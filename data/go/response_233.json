[{"tags": ["go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 3, "creation_date": 1561577824, "post_id": 56779889, "comment_id": 100114870, "body": "What have you tried? Give example code please. This site is for programming problems, not &#39;write my simple code for me&#39;. Start here - <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow noreferrer\">golang.org/pkg/strings</a>"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1561577856, "post_id": 56779889, "comment_id": 100114891, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/20827332/how-to-find-a-character-index-in-golang\">How to find a character index in Golang?</a>"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1561588256, "post_id": 56779889, "comment_id": 100118278, "body": "<a href=\"https://play.golang.org/p/euaU-hy-Fly\" rel=\"nofollow noreferrer\">play.golang.org/p/euaU-hy-Fly</a>, in play.golang.org you could test/share what you have been doing"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1561595091, "post_id": 56779889, "comment_id": 100119657, "body": "@nbari: Your code (<a href=\"https://play.golang.org/p/euaU-hy-Fly\" rel=\"nofollow noreferrer\">play.golang.org/p/euaU-hy-Fly</a>) does not do a slice bounds check. It may <code>panic: runtime error: index out of range</code>. Your code does not work for &quot;any given string.&quot; It only works for ASCII characters."}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1561595241, "post_id": 56780019, "comment_id": 100119675, "body": "Your code does not do a slice bounds check. It may <code>panic: runtime error: index out of range</code>. Converting the entire string to a rune slice is inefficient."}], "tags": [], "owner": {"reputation": 586, "user_id": 8580266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911ad9fb565b3ce8c460014df914b3bf?s=128&d=identicon&r=PG&f=1", "display_name": "alexzimmer96", "link": "https://stackoverflow.com/users/8580266/alexzimmer96"}, "is_accepted": false, "score": -1, "last_activity_date": 1561578293, "creation_date": 1561578293, "answer_id": 56780019, "question_id": 56779889, "link": "https://stackoverflow.com/questions/56779889/how-to-find-an-exact-character-at-a-particular-position-in-a-string/56780019#56780019", "title": "How to find an exact character at a particular position in a string", "body": "<p>You could use a rune-array:</p>\n\n<pre><code>text := \"ifthisisyourstring\"\nchars := []rune(text)\nif chars[0] == '1' {\n    // is true\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1561603886, "last_edit_date": 1561603886, "creation_date": 1561591842, "answer_id": 56782132, "question_id": 56779889, "link": "https://stackoverflow.com/questions/56779889/how-to-find-an-exact-character-at-a-particular-position-in-a-string/56782132#56782132", "title": "How to find an exact character at a particular position in a string", "body": "<p>In Go, string character values are Unicode characters encoded in UTF-8. UTF-8 is a variable-length encoding which uses one to four bytes per character.</p>\n\n<p>For your example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode/utf8\"\n)\n\nfunc is10Hyphen(s string) bool {\n    for n := 1; len(s) &gt; 0; n++ {\n        r, size := utf8.DecodeRuneInString(s)\n        if r == utf8.RuneError &amp;&amp; (size == 0 || size == 1) {\n            return false\n        }\n        if n == 10 {\n            return r == '-'\n        }\n        s = s[size:]\n    }\n    return false\n}\n\nfunc main() {\n    s := \"absoloute-power\"\n    fmt.Println(is10Hyphen(s))\n    s = \"absoloute+power\"\n    fmt.Println(is10Hyphen(s))\n    s = \"absoloute\"\n    fmt.Println(is10Hyphen(s))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/h9rMQWWAdvb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h9rMQWWAdvb</a></p>\n\n<p>Output:</p>\n\n<pre><code>true\nfalse\nfalse\n</code></pre>\n\n<hr>\n\n<p>If you are willing to consider encountering the Unicode replacement character an error, then for your example:</p>\n\n<pre><code>func is10Hyphen(s string) bool {\n    n := 0\n    for _, r := range s {\n        if r == utf8.RuneError {\n            return false\n        }\n        n++\n        if n == 10 {\n            return r == '-'\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/SHbPAnldTyw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SHbPAnldTyw</a></p>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1561639328, "post_id": 56790912, "comment_id": 100136836, "body": "Your code does not work for &quot;any given string.&quot; It only works for ASCII characters."}, {"owner": {"reputation": 116, "user_id": 11701044, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FXxgEr8BrpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2egQHtyv-v5o5SQResq1TYjg_qg/photo.jpg?sz=128", "display_name": "SennoYuki", "link": "https://stackoverflow.com/users/11701044/sennoyuki"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1561687683, "post_id": 56790912, "comment_id": 100154995, "body": "Yes,I forgot the case"}, {"owner": {"reputation": 116, "user_id": 11701044, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FXxgEr8BrpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2egQHtyv-v5o5SQResq1TYjg_qg/photo.jpg?sz=128", "display_name": "SennoYuki", "link": "https://stackoverflow.com/users/11701044/sennoyuki"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1561689219, "post_id": 56790912, "comment_id": 100155200, "body": "using utf8.DecodeRuneInString for the case of the invalid encoding?"}], "tags": [], "owner": {"reputation": 116, "user_id": 11701044, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FXxgEr8BrpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2egQHtyv-v5o5SQResq1TYjg_qg/photo.jpg?sz=128", "display_name": "SennoYuki", "link": "https://stackoverflow.com/users/11701044/sennoyuki"}, "is_accepted": false, "score": -2, "last_activity_date": 1561688679, "last_edit_date": 1561688679, "creation_date": 1561638141, "answer_id": 56790912, "question_id": 56779889, "link": "https://stackoverflow.com/questions/56779889/how-to-find-an-exact-character-at-a-particular-position-in-a-string/56790912#56790912", "title": "How to find an exact character at a particular position in a string", "body": "<p>As string is an array in fact, you can access the 10th position directly.Of course, need to avoid \"out of range \" error.\nFor the case of the non-ascii encoding, converting it to a rune array</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\nfunc main() {\n  fmt.Println(Check(\"213123-dasdas\"))\n  fmt.Println(Check(\"213123sdas\"))\n  fmt.Println(Check(\"213123das-das\"))\n  fmt.Println(Check(\"213123dasda-s\"))\n  fmt.Println(Check(\"---------2----------\"))\n}\n\nfunc Check(ss string) bool {\n  r = []rune(ss)\n  if len(r) &lt; 10 {\n    return false\n  }\n  return ss[r] == '-'\n}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 9189479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5dd31c32cd9afefcafe62fcb009f22e4?s=128&d=identicon&r=PG&f=1", "display_name": "jberthia", "link": "https://stackoverflow.com/users/9189479/jberthia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1561688679, "creation_date": 1561577663, "last_edit_date": 1561604914, "question_id": 56779889, "link": "https://stackoverflow.com/questions/56779889/how-to-find-an-exact-character-at-a-particular-position-in-a-string", "title": "How to find an exact character at a particular position in a string", "body": "<p>I have the following string:</p>\n\n<pre><code>absoloute-power\n</code></pre>\n\n<p>As you can see, there is a \"-\" at position number 10 in the string.  How do I write the go code to validate if the 10th position of any given string has a \"-\" in the string?</p>\n"}, {"tags": ["go", "httphandler", "goroutine", "timeoutexception"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1561571973, "post_id": 56777996, "comment_id": 100112382, "body": "go does provide <code>context.Context</code> to inform go-routines when to return when a result is no longer needed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1561572591, "post_id": 56777996, "comment_id": 100112633, "body": "Go cannot &quot;kill&quot; goroutines, it&#39;s up to you to return when the request is done."}, {"owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561623608, "post_id": 56777996, "comment_id": 100127717, "body": "do you agree? It&#39;s a leak? I&#39;ve used time.Sleep to show that its a large time consuming computation and even after request ends it still goes on. Somehow I want to stop that, because there is no meaning of running that goroutine anymore."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1561656722, "post_id": 56777996, "comment_id": 100146637, "body": "Do we agree with what? Yes it could be considered a leak if you don&#39;t return, and it&#39;s also invalid to write to the <code>ResponseWriter</code> after the request has ended; both of those things are up to you to do correctly."}, {"owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561705885, "post_id": 56777996, "comment_id": 100159255, "body": "Do we agree with what? &gt; about goroutine leak. You already answer that."}], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561577086, "post_id": 56778810, "comment_id": 100114556, "body": "Thanks. That means I can never kill any goroutine, if there is a long execution of any task. So, is it good way to use http.TimeoutHandler? Because it creates 2 goroutines?  <a href=\"https://play.golang.org/p/yxjRDxU1eBh\" rel=\"nofollow noreferrer\">play.golang.org/p/yxjRDxU1eBh</a>"}, {"owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561577826, "post_id": 56778810, "comment_id": 100114872, "body": "<a href=\"https://play.golang.org/p/ToGlhTA_F9M\" rel=\"nofollow noreferrer\">play.golang.org/p/ToGlhTA_F9M</a> - fatal error: all goroutines are asleep - deadlock! Can you plz help with me? What this error means?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561602226, "post_id": 56778810, "comment_id": 100120742, "body": "your linked code has diverged from your original question - perhaps you should post a new question..."}, {"owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "edited": false, "score": 0, "creation_date": 1561622845, "post_id": 56778810, "comment_id": 100127326, "body": "Ok, my original question remains the same. It&#39;s a leak and not able to achieve it if there is large computation going on.  Thanks for your help. It is really helpful."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1561574844, "last_edit_date": 1561574844, "creation_date": 1561572800, "answer_id": 56778810, "question_id": 56777996, "link": "https://stackoverflow.com/questions/56777996/goroutine-leaks-http-timeouthandler-does-not-kill-respective-servehttp-gorouti/56778810#56778810", "title": "(goroutine leaks) http.TimeoutHandler does not kill respective ServeHTTP goroutine", "body": "<p>Use <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context.Context</a> to instruct go-routines to abort their function. The go-routines, of course, have to listen for such cancelation events.</p>\n\n<p>So for your code, do something like:</p>\n\n<pre><code>ctx := req.Context() // this will be implicitly canceled by your TimeoutHandler after 1s\n\ni := 0\nfor {\n    if i == 500 {\n        break\n    }\n\n    // for any long wait (1s etc.) always check the state of your context\n    select {\n    case &lt;-time.After(1 * time.Second): // no cancelation, so keep going\n    case &lt;-ctx.Done():\n        fmt.Println(\"request context has been canceled:\", ctx.Err())\n        return // terminates go-routine\n    }\n    i++\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/VEnW0vsItXm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VEnW0vsItXm</a></p>\n\n<hr>\n\n<p><strong>Note:</strong> <code>Context</code> are designed to be chained - allowing for multiple levels of sub-tasks to be canceled in a cascading manner.</p>\n\n<p>In a typical REST call one would initiate a database request. So, to ensure such a blocking and/or slow call completes in a timely manner, instead of using <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\">Query</a> one should use <a href=\"https://golang.org/pkg/database/sql/#DB.QueryContext\" rel=\"nofollow noreferrer\">QueryContext</a> - passing in the http request's context as the first argument.</p>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "is_accepted": true, "score": 0, "last_activity_date": 1564071327, "creation_date": 1564071327, "answer_id": 57206312, "question_id": 56777996, "link": "https://stackoverflow.com/questions/56777996/goroutine-leaks-http-timeouthandler-does-not-kill-respective-servehttp-gorouti/57206312#57206312", "title": "(goroutine leaks) http.TimeoutHandler does not kill respective ServeHTTP goroutine", "body": "<p>I found, if you do not have any way to reach to your channel then there is no way to kill or stop goroutine when it is running.</p>\n\n<p>In the large computational task, you have to watch the channel on a specific interval or after specific task completion. </p>\n"}], "owner": {"reputation": 182, "user_id": 5156040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KhTad.jpg?s=128&g=1", "display_name": "Roshan Gade", "link": "https://stackoverflow.com/users/5156040/roshan-gade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 57206312, "answer_count": 2, "score": -2, "last_activity_date": 1564071327, "creation_date": 1561569190, "last_edit_date": 1561706736, "question_id": 56777996, "link": "https://stackoverflow.com/questions/56777996/goroutine-leaks-http-timeouthandler-does-not-kill-respective-servehttp-gorouti", "title": "(goroutine leaks) http.TimeoutHandler does not kill respective ServeHTTP goroutine", "body": "<p>Timeout handler moves ServeHTTP execution on a new goroutine, but not able to kill that goroutine after the timer ends. On every request, it creates two goroutines, but ServeHTTP goroutines never kill with context.</p>\n\n<p>Not able to find a way to kill goroutines.</p>\n\n<p><strong>Edit</strong> For-loop with time.Sleep function, represents huge computation which goes beyond our timer. Can replace it with any other function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"runtime\"\n    \"time\"\n)\n\ntype api struct{}\n\nfunc (a api) ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    // For-loop block represents huge computation and usually takes more time\n    // Can replace with any code\n    i := 0\n    for {\n        if i == 500 {\n            break\n        }\n        fmt.Printf(\"#goroutines: %d\\n\", runtime.NumGoroutine())\n        time.Sleep(1 * time.Second)\n        i++\n    }\n    _, _ = io.WriteString(w, \"Hello World!\")\n}\n\nfunc main() {\n    var a api\n    s := http.NewServeMux()\n    s.Handle(\"/\", a)\n    h := http.TimeoutHandler(s, 1*time.Second, `Timeout`)\n\n    fmt.Printf(\"#goroutines: %d\\n\", runtime.NumGoroutine())\n\n    _ = http.ListenAndServe(\":8080\", h)\n}\n\n</code></pre>\n\n<p>ServeHTTP goroutine should kill along with request context, normally which does not happen.</p>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "edited": false, "score": 0, "creation_date": 1561634534, "post_id": 56777317, "comment_id": 100134072, "body": "I have actually answered a question similar to this here : <a href=\"https://stackoverflow.com/questions/55383558/kafka-uncommitted-message-not-getting-consumed-again/55386024#55386024\">Kafka uncommitted message not getting consumed again</a>"}, {"owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "edited": false, "score": 0, "creation_date": 1561634772, "post_id": 56777317, "comment_id": 100134211, "body": "Also another thing for you to check is are you using a consumer group while starting a new consumer, because the  data that is read and unread is usually tracked by kafka using consumer groups"}], "owner": {"reputation": 21, "user_id": 11484133, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vY8hQkjAnAY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcztc1Pohy0-y0N5JCMlOGhlJWRqA/mo/photo.jpg?sz=128", "display_name": "Piyush Kumar", "link": "https://stackoverflow.com/users/11484133/piyush-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561566464, "creation_date": 1561566464, "question_id": 56777317, "link": "https://stackoverflow.com/questions/56777317/apache-kafka-consumer-resume-behaviour", "title": "apache kafka consumer resume behaviour", "body": "<p>I am currently working on Apache Kafka using go/golang confluent library. I have some doubts regarding consumer and its APIs.</p>\n\n<ol>\n<li><p>I am using pause and resume APIs of the library and doing manual commits. Let's say, I send 100 messages and without committing, I paused consumer and resume it afterward. I notice it didn't consume those 100 messages again but it started consuming the latest messages. Is this an expected behavior? If yes, is there a way to consume those 100 messages again.</p></li>\n<li><p>When I am resuming the consumers, after some processing, I am doing manual commit. I noticed the return offset committed is -1001 for a partition. I am not able to understand why it is happening and what it means? Did I lose all the data or the commit failed?</p></li>\n<li><p>Can someone please explain to me auto.offset.reset - latest and earliest?</p></li>\n</ol>\n\n<p>Thanks</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": 0, "last_activity_date": 1561812029, "creation_date": 1561812029, "answer_id": 56817608, "question_id": 56776608, "link": "https://stackoverflow.com/questions/56776608/creating-a-dynamic-filter-with-mongo-go-driver/56817608#56817608", "title": "Creating a dynamic filter with mongo-go-driver", "body": "<p>query op <code>$text</code> search <strong>across</strong> text index fields on a doc, you can't do single field search with <code>$text</code></p>\n\n<p>assuming you have created a text index on <code>name</code>, then try:</p>\n\n<pre><code>  if f.Name != \"\" {\n        filter = append(filter, bson.E{Key: \"$text\", Value: bson.M{\"$search\": f.Name}})\n    }\n</code></pre>\n"}], "owner": {"reputation": 1034, "user_id": 3176972, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mlKGV.png?s=128&g=1", "display_name": "SaroVin", "link": "https://stackoverflow.com/users/3176972/sarovin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 396, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1586104266, "creation_date": 1561563870, "question_id": 56776608, "link": "https://stackoverflow.com/questions/56776608/creating-a-dynamic-filter-with-mongo-go-driver", "title": "Creating a dynamic filter with mongo-go-driver", "body": "<p>I want create a dynamic filter with the mongo-go-driver.</p>\n\n<p>For example, I have this documents:</p>\n\n<pre><code>{\n\"_id\":\"5d1231380a2a2b39a99c3ed1\"},\n\"name\":\"flower.png\",\n\"colors\":[\"#ffffff\",\"#212121\",\"#999999\",\"#dbdbdb\",\"#ff5252\"],\n},\n{\n\"_id\":\"5d1231380a2a2b39a99c3ed0\"},\n\"name\":\"image of go.jpg\",\n\"colors\":[\"#dedede\",\"#dfdfdf\",\"#dddddd\",\"#e0e0e0\",\"#e2e2e2\"],\n},\n{\n\"_id\":\"5d1231380a2a2b39a99c3ecf\"},\n\"name\":\"bolket rulez.png\",\n\"colors\":[\"#000000\",\"#010101\",\"#020202\",\"#030303\",\"#040404\"],\n},\n{\n\"_id\":\"5d1231380a2a2b39a99c3ecf\"},\n\"name\":\"bolket photo.png\",\n\"colors\":[\"#ffffff\",\"#010101\",\"#020202\",\"#030303\",\"#040404\"],\n}\n</code></pre>\n\n<p>Now I want all documents that have \"bolket\" in the name and \"#ffffff\" color.</p>\n\n<p>I have tryed with this filter:</p>\n\n<pre><code>filter := make(bson.D, 2)\n\n    if f.Name != \"\" {\n        filter = append(filter, bson.E{Key: \"name\", Value: bson.M{\"$text\": bson.M{\"$search\": f.Name}}})\n    }\n\n    if f.Color != \"\" {\n        filter = append(filter, bson.E{Key: \"colors\", Value: bson.M{\"$in\": f.Color}})\n    }\n</code></pre>\n\n<p>But with this filter I have this error: <code>(BadValue) unknown operator: $text\n</code></p>\n\n<p>How can I create a dynamic filter???</p>\n"}, {"tags": ["mysql", "database", "go", "logging"], "comments": [{"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1561560764, "post_id": 56775552, "comment_id": 100106756, "body": "<i>&quot;Now, what i want to do is to log every query that is being executed. How can i do this?&quot;</i> Stop reinventing the wheel ?  See <a href=\"https://dev.mysql.com/doc/refman/8.0/en/query-log.html\" rel=\"nofollow noreferrer\">The General Query Log</a> .. <i>&quot;I want to do client side logging. &quot;</i> Why?  Client logging which uses prepared statements is much harder to do"}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1561560988, "post_id": 56775552, "comment_id": 100106905, "body": "Otherwise the most easy way i geuss is to make a MySQL proxy on the local client where you proxy the prepared statement query request, log it and send it to the MySQL server and proxy the response back to the program"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1561637687, "post_id": 56775552, "comment_id": 100135771, "body": "Your problem is essentially the context, right? How to get the information from it... because all other info is right there."}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561560486, "creation_date": 1561560486, "question_id": 56775552, "link": "https://stackoverflow.com/questions/56775552/logging-sql-queries", "title": "Logging SQL queries", "body": "<p>Our go code is organized like this. </p>\n\n<p>We have MySQL struct</p>\n\n<pre><code>type MySQL struct {\n    mysqlDB *sql.DB\n    db      sqlbuilder.Database\n    logger  service.logger\n}\n</code></pre>\n\n<p>Our repository</p>\n\n<pre><code>type ServiceRepo struct {\n    db     *database.MySQL\n    logger servicelogger.Logger\n}\n</code></pre>\n\n<p>and then we use these structs to issue sql queries like this</p>\n\n<pre><code>statement, err := s.db.RawDatabase().PrepareContext(ctx, query)\nif err != nil {\n    return err\n}\ndefer statement.Close()\n\n_, err = statement.ExecContext(ctx, value1)\n</code></pre>\n\n<p>Now, what i want to do is to log every query that is being executed. How can i do this? I want to do client side logging. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 9367249, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Raw4ka1TOyQ/AAAAAAAAAAI/AAAAAAAAATM/_mE6S8xylZ0/photo.jpg?sz=128", "display_name": "TheJet 1", "link": "https://stackoverflow.com/users/9367249/thejet-1"}, "edited": false, "score": 0, "creation_date": 1561560653, "post_id": 56775354, "comment_id": 100106689, "body": "Thanks this is closer than I was able to get. I am now getting the Error: exit status 1619, which equates to the msi file being in a subfolder. I do not understand how this is the issue as I am supplying the full path to the msi file as the &quot;pathtotheMSIfile&quot; argument."}, {"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "reply_to_user": {"reputation": 91, "user_id": 9367249, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Raw4ka1TOyQ/AAAAAAAAAAI/AAAAAAAAATM/_mE6S8xylZ0/photo.jpg?sz=128", "display_name": "TheJet 1", "link": "https://stackoverflow.com/users/9367249/thejet-1"}, "edited": false, "score": 1, "creation_date": 1561561160, "post_id": 56775354, "comment_id": 100107031, "body": "try to make the following test: move the MSI file into your golang execution folder, and call it by his name Error code 1619 = &quot;This installation package could not be opened. Verify that the package exists and that you can access it, or contact the application vendor to verify that this is a valid Windows Installer package."}], "tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": true, "score": 1, "last_activity_date": 1561561481, "last_edit_date": 1561561481, "creation_date": 1561559910, "answer_id": 56775354, "question_id": 56775273, "link": "https://stackoverflow.com/questions/56775273/how-do-i-run-a-msi-file-using-golang/56775354#56775354", "title": "How do I run a .msi file using golang?", "body": "<p>you can simply run it through  windows's command line</p>\n\n<pre><code>   func main(){    \n    c := exec.Command(\"cmd\", \"/C\", \"msiexec /a \\\"pathtotheMSIfile\\\"\")\n    if err := c.Run(); err != nil { \n        fmt.Println(\"Error: \", err)\n    }   \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 1, "last_activity_date": 1610320484, "last_edit_date": 1610320484, "creation_date": 1606275863, "answer_id": 64998233, "question_id": 56775273, "link": "https://stackoverflow.com/questions/56775273/how-do-i-run-a-msi-file-using-golang/64998233#64998233", "title": "How do I run a .msi file using golang?", "body": "<p>Create a file like this:</p>\n<pre><code>//go:generate mkwinsyscall -output zmsi.go msi.go\n//sys MsiInstallProduct(path string, command string) (e error) = msi.MsiInstallProductW\npackage main\nimport &quot;log&quot;\n\nfunc main() {\n   e := MsiInstallProduct(`C:\\a.msi`, &quot;&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n}\n</code></pre>\n<p>Then build:</p>\n<pre><code>go generate\ngo mod init msi\ngo build\n</code></pre>\n<p><a href=\"https://github.com/golang/sys/tree/master/windows/mkwinsyscall\" rel=\"nofollow noreferrer\">https://github.com/golang/sys/tree/master/windows/mkwinsyscall</a></p>\n"}], "owner": {"reputation": 91, "user_id": 9367249, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Raw4ka1TOyQ/AAAAAAAAAAI/AAAAAAAAATM/_mE6S8xylZ0/photo.jpg?sz=128", "display_name": "TheJet 1", "link": "https://stackoverflow.com/users/9367249/thejet-1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 2, "accepted_answer_id": 56775354, "answer_count": 2, "score": 0, "last_activity_date": 1610320484, "creation_date": 1561559616, "question_id": 56775273, "link": "https://stackoverflow.com/questions/56775273/how-do-i-run-a-msi-file-using-golang", "title": "How do I run a .msi file using golang?", "body": "<p>I'm writing a function that will run an msi file by taking in the applications path as a parameter. Right now the function is returning an error code stating that the application's path is not a valid Win32 application. This function works for .exe files, but not .msi files. How can I refactor it to work for .msi files?</p>\n\n<pre><code>func Run(application string) {\n    cmd := exec.Command(application)\n    err := cmd.Run()\n    if err != nil {\n        log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["javascript", "node.js", "go", "gopherjs"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561558830, "post_id": 56774821, "comment_id": 100105492, "body": "what type is this <code>RID</code> object in JS? Is it a string? Or is it a typed array? Or something else?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1561559161, "post_id": 56774821, "comment_id": 100105732, "body": "Try <a href=\"https://godoc.org/github.com/gopherjs/gopherjs/js#Object.Interface\" rel=\"nofollow noreferrer\">godoc.org/github.com/gopherjs/gopherjs/js#Object.Interface</a> and then type assert the output."}], "answers": [{"tags": [], "owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "is_accepted": true, "score": 1, "last_activity_date": 1561560915, "creation_date": 1561560915, "answer_id": 56775684, "question_id": 56774821, "link": "https://stackoverflow.com/questions/56774821/how-to-access-a-javascript-object-as-an-array/56775684#56775684", "title": "How to access a JavaScript object as an array", "body": "<p>Woo-hoo - got it!\nThanks for suggestions :)</p>\n\n<pre><code>func makeRID(o *js.Object) string {\n  // access the array of numbers in member RID:\n  jsRID := o.Get(\"RID\")\n  // I know that the source object's RID member is an Array, so we can access it in gopherjs as:\n  jsArray := jsRID.Interface().([]interface{})\n  // ... profit!\n}\n</code></pre>\n"}], "owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 56775684, "answer_count": 1, "score": 0, "last_activity_date": 1561560915, "creation_date": 1561558139, "last_edit_date": 1561559003, "question_id": 56774821, "link": "https://stackoverflow.com/questions/56774821/how-to-access-a-javascript-object-as-an-array", "title": "How to access a JavaScript object as an array", "body": "<p>In GopherJS, members of an object are themselves objects (just as js handles things under the hood, ttbomk).</p>\n\n<p>So when accessing a member, one gets back a <code>*js.Object</code>:</p>\n\n<pre><code>func makeRID(o *js.Object) string {\n  // access the array of numbers in member RID:\n  arr := o.Get(\"RID\")\n  // arr is now a *js.Object - not an []interface{} - which is what I actually need (and what the contents of the property RID really are...\n}\n</code></pre>\n\n<p>the incoming <code>o</code> is a js object that was extracted from a JSON response from the server.  Its member \"RID\" is the array of byte values - e.g. <code>{ RID: [ 136, 210, 92, 97, 152, 26, 17, 233, 147, 147, 8, 0, 39, 223, 163, 7 ],</code> ...</p>\n\n<p>I'm not googling nor seeing in the js Docs for gopherjs any clear indication of how to go from a *js.Object to a gopherjs equivalent of an js array, namely <code>[]interface{}</code></p>\n\n<p>Ideas?</p>\n\n<p><code>*js.Object -&gt; []interface{}</code></p>\n"}, {"tags": ["go", "code-coverage", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 1, "creation_date": 1561556879, "post_id": 56774273, "comment_id": 100104182, "body": "Please report the issue on the official issue tracker <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issues/Go</a> as more details are needed to figure out what&#39;s happening. For example, the IDE version, how do you run the tests, is the command that GoLand runs the same as the one you run in the command line and so on."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561557651, "post_id": 56774273, "comment_id": 100104692, "body": "Do you run your tests with coverage on the IDE?"}, {"owner": {"reputation": 573, "user_id": 7792934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7750267565c576fe30290043ca719936?s=128&d=identicon&r=PG&f=1", "display_name": "D. Pinheiro", "link": "https://stackoverflow.com/users/7792934/d-pinheiro"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561561078, "post_id": 56774273, "comment_id": 100106963, "body": "@georgeok As I explained above, yes. Running the tests on the terminal works fine. Only with the IDE is that I can not analyze the code coverage"}], "owner": {"reputation": 573, "user_id": 7792934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7750267565c576fe30290043ca719936?s=128&d=identicon&r=PG&f=1", "display_name": "D. Pinheiro", "link": "https://stackoverflow.com/users/7792934/d-pinheiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 521, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561556478, "creation_date": 1561556478, "question_id": 56774273, "link": "https://stackoverflow.com/questions/56774273/goland-ide-tests-coverage", "title": "Goland IDE - Tests Coverage", "body": "<p>I'm recently using the Goland IDE and I'm having trouble getting the test code coverage.\nIn the package, I right-click and click on 'Run with coverage'. The tests are run but I always get as a result: \"<em>coverage: 0.0% of statements in ...</em>\".</p>\n\n<p>Additionally, the coverage window that the IDE opens after run tests is empty:</p>\n\n<p><a href=\"https://i.stack.imgur.com/vuEsB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vuEsB.png\" alt=\"enter image description here\"></a></p>\n\n<p>If I run test coverage via terminal and export to html, it works fine. Example:</p>\n\n<pre><code>$ go test -coverprofile=coverage.out\n$ go tool cover -html=coverage.out -o cov.html\n</code></pre>\n\n<p>Is there any known problem with IDE? Any solution?</p>\n"}, {"tags": ["go", "yaml", "viper-go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561555725, "post_id": 56773979, "comment_id": 100103451, "body": "Can you please include a <i>complete</i> verifiable example, complete with the actual output and what you expected instead?"}, {"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561555930, "post_id": 56773979, "comment_id": 100103569, "body": "@Flimzy yeah, I updated the question, hope it be enough."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561556009, "post_id": 56773979, "comment_id": 100103612, "body": "So you expect it to be empty?"}, {"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561556382, "post_id": 56773979, "comment_id": 100103865, "body": "@Flimzy No, I expect all the fields to be filled with the value in the yaml file. But some values like url and location are filled and others are empty! when I print the empty ones with the viper.Get() they are not empty! so the unmarshalling method is not working properly for me."}], "answers": [{"comments": [{"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 1, "creation_date": 1561569702, "post_id": 56775231, "comment_id": 100111371, "body": "viper first unmarshal all fields into an empty interface then use the <a href=\"https://godoc.org/github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">mapstructure</a> package to unmarshal it into a specific structure."}, {"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "reply_to_user": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1561743620, "post_id": 56775231, "comment_id": 100176541, "body": "so the problem is with mapstructure that can\u2019t understand <code>yaml:</code> tags?"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 1, "creation_date": 1561743718, "post_id": 56775231, "comment_id": 100176570, "body": "mapstructure converts the given string to empty interface map into a struct so it must not understand the yaml tags :)"}], "tags": [], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "is_accepted": true, "score": 3, "last_activity_date": 1561559499, "creation_date": 1561559499, "answer_id": 56775231, "question_id": 56773979, "link": "https://stackoverflow.com/questions/56773979/viper-is-not-considering-the-yaml-tags-in-my-structs-on-unmarshalling/56775231#56775231", "title": "Viper is not considering the yaml tags in my structs on unmarshalling", "body": "<p>Finally found the solution, changing <code>yaml:</code> tags to <code>mapstructure:</code> will fix the problem.</p>\n\n<p>It seems that viper couldn't unmarshal the fields that haven't the same key name in my <code>.yaml</code> file. Like the <code>access_key</code> and <code>secret_key</code> in the question, cause the struct fields where <code>AccessKey</code> and <code>SecretKey</code>.</p>\n\n<p>But the fields like <code>location</code> and <code>url</code> that had the same name in the struct and <code>.yaml</code> file, and there was no problem.</p>\n\n<p>As <a href=\"https://github.com/spf13/viper/issues/385\" rel=\"nofollow noreferrer\">this issue</a> says:</p>\n\n<blockquote>\n  <p>The problem is that <code>viper</code> uses mapstructure package for\n  unmarshalling config maps to structs. It doesn't support yaml tags\n  used by the yaml package.</p>\n</blockquote>\n\n<p>So changing the <code>yaml:</code> in the tags to <code>mapstructure:</code> had fixed the problem.</p>\n"}], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1070, "favorite_count": 0, "accepted_answer_id": 56775231, "answer_count": 1, "score": 0, "last_activity_date": 1561559499, "creation_date": 1561555635, "last_edit_date": 1561556464, "question_id": 56773979, "link": "https://stackoverflow.com/questions/56773979/viper-is-not-considering-the-yaml-tags-in-my-structs-on-unmarshalling", "title": "Viper is not considering the yaml tags in my structs on unmarshalling", "body": "<p>when I use the <code>Unmarshal</code> method of viper to fill my config structs with the values in my yaml file, some of the struct fields became empty!\nI do it in this way:</p>\n\n<pre><code>viper.SetConfigType(\"yaml\")\nviper.SetConfigName(\"config\")\nviper.AddConfigPath(\"/etc/myapp/\")\nviper.AddConfigPath(\".\")\n\nerr := viper.ReadInConfig()\n// error checking ...\nconf := &amp;ConfYaml{}\nerr = viper.Unmarshal(conf)\n// error checking ...\n</code></pre>\n\n<p>And my structs are like this:</p>\n\n<pre><code>type ConfYaml struct {\n    Endpoints SectionStorageEndpoint `yaml:\"endpoints\"`\n}\n\ntype SectionStorageEndpoint struct {\n    URL       string `yaml:\"url\"`\n    AccessKey string `yaml:\"access_key\"`\n    SecretKey string `yaml:\"secret_key\"`\n    UseSSL    bool   `yaml:\"use_ssl\"`\n    Location  string `yaml:\"location\"`\n}\n</code></pre>\n\n<p>Here the <code>url</code> and <code>location</code> fields are filled with proper value in the yaml file, but the other fields are empty!</p>\n\n<p>It's wondering that when I try to print a field like:</p>\n\n<pre><code>viper.Get(\"endpoints.access_key\")\n</code></pre>\n\n<p>it prints the proper value in the yaml file and <strong>is not empty</strong>!!</p>\n"}, {"tags": ["go", "microservices"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561555622, "post_id": 56773961, "comment_id": 100103369, "body": "Use a common library."}, {"owner": {"reputation": 3265, "user_id": 5842430, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kzxRTPC_BI0/AAAAAAAAAAI/AAAAAAAAAKg/yYr8RBdEqQ4/photo.jpg?sz=128", "display_name": "federico scamuzzi", "link": "https://stackoverflow.com/users/5842430/federico-scamuzzi"}, "edited": false, "score": 0, "creation_date": 1561556494, "post_id": 56773961, "comment_id": 100103927, "body": "use artifacts (i don&#39;t know if their are in GO .. but in JAVA and C# etc it is possible .. so you can install them as packages)"}], "answers": [{"tags": [], "owner": {"reputation": 586, "user_id": 8580266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911ad9fb565b3ce8c460014df914b3bf?s=128&d=identicon&r=PG&f=1", "display_name": "alexzimmer96", "link": "https://stackoverflow.com/users/8580266/alexzimmer96"}, "is_accepted": true, "score": 1, "last_activity_date": 1561556373, "creation_date": 1561556373, "answer_id": 56774234, "question_id": 56773961, "link": "https://stackoverflow.com/questions/56773961/how-should-i-avoid-multiple-implementation-of-my-methods-in-a-micro-service-arch/56774234#56774234", "title": "How should I avoid multiple implementation of my methods in a micro service architecture", "body": "<p>The idea you already mentioned can't be that wrong. When you have a set of services sharing the same models, it can be a good idea to extract these models into an own package/module.</p>\n\n<p>We decided to do this in a Java-Project a few months ago and it made things a lot easier. Especially when your services are decoupled used some type of messaging/streaming, you absolutely have a set of common entities they need for communication.</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "closed_date": 1561657497, "accepted_answer_id": 56774234, "answer_count": 1, "score": -3, "last_activity_date": 1561556373, "creation_date": 1561555590, "last_edit_date": 1561555642, "question_id": 56773961, "link": "https://stackoverflow.com/questions/56773961/how-should-i-avoid-multiple-implementation-of-my-methods-in-a-micro-service-arch", "closed_reason": "Needs more focus", "title": "How should I avoid multiple implementation of my methods in a micro service architecture", "body": "<p>I am working in a microservice architecture ( my first one ), in Golang, and I find myself duplicating Models definition over several services.</p>\n\n<p>What can I do to avoid this?</p>\n\n<p>I can only think to implementing a shared library with all my model definitions but I can't evaluate pros and cons. Can you tell me about other ways to solve this issue?</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1561551062, "post_id": 56772452, "comment_id": 100100397, "body": "MongoDB driver returns a map between strings and interfaces as you set so your transform function must work with this not bytes."}], "answers": [{"tags": [], "owner": {"reputation": 586, "user_id": 8580266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911ad9fb565b3ce8c460014df914b3bf?s=128&d=identicon&r=PG&f=1", "display_name": "alexzimmer96", "link": "https://stackoverflow.com/users/8580266/alexzimmer96"}, "is_accepted": false, "score": 0, "last_activity_date": 1561555091, "creation_date": 1561555091, "answer_id": 56773779, "question_id": 56772452, "link": "https://stackoverflow.com/questions/56772452/mocking-mongodb-response-in-go/56773779#56773779", "title": "Mocking MongoDB response in Go", "body": "<p>The best solution to write testable could would be to extract your code to a DAO or Data-Repository. You would define an interface which would return what you need. This way, you can just used a Mocked Version for testing.</p>\n\n<pre><code>// repository.go\ntype ISomeRepository interface {\n    Get(string) (*SomeModel, error)\n}\n\ntype SomeRepository struct { ... }\n\nfunc (r *SomeRepository) Get(id string) (*SomeModel, error) {\n    // Handling a real repository access and returning your Object\n}\n</code></pre>\n\n<p>When you need to mock it, just create a Mock-Struct and implement the interface:</p>\n\n<pre><code>// repository_test.go\n\ntype SomeMockRepository struct { ... }\n\nfunc (r *SomeRepository) Get(id string) (*SomeModel, error) {\n    return &amp;SomeModel{...}, nil\n}\n\nfunc TestSomething() {\n    // You can use your mock as ISomeRepository\n    var repo *ISomeRepository\n    repo = &amp;SomeMockRepository{}\n    someModel, err := repo.Get(\"123\")\n}\n</code></pre>\n\n<p>This is best used with some kind of <a href=\"https://en.wikipedia.org/wiki/Dependency_injection\" rel=\"nofollow noreferrer\">dependency-injection</a>, so passing this repository as ISomeRepository into the function.</p>\n"}, {"tags": [], "owner": {"reputation": 35, "user_id": 3488339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0e5fde139f6b9dacf68b4766a1dc616?s=128&d=identicon&r=PG&f=1", "display_name": "mentalmap", "link": "https://stackoverflow.com/users/3488339/mentalmap"}, "is_accepted": false, "score": 0, "last_activity_date": 1562727175, "creation_date": 1562727175, "answer_id": 56962798, "question_id": 56772452, "link": "https://stackoverflow.com/questions/56772452/mocking-mongodb-response-in-go/56962798#56962798", "title": "Mocking MongoDB response in Go", "body": "<p>Using monkey library to hook any function from mongo driver.</p>\n\n<p>For example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func insert(collection *mongo.Collection) (int, error) {\n    ctx, _ := context.WithTimeout(context.Background(), 10*time.Second)\n\n    u := User{\n        Name: \"kevin\",\n        Age:  20,\n    }\n\n    res, err := collection.InsertOne(ctx, u)\n    if err != nil {\n        log.Printf(\"error: %v\", err)\n        return 0, err\n    }\n\n    id := res.InsertedID.(int)\n    return id, nil\n}\n\nfunc TestInsert(t *testing.T) {\n    var c *mongo.Collection\n\n    var guard *monkey.PatchGuard\n    guard = monkey.PatchInstanceMethod(reflect.TypeOf(c), \"InsertOne\",\n        func(c *mongo.Collection, ctx context.Context, document interface{}, opts ...*options.InsertOneOptions) (*mongo.InsertOneResult, error) {\n            guard.Unpatch()\n            defer guard.Restore()\n\n            log.Printf(\"record: %+v, collection: %s, database: %s\", document, c.Name(), c.Database().Name())\n            res := &amp;mongo.InsertOneResult{\n                InsertedID: 100,\n            }\n\n            return res, nil\n        })\n\n    collection := client.Database(\"db\").Collection(\"person\")\n    id, err := insert(collection)\n\n    require.NoError(t, err)\n    assert.Equal(t, id, 100)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10400458"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3318, "favorite_count": 3, "answer_count": 2, "score": 3, "last_activity_date": 1562727175, "creation_date": 1561550862, "last_edit_date": 1561553669, "question_id": 56772452, "link": "https://stackoverflow.com/questions/56772452/mocking-mongodb-response-in-go", "title": "Mocking MongoDB response in Go", "body": "<p>I'm fetching a document from MongoDB and passing it into function <code>transform</code>, e.g. </p>\n\n<pre><code>var doc map[string]interface{}\nerr := collection.FindOne(context.TODO(), filter).Decode(&amp;doc) \nresult := transform(doc)\n</code></pre>\n\n<p>I want to write unit tests for <code>transform</code>, but I'm not sure how to mock a response from MongoDB. Ideally I want to set something like this up:</p>\n\n<pre><code>func TestTransform(t *testing.T) {\n    byt := []byte(`\n    {\"hello\": \"world\",\n     \"message\": \"apple\"}\n `)\n\n    var doc map[string]interface{}\n\n    &gt;&gt;&gt; Some method here to Decode byt into doc like the code above &lt;&lt;&lt;\n\n    out := transform(doc)\n    expected := ...\n    if diff := deep.Equal(expected, out); diff != nil {\n        t.Error(diff)\n    }\n}\n</code></pre>\n\n<p>One way would be to <code>json.Unmarshal</code> into <code>doc</code>, but this sometimes gives different results. For example, if the document in MongoDB has an array in it, then that array is decoded into <code>doc</code> as a <code>bson.A</code> type not <code>[]interface{}</code> type.</p>\n"}, {"tags": ["json", "go", "deserialization"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1561537849, "post_id": 56768403, "comment_id": 100092630, "body": "<i>&quot;Obviously\uff0c this is not what I want&quot;</i> \u2013 <i>What</i> do you want? &quot;<i>&quot;is there a better way?&quot;</i> \u2013 Depends or what you want, you could use a struct to model the data, and unmarshal into a slice of that struct."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1561538272, "post_id": 56768403, "comment_id": 100092848, "body": "You&#39;re experiencing a float rounding error. Best not to use floats when you need int64."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561538941, "post_id": 56768403, "comment_id": 100093219, "body": "&quot;In addition to using a struct, is there a better way?&quot; No. A struct is the best way for this. Is there a reason a struct is a problem? If so, please explain it so we can help solve that issue, too."}, {"owner": {"reputation": 31, "user_id": 7130602, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1o2C.png?s=128&g=1", "display_name": "Jachin Huang", "link": "https://stackoverflow.com/users/7130602/jachin-huang"}, "edited": false, "score": 0, "creation_date": 1561539459, "post_id": 56768403, "comment_id": 100093568, "body": "Is interface{} not a good idea?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561539607, "post_id": 56768403, "comment_id": 100093660, "body": "<code>interface{}</code> is a good idea when it&#39;s needed. But you should generally use a concrete type whenever possible."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561539930, "post_id": 56768403, "comment_id": 100093828, "body": "&quot;Is interface{} not a good idea?&quot; Of course not. interface{} is the worst idea."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 8, "last_activity_date": 1561538795, "last_edit_date": 1561538795, "creation_date": 1561537898, "answer_id": 56768513, "question_id": 56768403, "link": "https://stackoverflow.com/questions/56768403/deserializing-json-numbers-returning-incorrect-values/56768513#56768513", "title": "Deserializing JSON numbers returning incorrect values", "body": "<p>The normal way to do this would be with a struct:</p>\n\n<pre><code>type myStruct struct {\n    Category string `json:\"category\"`\n    CID      int64  `json:\"cid\"`\n}\n\nvar oriInfo []myStruct\nerr := json.Unmarshal([]byte(pickled), &amp;oriInfo)\n// ... etc\n\n</code></pre>\n\n<p>This should solve your problem, since your problem is the result of <a href=\"https://stackoverflow.com/q/21895756/13860\">floating point rounding error</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 7130602, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1o2C.png?s=128&g=1", "display_name": "Jachin Huang", "link": "https://stackoverflow.com/users/7130602/jachin-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 56768513, "answer_count": 1, "score": -4, "last_activity_date": 1561539101, "creation_date": 1561537553, "last_edit_date": 1561539101, "question_id": 56768403, "link": "https://stackoverflow.com/questions/56768403/deserializing-json-numbers-returning-incorrect-values", "title": "Deserializing JSON numbers returning incorrect values", "body": "<p>I want to deserialize <code>json strings</code> with the go language. The value types of different keys are different. for example\uff0cin <code>string</code> <code>{\\\"category\\\":\\\"6\\\",\\\"cid\\\":2511993760745787586}</code>\uff0c<code>category</code> type is <code>string</code>, <code>cid</code> type is <code>int64</code>.</p>\n\n<p>my code is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    oriInfo := make([]interface{}, 0)\n    pickled := \"[{\\\"category\\\":\\\"6\\\",\\\"cid\\\":2511993760745787586},{\\\"category\\\":\\\"5\\\",\\\"cid\\\":2504429915944783937}]\"\n    err := json.Unmarshal([]byte(pickled), &amp;oriInfo)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    all := make([]map[string]interface{}, 0, len(oriInfo))\n    for _, val := range oriInfo {\n        m := make(map[string]interface{})\n        for k, v := range val.(map[string]interface{}) {\n            switch k {\n            case \"category\":\n                m[k] = v.(string)\n            case \"cid\":\n                m[k] = int64(v.(float64))\n            }\n        }\n        all = append(all, m)\n    }\n    fmt.Println(all)\n}\n</code></pre>\n\n<p>The results are as follows:<br>\n<code>[map[category:6 cid:2511993760745787392] map[category:5 cid:2504429915944783872]]</code></p>\n\n<p>Obviously\uff0cthis is not what I want, because the result of <code>cid</code> are <code>2511993760745787392</code> and <code>2504429915944783872</code>, but my original <code>cid</code> are <code>2511993760745787586</code> and <code>2504429915944783937</code>.<br>\nIn addition to using a struct, is there a better way?</p>\n"}, {"tags": ["go", "type-inference"], "comments": [{"owner": {"reputation": 420, "user_id": 9359459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9o8Pi.png?s=128&g=1", "display_name": "charles Lgn", "link": "https://stackoverflow.com/users/9359459/charles-lgn"}, "edited": false, "score": 0, "creation_date": 1561539095, "post_id": 56768392, "comment_id": 100093333, "body": "if you try to formating a slice of something to a slice of interface, you should maybe have a look <a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1561541361, "post_id": 56769184, "comment_id": 100094624, "body": "Yes, thing is I would have a single array of &quot;objects&quot;, so ... it might not be the best fit"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1561541727, "post_id": 56769184, "comment_id": 100094828, "body": "Are you saying that the slice of objects is already built before calling <code>Write</code> method? In that case you just need to invoke it like this: <code>Write(mySlice...)</code>."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1561543318, "post_id": 56769184, "comment_id": 100095775, "body": "Yep, my input in a slice of objects. Objects type may vary. I will check if that works"}], "tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 1, "last_activity_date": 1561540332, "creation_date": 1561540332, "answer_id": 56769184, "question_id": 56768392, "link": "https://stackoverflow.com/questions/56768392/omit-type-of-array-in-a-function-argument-with-golang/56769184#56769184", "title": "omit type of array in a function argument with golang", "body": "<p>This happens because <code>[]models.Meter</code> and <code>[]interface{}</code> are two different types for the Go compiler. </p>\n\n<p>Using <code>interface{}</code> is not a best-practice typically. It would be better to define your own type and use that instead.</p>\n\n<p>Having said that, the quickest solution for your case should be to make <code>Write</code> function a variadic one. Like the example below.</p>\n\n<p><a href=\"https://play.golang.org/p/KzzFMAjQvRa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KzzFMAjQvRa</a></p>\n\n<pre><code>func Write(myArray ...interface{}) (error) {\n    fmt.Printf(\"Slice: %v\\n\", myArray)\n    // Insert into DB\n    return nil\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 180, "user_id": 127838, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LNz5H.jpg?s=128&g=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/127838/mario"}, "is_accepted": false, "score": 0, "last_activity_date": 1561544333, "creation_date": 1561544333, "answer_id": 56770434, "question_id": 56768392, "link": "https://stackoverflow.com/questions/56768392/omit-type-of-array-in-a-function-argument-with-golang/56770434#56770434", "title": "omit type of array in a function argument with golang", "body": "<p>It is possible if you copy first to an []interface instance</p>\n\n<pre><code>func main() {\n\n   // Copy from your explicit type array\n   var interfaceSlice []interface{} = make([]interface{}, len(models.Meter))\n\n   for i, Modelvalue := range models.Meter {\n       interfaceSlice[i] = Modelvalue\n   }    \n\n   influxClient.Write(interfaceSlice)\n}\n</code></pre>\n\n<p><a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">Wiki Interface slice and arrays</a></p>\n\n<p><a href=\"https://play.golang.org/p/SujzWh7d56g\" rel=\"nofollow noreferrer\">Playground sample</a></p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 0, "closed_date": 1561545280, "accepted_answer_id": 56769184, "answer_count": 2, "score": -1, "last_activity_date": 1561544333, "creation_date": 1561537509, "last_edit_date": 1561537672, "question_id": 56768392, "link": "https://stackoverflow.com/questions/56768392/omit-type-of-array-in-a-function-argument-with-golang", "closed_reason": "Duplicate", "title": "omit type of array in a function argument with golang", "body": "<p>I'm writing a write method, to write an array of value to InfluxDB</p>\n\n<p>What I would like is to be able to have something like:</p>\n\n<pre><code>func (influxClient *InfluxClient) Write(myArray []interface{}) (error) {\n    fmt.Print(myArray)\n    // Insert into DB\n    return nil\n\n}\n</code></pre>\n\n<p>Where <code>myArray</code> could be an array with any objects inside</p>\n\n<p>I tried to use <code>myArray []interface{}</code> to ommit myArray's type, but it doesn't work, I get: </p>\n\n<pre><code>Cannot use 'meters' (type []models.Meter) as type []interface{}\n</code></pre>\n\n<p>Is it possible to achieve it ? </p>\n\n<p>How should I do ?</p>\n"}, {"tags": ["go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561533063, "post_id": 56766872, "comment_id": 100090198, "body": "somehow I didn&#39;t find my way to that set of docs.. /facepalm.  My question is around how I&#39;m passing context around. Why do I have to pass both context and the computeService into my stop function? It appears to me that the compute service is instantiated with my context already."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561533559, "post_id": 56766872, "comment_id": 100090452, "body": "I don&#39;t know. Maybe because it can be desirable to use a context with a (shorter) Timeout for the Do call, but that is just a guess."}, {"owner": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "edited": false, "score": 2, "creation_date": 1561534413, "post_id": 56766872, "comment_id": 100090850, "body": "The first is the context for the client (service). The second is the context for the request. You could have two different contexts there if you wanted."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "edited": false, "score": 0, "creation_date": 1561536272, "post_id": 56766872, "comment_id": 100091822, "body": "@sethvargo - TY. I asked the OP to move his comment and create a question. I felt this would be good for the Go GCP developers."}], "answers": [{"tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": false, "score": 2, "last_activity_date": 1561535603, "last_edit_date": 1561535603, "creation_date": 1561534451, "answer_id": 56767551, "question_id": 56766872, "link": "https://stackoverflow.com/questions/56766872/what-is-the-proper-style-and-usage-of-golang-context/56767551#56767551", "title": "What is the proper style and usage of golang Context?", "body": "<p><code>svc.Instances.Stop(project, zone, v.Name)</code> returns <code>InstanceStopCall</code></p>\n\n<p>By calling <code>Context(ctx)</code> you are setting the context to be used in this call's Do method. This allows the HTTP request to be aborted if the context is canceled.</p>\n\n<p>The Stop method can take a long time (as in minutes). This allows a user to cancel waiting for a VM to shutdown.</p>\n"}], "owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1561535603, "creation_date": 1561532062, "last_edit_date": 1561533160, "question_id": 56766872, "link": "https://stackoverflow.com/questions/56766872/what-is-the-proper-style-and-usage-of-golang-context", "title": "What is the proper style and usage of golang Context?", "body": "<p>I am new to golang and trying to get a better understanding of context.</p>\n\n<p>In the below snippet, it appears to me that I've instantiated my <code>computeService</code> with a context. why do I have to pass it again to the <code>.Context()</code> function when calling <code>Stop()</code>?</p>\n\n<pre><code>package main\n\nfunc stopTaggedMachines(ctx context.Context, svc *compute.Service, project, zone, tag string) ([]string, error) {\n    var instances []string\n    f := func(page *compute.InstanceList) error {\n        for _, v := range page.Items {\n            if v.Labels[\"gcp-idler-managed\"] == \"true\" {\n                result, err := svc.Instances.Stop(project, zone, v.Name).Context(ctx).Do()\n                if err != nil {\n                    log.Fatal(err)\n                }\n                fmt.Printf(\"[INFO] gcp-machine-idler: Instance in state %v, Stopping %v... Response: %v \\n\", v.Status, v.Name, result.HTTPStatusCode)\n            }\n        }\n        return nil\n    }\n\n    call := svc.Instances.List(\"my-project\", \"us-west1-b\")\n    if err := call.Pages(oauth2.NoContext, f); err != nil {\n        return instances, nil\n    }\n    return instances, nil\n}\n\nfunc main() {\n    // Use oauth2.NoContext if there isn't a good context to pass in.\n    ctx := context.Background()\n\n    computeService, err := compute.NewService(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n    stopTaggedMachines(ctx, computeService, \"my-project\", \"us-west1-b\", \"gcp-idler-managed\")\n    return\n}\n</code></pre>\n\n<p>It seems redundant to me that I pass ctx into <code>compute.NewService()</code>, then again into <code>stopTaggedMachines()</code> </p>\n\n<p>Is this really the correct convention or usage of context? Why does my call to <code>svc.Instances.Stop(project, zone, v.Name).Context(ctx).Do()</code> need to be passed <code>ctx</code> yet again as a parameter?</p>\n"}, {"tags": ["sql", "go", "backup"], "comments": [{"owner": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "edited": false, "score": 0, "creation_date": 1561534543, "post_id": 56766628, "comment_id": 100090923, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25594521/how-can-i-copy-a-single-row-record-from-one-mysql-instance-to-another\">How can I copy a single row/record from one MySQL instance to another?</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1561542929, "post_id": 56766628, "comment_id": 100095564, "body": "Why reinvent the wheel? <a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql-command-options.html#option_mysql_execute\" rel=\"nofollow noreferrer\"><code>mysql -e &quot;$YourQuery&quot; -u foo $YourOtherOpts &gt; dump.sql</code></a>"}, {"owner": {"reputation": 11, "user_id": 11683968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f020ebfbd972f12d4f2d809a1475ee?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet Jindal", "link": "https://stackoverflow.com/users/11683968/puneet-jindal"}, "reply_to_user": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "edited": false, "score": 0, "creation_date": 1561552056, "post_id": 56766628, "comment_id": 100101052, "body": "@sethvargo can you tell me that what command should I have to use to fetch the   rows using where condition from multiple tables?"}, {"owner": {"reputation": 11, "user_id": 11683968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f020ebfbd972f12d4f2d809a1475ee?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet Jindal", "link": "https://stackoverflow.com/users/11683968/puneet-jindal"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1561552094, "post_id": 56766628, "comment_id": 100101080, "body": "@MarkusWMahlberg please read the comment I have posted above"}], "owner": {"reputation": 11, "user_id": 11683968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f020ebfbd972f12d4f2d809a1475ee?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet Jindal", "link": "https://stackoverflow.com/users/11683968/puneet-jindal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561531138, "creation_date": 1561531138, "question_id": 56766628, "link": "https://stackoverflow.com/questions/56766628/how-to-backup-the-one-row-from-the-sql-database", "title": "How to backup the one row from the sql database?", "body": "<p>I want to make a backup sql data function in golang. I have written a sample code which will backup the sql database and a command for table too. But I don't know that how to dump the one row data from sql into given path?</p>\n\n<p>For database: </p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"mysqldump\", \"-P3306\", \"-hhost\", \"-uuser\", \"-ppassword\", \"database_name\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    bytes, err := ioutil.ReadAll(stdout)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = ioutil.WriteFile(\"./out.sql\", bytes, 0644)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n\n<p>For table we can change the command like below: </p>\n\n<pre><code>cmd := exec.Command(\"mysqldump\", \"-P3306\", \"-hhost\", \"-uuser\", \"-ppassword\", \"database_name\" \"table_name\")\n</code></pre>\n\n<p>For dump the row of a table what should I have to write please any suggestions with short code.</p>\n\n<p>for example: dump that row where id is equals to 1</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1561664587, "post_id": 56793457, "comment_id": 100149819, "body": "Thanks - the challenge is that <code>*AdmissionRequest.Object.Object</code> is of type <code>runtime.Object</code>, but attempting to create a <code>meta.Accessor</code> that then calls <code>.Annotations(obj)</code> fails with <code>object does not implement the Object interfaces</code>. So although it appears we have the right type, attempting to inspect it <i>as</i> a <code>runtime.Object</code> fails."}, {"owner": {"reputation": 1242, "user_id": 3873424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9NddA.jpg?s=128&g=1", "display_name": "Ottovsky", "link": "https://stackoverflow.com/users/3873424/ottovsky"}, "edited": false, "score": 1, "creation_date": 1561993099, "post_id": 56793457, "comment_id": 100228301, "body": "Can you show that part of the code? In my experience <code>meta.Accessor()</code> from <code>k8s.io&#47;apimachinery&#47;pkg&#47;api&#47;meta</code> should achieve exactly what you want."}], "tags": [], "owner": {"reputation": 2304, "user_id": 10347794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f789eeaaa46141793c051f2446397400?s=128&d=identicon&r=PG&f=1", "display_name": "Nepomucen", "link": "https://stackoverflow.com/users/10347794/nepomucen"}, "is_accepted": false, "score": 0, "last_activity_date": 1561646300, "creation_date": 1561646300, "answer_id": 56793457, "question_id": 56765480, "link": "https://stackoverflow.com/questions/56765480/deserializing-objectmeta-regardless-of-kind/56793457#56793457", "title": "Deserializing ObjectMeta Regardless of Kind", "body": "<p>It seems there are two possibilities:</p>\n\n<ol>\n<li>Either the field <code>Object</code> should already contain the correct object instance, when using Go client, check code <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apiserver/pkg/admission/plugin/webhook/request/admissionreview.go#L81\" rel=\"nofollow noreferrer\">here</a>.</li>\n<li>Try using the converters <a href=\"https://github.com/kubernetes/apimachinery/blob/master/pkg/runtime/converter.go\" rel=\"nofollow noreferrer\">here</a></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "is_accepted": false, "score": 2, "last_activity_date": 1562328486, "last_edit_date": 1562328486, "creation_date": 1562328027, "answer_id": 56902671, "question_id": 56765480, "link": "https://stackoverflow.com/questions/56765480/deserializing-objectmeta-regardless-of-kind/56902671#56902671", "title": "Deserializing ObjectMeta Regardless of Kind", "body": "<p>I believe you can't find what you are looking for because, when decoding an object, Kubernetes uses <a href=\"https://github.com/kubernetes/apimachinery/blob/master/pkg/runtime/interfaces.go#L255\" rel=\"nofollow noreferrer\">GetObjectKind</a> and compares the result to a <a href=\"https://github.com/kubernetes/apimachinery/blob/master/pkg/runtime/scheme.go#L32\" rel=\"nofollow noreferrer\">Scheme</a> to convert the object to a concrete type, rather than using some <a href=\"https://en.wikipedia.org/wiki/Generic_programming\" rel=\"nofollow noreferrer\">generic</a> like approach and interacting with the fields of an object without knowing it's concrete type.</p>\n\n<p>So you can use reflection instead, something like:</p>\n\n<pre><code>k8sObjValue := reflect.ValueOf(admissionReview.Request.Object.Raw).Elem()\nk8sObjObjectMeta := k8sObjValue.FieldByName(\"ObjectMeta\")\nannotations, ok := k8sObjObjectMeta.FieldByName(\"Annotations\").(map[string]string)\nif !ok {\n    panic(\"failed to retrieve annotations\")\n}\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Or closer to your requirements, convert to an ObjectMeta object</p>\n\n<pre><code>k8sObjValue := reflect.ValueOf(admissionReview.Request.Object.Raw).Elem()\nobjMeta, ok := k8sObjValue.FieldByName(\"ObjectMeta\").(core.ObjectMeta)\nif !ok {\n    panic(\"failed to retrieve object metadata\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 8247088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a893080aabaab09001ad586b024acdb?s=128&d=identicon&r=PG&f=1", "display_name": "ArseniyKD", "link": "https://stackoverflow.com/users/8247088/arseniykd"}, "is_accepted": false, "score": 2, "last_activity_date": 1595364893, "creation_date": 1595364893, "answer_id": 63022947, "question_id": 56765480, "link": "https://stackoverflow.com/questions/56765480/deserializing-objectmeta-regardless-of-kind/63022947#63022947", "title": "Deserializing ObjectMeta Regardless of Kind", "body": "<p>There is a way to do this that I discovered recently, let me describe it here:</p>\n<p>Quick disclaimer: I used admission/v1 and never tested with admission/v1beta1, which should work identically.</p>\n<p>The data type of <code>admissionReview.Request.Object</code> is <code>runtime.RawExtension</code>, and the <code>k8s.io/apimachinery/pkg/runtime</code> provides a method that can convert the <code>runtime.RawExtension</code> to a <code>runtime.Object</code>. The method is called <code>runtime.Convert_runtime_RawExtension_To_runtime_Object(...)</code>. From there, you can easily convert to the <code>unstructured.Unstructured</code> data type, which has all the fields from the <code>MetaV1</code> object accessible with simple getter methods.</p>\n<p>Here is a code snippet that lets you get this accomplished:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    // ...\n    &quot;k8s.io/apimachinery/pkg/apis/meta/v1/unstructured&quot;\n    &quot;k8s.io/apimachinery/pkg/runtime&quot;\n    // ...\n)\n\n// ...\n\nfunc dummyFunc(ar *v1.AdmissionReview) {\n    // ...\n    var obj runtime.Object\n    var scope conversion.Scope // While not actually used within the function, need to pass in\n    err := runtime.Convert_runtime_RawExtension_To_runtime_Object(&amp;ar.Request.Object, &amp;obj, scope)\n    if err != nil {\n        // ...\n    }\n\n    innerObj, err := runtime.DefaultUnstructuredConverter.ToUnstructured(obj)\n    if err != nil {\n        // ...\n    }\n    u := unstructured.Unstructured{Object: innerObj}\n    // Now the `u` variable has all the meta info available with simple getters.\n    // Sample:\n    labels := u.GetLabels()\n    kind := u.GetKind()\n    // etc.\n    // ...\n}\n</code></pre>\n<p>References:</p>\n<ol>\n<li><a href=\"https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured</a></li>\n<li><a href=\"https://godoc.org/k8s.io/apimachinery/pkg/runtime#Convert_runtime_RawExtension_To_runtime_Object\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/apimachinery/pkg/runtime#Convert_runtime_RawExtension_To_runtime_Object</a></li>\n<li><a href=\"https://godoc.org/k8s.io/api/admission/v1#AdmissionRequest\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/api/admission/v1#AdmissionRequest</a></li>\n</ol>\n"}], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1231, "favorite_count": 3, "answer_count": 3, "score": 12, "last_activity_date": 1595364893, "creation_date": 1561525267, "last_edit_date": 1561627895, "question_id": 56765480, "link": "https://stackoverflow.com/questions/56765480/deserializing-objectmeta-regardless-of-kind", "title": "Deserializing ObjectMeta Regardless of Kind", "body": "<p><strong>TL;DR:</strong> How can I flexibly decode a k8s API object and inspect its top-level <code>metav1.ObjectMeta</code> struct without knowing the object's <code>Kind</code> in advance?</p>\n\n<hr>\n\n<p>I'm writing an admission controller endpoint that unmarshals a <code>metav1.AdmissionReview</code> object's <code>Request.Object.Raw</code> field into a concrete object based on the <code>Request.Kind</code> field - e.g.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if kind == \"Pod\" {\n    var pod core.Pod\n    // ...\n    if _, _, err := deserializer.Decode(admissionReview.Request.Object.Raw, nil, &amp;pod); err != nil {\n        return nil, err\n    }\n\n    annotations := pod.ObjectMeta.Annotations\n    // inspect/validate the annotations...\n</code></pre>\n\n<p>This requires knowing all possible types up front, or perhaps asking a user to supply a <code>map[kind]corev1.Object</code> that we can use to be more flexible.</p>\n\n<p>What I'd like to instead achieve is something closer to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var objMeta core.ObjectMeta\nif _, _, err := deserializer.Decode(admissionReview.Request.Object.Raw, nil, &amp;objMeta); err != nil {\n        return nil, err\n}\n\n// if objMeta is populated, validate the fields, else\n// assume it is an object that does not define an ObjectMeta\n// as part of its schema.\n</code></pre>\n\n<p>Is this possible? The k8s API surface is fairly extensive, and I've crawled through the <a href=\"https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1#Object\" rel=\"noreferrer\">metav1 godoc</a>, corev1 godoc &amp; <a href=\"https://cs.k8s.io\" rel=\"noreferrer\">https://cs.k8s.io</a> for prior art without a decent example.</p>\n\n<p>The closest I've found is possibly the <a href=\"https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1#ObjectMetaAccessor\" rel=\"noreferrer\"><code>ObjectMetaAccessor</code></a> interface, but I'd need to get from an <code>AdmissionReview.Request.Object</code> (type <code>runtime.RawExtension</code>) to a <code>runtime.Object</code> first.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7477, "user_id": 190280, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/134b8de0aceaba40d4b30757a3bffd48?s=128&d=identicon&r=PG", "display_name": "Josh Bleecher Snyder", "link": "https://stackoverflow.com/users/190280/josh-bleecher-snyder"}, "is_accepted": false, "score": 2, "last_activity_date": 1561501837, "creation_date": 1561501837, "answer_id": 56762834, "question_id": 56762602, "link": "https://stackoverflow.com/questions/56762602/golang-find-first-element-smaller-or-equal-to-given-element-using-sort-search/56762834#56762834", "title": "golang find first element smaller or equal to given element using sort.Search", "body": "<p>In your \u201cless\u201d function, implement \u201cmore\u201d instead. You may need to adjust the resulting index by 1.</p>\n"}], "owner": {"reputation": 592, "user_id": 3103316, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c1a7bb82ea66d5fa4246bca7b91bfef7?s=128&d=identicon&r=PG&f=1", "display_name": "Prasad Shinde", "link": "https://stackoverflow.com/users/3103316/prasad-shinde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1561501837, "creation_date": 1561500118, "question_id": 56762602, "link": "https://stackoverflow.com/questions/56762602/golang-find-first-element-smaller-or-equal-to-given-element-using-sort-search", "title": "golang find first element smaller or equal to given element using sort.Search", "body": "<p>golang find first element smaller or equal to given element using <code>sort.Search()</code> if the array is sorted in ascending order.</p>\n\n<p>Note: I do not want to sort the array in descending order to use the <code>sort.Search</code></p>\n"}, {"tags": ["ssl", "go", "artifactory"], "answers": [{"tags": [], "owner": {"reputation": 13950, "user_id": 1626687, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8d4317dca5804dd7e9b30515b9bf3020?s=128&d=identicon&r=PG", "display_name": "spuder", "link": "https://stackoverflow.com/users/1626687/spuder"}, "is_accepted": false, "score": 1, "last_activity_date": 1561488680, "creation_date": 1561488680, "answer_id": 56760354, "question_id": 56760353, "link": "https://stackoverflow.com/questions/56760353/artifactory-jfrog-cli-unable-to-authenticate/56760354#56760354", "title": "Artifactory jfrog cli unable to authenticate", "body": "<p>The errors were caused by a misconfigured apache vhost. Since the certificate chain is bundled in the cert, there was no need for the SSLCertificateChainFile. Web browsers handled this misconfiguration no problem, but golang was more particular about the chain. </p>\n\n<p>Bad configuration</p>\n\n<pre><code>  SSLCertificateFile      \"/etc/ssl/certs/artifactory.example.com.crt.pem\"\n  SSLCertificateKeyFile   \"/etc/ssl/private/artifactory.example.com.key.pem\"\n  SSLCertificateChainFile \"/etc/ssl/certs/STAR.bad.example.com.pem\"\n</code></pre>\n\n<p>Working configuration</p>\n\n<pre><code>  SSLCertificateFile      \"/etc/ssl/certs/artifactory.example.com.crt.pem\"\n  SSLCertificateKeyFile   \"/etc/ssl/private/artifactory.example.com.key.pem\"\n</code></pre>\n"}], "owner": {"reputation": 13950, "user_id": 1626687, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8d4317dca5804dd7e9b30515b9bf3020?s=128&d=identicon&r=PG", "display_name": "spuder", "link": "https://stackoverflow.com/users/1626687/spuder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561488680, "creation_date": 1561488680, "question_id": 56760353, "link": "https://stackoverflow.com/questions/56760353/artifactory-jfrog-cli-unable-to-authenticate", "title": "Artifactory jfrog cli unable to authenticate", "body": "<p>Attempting to use the jfrog cli to integrate with an artifactory server, when I get this error</p>\n\n<pre><code>jfrog rt config example-company --url=$ARTIFACTORY_URL --user=$ARTIFACTORY_USER --password=$ARTIFACTORY_PASS\n[Info] Encrypting password...\n[Error] Get https://artifactory.example.com/api/security/encryptedPassword: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>Navigating to <a href=\"https://artifactory.example.com/api/security/encryptedPassword\" rel=\"nofollow noreferrer\">https://artifactory.example.com/api/security/encryptedPassword</a> in a browser shows that the TLS certificate is valid, however I get a different error: </p>\n\n<pre><code>{\n  \"errors\": [\n    {\n      \"status\": 404,\n      \"message\": \"User not found: bill.gates\"\n    }\n  ]\n}\n</code></pre>\n\n<p>ping commands also return TLS errors</p>\n\n<pre><code>jfrog rt ping --url=https://artifactory.example.com\n[Error] Get https://artifactory.example.com/artifactory/api/system/ping: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>jfrog cli is written in golang. Running version:</p>\n\n<pre><code>go version\ngo version go1.12.5 darwin/amd64\n</code></pre>\n\n<p>Looking at the jfrog github issues, others have reported similar issues</p>\n\n<p><a href=\"https://github.com/jfrog/jfrog-cli/issues/277\" rel=\"nofollow noreferrer\">https://github.com/jfrog/jfrog-cli/issues/277</a></p>\n\n<p>How can I get the jfrog cli to connect to the artifactory server? </p>\n"}, {"tags": ["git", "go", "bitbucket", "go-get"], "comments": [{"owner": {"reputation": 393, "user_id": 5223002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tmBSX.jpg?s=128&g=1", "display_name": "Eduardo Hitek", "link": "https://stackoverflow.com/users/5223002/eduardo-hitek"}, "edited": false, "score": 0, "creation_date": 1561488088, "post_id": 56760145, "comment_id": 100077897, "body": "Hi Clay, what is the error message you&#39;re getting?"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1561488142, "post_id": 56760145, "comment_id": 100077930, "body": "Wild ass guess - git protocol is ok, http protocol is not (go get is going to use http protocol iirc)"}, {"owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "edited": false, "score": 0, "creation_date": 1561488211, "post_id": 56760145, "comment_id": 100077959, "body": "With the first most obvious <code>go get bitbucket.org&#47;&lt;team-name&gt;&#47;&lt;repo-name&gt; </code> I get <code>go: missing Mercurial command. See https:&#47;&#47;golang.org&#47;s&#47;gogetcmd</code>. This is a git repository, we are not using Mercurial at all, I&#39;m not sure why the tool suspects that this is a Mercurial repository."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 2, "creation_date": 1561515002, "post_id": 56760145, "comment_id": 100085097, "body": "Old versions of Go believe (correctly for the time) that bitbucket.org hosts only Mercurial repositories. Newer versions of Go believe that bitbucket.org hosts both Git and Mercurial repositories, but I&#39;m not sure how you tell it which one. <code>go help importpath</code> suggests sticking the VCS into the path: <code>example.org&#47;user&#47;foo.hg</code> vs <code>example.org&#47;repo.git&#47;foo&#47;bar</code> for instance. Go also tries http/https and looks for <code>&lt;meta name=&quot;go-import&quot; content=&quot;import-prefix vcs repo-root&quot;&gt;</code> tags. If Bitbucket Cloud should provide a Git vcs tag here, that would presumably direct <code>go get</code> to use Git."}], "owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1026, "favorite_count": 0, "closed_date": 1561497731, "answer_count": 0, "score": 0, "last_activity_date": 1561498072, "creation_date": 1561487707, "question_id": 56760145, "link": "https://stackoverflow.com/questions/56760145/bitbucket-cloud-go-get-support", "closed_reason": "Duplicate", "title": "Bitbucket Cloud `go get` support?", "body": "<p>I want to use <code>go get</code> with a project hosted on private Bitbucket cloud. I have ssh configured so that the following works without manually entering credentials:</p>\n\n<pre><code>git clone git@bitbucket.org:&lt;team-name&gt;/&lt;repo-name&gt;.git\n</code></pre>\n\n<p>The following attempts don't work:</p>\n\n<pre><code>go get bitbucket.org/&lt;team-name&gt;/&lt;repo-name&gt;\ngo get bitbucket.org/&lt;team-name&gt;/&lt;repo-name&gt;.git\ngo get bitbucket.org:&lt;team-name&gt;/&lt;repo-name&gt;\ngo get bitbucket.org:&lt;team-name&gt;/&lt;repo-name&gt;.git\n</code></pre>\n\n<p>Here (<a href=\"https://community.atlassian.com/t5/Answers-Developer-Questions/go-get-and-bitbucket/qaq-p/565640\" rel=\"nofollow noreferrer\">https://community.atlassian.com/t5/Answers-Developer-Questions/go-get-and-bitbucket/qaq-p/565640</a>), back in 2016, an Atlassian team member explains <code>go get</code> support for Bitbucket Server, but not Bitbucket Cloud.</p>\n"}, {"tags": ["go", "kubernetes", "google-kubernetes-engine"], "comments": [{"owner": {"reputation": 1236, "user_id": 1289628, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/4ce1c64def03a08f11757ead0ae2b43a?s=128&d=identicon&r=PG", "display_name": "Subhash Chandran", "link": "https://stackoverflow.com/users/1289628/subhash-chandran"}, "edited": false, "score": 1, "creation_date": 1561525506, "post_id": 56759728, "comment_id": 100087228, "body": "There seems to be a related question: <a href=\"https://stackoverflow.com/questions/56191900/is-there-a-golang-sdk-equivalent-of-gcloud-container-clusters-get-credentials\" title=\"is there a golang sdk equivalent of gcloud container clusters get credentials\">stackoverflow.com/questions/56191900/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 356, "user_id": 1008290, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hBYEQ.jpg?s=128&g=1", "display_name": "Deepak Garg", "link": "https://stackoverflow.com/users/1008290/deepak-garg"}, "edited": false, "score": 0, "creation_date": 1563233821, "post_id": 56768428, "comment_id": 100623766, "body": "I&#39;m using <code>kubectl config use-context CONTEXT_NAME [options]</code>. It works better for my issue. Thanks"}], "tags": [], "owner": {"reputation": 4962, "user_id": 11560878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ESrYf.png?s=128&g=1", "display_name": "Wytrzyma\u0142y Wiktor", "link": "https://stackoverflow.com/users/11560878/wytrzyma%c5%82y-wiktor"}, "is_accepted": true, "score": 1, "last_activity_date": 1561537631, "creation_date": 1561537631, "answer_id": 56768428, "question_id": 56759728, "link": "https://stackoverflow.com/questions/56759728/deploying-services-in-gke-k8s-cluster-using-golang-k8s-client/56768428#56768428", "title": "Deploying services in GKE k8s cluster using Golang k8s client", "body": "<p>As per @Subhash suggestion I am posting the answer from <a href=\"https://stackoverflow.com/questions/56191900/is-there-a-golang-sdk-equivalent-of-gcloud-container-clusters-get-credentials/56192493#56192493\">this</a> question:</p>\n\n<blockquote>\n  <p>The GKE API does not have a call that outputs a kubeconfig file (or\n  fragment). The specific processing between fetching a full cluster\n  definition and updating the kubeconfig file are implemented in python\n  in the gcloud tooling. It isn't part of the Go SDK so you'd need to\n  implement it yourself. </p>\n  \n  <p>You can also try using <code>kubectl config set-credentials</code> (see\n  <a href=\"https://github.com/ahmetb/kubernetes.github.io/blob/master/docs/user-guide/kubectl/kubectl_config_set-credentials.md\" rel=\"nofollow noreferrer\">this</a>)  and/or see if you can vendor the libraries that implement\n  that function if you want to do it programmatically.</p>\n</blockquote>\n"}], "owner": {"reputation": 356, "user_id": 1008290, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hBYEQ.jpg?s=128&g=1", "display_name": "Deepak Garg", "link": "https://stackoverflow.com/users/1008290/deepak-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 56768428, "answer_count": 1, "score": 1, "last_activity_date": 1561540256, "creation_date": 1561485876, "last_edit_date": 1561540256, "question_id": 56759728, "link": "https://stackoverflow.com/questions/56759728/deploying-services-in-gke-k8s-cluster-using-golang-k8s-client", "title": "Deploying services in GKE k8s cluster using Golang k8s client", "body": "<p>I'm able to create a GKE cluster using the golang container lib <a href=\"https://godoc.org/google.golang.org/api/container/v1\" rel=\"nofollow noreferrer\">here</a>. \nNow for my golang k8s client to be able to deploy my k8s deployment files there, I need to get the kubeconfig from the GKE cluster. However I can't find the relevant api for that in the <strong>container</strong> lib above. Can anyone please point out what am I missing ?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "is_accepted": false, "score": 2, "last_activity_date": 1561490210, "creation_date": 1561490210, "answer_id": 56760687, "question_id": 56759074, "link": "https://stackoverflow.com/questions/56759074/how-do-i-create-a-text-index-in-mongodb-with-golang-and-the-mongo-go-driver/56760687#56760687", "title": "How do I create a text index in mongodb with golang and the mongo-go-driver?", "body": "<p>To create indexes using the official mongo go driver you can use the following code:</p>\n\n<pre><code>// create Index\nindexName, err := c.Indexes().CreateOne(\n        context.Background(),\n        mongo.IndexModel{\n                Keys: bson.M{\n                        \"time\": 1,\n                },\n                Options: options.Index().SetUnique(true),\n        },\n)\nif err != nil {\n        log.Fatal(err)\n}\nfmt.Println(indexName)\n</code></pre>\n\n<p>You can replace it with your desired index configuration.</p>\n"}, {"tags": [], "owner": {"reputation": 1034, "user_id": 3176972, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mlKGV.png?s=128&g=1", "display_name": "SaroVin", "link": "https://stackoverflow.com/users/3176972/sarovin"}, "is_accepted": false, "score": 1, "last_activity_date": 1561561324, "creation_date": 1561561324, "answer_id": 56775826, "question_id": 56759074, "link": "https://stackoverflow.com/questions/56759074/how-do-i-create-a-text-index-in-mongodb-with-golang-and-the-mongo-go-driver/56775826#56775826", "title": "How do I create a text index in mongodb with golang and the mongo-go-driver?", "body": "<p>I have founded the solution:</p>\n\n<pre><code>    coll := db.Collection(\"test\")\n    index := []mongo.IndexModel{\n        {\n            Keys: bsonx.Doc{{Key: \"name\", Value: bsonx.String(\"text\")}},\n        },\n        {\n            Keys: bsonx.Doc{{Key: \"createdAt\", Value: bsonx.Int32(-1)}},\n        },\n    }\n\n    opts := options.CreateIndexes().SetMaxTime(10 * time.Second)\n    _, errIndex = coll.Indexes().CreateMany(context, index, opts)\n    if err != nil {\n        panic(errIndex)\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3010, "user_id": 3415984, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sTrps.jpg?s=128&g=1", "display_name": "ttrasn", "link": "https://stackoverflow.com/users/3415984/ttrasn"}, "is_accepted": false, "score": 0, "last_activity_date": 1602489731, "creation_date": 1602489731, "answer_id": 64313860, "question_id": 56759074, "link": "https://stackoverflow.com/questions/56759074/how-do-i-create-a-text-index-in-mongodb-with-golang-and-the-mongo-go-driver/64313860#64313860", "title": "How do I create a text index in mongodb with golang and the mongo-go-driver?", "body": "<p>From <a href=\"https://docs.mongodb.com/manual/indexes/\" rel=\"nofollow noreferrer\"><code>MongoDB indexes documentation</code></a> I wrote a function to create an index for all types MongoDB supported.</p>\n<pre><code>func AddIndex(dbName string, collection string, indexKeys interface{}) error {\n    db := getNewDbClient() // get clients of mongodb connection\n    serviceCollection := db.Database(dbName).Collection(collection)\n    indexName, err := serviceCollection.Indexes().CreateOne(mtest.Background, mongo.IndexModel{\n        Keys: indexKeys,\n    })\n    if err != nil {\n        return err\n    }\n    fmt.Println(indexName)\n    return nil\n}\n</code></pre>\n<p><strong>mongodb single field index</strong>:</p>\n<pre><code>AddIndex(&quot;mydb&quot;, &quot;mycollection&quot;, bson.M{&quot;myfieldname&quot;: 1}) // to descending set it to -1\n</code></pre>\n<p><strong>mongodb Compound index</strong>:</p>\n<pre><code>AddIndex(&quot;mydb&quot;, &quot;mycollection&quot;, bson.D{{&quot;myFirstField&quot;, 1},{&quot;mySecondField&quot;, -1}}) // to descending set it to -1\n</code></pre>\n<p><strong>mongodb Text index</strong></p>\n<pre><code>AddIndex(&quot;mydb&quot;, &quot;mycollection&quot;, bson.D{{&quot;myFirstTextField&quot;, &quot;text&quot;},{&quot;mySecondTextField&quot;, &quot;text&quot;}})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 3144447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Op9l5.jpg?s=128&g=1", "display_name": "wi7sonjoseph", "link": "https://stackoverflow.com/users/3144447/wi7sonjoseph"}, "is_accepted": false, "score": 0, "last_activity_date": 1618385052, "creation_date": 1618385052, "answer_id": 67087212, "question_id": 56759074, "link": "https://stackoverflow.com/questions/56759074/how-do-i-create-a-text-index-in-mongodb-with-golang-and-the-mongo-go-driver/67087212#67087212", "title": "How do I create a text index in mongodb with golang and the mongo-go-driver?", "body": "<p>With Geospatial (2dsphere), text and single field.</p>\n<pre><code>models := []mongo.IndexModel{\n    {\n        Keys: bsonx.Doc{{Key: &quot;username&quot;, Value: bsonx.String(&quot;text&quot;)}},\n    },\n    {\n        Keys: bsonx.Doc{{Key: &quot;NearCoordinates&quot;, Value: bsonx.String(&quot;2dsphere&quot;)}},\n    },\n    {\n        Keys: bsonx.Doc{{Key: &quot;password&quot;, Value: bsonx.Int32(1)}},\n    },\n}\nopts := options.CreateIndexes().SetMaxTime(20 * time.Second)\n_, err := collectionName.Indexes().CreateMany(context.Background(), models, opts)\n</code></pre>\n"}], "owner": {"reputation": 1034, "user_id": 3176972, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mlKGV.png?s=128&g=1", "display_name": "SaroVin", "link": "https://stackoverflow.com/users/3176972/sarovin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3371, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1618385052, "creation_date": 1561483047, "question_id": 56759074, "link": "https://stackoverflow.com/questions/56759074/how-do-i-create-a-text-index-in-mongodb-with-golang-and-the-mongo-go-driver", "title": "How do I create a text index in mongodb with golang and the mongo-go-driver?", "body": "<p>I'm trying to do a full text search on a collection, but in order to do that I need to create a text index.\nHow can I create a text index on two fields?</p>\n\n<p>I know that I must use a thing as this:</p>\n\n<pre><code>opts := options.CreateIndexes().SetMaxTime(10 * time.Second)\n\nidxFiles := []mongo.IndexModel{\n    {\n      Keys: bsonx.Doc{{\"name\": \"text\"}},\n    },\n  }\n\ndb.Collection(\"mycollection\").Indexes().CreateMany(context, idx, opts)\n</code></pre>\n"}, {"tags": ["go", "microservices", "consul", "service-discovery"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1561488049, "post_id": 56758698, "comment_id": 100077877, "body": "In consul&#39;s kv store :)"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1561488126, "post_id": 56758698, "comment_id": 100077915, "body": "Normally you pass such configuration data either via a env var or a config file."}], "answers": [{"tags": [], "owner": {"reputation": 180, "user_id": 127838, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LNz5H.jpg?s=128&g=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/127838/mario"}, "is_accepted": true, "score": 1, "last_activity_date": 1561509190, "creation_date": 1561509190, "answer_id": 56763658, "question_id": 56758698, "link": "https://stackoverflow.com/questions/56758698/where-should-i-store-the-endpoint-of-the-service-registry-server/56763658#56763658", "title": "Where should i store the endpoint of the service registry server?", "body": "<h3>All of the 3 following options are supported in the following precedence order:</h3>\n\n<ol>\n<li>Command line arguments </li>\n<li>Environment Variables </li>\n<li>Configuration files</li>\n</ol>\n\n<h3>For the Linux Configuration File Option</h3>\n\n<p>Create </p>\n\n<blockquote>\n  <p><strong>/etc/consul.d/config.json</strong></p>\n</blockquote>\n\n<p>The key is <strong>start_join</strong> with value of the IP of Consul server e.g., </p>\n\n<pre><code>\"start_join\": [ \"10.128.0.2\" ]\n</code></pre>\n\n<p>For a cluster solution of more than one Consul instances: </p>\n\n<pre><code>\"start_join\": [ \"10.128.0.2\", \"10.128.0.3\" ]\n</code></pre>\n\n<p>The default <em>server</em> port is <strong>8300</strong> but you may override with the <strong>ports</strong> object offering multiple ports to override e.g.,</p>\n\n<pre><code>\"ports\": {\n   \"server\": 8300\n}\n</code></pre>\n\n<p>For a full reference of the available options, you may check the <a href=\"https://www.consul.io/docs/agent/options.html\" rel=\"nofollow noreferrer\">Consul Documentation</a>, <a href=\"https://www.consul.io/docs/agent/options.html#ports\" rel=\"nofollow noreferrer\">and all the available ports options</a></p>\n"}], "owner": {"reputation": 125, "user_id": 7973864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01b086a0c6af41aecf13d612617fc21c?s=128&d=identicon&r=PG&f=1", "display_name": "Souji Tendo", "link": "https://stackoverflow.com/users/7973864/souji-tendo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 56763658, "answer_count": 1, "score": 0, "last_activity_date": 1561509190, "creation_date": 1561481465, "last_edit_date": 1561484090, "question_id": 56758698, "link": "https://stackoverflow.com/questions/56758698/where-should-i-store-the-endpoint-of-the-service-registry-server", "title": "Where should i store the endpoint of the service registry server?", "body": "<p>I'm learning about microservices recently. I tried using consul for service discovery. \nI wonder if I deploy the consul server, so where should i store endpoint of that server? Is it good to hard code in env variable of each services?</p>\n"}, {"tags": ["unit-testing", "go", "mocking", "hyperledger-fabric", "hyperledger-chaincode"], "comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1602588929, "post_id": 56757815, "comment_id": 113762534, "body": "Please provide minimal, reproducible example code."}], "owner": {"reputation": 4735, "user_id": 5270744, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/kPNwH.jpg?s=128&g=1", "display_name": "m_callens", "link": "https://stackoverflow.com/users/5270744/m-callens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1602588910, "creation_date": 1561477808, "last_edit_date": 1602588910, "question_id": 56757815, "link": "https://stackoverflow.com/questions/56757815/unit-test-chaincode-with-invokechaincode", "title": "Unit Test Chaincode with InvokeChaincode", "body": "<p>I have a function in one of my chaincode contracts that calls the Golang SDK's <code>stub.InvokeChaincode</code> function in order to call another chaincode and get it's response before continuing with the currently invoked function.</p>\n\n<p>When I try to unit test this function using the mock stubs from the <code>github.com/hyperledger/fabric/core/chaincode/shim</code> package I get memory errors because of this call to invoke an external secondary chaincode function.</p>\n\n<p>Is there a way to unit test functions that have this built in?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1561483708, "post_id": 56757353, "comment_id": 100075940, "body": "You&#39;re looking at the un-exported <code>activeConn</code> field of the <code>*http.Server</code>. Reading that field using reflection to bypass any synchronization of course is not going to be properly synchronized."}], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 1865966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q52NB.jpg?s=128&g=1", "display_name": "tacobot", "link": "https://stackoverflow.com/users/1865966/tacobot"}, "edited": false, "score": 0, "creation_date": 1561485257, "post_id": 56758932, "comment_id": 100076612, "body": "I, personally, disagree with your message, that it&#39;s a user&#39;s responsibility to do extra things just to print some value, especially when it already satisfied <code>String</code> interface. So, it really looks like a bug. I&#39;ve tested simple handler, which does <code>fmt.Fprintf(w, &quot;%s&quot;, r.Context())</code> with <code>ab -c100 -n1000 ...</code> and it fails. I&#39;m pretty sure, than it is undefined and &quot;undesired&quot; behavior."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 779, "user_id": 1865966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q52NB.jpg?s=128&g=1", "display_name": "tacobot", "link": "https://stackoverflow.com/users/1865966/tacobot"}, "edited": false, "score": 3, "creation_date": 1561488267, "post_id": 56758932, "comment_id": 100077987, "body": "@tacobot: The only thing here that seems somewhat &quot;bug like&quot; is that a user can read unexported fields with reflection, but that is a design decision at that can&#39;t be changed at this point. If you&#39;re going to read the unexported internals of a structure, bypassing any synchronization methods, it&#39;s sort of on you to determine if that&#39;s OK."}, {"owner": {"reputation": 779, "user_id": 1865966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q52NB.jpg?s=128&g=1", "display_name": "tacobot", "link": "https://stackoverflow.com/users/1865966/tacobot"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1561488545, "post_id": 56758932, "comment_id": 100078099, "body": "@Jimb agree! But, it&#39;s a bad design decision in it&#39;s guts. Just my opinion."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 779, "user_id": 1865966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q52NB.jpg?s=128&g=1", "display_name": "tacobot", "link": "https://stackoverflow.com/users/1865966/tacobot"}, "edited": false, "score": 0, "creation_date": 1561511841, "post_id": 56758932, "comment_id": 100084527, "body": "@tacobot, my answer points to the cause of the issue and how to solve it (and also explains that it is not a concurrency issue in Go&#39;s http implementation itself but rather caused by printing the context), if that&#39;s a bug or not is outside the scope of this question. It can be reported to Go&#39;s project if need be."}, {"owner": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "edited": false, "score": 0, "creation_date": 1561512781, "post_id": 56758932, "comment_id": 100084668, "body": "Hi\uff0c is there any Static Detection Tool which could help me to find map problem before deploying?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "edited": false, "score": 1, "creation_date": 1561553895, "post_id": 56758932, "comment_id": 100102259, "body": "@\u5f20todd, I don&#39;t think a static tool would detect this, but you can run your tests with &quot;race detector&quot; enabled: <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">golang.org/doc/articles/race_detector.html</a> , so one way would be for you to create a test that calls your handler concurrently and run it with race detection enabled"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 1, "last_activity_date": 1561484322, "last_edit_date": 1561484322, "creation_date": 1561482461, "answer_id": 56758932, "question_id": 56757353, "link": "https://stackoverflow.com/questions/56757353/go-http-request-conn-activeconn-is-a-map-so-will-it-have-concurrent-map-problem/56758932#56758932", "title": "go http.Request.Conn.ActiveConn is a map, so will it have concurrent map problem?", "body": "<p>The whole purpose of Go's http server implementation is to handle concurrent connections, so I doubt you'll see concurrency issues in the implementation itself.</p>\n\n<p>What's happening here is that when printing the whole <code>r.Context()</code> there, you end up accessing an internal field of Go's <code>Server</code> object without synchronizing access to it.</p>\n\n<p>That causes the <code>concurrent map read and map write</code> error you end up seeing.</p>\n\n<p>Simplest solution would be to replace this:</p>\n\n<pre><code>fmt.Fprintf(w, \"r.ctx: %#v, %+v\", r.Context(), r.Context())\n</code></pre>\n\n<p>With some custom function you write that takes that <code>Context</code> object and extracts the values that are relevant for you (like for example, any custom key/value you have added yourself to the Context).</p>\n\n<p><strong>More detailed explanation about that activeConn field</strong></p>\n\n<p>The <code>activeConn</code> you see when you print the whole <code>r.Context()</code> as doing there, comes from Go's <code>Server</code> type.</p>\n\n<p>When preparing to listen for connections, the <code>Server</code> creates a base context in which it adds a reference to the <code>Server</code> itself:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2894\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/server.go#L2894</a></p>\n\n<pre><code>func (srv *Server) Serve(l net.Listener) error {\n    ....\n    ctx := context.WithValue(baseCtx, ServerContextKey, srv)\n    ....\n}\n</code></pre>\n\n<p>So when printing the whole context, you end up printing that <code>activeConn</code> field:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2582\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/server.go#L2582</a></p>\n\n<pre><code>activeConn map[*conn]struct{}\n</code></pre>\n\n<p>The <code>Server</code> implementation synchronizes access to that map when it needs to use it, for example here:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2997\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/server.go#L2997</a></p>\n\n<pre><code>...\n\ns.mu.Lock()\ndefer s.mu.Unlock()\nif s.activeConn == nil {\n    s.activeConn = make(map[*conn]struct{})\n}\n\nif add {\n    s.activeConn[c] = struct{}{}\n} else {\n    delete(s.activeConn, c)\n}\n....\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561484322, "creation_date": 1561476157, "last_edit_date": 1561479248, "question_id": 56757353, "link": "https://stackoverflow.com/questions/56757353/go-http-request-conn-activeconn-is-a-map-so-will-it-have-concurrent-map-problem", "title": "go http.Request.Conn.ActiveConn is a map, so will it have concurrent map problem?", "body": "<p>go http.Request.Context.ActiveConn is a map, will it have concurrent map problem?</p>\n\n<p>If there are many connections, I print the <code>request.Context</code> which is including a <code>ActiveConn(map)</code>, will it have concurrent reading and writing map problem? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"r.ctx: %#v, %+v\", r.Context(), r.Context())\n    })\n    http.ListenAndServe(\":1234\", nil)\n}\n</code></pre>\n\n<p>I use a webench to give a pressure test, it will fail because of concurrent map problem. So, is there any one who has the same problem? Because of this, I messed up the core service... ...</p>\n"}, {"tags": ["arrays", "json", "dictionary", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 8604, "user_id": 1004781, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dn2vE.png?s=128&g=1", "display_name": "rix", "link": "https://stackoverflow.com/users/1004781/rix"}, "edited": false, "score": 0, "creation_date": 1561492669, "post_id": 56756661, "comment_id": 100079768, "body": "thanks, i think i was just expecting to be able to marshal straight to a map without the intermediate array step"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1561473908, "creation_date": 1561473908, "answer_id": 56756661, "question_id": 56756534, "link": "https://stackoverflow.com/questions/56756534/marshal-json-file-into-map/56756661#56756661", "title": "Marshal json file into map", "body": "<blockquote>\n  <p>My problem is that I can't figure out how to key the map by the id</p>\n</blockquote>\n\n<p>You can't index the map because you don't have any maps.</p>\n\n<p>Your input JSON is a JSON array, so you can unmarshal that into a Go slice. After that you have to build a Go map yourself. And then you can index that map by <code>Id</code>:</p>\n\n<pre><code>m := map[string]*Item{}\nfor i := range data {\n    m[data[i].Id] = &amp;data[i]\n}\n\nfmt.Println(m)\nfmt.Println(m[\"086687173\"])\nfmt.Println(m[\"078382574\"])\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/qSsV_7v2gwN\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[{086687173 5} {078382574 3}] &lt;nil&gt;\nmap[078382574:0x43015c 086687173:0x430150]\n&amp;{086687173 5}\n&amp;{078382574 3}\n</code></pre>\n\n<p>Note that if you initially would've used a pointer slice <code>[]*Item</code>, creating the map would be simpler:</p>\n\n<pre><code>m := map[string]*Item{}\nfor _, item := range data {\n    m[item.Id] = item\n}\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/BZVEBGs1vuP\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 8604, "user_id": 1004781, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dn2vE.png?s=128&g=1", "display_name": "rix", "link": "https://stackoverflow.com/users/1004781/rix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 56756661, "answer_count": 1, "score": 0, "last_activity_date": 1561494911, "creation_date": 1561473457, "last_edit_date": 1561494911, "question_id": 56756534, "link": "https://stackoverflow.com/questions/56756534/marshal-json-file-into-map", "title": "Marshal json file into map", "body": "<p>I have a largish (10mb) JSON file which I am attempting to unmarshal into a map so I can read it from memory when required.  My problem is that I can't figure out how to key the map by the id of each row in the json or even if this is the idiomatic approach to the problem. </p>\n\n<p>It contains a lot of nested data but for simplicity it's basically this:</p>\n\n<pre><code>[{\"id\": \"086687173\", \"count\": 5}, {\"id\": \"078382574\", \"count\": 3}]\n\ntype Item struct {\n    Id string `json:\"id\"`\n    Count int `json:\"count\"`\n}\n\ndata := []Item  // am able to marshal into an array\ndata := make(map[string]Item) // cannot unmarshal array into Go value of type map[string]Item\n\n\nbytes, _ := ioutil.ReadFile(\"./templates/data.json\")\nerr := json.Unmarshal(bytes, &amp;data)\n\nfmt.Println(data)\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "syslog"], "answers": [{"tags": [], "owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "is_accepted": false, "score": 1, "last_activity_date": 1561557905, "last_edit_date": 1561557905, "creation_date": 1561531275, "answer_id": 56766650, "question_id": 56756509, "link": "https://stackoverflow.com/questions/56756509/is-it-possible-for-stackdriver-to-recognise-syslog-input-from-k8s/56766650#56766650", "title": "Is it possible for stackdriver to recognise syslog input from k8s?", "body": "<p>Syslog is a different protocol.</p>\n\n<p>Try the <a href=\"https://cloud.google.com/logging/docs/setup/go\" rel=\"nofollow noreferrer\">golang driver</a>.</p>\n\n<p>This is tagged with k8s... if you need your kubernetes logs then just use the exporter. If you're just trying to get pod logs, you can send to STDOUT and the <a href=\"https://github.com/helm/charts/tree/master/stable/stackdriver-exporter\" rel=\"nofollow noreferrer\">below</a> will forward for you.</p>\n"}], "owner": {"reputation": 9, "user_id": 5589924, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/000d4701d73a9a34029b569fb33c0d34?s=128&d=identicon&r=PG", "display_name": "blane", "link": "https://stackoverflow.com/users/5589924/blane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561557905, "creation_date": 1561473352, "last_edit_date": 1561553997, "question_id": 56756509, "link": "https://stackoverflow.com/questions/56756509/is-it-possible-for-stackdriver-to-recognise-syslog-input-from-k8s", "title": "Is it possible for stackdriver to recognise syslog input from k8s?", "body": "<p>Unable to get stack driver to recognize syslog levels. Everything appears as an error despite specifying <code>DEBUG</code> </p>\n\n<pre><code>logwriter, e := syslog.New(syslog.LOG_DEBUG, \"myprog\")\nif e == nil {\n    log.SetOutput(logwriter)\n}\n\nlog.Print(\"log me\")\n</code></pre>\n\n<p>I am aware of format <a href=\"https://cloud.google.com/error-reporting/docs/formatting-error-messages\" rel=\"nofollow noreferrer\">requirements</a> </p>\n\n<p>if I stdout correct format as json payload stackdriver will magically pick it up and it works for me.</p>\n\n<p>But why can't stackdriver recognize syslog input even if I syslog the json payload?</p>\n"}, {"tags": ["c++", "go", "dll", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606403120, "post_id": 56758803, "comment_id": 114958244, "body": "Pretty late, I know. However, 4. probably is little helpful, rather misleading. Sure, 16-bit char systems <i>do</i> exist, but they are pretty rare and the DLL most likely has not been written for such a system. Instead, the function would rather expect 8-bit bytes, thus we&#39;d instead need a function like (the not existing) <code>syscall.UTF8PtrFromString</code>."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606403309, "post_id": 56758803, "comment_id": 114958330, "body": "Something like <code>b := []byte(myString); b = append(b, 0); ptr := unsafe.Pointer(&amp;b[0])</code> to have <code>syscall.Syscall(..., uintptr(ptr), ...)</code> \u2013 if the DLL cannot cope with utf-8 (not a matter, if only ASCII contained anyway) we yet might have to convert encoding to local system&#39;s one."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606405556, "post_id": 56758803, "comment_id": 114959313, "body": "@Aconcagua, it actually exists in the form of <code>C.CString</code>, but only when using <code>cgo</code> ;-) Yes, you&#39;re correct in that I should have probably put more variants offered by guesseneering into my response, but unfortunately there&#39;s too little known about the DLL. After all, <code>const char*</code> might in that API really <i>mean</i> a type-puned pointer to <code>uint16_t</code>-s or something like this. \ud83e\udd37"}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606406676, "post_id": 56758803, "comment_id": 114959817, "body": "<code>char</code> in C or C++ is a language type just like <code>int</code> in go and maps to the target&#39;s smallest addressable unit, which typically is a 8-bit byte, but <i>can</i> be larger (then no <code>uint8_t</code> would exist either). Compilers usually allow to specify signedness of, never heard of they allow to change size \u2013 and would not be recommendable either, would break any expectations of developers on that system... <i>&#39;It</i> might <i>mean [...]&#39;</i> \u2013 yes, if we are on a system with 16-bit smallest addressable unit. Honestly, someone coding on such exotic systems I&#39;d really expect to get <i>this</i> matter right alone ;)"}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606406763, "post_id": 56758803, "comment_id": 114959856, "body": "No critisism, though. Just a small detail that could be written better. Apart from, appreciated the answer, contained some nice details interesting to know (still go beginner...)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606412502, "post_id": 56758803, "comment_id": 114962226, "body": "@Aconcagua, ah, no, bad wording on my part! I meant that in C, <code>char *</code> might mean a pointer to <i>anything.</i> Some programmers &quot;feel&quot; like using <code>void*</code> is somehow too vague and using <code>char*</code> to point to a &quot;contiguous lump of data&quot; is somehow better. So really without further knowledge about what the DLLs author really meant (does the function &quot;under the hood&quot; treats the pointer as an address of a series of 16-bit values), guessing is only so much good, unfortunately. BTW, I appreciate your mentioning of non-UTF-8 legacy system encodings\u2014this is definitely a possibility."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606470885, "post_id": 56758803, "comment_id": 114976492, "body": "OK, such usage is known to me \u2013 although I disagree (consider e. g. <code>memset</code>, <code>memcpy</code>, ... \u2013 but that&#39;s another topic). I wouldn&#39;t expect this here, though: There are no lengths given anywhere, so I&#39;d assume 0-terminated sequences, and <code>int argc, char* argv[]</code> ressembles pretty much C&#39;s <code>main</code> function (one legal variant of, at least), which expects ordinary c-strings, too."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1606471280, "post_id": 56758803, "comment_id": 114976656, "body": "Representing an expected sequence of 16-bit values with <code>char*</code> would be pretty strange, too, as there are better options (preferrably <code>uint16_t*</code>, but with <code>CHAR_BIT == 8</code> e. g. <code>unsigned shor*</code>, possibly <code>wchar_t*</code> or <code>char16_t*</code>, should just be as fine, even though not <i>guaranteeing</i> 16 bit...). \u2013 <code>cgo</code>&#39;s <code>CString</code> is nice, by the way, and would be absolutely appropriate here, as we are coding against a C library anyway (well, says C++, but I&#39;d asume <code>extern &quot;C&quot;</code> functions here to avoid name mangling...)."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1612254609, "last_edit_date": 1612254609, "creation_date": 1561481884, "answer_id": 56758803, "question_id": 56755969, "link": "https://stackoverflow.com/questions/56755969/getting-an-exception-when-calling-syscall-function/56758803#56758803", "title": "Getting an exception when calling Syscall function", "body": "<h2>The setting</h2>\n<p>So, basically, the mapping you've got is</p>\n<ol>\n<li><p><code>int* buffer</code> \u2192 <code>buffer uintptr</code></p>\n</li>\n<li><p><code>int argc</code> \u2192 <code>unsafe.Pointer(&amp;argsCount)</code>, where <code>&amp;argsCount</code> is a pointer to <code>int</code></p>\n</li>\n<li><p><code>char* argv[]</code> \u2192 <code>unsafe.Pointer(&amp;args)</code>, where <code>args</code> is <code>[]string</code></p>\n</li>\n<li><p><code>const char* fileName</code> \u2192 <code>unsafe.Pointer(syscall.StringToUTF16Ptr(fileName))</code></p>\n<p><code>const char* key</code>, <code>const char* prefix</code>, <code>const char* version</code> \u2014 same as above.</p>\n</li>\n</ol>\n<h2>The problems</h2>\n<p>Now what's wrong with this.</p>\n<ol>\n<li><p>Passing <code>uintptr</code> values containing addresses of live Go objects between functions is prohibited. (More on this later.)</p>\n</li>\n<li><p>You pass the address of the <code>argsCount</code> function argument to <code>argc</code>. An address on a typical commodity platform/OS like amd64/Windows is an insanely huge value\u2014if interpreted as a count.</p>\n<p>My bet is that the function crashes when it makes an attempt to read that many elements from <code>argv</code>\u2014causing it to read memory your process had not mapped.</p>\n</li>\n<li><p>Two problems here:</p>\n<ol>\n<li><p>Passing an address of a slice value as an argument expecting the address of the first element of that slice is wrong.</p>\n<p>This is because a slice value (presently, in the &quot;reference&quot; Go implementation you're supposedly using) is a <code>struct</code> with 3 fields: an address of the underlying data array, the number of elements in that array allowed to be used and the total count of such elements in that array which may be used without reallocation by the <code>append</code> function when called on the slice value.</p>\n<p>When you have <code>args []string</code> and do <code>&amp;args</code> you get the address of that structure, not the address of the first element of that slice.</p>\n<p>To do the latter, use <code>&amp;args[0]</code>.</p>\n</li>\n<li><p>In Go, a string (typically, and let's assume that's the case) contains characters encoded as UTF-8. This is typically not what a Windows-native C++ code expects to deal with when it says it wants a <code>char *</code>.</p>\n<p>My guess, you need to first construct a proper thing for the <code>argv</code>,\nsomething like</p>\n<pre class=\"lang-golang prettyprint-override\"><code>argv := make([]unsafe.Pointer, 0, len(args))\nfor i, s := range args {\n    argv[i] = unsafe.Pointer(syscall.StringToUTF16Ptr(s))\n}\n</code></pre>\n<p>and then pass <code>&amp;argv[0]</code> to the callee.</p>\n<p>But see below for <code>syscall.StringToUTF16Ptr()</code>.</p>\n</li>\n</ol>\n</li>\n<li><p>The preparation you're doing to pass string data to the rest of the arguments which have the <code>const char*</code> type appears to be correct but only if the callee really means its <code>char</code> is a 16-bit integer.</p>\n<p>In other words, the source code <em>and the toolchain</em> used to compile that library must have made sure that <code>char</code> was really <a href=\"https://docs.microsoft.com/en-us/windows/desktop/learnwin32/working-with-strings\" rel=\"nofollow noreferrer\"><code>wchar_t</code> or <code>WCHAR</code></a>.</p>\n<p>If yes, what you do should be OK; otherwise it's not. You should verify this.</p>\n</li>\n</ol>\n<h3>A note on passing <code>uintptr</code>s across expressions</h3>\n<p>Go features garbage collection, and because of this its runtime must know all pointers to all currently live objects. As long as there exists a variable containing a pointer to a memory block allocated during the program run time, that block won't be garbage-collected.</p>\n<p>An <code>unsafe.Pointer</code> value counts as a proper reference to a memory block <em>but an <code>uintptr</code> value <strong>is not.</strong></em> This means when the code</p>\n<pre class=\"lang-golang prettyprint-override\"><code>p := new(someType)\nu := uintptr(unsafe.Pointer(&amp;p))\nfoo(u)\nreturn\n</code></pre>\n<p>is running, the GC is free to reclaim the object allocated by <code>p</code> as soon as <code>p</code> was assigned its address\u2014simply because <code>p</code> is the sole reference to that object, and <code>u</code> is not.</p>\n<p>Now consider that the GC in the reference Go implementation runs concurrently with the code of your program.\nThis means when <code>foo</code> runs, so may do the GC, and it may sweep your instance of <code>someType</code> right from under the feet of <code>foo</code>.</p>\n<p>As an exception to this general rule, the Go compiler guarantees that all the <code>uintptr(unsafe.Pointer)</code> type conversions occuring in the same <em>language expression</em> are immune to the GC. So taking our previous example, it's OK to do</p>\n<pre class=\"lang-golang prettyprint-override\"><code>foo(uintptr(unsafe.Pointer(new(someType)))\nreturn\n</code></pre>\n<p>and</p>\n<pre class=\"lang-golang prettyprint-override\"><code>p := new(someType)\nv := unsafe.Pointer(&amp;p)\nfoo(uintptr(v))\nreturn\n</code></pre>\n<p>since the type-conversion to <code>uintptr</code> happens in a single expression\u2014which is a function call.</p>\n<p>As a consequence, you must not pass pointers to Go objects around as <code>uintptr</code>s <em>unless</em> they contain pointers obtained from the &quot;C side&quot;.</p>\n"}], "owner": {"reputation": 338, "user_id": 5334658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d1b77d34c33ea4758f5dcb5356d37a5?s=128&d=identicon&r=PG&f=1", "display_name": "Arunwij", "link": "https://stackoverflow.com/users/5334658/arunwij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 0, "accepted_answer_id": 56758803, "answer_count": 1, "score": 2, "last_activity_date": 1612254609, "creation_date": 1561471666, "last_edit_date": 1561482341, "question_id": 56755969, "link": "https://stackoverflow.com/questions/56755969/getting-an-exception-when-calling-syscall-function", "title": "Getting an exception when calling Syscall function", "body": "<p>I am using Go's syscall package to call a DLL that is written in C++. </p>\n\n<p>C++ method signature looks like this. </p>\n\n<p><code>init(int* buffer, int argc, char* argv[], const char* fileName, const char* key, const char* prefix, const char* version)</code></p>\n\n<p>this is the function I am using to call above method in Go.</p>\n\n<pre><code>func init(\n  buffer uintptr, \n  argsCount int, \n  args []string, \n  fileName string, \n  key string, \n  prefix string, \n  version string\n) uintptr {\n    // libHandle is handle to the loaded DLL\n    methodAddress := getProcAddress(libHandle, \"init\")\n\n    status, _, err := syscall.Syscall9(\n      methodAddress,\n      7,\n      buffer,\n      uintptr(unsafe.Pointer(&amp;argsCount)),\n      uintptr(unsafe.Pointer(&amp;args)),\n      uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(fileName))),\n      uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(key))),\n      uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(prefix))),\n      uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(version))),\n      0,\n      0)\n\n      fmt.Println(err.Error())\n\n      return status\n }\n</code></pre>\n\n<p>I get this Error When I invoking this method and don't have an Idea about this. </p>\n\n<pre><code>Exception 0xc0000005 0x0 0x0 0x7fffe30bdb33\nPC=0x7fffe30bdb33\n\nsyscall.Syscall9(0x7fffe32db600, 0x7, 0x97db50, 0xc00007ff10, \n0xc00007ff70, 0xc000054180, 0xc0000541a0, 0xc0000541c0, 0xc0000541e0, \n0x0, ...)\n\nc:/go/src/runtime/syscall_windows.go:210 +0xf3\nmain.main()\n\n E:/Path/test.go:157 +0x2be\n rax     0x81fbf0\n rbx     0x1\n rcx     0x7ff804ad1310\n rdi     0x7ff10\n rsi     0xc00007ff70\n rbp     0x0\n rsp     0x81fbc0\n r8      0x0\n r9      0x7ff804ad0000\n r10     0xc00007ff00\n r11     0x81fbf0\n r12     0x7ff10\n r13     0xc00007ff70\n r14     0xc000054180\n r15     0x97db50\n rip     0x7fffe30bdb33\n rflags  0x10257\n cs      0x33\n fs      0x53\n gs      0x2b\n</code></pre>\n"}, {"tags": ["go", "command-line-interface"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1561471582, "post_id": 56755423, "comment_id": 100069523, "body": "What is the error you get? It works for me and it outputs <code>[test cmd -f flag]</code>!"}, {"owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1561471744, "post_id": 56755423, "comment_id": 100069639, "body": "I made a typo in the command name (<code>test2</code> instead of <code>test</code>). The error I get is &quot;Incorrect Usage: flag provided but not defined: -f&quot;"}, {"owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1561471898, "post_id": 56755423, "comment_id": 100069737, "body": "@Abdullah I fixed the typo in my question. You had to enter <code>go run main.go test2 cmd -f flag</code> to get the error with the old version."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1561473713, "post_id": 56755423, "comment_id": 100070840, "body": "You forgot the <code>app.Name</code>. Use <code>go run main.go main test cmd -f flag</code>. This will output: <code>[main test cmd -f flag]</code>"}, {"owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1561474225, "post_id": 56755423, "comment_id": 100071143, "body": "No I didn&#39;t. Maybe I&#39;m not clear enough. I get the error when the command of my program is <code>test</code> as defined in <code>app.Commands</code>. Any other command, including <code>main</code>, will call <code>app.Action</code> where there is no problem."}], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "is_accepted": true, "score": 1, "last_activity_date": 1561531123, "creation_date": 1561531123, "answer_id": 56766621, "question_id": 56755423, "link": "https://stackoverflow.com/questions/56755423/how-to-pass-flags-as-argument-of-urface-cli-command/56766621#56766621", "title": "How to pass flags as argument of urface/cli command?", "body": "<p>After looking at the documentation of <a href=\"https://godoc.org/github.com/urfave/cli#Command\" rel=\"nofollow noreferrer\">cli.Command</a>, there is actually a very simple way to have what I want: setting <code>SkipFlagParsing</code> to true will treat all flags as normal arguments.</p>\n\n<pre><code>app.Commands = []cli.Command{\n    {\n        Name:    \"test\",\n        SkipFlagParsing: true\n        Action:  func(c *cli.Context) error {\n            fmt.Println(\"test\", c.Args())\n            return nil\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 0, "accepted_answer_id": 56766621, "answer_count": 1, "score": 0, "last_activity_date": 1561531123, "creation_date": 1561469966, "last_edit_date": 1561471665, "question_id": 56755423, "link": "https://stackoverflow.com/questions/56755423/how-to-pass-flags-as-argument-of-urface-cli-command", "title": "How to pass flags as argument of urface/cli command?", "body": "<p>I am using <a href=\"https://github.com/urfave/cli\" rel=\"nofollow noreferrer\">urfave/cli</a> to build a CLI application in Go. </p>\n\n<p>What I would like is options given after the first command to be treated as arguments and not flags (so that I can handle them myself or pass them to an other executable).</p>\n\n<p>When using <code>app.Action</code> (see below), this is the behavior that I get, but if I am using <code>cli.Commands</code> then I get an error.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/urfave/cli\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    app := cli.NewApp()\n\n    app.Commands = []cli.Command{\n        {\n            Name:    \"test\",\n            Action:  func(c *cli.Context) error {\n                fmt.Println(\"test\", c.Args())\n                return nil\n            },\n        },\n    }\n\n    app.Action = func(c *cli.Context) error {\n        fmt.Println(c.Args())\n        return nil\n    }\n\n    err := app.Run(os.Args)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Output of: <code>go run main.go cmd -f flag</code>:</p>\n\n<pre><code>[cmd -f flag]\n</code></pre>\n\n<p>but <code>go run main.go test cmd -f flag</code> exits with an error where I would like it to oupput</p>\n\n<pre><code>test [cmd -f flag]\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1561466701, "creation_date": 1561466701, "answer_id": 56754397, "question_id": 56754350, "link": "https://stackoverflow.com/questions/56754350/why-this-function-can-not-exit/56754397#56754397", "title": "Why this function can not exit?", "body": "<p>Your select statement has two options:</p>\n\n<pre><code>        case &lt;-tick:\n</code></pre>\n\n<p>which triggers every 1 second, and</p>\n\n<pre><code>        case &lt;-time.After(2 * time.Second):\n</code></pre>\n\n<p>which triggers 2 seconds after starting the select loop.</p>\n\n<p>Since your first case always happens after 1 second, the second case will never occur. And it is only the second case which triggers exiting the main function.</p>\n\n<p>What you probably intended was instead this:</p>\n\n<pre><code>tick := time.Tick(1 * time.Second)\ntimer := time.After(2 * time.Second)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>case &lt;-timer:\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7779987, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyK7z.jpg?s=128&g=1", "display_name": "yuu", "link": "https://stackoverflow.com/users/7779987/yuu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "closed_date": 1561466781, "accepted_answer_id": 56754397, "answer_count": 1, "score": 0, "last_activity_date": 1561466701, "creation_date": 1561466541, "question_id": 56754350, "link": "https://stackoverflow.com/questions/56754350/why-this-function-can-not-exit", "closed_reason": "Duplicate", "title": "Why this function can not exit?", "body": "<p>I try to run the main function but it can not end. I don't know why.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    tick := time.Tick(1 * time.Second)\n    done := make(chan bool)\n    go func() {\n        for {\n            select {\n            case &lt;-tick:\n                println(\"-------hah---------\")\n            case &lt;-time.After(2 * time.Second):\n                println(\"after 1 second.\")\n                done &lt;- true\n            }\n        }\n    }()\n    &lt;-done\n}\n</code></pre>\n\n<p>I expect the function can exit successfully, but the function can not end</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "is_accepted": true, "score": 1, "last_activity_date": 1561462849, "creation_date": 1561462849, "answer_id": 56753273, "question_id": 56751280, "link": "https://stackoverflow.com/questions/56751280/why-mongo-go-driver-aggregation-result-object-keys-returned-as-key/56753273#56753273", "title": "Why mongo-go-driver aggregation result object keys returned as &quot;Key&quot;", "body": "<p>The new version of MongoDB driver treated the empty interface as an array of keys and values instead of a mapping between strings and empty interfaces. I have corrected the issue use the following code:</p>\n\n<pre><code>// register custom codec registry to handle empty interfaces\nrb := bson.NewRegistryBuilder()\nrb.RegisterTypeMapEntry(bsontype.EmbeddedDocument, reflect.TypeOf(bson.M{}))\n\nclient, err := mongo.NewClient(options.Client().ApplyURI(url).SetRegistry(rb.Build()))\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9423091, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "syahid nurrohim", "link": "https://stackoverflow.com/users/9423091/syahid-nurrohim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 56753273, "answer_count": 1, "score": 1, "last_activity_date": 1561535435, "creation_date": 1561456403, "question_id": 56751280, "link": "https://stackoverflow.com/questions/56751280/why-mongo-go-driver-aggregation-result-object-keys-returned-as-key", "title": "Why mongo-go-driver aggregation result object keys returned as &quot;Key&quot;", "body": "<p>I want to group some data with mongo-go-driver using aggregate, but the json result confused me, because the row key replaced with \"Key\" and and the real key become the \"Key\"s value</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var result primitive.A\npipeline := mongo.Pipeline{{{\"$group\", bson.D{{\"_id\", \"$nis\"}}}}}\ncursor, err := db.NilaiUH.Aggregate(context.TODO(), pipeline)\ncursor.All(context.Background(), &amp;result)\njson.NewEncoder(w).Encode(&amp;result)\n</code></pre>\n\n<p>Here is the result</p>\n\n<pre><code>[\n  [\n    {\n      \"Key\": \"_id\",\n      \"Value\": 15100\n    }\n  ],\n  [\n    {\n      \"Key\": \"_id\",\n      \"Value\": 15101\n    }\n  ]\n]\n</code></pre>\n"}, {"tags": ["go", "newline", "writer"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561455746, "post_id": 56751006, "comment_id": 100059924, "body": "I don&#39;t understand. Where, and why, do you want a newline?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561456407, "post_id": 56751006, "comment_id": 100060295, "body": "What on earth is this?!?!? <code>if nBuf, ok := interface{}(&amp;buf).(io.Writer); ok {</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561456595, "post_id": 56751006, "comment_id": 100060389, "body": "@Volker: My guess: The an ill-conceived response to <code>tmpStruct does not implement io.Writer (Write method has pointer receiver)</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561456644, "post_id": 56751006, "comment_id": 100060418, "body": "Also, why are you using <code>tmpStruct</code> at all? Why not just use <code>os.Stdout</code>?"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561457586, "post_id": 56751006, "comment_id": 100060926, "body": "@Flimzy as you can see in the image [client logger] is appending to the same line. Hence wish for a new line. I am using tmpStruct because the above is a PoC as I want to push the progress bar to a different writer eventually, not just os.Stdout. Volker - yes, its as a result of SO suggesting that so that I can type assert that buf is of Writer type, what is the correct approach? I got it from here <a href=\"https://stackoverflow.com/a/23172457/1414721\">stackoverflow.com/a/23172457/1414721</a> Why the downvotes, <code>if nBuf, ok := interface{}(&amp;buf).(io.Writer); ok</code> maybe incorrect but the question follows standard question asking convention"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561457789, "post_id": 56751006, "comment_id": 100061043, "body": "So you want a new line after the status bar? Why don&#39;t you print a newline, then, after the status bar?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561457845, "post_id": 56751006, "comment_id": 100061088, "body": "<code>nBuf := &amp;tmpStruct{}</code> and drop the if statement. Then nBuf is of type *tmpStruct which implements io.Writer."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561457855, "post_id": 56751006, "comment_id": 100061095, "body": "As for the type asserting: There&#39;s no need to type assert at all. Interfaces are automatic. Just declare your variable properly:  <code>buf := &amp;tmpStruct{}</code>"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561457856, "post_id": 56751006, "comment_id": 100061097, "body": "Well I could, but I would have to do that outside of the progress bar, and not as part of the progress bar writer... that would be very repetitive"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1561457885, "post_id": 56751006, "comment_id": 100061119, "body": "Repetitive is what coders are best at. Write a function to handle it for you. I don&#39;t see any problem."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561458005, "post_id": 56751006, "comment_id": 100061193, "body": "Thanks @Peter, I&#39;m not sure why the aggression Flimzy - <code>buf := &amp;tmpStruct{}</code> is all you needed to say. Re the function, that is literally my question &quot;is there a neat way to do this&quot;. I consider a seperate helper function the &quot;not neat&quot; way to do this. Surely the writer can no when its finished being written to and add a new line"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561458007, "post_id": 56751006, "comment_id": 100061194, "body": "I downvoted because the question is very unclear. I don&#39;t see a clear problem statement.  I see a teeny tiny graphic which I guess demonstrates an unspecified incorrect behavior (after comments I think I understand the intention)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561458079, "post_id": 56751006, "comment_id": 100061236, "body": "It&#39;s not really a minimal reproduction case, either. In fact, it&#39;s more code than necessary (given the unnecessary <code>tmpStruct</code> type, and the unnecessary type assertion), and simultaneously not enough code, since there&#39;s not a complete, executable example there to demonstrate the failure mode."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1561459807, "post_id": 56751006, "comment_id": 100062214, "body": "Eeeuh, does <code>BarEnd: &quot;&lt;\\n&quot;</code> work?"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1561460158, "post_id": 56751006, "comment_id": 100062441, "body": "lol, I like your thinking @RickyA  no it prints <code>BarEnd</code> every time it updates the progress bar, so that causes it to print over lots and lots of lines"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1561460330, "post_id": 56751006, "comment_id": 100062556, "body": "Ah, then I would just wrap this lib and the buffer in a custom struct and expose two functions ; <code>add</code> and <code>close</code>"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561460461, "post_id": 56751006, "comment_id": 100062630, "body": "Yes that&#39;s the approach I&#39;m now taking. Thanks. I prefer the explicit <code>close()</code> as it leaves room for other cleaning up if necessary."}], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561458639, "post_id": 56751914, "comment_id": 100061537, "body": "Yes, this is a solution, and does work. I was hoping that this could be handled inside the Write function of the custom io.Writer so that the writer could be passed around and the coder wouldn&#39;t have to either know, or realise they needed to do this when they want to use a progress bar. Ultimately I want to pass the progress bar around and call it/use it whenever I need one, and not have to worry about the new line each time."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561458730, "post_id": 56751914, "comment_id": 100061586, "body": "If you switch to an <code>io.WriteCloser</code>, <i>and</i> you know that the progress bar will close the writer when it&#39;s done, you could then make your <code>Close()</code> function write one last &quot;\\n&quot;.  But that sounds a lot more intrusive than just printing a &quot;\\n&quot;. There are no magic solutions."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561458778, "post_id": 56751914, "comment_id": 100061614, "body": "Doesn&#39;t each use of the progress bar needs its own instantiation anyway? Since it&#39;s tracking different state? I don&#39;t see how you&#39;d be able to pass a single one around anyway."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561458976, "post_id": 56751914, "comment_id": 100061720, "body": "That could be interesting for my use case. Thank you, I shall look into that. Incidentally, thanks for a more thorough discussion. I felt your approach was &quot;help at a cost&quot;. If you like, take it as feedback. I see that I could have been more descriptive with my question. Noted. Ultimately I plan to wrap a pointer to the progressBar (and I can reassign it) and the io.writer in the tmpStruct, which I planned to pass around. So yes, a specific PB can&#39;t be reused but a pointer could and the writer can stay the same."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1561459232, "post_id": 56751914, "comment_id": 100061878, "body": "I think what confused me re the <code>&amp;tmpStruct{}</code> was that the function takes an io.Writer, not a <code>*io.Writer</code>, so didn&#39;t think that I should pass the address of a <code>tmpStruct{}</code> rather than a <code>tmpStruct{}</code>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1561458384, "creation_date": 1561458384, "answer_id": 56751914, "question_id": 56751006, "link": "https://stackoverflow.com/questions/56751006/golang-io-writer-new-line-after-finished-writing-string/56751914#56751914", "title": "golang io.writer new line after finished writing string", "body": "<p>The simple answer to the question you've asked is simply to print an additional newline after the progress bar is complete:</p>\n\n<pre><code>func demoLoadingBarCount(maximumInt int) {\n    buf := &amp;tmpStruct{}\n    bar := progressbar.NewOptions(\n        maximumInt,\n        progressbar.OptionSetTheme(progressbar.Theme{Saucer: \"\u2588\", SaucerPadding: \"-\", BarStart: \"&gt;\", BarEnd: \"&lt;\"}),\n        progressbar.OptionSetWidth(100),\n        progressbar.OptionSetWriter(buf),\n    )\n    for i := 0; i &lt; maximumInt; i++ {\n        bar.Add(1)\n        time.Sleep(10 * time.Millisecond)\n    }\n    fmt.Fprintf(buf, \"\\n\") // &lt;---- Add this\n}\n</code></pre>\n\n<p>Although your comments indicate that this is problematic, but you haven't explained how. If you update your question to explain why this is a problem, perhaps a better solution can follow.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1927, "favorite_count": 0, "accepted_answer_id": 56751914, "answer_count": 1, "score": -4, "last_activity_date": 1561458384, "creation_date": 1561455448, "last_edit_date": 1561457730, "question_id": 56751006, "link": "https://stackoverflow.com/questions/56751006/golang-io-writer-new-line-after-finished-writing-string", "title": "golang io.writer new line after finished writing string", "body": "<p>I have the following code that uses <a href=\"http://github.com/schollz/progressbar\" rel=\"nofollow noreferrer\">a package</a> to draw a progress bar</p>\n\n<pre><code>type tmpStruct struct {\n}\n\nfunc (t *tmpStruct) Write(p []byte) (n int, err error) {\n    fmt.Fprintf(os.Stdout, \"%s\", string(p))\n    return len(p), nil\n}\n\nfunc demoLoadingBarCount(maximumInt int) {\n    buf := tmpStruct{}\n    if nBuf, ok := interface{}(&amp;buf).(io.Writer); ok {\n        bar := progressbar.NewOptions(\n            maximumInt,\n            progressbar.OptionSetTheme(progressbar.Theme{Saucer: \"\u2588\", SaucerPadding: \"-\", BarStart: \"&gt;\", BarEnd: \"&lt;\"}),\n            progressbar.OptionSetWidth(100),\n            progressbar.OptionSetWriter(nBuf),\n        )\n        for i := 0; i &lt; maximumInt; i++ {\n            bar.Add(1)\n            time.Sleep(10 * time.Millisecond)\n        }\n    }\n}\n</code></pre>\n\n<p>All works, except there is no new line at the end as you can see here\n<a href=\"https://i.stack.imgur.com/3pG9i.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3pG9i.png\" alt=\"enter image description here\"></a></p>\n\n<p>I can't add a new line character in the Write function as  that will cause it to new line after every byte pushed to the writer. Is there a neat way can I do this?</p>\n\n<p>EDIT:\nI want the new line <strong>after</strong> the progress bar and before the next line prints out</p>\n"}, {"tags": ["go", "dns", "dkim"], "owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 470, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1561453670, "creation_date": 1561453670, "question_id": 56750468, "link": "https://stackoverflow.com/questions/56750468/generate-rsa-key-valid-for-dkim-validation", "title": "generate rsa key valid for dkim validation", "body": "<p>I am tring to generate dkim key using golang, my current code is :</p>\n\n<pre><code>package appdkim\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/asn1\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc Keymaker(path string) {\n    reader := rand.Reader\n    bitSize := 2048\n\n    key, err := rsa.GenerateKey(reader, bitSize)\n    checkError(err)\n\n    publicKey := key.PublicKey\n\n    savePEMKey(path+\".priv\", key)\n\n    savePublicPEMKey2(path+\".pub\", publicKey)\n\n    return\n}\n\nfunc savePEMKey(fileName string, key *rsa.PrivateKey) {\n    outFile, err := os.Create(fileName)\n    checkError(err)\n    defer outFile.Close()\n\n    var privateKey = &amp;pem.Block{\n        Type:  \"PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }\n\n    err = pem.Encode(outFile, privateKey)\n    checkError(err)\n}\n\nfunc savePublicPEMKey2(fileName string, pubkey rsa.PublicKey) {\n    //var PublicKeyRow bytes.Buffer\n\n    var pemkey = &amp;pem.Block{\n        Type:  \"PUBLIC KEY\",\n        Bytes: x509.MarshalPKCS1PublicKey(&amp;pubkey),\n    }\n\n    pemfile, err := os.Create(fileName)\n    checkError(err)\n    defer pemfile.Close()\n\n    err = pem.Encode(pemfile, pemkey)\n    checkError(err)\n\n    //err = pem.Encode(&amp;PublicKeyRow, pemkey)\n    //checkError(err)\n\n    //return PublicKeyRow.String()\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        fmt.Println(\"Fatal error \", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>the code is working, generate the dkim private/public keys, problem is this keys return bad keys by sender, if i generate keys using this site : <a href=\"https://easydmarc.com/tools/dkim-record-generator/\" rel=\"nofollow noreferrer\">https://easydmarc.com/tools/dkim-record-generator/</a> the keys results valid.</p>\n\n<p>this is my dkim settings in dns :</p>\n\n<pre><code>v=DKIM1;t=s;p=MIGJAoGBD1DSPRFFTujiCAiadP9ZeA6eAyf0GktfCQO2WKbrAx2Cu15y2A+agQMWNTmZbbhcznGZiz3kA9y7c0wOqN2iaJchBAxt4qdg1vUhy+6CkSZcY5bdm8uOxsXW3gjOTyZrOur/c118wMTOmSJKHOjn9xLG3ta8tXJtqab8idtx4TlBAgMBAAE=\n</code></pre>\n\n<p>I try to understend what if diferent with my golang key like key generated by easydmarc.com. What i need to change to my golang code for be valid for dkim validation ?</p>\n"}, {"tags": ["go", "concurrency", "mergesort"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1561453952, "creation_date": 1561453952, "answer_id": 56750544, "question_id": 56750038, "link": "https://stackoverflow.com/questions/56750038/how-to-fix-concurrent-merge-sort-in-go/56750544#56750544", "title": "How to fix concurrent merge sort in go", "body": "<p>Your merge phase is broken: You have to send on <code>ch</code> all values from <code>ch1</code> and <code>ch2</code> but your code stops once <em>any</em> of <code>ch1</code> <em>or</em> <code>ch2</code> is drained. Once you drained e.g. <code>ch2</code> you have to send everything from <code>ch1</code> to <code>c</code>.</p>\n\n<p>Something along (make sure to clean up the conditions!)</p>\n\n<pre><code>for ok1 || ok2 {\n    if (ok1 &amp;&amp; ok2 &amp;&amp; v1 &lt; v2) || (ok1 &amp;&amp; !ok2) {\n        ch &lt;- v1\n        v1, ok1 = &lt;-ch1\n    } else if (ok1 &amp;&amp; ok2 &amp;&amp; v1 &gt;= v2) || (!ok1 &amp;&amp; ok2) {\n        ch &lt;- v2\n        v2, ok2 = &lt;-ch2\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 3712270, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1547733353/picture?type=large", "display_name": "swappy", "link": "https://stackoverflow.com/users/3712270/swappy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 56750544, "answer_count": 1, "score": 1, "last_activity_date": 1561453952, "creation_date": 1561452144, "question_id": 56750038, "link": "https://stackoverflow.com/questions/56750038/how-to-fix-concurrent-merge-sort-in-go", "title": "How to fix concurrent merge sort in go", "body": "<p>I am trying to learn go lang and facing problems in implementing merge sort concurrently. It is not sorting the array properly</p>\n\n<p>I have tried finding any race conditions and also tried printing at various stages. But couldn't seem to figure out the issue. Any tool to analyze and point out such issues.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc merge(a []int, ch chan int) {\n    //     defer close(ch)\n    if len(a) == 0 {\n        close(ch)\n        return\n    }\n\n    if len(a) == 1 {\n        ch &lt;- a[0]\n        close(ch)\n        return\n    }\n\n    mid := len(a) / 2\n\n    ch1 := make(chan int)\n    go merge(a[:mid], ch1)\n\n    ch2 := make(chan int)\n    go merge(a[mid:], ch2)\n\n    v1, ok1 := &lt;-ch1\n    v2, ok2 := &lt;-ch2\n    var t []int\n    for ok1 == true &amp;&amp; ok2 == true {\n        if v1 &lt; v2 {\n            ch &lt;- v1\n            t = append(t, v1)\n            v1, ok1 = &lt;-ch1\n        } else {\n            ch &lt;- v2\n            t = append(t, v2)\n            v2, ok2 = &lt;-ch2\n        }\n    }\n    close(ch)\n}\n\nfunc Merge(a []int) (sortedA []int) {\n    ch := make(chan int)\n    go merge(a, ch)\n\n    for v := range ch {\n        sortedA = append(sortedA, v)\n    }\n    return\n}\n\nfunc main() {\n    arr := []int{3, 34, 23, 65, 34, 7, -1, 0, -23}\n    start := time.Now()\n    b := Merge(arr)\n    fmt.Printf(\"Time taken to sort: %v, sorted: %v\", time.Since(start), b)\n}\n\n</code></pre>\n\n<p>I expected the output to be <code>[-23 -1 0 3 7 23 34 34 65]</code> but the actual output is only <code>-23</code></p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1561448662, "post_id": 56749096, "comment_id": 100056181, "body": "Please don&#39;t use a regex for this task.The <a href=\"https://golang.org/pkg/strings/#FieldsFunc\" rel=\"nofollow noreferrer\">strings.FieldsFunc</a> method, a split, or a scan, would be far more efficient, readable, and generally better."}, {"owner": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561448871, "post_id": 56749096, "comment_id": 100056282, "body": "things are getting complex if I have one more tag like <code>columns=(c1, c2, c3)</code>. it could be <code>columns=(c1 c2 c3)</code> as well"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1561449919, "post_id": 56749096, "comment_id": 100056818, "body": "You cannot write a single regex to do what you want in Go because you need a lookahead."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561450276, "post_id": 56749096, "comment_id": 100057007, "body": "If you have the option, make the grammar more strict. It looks like you&#39;re dealing with struct tags. The rules for those are usually pretty strict anyway. For example, require either spaces or commas, not either/both. Don&#39;t feel bad inventing a grammar that&#39;s easy to parse. Your consumers are other developers--they&#39;ll understand."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561449538, "post_id": 56749258, "comment_id": 100056622, "body": "Thanks so much for being so responsive. I just updated the description to express more my concern cause it&#39;s getting complicated. Regex might still be the best way AFAIK."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561449631, "post_id": 56749258, "comment_id": 100056677, "body": "I still wouldn&#39;t use a regex for that. The more complex your data gets, the harder it is to reason about a regex.  I would still parse that as fields, and split the <code>columns</code> field into its component parts using <code>strings.Split</code> or similar."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561449656, "post_id": 56749258, "comment_id": 100056690, "body": "Basically, regular expressions are the wrong tool about 98.5% of the time."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561449822, "post_id": 56749258, "comment_id": 100056779, "body": "BTW, do you control the grammar you&#39;re parsing, or are you stuck parsing grammar someone else defined?"}, {"owner": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561450370, "post_id": 56749258, "comment_id": 100057045, "body": "i am defining the syntax for my own use. U are right, I am parsing the annotation of one field in the struct."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561450507, "post_id": 56749258, "comment_id": 100057106, "body": "@skywhat: If it&#39;s for your own use, then make your own life easier, and make the grammar much simpler. Stick to spaces or commas, not both. I suggest commas, because they&#39;re more common, but if you want to use spaces for indentation, then use spaces, and only spaces. :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "edited": false, "score": 0, "creation_date": 1561450533, "post_id": 56749258, "comment_id": 100057116, "body": "Or use spaces for general fields, and comas just for the columns. Then your parsing task because amazingly easy."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1561449944, "last_edit_date": 1561449944, "creation_date": 1561449012, "answer_id": 56749258, "question_id": 56749096, "link": "https://stackoverflow.com/questions/56749096/match-repeating-patterns-that-are-consistently-separated-with-comma-or-whitespac/56749258#56749258", "title": "Match repeating patterns that are consistently separated with comma or whitespace in golang", "body": "<p>Yes, what you want is possible. the <code>regexp.Regexp</code> type has a <code>String()</code> method, which produces the string representation. So you can use this to combine regular expressions:</p>\n\n<pre><code>patternName :=  regexp.MustCompile(`name=\\w+`)\npatternKey := regexp.MustCompile(`key=\\w+`)\npattern = regexp.MustCompile(`((`+patternName.String()+`|`+patternKey.String()+`)+,\\s*)*(`+patternName.String()+`|`+patternKey.String()`+`)+`)\n</code></pre>\n\n<p>Can be shortened (though less efficient) with <code>fmt.Sprintf</code>:</p>\n\n<pre><code>pattern = regexp.MustCompile(fmt.Sprintf(`((%s|%s)+,\\s*)*(%s|%s)+`, patternName, patternKey, patternName, patternKey)\n</code></pre>\n\n<p>But just because it's possible doesn't mean you should do it...</p>\n\n<p>Your particular examples would be much more easily handled using standard text parsing methods such as <code>strings.Split</code> or <code>strings.FieldsFunc</code>, etc. Given your provided sample inputs, I would do it this way:</p>\n\n<ol>\n<li>Split on whitespace/comma</li>\n<li>Split each result on the equals sign.</li>\n<li>Validate that the key names are expected (<code>name</code> and/or <code>key</code>)</li>\n</ol>\n\n<p>This code will be far easier to read, and will execute probably hundreds or thousands of times faster, compared to a regular expression. This approach also lends itself easily to stream processing, which can be a big benefit if you're processing hundreds or more records, and don't want to consume a lot of memory. (Regexp can be made to do this as well, but it's still less readable).</p>\n"}], "owner": {"reputation": 15, "user_id": 3577366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f52bf70d6cb7a8edd762c24422cdc32?s=128&d=identicon&r=PG", "display_name": "skywhat", "link": "https://stackoverflow.com/users/3577366/skywhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1561450035, "creation_date": 1561448439, "last_edit_date": 1561450035, "question_id": 56749096, "link": "https://stackoverflow.com/questions/56749096/match-repeating-patterns-that-are-consistently-separated-with-comma-or-whitespac", "title": "Match repeating patterns that are consistently separated with comma or whitespace in golang", "body": "<p>I am trying to parse multiple tags in one string literal.\nsuch as <code>name=testName, key=testKey, columns=(c1, c2, c3)</code>, and I might consider add more tags with different syntax in this string in the near future.\nSo it's natural to study regex to implement it.</p>\n\n<p>as for the syntax:\nvalid:</p>\n\n<pre><code>`name=testName,key=testKey`\n`name=testName, key=testKey`\n`name=testName key=testKey`\n`name=testName    key=testKey`\n`name=testName key=testKey columns=(c1 c2 c3)`\n`name=testName key=testKey columns=(c1, c2, c3)`\n`name=testName, key=testKey, columns=(c1 c2 c3)`\n</code></pre>\n\n<p>invalid:</p>\n\n<pre><code>`name=testName,, key=testKey`  (multiple commas in between)\n`name=testName, key=testKey,`  (end with a comma)\n`name=testName, key=testKey, columns=(c1,c2 c3)` u can only use comma or whitespace consistently inside columns, the rule applies to the whole tags as well. see below\n`name=testName, key=testKey columns=(c1,c2,c3)`\n\n</code></pre>\n\n<p>I come up the whole pattern like this:</p>\n\n<pre><code>((name=\\w+|key=\\w+)+,\\s*)*(name=\\w+|key=\\w+)+\n</code></pre>\n\n<p>I am wondering is it possible to set the subpattern as a regex and then combine them into a larger pattern.\nsuch as</p>\n\n<pre><code>patternName :=  regexp.MustCompile(`name=\\w+`)\npatternKey := regexp.MustCompile(`key=\\w+`)\npattern = ((patternName|patternKey)+,\\s*)*(patternName|patternKey)+\n</code></pre>\n\n<p>considering I will add more tags, the whole pattern will definitely get larger and more ugly. Is there any elegant way like the combined way?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 9, "last_activity_date": 1561448224, "last_edit_date": 1561448224, "creation_date": 1561447397, "answer_id": 56748822, "question_id": 56748743, "link": "https://stackoverflow.com/questions/56748743/test-concurrent-map-read-and-map-write/56748822#56748822", "title": "test concurrent map read and map write", "body": "<p>You must pass a pointer to your <code>sync.RWMutex</code> value. Otherwise, you're making copies of the mutex every time you pass it to a new function, so no actual locking happens.</p>\n\n<p>The <code>go vet</code> tool will detect this error for you. You should run <code>go vet</code> (and likely <a href=\"https://github.com/golangci/golangci-lint\" rel=\"noreferrer\">other linters</a>) on all your code, to help catch such common errors. <a href=\"https://medium.com/golangspec/detect-locks-passed-by-value-in-go-efb4ac9a3f2b\" rel=\"noreferrer\">Related reading</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 7130602, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1o2C.png?s=128&g=1", "display_name": "Jachin Huang", "link": "https://stackoverflow.com/users/7130602/jachin-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 56748822, "answer_count": 1, "score": 3, "last_activity_date": 1561448224, "creation_date": 1561447138, "question_id": 56748743, "link": "https://stackoverflow.com/questions/56748743/test-concurrent-map-read-and-map-write", "title": "test concurrent map read and map write", "body": "<p>I am a newcomer to the go language. When I execute the code, I get the following error\uff1a<br>\nfatal error: concurrent map read and map write</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func foo() {\n    var m = map[string]int{\"a\": 1}\n    var lock = sync.RWMutex{}\n\n    go Read(m, lock)\n    time.Sleep(1 * time.Second)\n    go Write(m, lock)\n    time.Sleep(1 * time.Minute)\n}\n\nfunc main() {\n    foo()\n}\n\nfunc Read(m map[string]int, lock sync.RWMutex) {\n    for {\n        read(m, lock)\n    }\n}\n\nfunc Write(m map[string]int, lock sync.RWMutex) {\n    for {\n        write(m, lock)\n    }\n}\n\nfunc read(m map[string]int, lock sync.RWMutex) {\n    lock.RLock()\n    defer lock.RUnlock()\n    _ = m[\"a\"]\n}\n\nfunc write(m map[string]int, lock sync.RWMutex) {\n    lock.Lock()\n    defer lock.Unlock()\n    m[\"b\"] = 2\n}\n</code></pre>\n\n<p>anyone can tell me why?</p>\n"}, {"tags": ["go", "types", "type-conversion", "type-assertion"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561446490, "post_id": 56747464, "comment_id": 100055158, "body": "You only need to assert the type of an interface value if you need to access something specific to the dynamic type, such as a struct field or a method that is not part of the interface. If you depend on something that&#39;s specific to a particular driver then that code won&#39;t work with another driver, obviously. Don&#39;t do that then. Depend only on some common interface that works with all drivers you want to support."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561823302, "post_id": 56747533, "comment_id": 100190903, "body": "<code>A</code> is not an <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"nofollow noreferrer\">alias</a> of <code>interface{}</code>."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 0, "last_activity_date": 1561455917, "last_edit_date": 1561455917, "creation_date": 1561441459, "answer_id": 56747533, "question_id": 56747464, "link": "https://stackoverflow.com/questions/56747464/type-assert-custom-type-to-base-type/56747533#56747533", "title": "Type assert custom type to base type", "body": "<p>You cannot <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">type assert</a> variable <code>y</code> to <code>[]interface{}</code> because the actual data type of <code>y</code> is <code>A</code> (even though <code>A</code> is an alias of <code>[]interface{}</code>).</p>\n\n<p>Working example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fmt.Println(y.(A))\n</code></pre>\n\n<p>But you can convert variable with <code>A</code> data type to <code>[]interface{}</code> by using <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>. Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>w := y.(A)\nx := []interface{}(w)\n\n// or \n\nz := []interface{}(y.(A))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1561447795, "last_edit_date": 1561447795, "creation_date": 1561446791, "answer_id": 56748642, "question_id": 56747464, "link": "https://stackoverflow.com/questions/56747464/type-assert-custom-type-to-base-type/56748642#56748642", "title": "Type assert custom type to base type", "body": "<p>When <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type asserting</a> (to) a concrete type, you can only type assert the same type that is stored in the interface value, not its base type. Of course when you have the concrete type, you can <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">convert</a> that to its base type.</p>\n\n<p>You said you want to avoid that, you want to avoid having to refer to the concrete type.</p>\n\n<p>To do that, you will need reflection. Obtain a <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> descriptor of the value, and use the <a href=\"https://golang.org/pkg/reflect/#Value.Convert\" rel=\"nofollow noreferrer\"><code>Value.Convert()</code></a> method to \"directly\" convert to its base type, skipping the \"actual\" type. This will succeed because a value can be converted to a value of its base type.</p>\n\n<p>Of course the <code>Value.Convert()</code> method will yield a value of type <code>reflect.Value</code> (and not <code>[]interface{}</code>), but you can get the <code>interface{}</code> value wrapping this using <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a>. You will now have an <code>interface{}</code> that wraps a concrete value of type <code>[]interface{}</code>, from which you can now type assert a value of type <code>[]interface{}</code>.</p>\n\n<p>See this example:</p>\n\n<pre><code>z := reflect.ValueOf(y).Convert(reflect.TypeOf([]interface{}{})).\n    Interface().([]interface{})\n\nfmt.Printf(\"%T %v\", z, z)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/urlxJmMhiOs\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[]interface {} [b c]\n</code></pre>\n\n<p>There's a lot of boilerplate here, and this won't be nearly as efficient as a simple type-assertion and conversion. Try to avoid doing it this way.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10400458"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 56748642, "answer_count": 2, "score": 1, "last_activity_date": 1561455917, "creation_date": 1561441078, "last_edit_date": 1561446847, "question_id": 56747464, "link": "https://stackoverflow.com/questions/56747464/type-assert-custom-type-to-base-type", "title": "Type assert custom type to base type", "body": "<p>Is it possible to type assert a custom type to its base type?</p>\n\n<p>For example, if I have the following</p>\n\n<pre><code>type A []interface{}\n\nvar x = map[string]interface{}{\n        \"hello\":\"a\",\n        \"world\":A{\"b\",\"c\"},\n    }\n\ny := x[\"world\"]\n</code></pre>\n\n<p>Then if I try to type assert via <code>y.([]interface{})</code> I get the error <code>//interface {} is A, not []interface {}</code>.</p>\n\n<p>Edit: As an answer below has noted, I can assert to type A via <code>y.(A)</code>. The problem stems from <code>x</code> being given by a Mongo driver. Some drivers implement their own types, for example, the official mongo driver implements a <code>bson.A</code> type for <code>[]interface</code> types. If I switch drivers then my type assertions need to change to match their custom types, which is something I want to avoid.</p>\n"}, {"tags": ["go", "sqlx"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1561437845, "post_id": 56746785, "comment_id": 100052108, "body": "Erm... You explicitly ask only to return <code>user_nme</code> for all users, which will simply return a list of usernames, no additional values. How should Go populate those fields, then?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1561438057, "post_id": 56746785, "comment_id": 100052166, "body": "Furthermore, you do what is called \u201estuttering\u201c amongst gophers: <code>User.UserEmail</code>. Makes more sense to call it <code>User.Email</code>"}], "answers": [{"comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1561442297, "post_id": 56747514, "comment_id": 100053385, "body": "I want to get the queried fields, not all"}, {"owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "reply_to_user": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1561442426, "post_id": 56747514, "comment_id": 100053433, "body": "you can use only  <code>users.UserName</code>"}], "tags": [], "owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1561532251, "last_edit_date": 1561532251, "creation_date": 1561441350, "answer_id": 56747514, "question_id": 56746785, "link": "https://stackoverflow.com/questions/56746785/how-to-get-corresponding-fields-when-selecting-specific-columns/56747514#56747514", "title": "How to get corresponding fields when selecting specific columns?", "body": "<p><strong>You can try this</strong></p>\n\n<pre><code>func (ur *userRepository) FindAll() ([]models.User, error) {\n    users := []models.User{}.UserNme\n    query := \"select user_nme from users\"\n    err := ur.Db.Select(&amp;users, query)\n    if err != nil {\n        return nil, err\n    }\n    return users, nil\n}\n</code></pre>\n\n<p>Also you can follow this link </p>\n\n<p><a href=\"http://go-database-sql.org/retrieving.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/retrieving.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1561967926, "post_id": 56748105, "comment_id": 100215781, "body": "This way will lose static type for <code>user</code>, because <code>interface{}</code> means <code>any</code> type."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 0, "last_activity_date": 1561444861, "last_edit_date": 1561444861, "creation_date": 1561444546, "answer_id": 56748105, "question_id": 56746785, "link": "https://stackoverflow.com/questions/56746785/how-to-get-corresponding-fields-when-selecting-specific-columns/56748105#56748105", "title": "How to get corresponding fields when selecting specific columns?", "body": "<p>By using struct, you can't.</p>\n\n<p>The other fields will still be there with it's zero value. The fields are property of the struct so whether you need it or not, whether it stored retrieved value from db operation or not, all the fields will still be there.</p>\n\n<p>The only solution for your case is by using map, so only value of correspondent fields will be retrieved.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var users []map[string]interface{}\nquery := \"select user_nme from users\"\nerr := ur.Db.Select(&amp;users, query)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&amp;[]map[string]interface{}{map[string]interface{}{UserNme:\"Jay Durgan\"}, ...}\n</code></pre>\n"}], "owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 56748105, "answer_count": 2, "score": -1, "last_activity_date": 1561532251, "creation_date": 1561436338, "last_edit_date": 1561449466, "question_id": 56746785, "link": "https://stackoverflow.com/questions/56746785/how-to-get-corresponding-fields-when-selecting-specific-columns", "title": "How to get corresponding fields when selecting specific columns?", "body": "<p>Here is the code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// User Model\ntype User struct {\n    UserID        int           `db:\"user_id\"`\n    UserNme       string        `db:\"user_nme\"`\n    UserEmail     string        `db:\"user_email\"`\n    UserAddressID sql.NullInt64 `db:\"user_address_id\"`\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (ur *userRepository) FindAll() ([]models.User, error) {\n    var users []models.User\n    query := \"select user_nme from users\"\n    err := ur.Db.Select(&amp;users, query)\n    if err != nil {\n        return nil, err\n    }\n    return users, nil\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>&amp;[]models.User{models.User{UserID:0, UserNme:\"Jay Durgan\", UserEmail:\"\", UserAddressID:sql.NullInt64{Int64:0, Valid:false}}, models.User{UserID:0, UserNme:\"Arne Balistreri\", UserEmail:\"\", UserAddressID:sql.NullInt64{Int64:0, Valid:false}}, models.User{UserID:0, UserNme:\"Greg Willms\", UserEmail:\"\", UserAddressID:sql.NullInt64{Int64:0, Valid:false}}, models.User{UserID:0, UserNme:\"Lady Aisha McLaughlin\", UserEmail:\"\", UserAddressID:sql.NullInt64{Int64:0, Valid:false}}, models.User{UserID:0, UserNme:\"Mrs. Phoebe Boyle\", UserEmail:\"\", UserAddressID:sql.NullInt64{Int64:0, Valid:false}}}% \n</code></pre>\n\n<p>As you can see, I didn't query <code>user_id</code>, <code>user_email</code> and <code>user_address_id</code> columns, but the result give me these fields with zero value. </p>\n\n<p>So, is there a way only get the fields correspond to the queried columns?\nBeside, I don't want to write it like this: <code>&amp;user.userNme</code>, <code>&amp;user.xxx</code>, <code>&amp;user.xxx</code> which means write each field and populate it. It's too verbose.</p>\n\n<p>Expected result is: <code>{UserNme: \"Jay Durgan\"}</code>...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 1, "creation_date": 1561446376, "post_id": 56746563, "comment_id": 100055105, "body": "@sahaj: Votes are anonymous for a reason. Asking people to explain their votes is not constructive."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1561446615, "post_id": 56746563, "comment_id": 100055211, "body": "I don&#39;t understand your question. Your title asks about receive before send. Your question asks about send before receive. Your code does neither. What is your actual question?"}, {"owner": {"reputation": 1, "user_id": 8206890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e27ede826c9b9fae302182f958b5130a?s=128&d=identicon&r=PG&f=1", "display_name": "user8206890", "link": "https://stackoverflow.com/users/8206890/user8206890"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561968692, "post_id": 56746563, "comment_id": 100216094, "body": "I guess I had a bad title then (or poor english). The original question came from the confusion that:if I exchange line 15 and line 17, which will come first : c &lt;- &quot;John&quot;  or &lt;-c. It was hard for me to understand, at that time, &quot;channel&quot; will &quot;give out&quot; something before it &quot;receives&quot; (the case that &lt;- c happens before c &lt;- &quot;John&quot;)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561981079, "post_id": 56746563, "comment_id": 100222123, "body": "For an unbuffered channel, like you&#39;re using, send and receive must happen simultaneously. There is no &quot;before&quot; or &quot;after&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1561434529, "creation_date": 1561434529, "answer_id": 56746576, "question_id": 56746563, "link": "https://stackoverflow.com/questions/56746563/deadlock-in-golang/56746576#56746576", "title": "deadlock in golang", "body": "<p>The channel <code>c</code> is unbuffered.  Communication on an unbuffered channel does not proceed until the sender and receiver are both ready. </p>\n\n<p>The program deadlocks because no receiver is ready when the main goroutine executes the send operation.</p>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1566286067, "last_edit_date": 1566286067, "creation_date": 1561445835, "answer_id": 56748405, "question_id": 56746563, "link": "https://stackoverflow.com/questions/56746563/deadlock-in-golang/56748405#56748405", "title": "deadlock in golang", "body": "<p>You can do something like this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc greet(c chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Hello \" + &lt;-c + \"!\")\n}\n\nfunc main() {\n    c := make(chan string, 10)\n    //line15\n    c &lt;- \"John\"\n    //line17\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go greet(c, &amp;wg)\n    c &lt;- \"Alex\"\n    wg.Add(1)\n    go greet(c, &amp;wg)\n    wg.Wait()\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8206890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e27ede826c9b9fae302182f958b5130a?s=128&d=identicon&r=PG&f=1", "display_name": "user8206890", "link": "https://stackoverflow.com/users/8206890/user8206890"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1566286067, "creation_date": 1561434400, "last_edit_date": 1561969067, "question_id": 56746563, "link": "https://stackoverflow.com/questions/56746563/deadlock-in-golang", "title": "deadlock in golang", "body": "<p>I know by exchanging line 15 and line 17 gives no error, however, I don't understand why not exchange will gives deadlock</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n\n)\n\nfunc greet(c chan string) {\n    fmt.Println(\"Hello \" + &lt;-c + \"!\")\n}\n\nfunc main() {\n    c := make(chan string)\n    //line15\n    c &lt;- \"John\"\n    //line17\n    go greet(c)\n\n}\n</code></pre>\n\n<p>fatal error: all goroutines are asleep - deadlock!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561477934, "post_id": 56746206, "comment_id": 100073254, "body": "Where is worker func? Where result is stored?"}, {"owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561481749, "post_id": 56746206, "comment_id": 100075049, "body": "Ok! I will continue researching about this because it isn&#39;t clear for me. Thank you anyway!"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "edited": false, "score": 0, "creation_date": 1561478047, "post_id": 56746503, "comment_id": 100073314, "body": "Has it only one channel, right? This channel works for 5 goroutines?"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1561487678, "post_id": 56746503, "comment_id": 100077724, "body": "You can think of the channel as a queue here - each worker takes the top thing off the queue, so yeah, only need one"}], "tags": [], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "is_accepted": false, "score": 1, "last_activity_date": 1561433884, "creation_date": 1561433884, "answer_id": 56746503, "question_id": 56746206, "link": "https://stackoverflow.com/questions/56746206/create-goroutine-and-set-maximum-goroutines/56746503#56746503", "title": "Create goroutine and set maximum goroutines", "body": "<p>There are many patterns in Go to set a threshold for goroutines. One of my favorites is using the pipeline. In the pipeline pattern, you create a set of running goroutine and pass a structure to them as a work.</p>\n\n<p>The following code is an illustrative example for pipelines. Please note that you must provide a synchronous way to waiting for goroutines to terminate for example using <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype handler struct {\n        workStream chan int\n}\n\nfunc (h handler) handle() {\n        for w := range h.workStream {\n                fmt.Printf(\"do some work with %d\\n\", w)\n        }\n}\n\nfunc main() {\n        h := handler{\n                workStream: make(chan int),\n        }\n\n        // run goroutines as much as you want\n        for i := 0; i &lt; 5; i++ {\n                go h.handle()\n        }\n\n        for i := 0; i &lt; 1000; i++ {\n                h.workStream &lt;- i\n        }\n\n        close(h.workStream) // by closing this channel all goroutines all killed\n\n        // TODO: wait for all goroutines to die\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1561486006, "post_id": 56759589, "comment_id": 100076966, "body": "Also note the change to the range, using an index instead of a range variable - the range variable will be made dynamically (copied), and changing that will just change the loop variable, rather than the member of the slice. I am probably not explaining this well, but it is a big gotcha."}, {"owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "edited": false, "score": 0, "creation_date": 1561486396, "post_id": 56759589, "comment_id": 100077163, "body": "Doesn&#39;t matter what do you put on channel? <code>semaphore &lt;- struct{}{}</code>"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "reply_to_user": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "edited": false, "score": 0, "creation_date": 1561486790, "post_id": 56759589, "comment_id": 100077327, "body": "Nope, but doing an empty struct is kind of nice memory size-wise, but a bool would be ok there too."}, {"owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "edited": false, "score": 0, "creation_date": 1561491114, "post_id": 56759589, "comment_id": 100079166, "body": "Thank you for explain! I though channel served only to pass information between goroutines"}], "tags": [], "owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "is_accepted": false, "score": 0, "last_activity_date": 1561485631, "last_edit_date": 1561485631, "creation_date": 1561485276, "answer_id": 56759589, "question_id": 56746206, "link": "https://stackoverflow.com/questions/56746206/create-goroutine-and-set-maximum-goroutines/56759589#56759589", "title": "Create goroutine and set maximum goroutines", "body": "<p>I like to use a simple count semaphore for this, combined with a sync.WaitGroup to ensure completion as @Parham Alvani suggests. (note that @Parham Alvani's solution is at least equally correct as this one)</p>\n\n<p>(some explanation  - we make a channel with a buffer - the buffer size becomes the amount of allowed concurrent executions of the goroutine. Each goroutine puts something in the channel, then reads it back out. In the case of the code below, the fifth time, the goroutine is blocked adding to the channel until another goroutine takes something out of the channel.)</p>\n\n<p>I also made the 'getRTT' function instead work on a pointer to a server, as we are munging the receiver here.</p>\n\n<p>playground here:\n<a href=\"https://play.golang.org/p/8Rmp0kHoNFB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8Rmp0kHoNFB</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n    \"math/rand\"\n)\n\n\ntype Server struct {\n    id  uint\n    ip  string\n    rtt time.Duration\n}\n\n\nfunc (s *Server) setRTT()  {  \n    fmt.Printf(\"setting rtt for id %d\\n\", s.id) \n    // do something that takes a while\n    sleepyTime := time.Second * time.Duration(rand.Intn(5))\n    time.Sleep(sleepyTime)\n    s.rtt = sleepyTime\n}\n\nfunc main() {\n\n    servers := []Server{\n       {1,\"10.10.10.0\",0},\n       {2,\"10.10.10.1\",0},\n       {3,\"10.10.10.2\",0},\n       {4,\"10.10.10.3\",0},\n       {5,\"10.10.10.4\",0},\n       {6,\"10.10.10.5\",0},\n       {7,\"10.10.10.0\",0},\n       {8,\"10.10.10.1\",0},\n       {9,\"10.10.10.2\",0},\n       {10,\"10.10.10.3\",0},\n       {11,\"10.10.10.4\",0},\n       {12,\"10.10.10.5\",0},\n       {13,\"10.10.10.0\",0},\n       {14,\"10.10.10.1\",0},\n       {15,\"10.10.10.2\",0},\n       {16,\"10.10.10.3\",0},\n\n    }\n    semaphore := make(chan struct{}, 4) // limit concurrency simply, you likely want a larger number than 4 here\n    var wg sync.WaitGroup // necessary to ensure we complete everything - otherwise main will exit before we are done\n\n    wg.Add(len(servers)) \n\n    for i := range servers {\n        go func(s *Server) {\n            defer wg.Done()\n            semaphore &lt;- struct{}{} // put something in channel, will block when &gt; 4\n            defer func() { &lt;-semaphore }() // remove something from channel as this goroutine completes, allowing another goroutine to continue\n            s.setRTT() \n        }(&amp;servers[i])\n    }\n    wg.Wait() // wait for it!\n    fmt.Println(servers)\n}\n</code></pre>\n\n<p>example output:</p>\n\n<pre><code>setting rtt for id 16\nsetting rtt for id 1\nsetting rtt for id 2\nsetting rtt for id 3\nsetting rtt for id 4\nsetting rtt for id 5\nsetting rtt for id 6\nsetting rtt for id 7\nsetting rtt for id 8\nsetting rtt for id 9\nsetting rtt for id 10\nsetting rtt for id 11\nsetting rtt for id 12\nsetting rtt for id 13\nsetting rtt for id 14\nsetting rtt for id 15\n[{1 10.10.10.0 2000000000} {2 10.10.10.1 2000000000} {3 10.10.10.2 4000000000} {4 10.10.10.3 1000000000} {5 10.10.10.4 3000000000} {6 10.10.10.5 0} {7 10.10.10.0 0} {8 10.10.10.1 1000000000} {9 10.10.10.2 0} {10 10.10.10.3 4000000000} {11 10.10.10.4 1000000000} {12 10.10.10.5 2000000000} {13 10.10.10.0 4000000000} {14 10.10.10.1 3000000000} {15 10.10.10.2 4000000000} {16 10.10.10.3 1000000000}]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1561487215, "creation_date": 1561487215, "answer_id": 56760031, "question_id": 56746206, "link": "https://stackoverflow.com/questions/56746206/create-goroutine-and-set-maximum-goroutines/56760031#56760031", "title": "Create goroutine and set maximum goroutines", "body": "<p>Start 20 goroutines to do the work.  Distribute work to those goroutines using a channel.  Wait for the goroutines to complete. </p>\n\n<pre><code>// c is channel for sending *Server values to worker goroutines.\nc := make(chan *Server)\n\n// Start worker goroutines. Each goroutine receives \n// values from c in a loop. The loop breaks when c\n// is closed.\nvar wg sync.WaitGroup\nfor i := 0; i &lt; 20; i++ {\n    wg.Add(1)\n    go func() {\n       for server := range c {\n           server.rtt = getRTT(server.ip)\n       }\n       wg.Done()\n    }()\n}\n\n// Feed work to the goroutines.\nfor _, server := range servers {\n    c &lt;- server\n}\n\n// Close channel to cause workers to break out of \n// for loop.\nclose(c)\n\n// Wait for the workers to complete.\nwg.Wait()\n\nfmt.Println(servers)\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 11695208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85455458574a64da3feb6c10aa46561?s=128&d=identicon&r=PG&f=1", "display_name": "Le Yuhu", "link": "https://stackoverflow.com/users/11695208/le-yuhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2522, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1561487215, "creation_date": 1561431113, "question_id": 56746206, "link": "https://stackoverflow.com/questions/56746206/create-goroutine-and-set-maximum-goroutines", "title": "Create goroutine and set maximum goroutines", "body": "<p>I'm learning Golang and I have some difficulties. I already researched Google, but no progress.</p>\n\n<p>I made a code that check RTT via ICMP of several servers.</p>\n\n<p>It has this struct:</p>\n\n<pre><code>type Server struct {\n    id  uint\n    ip  string\n    rtt time.Duration\n}\n</code></pre>\n\n<p>And it has a slice (Is it an array?) that contains several servers.\nFor each server in this slice I call function getRTT that returns the RTT then I store it on <code>Server.rtt</code> because after the for loop, I want to print all servers and their respectives RTT.</p>\n\n<pre><code>for _, server := range servers {\n    server.rtt = getRTT(server.ip) / time.Millisecond\n}\nfmt.Println(servers)\n</code></pre>\n\n<p>The problem it's sync, so send one by one \"ping\". I want to make this async and limit the maximum goroutines. Example: Call 20 getRTT at once.</p>\n\n<p>I'm reading about goroutines, maxgroup, channel, but I haven't got it so far.</p>\n"}, {"tags": ["java", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10104145, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GFw0uZGi1Uc/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oN9096DV47jBvBGbUOvj9CGIX9JA/mo/photo.jpg?sz=128", "display_name": "Vinodh Kumar", "link": "https://stackoverflow.com/users/10104145/vinodh-kumar"}, "edited": false, "score": 0, "creation_date": 1561444299, "post_id": 56747110, "comment_id": 100054132, "body": "Hi @Alex. thank you for responding. I tried this but, it is not suited for my task. If the input parameters coming from front end, we need to pass values in query otherwise not. and I have text[] concept. in that I need to retirve the data based on in coming array."}, {"owner": {"reputation": 586, "user_id": 8580266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911ad9fb565b3ce8c460014df914b3bf?s=128&d=identicon&r=PG&f=1", "display_name": "alexzimmer96", "link": "https://stackoverflow.com/users/8580266/alexzimmer96"}, "reply_to_user": {"reputation": 1, "user_id": 10104145, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GFw0uZGi1Uc/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oN9096DV47jBvBGbUOvj9CGIX9JA/mo/photo.jpg?sz=128", "display_name": "Vinodh Kumar", "link": "https://stackoverflow.com/users/10104145/vinodh-kumar"}, "edited": false, "score": 0, "creation_date": 1561444884, "post_id": 56747110, "comment_id": 100054401, "body": "Hi Vinodh, i added some information about method chaining using variables. This should match your case. If not, i think i did not get the problem."}], "tags": [], "owner": {"reputation": 586, "user_id": 8580266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911ad9fb565b3ce8c460014df914b3bf?s=128&d=identicon&r=PG&f=1", "display_name": "alexzimmer96", "link": "https://stackoverflow.com/users/8580266/alexzimmer96"}, "is_accepted": false, "score": 1, "last_activity_date": 1561444841, "last_edit_date": 1561444841, "creation_date": 1561438935, "answer_id": 56747110, "question_id": 56745827, "link": "https://stackoverflow.com/questions/56745827/how-can-i-add-query-parameters-dymanically-using-gorm/56747110#56747110", "title": "How can I add query parameters dymanically using gorm?", "body": "<p>In GORM, you could handle the basic inputs by enriching the Object and passing it to the function, similar to this:</p>\n\n<pre><code>// Would get the First user with Name=\"jinzhu\" and Age=\"20\"\ndb.Where(&amp;User{Name: \"jinzhu\", Age: 20}).First(&amp;user)\n</code></pre>\n\n<p>Whenever you cannot express a part of your statement using GORMs default functions, you can use normal SQL and Method Chaining:</p>\n\n<pre><code>// Would get the first User with Name=\"jinzhu\" and id in (4,5,6,7)\nids := [4]int{4,5,6,7}\ndb.Where(&amp;User{Name: \"jinzhu\"}).Where(\"id IN (?)\", ids).First(&amp;user)\n</code></pre>\n\n<p>You could also chain methods using variables</p>\n\n<pre><code>base := db.Where(&amp;User{Name: \"jinzhu\"})\nif someThing {\n    base = base.Where(\"id IN (?)\", ids) // Adding this condition just if someThing is true\n}\nbase.First(&amp;user) // Query your results\n</code></pre>\n\n<p><a href=\"http://gorm.io/docs/method_chaining.html\" rel=\"nofollow noreferrer\">More Information about Method Chaining</a></p>\n"}], "owner": {"reputation": 1, "user_id": 10104145, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GFw0uZGi1Uc/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oN9096DV47jBvBGbUOvj9CGIX9JA/mo/photo.jpg?sz=128", "display_name": "Vinodh Kumar", "link": "https://stackoverflow.com/users/10104145/vinodh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1828, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563992914, "creation_date": 1561427417, "last_edit_date": 1563992914, "question_id": 56745827, "link": "https://stackoverflow.com/questions/56745827/how-can-i-add-query-parameters-dymanically-using-gorm", "title": "How can I add query parameters dymanically using gorm?", "body": "<p>I am new to golang development. I have 6 parameters to pass into query using gorm. this is the select query so, based on input value we need to do filter the values. So, we need to pass the filters dynamically into query. I tried but no solution.</p>\n\n<p>func GetUsers(DB *gorm.DB, Offset int, Limit int, User uibackendmodels.UserDetails) (Users []uibackendmodels.UserDetails, Err error) {</p>\n\n<pre><code>query := \"SELECT userid, username, nickname, email, mobile, location, status, roleids, trsids, brandids, languagecode, createdat, createdby, modified, modifiedby\" +\n    \" FROM users WHERE 1=1 \"\n\nif User.UserName != \"\" || User.NickName != \"\" {\n    nameQuery := \"(\"\n    if User.UserName != \"\" {\n        nameQuery = nameQuery + \" username LIKE \" + \"'\" + User.UserName + \"%'\"\n    }\n    if User.NickName != \"\" &amp;&amp; User.UserName != \"\" {\n        nameQuery = nameQuery + \" OR nickname LIKE \" + \"'\" + User.NickName + \"%'\"\n    } else if User.NickName != \"\" {\n        nameQuery = nameQuery + \" nickname LIKE \" + \"'\" + User.NickName + \"%'\"\n    }\n    query = query + \" AND \" + nameQuery + \")\"\n}\n\nif User.BrandIDs != nil &amp;&amp; len(User.BrandIDs) &gt; 0 {\n    brandIds := \"(\"\n    for i := range User.BrandIDs {\n        if len(User.BrandIDs) == (i + 1) {\n            brandIds = brandIds + \"'\" + User.BrandIDs[i] + \"' =  ANY (brandids) \"\n        } else {\n            brandIds = brandIds + \"'\" + User.BrandIDs[i] + \"' =  ANY (brandids) OR \"\n        }\n    }\n    query = query + \" AND \" + brandIds + \")\"\n}\n\nif User.TRSIDs != nil &amp;&amp; len(User.TRSIDs) &gt; 0 {\n    trsIds := \"(\"\n    for i := range User.TRSIDs {\n        if len(User.TRSIDs) == (i + 1) {\n            trsIds = trsIds + \"'\" + User.TRSIDs[i] + \"' =  ANY (trsids) \"\n        } else {\n            trsIds = trsIds + \"'\" + User.TRSIDs[i] + \"' =  ANY (trsids) OR \"\n        }\n    }\n    query = query + \" AND \" + trsIds + \")\"\n}\nif User.RoleIDs != nil &amp;&amp; len(User.RoleIDs) &gt; 0 {\n    roleIds := \"(\"\n    for i := range User.RoleIDs {\n        if len(User.RoleIDs) == (i + 1) {\n            roleIds = roleIds + strconv.FormatInt(int64(User.RoleIDs[i]), 10) + \" =  ANY (roleids) \"\n        } else {\n            roleIds = roleIds + strconv.FormatInt(int64(User.RoleIDs[i]), 10) + \" =  ANY (roleids) OR \"\n        }\n    }\n    query = query + \" AND \" + roleIds + \")\"\n}\nif User.Status != \"\" {\n    query = query + \" AND  status = \" + \"'\" + EnumToString(User.Status) + \"'\"\n}\nquery = query + \" AND  status != 'deleted' ORDER BY modified desc LIMIT \" + strconv.Itoa(Limit) + \" OFFSET \" + strconv.Itoa(Offset)\n\nif err := DB.Raw(query).Scan(&amp;Users).Error; err != nil {\n    return nil, err\n}\nreturn Users, nil\n</code></pre>\n\n<p>}</p>\n\n<p>I need to add parameters dynamically to above query.</p>\n"}, {"tags": ["string", "go", "utf-8", "unicode-literals", "rune"], "comments": [{"owner": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "edited": false, "score": 0, "creation_date": 1561424870, "post_id": 56745544, "comment_id": 100049826, "body": "\\u1F606 is a UTF-32 codepoint not UTF-8."}, {"owner": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "reply_to_user": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "edited": false, "score": 0, "creation_date": 1561425806, "post_id": 56745544, "comment_id": 100049964, "body": "It&#39;s a surrogate pair as far as I understand it. But again, I&#39;m not overly concerned with supporting &quot;higher-order&quot; encoding at this point.  Please forgive my ignorance on the nuances of utf-8 vs utf-32."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1561490073, "post_id": 56745544, "comment_id": 100078729, "body": "@bennowak <code>\\u1F606</code> is not a surrogate pair.  That would look like <code>\\uD83D\\uDE06</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "edited": false, "score": 0, "creation_date": 1561427244, "post_id": 56745631, "comment_id": 100050167, "body": "You sir @Strom are a gem!  Thanks a ton for getting me there on that.  Might I ask where you dug to find that gold?  Or what was your thought process?  To help a lowly greenhorn like me to peer into the depths of greatness that I might one day fill my cup at the same mead hall?"}, {"owner": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "edited": false, "score": 0, "creation_date": 1561427407, "post_id": 56745631, "comment_id": 100050194, "body": "Works on &quot;higher order&quot; surrogates too!  Yipee!"}, {"owner": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "reply_to_user": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "edited": false, "score": 0, "creation_date": 1561431016, "post_id": 56745631, "comment_id": 100050774, "body": "@bennowak The logic was: 1. Concatenation doesn&#39;t work(the conversion is done during at compile time(<a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Constant_expressions</a>) 2. Convert the number to UTF-8 chars and append them into a string(Ouch, there must be a better way). 3. <code>rune</code> is an alias to <code>int32</code>(<a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a>), aha, a rune is just a Unicode codepoint. 4. Now to convert the hex string to a number (<a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow noreferrer\">golang.org/pkg/strconv/#ParseInt</a>). 5. Mix it all together in a large pot, stir, and taste(er... test).  Success."}, {"owner": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "reply_to_user": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "edited": false, "score": 0, "creation_date": 1561433811, "post_id": 56745631, "comment_id": 100051237, "body": "@bennowak &quot;Works on &quot;higher order&quot; [codepoints] too! Yipee!&quot;: this code will work on all single character codepoints (including Emojis).  Modifications would have to be made to support multi-codepoint glyphs (displayed characters), the longest of which are the flags of England, Scotland, and Wales at seven codepoints, 224 bits!"}], "tags": [], "owner": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "is_accepted": true, "score": 1, "last_activity_date": 1561426919, "last_edit_date": 1561426919, "creation_date": 1561425315, "answer_id": 56745631, "question_id": 56745544, "link": "https://stackoverflow.com/questions/56745544/how-to-convert-a-utf8-literal-ie-u1f606-to-a-rune-not-get-the-utf8-from-t/56745631#56745631", "title": "How to convert a utf8 literal (ie &#39;\\u1F606&#39;) to a rune? (NOT GET THE UTF8 FROM THE RUNE!)", "body": "<p>Parse the hex value into an int32.</p>\n\n<p>Then cast that value to a <code>rune</code> in the <code>println</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strconv\"\n\nfunc main() {\n    s1 := \"259\"\n    s2 := \"E\"\n    s3, err := strconv.ParseInt(s1+s2, 16, 32)\n    fmt.Println(string(rune(s3)))\n    fmt.Println(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 6559065, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JuKFIGO0Nto/AAAAAAAAAAI/AAAAAAAAADA/uRY3d9X4gtE/photo.jpg?sz=128", "display_name": "bennowak", "link": "https://stackoverflow.com/users/6559065/bennowak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 56745631, "answer_count": 1, "score": -1, "last_activity_date": 1561426933, "creation_date": 1561424249, "question_id": 56745544, "link": "https://stackoverflow.com/questions/56745544/how-to-convert-a-utf8-literal-ie-u1f606-to-a-rune-not-get-the-utf8-from-t", "title": "How to convert a utf8 literal (ie &#39;\\u1F606&#39;) to a rune? (NOT GET THE UTF8 FROM THE RUNE!)", "body": "<p>I'm trying to generate sequential characters using the utf8 hex codes. For example first part, I'm terming \"base\" code : 259\nsecond part, Im' terming \"end\" code : 1 (or, 2, or A, or F, etc)</p>\n\n<p>These are coming in as strings.  Once I append the end code and get a complete string (ie: 259E), how can I convert that into the actual utf8 representation (or \"character\")</p>\n\n<p>I'm not sure where to start.  I know that <code>string(rune('\\u259E')</code> will give me the representation ( \u259e), but I don't know how to get the string into the rune cast as a (single-quoted) utf8 character code.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s1 := \"259\"\n    s2 := \"E\"\n    s3 := \"\\\\u\"+s1+s2\n    fmt.Println(s3)\n    fmt.Println(string(rune('\\u259E'))) \n}\n</code></pre>\n\n<p>The desired outcome is that I'm able to return a utf8 character (and potentially surrogate pairs) from generated string representations of the codes.</p>\n\n<p>The overall gist (for example) is that I'd like the string value \"272A\" to return as : \u272a</p>\n"}, {"tags": ["go", "amazon-s3", "file-upload"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11112659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nh1fA.png?s=128&g=1", "display_name": "Neo", "link": "https://stackoverflow.com/users/11112659/neo"}, "is_accepted": false, "score": 1, "last_activity_date": 1561416868, "creation_date": 1561416868, "answer_id": 56744895, "question_id": 56744834, "link": "https://stackoverflow.com/questions/56744834/how-do-i-get-file-url-after-put-file-to-amazon-s3-in-golang/56744895#56744895", "title": "How do I get file url after put file to amazon s3 in golang?", "body": "<p>You will need to reconstruct the file url </p>\n\n<p>Using the s3 path to which you uploaded the file + the file name</p>\n"}, {"tags": [], "owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "is_accepted": true, "score": 0, "last_activity_date": 1561420520, "creation_date": 1561420520, "answer_id": 56745231, "question_id": 56744834, "link": "https://stackoverflow.com/questions/56744834/how-do-i-get-file-url-after-put-file-to-amazon-s3-in-golang/56745231#56745231", "title": "How do I get file url after put file to amazon s3 in golang?", "body": "<p>You can construct the URL as:</p>\n\n<pre><code>https://BUCKETNAME.s3-REGIONNAME.amazonaws.com/KEY\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>https://my-bucket.s3-ap-southeast-2.amazonaws.com/foo/bar.txt\n</code></pre>\n"}], "owner": {"reputation": 2985, "user_id": 7122343, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/nDdak.png?s=128&g=1", "display_name": "Nomura Nori", "link": "https://stackoverflow.com/users/7122343/nomura-nori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1348, "favorite_count": 0, "accepted_answer_id": 56745231, "answer_count": 2, "score": 0, "last_activity_date": 1561420520, "creation_date": 1561416318, "question_id": 56744834, "link": "https://stackoverflow.com/questions/56744834/how-do-i-get-file-url-after-put-file-to-amazon-s3-in-golang", "title": "How do I get file url after put file to amazon s3 in golang?", "body": "<p>File is uploaded successfully, and I want to return file url after uploading.</p>\n\n<pre><code>_, err := s3.New(s).PutObject(&amp;s3.PutObjectInput{\n    Bucket:               aws.String(\"bucket\"),\n    Key:                  aws.String(tempFileName),\n    ACL:                  aws.String(\"public-read\"), // could be private if you want it to be access by only authorized users\n    Body:                 bytes.NewReader(buffer),\n    ContentLength:        aws.Int64(int64(size)),\n    ContentType:          aws.String(http.DetectContentType(buffer)),\n    ContentDisposition:   aws.String(\"attachment\"),\n    ServerSideEncryption: aws.String(\"AES256\"),\n    StorageClass:         aws.String(\"INTELLIGENT_TIERING\"),\n})\n</code></pre>\n\n<p>I have checked amazon doc for PutObject function, but PutObjectOutput struct type\nBut there is no uploaded file url in this structure.</p>\n\n<p>How can I get file url?\nIs there other way to return uploaded file url in amazon s3 sdk as soon as upload success?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1561408615, "post_id": 56743291, "comment_id": 100046131, "body": "See <a href=\"https://stackoverflow.com/questions/37729643/golang-how-can-i-stop-the-execution-of-a-for-loop-from-outside-the-loop/37732256#37732256\" title=\"golang how can i stop the execution of a for loop from outside the loop\">stackoverflow.com/questions/37729643/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/54339304/all-goroutines-are-asleep-deadlock-with-waitgroup\" title=\"all goroutines are asleep deadlock with waitgroup\">stackoverflow.com/questions/54339304/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/54166296/one-channel-with-one-receiver-and-unknown-number-of-goroutines-senders-causing-d\" title=\"one channel with one receiver and unknown number of goroutines senders causing d\">stackoverflow.com/questions/54166296/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/56603716/best-time-to-close-channel-when-iterating-over-channel/56604063#56604063\" title=\"best time to close channel when iterating over channel\">stackoverflow.com/questions/56603716/&hellip;</a>, etc,"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1561408840, "post_id": 56743291, "comment_id": 100046220, "body": "There&#39;s no guarantee that the &quot;Edit 2&quot; version will print the values before the program exits."}, {"owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561408952, "post_id": 56743291, "comment_id": 100046254, "body": "Please tell me why?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1561409074, "post_id": 56743291, "comment_id": 100046300, "body": "@JeYa: because main exits when waitgroup is finished. Nothing in the code waits for reader goroutine to finish reading the channel."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561407754, "post_id": 56743452, "comment_id": 100045811, "body": "How can I handle this?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561407790, "post_id": 56743452, "comment_id": 100045826, "body": "@JeYa: depends on what exactly you are trying to achieve."}, {"owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561407932, "post_id": 56743452, "comment_id": 100045877, "body": "I trying to learn goroutine pushing data into same channel and main thread or any other thread traversing over it"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561407990, "post_id": 56743452, "comment_id": 100045902, "body": "@JeYa: I&#39;d say, that goal is achieved. You successfully push data to a channel from one goroutine and another reads it."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 2, "creation_date": 1561408033, "post_id": 56743452, "comment_id": 100045920, "body": "@JeYa: I explained that in the answer."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561408119, "post_id": 56743452, "comment_id": 100045961, "body": "One way to prevent a goroutine from blocking on reading from a channel that nobody writes to is to close that channel. A waitgroup will indeed be handy here, to wait for all writers to exit before closing the channel."}, {"owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561408303, "post_id": 56743452, "comment_id": 100046024, "body": "I have added another code using waitgroup. Please review and let me know where I am going. Thanks for promt reply :)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561408876, "post_id": 56743452, "comment_id": 100046231, "body": "@JeYa: no, don&#39;t do that. If you have a working code, post as an answer. And check out Cerise&#39;s version."}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 0, "last_activity_date": 1561407756, "last_edit_date": 1561407756, "creation_date": 1561407587, "answer_id": 56743452, "question_id": 56743291, "link": "https://stackoverflow.com/questions/56743291/getting-goroutine-deadlock-when-using-for-loop-to-traverse-through-the-channel/56743452#56743452", "title": "Getting Goroutine deadlock when using for loop to traverse through the channel", "body": "<p>Not sure what your question is, but I'll tell you what happens. Your two side goroutines push their numbers to the channel and exit. Then the main goroutine (the only one left at this point) will block forever, waiting for another element to come out of the channel. </p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561409458, "post_id": 56743640, "comment_id": 100046410, "body": "When I am adding <code>w.Wait()</code> before the goroutine, after <code>go smallThread(2, c, &amp;w)</code>, I am getting deadlock error, I wanted to wait the main thread unless all the <code>smallThread</code> are finished"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "edited": false, "score": 0, "creation_date": 1561413288, "post_id": 56743640, "comment_id": 100047611, "body": "@JeYa Because the channel is unbuffered,  the <code>smallThread</code> goroutines do not complete until after the main goroutine receives.  If the main goroutine calls w.Wait() before receiving, the <code>smallThread</code> goroutines block on send. If the goroutines block on send, then they never call w.Done().  That&#39;s a deadlock."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1561408683, "creation_date": 1561408683, "answer_id": 56743640, "question_id": 56743291, "link": "https://stackoverflow.com/questions/56743291/getting-goroutine-deadlock-when-using-for-loop-to-traverse-through-the-channel/56743640#56743640", "title": "Getting Goroutine deadlock when using for loop to traverse through the channel", "body": "<p>When the goroutines are done, close the channel to indicate that no more values will be added. The for loop will break when after all values are received.</p>\n\n<pre><code>c := make(chan int)\nvar w sync.WaitGroup\nw.Add(2)\ngo smallThread(1, c, &amp;w)\ngo smallThread(2, c, &amp;w)\ngo func() {\n    w.Wait()\n    close(c)\n}()\n\nfor i := range c {\n    fmt.Println(i)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11694263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2e3179fb4d22984c906cd6400986a2?s=128&d=identicon&r=PG&f=1", "display_name": "Je Ya", "link": "https://stackoverflow.com/users/11694263/je-ya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 56743640, "answer_count": 2, "score": -3, "last_activity_date": 1561408698, "creation_date": 1561406820, "last_edit_date": 1561408698, "question_id": 56743291, "link": "https://stackoverflow.com/questions/56743291/getting-goroutine-deadlock-when-using-for-loop-to-traverse-through-the-channel", "title": "Getting Goroutine deadlock when using for loop to traverse through the channel", "body": "<p>I am tring to practise goroutine and channels, where I am facing issue where I am calling gorouting and passing channel. The goroutine will push data into into channel and then main thread will print the elements.</p>\n\n<p>I have used for loop to print the contents but getting.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>fatal error: all goroutines are asleep - deadlock!\n\n2\n1\ngoroutine 1 [chan receive]:\nmain.main()\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\n\nfunc smallThread(a int, c chan int) {\n    c &lt;- a\n}\n\nfunc main() {\n    c := make(chan int)\n    go smallThread(1, c)\n    go smallThread(2, c)\n    for {\n        fmt.Println(&lt;-c)\n    }\n}\n\n</code></pre>\n\n<p><strong>EDIT</strong>:\nUsing waitgroup:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func smallThread(a int, c chan int, w *sync.WaitGroup) {\n    c &lt;- a\n    w.Done()\n}\n\nfunc main() {\n    c := make(chan int)\n    var w sync.WaitGroup\n    w.Add(2)\n    go smallThread(1, c, &amp;w)\n    go smallThread(2, c, &amp;w)\n    //w.Wait()\n    for i := range c {\n        fmt.Println(i)\n    }\n    w.Wait()\n}\n</code></pre>\n\n<p><strong>EDIT2</strong>: Working Code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func smallThread(a int, c chan int, w *sync.WaitGroup) {\n    //defer w.Done()\n    c &lt;- a\n    w.Done()\n}\n\nfunc main() {\n    c := make(chan int)\n    var w sync.WaitGroup\n    w.Add(1)\n    go smallThread(1, c, &amp;w)\n    w.Add(1)\n    go smallThread(2, c, &amp;w)\n    go func(c chan int) {\n        for i := range c {\n            fmt.Println(i)\n        }\n    }(c)\n    w.Wait()\n}\n</code></pre>\n"}, {"tags": ["go", "email-validation", "dkim"], "comments": [{"owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "edited": false, "score": 0, "creation_date": 1561407806, "post_id": 56742693, "comment_id": 100045835, "body": "You should be using <code>x509.MarshalPKCS1PublicKey</code> or <code>x509.MarshalPKIXPublicKey</code> for the public key, not <code>asn1.Marshal</code>."}, {"owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "reply_to_user": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "edited": false, "score": 0, "creation_date": 1561408217, "post_id": 56742693, "comment_id": 100046003, "body": "@PaulGriffiths can show me example code, please. i am new in golang."}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "edited": false, "score": 0, "creation_date": 1561668777, "post_id": 56742693, "comment_id": 100151234, "body": "Is this a duplicate of <a href=\"https://stackoverflow.com/q/56750468/648741\">stackoverflow.com/q/56750468/648741</a> ?"}], "owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 336, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561403962, "creation_date": 1561403962, "question_id": 56742693, "link": "https://stackoverflow.com/questions/56742693/generate-valid-dkim-key-using-golang", "title": "generate valid dkim key using golang", "body": "<p>I am tring to generate dkim key using golang, my current code is :</p>\n\n<pre><code>import (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/asn1\"\n    \"encoding/gob\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc Keymaker(path string) {\n    reader := rand.Reader\n    bitSize := 2048\n\n    key, err := rsa.GenerateKey(reader, bitSize)\n    checkError(err)\n\n    publicKey := key.PublicKey\n\n    //saveGobKey(\"private.key\", key)\n    savePEMKey(path+\".priv\", key)\n\n    //saveGobKey(\"public.key\", publicKey)\n    savePublicPEMKey(path+\".pub\", publicKey)\n}\n\nfunc savePEMKey(fileName string, key *rsa.PrivateKey) {\n    outFile, err := os.Create(fileName)\n    checkError(err)\n    defer outFile.Close()\n\n    var privateKey = &amp;pem.Block{\n        Type:  \"PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }\n\n    err = pem.Encode(outFile, privateKey)\n    checkError(err)\n}\n\nfunc savePublicPEMKey(fileName string, pubkey rsa.PublicKey) {\n    asn1Bytes, err := asn1.Marshal(pubkey)\n    checkError(err)\n\n    var pemkey = &amp;pem.Block{\n        Type:  \"PUBLIC KEY\",\n        Bytes: asn1Bytes,\n    }\n\n    pemfile, err := os.Create(fileName)\n    checkError(err)\n    defer pemfile.Close()\n\n    err = pem.Encode(pemfile, pemkey)\n    checkError(err)\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        fmt.Println(\"Fatal error \", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>the code is working, generate the dkim private/public keys, problem is this keys return bad keys by sender, if i generate keys using this site : <a href=\"https://easydmarc.com/tools/dkim-record-generator/\" rel=\"nofollow noreferrer\">https://easydmarc.com/tools/dkim-record-generator/</a> the keys results valid.</p>\n\n<p>this is my dkim settings in dns : </p>\n\n<pre><code>v=DKIM1;t=s;p=MIGJAoGBD1DSPRFFTujiCAiadP9ZeA6eAyf0GktfCQO2WKbrAx2Cu15y2A+agQMWNTmZbbhcznGZiz3kA9y7c0wOqN2iaJchBAxt4qdg1vUhy+6CkSZcY5bdm8uOxsXW3gjOTyZrOur/c118wMTOmSJKHOjn9xLG3ta8tXJtqab8idtx4TlBAgMBAAE=\n</code></pre>\n\n<p>i try to understend way keys generated by easydmarc.com working, and golang keys not working. Any ideea ?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561390453, "post_id": 56739720, "comment_id": 100038490, "body": "Look at the <a href=\"https://github.com/mongodb/mongo-go-driver#usage\" rel=\"nofollow noreferrer\">github.com/mongodb/mongo-go-driver#usage</a>. You need to pass a context to results.Next(ctx) and call <code>results.Decode(&amp;organzation)</code> and the print/append."}, {"owner": {"reputation": 1, "user_id": 11692905, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UZiNkM6AGnY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re0ew9WSfdTjIpyTEtT7nmKSN-eRw/mo/photo.jpg?sz=128", "display_name": "Jakub Gadawski", "link": "https://stackoverflow.com/users/11692905/jakub-gadawski"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561391353, "post_id": 56739720, "comment_id": 100038943, "body": "Hi, thanks for response but that&#39;s can&#39;t help me becouse I&#39;m using <code>bongo</code> to connect with mongoDB"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1561392238, "creation_date": 1561392238, "answer_id": 56740294, "question_id": 56739720, "link": "https://stackoverflow.com/questions/56739720/how-to-fix-golang-append-method-pushing-same-elements-to-slice/56740294#56740294", "title": "How to fix: Golang &quot;append&quot; method pushing same elements to slice", "body": "<p>The application appends the same value of <code>organization</code> on every iteration through the loop. Fix by creating a new value inside the loop.</p>\n\n<pre><code>func (os *OrganizationService) GetAll() ([]*models.Organization, error) {\n    var organizations []*models.Organization\n    results := os.MongoClient.Collection(\"organizations\").Find(bson.M{})\n    organization := &amp;models.Organization{}\n    for results.Next(organization) {\n        fmt.Println(organization)\n        organizations = append(organizations, organization)\n        organization = &amp;models.Organization{} // new value for next iteration\n    }\n    return organizations, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11692905, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UZiNkM6AGnY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re0ew9WSfdTjIpyTEtT7nmKSN-eRw/mo/photo.jpg?sz=128", "display_name": "Jakub Gadawski", "link": "https://stackoverflow.com/users/11692905/jakub-gadawski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 56740294, "answer_count": 1, "score": -3, "last_activity_date": 1561392238, "creation_date": 1561389960, "last_edit_date": 1561391291, "question_id": 56739720, "link": "https://stackoverflow.com/questions/56739720/how-to-fix-golang-append-method-pushing-same-elements-to-slice", "title": "How to fix: Golang &quot;append&quot; method pushing same elements to slice", "body": "<p>I'm trying to map data from DB ( Mongo ) to slice in go , and everythin works fine if I'm returning simple <code>[]string</code> but if I change type to <code>[]*models.Organization</code> that code returns slice of same elements.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (os *OrganizationService) GetAll() ([]*models.Organization, error) {\n    var organizations []*models.Organization\n    results := os.MongoClient.Collection(\"organizations\").Find(bson.M{})\n    organization := &amp;models.Organization{}\n    for results.Next(organization) {\n        fmt.Println(organization)\n        organizations = append(organizations, organization)\n    }\n    return organizations, nil\n}\n\n\n</code></pre>\n\n<p>I expect output <code>[{ Name: \"someOrg\", ID: \"someId\" },{ Name: \"someOrg2\", ID: \"someID }, ... ]</code> , but actual output is  <code>[{ Name: \"someOrg\", ID: \"someId\" },{ Name: \"someOrg\", ID: \"someId\" }, ... ]</code></p>\n\n<p>I'm using <code>bongo</code> package.</p>\n"}, {"tags": ["go", "gitlab-ci", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561387133, "post_id": 56738600, "comment_id": 100036511, "body": "Are you sure to use a module build? Did you set GO111MODULE=on?"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561387488, "post_id": 56738600, "comment_id": 100036737, "body": "Yes, I did, and I have go modules output, so there is no doubt about it"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 2, "creation_date": 1561387623, "post_id": 56738600, "comment_id": 100036839, "body": "You might need gitlab to cache the dependencies between jobs <a href=\"https://docs.gitlab.com/ee/ci/caching/#how-archiving-and-extracting-works\" rel=\"nofollow noreferrer\">docs.gitlab.com/ee/ci/caching/&hellip;</a>"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1561387808, "post_id": 56738600, "comment_id": 100036961, "body": "I used to do it with artifacts, with vendor folder, and it was working well.... I could give it a try"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1561388578, "post_id": 56738600, "comment_id": 100037428, "body": "Are you certain <code>golint</code> supports modules? (<a href=\"https://github.com/golang/lint/issues/409\" rel=\"nofollow noreferrer\">github.com/golang/lint/issues/409</a>)"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1561388720, "post_id": 56738600, "comment_id": 100037516, "body": "Yep, it sounds that there is still not a full support of modules with lint"}, {"owner": {"reputation": 2724, "user_id": 758494, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0a60a9c9c5193d41019fa3e09b2696f3?s=128&d=identicon&r=PG", "display_name": "Isaac Kleinman", "link": "https://stackoverflow.com/users/758494/isaac-kleinman"}, "edited": false, "score": 0, "creation_date": 1561390265, "post_id": 56738600, "comment_id": 100038370, "body": "What does your <code>inject-gopath</code> look like?"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 2724, "user_id": 758494, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0a60a9c9c5193d41019fa3e09b2696f3?s=128&d=identicon&r=PG", "display_name": "Isaac Kleinman", "link": "https://stackoverflow.com/users/758494/isaac-kleinman"}, "edited": false, "score": 0, "creation_date": 1561443257, "post_id": 56738600, "comment_id": 100053740, "body": "@IsaacKleinman I updated the code with inject-gopath, and other variables"}], "answers": [{"tags": [], "owner": {"reputation": 2724, "user_id": 758494, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0a60a9c9c5193d41019fa3e09b2696f3?s=128&d=identicon&r=PG", "display_name": "Isaac Kleinman", "link": "https://stackoverflow.com/users/758494/isaac-kleinman"}, "is_accepted": false, "score": 0, "last_activity_date": 1561390061, "last_edit_date": 1561390061, "creation_date": 1561389715, "answer_id": 56739668, "question_id": 56738600, "link": "https://stackoverflow.com/questions/56738600/go-mod-is-downloading-well-but-golint-is-failing-on-supposed-downloaded-depende/56739668#56739668", "title": "Go mod is downloading well, but golint is failing on supposed downloaded dependencies", "body": "<p>Gitlab interprets all paths as relative to the project root, so if your project is <code>myproject</code>, <code>$GOPATH/pkg/mod/</code> translates to <code>myproject/$GOPATH/pkg/mod/</code>, but the location where the go tool actually actually installs the packages is <code>/$GOPATH/pkg/mod/</code> (directly under root). </p>\n\n<p>You can work around this by setting the GOPATH to a location within the project directory; e.g. </p>\n\n<pre><code>export GOPATH=\"$CI_PROJECT_DIR/pkg/mod\"\n</code></pre>\n\n<p>Then, you can use this path throughout your pipeline.</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 426, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561443239, "creation_date": 1561386096, "last_edit_date": 1561443239, "question_id": 56738600, "link": "https://stackoverflow.com/questions/56738600/go-mod-is-downloading-well-but-golint-is-failing-on-supposed-downloaded-depende", "title": "Go mod is downloading well, but golint is failing on supposed downloaded dependencies", "body": "<p>In Gitlab CI, I need to specify <code>GITLAB_DEPLOY_TOKEN</code>, as I have some private repositories. This works well for compile step.</p>\n\n<p>But when I execute golint, it will download again all dependencies, and it will fail on private ones. I could add the same <code>git config</code> directive, </p>\n\n<p>image: golang\nvariables:\n  PACKAGE_PATH: /go/src/gitlab.com/company/sam/daemon\n  PACKAGE_API_NAME: registry.gitlab.com/company/sam/daemon\n  REGISTRY_URL: <a href=\"https://registry.gitlab.com\" rel=\"nofollow noreferrer\">https://registry.gitlab.com</a>\n  DOCKER_DRIVER: overlay\n  GO111MODULE: \"on\"</p>\n\n<p>.anchors:\n  - &amp;inject-gopath\n      mkdir -p $(dirname ${PACKAGE_PATH})\n      &amp;&amp; ln -s ${CI_PROJECT_DIR} ${PACKAGE_PATH}\n      &amp;&amp; cd ${PACKAGE_PATH}</p>\n\n<pre><code>compile:\n  stage: build\n  before_script:\n    - *inject-gopath\n    - git config --global url.\"https://oauth:${GITLAB_DEPLOY_TOKEN}@gitlab.com\".insteadOf https://gitlab.com\n    - go mod tidy\n  script: GOOS=linux GOARCH=arm GOARM=7 go build -o release/daemon .\n  artifacts:\n    name: \"binary-$CI_PIPELINE_ID\"\n    paths:\n      - $GOPATH/pkg/mod/\n    expire_in: 1 hour\n\nlint:\n  stage: test\n  before_script:\n    - apt install -y curl git\n    - go get github.com/golang/lint\n    - *inject-gopath\n  script:\n    - $GOPATH/bin/golint -set_exit_status $(go list ./...)\n  allow_failure: true\n</code></pre>\n\n<p>I read <a href=\"https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang\">here</a> that go modules were cached in <code>$GOPATH/pkg/mod</code> but it doesn't seem to work</p>\n\n<p>Any idea how should I fix it ?</p>\n"}, {"tags": ["json", "go", "memory-management", "slice", "httpserver"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1561382734, "post_id": 56737363, "comment_id": 100033855, "body": "Don&#39;t build a JSON array of hundred thousand objects in memory. Use <code>json.NewEncoder()</code>, and stream the result to the HTTP response (see <a href=\"https://stackoverflow.com/questions/55021403/ouput-json-to-http-responsewriter-with-template/55021498#55021498\">example</a>). Sometimes doing something yourself and not relying on a framework helps big time."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1561383037, "post_id": 56737363, "comment_id": 100034028, "body": "Why would you expect this code not to use an immense amount of memory? You create a slice of 1e5 elements for a 0-len slice via append. Each time your backing array needs to grow you copy. That <code>users = nil</code> is just snake oil. Just don&#39;t <i>use</i> memory. Start with icza&#39;s advice."}, {"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1561384556, "post_id": 56737363, "comment_id": 100034940, "body": "@icza thanks a lot, I will try your solution."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1561492657, "post_id": 56750509, "comment_id": 100079765, "body": "Thank you very much for these explanations, that&#39;s exactly what I needed :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1561497820, "post_id": 56750509, "comment_id": 100081619, "body": "@FabienBellanger Would be nice if you&#39;d share your performance test results with this version."}, {"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1561536654, "post_id": 56750509, "comment_id": 100092000, "body": "Yes, of course. With initial version, memory increase to 3.1Go with 10 simultaneous requests. But with @icza version, 10 simultaneous requests only take 10Mo and it remains stable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1561536903, "post_id": 56750509, "comment_id": 100092135, "body": "@FabienBellanger Good \ud83d\ude03 Thanks."}, {"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1561536951, "post_id": 56750509, "comment_id": 100092149, "body": "I&#39;m a little disappointed by the performance of Go (1.12) + Echo compared to PHP (7.3) + Lumen. For the same route, Lumen is three times faster than Echo (2s vs. 6s)."}, {"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1564517470, "post_id": 56750509, "comment_id": 101055236, "body": "it works well if I don&#39;t have to process the data. If, for example, I get 100,000 lines from the database. And then I need to process them to return a JSON with several levels. In this case, I am obliged to create an array or map. But the problem is that memory is never released. And it increases with each request and it is even worse in the case of parallel requests."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1564554921, "post_id": 56750509, "comment_id": 101064289, "body": "@FabienBellanger Even if you have to process the objects, you can process them one-by-one, and send the processed result, again, one-by-one."}, {"owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "edited": false, "score": 0, "creation_date": 1564575072, "post_id": 56750509, "comment_id": 101075352, "body": "thanks for your response. For PHP developers, interstanding Go&#39;s memory management is not easy :) In the example I added in my initial answer, I do not see how I can not pass to a map with all the data. I have the correct map of DataApplicationType structure only at the end. So I could send application by application with your solution, but the variable data seems no to be released by the GC. Sorry, I&#39;m newbie with Go :("}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1561454325, "last_edit_date": 1561454325, "creation_date": 1561453809, "answer_id": 56750509, "question_id": 56737363, "link": "https://stackoverflow.com/questions/56737363/memory-consumption-with-large-array-with-echo-or-gin-framework/56750509#56750509", "title": "Memory consumption with large array with Echo or Gin framework", "body": "<p>Allocated memory isn't immediately returned back to the OS, see <a href=\"https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Cannot free memory once occupied by bytes.Buffer</a>; and <a href=\"https://stackoverflow.com/questions/45509538/freeing-unused-memory/45509642#45509642\">Freeing unused memory?</a></p>\n\n<p>Your answer gives little improvement, because you are still building the (Go) array (or rather slice) in memory, and once it's done, only then you proceed to marshal it into the response. You also create a new encoder for each item, you marshal a single item and you just throw it away. You may use <code>json.Encoder</code> to marshal multiple items. You also flush the response after each item, that's also terribly inefficient. That defeats the purpose of all internal buffering...</p>\n\n<p>Instead you may marshal them as soon as an item (<code>User</code>) is ready, so you don't have to keep all in memory. And don't flush after every user, it's enough to do it once in the end, which isn't necessary as once you return from the handler, the server will flush all buffered data.</p>\n\n<p>Do it something like this:</p>\n\n<pre><code>e.GET(\"/\", func(c echo.Context) error {\n    c.Response().WriteHeader(http.StatusOK)\n\n    enc := json.NewEncoder(c.Response())\n    for i := 0; i &lt; 100000; i++ {\n        user := User{\n            Username:  \"ffgfgfghhfghfhgfgfhgfghfghfhgfhgfh\" + strconv.Itoa(i),\n            Password:  \"gjgjghjgjhgjhghjfrserhkhjhklljjkbhjvftxersgdghjjkhkljkbhfd\",\n            Lastname:  \"njuftydfhgjkjlkjlkjlkhjkhu\",\n            Firstname: \"jkggkjkl,,lm,kljkvgf\",\n        }\n        if err := enc.Encode(user); err != nil {\n            return err\n        }\n    }\n\n    return nil\n})\n</code></pre>\n\n<p>One thing to note here: the above code does not send a JSON array to the output, it sends a series of JSON objects. If this is not suitable to you and you do need to send a single JSON array, simply \"frame\" the data and insert a comma between items:</p>\n\n<pre><code>e.GET(\"/\", func(c echo.Context) error {\n    resp := c.Response()\n    resp.WriteHeader(http.StatusOK)\n\n    if _, err := io.WriteString(resp, \"[\"); err != nil {\n        return err\n    }\n    enc := json.NewEncoder(resp)\n    for i := 0; i &lt; 100000; i++ {\n        if i &gt; 0 {\n            if _, err := io.WriteString(resp, \",\"); err != nil {\n                return err\n            }\n        }\n        user := User{\n            Username:  \"ffgfgfghhfghfhgfgfhgfghfghfhgfhgfh\" + strconv.Itoa(i),\n            Password:  \"gjgjghjgjhgjhghjfrserhkhjhklljjkbhjvftxersgdghjjkhkljkbhft\",\n            Lastname:  \"njuftydfhgjkjlkjlkjlkhjkhu\",\n            Firstname: \"jkggkjkl,,lm,kljkvgf\",\n        }\n        if err := enc.Encode(user); err != nil {\n            return err\n        }\n    }\n    if _, err := io.WriteString(resp, \"]\"); err != nil {\n        return err\n    }\n\n    return nil\n})\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11491935, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VZNbos7Rdc/AAAAAAAAAAI/AAAAAAAAA34/LZZZDp70Xsg/photo.jpg?sz=128", "display_name": "Fabien Bellanger", "link": "https://stackoverflow.com/users/11491935/fabien-bellanger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 0, "accepted_answer_id": 56750509, "answer_count": 1, "score": -4, "last_activity_date": 1564512972, "creation_date": 1561381953, "last_edit_date": 1564512972, "question_id": 56737363, "link": "https://stackoverflow.com/questions/56737363/memory-consumption-with-large-array-with-echo-or-gin-framework", "title": "Memory consumption with large array with Echo or Gin framework", "body": "<p>I have a memory problem when I try to send a large array with Echo (and Gin too).\nAfter the request, memory is not free.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n    \"strconv\"\n\n    \"github.com/labstack/echo\"\n)\n\ntype User struct {\n    Username  string\n    Password  string\n    Lastname  string\n    Firstname string\n}\n\nfunc main() {\n    e := echo.New()\n    e.GET(\"/\", func(c echo.Context) error {\n        var user User\n        users := make([]User, 0)\n\n        for i := 0; i &lt; 100000; i++ {\n            user = User{\n                Username:  \"ffgfgfghhfghfhgfgfhgfghfghfhgfhgfh\" + strconv.Itoa(i),\n                Password:  \"gjgjghjgjhgjhghjfrserhkhjhklljjkbhjvftxersgdghjjkhkljkbhftd\",\n                Lastname:  \"njuftydfhgjkjlkjlkjlkhjkhu\",\n                Firstname: \"jkggkjkl,,lm,kljkvgf\"}\n\n            users = append(users, user)\n        }\n\n        defer func() {\n            users = nil\n        }()\n        return c.JSON(http.StatusOK, users)\n    })\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n\n</code></pre>\n\n<p>To test, I run request in parallel and I have these results :</p>\n\n<ul>\n<li>1 request : 300Mo</li>\n<li>5 requests : 1.5Go</li>\n<li>10 requests : 3.1Go</li>\n<li>more : my PC freeze :)</li>\n</ul>\n\n<p>How can I reduce memory consumption?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>It works well if I don't have to process the data.<br>\nIf, for example, I get 100,000 lines from the database.\nAnd then I need to process them to return a JSON with several levels. In this case, I am obliged to create an array or map.<br>\nBut the problem is that memory is never released. And it increases with each request and it is even worse in the case of parallel requests.</p>\n\n<p>Here an example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"strconv\"\n    \"time\"\n)\n\ntype sqlDataType struct {\n    ApplicationID        int\n    ApplicationName      string\n    ApplicationCreatedAt time.Time\n    ApplicationUpdatedAt time.Time\n    ModuleID             int\n    ModuleName           string\n    ModuleCreatedAt      time.Time\n    ModuleUpdatedAt      time.Time\n    ActionID             int\n    ActionName           string\n    ActionCreatedAt      time.Time\n    ActionUpdatedAt      time.Time\n}\n\ntype DataApplicationType struct {\n    Name      string\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    Modules   map[int]dataModuleType\n}\n\ntype dataModuleType struct {\n    Name      string\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    Actions   map[int]dataActionType\n}\n\ntype dataActionType struct {\n    Name      string\n    CreatedAt time.Time\n    UpdatedAt time.Time\n}\n\n// InitData inits data for test\nfunc InitData() map[int]DataApplicationType {\n    data := make(map[int]DataApplicationType)\n\n    const nbApplications = 10\n    const nbModules = 1000\n    const nbActions = 100000\n\n    sqlData := make([]sqlDataType, 0)\n    for i := 0; i &lt; nbActions; i++ {\n        line := sqlDataType{\n            ApplicationID:        (i % nbApplications) + 1,\n            ApplicationName:      \"Application \" + strconv.Itoa((i%nbApplications)+1),\n            ApplicationCreatedAt: time.Now(),\n            ApplicationUpdatedAt: time.Now(),\n            ModuleID:             (i % nbModules) + 1,\n            ModuleName:           \"Module \" + strconv.Itoa((i%nbModules)+1),\n            ModuleCreatedAt:      time.Now(),\n            ModuleUpdatedAt:      time.Now(),\n            ActionID:             i + 1,\n            ActionName:           \"Action \" + strconv.Itoa(i+1),\n            ActionCreatedAt:      time.Now(),\n            ActionUpdatedAt:      time.Now(),\n        }\n\n        sqlData = append(sqlData, line)\n    }\n\n    nbData := len(sqlData)\n    for i := 0; i &lt; nbData; i++ {\n        if _, ok := data[sqlData[i].ApplicationID]; !ok {\n            dac := new(dataActionType)\n            dac.Name = sqlData[i].ActionName\n            dac.CreatedAt = sqlData[i].ActionCreatedAt\n            dac.UpdatedAt = sqlData[i].ActionUpdatedAt\n\n            dmo := new(dataModuleType)\n            dmo.Name = sqlData[i].ModuleName\n            dmo.CreatedAt = sqlData[i].ModuleCreatedAt\n            dmo.UpdatedAt = sqlData[i].ModuleUpdatedAt\n            dmo.Actions = make(map[int]dataActionType)\n            dmo.Actions[sqlData[i].ActionID] = *dac\n\n            dap := new(DataApplicationType)\n            dap.Name = sqlData[i].ApplicationName\n            dap.CreatedAt = sqlData[i].ApplicationCreatedAt\n            dap.UpdatedAt = sqlData[i].ApplicationUpdatedAt\n            dap.Modules = make(map[int]dataModuleType)\n            dap.Modules[sqlData[i].ModuleID] = *dmo\n\n            data[sqlData[i].ApplicationID] = *dap\n        }\n\n        if _, ok := data[sqlData[i].ApplicationID].Modules[sqlData[i].ModuleID]; !ok {\n            dac := new(dataActionType)\n            dac.Name = sqlData[i].ActionName\n            dac.CreatedAt = sqlData[i].ActionCreatedAt\n            dac.UpdatedAt = sqlData[i].ActionUpdatedAt\n\n            dmo := new(dataModuleType)\n            dmo.Name = sqlData[i].ModuleName\n            dmo.CreatedAt = sqlData[i].ModuleCreatedAt\n            dmo.UpdatedAt = sqlData[i].ModuleUpdatedAt\n            dmo.Actions = make(map[int]dataActionType)\n            dmo.Actions[sqlData[i].ActionID] = *dac\n\n            data[sqlData[i].ApplicationID].Modules[sqlData[i].ModuleID] = *dmo\n        }\n\n        if _, ok := data[sqlData[i].ApplicationID].Modules[sqlData[i].ModuleID].Actions[sqlData[i].ActionID]; !ok {\n            dac := new(dataActionType)\n            dac.Name = sqlData[i].ActionName\n            dac.CreatedAt = sqlData[i].ActionCreatedAt\n            dac.UpdatedAt = sqlData[i].ActionUpdatedAt\n\n            data[sqlData[i].ApplicationID].Modules[sqlData[i].ModuleID].Actions[sqlData[i].ActionID] = *dac\n        }\n    }\n\n    return data\n}\n</code></pre>\n\n<p>In the main.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    // Lancement de Cobra\n    // commands.Execute()\n    go issues.InitData()\n    go issues.InitData()\n    go issues.InitData()\n    go issues.InitData()\n    go issues.InitData()\n\n    time.Sleep(60 * time.Second)\n}\n</code></pre>\n\n<p>This script needs around 500 Mo of memory and does not release it whereas the map hasn't even been transformed into JSON.</p>\n\n<p>How can I reduce memory consumption and/or I can have a stable memory consumption state with many calls?</p>\n\n<p>Thanks for you help</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1561378433, "post_id": 56736305, "comment_id": 100031347, "body": "Related / possible duplicate: <a href=\"https://stackoverflow.com/questions/50287664/why-is-time-parse-not-using-the-timezone/50287766#50287766\">Why is time.Parse not using the timezone?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "edited": false, "score": 0, "creation_date": 1561399333, "post_id": 56737272, "comment_id": 100042492, "body": "Okay, but we still don`t know which locations time zones have same issue. Because the same code has to be executed in many places and what if we hit the same issue. To avoid this, i planned to take it from time.Zone() itself but again it is not helping. The above solution solves IST issue as we know the exact term . So we need it to find out with help of system time itself. So any way to do so."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "edited": false, "score": 0, "creation_date": 1561445891, "post_id": 56737272, "comment_id": 100054865, "body": "@kish I don&#39;t understand what you mean."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1561381604, "creation_date": 1561381604, "answer_id": 56737272, "question_id": 56736305, "link": "https://stackoverflow.com/questions/56736305/ist-time-zone-error-in-time-package-go-golang/56737272#56737272", "title": "IST time zone error in time package go golang", "body": "<p>You can't load Indian IST time zone by that name because the name \"IST\" is ambiguous. It could mean India, Ireland, Israel, etc. time zones, which have different zone offsets and rules. For details, see <a href=\"https://stackoverflow.com/questions/50287664/why-is-time-parse-not-using-the-timezone/50287766#50287766\">Why is time.Parse not using the timezone?</a></p>\n\n<p>If IST is your local zone, the <a href=\"https://golang.org/pkg/time/#Location\" rel=\"nofollow noreferrer\"><code>time.Local</code></a> variable will denote that time zone. If you have a <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a>, you can \"switch\" to another zone using <a href=\"https://golang.org/pkg/time/#Time.In\" rel=\"nofollow noreferrer\"><code>Time.In()</code></a>, also <a href=\"https://golang.org/pkg/time/#Time.Local\" rel=\"nofollow noreferrer\"><code>Time.Local()</code></a> returns the time in your local zone.</p>\n\n<p>Of course this code would \"break\" when ran in another zone. To make sure it behaves the same everywhere, load the Indian IST zone explicitly like this:</p>\n\n<pre><code>loc, err := time.LoadLocation(\"Asia/Kolkata\")\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(time.Now())\nfmt.Println(time.Now().In(loc))\n</code></pre>\n\n<p>On the <a href=\"https://play.golang.org/p/JBxQWNY3ySf\" rel=\"nofollow noreferrer\">Go Playground</a> it will output:</p>\n\n<pre><code>2009-11-10 23:00:00 +0000 UTC m=+0.000000001\n2009-11-11 04:30:00 +0530 IST\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1017, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561381604, "creation_date": 1561378324, "last_edit_date": 1561378842, "question_id": 56736305, "link": "https://stackoverflow.com/questions/56736305/ist-time-zone-error-in-time-package-go-golang", "title": "IST time zone error in time package go golang", "body": "<p>I need to convert any given time zone in RFC3339 format to system time in RFC3339 format.But for few time zone like IST it is throwing the error and the time is still in UTC.\nFor conversion which function service as better? time.parse or time.In.</p>\n\n<p>I tried to convert the UTC to IST but it failed. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    //now time\n    now := time.Now()\n    fmt.Println(\"now \", now)\n    zone, _ := now.Zone()\n    fmt.Println(\"zone-&gt;\", zone)\n\n    ll, llerr := time.LoadLocation(zone)\n    fmt.Println(\"Load Location\", ll, llerr)\n    // Convert the given time to system based time zone\n    t, err := time.ParseInLocation(time.RFC3339, \"2017-04-25T23:03:00Z\", ll)\n    fmt.Println(\"t - parsein\", t)\n    fmt.Println(\"err - parsein\", err)\n    //fmt.Println(\"t2 - parse\", t.In(ll))\n\n}\n</code></pre>\n\n<p>Error : <code>unknown time zone IST</code></p>\n\n<p>Expected: Need to convert any time zone to system time zone.</p>\n"}, {"tags": ["go", "primary-key", "go-gorm", "cockroachdb"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1561377550, "creation_date": 1561377550, "answer_id": 56736081, "question_id": 56735451, "link": "https://stackoverflow.com/questions/56735451/issue-while-creating-primary-key-from-gorm-model/56736081#56736081", "title": "Issue while creating primary key from gorm model", "body": "<p>Gorm uses <a href=\"https://gorm.io/docs/conventions.html#ID-as-Primary-Key\" rel=\"nofollow noreferrer\"><code>ID</code></a> as the primary key by default. It is <a href=\"https://gorm.io/docs/conventions.html#gorm-Model\" rel=\"nofollow noreferrer\">part of</a> the <code>gorm.Model</code> you are embedding.</p>\n\n<p>When embedding the <code>gorm.Model</code>, you should leave <code>ID</code> out as gorm already includes it. The alternative is to remove the embedded <code>gorm.Model</code> and specify <code>ID</code> yourself.</p>\n\n<p>To quote the <a href=\"https://gorm.io/docs/conventions.html#gorm-Model\" rel=\"nofollow noreferrer\">gorm conventions</a> page:</p>\n\n<blockquote>\n  <p>gorm.Model is a basic GoLang struct which includes the following\n  fields: ID, CreatedAt, UpdatedAt, DeletedAt.</p>\n  \n  <p>It may be embeded into your model or you may build your own model\n  without it.</p>\n</blockquote>\n\n<p>The reasons this fails on schema creation as opposed to compilation is that a lot of databases (CockroachDB included) do case insensitive checking unless you quote the object names (<code>Id</code> matches <code>id</code>, but <code>\"Id\"</code> does not). This results in two separate column names that match when compared with case insensitivity.</p>\n"}], "owner": {"reputation": 91, "user_id": 2749349, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b628c9e15a1c7ae7115ba12c3df62862?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Habib", "link": "https://stackoverflow.com/users/2749349/muhammad-habib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 56736081, "answer_count": 1, "score": 0, "last_activity_date": 1561377550, "creation_date": 1561375124, "last_edit_date": 1561375502, "question_id": 56735451, "link": "https://stackoverflow.com/questions/56735451/issue-while-creating-primary-key-from-gorm-model", "title": "Issue while creating primary key from gorm model", "body": "<p>While creating primary key from gorm model it return with error \u201cduplicate column name: \u201cid\u201d\u201d</p>\n\n<p>my model looks like </p>\n\n<pre><code>type User struct { \ngorm.Model \nId string gorm:\"primary_key;\" \nFirstName string \nLastName string \n}\n</code></pre>\n\n<p>any idea what is the issue with above model </p>\n"}, {"tags": ["go", "sigterm"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1561373823, "post_id": 56735056, "comment_id": 100028939, "body": "Your &quot;infinite&quot; loop could monitor the <code>sigChan</code> and &quot;break&quot; once a value is received from it. What&#39;s wrong with that?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561374527, "post_id": 56735056, "comment_id": 100029316, "body": "Side note: make a chan with cap 1 for your signals."}, {"owner": {"reputation": 549, "user_id": 3653092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QtVYm.jpg?s=128&g=1", "display_name": "Cae Vecchi", "link": "https://stackoverflow.com/users/3653092/cae-vecchi"}, "edited": false, "score": 0, "creation_date": 1561378618, "post_id": 56735056, "comment_id": 100031461, "body": "The example is for visualisation only, I have no control over the infinite loop, I&#39;m trying to implement this on an internal library."}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 1, "last_activity_date": 1561378746, "creation_date": 1561378746, "answer_id": 56736440, "question_id": 56735056, "link": "https://stackoverflow.com/questions/56735056/golang-catch-sigterm-and-continue-application/56736440#56736440", "title": "Golang catch sigterm and continue application", "body": "<p>This is very easy to achieve. Because the signal channel needs to block and wait for a signal, you have to start your business logic code in a different goroutine.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    cancelChan := make(chan os.Signal, 1)\n    // catch SIGETRM or SIGINTERRUPT\n    signal.Notify(cancelChan, syscall.SIGTERM, syscall.SIGINT)\n    go func() {\n        // start your software here. Maybe your need to replace the for loop with other code\n        for {\n            // replace the time.Sleep with your code\n            log.Println(\"Loop tick\")\n            time.Sleep(time.Second)\n        }\n    }()\n    sig := &lt;-cancelChan\n    log.Printf(\"Caught SIGTERM %v\", sig)\n    // shutdown other goroutines gracefully\n    // close other resources\n}\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 3653092, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QtVYm.jpg?s=128&g=1", "display_name": "Cae Vecchi", "link": "https://stackoverflow.com/users/3653092/cae-vecchi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1152, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561378746, "creation_date": 1561373627, "question_id": 56735056, "link": "https://stackoverflow.com/questions/56735056/golang-catch-sigterm-and-continue-application", "title": "Golang catch sigterm and continue application", "body": "<p>Is it possible to catch a <code>sigterm</code> in Golang and move on on the code, like a panic/defer?</p>\n\n<p>Example: </p>\n\n<pre><code>func main() {\n    fmt.Println(\"app started\")\n    setupGracefulShutdown()\n\n    for {\n    }\n    close()    \n}\n\nfunc close() {\n    fmt.Println(\"infinite loop stopped and got here\")\n}\n\nfunc setupGracefulShutdown() {\n    sigChan := make(chan os.Signal)\n    signal.Notify(sigChan, os.Interrupt, syscall.SIGTERM)\n\n    go func() {\n        fmt.Println(\" got interrupt signal: \", &lt;-sigChan)\n    }()\n}\n\n// \"app started\"\n// CTRL + C\n// ^C \"got interrupt signal:  interrupt\"\n// app don't stop\n</code></pre>\n\n<p>What I want is to print <code>infinite loop stopped and got here</code> and finish application.</p>\n\n<pre><code>// \"app started\"\n// CTRL + C\n// ^C \"got interrupt signal:  interrupt\"\n// \"infinite loop stopped and got here\"\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 1, "creation_date": 1561370947, "post_id": 56734286, "comment_id": 100027552, "body": "Note that order-dependent tests are a smell."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1561370991, "post_id": 56734286, "comment_id": 100027576, "body": "Usually if something is not document means you can&#39;t rely on that. And if something is not documented, it means the implementor wishes to keep freedom to change it at his/her own pleasure."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561371076, "post_id": 56734286, "comment_id": 100027618, "body": "You cannot rely on this a I may chose to run just a <i>subset</i> of the tests with the <code>- run</code> flag."}, {"owner": {"reputation": 33, "user_id": 8278332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a462d40f229c4be267e6ed4005137a3?s=128&d=identicon&r=PG&f=1", "display_name": "Real Mind", "link": "https://stackoverflow.com/users/8278332/real-mind"}, "edited": false, "score": 0, "creation_date": 1561371226, "post_id": 56734286, "comment_id": 100027685, "body": "someone tell that to my organization"}], "owner": {"reputation": 33, "user_id": 8278332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a462d40f229c4be267e6ed4005137a3?s=128&d=identicon&r=PG&f=1", "display_name": "Real Mind", "link": "https://stackoverflow.com/users/8278332/real-mind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 25, "favorite_count": 0, "closed_date": 1561370930, "answer_count": 0, "score": 0, "last_activity_date": 1561370846, "creation_date": 1561370846, "question_id": 56734286, "link": "https://stackoverflow.com/questions/56734286/do-test-functions-inside-test-go-file-run-in-order-of-declaration", "closed_reason": "Duplicate", "title": "Do Test Functions inside _test.go file run in order of declaration", "body": "<p>Everytime i run the tests they run in order of declaration, is this guaranteed ?\notherwise how can i ensure a particular test function runs before all others.</p>\n"}, {"tags": ["go", "apache-kafka", "confluent-platform", "librdkafka"], "comments": [{"owner": {"reputation": 2288, "user_id": 1821055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4031acff2994243c56d92f9fd4a8e3bb?s=128&d=identicon&r=PG", "display_name": "Edenhill", "link": "https://stackoverflow.com/users/1821055/edenhill"}, "edited": false, "score": 0, "creation_date": 1561407503, "post_id": 56734181, "comment_id": 100045722, "body": "Are you calling Poll() or ReadMessage() with a timeout longer than the max.poll.interval.ms? If so, you&#39;re probably hitting an issue in librdkafka which is fixed in librdkafka v1.1.0."}, {"owner": {"reputation": 293, "user_id": 4607015, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/lWkYD.jpg?s=128&g=1", "display_name": "esquarer", "link": "https://stackoverflow.com/users/4607015/esquarer"}, "reply_to_user": {"reputation": 2288, "user_id": 1821055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4031acff2994243c56d92f9fd4a8e3bb?s=128&d=identicon&r=PG", "display_name": "Edenhill", "link": "https://stackoverflow.com/users/1821055/edenhill"}, "edited": false, "score": 0, "creation_date": 1561448221, "post_id": 56734181, "comment_id": 100055958, "body": "@Edenhill No, I&#39;m calling <code>Poll()</code> with a timeout of 100 ms"}, {"owner": {"reputation": 108, "user_id": 2902298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/195f9c7d2e21dfb16510965b8b29861b?s=128&d=identicon&r=PG&f=1", "display_name": "Sawood", "link": "https://stackoverflow.com/users/2902298/sawood"}, "edited": false, "score": 0, "creation_date": 1603530247, "post_id": 56734181, "comment_id": 114070979, "body": "Hi @esquarer did you find solution, please let me know am facing same the issue."}], "answers": [{"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 0, "last_activity_date": 1613876835, "creation_date": 1613876835, "answer_id": 66298763, "question_id": 56734181, "link": "https://stackoverflow.com/questions/56734181/kafka-consumer-gets-stuck-after-exceeding-max-poll-interval-ms/66298763#66298763", "title": "Kafka consumer gets stuck after exceeding max.poll.interval.ms", "body": "<p>It looks like this is a reported issue to the confluent-kafka-go client: <a href=\"https://github.com/confluentinc/confluent-kafka-go/issues/344\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/issues/344</a></p>\n<p>It is marked as resolved by this change which should have been released in librdkafka version 1.1.0: <a href=\"https://github.com/edenhill/librdkafka/commit/80e9b1ee0c0e477c02f18b130c4302240711a88d\" rel=\"nofollow noreferrer\">https://github.com/edenhill/librdkafka/commit/80e9b1ee0c0e477c02f18b130c4302240711a88d</a></p>\n<p>It looks like that change should also have been released in confluent-kafka-go version 1.1.0: <a href=\"https://github.com/confluentinc/confluent-kafka-go/tree/v1.1.0\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/tree/v1.1.0</a></p>\n<p>Some comments in the issue still report that this is an issue experiences on versions &gt;1.1.0.</p>\n<p>A commenter suggests a work around:</p>\n<blockquote>\n<p>Using v1.5.2. Also calling ReadMessage(-1) in an infinite loop, and not seeing rejoining after consumer leaving group, worked around it by setting timeout to be less than max.poll.interval.ms instead of -1, but wondering why it's not rejoining as expected.</p>\n</blockquote>\n<p><a href=\"https://github.com/confluentinc/confluent-kafka-go/issues/344#issuecomment-745014864\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/issues/344#issuecomment-745014864</a></p>\n"}], "owner": {"reputation": 293, "user_id": 4607015, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/lWkYD.jpg?s=128&g=1", "display_name": "esquarer", "link": "https://stackoverflow.com/users/4607015/esquarer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2739, "favorite_count": 1, "answer_count": 1, "score": 9, "last_activity_date": 1613876835, "creation_date": 1561370436, "last_edit_date": 1561864212, "question_id": 56734181, "link": "https://stackoverflow.com/questions/56734181/kafka-consumer-gets-stuck-after-exceeding-max-poll-interval-ms", "title": "Kafka consumer gets stuck after exceeding max.poll.interval.ms", "body": "<p>When the consumer does not receives a message for 5 mins (default value of max.poll.interval.ms 300000ms) the consumer comes to a halt without exiting the program. The consumer process hangs and does not consume any more messages.</p>\n\n<p>The following error message gets logged</p>\n\n<pre><code>MAXPOLL|rdkafka#consumer-1| [thrd:main]: Application maximum poll interval (300000ms) exceeded by 255ms (adjust max.poll.interval.ms for long-running message processing): leaving group\n</code></pre>\n\n<p>I see that <code>ErrMaxPollExceeded</code> is defined <a href=\"https://github.com/confluentinc/confluent-kafka-go/blob/aba1d4b9ad6802580e1fa7015a7137af6a3e2893/kafka/generated_errors.go#L123-L124\" rel=\"noreferrer\">here</a> in confluent-kafka-go but unable to find where it is getting raised.</p>\n\n<p>If any such error is raised, why does the program not exit ?</p>\n\n<ul>\n<li>Kafka v1.1.0</li>\n<li>librdkafka v1.0.0</li>\n<li>confluent-kafka-go (master)</li>\n</ul>\n\n<p>Config used for kafka.Consumer</p>\n\n<pre><code>{\n    \"bootstrap.servers\":    \"private.kafka.host\",\n    \"group.id\":             \"foo.bar\",\n    \"auto.offset.reset\":    \"earliest\",\n    \"enable.auto.commit\":   false,\n}\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 1053, "user_id": 1061664, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/zGsvQ.jpg?s=128&g=1", "display_name": "Girish Gupta", "link": "https://stackoverflow.com/users/1061664/girish-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1561387176, "creation_date": 1561387176, "answer_id": 56738928, "question_id": 56732843, "link": "https://stackoverflow.com/questions/56732843/synchronisation-issues-in-go-routine-channel/56738928#56738928", "title": "synchronisation issues in go routine channel", "body": "<p>This is fixed just by replacing default with a select on a channel(<code>vodToLive.Out</code>) and adding 4 seconds wait in <code>case &lt;-loopEnd</code></p>\n\n<pre><code>go func(childURLSlug string) {\n    for {\n        for {\n            select {\n            //If video reaches end of stream then restart stream from Sequence #1\n            case &lt;-loopEnd:\n                vodToLive.SequenceNumber = 1\n                // so this will ensure that next stream starts only when first is complete.\n                time.Sleep(4 * time.Second) //Usually a ts is 4 seconds length.\n                vodToLive.CurrentStream = \"\"\n                break\n\n            case res := &lt;-vodToLive.Out:\n                outputString := res\n                fmt.Println(outputString)\n                vodToLive.CurrentStream = vodToLive.CurrentStream + outputString\n\n            }\n        }\n    }\n}(childURLSlug)\n</code></pre>\n"}], "owner": {"reputation": 1053, "user_id": 1061664, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/zGsvQ.jpg?s=128&g=1", "display_name": "Girish Gupta", "link": "https://stackoverflow.com/users/1061664/girish-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561387176, "creation_date": 1561365740, "question_id": 56732843, "link": "https://stackoverflow.com/questions/56732843/synchronisation-issues-in-go-routine-channel", "title": "synchronisation issues in go routine channel", "body": "<p>I am trying to write a proxy server where I will convert a video file to live stream. A vod file consists for multiple child manifest files of different bit rates. each child manifest consist of multiple ts segments say 4 second each.for simplicity I have created a dummy map of 2 child manifests containing 4 ts segments each. My task is to create an live stream infinitely in for loop. so I am sending each ts segment after 4 seconds in go routine and writing to channel and I have one more go routine where I am reading from this go routine and writing to output string. once all segments are over I am updating to <code>loopEnd</code> channel and start again. There are 2 APIs for different bit rates that gives me new ts after each 4 seconds.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gin-contrib/gzip\"\n    \"github.com/gin-gonic/gin\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    vodToLiveMap := convertVodToLive()\n    engine := gin.Default()\n    engine.Use(gzip.Gzip(gzip.DefaultCompression))\n    engine.GET(\"/134200\", func(gctx *gin.Context) {\n        prepareResponse(gctx, \"134200\", vodToLiveMap)\n    })\n\n    engine.GET(\"/290400\", func(gctx *gin.Context) {\n        prepareResponse(gctx, \"290400\", vodToLiveMap)\n    })\n    engine.Run() // listen and serve on 0.0.0.0:8080\n}\n\n// this represents one ulr for http live stream\ntype hlsEntry struct {\n    timeCode int    // timecode in microseconds\n    body     string // string including transport segment URL, timecode\n}\n\ntype VodToLive struct {\n    SequenceNumber int\n    Out            chan string\n    CurrentStream  string\n}\n\nfunc convertVodToLive() sync.Map {\n    var hlsEntriesBitrate1 = []hlsEntry{\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer1_001.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer1_002.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer1_003.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer1_004.ts\\n\",\n        },\n    }\n\n    var hlsEntriesBitrate2 = []hlsEntry{\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer2_001.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer2_002.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer2_003.ts\\n\",\n        },\n        {\n            timeCode: 4000000,\n            body:     \"#EXTINF:4.00000,\\n/master_Layer2_004.ts\\n\",\n        },\n    }\n    fmt.Println(hlsEntriesBitrate2)\n    var hlsEntriesMap = make(map[string][]hlsEntry)\n    hlsEntriesMap[\"134200\"] = hlsEntriesBitrate1\n    hlsEntriesMap[\"290400\"] = hlsEntriesBitrate2\n    outputString := \"\"\n    vodToLiveMap := sync.Map{}\n    i := 0\n    //Iterate for all child manifest files of different bit rates\n    for childURLSlug := range hlsEntriesMap {\n        vodToLive := &amp;VodToLive{}\n        vodToLive.SequenceNumber = 1\n        vodToLive.Out = make(chan string)\n        vodToLiveMap.Store(childURLSlug, vodToLive)\n        loopEnd := make(chan bool)\n\n        //Writing to vodToLive for a childURLSlug\n        go func(childURLSlug string) {\n            for {\n                for _, entry := range hlsEntriesMap[childURLSlug] {\n                    select {\n                    case &lt;-time.After(time.Duration(entry.timeCode) * time.Microsecond):\n                        vodToLive.SequenceNumber++\n                        vodToLive.Out &lt;- entry.body\n                    }\n                }\n                loopEnd &lt;- true\n                fmt.Println(childURLSlug)\n            }\n        }(childURLSlug)\n\n        //Reading from vodToLive's Out channel for a childURLSlug to update CurrentStream\n        go func(childURLSlug string) {\n            for {\n                for {\n                    select {\n                    //If video reaches end of stream then restart stream from Sequence #1\n                    case &lt;-loopEnd:\n                        vodToLive.SequenceNumber = 1\n                        //time.Sleep(10 * time.Second)\n                        vodToLive.CurrentStream = \"\"\n                        break\n\n                    default:\n                        outputString = &lt;-vodToLive.Out\n                        fmt.Println(outputString)\n                        vodToLive.CurrentStream = vodToLive.CurrentStream + outputString\n\n                    }\n                }\n            }\n        }(childURLSlug)\n        i++\n    }\n    return vodToLiveMap\n}\n\nfunc prepareResponse(gctx *gin.Context, childURLSlug string, vodToLiveMap sync.Map) {\n\n    vodToLive, _ := vodToLiveMap.Load(childURLSlug)\n\n    gctx.Header(\"Content-Type\", \"application/x-mpegURL\")\n    response := `#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:4\n#EXT-X-MEDIA-SEQUENCE:` + \"1\" + \"\\n\" + vodToLive.(*VodToLive).CurrentStream\n\n    size := len(response)\n    if size &gt; 0 &amp;&amp; response[size-1] == '\\n' {\n        response = response[:size-1]\n    }\n    gctx.String(200, response)\n}\n//curl localhost:8080/134200\n//curl localhost:8080/290400\n</code></pre>\n\n<p>But problem here is that I am not getting all ts segments in curl request and sometimes even ts are not updated after the end of loop. I shows all 4 ts segments in each call but these should be reset after each endLoop. </p>\n"}, {"tags": ["go", "cloudkit-web-services"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561363522, "post_id": 56732247, "comment_id": 100023655, "body": "What do you mean &quot;the error&quot; you get? That&#39;s not an error. And it comes from the non-error path of your code. What were you expecting instead?"}], "answers": [{"tags": [], "owner": {"reputation": 357, "user_id": 456710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7936349c7fa108fc32ebd480d5eed82?s=128&d=identicon&r=PG&f=1", "display_name": "thstart", "link": "https://stackoverflow.com/users/456710/thstart"}, "is_accepted": true, "score": 3, "last_activity_date": 1561686553, "last_edit_date": 1561686553, "creation_date": 1561579922, "answer_id": 56780196, "question_id": 56732247, "link": "https://stackoverflow.com/questions/56732247/how-to-perform-cloudkit-server-to-server-authentication/56780196#56780196", "title": "How to perform CloudKit Server-to-Server authentication", "body": "<p>If anybody needs it here is a working solution. </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/ecdsa\"\n    \"crypto/rand\"\n    \"crypto/sha256\"\n    \"crypto/x509\"\n    \"encoding/asn1\"\n    \"encoding/base64\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"math/big\"\n    \"net/http\"\n    \"time\"\n)\n\nconst projectID = \"&lt;your ID&gt;\"\n\n//\nconst authKeyID = \"your ID\"\nconst path = \"https://api.apple-cloudkit.com\"\nconst version = \"1\"\nconst container = \"your container\"\nconst environment = \"development\"\nconst database = \"public\"\n\nconst privPEM = `-----BEGIN EC PRIVATE KEY-----\nyour privste key\n-----END EC PRIVATE KEY-----`\n\nconst pubPEM = `-----BEGIN PUBLIC KEY-----\nyour public key\n-----END PUBLIC KEY-----`\n\ntype ecdsaSignature struct {\n    R, S *big.Int\n}\n\nfunc main() {\n    t0 := time.Now().UTC()\n    t1 := time.Now().UTC()\n\n    // fmt.Printf(\"\\nprivate key:\\n\")\n    // https://golang.org/pkg/crypto/x509/#example_ParsePKIXPublicKey\n    privBlock, _ := pem.Decode([]byte(privPEM))\n    if privBlock == nil {\n        panic(\"failed to parse PEM block containing the public key\")\n    }\n\n    private_key, err := x509.ParseECPrivateKey(privBlock.Bytes)\n    if err != nil {\n        panic(\"failed to parse PEM block containing the public key\")\n    }\n\n    pubBlock, _ := pem.Decode([]byte(pubPEM))\n    if pubBlock == nil {\n        panic(\"failed to parse PEM block containing the public key\")\n    }\n\n    var public_key *ecdsa.PublicKey\n    public_k, err := x509.ParsePKIXPublicKey(pubBlock.Bytes)\n    if err != nil {\n        panic(\"failed to parse PEM block containing the public key\")\n    }\n    switch public_k1 := public_k.(type) {\n    case *ecdsa.PublicKey:\n        public_key = public_k1\n    default:\n        //return false\n    }\n    //////////\n    // Config\n    //////////\n    requestPath := \"/database/\" +\n        version + \"/\" +\n        container + \"/\" +\n        environment + \"/\" +\n        database + \"/\" +\n        \"records/query\"\n\n    requestBody := `{\"query\": {\"recordType\": \"&lt;your record type\"}}`\n\n    f := \"2006-01-02T15:04:05Z\"\n    requestDate := time.Now().UTC().Format(f)\n\n    h := sha256.New()\n    h.Write([]byte(requestBody))\n    b := h.Sum(nil)\n    hashedBody := base64.StdEncoding.EncodeToString(b)\n\n    rawPayload := requestDate + \":\" + hashedBody + \":\" + requestPath\n\n    signedSignature, err := SignMessage(private_key, []byte(rawPayload))\n    if err != nil {\n        fmt.Printf(\"SignMessage  error: %s\\n\", err.Error())\n    }\n\n    verify := VerifyMessage(public_key, []byte(rawPayload), signedSignature)\n    fmt.Printf(\"signature verification result: %t\\n\", verify)\n\n    requestSignature := base64.StdEncoding.EncodeToString(signedSignature)\n    url := path + requestPath\n\n    req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer([]byte(requestBody)))\n\n    req.Header.Add(\"content-type\", \"text/plain\")\n    req.Header.Add(\"X-Apple-CloudKit-Request-KeyID\", authKeyID)\n\n    req.Header.Add(\"X-Apple-CloudKit-Request-ISO8601Date\", requestDate)\n\n    req.Header.Add(\"X-Apple-CloudKit-Request-SignatureV1\", requestSignature)\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        fmt.Printf(\"\\nresp.err:%v\\n\", err.Error())\n\n    }\n\n    defer resp.Body.Close()\n    rbody, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        fmt.Printf(\"\\nioutil.ReadAll.err:%v\\n\", err.Error())\n\n    }\n    fmt.Printf(\"\\nrbody:%s\\n\", rbody)\n\n    curl := \"curl -X POST -H \\\"content-type: text/plain\\\"\" + \" \" +\n        \"-H X-Apple-CloudKit-Request-KeyID:\" + authKeyID + \" \" +\n        \"-H X-Apple-CloudKit-Request-ISO8601Date:\" + requestDate + \" \" +\n        \"-H X-Apple-CloudKit-Request-SignatureV1:\" + base64.StdEncoding.EncodeToString(signedSignature) + \" \" +\n        \" -d \" + \"'\" + requestBody + \"'\" + \" \" +\n        url\n\n    fmt.Printf(\"\\n%s\\n\", curl)\n\n}\n\nfunc SignMessage(priv *ecdsa.PrivateKey, message []byte) ([]byte, error) {\n    hashed := sha256.Sum256(message)\n    r, s, err := ecdsa.Sign(rand.Reader, priv, hashed[:])\n    if err != nil {\n        return nil, err\n    }\n\n    return asn1.Marshal(ecdsaSignature{r, s})\n}\n\nfunc VerifyMessage(pub *ecdsa.PublicKey, message []byte, signature []byte) bool {\n    var rs ecdsaSignature\n\n    if _, err := asn1.Unmarshal(signature, &amp;rs); err != nil {\n        return false\n    }\n\n    hashed := sha256.Sum256(message)\n    return ecdsa.Verify(pub, hashed[:], rs.R, rs.S)\n}\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 456710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7936349c7fa108fc32ebd480d5eed82?s=128&d=identicon&r=PG&f=1", "display_name": "thstart", "link": "https://stackoverflow.com/users/456710/thstart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 56780196, "answer_count": 1, "score": -1, "last_activity_date": 1561686553, "creation_date": 1561363361, "last_edit_date": 1592644375, "question_id": 56732247, "link": "https://stackoverflow.com/questions/56732247/how-to-perform-cloudkit-server-to-server-authentication", "title": "How to perform CloudKit Server-to-Server authentication", "body": "<p>I'm following <a href=\"https://developer.apple.com/library/archive/documentation/DataManagement/Conceptual/CloudKitWebServicesReference/SettingUpWebServices.html#//apple_ref/doc/uid/TP40015240-CH24-SW6\" rel=\"nofollow noreferrer\">Composing Web Service Requests</a></p>\n<p>To perform the\n<a href=\"https://developer.apple.com/library/archive/documentation/DataManagement/Conceptual/CloudKitWebServicesReference/DiscoveringAllUserIdentities.html#//apple_ref/doc/uid/TP40015240-CH31-SW1\" rel=\"nofollow noreferrer\">Discovering All User Identities (GET users/discover)</a>.</p>\n<p>The idea is to get this simple request working and later make more sophisticated requests like uploading an asset.</p>\n<p>The code below is returning an error from the request.</p>\n<pre><code>\nimport (\n    &quot;bytes&quot;\n    &quot;crypto/ecdsa&quot;\n    &quot;crypto/rand&quot;\n    &quot;crypto/sha256&quot;\n    &quot;crypto/x509&quot;\n    &quot;encoding/base64&quot;\n    &quot;encoding/pem&quot;\n    &quot;fmt&quot;\n    &quot;math/big&quot;\n    &quot;net/http&quot;\n    &quot;time&quot;\n    //...\n)\n\nfunc main() {\n\n    fmt.Printf(&quot;\\nprivate key:\\n&quot;)\n\n    const privPEM = `-----BEGIN EC PRIVATE KEY-----\nMyProvateKey\n-----END EC PRIVATE KEY-----`\n\n    // https://golang.org/pkg/crypto/x509/#example_ParsePKIXPublicKey\n    privBlock, _ := pem.Decode([]byte(privPEM))\n    if privBlock == nil {\n        panic(&quot;failed to parse PEM block containing the public key&quot;)\n    }\n\n    requestPathStr := &quot;/database/1/iCloud.&lt;MyContainer&gt;/development/public/users/discover&quot;\n\n    var requestPath []byte\n    requestPath = []byte(requestPathStr)\n    fmt.Printf(&quot;requestPath: %s\\n&quot;, requestPath)\n\n    requestBody := &quot;&quot;\n    var jsonStr = []byte(requestBody)\n    //\n    h := sha256.New()\n    h.Write([]byte(requestBody))\n    b := h.Sum(nil)\n    hashedBody := base64.StdEncoding.EncodeToString(b)\n    //\n\n    f := &quot;2006-01-02T15:04:05Z&quot;\n    requestDate := time.Now().UTC().Format(f)\n    fmt.Println(requestDate)\n\n    rawPayload := []byte(requestDate + &quot;:&quot; + hashedBody + &quot;:&quot; + requestPathStr)\n\n    r, s, err := pkSign(rawPayload, privBlock)\n    if err != nil {\n        fmt.Printf(&quot;signing hash error: %s\\n&quot;, err)\n    }\n    fmt.Printf(&quot;r: %v\\n&quot;, r)\n    fmt.Printf(&quot;s: %v\\n&quot;, s)\n\n    fmt.Printf(&quot;\\npublic key:\\n&quot;)\n\n    const pubPEM = `-----BEGIN PUBLIC KEY-----\nMyPublicKey\n-----END PUBLIC KEY-----`\n    pubBlock, _ := pem.Decode([]byte(pubPEM))\n    if pubBlock == nil {\n        panic(&quot;failed to parse PEM block containing the public key&quot;)\n    }\n    // ECDSA signature\n    ECDSAsignature := r.Bytes()\n    ECDSAsignature = append(ECDSAsignature, s.Bytes()...)\n\n    fmt.Printf(&quot;ECDSAsignature : %x\\n&quot;, ECDSAsignature)\n\n    verify := pkVerify(rawPayload, pubBlock, r, s)\n    fmt.Printf(&quot;signature verification result: %t\\n&quot;, verify)\n\n    // GET [path]/database/[version]/[container]/[environment]/public/users/discover\n\n    url := &quot;https://api.apple-cloudkit.com/&quot; + requestPathStr\n    fmt.Printf(&quot;\\nurl:%v\\n&quot;, url)\n    fmt.Printf(&quot;\\njsonStr:%s\\n&quot;, jsonStr)\n    fmt.Printf(&quot;\\nrequestDate:%s\\n&quot;, requestDate)\n\n    client := &amp;http.Client{}\n\n    // GET [path]/database/[version]/[container]/[environment]/public/users/discover\n\n    req, err := http.NewRequest(&quot;GET&quot;, url, bytes.NewBuffer(jsonStr))\n    var authKeyID = &quot;MyKeyID&quot;\n\n    req.Header.Add(&quot;content-type&quot;, &quot;text/plain&quot;)\n    req.Header.Add(&quot;X-Apple-CloudKit-Request-KeyID&quot;, authKeyID)\n    req.Header.Add(&quot;X-Apple-CloudKit-Request-ISO8601Date&quot;, requestDate)\n\n    ECDSAsignatureBase64 := base64.StdEncoding.EncodeToString(ECDSAsignature)\n\n    req.Header.Add(&quot;X-Apple-CloudKit-Request-SignatureV1&quot;, ECDSAsignatureBase64)\n    resp, _ := client.Do(req)\n    fmt.Printf(&quot;\\nresp:%v\\n&quot;, resp)\n\n    resp, err = client.Do(req)\n    if err != nil {\n        fmt.Printf(&quot;\\nerr:%v\\n&quot;, err.Error())\n\n    } else {\n        resp.Body.Close()\n        fmt.Printf(&quot;\\nresp.Body:%v\\n&quot;, resp.Body)\n\n    }\n    fmt.Printf(&quot;\\nresp:%v\\n&quot;, resp)\n\n}\n\nfunc pkSign(hash []byte, block *pem.Block) (r, s *big.Int, err error) {\n    zero := big.NewInt(0)\n    private_key, err := x509.ParseECPrivateKey(block.Bytes)\n    if err != nil {\n        return zero, zero, err\n    }\n\n    // Sign signs a hash (which should be the result of hashing a larger message)\n    // using the private key, priv.\n    // If the hash is longer than the bit-length of the private key's curve order,\n    // the hash will be truncated to that length.\n    // It returns the signature as a pair of integers.\n    // The security of the private key depends on the entropy of rand.\n\n    r, s, err = ecdsa.Sign(rand.Reader, private_key, hash)\n    if err != nil {\n        return zero, zero, err\n    }\n    return r, s, nil\n}\n\nfunc pkVerify(hash []byte, block *pem.Block, r *big.Int, s *big.Int) (result bool) {\n    public_key, err := x509.ParsePKIXPublicKey(block.Bytes)\n    if err != nil {\n        return false\n    }\n\n    switch public_key := public_key.(type) {\n    case *ecdsa.PublicKey:\n        return ecdsa.Verify(public_key, hash, r, s)\n    default:\n        return false\n    }\n}\n\n</code></pre>\n<p>The error I got is following:</p>\n<blockquote>\n<p>resp:&amp;{503 Service Unavailable 503 HTTP/1.1 1 1 map[Access-Control-Expose-Headers:[X-Apple-Request-UUID Via] Connection:[keep-alive] Content-Length:[0] Content-Type:[text/plain] Date:[Mon, 24 Jun 2019 07:47:52 GMT] Retry-After:[30] Server:[AppleHttpServer/70a91026] Via:[icloudedge:mi01p00ic-zteu02110401:7401:19RC207:Miami] X-Apple-Cache:[false] X-Apple-Request-Uuid:[ddeb0fa3-ea16-40e9-a15b-c2e68cb5fe78]] {} 0 [] false false map[] 0xc00015c000 0xc0000ce2c0}</p>\n<p>resp.Body:{}</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1561362911, "post_id": 56732090, "comment_id": 100023372, "body": "It&#39;s a channel of ints. And it&#39;s explained in the tutorial you&#39;re reading. Please read the entire section on channels."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1561363110, "post_id": 56732090, "comment_id": 100023463, "body": "If you think this is weird, wait til you see directional chan types :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1561364018, "post_id": 56732090, "comment_id": 100023902, "body": "@SergioTulentsev: That&#39;s nothing. How about maps of directional chans of functions accepting maps of directional chans..."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1561364145, "post_id": 56732090, "comment_id": 100023967, "body": "@Flimzy: oh my, just reading these words gives me anxiety."}], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 4, "last_activity_date": 1561363629, "last_edit_date": 1561363629, "creation_date": 1561362937, "answer_id": 56732126, "question_id": 56732090, "link": "https://stackoverflow.com/questions/56732090/why-syntax-for-channel-parameters-are-different-are-there-any-underlying-meanin/56732126#56732126", "title": "Why syntax for channel parameters are different? Are there any underlying meaning?", "body": "<blockquote>\n  <p>I'm familiar with the syntax: <code>variableName type</code> in Go. Is this a channel type, or an <code>int</code> type, or a <code>chan int</code> type? And what's with the weird syntax?</p>\n</blockquote>\n\n<p><code>chan int</code> is the type. It's just as \"weird\" as <code>[]int</code>.</p>\n"}], "owner": {"reputation": 385, "user_id": 8249447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2019240481630479/picture?type=large", "display_name": "Tr\u1ea7n Xu&#226;n Huy", "link": "https://stackoverflow.com/users/8249447/tr%e1%ba%a7n-xu%c3%a2n-huy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 56732126, "answer_count": 1, "score": -6, "last_activity_date": 1561363629, "creation_date": 1561362817, "last_edit_date": 1561362875, "question_id": 56732090, "link": "https://stackoverflow.com/questions/56732090/why-syntax-for-channel-parameters-are-different-are-there-any-underlying-meanin", "title": "Why syntax for channel parameters are different? Are there any underlying meaning?", "body": "<p>I'm digging around the use of channels in Go, and in <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">this example</a> from Tour of Go, we have this line: </p>\n\n<pre><code>func sum(s []int, c chan int) {\n</code></pre>\n\n<p>I'm familiar with the syntax: <code>variableName type</code> in Go.\nBut what does this mean? <code>c chan int</code></p>\n\n<p>Is this a <code>channel</code> type, or an <code>int</code> type, or a <code>chan int</code> type? And what's with the weird syntax?</p>\n\n<p>I cannot search for the answer, if this is a duplicate, kindly give me a link to the original post in the comment, and I'll delete the question.</p>\n"}, {"tags": ["go", "ipfs"], "answers": [{"tags": [], "owner": {"reputation": 183, "user_id": 4115868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QiPJP.jpg?s=128&g=1", "display_name": "Manuja Jayawardana", "link": "https://stackoverflow.com/users/4115868/manuja-jayawardana"}, "is_accepted": false, "score": 0, "last_activity_date": 1561490981, "creation_date": 1561490981, "answer_id": 56760823, "question_id": 56730553, "link": "https://stackoverflow.com/questions/56730553/unable-to-install-go-ipfs-from-source/56760823#56760823", "title": "Unable to Install Go-Ipfs from source", "body": "<p>I solved this problem by following method. not sure this will be a good solution or not. any way i could solve the issue.</p>\n\n<p>I'm posting this as a answer. so it will be useful to everyone who has the same issue.</p>\n\n<p>1) Deleted go-ipfs folder inside the \"%GO_WORKSPACE% / .... / ipfs\" folder.</p>\n\n<p>2) Git clone the go ipfs repo manually on the same location.</p>\n\n<p>3) go inside go-ipfs folder.</p>\n\n<p>4) execute install command.</p>\n\n<pre><code>make install\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 4115868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QiPJP.jpg?s=128&g=1", "display_name": "Manuja Jayawardana", "link": "https://stackoverflow.com/users/4115868/manuja-jayawardana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561490981, "creation_date": 1561355685, "question_id": 56730553, "link": "https://stackoverflow.com/questions/56730553/unable-to-install-go-ipfs-from-source", "title": "Unable to Install Go-Ipfs from source", "body": "<p>I'm trying to Build IPFS from Source on windows 10.</p>\n\n<p>Previously i installed it from source.It was working fine. But i needed the latest source so i started again from the scratch. because i edited some parts in the source.</p>\n\n<p>I followed instructions on <a href=\"https://github.com/ipfs/go-ipfs/blob/master/docs/windows.md\" rel=\"nofollow noreferrer\">https://github.com/ipfs/go-ipfs/blob/master/docs/windows.md</a>.</p>\n\n<p>I received following error on executing following commands.</p>\n\n<p>code</p>\n\n<pre><code>cd %GOPATH%\\src\\github.com\\ipfs\\go-ipfs\nmake install\n</code></pre>\n\n<p>Error</p>\n\n<pre><code>go version go1.12.6 windows/amd64\nbin/check_go_version 1.12\ngo install  -asmflags=all=-trimpath=\"D:\\GO_WORKSPACE\" -gcflags=all=-trimpath=\"D:\\GO_WORKSPACE\" -ldflags=\"-X \"github.com/ipfs/go-ipfs\".CurrentCommit=810cb607e-dirty\" ./cmd/ipfs\n# github.com/ipfs/go-ipfs/plugin/loader\nplugin\\loader\\preload.go:11:2: undefined: pluginipldgit\nplugin\\loader\\preload.go:12:2: undefined: pluginbadgerds\nplugin\\loader\\preload.go:13:2: undefined: pluginflatfs\nplugin\\loader\\preload.go:14:2: undefined: pluginlevelds\nmake: *** [cmd/ipfs/Rules.mk:37: cmd/ipfs-install] Error 2\n\n</code></pre>\n\n<p>I tried Adding this plugins in to preload.go file under src\\github.com\\ipfs\\go-ipfs\\plugin\\loader directory.</p>\n\n<p>exisiting code on preload.go.</p>\n\n<pre><code>import (\n    \"github.com/ipfs/go-ipfs/plugin\"\n)\n</code></pre>\n\n<p>i added after the issue</p>\n\n<pre><code>import (\n    \"github.com/ipfs/go-ipfs/plugin\"\n    pluginipldgit \"github.com/ipfs/go-ipfs/plugin/plugins/git\"\n    pluginbadgerds \"github.com/ipfs/go-ipfs/plugin/plugins/git\"\n    pluginflatfs \"github.com/ipfs/go-ipfs/plugin/plugins/git\"\n    pluginlevelds \"github.com/ipfs/go-ipfs/plugin/plugins/git\"\n)\n</code></pre>\n\n<p>so after i added this lines result is success.</p>\n\n<p>Executed command</p>\n\n<pre><code>make install\n\n</code></pre>\n\n<p>Result </p>\n\n<pre><code>go version go1.12.6 windows/amd64\nbin/check_go_version 1.12\ngo install  -asmflags=all=-trimpath=\"D:\\GO_WORKSPACE\" -gcflags=all=-trimpath=\"D:\\GO_WORKSPACE\" -ldflags=\"-X \"github.com/ipfs/go-ipfs\".CurrentCommit=810cb607e-dirty\" ./cmd/ipfs\n\n</code></pre>\n\n<p>Then i tried to start the ipfs using following command</p>\n\n<pre><code>ipfs daemon\n</code></pre>\n\n<p>Error</p>\n\n<pre><code>Initializing daemon...\ngo-ipfs version: 0.4.22-dev-810cb607e-dirty\nRepo version: 7\nSystem version: amd64/windows\nGolang version: go1.12.6\n\nError: unknown datastore type: flatfs\n\n</code></pre>\n\n<p>Can someone help me configure the IPFS from source.\nThanks in advance.</p>\n"}, {"tags": ["go", "path", "environment"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1561342736, "post_id": 56729129, "comment_id": 100017923, "body": "Add the directory where you installed Go to your PATH."}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561342896, "post_id": 56729129, "comment_id": 100017951, "body": "@CeriseLim&#243;n Add something to the question."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1561344406, "post_id": 56729129, "comment_id": 100018103, "body": "give yourself a <code>export PATH=&#47;usr&#47;local&#47;go&#47;bin:${PATH}</code>"}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1561345005, "post_id": 56729129, "comment_id": 100018197, "body": "@ScottStensland It works now! So <code>GOPATH</code> should be <code>&#47;usr&#47;local&#47;go</code> which been installed?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561348299, "post_id": 56729129, "comment_id": 100018643, "body": "@02040402 Do not set GOPATH to the installation directory.  A simple approach is to not set GOPATH at all. In this case the go tool will use $HOME/go as the workspace."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1561350088, "creation_date": 1561350088, "answer_id": 56729810, "question_id": 56729129, "link": "https://stackoverflow.com/questions/56729129/cant-find-gopath-even-set-env-path/56729810#56729810", "title": "Can&#39;t find GOPATH even set env path", "body": "<p>As commented, your ~/.zshrc should set PATH to reference Go, as seen in the <a href=\"https://github.com/golang/go/wiki/SettingGOPATH#zsh\" rel=\"nofollow noreferrer\">Go wiki</a>:</p>\n\n<blockquote>\n  <p>Edit your <code>~/.zshrc</code> file to add the following line:</p>\n</blockquote>\n\n<pre><code>export GOPATH=$HOME/go\n</code></pre>\n\n<blockquote>\n  <p>Save and exit your editor. Then, source your <code>~/.zshrc</code>.</p>\n</blockquote>\n\n<pre><code>source ~/.zshrc\n</code></pre>\n\n<p>As explained in the <a href=\"https://rakyll.org/default-gopath/\" rel=\"nofollow noreferrer\">default <code>GOPATH</code></a> and <a href=\"https://github.com/golang/go/issues/17262\" rel=\"nofollow noreferrer\">issue 17262</a>, you don't need to set GOPATH.</p>\n\n<p>But since <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">Go 1.11 and its modules</a>, you can now makes entire projects <em>without</em> ever using the default <code>GOPATH</code> at all: everything would remain local to your project.</p>\n\n<blockquote>\n  <p>As of Go 1.11, the <code>go</code> command enables the use of modules when the current directory or any parent directory has a <code>go.mod</code>, provided the directory is outside <code>$GOPATH/src</code>.<br>\n  (Inside <code>$GOPATH/src</code>, for compatibility, the <code>go</code> command still runs in the old <code>GOPATH</code> mode, even if a <code>go.mod</code> is found)</p>\n</blockquote>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "accepted_answer_id": 56729810, "answer_count": 1, "score": 0, "last_activity_date": 1561473726, "creation_date": 1561342444, "last_edit_date": 1561342862, "question_id": 56729129, "link": "https://stackoverflow.com/questions/56729129/cant-find-gopath-even-set-env-path", "title": "Can&#39;t find GOPATH even set env path", "body": "<p>Using the root user installed go on linux.</p>\n\n<p>Set go path in the ~/.zshrc file:</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<pre><code>$ ls $HOME/go\nbin pkg src\n\n$ ls $HOME/go/bin\nasmfmt  dlv  errcheck  fillstruct  gocode  gocode-gomod  godef  gogetdoc  goimports  golint  gometalinter  gomodifytags  gorename  gotags  gounit  guru  iferr  impl  keyify  motion\n</code></pre>\n\n<p>But <code>go env</code> returned:</p>\n\n<pre><code>zsh: command not found: go\n</code></pre>\n\n<p>Why?</p>\n\n<hr>\n\n<h1>Addition</h1>\n\n<pre><code>$ whereis go\ngo: /usr/local/go\n</code></pre>\n\n<p>Set <code>/usr/local</code> to ~/.zshrc:</p>\n\n<pre><code>export PATH=$PATH:/usr/local/\n</code></pre>\n\n<p>Source it. Run <code>go env</code> returned:</p>\n\n<pre><code>zsh: permission denied: go\n</code></pre>\n"}, {"tags": ["linux", "go", "boltdb"], "comments": [{"owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 0, "creation_date": 1561342004, "post_id": 56729046, "comment_id": 100017799, "body": "Have a look at <a href=\"https://stackoverflow.com/questions/22678981/concurrently-writing-to-file-while-reading-it-out-using-mmap\" title=\"concurrently writing to file while reading it out using mmap\">stackoverflow.com/questions/22678981/&hellip;</a>"}, {"owner": {"reputation": 256, "user_id": 5304662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3ef226b08b534fc47c0edd7ed520d5?s=128&d=identicon&r=PG&f=1", "display_name": "chenyuandong", "link": "https://stackoverflow.com/users/5304662/chenyuandong"}, "reply_to_user": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 0, "creation_date": 1561344327, "post_id": 56729046, "comment_id": 100018094, "body": "@DavidCullen Thank you! It seems like I&#39;d better stick to one kind of system call instead of mixing them."}], "answers": [{"tags": [], "owner": {"reputation": 694, "user_id": 2823791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c342a53da99bd7e1b4fcb164a037d220?s=128&d=identicon&r=PG", "display_name": "VicX", "link": "https://stackoverflow.com/users/2823791/vicx"}, "is_accepted": false, "score": 0, "last_activity_date": 1586340457, "creation_date": 1586340457, "answer_id": 61098143, "question_id": 56729046, "link": "https://stackoverflow.com/questions/56729046/is-it-safe-to-use-mmap-with-fsync-will-fsync-invalidate-some-page-on-mmap/61098143#61098143", "title": "Is it safe to use mmap with fsync? \uff08will fsync invalidate some page on mmap?\uff09", "body": "<p>The same question bothered me when I was reading the source code of boltdb. I searched/reviewed a lot of articles on Google but still didn't get an answer. </p>\n\n<p>I knew that linux has a <code>dnotify</code>/<a href=\"http://man7.org/linux/man-pages/man7/inotify.7.html\" rel=\"nofollow noreferrer\">inodtify</a> system to monitor file changes, thus it is sure that kernel knows changes made to a file.</p>\n\n<p>The <a href=\"http://man7.org/linux/man-pages/man2/mmap.2.html\" rel=\"nofollow noreferrer\">man page for mmap</a> didn't describe the satiation mentioned here, but the description for MAP_SHARED did mention that </p>\n\n<blockquote>\n  <p>Updates to the mapping are visible to other processes mapping the same region, and (in the case of file-backed mappings) are carried through to the underlying file.  </p>\n</blockquote>\n\n<p>I think it should be a reasonable guess that MAP_SHARED guarantees changes made to the underlying file are seen to all mapped memory regions. Hope someday a Linux kernel expert can provide some details on this.</p>\n"}], "owner": {"reputation": 256, "user_id": 5304662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3ef226b08b534fc47c0edd7ed520d5?s=128&d=identicon&r=PG&f=1", "display_name": "chenyuandong", "link": "https://stackoverflow.com/users/5304662/chenyuandong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 299, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1586340457, "creation_date": 1561341375, "question_id": 56729046, "link": "https://stackoverflow.com/questions/56729046/is-it-safe-to-use-mmap-with-fsync-will-fsync-invalidate-some-page-on-mmap", "title": "Is it safe to use mmap with fsync? \uff08will fsync invalidate some page on mmap?\uff09", "body": "<p>For example, I use mmap to map a file into the memory as read-only shared mode. And I read some data on the file based on their address in the memory. What if I call write and fsync to update or changes the underlying file after then? Will the data in the memory also change? Or I need to call some other system call to synchronize the mapped memory? I find this question when reading source code of BoltDB. </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1561342104, "last_edit_date": 1561342104, "creation_date": 1561341771, "answer_id": 56729076, "question_id": 56729009, "link": "https://stackoverflow.com/questions/56729009/sort-sort-not-modifying-array/56729076#56729076", "title": "sort.Sort not modifying array", "body": "<p>The problem is that the Swap method is changing the argument array, not the array in the caller.</p>\n\n<p>Fix by declaring byNum as a slice:</p>\n\n<pre><code>type byNum []int\n\n...\n\nsort.Sort(byNum(a[:]))\n</code></pre>\n\n<p>In this call, the backing array of the slice argument is the array that you want to modify.</p>\n\n<p><a href=\"https://play.golang.org/p/uyWgR6B-YkH\" rel=\"nofollow noreferrer\">Run it on the playground</a>.  </p>\n"}], "owner": {"reputation": 4746, "user_id": 1644215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e2195ef04472c73ccd53d77bec0c7e6?s=128&d=identicon&r=PG", "display_name": "KevBurnsJr", "link": "https://stackoverflow.com/users/1644215/kevburnsjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 1, "accepted_answer_id": 56729076, "answer_count": 1, "score": -1, "last_activity_date": 1561342104, "creation_date": 1561341085, "question_id": 56729009, "link": "https://stackoverflow.com/questions/56729009/sort-sort-not-modifying-array", "title": "sort.Sort not modifying array", "body": "<p>The following code should create an array of ints (<code>a</code>) and sort it, but sort.Sort does not appear to modify the variable.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype IntArray [5]int\n\ntype byNum [5]int\nfunc (s byNum) Len() int {\n    return len(s)\n}\nfunc (s byNum) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}\nfunc (s byNum) Less(i, j int) bool {\n    return s[i] &lt; s[j]\n}\n\nfunc main() {\n    a := IntArray{5,3,4,1,2}\n\n    fmt.Println(a)\n    sort.Sort(byNum(a))\n    fmt.Println(a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bhcwgosqvis\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bhcwgosqvis</a></p>\n\n<pre><code>[5 3 4 1 2]\n[5 3 4 1 2]\n\nProgram exited.\n</code></pre>\n\n<p>Why does this not work?</p>\n"}, {"tags": ["go", "neo4j"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 3434532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dca8c222cb1cbc478d69dffc89ebde4?s=128&d=identicon&r=PG&f=1", "display_name": "Weev", "link": "https://stackoverflow.com/users/3434532/weev"}, "is_accepted": true, "score": 0, "last_activity_date": 1568194138, "creation_date": 1568194138, "answer_id": 57886066, "question_id": 56728697, "link": "https://stackoverflow.com/questions/56728697/issue-with-compiling-neo4j-code-with-neo4j-go-driver/57886066#57886066", "title": "Issue with compiling neo4j code with neo4j go driver", "body": "<p>This has been the source of a big issue for me too, but I eventually sorted it out.</p>\n\n<p>The issue is that the lib you download from their <a href=\"https://github.com/neo4j-drivers/seabolt/releases\" rel=\"nofollow noreferrer\">repo</a> is most likely linked to a version of openssl you don't have installed. So you likely need to either compile it yourself so it's relevant to your current OS and architecture, or you need to manually edit the path of the dynamically linked libraries so that it's correct, with nm for example if you're on macOS.</p>\n\n<p>Simply put, you need to make libseabolt available on your working environment first.</p>\n\n<p>It's safe to assume it's a pain in the ass for deploying stuff properly, I had to do hacks here and there to be able to deploy stuff with docker consistently using this driver.</p>\n\n<p>Good luck :)</p>\n"}], "owner": {"reputation": 125, "user_id": 2543909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dfa359c96986eb740d5d78bc2ccece4?s=128&d=identicon&r=PG", "display_name": "jmadan", "link": "https://stackoverflow.com/users/2543909/jmadan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 57886066, "answer_count": 1, "score": 1, "last_activity_date": 1568194138, "creation_date": 1561336983, "question_id": 56728697, "link": "https://stackoverflow.com/questions/56728697/issue-with-compiling-neo4j-code-with-neo4j-go-driver", "title": "Issue with compiling neo4j code with neo4j go driver", "body": "<p>I am trying to run the sample code available at (<a href=\"https://neo4j.com/developer/go/\" rel=\"nofollow noreferrer\">https://neo4j.com/developer/go/</a>) using golang neo4j driver but running into compiling issues.</p>\n\n<p>I have build the seabolt 1.7.4 from source.\nHave the following variables in place\nPKG_CONFIG_PATH pointing to seabolt-1.7.4/build/dist/share/pkgconfig\nOPENSSL_ROOT_DIR=/usr/local/opt/openssl\nDYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/seabolt-1.7.4/build/dist/lib</p>\n\n<p>When I try to build my code with command\nenv GOOS=linux go build -ldflags=\"-s -w\" --tags seabolt_static -o bin/user users/user.go</p>\n\n<p>I get the following error</p>\n\n<p>github.com/neo4j-drivers/gobolt\n../pkg/mod/github.com/neo4j-drivers/gobolt@v1.7.4/connector_worker.go:30:14: undefined: Config\n../pkg/mod/github.com/neo4j-drivers/gobolt@v1.7.4/connector_worker.go:31:15: undefined: seaboltConnector</p>\n\n<p>Can anyone point me in right direction.</p>\n"}, {"tags": ["go", "datastore"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 10405483, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Z4PahWppaMI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUwz0-5sYxEHOdMMMWz7Sc2WVa7wg/mo/photo.jpg?sz=128", "display_name": "Ar_11", "link": "https://stackoverflow.com/users/10405483/ar-11"}, "edited": false, "score": 0, "creation_date": 1561339091, "post_id": 56728747, "comment_id": 100017365, "body": "I get the following error - `    undefined: &quot;google.golang.org/appengine/datastore&quot;.IDKey`"}, {"owner": {"reputation": 41, "user_id": 10405483, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Z4PahWppaMI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUwz0-5sYxEHOdMMMWz7Sc2WVa7wg/mo/photo.jpg?sz=128", "display_name": "Ar_11", "link": "https://stackoverflow.com/users/10405483/ar-11"}, "edited": false, "score": 0, "creation_date": 1561339853, "post_id": 56728747, "comment_id": 100017463, "body": "I&#39;m importing &quot;google.golang.org/appengine/datastore&quot; and not  &quot;cloud.google.com/go/datastore&quot;. how can i do the same with the former import."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 41, "user_id": 10405483, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Z4PahWppaMI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUwz0-5sYxEHOdMMMWz7Sc2WVa7wg/mo/photo.jpg?sz=128", "display_name": "Ar_11", "link": "https://stackoverflow.com/users/10405483/ar-11"}, "edited": false, "score": 1, "creation_date": 1561341372, "post_id": 56728747, "comment_id": 100017711, "body": "To use the older google.golang.org/appengine/datastore  package, replace the call to IDKey with a call to <a href=\"https://godoc.org/google.golang.org/appengine/datastore#NewKey\" rel=\"nofollow noreferrer\">NewKey</a>.  As with the cloud.google.com/go/datastore package, the Encode method and Decode functions are the preferred way to get a key as a machine readable string."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1561338784, "last_edit_date": 1561338784, "creation_date": 1561337721, "answer_id": 56728747, "question_id": 56728338, "link": "https://stackoverflow.com/questions/56728338/unable-to-parse-string-to-datastore-key/56728747#56728747", "title": "Unable to parse string to datastore.Key", "body": "<p>ParseInt returns an error because the string <code>\"/Users,6248007768440574\"</code> is not an integer. A substring is an integer, but not the entire string.</p>\n\n<p>The string in the question was created by calling <a href=\"https://godoc.org/cloud.google.com/go/datastore#Key.String\" rel=\"nofollow noreferrer\">Key.String</a>.  The datastore package does not provide a way to parse the output from this method. Here's a simple parser for the case where there are no ancestor keys: </p>\n\n<pre><code>var keyPat = regexp.MustCompile(`^/([^\\.]*),(\\d+)$`)\n\nfunc parseKey(s string) (*datastore.Key, error) {\n    m := keyPat.FindStringSubmatch(s)\n    i := strings.Index(s, \",\")\n    if i &lt; 0 {\n        return nil, errors.New(\"bad format\")\n    }\n    n, err := strconv.ParseInt(m[2], 10, 64)\n    if err != nil {\n        return nil, err\n    }\n    return datastore.IDKey(m[1], n, nil), nil\n}\n</code></pre>\n\n<p>The the <a href=\"https://godoc.org/cloud.google.com/go/datastore#Key.Encode\" rel=\"nofollow noreferrer\">Encode</a> method and <a href=\"https://godoc.org/cloud.google.com/go/datastore#DecodeKey\" rel=\"nofollow noreferrer\">Decode</a> function are the preferred way to convert a key to and from a machine readable string. </p>\n"}], "owner": {"reputation": 41, "user_id": 10405483, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Z4PahWppaMI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUwz0-5sYxEHOdMMMWz7Sc2WVa7wg/mo/photo.jpg?sz=128", "display_name": "Ar_11", "link": "https://stackoverflow.com/users/10405483/ar-11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11194, "favorite_count": 0, "accepted_answer_id": 56728747, "answer_count": 1, "score": 0, "last_activity_date": 1561338784, "creation_date": 1561331460, "last_edit_date": 1561332538, "question_id": 56728338, "link": "https://stackoverflow.com/questions/56728338/unable-to-parse-string-to-datastore-key", "title": "Unable to parse string to datastore.Key", "body": "<p>With reference to <a href=\"https://stackoverflow.com/questions/26593806/making-a-google-app-engine-datastore-key-from-a-string\">this question</a>, I am trying to convert a datastore key from the Form to int64 and with the help of that key, trying to update a record in the datastore. I tried exactly the same code as in the answer selected in the reference link, but I get an error  which says, <code>Unable to parse key. strconv.ParseInt: parsing \"/Users,6248007768440574\": invalid syntax</code> </p>\n\n<p>The value I'm passing from the form is a datastore key of the format <code>/Users,6248007768440574</code>. I realize that the syntax error is because of this. Could anyone please help me in how to go about with this issue? Or, is there a method to convert a string to *datastore.Key? Any help will be appreciated</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 1, "creation_date": 1561358718, "post_id": 56728227, "comment_id": 100021443, "body": "Yes, sorry in my question I was talking about the total size in memory (so the size of the map + to all the struct it points to). What you describe is indeed the behaviour I expected writing my code. However the garbage collector does not seem to free/allow for reuse the formerly occupied memory by the strucs."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1561330848, "last_edit_date": 1561330848, "creation_date": 1561329909, "answer_id": 56728227, "question_id": 56728142, "link": "https://stackoverflow.com/questions/56728142/freeing-map-of-struct/56728227#56728227", "title": "Freeing map of struct", "body": "<p>The size of the map value <code>&amp;S</code>, a pointer, is the same irrespective of the capacity of slice <code>b</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype S struct {\n    a uint32\n    b []uint32\n}\n\nfunc main() {\n    size := unsafe.Sizeof(&amp;S{})\n    fmt.Println(size)\n\n    size = unsafe.Sizeof(&amp;S{b: make([]uint32, 10)})\n    fmt.Println(size)\n\n    s := make(map[uint32]*S)\n\n    for k, v := range s {\n        delete(s, k)\n        s[k] = &amp;S{a: v.a}\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>8\n8\n</code></pre>\n\n<hr>\n\n<p>A slice is represented internally by</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>When you set <code>&amp;S{a: v.a}</code> you set <code>b</code> to initial values: <code>array</code> to <code>nil</code> and <code>len</code> and <code>cap</code> to zero. The memory formerly occupied by the underlying <code>array</code> is returned to the garbage collector for reuse.</p>\n"}, {"comments": [{"owner": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561358406, "post_id": 56728256, "comment_id": 100021304, "body": "Isn&#39;t the size of a slice also bounded to the maximum it had? This is the reason why I performed the delete operation: so that the size of the slice in <code>s</code> is also reset"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561359183, "post_id": 56728256, "comment_id": 100021639, "body": "No because it\u2019s a pointer which is the reference to the struct instance"}, {"owner": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561361827, "post_id": 56728256, "comment_id": 100022898, "body": "Yes but I am interested in the global memory usage, not only the map size. So each element of the map points to a struct which contains a slice."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561362306, "post_id": 56728256, "comment_id": 100023124, "body": "Yes, the deleted instances will eventually get garbage collected but there is a chance that the Go runtime will not immediately return the memory to the OS."}, {"owner": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561364443, "post_id": 56728256, "comment_id": 100024128, "body": "My question is exactly about this issue: My program gets killed by the system (out of memory) before the gc has time to release the unused memory"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "edited": false, "score": 0, "creation_date": 1561364843, "post_id": 56728256, "comment_id": 100024339, "body": "That&#39;s a new thing. Use the environment variables from <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime</a> or pprof <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/pprof</a> to monitor the memory size and edit your question with the finding to give us more information."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1561383784, "post_id": 56728256, "comment_id": 100034495, "body": "<code>v.b = v.b[:0]</code> frees zero memory. The same underlying array is still used by the slice. It just means the slice won&#39;t have to grow the next time it&#39;s appended to. <code>v.b := []uint32{}</code> would actually free memory."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561384368, "post_id": 56728256, "comment_id": 100034838, "body": "That&#39;s a good point. I&#39;ve edited the answer adopting this change."}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 1, "last_activity_date": 1561384339, "last_edit_date": 1561384339, "creation_date": 1561330321, "answer_id": 56728256, "question_id": 56728142, "link": "https://stackoverflow.com/questions/56728142/freeing-map-of-struct/56728256#56728256", "title": "Freeing map of struct", "body": "<p>The map size is bounded to the maximum size it had at any point. Because you store pointers (map[uint32]*S) and not values the deleted objects will get garbage collected eventually but usually not immediately and that why you don\u2019t see it in top/htop like monitors. </p>\n\n<p>The runtime is clever enough and reserves memory for future use if the system is not under pressure or low on resources.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/49963553/1199408\">https://stackoverflow.com/a/49963553/1199408</a> to understand more about memory.</p>\n\n<p>In your example you don't need to call delete. You will achieve what you want just by clearing the slice in the struct.</p>\n\n<pre><code>type S struct {\n a uint32\n b []uint32\n}\n\ns := make(map[uint32]*S)\n\nfor k, v := range s {\n  v.b = []uint32{}\n}\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 4011719, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/baab6eda913eb411084a1d77ce3bab45?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin P", "link": "https://stackoverflow.com/users/4011719/kevin-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1561384339, "creation_date": 1561328770, "question_id": 56728142, "link": "https://stackoverflow.com/questions/56728142/freeing-map-of-struct", "title": "Freeing map of struct", "body": "<p>I am working with a very large map of pointer to struct. It is growing over the lifetime of the program (I use it as a buffer) and I wrote a function that is supposed to reduce it size when it is called.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type S struct {\n a uint32\n b []uint32\n}\n\ns := make(map[uint32]*S)\n\nfor k, v := range s {\n  delete(s, k)\n  s[k] = &amp;S{a: v.a}\n}\n</code></pre>\n\n<p>I remove <code>b</code> from every element of the map, so I expected the size of the map in memory to shrink (<code>b</code> is a slice of length > 10). However the memory is not freed, why?</p>\n"}, {"tags": ["algorithm", "go", "queue", "priority-queue"], "comments": [{"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561330572, "post_id": 56727143, "comment_id": 100016310, "body": "Two things: 1) You add a new edge <code>vertNum</code> times. However, a tree will always have <code>vertNum - 1</code> edges. 2) You assume that a vertex is not in the queue if its index is <code>-1</code>. This is not true as another neighbor vertex might already have pushed it into the queue."}, {"owner": {"reputation": 9, "user_id": 8811308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wWSP9.jpg?s=128&g=1", "display_name": "cryptostimor", "link": "https://stackoverflow.com/users/8811308/cryptostimor"}, "reply_to_user": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561477378, "post_id": 56727143, "comment_id": 100072992, "body": "@NicoSchertler 1) Do you mean adding a new edge to queue? 2) The function uses same adresses of vertices in array <code>vertices</code> and array <code>queue</code>."}, {"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561482067, "post_id": 56727143, "comment_id": 100075224, "body": "1) No, I mean <code>treeEdges = append(...)</code>. 2) I mean the <code>.index</code>. You assign either <code>-1</code> or <code>-2</code>. Btw, you might also want to check if your data type can hold negative numbers."}, {"owner": {"reputation": 9, "user_id": 8811308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wWSP9.jpg?s=128&g=1", "display_name": "cryptostimor", "link": "https://stackoverflow.com/users/8811308/cryptostimor"}, "reply_to_user": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561494424, "post_id": 56727143, "comment_id": 100080472, "body": "@NicoSchertler Yeah, you&#39;re right. But actually cycle controlled by <code>if queue.Len() == 0</code> line and I don&#39;t think that <code>vertNum</code> plays any role in this cycle. Field <code>index</code> has <code>int</code> as type, so I think it should be able to hold negative numbers."}, {"owner": {"reputation": 9, "user_id": 8811308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wWSP9.jpg?s=128&g=1", "display_name": "cryptostimor", "link": "https://stackoverflow.com/users/8811308/cryptostimor"}, "reply_to_user": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561494910, "post_id": 56727143, "comment_id": 100080662, "body": "@NicoSchertler Forgot to reply. I assign <code>-1</code> for vertices which didn&#39;t put in a queue yet or was taken earlier, and <code>-2</code> for the vertex which I took from queue in current iteration."}, {"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1561504743, "post_id": 56727143, "comment_id": 100083329, "body": "You do the following: <code>if u.index == -1 ... queue.Push(u)</code>. But <code>u</code> might already be in the queue."}], "owner": {"reputation": 9, "user_id": 8811308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wWSP9.jpg?s=128&g=1", "display_name": "cryptostimor", "link": "https://stackoverflow.com/users/8811308/cryptostimor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561359467, "creation_date": 1561318075, "question_id": 56727143, "link": "https://stackoverflow.com/questions/56727143/why-this-code-makes-wrong-minimal-spanning-tree-by-prims-algorythm", "title": "Why this code makes wrong minimal spanning tree by Prim&#39;s algorythm?", "body": "<p>I have some code on Golang with Prim's algorythm.\nThe task is to find minimal spanning tree with a minimum amount of edge lengths. But if vertices number is greater then 3, I'm getting wrong answer.</p>\n\n<p>So I tried to rewrite Prim's algorythm, but nothing changed.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func MST_Prim(vertices []*Vertex, vertNum int, edgeNum int) []*Edge {\n    treeEdges := make([]*Edge, 0)\n\n    for i := 0; i &lt; vertNum; i++ {\n        vertices[i].index = -1\n    }\n\n    queue := make(PriorityQueue, 0)\n    v := vertices[0]\n    for i := 0; i &lt; vertNum; i++ {\n        v.index = -2\n\n        for _, edge := range vertices[v.id].edges {\n            u := vertices[edge.v]\n\n            if u.index == -1 {\n                u.priority = edge.len\n                u.value = v.id\n                queue.Push(u)\n            } else if u.index != -2 &amp;&amp; edge.len &lt; u.priority {\n                u.value = v.id\n                queue.update(u, v.value, edge.len)\n            }\n        }\n\n        if queue.Len() == 0 {\n            break\n        }\n\n        v = queue.Pop().(*Vertex)\n        treeEdges = append(treeEdges, &amp;Edge{v.id, v.value, v.priority})\n    }\n\n    return treeEdges\n}\n</code></pre>\n\n<p>I need to print minimal sum of length of edges in minimal spanning tree.\nThere is the input:</p>\n\n<pre><code>4\n4\n1 2 462\n0 3 343\n0 1 430\n1 3 146\n</code></pre>\n\n<p>I'm getting 1038 as answer, but correct answer is 951.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1561313534, "post_id": 56726513, "comment_id": 100013038, "body": "Yeah, ended up doing the second option. Stupid question."}], "tags": [], "owner": {"reputation": 1342, "user_id": 7046455, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-XJOndHBD524/AAAAAAAAAAI/AAAAAAAAARw/8_dQhNU18-k/photo.jpg?sz=128", "display_name": "Thomas Sauvajon", "link": "https://stackoverflow.com/users/7046455/thomas-sauvajon"}, "is_accepted": false, "score": 1, "last_activity_date": 1561312879, "creation_date": 1561312879, "answer_id": 56726513, "question_id": 56726464, "link": "https://stackoverflow.com/questions/56726464/out-of-bounds-when-appending-in-go-slice/56726513#56726513", "title": "Out of bounds when appending in Go slice", "body": "<p>Well if <code>i == len(SliceA)</code>, then <code>sliceA[i+1]</code> is out of bounds! It is not \"in some cases\" but in every case, and the same will happen for SliceB.</p>\n\n<p>Consider breaking out of your loop if <code>i == len(SliceA)</code> or <code>j == len(SliceB)</code>.</p>\n\n<p>Another solution would be to use a \"regular\" for loop: <code>for i := 0; i &lt; len(SliceA); i++</code></p>\n"}], "owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1561312879, "creation_date": 1561312480, "question_id": 56726464, "link": "https://stackoverflow.com/questions/56726464/out-of-bounds-when-appending-in-go-slice", "title": "Out of bounds when appending in Go slice", "body": "<p>In some cases when i == len(SliceA) i get a slice out of bounds error.</p>\n\n<pre><code>//filterIntersection removes points from two slices that have common points.\nfunc filterIntersection(sliceA, sliceB *[]ds.Coord) {\n    for i, a := range *sliceA {\n        for j, b := range *sliceB {\n            if a == b {\n                (*sliceA) = append((*sliceA)[:i], (*sliceA)[i+1:]...) &lt;--- error here\n                (*sliceB) = append((*sliceB)[:j], (*sliceB)[j+1:]...)\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "go-build"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1561309723, "post_id": 56725750, "comment_id": 100012180, "body": "If you use <code>go install</code> to build the binary, then you can run <code>go install -n</code> to determine if the installed binary is up-to-date.  No output means that binary is up-to-date.  If your goal update the binary before running it, then run <code>go install</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1561320471, "post_id": 56725750, "comment_id": 100014593, "body": "<code>go build</code> only does the minimal amount of work necessary, so even a large project will only take a second to run a no-op build."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561330474, "post_id": 56725750, "comment_id": 100016300, "body": "Although it doesn&#39;t make sense because as the others said go build caches outputs anyway, you can change your scripts to find changed (<code>git diff-index --quiet HEAD --</code>) files and if there aren\u2019t any skip the build."}], "owner": {"reputation": 47, "user_id": 9122077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c4a349c1f476414fea4904cb3392299?s=128&d=identicon&r=PG&f=1", "display_name": "iman tung", "link": "https://stackoverflow.com/users/9122077/iman-tung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561306882, "creation_date": 1561306882, "question_id": 56725750, "link": "https://stackoverflow.com/questions/56725750/is-there-any-way-to-skip-go-build-if-the-binary-already-the-latest-build", "title": "is there any way to skip go build if the binary already the latest build", "body": "<p>I wrote a simple bash script to go build then run the binary   </p>\n\n<pre><code>go build -o my-binary\n./my-binary\n</code></pre>\n\n<p>Is there any way to find that my binary already the latest build (no code change)? </p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561297088, "post_id": 56723859, "comment_id": 100008818, "body": "Why do you think testing for Close being called would be &quot;a common task&quot;?"}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561312072, "post_id": 56723859, "comment_id": 100012727, "body": "I&#39;m not saying that everybody is doing TDD; but if you do, this is a common task as it needs to be closed, as the spec says."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561314170, "post_id": 56723859, "comment_id": 100013202, "body": "Just closing it is enough."}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1561314813, "post_id": 56723859, "comment_id": 100013365, "body": "Sorry, don&#39;t agree on that. By the way, could we please come back to the topic? Do you have a better solution?"}], "answers": [{"tags": [], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "is_accepted": false, "score": 0, "last_activity_date": 1589170283, "creation_date": 1589170283, "answer_id": 61722155, "question_id": 56723859, "link": "https://stackoverflow.com/questions/56723859/test-if-http-response-body-is-closed/61722155#61722155", "title": "Test if http.Response.Body is closed", "body": "<p>Try to read from the body to test if it was closed.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>r, err := http.Get(\"http://google.com\")\nr.Body.Close()\n\n_, err = r.Body.Read(nil)\nif err == nil {\n  // can still read from body so it's not closed\n\n} else if err != nil &amp;&amp; err.Error() == \"http: read on closed response body\" {\n  // body is already closed\n} \n</code></pre>\n\n<p>Unfortunately the returned error <a href=\"https://github.com/golang/go/blob/f4274e64aac99aaa9af05988f2f8c36c47554889/src/net/http/transport.go#L2636\" rel=\"nofollow noreferrer\">errReadOnClosedResBody</a> is not exported, so you'd have to compare the string value.</p>\n"}], "owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 876, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1589170375, "creation_date": 1561292762, "last_edit_date": 1589170375, "question_id": 56723859, "link": "https://stackoverflow.com/questions/56723859/test-if-http-response-body-is-closed", "title": "Test if http.Response.Body is closed", "body": "<p>I'm searching for an easy way to test that http.Response.Body.Close() was called.</p>\n\n<p>I already tried this by counting the number of open connections to the server (<a href=\"https://golang.org/src/net/http/serve_test.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/serve_test.go</a> - countCloseListener), but it seems that it only is testable on the client side, via rewriting the Roundtripper.</p>\n\n<p>So the following example works, but I'm wondering whether there is an easier way for such a common task...</p>\n\n<pre><code>package closing\n\nimport \"net/http\"\n\ntype MyClient struct {\n    Client http.Client\n}\n\nfunc (c *MyClient) Closing() (err error) {\n    res, err := c.Client.Get(\"http://localhost\")\n    defer res.Body.Close()\n    return\n}\n\nfunc (c *MyClient) NotClosing() (err error) {\n    _, err = c.Client.Get(\"http://localhost\")\n    return\n}\n</code></pre>\n\n<p><a href=\"https://github.com/elgohr/golang-test-body-close/blob/master/performsHttpRequest.go\" rel=\"nofollow noreferrer\">https://github.com/elgohr/golang-test-body-close/blob/master/performsHttpRequest.go</a></p>\n\n<pre><code>package closing_test\n\nimport (\n    \"github.com/elgohr/closing\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n    \"testing\"\n)\n\nfunc TestShouldBeClosedWhenClosed(t *testing.T) {\n    tripper := NewFakeRoundTripper()\n    cl := closing.MyClient{\n        Client: http.Client{\n            Transport: tripper,\n        },\n    }\n\n    if err := cl.Closing(); err != nil {\n        t.Error(err)\n    }\n\n    if !tripper.Body.Closed {\n        t.Error(\"Should be closed, but wasn't\")\n    }\n}\n\nfunc TestShouldBeOpenWhenNotClosed(t *testing.T) {\n    tripper := NewFakeRoundTripper()\n    cl := closing.MyClient{\n        Client: http.Client{\n            Transport: tripper,\n        },\n    }\n\n    if err := cl.NotClosing(); err != nil {\n        t.Error(err)\n    }\n\n    if tripper.Body.Closed {\n        t.Error(\"Should be open, but wasn't\")\n    }\n}\n\nfunc NewFakeRoundTripper() *FakeRoundTripper {\n    return &amp;FakeRoundTripper{\n        Body: &amp;FakeReadCloser{\n            ReadCloser: ioutil.NopCloser(strings.NewReader(\"content\")),\n        },\n    }\n}\n\ntype FakeRoundTripper struct {\n    Body *FakeReadCloser\n}\n\nfunc (r *FakeRoundTripper) RoundTrip(*http.Request) (*http.Response, error) {\n    return &amp;http.Response{\n        Body: r.Body,\n    }, nil\n}\n\ntype FakeReadCloser struct {\n    io.ReadCloser\n    Closed bool\n}\n\nfunc (r *FakeReadCloser) Close() error {\n    r.Closed = true\n    return r.ReadCloser.Close()\n}\n</code></pre>\n\n<p><a href=\"https://github.com/elgohr/golang-test-body-close/blob/master/performsHttpRequest_test.go\" rel=\"nofollow noreferrer\">https://github.com/elgohr/golang-test-body-close/blob/master/performsHttpRequest_test.go</a></p>\n"}, {"tags": ["go", "dll", "x86"], "comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561298269, "post_id": 56723616, "comment_id": 100009167, "body": "The <code>@12</code> is the size of the args, and tells you it needs to be declared with the <code>__stdcall</code> x86 calling convention  Or it might be <code>__fastcall</code>, IDK what Go uses (but something with callee pops, so it will return with an x86 asm <code>ret 12</code> instruction).  So <code>__stdcall func RVExtension(  args  );</code> might work for some compilers.  Or for GNU C compilers (gcc/clang), maybe <code>__attribute__((stdcall))</code>.  I don&#39;t have a Windows system to test this on, so not posting an answer."}], "owner": {"reputation": 11, "user_id": 11688098, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oRwo2LCQUQc/AAAAAAAAAAI/AAAAAAAABkQ/XepxkpBKIp4/photo.jpg?sz=128", "display_name": "Alexis 74", "link": "https://stackoverflow.com/users/11688098/alexis-74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561291015, "creation_date": 1561291015, "question_id": 56723616, "link": "https://stackoverflow.com/questions/56723616/export-go-function-to-c-illegal-character", "title": "Export go function to C - illegal character", "body": "<p>I need some assistance to export a GO dll function to a C program.</p>\n\n<p>The C program (wich i m not the author) required to call a function with this name: _RVExtension@12</p>\n\n<p>so, i simply declare my go function like this:</p>\n\n<pre><code>//export _RVExtension@12\nfunc _RVExtension@12(output *C.char, outputsize C.size_t, input *C.char) {Saisissez le code ici...\n</code></pre>\n\n<p>but when i try to compile it, it returns an illegal character U+0040 '@' error.</p>\n\n<p>Do you know if there is a workaround about this ? I m not familiar with C code and i don't understand why there is @12 in the function name.</p>\n\n<p>note: for the 64 bits the entry point is simple : RVExtension and it works perfectly well.</p>\n"}, {"tags": ["excel", "go", "encryption"], "answers": [{"tags": [], "owner": {"reputation": 427, "user_id": 6568632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf21ce78b7d4a6770c8130b5b6d35aa4?s=128&d=identicon&r=PG&f=1", "display_name": "Sean W", "link": "https://stackoverflow.com/users/6568632/sean-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1562424798, "creation_date": 1562424798, "answer_id": 56915177, "question_id": 56723388, "link": "https://stackoverflow.com/questions/56723388/go-is-it-possible-to-encrypt-excel-workbook/56915177#56915177", "title": "Go - is it possible to encrypt excel workbook", "body": "<p>After some research it seems there's no Go packages that can achieve this. However I've come across a npm package - <a href=\"https://github.com/ankane/secure-spreadsheet\" rel=\"nofollow noreferrer\">secure-spreadsheet</a> that is able to password protect an excel file.</p>\n\n<p>As I needed to program the password protect operation in Go, what i did was to trigger an os command in the Go code to invoke the npm package to password protect the file. </p>\n\n<p>The Go program is deployed &amp; executed in an alpine container, which i can install the <code>node-npm</code> and have access to <code>npx</code> command.</p>\n\n<p>code sample:</p>\n\n<pre><code>func passProtectExcelWorkbook(filename, outFilename string) error {\n    passwd := \"password\"\n    cat := exec.Command(\"cat\", filename)\n    excel := exec.Command(\"npx\", \"secure-spreadsheet\", \"--password\", passwd, \"--input-format\", excelExt)\n\n    file, err := os.Create(outFilename)\n    if err != nil {\n        return fmt.Errorf(\"error when creating excel file: %v err: %v\", outFilename, err)\n    }\n\n    defer file.Close()\n\n    excel.Stdin, err = cat.StdoutPipe()\n    if err != nil {\n        return fmt.Errorf(\"error when reading from cat command output: %v\", err)\n    }\n\n    excel.Stdout = file\n\n    if err := excel.Start(); err != nil {\n        return fmt.Errorf(\"error when starting npx command: %v\", err)\n    }\n\n    if err := cat.Run(); err != nil {\n        return fmt.Errorf(\"error when running cat command: %v\", err)\n    }\n\n    return excel.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 6568632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf21ce78b7d4a6770c8130b5b6d35aa4?s=128&d=identicon&r=PG&f=1", "display_name": "Sean W", "link": "https://stackoverflow.com/users/6568632/sean-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563345252, "creation_date": 1561289104, "question_id": 56723388, "link": "https://stackoverflow.com/questions/56723388/go-is-it-possible-to-encrypt-excel-workbook", "title": "Go - is it possible to encrypt excel workbook", "body": "<p>I have checked the <a href=\"https://godoc.org/github.com/360EntSecGroup-Skylar/excelize#File.ProtectSheet\" rel=\"nofollow noreferrer\">excelize</a> package, there's the <code>ProtectSheet</code> function. However this only protects the sheet from changes etc not protecting from the unauthorised access.</p>\n\n<p>I have look for several other options/packages and they don't seem to offer such capabilities.</p>\n\n<p>I know that ultimately I could still zip-password protect the excel file, but being able to protect the workbook itself is much preferable.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1561287010, "post_id": 56722856, "comment_id": 100006708, "body": "fmt.Sprintf will be much simpler, no?"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1561296958, "post_id": 56722856, "comment_id": 100008783, "body": "I&#39;d use fmt.Sprintf to do this kind of thing"}], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1561290198, "post_id": 56723159, "comment_id": 100007313, "body": "Thanks, sorry but I didnt understand the if ? sometimes it should get hardcoded value, you can see that on the <code>else</code>.."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 1, "creation_date": 1561290819, "post_id": 56723159, "comment_id": 100007472, "body": "@NinaS: If the map doesn&#39;t contain a value for <code>&quot;c_data&quot;</code> (<code>!ok</code>) then use the default value (<code>10</code>). &quot;The value of ok is true if the key x is present in the map, and false otherwise.&quot;: <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Index_expressions</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1561287761, "last_edit_date": 1561287761, "creation_date": 1561287242, "answer_id": 56723159, "question_id": 56722856, "link": "https://stackoverflow.com/questions/56722856/go-concatenate-string-with-int/56723159#56723159", "title": "GO concatenate string with int", "body": "<p>For readability, I would write:</p>\n\n<pre><code>cd, ok := cfg.ltrSharedDicts[\"c_data\"]\nif !ok {\n    cd = 10\n}\nout = append(out, fmt.Sprintf(\"fds data %dM\", cd))\n</code></pre>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 2, "accepted_answer_id": 56723159, "answer_count": 1, "score": 0, "last_activity_date": 1561291714, "creation_date": 1561284611, "last_edit_date": 1561284820, "question_id": 56722856, "link": "https://stackoverflow.com/questions/56722856/go-concatenate-string-with-int", "title": "GO concatenate string with int", "body": "<p>I\u2019ve the following code which needs to get int value and add it to a string with string suffix. E.g.</p>\n\n<p>At start I'm getting this</p>\n\n<pre><code>\"fds data \"\n</code></pre>\n\n<p>After the <code>if</code> statement it should like this </p>\n\n<pre><code>\"fds data 10 M\"\n</code></pre>\n\n<p>This is the code:</p>\n\n<pre><code>ltrCfg := \"fds data \"\nif len(cfg.ltrSharedDicts) &gt; 0 {\n    ltrCfg += strconv.Itoa(cfg.ltrSharedDicts[\"c_data\"])\n    ltrCfg += \"M\"\n} else {\n    ltrCfg += \"10M\"\n}\nout = append(out, ltrCfg)\n\nltrCert := \u201cfds data \"\nif len(cfg.ltrSharedDicts) &gt; 0 {\n    ltrCert += strconv.Itoa(cfg.ltrSharedDicts[\"d_data\"])\n    ltrCert += \"M\"\n} else {\n    ltrCert += \u201c20M\"\n}\nout = append(out, ltrCert)\n</code></pre>\n\n<p>The code is working but I wonder for the first fork of the if statement</p>\n\n<pre><code>if len(cfg.ltrSharedDicts) &gt; 0 {\n    ltrCfg += strconv.Itoa(cfg.ltrSharedDicts[\"c_data\"])\n    ltrCfg += \"M\"\n</code></pre>\n\n<p>Is there a better way to achieve it? </p>\n"}, {"tags": ["go", "closures", "code-duplication"], "answers": [{"comments": [{"owner": {"reputation": 545, "user_id": 5380027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/gMfFN.jpg?s=128&g=1", "display_name": "Mateusz", "link": "https://stackoverflow.com/users/5380027/mateusz"}, "edited": false, "score": 0, "creation_date": 1561303950, "post_id": 56722847, "comment_id": 100010682, "body": "Thanks, but what if I would like to use this method also to pass a slice of users? Is changing <code>User</code> arg to <code>interface{}</code> a good idea? And also is it better to send just <code>contentType</code>, not whole <code>r</code>? If I sent r, I would not have to read content type everytime I call responseBody"}, {"owner": {"reputation": 545, "user_id": 5380027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/gMfFN.jpg?s=128&g=1", "display_name": "Mateusz", "link": "https://stackoverflow.com/users/5380027/mateusz"}, "edited": false, "score": 0, "creation_date": 1561304044, "post_id": 56722847, "comment_id": 100010706, "body": "And <code>renderTemplate</code> also receives a template name as a second argument. Should I made the <code>responseBody</code> func to receive a template name as an arg? Or maybe that would be too much?"}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 1, "last_activity_date": 1561284467, "creation_date": 1561284467, "answer_id": 56722847, "question_id": 56722602, "link": "https://stackoverflow.com/questions/56722602/golang-http-server-return-html-or-json-depending-on-content-type/56722847#56722847", "title": "Golang http server return html or json depending on content type", "body": "<p>Although this is a code review question and should be in the CodeReview community, I\u2019ll try to answer it.</p>\n\n<p>Write a generic function that handles HTML and JSON rendering. The error handling IMO should happen on each handler even if you duplicate some code. It makes more sense there and makes the code more readable and explicit. You will soon see that there will be other errors that require special handling.</p>\n\n<p>On the logic, most APIs accept query parameters <code>http://api.com/user/1?fomtat=json</code>. This makes more sense because when a client accept more than content types you will be stuck.</p>\n\n<pre><code>const JSON = \"application/json\"\n\nfunc getUser(w http.ResponseWriter, r *http.Request) {\n    u, err := _getUser(r)\n    if err != nil {\n        http.NotFound(w, r)\n        return\n    }\n    responseBody(u, r.Header.Get(\"Content-type\"), &amp;w)\n}\n\nfunc responseBody(u User, contentType string, w io.writer) {\n    switch contentType {\n    case JSON:\n        w.Header().Set(\"Content-Type\", JSON)\n        json.NewEncoder(w).Encode(u) //asked for json, return json\n    default:\n        w.Header().Set(\"Content-Type\", \"text/html\")\n        renderTemplate(w, \"view\", u) // asked for html, return html\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 545, "user_id": 5380027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/gMfFN.jpg?s=128&g=1", "display_name": "Mateusz", "link": "https://stackoverflow.com/users/5380027/mateusz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2125, "favorite_count": 0, "accepted_answer_id": 56722847, "answer_count": 1, "score": 0, "last_activity_date": 1561284467, "creation_date": 1561282231, "question_id": 56722602, "link": "https://stackoverflow.com/questions/56722602/golang-http-server-return-html-or-json-depending-on-content-type", "title": "Golang http server return html or json depending on content type", "body": "<p>I am trying to write simple RESTful app in Golang using gorilla mux.\nI wrote few handlers that look as follows:</p>\n\n<pre><code>func getUser(w http.ResponseWriter, r *http.Request) {\n    if r.Header.Get(\"Content-type\") == \"application/json\" {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        u, err := _getUser(r)\n        if err != nil {\n            http.NotFound(w, r)\n            return\n        }\n        json.NewEncoder(w).Encode(u) //asked for json, return json\n    } else {\n        w.Header().Set(\"Content-Type\", \"text/html\")\n        u, err := _getUser(r)\n        if err != nil {\n            http.NotFound(w, r)\n            return\n        }\n        renderTemplate(w, \"view\", u) // asked for html, return html\n    }\n}\nfunc _getUser(r *http.Request) (*User, error) {\n    params := mux.Vars(r)\n    for _, u := range users {\n        if u.ID == params[\"id\"] {\n            return &amp;u, nil\n        }\n    }\n    return nil, errors.New(\"\")\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/v1/users/{id}\", getUser).Methods(\"GET\")\n}\n</code></pre>\n\n<p>The problem I got here is that I have got a lot of duplication. Every CRUD method would have to check for content type and return either json or html.</p>\n\n<p>I thought about writing a closure </p>\n\n<pre><code>func htmlOrJSON(fn func(http.ResponseWriter, *http.Request) (interface {}, error), templateName string) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        if r.Header.Get(\"Content-type\") == \"application/json\" {\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            result, err := fn(w, r)\n            if err != nil {\n                http.NotFound(w, r)\n                return\n            }\n            json.NewEncoder(w).Encode(result)\n        } else {\n            w.Header().Set(\"Content-Type\", \"text/html\")\n            result, err := fn(w, r)\n            if err != nil {\n                http.NotFound(w, r)\n                return\n            }\n            renderTemplate(w, templateName, result)\n        }\n    }\n}\n\n// and use as:\nrouter.HandleFunc(\"/v1/users/{id}\", htmlOrJSON(getUser, \"view\")).Methods(\"GET\")\n</code></pre>\n\n<p>To remove duplication but it also does not look well. Could anyone help me make this code cleaner?</p>\n"}, {"tags": ["go", "label", "prometheus", "metrics", "dynamically-generated"], "answers": [{"tags": [], "owner": {"reputation": 3320, "user_id": 3480808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbca64f49de22131b4b51fddfa8a7df4?s=128&d=identicon&r=PG", "display_name": "Michael Doubez", "link": "https://stackoverflow.com/users/3480808/michael-doubez"}, "is_accepted": false, "score": 0, "last_activity_date": 1561497664, "last_edit_date": 1561497664, "creation_date": 1561436569, "answer_id": 56746812, "question_id": 56722471, "link": "https://stackoverflow.com/questions/56722471/adding-metric-labels-in-prometheus-on-the-fly/56746812#56746812", "title": "Adding metric labels in prometheus on the fly", "body": "<p>You can use <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config\" rel=\"nofollow noreferrer\">relabel_config</a> or <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs\" rel=\"nofollow noreferrer\">metric_relabel_config</a> in your Prometheus config.</p>\n\n<p>It would look like the following:</p>\n\n<pre><code>- source_labels: [request_origin]\n  regex: 'http://(\\w+)/.*'\n  replacement: '${1}'\n  target_label: host\n</code></pre>\n\n<p>See also this <a href=\"https://www.robustperception.io/extracting-labels-from-legacy-metric-names\" rel=\"nofollow noreferrer\">article</a> showing usage of relabelling.</p>\n"}], "owner": {"reputation": 215, "user_id": 11021437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e77a941ee46253533bef4a1b3771bd2?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/11021437/anonymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1318, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561497664, "creation_date": 1561280814, "last_edit_date": 1561427936, "question_id": 56722471, "link": "https://stackoverflow.com/questions/56722471/adding-metric-labels-in-prometheus-on-the-fly", "title": "Adding metric labels in prometheus on the fly", "body": "<p>I have a counter metric in prometheus. I want to add lables to it dynamically for example if my request comes <code>http://abc123.com/{p1}</code> ,I want my custom_metric_name to store  <code>{statuscode=200, p1=p1Value , host=\"abc123\"}</code> and if request comes <a href=\"http://def123.com/\" rel=\"nofollow noreferrer\">http://def123.com/</a>{p2} . I want custom_metric_name to store <code>{statuscode=200, p2=p2Value , host=\"def123\"}</code> but <code>custom_metric_name</code> will be shared metric by both.</p>\n\n<p>I am trying still not able to get answer</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21, "user_id": 11687311, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-q_ZvbW1RJqM/AAAAAAAAAAI/AAAAAAAAABM/gLX8BgMGHm0/photo.jpg?sz=128", "display_name": "\u6167\u5fc3\u67ab", "link": "https://stackoverflow.com/users/11687311/%e6%85%a7%e5%bf%83%e6%9e%ab"}, "edited": false, "score": 0, "creation_date": 1561272800, "post_id": 56721676, "comment_id": 100003970, "body": "in my way\uff1a ctx.Done is a read-only chan,but when context is canceled, the done chan return zero value to select , but should exec fmt.Println(&quot;done),why not print"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1561274350, "creation_date": 1561274350, "answer_id": 56721816, "question_id": 56721676, "link": "https://stackoverflow.com/questions/56721676/different-about-withcancel-and-withtimeout-in-golangs-context/56721816#56721816", "title": "different about withcancel and withtimeout in golang&#39;s context", "body": "<p>\"<a href=\"https://medium.com/@parikshit/understanding-the-context-package-in-golang-b1392c821d14\" rel=\"nofollow noreferrer\">Understanding the context package in golang</a>\" from <a href=\"https://twitter.com/ParikshitAgni\" rel=\"nofollow noreferrer\">Parikshit Agnihotry</a>\n mentions:</p>\n\n<blockquote>\n  <h2><code>context.WithCancel(parent Context) (ctx Context, cancel CancelFunc)</code></h2>\n  \n  <p>This function creates a new context derived from the parent context that is passed in.<br>\n  The parent can be a background context or a context that was passed into the function.</p>\n  \n  <p>This returns a derived context and the cancel function.<br>\n  Only the function that creates this should call the cancel function to cancel this context.<br>\n  You can pass around the cancel function if you wanted to, but, that is highly not recommended. This can lead to the invoker of cancel not realizing what the downstream impact of canceling the context may be. There may be other contexts that are derived from this which may cause the program to behave in an unexpected fashion. In short, NEVER pass around the cancel function.</p>\n\n<pre><code>ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))\n</code></pre>\n  \n  <h2><code>context.WithDeadline(parent Context, d time.Time) (ctx Context, cancel CancelFunc)</code></h2>\n  \n  <p>This function returns a derived context from its parent that gets cancelled when the deadline exceeds or cancel function is called. </p>\n  \n  <p>For example, you can create a context that will automatically get canceled at a certain time in future and pass that around in child functions.<br>\n  <strong>When that context gets canceled because of deadline running out, all the functions that got the context get notified to stop work and return.</strong></p>\n</blockquote>\n\n<pre><code>ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))\n</code></pre>\n\n<blockquote>\n  <h2><code>context.WithTimeout(parent Context, timeout time.Duration) (ctx Context, cancel CancelFunc)</code></h2>\n  \n  <p>This function is similar to <code>context.WithDeadline</code>.<br>\n  <strong>The difference is that it takes in time duration as an input instead of the time object</strong>.<br>\n  This function returns a derived context that gets canceled if the cancel function is called or the timeout duration is exceeded.</p>\n\n<pre><code>ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))\n</code></pre>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>why dones't print 'done' when use withCancel but withTimeout does</p>\n</blockquote>\n\n<p>Probably because the Go program already exited before the goroutine has time to acknowledge the \"Done\" part.</p>\n"}], "owner": {"reputation": 21, "user_id": 11687311, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-q_ZvbW1RJqM/AAAAAAAAAAI/AAAAAAAAABM/gLX8BgMGHm0/photo.jpg?sz=128", "display_name": "\u6167\u5fc3\u67ab", "link": "https://stackoverflow.com/users/11687311/%e6%85%a7%e5%bf%83%e6%9e%ab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 845, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1561274427, "creation_date": 1561272530, "last_edit_date": 1561274427, "question_id": 56721676, "link": "https://stackoverflow.com/questions/56721676/different-about-withcancel-and-withtimeout-in-golangs-context", "title": "different about withcancel and withtimeout in golang&#39;s context", "body": "<p>I'm new in Golang and I have some confused about <code>WithCancel</code> and <code>WithTimeout</code> when I learn golang's context part. </p>\n\n<p>Show the code. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc someHandler() {\n    //ctx, cancel := context.WithCancel(context.Background())\n    ctx, cancel := context.WithTimeout(context.Background(),  2*time.Second)\n    go doSth(ctx)\n\n    time.Sleep(3 * time.Second)\n    cancel()\n}\n\nfunc doSth(ctx context.Context) {\n    var i = 1\n    for {\n        time.Sleep(1 * time.Second)\n        select {\n        case &lt;-ctx.Done():\n            fmt.Println(\"done\")\n            return\n        default:\n            fmt.Printf(\"work %d seconds: \\n\", i)\n        }\n        i++\n    }\n}\n\nfunc main() {\n    fmt.Println(\"start...\")\n    someHandler()\n    fmt.Println(\"end.\")\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>// when use WithCancel\n//\nstart...\nwork 1 seconds: \nwork 2 seconds: \nend.\n\n// when use WithTimeout\nstart...\nwork 1 seconds:\ndone\nend.\n</code></pre>\n\n<p>My question is: why doesn't it print '<code>done</code>' when I use <code>withCancel</code> but <code>withTimeout</code> does print it?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-textract"], "comments": [{"owner": {"reputation": 4878, "user_id": 106716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84b86f7e739f0826554499cef9e5862b?s=128&d=identicon&r=PG", "display_name": "ShawnMilo", "link": "https://stackoverflow.com/users/106716/shawnmilo"}, "edited": false, "score": 1, "creation_date": 1603984899, "post_id": 56719562, "comment_id": 114214288, "body": "Did you ever find a working example?  Amazon is amazing in that they generate gigabytes of documentation and none of it is actually useful."}], "answers": [{"tags": [], "owner": {"reputation": 5801, "user_id": 2586392, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9d89d4072afb4457b0c49131d8d258f5?s=128&d=identicon&r=PG", "display_name": "rpadovani", "link": "https://stackoverflow.com/users/2586392/rpadovani"}, "is_accepted": false, "score": 0, "last_activity_date": 1561459342, "creation_date": 1561459342, "answer_id": 56752208, "question_id": 56719562, "link": "https://stackoverflow.com/questions/56719562/send-s3-document-to-textract-using-go/56752208#56752208", "title": "Send S3 document to Textract using Go", "body": "<p>To start a job, you invoke <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/textract/#Textract.StartDocumentTextDetection\" rel=\"nofollow noreferrer\"><code>StartDocumentTextDetection</code></a>, using a <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/textract/#DocumentLocation\" rel=\"nofollow noreferrer\"><code>DocumentLocation</code></a> to specify the file, and you specify a SNS topic where Textract will publish a notification when it has finished to process your job.</p>\n\n<p>You have now two possibilities:</p>\n\n<ul>\n<li>Subscribe to the SNS topic, and when you receive a message retrieve the result</li>\n<li>Create a lambda function triggered by the SNS topic, which retrieves the result.</li>\n</ul>\n\n<p>The second option is IMO better 'cause it use less computation time (doesn't run until the job hasn't finished).</p>\n\n<p>To retrieve the job, you use <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/textract/#Textract.GetDocumentTextDetection\" rel=\"nofollow noreferrer\"><code>GetDocumentTextDetection</code></a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5194571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5d05cd1c7b212964035c699707d3171?s=128&d=identicon&r=PG", "display_name": "Michael Weber", "link": "https://stackoverflow.com/users/5194571/michael-weber"}, "is_accepted": false, "score": 0, "last_activity_date": 1606395357, "creation_date": 1606395357, "answer_id": 65022482, "question_id": 56719562, "link": "https://stackoverflow.com/questions/56719562/send-s3-document-to-textract-using-go/65022482#65022482", "title": "Send S3 document to Textract using Go", "body": "<p>If anyone else reaches this site searching for an answer:</p>\n<p>I understood the documentation as if I could just call the StartDocumentAnalysis function through the textract SDK but in fact what was missing is the fact that you need to create a new Session first and do the calls based on the session:</p>\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/textract/#New\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/textract/#New</a></p>\n"}], "owner": {"reputation": 425, "user_id": 3202399, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Vwd26.jpg?s=128&g=1", "display_name": "Indrid", "link": "https://stackoverflow.com/users/3202399/indrid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 396, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1606395357, "creation_date": 1561241893, "question_id": 56719562, "link": "https://stackoverflow.com/questions/56719562/send-s3-document-to-textract-using-go", "title": "Send S3 document to Textract using Go", "body": "<p>I'm trying to use Go to send objects in a S3 bucket to Textract and collect the response.</p>\n\n<p>I'm using the aws go sdk package and able to connect to my S3 bucket and list all the objects contained within. So far so good. I now need to be able to send one of those objects (a .pdf file) to Textract and collect the response(s).</p>\n\n<p>The AWS Go SDK content for interacting with Textract seem to be quite extensive but I cannot find a good example for how to do this. </p>\n\n<p>I would be very grateful for a sample or advice on how to do this.</p>\n"}, {"tags": ["go", "concurrency", "multiprocessing", "mutex"], "comments": [{"owner": {"reputation": 8810, "user_id": 1023553, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/EzEeL.png?s=128&g=1", "display_name": "NoDataFound", "link": "https://stackoverflow.com/users/1023553/nodatafound"}, "edited": false, "score": 0, "creation_date": 1561240040, "post_id": 56719359, "comment_id": 100000079, "body": "I can&#39;t answer for Go, but locking generally does not lock a variable: it simply add a barrier for thread that try to enter some specific part (&quot;protected&quot; by the mutex). And there are different kind of barrier."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1561241319, "post_id": 56719359, "comment_id": 100000289, "body": "A mutex locks itself and nothing more. It\u2019s a primitive with the same semantics in most every language, there\u2019s no other magic involved and there\u2019s nothing special about them in Go."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1561243063, "post_id": 56719359, "comment_id": 100000547, "body": "...and so, how you use them is, if there is some variable/object or <i>group</i> of variables/objects that need to be protected, you make sure that <i>every part</i> of your code that accesses them is guarded by a mutex."}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 1, "creation_date": 1561270423, "post_id": 56719945, "comment_id": 100003656, "body": "Aha! Now I finally got it; not the variable but the mutex is locked!"}], "tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": true, "score": 8, "last_activity_date": 1561246666, "creation_date": 1561246666, "answer_id": 56719945, "question_id": 56719359, "link": "https://stackoverflow.com/questions/56719359/how-does-a-mutex-lock-know-which-variables-to-lock/56719945#56719945", "title": "How does a mutex.Lock() know which variables to lock?", "body": "<blockquote>\n  <p>lock access to a certain resource, interact with it (read or write), and then unlock it for others again.</p>\n</blockquote>\n\n<p>Basically yes.</p>\n\n<blockquote>\n  <p>What puzzles me here is that there doesn't seem to be any connection between the mutex and the value it is supposed to lock.</p>\n</blockquote>\n\n<p>Mutex is just a mutual exclusion object that synchronizes access to a resource. That means, if two different goroutines want to lock the mutex, only the first can access it. The second goroutines now waits indefinitely until it can itself lock the mutex. There is no connection to variables whatsoever, you can use mutex however you want. For example only one http request, only one database read/write operation or only one variable assignment. While i don't advice the usage of mutex for those examples, the general idea should become clear.</p>\n\n<blockquote>\n  <p>but looking at this code it seems to somehow lock the whole program into doing only the lines below the lock, until the unlock is ran again.</p>\n</blockquote>\n\n<p>Not the whole program, only every goroutine who wants to access <strong>the same</strong> mutex waits until it can.</p>\n\n<blockquote>\n  <p>I suppose that means that all the other goroutines are paused for a moment until the unlock is ran again.</p>\n</blockquote>\n\n<p>No, they don't pause. They execute until they want to access the same mutex.</p>\n\n<p>If you want to group your mutex specifically with a variable, why not create a struct?</p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 56719945, "answer_count": 1, "score": -1, "last_activity_date": 1561246666, "creation_date": 1561239554, "question_id": 56719359, "link": "https://stackoverflow.com/questions/56719359/how-does-a-mutex-lock-know-which-variables-to-lock", "title": "How does a mutex.Lock() know which variables to lock?", "body": "<p>I'm a go-newbie, so please be gentle. </p>\n\n<p>So I've been using mutexes in some of my code for a couple weeks now. I understand the concept behind it: lock access to a certain resource, interact with it (read or write), and then unlock it for others again. </p>\n\n<p>The mutex code I use is mostly copy-paste-adjust. The code runs, but I'm still trying to wrap my head around it's internal working. Until now I've always used a mutex within a struct to lock the struct. Today I found <a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">this example</a> though, which made it completely unclear for me what the mutex actually locks. Below is a piece of the example code:</p>\n\n<pre><code>var state = make(map[int]int)\n\nvar mutex = &amp;sync.Mutex{}\n\nvar readOps uint64\nvar writeOps uint64\n\n// Here we start 100 goroutines to execute repeated reads against the state, once per millisecond in each goroutine.\nfor r := 0; r &lt; 100; r++ {\n    go func() {\n        total := 0\n        for {\n            key := rand.Intn(5)\n            mutex.Lock()\n            total += state[key]\n            mutex.Unlock()\n            atomic.AddUint64(&amp;readOps, 1)\n\n            time.Sleep(time.Millisecond)\n        }\n    }()\n}\n</code></pre>\n\n<p>What puzzles me here is that there doesn't seem to be any connection between the mutex and the value it is supposed to lock. Until today I thought that the mutex can lock a specific variable, but looking at this code it seems to somehow lock the whole program into doing only the lines below the lock, until the unlock is ran again. I suppose that means that all the other goroutines are paused for a moment until the unlock is ran again. Since the code is compiled I suppose it can know what variables are accessed between the <code>lock()</code> and the <code>unlock()</code>, but I'm not sure if that is the case.</p>\n\n<p>If all other programs pause for a moment, it doesn't sound like real multi-processing, so I'm guessing I don't have a good understanding of what's going on.</p>\n\n<p>Could anybody help me out in understanding how the computer knows which variables it should lock?</p>\n"}, {"tags": ["go", "sqlx"], "answers": [{"comments": [{"owner": {"reputation": 477, "user_id": 7047456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b50238281fc05d33c8a5b17492cb560?s=128&d=identicon&r=PG&f=1", "display_name": "Mozhi", "link": "https://stackoverflow.com/users/7047456/mozhi"}, "edited": false, "score": 0, "creation_date": 1561268398, "post_id": 56719181, "comment_id": 100003383, "body": "Thank you for the response, however am getting following error while scanning , s:&quot;sql: expected 8 destination arguments in Scan, not 1&quot; . Can you please let me know what am doing wrong ? Thank you"}], "tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 1, "last_activity_date": 1561237503, "creation_date": 1561237503, "answer_id": 56719181, "question_id": 56718043, "link": "https://stackoverflow.com/questions/56718043/how-to-convert-sqlx-query-results-to-an-array-of-structs/56719181#56719181", "title": "How to convert sqlx query results to an array of structs?", "body": "<p>you can use the following:</p>\n\n<pre><code>for rows.Next() {\n    s := CustomData{}\n    if err := rows.Scan(&amp;s); err != nil {\n        return err\n    }\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>and you can always use ORM library as <a href=\"https://gorm.io/\" rel=\"nofollow noreferrer\">gorm</a>  if you like code first approach or <a href=\"https://github.com/volatiletech/sqlboiler\" rel=\"nofollow noreferrer\">sqlboiler</a> if you like DB first approach </p>\n"}, {"tags": [], "owner": {"reputation": 274, "user_id": 6738828, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WfJK-1Ftvr4/AAAAAAAAAAI/AAAAAAAAAJQ/nJ_xC9x09b8/photo.jpg?sz=128", "display_name": "Filip Wojciechowski", "link": "https://stackoverflow.com/users/6738828/filip-wojciechowski"}, "is_accepted": true, "score": 4, "last_activity_date": 1561316836, "creation_date": 1561316836, "answer_id": 56727017, "question_id": 56718043, "link": "https://stackoverflow.com/questions/56718043/how-to-convert-sqlx-query-results-to-an-array-of-structs/56727017#56727017", "title": "How to convert sqlx query results to an array of structs?", "body": "<ol>\n<li><p>You don't need to rename the fields in the query, since you're defining the actual DB fields in the struct tags.</p></li>\n<li><p>If you want to scan directly to the slice of CustomData and if you are using SQLX, you should use the SQLX specific Select method, rather than the generic SQL Query.  Slightly modified relevant example from the illustrated guide to SQLX (<a href=\"https://jmoiron.github.io/sqlx/#getAndSelect\" rel=\"nofollow noreferrer\">https://jmoiron.github.io/sqlx/#getAndSelect</a>):</p></li>\n</ol>\n\n<pre><code>    pp := []Place{}\n    err = db.Select(&amp;pp, \"SELECT * FROM place\")\n</code></pre>\n\n<p>So in your case:</p>\n\n<pre><code>    myData := []CustomData\n    err = db.Select(&amp;myData, \"SELECT * FROM myschema.my_table\")\n</code></pre>\n"}], "owner": {"reputation": 477, "user_id": 7047456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b50238281fc05d33c8a5b17492cb560?s=128&d=identicon&r=PG&f=1", "display_name": "Mozhi", "link": "https://stackoverflow.com/users/7047456/mozhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2832, "favorite_count": 0, "accepted_answer_id": 56727017, "answer_count": 2, "score": 2, "last_activity_date": 1561316836, "creation_date": 1561227782, "question_id": 56718043, "link": "https://stackoverflow.com/questions/56718043/how-to-convert-sqlx-query-results-to-an-array-of-structs", "title": "How to convert sqlx query results to an array of structs?", "body": "<p>I am trying to query all the results from a postgres table without where condition and map it with array of structs with the help of sqlx db Query by passing the args ...interface {}.</p>\n\n<p>But the code pasted below never works, Instead of iterating and scanning the result one by one , is it possible to get the following code work ??</p>\n\n<p>Inputs are much appreciated . Thank you</p>\n\n<pre><code>type CustomData struct {\n    ID                        string `db:\"id\" json:\",omitempty\"`\n    Name                      string `db:\"name\" json:\",omitempty\"`\n    Description               string `db:\"description\" json:\",omitempty\"`\n    SourceID                  string `db:\"sourceid\" json:\",omitempty\"`\n    StatusID                  string `db:\"statusid\" json:\",omitempty\"`\n    StatusReason              string `db:\"statusreason\" json:\",omitempty\"`\n    CreateTime                string `db:\"createtime\" json:\",omitempty\"`\n    UpdateTime                string `db:\"updatetime\" json:\",omitempty\"`\n}\n\nvar myData []CustomData\n\n*sqlx.DB.Query(\"SELECT id as ID,  name as Name, description as Description, sourceid as SourceID, statusid as StatusID, statusreason as StatusReason, createtime as CreateTime, updatetime as UpdateTime FROM myschema.my_table\", &amp;myData)\n\n// tried with following statement but din't work either\n// *sqlx.DB.Query(\"SELECT * FROM myschema.my_table\", &amp;myData)\n\n    for _, data := range myData {\n        fmt.Println(\"--\", data)\n    }\n</code></pre>\n\n<p>Expected results:</p>\n\n<p>--- CustomData{1,x,x,x,x}\n--- CustomData{2,x,x,x,x}</p>\n\n<p>Actual:\n  Nothing..</p>\n"}, {"tags": ["scala", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 143, "user_id": 4832005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df59226bf6ae50044760cbf84174f557?s=128&d=identicon&r=PG&f=1", "display_name": "BranY", "link": "https://stackoverflow.com/users/4832005/brany"}, "edited": false, "score": 0, "creation_date": 1561218600, "post_id": 56716841, "comment_id": 99995545, "body": "in client(golang), use concurrent programming, this stage proto is only read, not exist writing, this error rate in server(scala) is 0.5%"}], "owner": {"reputation": 143, "user_id": 4832005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df59226bf6ae50044760cbf84174f557?s=128&d=identicon&r=PG&f=1", "display_name": "BranY", "link": "https://stackoverflow.com/users/4832005/brany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561218330, "creation_date": 1561218330, "question_id": 56716841, "link": "https://stackoverflow.com/questions/56716841/protobuf-unmarshal-error-in-scala-throw-a-com-google-protobuf-invalidprotocolbu", "title": "protobuf unmarshal error in scala, throw a com.google.protobuf.InvalidProtocolBufferException", "body": "<p>in client(golang), i use protobuf to marshal a message into byte array, in server(scala), i use same proto  <code>parseFrom</code> this byte array, get an error:</p>\n\n<p>com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.</p>\n"}, {"tags": ["go", "build", "dependencies", "go-modules"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1561212168, "post_id": 56716040, "comment_id": 99994134, "body": "What commands do you use exactly? Did you maybe name your module <code>main.go</code>?"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1561216458, "post_id": 56716040, "comment_id": 99995070, "body": "Thanks @JimB. This is the issue. I just ran <code>go mod init</code> and it created the module with name <code>main.go</code>. Running <code>go build</code> is then overriding the <code>main.go</code> file. Changing the module name to main (or anything other than main.go) solved the issue."}], "answers": [{"tags": [], "owner": {"reputation": 312, "user_id": 4071461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/195116dca64969be94c447d3403dd15f?s=128&d=identicon&r=PG", "display_name": "kasvith", "link": "https://stackoverflow.com/users/4071461/kasvith"}, "is_accepted": false, "score": 2, "last_activity_date": 1561269493, "creation_date": 1561269493, "answer_id": 56721414, "question_id": 56716040, "link": "https://stackoverflow.com/questions/56716040/go-module-main-go-file-is-being-overwritten-after-go-build/56721414#56721414", "title": "Go Module : main.go file is being overwritten after go build", "body": "<p>The module name should not be main.go as it is a file inside a package. Please use your project name for module name in <code>go mod init</code>. </p>\n\n<p>For example, if your project root is hello, name your package hello, not <code>main.go</code>.\nAlso if you want to use the module over and over again, please consider using your repository name as the module name.</p>\n\n<p>Go handles packages not individual files. Go modules are used to organize packages. Know more in <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">official documentation</a></p>\n"}], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561269493, "creation_date": 1561211718, "question_id": 56716040, "link": "https://stackoverflow.com/questions/56716040/go-module-main-go-file-is-being-overwritten-after-go-build", "title": "Go Module : main.go file is being overwritten after go build", "body": "<p>I am facing an weird issue where after vendorising my dependencies with go modules, go build command is overriding the main.go file with random data.</p>\n\n<p>Start of the file looks like this:</p>\n\n<pre><code>\ufffd\ufffd\ufffd\ufffd\nH\nH__PAGEZEROx__TEXTpxpx__text__TEXT\u0010\ufffd\ufffd7\u0010\ufffd__rodata__TEXT\ufffd\ufffd7Y\ufffd\ufffd7__symbol_stub1__TEXT\ufffdV\ufffd\ufffdV\ufffd__typelink__TEXT\ufffdV\ufffd(\ufffdV__itablink__TEXTP@V\ufffd\nP@V__gosymtab__TEXT\ufffdJV\ufffdJV__gopclntab__TEXTKV\n\"KV\ufffd__DATApx\ufffd|px c\n__nl_symbol_ptr__DATApx\ufffdpxs__noptrdata__DATA\ufffdsx\ufffd\ufffd\ufffdsx__data__DATA\ufffd&amp;{\ufffd\ufffd\ufffd&amp;{__bss__DATA \ufffd{\ufffd\ufffd__noptrbss__DATA\ufffd}\ufffd2__DWARF\ufffd}\ufffd{\ufffd\ufffd   __zdebug_abbrev__DWARF\ufffd}\ufffd{__zdebug_line__DWARF\ufffd}'W\ufffd{__zdebug_frame__DWARF;H\ufffd\ufffd\ufffd;8\ufffd__zdebug_pubname__DWARF\ufffd\u0685\ufffdK\ufffd\u0283__zdebug_pubtype__DWARF\ufffd&amp;\ufffd\ufffd\ufffd\ufffd__debug_gdb_scri__DWARF\ufffd\ufffd6\ufffd\u04c4__zdebug_info__DWARF\ufffd\ufffd\ufffd\n\ufffd\u04c4__zdebug_loc__DWARF\u4251\ufffd\ufffdy\ufffd__zdebug_ranges__DWARFU\ufffd\ufffdZE\ufffdH__LINKEDIT\ufffd}L\ufffd\ufffd\ufffdL\ufffd\ufffd*\ufffd\ufffd\ufffd\ufffd\ufffd,\ufffdr\ufffd\ufffd\ufffd\u000bPu,u,x,xo\ufffd\ufffd\u000e \f/usr/lib/dyld\f8/usr/lib/libSystem.B.dylib\fh/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation\f`/System/Library/Frameworks/Security.framework/Versions/A/Security$\u0010\n\n\ufffd Go build ID: \"OLftMbjtv5aWMkI_0qrD/LhWRtD0wcaKFWRYSDOa9/7dFWcNOQ4BpWWqZQW07D/pkR9ABiz-SHIBaJIZ1ur\"\n \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdUH\ufffd\ufffdAWAVATSH\ufffd\ufffd\ufffd=|I\ufffd\ufffd\n</code></pre>\n\n<p>Go version: go version <code>go1.12.5 darwin/amd64</code></p>\n\n<p>Enabled Go moduled with <code>export GO111MODULE=on</code></p>\n\n<p>Folder structure:\ngo.mod  go.sum  log.go  main.go vendor</p>\n\n<p>FYI: only main.go is being overwritten, not log.go.</p>\n\n<p>Go module initialised with <code>go mod init</code></p>\n\n<p>App vendorised with <code>go mod vendor</code></p>\n\n<p>Not sure if I am doing something wrong. Any help is appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 1, "creation_date": 1561204274, "post_id": 56714851, "comment_id": 99992543, "body": "Do you have a specific reason for using <code>uint8</code> and <code>int8</code>? Their use is typically considered <a href=\"https://tour.golang.org/basics/11\" rel=\"nofollow noreferrer\">unidiomatic</a> in Go: \u201c<i>The <code>int</code>, <code>uint</code>, and <code>uintptr</code> types are usually 32 bits wide on 32-bit systems and 64 bits wide on 64-bit systems. When you need an integer value you should use <code>int</code> unless you have a specific reason to use a sized or unsigned integer type.</i>\u201d"}, {"owner": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "reply_to_user": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 1, "creation_date": 1561206753, "post_id": 56714851, "comment_id": 99993052, "body": "@MTCoster yes, because I&#39;m sending packets over a network."}], "answers": [{"comments": [{"owner": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "edited": false, "score": 0, "creation_date": 1561207127, "post_id": 56715295, "comment_id": 99993134, "body": "It doesn&#39;t matter if the type is <code>uint8</code> or <code>uint32</code>, you can try."}, {"owner": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "edited": false, "score": 0, "creation_date": 1561207258, "post_id": 56715295, "comment_id": 99993158, "body": "Anyways, my question is more about how to subtract from unsigned integers when the value (sometimes you want to add and sometimes subtract) is coming from an argument (that must be a signed type) which makes it so that you have to do type conversion before subtracting/adding."}, {"owner": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "edited": false, "score": 0, "creation_date": 1561212591, "post_id": 56715295, "comment_id": 99994226, "body": "&quot;You may using both int8&quot; - the value I&#39;m subtracting/adding to must be <code>uint16</code>. The original post gives me the wanted result, I am looking for a more idiomatic way (because it looks like a hack)."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "edited": false, "score": 1, "creation_date": 1561214995, "post_id": 56715295, "comment_id": 99994753, "body": "No it&#39;s not a hack, this is the way to go ( idiomatic way). So be it, and use <code>uint16</code>"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1561208258, "last_edit_date": 1561208258, "creation_date": 1561204857, "answer_id": 56715295, "question_id": 56714851, "link": "https://stackoverflow.com/questions/56714851/converting-negative-numbers/56715295#56715295", "title": "Converting negative numbers", "body": "<p>Since the type is unsigned it is an <a href=\"https://play.golang.org/p/DyxKn8TrS4r\" rel=\"nofollow noreferrer\"><strong>overflow</strong></a>:<br>\n<code>uint8(b)</code> is <code>248</code>, so <code>a + uint8(b)</code> is <code>10+248=258=256+2 =&gt; 2</code> </p>\n\n<blockquote>\n  <p>my question is more about how to subtract from unsigned integers when\n  the value (sometimes you want to add and sometimes subtract) is coming\n  from an argument (that must be a signed type) which makes it so that\n  you have to do type conversion before subtracting/adding.</p>\n</blockquote>\n\n<p>You may using both <code>int8</code>:</p>\n\n<pre><code>\n    a := int8(10)\n    b := int8(-8)\n    fmt.Println(a + b) // 2\n    fmt.Println(a - b) // 18\n</code></pre>\n\n<p>You may avoid the overflow, like <a href=\"https://play.golang.org/p/yFsXC8m-nt-\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>    a := uint8(10)\n    b := int8(-8)\n    c := uint8(b)\n    d := uint16(a) + uint16(c)\n    fmt.Println(d) // 258\n</code></pre>\n\n<hr>\n\n<p>You should remove 3-pair of superfluous Parentheses here:</p>\n\n<blockquote>\n  <p>a := (uint8)(10)<br>\n  b := (int8)(-8)<br>\n  fmt.Println(a + (uint8)(b))</p>\n</blockquote>\n\n<p>Use this:  </p>\n\n<pre><code>a := uint8(10)\nb := int8(-8)\nfmt.Println(a + uint8(b))\n</code></pre>\n\n<hr>\n\n<p>See:<br>\n<a href=\"https://stackoverflow.com/questions/55719813/confusion-about-convert-uint8-to-int8\">confusion about convert `uint8` to `int8`</a></p>\n"}], "owner": {"reputation": 223, "user_id": 10337686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/603f74483866e9de4db7500284262089?s=128&d=identicon&r=PG&f=1", "display_name": "sornbro", "link": "https://stackoverflow.com/users/10337686/sornbro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 677, "favorite_count": 0, "accepted_answer_id": 56715295, "answer_count": 1, "score": 0, "last_activity_date": 1566315869, "creation_date": 1561200693, "last_edit_date": 1566315869, "question_id": 56714851, "link": "https://stackoverflow.com/questions/56714851/converting-negative-numbers", "title": "Converting negative numbers", "body": "<p>When converting a negative number to an unsigned integer and later adding that value it results in subtracting.</p>\n\n<pre><code>a := (uint8)(10)\nb := (int8)(-8)\nfmt.Println(a + (uint8)(b)) // result: 2\n</code></pre>\n\n<p>Is this an idiomatic approach or should it be done more explicitly?</p>\n"}, {"tags": ["c#", "go", "aes", "rijndael"], "comments": [{"owner": {"reputation": 3891, "user_id": 9456781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdM55.jpg?s=128&g=1", "display_name": "Tobias Tengler", "link": "https://stackoverflow.com/users/9456781/tobias-tengler"}, "edited": false, "score": 0, "creation_date": 1561195918, "post_id": 56714284, "comment_id": 99990879, "body": "And what exactly is the issue?"}, {"owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "reply_to_user": {"reputation": 3891, "user_id": 9456781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdM55.jpg?s=128&g=1", "display_name": "Tobias Tengler", "link": "https://stackoverflow.com/users/9456781/tobias-tengler"}, "edited": false, "score": 0, "creation_date": 1561196006, "post_id": 56714284, "comment_id": 99990891, "body": "This is sent over an API and the response will go through a decrypt function - but i&#39;m unable to decrypt it - but i&#39;m confused if this is because of the my encryption messing up"}, {"owner": {"reputation": 3891, "user_id": 9456781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdM55.jpg?s=128&g=1", "display_name": "Tobias Tengler", "link": "https://stackoverflow.com/users/9456781/tobias-tengler"}, "edited": false, "score": 0, "creation_date": 1561196074, "post_id": 56714284, "comment_id": 99990898, "body": "If the problem occurs while decrypting, wouldn&#39;t it be good to include the decrypt code as well?"}, {"owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "reply_to_user": {"reputation": 3891, "user_id": 9456781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdM55.jpg?s=128&g=1", "display_name": "Tobias Tengler", "link": "https://stackoverflow.com/users/9456781/tobias-tengler"}, "edited": false, "score": 0, "creation_date": 1561196287, "post_id": 56714284, "comment_id": 99990951, "body": "@TobiasTengler - you&#39;re right. Edited"}, {"owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "edited": false, "score": 0, "creation_date": 1561207802, "post_id": 56714284, "comment_id": 99993282, "body": "Works over here. What is the error you get?"}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1561963130, "post_id": 56826199, "comment_id": 100214070, "body": "I would like to add that \u201estronger\u201c is not a proper description of the difference between CFB and GCM and that CFB holds at least one advantage over GCM: partial reconstruction should the cyphertext be corrupted."}, {"owner": {"reputation": 166, "user_id": 9264788, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-exhMuJLXtxA/AAAAAAAAAAI/AAAAAAAAAIE/AEAjeJQ6eTQ/photo.jpg?sz=128", "display_name": "Brian Williams", "link": "https://stackoverflow.com/users/9264788/brian-williams"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1561990588, "post_id": 56826199, "comment_id": 100227029, "body": "Can that really be said to be an advantage? If you start decrypting something without first verifying the integrity, then you are open to the possibility of chosen-ciphertext attacks. I&#39;ll edit to clarify that the main advantage of GCM is authenticated encryption."}], "tags": [], "owner": {"reputation": 166, "user_id": 9264788, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-exhMuJLXtxA/AAAAAAAAAAI/AAAAAAAAAIE/AEAjeJQ6eTQ/photo.jpg?sz=128", "display_name": "Brian Williams", "link": "https://stackoverflow.com/users/9264788/brian-williams"}, "is_accepted": true, "score": 3, "last_activity_date": 1562448071, "last_edit_date": 1562448071, "creation_date": 1561909995, "answer_id": 56826199, "question_id": 56714284, "link": "https://stackoverflow.com/questions/56714284/golang-encrypting-data-using-aes/56826199#56826199", "title": "Golang encrypting data using AES", "body": "<p>There's a few problems with the code you posted.</p>\n\n<ol>\n<li>Don't store the key in a byte array, because that means that you are hard-coding it. Instead generate a random 256-bit key, encode it to a hex string, then store that <em>outside</em> of your program and read it in using a config library like <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">viper</a>.</li>\n<li>Don't hard-code the IV. You should be generating a new IV for every single message. Reusing the same IV weakens your encryption significantly. For every message that you encrypt, generate a random IV and prepend it to the message. When you attempt to decrypt it, read the IV off of the first n bytes and then decrypt.</li>\n<li>You should use authenticated encryption as a measure of protection against chosen ciphertext attacks. GCM mode provides authentication for you.</li>\n</ol>\n\n<p>Here is an example. <a href=\"https://play.golang.org/p/U_0pk7on1FV\" rel=\"nofollow noreferrer\">Playground Link</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"crypto/rand\"\n    \"encoding/hex\"\n    \"fmt\"\n    \"os\"\n)\n\nvar (\n    key       = randBytes(256 / 8)\n    gcm       cipher.AEAD\n    nonceSize int\n)\n\n// Initilze GCM for both encrypting and decrypting on program start.\nfunc init() {\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        fmt.Printf(\"Error reading key: %s\\n\", err.Error())\n        os.Exit(1)\n    }\n\n    fmt.Printf(\"Key: %s\\n\", hex.EncodeToString(key))\n\n    gcm, err = cipher.NewGCM(block)\n    if err != nil {\n        fmt.Printf(\"Error initializing AEAD: %s\\n\", err.Error())\n        os.Exit(1)\n    }\n\n    nonceSize = gcm.NonceSize()\n}\n\nfunc randBytes(length int) []byte {\n    b := make([]byte, length)\n    rand.Read(b)\n    return b\n}\n\nfunc encrypt(plaintext []byte) (ciphertext []byte) {\n    nonce := randBytes(nonceSize)\n    c := gcm.Seal(nil, nonce, plaintext, nil)\n    return append(nonce, c...)\n}\n\nfunc decrypt(ciphertext []byte) (plaintext []byte, err error) {\n    if len(ciphertext) &lt; nonceSize {\n        return nil, fmt.Errorf(\"Ciphertext too short.\")\n    }\n    nonce := ciphertext[0:nonceSize]\n    msg := ciphertext[nonceSize:]\n    return gcm.Open(nil, nonce, msg, nil)\n}\n\nfunc main() {\n    fmt.Println(\"Encrypting...\")\n    msg := []byte(\"The quick brown fox jumped over the lazy dog.\")\n    ciphertext := encrypt(msg)\n    fmt.Printf(\"Encrypted message: %v\\n\", ciphertext)\n\n    fmt.Println(\"Decrypting...\")\n    plaintext, err := decrypt(ciphertext)\n    if err != nil {\n        // Don't display this message to the end-user, as it could potentially\n        // give an attacker useful information. Just tell them something like \"Failed to decrypt.\"\n        fmt.Printf(\"Error decryping message: %s\\n\", err.Error())\n        os.Exit(1)\n    }\n    fmt.Printf(\"Decrypted message: %s\\n\", string(plaintext))\n}\n</code></pre>\n"}], "owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2055, "favorite_count": 1, "accepted_answer_id": 56826199, "answer_count": 1, "score": 0, "last_activity_date": 1562448071, "creation_date": 1561195744, "last_edit_date": 1561197337, "question_id": 56714284, "link": "https://stackoverflow.com/questions/56714284/golang-encrypting-data-using-aes", "title": "Golang encrypting data using AES", "body": "<p>I'm not sure if this is the right place to ask this. But I have no experience with C# and have been tasked to convert a security piece of code to Golang</p>\n\n<p>I was wondering if i'm missing out on something here. </p>\n\n<p>The C# code uses a <code>Rijndael</code> class to encrypt a bit of data. The <code>key</code> value and <code>iv</code> value is written out in the byte code like this</p>\n\n<pre><code>   public static byte[] Key = new byte[]{0xx, 0xx, 0xx, 0xx, 0xx,\n                    0xx4, 0xxx, 0xxx, 0xxx, 0xxx, xxx, 0xxx,\n                    0xxx, 0xxx, 0xxx, 0xxx};\n</code></pre>\n\n<p><code>public static byte[] IV = new byte[] // save structure as above with 16 in length</code></p>\n\n<p>then theres a bit of code which does this</p>\n\n<pre><code>Rijndael alg = Rijndael.Create();\n                alg.Key = Key;\n                alg.IV = IV;\n                CryptoStream cs = new CryptoStream(ms,\n                alg.CreateEncryptor(), CryptoStreamMode.Write);\n                cs.Write(dataWithoutHeader, 0, dataWithoutHeader.Length);\n                cs.Close();\n</code></pre>\n\n<p>the function sends out <code>byte[] data</code> as output</p>\n\n<p>I'm trying to mimic this is <code>golang</code> like this</p>\n\n<pre><code>func StartEncryption(message []byte) []byte {\n    var key = []byte {// same as C# } \n\n    var iv = []byte{ // same as C# }\n\n    var err error\n    fmt.Printf(\"\\n length of key %+v \\n, \\n length of iv \\n %+v \\n\", len(key), len(iv))\n    // Encrypt\n    encrypted := make([]byte, len(message))\n    err = EncryptAESCFB(encrypted, []byte(message), key, iv)\n    if err != nil {\n        panic(err)\n    }\n    return encrypted\n}\n</code></pre>\n\n<p>The Encryption function</p>\n\n<pre><code>func EncryptAESCFB(dst, src, key, iv []byte) error {\n    aesBlockEncrypter, err := aes.NewCipher([]byte(key))\n    if err != nil {\n        return err\n    }\n    aesEncrypter := cipher.NewCFBEncrypter(aesBlockEncrypter, iv)\n    aesEncrypter.XORKeyStream(dst, src)\n    return nil\n}\n</code></pre>\n\n<p>The output of this is sent over an API whose output needs to be decrypted. I'm using this below</p>\n\n<pre><code>func decryptMessage(message []byte)error{\n    var key = []byte{ // same as C# }\n\n    var iv = []byte{ // same as C#  }\n\n    // Remove the head part of the response (45 bytes)\n    responseBody := message[45:]\n\n    decrypted := make([]byte, len(responseBody))\n\n    err := DecryptAESCFB(decrypted, responseBody, key, iv)\n\n    if err != nil {\n        fmt.Printf(\"\\n error : \\n %+v \\n\", err)\n    }\n    return nil\n}\n\nfunc DecryptAESCFB(dst, src, key, iv []byte) error {\n    aesBlockDecrypter, err := aes.NewCipher([]byte(key))\n    if err != nil {\n        return nil\n    }\n    aesDecrypter := cipher.NewCFBDecrypter(aesBlockDecrypter, iv)\n    aesDecrypter.XORKeyStream(dst, src)\n    return nil\n}\n</code></pre>\n\n<p>The decryptor gives me gibberish - Am i going wrong somewhere?</p>\n\n<p>My question boils down to 2 questions</p>\n\n<ol>\n<li><p>Would the C# function using the <code>rijndael</code> class and the golang functiony yield the same output or should i be doing something more/less</p></li>\n<li><p>Is the byte array the right data to store the key, IV in - i.e its not the same used in C# when copied to GO</p></li>\n</ol>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1561195050, "post_id": 56714188, "comment_id": 99990710, "body": "<code>I think the main() routine should be blocked after cubeChan &lt;- testNum</code> Why? There is no reason to."}, {"owner": {"reputation": 1, "user_id": 10228391, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nRF7nw4xNck/AAAAAAAAAAI/AAAAAAAAAAw/bgSkagsFr4U/photo.jpg?sz=128", "display_name": "Daniel Guo", "link": "https://stackoverflow.com/users/10228391/daniel-guo"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1561195288, "post_id": 56714188, "comment_id": 99990757, "body": "@tkausl  In my opinion, cubeChan is a channel of capacity 0. sending an element to a full channel should cause blocking."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1561195346, "post_id": 56714188, "comment_id": 99990773, "body": "The other goroutine is blocked reading on the channel, so the send succeeds immediately."}, {"owner": {"reputation": 1, "user_id": 10228391, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nRF7nw4xNck/AAAAAAAAAAI/AAAAAAAAAAw/bgSkagsFr4U/photo.jpg?sz=128", "display_name": "Daniel Guo", "link": "https://stackoverflow.com/users/10228391/daniel-guo"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1561195777, "post_id": 56714188, "comment_id": 99990849, "body": "but in the same case, why <code>[main] resuming (6)</code> is after <code>[square] calc (5)</code>, while <code>square()</code> is blocked reading on the channel squareChan."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1561195891, "post_id": 56714188, "comment_id": 99990876, "body": "Its blocked <i>writing</i>, because main isn&#39;t reading."}], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": 0, "last_activity_date": 1561213131, "creation_date": 1561213131, "answer_id": 56716208, "question_id": 56714188, "link": "https://stackoverflow.com/questions/56714188/scheduling-of-multiple-goroutines/56716208#56716208", "title": "Scheduling of multiple goroutines", "body": "<blockquote>\n  <p>I think the main() routine should be blocked after cubeChan &lt;- testNum</p>\n</blockquote>\n\n<p>it does block, but at these:</p>\n\n<pre><code>squareVal, cubeVal := &lt;-squareChan, &lt;-cubeChan\n                      ^             ^\n</code></pre>\n\n<p>if either <code>squareChan</code> or <code>cubeChan</code> doesn't receive any values in other routines, that line will become deadlock, modify <code>cube()</code> like below to see the effect:</p>\n\n<pre><code>func cube(c chan int) {\n    fmt.Println(\"[cube] reading (3)\")\n    _ = &lt;-c\n    fmt.Println(\"[cube] calc (11)\")\n    // c &lt;- num * num * num\n    fmt.Println(\"back from [cube] (12)\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24, "user_id": 5627808, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a68EYpAhOO4/AAAAAAAAAAI/AAAAAAAAAHo/dX0BlzR3DBQ/photo.jpg?sz=128", "display_name": "Hayhay G", "link": "https://stackoverflow.com/users/5627808/hayhay-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1563548795, "creation_date": 1563548795, "answer_id": 57115202, "question_id": 56714188, "link": "https://stackoverflow.com/questions/56714188/scheduling-of-multiple-goroutines/57115202#57115202", "title": "Scheduling of multiple goroutines", "body": "<p>I think you're misunderstanding con-current code.</p>\n\n<p>But, channels only block flow if they have nothing to output or if they're full. And channels can only get full if you specify a size.</p>\n\n<p>I also dont recommend using the same channel for input and output for a function</p>\n\n<p>With your current method you could run into trouble here</p>\n\n<pre><code>cubeChan &lt;- testNum \n\nfmt.Println(\"[main] resuming (8)\")\nfmt.Println(\"[main] reading from channels (9)\")\n\nsquareVal, cubeVal := &lt;-squareChan, &lt;-cubeChan\n</code></pre>\n\n<p>If your cube function is too slow for any possible number of reasons, the testNum that you add onto the cubechan could be instantly taken off with this line here</p>\n\n<pre><code>squareVal, cubeVal := &lt;-squareChan, &lt;-cubeChan\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10228391, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nRF7nw4xNck/AAAAAAAAAAI/AAAAAAAAAAw/bgSkagsFr4U/photo.jpg?sz=128", "display_name": "Daniel Guo", "link": "https://stackoverflow.com/users/10228391/daniel-guo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 693, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1563548795, "creation_date": 1561194806, "question_id": 56714188, "link": "https://stackoverflow.com/questions/56714188/scheduling-of-multiple-goroutines", "title": "Scheduling of multiple goroutines", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\n\nfunc square(c chan int) {\n    fmt.Println(\"[square] reading (4)\")\n    num := &lt;-c\n    fmt.Println(\"[square] calc (5)\")\n    c &lt;- num * num\n    fmt.Println(\"back from [square] (10)\")\n}\n\nfunc cube(c chan int) {\n    fmt.Println(\"[cube] reading (3)\")\n    num := &lt;-c\n    fmt.Println(\"[cube] calc (11)\")\n    c &lt;- num * num * num\n    fmt.Println(\"back from [cube] (12)\")\n}\n\nfunc main() {\n    fmt.Println(\"[main] main() started (1)\")\n\n    squareChan := make(chan int)\n    cubeChan := make(chan int)\n\n    go square(squareChan)\n    go cube(cubeChan)\n\n    testNum := 3\n    fmt.Println(\"[main] sent testNum to squareChan (2)\")\n\n    squareChan &lt;- testNum\n\n    fmt.Println(\"[main] resuming (6)\")\n    fmt.Println(\"[main] sent testNum to cubeChan (7)\")\n\n    cubeChan &lt;- testNum // why doesn't block here?\n\n    fmt.Println(\"[main] resuming (8)\")\n    fmt.Println(\"[main] reading from channels (9)\")\n\n    squareVal, cubeVal := &lt;-squareChan, &lt;-cubeChan\n    fmt.Println(\"[main] waiting calculating (13)\")\n\n    fmt.Println(\"[main] results: \", squareVal, cubeVal)\n    fmt.Println(\"[main] main() stopped\")\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[main] main() started (1)\n[main] sent testNum to squareChan (2)\n[cube] reading (3)\n[square] reading (4)\n[square] calc (5)\n[main] resuming (6)\n[main] sent testNum to cubeChan (7)\n[main] resuming (8)\n[main] reading from channels (9)\nback from [square] (10)\n[cube] calc (11)\nback from [cube] (12)\n[main] waiting calculating (13)\n[main] results:  9 27\n[main] main() stopped\n</code></pre>\n\n<p>In the code given above, I think the <code>main()</code> routine should be blocked after <code>cubeChan &lt;- testNum</code>, then <code>cube</code> routine should be scheduled, which means the output <code>[cube] calc (11)</code> ought to be prior to <code>[main] resuming (8)</code>. But after executing on Playground, I'm so confused by the output.</p>\n\n<p>Could anyone tell me if I misunderstand anything?</p>\n"}, {"tags": ["c++", "opencv", "go", "dll", "lib"], "comments": [{"owner": {"reputation": 17033, "user_id": 2393191, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mFcLT.jpg?s=128&g=1", "display_name": "Micka", "link": "https://stackoverflow.com/users/2393191/micka"}, "edited": false, "score": 0, "creation_date": 1561187820, "post_id": 56713339, "comment_id": 99989309, "body": "maybe you could write a C wrapper with the compiler that was used by the manufacturer and call that C code in Go <a href=\"https://karthikkaranth.me/blog/calling-c-code-from-go/\" rel=\"nofollow noreferrer\">karthikkaranth.me/blog/calling-c-code-from-go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "edited": false, "score": 0, "creation_date": 1561221653, "post_id": 56714567, "comment_id": 99996341, "body": "Should I use syscall.LoadLibrary() or syscall.LoadDLL? Is there any difference?"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "edited": false, "score": 0, "creation_date": 1561227633, "post_id": 56714567, "comment_id": 99997615, "body": "They both work but have different returns. LoadDLL returns a struct with the dll name and a handle with LoadLibrary just a handle. If you need the dll name use the first, otherwise the second."}, {"owner": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "edited": false, "score": 0, "creation_date": 1561264046, "post_id": 56714567, "comment_id": 100002812, "body": "Get it, thanks! Is there any function returns function names in DLL?"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "edited": false, "score": 0, "creation_date": 1561264570, "post_id": 56714567, "comment_id": 100002875, "body": "As far as I know there isn\u2019t."}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 0, "last_activity_date": 1561198419, "creation_date": 1561198419, "answer_id": 56714567, "question_id": 56713339, "link": "https://stackoverflow.com/questions/56713339/how-can-i-call-prebuilt-apis-with-lib-and-dll-file-in-go/56714567#56714567", "title": "How can I call prebuilt APIs with .lib and .dll file in go?", "body": "<p>There three ways:</p>\n\n<ol>\n<li>You can load and call the dll from Go. This is documented in <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a>.</li>\n<li>You can load and call your dll or link the lib using cgo and call this from your Go code. This is more complicated and requires more brain power. </li>\n<li>You can use syscall.NewProc. </li>\n</ol>\n\n<p>I would use the first. They are all documented in <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a> with examples.</p>\n\n<p>You can also look on Github for examples by searching for syscall.syscall9.</p>\n\n<p>If your machine has the drivers and it\u2019s openCV compatible you could use GOCV to capture data.</p>\n"}], "owner": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "closed_date": 1561352067, "accepted_answer_id": 56714567, "answer_count": 1, "score": -3, "last_activity_date": 1561302389, "creation_date": 1561186771, "last_edit_date": 1561302389, "question_id": 56713339, "link": "https://stackoverflow.com/questions/56713339/how-can-i-call-prebuilt-apis-with-lib-and-dll-file-in-go", "closed_reason": "Needs more focus", "title": "How can I call prebuilt APIs with .lib and .dll file in go?", "body": "<p>I have a PCI-E capture card, and I have to use APIs for it supplied by the manufacturer. \nThey provide prebuilt .lib and .dll file. \nHow can I use it in Golang? \nOr is it possible to get the output of capture card by using GOCV?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1561194607, "post_id": 56713271, "comment_id": 99990619, "body": "Names must be qualified. Unrelated to modules."}, {"owner": {"reputation": 1953, "user_id": 5160, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d50c0304e5fe3a83cf2657e84a0e5d53?s=128&d=identicon&r=PG", "display_name": "Raoul", "link": "https://stackoverflow.com/users/5160/raoul"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561285542, "post_id": 56713271, "comment_id": 100006395, "body": "why am I getting multiple downvotes with no explanation?  I thought I&#39;d been pretty clear in the question I asked and gave a minimal test case explaining what I was asking.  This feels very mean spirited!  I will gladly make edits to make the question more valuable to future users searching if people have suggestions."}, {"owner": {"reputation": 1953, "user_id": 5160, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d50c0304e5fe3a83cf2657e84a0e5d53?s=128&d=identicon&r=PG", "display_name": "Raoul", "link": "https://stackoverflow.com/users/5160/raoul"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1561287431, "post_id": 56713271, "comment_id": 100006791, "body": "Thanks @Volker.  I did not know that until I had the answer.  I&#39;ve removed the tag and updated the title"}], "answers": [{"comments": [{"owner": {"reputation": 1953, "user_id": 5160, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d50c0304e5fe3a83cf2657e84a0e5d53?s=128&d=identicon&r=PG", "display_name": "Raoul", "link": "https://stackoverflow.com/users/5160/raoul"}, "edited": false, "score": 0, "creation_date": 1561198681, "post_id": 56713340, "comment_id": 99991436, "body": "D&#39;oh couldn&#39;t see the wood for the trees.  Thank you!"}], "tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 1, "last_activity_date": 1561186779, "creation_date": 1561186779, "answer_id": 56713340, "question_id": 56713271, "link": "https://stackoverflow.com/questions/56713271/name-resolution-problem-in-multi-package-go-module/56713340#56713340", "title": "Name resolution problem in multi package go module", "body": "<p>There is bug in the <code>cmd/a.go</code>. You did not use <code>\"github.com/go-test/mod-test/pkg/foo\"</code>. Also <code>B()</code> is under <code>github.com/go-test/mod-test/pkg/foo</code> package, so you have to specify it. See below:</p>\n\n<p>package cmd</p>\n\n<pre><code>import (\n        \"fmt\"\n        \"github.com/go-test/mod-test/pkg/foo\"\n)\n\nfunc A() {\n        fmt.Println(\"a\")\n        // B()\n        foo.B()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": -1, "last_activity_date": 1561193566, "last_edit_date": 1561193566, "creation_date": 1561189398, "answer_id": 56713605, "question_id": 56713271, "link": "https://stackoverflow.com/questions/56713271/name-resolution-problem-in-multi-package-go-module/56713605#56713605", "title": "Name resolution problem in multi package go module", "body": "<p>There is another way to avoid this. If you don't want to use the package name, simply just put a <code>.</code> before importing a package. By doing that you can call a public fn or use a public var of that package. After doing that your <code>main.go</code> and <code>cmd/a.go</code> files look like below:</p>\n\n<p><strong><code>main.go</code></strong>:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        . \"github.com/go-test/mod-test/cmd\"\n)\n\nfunc main() {\n        fmt.Println(\"main\")\n        A()\n}\n</code></pre>\n\n<p><strong><code>cmd/a.go</code></strong>:</p>\n\n<pre><code>package cmd\n\nimport (\n        \"fmt\"\n        . \"github.com/go-test/mod-test/pkg/foo\"\n)\n\nfunc A() {\n        fmt.Println(\"a\")\n        B()\n}\n</code></pre>\n"}], "owner": {"reputation": 1953, "user_id": 5160, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d50c0304e5fe3a83cf2657e84a0e5d53?s=128&d=identicon&r=PG", "display_name": "Raoul", "link": "https://stackoverflow.com/users/5160/raoul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 56713340, "answer_count": 2, "score": -2, "last_activity_date": 1561287387, "creation_date": 1561186222, "last_edit_date": 1561287387, "question_id": 56713271, "link": "https://stackoverflow.com/questions/56713271/name-resolution-problem-in-multi-package-go-module", "title": "Name resolution problem in multi package go module", "body": "<p>I'm trying to create a module that contains multiple packages but I don't understand why I'm getting errors.</p>\n\n<p>Layout:</p>\n\n<pre><code>\u03bb ~/code/go-test/src/mod-test/ \u00bb tree\n.\n\u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 a.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 pkg\n    \u2514\u2500\u2500 foo\n        \u2514\u2500\u2500 b.go\n\n3 directories, 4 files\n</code></pre>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"github.com/go-test/mod-test/cmd\"\n)\n\nfunc main() {\n        fmt.Println(\"main\")\n        A()\n}\n</code></pre>\n\n<p>cmd/a.go:</p>\n\n<pre><code>package cmd\n\nimport (\n        \"fmt\"\n        \"github.com/go-test/mod-test/pkg/foo\"\n)\n\nfunc A() {\n        fmt.Println(\"a\")\n        B()\n}\n</code></pre>\n\n<p>pkg/foo/b.go:</p>\n\n<pre><code>package foo\n\nimport \"fmt\"\n\nfunc B() {\n        fmt.Println(\"B\")\n}\n</code></pre>\n\n<p>go.mod:</p>\n\n<pre><code>module github.com/go-test/mod-test\n\ngo 1.12\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>\u03bb ~/code/go-test/src/mod-test/ \u00bb go build\n# github.com/go-test/mod-test/cmd\ncmd/a.go:5:2: imported and not used: \"github.com/go-test/mod-test/pkg/foo\"\ncmd/a.go:10:2: undefined: B\n</code></pre>\n\n<p>Can anyone help explain what I've done wrong and why I get the error?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go", "package", "instantiation"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1561185875, "post_id": 56713065, "comment_id": 99988960, "body": "No, you cannot. The program won&#39;t compile if you have several copies of a package."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561198797, "post_id": 56713065, "comment_id": 99991459, "body": "It\u2019s not clear what you want to achieve. If you want different loggers create two loggers. In Go you can\u2019t swap packages dynamically. You can have two version of a package though easily using Go modules."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11370656"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1561202176, "post_id": 56713065, "comment_id": 99992126, "body": "@georgeok I think modules are what I am looking for. Thank you."}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1561203283, "creation_date": 1561203283, "answer_id": 56715125, "question_id": 56713065, "link": "https://stackoverflow.com/questions/56713065/multiple-instances-of-golang-package-inside-the-same-program/56715125#56715125", "title": "Multiple Instances of Golang package inside the same program", "body": "<p>You can use Go modules and aliases to import two packages in the same source file. This is going to work when quote is a tagged repo or submodule.</p>\n\n<pre><code>import (\n    \"rsc.io/quote\"\n    quoteV3 \"rsc.io/quote/v3\"\n)\n\nfunc Hello() string {\n    return quote.Hello()\n}\n\nfunc Proverb() string {\n    return quoteV3.Concurrency()\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11370656"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 326, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1561203283, "creation_date": 1561183917, "question_id": 56713065, "link": "https://stackoverflow.com/questions/56713065/multiple-instances-of-golang-package-inside-the-same-program", "title": "Multiple Instances of Golang package inside the same program", "body": "<p>I am currently working on Golang and struck at a point, related to package instantiation.</p>\n\n<p>Issue: whether we can have different instances of the same package.</p>\n\n<p>Problem Facing: While building a go packages, the utility packages(non main) are instantiated or compiled only once through out that particular building process. But while logging, I, for some purpose, want to have different loggers parallelly handling different package or files. Is there any way, that I can have multiple instances of the same package, so that changes made on each don't affect the other. </p>\n\n<p>Note: I have found a good work around using go-logging library where I have declared multiple loggers and that quite satiates my need. So, my main question is whether we can have different instances of the same package. </p>\n\n<p>Thanks to respond.</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1561234260, "post_id": 56711796, "comment_id": 99999050, "body": "maybe there is an error in your db calls? Check using <code>db.First(&amp;item).Error</code> and <code>db.Save(&amp;item).Error</code>"}, {"owner": {"reputation": 21, "user_id": 2891374, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OLl62.jpg?s=128&g=1", "display_name": "user2891374", "link": "https://stackoverflow.com/users/2891374/user2891374"}, "reply_to_user": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1561236920, "post_id": 56711796, "comment_id": 99999571, "body": "db.First(&amp;item).Error returns nil, and db.Save(&amp;item) fails at <code>go \t\tnewDB := scope.callCallbacks(s.parent.callbacks.updates).db </code> so the .Error could not be reached."}, {"owner": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1561278624, "post_id": 56711796, "comment_id": 100005046, "body": "Could you post the whole stack error in this question? I think it&#39;ll be easier for checking what is going on"}, {"owner": {"reputation": 21, "user_id": 2891374, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OLl62.jpg?s=128&g=1", "display_name": "user2891374", "link": "https://stackoverflow.com/users/2891374/user2891374"}, "reply_to_user": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1561399852, "post_id": 56711796, "comment_id": 100042702, "body": "There is no error log from debugging the app, which is why it is so hard to figure out why. I had to kill my app several times during the debug because the app hangs. Updated the issue with postgres db log."}, {"owner": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1561452791, "post_id": 56711796, "comment_id": 100058246, "body": "I guess this is more about having the right setup with postgres. Maybe this helps: <a href=\"https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist\" title=\"postgresql error fatal role username does not exist\">stackoverflow.com/questions/11919391/&hellip;</a>"}], "owner": {"reputation": 21, "user_id": 2891374, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OLl62.jpg?s=128&g=1", "display_name": "user2891374", "link": "https://stackoverflow.com/users/2891374/user2891374"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3925, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1563995748, "creation_date": 1561164794, "last_edit_date": 1563995748, "question_id": 56711796, "link": "https://stackoverflow.com/questions/56711796/why-gorm-hangs-after-doing-save", "title": "Why GORM hangs after doing Save", "body": "<p>Was trying to get an item from db, updates it and save it back to db using GORM. but the process hangs after doing the save.</p>\n\n<p>I also tried to wrap these commands in a transaction, but still see the process hangs at save.</p>\n\n<p>However I noticed if I just do \"First\" to get the item and \"Save\" to save back the item, the process completes successfully.</p>\n\n<p>This really puzzles me because apparently in the GORM documentation, the example of an update is exactly what I am trying to achieve here.</p>\n\n<p>Example in doc</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db.First(&amp;user)\n\nuser.Name = \"jinzhu 2\"\nuser.Age = 100\ndb.Save(&amp;user)\n</code></pre>\n\n<p>My code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Item struct {\n    PK              int     `json:\"-\" gorm:\"index;primary_key\"`\n    ID              string  `json:\"id\" gorm:\"index\" external_reference_key:\"true\"`\n    MEMO            string  `json:\"MEMO\"`\n}\n\nfunc main() {\n\n    db, err := gorm.Open(\"postgres\", \"host=localHost port=5432 user=postgres password=5206 dbname=item sslmode=disable\")\n    if err != nil {\n        panic(err)\n    }\n    db.LogMode(true)\n\n    item := Item{}\n    db.First(&amp;item) //Gets the item\n    item.MEMO = \"[hpapaapodfiso]\" //Change the field\n    db.Save(&amp;item) //Save back to db\n    fmt.Printf(\"%v\",item) //never executed, process stops at Save\n}\n</code></pre>\n\n<p>Could anyone explain to me what made a difference? And what caused the process to stop/hang?</p>\n\n<p>Really appreciated.</p>\n\n<p>Update with the postgres log:</p>\n\n<pre><code>2019-06-22 15:39:07 PDT LOG:  database system is ready to accept connections\n2019-06-22 15:39:08 PDT LOG:  autovacuum launcher started\n2019-06-22 15:40:08 PDT FATAL:  canceling authentication due to timeout\n2019-06-22 15:49:23 PDT LOG:  could not receive data from client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 15:53:22 PDT LOG:  could not receive data from client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 15:53:31 PDT LOG:  could not receive data from client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 15:53:46 PDT LOG:  could not receive data from client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 16:05:42 PDT ERROR:  role \"username\" does not exist\n2019-06-22 16:05:42 PDT STATEMENT:  REVOKE CONNECT ON DATABASE triggers FROM PUBLIC, username;\n\n2019-06-22 16:06:14 PDT FATAL:  terminating connection due to administrator command\n2019-06-22 16:06:14 PDT FATAL:  terminating connection due to administrator command\n2019-06-22 16:06:14 PDT LOG:  could not send data to client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 16:06:14 PDT FATAL:  terminating connection due to administrator command\n2019-06-22 16:06:14 PDT LOG:  could not send data to client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 16:06:14 PDT FATAL:  terminating connection due to administrator command\n2019-06-22 16:06:14 PDT LOG:  could not send data to client: No connection could be made because the target machine actively refused it.\n\n\n2019-06-22 16:06:14 PDT LOG:  could not send data to client: No connection could be made because the target machine actively refused it.\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "go-chi"], "comments": [{"owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "edited": false, "score": 4, "creation_date": 1561162103, "post_id": 56711561, "comment_id": 99986225, "body": "Save yourself some trouble and just plug your production router into a <code>httptest.Server</code>. You&#39;re not testing your real setup if you&#39;re manually configuring the endpoints like this in your tests, instead of using your production configuration."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1561212079, "post_id": 56711561, "comment_id": 99994118, "body": "Save yourself some further trouble and mock the database. Unitests (&quot;given I get proper responses from the database, does <i>my</i> code give the expected results&quot;) != integration tests (&quot;given a known query, do I get the expected results from the database, does my code behave well on connection problems etc.&quot;)"}], "owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1158, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1561161249, "creation_date": 1561161249, "question_id": 56711561, "link": "https://stackoverflow.com/questions/56711561/unit-testing-with-go-chi-chi", "title": "Unit Testing with Go-Chi/Chi", "body": "<p>I am trying to write unit tests for my rest endpoints using Go-Chi as my mux.</p>\n\n<p>Previously I was using gorilla/mux but moved to Chi because it is easier to maintain as my application grows.</p>\n\n<p>With Gorilla/mux, I was able to use \"ServeHTTP\" to send a test request but using go-chi/chi it does not seem to do the same thing.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var writer *httptest.ResponseRecorder\nvar r = chi.Mux{}\n\nfunc TestMain(m *testing.M) {\n    setUp()\n    code := m.Run()\n    os.Exit(code)\n}\n\nfunc setUp() {\n    d, _ := database.ConnectToDB(database.TESTDBNAME)\n    writer = httptest.NewRecorder()\n    r := chi.NewMux()\n    r.Route(\"/companies\", func(r chi.Router) {\n        r.Get(\"/\", GetCompanies(d))\n        r.Get(\"/{id}\", GetCompany(d))\n        r.Post(\"/\", PostCompany(d))\n        r.Put(\"/{id}\", PutCompany(d))\n        r.Delete(\"/{id}\", DeleteCompany(d))\n    })\n}\n\nfunc TestPostCompany(t *testing.T) {\n    tables := []struct {\n        company   model.Company\n        result int\n    }{\n        {model.Company{Name:\"Test\"}, 200},\n    }\n\n    for _, table := range tables {\n        company, err := json.Marshal(table.company)\n        if err != nil {\n            t.Errorf(\"JSON Error\")\n        }\n        companyJson := strings.NewReader(string(company))\n        request, err := http.NewRequest(\"POST\", \"/companies\", companyJson)\n        if err != nil {\n            t.Error(err)\n        }\n        r.ServeHTTP(writer, request)\n        if writer.Code != table.result {\n        t.Error(writer.Body)\n        }\n    }\n}\n</code></pre>\n\n<p>Right now the test is showing a 404 error but I would like it to give a 200 error. This request works fine while running my application and testing manually.</p>\n\n<p>I believe the issue has something to do with \"ServeHTTP\". Maybe it works differently with chi. Does anyone know how to get this test to run successfully?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": false, "score": 0, "last_activity_date": 1561147549, "creation_date": 1561147549, "answer_id": 56709806, "question_id": 56709649, "link": "https://stackoverflow.com/questions/56709649/attempting-to-unmarshal-a-json-byte-array-in-golang-1-12/56709806#56709806", "title": "Attempting to unmarshal a json byte array in golang 1.12", "body": "<p>If you change the lowercase first letters of the struct fields to uppercase it will work as you expect.</p>\n\n<pre><code>type Event struct {\n    Category  string `json:\"category\"` &lt;-- // uppercase first letter means the field is exported (which means accessible to other packages, like encoding/json which will marshal the data into a struct)\n    Service   string `json:\"service\"`\n    Timestamp string `json:\"timestamp\"`\n    Value     string `json:\"value\"`\n}\n</code></pre>\n\n<p>running</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n)\n\ntype Event struct {\n    Category  string `json:\"category\"`\n    Service   string `json:\"service\"`\n    Timestamp string `json:\"timestamp\"`\n    Value     string `json:\"value\"`\n}\n\nfunc main() {\n\n    ba := []byte(`\n        {\n          \"category\": \"category1\",\n          \"service\" : \"service1\",\n          \"timestamp\": \"06-21-2019T10:08:00\",\n          \"value\": \"5\"\n        }`)\n    var event Event\n    err := json.Unmarshal(ba, &amp;event)\n    if err != nil {\n        log.Panicln(err)\n    }\n    log.Printf(\"%+v\", event)\n\n}\n</code></pre>\n\n<p>gives me the result</p>\n\n<pre><code>2019/06/21 13:03:09 {Category:category1 Service:service1 Timestamp:06-21-2019T10:08:00 Value:5}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 3047510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lglGA.jpg?s=128&g=1", "display_name": "Delbert Aud", "link": "https://stackoverflow.com/users/3047510/delbert-aud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "closed_date": 1561149835, "answer_count": 1, "score": -5, "last_activity_date": 1561147549, "creation_date": 1561146767, "question_id": 56709649, "link": "https://stackoverflow.com/questions/56709649/attempting-to-unmarshal-a-json-byte-array-in-golang-1-12", "closed_reason": "Duplicate", "title": "Attempting to unmarshal a json byte array in golang 1.12", "body": "<p>I am getting a json byte array and simply attempting to unmarshal it into a struct for later use.</p>\n\n<pre><code>type Event struct {\n    category  string `json:\"category\"`\n    service   string `json:\"service\"`\n    timestamp string `json:\"timestamp\"`\n    value     string `json:\"value\"`\n}\nba := []byte(`\n    {\n      \"category\": \"category1\",\n      \"service\" : \"service1\",\n      \"timestamp\": \"06-21-2019T10:08:00\",\n      \"value\": \"5\"\n    }`)\nvar event Event\nerr := json.Unmarshal(ba, &amp;event)\nif err != nil {\n    log.Panicln(err)\n}\nlog.Printf(\"%+v\", event)\n</code></pre>\n\n<p>I was expecting:</p>\n\n<p>2019/06/21 12:21:13 {category:category1 service:service1 timestamp:06-21-2019T10:08:00 value:5 }</p>\n\n<p>but instead I'm getting:</p>\n\n<p>2019/06/21 12:21:13 {category: service: timestamp: value:}</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 0, "creation_date": 1561148092, "post_id": 56709585, "comment_id": 99983062, "body": "are you looking for a shorter way to write the same code, which my not be as efficient?"}, {"owner": {"reputation": 14996, "user_id": 190823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/521yb.jpg?s=128&g=1", "display_name": "Jens", "link": "https://stackoverflow.com/users/190823/jens"}, "reply_to_user": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 0, "creation_date": 1561148335, "post_id": 56709585, "comment_id": 99983144, "body": "@OrYaacov Only if the shorter version is as efficient or more efficient than my current implementation. I just started learning Go, so all of this is hard to judge for me. In general I am interested in the most idiomatic solution. Since I am learning I would like to have a solution that does not feel un-idiomatic to seasoned Go coders ;)"}, {"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 1, "creation_date": 1561148523, "post_id": 56709585, "comment_id": 99983207, "body": "I wanted to suggest PeterSO&#39;s version, a bit more efficient, but not shorter."}], "answers": [{"comments": [{"owner": {"reputation": 14996, "user_id": 190823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/521yb.jpg?s=128&g=1", "display_name": "Jens", "link": "https://stackoverflow.com/users/190823/jens"}, "edited": false, "score": 0, "creation_date": 1561148940, "post_id": 56709961, "comment_id": 99983346, "body": "Interesting solution. And Go is &quot;clever&quot; when you add one day (<code>dd+1</code>) and roles over &quot;intelligently&quot;. For example: When you use this on <code>2019-12-31</code> it will &quot;role over&quot; to <code>2020-01-01</code>. Wonderful. See: <a href=\"https://play.golang.org/p/bFxCywISXav\" rel=\"nofollow noreferrer\">play.golang.org/p/bFxCywISXav</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 14996, "user_id": 190823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/521yb.jpg?s=128&g=1", "display_name": "Jens", "link": "https://stackoverflow.com/users/190823/jens"}, "edited": false, "score": 0, "creation_date": 1561149770, "post_id": 56709961, "comment_id": 99983648, "body": "@Jens: In Go terminology dates and times are normalized."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1561150695, "last_edit_date": 1561150695, "creation_date": 1561148437, "answer_id": 56709961, "question_id": 56709585, "link": "https://stackoverflow.com/questions/56709585/how-to-get-specific-time-from-next-day/56709961#56709961", "title": "How to get specific time from next day", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n\n<pre><code>import \"time\" \n</code></pre>\n  \n  <p>The month, day, hour, min, sec, and nsec values may be outside their\n  usual ranges and will be normalized during the conversion. For\n  example, October 32 converts to November 1.</p>\n</blockquote>\n\n<hr>\n\n<p>This is more efficient. It minimizes calls to package <code>time</code> functions and methods.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    now := time.Now()\n    fmt.Println(now.Round(0))\n    yyyy, mm, dd := now.Date()\n    tomorrow := time.Date(yyyy, mm, dd+1, 15, 0, 0, 0, now.Location())\n    fmt.Println(tomorrow)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2019-06-21 16:23:06.525478162 -0400 EDT\n2019-06-22 15:00:00 -0400 EDT\n</code></pre>\n\n<hr>\n\n<p>Some benchmarks:</p>\n\n<pre><code>BenchmarkNow-8                  31197811            36.6 ns/op\nBenchmarkTomorrowPeterSO-8      29852671            38.4 ns/op\nBenchmarkTomorrowJens-8          9523422           124 ns/op\n</code></pre>\n\n<p><code>bench_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n    \"time\"\n)\n\nfunc BenchmarkNow(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        now := time.Now()\n        _ = now\n    }\n}\n\nvar now = time.Now()\n\nfunc BenchmarkTomorrowPeterSO(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        // now := time.Now()\n        yyyy, mm, dd := now.Date()\n        tomorrow := time.Date(yyyy, mm, dd+1, 15, 0, 0, 0, now.Location())\n        _ = tomorrow\n    }\n}\n\nfunc BenchmarkTomorrowJens(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        // now := time.Now()\n        tomorrow := time.Date(now.Year(), now.Month(), now.Day(), 15, 0, 0, 0, now.Location()).AddDate(0, 0, 1)\n        _ = tomorrow\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 14996, "user_id": 190823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/521yb.jpg?s=128&g=1", "display_name": "Jens", "link": "https://stackoverflow.com/users/190823/jens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 1, "accepted_answer_id": 56709961, "answer_count": 1, "score": 3, "last_activity_date": 1592338568, "creation_date": 1561146334, "last_edit_date": 1592338568, "question_id": 56709585, "link": "https://stackoverflow.com/questions/56709585/how-to-get-specific-time-from-next-day", "title": "How to get specific time from next day", "body": "<p>I want to create a <code>time.Time</code> for an exact point in time the following day (tomorrow). For now I would like to set the hour and minute.</p>\n\n<p>This is the code I use at the moment:</p>\n\n<pre><code>now := time.Now()\ntomorrow := time.Date(now.Year(), now.Month(), now.Day(), 15, 0, 0, 0, time.UTC).AddDate(0,0,1)\n</code></pre>\n\n<p>This will create a <code>Date</code> for today with the exact time (hour and minute) I am looking for and then adds one day to that <code>Date</code>. This works fine. </p>\n\n<hr>\n\n<p><strong>Example:</strong></p>\n\n<p>Imagine <code>time.Now()</code> is <code>2009-11-10 23:00:00 +0000 UTC</code>.</p>\n\n<p>The result of the following code would be: <code>2009-11-10 15:00:00 +0000 UTC</code></p>\n\n<pre><code>tomorrow := time.Date(now.Year(), now.Month(), now.Day(), 15, 0, 0, 0, time.UTC)\n</code></pre>\n\n<p>To this date I add one day using <code>AddDate(0, 0, 1)</code>. The result is then the desired time the next day: <code>2009-11-11 15:00:00 +0000 UTC</code>.</p>\n\n<p>See: <a href=\"https://play.golang.org/p/OKR9V1HN50x\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OKR9V1HN50x</a></p>\n\n<hr>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a shorter way to write this code?</p>\n"}, {"tags": ["go", "amazon-sqs"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1561143755, "post_id": 56708954, "comment_id": 99981532, "body": "If their SDK defines the field as a map, but their API returns a json array for that value then the problem seems to be with their SDK, or API, since they are at odds with each other."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1561143932, "post_id": 56708954, "comment_id": 99981591, "body": "... if that&#39;s the case, then you can work around this by first unmarshaling into a custom type, one that matches the json, and then if you need to you can convert that to the SDK type manually."}, {"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1561146130, "post_id": 56708954, "comment_id": 99982391, "body": "100%.  Problem resolved.  I definitely can not trust their SDK...  unmarshaling to sqs.Message type worked."}], "answers": [{"comments": [{"owner": {"reputation": 174, "user_id": 5080762, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Lwg9i.jpg?s=128&g=1", "display_name": "Tarique Shamim", "link": "https://stackoverflow.com/users/5080762/tarique-shamim"}, "edited": false, "score": 0, "creation_date": 1578477590, "post_id": 56709578, "comment_id": 105447988, "body": "Hi @Cmag, can you please show the code for parsing the *sqs.Message into Go lang struct. I have been trying to parse it."}], "tags": [], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "is_accepted": false, "score": 5, "last_activity_date": 1561146319, "creation_date": 1561146319, "answer_id": 56709578, "question_id": 56708954, "link": "https://stackoverflow.com/questions/56708954/unable-to-unmarshal-aws-sqs-message-in-go/56709578#56709578", "title": "Unable to unmarshal AWS SQS message in GO", "body": "<p>For those who stumble upon this...</p>\n\n<pre><code>// Message encapsulates all the information to publish in a message\ntype Message struct {\n    Body              json.RawMessage            `json:\"body\"`\n    Headers           map[string]json.RawMessage `json:\"headers\"`\n    Environment       string                     `json:\"env\"`\n    PublishTime       int64                      `json:\"publishTime\"`\n    MessageAttributes []Attributes               `json:\"messageAttributes\"`\n}\n\nfor _, msg := range resp.Messages {\n\n  var result Message\n  if err := json.Unmarshal([]byte(*msg.Body), &amp;result); err != nil {\n    onError(err)\n    continue\n  }\n\n  metadata := &amp;Metadata{\n    ReceiptHandle: *msg.ReceiptHandle,\n    MD5OfBody:     *msg.MD5OfBody,\n    SQSMessageID:  *msg.MessageId,\n    ReceiveCount:  *msg.Attributes[sqs.MessageSystemAttributeNameApproximateReceiveCount],\n  }\n\n  onMessage(result, *metadata)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1998, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561146319, "creation_date": 1561143004, "last_edit_date": 1561143318, "question_id": 56708954, "link": "https://stackoverflow.com/questions/56708954/unable-to-unmarshal-aws-sqs-message-in-go", "title": "Unable to unmarshal AWS SQS message in GO", "body": "<p>Folks,</p>\n\n<p>Am trying to unmarshal a message from an SQS FIFO queue, and am getting </p>\n\n<pre><code>cannot unmarshal array into Go struct field SendMessageInput.MessageAttributes of type map[string]*sqs.MessageAttributeValue\n</code></pre>\n\n<pre><code>// unmarshal for the sqs message\nvar publishedMessage sqs.SendMessageInput\nif err := json.Unmarshal([]byte(*msg.Body), &amp;publishedMessage); err != nil {\n  onError(err)\n  continue\n}\n\n// unmarhsal for the message sent\nvar result Message\nif err := json.Unmarshal([]byte(*publishedMessage.MessageBody), &amp;result); err != nil {\n    onError(err)\n    continue\n}\n\n</code></pre>\n\n<p>The Message itself looks ok when i look at the message via the SQS console.</p>\n\n<p>Here is a sample messageAttributes section from the message:</p>\n\n<pre><code>\"messageAttributes\":[{\"name\":\"foo\",\"dataType\":\"String\",\"attributeValue\":\"something\"},{\"name\":\"uid\",\"dataType\":\"String\",\"attributeValue\":\"26799e9c-9455-11e9-bc42-526af7764f64\"}]\n</code></pre>\n\n<p>From the SDK documentation:</p>\n\n<pre><code>// Each message attribute consists of a Name, Type, and Value. For more information,\n    // see Amazon SQS Message Attributes (http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-message-attributes.html)\n    // in the Amazon Simple Queue Service Developer Guide.\n    MessageAttributes map[string]*MessageAttributeValue `locationName:\"MessageAttribute\" locationNameKey:\"Name\" locationNameValue:\"Value\" type:\"map\" flattened:\"true\"`\n</code></pre>\n\n<p>What am I doing wrong here folks?</p>\n"}, {"tags": ["html", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561142047, "post_id": 56708691, "comment_id": 99980891, "body": "Convert your strings to <a href=\"https://golang.org/pkg/html/template/#HTML\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template/#HTML</a>, either in the Go code, or inside the template by registering a func that does that. E.g. <code>[]template.HTML{`&lt;h1&gt;This is from dog&lt;&#47;h1&gt;`, `&lt;img src=&quot;&#47;assets&#47;img&#47;dog.jpg&quot;&gt;`}</code>"}, {"owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1561142400, "post_id": 56708691, "comment_id": 99981009, "body": "Thank you @mkopriva that did the trick.  I will answer below for others to learn from this."}], "answers": [{"tags": [], "owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1561142457, "creation_date": 1561142457, "answer_id": 56708842, "question_id": 56708691, "link": "https://stackoverflow.com/questions/56708691/golang-template-interprets-html-as-plain-text/56708842#56708842", "title": "Golang template interprets html as plain text", "body": "<p>As pointed out in the comments, the answer is to replace <code>[]string{}</code> with <code>[]template.HTML{}</code> instead when passed as data into your template.</p>\n"}], "owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "closed_date": 1561145205, "answer_count": 1, "score": -1, "last_activity_date": 1561142457, "creation_date": 1561141621, "last_edit_date": 1561142365, "question_id": 56708691, "link": "https://stackoverflow.com/questions/56708691/golang-template-interprets-html-as-plain-text", "closed_reason": "Duplicate", "title": "Golang template interprets html as plain text", "body": "<p>I have a Golang template interpreting my html as plain text.</p>\n\n<p>I have included the line <code>w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")</code> in my function passed to <code>http.HandleFunc()</code> however nonetheless my html is interpreted as plain text.</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"io\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/dog\", dog)\n    http.Handle(\"/resources/\", http.StripPrefix(\"/resources\", http.FileServer(http.Dir(\"./assets\"))))\n    http.ListenAndServe(\":8080\", nil)\n}\n\nvar tpl *template.Template\n\nfunc init() {\n    tpl = template.Must(template.ParseFiles(\"index.gohtml\"))\n}\n\nfunc dog(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n    data := []string{`&lt;h1&gt;This is from dog&lt;/h1&gt;`, `&lt;img src=\"/assets/img/dog.jpg\"&gt;`}\n    tpl.ExecuteTemplate(w, \"index.gohtml\", data)\n}\n</code></pre>\n\n<p>And here is my <code>index.gohtml</code> template:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Document&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    {{range .}}\n        {{.}}\n    {{end}}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 2, "creation_date": 1561131984, "post_id": 56706566, "comment_id": 99976610, "body": "Also IMO the source is extremely readable (since it&#39;s in go!!! :) ) <a href=\"https://golang.org/src/runtime/chan.go#L142\" rel=\"nofollow noreferrer\">golang.org/src/runtime/chan.go#L142</a>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1561133921, "post_id": 56706566, "comment_id": 99977588, "body": "It might help your understanding to break out the receive into a separate variable <code>j := &lt;-c</code> (the compiler is highly likely to do this on its own).  Once the value has been delivered, either or both <code>fmt.Printf</code> calls can proceed, and there&#39;s no guarantee on which will happen first."}], "answers": [{"comments": [{"owner": {"reputation": 790, "user_id": 4611854, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/og2CM.jpg?s=128&g=1", "display_name": "Karan Singh", "link": "https://stackoverflow.com/users/4611854/karan-singh"}, "edited": false, "score": 0, "creation_date": 1584874389, "post_id": 56706591, "comment_id": 107567673, "body": "Thank you for making it clear. I was trying to analyze the order of operations but totally forgot that it could be anything since they are concurrent. Upon verifying, the output that OP got from the first code is definitely one of the possible outputs."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 7, "last_activity_date": 1561131630, "creation_date": 1561131630, "answer_id": 56706591, "question_id": 56706566, "link": "https://stackoverflow.com/questions/56706566/when-does-a-channel-block-a-goroutine/56706591#56706591", "title": "When does a channel block a goroutine", "body": "<p>Sending to a channel with no available buffer space blocks the sender until the send can complete; receiving from a channel with no available messages blocks the receiver until the receive can complete. An unbuffered channel never has buffer space - sends block until something receives and vice-versa. This is covered in the Tour of Go: <a href=\"https://tour.golang.org/concurrency/2\" rel=\"noreferrer\">https://tour.golang.org/concurrency/2</a></p>\n\n<p>Remember that your code is concurrent so you can't read too much into the order of output statements. A goroutine can be put to sleep in between the send/receieve operation and when your message is printed to stdout.</p>\n"}], "owner": {"reputation": 25, "user_id": 11676407, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c2PRHXuD_ZY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfV0Y_1BntvKrCmkYTNLnudYPhkbQ/mo/photo.jpg?sz=128", "display_name": "Wei Duan", "link": "https://stackoverflow.com/users/11676407/wei-duan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1561131630, "creation_date": 1561131526, "question_id": 56706566, "link": "https://stackoverflow.com/questions/56706566/when-does-a-channel-block-a-goroutine", "title": "When does a channel block a goroutine", "body": "<p>If I define a channel without buffer and write one data into it, does it block immediately(so that the kernel will look for another unblocked goroutine that reads from the channel), or does it continues execution and blocks when the next time some code tries to write into the channel again, when it hasn't been read yet?</p>\n\n<p>Below are two pieces of codes I wrote to research on this problem.</p>\n\n<p>code1:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    c := make(chan int)\n    go func() {\n        for i := 0;i &lt; 3; i++ {\n            c &lt;- i\n            fmt.Printf(\"number %v inserted into channel\\n\", i)\n        }\n    }()\n    for i := 0; i &lt; 3; i++ {\n        fmt.Printf(\"number poped from channel %v\\n\", &lt;-c)\n    }\n}\n</code></pre>\n\n<p>The output is like this:</p>\n\n<pre><code>number 0 inserted into channel\nnumber poped from channel 0\nnumber poped from channel 1\nnumber 1 inserted into channel\nnumber 2 inserted into channel\nnumber poped from channel 2\n</code></pre>\n\n<p>After the first time c is written into, this goroutine seems to continue to be executed, since \"number 0 inserted into channel\" was printed.</p>\n\n<p>code2:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    c := make(chan int)\n    c &lt;- 2\n    fmt.Println(\"Something is written into channel\")\n    &lt;-c\n}\n</code></pre>\n\n<p>This piece of code cannot run correctly since a deadlock error is reported at runtime.</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>From my view, when c &lt;-2 is executed, the goroutine is blocked(if it's not blocked, the fmt.Println line will be executed and continuing executing will unlock c at &lt;-c). When this goroutine is blocked, the kernel searches other goroutines and find none, so it reports a deadlock error.</p>\n\n<p>In summary, in the first piece of code I conclude that writting to a channel doesn't block the goroutine immediately but from the second piece of code it does. Where did I get it wrong and when does a channel blocks a goroutine?</p>\n"}, {"tags": ["go", "circleci", "buffalo"], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": 1, "last_activity_date": 1561214695, "creation_date": 1561214695, "answer_id": 56716406, "question_id": 56706549, "link": "https://stackoverflow.com/questions/56706549/circleci-and-gobuffalo-challenge/56716406#56716406", "title": "Circleci and GoBuffalo challenge", "body": "<p>It tries to bundle js with webpack, try <code>--skip-assets</code> as you probably don't have frontend for it:</p>\n\n<pre><code>- run: buffalo build --skip-assets\n</code></pre>\n\n<p>More on their frontend requirements are <a href=\"https://gobuffalo.io/en/docs/getting-started/installation#frontend-requirements\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 90, "user_id": 2561989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb9c8167660ab75048a0f24a7a3a0d0?s=128&d=identicon&r=PG", "display_name": "paganotoni", "link": "https://stackoverflow.com/users/2561989/paganotoni"}, "is_accepted": true, "score": 0, "last_activity_date": 1562369698, "creation_date": 1562369698, "answer_id": 56910146, "question_id": 56706549, "link": "https://stackoverflow.com/questions/56706549/circleci-and-gobuffalo-challenge/56910146#56910146", "title": "Circleci and GoBuffalo challenge", "body": "<p>Tino, this is how I run my tests in CircleCi with buffalo, one important thing is that you can use buffalo images to build/test your code.</p>\n\n<p>This has some advantages:</p>\n\n<ol>\n<li>All buffalo dependencies are already in the buffalo image</li>\n<li>It has postgres preinstalled so I just have to start it and run tests against it.</li>\n</ol>\n\n<pre><code>version: 2\n\njobs:\n  test:\n    docker:\n      - image: gobuffalo/buffalo:v0.14.0\n    working_directory: /go/src/github.com/my/app\n    steps:\n      - checkout\n      - run: GO111MODULE=off go get github.com/gobuffalo/buffalo-plugins\n      - run: buffalo plugins install\n      - run: service postgresql start &amp;&amp; buffalo db create -e test &amp;&amp; buffalo db migrate -e test\n      - run: service postgresql start &amp;&amp; buffalo test ./...\n</code></pre>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 56910146, "answer_count": 2, "score": 1, "last_activity_date": 1562369698, "creation_date": 1561131466, "question_id": 56706549, "link": "https://stackoverflow.com/questions/56706549/circleci-and-gobuffalo-challenge", "title": "Circleci and GoBuffalo challenge", "body": "<p>I'm currently trying to get GoBuffalo and CircleCi working, but so far without luck. </p>\n\n<p>Circleci fails on the \"buffalo build\" step with the error message:\n<a href=\"https://i.stack.imgur.com/heLTu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/heLTu.png\" alt=\"enter image description here\"></a></p>\n\n<p>My config.yaml:</p>\n\n<pre><code>version: 2\njobs:\n  khw_build_and_test:\n    docker:\n      - image: circleci/golang:1.9\n    working_directory: /go/src/github.com/khwerhahn/khw\n    environment:\n      TEST_RESULTS: /tmp/test-results\n    steps:\n      - checkout\n      - run: mkdir -p $TEST_RESULTS # create the test results directory\n      - run:\n          name: Update PATH and Define Environment Variable at Runtime\n          command: |\n            echo 'export PATH=${GOPATH}/bin/:${PATH}' &gt;&gt; $BASH_ENV\n            source $BASH_ENV\n      - run: go get -v -t -d ./...\n      - run: go get -u -v github.com/gobuffalo/buffalo/buffalo\n      - run: buffalo build\n      - restore_cache:\n          keys:\n            - v1-pkg-cache\n      - save_cache: # Store cache in the /go/pkg directory\n          key: v1-pkg-cache\n          paths:\n            - \"/go/pkg\"\n  khw_deploy_to_production:\n    xxxx cut out xxxx\n\nworkflows:\n  version: 2\n  build_test_deploy:\n    jobs:\n      - khw_build_and_test\n      - khw_deploy_to_production:\n          requires:\n            - khw_build_and_test\n          filters:\n            branches:\n              only: master\n</code></pre>\n\n<p>Can somebody explain this error to me?</p>\n"}, {"tags": ["mysql", "sql", "go", "query-performance", "sqlperformance"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1561131504, "post_id": 56706321, "comment_id": 99976378, "body": "&quot;This is on a 16Gb RAM CPU It is very slow when it is deployed on a low grade system&quot; does this refer to the MySQL server or the machine running this utility? Because the utility is doing al this with <code>INSERT INTO...SELECT</code>, the utility itself should use basically no resources, it just waits on MySQL; you&#39;ll want to speed up the DB side, probably by making sure your <code>SELECT</code> is using good indexes (<code>EXPLAIN</code> will tell you) and removing all indexes on the destination and adding them back when the inserts are done."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1561131540, "post_id": 56706321, "comment_id": 99976396, "body": "You might also trying dumping the <code>UNION</code> and just running two separate <code>INSERT INTO...SELECT</code>s, one for each query."}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1561132480, "post_id": 56706321, "comment_id": 99976889, "body": "@Adrian All the tables are loaded with minimum of 3 to 4 indexes. I believe the indexes are usually retrieved from memory. This plays a part in the lower end systems and affects execution time. This is as far as I know. Please correct me if I am thinking wrong"}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1561132517, "post_id": 56706321, "comment_id": 99976910, "body": "Try to run prepared SQL using only mysql CLI. Is it faster or it&#39;s the same? If you can get speed up by using CLI - I consider to think about: a) prepare file with query output, b) reading in golang this file"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1561132666, "post_id": 56706321, "comment_id": 99976993, "body": "The indexes are used on the MySQL server, so that&#39;s where you need a lot of memory. The Go tool, based on what you&#39;ve shown here, should use very very little memory and CPU. All it does is send a query that returns no results and wait for it to finish."}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1561132939, "post_id": 56706321, "comment_id": 99977116, "body": "@Adrian I already had tried removing all indexes and putting it back on after execution. It made the execution faster by just around 5 to 10  seconds which is not much when compared with the total execution time of 180 secs"}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1561133208, "post_id": 56706321, "comment_id": 99977240, "body": "we can&#39;t answer this question without <code>SHOW CREATE TABLE table</code> commands for every table involved in the question/query and without a <code>EXPLAIN query</code> output.."}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1561133308, "post_id": 56706321, "comment_id": 99977289, "body": "Also seeing <code>SELECT * ... GROUP BY timekey</code>  also means 99% out the time the SQL is invalid written, unless MySQL could have used functional dependency.."}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "reply_to_user": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 1, "creation_date": 1561133670, "post_id": 56706321, "comment_id": 99977464, "body": "@RaymondNijland Yes I am evading mysql functional dependency by disabling it. But the query is able to serve its purpose and is accurate . But can this query be altered to make it abide by functional dependancy???. I did not find any other way without having to use the column names of the main table in the query. I want this utility to be universal."}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 1, "creation_date": 1561133852, "post_id": 56706321, "comment_id": 99977554, "body": "You mean you disabled sql_mode only_full_group_by i assume you like to play russian roulette because that is what you are doing"}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1561133934, "post_id": 56706321, "comment_id": 99977593, "body": "No we cant suggest a rewrite without example data and expected results"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561144556, "post_id": 56706321, "comment_id": 99981838, "body": "There is too much guessing -- <i>Please</i> provide <code>SHOW CREATE TABLE</code>."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "reply_to_user": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1561144639, "post_id": 56706321, "comment_id": 99981861, "body": "@AlexYu - The same query will run at the same speed in mysql CLI versus any other client."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561144805, "post_id": 56706321, "comment_id": 99981915, "body": "@Prashanth - The query can be modified to abide... -- see my comments on spencer&#39;s answer."}], "answers": [{"comments": [{"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "edited": false, "score": 0, "creation_date": 1561134185, "post_id": 56707116, "comment_id": 99977686, "body": "I am very sorry for the confusion The column_name is the &quot;date&quot; itself for all. Have edited the question now! :)"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561144378, "post_id": 56707116, "comment_id": 99981762, "body": "Instead of <code>t.*</code>, spell out the columns, then replace <code>t.date</code> with <code>FLOOR(...)</code>.  Better yet, convert the <code>FLOOR</code> back to a datetime (or whatever) via a multiply and <code>FROM_UNIXTIME</code> (or whatever)."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561144454, "post_id": 56707116, "comment_id": 99981793, "body": "Also, change the other columns to <code>AVG(t.temp) AS temp</code>, etc.  And <code>MIN(id) AS id</code>.  Etc, etc -- this avoids the <code>ONLY_FULL_GROUP_BY</code> problem."}, {"owner": {"reputation": 99308, "user_id": 107744, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d6a34fb9a78937e1500b7ae0b5aee37?s=128&d=identicon&r=PG&f=1", "display_name": "spencer7593", "link": "https://stackoverflow.com/users/107744/spencer7593"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561146478, "post_id": 56707116, "comment_id": 99982506, "body": "@RickJames: yes, we should enumerate all of the expressions in the SELECT list. But this appears to be an attempt to delete a whole bunch of rows from a table, by creating a new table, copying only the rows to be kept, and then  swapping the tables; given the <code>CREATE TABLE ... LIKE</code>  in the same script, I&#39;m okay with using SELECT * and omitting the list of columns from the INSERT."}, {"owner": {"reputation": 99308, "user_id": 107744, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d6a34fb9a78937e1500b7ae0b5aee37?s=128&d=identicon&r=PG&f=1", "display_name": "spencer7593", "link": "https://stackoverflow.com/users/107744/spencer7593"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561146596, "post_id": 56707116, "comment_id": 99982535, "body": "@RickJames: i&#39;m totally on board with fixing the issue with the non-determinant columns (non-aggregates in SELECT not in GROUP BY) ONLY_FULL_GROUP_BY problem... I did mention this issue in this answer.  As far as how to fix that, I could answer that, but it seems like a different question than the one that was asked. (To fix it properly, I&#39;d need the  PRIMARY KEY or a non-null UNIQUE KEY, and then I could craft the SQL.)"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561147461, "post_id": 56707116, "comment_id": 99982834, "body": "@spencer7593 - The OP is quiet about the type of data.  If it is meteorological, then min/max/avg makes more sense.  If it is stock quotes, then opening price makes sense.  Etc."}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "edited": false, "score": 0, "creation_date": 1561728537, "post_id": 56707116, "comment_id": 100169709, "body": "@spencer7593 Thanks so much for the solution. I tested it out and the new query strategy was able to increase efficiency. It used to take 44 seconds on a 2 million record table. Now it is able to complete in 25 seconds!!"}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "edited": false, "score": 0, "creation_date": 1561728726, "post_id": 56707116, "comment_id": 100169807, "body": "@spencer7593 About the type of data, it varies for many tables. I can only have the <i>id</i> which can be seen common in some of the tables. So is there any way to make this query work with FULL_GROUP_BY? It would be excellent if <i>id</i> is also not used explicitly."}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "edited": false, "score": 0, "creation_date": 1561728855, "post_id": 56707116, "comment_id": 100169878, "body": "@spencer7593 I tried it out in different versions. Here is my <a href=\"https://dbfiddle.uk/?rdbms=mysql_5.7&amp;fiddle=e30ccc6cee23866c37ee0739009cd107\" rel=\"nofollow noreferrer\">dbfiddle</a> . Can anything be done to make this work for MYSQL 5.7 and above??"}, {"owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1561729044, "post_id": 56707116, "comment_id": 100169997, "body": "@RickJames Take a look at the fiddle in the above comment.Can anything be done here?. I am really stuck with the FULL_GROUP_BY here. I cannot use any MAX(temp) or any aggregate functions because I am trying to make this work on a huge DB which has different sets of tables."}], "tags": [], "owner": {"reputation": 99308, "user_id": 107744, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d6a34fb9a78937e1500b7ae0b5aee37?s=128&d=identicon&r=PG&f=1", "display_name": "spencer7593", "link": "https://stackoverflow.com/users/107744/spencer7593"}, "is_accepted": true, "score": 3, "last_activity_date": 1561176705, "last_edit_date": 1561176705, "creation_date": 1561133732, "answer_id": 56707116, "question_id": 56706321, "link": "https://stackoverflow.com/questions/56706321/increase-performance-of-mysql-query-involving-unions/56707116#56707116", "title": "Increase Performance of MYSQL QUERY involving unions", "body": "<p>Why are we adding <code>timekey</code> and then dropping it? Adding it to an empty table is fast, but dropping it from a table after it's populated, that's like an extra copy of the table. That's unnecessary work, if we don't need it.</p>\n\n<p>We can do a <code>GROUP BY</code> on an expression; that expression doesn't have to appear in the SELECT list., for example:</p>\n\n<pre><code>SELECT t.*\n  FROM main_table t\n WHERE t.column_name &lt;= '2018-01-01'\n GROUP \n    BY FLOOR(UNIX_TIMESTAMP(t.column_name)/((1440/2)*60))\n</code></pre>\n\n<p>(Note that this query will cause an error if <code>ONLY_FULL_GROUP_BY</code> is included in sql_mode; that disables a MySQL-specific extension which allows the query to run.)</p>\n\n<p>Without some table definitions (including storage engine, column datatypes, indexes) and without EXPLAIN output, we're just guessing.</p>\n\n<p>But some suggestions:</p>\n\n<p>Drop the secondary indexes on the empty table being populated, and add them after the table is loaded.</p>\n\n<p>I'd avoid the UNION.  Given that one of the SELECT statements has a predicate on <code>column_name</code> and the other has a predicate on an entirely different column <code>date</code>, we do want to separate SELECT statements.</p>\n\n<pre><code>CREATE TABLE main_table_tmp LIKE main_table\n;\n\n-- for performance, remove secondary indexes, leave just the cluster index\nALTER TABLE main_table_tmp \n    DROP INDEX noncluster_index_1\n  , DROP INDEX noncluster_index_2\n  , ...\n;\n\n-- for performance, have a suitable index available on main_table \n-- with `column_name` as the leading column\nINSERT INTO main_table_tmp \nSELECT h.*\n  FROM main_table h\n WHERE h.column_name &lt;= '2018-01-01'\n GROUP \n    BY FLOOR(UNIX_TIMESTAMP(h.column_name)/((1440/2)*60))\n;\n\n-- for performance, have a suitable index available on main_table\n-- with `date` as the leading column\nINSERT INTO main_table_tmp\nSELECT c.*\n  FROM main_table\n WHERE c.date &gt; '????-??-??'\n;\n\n-- add secondary indexes \nALTER TABLE maint_table_tmp\n    ADD UNIQUE INDEX noncluster_index_1 (fee,fi,fo)\n  , ADD INDEX noncluster_index_2 (fum)\n  , ...\n;\n</code></pre>\n"}], "owner": {"reputation": 158, "user_id": 10444937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXf4F.png?s=128&g=1", "display_name": "Prashanth", "link": "https://stackoverflow.com/users/10444937/prashanth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "accepted_answer_id": 56707116, "answer_count": 1, "score": 2, "last_activity_date": 1561176705, "creation_date": 1561130738, "last_edit_date": 1592644375, "question_id": 56706321, "link": "https://stackoverflow.com/questions/56706321/increase-performance-of-mysql-query-involving-unions", "title": "Increase Performance of MYSQL QUERY involving unions", "body": "<p>Have a Golang utility which is able to decrease data points per day in a table with historic data.</p>\n<p>The records range from 20 to 400 records per day.\ntotally there are a minimum of 100 million records.</p>\n<p>The utility is able to trim it down to n records per day prior to a given date. (n can range from 1 to 300 records per day)</p>\n<p><strong>The method I am using is as follows:</strong></p>\n<p><em>STEP 1:</em></p>\n<blockquote>\n<p>CREATE TABLE main_table_tmp LIKE main_table;</p>\n</blockquote>\n<p><em>STEP 2:</em></p>\n<blockquote>\n<p>ALTER TABLE main_table_tmp ADD COLUMN timekey INT;</p>\n</blockquote>\n<p><em>STEP 3:</em></p>\n<pre><code>INSERT INTO main_table_tmp \nSELECT * FROM (\n  SELECT *,FLOOR(UNIX_TIMESTAMP(column_name)/((1440/2)*60)) AS timekey \n  FROM main_table\n  WHERE column_name &lt;= '2018-01-01' \n  GROUP BY timekey\n) m \nUNION ALL \n(SELECT * ,0 As timekey FROM main_table where column_name &gt; 'date') ;\n</code></pre>\n<p><em>STEP 4:</em></p>\n<blockquote>\n<p>ALTER TABLE main_table_tmp DROP COLUMN timekey;</p>\n<p>DROP TABLE maintable;</p>\n<p>RENAME TABLE maintable_tmp TO maintable;</p>\n</blockquote>\n<p><strong>I am achieving the above using golang.</strong></p>\n<pre><code>func somefuncname(){\n\n  ---- \n  ----\n  ----\n  q := &quot;CREATE TABLE &quot; + *tablename + &quot;_tmp LIKE &quot; + *tablename + &quot;;&quot;\n  rows, err := db.Query(q)\n  if err != nil {\n  fmt.Println(err)\n  }\n//--ALTER ADD timekey\n//--INSERT INTO SELECT *....\n//--ALTER DROP timekey ,DROP table and rename\n\n}\n</code></pre>\n<p><strong>The current response time of this query is very slow</strong></p>\n<p><strong>Some of the Results:</strong>\n<strong>Total Records :</strong> 2 million<br />\n<strong>Execution Time:</strong> 180 seconds</p>\n<p>This is on a 16Gb RAM CPU\nIt is very slow when it is deployed on a low grade system</p>\n<p><strong>Steps I have took to resolve this:</strong></p>\n<ol>\n<li><p>Looked into indexes of all the tables. Tried removing the index and running the utility. Removing indexes made the utility faster by 5 seconds which is also not much.</p>\n</li>\n<li><p>Executed the utility in stages: if total records crosses more than 1 million then run the utility 1 million at a time</p>\n</li>\n</ol>\n<p>But after all these efforts looks like the main problem is in the query itself.</p>\n<p>It is just not fast enough. I just need a way to increase the efficiency of the query</p>\n<p>Any help appreciated,\nthank you guys!!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1561129044, "post_id": 56705472, "comment_id": 99975114, "body": "Not in Go as it does not do the interpolation, both the query string and the argument values are sent to the db server, which does the interpolation. So if the db server doesn&#39;t provide such a feature then you&#39;re out of luck. Alternatively you could try searching for a 3rd party package that does the interpolation, however if you find one keep in mind that to be accurate it needs to keep up with the target server&#39;s version, if it doesn&#39;t do that you may see logs that don&#39;t match the actual query being executed."}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561130871, "post_id": 56705472, "comment_id": 99976059, "body": "Ahh that explains a great deal thank you."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1561131510, "post_id": 56705472, "comment_id": 99976383, "body": "I guess I should point out that the above is entirely dependent on the driver that you&#39;re using, however, no sane driver would elect to do the interpolation themselves since then they would also have to implement protection against sql injection and who knows what else to match server&#39;s functionality. And again, for the driver to be useful it would need to keep up with the server&#39;s updates. So in case you find such a driver, one that does its own interpolation and sql-injection protection, I&#39;d recommend you do not use it."}], "answers": [{"tags": [], "owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "is_accepted": true, "score": 1, "last_activity_date": 1561146329, "creation_date": 1561146329, "answer_id": 56709584, "question_id": 56705472, "link": "https://stackoverflow.com/questions/56705472/looking-for-a-way-to-view-an-interpolated-query-in-golang-mysql/56709584#56709584", "title": "Looking for a way to view an interpolated query in golang mysql", "body": "<p>Based on @mkopriva's comments,</p>\n\n<blockquote>\n  <p>Not in Go as it does not do the interpolation, both the query string and the argument values are sent to the db server, which does the interpolation. So if the db server doesn't provide such a feature then you're out of luck. Alternatively you could try searching for a 3rd party package that does the interpolation, however if you find one keep in mind that to be accurate it needs to keep up with the target server's version, if it doesn't do that you may see logs that don't match the actual query being executed</p>\n</blockquote>\n\n<p>I cannot accomplish this using tooling, as go never has the interpolated query. Sticking to spitting out the non-interpolated query along with the pile of arguments.</p>\n"}], "owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 56709584, "answer_count": 1, "score": 0, "last_activity_date": 1561146329, "creation_date": 1561127628, "last_edit_date": 1561138100, "question_id": 56705472, "link": "https://stackoverflow.com/questions/56705472/looking-for-a-way-to-view-an-interpolated-query-in-golang-mysql", "title": "Looking for a way to view an interpolated query in golang mysql", "body": "<p>So, I have a reasonably complicated query which I am trying to debug, but for a simple example let's say I have something like this:</p>\n\n<pre><code>q := \"SELECT id FROM users WHERE timestamp &gt; ? AND timestamp &lt; ?\"\n</code></pre>\n\n<p>I will do a Query() on this the usual way, e.g.</p>\n\n<pre><code>db.Query(q, 1546300800,1561127488)\n</code></pre>\n\n<p>And I would like to log/println/whatever (for debugging) the interpolated query, to end up with </p>\n\n<pre><code>SELECT id FROM users WHERE timestamp &gt; 1546300800 AND timestamp &lt; 1561127488\n</code></pre>\n\n<p>Wondering if anyone has a trick for me here. </p>\n"}, {"tags": ["go", "web", "web-scraping"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1561126104, "post_id": 56704464, "comment_id": 99973452, "body": "OK, so what is happening? I ran your code locally, it all worked perfectly fine for me, although the output is a bit more than what you&#39;re expecting, it&#39;s still the markup for the page."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1561212525, "post_id": 56704464, "comment_id": 99994209, "body": "And I do not see any usage of colly in the code."}], "owner": {"reputation": 5, "user_id": 7004648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/711f9c04151f1108aec3d6f466c64824?s=128&d=identicon&r=PG&f=1", "display_name": "Idoncare", "link": "https://stackoverflow.com/users/7004648/idoncare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561123815, "creation_date": 1561123815, "question_id": 56704464, "link": "https://stackoverflow.com/questions/56704464/how-can-i-write-this-equivalent-code-using-gocolly", "title": "How can I write this equivalent code using gocolly", "body": "<p>I try to use <code>https://github.com/gocolly/colly.</code> I try to visit a URL and save the full response on my local disc for example visit google.com and save the full response body of the URL google.html.</p>\n\n<pre><code>&lt;!doctype html&gt;&lt;html itemscope=\"\" itemtype=\"http://schema.org/WebPage\" lang=\"bn\"&gt;&lt;head&gt;&lt;meta content=\"text/html; charset=UTF-8\" http-;google.pmc=JSON.parse(pmc);})();&lt;/script&gt;        &lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc main() {\n    response, err := http.Get(\"https://www.google.com\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer response.Body.Close()\n\n    outFile, err := os.Create(\"google.html\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer outFile.Close()\n\n    // Copy data from HTTP response to file\n    _, err = io.Copy(outFile, response.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>My expected output: </p>\n\n<pre><code>&lt;!doctype html&gt;&lt;html itemscope=\"\" itemtype=\"http://schema.org/WebPage\" lang=\"bn\"&gt;&lt;head&gt;&lt;meta content=\"text/html; charset=UTF-8\" http-;google.pmc=JSON.parse(pmc);})();&lt;/script&gt;        &lt;/body&gt;&lt;/html&gt;\n</code></pre>\n"}, {"tags": ["mongodb", "go", "database-connection", "connection-pooling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 8, "creation_date": 1561123673, "post_id": 56704178, "comment_id": 99972097, "body": "The driver uses a connection pool internally."}, {"owner": {"reputation": 332, "user_id": 1712581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/875c2ee70f81b21c3a5a82a5f9790396?s=128&d=identicon&r=PG", "display_name": "Prutser", "link": "https://stackoverflow.com/users/1712581/prutser"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1561124133, "post_id": 56704178, "comment_id": 99972354, "body": "@Adrian awesome! That&#39;s all I needed to know"}, {"owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "edited": false, "score": 3, "creation_date": 1561215121, "post_id": 56704178, "comment_id": 99994777, "body": "in case you wonder where the <a href=\"https://github.com/mongodb/mongo-go-driver/blob/v1.0.3/x/network/connection/pool.go#L166\" rel=\"nofollow noreferrer\">magics</a> happen"}, {"owner": {"reputation": 2447, "user_id": 6315366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1308330302516639/picture?type=large", "display_name": "Alongkorn Chetasumon", "link": "https://stackoverflow.com/users/6315366/alongkorn-chetasumon"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1580833887, "post_id": 56704178, "comment_id": 106224625, "body": "@Adrian comment is correct ,default is 100 (from <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#ClientOptions.SetMaxPoolSize\" rel=\"nofollow noreferrer\">godoc.org/go.mongodb.org/mongo-driver/mongo/&hellip;</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 1715, "user_id": 8712494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iWUnn1PqAuw/AAAAAAAAAAI/AAAAAAAAAGQ/2OslFo_DLk4/photo.jpg?sz=128", "display_name": "Amin Shojaei", "link": "https://stackoverflow.com/users/8712494/amin-shojaei"}, "is_accepted": false, "score": 2, "last_activity_date": 1597570711, "last_edit_date": 1597570711, "creation_date": 1594106244, "answer_id": 62769945, "question_id": 56704178, "link": "https://stackoverflow.com/questions/56704178/using-the-mongodb-go-driver-how-do-i-set-up-connection-pooling/62769945#62769945", "title": "Using the MongoDB Go Driver, how do I set up connection pooling?", "body": "<p>From comments:</p>\n<p><a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">Mongo-go-driver</a> takes care of connection pooling by default(100 connection by default)</p>\n<p>You can read the source code <a href=\"https://github.com/mongodb/mongo-go-driver/blob/v1.0.3/x/network/connection/pool.go#L166\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 332, "user_id": 1712581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/875c2ee70f81b21c3a5a82a5f9790396?s=128&d=identicon&r=PG", "display_name": "Prutser", "link": "https://stackoverflow.com/users/1712581/prutser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3897, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1597570711, "creation_date": 1561122748, "question_id": 56704178, "link": "https://stackoverflow.com/questions/56704178/using-the-mongodb-go-driver-how-do-i-set-up-connection-pooling", "title": "Using the MongoDB Go Driver, how do I set up connection pooling?", "body": "<p>I'm using the <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"noreferrer\">MongoDB Go Driver</a> in my Go (1.11) server which runs on Google Cloud's App Engine. I'm not really sure if I still manually have to set up connection pooling or if it's already being taken care of out of the box. For example I'm not entirely sure what the context (with timeout) exactly means.</p>\n\n<p>My code looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package tools\n\nimport (\n    \"context\"\n    \"time\"\n    \"valuation-app/settings\"\n\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\n// ConnectToDB starts a new database connection and returns a reference to it\nfunc ConnectToDB() (*mongo.Database, error) {\n    settings := settings.Get().Database\n    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n    defer cancel()\n    options := options.Client().ApplyURI(settings.URI)\n    options.SetMaxPoolSize(10)\n    client, err := mongo.Connect(ctx, options)\n    if err != nil {\n        return nil, err\n    }\n\n    return client.Database(settings.DatabaseName), nil\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "containers", "docker-api"], "comments": [{"owner": {"reputation": 430, "user_id": 11352925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f73f694f6a5663aa1b97e893bfc095c?s=128&d=identicon&r=PG&f=1", "display_name": "lindluni", "link": "https://stackoverflow.com/users/11352925/lindluni"}, "edited": false, "score": 1, "creation_date": 1561188270, "post_id": 56702213, "comment_id": 99989389, "body": "Unfortunately you&#39;re not going to get the response codes, the Moby client only ensures the response object is closed, and does not return it. You can check it out here: <a href=\"https://github.com/moby/moby/blob/master/client/container_start.go#L11\" rel=\"nofollow noreferrer\">github.com/moby/moby/blob/master/client/container_start.go#L&zwnj;&#8203;11</a>"}, {"owner": {"reputation": 126, "user_id": 8087043, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh6.googleusercontent.com/-Vy1rdoIq0-E/AAAAAAAAAAI/AAAAAAAACEY/Pxlxj26yn-g/photo.jpg?sz=128", "display_name": "charanReddy", "link": "https://stackoverflow.com/users/8087043/charanreddy"}, "reply_to_user": {"reputation": 430, "user_id": 11352925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f73f694f6a5663aa1b97e893bfc095c?s=128&d=identicon&r=PG&f=1", "display_name": "lindluni", "link": "https://stackoverflow.com/users/11352925/lindluni"}, "edited": false, "score": 0, "creation_date": 1561367055, "post_id": 56702213, "comment_id": 100025433, "body": "Got it....thank you :)"}], "owner": {"reputation": 126, "user_id": 8087043, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh6.googleusercontent.com/-Vy1rdoIq0-E/AAAAAAAAAAI/AAAAAAAACEY/Pxlxj26yn-g/photo.jpg?sz=128", "display_name": "charanReddy", "link": "https://stackoverflow.com/users/8087043/charanreddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561115100, "creation_date": 1561115100, "question_id": 56702213, "link": "https://stackoverflow.com/questions/56702213/how-to-get-the-rest-response-code-of-golang-docker-client-on-starting-a-containe", "title": "How to get the rest response code of golang docker client on starting a container?", "body": "<p>When I do </p>\n\n<pre><code>curl -X POST -v --unix-socket /var/run/docker.sock http://docker/containers/container_name/start\n</code></pre>\n\n<p>I got response codes like 204, 304, 404, 502</p>\n\n<p>How to get the same response codes from the golang docker client? As of now, startcontainer function in golang is only returning an error string</p>\n\n<p>dockerclient function: </p>\n\n<pre><code>ContainerStart(ctx context.Context, containerID string, options dockTypes.ContainerStartOptions) error\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1561115852, "post_id": 56702183, "comment_id": 99968113, "body": "Yes, HTTP handlers are called in their own goroutine. Note that <i>every</i> functions runs in a goroutine, even main. Whether one function runs in a different goroutine from another function cannot generally be determined. Some hacks exist, but they rely on implementation details of the runtime and are therefore not portable or subject to the compatibility guarantees."}, {"owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561116892, "post_id": 56702183, "comment_id": 99968620, "body": "Let&#39;s say I need to access some external data from my function for modification, but I don&#39;t know whether the function was called in another go routine or not. Then how do I determine if I need to use mutex to serialize access to the data?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1561117307, "post_id": 56702183, "comment_id": 99968814, "body": "Whether you need synchronization or not is not a runtime decision. It&#39;s made when writing the code and when writing the code you already know."}, {"owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561117646, "post_id": 56702183, "comment_id": 99968964, "body": "That&#39;s the problem, I think I don&#39;t know because I don&#39;t know how my functions are going to be called from other packages..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1561118003, "post_id": 56702183, "comment_id": 99969136, "body": "That&#39;s your decision to make; you can either solve a problem yourself or let the user deal with it. Just document if your function is safe for concurrent use. You should have some kind of intuition whether that&#39;s a common case or not."}, {"owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561118237, "post_id": 56702183, "comment_id": 99969245, "body": "No, I&#39;m afraid it&#39;s other way around: I&#39;m using some package which will call my function, but whether it will call my function via go or not it is not described in that package. So what shall I do? Probably read source codes of that package or find another one with better docs."}], "answers": [{"comments": [{"owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "edited": false, "score": 0, "creation_date": 1561117568, "post_id": 56702614, "comment_id": 99968923, "body": "If I&#39;m providing my own function which accesses shared data to another function from some package (for example http package), shall I use mutex to synchronize access to the data? Always?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "edited": false, "score": 0, "creation_date": 1561117679, "post_id": 56702614, "comment_id": 99968979, "body": "@Sergey Yes, HTTP handlers are called from their own goroutines, so if they access data outside of the handler function (that includes write), synchronization is required. For details see <a href=\"https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver/37531953#37531953\">Process Management for the Go Webserver</a>"}, {"owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "edited": false, "score": 0, "creation_date": 1561117812, "post_id": 56702614, "comment_id": 99969047, "body": "Ok, maybe HTTP handlers is not a good example anymore. What if you started using some new package and you don&#39;t know the internals of the package, what will you do then? Implement serialized access in your function or look at the sources of the new package to understand what happens there?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "edited": false, "score": 0, "creation_date": 1561118102, "post_id": 56702614, "comment_id": 99969187, "body": "@Sergey Look at its documentation. If it documents that it&#39;s safe for concurrent use, then that&#39;s good. If not, don&#39;t make that assumption."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1561125632, "last_edit_date": 1561125632, "creation_date": 1561116735, "answer_id": 56702614, "question_id": 56702183, "link": "https://stackoverflow.com/questions/56702183/check-if-function-is-being-called-as-goroutine-or-not/56702614#56702614", "title": "Check if function is being called as goroutine or not", "body": "<p>Every function is called from a goroutine, even the <code>main()</code> function (which is called the <code>main</code> goroutine).</p>\n\n<p>And goroutines in Go have no identity. It does not matter which goroutine calls a function.</p>\n\n<p>To answer your \"original\" question:</p>\n\n<blockquote>\n  <p>Is there any way to find out if a running function was called as goroutine or not?</p>\n</blockquote>\n\n<p>If we define this as the function being called with the <code>go</code> statement or without that, then the answer is yes: we can check that.</p>\n\n<p>But before we do: I would not use this information for anything. Don't write code that depends on this, nor on which goroutine calls a function. If you need to access a resource concurrently from multiple goroutines, just use proper synchronization.</p>\n\n<p>Basically we can check the call stack: the list of functions that call each other. If the function is at the top of that list, then it was called using <code>go</code> (check note at the end of the answer). If there are other functions before that in the call stack, then it was called without <code>go</code>, from another function (that places before in the call stack).</p>\n\n<p>We may use <a href=\"https://golang.org/pkg/runtime/#Callers\" rel=\"noreferrer\"><code>runtime.Callers()</code></a> to get the calling goroutine's stack. This is how we can check if there are other functions calling \"us\":</p>\n\n<pre><code>func f(name string) {\n    count := runtime.Callers(3, make([]uintptr, 1))\n    if count == 0 {\n        fmt.Printf(\"%q is launched as new\\n\", name)\n    }\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>func main() {\n    f(\"normal\")\n    go f(\"with-go\")\n\n    func() { f(\"from-anon\") }()\n    func() { go f(\"from-anon-with-go\") }()\n\n    f2(\"from-f2\")\n    go f2(\"with-go-from-f2\")\n\n    f3(\"from-f3\")\n    go f3(\"with-go-from-f3\")\n\n    time.Sleep(time.Second)\n}\n\nfunc f2(name string) { f(name) }\nfunc f3(name string) { go f(name) }\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/72AIbDXvQM2\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\"with-go\" is launched as new\n\"from-anon-with-go\" is launched as new\n\"from-f3\" is launched as new\n\"with-go-from-f3\" is launched as new\n</code></pre>\n\n<p><sup>Note: basically there is a <code>runtime.goexit()</code> function on \"top\" of all call stacks, this is the top-most function running on a goroutine and is the \"exit\" point for all goroutines. This is why we skip 3 frames from the stack (0. is <code>runtime.Callers()</code> itself, 1. is the <code>f()</code> function, and the last one to skip is <code>runtime.goexit()</code>). You can check the full call stacks with function and file names+line numbers in this <a href=\"https://play.golang.org/p/LDMtj2ZVljl\" rel=\"noreferrer\">Go Playground</a>. This doesn't change the viability of this solution, it's just that we have to skip 3 frames instead of 2 to tell if <code>f()</code> was called from another function or with the <code>go</code> statement.</sup></p>\n"}], "owner": {"reputation": 205, "user_id": 703537, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a18a71a6b7e4c95724209dea03bcad39?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/703537/sergey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 1, "accepted_answer_id": 56702614, "answer_count": 1, "score": 0, "last_activity_date": 1561125632, "creation_date": 1561114991, "question_id": 56702183, "link": "https://stackoverflow.com/questions/56702183/check-if-function-is-being-called-as-goroutine-or-not", "title": "Check if function is being called as goroutine or not", "body": "<p>Is there any way to find out if a running function was called as goroutine or not?</p>\n\n<p>I've read 'go tour' and I am interested in building a websocket server with golang, so I found this tutorial <a href=\"https://tutorialedge.net/golang/go-websocket-tutorial/\" rel=\"nofollow noreferrer\">https://tutorialedge.net/golang/go-websocket-tutorial/</a></p>\n\n<p>Now I'm wondering if wsEndpoint function from the tutorial is invoked as goroutine (e.g. go wsEndpoint(...)) or not.</p>\n\n<p>I've tried to read http package documentation, but did not get clear picture, just a guess that the handler will be called with go routine. Is that true?</p>\n"}, {"tags": ["go", "kubernetes", "openshift", "kubernetes-go-client"], "owner": {"reputation": 23, "user_id": 10819120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23375e59e7f1c064ec5a09fe761ece22?s=128&d=identicon&r=PG&f=1", "display_name": "MartinD", "link": "https://stackoverflow.com/users/10819120/martind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1608744391, "creation_date": 1561111751, "question_id": 56701287, "link": "https://stackoverflow.com/questions/56701287/how-can-i-use-username-and-password-authentication-of-the-openshift-go-client", "title": "How can i use username and password authentication of the openshift-go-client?", "body": "<p>I tried to use the Openshift go-client to access objects inside Openshift. But I was not successful with the authentication via username and password. Does anyone know how to use the client with username and password authentication? Did I forget any parameter when creating the configuration?</p>\n\n<p>I don't want to authenticate via Kubeconfig.</p>\n\n<p>I have created the REST configuration with username and password authentication. Alternatively I tried the Bearer-Token approach, which returns the expected result. I tried the following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>insecureCommunication := true\n\nrestConfig := rest.Config{\n    Host: \"https://my-url.net\",\n}\nauthInfo := auth.Info{\n    User:     \"username\",\n    Password: \"password\",\n    Insecure: &amp;insecureCommunication,\n}\n\nrestConfig, err := authInfo.MergeWithConfig(restConfig)\n\nbuildV1Client, err := buildv1.NewForConfig(&amp;restConfig)\nif err != nil {\n    fmt.Println(err)\n    return err\n}\n\nbuilds, err := buildV1Client.Builds(\"namespace\").List(metav1.ListOptions{})\nif err != nil {\n    fmt.Println(err)\n    return err\n}\n\nfmt.Printf(\"There are %d builds in project %s\\n\", len(builds.Items), openshift.namespace)\n// List names of all builds\nfor i, build := range builds.Items {\n    fmt.Printf(\"index %d: Name of the build: %s\", i, build.Name)\n}\n</code></pre>\n\n<p>I would expect the request to be successful as with the bearer token. But I always get a <code>user \"system:anonymous\" cannot list builds.build.openshift.io in project \"namespace\"</code> error. </p>\n\n<p>Does anyone have any idea how I can solve this problem?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "renderer", "go-templates"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561109660, "post_id": 56700666, "comment_id": 99965179, "body": "How are you serving the assets? Show the code that sets up your server router."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561109986, "post_id": 56700666, "comment_id": 99965353, "body": "Please put that into the question by editing it, not the comment."}, {"owner": {"reputation": 95, "user_id": 6098052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A52ktfHqyd4/AAAAAAAAAAI/AAAAAAAAATA/UQFvWz0wLyw/photo.jpg?sz=128", "display_name": "Soumya Sengupta", "link": "https://stackoverflow.com/users/6098052/soumya-sengupta"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1561110149, "post_id": 56700666, "comment_id": 99965436, "body": "updated the question.. please check.."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561110215, "post_id": 56700666, "comment_id": 99965467, "body": "Right, you&#39;re missing the code that sets up your router to serve static files, like <code>login.js</code>. Go to gorilla mux&#39;s github project page, the <code>README</code> contains examples on how to serve static files if I&#39;m not mistaken."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561110259, "post_id": 56700666, "comment_id": 99965496, "body": "... here: <a href=\"https://github.com/gorilla/mux#static-files\" rel=\"nofollow noreferrer\">github.com/gorilla/mux#static-files</a>"}, {"owner": {"reputation": 95, "user_id": 6098052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A52ktfHqyd4/AAAAAAAAAAI/AAAAAAAAATA/UQFvWz0wLyw/photo.jpg?sz=128", "display_name": "Soumya Sengupta", "link": "https://stackoverflow.com/users/6098052/soumya-sengupta"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561111428, "post_id": 56700666, "comment_id": 99966070, "body": "used the same, and updated the used code in the question itself. But still its not working. :("}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1561111733, "post_id": 56700666, "comment_id": 99966231, "body": "<code>router.PathPrefix(&quot;&#47;static&#47;&quot;).Handler(...)</code> tells the router to invoke the handler for requests that have a <code>&#47;static&#47;</code> prefix, so you need to update the link in your html from <code>&#39;login.js&#39;</code> to <code>&#39;&#47;static&#47;login.js&#39;</code>."}, {"owner": {"reputation": 95, "user_id": 6098052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A52ktfHqyd4/AAAAAAAAAAI/AAAAAAAAATA/UQFvWz0wLyw/photo.jpg?sz=128", "display_name": "Soumya Sengupta", "link": "https://stackoverflow.com/users/6098052/soumya-sengupta"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1561112063, "post_id": 56700666, "comment_id": 99966405, "body": "yes now its working fine. Thank you @mkopriva"}], "answers": [{"tags": [], "owner": {"reputation": 95, "user_id": 6098052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A52ktfHqyd4/AAAAAAAAAAI/AAAAAAAAATA/UQFvWz0wLyw/photo.jpg?sz=128", "display_name": "Soumya Sengupta", "link": "https://stackoverflow.com/users/6098052/soumya-sengupta"}, "is_accepted": true, "score": 1, "last_activity_date": 1561112154, "creation_date": 1561112154, "answer_id": 56701421, "question_id": 56700666, "link": "https://stackoverflow.com/questions/56700666/golang-renderer-html-not-picking-javascript-file-from-inside-the-template/56701421#56701421", "title": "golang renderer.HTML not picking javascript file from inside the template", "body": "<p>updated _login.html , its working fine with @mkopriva suggestion</p>\n\n<pre><code>{{ define \"_login\" }}\n&lt;!--\nhttps://medium.com/@thedevsaddam/easy-way-to-render-html-in-go-34575f858026\n--&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;!-- Bootstrap import CSS--&gt;\n&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"&gt;\n  &lt;body&gt;\n    &lt;div class=\"container\"&gt;\n      &lt;div class=\"starter-template jumbotron text-center\"&gt;\n        &lt;h1&gt;HI GUEST&lt;/h1&gt;\n        &lt;div class=\"col-sm-4\"&gt;\n        &lt;p class=\"lead\"&gt;Welcome to &lt;strong&gt;HI_GUEST --ssg&lt;/strong&gt; page&lt;/p&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.container --&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\" id=\"idtest1\"&gt;Test1&lt;/p&gt;&lt;/div&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\"&gt;Test2&lt;/p&gt;&lt;/div&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\"&gt;&lt;button type=\"button\" class=\"btn btn-info btn-lg\" name=\"btn_ip\" id=\"btn_id\" onclick=\"myFunction()\"&gt;{{.Val1}}&lt;/button&gt;&lt;/p&gt;&lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/body&gt;\n  &lt;script type='text/javascript' src='/static/login.js'&gt;&lt;/script&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 6098052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A52ktfHqyd4/AAAAAAAAAAI/AAAAAAAAATA/UQFvWz0wLyw/photo.jpg?sz=128", "display_name": "Soumya Sengupta", "link": "https://stackoverflow.com/users/6098052/soumya-sengupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 56701421, "answer_count": 1, "score": 0, "last_activity_date": 1561112154, "creation_date": 1561109552, "last_edit_date": 1561111393, "question_id": 56700666, "link": "https://stackoverflow.com/questions/56700666/golang-renderer-html-not-picking-javascript-file-from-inside-the-template", "title": "golang renderer.HTML not picking javascript file from inside the template", "body": "<p>Trying to publish a login page using \"github.com/thedevsaddam/renderer\" package renderer . Not able to call the .js file from inside the template. When tried inlining javascript it worked fine, but not able to load the .js file.</p>\n\n<p>my file structure is</p>\n\n<pre><code>Project\n|\n+-main.go\n|\n+-handlers\n| |\n| +- routes.go\n| |\n| +- login.go\n+-views\n| |\n| +- _login.html\n| +- login.js\n\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/higuestssg/handlers\"\n)\n\nfunc main() {\n    router := mux.NewRouter().StrictSlash(true)\n\n    // This will serve files under http://localhost:8000/static/&lt;filename&gt;\n    router.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"views/\"))))\n\n    portalRouter := router.PathPrefix(\"/portal\").Subrouter()\n    handlers.HandleRoutes(portalRouter)\n    fmt.Println(\"listening at localhost:10001\")\n    log.Fatal(http.ListenAndServe(\":10001\", router))\n}\n\n</code></pre>\n\n<p>routes.go</p>\n\n<pre><code>package handlers\n\nimport (\n  //\"net/http\"\n\n  \"github.com/gorilla/mux\"\n)\n\nfunc HandleRoutes(r *mux.Router){\n  r.HandleFunc(\"/login\", loginHandler)\n  r.HandleFunc(\"/healthTest\", healthTestHandler)\n}\n</code></pre>\n\n<p>login.go</p>\n\n<pre><code>package handlers\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    //\"github.com/gorilla/mux\"\n    \"github.com/thedevsaddam/renderer\"\n)\n\nvar rnd *renderer.Render\n\nfunc init() {\n    opts := renderer.Options{\n        ParseGlobPattern: \"./views/*.html\",\n    }\n    rnd = renderer.New(opts)\n}\n\n// loginHandler renders login page\nfunc loginHandler(w http.ResponseWriter, r *http.Request) {\n\n    data := struct {\n        Val1 string\n        Val2 string\n    }{\n        \"test100\",\n        \"test2\",\n    }\n    fmt.Println(\"login page hit\")\n    rnd.HTML(w, http.StatusOK, \"_login\", data)\n}\n</code></pre>\n\n<p>_login.html</p>\n\n<pre><code>{{ define \"_login\" }}\n&lt;!--\nhttps://medium.com/@thedevsaddam/easy-way-to-render-html-in-go-34575f858026\n--&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;!-- Bootstrap import CSS--&gt;\n&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"&gt;\n  &lt;body&gt;\n    &lt;div class=\"container\"&gt;\n      &lt;div class=\"starter-template jumbotron text-center\"&gt;\n        &lt;h1&gt;HI GUEST&lt;/h1&gt;\n        &lt;div class=\"col-sm-4\"&gt;\n        &lt;p class=\"lead\"&gt;Welcome to &lt;strong&gt;HI_GUEST --ssg&lt;/strong&gt; page&lt;/p&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.container --&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\" id=\"idtest1\"&gt;Test1&lt;/p&gt;&lt;/div&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\"&gt;Test2&lt;/p&gt;&lt;/div&gt;\n      &lt;div class=\"col-sm-4\"&gt;&lt;p class=\"lead\"&gt;&lt;button type=\"button\" class=\"btn btn-info btn-lg\" name=\"btn_ip\" id=\"btn_id\" onclick=\"myFunction()\"&gt;{{.Val1}}&lt;/button&gt;&lt;/p&gt;&lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/body&gt;\n  &lt;script type='text/javascript' src='login.js'&gt;&lt;/script&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n\n<p>login.js</p>\n\n<pre><code>\nfunction myFunction() \n{\n alert(\"Hello\");\n}\n\n$(document).ready(function () {\n  alert(\"Hello\");\n});\n</code></pre>\n\n<p>When checked in chrome using viewSource, when clicked on <code>login.js</code> its showing <code>404 not found</code></p>\n"}, {"tags": ["go", "go-modules", "godeps"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1561108945, "post_id": 56700443, "comment_id": 99964832, "body": "What you should or should not do is a matter of opinion. There are pros and cons to any such decision. We can&#39;t tell you what to do."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1561108978, "post_id": 56700443, "comment_id": 99964856, "body": "IMO you should switch to modules when starting a new project. Go 1.13 will be out in August (~2 months from now), having full support for modules, including default usage of the Go module mirror and checksum database. Also don&#39;t forget: if you start with <code>dep</code>, you will always have the option to switch to modules in the future... It&#39;s not like what you choose now you will have to carry for the rest of your life."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1561109634, "post_id": 56700443, "comment_id": 99965167, "body": "@icza Ok, the 2 months arguments is good. You could put it as an answer"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1561124431, "post_id": 56700443, "comment_id": 99972509, "body": "Not sure what you mean by &quot;in production&quot;. Modules have no impact on <i>running</i> a program, only on <i>building</i> it, which shouldn&#39;t be happening &quot;in production&quot;. Production should be where you run a built application."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1564802202, "post_id": 56700443, "comment_id": 101159872, "body": "There are still some problems with the tooling and editors like VS Code. However, the modules are widely accepted."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1561110718, "last_edit_date": 1592644375, "creation_date": 1561109862, "answer_id": 56700747, "question_id": 56700443, "link": "https://stackoverflow.com/questions/56700443/should-i-use-go-modules-in-production/56700747#56700747", "title": "Should I use go modules in production", "body": "<p>In my opinion, you should switch to modules when starting a new project. Go 1.13 will be out in August (~2 months from now), having full support for modules, including default usage of the Go module mirror and checksum database.</p>\n<p>Quoting from <a href=\"https://tip.golang.org/doc/go1.13\" rel=\"nofollow noreferrer\">preliminary Go 1.13 release docs</a>:</p>\n<blockquote>\n<p><strong>Go 1.13 is expected to be released in August 2019.</strong></p>\n<p>As of Go 1.13, the go command by default downloads and authenticates modules using the Go module mirror and Go checksum database run by Google. See <a href=\"https://proxy.golang.org/privacy\" rel=\"nofollow noreferrer\">https://proxy.golang.org/privacy</a> for privacy information about these services and the <a href=\"https://tip.golang.org/cmd/go/#hdr-Module_downloading_and_verification\" rel=\"nofollow noreferrer\">go command documentation</a> for configuration details including how to disable the use of these servers or use different ones.</p>\n</blockquote>\n<p>I see more and more repositories adding a <code>go.mod</code> file which means they are already tested and working with modules without any problems, and even if they don't have a <code>go.mod</code> file, that doesn't mean they can't be used with modules, but manual adjustment to dependencies or vendoring <em>might</em> be needed.</p>\n<p>Also don't forget: even if you don't start using modules now with your new project, you can switch to modules any time in the future, no one prevents that. But if you start with modules on day one, you will spare some work for yourself.</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 0, "closed_date": 1561124435, "accepted_answer_id": 56700747, "answer_count": 1, "score": -2, "last_activity_date": 1561110718, "creation_date": 1561108756, "question_id": 56700443, "link": "https://stackoverflow.com/questions/56700443/should-i-use-go-modules-in-production", "closed_reason": "Opinion-based", "title": "Should I use go modules in production", "body": "<p>I am using <code>dep</code>, but I am quite seduced by built-in <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">Go Modules</a> in Go 1.11</p>\n\n<p>In the docs, it says: </p>\n\n<blockquote>\n  <p>Go 1.11 includes preliminary support for versioned modules as proposed here. Modules are an experimental opt-in feature in Go 1.11, with the plan of incorporating feedback and finalizing the feature for Go 1.13. Even though some details may change, future releases will support modules defined using Go 1.11 or 1.12.</p>\n</blockquote>\n\n<p>Even with that said, it seems that Go Modules are widely used by community and that they work pretty well.</p>\n\n<p>So, for a new project, should I use Go Modules, or should I stick with <code>dep</code> ? I need help to take a decision.</p>\n"}]