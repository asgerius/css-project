[{"tags": ["go"], "comments": [{"owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "edited": false, "score": 1, "creation_date": 1559170385, "post_id": 56369383, "comment_id": 99341576, "body": "Not sure I understand what you&#39;re trying to achieve, but it looks to me like you want a mock object which implements <code>Interface</code>, but you don&#39;t want to duplicate the code from <code>C</code> and <code>D</code>. Maybe create a struct <code>MockP</code> which embeds <code>P</code>? Then <code>MockP</code> inherits all the methods of <code>P</code>, but you can shadow <code>A</code> and <code>B</code> with your own mock implementations."}, {"owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "reply_to_user": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "edited": false, "score": 0, "creation_date": 1559170629, "post_id": 56369383, "comment_id": 99341639, "body": "@MihaiTodor yes, I don&#39;t want to mock the functions that I don&#39;t need. Among the 10 functions that interface has, I only used 2."}, {"owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "reply_to_user": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "edited": false, "score": 0, "creation_date": 1559170898, "post_id": 56369383, "comment_id": 99341704, "body": "@MihaiTodor I tried your solution, it works well.  Thanks!"}, {"owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "edited": false, "score": 0, "creation_date": 1559182393, "post_id": 56369383, "comment_id": 99343943, "body": "I&#39;m happy to hear that my suggestion helped. I posted a detailed example as an answer."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559229959, "post_id": 56369383, "comment_id": 99362612, "body": "It sounds like it is poorly designed. &quot;Accept abstractions, return concretions&quot; - i.e., parameters should be interface types, returned values should be concrete types."}], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "edited": false, "score": 1, "creation_date": 1559185005, "post_id": 56370799, "comment_id": 99344395, "body": "I actually embedded the interface."}, {"owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "reply_to_user": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "edited": false, "score": 0, "creation_date": 1559220326, "post_id": 56370799, "comment_id": 99357355, "body": "That also works, but you&#39;ll get a panic if the code happens to call any method that hasn&#39;t been mocked."}], "tags": [], "owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "is_accepted": true, "score": 1, "last_activity_date": 1559182695, "last_edit_date": 1559182695, "creation_date": 1559182296, "answer_id": 56370799, "question_id": 56369383, "link": "https://stackoverflow.com/questions/56369383/testing-function-that-returns-an-interface/56370799#56370799", "title": "Testing function that returns an interface", "body": "<p>You can try creating a struct <code>MockP</code> which embeds <code>P</code>. Then <code>MockP</code> inherits all the methods of <code>P</code>, but you can shadow <code>A()</code> and <code>B()</code> with your own mock implementations. Here's an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Interface interface {\n    A()\n    B()\n}\n\ntype P struct {\n}\n\nfunc (p P) A() {\n    fmt.Println(\"A\")\n}\n\n\nfunc (p P) B() {\n    fmt.Println(\"B\")\n}\n\ntype MockP struct {\n    P\n}\n\n// Shadow P's B() method\nfunc (p MockP) B() {\n    fmt.Println(\"Mock B\")\n}\n\nfunc main() {\n    var p Interface = MockP{}\n    p.A()\n    p.B()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>A\nMock B\n</code></pre>\n"}], "owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 56370799, "answer_count": 1, "score": 1, "last_activity_date": 1559182695, "creation_date": 1559169256, "question_id": 56369383, "link": "https://stackoverflow.com/questions/56369383/testing-function-that-returns-an-interface", "title": "Testing function that returns an interface", "body": "<p>I'm having difficulty writing test for the case below.</p>\n\n<p>I'm able to write test for \"helper\" with a mock object that only implements the functions that used by myself.</p>\n\n<p>How do I write test code for the function 'new' using a mock object without mocking functions C(), D()?</p>\n\n<p>It could be that the other package is written poorly that it should not return an Interface but rather the actual struct?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    New()\n}\n\nfunc New() {\n    new(NewFromEnvironment)\n}\n\ntype newTopology func()(Interface,error)\n\n// new is non-exposed simply used for testing purpose.\nfunc new(newTopology newTopology) {\n  t,_ :=  newTopology()\n  helper(t)\n}\n\n// I need to call only A and B\ntype topologyInterface interface {\n    A() string\n    B() string\n}\n\nfunc helper(topology topologyInterface) {\n    s1 := topology.A()\n    s2 := topology.B()\n    fmt.Println(s1 + \",\" + s2)\n}\n\n// Below are from other package named \"topology\".\n// I have no control to the code below.\n\ntype Interface interface {\n    A() string\n    B() string\n    C() string\n    D() string\n    //... more\n}\n\nfunc NewFromEnvironment() (Interface, error) {\n    return P{}, nil\n}\n\ntype P struct{}\n\nfunc (p P) A() string {\n    return \"A\"\n}\n\nfunc (p P) B() string {\n    return \"B\"\n}\n\nfunc (p P) C() string {\n    return \"C\"\n}\n\nfunc (p P) D() string {\n    return \"D\"\n}\n\n// more...\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1559159100, "post_id": 56367423, "comment_id": 99338042, "body": "It might be caught by a linter, but the compiler doesn&#39;t care about semantics. You have 3 function calls, which is legal. You can&#39;t have a <code>return</code> followed by more code, but to the compiler <code>os.Exit</code> is just another function."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559166301, "post_id": 56367423, "comment_id": 99340497, "body": "@Adrian Actually in Go it is not an error to have code after a <code>return</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559222857, "post_id": 56367423, "comment_id": 99358710, "body": "@icza sorry you&#39;re right, I forgot Playground runs <code>go vet</code> before <code>go run</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1559167574, "last_edit_date": 1592644375, "creation_date": 1559166690, "answer_id": 56369012, "question_id": 56367423, "link": "https://stackoverflow.com/questions/56367423/shouldnt-unreachable-code-after-os-exit-be-flagged/56369012#56369012", "title": "shouldn&#39;t unreachable code after os.Exit be flagged", "body": "<p><a href=\"https://golang.org/pkg/os/#Exit\" rel=\"nofollow noreferrer\"><code>os.Exit()</code></a> is just like any other function, the compiler should not know it terminates the app and so the rest of the code that follows is unreachable. <code>os.Exit()</code> is just one example and there are more, e.g.<a href=\"https://golang.org/pkg/log/#Fatal\" rel=\"nofollow noreferrer\"><code>log.Fatal()</code></a> (which calls <code>os.Exit()</code>). Not to mention you can also create a function which calls one of these, how far should the compiler go to detect all or most of these?</p>\n<p>Going further, the Go compiler does not detect nor marks &quot;truly&quot; unreachable code. The following variation when using a <code>return</code> statement could even be obvious to the compiler:</p>\n<pre><code>func main() {\n    fmt.Println(&quot;Hello, playground&quot;)\n    return\n    fmt.Println(&quot;Good By, playground&quot;)\n}\n</code></pre>\n<p>Yet it compiles and runs just fine, and outputs (try it on the <a href=\"https://play.golang.org/p/Aw3WdB4ctj4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>Hello, playground\n</code></pre>\n<p>So the compiler does not detect unreachable code, but <code>go vet</code> does, which is also run by the Go Playground, and so you can see the app's output prefixed by:</p>\n<pre><code>./prog.go:10:2: unreachable code\nGo vet exited.\n</code></pre>\n<p>This has been brought up before, see <a href=\"https://github.com/golang/go/issues/9501\" rel=\"nofollow noreferrer\">cmd/gc: report unreachable code #9501</a>. Robert Grisemer's response was:</p>\n<blockquote>\n<p>Generally, Go's philosophy is not to protect the programmer at all costs from his/her mistakes. It's deliberate to not raise an error for unreachable code. It's also not a very common kind of mistake. Besides, it's often useful to introduce early returns for debugging which may cause plenty of unreachable code. It's not clear the benefits outweigh the costs and disadvantages.</p>\n<p>Unused variables can lead to subtle find bugs in conjunction with Go's re-declaration mechanism in short variable declarations - hence the error message for unused variables. This is a mechanism that evolved from experience and is a pragmatic solution for a concrete problem.</p>\n<p>Unused imports are reported because it helps keeping dependencies under control - an important tool in large-scale systems design and as a side-effect it also keeps compile times fast. Again a very deliberate design decision.</p>\n<p>Finally, making dead code an error would be a significant language change which is out of the question at this point.</p>\n<p>Use go vet.</p>\n</blockquote>\n"}], "owner": {"reputation": 15, "user_id": 2033930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09aadf4e79e245b7fab4544f03070d9c?s=128&d=identicon&r=PG", "display_name": "Bill Lanahan", "link": "https://stackoverflow.com/users/2033930/bill-lanahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1559167574, "creation_date": 1559158734, "last_edit_date": 1559158758, "question_id": 56367423, "link": "https://stackoverflow.com/questions/56367423/shouldnt-unreachable-code-after-os-exit-be-flagged", "title": "shouldn&#39;t unreachable code after os.Exit be flagged", "body": "<p>go 1.12 window</p>\n\n<p>misplaced a fmt.Println after os.Exit instead of before,\nshouldn't this have gotten a compiler failure or at least warning?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    os.Exit(0)\n    fmt.Println(\"Good By, playground\")\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1559540427, "post_id": 56367357, "comment_id": 99438295, "body": "In order to use MongoDB multi-documents transactions you need a replica set. This is a duplicate to <a href=\"https://stackoverflow.com/questions/51461952/mongodb-v4-0-transaction-mongoerror-transaction-numbers-are-only-allowed-on-a\" title=\"mongodb v4 0 transaction mongoerror transaction numbers are only allowed on a\">stackoverflow.com/questions/51461952/&hellip;</a>"}, {"owner": {"reputation": 212, "user_id": 5961207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2183baa733d4702abd670be9e0343266?s=128&d=identicon&r=PG", "display_name": "revant", "link": "https://stackoverflow.com/users/5961207/revant"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1559767593, "post_id": 56367357, "comment_id": 99527059, "body": "I had created a replica set. My issue was with the mongo go driver not able to connect to it properly."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565916813, "post_id": 56367357, "comment_id": 101503256, "body": "Could you provide the connection error message? because the error message that you posted (<code>IllegalOperation</code>) indicates that the deployment is not a replica set."}, {"owner": {"reputation": 133, "user_id": 12330715, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wdhhT-WJ02E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd3ZTuMbyvFm9C2Gte4Aeg2u1DXXw/photo.jpg?sz=128", "display_name": "Weq Iou", "link": "https://stackoverflow.com/users/12330715/weq-iou"}, "edited": false, "score": 0, "creation_date": 1592037696, "post_id": 56367357, "comment_id": 110284829, "body": "hey @revant, did u find out about this what&#39;s wrong? I really need know this so bad, I have same issue like you that can&#39;t connect, hope u can share the answer of this"}], "owner": {"reputation": 212, "user_id": 5961207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2183baa733d4702abd670be9e0343266?s=128&d=identicon&r=PG", "display_name": "revant", "link": "https://stackoverflow.com/users/5961207/revant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1578, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1559158422, "creation_date": 1559158422, "question_id": 56367357, "link": "https://stackoverflow.com/questions/56367357/not-able-to-use-mongodb-transactions-using-mongo-go-driver", "title": "Not able to use mongodb transactions using mongo go driver", "body": "<p>I have created a mongodb replica set. I am able to run transactions from the mongo shell. But when I try to do it using mongo-go-driver I always get this error <code>(IllegalOperation) Transaction numbers are only allowed on a replica set member or mongos</code>. I am not sure where I am going wrong. I am using this as a reference <code>https://github.com/simagix/mongo-go-examples/blob/master/examples/transaction_test.go</code>. </p>\n\n<p>I create the client like this </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>client, err := mongo.NewClient(options.Client().ApplyURI(\"mongodb://localhost:27017,localhost:27018,localhost:27019?replicaSet=rs\"))\n</code></pre>\n\n<p>I can connect to the individual mongodb instances, just not the replica set.\nThis is the transaction that I am trying to run</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var session mongo.Session\n\ncoll := db.Collection(\"collectionname\")\n\nif session, err = client.StartSession(); err != nil {\n    return \"\", fmt.Errorf(\"Could not start session: %q\", err)\n}\n\nif err = session.StartTransaction(); err != nil {\n    return \"\", fmt.Errorf(\"Could not start Transaction: %q\", err)\n}\n\nif err = mongo.WithSession(ctx, session, func(sc md.SessionContext) error {\n\n    newVal, err = coll.InsertOne(sc, val) // some val that I have\n    if err != nil {\n        sc.AbortTransaction(sc)\n        return fmt.Errorf(\"Error during New address creation, aborting: %q\", err)\n    }\n\n    if err = sc.CommitTransaction(sc); err != nil {\n        return fmt.Errorf(\"Error While commiting New address Transaction: %q\", err)\n    }\n    return nil\n}); err != nil {\n    return \"\", err\n}\n\nsession.EndSession(ctx)\n</code></pre>\n\n<p>Is there something I am missing. Is there some other example maybe that I can reference. Thanks for the help/suggestions.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "is_accepted": true, "score": 1, "last_activity_date": 1559273973, "last_edit_date": 1559273973, "creation_date": 1559158513, "answer_id": 56367373, "question_id": 56367058, "link": "https://stackoverflow.com/questions/56367058/using-gorm-and-postgresql-how-to-set-the-search-path/56367373#56367373", "title": "Using GORM and Postgresql how to set the search_path?", "body": "<p>FOUND how to display current schema by experimenting and a hint about Raw and Scan in PluralSite's GORM class. </p>\n\n<pre><code>var currentSchema string\nrows, err := db.Debug().Raw(\"show search_path\").Rows()\nrows.Next()  // to get the first and only result\nrows.Scan(&amp;currentSchema)\nfmt.Printf(\"Search Path: %v\\n\", currentSchema)\n</code></pre>\n\n<p>returns: Search Path: \"$user\", public</p>\n\n<p>Taking @PavloStrokov point about transactions (which are basically threads and a transaction) into account, I was able to get the schema to stay during the current process. In the handler, I use the existing DB connection and create a transaction. It gets passed to every method that is called that touches the Database. I change the call to the gorm method to be the passed tx instead of the normal db variable that was stored and made available to any method that needed it.</p>\n\n<p>The call I make to start it all of is:</p>\n\n<p>tx := db.Begin()</p>\n\n<p>tx.Exec(\"set search_path to schema_name\")</p>\n\n<p>The string is generated to use the proper Facility schema name.</p>\n\n<p>The tx is the last param in the signature of all methods that touch the DB. For example func methiodUsingDBSchema(val1 string, val2 string,  tx *gorm.DB){}</p>\n\n<p>Then the last thing I do is tx.Commit()  Even though these are all reads.</p>\n\n<p>I have run all test and works well. </p>\n\n<p>I use the Postgres schemas to separate Facilities in my application and need to change based upon the user logged in.  All User and Facility information is in public. </p>\n"}, {"comments": [{"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1559170378, "post_id": 56368340, "comment_id": 99341574, "body": "Changing for the current query IS what is needed. We look at the current user using the API and check their facility, then change the current schema to the proper one for their current facility. User can be at different facilities or accessing different facilities at any time.  This app was originally written in Rails using Apartments and has processed 100s of million API calls each one could be one of several facilities.  The on DB open is more expensive if have to do on every call or keep track of which process has which facility open.  It was tried several years ago and unacceptable."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1559198475, "post_id": 56368340, "comment_id": 99347683, "body": "@DonaldFrench than please execute it in the transaction, otherwise you could get into situation when you run <code>set</code> on one connection, but actual query will be run on the other with the old search_path. When you open transaction it sticks to to connection and you will be in safe."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1559293037, "post_id": 56368340, "comment_id": 99382519, "body": "@DonaldFrench if you find my comments useful, please click &quot;arrow up&quot;. I want to reach 1k reputation :)"}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 2, "last_activity_date": 1559163157, "creation_date": 1559163157, "answer_id": 56368340, "question_id": 56367058, "link": "https://stackoverflow.com/questions/56367058/using-gorm-and-postgresql-how-to-set-the-search-path/56368340#56368340", "title": "Using GORM and Postgresql how to set the search_path?", "body": "<p>Setting <code>search_path</code> by executing query like <code>set search_path to newschema</code> is incorrect way of setting, because this will be changed only for the connection that was used to execute the query.  </p>\n\n<p>To set it to full set of connection that your application will use you need to provide <code>search_path</code> as an argument to <code>gorm.Open(\"postgres\", \"dbname=YourDB search_path=YourSearchPath\")</code> with all other connection arguments you gonna to use like <code>dbname</code> or <code>port</code>, <code>user</code>, etc.</p>\n"}], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 627, "favorite_count": 0, "accepted_answer_id": 56367373, "answer_count": 2, "score": 0, "last_activity_date": 1564035667, "creation_date": 1559157015, "last_edit_date": 1564035667, "question_id": 56367058, "link": "https://stackoverflow.com/questions/56367058/using-gorm-and-postgresql-how-to-set-the-search-path", "title": "Using GORM and Postgresql how to set the search_path?", "body": "<p>How can I get the current schema from gorm?  Normally it is \"SHOW search_path\" and is an exec.  Same with setting the current search_path  normally \"set search_path to newschema\". where new schema can be a single schema name of a series of names.</p>\n\n<p>I attempted db.Exec(\"show search_path\").Find(&amp;result) where result is a []string and I get an empty array. </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ec2", "aws-sdk-go"], "comments": [{"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1559164587, "post_id": 56366301, "comment_id": 99340017, "body": "can you elaborate on the methods you are calling to get this <code>DescribeVolumesOutput </code> The trick should be to mock a service method and expect an already known value."}, {"owner": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "reply_to_user": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1559175163, "post_id": 56366301, "comment_id": 99342578, "body": "@diyoda_ I have yet to make the methods since I am trying TDD, and failing at it, and trying to create the tests first. Basically the method will use <code>DescribeVolumesOutput</code> to check each volume for tags and return the VolumeId for each. so what I want to mock are tag values and volume id&#39;s"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "edited": false, "score": 0, "creation_date": 1559174780, "post_id": 56368873, "comment_id": 99342509, "body": "Awesome! Thank you this clarifies a lot! However I am still confused on this part <code>&amp;ec2.DescribeVolumesOutput{...your initialization...}</code> if I can not mock the types then how am I supposed to make what the outputs are? I guess I am mostly lost on how to prepare an <code>ec2.DescribeVolumesOutput</code> result."}, {"owner": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "edited": false, "score": 0, "creation_date": 1559175479, "post_id": 56368873, "comment_id": 99342645, "body": "For instance I want to mock tag and volume id values. How would I initialize those?"}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "edited": false, "score": 0, "creation_date": 1559198830, "post_id": 56368873, "comment_id": 99347840, "body": "@AlexCosta   <code>volumeId := &quot;Your mock for VolumeId&quot;</code>   <code>tagKey := &quot;Your mock for Tag Key&quot;</code>   <code>tagValue := &quot;Your mock for Tag Value&quot;</code>   <code>tag := ec2.Tag{Key: &amp;tagKey, Value: &amp;tagValue}</code>   <code>mocked := &amp;ec2.DescribeVolumesOutput{</code>       <code>Volumes: []*ec2.Volume{{VolumeId: &amp;volumeId, Tags: []*ec2.Tag{&amp;tag}}}</code>   <code>}</code>"}, {"owner": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "edited": false, "score": 0, "creation_date": 1559503596, "post_id": 56368873, "comment_id": 99432205, "body": "AHHHHHH Thank you! This now makes sense to me!"}, {"owner": {"reputation": 588, "user_id": 9464037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9xNLd.jpg?s=128&g=1", "display_name": "tedsmitt", "link": "https://stackoverflow.com/users/9464037/tedsmitt"}, "edited": false, "score": 0, "creation_date": 1616290721, "post_id": 56368873, "comment_id": 117955314, "body": "2 years later and still as useful as ever. Really good example, take my upvote!"}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 3, "last_activity_date": 1559165870, "creation_date": 1559165870, "answer_id": 56368873, "question_id": 56366301, "link": "https://stackoverflow.com/questions/56366301/how-do-you-mock-the-value-of-ec2-describevolumesoutput/56368873#56368873", "title": "How do you mock the value of *ec2.DescribeVolumesOutput", "body": "<p>There is no way to mock the type, you are able to mock only implementation of the interface. In your case I assume that you are trying to call <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/ec2/ec2iface/interface.go#L1032\" rel=\"nofollow noreferrer\">DescribeVolumes</a> and in the response get value constructed by you.<br>\nTo do that you need to create a mock like </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MockEC2API struct {\n    ec2iface.EC2API // embedding of the interface is needed to skip implementation of all methods\n    DescribeVolumesMethod func(*ec2.DescribeVolumesInput) (*ec2.DescribeVolumesOutput, error)\n}\n\nfunc (m *MockEC2API) DescribeVolumes(in *ec2.DescribeVolumesInput) (*ec2.DescribeVolumesOutput, error) {\n    if m.DescribeVolumesMethod != nil {\n        return m.DescribeVolumesMethod(in)\n    }\n    return nil, nil // return any value you think is good for you\n}\n</code></pre>\n\n<p>In the test create instance of <code>MockEC2API</code> instead of the real <code>ec2.EC2</code> and provide it with function that will be called and return your's prepared <code>ec2.DescribeVolumesOutput</code> result</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\nec2 := &amp;MockEC2API{\n    DescribeVolumesMethod: func(*ec2.DescribeVolumesInput) (*ec2.DescribeVolumesOutput, error) {\n        return &amp;ec2.DescribeVolumesOutput{...your initialization...}, nil\n    }\n}\n...\noutput, err := ec2.DescribeVolumes(in) // this output will be your prepared initialization\n\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11570764, "user_type": "registered", "profile_image": "https://graph.facebook.com/10161904088095258/picture?type=large", "display_name": "Alex Costa", "link": "https://stackoverflow.com/users/11570764/alex-costa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 0, "accepted_answer_id": 56368873, "answer_count": 1, "score": 2, "last_activity_date": 1559165870, "creation_date": 1559153291, "question_id": 56366301, "link": "https://stackoverflow.com/questions/56366301/how-do-you-mock-the-value-of-ec2-describevolumesoutput", "title": "How do you mock the value of *ec2.DescribeVolumesOutput", "body": "<p>I am currently trying to get used to TDD and on a current project I am working on I am trying to leverage AWS's Go SDK. Which is all fine and dandy and I have used it before but I am currently trying to mock the value that <code>*ec2.DescribeVolumesOutput</code> sends.</p>\n\n<p>Diving into the code I see this as what returns for <code>*ec2.DescribeVolumesOutput</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type DescribeVolumesOutput struct {\n    _ struct{} `type:\"structure\"`\n\n    // The NextToken value to include in a future DescribeVolumes request. When\n    // the results of a DescribeVolumes request exceed MaxResults, this value can\n    // be used to retrieve the next page of results. This value is null when there\n    // are no more results to return.\n    NextToken *string `locationName:\"nextToken\" type:\"string\"`\n\n    // Information about the volumes.\n    Volumes []*Volume `locationName:\"volumeSet\" locationNameList:\"item\" type:\"list\"`\n}\n</code></pre>\n\n<p>Okay.. That's cool, but what I want to mock the output of must live inside of <code>Volumes []*Volume</code>locationName:\"volumeSet\" locationNameList:\"item\" type:\"list\"` so let's go a little deeper and see what that is...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Volume struct {\n    _ struct{} `type:\"structure\"`\n\n    // Information about the volume attachments.\n    Attachments []*VolumeAttachment `locationName:\"attachmentSet\" locationNameList:\"item\" type:\"list\"`\n\n    // The Availability Zone for the volume.\n    AvailabilityZone *string `locationName:\"availabilityZone\" type:\"string\"`\n\n    // The time stamp when volume creation was initiated.\n    CreateTime *time.Time `locationName:\"createTime\" type:\"timestamp\"`\n\n    // Indicates whether the volume will be encrypted.\n    Encrypted *bool `locationName:\"encrypted\" type:\"boolean\"`\n\n    // The number of I/O operations per second (IOPS) that the volume supports.\n    // For Provisioned IOPS SSD volumes, this represents the number of IOPS that\n    // are provisioned for the volume. For General Purpose SSD volumes, this represents\n    // the baseline performance of the volume and the rate at which the volume accumulates\n    // I/O credits for bursting. For more information, see Amazon EBS Volume Types\n    // (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html)\n    // in the Amazon Elastic Compute Cloud User Guide.\n    //\n    // Constraints: Range is 100-16,000 IOPS for gp2 volumes and 100 to 64,000IOPS\n    // for io1 volumes, in most Regions. The maximum IOPS for io1 of 64,000 is guaranteed\n    // only on Nitro-based instances (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html#ec2-nitro-instances).\n    // Other instance families guarantee performance up to 32,000 IOPS.\n    //\n    // Condition: This parameter is required for requests to create io1 volumes;\n    // it is not used in requests to create gp2, st1, sc1, or standard volumes.\n    Iops *int64 `locationName:\"iops\" type:\"integer\"`\n\n    // The full ARN of the AWS Key Management Service (AWS KMS) customer master\n    // key (CMK) that was used to protect the volume encryption key for the volume.\n    KmsKeyId *string `locationName:\"kmsKeyId\" type:\"string\"`\n\n    // The size of the volume, in GiBs.\n    Size *int64 `locationName:\"size\" type:\"integer\"`\n\n    // The snapshot from which the volume was created, if applicable.\n    SnapshotId *string `locationName:\"snapshotId\" type:\"string\"`\n\n    // The volume state.\n    State *string `locationName:\"status\" type:\"string\" enum:\"VolumeState\"`\n\n    // Any tags assigned to the volume.\n    Tags []*Tag `locationName:\"tagSet\" locationNameList:\"item\" type:\"list\"`\n\n    // The ID of the volume.\n    VolumeId *string `locationName:\"volumeId\" type:\"string\"`\n\n    // The volume type. This can be gp2 for General Purpose SSD, io1 for Provisioned\n    // IOPS SSD, st1 for Throughput Optimized HDD, sc1 for Cold HDD, or standard\n    // for Magnetic volumes.\n    VolumeType *string `locationName:\"volumeType\" type:\"string\" enum:\"VolumeType\"`\n}\n</code></pre>\n\n<p>Nice! this looks like some data that I want to mock the values of! </p>\n\n<p>But over the last couple of days I have had no luck in actually mocking these values. Are they so nested that this type of mocking is not worth the effort? Even trying to use the <code>github.com/aws/aws-sdk-go/service/ec2/ec2iface</code> does not seem to help me wrap my head around how to properly package some mock value returns to test. Am I coming at TDD all wrong? am I missing something super obvious? I do not really have example code to show since I now no longer understand what I am trying to do. </p>\n\n<p>Does anyone possibly have an example of how they have mocked this?</p>\n"}, {"tags": ["go", "cron", "scheduled-tasks", "scheduler"], "answers": [{"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": true, "score": 0, "last_activity_date": 1559158660, "creation_date": 1559158660, "answer_id": 56367403, "question_id": 56364706, "link": "https://stackoverflow.com/questions/56364706/how-to-set-up-multiple-crons-for-different-timezones/56367403#56367403", "title": "How to set up multiple crons for different timezones", "body": "<p>As stated in the <a href=\"https://godoc.org/github.com/robfig/cron#Parse\" rel=\"nofollow noreferrer\">docs</a> <code>s, err1 := cron.Parse(\"30 10 * * *\")</code> creates a new cron job executed hourly at exactly 10mins and 30sec.</p>\n\n<p>Because your time was <code>2019/05/30 00:59:21</code> the next avaiable slot would be exactly like stated <code>01:10:30 +0900 JST</code>.</p>\n\n<p>To create a new job executed daily at 10:30 local time use <code>s, err1 := cron.Parse(\"0 30 10 * *\")</code> instead. For a quick overview use <a href=\"https://godoc.org/github.com/robfig/cron#hdr-Predefined_schedules\" rel=\"nofollow noreferrer\">Predefined schedules</a> in the docs, it displays it in a nice table.</p>\n"}], "owner": {"reputation": 5, "user_id": 11571125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ba5f095533553ab4b8f8b51c4ca621?s=128&d=identicon&r=PG&f=1", "display_name": "cjder75", "link": "https://stackoverflow.com/users/11571125/cjder75"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 56367403, "answer_count": 1, "score": 0, "last_activity_date": 1559158660, "creation_date": 1559146337, "last_edit_date": 1559149526, "question_id": 56364706, "link": "https://stackoverflow.com/questions/56364706/how-to-set-up-multiple-crons-for-different-timezones", "title": "How to set up multiple crons for different timezones", "body": "<p>Following my question <a href=\"https://stackoverflow.com/questions/56354424/cron-job-doesnt-trigger-with-timezone\">about cron job and timezone</a></p>\n\n<p>I would like to know what would be the best way to  schedule things at different time zones:</p>\n\n<ul>\n<li>Something to run at : 16h30 Tokyo time</li>\n<li>Then another to run at :  10AM London time </li>\n<li>Another at 3PM NYC Time , etc etc.</li>\n</ul>\n\n<p>I have multiple cron jobs like those that i need to run and my code from previous post doesn't seem to cut it. </p>\n\n<p>I don't know what is the best way to proceed as it should be independent of the server time, so working with UTC time doesn't really cut it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/robfig/cron\"\n    \"os\"\n    \"os/signal\"\n    \"time\"\n)\n\nfunc helloWorld() {\n  fmt.Println(\"hello world\")\n}\n\nfunc main() {\n    s, err1 := cron.Parse(\"30 10 * * *\")\n    fmt.Println(err1)\n    l, err := time.LoadLocation(\"Asia/Tokyo\")\n    fmt.Println(err)\n    c := cron.NewWithLocation(l)\n    c.Schedule(s, cron.FuncJob(helloWorld))\n    c.Start()\n\n    sig := make(chan os.Signal)\n    signal.Notify(sig, os.Interrupt, os.Kill)\n    &lt;-sig\n}\n</code></pre>\n\n<p>After my previous post i've found that you could check the scheduler this way :</p>\n\n<pre><code>    test := c.Entries()\n    log.Println(test[0].Schedule)\n    log.Println(test[0].Next)\n    log.Println(test[0].Prev)\n</code></pre>\n\n<p>and got as result (the first 2 nils being the err \"handling\"):</p>\n\n<pre><code>    &lt;nil&gt;\n    &lt;nil&gt;\n    2019/05/30 00:59:21 &amp;{1073741824 1024 9223372036871553023 9223372041149743102 9223372036854783998 9223372036854775935}\n    2019/05/30 00:59:21 2019-05-30 01:10:30 +0900 JST\n    2019/05/30 00:59:21 0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>You can see that it's scheduled to run at 01:10:30 Japan time ( JST ) instead of 10:30 AM JST that i expected. </p>\n\n<p>Anybody know what's happening. I'm gonna need to do this for upward of 70 timezones.. </p>\n"}, {"tags": ["go", "artifactory"], "answers": [{"comments": [{"owner": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "edited": false, "score": 0, "creation_date": 1561417315, "post_id": 56742459, "comment_id": 100048587, "body": "some of the packages are not available in GoCenter and also we have some private packages that we want to use from GitHub Ent and BitBucket."}, {"owner": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "edited": false, "score": 0, "creation_date": 1561417347, "post_id": 56742459, "comment_id": 100048594, "body": "Also I tried resolving packages from Virtual repo I get same error."}, {"owner": {"reputation": 81, "user_id": 5718507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/decd57e279ba4fe28709490e87d69a31?s=128&d=identicon&r=PG&f=1", "display_name": "DonMy", "link": "https://stackoverflow.com/users/5718507/donmy"}, "reply_to_user": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "edited": false, "score": 0, "creation_date": 1561440791, "post_id": 56742459, "comment_id": 100052915, "body": "Unsupported repository request means Artifactory can&#39;t find that go repo. It has to be local or virtual. What have you used for your goproxy?"}, {"owner": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "edited": false, "score": 0, "creation_date": 1561488363, "post_id": 56742459, "comment_id": 100078023, "body": "Thanks I got github working I had configured <code>Artifactory</code> as Module provider. Now only Bitbucket on prime is remaining. for bitbucket I have configured <code>Stash &#47; Bitbuket Private</code> as module provider. Still when I try to fetch module It gives 404 without trying to fetch it from bitbucket-go remote repo in artifactory."}, {"owner": {"reputation": 81, "user_id": 5718507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/decd57e279ba4fe28709490e87d69a31?s=128&d=identicon&r=PG&f=1", "display_name": "DonMy", "link": "https://stackoverflow.com/users/5718507/donmy"}, "reply_to_user": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "edited": false, "score": 0, "creation_date": 1561571514, "post_id": 56742459, "comment_id": 100112186, "body": "Unfortunately, BitBucket and GitHub on prem are not supported yet. But do upgrade to Artifactory 6.10 or up, there was some fixes to Go focusing on the UX of those flows and more..."}], "tags": [], "owner": {"reputation": 81, "user_id": 5718507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/decd57e279ba4fe28709490e87d69a31?s=128&d=identicon&r=PG&f=1", "display_name": "DonMy", "link": "https://stackoverflow.com/users/5718507/donmy"}, "is_accepted": true, "score": 2, "last_activity_date": 1561402810, "creation_date": 1561402810, "answer_id": 56742459, "question_id": 56364559, "link": "https://stackoverflow.com/questions/56364559/how-to-use-jfrog-artifactory-to-proxy-github-as-go-repository/56742459#56742459", "title": "How to use JFrog Artifactory to proxy GitHub as Go Repository?", "body": "<p>In Artifactory Go repositories, you can't resolve from a remote repository directly, packages has to be resolved from a virtual repo.\nJust include it in any Go virtual repository and you should be good to go.</p>\n\n<p>Also, why not use gocenter for Go packages? It's much more reliable IMO.</p>\n"}], "owner": {"reputation": 1097, "user_id": 6125764, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058553257541751/picture?type=large", "display_name": "Jainish Shah", "link": "https://stackoverflow.com/users/6125764/jainish-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 0, "accepted_answer_id": 56742459, "answer_count": 1, "score": 3, "last_activity_date": 1561402810, "creation_date": 1559145744, "last_edit_date": 1561396565, "question_id": 56364559, "link": "https://stackoverflow.com/questions/56364559/how-to-use-jfrog-artifactory-to-proxy-github-as-go-repository", "title": "How to use JFrog Artifactory to proxy GitHub as Go Repository?", "body": "<p>I want to use Go Remote repository caching/proxying Github. \nI have created Go remote repo <code>github</code> proxying <code>https://github.com/</code> (Credentials added as mentioned in <a href=\"https://www.jfrog.com/confluence/display/RTF/Go+Registry#GoRegistry-RemoteRepositories\" rel=\"nofollow noreferrer\">https://www.jfrog.com/confluence/display/RTF/Go+Registry#GoRegistry-RemoteRepositories</a>). </p>\n\n<p>When I run <code>go get</code> artifactory log shows following error: </p>\n\n<pre><code>2019-05-29 16:01:29,586 [http-nio-8081-exec-252] [ERROR] (o.a.a.g.r.GoResource:88) - Unsupported go repository request for 'github'```\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1559146082, "post_id": 56363771, "comment_id": 99332448, "body": "Have you read <a href=\"https://golang.org/cmd/cgo/#hdr-Passing_pointers\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1559146177, "post_id": 56363771, "comment_id": 99332491, "body": "A direct solution is to use <code>C.malloc(4 * C.sizeof(C.double))</code> to allocate the array of <code>double</code>-s. Note that you have to make sure to call <code>C.free()</code> on it when done. The same applies to the second array of a single <code>int</code>."}, {"owner": {"reputation": 1, "user_id": 11568153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51efccd290cc0fa165045fc0c2ce1ab3?s=128&d=identicon&r=PG&f=1", "display_name": "Mattanis", "link": "https://stackoverflow.com/users/11568153/mattanis"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1560266133, "post_id": 56363771, "comment_id": 99675410, "body": "@kostix : thanks for giving some pointers. I tried with  <code>a1 := [4]C.double{1,1,1,1}  sizeA1 := C.malloc(4 * C.sizeof_double)  cstruct := C.emxArray_real_T{data: &amp;a1[0], size: (*C.int)(sizeA1)}  y := C.sumArray(cstruct)  defer C.free(sizeA1)</code> but it gave me the same answer as before cgo argument has Go pointer to Go pointer when I tried to run the program"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1560276793, "post_id": 56363771, "comment_id": 99680848, "body": "Okay, seems you did not completely grok it on the first try. Too much to write, so I&#39;ve created an answer. Is it clearer now?"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1560874570, "last_edit_date": 1560874570, "creation_date": 1560276758, "answer_id": 56549525, "question_id": 56363771, "link": "https://stackoverflow.com/questions/56363771/how-to-call-a-c-function-that-takes-a-c-struct-that-contains-pointers/56549525#56549525", "title": "How to call a c-function that takes a c-struct that contains pointers", "body": "<p>Too much for a comment, so here's the answer.</p>\n\n<p>First, the original text:</p>\n\n<p>A direct solution is to use <code>C.malloc(4 * C.sizeof(C.double))</code>to allocate the array of <code>double</code>-s. Note that you have to make sure to call <code>C.free()</code> on it when done. The same applies to the second array of a single <code>int</code>.</p>\n\n<p>Now, your comment to the Mattanis' remark, which was, reformatted a bit:</p>\n\n<blockquote>\n  <p>thanks for giving some pointers. I tried with</p>\n  \n  <pre class=\"lang-golang prettyprint-override\"><code>a1 := [4]C.double{1,1,1,1}\nsizeA1 := C.malloc(4 * C.sizeof_double)\ncstruct := C.emxArray_real_T{\n  data: &amp;a1[0],\n  size: (*C.int)(sizeA1)\n}\ny := C.sumArray(cstruct)\ndefer C.free(sizeA1)\n</code></pre>\n  \n  <p>but it gave me the same\n  answer as before cgo argument\n  has Go pointer to Go pointer when I\n  tried to run the program</p>\n</blockquote>\n\n<p>You still seem to miss the crucial point. When you're using <code>cgo</code>, there are two <em>disjoint</em> \"memory views\":</p>\n\n<ul>\n<li><p>\"The Go memory\" is everything allocated by the Go runtime powering your running process\u2014on behalf of that process. This memory (most of the time, barring weird tricks) is known to the GC\u2014which is a part of the runtime.</p></li>\n<li><p>\"The C memory\" is memory allocated by the C code\u2014typically by calling the <code>libc</code>'s <code>malloc()</code>/<code>realloc()</code>.</p></li>\n</ul>\n\n<p>Now imagine a not-so-far-fetched scenario:</p>\n\n<ol>\n<li>Your program runs, the C \"side\" gets initialized and\nspawns its own thread (or threads), and holds handles on them.</li>\n<li>Your Go \"side\" already uses multiple threads to run your goroutines.</li>\n<li>You allocate some Go memory in your Go code and pass it\nto the C side.</li>\n<li>The C side passes the address of that memory to one or more of its own threads.</li>\n<li>Your program continues to chug away, <em>and so do the C-side threads</em>\u2014in parallel with your Go code.</li>\n</ol>\n\n<p>As a result you have a reasonably classical scenario in which you get a super-simple situation for unsynchronized parallel memory access, which is a sure recepy for disaster on today's multi-core multi-socket hardware.</p>\n\n<p>Also consider that Go is considerably a more higher-level programming language than C; at the bare minimum, it has automatic garbage collection, and notice that nothing in <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">the Go spec</a> specifies how <em>exactly</em> the GC must be specified.\nThis means, a particular implementation of Go (including the reference one\u2014in the future) is free to allow its GC to <em>move</em> arbitrary objects in the memory\u00b9, and this means updating every pointer pointing into the memory block in its original location to point to the same place in the block's new location\u2014after it was moved.</p>\n\n<p>With these considerations in mind, the Go devs postulated that in order to keep <code>cgo</code>-using programs future-proof\u00b2, it is forbidden to pass to C any memory blocks which contain pointers to other Go memory blocks.</p>\n\n<p>It's okay to pass Go memory blocks which contain pointers to C memory, though.</p>\n\n<p>Going back to the example from your second comment,\nyou still allocate the array of 4 <code>double</code>s, <code>a1</code>, in the Go memory.</p>\n\n<p>Then the statement <code>cstruct := C.emxArray_real_T{...}</code> again allocates an instance of <code>C.emxArray_real_T</code> in the Go memory, and so after you initialize its <code>data</code> field with a pointer to Go memory (<code>&amp;a1[0]</code>), and then pass its address to the C side, the runtime performs its dynamic checks before actually calling into the C side and crashes your program.</p>\n\n<hr>\n\n<p>\u00b9 This is typical behaviour for the so-called \"generational\" garbage collectors, for one example.</p>\n\n<p>\u00b2 That is, you recompile your program with a future version of the Go compiler of the same \"major\" release, and the program continues to work, unmodified.</p>\n"}], "owner": {"reputation": 1, "user_id": 11568153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51efccd290cc0fa165045fc0c2ce1ab3?s=128&d=identicon&r=PG&f=1", "display_name": "Mattanis", "link": "https://stackoverflow.com/users/11568153/mattanis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560874570, "creation_date": 1559142927, "last_edit_date": 1559149418, "question_id": 56363771, "link": "https://stackoverflow.com/questions/56363771/how-to-call-a-c-function-that-takes-a-c-struct-that-contains-pointers", "title": "How to call a c-function that takes a c-struct that contains pointers", "body": "<p>From a GO program on a Raspberry PI I'm trying to call a function(Matlab function converted to C function) and the input to the function is a pointer to a struct and the struct contains pointer to a double(data) and a pointer to an int(size) and two int(allocatedSize, numDimensions). I have tried several ways but nothing has worked, when I have passed the compilation it usually throws a panic: runtime error: cgo argument has Go pointer to Go pointer when I run the program. </p>\n\n<p>sumArray.c</p>\n\n<pre><code>/*sumArray.C*/\n/* Include files */\n#include \"sumArray.h\"\n\n/* Function Definitions */\ndouble sumArray(const emxArray_real_T *A1)\n{\n  double S1;\n  int vlen;\n  int k;\n  vlen = A1-&gt;size[0];\n  if (A1-&gt;size[0] == 0) {\n    S1 = 0.0;\n  } else {\n    S1 = A1-&gt;data[0];\n    for (k = 2; k &lt;= vlen; k++) {\n      S1 += A1-&gt;data[k - 1];\n    }\n  }\n\n  return S1;\n}\n</code></pre>\n\n<p>sumArray.h</p>\n\n<pre><code>#ifndef SUMARRAY_H\n#define SUMARRAY_H\n\n/* Include files */\n#include &lt;stddef.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"sumArray_types.h\"\n\n/* Function Declarations */\nextern double sumArray(const emxArray_real_T *A1);\n\n#endif\n</code></pre>\n\n<p>sumArray_types.h</p>\n\n<pre><code>#ifndef SUMARRAY_TYPES_H\n#define SUMARRAY_TYPES_H\n\n/* Include files */\n\n/* Type Definitions */\n#ifndef struct_emxArray_real_T\n#define struct_emxArray_real_T\n\nstruct emxArray_real_T\n{\n  double *data;\n  int *size;\n  int allocatedSize;\n  int numDimensions;\n};\n\n#endif                                 /*struct_emxArray_real_T*/\n\n#ifndef typedef_emxArray_real_T\n#define typedef_emxArray_real_T\n\ntypedef struct emxArray_real_T emxArray_real_T;\n\n#endif                                 /*typedef_emxArray_real_T*/\n#endif\n\n/* End of code generation (sumArray_types.h) */\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>// #cgo CFLAGS: -g -Wall\n// #include &lt;stdlib.h&gt;\n// #include \"sumArray.h\"\nimport \"C\"\n\nimport (\n   \"fmt\"\n)\nfunc main() {\n   a1 := [4]C.Double{1,1,1,1}\n   a2 := [1]C.int{4}\n   cstruct := C.emxArray_real_T{data: &amp;a1[0], size: &amp;a2[0]}\n   cstructArr := [1]C.emxArray_real_T{cstruct}\n   y := C.sumArray(&amp;cstructArr[0])\n   fmt.Print(float64(y))\n}\n</code></pre>\n\n<p>With this example I get panic: runtime error: cgo argument has Go pointer to Go pointer when I run the program. </p>\n\n<p>I do not how to make it work or if it is possible to make it work. I hope someone can help me or give some direction on how to solve this.</p>\n"}, {"tags": ["go", "tcp", "global-variables"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "edited": false, "score": 0, "creation_date": 1559151794, "post_id": 56363154, "comment_id": 99335073, "body": "This was very helpful, thanks so much.  I went ahead and implemented your changes, and switched my slice to a map (to allow for more efficient removal of clients), and things work wonderfully.  One quick questions about mutexes since this is my first time using them. I added <code>mu sync.RWMutex</code> to my <code>ClientList</code> struct. Am I correct in using <code>cList.mu.Lock()</code> and <code>defer cList.mu.Unlock()</code> when modifying <code>*Client,</code> and using <code>cList.mu.RLock()</code> and <code>defer cList.mu.RUnlock()</code> when reading?  When I run my code with the <code>-race</code> flag I don&#39;t get any warnings, but I just want to make sure."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "edited": false, "score": 0, "creation_date": 1559153654, "post_id": 56363154, "comment_id": 99335837, "body": "1) Yes. But keep in mind that <code>RWMutex</code> is way more complicated than the simple mutex and you pay for that on any call to <code>Lock</code>, IOW, its <code>Lock</code> burns more CPU cycles than that of the simple <code>Mutex</code>. In a toy example it is ok but in production setting you&#39;d have to ponder whether you really going to have many concurrent readers. 2) <code>-race</code> does not give warnings: if it detects a race, it crashes the process highlighting what memory location has been raced for access to."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "edited": false, "score": 0, "creation_date": 1559153835, "post_id": 56363154, "comment_id": 99335921, "body": "\u2026and while we&#39;re on it, may I recommend you to get and read <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">The Book</a>\u2014especially its 8th and 9th chapters? It will gently introduce you to concurrency in Go. Concurrency in Go is easier than in most other environments, but it itself is fundamentally hard in that it requires certain way of thinking and discipline to wield properly. You have to educate yourself lest you&#39;ll fail in a bit more complicated case. Your next book on the topic could be <a href=\"https://www.oreilly.com/library/view/concurrency-in-go/9781491941294/\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "edited": false, "score": 0, "creation_date": 1559154043, "post_id": 56363154, "comment_id": 99335997, "body": "\u2026well, and be sure to at least complete <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">the tour</a>\u2014it contains the set of exercises on the topic of concurrency, mutexes included. Also be sure to read <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">the docs</a> on both <code>Mutex</code> and <code>RWMutex</code>."}, {"owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "edited": false, "score": 0, "creation_date": 1559154650, "post_id": 56363154, "comment_id": 99336234, "body": "I read the little go book when I first started playing around with go, but I&#39;ll admit I skimmed the concurrency sections because it seemed a bit daunting at first, but my curiosity and willingness to learn now outweighs the fear :) I&#39;ll definitely check out the books you&#39;ve linked and take a deep dive into things. Thanks again for the knowledge."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1559144879, "last_edit_date": 1559144879, "creation_date": 1559140804, "answer_id": 56363154, "question_id": 56362784, "link": "https://stackoverflow.com/questions/56362784/how-to-access-a-variable-across-all-connected-tcp-clients-in-go/56363154#56363154", "title": "How to access a variable across all connected tcp clients in go?", "body": "<p>Several problems with this approach.</p>\n\n<p>First, your code contains a data race: each TCP connection is served by a separate goroutine, and they all attempt to modify the slice concurrently.</p>\n\n<p>You might try building your code with <code>go build -race</code> (or <code>go install -race</code> \u2014 whatever you're using), and see it crash by the enabled runtime checks.</p>\n\n<p>This one is easy to fix. The most straightforward approach is to add a mutex variable into the <code>ClientList</code> type:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ClientList struct {\n  mu      sync.Mutex\n  clients []*Client\n}\n</code></pre>\n\n<p>\u2026and make the type's methods hold the mutex while they're mutating the <code>clients</code> field, like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (cList *ClientList) AddClient(cl *Client) {\n  cList.mu.Lock()\n  defer cList.mu.Unlock()\n\n  cList.clients = append(cList.clients, o)\n}\n</code></pre>\n\n<p>(If you will ever encounter the typical usage pattern of your <code>ClientList</code> type is to frequently call methods which only <em>read</em> the contained list, you may start using the <code>sync.RWLock</code> type instead, which allows multiple concurrent readers.)</p>\n\n<p>Second, I'd split the part which \"identifies\" a client out of the handler function.\nAs of now, in the handler, if the identification fails, the handler exits but the client is not delisted.</p>\n\n<p>I'd say it would be better to identify it up front and only run the handler once the client is beleived to be okay.</p>\n\n<p>Also it supposedly worth adding a deferred call to something like <code>RemoveClient</code> at the top of the handler's body so that the client is properly delisted when the handler is done with it.</p>\n\n<p>IOW, I'd expect to see something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (cl *Client) HandleClient(cList *ClientList) {\n    defer cl.Conn.Close()\n\n    err := cl.Identify()\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    cList.AddClient(cl)\n    defer cList.RemoveClient(cl)\n\n    // ... the rest of the code\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 56363154, "answer_count": 1, "score": 0, "last_activity_date": 1559146087, "creation_date": 1559139659, "last_edit_date": 1559146087, "question_id": 56362784, "link": "https://stackoverflow.com/questions/56362784/how-to-access-a-variable-across-all-connected-tcp-clients-in-go", "title": "How to access a variable across all connected tcp clients in go?", "body": "<p>I'm setting up a tcp server in a pet project I'm writing in go. I want to be able to maintain a slice of all connected clients, and then modify it whenever a new client connects or disconnects from my server.</p>\n\n<p>My main mental obstacle right now is whether I should be declaring a package level slice, or just passing a slice into my handler.</p>\n\n<p>My first thought was to declare my <code>ClientList</code> slice (I'm aware that a slice might not be my best option here, but I've decided to leave it as is for now) as a package level variable. While I think this would work, I've seen a number of posts discouraging the use of them.</p>\n\n<p>My other thought was to declare <code>ClientList</code> as a slice in my main function, and then I pass <code>ClientList</code> to my <code>HandleClient</code> function, so whenever a client connects/disconnects I can call <code>AddClient</code> or <code>RemoveClient</code> and pass this slice in and add/remove the appropriate client. </p>\n\n<p>This implementation is seen below. There are definitely other issues with the code, but I'm stuck trying to wrap my head around something that seems like it should be very simple.</p>\n\n<pre><code>type Client struct {\n    Name string  \n    Conn net.Conn\n}\n\ntype ClientList []*Client\n\n// Identify is used to set the name of the client\nfunc (cl *Client) Identify() error {\n// code here to set the client's name in the based on input from client\n}\n\n// This is not a threadsafe way to do this - need to use mutex/channels\nfunc (cList *ClientList) AddClient(cl *Client) {\n    *cList = append(*cList, cl)\n}\n</code></pre>\n\n<pre><code>func (cl *Client) HandleClient(cList *ClientList) {\n    defer cl.Conn.Close()\n    cList.AddClient(cl)\n    err := cl.Identify()\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    for {\n        err := cl.Conn.SetDeadline(time.Now().Add(20 * time.Second))\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        cl.Conn.Write([]byte(\"What command would you like to perform?\\n\"))\n        netData, err := bufio.NewReader(cl.Conn).ReadString('\\n')\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        cmd := strings.TrimSpace(string(netData))\n        if cmd == \"Ping\" {\n            cl.Ping() //sends a pong msg back to client\n        } else {\n            cl.Conn.Write([]byte(\"Unsupported command at this time\\n\"))\n        }\n\n    }\n}\n</code></pre>\n\n<pre><code>func main() {\n    arguments := os.Args\n\n    PORT := \":\" + arguments[1]\n    l, err := net.Listen(\"tcp4\", PORT)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer l.Close()\n    fmt.Println(\"Listening...\")\n\n    // Create a new slice to store pointers to clients\n    var cList ClientList\n\n    for {\n        c, err := l.Accept()\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        // Create client cl1\n        cl1 := Client{Conn: c}\n\n        // Go and handle the client\n        go cl1.HandleClient(&amp;cList)\n    }\n}\n</code></pre>\n\n<p>From my initial testing, this appears to work. I am able to print out my client list and I can see that new clients are being added, and their name is being added after <code>Identify()</code> is called as well. </p>\n\n<p>When I run it with the -race flag, I do get data race warnings, so I know I will need a threadsafe way to handle adding clients. The same goes for removing clients when I add that in.</p>\n\n<p>Are there any other issues I might be missing by passing my ClientList  into <code>HandleClient</code>, or any benefits I would gain from declaring ClientList as a package level variable instead?</p>\n"}, {"tags": ["go", "networking", "websocket", "http-compression", "permessagedeflate"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1559141006, "post_id": 56362661, "comment_id": 99329650, "body": "Encode some sample messages as JSON and MessagePack, compress and compare."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559142709, "post_id": 56362661, "comment_id": 99330547, "body": "This depends entirely on the nature and size of your messages and is impossible for us to predict. As Cerise said, measure it."}], "owner": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559139289, "creation_date": 1559139289, "question_id": 56362661, "link": "https://stackoverflow.com/questions/56362661/do-i-need-use-messagepack-serialization-over-json-if-my-client-and-server-alread", "title": "Do I need use messagePack serialization over JSON if my client and server already supported per message deflate compression?", "body": "<p>My client and server are communicating through WebSocket with the JSON serialized data and both are supporting per message deflate and I suppose the JSON data is already compressed.\nThe server is written on go and using gorrilla's WebSocket package.\nMy goal is to decrease more traffic so wondering if I change the JSON serialization to MessagePack and continue to use per-message deflate header would it help to decrease the traffic ? </p>\n"}, {"tags": ["go", "google-cloud-pubsub"], "answers": [{"comments": [{"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1559231175, "post_id": 56379928, "comment_id": 99363279, "body": "Thank you, now I will try to &quot;peek&quot; into the messages with <code>gcloud</code>. Also note that at this stage, with stucked messages, when I send any new messages (I am sure that they are correct) - they will not Received, but only the graph <code>num_undelivered_messages</code> will increase."}, {"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1559231957, "post_id": 56379928, "comment_id": 99363722, "body": "<code>\u2502 {&quot;Voice&quot;:&quot;David&quot;,&quot;TextChunks&quot;:[&quot;my text here&quot;],&quot;Sub&quot;:&quot;f4cfd4a8-0e94-4287-8c5e-1b01538dd2a1&quot;,&quot;HashArt&zwnj;&#8203;icle&quot;:&quot;b1bc248a7ff2b&zwnj;&#8203;2e95569f56de68615dfD&zwnj;&#8203;avid&quot;,&quot;Title&quot;:&quot;Nazis&zwnj;&#8203;m - Wikipedia&quot;,&quot;URLArticle&quot;:&quot;https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Nazis&zwnj;&#8203;m&quot;,&quot;FavIconURL&quot;:&quot;htt&zwnj;&#8203;ps:&#47;&#47;en.wikipedia.or&zwnj;&#8203;g&#47;static&#47;favicon&#47;wik&zwnj;&#8203;ipedia.ico&quot;,&quot;Utc&quot;:15&zwnj;&#8203;59210260} \u2502 432924914515591 \u2502            \u2502 WBFOBCEhPjA-RVNEUAYWLF1GSFE3GQhoUQ5PXiM_NSAoRRILUxNRXHYTTBBu&zwnj;&#8203;M1x1B1ENGHQvYX1oCRQJ&zwnj;&#8203;VBRZflVbCTxofmNxBFME&zwnj;&#8203;G3Z0YHFvWxYEC0R7xtnz&zwnj;&#8203;h_WWFkZJP8XElqVIQbbF&zwnj;&#8203;m74zZhg9XBJLLD5-LS9F&zwnj;&#8203;QV5AEkwmGkRJUytDCyo |</code>"}, {"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1559232010, "post_id": 56379928, "comment_id": 99363752, "body": "This is one of the outputs from <code>gcloud pubsub subscriptions pull &quot;my-subscription-id&quot;</code>, looks ok for me."}, {"owner": {"reputation": 124, "user_id": 8098238, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yFY8WfL8W5g/AAAAAAAAAAI/AAAAAAAAH2A/JRfAPFknUps/photo.jpg?sz=128", "display_name": "Alex Mordkovich", "link": "https://stackoverflow.com/users/8098238/alex-mordkovich"}, "reply_to_user": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1559316367, "post_id": 56379928, "comment_id": 99394208, "body": "I suggest trying to run your subscriber logic against the body of this message, to see if it handles the message correctly (i.e., doesn&#39;t crash or fail to acknowledge the message). You can also just acknowledge this message via <code>gcloud</code> (though note that that means that your actual subscriber would not process this message)."}], "tags": [], "owner": {"reputation": 124, "user_id": 8098238, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yFY8WfL8W5g/AAAAAAAAAAI/AAAAAAAAH2A/JRfAPFknUps/photo.jpg?sz=128", "display_name": "Alex Mordkovich", "link": "https://stackoverflow.com/users/8098238/alex-mordkovich"}, "is_accepted": false, "score": 0, "last_activity_date": 1559225416, "creation_date": 1559225416, "answer_id": 56379928, "question_id": 56359029, "link": "https://stackoverflow.com/questions/56359029/why-i-have-undelivered-messages-if-my-receiver-works/56379928#56379928", "title": "Why I have &#39;Undelivered Messages&#39; if my receiver works?", "body": "<p>I'm assuming that the metric that is concerning is <code>pubsub.googleapis.com/subscription/num_undelivered_messages</code> which measures the \"Number of unacknowledged messages (a.k.a. backlog messages) in a subscription.\" From the \"Acknowledge Requests\" graph, we see that your subscribers stopped acknowledging message at around 9pm on the 28th. That's the same time when the \"Oldest Unacknowledged Message\" age started growing (linearly). Meanwhile, the \"Backlog Size\" graph is pretty flat. This means that there is a small number of \"problematic\" messages in the subscription's backlog that the subscribers are not acknowledging. Most likely, the subscribers are having trouble processing this small set of messages for some reason. Perhaps these messages are malformed in some way, or do not conform some expectation of the subscriber code.</p>\n\n<p>One thing you can do to try to debug this is to use the <code>gcloud</code> command-line tool to \"peek\" into the messages in the subscription's backlog: <a href=\"https://cloud.google.com/sdk/gcloud/reference/pubsub/subscriptions/pull\" rel=\"nofollow noreferrer\">https://cloud.google.com/sdk/gcloud/reference/pubsub/subscriptions/pull</a>. Note that <code>gcloud</code> tool <em>will not</em> acknowledge any messages if you do not set the <code>--auto-ack</code> flag.</p>\n"}], "owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 338, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559230790, "creation_date": 1559127696, "last_edit_date": 1559230790, "question_id": 56359029, "link": "https://stackoverflow.com/questions/56359029/why-i-have-undelivered-messages-if-my-receiver-works", "title": "Why I have &#39;Undelivered Messages&#39; if my receiver works?", "body": "<p><a href=\"https://i.stack.imgur.com/vfEqc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vfEqc.png\" alt=\"stackdriver undelivered messages\"></a></p>\n\n<p>I restarted my Windows VM but this did not help. On the next day I restarted my <code>main.go</code> and right after that I saw that old stuck messages began to come.</p>\n\n<p>My <code>Subscription Type</code> is Pull, my <code>Acknowledgement Deadline</code> is maximum: 600 seconds.</p>\n\n<p>Background: I want to use Pubsub as a load balancer in my managed group of Windows instances (I need Windows API for that task). Message processing is CPU intensive (with a few HTTP calls) and can take from a few seconds to a few minutes.</p>\n\n<p>Some other metrics from Stackdriver:\n<a href=\"https://i.stack.imgur.com/e6TFI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/e6TFI.png\" alt=\"stackdriver pubsub\"></a>\n<a href=\"https://i.stack.imgur.com/5LgSp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5LgSp.png\" alt=\"stackdriver oldest unacknowledged message\"></a>\n<a href=\"https://i.stack.imgur.com/QSkWU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QSkWU.png\" alt=\"stackdriver backlog size\"></a></p>\n\n<p>I have no idea what I can check. Day ago I did a highload testing and looks like everything was fine (<code>Undelivered Messages</code> was zero as we see on the first screenshot above). Now my CPU consumption is zero, managed group decreased to one instance (this is not in a production environment). I try to use Pubsub for the first time. Code of my <code>main()</code> that synthesize audio from text chunks, encode to two formats and upload to S3: </p>\n\n<pre><code>func main() {\n    fmt.Printf(\"Current time: %v\\n\",\n        time.Now().Format(timeFormat),\n    )\n\n    // https://godoc.org/cloud.google.com/go/pubsub#Subscription.Receive\n    err := subscription.Receive(ctx, func(ctx context.Context, m *pubsub.Message) {\n        timeStart := time.Now()\n        if timeStartFirstMessage == nil {\n            timeStartFirstMessage = &amp;timeStart\n        }\n\n        var data pubsubMessage\n        json.Unmarshal(m.Data, &amp;data)\n        fmt.Printf(\"Got message: %#v\\n\", data)\n\n        var wg sync.WaitGroup\n        wg.Add(len(data.TextChunks))\n\n        wavs := make([][]byte, len(data.TextChunks))\n        for i, chunk := range data.TextChunks {\n            /** TODO without 'go' (sequential) will process in correct order:\n             * user can listen first and seconds chunks faster,\n             * but m4a will be later,\n             * but on \"high load\" of the VM with ~2x more messages in parallel\n             * (each message on it is own goroutine)\n             * performance may be even better (I think) because\n             * hundreds of CPU intensive goroutine is worse.\n             *\n             * Also in sequential code I can append() to wav[]\n             * instead of doind it later in another func,\n             * maybe this will also improve perfomance (profile).\n            **/\n            go func(i int, chunk string) {\n                fmt.Printf(\"Index of text chunk: %d\\n\", i)\n                wav := tts(data.Voice, chunk)\n                streamOfOggEncoder := encodeOggVorbis(wav)\n                uploadToS3(\n                    \"intelligentspeaker\",\n                    data.Sub+\"/\"+data.HashArticle+\"/\"+fmt.Sprint(i),\n                    \"audio/ogg\",\n                    streamOfOggEncoder,\n                )\n                wavs[i] = wav\n\n                wg.Done()\n            }(i, chunk)\n        }\n        wg.Wait()\n        wavConcated := concat(wavs)\n\n        filename := buildPodcastEpisodeFilename(data.Title)\n        err := encodePodcastEpisode(wavConcated, filename)\n        if err != nil {\n            m.Nack()\n            return\n        }\n\n        if err != nil {\n            logger.Log(logging.Entry{Payload: fmt.Sprintf(\"ERROR on m4a deleting: %v\", err)})\n        }\n\n        key := data.Sub + \"/\" + data.HashArticle + \"/\" + random() + \"/\" + filename\n        readCloser, size := getReadCloserAndSize(filename)\n        if readCloser == nil {\n            m.Nack()\n            return\n        }\n        uploadToS3(\"intelligentspeaker--podcasts\", key, \"audio/x-m4a\", readCloser)\n        // Next message may be with the same title (filename)\n        err = os.Remove(filename)\n\n        fmt.Printf(\"Duration: %v\\n\", duration(wavConcated))\n        updatePodcastXML(\n            key,\n            data.Title,\n            data.URLArticle,\n            data.FavIconURL,\n            duration(wavConcated),\n            data.Utc,\n            size,\n        )\n\n        fmt.Printf(\"DONE pubsub message, current time: %v\\n\", time.Now().Format(timeFormat))\n        fmt.Printf(\"Time of message processing: %v\\n\", time.Since(timeStart).Round(time.Second))\n        fmt.Printf(\n            \"Time of all messages processing (counted from the first message, not from the start of this app): %v\\n\",\n            time.Since(*timeStartFirstMessage).Round(time.Second),\n        )\n\n        m.Ack()\n\n    })\n    if err != nil {\n        logger.Log(logging.Entry{Payload: fmt.Sprintf(\"ERROR on registering receiver: %v\", err)})\n    }\n\n}\n\n</code></pre>\n\n<p>Update: found <a href=\"https://stackoverflow.com/questions/55508344/google-pubsub-golang-subscriber-stops-receiving-new-published-messages-after-b\">similar question</a>.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 9945782, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fEyuE7AzABQ/AAAAAAAAAAI/AAAAAAAAAAA/mR5ChpCi7wI/photo.jpg?sz=128", "display_name": "Nick P", "link": "https://stackoverflow.com/users/9945782/nick-p"}, "edited": false, "score": 0, "creation_date": 1559128223, "post_id": 56358709, "comment_id": 99321888, "body": "This solution works when I change the operator to &lt;=, however, if there&#39;s a variant not in the languages struct it places it in the middle of the slice, is there a way to place this at the end?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 37, "user_id": 9945782, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fEyuE7AzABQ/AAAAAAAAAAI/AAAAAAAAAAA/mR5ChpCi7wI/photo.jpg?sz=128", "display_name": "Nick P", "link": "https://stackoverflow.com/users/9945782/nick-p"}, "edited": false, "score": 0, "creation_date": 1559129030, "post_id": 56358709, "comment_id": 99322345, "body": "I&#39;ve added another example which handles the unsorted case."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1559129203, "last_edit_date": 1559129203, "creation_date": 1559126683, "answer_id": 56358709, "question_id": 56358567, "link": "https://stackoverflow.com/questions/56358567/sorting-a-slice-based-on-the-order-of-the-elements-in-another-slice/56358709#56358709", "title": "Sorting a slice based on the order of the elements in another slice", "body": "<p>I think to do this, you need to build a ranking of your languages:</p>\n\n<pre><code>var langMap map[string]int\nfor i, lang := range languages {\n    langMap[lang.Code] = i\n}\n</code></pre>\n\n<p>With this, it becomes trivial to just look up the ranking of each item in <code>variants</code>, and return the appropriate value:</p>\n\n<pre><code>sort.Slice(variants, func(i, j int) bool {\n    iRank, jRank := langMap[variants[i].Code], langMap[variants[j].Code]\n    return iRank &lt; jRank\n})\n</code></pre>\n\n<p>If there's a chance you may have inputs that are not in the pre-sorted list, you can sort them last:</p>\n\n<pre><code>sort.Slice(variants, func(i, j int) bool {\n    iRank, iExists := langMap[variants[i].Code]\n    jRank, jExists := langMap[variants[j].Code]\n    switch (\n    case iExists &amp;&amp; jExists:\n        // Both exist in the pre-ordered list, so sort by rank\n        return iRank &lt; jRank\n    case !iExists &amp;&amp; !jExists:\n        // Neither exists in the pre-ordered list, sort alphabetically\n        return variants[i].Code &lt; variants[j].Code\n    case iExists:\n        // Only i exists, so sort it before j\n        return true\n    default: // jExists\n        // Only j exists, so sort it after i\n        return false\n    )\n\n})\n</code></pre>\n\n<p>It is logically possible to do the same by looping through your reference list each time, as you're attempting, but it's much harder to reason about, and far less efficient.</p>\n"}], "owner": {"reputation": 37, "user_id": 9945782, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fEyuE7AzABQ/AAAAAAAAAAI/AAAAAAAAAAA/mR5ChpCi7wI/photo.jpg?sz=128", "display_name": "Nick P", "link": "https://stackoverflow.com/users/9945782/nick-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 56358709, "answer_count": 1, "score": 1, "last_activity_date": 1559129203, "creation_date": 1559126175, "question_id": 56358567, "link": "https://stackoverflow.com/questions/56358567/sorting-a-slice-based-on-the-order-of-the-elements-in-another-slice", "title": "Sorting a slice based on the order of the elements in another slice", "body": "<p>I am attempting to order a slice based on the order of the elements within another slice. My sort function works when I only have one of each type within my slice I want to order however when I start adding more elements the ordering breaks. </p>\n\n<p>I have created an example within the Golang playground.</p>\n\n<p><a href=\"https://play.golang.org/p/e9sHIeV2qSf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/e9sHIeV2qSf</a></p>\n\n<p>I want to order my Variant slice by the Code field and have it the same as order as the codes appear in the Language struct.</p>\n\n<p>Below is the sort function I am using:</p>\n\n<pre><code>sort.Slice(variants, func(i, j int) bool {\n    for k, language := range languages {\n        if language.Code == variants[i].Code {\n            return i &gt;= k\n        }\n    }\n\n    return false\n})\n</code></pre>\n\n<p>The current order it's returning is:</p>\n\n<blockquote>\n  <p>Sorted slice: [{Code:en-GB} {Code:en-US} {Code:en-GB} {Code:es-ES}\n  {Code:en-GB} {Code:en-GB} {Code:en-GB} {Code:en-GB} {Code:es-ES}]</p>\n</blockquote>\n\n<p>When the order within my Language struct is:</p>\n\n<blockquote>\n  <p>\"en-GB\", \"en-US\", \"fr-FR\", \"es-ES\"</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559135534, "post_id": 56358363, "comment_id": 99326215, "body": "1. should more accurately be don&#39;t use them to put <i>values</i> in queries. There&#39;s nothing wrong with assembling a dynamic query using these tools, so long as it&#39;s still a parameterized/prepared query."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1559137413, "last_edit_date": 1559137413, "creation_date": 1559125514, "answer_id": 56358363, "question_id": 56357918, "link": "https://stackoverflow.com/questions/56357918/cannot-use-buffer-type-bytes-buffer-as-type-string-in-argument-to-db-query/56358363#56358363", "title": "cannot use buffer (type bytes.Buffer) as type string in argument to db.Query", "body": "<p>The direct answer to your question is <a href=\"https://golang.org/pkg/bytes/#Buffer.String\" rel=\"nofollow noreferrer\">provided by the docs</a>, and is simply to use the <code>String()</code> method:</p>\n\n<pre><code>rows, err := db.Query(buffer.String())\n</code></pre>\n\n<p>Having said that, a buffer probably doesn't make sense here. For building strings, the <code>strings.Builder</code> type is more efficient.</p>\n\n<p>But for your particular use case, building SQL queries this way is dangerous and error-prone. Several suggestions:</p>\n\n<ol>\n<li><em>NEVER, EVER EVER</em> use string concatenation or Sprintf/Fprintf to insert values into SQL queries. You'll open yourself up to SQL injection attacks. Instead, always use parameterized queries.</li>\n<li>Large if/else blocks are error-prone and hard to read. Use a proper switch statement instead.</li>\n<li>You can use an SQL query builder, but in your case, you have only one optional portion of the query. Just use standard string concatenation for that.</li>\n</ol>\n\n<p>I've rewritten your code considering the above concerns, and now it looks like this:</p>\n\n<pre><code>var paidCondition string\nargs := []interface{}{masterID}\nswitch (\ncase e.Type == \"today\":\n    paidCondition = `AND ts.paid_on = CURDATE()`\ncase e.Type == \"weekly\":\n    paidCondition = `AND ts.paid_on &gt; DATE_SUB(NOW(), INTERVAL 1 WEEK)`\ncase e.Type == \"monthly\":\n    paidCondition = `AND ts.paid_on &gt; DATE_SUB(NOW(), INTERVAL 1 MONTH)`\ncase e.StartDate != \"\" &amp;&amp; e.EndDate != \"\" &amp;&amp; e.StartDate == e.EndDate:\n    paidCondition = `AND ts.paid_on = ?`\n    args = append(args, e.StartDate)\ncase e.StartDate != \"\" &amp;&amp; e.EndDate != \"\":\n    paidCondition = `AND ts.paid_on &gt;= ? AND ts.paid_on &lt;= ?`\n    args = append(args, e.StartDate, e.EndDate)\n)\n\nquery := `SELECT c.id, c.company_name, ss.start_date, ss.shift_length, ss.bill_rate, ss.ot_hrs, ss.dt_hrs, ts.pay_rate, ts.wc_rate, ts.paid, td.wc\n    FROM company c\n    JOIN users u1 ON c.id = u1.company_id\n    JOIN schedule s ON u1.id = s.user_id\n    JOIN schedule_shifts ss ON s.id = ss.schedule_id\n    JOIN technician_shifts ts ON ss.id = ts.shift_id\n    JOIN users u ON u.id = ts.technician_id\n    JOIN technician_details td ON td.user_id = u.id\n    JOIN master_technicians mt ON mt.id = u.master_technician_id\n    WHERE mt.id = ? AND ts.confirmed = 'yes' AND ts.paid = 'yes' ` + paidCondition\n\nrows, err := db.Query(query, args...)\nif err != nil {\n    log.Panic(err.Error())\n}\n</code></pre>\n\n<p>And finally, a couple other improvements, which are not directly related to your question or my suggested code above:</p>\n\n<ol>\n<li><code>buffer.WriteString(fmt.Sprintf(</code>...<code>))</code> is overly verbose. The shorter version is: <code>fmt.Fprintf(buffer,</code>...<code>)</code>.</li>\n<li>You're using <code>fmt.Sprintf()</code> in several places where no formatting is taking place. Just remove this entirely. For example, replace <code>fmt.Sprintf(\"AND ts.paid_on = CURDATE()\")</code> with simply <code>\"AND ts.paid_on = CURDATE()\"</code>.</li>\n</ol>\n"}], "owner": {"reputation": 291, "user_id": 10716743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17c2cba1f960b985070a7c75c6f2c4c?s=128&d=identicon&r=PG&f=1", "display_name": "Aadil Shaikh", "link": "https://stackoverflow.com/users/10716743/aadil-shaikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 56358363, "answer_count": 1, "score": -1, "last_activity_date": 1559137413, "creation_date": 1559124027, "question_id": 56357918, "link": "https://stackoverflow.com/questions/56357918/cannot-use-buffer-type-bytes-buffer-as-type-string-in-argument-to-db-query", "title": "cannot use buffer (type bytes.Buffer) as type string in argument to db.Query", "body": "<p>I have written a SQL query in buffer.WriteString() but not able to use that buffer in db.Query().</p>\n\n<pre><code>buffer.WriteString(fmt.Sprintf(`SELECT c.id, c.company_name, ss.start_date, ss.shift_length, ss.bill_rate, ss.ot_hrs, ss.dt_hrs, ts.pay_rate, ts.wc_rate, ts.paid, td.wc\n        FROM company c\n        JOIN users u1 ON c.id = u1.company_id\n        JOIN schedule s ON u1.id = s.user_id\n        JOIN schedule_shifts ss ON s.id = ss.schedule_id\n        JOIN technician_shifts ts ON ss.id = ts.shift_id\n        JOIN users u ON u.id = ts.technician_id\n        JOIN technician_details td ON td.user_id = u.id\n        JOIN master_technicians mt ON mt.id = u.master_technician_id\n        WHERE mt.id = %d AND ts.confirmed = 'yes' AND ts.paid = 'yes'`, masterID))\n\n    if e.Type == \"today\" {\n        buffer.WriteString(fmt.Sprintf(`AND ts.paid_on = CURDATE()`))\n    } else if e.Type == \"weekly\" {\n        buffer.WriteString(fmt.Sprintf(`AND ts.paid_on &gt; DATE_SUB(NOW(), INTERVAL 1 WEEK)`))\n    } else if e.Type == \"monthly\" {\n        buffer.WriteString(fmt.Sprintf(`AND ts.paid_on &gt; DATE_SUB(NOW(), INTERVAL 1 MONTH)`))\n    } else {\n        if e.StartDate != \"\" &amp;&amp; e.EndDate != \"\" {\n            if e.StartDate == e.EndDate {\n                buffer.WriteString(fmt.Sprintf(`AND ts.paid_on = %s`, e.StartDate))\n            } else {\n                buffer.WriteString(fmt.Sprintf(`AND ts.paid_on &gt;= %s AND ts.paid_on &lt;= %s`, e.StartDate, e.EndDate))\n            }\n        }\n    }\n\nrows, err := db.Query(buffer)\n    if err != nil {\n        log.Panic(err.Error())\n    }\n</code></pre>\n\n<p>It gives me the error that</p>\n\n<blockquote>\n  <p>cannot use buffer (type bytes.Buffer) as type string in argument to\n  db.Query</p>\n</blockquote>\n\n<p>How can i do that?</p>\n"}, {"tags": ["go", "system-calls"], "answers": [{"comments": [{"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1559194898, "post_id": 56367944, "comment_id": 99346410, "body": "Sorry I&#39;m a little confused; what does Entersyscall get turned into?"}, {"owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "reply_to_user": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1559203819, "post_id": 56367944, "comment_id": 99350008, "body": "<code>syscall.Entersyscall()</code> is just a definition of a function in the go file (without implementation). Implementation is done in a separate file in another language (C, ASM etc.). During compilation process both files compile into binary data and then link together into one executable file."}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1559264579, "post_id": 56367944, "comment_id": 99374630, "body": "Is there some documentation of which names in Go correspond with which names in the implementation?"}], "tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 1, "last_activity_date": 1559161226, "creation_date": 1559161226, "answer_id": 56367944, "question_id": 56356889, "link": "https://stackoverflow.com/questions/56356889/where-is-the-implementation-of-syscall-entersyscall/56367944#56367944", "title": "Where is the implementation of syscall.Entersyscall?", "body": "<p>You cannot find it in the stdlib because it contains just a wrapper function <code>syscall.Entersyscall()</code>. The proper implementation is in the same package but written in asm <a href=\"https://golang.org/src/syscall/asm_linux_arm.s\" rel=\"nofollow noreferrer\">golang.org/src/syscall/asm_linux_arm.s</a></p>\n"}], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1559161226, "creation_date": 1559120790, "last_edit_date": 1559121123, "question_id": 56356889, "link": "https://stackoverflow.com/questions/56356889/where-is-the-implementation-of-syscall-entersyscall", "title": "Where is the implementation of syscall.Entersyscall?", "body": "<p>I am trying to trace down how syscalls work in Go, but I got stuck <a href=\"https://github.com/golang/go/blob/master/src/cmd/vendor/golang.org/x/sys/unix/gccgo.go#L29\" rel=\"nofollow noreferrer\">here</a>. </p>\n\n<p>The code is invoking <code>syscall.Entersyscall</code>, but I cannot find the definition for the <code>Entersyscall</code> function in the <code>syscall</code> package anywhere in the source tree.</p>\n\n<p>Is there some magic that renames this to something else?</p>\n\n<p>More generally, how does one go about finding definitions for function names (in the Go source tree) that have no apparent definition in their advertised package?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "edited": false, "score": 0, "creation_date": 1559218808, "post_id": 56355806, "comment_id": 99356661, "body": "Anyone know why this was voted down I edited to use correct package?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1559118806, "last_edit_date": 1559118806, "creation_date": 1559117595, "answer_id": 56355921, "question_id": 56355806, "link": "https://stackoverflow.com/questions/56355806/how-can-i-convert-interface-to-sql-nullstring-using-reflection-or-otherwise/56355921#56355921", "title": "How can I Convert interface{} to sql.NullString, using reflection or otherwise", "body": "<p><code>new()</code> creates a nil pointer to the type requested. So it's expected that you're creating a <code>*sql.NullString</code> rather than a <code>sql.NullString</code>.  Your options are:</p>\n\n<ol>\n<li><p>Convert it correctly for the type:</p>\n\n<pre><code>s = temp.(*sql.NullString)\n</code></pre></li>\n<li><p>Don't create a pointer:</p>\n\n<pre><code>str := sql.NullString{}\n\nstr.String = \"hello\"\nstr.Valid = true\n</code></pre>\n\n<p>which can be shortened to:</p>\n\n<pre><code>str := sql.NullString{\n    String: \"hello\",\n    Valid:  true,\n}\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 56355921, "answer_count": 1, "score": -1, "last_activity_date": 1559226595, "creation_date": 1559117187, "last_edit_date": 1559226595, "question_id": 56355806, "link": "https://stackoverflow.com/questions/56355806/how-can-i-convert-interface-to-sql-nullstring-using-reflection-or-otherwise", "title": "How can I Convert interface{} to sql.NullString, using reflection or otherwise", "body": "<p>I have created a map[string]interface{}, and populated it as such.</p>\n\n<pre><code>sli := make(map[string]interface{})\n\n    str := new(sql.NullString)\n\n    str.String = \"hello\"\n    str.Valid = true\n\n    i64 := new(sql.NullInt64)\n\n    i64.Int64 = 55\n    i64.Valid = true\n\n    sli[\"first\"] = str\n    sli[\"second\"] = i64\n</code></pre>\n\n<p>This all populates fine but when I try and accessthe string from the sql.NullString element in the map I get a panic.</p>\n\n<blockquote>\n  <p>interface conversion: interface {} is *sql.NullString, not\n  sql.NullString</p>\n</blockquote>\n\n<p>Here is the code I am using to access the string...</p>\n\n<pre><code>temp := sli[\"first\"]\n    temptype := reflect.TypeOf(temp).String()\n    if temptype == \"*sql.NullString\" {\n        s := sql.NullString{}\n        s = temp.(sql.NullString)\n        s2 := s.String\n        fmt.Print(s2)\n    }\n</code></pre>\n\n<p>I have tried change the type to sql.Nullstring as the error suggested but it does not then see the if condition as true.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 1, "creation_date": 1559116965, "post_id": 56355702, "comment_id": 99315611, "body": "please share the response format."}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559117434, "post_id": 56355702, "comment_id": 99315880, "body": "This may help you.. <a href=\"https://stackoverflow.com/questions/47723193/panic-json-cannot-unmarshal-array-into-go-value-of-type-main-structure\" title=\"panic json cannot unmarshal array into go value of type main structure\">stackoverflow.com/questions/47723193/&hellip;</a>"}, {"owner": {"reputation": 19, "user_id": 11439930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54a3eef5edc8acefec29734b30405cec?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/11439930/kevin"}, "reply_to_user": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559119764, "post_id": 56355702, "comment_id": 99317114, "body": "@VikashPathak i will look to that, thank you"}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 11439930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54a3eef5edc8acefec29734b30405cec?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/11439930/kevin"}, "edited": false, "score": 0, "creation_date": 1559119698, "post_id": 56356027, "comment_id": 99317068, "body": "i followed your suggestion but i got another error: <code>syntax error: unexpected [ at end of statement</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 19, "user_id": 11439930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54a3eef5edc8acefec29734b30405cec?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/11439930/kevin"}, "edited": false, "score": 1, "creation_date": 1559120501, "post_id": 56356027, "comment_id": 99317554, "body": "@Kevin what Vorsprung actually meant was <code>[]map[string]interface{}</code>. The <code>map[string]interface{}[]</code> is not a valid Go statement. <code>[]</code> in front of a type declares a slice of that type, <code>[]</code> at the end of a type is not valid Go."}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1559121575, "last_edit_date": 1559121575, "creation_date": 1559117983, "answer_id": 56356027, "question_id": 56355702, "link": "https://stackoverflow.com/questions/56355702/extracting-specific-and-latest-data-from-http-webserver-using-golang/56356027#56356027", "title": "Extracting specific and latest data from http webserver using golang", "body": "<p>Your body data is a JSON array so the unmarshalling has to be to an array</p>\n\n<pre><code>var data []map[string]interface{} // add this to declaration\nerr = json.Unmarshal([]byte(body), &amp;data)\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 11439930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54a3eef5edc8acefec29734b30405cec?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/11439930/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559121575, "creation_date": 1559116819, "last_edit_date": 1559120022, "question_id": 56355702, "link": "https://stackoverflow.com/questions/56355702/extracting-specific-and-latest-data-from-http-webserver-using-golang", "title": "Extracting specific and latest data from http webserver using golang", "body": "<p>I'm trying to make a simple blockchain and store the data to the webserver based on this tutorial <a href=\"https://github.com/mycoralhealth/blockchain-tutorial/tree/master/proof-work\" rel=\"nofollow noreferrer\">https://github.com/mycoralhealth/blockchain-tutorial/tree/master/proof-work</a>. I want to get the latest value by using get request but only the specific data not all the data, for example only the PrevHash and Data.</p>\n\n<p>I tried this code to send a get request to the server.</p>\n\n<pre><code>package main\n\nimport (\n\n\"net/http\"\n\"log\"\n\"io/ioutil\"\n\"fmt\"\n\"encoding/json\")\n\nfunc main() {\n\nMakeRequest()\n}\n\nfunc MakeRequest() {\n\nresp, err := http.Get(\"http://localhost:5555/\")\nif err != nil {\n    log.Fatalln(err)\n}\n\nbody, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    log.Fatalln(err)\n}\n\nvar data map[string]interface{}\n    err = json.Unmarshal([]byte(body), &amp;data)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(data[\"Data\"])\n}\n</code></pre>\n\n<p>But it gives the output:\n<code>panic: json: cannot unmarshal array into Go value of type map[string]interface {}</code></p>\n\n<p>Update:\nThis is my data in webserver. I want to get the value of parameter \"Data\" based the newest NoBlock, which is always updated.</p>\n\n<pre><code>([]main.Block) (len=2 cap=2) {\n(main.Block) {\nNoBlock: (int) 0,\nTimestamp: (string) (len=39) \"2019-05-29 14:50:00.966201709 +0800 +08\",\nData: (string) \"\",\nHash: (string) (len=64) \"5feceb66ffc86f38d952786c6d696c79c2dbc239dd4e91b46729d73a27fb57e9\",\nPrevHash: (string) \"\",\nDifficulty: (int) 0,\nNonce: (string) \"\"\n},\n(main.Block) {\nNoBlock: (int) 1,\nTimestamp: (string) (len=39) \"2019-05-29 14:50:12.891324534 +0800 +08\",\nData: (string) (len=110) \"3e19124ee3a459d5c6edcb9b2a37cf2c4febd2e3ab8a8628f1bfb197bdaf5accada8349d9a99cfbf7cdd1af003c14f7c5c004f53c1d231\",\nHash: (string) (len=64) \"b2aebe50c3ace8230cb8d839d4e36da8899a2d0f0a3c1dbc9e9c717f74ead464\",\nPrevHash: (string) (len=64) \"5feceb66ffc86f38d952786c6d696c79c2dbc239dd4e91b46729d73a27fb57e9\",\nDifficulty: (int) 0,\nNonce: (string) (len=1) \"0\"\n }\n}\n</code></pre>\n\n<p>Please help me, thank you.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 862, "user_id": 986519, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/nT0Me.jpg?s=128&g=1", "display_name": "Abhishek Salian", "link": "https://stackoverflow.com/users/986519/abhishek-salian"}, "edited": false, "score": 0, "creation_date": 1559612365, "post_id": 56436292, "comment_id": 99466750, "body": "also the reason i said make different package/namespace is because if you are going to make var db global then anything under main can access that and modify, if it is in different namespace and variable or method starting with lowercase becomes private to that namespace, its much safer this way."}, {"owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559612653, "post_id": 56436292, "comment_id": 99466807, "body": "<code>sql.Open</code> does not create a connection. It only creates the context. Connection gets created when the query is executed which means in <code>handleConnection()</code>. I can catch the error and then reconnect but I don&#39;t want to wait for the query to fail to reconnect with new password, but instead catch the bad connection error and then create a new connection by fetching password from vault. However, I am unsure as to how I can catch the bad connection error since the library does not throw it(may be I am wrong)."}, {"owner": {"reputation": 862, "user_id": 986519, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/nT0Me.jpg?s=128&g=1", "display_name": "Abhishek Salian", "link": "https://stackoverflow.com/users/986519/abhishek-salian"}, "reply_to_user": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559614021, "post_id": 56436292, "comment_id": 99467028, "body": "yeah true, i meant to say context. updated answer with specific details"}, {"owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559615031, "post_id": 56436292, "comment_id": 99467188, "body": "Does that mean we need to ping before every sql execution to check if connection is alive? The chances of it to fail are very rare so pinging every time is not feasible. That is the reason I wanted to catch bad connection error and then reconnect. The library does the job of checking if the connection is alive and if not try creating new connection with the saved context. All I wanted to do is when the library catches bad connection error and creates new connection, make it use the new password which could solve the problem."}, {"owner": {"reputation": 862, "user_id": 986519, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/nT0Me.jpg?s=128&g=1", "display_name": "Abhishek Salian", "link": "https://stackoverflow.com/users/986519/abhishek-salian"}, "reply_to_user": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559615195, "post_id": 56436292, "comment_id": 99467218, "body": "not at every sql query, just before you start executing underlying queries inside your handleConnection(), so once everytime you execute this method."}, {"owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559615285, "post_id": 56436292, "comment_id": 99467237, "body": "It is a long running daemon and this method gets executed when ever a new tcp connection gets established which happens almost every time."}, {"owner": {"reputation": 862, "user_id": 986519, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/nT0Me.jpg?s=128&g=1", "display_name": "Abhishek Salian", "link": "https://stackoverflow.com/users/986519/abhishek-salian"}, "reply_to_user": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559615311, "post_id": 56436292, "comment_id": 99467243, "body": "&quot;All I wanted to do is when the library catches bad connection error and creates new connection, make it use the new password which could solve the problem.&quot; then you have to wait for query to fail and then retry. either check before which is safer. ping only checks connection status doesnot execute any query or you have to wait for it to fail. i prefer ping over failing."}, {"owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "edited": false, "score": 0, "creation_date": 1559615773, "post_id": 56436292, "comment_id": 99467300, "body": "Agree that pinging is a good idea but not for this scenario because of various other constraints and we have thought about it. Waiting for the query to fail is the solution we had in mind but we wanted to make it better by handling it at the connection establishment level. The way we could do it in oop languages is by extending the library and overriding the function. However, my go skills are not that great and am still learning and am not sure if there is an equivalent approach in golang with composition."}], "tags": [], "owner": {"reputation": 862, "user_id": 986519, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/nT0Me.jpg?s=128&g=1", "display_name": "Abhishek Salian", "link": "https://stackoverflow.com/users/986519/abhishek-salian"}, "is_accepted": false, "score": 0, "last_activity_date": 1559613988, "last_edit_date": 1559613988, "creation_date": 1559611590, "answer_id": 56436292, "question_id": 56355577, "link": "https://stackoverflow.com/questions/56355577/using-database-sql-library-and-fetching-password-from-vault-when-a-new-connectio/56436292#56436292", "title": "Using database/sql library and fetching password from vault when a new connection fails", "body": "<p>Why do you have to create context on main?\nwhy not create a separate package/namespace and perform db connections in there.\ncreate a new namespace with methods...\ncreateDBClient() this creates new db contexts by fetching password from vault and stores it in global var db\nGetDBClient() this checks if the global var db has something in it, if so check if it can connect to db (<a href=\"https://golang.org/pkg/database/sql/#DB.Ping\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#DB.Ping</a>)\nif not call createDBClient() loop this for few times with sleep if doesnt connect crash and burn\nif it connects return the context</p>\n\n<p>now in your handleConnection() call db := newnamespace.GetDBClient()</p>\n"}, {"tags": [], "owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "is_accepted": true, "score": 0, "last_activity_date": 1560329809, "last_edit_date": 1560329809, "creation_date": 1560314137, "answer_id": 56554743, "question_id": 56355577, "link": "https://stackoverflow.com/questions/56355577/using-database-sql-library-and-fetching-password-from-vault-when-a-new-connectio/56554743#56554743", "title": "Using database/sql library and fetching password from vault when a new connection fails", "body": "<p>I have solved this problem by creating a custom driver that imports github.com/go-sql-driver/mysql and get registered in the sql package, so that when ever a new connection is required the custome driver can fetch password from vault and pass it down to mysql driver to open the connection. Refer the code sample below.</p>\n\n<pre><code>package vault-mysql-driver\n\nimport (\n    \"database/sql\"\n    \"github.com/go-sql-driver/mysql\"\n)\n\ntype VaultMysqlDriver struct {\n    *mysql.MySQLDriver\n}\n\nfunc updateDsn(dsn string) (string, err) {\n    // logic to fetch password from vault and update dsn with the password\n}\n\nfunc (d VaultMysqlDriver) Open(dsn string) (driver.Conn, error) {\n\n    updateddsn, err := updateDsn(dsn)\n\n    // Pass down the dsn with password to mysql driver's open function\n    return d.MySQLDriver.Open(updateddsn)\n\n}\n\n// When initialised will register the driver in sql package\nfunc init() {\n    sql.Register(vault-driver, &amp;CyberarkMysqlDriver{&amp;mysql.MySQLDriver{}})\n}\n\n</code></pre>\n\n<p>This package is now imported in the daemon as below,</p>\n\n<pre><code>import (\n    \"database/sql\"\n    _ \"vault-mysql-driver\"// init is invoked and it will get registered in sql package\n    \"net\"\n)\n\nvar db *sql.DB\nconst port = \"port number\"\n\nfunc main() {\n    // vault-driver is used instead of mysql so that the sql package knows to use the custom driver for new connections.\n    db, err = sql.Open(\"vault-driver\",\"&lt;Connection string that contains the password fetched from vault&gt;\")\n\n    db.SetMaxOpenConns(100)\n\n    listener, err := net.Listen(\"tcp\", \":\"+port)\n\n    for {\n        conn, err := listener.Accept() \n\n        go handleConnection(conn)\n    }\n}\n\nfunc handleConnection(conn net.Conn) {\n    // Uses db variable to connect to db.\n}\n</code></pre>\n\n<p>This way whenever the vault rotates the password there won't be any connection failure since the vault driver will always fetch password from vault for every new connections.</p>\n"}], "owner": {"reputation": 157, "user_id": 7274716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73ac5498931728e5af77898185393ff4?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith Mohan", "link": "https://stackoverflow.com/users/7274716/rohith-mohan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "accepted_answer_id": 56554743, "answer_count": 2, "score": 0, "last_activity_date": 1560329809, "creation_date": 1559116375, "last_edit_date": 1559526488, "question_id": 56355577, "link": "https://stackoverflow.com/questions/56355577/using-database-sql-library-and-fetching-password-from-vault-when-a-new-connectio", "title": "Using database/sql library and fetching password from vault when a new connection fails", "body": "<p>I have a long running daemon written in Go, that listens to a port and spins up multiple go routines for every new connection to handle the data. There is a global variable <code>db</code> that is assigned connection context returned by <code>database/sql</code> library's <code>open()</code> function in the func main() of my script. </p>\n\n<p>We store the db password in a vault which rotates it every couple of days for security reasons. I can fetch the password from the vault the first time it creates the connection context and the same context is used in all go routines for creating new db connections.\nHowever, when the password is rotated by the vault, all new db connections fail. I would like to know what is the best way of handling this so that it fetches the password from the vault on failure and reconnects. If it was an oop language, I could extend the db library and override the connection function to catch the error and fetch password from the vault on connection failure. Is there a similar approach that can be used in Go or are there any other way of handling this? I am very new to Go, and apologies if I have not framed the question right. </p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"net\"\n)\n\nvar db *sql.DB\nconst port = \"port number\"\n\nfunc main() {\n\n    db, err = sql.Open(\"mysql\",\"&lt;Connection string that contains the password fetched from vault&gt;\")\n\n    db.SetMaxOpenConns(100)\n\n    listener, err := net.Listen(\"tcp\", \":\"+port)\n\n    for {\n        conn, err := listener.Accept() \n\n        go handleConnection(conn)\n    }\n}\n\nfunc handleConnection(conn net.Conn) {\n    // Uses db variable to connect to db.\n}\n\n</code></pre>\n"}, {"tags": ["go", "vim-plugin"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1559116533, "post_id": 56355477, "comment_id": 99315384, "body": "Clone the repo and checkout to desired commit not an option?"}], "answers": [{"comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559119695, "post_id": 56355607, "comment_id": 99317063, "body": "@user1269298 does this help?"}, {"owner": {"reputation": 489, "user_id": 1269298, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2608e65a02613c529dcffdc3d3de4062?s=128&d=identicon&r=PG&f=1", "display_name": "user1269298", "link": "https://stackoverflow.com/users/1269298/user1269298"}, "edited": false, "score": 0, "creation_date": 1559166017, "post_id": 56355607, "comment_id": 99340408, "body": "I do not have problem on install multiple version go.  \u0417\u0435\u043b\u0451\u043d\u044b\u0439 &#39;s suggestion sounds reasonable, I will start with that."}], "tags": [], "owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "is_accepted": false, "score": 0, "last_activity_date": 1559116480, "creation_date": 1559116480, "answer_id": 56355607, "question_id": 56355477, "link": "https://stackoverflow.com/questions/56355477/how-to-install-old-version-go-vim-plugin/56355607#56355607", "title": "How to Install old version go-vim plugin", "body": "<p>You should try goenv it support multiple version of golang.</p>\n\n<p>Here is the installation guide</p>\n\n<p><a href=\"https://github.com/syndbg/goenv/blob/master/INSTALL.md\" rel=\"nofollow noreferrer\">https://github.com/syndbg/goenv/blob/master/INSTALL.md</a></p>\n\n<p>And after installation you can choose and install any version from the list.</p>\n\n<p>Just by typing..</p>\n\n<pre><code>goenv install 1.10.2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 489, "user_id": 1269298, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2608e65a02613c529dcffdc3d3de4062?s=128&d=identicon&r=PG&f=1", "display_name": "user1269298", "link": "https://stackoverflow.com/users/1269298/user1269298"}, "is_accepted": true, "score": 0, "last_activity_date": 1562343912, "creation_date": 1562343912, "answer_id": 56906512, "question_id": 56355477, "link": "https://stackoverflow.com/questions/56355477/how-to-install-old-version-go-vim-plugin/56906512#56906512", "title": "How to Install old version go-vim plugin", "body": "<p>Solved it by cloning the repo and checkout to an old commit</p>\n"}], "owner": {"reputation": 489, "user_id": 1269298, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2608e65a02613c529dcffdc3d3de4062?s=128&d=identicon&r=PG&f=1", "display_name": "user1269298", "link": "https://stackoverflow.com/users/1269298/user1269298"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 56906512, "answer_count": 2, "score": 0, "last_activity_date": 1562343912, "creation_date": 1559116031, "question_id": 56355477, "link": "https://stackoverflow.com/questions/56355477/how-to-install-old-version-go-vim-plugin", "title": "How to Install old version go-vim plugin", "body": "<p>I am a new golang developer. My company uses go 1.10.2, and I hit following error during installing vim-go</p>\n\n<pre><code>Error installing golang.org/x/tools/cmd/gopls: # golang.org/x/tools/internal/lsp/source^@../../../golang.org/x/tools/internal/lsp/source/symbols.go:232:18: ti.EmbeddedType undefined (t\nype *types.Interface has no field or method EmbeddedType\n</code></pre>\n\n<p>It turns out due to the old go version. <a href=\"https://github.com/fatih/vim-go/issues/2246\" rel=\"nofollow noreferrer\">https://github.com/fatih/vim-go/issues/2246</a>, <a href=\"https://github.com/golang/go/issues/31864\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/31864</a>. Since upgrade go version is not an option, the only choice I can think of is to install an old version vim-go that supports go 1.10.2. But I am not sure how to do so. \nThis is how I install vim-go now:</p>\n\n<pre><code>git clone https://github.com/fatih/vim-go.git ~/.vim/pack/plugins/start/vim-go\n</code></pre>\n\n<p>then open up vim and run <code>:GoInstallBinaries</code> (where above error show up)</p>\n\n<p>Any suggestions would be great. Since I am neither a vim nor a go person before, more details would be appreciate!</p>\n"}, {"tags": ["go", "struct", "deep-copy"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559115097, "post_id": 56355212, "comment_id": 99314615, "body": "Using package <code>reflect</code> you should be able to implement your own deep copy including unexported fields using <code>unsafe</code>, if I&#39;m not mistaken."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559115182, "post_id": 56355212, "comment_id": 99314671, "body": "@mkopriva: but that sounds like a lot of work out of nothing :) Having an abilitiy to deep-copy all fields does indeed appear useful."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1559116261, "post_id": 56355212, "comment_id": 99315235, "body": "@mkopriva You can read unexported fields using reflection, but you can&#39;t set them. See <a href=\"https://stackoverflow.com/questions/38369350/how-to-clone-a-structure-with-unexported-field\">How to clone a structure with unexported field?</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1559117192, "post_id": 56355212, "comment_id": 99315735, "body": "@icza <a href=\"https://stackoverflow.com/a/43918797/965900\">stackoverflow.com/a/43918797/965900</a> (i did mention <code>unsafe</code> in my initial comment)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559117279, "post_id": 56355212, "comment_id": 99315784, "body": "@mkopriva Yes, using <code>unsafe</code> you can do anything, even modify immutable strings, so I wouldn&#39;t count that."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1559121020, "post_id": 56355212, "comment_id": 99317855, "body": "@mkopriva Oh, sorry, didn&#39;t spot the <code>unsafe</code> word in your first comment."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559121513, "post_id": 56355212, "comment_id": 99318144, "body": "@icza no problem at all"}], "answers": [{"tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": false, "score": 0, "last_activity_date": 1559116925, "creation_date": 1559116925, "answer_id": 56355729, "question_id": 56355212, "link": "https://stackoverflow.com/questions/56355212/deep-copying-data-structures-in-golang/56355729#56355729", "title": "Deep copying data structures in golang", "body": "<p>If the package your are using does not provide a copy function for the data stucture, then I would write my own type-safe copy function. Moreover, I would not worry about unexported fields, because there must be a reason why the developer has decided to hide those fields to users.</p>\n\n<p>In your example:</p>\n\n<pre><code>func NewHashSetCopy(src *hashset.Set) *hashset.Set{\n    dst := *hashset.New()\n    iterator := src.Iter()\n    for elem := range iterator {\n        dst.Add(elem)\n    }\n    return dst\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1559118822, "last_edit_date": 1559118822, "creation_date": 1559116928, "answer_id": 56355733, "question_id": 56355212, "link": "https://stackoverflow.com/questions/56355212/deep-copying-data-structures-in-golang/56355733#56355733", "title": "Deep copying data structures in golang", "body": "<p>Unfortunately or not, there is no way to do this in Go. First tool that comes to mind is reflection (package <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a>), but using reflection you can only read unexported fields, but you can't set them. See <a href=\"https://stackoverflow.com/questions/38369350/how-to-clone-a-structure-with-unexported-field\">How to clone a structure with unexported field?</a></p>\n\n<p>The only way to clone structures with unexported fields would be to use package <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\"><code>unsafe</code></a> (see an example here: <a href=\"https://stackoverflow.com/questions/42664837/access-unexported-fields-in-golang-reflect/43918797#43918797\">Access unexported fields in golang/reflect?</a>), but as its name says: it's <em>unsafe</em> and you should stay away from it as much as possible. Programs created using <code>unsafe</code> has no guarantee that they continue to work with newer Go releases, or that they behave the same on every platform.</p>\n\n<p><em>In general</em> the only and proper way to support cloning in Go is if the package itself supports such operations.</p>\n\n<p><strong>Note #1:</strong></p>\n\n<p>This does not mean that in some <em>specific</em> case you can't \"mimic\" cloning by creating a new value and building its state manually. For example you can clone a <code>map</code> by creating a new map, iterating over the key-value pairs of the original and setting them in the new map.</p>\n\n<p><strong>Note #2:</strong></p>\n\n<p>Do note that you can make \"exact\" copies of structs having unexported fields by simply <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assigning</a> them to another struct variable (of the same type), which will properly copy the unexported fields too.</p>\n\n<p>Like in this example:</p>\n\n<pre><code>type person struct {\n    Name string\n    age  *int\n}\n\nage := 22\np := &amp;person{\"Bob\", &amp;age}\nfmt.Println(p)\n\np2 := new(person)\n*p2 = *p\nfmt.Println(p2)\n</code></pre>\n\n<p>Which will output (try it on the <a href=\"https://play.golang.org/p/tKkRC3IeT2t\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{Bob 0x414020}\n&amp;{Bob 0x414020}\n</code></pre>\n\n<p>Which we can even generalize using <code>reflect</code> without relying on the concrete type:</p>\n\n<pre><code>type person struct {\n    Name string\n    age  *int\n}\n\nage := 22\np := &amp;person{\"Bob\", &amp;age}\nfmt.Println(p)\n\nv := reflect.ValueOf(p).Elem()\nvp2 := reflect.New(v.Type())\nvp2.Elem().Set(v)\nfmt.Println(vp2)\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/wmSD3iuptp3\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><strong>But what we can't do</strong> is change the <code>person.age</code> unexported field to point to something else. Without help of the declaring package, it can only be <code>nil</code> or the same pointer value (pointing to the object as the original field).</p>\n\n<p>Also see related: <a href=\"https://stackoverflow.com/questions/46790190/quicker-way-to-deepcopy-objects-in-golang\">Quicker way to deepcopy objects in golang</a></p>\n"}], "owner": {"reputation": 75, "user_id": 10668536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d520fb99182d11f935e74abd96c2de?s=128&d=identicon&r=PG&f=1", "display_name": "Mayoi", "link": "https://stackoverflow.com/users/10668536/mayoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5829, "favorite_count": 0, "accepted_answer_id": 56355733, "answer_count": 2, "score": 2, "last_activity_date": 1559120872, "creation_date": 1559114950, "last_edit_date": 1559120872, "question_id": 56355212, "link": "https://stackoverflow.com/questions/56355212/deep-copying-data-structures-in-golang", "title": "Deep copying data structures in golang", "body": "<p>I want to duplicate an instance of a data structure. Since go does not have any builtins, I am using a third party library: <code>https://github.com/emirpasic/gods</code>. </p>\n\n<p>For example, I may try use deep copy with a hash set. </p>\n\n<pre><code>var c, d hashset.Set\nc = *hashset.New()\nc.Add(1)\ndeepcopy.Copy(d, c)\nc.Add(2)\nfmt.Println(c.Contains(2))\nfmt.Println(d.Contains(2))\nfmt.Println(c.Contains(1))\nfmt.Println(d.Contains(1))\n</code></pre>\n\n<p>However, the content of the hash set is not copied at all. I know deep copy modules can't copy unexported values, but since there is no builtin \"copy constructor\" in the library, does it mean it is not possible to fully duplicate a data structure instance with the library without modifying its code? (Similar problem happens with some other libraries I looked into).</p>\n\n<p>I am new to golang and does not feel right, since similar things can be easily achieved for example in C++. I know I could write my own version or modify their code, but it is too much work than expected and that's why I think there should be an idiomatic way.</p>\n\n<p>PS: For people who may say \"there is no need of such functionality\", I am distributing some complex state with some data structures to parallel calculation threads, they use the states directly and must not interfere with each other.</p>\n"}, {"tags": ["go", "mutex", "atomic"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1559128895, "post_id": 56355119, "comment_id": 99322265, "body": "And what&#39;s the problem, exactly?"}, {"owner": {"reputation": 1298, "user_id": 3319725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f6a9037c9ce9c44d478bad131c25acc?s=128&d=identicon&r=PG&f=1", "display_name": "AnatolyG", "link": "https://stackoverflow.com/users/3319725/anatolyg"}, "edited": false, "score": 0, "creation_date": 1599494080, "post_id": 56355119, "comment_id": 112785294, "body": "I&#39;d suggest you to take a look at <a href=\"https://github.com/anatolygudkov/mc4go\" rel=\"nofollow noreferrer\">github.com/anatolygudkov/mc4go</a> as an example. This is thread safe counters which can be read even from another process..."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 2, "last_activity_date": 1559205252, "creation_date": 1559205252, "answer_id": 56374549, "question_id": 56355119, "link": "https://stackoverflow.com/questions/56355119/is-there-a-way-to-reset-counter-incremented-using-atomic-adduint64/56374549#56374549", "title": "Is there a way to reset counter incremented using atomic.AddUint64?", "body": "<p>So what is the problem to use something like this?</p>\n\n<pre><code>func TestNameAtomic(t *testing.T) {\n    var i int64\n\n    atomic.AddInt64(&amp;i, 1)\n    atomic.AddInt64(&amp;i, 1)\n    atomic.AddInt64(&amp;i, 1)\n    fmt.Println(i)\n\n    atomic.CompareAndSwapInt64(&amp;i, i, 0)\n    fmt.Println(i)\n}\n</code></pre>\n"}], "owner": {"reputation": 336, "user_id": 2651871, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4830aa030d20eeda5677e23f830dddd2?s=128&d=identicon&r=PG", "display_name": "Amber Kulkarni", "link": "https://stackoverflow.com/users/2651871/amber-kulkarni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559205252, "creation_date": 1559114583, "question_id": 56355119, "link": "https://stackoverflow.com/questions/56355119/is-there-a-way-to-reset-counter-incremented-using-atomic-adduint64", "title": "Is there a way to reset counter incremented using atomic.AddUint64?", "body": "<p>I am implementing global counters for a concurrent go application.</p>\n\n<p>My use case is that the counter should be reset after x seconds and written to DB.</p>\n\n<p>I have tried using mutex (I am able to reset counter using this)</p>\n\n<p>Also when I increment the counter I also log something.\nI have found that after the application runs for about 8-9 hours the number of lines logged and the counter value do not match (mutex version) Counter values is always less.\nI have still not found the cause for this.</p>\n\n<p>I am using mutex in the following manner</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s *Metrics) AddQps() {\n    s.qpsMu.Lock()\n    s.qps++\n    s.qpsMu.Unlock()\n}\n\n\nAnd the flushing of metrics is done as follows.\n\nfor {\n    ticker := time.NewTicker(time.Duration(interval) * time.Second)\n    select {\n    case &lt;-ticker.C:\n       logger.Println(\"flushing metrics...\")\n    }\n}\n</code></pre>\n\n<p>I had implemented the mutex part referencing \n[<a href=\"https://stackoverflow.com/questions/50304851/how-to-create-global-counter-in-golang-in-highly-concurrent-system]\">How to create global counter in golang in highly concurrent system</a></p>\n\n<p>Due to the above mentioned problem I am now trying counters using sync.atomic.\nAs I want the metric to be flushed after x seconds I wanted to reset the counter.</p>\n"}, {"tags": ["go", "kubernetes", "apache-kafka", "aws-msk"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11484133, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vY8hQkjAnAY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcztc1Pohy0-y0N5JCMlOGhlJWRqA/mo/photo.jpg?sz=128", "display_name": "Piyush Kumar", "link": "https://stackoverflow.com/users/11484133/piyush-kumar"}, "edited": false, "score": 0, "creation_date": 1560068583, "post_id": 56512862, "comment_id": 99612403, "body": "Thanks for the answer. Regarding the second question, I don&#39;t exactly need such behavior but I was getting that from k8s. You mention an external solution, what would that be?"}, {"owner": {"reputation": 501, "user_id": 7051479, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/139f7b5ab8eedfe2cd43b3cf1d5e9dba?s=128&d=identicon&r=PG&f=1", "display_name": "Avik Aggarwal", "link": "https://stackoverflow.com/users/7051479/avik-aggarwal"}, "reply_to_user": {"reputation": 21, "user_id": 11484133, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vY8hQkjAnAY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcztc1Pohy0-y0N5JCMlOGhlJWRqA/mo/photo.jpg?sz=128", "display_name": "Piyush Kumar", "link": "https://stackoverflow.com/users/11484133/piyush-kumar"}, "edited": false, "score": 0, "creation_date": 1560072194, "post_id": 56512862, "comment_id": 99613015, "body": "Maybe a log analyser or log based trigger through some tool. You could export your application&#39;s log through side car containers in each pod and then use those logs to configure triggers."}], "tags": [], "owner": {"reputation": 501, "user_id": 7051479, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/139f7b5ab8eedfe2cd43b3cf1d5e9dba?s=128&d=identicon&r=PG&f=1", "display_name": "Avik Aggarwal", "link": "https://stackoverflow.com/users/7051479/avik-aggarwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1560066587, "creation_date": 1560066587, "answer_id": 56512862, "question_id": 56354566, "link": "https://stackoverflow.com/questions/56354566/handling-kafka-clients-updates-in-kubernetes/56512862#56512862", "title": "Handling kafka clients updates in kubernetes", "body": "<p>For your first question, I would suggest having rolling update of your deployment in the cluster.\nFor second, that is the general behavior of deployments in kubernetes. I could think of an external monitoring solution that de-deploys your application or stops handling requests in case of a <code>panic</code>.\nIt would be better if you could explain why exactly you need such kind of behavior.! </p>\n"}], "owner": {"reputation": 21, "user_id": 11484133, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vY8hQkjAnAY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcztc1Pohy0-y0N5JCMlOGhlJWRqA/mo/photo.jpg?sz=128", "display_name": "Piyush Kumar", "link": "https://stackoverflow.com/users/11484133/piyush-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 342, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1564336809, "creation_date": 1559112452, "last_edit_date": 1564336809, "question_id": 56354566, "link": "https://stackoverflow.com/questions/56354566/handling-kafka-clients-updates-in-kubernetes", "title": "Handling kafka clients updates in kubernetes", "body": "<p>I have a Kafka cluster running on AWS MSK with Kafka producer and consumer go clients running in kubernetes. The producer is responsible for sending the stream of data to Kafka. I need help solving the following problems:</p>\n\n<ol>\n<li><p>Let's say, there is some code change in producer code and have to redeploy it in kubernetes. How can I do that? Since the data is continuously generated, I cannot just simply stop the already running producer and deploy the updated one. In this case, I will lose the data between the update process.</p></li>\n<li><p>Sometimes due to a panic(golang) in the code, the client crashes, but since it is running as a pod, kubernetes restarts it. I am not able to understand as to whether it's a good thing or bad.</p></li>\n</ol>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "cron"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559111939, "post_id": 56354424, "comment_id": 99313119, "body": "If you&#39;re setting it 1-2 min ahead, the problem is most likely that when you change the timezone, you&#39;re adjusting it to a time in the past, or distant future."}, {"owner": {"reputation": 5, "user_id": 11571125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ba5f095533553ab4b8f8b51c4ca621?s=128&d=identicon&r=PG&f=1", "display_name": "cjder75", "link": "https://stackoverflow.com/users/11571125/cjder75"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559112632, "post_id": 56354424, "comment_id": 99313440, "body": "it&#39;s in the timezone i&#39;m living in, should that still be a problem ? i&#39;m basically testing it vs my computer clock , 2 min ahead. I&#39;m just manually imputing the Asia/Tokyo timezone for testing purpose but i shouldn&#39;t need it since that&#39;s where i live ( so that&#39;s my computer clock )."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559116818, "post_id": 56354424, "comment_id": 99315534, "body": "It doesn&#39;t matter if it&#39;s the timezone you live in. When you adjust &quot;15:26&quot; to any other time zone, it&#39;s no longer &quot;15:26&quot;, so won&#39;t run when you expect."}, {"owner": {"reputation": 5, "user_id": 11571125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ba5f095533553ab4b8f8b51c4ca621?s=128&d=identicon&r=PG&f=1", "display_name": "cjder75", "link": "https://stackoverflow.com/users/11571125/cjder75"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559117331, "post_id": 56354424, "comment_id": 99315818, "body": "so it&#39;s 15:26 adjusted , not 15:26 at defined timezone ?!  How should i proceed to make it run at 15:26  for location &quot;Asia/Tokyo&quot; ? I need to schedule things at different time zones. 16h30 Tokyo time , 10AM  London time , etc ..."}], "answers": [{"tags": [], "owner": {"reputation": 5, "user_id": 11571125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ba5f095533553ab4b8f8b51c4ca621?s=128&d=identicon&r=PG&f=1", "display_name": "cjder75", "link": "https://stackoverflow.com/users/11571125/cjder75"}, "is_accepted": false, "score": 0, "last_activity_date": 1559201459, "creation_date": 1559201459, "answer_id": 56373677, "question_id": 56354424, "link": "https://stackoverflow.com/questions/56354424/cron-job-doesnt-trigger-with-timezone/56373677#56373677", "title": "Cron Job doesn&#39;t trigger with TimeZone", "body": "<p>I was an error of the cron formula <code>\"26 15 * * *\"</code>  should have been <code>\"00 26 15 * *\"</code></p>\n"}], "owner": {"reputation": 5, "user_id": 11571125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17ba5f095533553ab4b8f8b51c4ca621?s=128&d=identicon&r=PG&f=1", "display_name": "cjder75", "link": "https://stackoverflow.com/users/11571125/cjder75"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559201459, "creation_date": 1559111693, "last_edit_date": 1559111874, "question_id": 56354424, "link": "https://stackoverflow.com/questions/56354424/cron-job-doesnt-trigger-with-timezone", "title": "Cron Job doesn&#39;t trigger with TimeZone", "body": "<p>I've been doing some test with cron jobs with timezones.\nMy goal is to setup 1 cron job per timezone so it can be run independently of the server location.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/robfig/cron\"\n    \"os\"\n    \"os/signal\"\n    \"time\"\n)\n\nfunc helloWorld() {\n  fmt.Println(\"hello world\")\n}\n\nfunc main() {\n    s, err1 := cron.Parse(\"26 15 * * *\")\n    fmt.Println(err1)\n    l, err := time.LoadLocation(\"Asia/Tokyo\")\n    fmt.Println(err)\n    c := cron.NewWithLocation(l)\n    c.Schedule(s, cron.FuncJob(helloWorld))\n    c.Start()\n\n    sig := make(chan os.Signal)\n    signal.Notify(sig, os.Interrupt, os.Kill)\n    &lt;-sig\n}\n</code></pre>\n\n<p>Here i'm just trying to make a test. I expect to see helloWorld at 15:26 Tokyo time. ( 3:26PM )</p>\n\n<p>The sig snippet is something i've found on stack overflow for testing purposes so that the program doesn't close before the cron job has time to run. </p>\n\n<p>I'm always setting up the time 1 or 2 minutes ahead and it's never working.\nany idea why ?</p>\n"}, {"tags": ["go", "networking", "grpc"], "comments": [{"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 1, "creation_date": 1559109268, "post_id": 56353101, "comment_id": 99312033, "body": "Why have you omitted the necessary parts of the code base?"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 1, "creation_date": 1559113925, "post_id": 56353101, "comment_id": 99314023, "body": "Probably the bottleneck is the code you omitted. That is, where you actually read the grpc messages and write their payload to file. Moreover, if you suspect performance issues in your Go programs, you can always trace their execution and see if you find the bottleneck. <a href=\"https://blog.gopheracademy.com/advent-2017/go-execution-tracer/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2017/go-execution-tracer</a>"}, {"owner": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "reply_to_user": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1559138381, "post_id": 56353101, "comment_id": 99328059, "body": "@diyoda_ because its ~~proprietary~~, there&#39;s nothing special with the connection so i can share that. I&#39;ll update the code with code that somewhat similar to the actual code."}, {"owner": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559138434, "post_id": 56353101, "comment_id": 99328099, "body": "@GiulioMicheloni i&#39;ll be updating the code shortly with some more details"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "edited": false, "score": 0, "creation_date": 1559182028, "post_id": 56368927, "comment_id": 99343878, "body": "Well yes and no. the gRPC server automatically multithreads streams on the same connection, so each stream gets its own go routine. Then, in order to not read the entire file into memory at once, the second go routine reads out of the buffer into a file."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "edited": false, "score": 0, "creation_date": 1559221820, "post_id": 56368927, "comment_id": 99358128, "body": "IMHO, two goroutines for each stram is not necessary. You could perform the chunking of input stream directly in the same goroutine that also writes the chunks to output file. Having more goroutines than needed may lead to high contention and then bad concurrency. Moreover, what is the size of buffer and channel? Make sure that they are not too small. I would reccomend to trace your executable to see what is going on."}, {"owner": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "edited": false, "score": 0, "creation_date": 1559224696, "post_id": 56368927, "comment_id": 99359786, "body": "Well the first go routine is out of my control--every stream that the server gets, gRPC automatically spins up a go routine to handle it (or rather, i think it gets it out of a pool). The reason i choose this route was to just get as much in to the buffer as possible w/o waiting to write to the file. The buffer is a <code>bytes.Buffer</code>, so resizable, and the channel is 50."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "edited": false, "score": 0, "creation_date": 1559234153, "post_id": 56368927, "comment_id": 99364788, "body": "It makes sense. The prototype looks ok to me then. I can only suggest to use the tracer to spot the critical path and possibly improve it."}], "tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": false, "score": 0, "last_activity_date": 1559166196, "creation_date": 1559166196, "answer_id": 56368927, "question_id": 56353101, "link": "https://stackoverflow.com/questions/56353101/grpc-slow-bandwidth-to-remote-server/56368927#56368927", "title": "gRPC slow bandwidth to remote server", "body": "<p>If I get it right, you are reading the input stream within one goroutine and dispatch the bytes to a second goroutine. Why don't you let the second goroutine handle the stream entirely? In this way the first goroutine is free to process the following streams, if any. </p>\n\n<p>Typically the pattern is to have one goroutine that listens for incoming requests and spawns new goroutines for handling them. It is crutial that the main goroutine does not call any blocking API, besides the one to listen for requests.</p>\n\n<p>For example:</p>\n\n<pre><code>for {\n    newStream := ListenForStreams() //Block until next stream\n    go consumeStream(newStream)\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 3064090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294b63951265205824c3d21255ad58d9?s=128&d=identicon&r=PG&f=1", "display_name": "PSU2017", "link": "https://stackoverflow.com/users/3064090/psu2017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1024, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559166196, "creation_date": 1559103905, "last_edit_date": 1559139408, "question_id": 56353101, "link": "https://stackoverflow.com/questions/56353101/grpc-slow-bandwidth-to-remote-server", "title": "gRPC slow bandwidth to remote server", "body": "<p>I have a gRPC service that transfers files from a local machine to a remote server, and I'm noticing some significant bandwidth issues. On average, it's downloading at about 1mb/s with one connection sharing several streams (usually about 8).</p>\n\n<p>The server uses TLS to encryption, but that doesn't seem to be the bottleneck, as turning off TLS has negligible effect on the performance. I've also tried using <code>iperf3</code> to test the bandwidth directly between the client and the server, and it resulted in 10mb/s.</p>\n\n<pre><code>Connecting to host &lt;host&gt;, port &lt;port&gt;\n[  7] local 10.0.0.112 port 59651 connected to &lt;ip&gt; port &lt;port&gt;\n[ ID] Interval           Transfer     Bitrate\n[  7]   0.00-1.00   sec  1.28 MBytes  10.7 Mbits/sec\n[  7]   1.00-2.00   sec   894 KBytes  7.35 Mbits/sec\n[  7]   2.00-3.00   sec   999 KBytes  8.17 Mbits/sec\n[  7]   3.00-4.00   sec  1.19 MBytes  10.0 Mbits/sec\n[  7]   4.00-5.00   sec   753 KBytes  6.17 Mbits/sec\n[  7]   5.00-6.00   sec  1.16 MBytes  9.67 Mbits/sec\n[  7]   6.00-7.00   sec  1.00 MBytes  8.44 Mbits/sec\n[  7]   7.00-8.00   sec  1.26 MBytes  10.5 Mbits/sec\n[  7]   8.00-9.00   sec  1.22 MBytes  10.2 Mbits/sec\n[  7]   9.00-10.00  sec  1.15 MBytes  9.66 Mbits/sec\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  7]   0.00-10.00  sec  10.8 MBytes  9.09 Mbits/sec                  sender\n[  7]   0.00-10.00  sec  10.7 MBytes  8.95 Mbits/sec                  receiver\n</code></pre>\n\n<p>The upload bandwidth from the client is about 10mb/s, and the download of the server is about 50mb/s (via <code>speedtest-cli</code>)</p>\n\n<p><code>traceroute</code> doesn't show anything interesting either...</p>\n\n<pre><code>traceroute to mikemeredith.ddns.net (108.52.111.249), 64 hops max, 72 byte packets\n 1  10.0.0.1 (10.0.0.1)  2.195 ms  5.388 ms  1.385 ms\n 2  &lt;ip&gt;  (&lt;ip&gt;)  8.256 ms  145.115 ms  19.025 ms\n 3  &lt;ip2&gt; (&lt;ip2&gt;)  9.951 ms  9.471 ms  141.929 ms\n 4  &lt;ip3&gt; (&lt;ip3&gt;)  18.389 ms  9.684 ms  12.248 ms\n 5  &lt;ip4&gt; (&lt;ip4&gt;)  143.880 ms  25.077 ms  10.606 ms\n 6  ae-13-ar01.capitolhghts.md.bad.comcast.net (68.87.168.61)  142.567 ms  137.153 ms  20.790 ms\n 7  be-33657-cr02.ashburn.va.ibone.comcast.net (68.86.90.57)  14.326 ms  144.076 ms  22.957 ms\n 8  be-1102-cs01.ashburn.va.ibone.comcast.net (96.110.32.169)  13.881 ms  144.756 ms  23.981 ms\n 9  be-2107-pe07.ashburn.va.ibone.comcast.net (96.110.32.186)  20.203 ms  94.433 ms  23.034 ms\n10  n-a.gw12.iad8.alter.net (152.179.50.205)  20.254 ms  278.023 ms  31.660 ms\n11  * * *\n12  &lt;ip12&gt; (&lt;ip13&gt;)  66.277 ms  39.229 ms  34.543 ms\n13  &lt;ip13&gt; (&lt;ip14&gt;)  48.849 ms  49.300 ms  49.546 ms\n</code></pre>\n\n<p><br>\nHere's the actual code</p>\n\n<p>Client Connection:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>creds, err := credentials.NewClientTLSFromFile(cerLoc, \"\")\nif err != nil {\n    fmt..Printf(\"failed to get tls from file: %v\\n\", err)\n    panic(err)\n}\nconn, err = grpc.Dial(host+port, grpc.WithTransportCredentials(creds))\n</code></pre>\n\n<p>Client Stream:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ctx, cancel := context.WithCancel(context.Background())\ndefer cancel()\nclient := proto.Client(conn)\nstream, err := client.BackupFiles(ctx, grpc.UseCompressor(gzip.Name))\n// Send on stream, max size of message is 2mb\n</code></pre>\n\n<p>Server Listening:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Start serving on port\nl, err := net.Listen(\"tcp\", port)\nif err != nil {\n    fmt.Printf(\"error listening on port %v: %v\\n\", port, err)\n    panic(err)\n}\n\nvar s *grpc.Server\ncreds, err := credentials.NewServerTLSFromFile(\n    certLoc,\n    keyLoc,\n)\nif err != nil {\n    fmt.Printf(\"error getting tls certs: %v\\n\", err)\n    panic(err)\n}\ns = grpc.NewServer(grpc.Creds(creds))\nproto.RegisterBackupServer(s, &amp;server{})\nerr = s.Serve(l)\n\n\n// Actual stream handling\n\n// Get a pooled SharedBuffer for assembling the file\nb := getBuffer()\ndefer putBuffer(b)\nc := make(chan int, []50)\nu, _ := user.Current()\n\nuid := uuid.New()\nfout, err := os.Create(filePath + uid.String())\nif err != nil {\n    fmt.Println(\"error creating staging file: \", err)\n    panic(err)\n}\nvar wg sync.WaitGroup\n\ngo assemble(b, fout, c, &amp;wg)\nfor {\n    in, err := stream.Recv()\n    if err == io.EOF {\n        break\n    }\n    if err != nil {\n        fmt.Println(\"encountered an error receiving on stream: \", err)\n        return err\n    }\n\n\n    bytesWritten = b.LockWrite(in.Payload) // This buffer is shared between the stream and the go routine\n\n    c &lt;- bytesWritten\n}\n\n\nclose(c)\nwg.Wait()\n\n_ = fout.Close()\n\n// This is a pre-declared workerpool that basically moves files around \nwp.Submit(func() {\n    finalizeFile(fout.Name(), name, perms, \"\", checkSum, userID)\n})\n\nreturn stream.SendAndClose(&amp;proto.Resp{\n    Status:   true,\n})\n\nfunc assemble(b *buffer.SharedBuffer, fout *os.File, in chan int, wg *sync.WaitGroup) {\n    wg.Add(1)\n    defer wg.Done()\n\n    buf := make([]byte, buffer.BUFFSIZE*2)\n\n    for i := range in {\n        if fout != nil {\n            b.Lock()\n            _, err := b.Read(buf[:i])\n            b.Unlock()\n            if err == io.EOF {\n                continue\n            }\n            if err != nil {\n                panic(err)\n            }\n            n, err := fout.Write(buf[:i])\n            if err != nil {\n                panic(err)\n            }\n            if n != i {\n                fmt.Printf(\"failed to write all bytes to file: %v != %v\", n, i)\n                panic(err)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Seems like I might be missing something with the inner workings of gRPC?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559125265, "post_id": 56353020, "comment_id": 99320281, "body": "You can use the <a href=\"https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/\" rel=\"nofollow noreferrer\">Kubernetes downward API</a> to find this out at deployment time; but you probably don&#39;t actually care which node you&#39;re running on, you just need a unique stable identity for each pod, in which case a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/\" rel=\"nofollow noreferrer\">StatefulSet</a> plus the container&#39;s local hostname is enough information."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 6683327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d84f609bab99e2126d841a63a6f71a3a?s=128&d=identicon&r=PG&f=1", "display_name": "nguyennd", "link": "https://stackoverflow.com/users/6683327/nguyennd"}, "edited": false, "score": 0, "creation_date": 1559110438, "post_id": 56354039, "comment_id": 99312500, "body": "Thank you, yes, I know it is out of date. But which package I need to import to use &quot;ks&quot;. Thank you"}, {"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "reply_to_user": {"reputation": 55, "user_id": 6683327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d84f609bab99e2126d841a63a6f71a3a?s=128&d=identicon&r=PG&f=1", "display_name": "nguyennd", "link": "https://stackoverflow.com/users/6683327/nguyennd"}, "edited": false, "score": 0, "creation_date": 1559111697, "post_id": 56354039, "comment_id": 99313002, "body": "Check the example package in the library I shared. Its their official golang kubernetes client library"}], "tags": [], "owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "is_accepted": false, "score": 1, "last_activity_date": 1559109829, "creation_date": 1559109829, "answer_id": 56354039, "question_id": 56353020, "link": "https://stackoverflow.com/questions/56353020/get-current-node-of-a-pod-in-kubernetes-source-code/56354039#56354039", "title": "Get current node of a pod in Kubernetes source code", "body": "<p>First of all the codebase you are referring to is outdated.</p>\n\n<p>You can use <a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">kubernetes/client-go</a> library to query Kubernetes API. Refer to examples</p>\n\n<p>Just a minimal code:</p>\n\n<pre><code>  pod, - := ks.clientSet.CoreV1().Pods(apiV1.NamespaceDefault).Get(\"your_pod_name\", metaV1.GetOptions{})\n  fmt.Printf(\"node name: %s\", pod.Spec.NodeName)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 6683327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d84f609bab99e2126d841a63a6f71a3a?s=128&d=identicon&r=PG&f=1", "display_name": "nguyennd", "link": "https://stackoverflow.com/users/6683327/nguyennd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1559109829, "creation_date": 1559103287, "last_edit_date": 1559106018, "question_id": 56353020, "link": "https://stackoverflow.com/questions/56353020/get-current-node-of-a-pod-in-kubernetes-source-code", "title": "Get current node of a pod in Kubernetes source code", "body": "<p>I am doing with Kubernetes. </p>\n\n<p>Now, I am doing with <a href=\"https://github.com/kubernetes-retired/contrib/tree/master/election\" rel=\"nofollow noreferrer\">leaderelection</a> in K8S.</p>\n\n<p>Because I want to develop something here. So, I need to get the node which current pod belongs to.</p>\n\n<p>For example,in this file <a href=\"https://github.com/kubernetes-retired/contrib/blob/master/election/vendor/k8s.io/kubernetes/pkg/client/leaderelection/leaderelection.go\" rel=\"nofollow noreferrer\">leaderelection.go</a>, after a pod becomes leader, I want to know which node this pod belongs to. </p>\n\n<p>Can someone help me? Can you give me an example of code!</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 887, "user_id": 3789634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPNmf.jpg?s=128&g=1", "display_name": "srimaln91", "link": "https://stackoverflow.com/users/3789634/srimaln91"}, "edited": false, "score": 0, "creation_date": 1559121594, "post_id": 56354062, "comment_id": 99318199, "body": "I&#39;ve been using this method and just wanted to know the validity of this. Thanks."}], "tags": [], "owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "is_accepted": true, "score": 1, "last_activity_date": 1559109938, "creation_date": 1559109938, "answer_id": 56354062, "question_id": 56352863, "link": "https://stackoverflow.com/questions/56352863/c-null-type-in-cgo/56354062#56354062", "title": "C NULL type in CGO", "body": "<p>I think you can use <code>nil</code> to test if the c function returns <code>NULL</code>. Try the following code:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint* cfunc(int i) {\n    if (i == 0) {\n        return NULL;\n    }\n\n    int *p = (int*)malloc(sizeof(int));\n    *p = 100;\n    return p;\n}\n*/\nimport \"C\"\n\nimport \"fmt\"\nimport \"unsafe\"\n\nfunc call_cfunc(i int32) {\n    ret := C.cfunc(C.int(i))\n    if ret == nil {\n        fmt.Println(\"nil\")\n    } else {\n        fmt.Println(*ret)\n        C.free(unsafe.Pointer(ret))\n    }\n}\n\nfunc main() {\n    call_cfunc(0)\n    call_cfunc(1)\n}\n</code></pre>\n"}], "owner": {"reputation": 887, "user_id": 3789634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPNmf.jpg?s=128&g=1", "display_name": "srimaln91", "link": "https://stackoverflow.com/users/3789634/srimaln91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "accepted_answer_id": 56354062, "answer_count": 1, "score": 1, "last_activity_date": 1559109938, "creation_date": 1559101867, "question_id": 56352863, "link": "https://stackoverflow.com/questions/56352863/c-null-type-in-cgo", "title": "C NULL type in CGO", "body": "<p>I have a C function that returns NULL when an exception occurs. How can I check whether the returned value is NULL or not in Go since it has no built-in types to represent C NULL. Below is my code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>retVal := C.myfunc()\n\nif retVal == nil {\n  // handle the error\n}\n\n</code></pre>\n"}, {"tags": ["go"], "owner": {"reputation": 11, "user_id": 11570422, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7K5JNzDonEg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc_DQAtmyqasQS6m6WpSnv_6kG06g/mo/photo.jpg?sz=128", "display_name": "PPPPPPig", "link": "https://stackoverflow.com/users/11570422/ppppppig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559111117, "creation_date": 1559096875, "last_edit_date": 1559111117, "question_id": 56352292, "link": "https://stackoverflow.com/questions/56352292/how-can-i-get-a-new-instance-from-python-class-by-go-python", "title": "How can I get a new instance from python class by go-python?", "body": "<p>I was trying to get a new instance from a python class Test. However, it returns nil when I called PyInstance_New() function. Here is my testing code.</p>\n\n<pre><code>// hello.py\nclass Test(object):\n    def __init__(self, name):\n        print(name)\n    def hello(self, line):\n        return line\n\n// test.go\nimport (\n    \"github.com/sbinet/go-python\"\n    \"log\"\n)\n\nfunc init() {\n    err := python.Initialize()\n    if err != nil {\n        panic(err.Error())\n    }\n}\n\nfunc main() {\n    hello := python.PyImport_ImportModule(\"hello\")\n    if hello == nil {\n        log.Fatalf(\"could not import 'hello'\\n\")\n    }\n\n    testGetter := hello.GetAttrString(\"Test\")\n    if testGetter == nil {\n        log.Fatalf(\"could not retrieve 'hello.Test'\")\n    }\n\n    gostr := \"here is a test\"\n    pystr := python.PyString_FromString(gostr)\n    test := python.PyInstance_New(testGetter, pystr, nil)\n    if test == nil {\n                 // log fail at here\n        log.Fatalf(\"could not retrieve 'test'\")\n    }\n}\n</code></pre>\n\n<p>Is the way I called function is wrong? How could I get a new instance from python? Thanks.</p>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 369690, "user_id": 182668, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b19917aa04a6839aef577f1117c71d48?s=128&d=identicon&r=PG", "display_name": "Pointy", "link": "https://stackoverflow.com/users/182668/pointy"}, "edited": false, "score": 3, "creation_date": 1559091994, "post_id": 56351808, "comment_id": 99308424, "body": "Your Go code runs on the server, right? JavaScript runs in client browsers."}, {"owner": {"reputation": 47, "user_id": 11014311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e596192d63f93c52903885f7ed238f54?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/11014311/james"}, "reply_to_user": {"reputation": 369690, "user_id": 182668, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b19917aa04a6839aef577f1117c71d48?s=128&d=identicon&r=PG", "display_name": "Pointy", "link": "https://stackoverflow.com/users/182668/pointy"}, "edited": false, "score": 0, "creation_date": 1559093828, "post_id": 56351808, "comment_id": 99308740, "body": "The Go code would run on a server. Surf library might do the trick."}], "answers": [{"tags": [], "owner": {"reputation": 5251, "user_id": 551436, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9f3ca1db737cdb15bbded04d021da48a?s=128&d=identicon&r=PG", "display_name": "arthurakay", "link": "https://stackoverflow.com/users/551436/arthurakay"}, "is_accepted": true, "score": 1, "last_activity_date": 1559092590, "creation_date": 1559092590, "answer_id": 56351872, "question_id": 56351808, "link": "https://stackoverflow.com/questions/56351808/how-to-access-website-specific-javascript-objects-in-go/56351872#56351872", "title": "How to access website-specific Javascript objects in Go?", "body": "<p>I think what you're really looking for is a \"headless browser\" written or consumable by Go -- here's a <a href=\"https://www.reddit.com/r/golang/comments/4joexu/does_anyone_know_a_good_headless_browser_for_go/\" rel=\"nofollow noreferrer\">Reddit thread</a> with some possibilities.</p>\n\n<p>Effectively you're asking to <code>curl</code> a website and parse the runtime variables out of it -- but <code>curl</code> doesn't actually render the response, which is why you'd need a headless browser of some sort to render the output and then interact with the page in a sandbox environment.</p>\n"}], "owner": {"reputation": 47, "user_id": 11014311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e596192d63f93c52903885f7ed238f54?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/11014311/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "closed_date": 1559111716, "accepted_answer_id": 56351872, "answer_count": 1, "score": 1, "last_activity_date": 1559092590, "creation_date": 1559091772, "question_id": 56351808, "link": "https://stackoverflow.com/questions/56351808/how-to-access-website-specific-javascript-objects-in-go", "closed_reason": "Needs more focus", "title": "How to access website-specific Javascript objects in Go?", "body": "<p>I'm building a logging tool for websites in Golang, and was wondering if its possible to query Javascript objects from my Go program. For example, when I open up Developer Tools in Chrome, and type a specific variable in the console, the variable's value is outputted. </p>\n\n<p>I'd like to develop a Go script that can query a variable's value for a given website, and print that value to the machine's command line.</p>\n\n<p>I've tried googling my question in multiple phrasings, but haven't found any relevant information. I'm not even sure if its even possible in any language.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 440, "user_id": 6047557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f95e6e714cdc9f1c7d1df1d9398cad0e?s=128&d=identicon&r=PG&f=1", "display_name": "perennial_noob", "link": "https://stackoverflow.com/users/6047557/perennial-noob"}, "edited": false, "score": 1, "creation_date": 1559084476, "post_id": 56350257, "comment_id": 99307069, "body": "Have you already tried json Marshal/Unmarshal? Are you tied to a particular file format for serialization?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559141738, "post_id": 56350257, "comment_id": 99330029, "body": "There is nothing in stdlib that will do this for you automagically. You&#39;ll need to retain some mapping of identifiers to values and do custom marshal/unmarshal."}], "answers": [{"comments": [{"owner": {"reputation": 2031, "user_id": 565272, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/W9Q8S.jpg?s=128&g=1", "display_name": "Drewes", "link": "https://stackoverflow.com/users/565272/drewes"}, "edited": false, "score": 0, "creation_date": 1559198464, "post_id": 56354137, "comment_id": 99347676, "body": "I have tried this, but the pointers are not restored. Before: A-&gt;B&lt;-C After: A-&gt;B1, C-&gt;B2 I end up with the same values not the pointer do not point to the same object."}], "tags": [], "owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "is_accepted": false, "score": -1, "last_activity_date": 1559110388, "creation_date": 1559110388, "answer_id": 56354137, "question_id": 56350257, "link": "https://stackoverflow.com/questions/56350257/serialization-of-struct-with-pointers/56354137#56354137", "title": "Serialization of struct with pointers", "body": "<p>Use <code>encoding/json</code> package</p>\n\n<p>to marshal:</p>\n\n<pre><code>// Marshal is a function that marshals the object into an\n// io.Reader.\n// By default, it uses the JSON marshaller.\nvar Marshal = func(v interface{}) (io.Reader, error) {\n  b, err := json.MarshalIndent(v, \"\", \"\\t\")\n  if err != nil {\n    return nil, err\n  }\n  return bytes.NewReader(b), nil\n}\n</code></pre>\n\n<p>to unmarshal:</p>\n\n<pre><code>// Unmarshal is a function that unmarshals the data from the\n// reader into the specified value.\n// By default, it uses the JSON unmarshaller.\nvar Unmarshal = func(r io.Reader, v interface{}) error {\n  return json.NewDecoder(r).Decode(v)\n}\n</code></pre>\n\n<p>Not sure there's more to this,</p>\n\n<p>Another thing you can do is, store all these as json formatted strings. </p>\n"}, {"tags": [], "owner": {"reputation": 2031, "user_id": 565272, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/W9Q8S.jpg?s=128&g=1", "display_name": "Drewes", "link": "https://stackoverflow.com/users/565272/drewes"}, "is_accepted": true, "score": 0, "last_activity_date": 1560259098, "last_edit_date": 1560259098, "creation_date": 1559675329, "answer_id": 56449940, "question_id": 56350257, "link": "https://stackoverflow.com/questions/56350257/serialization-of-struct-with-pointers/56449940#56449940", "title": "Serialization of struct with pointers", "body": "<p>It can be done using the following method:</p>\n\n<ol>\n<li>All the objects are placed in maps in a State object.</li>\n<li>When the objects in a State object is marshalled, all objects refered to using pointers is replaced with the memory location of the object.</li>\n<li>When unmarshalled pointers are restored using a global list of previously read objects.</li>\n</ol>\n\n<p>The code will run, and is just to illustrate the method, I'm new to Go, so bear with me.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\ntype User struct {\n    Name  string\n    Email string\n}\ntype JsonUser struct {\n    ID    string `json:\"id\"`\n    Name  string `json:\"name\"`\n    Email string `json:\"email\"`\n}\n\nfunc (u *User) Print(level int) {\n    ident := strings.Repeat(\"-\", level)\n    log.Println(ident, \"Username:\", u.Name, u.Email)\n}\nfunc (u *User) Id() string {\n    return fmt.Sprintf(\"%p\", u)\n}\nfunc (u *User) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;JsonUser{\n        ID:    u.Id(),\n        Name:  u.Name,\n        Email: u.Email,\n    })\n}\nfunc (u *User) UnmarshalJSON(data []byte) error {\n    aux := &amp;JsonUser{}\n    if err := json.Unmarshal(data, &amp;aux); err != nil {\n        return err\n    }\n    u.Name = aux.Name\n    u.Email = aux.Email\n    load_helper[aux.ID] = u\n    log.Println(\"Added user with id \", aux.ID, u.Name)\n    return nil\n}\n\ntype Record struct {\n    Type     string // MX / A / CNAME / TXT / REDIR / SVR\n    Name     string // @ / www\n    Host     string // IP / address\n    Priority int    // Used for MX\n    Port     int    // Used for SVR\n}\ntype JsonRecord struct {\n    ID       string\n    Type     string\n    Name     string\n    Host     string\n    Priority int\n    Port     int\n}\n\nfunc (r *Record) Print(level int) {\n    ident := strings.Repeat(\"-\", level)\n    log.Println(ident, \"\", r.Type, r.Name, r.Host)\n}\nfunc (r *Record) Id() string {\n    return fmt.Sprintf(\"%p\", r)\n}\nfunc (r *Record) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;JsonRecord{\n        ID:       r.Id(),\n        Name:     r.Name,\n        Type:     r.Type,\n        Host:     r.Host,\n        Priority: r.Priority,\n        Port:     r.Port,\n    })\n}\nfunc (r *Record) UnmarshalJSON(data []byte) error {\n    aux := &amp;JsonRecord{}\n    if err := json.Unmarshal(data, &amp;aux); err != nil {\n        return err\n    }\n    r.Name = aux.Name\n    r.Type = aux.Type\n    r.Host = aux.Host\n    r.Priority = aux.Priority\n    r.Port = aux.Port\n    load_helper[aux.ID] = r\n    log.Println(\"Added record with id \", aux.ID, r.Name)\n    return nil\n}\n\ntype Domain struct {\n    Name    string\n    User    *User     // User ID\n    Records []*Record // Record ID's\n}\ntype JsonDomain struct {\n    ID      string   `json:\"id\"`\n    Name    string   `json:\"name\"`\n    User    string   `json:\"user\"`\n    Records []string `json:\"records\"`\n}\n\nfunc (d *Domain) Print(level int) {\n    ident := strings.Repeat(\"-\", level)\n    log.Println(ident, \"Domain:\", d.Name)\n    d.User.Print(level + 1)\n    log.Println(ident, \" Records:\")\n    for _, r := range d.Records {\n        r.Print(level + 2)\n    }\n}\nfunc (d *Domain) Id() string {\n    return fmt.Sprintf(\"%p\", d)\n}\nfunc (d *Domain) MarshalJSON() ([]byte, error) {\n    var record_ids []string\n    for _, r := range d.Records {\n        record_ids = append(record_ids, r.Id())\n    }\n    return json.Marshal(JsonDomain{\n        ID:      d.Id(),\n        Name:    d.Name,\n        User:    d.User.Id(),\n        Records: record_ids,\n    })\n}\nfunc (d *Domain) UnmarshalJSON(data []byte) error {\n    log.Println(\"UnmarshalJSON domain\")\n    aux := &amp;JsonDomain{}\n    if err := json.Unmarshal(data, &amp;aux); err != nil {\n        return err\n    }\n    d.Name = aux.Name\n    d.User = load_helper[aux.User].(*User) // restore pointer to domains user\n    for _, record_id := range aux.Records {\n        d.Records = append(d.Records, load_helper[record_id].(*Record))\n    }\n    return nil\n}\n\ntype State struct {\n    Users   map[string]*User\n    Records map[string]*Record\n    Domains map[string]*Domain\n}\n\nfunc NewState() *State {\n    s := &amp;State{}\n    s.Users = make(map[string]*User)\n    s.Domains = make(map[string]*Domain)\n    s.Records = make(map[string]*Record)\n    return s\n}\nfunc (s *State) Print() {\n    log.Println(\"State:\")\n    log.Println(\"Users:\")\n    for _, u := range s.Users {\n        u.Print(1)\n    }\n    log.Println(\"Domains:\")\n    for _, d := range s.Domains {\n        d.Print(1)\n    }\n}\nfunc (s *State) NewUser(name string, email string) *User {\n    u := &amp;User{Name: name, Email: email}\n    id := fmt.Sprintf(\"%p\", u)\n    s.Users[id] = u\n    return u\n}\nfunc (s *State) NewDomain(user *User, name string) *Domain {\n    d := &amp;Domain{Name: name, User: user}\n    s.Domains[d.Id()] = d\n    return d\n}\nfunc (s *State) NewMxRecord(d *Domain, rtype string, name string, host string, priority int) *Record {\n    r := &amp;Record{Type: rtype, Name: name, Host: host, Priority: priority}\n    d.Records = append(d.Records, r)\n    s.Records[r.Id()] = r\n    return r\n}\nfunc (s *State) FindDomain(name string) (*Domain, error) {\n    for _, v := range s.Domains {\n        if v.Name == name {\n            return v, nil\n        }\n    }\n    return nil, errors.New(\"Not found\")\n}\nfunc Save(s *State) (string, error) {\n    b, err := json.MarshalIndent(s, \"\", \"    \")\n    if err == nil {\n        return string(b), nil\n    } else {\n        log.Println(err)\n        return \"\", err\n    }\n}\n\nvar load_helper map[string]interface{}\n\nfunc Load(s *State, blob string) {\n    load_helper = make(map[string]interface{})\n    if err := json.Unmarshal([]byte(blob), s); err != nil {\n        log.Println(err)\n    } else {\n        log.Println(\"OK\")\n    }\n}\n\nfunc test_state() {\n\n    s := NewState()\n    u := s.NewUser(\"Ownername\", \"some@email.com\")\n    d := s.NewDomain(u, \"somedomain.com\")\n    s.NewMxRecord(d, \"MX\", \"@\", \"192.168.1.1\", 10)\n    s.NewMxRecord(d, \"A\", \"www\", \"192.168.1.1\", 0)\n\n    s.Print()\n\n    x, _ := Save(s) // Saved to json string\n\n    log.Println(\"State saved, the json string is:\")\n    log.Println(x)\n\n    s2 := NewState() // Create a new empty State\n    Load(s2, x)\n    s2.Print()\n\n    d, err := s2.FindDomain(\"somedomain.com\")\n    if err == nil {\n        d.User.Name = \"Changed\"\n    } else {\n        log.Println(\"Error:\", err)\n    }\n    s2.Print()\n}\n\nfunc main() {\n    test_state()\n}\n</code></pre>\n\n<p>This is quite a lot of code and there are to much coupling between the objects and the serialization. Also the global var load_helper is bad. Ideas to improve will be appreciated.</p>\n\n<p>Another approch would be to use reflection to make a more generic solution. Here is an example using this method:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n    \"reflect\"\n)\n\nfunc pprint(x interface{}) {\n    b, err := json.MarshalIndent(x, \"\", \"  \")\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    fmt.Println(string(b))  \n}\n\n\nvar typeRegistry = make(map[string]reflect.Type)\n\n// Register a type to make it possible for the Save/Load functions\n// to serialize it.\nfunc Register(v interface{}) {\n    t := reflect.TypeOf(v)\n    n := t.Name()\n    fmt.Println(\"Register type\",n)\n    typeRegistry[n] = reflect.TypeOf(v)\n}\n\n// Make an instance of a type from the string name of the type.\nfunc makeInstance(name string) reflect.Value {\n    v := reflect.New(typeRegistry[name]).Elem()\n    return v\n}\n\n// Translate a string type name tpo a real type.\nfunc getTypeFromString(name string) reflect.Type {\n    return typeRegistry[name]\n}\n\n\n// Serializeable interface must be supported by all objects passed to the Load / Save functions.\ntype Serializeable interface {\n    Id() string\n}\n\n// GenericSave saves the object d\nfunc GenericSave(d interface{}) (string, error) {\n    r := make(map[string]interface{})\n    v := reflect.ValueOf(d)\n    t := reflect.TypeOf(d)\n    if t.Kind()==reflect.Ptr {\n        t=t.Elem()\n        v=v.Elem()\n    }\n    r[\"_TYPE\"]=t.Name()\n    r[\"_ID\"]=fmt.Sprintf(\"%p\", d)\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        name := f.Name\n        vf := v.FieldByName(name)\n//      fmt.Println(\"Field\", i+1, \"name is\", name, \"type is\", f.Type.Name(), \"and kind is\", f.Type.Kind())      \n//      fmt.Println(\"V:\", vf)\n        if f.Tag != \"\" {\n            store:=strings.Split(f.Tag.Get(\"store\"),\",\")\n            switch store[1] {\n            case \"v\":\n                switch t.Field(i).Type.Name() {\n                case \"string\":\n                    r[store[0]]=vf.String()\n                case \"int\":\n                    r[store[0]]=vf.Int()\n                }\n            case \"p\":\n                vals:=vf.MethodByName(\"Id\").Call([]reflect.Value{})\n                r[store[0]]=vals[0].String()\n            case \"lp\":\n                tr:=[]string{}\n                for j := 0; j &lt; vf.Len(); j++ {\n                    vals:=vf.Index(j).MethodByName(\"Id\").Call([]reflect.Value{})\n                    tr=append(tr,vals[0].String())\n                }\n                r[store[0]]=tr\n            }\n        }\n    }   \n    m,_:=json.Marshal(r)\n    return string(m),nil\n}\n\n// Save saves the list of objects.\nfunc Save(objects []Serializeable) []byte {\n    lst:=[]string{}\n    for _,o := range(objects) {\n        os,_:= GenericSave(o) // o.Save()\n        lst=append(lst,os)\n    }\n    m,_:=json.Marshal(lst)\n    return m\n}\n\n\nfunc toStructPtr(obj interface{}) interface{} {\n    vp := reflect.New(reflect.TypeOf(obj))\n    vp.Elem().Set(reflect.ValueOf(obj))\n    return vp.Interface()\n}\n\n// Load creates a list of serializeable objects from json blob\nfunc Load(blob []byte) []Serializeable {\n    objects := []Serializeable{}\n    loadHelper := make(map[string]interface{})\n    var olist []interface{}\n    if err := json.Unmarshal(blob, &amp;olist); err != nil {\n        log.Println(err)\n    } else {\n        for _,o := range(olist) {\n\n            var omap map[string]interface{}\n            json.Unmarshal([]byte(o.(string)), &amp;omap)\n\n            t:= getTypeFromString(omap[\"_TYPE\"].(string))\n            obj := reflect.New(t).Elem() \n\n            for i := 0; i &lt; t.NumField(); i++ {\n//              n:=t.Field(i).Name\n//              fmt.Println(i,n,t.Field(i).Type.Name())\n\n                if t.Field(i).Tag != \"\" {\n                    store:=strings.Split(t.Field(i).Tag.Get(\"store\"),\",\")\n//                  fmt.Println(store)\n                    switch store[1] {\n                    case \"v\":\n                        switch t.Field(i).Type.Name() {\n                        case \"string\":\n                            obj.FieldByIndex([]int{i}).SetString(omap[store[0]].(string))\n                        case \"int\":\n                            obj.FieldByIndex([]int{i}).SetInt(int64(omap[store[0]].(float64)))\n                        }\n                    case \"p\":\n                        nObj:=loadHelper[omap[store[0]].(string)]\n                        obj.FieldByIndex([]int{i}).Set(reflect.ValueOf(nObj.(*User)))\n                    case \"lp\":\n                        ptrItemType:=t.Field(i).Type.Elem()\n                        slice := reflect.Zero(reflect.SliceOf(  ptrItemType /* reflect.TypeOf( &amp;Record{} ) */  ))//.Interface()\n                        for _, pID := range(omap[store[0]].([]interface{})) {\n                            nObj:=loadHelper[pID.(string)]\n                            slice=reflect.Append(slice,  reflect.ValueOf(nObj)  )\n                        }\n                        obj.FieldByIndex([]int{i}).Set(slice)                       \n                    }\n                }\n            }\n            oi:=toStructPtr(obj.Interface())\n            oip:=oi.(Serializeable)\n            objects=append(objects,oip)\n            loadHelper[omap[\"_ID\"].(string)]=oip\n        }\n    }\n    return objects\n\n}\n\n\n\n/* Application data structures */\n\ntype User struct {\n    Name  string `store:\"name,v\"`\n    Email string `store:\"email,v\"`\n}\nfunc (u *User) Id() string {\n    return fmt.Sprintf(\"%p\", u)\n}\nfunc (u *User) Save() (string, error) {\n    return GenericSave(u)\n}\nfunc (u *User) Print() {\n    fmt.Println(\"User:\",u.Name)\n}\n\n\ntype Record struct {\n    Type     string `store:\"type,v\"`// MX / A / CNAME / TXT / REDIR / SVR\n    Name     string `store:\"name,v\"`// @ / www\n    Host     string `store:\"host,v\"`// IP / address\n    Priority int    `store:\"priority,v\"`// Used for MX\n    Port     int    `store:\"port,v\"`// Used for SVR\n}\nfunc (r *Record) Id() string {\n    return fmt.Sprintf(\"%p\", r)\n}\nfunc (r *Record) Save() (string, error) {\n    return GenericSave(r)\n}\nfunc (r *Record) Print() {\n    fmt.Println(\"Record:\",r.Type,r.Name,r.Host)\n}\n\n\ntype Domain struct {\n    Name    string    `store:\"name,v\"`\n    User    *User     `store:\"user,p\"`    // User ID\n    Records []*Record `store:\"record,lp\"` // Record ID's\n}\nfunc (d *Domain) Id() string {\n    return fmt.Sprintf(\"%p\", d)\n}\nfunc (d *Domain) Save() (string, error) {\n    return GenericSave(d)\n}\nfunc (d *Domain) Print() {\n    fmt.Println(\"Domain:\",d.Name)\n    d.User.Print()\n    fmt.Println(\"Records:\")\n    for _, r := range d.Records {\n        r.Print()\n    }\n}\n\n\ntype DBM struct {\n    Domains []*Domain\n    Users []*User\n    Records []*Record\n}\nfunc (dbm *DBM) AddDomain(d *Domain) {\n    dbm.Domains=append(dbm.Domains,d)\n}\nfunc (dbm *DBM) AddUser(u *User) {\n    dbm.Users=append(dbm.Users,u)\n}\nfunc (dbm *DBM) AddRecord(r *Record) {\n    dbm.Records=append(dbm.Records,r)\n}\nfunc (dbm *DBM) GetObjects() []Serializeable {\n    objects:=[]Serializeable{}\n    for _,r := range(dbm.Records) {\n        objects=append(objects, r)\n    }\n    for _,u := range(dbm.Users) {\n        objects=append(objects, u)\n    }\n    for _,d := range(dbm.Domains) {\n        objects=append(objects, d)\n    }\n    return objects\n}\nfunc (dbm *DBM) SetObjects(objects []Serializeable) {\n    for _,o := range(objects) {\n        switch o.(type) {\n        case *Record:\n            fmt.Println(\"record\")\n            dbm.AddRecord(o.(*Record))\n        case *User:\n            fmt.Println(\"record\")\n            dbm.AddUser(o.(*User))\n        case *Domain:\n            fmt.Println(\"record\")\n            dbm.AddDomain(o.(*Domain))\n        }\n    }\n}\n\n\nfunc testState() {\n\n    Register(User{})\n    Register(Domain{})\n    Register(Record{})\n\n    dbm:=DBM{}\n\n    u := &amp;User{Name: \"Martin\", Email: \"some@email.com\"}\n    dbm.AddUser(u)\n\n    r1 := &amp;Record{Name: \"@\", Type: \"MX\", Host: \"mail.ishost.dk\"}\n    r2 := &amp;Record{Name: \"@\", Type: \"MX\", Host: \"mail.infoserv.dk\"}\n    dbm.AddRecord(r1)\n    dbm.AddRecord(r2)\n\n    d := &amp;Domain{User:u, Name: \"Martin\", Records: []*Record{r1, r2}}\n    dbm.AddDomain(d)\n\n    x:=Save(dbm.GetObjects())\n\n    fmt.Println(\"== Saved objects\")\n//  fmt.Println(string(x))\n\n    fmt.Println(\"== Loading\")\n\n    dbm2:=DBM{}\n    dbm2.SetObjects(Load(x))\n\n\n    u2:=dbm2.Users[0]\n    u2.Print()\n    u2.Name=\"KURT\"\n    u2.Print()\n\n    d2:=dbm2.Domains[0]\n    d2.Print()\n    d2.User.Name=\"ZIG\"\n    u2.Print()\n\n}\n\nfunc main() {\n    testState()\n}\n\n</code></pre>\n"}], "owner": {"reputation": 2031, "user_id": 565272, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/W9Q8S.jpg?s=128&g=1", "display_name": "Drewes", "link": "https://stackoverflow.com/users/565272/drewes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 818, "favorite_count": 0, "accepted_answer_id": 56449940, "answer_count": 2, "score": -1, "last_activity_date": 1560259098, "creation_date": 1559078775, "last_edit_date": 1559287772, "question_id": 56350257, "link": "https://stackoverflow.com/questions/56350257/serialization-of-struct-with-pointers", "title": "Serialization of struct with pointers", "body": "<p>Having a struct heirarchy like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type DomainStore struct {\n    Domains []*Domain\n    Users []*User\n}\n\ntype Domain struct {\n    Name    string\n    Records []*Record\n    Owner   *User\n}\n\ntype User struct {\n    Name      string\n    Email     string\n    Domains []*Domain\n}\n\ntype Record struct {\n    Name      string\n    Host      string\n}\n</code></pre>\n\n<p>With a single DomainStore having a list of Domain and Users with pointer between Domain and User.</p>\n\n<p>I'm looking for a way to serialize/deserialize to/from file. I have been trying to use gob, but the pointers is not (by design) serialized correct (its flattened).</p>\n\n<p>Thinking about giving each object a unique id and making a func to serialize/deserialize each type, but it seems much work/boilerplate. Any suggestions for a strategy?</p>\n\n<p>I would like to keep the whole DomainStore in memory, and just serialize to file on user request.</p>\n\n<p><strong>The main problem: How to serialise/deserialize and keep the pointers pointing to the same object and not different copies of the same object</strong></p>\n\n<p>Both gob and json seems to \"just\" copy the value of the object and afted deserializasion I end up with multiple independent copies of objects.</p>\n\n<p>Using gob ang json this is what happens:</p>\n\n<p>Before, A &amp; C both points to B:</p>\n\n<pre><code>A -&gt; B &lt;- C\n</code></pre>\n\n<p>After deserialization with json/gob:</p>\n\n<pre><code>A -&gt; B1 , C -&gt; B2\n</code></pre>\n\n<p>A &amp; C points to to different object, with the same values. But, if i change B1 it's not changed in B2.</p>\n\n<p>--- Update ---</p>\n\n<p>When marshalling i can obtain the memory location of the object and use it as an ID:</p>\n\n<pre><code>func (u *User) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;JsonUser{\n        ID:       fmt.Sprintf(\"%p\", u),\n        Name:     u.Name,\n        Email:    u.Email,\n    })\n}\n</code></pre>\n\n<p>And when marshalling the Domain I can replace the </p>\n\n<pre><code>func (d *Domain) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;struct {\n        ID       string `json:\"id\"`\n        Name     string `json:\"name\"`\n        User     string `json:\"user\"`\n    }{\n        ID:       fmt.Sprintf(\"%p\", d),\n        Name:     d.Name,\n        User:     fmt.Sprintf(\"%p\", d.User),\n    })\n}\n</code></pre>\n\n<p>Now I <em>just</em> need to be able to unmarshal this which gives me a problem in the UnmarshalJSON need to access a map of id's and their respective objects.</p>\n\n<pre><code>func (u *User) UnmarshalJSON(data []byte) error {\n  // need acces to a map shared by all UnmarshalJSON functions\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1559073116, "post_id": 56349068, "comment_id": 99303271, "body": "&quot;when the main goroutine returns&quot; there can be no leak, because the entire process exits."}, {"owner": {"reputation": 194, "user_id": 7025284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wIxhm.png?s=128&g=1", "display_name": "pikatao", "link": "https://stackoverflow.com/users/7025284/pikatao"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559077297, "post_id": 56349068, "comment_id": 99304954, "body": "thanks for your answer. I want to know if there is goroutine leak if the main goroutine does not terminate. I should have expressed it clearly, my bad :) @Adrian"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 4, "last_activity_date": 1559074073, "last_edit_date": 1559074073, "creation_date": 1559073691, "answer_id": 56349329, "question_id": 56349068, "link": "https://stackoverflow.com/questions/56349068/will-this-code-with-unbuffered-channel-cause-goroutine-leak-in-go/56349329#56349329", "title": "Will this code with unbuffered channel cause goroutine leak in Go?", "body": "<p>The problem with your code is twofold.</p>\n\n<p>First, there <em>is,</em> theoretically, a goroutine leak since any attempt to send a value to a channel with zero capacity (an unbuffered channel or a filled up buffered channel) blocks the sending goroutine until a receive operation is done on that channel.</p>\n\n<p>So, yes, by definition of how channels work, all your three goroutines will be blocked in the <code>numChan &lt;- num</code> statement.</p>\n\n<p>Second, since some revision of Go, an unhandled <code>panic</code> by default dumps only the stack trace of the panicking goroutine.\nIf you wish to dump the stacks of all the active goroutines, you'd have to tweak the runtime \u2014 from the <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">documentation of the package <code>runtime</code></a>:</p>\n\n<blockquote>\n  <p>The <code>GOTRACEBACK</code> variable controls the amount of output generated when a Go program fails due to an unrecovered panic or an unexpected runtime condition. By default, a failure prints a stack trace for the current goroutine, eliding functions internal to the run-time system, and then exits with exit code 2. The failure prints stack traces for all goroutines if there is no current goroutine or the failure is internal to the run-time. <code>GOTRACEBACK=none</code> omits the goroutine stack traces entirely. <code>GOTRACEBACK=single</code> (the default) behaves as described above. <code>GOTRACEBACK=all</code> adds stack traces for all user-created goroutines. <code>GOTRACEBACK=system</code> is like \u201call\u201d but adds stack frames for run-time functions and shows goroutines created internally by the run-time. <code>GOTRACEBACK=crash</code> is like \u201csystem\u201d but crashes in an operating system-specific manner instead of exiting. For example, on Unix systems, the crash raises <code>SIGABRT</code> to trigger a core dump. For historical reasons, the <code>GOTRACEBACK</code> settings 0, 1, and 2 are synonyms for none, all, and system, respectively. <code>The runtime/debug</code> package's <code>SetTraceback</code> function allows increasing the amount of output at run time, but it cannot reduce the amount below that specified by the environment variable. See <a href=\"https://golang.org/pkg/runtime/debug/#SetTraceback\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/debug/#SetTraceback</a>.</p>\n</blockquote>\n\n<hr>\n\n<p>Also note that <em>you must not <strong>ever</strong> use timers for (simulating) synchronization:</em> in a toy example this might work but in real life nothing prevents your three goroutines from not having a chance to be run during the time span your main goroutine spent in the call to <code>time.Sleep</code> \u2014 so the outcome might be that any number of spawned goroutines had run: from 0 to 3.</p>\n\n<p>Add there the fact that when <code>main</code> exits the runtime merely kills all the outstanding active goroutines, and the result of the test might be surprising at best.</p>\n\n<p>Hence a proper solution would be to</p>\n\n<ul>\n<li>Merely print the stacks where needed,</li>\n<li>Make sure you synchronize the sends by the matching receives:</li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"runtime\"\n)\n\nfunc dumpStacks() {\n    buf := make([]byte, 32 * 1024)\n    n := runtime.Stack(buf, true)\n    log.Println(string(buf[:n]))\n}\n\nfunc main() {\n    numCount := 3\n    numChan := make(chan int, numCount)\n\n    for i := 0; i &lt; numCount; i++ {\n        go func(num int) {\n            fmt.Printf(\"Adding num: %d to chan\\n\", num)\n            numChan &lt;- num\n            fmt.Printf(\"Adding num: %d to chan Done\\n\", num)\n        }(i)\n    }\n\n    dumpStacks()\n\n    for i := 0; i &lt; numCount; i++ {\n        &lt;-numChan\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tk9JdtCUTj7\" rel=\"nofollow noreferrer\">Playground</a>.</p>\n"}], "owner": {"reputation": 194, "user_id": 7025284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wIxhm.png?s=128&g=1", "display_name": "pikatao", "link": "https://stackoverflow.com/users/7025284/pikatao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 56349329, "answer_count": 1, "score": -1, "last_activity_date": 1559074073, "creation_date": 1559072541, "question_id": 56349068, "link": "https://stackoverflow.com/questions/56349068/will-this-code-with-unbuffered-channel-cause-goroutine-leak-in-go", "title": "Will this code with unbuffered channel cause goroutine leak in Go?", "body": "<p>I'm writing some golang concurrency codes with goroutines and channels, suspecting that my code may cause goroutine leaks. My situation is similar to the following code, or you can open this <a href=\"https://play.golang.org/p/tTlOzjAHmiy\" rel=\"nofollow noreferrer\">go playground link</a>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    numCount := 3\n    numChan := make(chan int)\n\n    for i := 0; i &lt; numCount; i++ {\n        go func(num int) {\n            fmt.Printf(\"Adding num: %d to chan\\n\", num)\n            numChan &lt;- num\n            fmt.Printf(\"Adding num: %d to chan Done\\n\", num)\n        }(i)\n    }\n\n    time.Sleep(time.Second)\n    panic(\"Goroutine Resource Leak Test\")\n} \n</code></pre>\n\n<p>In my opinion, when the main goroutine returns, three goroutines are blocked sending to the unbuffered channel and there will be goroutine leak. This post <a href=\"https://stackoverflow.com/questions/46141353/goroutine-leak-with-buffered-channel-in-go\">goroutine leak with buffered channel in Go</a> also suggests that <code>So only if the channel was unbuffered the leak would occur</code>. </p>\n\n<p><em>The Go Programming Language</em> suggests that: </p>\n\n<blockquote>\n  <p>There\u2019s a handy trick we can use during testing: if instead of returning from main in the event of cancellation, we execute a call to panic, then the runtime will dump the stack of every goroutine in the program. If the main goroutine is the only one left, then it has cleaned up after itself. But if other goroutines remain, they may not have been properly canceled, or perhaps they have been canceled but the cancellation takes time; a little investigation may be worthwhile. The panic dump often contains suf\ufb01cient information to distinguish these cases.</p>\n</blockquote>\n\n<p>Therefore, I added <code>panic(\"Goroutine Resource Leak Test\")</code> to the end of the main function to verify my assumption. However, the panic dump only contains main goroutine, that is, there is no resource leak.</p>\n\n<pre><code>Adding num: 0 to chan\nAdding num: 1 to chan\nAdding num: 2 to chan\npanic: Goroutine Resource Leak Test\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox011109649/prog.go:21 +0xc0\n</code></pre>\n\n<p>Can someone help explain</p>\n\n<ul>\n<li>why there is no goroutine leak, or</li>\n<li>how should I get the correct panic dump if there is leak</li>\n</ul>\n\n<p>Any suggestion will be appreciated, thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1559072948, "post_id": 56348923, "comment_id": 99303188, "body": "No, it doesn&#39;t. <code>exec</code> runs external executables, so whatever you want to run has to be an external executable. A function in your program can&#39;t be run after your program exits, by definition."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559075832, "post_id": 56348923, "comment_id": 99304323, "body": "&quot;When that function invocation [main] returns, the program exits. It does not wait for other (non-main) goroutines to complete.&quot; <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Program_execution</a>"}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "edited": false, "score": 0, "creation_date": 1559076912, "post_id": 56348923, "comment_id": 99304766, "body": "I understand that. My question is how to transform a goroutine into a full fledged process. It seems like a mechanism that should exist."}, {"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1559110800, "post_id": 56348923, "comment_id": 99312650, "body": "go routines are not meant to be processes."}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1559112774, "post_id": 56348923, "comment_id": 99313508, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28370646/how-do-i-fork-a-go-process\">How do I fork a go process?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "edited": false, "score": 0, "creation_date": 1559135472, "post_id": 56354363, "comment_id": 99326169, "body": "Thanks for the answer but this is already accomplished by the first block of code in my question that calls <code>cmd.Start()</code>. What I want is to execute the code in <code>playsound</code> without having to have create a separate executable called <code>playsound</code> in the first place."}, {"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "reply_to_user": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "edited": false, "score": 0, "creation_date": 1559163421, "post_id": 56354363, "comment_id": 99339637, "body": "Down vote and leave a comment why. I hope its not you @ChrisRedford"}], "tags": [], "owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "is_accepted": false, "score": 0, "last_activity_date": 1559163450, "last_edit_date": 1559163450, "creation_date": 1559111445, "answer_id": 56354363, "question_id": 56348923, "link": "https://stackoverflow.com/questions/56348923/detach-goroutine-into-independent-process/56354363#56354363", "title": "Detach Goroutine into Independent Process", "body": "<blockquote>\n  <p>GO routines are not meant to be processes</p>\n</blockquote>\n\n<p><a href=\"https://www.maketecheasier.com/run-bash-commands-background-linux/\" rel=\"nofollow noreferrer\">This</a> might work. I have done this myself, But you might be restricted to bash shell.</p>\n\n<pre><code>cmd := exec.Command(\"bash\", \"-c\", \"playsound\", \"&amp;\")\n</code></pre>\n"}], "owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 303, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559180670, "creation_date": 1559071825, "last_edit_date": 1559180670, "question_id": 56348923, "link": "https://stackoverflow.com/questions/56348923/detach-goroutine-into-independent-process", "title": "Detach Goroutine into Independent Process", "body": "<p>I have a function that plays a sound that I want to continue executing after my <code>main</code> program prints to standard output and exits. My reasoning is that I want the sound to finish playing after the program has exited but I don't want the <code>main</code> program to wait for the sound to finish playing before it exits.</p>\n\n<p>I found a method for executing the sound in an independent process by turning it into an executable named <code>playsound</code> and doing <code>go install</code>. Then in my main program, I call this at the end of <code>main()</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func startPlaySound() {\n    cmd := exec.Command(\"playsound\")\n    cmd.Start()\n}\n\nmain() {\n   // code that prints and exits\n\n   startPlaySound()\n}\n</code></pre>\n\n<p>This works but I would like to be able to play the sound after the main program exits without creating an executable file. I would rather run the equivalent of <code>cmd.Start()</code> on the function containing the code to play the sound.</p>\n\n<p>In other words, I would like it to look something like this:</p>\n\n<pre><code>func playSound() {\n    // code that plays the sound\n}\n\nfunc startPlaySound() {\n   cmd := CmdFromFunction(playSound)\n   cmd.Start()\n}\n\nmain() {\n   // code that prints and exits\n\n   startPlaySound()\n}\n</code></pre>\n\n<p>Does something like <code>CmdFromFunction</code> exist?</p>\n\n<h1>Response to Question Feedback</h1>\n\n<ul>\n<li>This is not a duplicate of <a href=\"https://stackoverflow.com/questions/28370646/how-do-i-fork-a-go-process\">How do I fork a go process?</a>. I am not trying to fork the <code>main</code> goroutine. I am trying to detach <code>playSound</code> into a separate process that will continue executing after the <code>main</code> goroutine exits. Both of the answers to that question involve executing an external program, which is exactly what I am trying to avoid.</li>\n<li>\"go routines are not meant to be processes\" - I literally turned the code from <code>playSound</code> into an executable called <code>playsound</code> and am now executing it as a process using <code>cmd.Start()</code>. I'm just trying to find a more direct route for doing that than creating an entirely separate executable file.</li>\n</ul>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 0, "creation_date": 1559069578, "post_id": 56348376, "comment_id": 99301842, "body": "Also note that xmlName is <code>XMLName</code>"}], "tags": [], "owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "is_accepted": true, "score": 3, "last_activity_date": 1559069458, "last_edit_date": 1559069458, "creation_date": 1559069137, "answer_id": 56348376, "question_id": 56348296, "link": "https://stackoverflow.com/questions/56348296/xml-marshal-ignore-struct-if-its-empty/56348376#56348376", "title": "xml.Marshal ignore struct if it&#39;s empty", "body": "<p>You have a few syntax errors but you can set child as a pointer:</p>\n\n<pre><code>type Parent struct {\n    XMLName xml.Name `xml:\"parent\"`\n    Name    string   `xml:\"name,omitempty\"`\n    Age     int64    `xml:\"age,omitempty\"`\n    Child   *Child    `xml:\"child,omitempty\"`\n}\n</code></pre>\n\n<p>When it's nil, it will be empty.</p>\n\n<p><a href=\"https://play.golang.org/p/pAEDVj7lUxw\" rel=\"nofollow noreferrer\">Working Demo</a></p>\n"}], "owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21, "favorite_count": 0, "accepted_answer_id": 56348376, "answer_count": 1, "score": 0, "last_activity_date": 1559069738, "creation_date": 1559068795, "last_edit_date": 1559069738, "question_id": 56348296, "link": "https://stackoverflow.com/questions/56348296/xml-marshal-ignore-struct-if-its-empty", "title": "xml.Marshal ignore struct if it&#39;s empty", "body": "<p>I need to output an XML file, and I've constructed a few structs that represent it As a basic example, say this:</p>\n\n<pre><code>type Parent struct {\n    XMLName xml.Name `xml:\"parent\"`\n    Name    string   `xml:\"name,omitempty\"`\n    Age     int64    `xml:\"age,omitempty\"`\n    Child   Child    `xml:\"child,omitempty`\n}\n\ntype Child struct {\n    XMLName  xml.Name `xml:\"child,omitempty\"`\n    Name     string   `xml:\"name,omitempty\"`\n    Gender   string   `xml:\"gender,omitempty\"`\n    Thoughts string   `xml:\",innerxml,omitempty\"`\n}\n</code></pre>\n\n<p>I expect that when I create a <code>Parent</code> without defining the child, and then marshal it into an XML file...</p>\n\n<pre><code>parent := Parent{\n    Name: \"Beatrice\",\n    Age: \"23\",\n}\n_ = xml.MarshalIndent(parent, \"\", \"    \")\n</code></pre>\n\n<p>...that I should get an XML file not containing a <code>child</code> tag:</p>\n\n<pre><code>&lt;parent&gt;\n    &lt;name&gt;Beatrice&lt;/name&gt;\n    &lt;age&gt;23&lt;/age&gt;\n&lt;/parent&gt;\n</code></pre>\n\n<p>Instead, I get this:</p>\n\n<pre><code>&lt;parent&gt;\n    &lt;name&gt;Beatrice&lt;/name&gt;\n    &lt;age&gt;23&lt;/age&gt;\n    &lt;child&gt;&lt;/child&gt;\n&lt;/parent&gt;\n</code></pre>\n\n<p>Why is the empty <code>&lt;child&gt;&lt;/child&gt;</code> tag there, and how can I get rid of it?</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": true, "score": 1, "last_activity_date": 1559068484, "creation_date": 1559068484, "answer_id": 56348218, "question_id": 56348035, "link": "https://stackoverflow.com/questions/56348035/how-to-generate-hyperlinks-in-table-using-go-template/56348218#56348218", "title": "How to generate hyperlinks in table using go template", "body": "<p>There exist especially for html an <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">html-template</a> which uses <a href=\"https://golang.org/pkg/html/template/#HTML\" rel=\"nofollow noreferrer\">type html</a>:</p>\n\n<blockquote>\n  <p>HTML encapsulates a known safe HTML document fragment.</p>\n</blockquote>\n\n<p>That means:</p>\n\n<blockquote>\n  <p>Based on the information I learned from go website, looks like I need to define another template embedded into this one. Suppose it's to replace {{ .Logs }} here. </p>\n</blockquote>\n\n<p>Instead of using string, use type html in your struct.</p>\n"}], "owner": {"reputation": 3, "user_id": 5473530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96d7bb7fcad59abef80dc13a2e9657e?s=128&d=identicon&r=PG&f=1", "display_name": "Tao W", "link": "https://stackoverflow.com/users/5473530/tao-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 56348218, "answer_count": 1, "score": 0, "last_activity_date": 1559111129, "creation_date": 1559067712, "last_edit_date": 1559111129, "question_id": 56348035, "link": "https://stackoverflow.com/questions/56348035/how-to-generate-hyperlinks-in-table-using-go-template", "title": "How to generate hyperlinks in table using go template", "body": "<p>I want to generate an html table which includes some hyperlink strings in one table cell.\ne.g,</p>\n\n<pre><code>&lt;a href=\"http://logd/logs/2800643/\"&gt;2800643&lt;/a&gt; \n&lt;a href=\"http://logd/logs/2800795/\"&gt;2800795&lt;/a&gt; \n&lt;a href=\"http://logd/logs/2801109/\"&gt;2801109&lt;/a&gt; \n</code></pre>\n\n<p>I've defined one template which can handle the table very well except this hyperlink thing.</p>\n\n<pre><code>{{ range . }}\n&lt;tr&gt;\n&lt;td&gt;{{ .Name }}&lt;/td&gt;\n&lt;td&gt;{{ .Logs }}&lt;/td&gt;\n&lt;/tr&gt;\n{{ end }}\n</code></pre>\n\n<p>Here I want to have Logs to be hyperlinked.\nIf I pass a formatted string into Logs here, <code>&lt;</code> <code>&gt;</code> will be parsed like below:</p>\n\n<pre><code>&amp;lt;a href=&amp;#34;http://logd/logs/2801103/&amp;#34;&amp;gt;2801103&amp;lt;/a&amp;gt\n</code></pre>\n\n<p>Based on the information I learned from go website, looks like I need to define another template embedded into this one.\nSuppose it's to replace <code>{{ .Logs }}</code> here. Like:</p>\n\n<pre><code>{{ range . }}\n&lt;a href=\"http://logd/logs/{{.LogID}}/\"&gt;{{.LogID}}&lt;/a&gt;\n{{ end }}\n</code></pre>\n\n<p>Wonder is there any example available ? Thanks</p>\n"}, {"tags": ["go", "integer-overflow"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1559057713, "post_id": 56345629, "comment_id": 99296242, "body": "No, as you&#39;ve proven yourself, it does not. Numbers are truncated at the boundary of the data type they&#39;re stored in."}], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "edited": false, "score": 0, "creation_date": 1559058733, "post_id": 56345772, "comment_id": 99296803, "body": "Thanks for the explanation! Really appreciate that!"}, {"owner": {"reputation": 847, "user_id": 5580553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54ef1b5ab609a00c87909b5187cbca3f?s=128&d=identicon&r=PG&f=1", "display_name": "Fynn Becker", "link": "https://stackoverflow.com/users/5580553/fynn-becker"}, "edited": false, "score": 0, "creation_date": 1559132003, "post_id": 56345772, "comment_id": 99324015, "body": "Might be worth noting that overflowing is perfectly fine in Rust as well if you compile for release rather than debug. There is <a href=\"https://doc.rust-lang.org/std/primitive.u64.html#method.checked_mul\" rel=\"nofollow noreferrer\"><code>u64::checked_mul()</code></a> if that is not desired."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1559060074, "last_edit_date": 1559060074, "creation_date": 1559058163, "answer_id": 56345772, "question_id": 56345629, "link": "https://stackoverflow.com/questions/56345629/is-it-expected-behavior-that-go-allows-overflow-for-arithmetic-operations-instea/56345772#56345772", "title": "Is it expected behavior that Go allows overflow for arithmetic operations instead of throwing an exception?", "body": "<p><a href=\"https://golang.org/ref/spec#Integer_overflow\" rel=\"noreferrer\">Spec: Integer overflow:</a></p>\n\n<blockquote>\n  <p>For unsigned integer values, the operations +, -, *, and &lt;&lt; are computed modulo 2<sup>n</sup>, where <em>n</em> is the bit width of the <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"noreferrer\">unsigned integer</a>'s type. Loosely speaking, <strong>these unsigned integer operations discard high bits upon overflow, and programs may rely on \"wrap around\"</strong>.</p>\n  \n  <p>For signed integers, the operations +, -, *, /, and &lt;&lt; may legally overflow and the resulting value exists and is deterministically defined by the signed integer representation, the operation, and its operands. <strong>Overflow does not cause a <a href=\"https://golang.org/ref/spec#Run_time_panics\" rel=\"noreferrer\">run-time panic</a>.</strong> A compiler may not optimize code under the assumption that overflow does not occur. For instance, it may not assume that <code>x &lt; x + 1</code> is always true.</p>\n</blockquote>\n\n<p>As quoted above, overflow exists and it does not cause a run-time panic.</p>\n\n<p>But care must be taken, as if you have a <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"noreferrer\">constant expressions</a>, since they have arbitrary precision, if the result is to be converted to a fixed precision where it does not fit into the target type's valid range, it results in a compile time-error.</p>\n\n<p>For example:</p>\n\n<pre><code>const maxuint64 = 0xffffffffffffffff\nvar key uint64 = maxuint64 * maxuint64\n\nfmt.Println(key)\n</code></pre>\n\n<p>The above yields:</p>\n\n<pre><code>constant 340282366920938463426481119284349108225 overflows uint64\n</code></pre>\n\n<p><code>maxuint64 * maxuint64</code> is a constant expression which is properly calculated (its value is <code>340282366920938463426481119284349108225</code>), but when this value is to be assigned to the <code>key</code> variable of type <code>uint64</code>, it results in a compile-time error because this value cannot be represented by a value of type <code>uint64</code>. But this is not a run-time panic.</p>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/34704843/golang-on-purpose-int-overflow/34704898#34704898\">Golang: on-purpose int overflow</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does Go compiler&#39;s evaluation differ for constant expression and other expression</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/54477761/how-to-store-a-big-float64-in-a-string-without-overflow/54477914#54477914\">How to store a big float64 in a string without overflow?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/48023473/proper-way-for-casting-uint16-to-int16-in-go/48023533#48023533\">Proper way for casting uint16 to int16 in Go</a></p>\n"}], "owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 900, "favorite_count": 0, "accepted_answer_id": 56345772, "answer_count": 1, "score": -3, "last_activity_date": 1559062738, "creation_date": 1559057643, "last_edit_date": 1559062738, "question_id": 56345629, "link": "https://stackoverflow.com/questions/56345629/is-it-expected-behavior-that-go-allows-overflow-for-arithmetic-operations-instea", "title": "Is it expected behavior that Go allows overflow for arithmetic operations instead of throwing an exception?", "body": "<p>I am porting some Go code to Rust and I realized that Rust panics when overflow occurs during multiplication while Go allows the overflow to happen.</p>\n\n<p>Test code below, that does not cause overflow but print reduced value. \n(tested via: <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a>)</p>\n\n<pre><code>func main() {\n    fmt.Println(\"test\\n\")\n    var key uint64 = 15000;\n\n    key = key*2862933555777941757 + 1\n\n    fmt.Println(key)\n}\n</code></pre>\n"}, {"tags": ["go", "gdb", "delve"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1559055699, "post_id": 56344734, "comment_id": 99295058, "body": "why dont you do a memory profile? it is buildin in go"}, {"owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 1, "creation_date": 1559056599, "post_id": 56344734, "comment_id": 99295584, "body": "@Pizzalord Unfortunately we didn&#39;t expose pprof endpoint on production, so we only can depend on core dump for post-mortem analysis.."}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "edited": false, "score": 0, "creation_date": 1593513070, "post_id": 62652773, "comment_id": 110801480, "body": "Very cool tool! but do you know why I get a bunch of &quot;unk&quot; objects when running &quot;histogram&quot;? for example: &quot;unk1152&quot;, &quot;unk704&quot;, &quot;unk288&quot;, etc. Please advise if there is some way to interpret these objects. update: seems like these refer to &quot;unknown&quot;, wondering if there is any way to increase the &quot;readability&quot; of these objects"}, {"owner": {"reputation": 387, "user_id": 6180078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9605fffd06e82ea65e77fb749c981819?s=128&d=identicon&r=PG", "display_name": "Aleksandr Karasev", "link": "https://stackoverflow.com/users/6180078/aleksandr-karasev"}, "reply_to_user": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "edited": false, "score": 0, "creation_date": 1593515878, "post_id": 62652773, "comment_id": 110802809, "body": "Yes, &quot;unk1152&quot; means unknown type &amp; 1152 means size of the instance. Unfortunately, I don&#39;t know how one can improve &quot;type detection&quot; in this particular case("}, {"owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "edited": false, "score": 1, "creation_date": 1593518932, "post_id": 62652773, "comment_id": 110804320, "body": "I figured out some workaround for this, I use <code>objects</code> command to list all live objects, get the address of one of the &quot;unk&quot; type, and then do <code>reachable &lt;address&gt;</code>. It is able to print some file location. Might need to run this several times on different addresses to confirm the finding, time consuming, but it works )"}, {"owner": {"reputation": 387, "user_id": 6180078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9605fffd06e82ea65e77fb749c981819?s=128&d=identicon&r=PG", "display_name": "Aleksandr Karasev", "link": "https://stackoverflow.com/users/6180078/aleksandr-karasev"}, "reply_to_user": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "edited": false, "score": 0, "creation_date": 1593520111, "post_id": 62652773, "comment_id": 110804960, "body": "nice, would be keep this mind the next time. Thanks for sharing!"}], "tags": [], "owner": {"reputation": 387, "user_id": 6180078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9605fffd06e82ea65e77fb749c981819?s=128&d=identicon&r=PG", "display_name": "Aleksandr Karasev", "link": "https://stackoverflow.com/users/6180078/aleksandr-karasev"}, "is_accepted": false, "score": 1, "last_activity_date": 1593503801, "creation_date": 1593503801, "answer_id": 62652773, "question_id": 56344734, "link": "https://stackoverflow.com/questions/56344734/how-to-inspect-memory-region-of-a-core-dump-with-delve/62652773#62652773", "title": "How to inspect memory region of a core dump with Delve?", "body": "<p>Last time I came across the similar problem, I found this little package <a href=\"https://github.com/golang/debug\" rel=\"nofollow noreferrer\">https://github.com/golang/debug</a>. It allows to get a histogram of a heap &amp; inspect how many object of a specific type you had right before the crash.</p>\n<p>Unfortunately, it doesn't work out of the box and you have to apply a couple of fixes which you find on the Pull Requests page</p>\n"}], "owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1593503801, "creation_date": 1559054637, "question_id": 56344734, "link": "https://stackoverflow.com/questions/56344734/how-to-inspect-memory-region-of-a-core-dump-with-delve", "title": "How to inspect memory region of a core dump with Delve?", "body": "<p>Given a core dump of a Go service, is there any command on Delve that can inspect memory region?\nWe are trying to find out what is occupying the heap.</p>\n"}, {"tags": ["go", "environment-variables"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 9, "creation_date": 1559053546, "post_id": 56344384, "comment_id": 99293794, "body": "You can benchmark this and find out. My prediction: it&#39;s fast enough to not care."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 3, "creation_date": 1559053774, "post_id": 56344384, "comment_id": 99293908, "body": "Why do you repeatedly read it if it doesn&#39;t change?"}, {"owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "edited": false, "score": 7, "creation_date": 1559053802, "post_id": 56344384, "comment_id": 99293920, "body": "read it before the loop?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1559053855, "post_id": 56344384, "comment_id": 99293948, "body": "<code>But to my understanding we should avoid package level variables.</code>: Why? If you need a package level variable, then use one. From your example, you also obviously have the choice to scope it outside the loop, so why look it up every time?"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1559054027, "post_id": 56344384, "comment_id": 99294046, "body": "@JimB Concurrency is not an issue here, but it does limit testing ability"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "edited": false, "score": 0, "creation_date": 1559054215, "post_id": 56344384, "comment_id": 99294141, "body": "@ServeLaurijssen It&#39;s possible and and is easy in the simplified example I&#39;ve given, but it will add complexity to the actual code I&#39;m working on so I&#39;m looking for ways around it"}], "answers": [{"tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 9, "last_activity_date": 1559054014, "creation_date": 1559054014, "answer_id": 56344544, "question_id": 56344384, "link": "https://stackoverflow.com/questions/56344384/how-expensive-is-os-getenv/56344544#56344544", "title": "How expensive is os.Getenv?", "body": "<p>You can benchmark os.Getenv and see how fast it is. </p>\n\n<p>By looking at its implementation <a href=\"https://golang.org/src/syscall/env_unix.go?s=1612:1662#L61\" rel=\"noreferrer\">here</a>, it costs:</p>\n\n<ol>\n<li>A read-lock;</li>\n<li>Lookup in global map;</li>\n<li>Linear search of char '='. </li>\n</ol>\n"}], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 0, "accepted_answer_id": 56344544, "answer_count": 1, "score": -3, "last_activity_date": 1559055677, "creation_date": 1559053470, "last_edit_date": 1559055677, "question_id": 56344384, "link": "https://stackoverflow.com/questions/56344384/how-expensive-is-os-getenv", "title": "How expensive is os.Getenv?", "body": "<p>I have a piece of code that's called every few seconds and makes use of an environment variable:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for {\n    myVar := os.Getenv(\"MY_VAR\")\n    //Do something\n    time.Sleep(3 * time.Second)\n}\n</code></pre>\n\n<p>But how costly are repeat calls to <code>os.Getenv</code>?</p>\n\n<p>The value of the environment variable will not change during runtime, so I could set it as a package level variable:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package blah\n\nvar myVar = os.Getenv(\"MY_VAR\")\n</code></pre>\n\n<p>But this does hurt testability of the code.</p>\n\n<p>Should I set it as a package level variable? Or is <code>os.Getenv</code> benign enough?</p>\n\n<p><strong>EDIT:</strong>\nI've benchmarked the call to <code>os.Getenv</code> but is it reliable?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main_test\n\nimport (\n    \"os\"\n    \"testing\"\n)\n\nvar result string\n\nfunc BenchmarkEnv(b *testing.B) {\n    var r string\n    for n := 0; n &lt; b.N; n++ {\n        r = os.Getenv(\"PATH\")\n    }\n    result = r\n}\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>goos: darwin\ngoarch: amd64\nBenchmarkEnv-8      20000000            78.7 ns/op\nPASS\n</code></pre>\n"}, {"tags": ["go", "concurrency", "synchronization", "channels"], "answers": [{"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1559051695, "creation_date": 1559051695, "answer_id": 56343836, "question_id": 56343626, "link": "https://stackoverflow.com/questions/56343626/go-synchronization-and-concurrency-model/56343836#56343836", "title": "Go synchronization and concurrency model", "body": "<blockquote>\n  <p>But how can be the message 6 and 13 be output their reception prior than their actual sending?</p>\n</blockquote>\n\n<p>We only know <code>fmt.Println(\"received job\", j)</code> was printed before <code>fmt.Println(\"sent job\", j)</code> was printed, and this is plausible in concurrent working code. </p>\n\n<blockquote>\n  <p>How can be 7 messages sent in a row, if the channel size is 5?</p>\n</blockquote>\n\n<p>Again, because we dont know exactly which statement prints out first, this can be expected. The Queue can already be reduced and we still are printing.</p>\n"}, {"comments": [{"owner": {"reputation": 427, "user_id": 6394524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b4d6c492444053f622b78d47b46f0c?s=128&d=identicon&r=PG&f=1", "display_name": "pacorrop", "link": "https://stackoverflow.com/users/6394524/pacorrop"}, "edited": false, "score": 0, "creation_date": 1559051960, "post_id": 56343869, "comment_id": 99292830, "body": "The bit about &quot;fmt.Print APIs are buffered&quot; is what I missed. Thank you very much"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559052452, "post_id": 56343869, "comment_id": 99293112, "body": "The fmt.Print functions do write to the output when they are called.  The functions use a buffer for constructing the output, but that buffer is written to stdout before the function returns."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1559053442, "post_id": 56343869, "comment_id": 99293721, "body": "@CeriseLim&#243;n, correct. The Go stdlib does not buffer to os.Stdout, but the OS probably does. I should have said it better."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559054588, "post_id": 56343869, "comment_id": 99294359, "body": "Buffering has nothing to do with the output order observed by OP.  Regarding comment about other languages: Go is different from most other languages in that the Go fmt functions never buffer output written directly to stdout."}], "tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 2, "last_activity_date": 1559051811, "creation_date": 1559051811, "answer_id": 56343869, "question_id": 56343626, "link": "https://stackoverflow.com/questions/56343626/go-synchronization-and-concurrency-model/56343869#56343869", "title": "Go synchronization and concurrency model", "body": "<p>Goroutines run concurrently, therefore they also print to stdout concurrently (i.e. out-of-order). Moreover, fmt.Print APIs are buffered, so your prints are not actually prited immediately as they are called. This happens also in other languages. </p>\n\n<p>This is why you cannot derive the real concurrent execution of goroutines from the messages in stdout. </p>\n"}], "owner": {"reputation": 427, "user_id": 6394524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b4d6c492444053f622b78d47b46f0c?s=128&d=identicon&r=PG&f=1", "display_name": "pacorrop", "link": "https://stackoverflow.com/users/6394524/pacorrop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56343869, "answer_count": 2, "score": 0, "last_activity_date": 1559051822, "creation_date": 1559051035, "last_edit_date": 1559051822, "question_id": 56343626, "link": "https://stackoverflow.com/questions/56343626/go-synchronization-and-concurrency-model", "title": "Go synchronization and concurrency model", "body": "<p>I'm a new Go learner, and I'm following <a href=\"https://gobyexample.com\" rel=\"nofollow noreferrer\">gobyexample.com</a> to learn the basics. When I reach the \"closing channels\" section, the tutorial inserts this code snippet (I'll remove original comments):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n\n    import \"fmt\"\n\n    func main() {\n        jobs := make(chan int, 5)\n        done := make(chan bool)\n\n       go func() {\n           for {\n               j, more := &lt;-jobs\n               if more {\n                   fmt.Println(\"received job\", j)\n               } else {\n                   fmt.Println(\"received all jobs\")\n                   done &lt;- true\n                   return\n               }\n           }\n       }()\n\n       for j := 1; j &lt;= 18; j++ {\n           jobs &lt;- j\n           fmt.Println(\"sent job\", j)\n       }\n       close(jobs)\n       fmt.Println(\"sent all jobs\")\n\n       &lt;-done\n    }\n</code></pre>\n\n<p>The original code was setting a 3 instead of a 18 in the job sender loop.</p>\n\n<p>Executing this code in <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a> it is what I don't fully understand. It always outputs the following:</p>\n\n<pre><code>sent job 1\nsent job 2\nsent job 3\nsent job 4\nsent job 5\nreceived job 1\nreceived job 2\nreceived job 3\nreceived job 4\nreceived job 5\nreceived job 6\nsent job 6\nsent job 7\nsent job 8\nsent job 9\nsent job 10\nsent job 11\nsent job 12\nreceived job 7\nreceived job 8\nreceived job 9\nreceived job 10\nreceived job 11\nreceived job 12\nreceived job 13\nsent job 13\nsent job 14\nsent job 15\nsent job 16\nsent job 17\nsent job 18\nsent all jobs\nreceived job 14\nreceived job 15\nreceived job 16\nreceived job 17\nreceived job 18\nreceived all jobs\n</code></pre>\n\n<p>So I understand that the \"queue\" of a channel (I'm aware this terminology is not the most accurate, but for the purpose of learning myself it is what I understand about what a channel is) is of size 5 so the first 10 log messages are fine for me.</p>\n\n<p>But how can be the message 6 and 13 be output their reception prior than their actual sending? How can be 7 messages sent in a row, if the channel size is 5? What am I missing from this?</p>\n"}, {"tags": ["go", "logging", "microservices", "trace"], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 9812635, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Parvesh ", "link": "https://stackoverflow.com/users/9812635/parvesh"}, "edited": false, "score": 0, "creation_date": 1559812384, "post_id": 56350207, "comment_id": 99539189, "body": "so we can pass the context and use it , there is not way to implement it in AOP way."}, {"owner": {"reputation": 173, "user_id": 7558625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a47b54fb92e3fda8ff9ba238147857a?s=128&d=identicon&r=PG&f=1", "display_name": "tomilchik", "link": "https://stackoverflow.com/users/7558625/tomilchik"}, "edited": false, "score": 0, "creation_date": 1570303300, "post_id": 56350207, "comment_id": 102873488, "body": "I do precisely the #1, up to the syntax itself :) log.Log(ctx).Info(...). Passing context in all methods on the path of request execution: yes again; took some time to get used to method signatures always including extra thing, but now it\u2019s automatic. I also tied my impl of MDC into this."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 1, "last_activity_date": 1559078428, "creation_date": 1559078428, "answer_id": 56350207, "question_id": 56343599, "link": "https://stackoverflow.com/questions/56343599/how-to-add-trace-id-to-each-logs-in-go-micro-service/56350207#56350207", "title": "How to add trace id to each logs in go micro service", "body": "<p>It might be worth reading up on <code>context.Context</code> particularly <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">this article</a> which has a section that says:</p>\n\n<blockquote>\n  <p>At Google, we require that Go programmers pass a Context parameter as the first argument to every function on the call path between incoming and outgoing requests. </p>\n</blockquote>\n\n<p>TL;DR - it's fine to pass the context, but what's the best way?</p>\n\n<p>There's two main patterns</p>\n\n<ol>\n<li>Ask the context to give you a logger</li>\n<li>Give the logger the context</li>\n</ol>\n\n<p>Context can be used to store values:</p>\n\n<pre><code>context.WithValue(ctx, someKey, someValue)\n</code></pre>\n\n<p>This means we can either do:</p>\n\n<pre><code>somepackage.Log(ctx).Info(\"hello world\")\n// or\nsompackage.Info(ctx, \"hello world\")\n</code></pre>\n\n<p>The implementation of these two sample APIs could interact with the context to retrieve the values required with out needing to worry about the extra information that would have been in MDC at any of the logging call sites. </p>\n"}], "owner": {"reputation": 78, "user_id": 9812635, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Parvesh ", "link": "https://stackoverflow.com/users/9812635/parvesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2017, "favorite_count": 0, "accepted_answer_id": 56350207, "answer_count": 1, "score": 3, "last_activity_date": 1559078428, "creation_date": 1559050928, "last_edit_date": 1559078059, "question_id": 56343599, "link": "https://stackoverflow.com/questions/56343599/how-to-add-trace-id-to-each-logs-in-go-micro-service", "title": "How to add trace id to each logs in go micro service", "body": "<p>I wanted to add trace id to logging done for each request to the micro service.I want this in similar as for springboot application we can set trace id in MDC and fetch it and use it while logging. </p>\n\n<p>I have done some research and I found that MDC equivalent in go lang is context. So, I have set the trace id in my context. Now the problem is where ever I have to log with trace id ,I need to pass context to that function which is very ugly way. I am looking for a better solution for this problem.</p>\n\n<pre><code>func HandlerFunction(f gin.HandlerFunc) gin.HandlerFunc{\n\u00a0\u00a0\u00a0\u00a0return func(cxt *gin.Context) {\n        reqraceId := cxt.Request.Header.Get(\"trace-id\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0requid , _ := uuid.NewRandom()\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if reqTraceId == \"\" {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c.Request.Header.Set(\"trace-id\", requid.String())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0f(c)\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>\n"}, {"tags": ["sorting", "dictionary", "go", "model", "reverse"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1559048667, "post_id": 56342903, "comment_id": 99290828, "body": "Are you trying to sort a map? Asking because maps in Go cannot be sorted. Or are you trying to store the contents of a map in a slice in a specific order?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1559048987, "post_id": 56342903, "comment_id": 99291000, "body": "Your first example collects the keys and sorts them. What is the problem exactly?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559049120, "post_id": 56342903, "comment_id": 99291096, "body": "<i>How can you use a map and send it to a model and ensure that you have the most recent items listed first on the web page?</i> You cannot, not with a map. You can move the contents of a map into a slice and sort that slice using the <code>sort</code> package and pass the result to your model. Also see: <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Map_types</a> <i>A map is an <b>unordered</b> group of elements of one type, ...</i> and <a href=\"https://blog.golang.org/go-maps-in-action#TOC_7\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action#TOC_7</a>."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559049373, "post_id": 56342903, "comment_id": 99291259, "body": "&quot;<i>How can you use a map and send it to a model and ensure that you have the most recent items listed first on the web page?</i>&quot;  The part &#39;most recent&#39; makes me think that you could use a min-heap instead of a map. Take a look here to see how use a min-heap: <a href=\"https://golang.org/pkg/container/heap/\" rel=\"nofollow noreferrer\">golang.org/pkg/container/heap</a>."}], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 2, "last_activity_date": 1559049940, "last_edit_date": 1559049940, "creation_date": 1559049025, "answer_id": 56343046, "question_id": 56342903, "link": "https://stackoverflow.com/questions/56342903/how-to-reverse-sort-a-map-and-send-it-to-model-in-go-lang/56343046#56343046", "title": "How to reverse sort a map and send it to model in go lang", "body": "<p>maps in go are always returned in a random order unless you use a key to access a value. so you can not reverse the order of a map because there is no order in the first place</p>\n"}, {"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": false, "score": -1, "last_activity_date": 1559052316, "last_edit_date": 1559052316, "creation_date": 1559051127, "answer_id": 56343660, "question_id": 56342903, "link": "https://stackoverflow.com/questions/56342903/how-to-reverse-sort-a-map-and-send-it-to-model-in-go-lang/56343660#56343660", "title": "How to reverse sort a map and send it to model in go lang", "body": "<p>While you cant sort maps directly, you can wrap each key value pair in a new struct and sort this structarray. It just needs to implement the sort interface, like stated <a href=\"https://golang.org/pkg/sort/#Sort\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Example: </p>\n\n<pre><code>type structSorter []mystruct\nfunc (a structSorter) Len() int           { return len(a) }\nfunc (a structSorter) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a structSorter) Less(i, j int) bool { return a[i].MyValue &lt; a.[j].MyValue }\n</code></pre>\n\n<p>and called with</p>\n\n<pre><code>sort.Sort(structSorter(mystructArray))\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 10015590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62d954de8d2a2474b3a409f082fed0e0?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/10015590/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1559052316, "creation_date": 1559048489, "question_id": 56342903, "link": "https://stackoverflow.com/questions/56342903/how-to-reverse-sort-a-map-and-send-it-to-model-in-go-lang", "title": "How to reverse sort a map and send it to model in go lang", "body": "<p>I want to send a reverse order of a list of books that are stored in a map and send this to a model instead of the map in its current order.</p>\n\n<p>I need to display a list in reverse order of date entered which is pubDate so that the webpage (model) displays the most recently added books instead of the books added first.  </p>\n\n<p>I have tried many various sort methods listed but I do not know how I would send this to the model.  For example, I tried \nimport \"sort\"</p>\n\n<pre><code>var m map[int]string\nvar keys []int\nfor k := range m {\n    keys = append(keys, k)\n}\nsort.Ints(keys)\nfor _, k := range keys {\n    fmt.Println(\"Key:\", k, \"Value:\", m[k])\n}\n</code></pre>\n\n<p>I also tried\nsort.Slice(ad, func(i, j int) bool {</p>\n\n<pre><code>    return ad[i].date.Before(ad[j].date)})\n</code></pre>\n\n<p>there are many others but I can not seem to get any working.</p>\n\n<pre><code>type Book struct {\n    ID     int64  `json:\"id\"`\n    Title  string `json:\"title\"`\n    Author string `json:\"author\"`\n    pubDate time.Time `json:\"pubDate\"`\n}\n\nvar bookModels = map[string]*Book{}\n\ns := res.NewService(\"library\")\n\n    // Add handlers for \"library.book.$id\" models\n    s.Handle(\n        \"book.$id\",\n        res.Access(res.AccessGranted),\n        res.GetModel(getBookHandler),\n        res.Set(setBookHandler),\n    )\n\n    // Add handlers for \"library.books\" collection\n    s.Handle(\n        \"books\",\n        res.Access(res.AccessGranted),\n        res.GetCollection(getBooksHandler),\n        res.New(newBookHandler),\n        res.Call(\"delete\", deleteBookHandler),\n    )\n\nfunc getBookHandler(r res.ModelRequest) {\n\n    book := bookModels[r.ResourceName()]\n    if book == nil {\n        r.NotFound()\n        return\n    }\n    r.Model(book)\n}\n</code></pre>\n\n<p>Mainly I get errors that the map does not allow indexing, or the wrong type, or cant access the fields, etc...  How can you use a map and send it to a model and ensure that you have the most recent items listed first on the web page?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 11331001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/106bw.jpg?s=128&g=1", "display_name": "SachsA", "link": "https://stackoverflow.com/users/11331001/sachsa"}, "is_accepted": false, "score": 0, "last_activity_date": 1559048787, "creation_date": 1559048787, "answer_id": 56342977, "question_id": 56342700, "link": "https://stackoverflow.com/questions/56342700/how-do-i-close-a-sheet-opened-with-golang-lib-excelize/56342977#56342977", "title": "How do I close a sheet opened with golang lib excelize?", "body": "<p>You don't have to close it.\nJust open it, and save it if you need to.</p>\n\n<p><code>myFile, err := excelize.OpenFile(\"./Book1.xlsx\")\n    if err != nil {\n        fmt.Println(err)\n    return\n}\n</code></p>\n\n<p>Then, do what you want.</p>\n\n<p>Finally, just save it with the origin path :</p>\n\n<p><code>err = myFile.Save()\n    if err != nil {\n        fmt.Println(err)\n}</code></p>\n\n<p>Or, an other path :</p>\n\n<p><code>err := myFile.SaveAs(\"./myFolder/Book2.xlsx\")\n    if err != nil {\n        fmt.Println(err)\n}</code></p>\n"}], "owner": {"reputation": 11, "user_id": 1819661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fc7326de20a481616e0c5bed87d7fd9?s=128&d=identicon&r=PG&f=1", "display_name": "rdt89", "link": "https://stackoverflow.com/users/1819661/rdt89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 362, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1559053279, "creation_date": 1559047815, "last_edit_date": 1559053279, "question_id": 56342700, "link": "https://stackoverflow.com/questions/56342700/how-do-i-close-a-sheet-opened-with-golang-lib-excelize", "title": "How do I close a sheet opened with golang lib excelize?", "body": "<p>I followed the repo (<a href=\"https://github.com/360EntSecGroup-Skylar/excelize\" rel=\"nofollow noreferrer\">https://github.com/360EntSecGroup-Skylar/excelize</a>) tutorial to open a file:</p>\n\n<pre><code>f, err := excelize.OpenFile(\"./Book1.xlsx\")\nif err != nil {\n    fmt.Println(err)\n    return\n}enter code here\n</code></pre>\n\n<p>But i couldn't find  a tutorial about closing, something like:</p>\n\n<pre><code>defer f.Close()\n</code></pre>\n\n<p>Is there a way to do that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1559047326, "post_id": 56342396, "comment_id": 99290039, "body": "Make your &quot;getters&quot; and &quot;setters&quot; work on a pointer receiver. Or even better: Stop worrying."}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559047528, "post_id": 56342396, "comment_id": 99290147, "body": "Changing to a pointer receiver won&#39;t change anything. And I worry because I want to write good code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1559047799, "post_id": 56342396, "comment_id": 99290315, "body": "For slices (if that&#39;s what you mean by array) you can use the builtin <code>copy</code> function. For maps using a for loop to create a copy, as you are already doing, is the the way to go. Alternatively wrap your map/slice in a struct that provides only getters for its <i>elements</i>, not the whole value as you&#39;re doing in your example."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1559048211, "post_id": 56342396, "comment_id": 99290556, "body": "&quot;because I want to write good code&quot; you should write good Go code not good Java code."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559048220, "post_id": 56342396, "comment_id": 99290563, "body": "@Volker arguably, getters are best implemented on a value receiver... that said: 100% agree on the good Go code vs Java code comment :P"}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559049258, "post_id": 56342396, "comment_id": 99291193, "body": "@mkopriva Thanks for your response. If there are no other solutions I&#39;ll probably stuck with my current solution because it makes iterating easier."}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559049288, "post_id": 56342396, "comment_id": 99291215, "body": "@Volker So this is why I asked about different approaches at the end of my question. If you have some good ideas I will be grateful if you tell something about them. Answers like &quot;it&#39;s bad because it&#39;s bad&quot; aren&#39;t too helpful :/"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559051010, "post_id": 56342396, "comment_id": 99292280, "body": "Any question tagged oop &amp; go is off to a bad start; Go is not object-oriented."}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559051681, "post_id": 56342396, "comment_id": 99292653, "body": "@Adrian You should read what authors of Go says about this topic. Encapsulation is term from OOP and authors od Go says it is at least partially object oriented so in my opinion OOP tag fits here."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559052383, "post_id": 56342396, "comment_id": 99293070, "body": "I have read a lot of what the Go authors have said about the topic, though without a link I have no idea what you&#39;re referring to specifically. Go is not what most would consider object-oriented. It has no classes, no objects, no inheritance, and no polymorphism outside of interfaces. Typical OOP patterns (such as getters/setters) are unidiomatic in Go. Generally, attempts at OOP in Go lead to frustration and poor quality."}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "edited": false, "score": 0, "creation_date": 1559052876, "post_id": 56342396, "comment_id": 99293370, "body": "I&#39;m referring to the FAQ on the Go official website. You don&#39;t need Java like support in the language to do OOP, you can even write object oriented code in C. There was a great discussion about it on SO: <a href=\"https://stackoverflow.com/questions/351733/can-you-write-object-oriented-code-in-c\" title=\"can you write object oriented code in c\">stackoverflow.com/questions/351733/&hellip;</a>"}, {"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "edited": false, "score": 0, "creation_date": 1559054748, "post_id": 56342396, "comment_id": 99294459, "body": "I got few downvotes I&#39;m not sure what&#39;s wrong with my question. It&#39;s not duplicated and I think it&#39;s common problem for newcomers. I&#39;d be grateful for any feedback that I can learn from to help me improve my questions."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "edited": false, "score": 0, "creation_date": 1559049686, "post_id": 56342988, "comment_id": 99291441, "body": "So maybe it will be better idea to remove all getters and just point in a documentation, that these structures shouldn&#39;t be modified?"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "edited": false, "score": 0, "creation_date": 1559050072, "post_id": 56342988, "comment_id": 99291669, "body": "I think your are right. Getters and setters are not common in Go, AFAIK. So, you can get rid of your getter, unless you have to satisfy an interface with that data structure.  IMHO, documentation is optional."}], "tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 1, "last_activity_date": 1559048826, "creation_date": 1559048826, "answer_id": 56342988, "question_id": 56342396, "link": "https://stackoverflow.com/questions/56342396/should-i-encapsulate-slice-and-maps-in-go-if-so-how-to-do-it/56342988#56342988", "title": "Should I encapsulate slice and maps in Go? If so, how to do it?", "body": "<p>Returning slice or map values is idiomatic Go. The user of your package will know how those data structures work in Go.</p>\n\n<p>In your example, the user of <code>Struct</code> should know that adding a new entry into the returned map would reflect for any other user of the same map. </p>\n\n<pre><code>// Simple getter\ns = Struct{make(map[string]OtherStruct, 0)}\np1 := s.Prop()\nfmt.Println(s) // &amp;{map[]}\np1[\"something\"] = OtherStruct{\"test\"}\nfmt.Println(s) // {map[something:{test}]}\n</code></pre>\n\n<p>You should worry about such things only in case of concurrency. That is, when multiple goroutines are accessing, and possibly changing, the elements inside your slice or map. </p>\n"}], "owner": {"reputation": 67, "user_id": 9240116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f0d5304654d550ee155642794a4d46?s=128&d=identicon&r=PG", "display_name": "MDobak", "link": "https://stackoverflow.com/users/9240116/mdobak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 56342988, "answer_count": 1, "score": -2, "last_activity_date": 1559050980, "creation_date": 1559046795, "last_edit_date": 1559050980, "question_id": 56342396, "link": "https://stackoverflow.com/questions/56342396/should-i-encapsulate-slice-and-maps-in-go-if-so-how-to-do-it", "title": "Should I encapsulate slice and maps in Go? If so, how to do it?", "body": "<p>I want to create a structure which will be accessible in other packages, but I don't want to allow modify this structure. In other languages this is archived by making all fields private and exposing only public getters. </p>\n\n<p>Solution with getters works fine for all data types except slices and maps because returned slices and maps aren't copied by default so they can be modified. The only solution that I managed to figure out is to create new map/slice and assign all items in a loop but this introduce a lot of repetitive and ugly code, especially for large nested structures.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype OtherStruct struct {\n    prop string\n}\n\ntype Struct struct {\n    prop map[string]OtherStruct\n}\n\nfunc (s Struct) Prop() map[string]OtherStruct {\n    return s.prop\n}\n\nfunc (s Struct) Prop2() map[string]*OtherStruct {\n    prop := make(map[string]*OtherStruct, 0)\n    for k := range s.prop {\n        v := s.prop[k]\n        prop[k] = &amp;v\n    }\n\n    return prop\n}\n\nfunc main() {\n    var s Struct;\n\n    // Simple getter\n    s = Struct{make(map[string]OtherStruct, 0)}\n    p1 := s.Prop()\n    fmt.Println(s) // &amp;{map[]}\n    p1[\"something\"] = OtherStruct{\"test\"}\n    fmt.Println(s) // {map[something:{test}]}\n\n    // Getter which copies map\n    s = Struct{make(map[string]OtherStruct, 0)}\n    p2 := s.Prop2()\n    fmt.Println(s) // &amp;{map[]}\n    p2[\"something\"] = &amp;OtherStruct{\"test\"}\n    fmt.Println(s) // &amp;{map[]}\n}\n</code></pre>\n\n<p>Is there any better way to encapsulate slices/maps in Go? Or maybe I shouldn't use encapsulation at all in Go and use different approach?</p>\n"}, {"tags": ["shell", "go", "pipe"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1559040387, "post_id": 56338927, "comment_id": 99286169, "body": "i dont understand how it would work, we have to pipe the first part output to the awk, it is showing error when i do the things you said syntax error: unexpected awk, expecting comma or ) can you please eloberate a little bit more?  invalid character literal (more than one character) @mstruebing"}, {"owner": {"reputation": 1312, "user_id": 4082431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/21eaa3ed4674e22d54aee1cb77108291?s=128&d=identicon&r=PG", "display_name": "mstruebing", "link": "https://stackoverflow.com/users/4082431/mstruebing"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1559040951, "post_id": 56338927, "comment_id": 99286473, "body": "Are you sure <code>i</code> is set?"}, {"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1559049277, "post_id": 56338927, "comment_id": 99291207, "body": "thanks sir, but it overwrites the file, as you have removed the &#39;&gt;&gt;&#39; in the script?"}, {"owner": {"reputation": 1312, "user_id": 4082431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/21eaa3ed4674e22d54aee1cb77108291?s=128&d=identicon&r=PG", "display_name": "mstruebing", "link": "https://stackoverflow.com/users/4082431/mstruebing"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1559052608, "post_id": 56338927, "comment_id": 99293212, "body": "then use <code>tee -a</code> for append."}], "tags": [], "owner": {"reputation": 1312, "user_id": 4082431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/21eaa3ed4674e22d54aee1cb77108291?s=128&d=identicon&r=PG", "display_name": "mstruebing", "link": "https://stackoverflow.com/users/4082431/mstruebing"}, "is_accepted": true, "score": 2, "last_activity_date": 1559052653, "last_edit_date": 1559052653, "creation_date": 1559035364, "answer_id": 56338927, "question_id": 56338860, "link": "https://stackoverflow.com/questions/56338860/read-input-from-command-line-into-the-shell-script-exec-using-golang/56338927#56338927", "title": "Read input from command line into the shell script exec using golang", "body": "<p>You need to format the <code>exec</code>-command string accordingly.</p>\n\n<p>So ie:</p>\n\n<p><code>fmt.Sprintf(\"awk '{print $%d/1024}'\", i)</code></p>\n\n<p>This gives: <code>awk '{print $1/1024}'</code> for <code>i = 1</code> and <code>awk '{print $2/1024}'</code> for <code>i = 2</code></p>\n\n<p><code>fmt.Sprintf</code> takes a format string and the arguments to pass into this string and returns the formatted string. (<a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/#Sprintf</a>)</p>\n\n<p>And this needs to be inserted into your <code>exec</code>-command:</p>\n\n<pre><code>i := 2\nawkPart := fmt.Sprintf(\"awk '{print $%d/1024}'\", i)\nout, err := exec.Command(\"bash\", \"-c\", \"tail -n 1 /var/log/apache2/access.log | \"+awkPart+\" | tee -a mem_usage.csv\").Output()\n</code></pre>\n\n<p>You should maybe try to disassemble your command a bit more for maintainabilty, but that's not part of the question.</p>\n"}], "owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 56338927, "answer_count": 1, "score": -2, "last_activity_date": 1559052653, "creation_date": 1559035181, "last_edit_date": 1559035372, "question_id": 56338860, "link": "https://stackoverflow.com/questions/56338860/read-input-from-command-line-into-the-shell-script-exec-using-golang", "title": "Read input from command line into the shell script exec using golang", "body": "<p>I am using go to run a shell script using exec.command like below and I want to take an input argument using command line say <code>i</code>, and my output should be based on <code>i</code>, how would I do that? </p>\n\n<pre><code>i := os.Args[1:2]\nout, err := exec.Command(\"bash\", \"-c\", \"tail -n 1 /var/log/apache2/access.log | awk '{print $i/1024}' &gt;&gt; mem_usage.csv\").Output()\nif err != nil {\n    fmt.Println(err.Error())\n    return\n }\n</code></pre>\n\n<p>How could I use that i in the shell script? </p>\n\n<p>Without <code>i</code> it works fine i.e if I put <code>$1</code> or <code>$2</code> it works fine but I want user to give me the position of <code>i</code> and then calculate accordingly.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1559033224, "creation_date": 1559033224, "answer_id": 56338308, "question_id": 56338059, "link": "https://stackoverflow.com/questions/56338059/how-to-fix-os-pathseparator-unzipping-files-zipped-on-windows/56338308#56338308", "title": "How to fix os.PathSeparator unzipping files zipped on Windows?", "body": "<p>Did you check out <a href=\"https://unix.stackexchange.com/questions/166159/convert-a-windows-created-zip-to-linux-internal-paths-issue\">convert a windows created zip to Linux internal paths issue</a>? Seems like something gone wrong while creating that zip file.</p>\n\n<p>Or alternatively, from those answers:</p>\n\n<blockquote>\n  <p>Use 7z rn to rename the files within the archive so that they have a forward slash. Then when you extract the archive, directories will be created.</p>\n</blockquote>\n"}], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559033224, "creation_date": 1559032296, "question_id": 56338059, "link": "https://stackoverflow.com/questions/56338059/how-to-fix-os-pathseparator-unzipping-files-zipped-on-windows", "title": "How to fix os.PathSeparator unzipping files zipped on Windows?", "body": "<p>I'm zipping files on Windows and when unzip on Linux, using the os default application, it doesn't create the folders along the path but a single file named \"indexes\\search.invcus\\index_meta.json\" e.g.:</p>\n\n<pre><code>unzip 2019-05-23_113735_data.zip -d xfolder\nArchive:  2019-05-23_113735_data.zip\n  inflating: xfolder/indexes\\search.invcus\\index_meta.json  \n  inflating: xfolder/indexes\\search.invcus\\store  \n  inflating: xfolder/indexes\\search.items\\index_meta.json  \n  inflating: xfolder/indexes\\search.items\\store  \n  inflating: xfolder/indexes\\search.subjects\\index_meta.json  \n  inflating: xfolder/indexes\\search.subjects\\store  \n  inflating: xfolder/indexes\\search.users\\index_meta.json  \n  inflating: xfolder/indexes\\search.users\\store  \n  inflating: xfolder/data.db         \n</code></pre>\n\n<p>I get the correct folders and files only if the zip file is created on Linux and unzipped on Windows using 7zip, etc...</p>\n\n<pre><code>func zipFiles(filename string, files []string) error {\n\n    newZipFile, err := os.Create(filename)\n    if err != nil {\n        return err\n    }\n    defer newZipFile.Close()\n\n    zipWriter := zip.NewWriter(newZipFile)\n    defer zipWriter.Close()\n\n    // Add files to zip\n    for _, file := range files {\n        if err = addFileToZip(zipWriter, file); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n\nfunc addFileToZip(zipWriter *zip.Writer, filename string) error {\n    fileToZip, err := os.Open(filename)\n    if err != nil {\n        return err\n    }\n    defer fileToZip.Close()\n\n    // Get the file information\n    info, err := fileToZip.Stat()\n    if err != nil {\n        return err\n    }\n\n    header, err := zip.FileInfoHeader(info)\n    if err != nil {\n        return err\n    }\n\n    // Using FileInfoHeader() above only uses the basename of the file. If we want\n    // to preserve the folder structure we can overwrite this with the full path.\n    header.Name = filename\n\n    // Change to deflate to gain better compression\n    // see http://golang.org/pkg/archive/zip/#pkg-constants\n    header.Method = zip.Deflate\n\n    writer, err := zipWriter.CreateHeader(header)\n    if err != nil {\n        return err\n    }\n    _, err = io.Copy(writer, fileToZip)\n    return err\n}\n\n</code></pre>\n\n<p>I expect:</p>\n\n<pre><code> indexes (folder)\n     search.invcus (folder)\n         index_meta.json (file)\n\n</code></pre>\n"}, {"tags": ["postgresql", "go", "transactions", "isolation-level", "acid"], "answers": [{"comments": [{"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "reply_to_user": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "edited": false, "score": 1, "creation_date": 1559032001, "post_id": 56337550, "comment_id": 99281545, "body": "I&#39;d expect that to be <code>BEGIN ISOLATION LEVEL SERIALIZABLE</code>, which sets the isolation level right when the transaction is started."}], "tags": [], "owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "is_accepted": true, "score": 2, "last_activity_date": 1559030335, "creation_date": 1559030335, "answer_id": 56337550, "question_id": 56337463, "link": "https://stackoverflow.com/questions/56337463/golang-postgres-repeatable-read-isolation-level-is-not-working/56337550#56337550", "title": "Golang Postgres repeatable read isolation level is not working", "body": "<p>The snapshot of a <code>REPEATABLE READ</code> or <code>SERIALIZABLE</code> transaction is not taken at the time when the transaction is started, but when the first SQL statement runs inside the transaction.</p>\n\n<p>First, this is an optimization for the case that the transaction does not run any statement at all. Second, it is the only way to allow setting the transaction isolation level <em>after</em> the start of the transaction, but <em>before</em> any SQL statement has been run with</p>\n\n<pre><code>SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n</code></pre>\n"}], "owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 620, "favorite_count": 1, "accepted_answer_id": 56337550, "answer_count": 1, "score": 0, "last_activity_date": 1559030974, "creation_date": 1559029983, "last_edit_date": 1559030974, "question_id": 56337463, "link": "https://stackoverflow.com/questions/56337463/golang-postgres-repeatable-read-isolation-level-is-not-working", "title": "Golang Postgres repeatable read isolation level is not working", "body": "<p>My understanding of the <code>REPEATABLE READ</code> transaction isolation level is that once it is set, the data read through in the transaction will not change. I have used the following code to verify this:</p>\n\n<pre><code>ctx = context.Background()\ntx, _ := db.BeginTx(ctx, &amp;sql.TxOptions{Isolation: sql.LevelSerializable}) \ntime.Sleep(5 * time.Second)\n// do query on tx\n</code></pre>\n\n<p>While the process is sleeping,  I have inserted another record through the console. But the newly inserted record has appeared in the results. Why is that so? I don't want to read the records which are inserted after the transaction has begun. I also tried:</p>\n\n<pre><code>tx, _ := db.Begin()\n_, err = tx.Exec(`set transaction isolation level repeatable read;`)\n</code></pre>\n\n<p>But still the results are the same.</p>\n"}, {"tags": ["go", "networking"], "answers": [{"comments": [{"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "edited": false, "score": 0, "creation_date": 1586427335, "post_id": 56336811, "comment_id": 108126055, "body": "Is it possible that in case of error the <code>conn</code> variable will still be differnet from <code>nil</code> ? Just wonder why not to use <code>if.else if</code> statement."}, {"owner": {"reputation": 163, "user_id": 8477074, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-0UgLisIi_jI/AAAAAAAAAAI/AAAAAAAAABI/iuy08Bs0WTs/photo.jpg?sz=128", "display_name": "Rustavil Nurkaev", "link": "https://stackoverflow.com/users/8477074/rustavil-nurkaev"}, "reply_to_user": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "edited": false, "score": 1, "creation_date": 1586697710, "post_id": 56336811, "comment_id": 108217147, "body": "No, it&#39;s not possible. It can be <code>if.else if</code> or only <code>if.else</code>. I think It doesn&#39;t matter"}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 1, "creation_date": 1593250010, "post_id": 56336811, "comment_id": 110717568, "body": "This is not working, at least nowadays, I just put any ports and even if it is closed it still said it is opened. This just ping the server I guess"}], "tags": [], "owner": {"reputation": 163, "user_id": 8477074, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-0UgLisIi_jI/AAAAAAAAAAI/AAAAAAAAABI/iuy08Bs0WTs/photo.jpg?sz=128", "display_name": "Rustavil Nurkaev", "link": "https://stackoverflow.com/users/8477074/rustavil-nurkaev"}, "is_accepted": true, "score": 11, "last_activity_date": 1559027518, "creation_date": 1559027518, "answer_id": 56336811, "question_id": 56336168, "link": "https://stackoverflow.com/questions/56336168/golang-check-tcp-port-open/56336811#56336811", "title": "golang check tcp port open", "body": "<p>To check the port, you can check if the connection was successful. For example:</p>\n\n<pre><code>func raw_connect(host string, ports []string) {\n    for _, port := range ports {\n        timeout := time.Second\n        conn, err := net.DialTimeout(\"tcp\", net.JoinHostPort(host, port), timeout)\n        if err != nil {\n            fmt.Println(\"Connecting error:\", err)\n        }\n        if conn != nil {\n            defer conn.Close()\n            fmt.Println(\"Opened\", net.JoinHostPort(host, port))\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1593250368, "post_id": 59621864, "comment_id": 110717688, "body": "Does it work for UDP as well? I have tried it, but whatever port I put it always tells me it is open."}, {"owner": {"reputation": 422, "user_id": 7327955, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Te8cv.jpg?s=128&g=1", "display_name": "Eds_k", "link": "https://stackoverflow.com/users/7327955/eds-k"}, "reply_to_user": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 1, "creation_date": 1593267352, "post_id": 59621864, "comment_id": 110722348, "body": "Telnet is an application that operates using the TCP protocol. UDP connectivity can not be tested using Telnet."}], "tags": [], "owner": {"reputation": 422, "user_id": 7327955, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Te8cv.jpg?s=128&g=1", "display_name": "Eds_k", "link": "https://stackoverflow.com/users/7327955/eds-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1578368308, "creation_date": 1578368308, "answer_id": 59621864, "question_id": 56336168, "link": "https://stackoverflow.com/questions/56336168/golang-check-tcp-port-open/59621864#59621864", "title": "golang check tcp port open", "body": "<p>Check multiple port examples</p>\n\n<pre><code>func tcpGather(ip string, ports []string) map[string]string {\n    // check emqx 1883, 8083 port\n\n    results := make(map[string]string)\n    for _, port := range ports {\n        address := net.JoinHostPort(ip, port)\n        // 3 second timeout\n        conn, err := net.DialTimeout(\"tcp\", address, 3*time.Second)\n        if err != nil {\n            results[port] = \"failed\"\n            // todo log handler\n        } else {\n            if conn != nil {\n                results[port] = \"success\"\n                _ = conn.Close()\n            } else {\n                results[port] = \"failed\"\n            }\n        }\n    }\n    return results\n}\n</code></pre>\n"}], "owner": {"reputation": 2201, "user_id": 677163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a1d8465997bf40a21eca3975f984fc72?s=128&d=identicon&r=PG", "display_name": "philippe", "link": "https://stackoverflow.com/users/677163/philippe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9013, "favorite_count": 0, "accepted_answer_id": 56336811, "answer_count": 2, "score": 4, "last_activity_date": 1578368308, "creation_date": 1559024850, "question_id": 56336168, "link": "https://stackoverflow.com/questions/56336168/golang-check-tcp-port-open", "title": "golang check tcp port open", "body": "<p>I need to check if remote address has specific TCP ports open or not. \nI have chosen to use golang for this purpose.\nHere is my attempt so far:</p>\n\n<pre><code>func raw_connect(host string, ports []string) {\n  for _, port := range ports {\n     timeout := time.Second\n     conn, err := net.DialTimeout(\"tcp\", host + \":\" + port, timeout)\n     if err != nil {\n        _, err_msg := err.Error()[0], err.Error()[5:]\n        fmt.Println(err_msg)\n     } else {\n        msg, _, err := bufio.NewReader(conn).ReadLine()\n        if err != nil {\n           if err == io.EOF {\n              fmt.Print(host + \" \" + port + \" - Open!\\n\")\n           }\n        } else {\n           fmt.Print(host + \" \" + port + \" - \" + string(msg))\n        }\n        conn.Close()\n     }\n   }\n }\n</code></pre>\n\n<p>This is working just fine for TCP port when application (such as SSH) returns first a string, I read it and print it with no time.</p>\n\n<p>However, when the application above TCP is waiting for command from the client first (such as HTTP), there is a timeout (<code>if err == io.EOF</code> clause).</p>\n\n<p>This timeout is quite long. I would need to know immediately if the port is open or not.</p>\n\n<p>Is there a more suitable technique for this purpose ?</p>\n\n<p>Many thanks!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1559022858, "creation_date": 1559022858, "answer_id": 56335807, "question_id": 56334885, "link": "https://stackoverflow.com/questions/56334885/interface-conversion-of-fields-on-equivalent-structures/56335807#56335807", "title": "Interface conversion of fields on equivalent structures", "body": "<blockquote>\n  <p>Is there a straightforward way to convert a struct where some fields are \"generic\" (interface{}) into another type which has the same field names but is \"strongly-typed\" (int, string, etc)?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>And this is obvious once you understand that <code>interface{}</code> is not some kind of \"generic\" or \"arbitrary\" type but a single, \"strongly-type\" type just like <code>string</code> or <code>int32</code>. The empty interface <code>interface{}</code> is a totally normal type just like a <code>uint16</code> or a <code>map[float32]bool</code> is. It is a interface type (in contrast to the other examples which are a numeric type and a map type) and its method set is the empty set. It is as strict or strongly typed as any of the other types.</p>\n\n<p>The fact that you can assign any value to a variable of type <code>interface{}</code> does not mean that <code>interface{}</code> somehow means \"any type\". You can assign the values <code>3</code>, <code>-1234</code>and <code>435948</code> (to name a few) to a <code>int32</code>. This is allowed because the allowed value range of a <code>int32</code> contains these values (3, -1234, 435948). You can assign a value of type <code>func(int) string</code> to a variable of type <code>interface{}</code> because the allowed value range of <code>interface{}</code> contains <code>func(int)string</code>. This is a vacuous truth and not a \"generic\" one. </p>\n"}], "owner": {"reputation": 555, "user_id": 1950363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21cff9b9bcc1cfc9de2163b58f757578?s=128&d=identicon&r=PG", "display_name": "John Furtado", "link": "https://stackoverflow.com/users/1950363/john-furtado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 1, "accepted_answer_id": 56335807, "answer_count": 1, "score": -1, "last_activity_date": 1559022858, "creation_date": 1559016605, "question_id": 56334885, "link": "https://stackoverflow.com/questions/56334885/interface-conversion-of-fields-on-equivalent-structures", "title": "Interface conversion of fields on equivalent structures", "body": "<p>Is there a straightforward way to convert a struct where some fields are \"generic\" (<code>interface{}</code>) into another type which has the same field names but is \"strongly-typed\" (<code>int</code>, <code>string</code>, etc)?</p>\n\n<p>Lets say that, given the definitions:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype GenericData struct {\n    Hard int\n    Soft interface{}\n}\n\ntype Data struct {\n    Hard int\n    Soft int\n}\n\ntype GenericDataGenerator func() GenericData\n\nfunc generateGenericData() interface{} {\n    return GenericData{1, 2}\n}\n\nfunc returnsGenericDataGenerator() interface{} {\n    return generateGenericData\n}\n</code></pre>\n\n<p>Does converting from <code>GenericData</code> to <code>Data</code> require explicitly casting all <code>interface{}</code> fields? Is there a more straightforwad way to do this?</p>\n\n<pre><code>func main() {\n    gd := generateGenericData()\n    fmt.Println(gd)\n    fmt.Println(gd.(GenericData))\n\n    // Doesn't work, but is straightforward\n    // fmt.Println(gd.(Data))\n\n    // Works, but is not straight forward\n    fmt.Println(Data{gd.(GenericData).Hard, gd.(GenericData).Soft.(int)})\n\n\n    genDataGenerator := returnsGenericDataGenerator()\n\n    // Doesn't work, but is straightforward\n    //genDataGenerator.(GenericDataGenerator)()\n\n    // Works, but is not straight forward\n    resp := genDataGenerator.(func() interface{})()\n    fmt.Println(resp.(GenericData))\n}\n</code></pre>\n\n<p>The code can be executed in:\n<a href=\"https://play.golang.org/p/_UVBi5It1FY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_UVBi5It1FY</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559011997, "post_id": 56334352, "comment_id": 99275090, "body": "Try a higher value for the timeout."}, {"owner": {"reputation": 31, "user_id": 1295679, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95d491362d73b571fdb52d229c52ea89?s=128&d=identicon&r=PG", "display_name": "user1295679", "link": "https://stackoverflow.com/users/1295679/user1295679"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1559022576, "post_id": 56334352, "comment_id": 99277324, "body": "That is invalid, I tried 30 seconds, the same error"}], "owner": {"reputation": 31, "user_id": 1295679, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95d491362d73b571fdb52d229c52ea89?s=128&d=identicon&r=PG", "display_name": "user1295679", "link": "https://stackoverflow.com/users/1295679/user1295679"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559011191, "creation_date": 1559011191, "question_id": 56334352, "link": "https://stackoverflow.com/questions/56334352/unable-to-crawl-data", "title": "Unable to crawl data", "body": "<p>I want to use the crawler to access <a href=\"https://bet.hkjc.com/marksix/default.aspx\" rel=\"nofollow noreferrer\">https://bet.hkjc.com/marksix/default.aspx</a>, but I always get a timeout error. I can't get the return data normally using postman emulation. It will only display normally under the browser. </p>\n\n<pre><code>tr := &amp;http.Transport{\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n}\ncli := &amp;http.Client{\n    Transport: tr,\n}\ncli.Timeout = 10 * time.Second\nreq, _ := http.NewRequest(\"GET\", url, nil)\nreq.Header.Set(\"Content-Type\", \"application/json\")\n//req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded; charset=UTF-8\")\nreq.Header.Set(\"Connection\", \"Keep-Alive\")\nreq.Header.Add(\"User-Agent\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.157 Safari/537.36\")\nreq.Header.Add(\"Referer\", \"https://bet.hkjc.com/marksix/index.aspx?lang=ch\")\nresp, err := cli.Do(req)\nfmt.Println(\"err\",err)\nbody, _ := ioutil.ReadAll(resp.Body)\nfmt.Println(\"doc\",string(body))\n</code></pre>\n"}, {"tags": ["go", "response"], "comments": [{"owner": {"reputation": 1525, "user_id": 10621668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LghNx.jpg?s=128&g=1", "display_name": "Luna", "link": "https://stackoverflow.com/users/10621668/luna"}, "edited": false, "score": 1, "creation_date": 1559012910, "post_id": 56333730, "comment_id": 99275246, "body": "Maybe you can check the reason by removing the <code>mux</code> library or just returning a simple string?"}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "reply_to_user": {"reputation": 1525, "user_id": 10621668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LghNx.jpg?s=128&g=1", "display_name": "Luna", "link": "https://stackoverflow.com/users/10621668/luna"}, "edited": false, "score": 0, "creation_date": 1559022493, "post_id": 56333730, "comment_id": 99277295, "body": "I&#39;m not sure what you mean by &quot;checking the reason&quot; is there something I should be looking for?"}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "reply_to_user": {"reputation": 1525, "user_id": 10621668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LghNx.jpg?s=128&g=1", "display_name": "Luna", "link": "https://stackoverflow.com/users/10621668/luna"}, "edited": false, "score": 0, "creation_date": 1559024408, "post_id": 56333730, "comment_id": 99277980, "body": "I think I understand what you&#39;re staying. Further eliminate variables by reducing the application to it&#39;s most simple state. Yea that&#39;s fair, I could probably reduce it further, but I&#39;m still surprised to see this kind of poor performance on such a simple request."}, {"owner": {"reputation": 1525, "user_id": 10621668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LghNx.jpg?s=128&g=1", "display_name": "Luna", "link": "https://stackoverflow.com/users/10621668/luna"}, "edited": false, "score": 0, "creation_date": 1559025496, "post_id": 56333730, "comment_id": 99278413, "body": "Yes, I have not used the <code>mux</code> library, but you may be able to further check the performance loss in this way, <code>mux</code> or go itself"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559027129, "post_id": 56333730, "comment_id": 99279120, "body": "What else is running on the server machine?"}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "reply_to_user": {"reputation": 1525, "user_id": 10621668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LghNx.jpg?s=128&g=1", "display_name": "Luna", "link": "https://stackoverflow.com/users/10621668/luna"}, "edited": false, "score": 0, "creation_date": 1559031144, "post_id": 56333730, "comment_id": 99281185, "body": "@Luna alright I&#39;ll remove mux and the json object and see if anything changes."}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559031177, "post_id": 56333730, "comment_id": 99281204, "body": "@Flimzy nothing else is installed it&#39;s an AWS c5.large instance with the base Amazon AMI image."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1559034249, "post_id": 56333730, "comment_id": 99282696, "body": "The fact that it&#39;s on AWS means that it is shared with any untold number of other services, so erratic performance is to be expected. To get a <i>meaningful</i> test, run it on a dedicated machine, with nothing else happening. If you still get erratic performance, then there&#39;s actually something to investigate."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559034316, "post_id": 56333730, "comment_id": 99282730, "body": "I&#39;m voting to close this question as off-topic because debugging shared-hosting performance is off-topic for SO."}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "edited": false, "score": 0, "creation_date": 1559036474, "post_id": 56333730, "comment_id": 99283988, "body": "I&#39;ve tried a number of different configurations. Granted all on shared hardware, but with similar results each time. After testing on multiple different instances I don&#39;t believe it to be a hardware issue. I&#39;ve continued to reduce the functionality until it&#39;s what&#39;s presented in this question. At this point, I&#39;ve basically narrowed it down to one of the following being misconfigured: the Go server, libraries used in the Go server, the OS, or the load test software. I&#39;ve got a plan to eliminate the load test software, but in general I&#39;m looking for feedback in these areas."}, {"owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "edited": false, "score": 0, "creation_date": 1559038753, "post_id": 56333730, "comment_id": 99285251, "body": "I&#39;ll see if I can get a dedicated instance to test against and report back."}], "owner": {"reputation": 2056, "user_id": 954224, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LNEg5.jpg?s=128&g=1", "display_name": "Rawr", "link": "https://stackoverflow.com/users/954224/rawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559007361, "creation_date": 1559003245, "last_edit_date": 1559007361, "question_id": 56333730, "link": "https://stackoverflow.com/questions/56333730/why-am-i-getting-large-p95-response-times-on-a-simple-go-web-service", "title": "Why am I getting large p95 response times on a simple Go web service?", "body": "<p>The service simply reads query params and creates an object and returns it to the requester. Yet at times I'm getting 200ms response times. It feels like there's some resource that's not being cleaned up correctly or something, but I don't even know where I should be looking.</p>\n\n<p>Here's what I've tried:  </p>\n\n<ul>\n<li>Disabling Keep-Alive. There's no additional resources loaded here, so I'm not sure I needed it.</li>\n<li>Setting the response <code>Connection</code> header to close. Same reasons.</li>\n<li>Increased the server's ulimit open files to 65535.</li>\n</ul>\n\n<p>Open File Descriptor Settings:</p>\n\n<p>/etc/sysctl.conf</p>\n\n<pre><code># increase max open files\nfs.file-max = 65536\n</code></pre>\n\n<p>/etc/security/limits.conf:</p>\n\n<pre><code>*               soft    nproc           65535\n*               hard    nproc           65535\n*               soft    nofile          65535\n*               hard    nofile          65535\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"net/http\"\n    \"encoding/json\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    // router\n    router := mux.NewRouter()\n\n    // v1 router\n    v1router := router.PathPrefix(\"/v1\").Subrouter()\n    v1router.HandleFunc(\"/resource\", createResource).Methods(\"GET\")\n\n    // server config\n    server := &amp;http.Server{\n        Addr:         \":8080\",\n        ReadTimeout:  time.Millisecond * 500,\n        WriteTimeout: time.Millisecond * 100,\n        IdleTimeout:  time.Millisecond * 500,\n        Handler:      router,\n    }\n\n    server.SetKeepAlivesEnabled(false)\n\n    // start server\n    server.ListenAndServe()\n}\n\n\ntype Resource struct {\n    Id string\n    Name string\n}\n\nfunc createResource(response http.ResponseWriter, request *http.Request) {\n    // connection header\n    response.Header().Set(\"Connection\", \"close\")\n    defer request.Body.Close()\n\n    // get query params\n    params := request.URL.Query()\n\n    // create resource\n    resource := Resource{\n        Id: \"testid\",\n        Name: params.Get(\"name\"),\n    }\n\n    // convert resource to string\n    resourceStr, _ := json.Marshal(resource)\n\n    response.WriteHeader(http.StatusOK)\n    _, _ = response.Write([]byte(resourceStr))\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/0jksC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0jksC.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "struct", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 2, "last_activity_date": 1559008236, "last_edit_date": 1559008236, "creation_date": 1559007803, "answer_id": 56334075, "question_id": 56333524, "link": "https://stackoverflow.com/questions/56333524/how-to-struct-yaml-file-in-parent-child-order/56334075#56334075", "title": "How to struct yaml file in parent child order?", "body": "<p>This online resource will get you halfway there:</p>\n\n<p><a href=\"https://mengzhuo.github.io/yaml-to-go/\" rel=\"nofollow noreferrer\">https://mengzhuo.github.io/yaml-to-go/</a></p>\n\n<p>Pasting your yaml yields this:</p>\n\n<pre><code>type AutoGenerated struct {\n    API struct {\n        Local struct {\n            Host string `yaml:\"host\"`\n            Port int    `yaml:\"port\"`\n        } `yaml:\"local\"`\n        Develop struct {\n            Host interface{} `yaml:\"host\"`\n            Port interface{} `yaml:\"port\"`\n        } `yaml:\"develop\"`\n        Production struct {\n            Host interface{} `yaml:\"host\"`\n            Port interface{} `yaml:\"port\"`\n        } `yaml:\"production\"`\n    } `yaml:\"api\"`\n    RestAPI struct {\n        Local struct {\n            Host string `yaml:\"host\"`\n            Port int    `yaml:\"port\"`\n        } `yaml:\"local\"`\n        Develop struct {\n            Host interface{} `yaml:\"host\"`\n            Port interface{} `yaml:\"port\"`\n        } `yaml:\"develop\"`\n        Production struct {\n            Host interface{} `yaml:\"host\"`\n            Port interface{} `yaml:\"port\"`\n        } `yaml:\"production\"`\n    } `yaml:\"rest-api\"`\n}\n</code></pre>\n\n<p>There's obvious sub-type duplicates. So it can be trimmed.</p>\n\n<p><strong>First pass:</strong></p>\n\n<pre><code>type Address struct {\n    Host string `yaml:\"host\"`\n    Port int    `yaml:\"port\"`\n}\n\ntype MyConfig struct {\n    API struct {\n        Local      Address `yaml:\"local\"`\n        Develop    Address `yaml:\"develop\"`\n        Production Address `yaml:\"production\"`\n    } `yaml:\"api\"`\n    RestAPI struct {\n        Local      Address `yaml:\"local\"`\n        Develop    Address `yaml:\"develop\"`\n        Production Address `yaml:\"production\"`\n    } `yaml:\"rest-api\"`\n}\n</code></pre>\n\n<p><strong>Second (and final) pass:</strong></p>\n\n<pre><code>type Address struct {\n    Host string `yaml:\"host\"`\n    Port int    `yaml:\"port\"`\n}\n\ntype Deployment struct {\n    Local      Address `yaml:\"local\"`\n    Develop    Address `yaml:\"develop\"`\n    Production Address `yaml:\"production\"`\n}\n\ntype MyConfig struct {\n    API     Deployment `yaml:\"api\"`\n    RestAPI Deployment `yaml:\"rest-api\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "accepted_answer_id": 56334075, "answer_count": 1, "score": 1, "last_activity_date": 1559008236, "creation_date": 1559000942, "question_id": 56333524, "link": "https://stackoverflow.com/questions/56333524/how-to-struct-yaml-file-in-parent-child-order", "title": "How to struct yaml file in parent child order?", "body": "<p>I want to form a struct using golang via yaml file but I find it difficult to figure out to do it.</p>\n\n<pre><code>api:\n  local:\n    host: localhost\n    port: 8085\n  develop:\n    host:\n    port:\n  production:\n    host:\n    port:\nrest-api:\n  local:\n    host: localhost\n    port: 8085\n  develop:\n    host:\n    port:\n  production:\n    host:\n    port:\n</code></pre>\n\n<p>this is the format in my yaml file </p>\n\n<p>the expected code of this is i want to create a dynamic api url in local, develop and production format like api : local = host+port, same to develop and production to dynamically configure it easily and set up</p>\n\n<p>Would appreciate your help in golang struct and also for your help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1558992628, "post_id": 56332497, "comment_id": 99271832, "body": "<code>godoc -http</code> will serve doc of all available packages, including the standard library. Worry not, your own packages are amongst them, just look again. As a shortcut, just type <code>http:&#47;&#47;localhost:6060&#47;pkg&#47;your&#47;package</code>."}, {"owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558997058, "post_id": 56332497, "comment_id": 99272729, "body": "@icza Thanks. I tried <code>http:&#47;&#47;localhost:6060&#47;pkg&#47;gonotes</code> and got <code>cannot find package &quot;.&quot; in: &#47;src&#47;gonotes</code>.  Do I need to put my source files under <code>src</code>?  Currently they&#39;re just in in the folder <code>gonotes</code>, as you can see from the terminal session I included in the OP."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559028281, "post_id": 56332497, "comment_id": 99279679, "body": "For that to work, your <code>gonotes</code> package would have to be inside <code>GOPATH&#47;src&#47;gonotes</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559036173, "post_id": 56332497, "comment_id": 99283808, "body": "You can&#39;t just put your Go code into arbitrary folders. You must follow the <code>GOPATH</code> convention, for details, see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>."}, {"owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1559043375, "post_id": 56332497, "comment_id": 99287755, "body": "@icza isn\u2019t this the whole point of using go modules?  so you aren\u2019t bound to GOPATH?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559045060, "post_id": 56332497, "comment_id": 99288703, "body": "Not the whole point, but yes, if using modules, you don&#39;t have to use <code>GOPATH</code> (you didn&#39;t mention modules before though). But then why are you setting <code>GOPATH</code>? <code>GOPATH</code> and modules are <i>mutually exclusive</i>, see <a href=\"https://stackoverflow.com/questions/55650450/go-modules-does-not-recognize-files-under-gopath/55650622#55650622\">Go Modules does not recognize files under GOPATH</a>. The <code>godoc</code> tool is not module-aware, and it is being deprecated, so for now if you want to see your package docs locally in <code>godoc</code>, you have to resort to putting their sources in an <code>src</code> folder."}, {"owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559045705, "post_id": 56332497, "comment_id": 99289058, "body": "This comment is the answer to my question.  Feel free to add as a proper answer."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1559046624, "creation_date": 1559046624, "answer_id": 56342340, "question_id": 56332497, "link": "https://stackoverflow.com/questions/56332497/view-package-documentation-locally-in-a-browser/56342340#56342340", "title": "View package documentation locally in a browser", "body": "<h2>In <code>GOPATH</code> mode</h2>\n\n<p><code>godoc -http</code> will serve doc of all available packages, including the standard library. Worry not, your own packages are amongst them, just look again. As a shortcut, just type <code>http://localhost:6060/pkg/your/package</code>.</p>\n\n<h2>In module-aware mode</h2>\n\n<p><code>GOPATH</code> and modules are <em>mutually exclusive</em>, see <a href=\"https://stackoverflow.com/questions/55650450/go-modules-does-not-recognize-files-under-gopath/55650622#55650622\">Go Modules does not recognize files under GOPATH</a>. The <code>godoc</code> tool is not module-aware, and it is being deprecated (see <a href=\"https://golang.org/doc/go1.12#godoc\" rel=\"noreferrer\">deprecation warning</a>), so for now if you want to see your package docs of modules locally in <code>godoc</code>, you have to resort to putting their sources in an <code>src</code> folder. </p>\n\n<p>\"Workaround\" for seeing docs of module's:</p>\n\n<ul>\n<li><p>Put the repo in a folder like <code>/some/folder/src</code></p></li>\n<li><p>Start godocs with <code>godoc -goroot=/some/folder -http=:6060</code></p></li>\n</ul>\n\n<p>See related issue: <a href=\"https://github.com/golang/gddo/issues/567\" rel=\"noreferrer\">support Go modules</a></p>\n\n<p>Also groups discussion: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/SSv5vhCi2zs\" rel=\"noreferrer\">Is the go 1.11 godoc tool 'module-aware'?</a></p>\n"}], "owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 1, "accepted_answer_id": 56342340, "answer_count": 1, "score": 2, "last_activity_date": 1559046624, "creation_date": 1558991485, "last_edit_date": 1592644375, "question_id": 56332497, "link": "https://stackoverflow.com/questions/56332497/view-package-documentation-locally-in-a-browser", "title": "View package documentation locally in a browser", "body": "<p>I want to see locally how my package documentation will look.  That is, I want to see the same kind of thing you see on <a href=\"https://godoc.org/strings\" rel=\"nofollow noreferrer\">godoc.org</a>, but locally.</p>\n<p>I have a simple example folder locally, but I can't get it to work.  It correctly outputs text documentation:</p>\n<pre><code>~/code/go/gonotes (master) $ godoc .\nPACKAGE DOCUMENTATION\n\npackage gonotes\n    import &quot;.&quot;\n\n\nFUNCTIONS\n\nfunc Blah()\n    Here is header\n\n    Blah is function being use to test:\n\n    - go documentation\n    - blah like things\n\n    It is nice\n</code></pre>\n<p>But if I run <code>godoc -http=:6060</code>, and navigate to <code>http://localhost:6060/</code>, I see essentially the same content I'd see on the golang.com homepage.  <code>http://localhost:6060/gonotes</code> displays</p>\n<pre><code>lstat $GOROOT/gonotes: no such file or directory\n</code></pre>\n<p>Am I misunderstanding how the <code>-http</code> works?  Is there any way to preview the http version of my docs locally?</p>\n<h2>UPDATE</h2>\n<p>I was able to get it to appear by copying the files into <code>src/gonotes</code> and then running:</p>\n<pre><code>GOPATH=/Users/jonah/code/go/gonotes godoc -http=:6060\n</code></pre>\n<p>so that the actual files were available at <code>/Users/jonah/code/go/gonotes/src/gonotes</code>.</p>\n<p>This has the side effect of not showing any of the Third part libs installed in my default <code>GOPATH</code>, so I'd still like to find a solution that just allows me to add the current directory, as is, without adding <code>src/curdir</code> to it, and still have it show up.</p>\n"}, {"tags": ["reactjs", "amazon-web-services", "go", "amazon-ec2", "amazon-elb"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1558974386, "post_id": 56329518, "comment_id": 99266374, "body": "low quality question but i suspectthe webserver is not confidureg to handle the expected domain so it returns 404 for security reasons among other considerations"}, {"owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1558974846, "post_id": 56329518, "comment_id": 99266521, "body": "I added the domain name to the Access-Control-Allow-Origin for handling CORs, the public IP is actually sometimes blocked because I switch around the Access-Control-Allow-Origin to my domain name just to test if it was that"}, {"owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1558976103, "post_id": 56329518, "comment_id": 99266970, "body": "I&#39;ve noticed it says that my port 8000 is unhealthy on the target group, I&#39;ve checked out the AWS documentation and it isn&#39;t really helpful, any clue as to what could be causing the issue?"}, {"owner": {"reputation": 26092, "user_id": 824377, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e600bd229c588891a7616f303e30efd9?s=128&d=identicon&r=PG", "display_name": "AJcodez", "link": "https://stackoverflow.com/users/824377/ajcodez"}, "edited": false, "score": 0, "creation_date": 1558976216, "post_id": 56329518, "comment_id": 99267003, "body": "If you want the domain to point to the load balancer you need to add a DNS record. See if the domain is managed by Route 53. If not, find out where the nameservers for the domain are pointing."}, {"owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "edited": false, "score": 0, "creation_date": 1558976388, "post_id": 56329518, "comment_id": 99267055, "body": "I&#39;ve added an A record on Route 53 to the load balancers, it says that the request timed out when I hovered over the unhealthy status for my target group, does that mean a firewall is blocking it out on EC2? The docs and google searches for unhealthy status is not that good"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1559047440, "post_id": 56329518, "comment_id": 99290106, "body": "can you share results of the adapted command <code>curl -H &quot;Origin: https:&#47;&#47;api&quot; --verbose  https:&#47;&#47;api&#47;</code>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1559047465, "post_id": 56329518, "comment_id": 99290118, "body": "can you share the mux declaration ?"}, {"owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "edited": false, "score": 0, "creation_date": 1559057232, "post_id": 56329518, "comment_id": 99295981, "body": "I figured it out and just used two EC2 instances, one for the frontend and one for the golang backend"}], "answers": [{"tags": [], "owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "is_accepted": true, "score": 1, "last_activity_date": 1559057209, "creation_date": 1559057209, "answer_id": 56345506, "question_id": 56329518, "link": "https://stackoverflow.com/questions/56329518/aws-elb-return-404-for-https-domain-name8000-but-accessible-via-public-ip800/56345506#56345506", "title": "AWS ELB return 404 for https://domain_name:8000 but accessible via public_ip:8000", "body": "<p>It was taking forever to figure out the ports and none of the google searches or AWS documentation was helpful so I put my reactjs frontend in one EC2 Instance running on port 80 and my server/golang API into another EC2 instance running on port 80 and then set up the Application Load Balancer to forward to a target group with the frontend if HTTP:80 or HTTPS:443 is called and forward to the target group with the golang API if HTTPS:8000 is called. </p>\n\n<p>Make sure that the instances are in the same availability zone as the load balancer or else it won't work properly and also ensure everything is healthy.</p>\n"}], "owner": {"reputation": 723, "user_id": 4297337, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Tv9JY.jpg?s=128&g=1", "display_name": "mding5692", "link": "https://stackoverflow.com/users/4297337/mding5692"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "accepted_answer_id": 56345506, "answer_count": 1, "score": -1, "last_activity_date": 1559057209, "creation_date": 1558974060, "last_edit_date": 1558977155, "question_id": 56329518, "link": "https://stackoverflow.com/questions/56329518/aws-elb-return-404-for-https-domain-name8000-but-accessible-via-public-ip800", "title": "AWS ELB return 404 for https://domain_name:8000 but accessible via public_ip:8000", "body": "<p>I'm a beginner to deploying web apps on AWS and I believe I have a similar issue to <a href=\"https://stackoverflow.com/questions/46562925/aws-forward-port-8000-from-elb-to-port-8000-of-ec2\">AWS forward port 8000 from elb to port 8000 of EC2</a> where I have a reactjs frontend and golang api running on aws ec2 and the golang api is running on port 8000 which is accessible via my public_ip:8000 and gaves me messages saying my golang api is operational when I access public_ip:8000. I created the public_ip using Elastic IPs.</p>\n\n<p>I used load balancers to get HTTPS as I have certain features that only work with HTTPS. However when I use my <a href=\"https://domain_name:8000\" rel=\"nofollow noreferrer\">https://domain_name:8000</a> to send requests to my own API, it says it isn't there and gives me 404 errors when I used an Application Load Balancer. </p>\n\n<p>My domain name uses AWS's Route 53 and AWS nameservers and should have no issues as I am being directed to my normal domain properly. I've added an A record pointing to my load balancer as well.</p>\n\n<p>I've checked the security group used and I have opened up the ports to my IP address.</p>\n\n<p>My Instance Status Checks:\n<a href=\"https://i.stack.imgur.com/mEw7P.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mEw7P.png\" alt=\"Instance Status checks\"></a></p>\n\n<p>Below is how I've configured my Application Load Balancer's Target Group:\n<a href=\"https://i.stack.imgur.com/oVV1g.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oVV1g.png\" alt=\"Target groups\"></a>\nand for my Listeners I've used HTTP 80, HTTPS 443 and HTTPS 8000 to forward to my target group.</p>\n\n<p>I have tried using classic load balancers as mentioned in the link but they all timeout when I use my domain_name.</p>\n\n<p>Anyone know either a better way to connect or a better way to structure my reactjs frontend and golang backend app on AWS that might need other ports open for api access.</p>\n\n<p>My Classic Load balancer port forwarding config:\n<a href=\"https://i.stack.imgur.com/fHSYN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fHSYN.png\" alt=\"classic load balancer port\"></a></p>\n\n<p>EDIT: I've noticed the problem might be my target group as it says that port 8000 is unhealthy and that the request timed out</p>\n"}, {"tags": ["go", "go-templates", "gomplate"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1558965556, "post_id": 56327319, "comment_id": 99262559, "body": "Try using <code>printf</code> to interpolate the env var&#39;s value into the json string. E.g. something like this: <code>(printf &quot;[%s]&quot; (getenv &quot;USER&quot;))</code>?"}, {"owner": {"reputation": 429, "user_id": 3597719, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e27a2108d6bc2898e83ba23ef8cf9405?s=128&d=identicon&r=PG&f=1", "display_name": "user3597719", "link": "https://stackoverflow.com/users/3597719/user3597719"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558966433, "post_id": 56327319, "comment_id": 99262981, "body": "No. It is not working. Still converts as a string"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1558968788, "post_id": 56327319, "comment_id": 99264151, "body": "Not sure what you&#39;ve tried from my first comment that it didn&#39;t work, however if I try in on my machine it works just fine. <a href=\"https://imgur.com/KxVFdod\" rel=\"nofollow noreferrer\">imgur.com/KxVFdod</a>"}, {"owner": {"reputation": 429, "user_id": 3597719, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e27a2108d6bc2898e83ba23ef8cf9405?s=128&d=identicon&r=PG&f=1", "display_name": "user3597719", "link": "https://stackoverflow.com/users/3597719/user3597719"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558969738, "post_id": 56327319, "comment_id": 99264563, "body": "@mkopriva Thank you so much it worked :) I was missing some braces. However I cannot include multiline values in this array.  for e.g.  ``` {{ $o := jsonArray (printf &quot;[%s]&quot; (getenv &quot;USER&quot;), &quot;one&quot;) }} {{ range $o }}   {{ . }} {{ end }} ``` The error is unexpected &quot;,&quot; in operand."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558971015, "post_id": 56327319, "comment_id": 99265120, "body": "<code>{{ $o := jsonArray (printf &quot;[%s, %s]&quot; (getenv &quot;USER&quot;) &quot;one&quot;) }}</code> Arguments to template functions are separated by white space, not commas. And don&#39;t forget to provide the <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\"><i>fmt verb</i></a> <code>%s</code> for each value you want to pass in to <code>printf</code>."}, {"owner": {"reputation": 429, "user_id": 3597719, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e27a2108d6bc2898e83ba23ef8cf9405?s=128&d=identicon&r=PG&f=1", "display_name": "user3597719", "link": "https://stackoverflow.com/users/3597719/user3597719"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558971218, "post_id": 56327319, "comment_id": 99265197, "body": "@mkopriva How can I write this in multiline? My strings are too big to write it in a single line. Looks like this does not support multiline formatting. Can you please tell me if it can be written as multiline values?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558971314, "post_id": 56327319, "comment_id": 99265242, "body": "Are your variable&#39;s values multiline? E.g. does your <code>USER</code> or other variable contain multiple lines? Or is the raw text in your template multiline?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1558972204, "post_id": 56327319, "comment_id": 99265605, "body": "If a variable&#39;s value contains multiple lines and you want to pass that to <code>jsonArray</code> you can probably use <code>replaceAll</code> or <code>regexp.Replace</code> to replace new lines with commas or just empty strings. If you want to use multi-line <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\">template actions</a> then that is only possible by using a raw string. <i>Except for raw strings, actions may not span newlines, although comments can.</i> <a href=\"https://imgur.com/Bue9iqy\" rel=\"nofollow noreferrer\">imgur.com/Bue9iqy</a> (use <code>replaceAll</code> to turn new lines into commas, use <code>strings.Trim</code> to remove extra commas)."}, {"owner": {"reputation": 429, "user_id": 3597719, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e27a2108d6bc2898e83ba23ef8cf9405?s=128&d=identicon&r=PG&f=1", "display_name": "user3597719", "link": "https://stackoverflow.com/users/3597719/user3597719"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558972332, "post_id": 56327319, "comment_id": 99265660, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/194013/discussion-between-user3597719-and-mkopriva\">continue this discussion in chat</a>."}], "owner": {"reputation": 429, "user_id": 3597719, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e27a2108d6bc2898e83ba23ef8cf9405?s=128&d=identicon&r=PG&f=1", "display_name": "user3597719", "link": "https://stackoverflow.com/users/3597719/user3597719"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 494, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558965544, "creation_date": 1558964815, "last_edit_date": 1558965544, "question_id": 56327319, "link": "https://stackoverflow.com/questions/56327319/how-to-get-environment-variable-in-gomplate-arrays", "title": "How to get environment variable in gomplate arrays?", "body": "<p>I need to create an array of some Environment variables in gomplate template and print in order to see if environment variables are set properly.</p>\n\n<p>I tried from the docs <a href=\"https://docs.gomplate.ca/syntax/#indexing-arrays-and-maps\" rel=\"nofollow noreferrer\">https://docs.gomplate.ca/syntax/#indexing-arrays-and-maps</a> but there is no mention to declare env variable in an array.</p>\n\n<p>Example, </p>\n\n<pre><code>{{ $o := jsonArray `[(getenv \"USER\")]` }}\n\n{{ range ($o) }}\n    {{ . }}\n{{ end }}\n</code></pre>\n\n<p>It converts the getenv \"USER\" into a string and does not get my \"USER\" environment  variable.</p>\n\n<p>The output it returns is (getenv \"USER\")</p>\n\n<p>Instead it should return pineapple (which is an example user env variable)</p>\n"}, {"tags": ["go", "audio", "ffmpeg", "binary", "ffmpeg-php"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1558967679, "post_id": 56327208, "comment_id": 99263578, "body": "You don&#39;t need Go installed on your server to run wnb-slicer. Go is a compiled language. Build the program anywhere you like and copy the binary."}, {"owner": {"reputation": 83, "user_id": 3243761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fa448501dd8b78a4dd29ce72876a23?s=128&d=identicon&r=PG", "display_name": "SomniusX", "link": "https://stackoverflow.com/users/3243761/somniusx"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559081647, "post_id": 56327208, "comment_id": 99306302, "body": "Yes i can do that, and i had done that, but i don&#39;t want to run shell_exec on the webserver cause i need to open php sessions and do the work, instead of like open a &quot;screen&quot; with name based on current date_time_seconds to be unique and the share the file into a temp folder based on that screen name from before and quote that link to the web output of the user. I&#39;d like to run everything on php, i run php-ffmpeg with success, but still i cant splice :&#39;("}], "owner": {"reputation": 83, "user_id": 3243761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fa448501dd8b78a4dd29ce72876a23?s=128&d=identicon&r=PG", "display_name": "SomniusX", "link": "https://stackoverflow.com/users/3243761/somniusx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558964394, "creation_date": 1558964394, "question_id": 56327208, "link": "https://stackoverflow.com/questions/56327208/how-to-use-php-ffmpeg-to-alter-audio-binary-header-bytes-offset", "title": "How to use PHP FFMPEG to alter audio binary header bytes offset", "body": "<p>I use the following method to create a WNB file that is flashable to my Electric Unicycle Ninebot Z10</p>\n\n<p>First audacity to make the file raw pcm 16khz 16bit mono littleendian\nThen wnb-slicer golang app to convert that raw file into wnb.</p>\n\n<p>Today i did the same with ffmpeg </p>\n\n<pre><code>ffmpeg -i $1 -acodec pcm_s16le -f s16le -ac 1 -ar 16000 -acodec pcm_s16le $1.raw\n../wnb-slicer-master/wnb-slicer -file-name $1.raw\n</code></pre>\n\n<p>where $1 is the original file</p>\n\n<p>About an hour ago i did the ffmpeg part with php-ffmpeg but i can't have golang run on a webserver.</p>\n\n<p>So i thought if ffmpeg does bytes manipulation like the golang app does <a href=\"https://github.com/berghauz/wnb-slicer/blob/master/wnb-slicer.go\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Thank you in advance!</p>\n\n<p>p.s. this project will help all electric unicycle owners of the Z series wheels to change audio voices/sounds on their wheels!!</p>\n"}, {"tags": ["string", "go", "casting", "hex"], "answers": [{"comments": [{"owner": {"reputation": 1432, "user_id": 2204593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fe4f25ca66d6349d215f4940fea7b87d?s=128&d=identicon&r=PG", "display_name": "SalmaFG", "link": "https://stackoverflow.com/users/2204593/salmafg"}, "edited": false, "score": 0, "creation_date": 1558961180, "post_id": 56326312, "comment_id": 99260316, "body": "Thank you so much! I&#39;ve been trying to get this to work for hours."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1558961841, "last_edit_date": 1558961841, "creation_date": 1558960847, "answer_id": 56326312, "question_id": 56326080, "link": "https://stackoverflow.com/questions/56326080/casting-string-to-uint16/56326312#56326312", "title": "Casting string to uint16", "body": "<p>The behavior of <a href=\"https://golang.org/pkg/strconv/#ParseUint\" rel=\"nofollow noreferrer\"><code>strconv.ParseUint()</code></a> is detailed at <a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow noreferrer\"><code>strconv.ParseInt()</code></a>:</p>\n\n<blockquote>\n  <p>If base == 0, the base is implied by the string's prefix: base 16 for \"0x\", base 8 for \"0\", and base 10 otherwise. For bases 1, below 0 or above 36 an error is returned.</p>\n</blockquote>\n\n<p>So simply use <code>base = 0</code>, and then the <code>0x</code> prefix will be interpreted properly.</p>\n\n<p>For example:</p>\n\n<pre><code>c, err := strconv.ParseUint(\"0x0000\", 0, 16)\nfmt.Println(c, err)\n\nc, err = strconv.ParseUint(\"0x0100\", 0, 16)\nfmt.Println(c, err)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/0aIfF0oAxxg\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0 &lt;nil&gt;\n256 &lt;nil&gt;\n</code></pre>\n\n<p>Another option is to use <a href=\"https://golang.org/pkg/fmt/#Sscanf\" rel=\"nofollow noreferrer\"><code>fmt.Sscanf()</code></a>:</p>\n\n<pre><code>var c uint16\n_, err := fmt.Sscanf(\"0x0000\", \"0x%04x\", &amp;c)\nfmt.Println(c, err)\n\n_, err = fmt.Sscanf(\"0x0100\", \"0x%04x\", &amp;c)\nfmt.Println(c, err)\n</code></pre>\n\n<p>Output is the same. Try it on the <a href=\"https://play.golang.org/p/jrNMnUWCxEK\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/4278430/convert-string-to-integer-type-in-go/29841190#29841190\">Convert string to integer type in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1558960905, "creation_date": 1558960905, "answer_id": 56326335, "question_id": 56326080, "link": "https://stackoverflow.com/questions/56326080/casting-string-to-uint16/56326335#56326335", "title": "Casting string to uint16", "body": "<p>First, what you're doing is a conversion, not a type cast. Go doesn't support type casting at all, and even if it did, this is not an example of typecasting in any language.</p>\n\n<p>But for your actual question, you have two options:</p>\n\n<ol>\n<li><p>Remove the \"0x\" prefix:</p>\n\n<pre><code>c, err := strconv.ParseUint(\"0000\", 16, 32)\n</code></pre></li>\n<li><p>Let strconv detect the base with the prefix, as <a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow noreferrer\">documented</a>:</p>\n\n<blockquote>\n  <p>If base == 0, the base is implied by the string's prefix: base 16 for \"0x\", base 8 for \"0\", and base 10 otherwise. For bases 1, below 0 or above 36 an error is returned.</p>\n</blockquote>\n\n<pre><code>c, err := strconv.ParseUint(\"0x0000\", 0, 32)\n</code></pre></li>\n</ol>\n\n<p>And finally, if your goal is to convert to a <code>uint16</code>, you should probably tell ParseUint as much, by requesting the appropriate bitsize:</p>\n\n<pre><code>c, err := strconv.ParseUint(\"0x0000\", 0, 16)\n</code></pre>\n"}], "owner": {"reputation": 1432, "user_id": 2204593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fe4f25ca66d6349d215f4940fea7b87d?s=128&d=identicon&r=PG", "display_name": "SalmaFG", "link": "https://stackoverflow.com/users/2204593/salmafg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "accepted_answer_id": 56326312, "answer_count": 2, "score": -1, "last_activity_date": 1558961841, "creation_date": 1558960089, "last_edit_date": 1558960552, "question_id": 56326080, "link": "https://stackoverflow.com/questions/56326080/casting-string-to-uint16", "title": "Casting string to uint16", "body": "<p>I'm new at go and I've been trying to cast the string \"0x0000\" into a hexadecimal with no luck so far. Here's what I tried:</p>\n\n<pre><code>import \"strconv\"\n\nc, err := strconv.ParseUint(\"0x0000\", 16, 32)\nif err != nil {\n    return err, nil\n}\n</code></pre>\n\n<p>which throws the error: <code>strconv.ParseUint: parsing \"0x0000\": invalid syntax</code>.</p>\n\n<p>I've also tried <code>uint16(\"0x0000\")</code> but apparently I also can't convert a string directly to <code>uint16</code>. I'm sure it's very trivial, so any help would be appreciated. Thanks.</p>\n"}, {"tags": ["go", "google-api", "speech-recognition"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 1442823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebdd1004642110ded4a0ad032daab6b?s=128&d=identicon&r=PG", "display_name": "Joan Salvatella", "link": "https://stackoverflow.com/users/1442823/joan-salvatella"}, "edited": false, "score": 0, "creation_date": 1560236075, "post_id": 56526586, "comment_id": 99658142, "body": "I guess this may indicate that it&#39;s a defect on the server side of things. I hope someone @ Google can give us a hint."}], "tags": [], "owner": {"reputation": 2158, "user_id": 44964, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/0a6fc5372dbffc5598c7ad38955634cd?s=128&d=identicon&r=PG", "display_name": "sabiland", "link": "https://stackoverflow.com/users/44964/sabiland"}, "is_accepted": false, "score": 0, "last_activity_date": 1560324869, "last_edit_date": 1560324869, "creation_date": 1560170254, "answer_id": 56526586, "question_id": 56325906, "link": "https://stackoverflow.com/questions/56325906/usage-of-alternativelanguagecodes-in-google-cloud-speech-to-text-api-v1p1beta1-r/56526586#56526586", "title": "Usage of AlternativeLanguageCodes in Google Cloud Speech to Text API v1p1beta1 RPC", "body": "<p>I have tried this today (c#, 1.0.0-beta02) but I never get alternative language codes results, only for primary language code.</p>\n\n<pre><code>ENGINE = SpeechClient.Create();\nENGINE_CONFIG = new StreamingRecognitionConfig()\n{\n    Config = new RecognitionConfig()\n    {\n        Encoding = RecognitionConfig.Types.AudioEncoding.Linear16,\n        SampleRateHertz = settings.ArchiveSampleRate,\n        LanguageCode = firstLanguageCode,\n        ProfanityFilter = false,\n        MaxAlternatives = Constants.MASTER_SETTINGS.SpeechRecognitionAlternatives,\n        SpeechContexts = { new HintsManager(settings).GetHintsBasedOnContext(Contexts) }\n    },\n    InterimResults = Constants.MASTER_SETTINGS.RecognitionConfigSettings.InterimResultsReturned\n};\n\n// NOTE: 10062019 - ADD ALTERNATIVE LANGUAGE CODES HERE\n// NOTE: 10062019 - ADD ALTERNATIVE LANGUAGE CODES HERE\n// NOTE: 10062019 - ADD ALTERNATIVE LANGUAGE CODES HERE\nforeach (var alternativeCode in otherAlternativeLanguageCodes)\n{\n    ENGINE_CONFIG.Config.AlternativeLanguageCodes.Add(alternativeCode);\n}\n</code></pre>\n\n<p>EDIT: After upgrading yesterday to new Beta, Nuget:</p>\n\n<pre><code>Install-Package Google.Cloud.Speech.V1P1Beta1 -Version 1.0.0-beta03\n</code></pre>\n\n<p>Everything seems to be working ok. The only thing I noticed was that interim results are never returned?</p>\n"}], "owner": {"reputation": 103, "user_id": 1442823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebdd1004642110ded4a0ad032daab6b?s=128&d=identicon&r=PG", "display_name": "Joan Salvatella", "link": "https://stackoverflow.com/users/1442823/joan-salvatella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1560324869, "creation_date": 1558959400, "question_id": 56325906, "link": "https://stackoverflow.com/questions/56325906/usage-of-alternativelanguagecodes-in-google-cloud-speech-to-text-api-v1p1beta1-r", "title": "Usage of AlternativeLanguageCodes in Google Cloud Speech to Text API v1p1beta1 RPC", "body": "<p>I am working on Google Cloud Speech to Text API in RPC v1p1beta1 with its go client. The API works as expected but if alternativeLanguageCodes are set in the RecognitionConfig it does not answer.</p>\n\n<pre><code>GoogleRecognitionConfig: &amp;speech.StreamingRecognitionConfig{\n            SingleUtterance: c.SingleUtterance,\n            InterimResults:  false,\n            Config: &amp;speech.RecognitionConfig{\n                Encoding:        speech.RecognitionConfig_LINEAR16,\n                SampleRateHertz: 8000,\n                LanguageCode:    lang,\n                // AlternativeLanguageCodes: []string(\"en-US\"),\n                SpeechContexts: []*speech.SpeechContext{\n                    {Phrases: c.Phrases},\n                },\n            },\n        },\n</code></pre>\n\n<p>I am aware it's in beta but I am wondering if anyone else is having issues as well or it's just a bug in my code.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["csv", "go", "multiprocess"], "comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1558958238, "post_id": 56325466, "comment_id": 99258754, "body": "Have you think about <code>bufio.NewScanner(file)</code> it won&#39;t use too much memory."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1558958460, "post_id": 56325466, "comment_id": 99258889, "body": "your loop over the cvs lines should be in a different routines. the main routine should be responsible to drain the output of the workers and wait for completion or error to exit."}], "answers": [{"comments": [{"owner": {"reputation": 421, "user_id": 1538434, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/426d9706bd2220ae9eefb5b1683d368c?s=128&d=identicon&r=PG", "display_name": "Ilan", "link": "https://stackoverflow.com/users/1538434/ilan"}, "edited": false, "score": 0, "creation_date": 1558958259, "post_id": 56325585, "comment_id": 99258770, "body": "I tried but then it seems to enter into a deadlock. It starts to process <code>numberOfWorkers</code> number of lines and then stuck."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1558958398, "post_id": 56325585, "comment_id": 99258853, "body": "happens because nothing is reading the output of your workers until you have fully processed the input."}, {"owner": {"reputation": 421, "user_id": 1538434, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/426d9706bd2220ae9eefb5b1683d368c?s=128&d=identicon&r=PG", "display_name": "Ilan", "link": "https://stackoverflow.com/users/1538434/ilan"}, "edited": false, "score": 0, "creation_date": 1558959889, "post_id": 56325585, "comment_id": 99259658, "body": "Could you help me understand more about your comment?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1558960614, "post_id": 56325585, "comment_id": 99260044, "body": "Your workers write to the <code>done</code> channel, but this is not read until the end of the program. This is what leads to a deadlock."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1558958571, "last_edit_date": 1558958571, "creation_date": 1558958098, "answer_id": 56325585, "question_id": 56325466, "link": "https://stackoverflow.com/questions/56325466/process-large-csv-file-and-limit-goroutines/56325585#56325585", "title": "Process large csv file and limit goroutines", "body": "<p>You're creating a new goroutine for every line in the file. That's why. There's no reason to do that, if you already have the workers you need.</p>\n\n<p>So in short, change this:</p>\n\n<pre><code>    go func(r []string, i int) {\n        q &lt;- r\n        bar.Add(1)\n    }(record, i)\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>    q &lt;- record\n    bar.Add(1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 3, "last_activity_date": 1558969310, "last_edit_date": 1558969310, "creation_date": 1558968673, "answer_id": 56328323, "question_id": 56325466, "link": "https://stackoverflow.com/questions/56325466/process-large-csv-file-and-limit-goroutines/56328323#56328323", "title": "Process large csv file and limit goroutines", "body": "<p>I striped out the progress bar as i did not want to bother about it, but overall this is closer to what you are looking for.</p>\n\n<p>It does not genuinely handle errors, they simply fail in a fatal state.</p>\n\n<p>I have added context and cancellation support.</p>\n\n<p>You might want to check for \n<a href=\"https://godoc.org/golang.org/x/sync/errgroup#Group.Go\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/sync/errgroup#Group.Go</a></p>\n\n<p>As a general recommentation, you need to learn the golang patterns and their usage.</p>\n\n<p>It is obvious you have not worked that enough, or that you are in process of learning.</p>\n\n<p>Its not the fastest program at all, but it does the job.</p>\n\n<p>This is only a draft to get you back on a better direction.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/csv\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"sync\"\n    \"time\"\n)\n\nfunc worker(ctx context.Context, dst chan string, src chan []string) {\n    for {\n        select {\n        case url, ok := &lt;-src: // you must check for readable state of the channel.\n            if !ok {\n                return\n            }\n            dst &lt;- fmt.Sprintf(\"out of %v\", url) // do somethingg useful.\n        case &lt;-ctx.Done(): // if the context is cancelled, quit.\n            return\n        }\n    }\n}\n\nfunc main() {\n\n    // create a context\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n    // that cancels at ctrl+C\n    go onSignal(os.Interrupt, cancel)\n\n    // parse command line arguments\n    var filename string\n    var numberOfWorkers int\n    flag.StringVar(&amp;filename, \"filename\", \"\", \"src file\")\n    flag.IntVar(&amp;numberOfWorkers, \"c\", 2, \"concurrent workers\")\n    flag.Parse()\n\n    // check arguments\n    if filename == \"\" {\n        log.Fatal(\"filename required\")\n    }\n\n    start := time.Now()\n\n    csvfile, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer csvfile.Close()\n\n    reader := csv.NewReader(csvfile)\n\n    // create the pair of input/output channels for the controller=&gt;workers com.\n    src := make(chan []string)\n    out := make(chan string)\n\n    // use a waitgroup to manage synchronization\n    var wg sync.WaitGroup\n\n    // declare the workers\n    for i := 0; i &lt; numberOfWorkers; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            worker(ctx, out, src)\n        }()\n    }\n\n    // read the csv and write it to src\n    go func() {\n        for {\n            record, err := reader.Read()\n            if err == io.EOF {\n                break\n            } else if err != nil {\n                log.Fatal(err)\n            }\n            src &lt;- record // you might select on ctx.Done().\n        }\n        close(src) // close src to signal workers that no more job are incoming.\n    }()\n\n    // wait for worker group to finish and close out\n    go func() {\n        wg.Wait() // wait for writers to quit.\n        close(out) // when you close(out) it breaks the below loop.\n    }()\n\n    // drain the output\n    for res := range out {\n        fmt.Println(res)\n    }\n\n    fmt.Printf(\"\\n%2fs\", time.Since(start).Seconds())\n}\n\nfunc onSignal(s os.Signal, h func()) {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, s)\n    &lt;-c\n    h()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 95, "user_id": 8893337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3ed98c5b3212f50965bdcd10c311be9?s=128&d=identicon&r=PG&f=1", "display_name": "qweqweqweqweqw", "link": "https://stackoverflow.com/users/8893337/qweqweqweqweqw"}, "is_accepted": false, "score": 0, "last_activity_date": 1559018011, "creation_date": 1559018011, "answer_id": 56335039, "question_id": 56325466, "link": "https://stackoverflow.com/questions/56325466/process-large-csv-file-and-limit-goroutines/56335039#56335039", "title": "Process large csv file and limit goroutines", "body": "<p>buffered channel can help you to limit goroutines</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var taskPipe = make(chan interface{}, 5)\n\nfunc main(){\n    go func() {\n        taskPipe &lt;- nil\n        sleep\n    }()\n}\n\nfunc sleep() {\n    time.Sleep(time.Second * 5)\n    &lt;- taskPipe\n}\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 1538434, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/426d9706bd2220ae9eefb5b1683d368c?s=128&d=identicon&r=PG", "display_name": "Ilan", "link": "https://stackoverflow.com/users/1538434/ilan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "accepted_answer_id": 56328323, "answer_count": 3, "score": 2, "last_activity_date": 1559018011, "creation_date": 1558957616, "last_edit_date": 1558957698, "question_id": 56325466, "link": "https://stackoverflow.com/questions/56325466/process-large-csv-file-and-limit-goroutines", "title": "Process large csv file and limit goroutines", "body": "<p>I'm trying to find the best efficient way to read a csv file (~1M row).\nEach row contain a HTTP link to an image which I need to download.</p>\n\n<p>This is my current code using worker pools:</p>\n\n<pre><code>func worker(queue chan []string, worknumber int, done, ks chan bool) {\n    for true {\n        select {\n        case url := &lt;-queue:\n            fmt.Println(\"doing work!\", url, \"worknumber\", worknumber)\n            processData(url) // HTTP download\n            done &lt;- true\n        case &lt;-ks:\n            fmt.Println(\"worker halted, number\", worknumber)\n            return\n        }\n    }\n}\n\nfunc main() {\n    start := time.Now()\n    flag.Parse()\n    fmt.Print(strings.Join(flag.Args(), \"\\n\"))\n    if *filename == \"REQUIRED\" {\n        return\n    }\n\n    csvfile, err := os.Open(*filename)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    count, _ := lineCounter(csvfile)\n    fmt.Printf(\"Total count: %d\\n\", count)\n    csvfile.Seek(0, 0)\n\n    defer csvfile.Close()\n\n    //bar := pb.StartNew(count)\n    bar := progressbar.NewOptions(count)\n    bar.RenderBlank()\n\n    reader := csv.NewReader(csvfile)\n\n    //channel for terminating the workers\n    killsignal := make(chan bool)\n\n    //queue of jobs\n    q := make(chan []string)\n    // done channel takes the result of the job\n    done := make(chan bool)\n\n    numberOfWorkers := *numChannels\n    for i := 0; i &lt; numberOfWorkers; i++ {\n        go worker(q, i, done, killsignal)\n    }\n\n    i := 0\n    for {\n        record, err := reader.Read()\n        if err == io.EOF {\n            break\n        } else if err != nil {\n            fmt.Println(err)\n            return\n        }\n        i++\n\n        go func(r []string, i int) {\n            q &lt;- r\n            bar.Add(1)\n        }(record, i)\n    }\n\n    // a deadlock occurs if c &gt;= numberOfJobs\n    for c := 0; c &lt; count; c++ {\n        &lt;-done\n    }\n\n    fmt.Println(\"finished\")\n\n    // cleaning workers\n    close(killsignal)\n    time.Sleep(2 * time.Second)\n\n    fmt.Printf(\"\\n%2fs\", time.Since(start).Seconds())\n}\n</code></pre>\n\n<p>My issue here is that it opens a lot of goroutines, use all the memory and crash.</p>\n\n<p>What would be the best way to limit it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1558956273, "post_id": 56325072, "comment_id": 99257758, "body": "Have you tried anything so far? Something like this is extremely trivial to do, just look at the introduction to slices, and check out <code>strings.Split</code>, you should be able to work it out yourself"}, {"owner": {"reputation": 13, "user_id": 7336228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fxdIXBMYloc/AAAAAAAAAAI/AAAAAAAAEy0/yrkBzd0E_gE/photo.jpg?sz=128", "display_name": "abdullah mohamed", "link": "https://stackoverflow.com/users/7336228/abdullah-mohamed"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1559044440, "post_id": 56325072, "comment_id": 99288362, "body": "actualy yes , and i made an implode function to do that , but it adds , after every tag and i want to change the , before the last tag"}], "answers": [{"tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 1, "last_activity_date": 1559047533, "creation_date": 1559047533, "answer_id": 56342608, "question_id": 56325072, "link": "https://stackoverflow.com/questions/56325072/adding-semicolon-in-array-of-booksname-after-each-bookname-how-to-change-the-l/56342608#56342608", "title": "Adding Semicolon in array of booksName after each BookName , How to change the last semicolon to (And)", "body": "<p>Right, so this is really quite a simple thing to do (As I said in the comments):</p>\n\n<pre><code>books := []string{\"title 1\", \"title 2\", \"title 3\"}\nlist := fmt.Sprintf(\n    \"%s and %s\",\n    strings.Join(books[:len(books)-1], \", \"), // join all elements with , excluding last one|\n    books[len(books)-1], // last element in slice\n)\n</code></pre>\n\n<h1><a href=\"https://play.golang.org/p/gFhw3h_ZbzL\" rel=\"nofollow noreferrer\">Demo</a></h1>\n\n<p>How it works:</p>\n\n<ul>\n<li><code>strings.Join</code> is part of the standard package <code>strings</code>, which does what your home-grown <code>impode</code> function does. No need to write it yourself</li>\n<li><code>books[:len(books)-1]</code> <em>\"creates\"</em> a new slice containing all elements in the original slice, excluding the last one. Joining these elements with comma's is what you want. You just want an <code>and</code> bit between this and the last element in the slice.</li>\n<li><code>books[len(books)-1]</code> gets the last element in the slice</li>\n<li><code>fmt.Sprintf(\"%s and %s\"</code>: this creates a string where the first part is the comma separated list created by <code>strings.Join</code>, and the second part is the last element in the slice.</li>\n</ul>\n\n<p>Together this yields <code>\"title 1, title 2 and title 3\"</code></p>\n"}], "owner": {"reputation": 13, "user_id": 7336228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fxdIXBMYloc/AAAAAAAAAAI/AAAAAAAAEy0/yrkBzd0E_gE/photo.jpg?sz=128", "display_name": "abdullah mohamed", "link": "https://stackoverflow.com/users/7336228/abdullah-mohamed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 56342608, "answer_count": 1, "score": 0, "last_activity_date": 1559047533, "creation_date": 1558956107, "question_id": 56325072, "link": "https://stackoverflow.com/questions/56325072/adding-semicolon-in-array-of-booksname-after-each-bookname-how-to-change-the-l", "title": "Adding Semicolon in array of booksName after each BookName , How to change the last semicolon to (And)", "body": "<p>I need and example for adding (semicolon) after each bookName in array of bookName , and change the last semicolon to (and) ,\nWhat i have is {\"me befor you\",\"fallen\",\"inferno\"}\nwhat i need as a result is (me befor you , fallen and inferno)</p>\n"}, {"tags": ["json", "pointers", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1558958651, "last_edit_date": 1558958651, "creation_date": 1558953823, "answer_id": 56324510, "question_id": 56324288, "link": "https://stackoverflow.com/questions/56324288/difference-between-missing-and-empty-fields-on-json-unmarshalling/56324510#56324510", "title": "Difference between missing and empty fields on JSON unmarshalling", "body": "<p>Go's primitive data types are not suitable to handle the \"all valid values\" and an additional \"is present\" information.</p>\n\n<p>If you do need this, one way is to use pointers, where the <code>nil</code> pointer value corresponds to the \"missing\" state.</p>\n\n<p>If it is uncomfortable to work with pointers afterwards, do a \"post processing\": convert your structs with pointer fields to a struct value with non-pointer fields, so you can work with that later on.</p>\n\n<p>You may do this \"manually\", or write a custom unmarshaler to make this happen automatically.</p>\n\n<p>Here's an example how to do it:</p>\n\n<pre><code>type PCar struct {\n    Name  *string `json:\"name\"`\n    Speed *int    `json:\"speed\"`\n}\n\ntype Car struct {\n    Name  string `json:\"-\"`\n    Speed int    `json:\"-\"`\n    PCar\n}\n\nfunc (c *Car) UnmarshalJSON(data []byte) error {\n    if err := json.Unmarshal(data, &amp;c.PCar); err != nil {\n        return err\n    }\n\n    if c.PCar.Name != nil {\n        c.Name = *c.PCar.Name\n    }\n    if c.PCar.Speed != nil {\n        c.Speed = *c.PCar.Speed\n    }\n    return nil\n}\n</code></pre>\n\n<p>Example using it:</p>\n\n<pre><code>sources := []string{\n    `{\"name\": \"\", \"speed\": 0}`,\n    `{}`,\n    `{\"name\": \"Bob\", \"speed\": 21}`,\n}\n\nfor i, src := range sources {\n    var c Car\n    if err := json.Unmarshal([]byte(src), &amp;c); err != nil {\n        panic(err)\n    }\n    fmt.Println(\"car\", i, c)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/X0KQ6mdJG6W\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>car 0 { 0 {0x40c200 0x4140ac}}\ncar 1 { 0 {&lt;nil&gt; &lt;nil&gt;}}\ncar 2 {Bob 21 {0x40c218 0x41410c}}\n</code></pre>\n\n<p>As you can see, <code>car 1</code> contains 2 non-<code>nil</code> pointers, because the respective fields were present in the input JSON, while <code>car 2</code> contains 2 <code>nil</code> pointers, because those fields were missing in its input. You may use <code>Car.Name</code> and <code>Car.Speed</code> fields as non-pointers (because they are not pointers). To tell if they were present in the input, you may check the corresponding pointers <code>Car.PCar.Name</code> and <code>Car.PCar.Speed</code> if they are <code>nil</code>.</p>\n"}], "owner": {"reputation": 3597, "user_id": 7946807, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UkEte.png?s=128&g=1", "display_name": "Schidu Luca", "link": "https://stackoverflow.com/users/7946807/schidu-luca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 56324510, "answer_count": 1, "score": 0, "last_activity_date": 1558958651, "creation_date": 1558952977, "last_edit_date": 1558954840, "question_id": 56324288, "link": "https://stackoverflow.com/questions/56324288/difference-between-missing-and-empty-fields-on-json-unmarshalling", "title": "Difference between missing and empty fields on JSON unmarshalling", "body": "<p>So I have this struct in Go:</p>\n\n<pre><code>type Car struct {\n    Name  string `json:\"name\"`\n    Speed int    `json:\"speed\"`\n}\n</code></pre>\n\n<p>And I have two JSON samples that I unmarshal:</p>\n\n<pre><code>str := `{\"name\": \"\", \"speed\": 0}`\nstrTwo := `{}`\n</code></pre>\n\n<p>I do the unmarshaling in this way:</p>\n\n<pre><code>car := Car{}\n_ = json.Unmarshal([]byte(str), &amp;car)\n\ncarTwo := Car{}\n_ = json.Unmarshal([]byte(strTwo), &amp;carTwo)\n</code></pre>\n\n<p>Now because of the way Go deals with default value types, when I try to print the structure, I get the same result:</p>\n\n<pre><code>car - { 0}\ncarTwo - { 0}\n</code></pre>\n\n<p>So I can't see the difference between a missing value in JSON and when a default value is passed. How can I solve this problem?</p>\n\n<p>One way is to use pointers in struct:</p>\n\n<pre><code>type Car struct {\n    Name  *string `json:\"name\"`\n    Speed *int    `json:\"speed\"`\n}\n</code></pre>\n\n<p>But I get a very ugly code when using this values, I have to do pointer dereferencing everywhere</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1558953030, "post_id": 56324276, "comment_id": 99256217, "body": "What have you tried? Include your code. What specific problem do you need help with?"}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558955397, "post_id": 56324276, "comment_id": 99257330, "body": "@Flimzy I added what I tried."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1558956726, "post_id": 56324276, "comment_id": 99257996, "body": "you expect 1,2,4. Why is there no 3 in your list?"}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1558956858, "post_id": 56324276, "comment_id": 99258062, "body": "@apxp I don&#39;t want <code>3</code> but want single items."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1558957035, "post_id": 56324276, "comment_id": 99258143, "body": "I would change the map definition. Do not just check with <code>bool</code> make it an <code>int</code> and count how often the value is inside your slice."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1558957259, "post_id": 56324276, "comment_id": 99258260, "body": "Here you go: <a href=\"https://play.golang.org/p/ESFLhC4VC-l\" rel=\"nofollow noreferrer\">play.golang.org/p/ESFLhC4VC-l</a>"}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 0, "creation_date": 1558957095, "post_id": 56325211, "comment_id": 99258172, "body": "Thank you for your answer. But I want the single count. Not include duplicate data itself."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 1, "last_activity_date": 1558957889, "last_edit_date": 1558957889, "creation_date": 1558956663, "answer_id": 56325211, "question_id": 56324276, "link": "https://stackoverflow.com/questions/56324276/how-to-get-single-items-count-in-a-slice-with-go/56325211#56325211", "title": "How to get single items count in a slice with go?", "body": "<p>I suppose a really easy &amp; quick way to get the count of unique values would be to use a map:</p>\n\n<pre><code>data := map[int]bool{}\ncnt := 0 // count of unique values\nfor _, i := range intSlice {\n    if dup, ok := data[i]; !ok {\n        // we haven't seen value i before, assume it's unique\n        data[i] = false // add to map, mark as non-duplicate\n        cnt++ // increment unique count\n    } else if !dup {\n        // we have seen value i before, but this is only the second time\n        cnt-- // unique count goes down here\n        data[i] = true // mark this value as known duplicate\n    }\n}\n</code></pre>\n\n<p>At the end of this loop, you'll have <code>cnt</code> with the count of unique values, and you can iterate the map <code>data</code> for all keys with value <code>false</code> to get the unique values that you found in the slice. All keys combined basically are the values in the slice, de-duplicated.</p>\n"}, {"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 1, "last_activity_date": 1558957398, "creation_date": 1558957398, "answer_id": 56325400, "question_id": 56324276, "link": "https://stackoverflow.com/questions/56324276/how-to-get-single-items-count-in-a-slice-with-go/56325400#56325400", "title": "How to get single items count in a slice with go?", "body": "<p>I just changed your function a little bit:</p>\n\n<pre><code>func removeDuplicateItems() {\n    intSlice := []int{1, 2, 3, 3, 4}\n    fmt.Println(intSlice)\n\n    keys := make(map[int]int)\n    list := []int{}\n    for _, entry := range intSlice {\n        keys[entry]++\n    }\n    for k, v := range keys {\n        if v == 1 {\n            list = append(list, k)\n        }\n    }\n\n    fmt.Println(list)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ESFLhC4VC-l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ESFLhC4VC-l</a></p>\n\n<p>At this point the list is not sorted. If you want to sort your list afterward you need to use the <code>sort</code>package.</p>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 0, "accepted_answer_id": 56325400, "answer_count": 2, "score": -2, "last_activity_date": 1558957889, "creation_date": 1558952944, "last_edit_date": 1558955368, "question_id": 56324276, "link": "https://stackoverflow.com/questions/56324276/how-to-get-single-items-count-in-a-slice-with-go", "title": "How to get single items count in a slice with go?", "body": "<p>For example, this is a slice:</p>\n\n<pre><code>[1, 2, 3, 3, 4]\n</code></pre>\n\n<p>want to get single data <code>1, 2, 4</code> 's count and return <code>count = 3</code>.</p>\n\n<p>Maybe remove duplicate items(include itself) is an idea, but didn't find suitalbe method.</p>\n\n<hr>\n\n<p>What I tried:</p>\n\n<pre><code>  func removeDuplicateItems() {\n      intSlice := []int{1, 2, 3, 3, 4}\n      fmt.Println(intSlice)\n\n      keys := make(map[int]bool)\n      list := []int{}\n      for _, entry := range intSlice {\n          if _, value := keys[entry]; !value {\n              keys[entry] = true\n              list = append(list, entry)\n          }\n      }\n\n      fmt.Println(list)\n  }\n</code></pre>\n\n<p>Got</p>\n\n<pre><code>[1 2 3 3 4]\n[1 2 3 4]\n</code></pre>\n"}, {"tags": ["sorting", "go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1558952008, "post_id": 56323919, "comment_id": 99255695, "body": "Then you have to do some programming. A simple foor loop is fone or use sort.IsSorted."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1558951956, "creation_date": 1558951956, "answer_id": 56324007, "question_id": 56323919, "link": "https://stackoverflow.com/questions/56323919/how-to-check-if-slice-of-custom-struct-is-sorted/56324007#56324007", "title": "How to check if slice of custom struct is sorted?", "body": "<p>If your type implements <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"noreferrer\"><code>sort.Interface</code></a>, simply use the <a href=\"https://golang.org/pkg/sort/#IsSorted\" rel=\"noreferrer\"><code>sort.IsSorted()</code></a> function.</p>\n\n<p>If not, you may use <a href=\"https://golang.org/pkg/sort/#SliceIsSorted\" rel=\"noreferrer\"><code>sort.SliceIsSorted()</code></a>, passing a <code>less()</code> function which decides / specifies the order(ing):</p>\n\n<pre><code>sortedByName := sort.SliceIsSorted(p, func(i, j int) bool {\n    return p[i].Name &lt; p[j].Name\n})\nfmt.Println(\"Sorted by name:\", sortedByName)\n\nsortedByLastName := sort.SliceIsSorted(p, func(i, j int) bool {\n    return p[i].LastName &lt; p[j].LastName\n})\nfmt.Println(\"Sorted by last name:\", sortedByLastName)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/aO8xDLPiuXs\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Sorted by name: false\nSorted by last name: true\n</code></pre>\n\n<p>If you look into the implementation of these functions, they use a simple loop to iterate over the elements and tell if the ones being next to each other does not violate the ordering (<code>less()</code> function). You may just as easily use a for loop too.</p>\n"}], "owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 2, "accepted_answer_id": 56324007, "answer_count": 1, "score": 2, "last_activity_date": 1558952496, "creation_date": 1558951683, "last_edit_date": 1558952496, "question_id": 56323919, "link": "https://stackoverflow.com/questions/56323919/how-to-check-if-slice-of-custom-struct-is-sorted", "title": "How to check if slice of custom struct is sorted?", "body": "<p>We can check if a slice of strings is sorted with </p>\n\n<pre><code>var slice = []string { \"a\", \"b }\n\nsort.StringsAreSorted(slice)\n</code></pre>\n\n<p>But what about when you have struct and you want to know if a slice of that struct is sorted by a certain member?</p>\n\n<pre><code>type Person struct {\n  Name string\n  LastName string\n}\n\nvar p = []Person{ {\"John\", \"Smith\" }, { \"Ben\", \"Smith\" } }\n\nsort.StringsAreSorted(p???)\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 10378365, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-I9TdvOryG2o/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNEnLKrlpOkwo7lKzwIXdklhtaeew/mo/photo.jpg?sz=128", "display_name": "Lin Corey", "link": "https://stackoverflow.com/users/10378365/lin-corey"}, "edited": false, "score": 0, "creation_date": 1558952277, "post_id": 56323960, "comment_id": 99255829, "body": "But why after executing &quot;go get github.com/hyperledger/fabric-sdk-go&quot; successfully, the dependencies were still missing? I can&#39;t understand. Until later I executed &quot;go get ./...&quot;, all dependencies exist under $GOPATH/src"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1558951807, "creation_date": 1558951807, "answer_id": 56323960, "question_id": 56323712, "link": "https://stackoverflow.com/questions/56323712/how-to-download-all-the-dependencies-of-fabric-sdk-go/56323960#56323960", "title": "How to download all the dependencies of fabric-sdk-go?", "body": "<blockquote>\n  <ol>\n  <li>Does \"go get\" download dependencies recursively or not?</li>\n  </ol>\n</blockquote>\n\n<p>Yes it does. No need to worry or doubt the documentation</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>How to download all the dependencies of fabric-sdk-go, instead of using \"go get [a_dependency_package]\" to download every single dependency one by one?</li>\n  </ol>\n</blockquote>\n\n<p>Just use go modules: <code>export GO111MODULE=on</code> and build your code.</p>\n"}, {"tags": [], "owner": {"reputation": 430, "user_id": 11352925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f73f694f6a5663aa1b97e893bfc095c?s=128&d=identicon&r=PG&f=1", "display_name": "lindluni", "link": "https://stackoverflow.com/users/11352925/lindluni"}, "is_accepted": true, "score": 3, "last_activity_date": 1559189085, "creation_date": 1559189085, "answer_id": 56371468, "question_id": 56323712, "link": "https://stackoverflow.com/questions/56323712/how-to-download-all-the-dependencies-of-fabric-sdk-go/56371468#56371468", "title": "How to download all the dependencies of fabric-sdk-go?", "body": "<p>There is no entry point in the root of the project (i.e. no main method) so there is nowhere for the tool to start looking as it doesn't actually do recursive downloads. Instead it looks at the files in the directory you named in the URL and fetches import paths named in those files. For future reference this command will do what you want it to, <code>go get github.com/hyperledger/fabric-sdk-go/...</code> you can append the triple dot right to your <code>go get</code> command</p>\n"}], "owner": {"reputation": 91, "user_id": 10378365, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-I9TdvOryG2o/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNEnLKrlpOkwo7lKzwIXdklhtaeew/mo/photo.jpg?sz=128", "display_name": "Lin Corey", "link": "https://stackoverflow.com/users/10378365/lin-corey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 56371468, "answer_count": 2, "score": -2, "last_activity_date": 1566138161, "creation_date": 1558950966, "question_id": 56323712, "link": "https://stackoverflow.com/questions/56323712/how-to-download-all-the-dependencies-of-fabric-sdk-go", "title": "How to download all the dependencies of fabric-sdk-go?", "body": "<p>I used command \"<strong>go get github.com/hyperledger/fabric-sdk-go</strong>\" to download fabric-sdk-go and its dependencies. No error happened.</p>\n\n<p>In the golang documentation( <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies</a> ), it said that \"Get downloads the packages named by the import paths, along with their dependencies. It then installs the named packages, like 'go install'.\"</p>\n\n<p>So I originally thought that all the dependencies of fabric-sdk-go would be downloaded <strong>recursively</strong>. But the fact proved that I was wrong.</p>\n\n<p>When I ran command \"go install ./...\" under fabric-sdk-go directory, many errors \"cannot find package\" were displayed:\n<a href=\"https://i.stack.imgur.com/nlrwu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nlrwu.png\" alt=\"enter image description here\"></a>\nSo my questions are:</p>\n\n<ol>\n<li><p>Does \"go get\" download dependencies <strong>recursively</strong> or not?</p></li>\n<li><p>How to download <strong>all</strong> the dependencies of fabric-sdk-go, instead of using \"go get [a_dependency_package]\" to download every single dependency one by one?</p></li>\n</ol>\n\n<p>Thanks very much.</p>\n"}, {"tags": ["image", "file", "go", "gif"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1558949698, "post_id": 56323293, "comment_id": 99254652, "body": "&quot;The out.gif can&#39;t be open[ed]&quot; is not a problem description."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1558949789, "post_id": 56323293, "comment_id": 99254695, "body": "What do you mean it can&#39;t be opened? How are you trying to open it? What error message, or other output do you see?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1558950589, "post_id": 56323293, "comment_id": 99255046, "body": "Don&#39;t ignore errors, especially if you have a problem!"}, {"owner": {"reputation": 23, "user_id": 7273773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JOSKt.jpg?s=128&g=1", "display_name": "YangYang", "link": "https://stackoverflow.com/users/7273773/yangyang"}, "edited": false, "score": 0, "creation_date": 1558952452, "post_id": 56323293, "comment_id": 99255915, "body": "If I try to open the outfile out.gif by Windows default program, it gives me a tip:Can&#39;t open this file. Maybe the system think out.gif is not a valid gif file."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1559720621, "last_edit_date": 1559720621, "creation_date": 1558950974, "answer_id": 56323714, "question_id": 56323293, "link": "https://stackoverflow.com/questions/56323293/go-generated-animated-gifs-didnt-work-in-windows/56323714#56323714", "title": "Go-generated animated GIFs didn&#39;t work in windows", "body": "<p>The GIF file (the gif data) is a binary format, not textual. Attempting to write it to the standard output and redirecting that to a file may suffer transformations. For example, the Windows PowerShell most likely converts some control characters (like <code>\"\\n\"</code> to <code>\"\\r\\n\"</code>), so the resulting binary will not be identical to what <a href=\"https://golang.org/pkg/image/gif/#EncodeAll\" rel=\"nofollow noreferrer\"><code>gif.EncodeAll()</code></a> writes to the standard output. Apparently <code>cmd.exe</code> does not do such transformations.</p>\n\n<p>I recommend writing to a file directly (you may pass an <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a> as the output), or an in-memory buffer which you can dump to a file using <a href=\"https://golang.org/pkg/io/ioutil/#WriteFile\" rel=\"nofollow noreferrer\"><code>ioutil.WriteFile()</code></a>.</p>\n\n<p>Here's how writing directly to a file could look like:</p>\n\n<pre><code>f, err := os.Create(\"a.gif\")\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\nlissajous(f)\n</code></pre>\n\n<p>Here's how the in-memory solution could look like:</p>\n\n<pre><code>buf := &amp;bytes.Buffer{}\nlissajous(buf)\nif err := ioutil.WriteFile(\"a.gif\", buf.Bytes(), 0666); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>See related issue: <a href=\"https://github.com/golang/go/issues/13746\" rel=\"nofollow noreferrer\">image/gif: result of EncodeAll not viewable in Eye of GNOME</a></p>\n\n<p>There is still a chance the result won't be readable by some apps (see above issue), which can be fixed by converting the output image in unix with the following command:</p>\n\n<pre><code>convert original.gif -coalesce unoptimized.gif\n</code></pre>\n\n<p>Source: <a href=\"https://askubuntu.com/questions/887187/fix-animated-gif-images-which-eog-cant-open-but-firefox-and-imagemagick-can\">Fix animated GIF images which eog can't open, but Firefox and ImageMagick can</a></p>\n"}], "owner": {"reputation": 23, "user_id": 7273773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JOSKt.jpg?s=128&g=1", "display_name": "YangYang", "link": "https://stackoverflow.com/users/7273773/yangyang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 56323714, "answer_count": 1, "score": -1, "last_activity_date": 1559720621, "creation_date": 1558949446, "last_edit_date": 1558967495, "question_id": 56323293, "link": "https://stackoverflow.com/questions/56323293/go-generated-animated-gifs-didnt-work-in-windows", "title": "Go-generated animated GIFs didn&#39;t work in windows", "body": "<p>I found an example didn't work properly in Windows.\nThis program demonstrates basic usage of Go's standard image packages, which we'll use to create a sequence of bit-mapped images and then encode the sequence as a GIF animation.</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/gif\"\n    \"io\"\n    \"math\"\n    \"math/rand\"\n    \"os\"\n)\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\n//!+main\n\nvar palette = []color.Color{color.White, color.Black}\n\nconst (\n    whiteIndex = 0 // first color in palette\n    blackIndex = 1 // next color in palette\n)\n\nfunc main() {\n    //!-main\n    // The sequence of images is deterministic unless we seed\n    // the pseudo-random number generator using the current time.\n    // Thanks to Randall McPherson for pointing out the omission.\n    rand.Seed(time.Now().UTC().UnixNano())\n\n    if len(os.Args) &gt; 1 &amp;&amp; os.Args[1] == \"web\" {\n        //!+http\n        handler := func(w http.ResponseWriter, r *http.Request) {\n            lissajous(w)\n        }\n        http.HandleFunc(\"/\", handler)\n        //!-http\n        log.Fatal(http.ListenAndServe(\"localhost:8000\", nil))\n        return\n    }\n    //!+main\n    lissajous(os.Stdout)\n}\n\nfunc lissajous(out io.Writer) {\n    const (\n        cycles  = 5     // number of complete x oscillator revolutions\n        res     = 0.001 // angular resolution\n        size    = 100   // image canvas covers [-size..+size]\n        nframes = 64    // number of animation frames\n        delay   = 8     // delay between frames in 10ms units\n    )\n    freq := rand.Float64() * 3.0 // relative frequency of y oscillator\n    anim := gif.GIF{LoopCount: nframes}\n    phase := 0.0 // phase difference\n    for i := 0; i &lt; nframes; i++ {\n        rect := image.Rect(0, 0, 2*size+1, 2*size+1)\n        img := image.NewPaletted(rect, palette)\n        for t := 0.0; t &lt; cycles*2*math.Pi; t += res {\n            x := math.Sin(t)\n            y := math.Sin(t*freq + phase)\n            img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5),\n                blackIndex)\n        }\n        phase += 0.1\n        anim.Delay = append(anim.Delay, delay)\n        anim.Image = append(anim.Image, img)\n    }\n    gif.EncodeAll(out, &amp;anim) // NOTE: ignoring encoding errors\n}\n</code></pre>\n\n<p>The code runs properly in cmd, however, if I run it in Windows Power Shell like:</p>\n\n<pre><code>.\\lissajous.exe &gt;out.gif\n</code></pre>\n\n<p>The out.gif can't be opened and I don't know why.</p>\n"}, {"tags": ["performance", "go", "memory"], "comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 1, "creation_date": 1558945141, "post_id": 56321624, "comment_id": 99252407, "body": "Can you please add labels to X &amp; Y axis on the graph"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1558945247, "post_id": 56321624, "comment_id": 99252456, "body": "Two comments.  First, what specifically is your question?  Do you want to know how to trace a memory leak?  Second, you haven&#39;t shown a minimal example or indeed any code.  So it&#39;s difficult to guess what is going on"}, {"owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "edited": false, "score": 1, "creation_date": 1558958298, "post_id": 56321624, "comment_id": 99258797, "body": "&quot;<code>The server had a huge amount of RAM. Although obviously more memory is used when the file is loaded, no limits are hit</code>&quot;. How about CPU cache size limit? E.g. maybe loading the data causes all other data to get pushed out of the cache (and makes code using the other data slower due to cache misses)."}, {"owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "edited": false, "score": 0, "creation_date": 1559026929, "post_id": 56321624, "comment_id": 99279010, "body": "Updated the question with labels on the axes and an explicit question."}, {"owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "reply_to_user": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "edited": false, "score": 0, "creation_date": 1559027220, "post_id": 56321624, "comment_id": 99279175, "body": "@Brendan Interesting, that is something I had not thought of. But I do not believe that is what I am running into. The part of the code that is running more slowly consists of file reading and writing, without any previous data involved."}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "edited": false, "score": 0, "creation_date": 1559030163, "post_id": 56325449, "comment_id": 99280659, "body": "Why read the data before I need it: to fail (or warn) fast if it is not of the expected format."}, {"owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "edited": false, "score": 0, "creation_date": 1559030294, "post_id": 56325449, "comment_id": 99280746, "body": "I read the 2 million records in memory because they are not in the order I need them to be. The way I circumvented the problem up to now was by reading the records, sorting them and writing them again (using gob). They can then be removed from memory and streamed."}, {"owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "edited": false, "score": 0, "creation_date": 1559032640, "post_id": 56325449, "comment_id": 99281816, "body": "Disabling garbage collection indeed solved the performance degradation. Would the <code>sync.Pool</code> be the preferred solution for a production environment? I have a lot of data that needs to be kept in memory throughout the whole run."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "edited": false, "score": 1, "creation_date": 1559037271, "post_id": 56325449, "comment_id": 99284450, "body": "@Socci: I don&#39;t have enough information to tell you whether or not <code>sync.Pool</code> is the best solution here. Getting something from the pool requires runtime type assertions, so you may end up wrapping the data into a type, and assert it to an interface, so you only need to do that once, so yeah, that could be a solution. I&#39;d try and tweak the <code>GOGC</code> value, too, and compare"}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 1, "last_activity_date": 1558957560, "creation_date": 1558957560, "answer_id": 56325449, "question_id": 56321624, "link": "https://stackoverflow.com/questions/56321624/large-memory-usage-slows-down-unrelated-code/56325449#56325449", "title": "Large memory usage slows down unrelated code", "body": "<p>So if I get this right, your flow looks something like this:</p>\n\n<ol>\n<li>Read 2 million rows from CSV into map -> struct</li>\n<li>Run part A (which doesn't need data from CSV)</li>\n<li>Run part B, using data from CSV</li>\n</ol>\n\n<p>Why read the data before you need it, would be the first question, but that's perhaps besides the point.</p>\n\n<p>What is likely is that 2 million structs in a map are routinely being accessed by the garbage collector, actually. Depending on what value <code>GOGC</code> has, the pacer component of the garbage collector is likely to kick in more often as the amount of memory allocated increases. Because this map is set aside for later use, there's nothing for the GC to do, but it's taking up cycles in checking the data regardless. There's a number of things you could do to verify, and account for this behaviour - all of these things should can help you rule out/confirm whether or not garbage collection is slowing you down.</p>\n\n<ul>\n<li>Profile the code (obviously, important for diagnostics) IIRC, the CPU profile shows GC interventions more readily</li>\n<li>Try disabling garbage collection (<code>debug.SetGCPercent(-1)</code>)</li>\n<li>Store the map in a <code>sync.Pool</code>. This is a type designed for you to keep stuff you'll manage manually, and move outside of regular GC cycles.</li>\n<li>Only read the CSV when you need to, don't read it before <em>\"part A\"</em></li>\n<li>Stream the file, instead of reading it in a massive map. 2 million rows, what's the value of reading all of this in memory, rather than reading line by line?</li>\n</ul>\n"}], "owner": {"reputation": 165, "user_id": 5110350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9b71749bd27b3126abd22419f8830fb?s=128&d=identicon&r=PG&f=1", "display_name": "Socci", "link": "https://stackoverflow.com/users/5110350/socci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 56325449, "answer_count": 1, "score": 0, "last_activity_date": 1559026599, "creation_date": 1558942443, "last_edit_date": 1559026599, "question_id": 56321624, "link": "https://stackoverflow.com/questions/56321624/large-memory-usage-slows-down-unrelated-code", "title": "Large memory usage slows down unrelated code", "body": "<p>I am maintaing the code for a Go project that reads and writes a lot of data and that has done so successfully for some time. Recently, I made a change: a CSV file with about 2 million records is loaded in a map with struct values at the beginning of the program. This map is only used in part B, but first part A is executed. And this first part already runs noticeably slower than before (processing time is quadrupled). That is very strange since that part of the logic did not change.\nI have spent a week trying to explain how this can happen. Here are the steps I have taken (when I mention performance, I always refer to part A, which does not include the time to load the data in memory and actually has nothing to do with it):</p>\n\n<ul>\n<li>The program was running on a server inside a Docker container. But I have been able to reproduce it on my laptop without container: the performance indeed decreases compared to when I run it without the data from the file loaded in memory.</li>\n<li>The server had a huge amount of RAM. Although obviously more memory is used when the file is loaded, no limits are hit. I also did not see spikes or other strange patterns in memory usage and disk I/O. For these checks, I have used pprof, htop and iotop.</li>\n<li>When the data is loaded but then the map set to nil, performance is OK again.</li>\n<li>Loading the data in a slice instead of a map reduces the performance decrease from x4 to x2 (but the memory usage is more or less the same as with the map).</li>\n<li>This made me wonder whether the map/slice is accessed somewhere in part A, even though it shouldn\u2019t. The map is stored in a field of a struct type. I checked and this struct is always passed by pointer (including all goroutines). Making it a global variable instead of a pointer field did not solve the issue.</li>\n<li>There is one dependency outside of the standard library. Is the problem caused by the library? It forces some garbage collects. Disabling this does not make a difference. I found another similar library that is unrelated and using this one as a replacement improves performance, but it still takes longer when the data of the file is loaded.</li>\n</ul>\n\n<p>Here I have plotted the metrics with and without the data in memory: <a href=\"https://i.stack.imgur.com/NRNSn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NRNSn.png\" alt=\"enter image description here\"></a></p>\n\n<p>What could cause this effect or how do I find it out?</p>\n"}, {"tags": ["sockets", "go", "networking", "tcp"], "comments": [{"owner": {"reputation": 7193, "user_id": 765971, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2f390fb2ccc9321e41ca5bcd09cb9a9a?s=128&d=identicon&r=PG", "display_name": "SKi", "link": "https://stackoverflow.com/users/765971/ski"}, "edited": false, "score": 0, "creation_date": 1559045673, "post_id": 56319676, "comment_id": 99289039, "body": "Unrelevant, but for avoiding angry calls from system administrators, I recommend to send RST, when you get SYN-ACK from some port. See: &#39;SYN flood attack&#39;."}, {"owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "reply_to_user": {"reputation": 7193, "user_id": 765971, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2f390fb2ccc9321e41ca5bcd09cb9a9a?s=128&d=identicon&r=PG", "display_name": "SKi", "link": "https://stackoverflow.com/users/765971/ski"}, "edited": false, "score": 0, "creation_date": 1559099851, "post_id": 56319676, "comment_id": 99309820, "body": "Thank you for your suggestion. Sending RST seems has been auto done by OS when OS get SYN-ACK.  It does at Windows(check by wireshark) and some Linux machine. I&#39;m not sure if all OS do this automatically"}, {"owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "reply_to_user": {"reputation": 7193, "user_id": 765971, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2f390fb2ccc9321e41ca5bcd09cb9a9a?s=128&d=identicon&r=PG", "display_name": "SKi", "link": "https://stackoverflow.com/users/765971/ski"}, "edited": false, "score": 0, "creation_date": 1559725928, "post_id": 56319676, "comment_id": 99506911, "body": "It seems that <code>net.Dial(&quot;ip4:tcp&quot;, target)</code> will create a row socket. And it will return all packets(any source port) from target ip when read from the raw socket, which make cpu run high I think"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "edited": false, "score": 0, "creation_date": 1559115357, "post_id": 56339660, "comment_id": 99314761, "body": "I do close <code>conn</code> before function call return, sorry for forgetting showing at the sample code."}, {"owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "edited": false, "score": 0, "creation_date": 1559115795, "post_id": 56339660, "comment_id": 99314976, "body": "For answer 2, I don&#39;t really understand.    Even I reuse local ephemeral port, I&#39;ll still run into same problem when I scan port from 1 to 1000 instead of just scanning one port 1000 times.    I think <code>conn.Read(bytes)</code> in loop is the root cause, it return so many packets from targetip that I have to filter match packet from 1000 packets(even more when concurrent is more) in loop.    I wonder if there is a function can read tcp according some filter, something like:    <code>conn.SetFilter(&quot;targetport=12345,ackno=23563324&quot;)   </code>conn.Read(bytes)`"}], "tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": 0, "last_activity_date": 1559037632, "creation_date": 1559037632, "answer_id": 56339660, "question_id": 56319676, "link": "https://stackoverflow.com/questions/56319676/why-i-read-many-response-packet-in-every-goroutine-when-i-send-a-tcp-shake-packe/56339660#56339660", "title": "Why I read many response packet in every goroutine when I send a tcp shake packet(SYN) in many goroutines", "body": "<p>Quick answer:</p>\n\n<ol>\n<li>close <code>conn</code> at the end of the routine. <code>net.Dial(\"ip4:tcp\", targetip)</code> is correct</li>\n<li>reuse local ephemeral port in the socket pairs <code>local:port remote:port</code> when you craft the syn packet</li>\n</ol>\n\n<p>Notes on 1: </p>\n\n<p>Closing <code>conn</code> might not be the best idea, should do <code>2</code> above for these benefits:</p>\n\n<ol>\n<li>not wasting cpu time for closing local ports</li>\n<li>when you make multiple conns to the same addr too quickly and let kernel assign local port, the kernel ip stack might actually <strong>plays up</strong> - for more details, digging in this keyword <code>TCP simultaneous connect</code></li>\n</ol>\n"}], "owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559114637, "creation_date": 1558931234, "last_edit_date": 1559114637, "question_id": 56319676, "link": "https://stackoverflow.com/questions/56319676/why-i-read-many-response-packet-in-every-goroutine-when-i-send-a-tcp-shake-packe", "title": "Why I read many response packet in every goroutine when I send a tcp shake packet(SYN) in many goroutines", "body": "<p>I'm building a port scanner to check if some TCP port at remote machine is open.</p>\n\n<p>To improve performance, I just build and send a TCP SYN packet to remote port instead of doing full 3-way handshake.And if I receive SYN-ACK packet successfully,then that port will be considered as open.</p>\n\n<p>Here is a part of my code:</p>\n\n<pre><code>conn, _:= net.Dial(\"ip4:tcp\", target)\ntcpSynPacket := BuildTcpSynPacket() // here I build a tcp syn packet\nconn.Write(tcpSynPacket.Marshal())\ndeadlineTime := time.NewTicker(time.Second * 2)\ndefer deadlineTime.Stop()\nfor {\n    select {\ncase &lt;-deadlineTime.C:\n    return nil\ndefault:\n        bytes := make([]byte, 128)\n        conn.SetReadDeadline(time.Now().Add(time.Millisecond * 200))\n        readnum, err := conn.Read(bytes)\n        responsePacket := parstTCPHeader(bytes[:readnum])\n        matched := CHECK_IF_RESPONSE_MATCH_REQUEST(tcpSynPacket,responsePacket) // here I'll check if ack-no,src-port,dest-port in tcpSynPacket match seq-no,dest-port,src-port in response packet\n        if !matched {\n            // unmatched packets,may response for another routine\n            continue\n        }\n        if responsePacket.rst_flg == 1 {\n            // the port would be consider as close\n            // build func return struct,and return\n            ....\n        }else {\n            // the port would be consider as open\n            // build func return struct,and return\n            ....\n        }\n}\n</code></pre>\n\n<p>There are not for loop and CHECK_IF_RESPONSE_MATCH_REQUEST statement at old code.But when I do stress test, I found it's necessary.</p>\n\n<p>Let's say we'll test if port 80 is open at 66.220.146.94.I open 1000 goroutines to call above code.</p>\n\n<pre><code>goroutine1: ack-no=11111\n\ngoroutine2: ack-no=22222\n\ngoroutine2: ack-no=33333\n\n...\n</code></pre>\n\n<p>Then I found that in every goroutine,the following statement</p>\n\n<pre><code>readnum, err := conn.Read(bytes)\nresponsePacket := parstTCPHeader(bytes[:readnum])\n</code></pre>\n\n<p>will read all response packet even the read packet do not match the syn packet sent at current goroutine.</p>\n\n<p>For example, at goroutine1, I sent syn packet(ack-no=11111),and read from conn. Then I found the seq-no in read packet could be 11112,22223,33334...\nSo I add a loop and some check logic at CHECK_IF_RESPONSE_MATCH_REQUEST.</p>\n\n<p>But the loop read and check logic make cpu so high.</p>\n\n<p>Here is a test result(I run it every 60 seconds)</p>\n\n<p><a href=\"https://i.stack.imgur.com/rBRb3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rBRb3.png\" alt=\"cpu%-runseconds\"></a></p>\n\n<p>Top 10 cpu cost using 3-way shakehand when open 1000 goroutine(Duration: 60s, Total samples = 780ms ( 1.30%)):</p>\n\n<p><a href=\"https://i.stack.imgur.com/RbSAJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RbSAJ.png\" alt=\"flame graph(3-way shakehand port scan)\"></a></p>\n\n<p>Top 10 cpu cost using tcp syn port scan when open 1000 goroutine(Duration: 60s, Total samples = 30.51s (50.85%)):</p>\n\n<p><a href=\"https://i.stack.imgur.com/snsMQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/snsMQ.png\" alt=\"flame graph(tcp syn port scan)\"></a></p>\n\n<p>What I want to know is that:</p>\n\n<p>1.Why conn.Read(bytes) read all response packets in every goroutine?Is net.Dial(\"ip4:tcp\", targetip) correct?</p>\n\n<p>2.Is there a lower-cost way to do periodic port scan(every 60 seconds) without doing 3-way shakehand</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1558929140, "last_edit_date": 1558929140, "creation_date": 1558928838, "answer_id": 56319440, "question_id": 56319377, "link": "https://stackoverflow.com/questions/56319377/use-channel-to-limit-the-number-of-active-go-routines/56319440#56319440", "title": "Use channel to limit the number of active go routines", "body": "<p>The goroutines block on sending to <code>squares</code>.  Main is not receiving on <code>squares</code> because it blocks on starting the the goroutines.</p>\n\n<p>Fix by moving the code that starts the goroutines to a goroutine.  This allows main to continue executing to the receive on <code>squares</code>.</p>\n\n<pre><code>squares := make(chan int)\ngo func() {\n    max := 2\n    var wg sync.WaitGroup\n    tokens := make(chan struct{}, max)\n    for i := 20; i &gt;= 1; i-- {\n        tokens &lt;- struct{}{}\n        wg.Add(1)\n        go func(n int) {\n            defer func() { &lt;-tokens }()\n            defer wg.Done()\n            fmt.Println(\"run go routine \", getGID())\n            squares &lt;- Square(n)\n\n        }(i)\n    }\n\n    wg.Wait()\n    close(squares)\n}()\n\nfmt.Println(\"About to receive\")\nfor s := range squares {\n    fmt.Println(\"Get square: \", s)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VFINCenQkp4\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 56319440, "answer_count": 1, "score": 0, "last_activity_date": 1558929270, "creation_date": 1558928166, "last_edit_date": 1558929270, "question_id": 56319377, "link": "https://stackoverflow.com/questions/56319377/use-channel-to-limit-the-number-of-active-go-routines", "title": "Use channel to limit the number of active go routines", "body": "<p>I'm reading the \"The Go Programming Language\"\nOne way to limit the number of running go routines is to use a \"counting semaphore\".</p>\n\n<p>The other way is <a href=\"https://stackoverflow.com/questions/55203251/limiting-number-of-go-routines-running\">Limiting number of go routines running</a></p>\n\n<p>I am allowing 2 more go routines in the case. I'm getting deadlock error.\nWhat causes the deadlock in my code?</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    //\"context\"\n    \"fmt\"\n    \"runtime\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    max := 2\n    var wg sync.WaitGroup\n    squares := make(chan int)\n    tokens := make(chan struct{}, max)\n    for i := 20; i &gt;= 1; i-- {\n        tokens &lt;- struct{}{}\n        wg.Add(1)\n        go func(n int) {\n            defer func() { &lt;-tokens }()\n            defer wg.Done()\n            fmt.Println(\"run go routine \", getGID())\n            squares &lt;- Square(n)\n\n        }(i)\n    }\n\n    go func() {\n        wg.Wait()\n        close(squares)\n    }()\n\n    for s := range squares {\n        fmt.Println(\"Get square: \", s)\n\n    }\n}\n\nfunc Square(num int) int {\n    time.Sleep(time.Second * time.Duration(num))\n    fmt.Println(num * num)\n    return num * num\n}\n\nfunc getGID() uint64 {\n    b := make([]byte, 64)\n    b = b[:runtime.Stack(b, false)]\n    b = bytes.TrimPrefix(b, []byte(\"goroutine \"))\n    b = b[:bytes.IndexByte(b, ' ')]\n    n, _ := strconv.ParseUint(string(b), 10, 64)\n    return n\n}\n</code></pre>\n"}, {"tags": ["session", "go", "gorilla", "expired-sessions"], "owner": {"reputation": 1533, "user_id": 1800838, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JJEuD.jpg?s=128&g=1", "display_name": "HippoMan", "link": "https://stackoverflow.com/users/1800838/hippoman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 286, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1558959476, "creation_date": 1558922712, "last_edit_date": 1558959476, "question_id": 56318859, "link": "https://stackoverflow.com/questions/56318859/golang-gorilla-updating-session-expiry", "title": "golang/gorilla: updating session expiry?", "body": "<p>I know how to use gorilla under golang to manage sessions. But what I'm trying to accomplish is to optionally set the session expiry time to a later date at run time, depending upon various application conditions. I haven't been able to figure out how to update this expiry time.</p>\n\n<p>Consider the following code fragment ...</p>\n\n<pre><code>skey  := \"some sort of secret key\"\nsname := \"some sort of session name\"\n\nsession_store := sessions.NewCookieStore([]byte(skey))\nsession_store.Options = &amp;sessions.Options{                                                                                        \n    MaxAge: 300,                                                                                                       \n}\n\n// `r` is previously defined as the current *http.Request\nsess, err := session_store.Get(r, sname)\n</code></pre>\n\n<p>As written, <code>sess</code> will expire 300 seconds after it was initialized. But how can I extend the lifetime of <code>sess</code> before this much time passes, so that its expiry will then occur at a later time?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["go", "linker", "cgo"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1558930214, "post_id": 56318343, "comment_id": 99247545, "body": "Perhaps you can use <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">modules</a>"}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 789095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de76be56cb39f9a3b47424093b9bec07?s=128&d=identicon&r=PG", "display_name": "Harusada", "link": "https://stackoverflow.com/users/789095/harusada"}, "is_accepted": false, "score": 1, "last_activity_date": 1605147918, "last_edit_date": 1605147918, "creation_date": 1605146463, "answer_id": 64796847, "question_id": 56318343, "link": "https://stackoverflow.com/questions/56318343/golang-multiple-definition-of-cgo-ported-package/64796847#64796847", "title": "Golang: multiple definition of CGO ported package", "body": "<p>For the <code>cgo</code>'s issue of linking error &quot;<em>multiple definition of ...</em>&quot;, the (work-around) solution is dependent on the nature of the linked C codes:</p>\n<ol>\n<li><p>If two Go packages link to <strong>the same C codes (libraries)</strong>, you should pass option <code>--allow-multiple-definition</code> to the linker (see <a href=\"https://linux.die.net/man/1/ld\" rel=\"nofollow noreferrer\"><code>ld</code> man page</a>), either via command options</p>\n<p><code>go build --ldflags '-extldflags &quot;-Wl,--allow-multiple-definition&quot;'</code>,</p>\n<p>or via <code>#cgo</code> directive in Go source of the packages linking to C codes:</p>\n<pre><code>//#cgo LDFLAGS: -Wl,--allow-multiple-definition\nimport &quot;C&quot;\n</code></pre>\n</li>\n<li><p>If two Go packages link to <em>different C codes</em> containing <strong>some functions &amp; variables with the same names</strong>, you should <em>refactor</em> those C codes:</p>\n<ul>\n<li>Make sure to put keyword <code>static</code> to all declarations whose usage is within that C object only (not intended to be linked to Go nor to other C objects).</li>\n<li>Find some way to do <em>name mangling</em> or put those duplicated identifiers into different <em>namespaces</em> (like in C++). It would be better if <code>cgo</code> supported some mechanism to do automatic namespacing using Go package name, but until now (2020) you must do it yourself. The C preprocessor's &quot;token pasting&quot; operator <code>##</code> may help in this namespacing task. Eg.\n<pre><code>//File: my_package1.h\n#define NS(id) my_package1_ ## id\nvoid NS(my_function1)(int);\nvoid NS(my_function2)(float);\nchar NS(my_shared_var);\n</code></pre>\n</li>\n</ul>\n</li>\n<li><p>If you have any <strong>C function definition</strong> in the Go source, like in <a href=\"https://stackoverflow.com/q/58606884/789095\">this question</a>, you must move those definitions into a separate C source file under the same package folder, leaving only declarations in the Go source.</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1605147918, "creation_date": 1558916470, "last_edit_date": 1558917673, "question_id": 56318343, "link": "https://stackoverflow.com/questions/56318343/golang-multiple-definition-of-cgo-ported-package", "title": "Golang: multiple definition of CGO ported package", "body": "<p>I have 2 project, the first, name as <code>A</code>, there is a submodule <code>a</code> imported sqlite3(<code>github.com/mattn/go-sqlite3</code>). Another <code>B</code> project import <code>A</code>'s submodule <code>a</code>, and in another submodule <code>b</code>, it also import the same sqlite3.</p>\n\n<p>Both <code>A</code> and <code>B</code> put there imports under <code>vendor</code> dir(managed by <code>govendor</code>). My Golang version is <code>go version go1.12 linux/amd64</code>.</p>\n\n<p>While build <code>B</code> (<code>go build main.go</code>), throwing following errors(too many, part of them):</p>\n\n<pre><code> /usr/local/go/pkg/tool/linux_amd64/link: running gcc failed: exit status 1\n /tmp/go-link-281256755/000029.o: In function `callbackTrampoline':\n /tmp/go-build/_cgo_export.c:25: multiple definition of `callbackTrampoline'\n /tmp/go-link-281256755/000005.o:/tmp/go-build/_cgo_export.c:25: first defined here\n /tmp/go-link-281256755/000029.o: In function `stepTrampoline':\n ...\n /home/xxx/go/src/gitlab.xxxxxxxxx.com/xxxxxxxxx-tools/A/vendor/github.com/mattn/go-sqlite3/sqlite3.go:129: multiple definition of `_sqlite3_result_text'\n /tmp/go-link-281256755/000009.o:/home/xxx/go/src/gitlab.xxxxxxxxx.com/xxxxxxxxx-tools/A/vendor/github.com/mattn/go-sqlite3/sqlite3.go:129: first defined here\n /tmp/go-link-281256755/000033.o: In function `_sqlite3_result_blob':\n ...\n</code></pre>\n\n<p>But building <code>A</code> works well.  To testing the error, I started following demo, also with <code>vendor</code> inited by <code>govendor</code>, and build ok.</p>\n\n<pre><code> package main\n\n import (\n   \"database/sql\"\n   \"fmt\"\n\n   \"gitlab.xxxxxxxxx.com/xxxxxxxxxxxxxxx/A/a\"\n\n   _ \"github.com/mattn/go-sqlite3\"\n )\n\n func main() {\n   fmt.Println(a.ModuleVariable) // use submodule `a` just like B is doing\n\n   _, _ = sql.Open(`sqlite3`, `test.db`) // use sqlite too\n }\n</code></pre>\n\n<p>I think the compiler first compile <code>A</code>'s <code>sqlite3</code>, objects are created under <code>/tmp/go-link-281256755/000005.o</code> (<em>but no this dir after building</em>), then compile <code>B</code>'s importing of <code>sqlite3</code> and also create a object contains the same-name function, then the compiler find 2 same-name symbols, the linking failed.</p>\n\n<p>How to fix these situation? Is there any golang env settings to avoid these?</p>\n\n<hr>\n\n<p>After I remove the sqlite3 package under <code>vendor</code> both of <code>A</code> and <code>B</code>, they both use the sqlite3 under <code>~/go/src/github.com/mattn/go-sqlite3/</code>, they all build ok. But I can't do these, due to project <code>A</code>'s deploy platform, I must put all dependencies under vendor, is there any another option to use multiple import with the same package?</p>\n"}, {"tags": ["xml", "go", "unmarshalling", "xml-attribute"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558946129, "post_id": 56317781, "comment_id": 99252831, "body": "You do not need the struct in your answer, instead in the enum&#39;s unmarshalxmlattr do <code>*E = EnumFoo</code>, not <code>E = &amp;EnumFoo</code>. Doing <code>E = &amp;EnumFoo</code> you are essentially overwriting the pointer value, not the value the pointer points to, and that&#39;s why outside of the method the change is not visible since outside the method the pointer value is the same. That is, a method cannot <i>replace</i> it&#39;s receiver, it can however modify the memory pointed to by the receiver."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558947248, "post_id": 56317781, "comment_id": 99253350, "body": "<a href=\"https://play.golang.com/p/zvs0_iyVq5n\" rel=\"nofollow noreferrer\">play.golang.com/p/zvs0_iyVq5n</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11559217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89f90f9acb324c274cccc9b9c0a9b8a4?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/11559217/david"}, "is_accepted": false, "score": 1, "last_activity_date": 1558942652, "creation_date": 1558942652, "answer_id": 56321656, "question_id": 56317781, "link": "https://stackoverflow.com/questions/56317781/how-to-unmarshal-an-xml-enum-attribute-in-go/56321656#56321656", "title": "How to unmarshal an xml enum attribute in go?", "body": "<p>I solved the problem by wrapping the int in a struct.</p>\n\n<pre><code>type EnumType int\nconst (\n    EnumUnknown EnumType = iota\n    EnumFoo\n    EnumBar\n)\ntype EnumContainer struct {\n    Value EnumType\n}\n\nfunc (E *EnumContainer) UnmarshalXMLAttr(attr xml.Attr) error {\n    switch attr.Value {\n    case \"foo\":\n        E.Value = EnumFoo\n    case \"bar\":\n        E.Value = EnumBar\n    default:\n        E.Value = EnumUnknown\n    }\n    return nil\n}\n\n\n// Example of how the unmarshal could be called:\ntype Tag struct {\n    Attribute EnumContainer `xml:\"attribute,attr\"`\n}\n\nfunc main() {\n    tag := &amp;Tag{}\n    xml.Unmarshal([]byte(\"&lt;tag attribute=\\\"foo\\\"/&gt;\"), tag)\n</code></pre>\n\n<p>Is there a \"more elegant\" way or should I be happy with what I now have?</p>\n"}], "owner": {"reputation": 11, "user_id": 11559217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89f90f9acb324c274cccc9b9c0a9b8a4?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/11559217/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558942693, "creation_date": 1558909045, "last_edit_date": 1558942693, "question_id": 56317781, "link": "https://stackoverflow.com/questions/56317781/how-to-unmarshal-an-xml-enum-attribute-in-go", "title": "How to unmarshal an xml enum attribute in go?", "body": "<p>I want to parse an xml attribute as an iota enum type (int) in go.</p>\n\n<p>Below you can see what I tried but this does not work because the address of enum variables can't be taken.</p>\n\n<pre><code>type EnumType int\nconst (\n    EnumUnknown EnumType = iota\n    EnumFoo\n    EnumBar\n)\n\nfunc (E *EnumType) UnmarshalXMLAttr(attr xml.Attr) error {\n    switch attr.Value {\n    case \"foo\":\n        E = &amp;EnumFoo\n    case \"bar\":\n        E = &amp;EnumBar\n    default:\n        E = &amp;EnumUnknown\n    }\n    return nil\n}\n\n\n// Example of how the unmarshal could be called:\ntype Tag struct {\n    Attribute EnumType `xml:\"attribute,attr\"`\n}\n\nfunc main() {\n    tag := &amp;Tag{}\n    xml.Unmarshal([]byte(\"&lt;tag attribute=\\\"foo\\\"/&gt;\"), tag)\n}\n</code></pre>\n\n<p>Any other way to make <code>UnmarshalXMLAttr</code> work with int types?</p>\n\n<p>Update: I know I can solve this by adding the <code>UnmarshalXML</code> method to Tag but I want to avoid this if possible because I have a lot of different tags with a lot of different attributes but only a few custom typed attributes. So implementing <code>UnmarshalXML</code> methods for each tag would not be preferred.</p>\n"}, {"tags": ["go", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1558906223, "post_id": 56316982, "comment_id": 99243990, "body": "Are the packages the same? The unit test must be in the same package as the definition of <code>server</code>."}, {"owner": {"reputation": 55, "user_id": 11558955, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XMzty7ayQjk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdbffScGvnDvg4iCSo6O2mg4Y_2AA/mo/photo.jpg?sz=128", "display_name": "Junes", "link": "https://stackoverflow.com/users/11558955/junes"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1558907000, "post_id": 56316982, "comment_id": 99244133, "body": "@Mark Yes, They both are in the &quot;main&quot; package."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1558908142, "post_id": 56316982, "comment_id": 99244309, "body": "Based on the referenced SO answer, you need to import your generated protobuf package - typically aliased as <code>pb</code>. And refer to your server RPC methods via the <code>pb</code> package."}, {"owner": {"reputation": 55, "user_id": 11558955, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XMzty7ayQjk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdbffScGvnDvg4iCSo6O2mg4Y_2AA/mo/photo.jpg?sz=128", "display_name": "Junes", "link": "https://stackoverflow.com/users/11558955/junes"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1558909324, "post_id": 56316982, "comment_id": 99244533, "body": "@colminator Thanks. How do I resolve <code>undefined: server</code> error?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1558909919, "post_id": 56316982, "comment_id": 99244622, "body": "Looking again at your code, it seems your <code>service</code> appears to serve the roll of <code>pb</code>, so see @Mark &#39;s comment. The unittest does not have a definition for <code>type server</code> - so ensure the source file that contains the definition top line ( <code>packagw XYZ</code> etc.) matches that of the test .go file."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1558910025, "post_id": 56316982, "comment_id": 99244641, "body": "If they do match in package name - they must also be in the same directory."}], "answers": [{"tags": [], "owner": {"reputation": 1188, "user_id": 300520, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/282efd4afde27a16916568b25c79beb9?s=128&d=identicon&r=PG", "display_name": "maverick", "link": "https://stackoverflow.com/users/300520/maverick"}, "is_accepted": false, "score": 1, "last_activity_date": 1558930359, "creation_date": 1558930359, "answer_id": 56319596, "question_id": 56316982, "link": "https://stackoverflow.com/questions/56316982/how-to-unit-test-grpc-service-in-go/56319596#56319596", "title": "How to unit test gRPC service in go", "body": "<p>Looking at your code organization, It seems that you are coming from Java background putting the src and test in there respective folders. I also struggled with the same when I started writing go. What I learned is it is better to have the src and test in the same package and folder therefore, to make the code idiomatic go and it also resolves any variable/methods references within the same package. So in your tests, you only need to import the pb package.</p>\n\n<p>I will also encourage you to look at <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">https://github.com/golang-standards/project-layout</a> for various code organization techniques in Golang. </p>\n"}], "owner": {"reputation": 55, "user_id": 11558955, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XMzty7ayQjk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdbffScGvnDvg4iCSo6O2mg4Y_2AA/mo/photo.jpg?sz=128", "display_name": "Junes", "link": "https://stackoverflow.com/users/11558955/junes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2617, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558930359, "creation_date": 1558901130, "last_edit_date": 1558910240, "question_id": 56316982, "link": "https://stackoverflow.com/questions/56316982/how-to-unit-test-grpc-service-in-go", "title": "How to unit test gRPC service in go", "body": "<p>I'm having difficulties in unit testing the gRPC service in go.</p>\n\n<p>I looked at <a href=\"https://stackoverflow.com/questions/42102496/testing-a-grpc-service/42103776#42103776\">Testing a gRPC service</a> but it isn't working for me, not sure what I'm doing wrong.</p>\n\n<p><strong>gRPC service implementation for the Add method:</strong></p>\n\n<pre><code>type server struct{}\n\nfunc main() {\n    listener, err := net.Listen(\"tcp\", \":4040\")\n    if err != nil {\n      panic(err)\n    }\n\n    srv := grpc.NewServer()\n    service.RegisterMathOpServiceServer(srv, &amp;server{})\n    reflection.Register(srv)\n\n    if e := srv.Serve(listener); e != nil {\n          panic(e)\n    }\n\n    fmt.Println(\"Service is running on localhost:4040\")\n}\n\nfunc (s *server) Add(ctx context.Context, request *service.AddRequest) \n(*service.AddResponse, error) {\n    a, b := request.GetX(), request.GetY()\n    result := a + b\n\n    return &amp;service.AddResponse{Answer: result}, nil\n}\n</code></pre>\n\n<p><strong>Unit Test for the Add method:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package test\n\nimport (\n    \"context\"\n    pb \"mathOp_service/src/service\"\n    \"testing\"\n)\nfunc TestAddition(t *testing.T) {\n    s := server{}   &lt;-- error occurs here\n    req := pb.AddRequest{X: int64(1), Y: int64(2)}\n    res, err := s.Add(context.Background(), req)\n\n    if res.Answer != 3 {\n        t.Error(\"Expected 1 + 2 to equal 3\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/Mk0mO.png\" rel=\"nofollow noreferrer\">Project Directory structure</a></p>\n\n<p><code>s := server{}</code> throws an error saying <code>undefined: server</code>. </p>\n\n<p>I'm very new to <code>Go</code> and can't find a solution to fix this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 20188, "user_id": 540873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9dcf9bf2f17d3b61fa583595bb0d6?s=128&d=identicon&r=PG", "display_name": "Thomas Jungblut", "link": "https://stackoverflow.com/users/540873/thomas-jungblut"}, "edited": false, "score": 0, "creation_date": 1558891155, "post_id": 56315690, "comment_id": 99240642, "body": "what&#39;s your go version?"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1558922575, "post_id": 56315690, "comment_id": 99246298, "body": "You should probably ask the maintainers of that package"}, {"owner": {"reputation": 1773, "user_id": 374222, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38a95f07d316ba88ee3d01ce77d57304?s=128&d=identicon&r=PG", "display_name": "FunkSoulBrother", "link": "https://stackoverflow.com/users/374222/funksoulbrother"}, "edited": false, "score": 0, "creation_date": 1558943344, "post_id": 56315690, "comment_id": 99251703, "body": "My golang ver is go1.12.2. I discovered that the dependency on libp2p in my project is for version 0.0.23 while &quot;go get&quot; was getting version 0.0.30. Checking if getting version 0.0.23 resolves the problem."}], "answers": [{"tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": false, "score": 2, "last_activity_date": 1558891369, "creation_date": 1558891369, "answer_id": 56315815, "question_id": 56315690, "link": "https://stackoverflow.com/questions/56315690/running-go-get-github-com-libp2p-go-libp2p-results-in-error-messages/56315815#56315815", "title": "Running &quot;go get github.com/libp2p/go-libp2p&quot; results in error messages", "body": "<p>They've been performing a <a href=\"https://github.com/libp2p/go-libp2p/issues/649\" rel=\"nofollow noreferrer\">refactor</a>, which resulted in <a href=\"https://github.com/libp2p/go-libp2p/issues/650\" rel=\"nofollow noreferrer\">this issue</a> being submitted.</p>\n\n<p>A solution was provided:</p>\n\n<p><a href=\"https://i.stack.imgur.com/VhUNU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VhUNU.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n"}], "owner": {"reputation": 1773, "user_id": 374222, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38a95f07d316ba88ee3d01ce77d57304?s=128&d=identicon&r=PG", "display_name": "FunkSoulBrother", "link": "https://stackoverflow.com/users/374222/funksoulbrother"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558891369, "creation_date": 1558890542, "question_id": 56315690, "link": "https://stackoverflow.com/questions/56315690/running-go-get-github-com-libp2p-go-libp2p-results-in-error-messages", "title": "Running &quot;go get github.com/libp2p/go-libp2p&quot; results in error messages", "body": "<p>I'm a beginner with golang. When trying to run \"go get github.com/libp2p/go-libp2p\" I get an error message that prevents me from being able to run tests &amp; benchmarks.</p>\n\n<p>Here is the error:</p>\n\n<blockquote>\n  <p>github.com/libp2p/go-libp2p/p2p/host/routed</p>\n  \n  <p>../../libp2p/go-libp2p/p2p/host/routed/routed.go:153:20: cannot use\n  rh.host.Mux() (type\n  \"github.com/libp2p/go-libp2p-core/protocol\".Switch) as type\n  *multistream.MultistreamMuxer in return argument: need type assertion ../../libp2p/go-libp2p/p2p/host/routed/routed.go:190:5: cannot use\n  (*RoutedHost)(nil) (type *RoutedHost) as type\n  \"github.com/libp2p/go-libp2p-core/host\".Host in assignment:\n          *RoutedHost does not implement \"github.com/libp2p/go-libp2p-core/host\".Host (wrong type for Mux\n  method)\n                  have Mux() *multistream.MultistreamMuxer\n                  want Mux() \"github.com/libp2p/go-libp2p-core/protocol\".Switch</p>\n  \n  <p>github.com/libp2p/go-libp2p/p2p/host/basic</p>\n  \n  <p>../../libp2p/go-libp2p/p2p/host/basic/basic_host.go:145:32: cannot use\n  h (type *BasicHost) as type host.Host in argument to\n  identify.NewIDService:\n          *BasicHost does not implement host.Host (wrong type for Mux method)\n                  have Mux() *multistream.MultistreamMuxer\n                  want Mux() \"github.com/libp2p/go-libp2p-core/protocol\".Switch\n  ../../libp2p/go-libp2p/p2p/host/basic/basic_host.go:172:32: cannot use\n  h (type *BasicHost) as type host.Host in argument to\n  ping.NewPingService:\n          *BasicHost does not implement host.Host (wrong type for Mux method)\n                  have Mux() *multistream.MultistreamMuxer\n                  want Mux() \"github.com/libp2p/go-libp2p-core/protocol\".Switch</p>\n</blockquote>\n\n<p>I don't understand why the error messages. It looks like go-libp2p does not compile. any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1559028582, "post_id": 56314512, "comment_id": 99279834, "body": "That sounds like more of an XML Schema problem than a parsing problem. Those conditionals should actually be handled in the schema, and hence accordingly could be unmarshalled with one struct with conditional embedded structs."}], "answers": [{"comments": [{"owner": {"reputation": 2703, "user_id": 1712880, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/cxC9W.jpg?s=128&g=1", "display_name": "Hamid Mohayeji", "link": "https://stackoverflow.com/users/1712880/hamid-mohayeji"}, "edited": false, "score": 0, "creation_date": 1558902144, "post_id": 56314660, "comment_id": 99243237, "body": "Yes, this is the first thing I tried, but I was looking for a more efficient and elegant solution."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1558885943, "last_edit_date": 1558885943, "creation_date": 1558882995, "answer_id": 56314660, "question_id": 56314512, "link": "https://stackoverflow.com/questions/56314512/conditional-dynamic-struct-tags/56314660#56314660", "title": "Conditional (Dynamic) Struct Tags", "body": "<p>The simplest is probably to handle all possible fields and do some post-processing.</p>\n\n<p>For example:</p>\n\n<pre><code>type MyType struct {\n    DateField1    []string `xml:\"value\"`\n    DateField2    []string `xml:\"anotherValue\"`\n}\n\n// After parsing, you have two options:\n\n// Option 1: re-assign one field onto another:\nif !someCondition {\n    parsed.DateField1 = parsed.DateField2\n    parsed.DateField2 = nil\n}\n\n// Option 2: use the above as an intermediate struct, the final being:\ntype MyFinalType struct {\n    Date    []string `xml:\"value\"`\n}\n\nif someCondition {\n    final.Date = parsed.DateField1\n} else {\n    final.Date = parsed.DateField2\n}\n</code></pre>\n\n<p><strong>Note</strong>: if the messages are sufficiently different, you probably want completely different types for parsing. The post-processing can generate the final struct from either. </p>\n"}, {"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2703, "user_id": 1712880, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/cxC9W.jpg?s=128&g=1", "display_name": "Hamid Mohayeji", "link": "https://stackoverflow.com/users/1712880/hamid-mohayeji"}, "edited": false, "score": 0, "creation_date": 1558932892, "post_id": 56314994, "comment_id": 99248109, "body": "@HamidMohayeji No, you have to write code for each XML schema you have to process."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1558939224, "last_edit_date": 1558939224, "creation_date": 1558885374, "answer_id": 56314994, "question_id": 56314512, "link": "https://stackoverflow.com/questions/56314512/conditional-dynamic-struct-tags/56314994#56314994", "title": "Conditional (Dynamic) Struct Tags", "body": "<p>You use <strong>different</strong> types to unmarshal. Basically, you write the unmarshaling code twice and either run the first version or the second. There is no dynamic solution to this.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1558939500, "creation_date": 1558939500, "answer_id": 56320934, "question_id": 56314512, "link": "https://stackoverflow.com/questions/56314512/conditional-dynamic-struct-tags/56320934#56320934", "title": "Conditional (Dynamic) Struct Tags", "body": "<p>As already indicated, you must duplicate the field. The question is where the duplication should exist.</p>\n\n<p>If it's just a single field of many, one option is to use embedding, and field shadowing:</p>\n\n<pre><code>type MyType struct {\n    Date    []string `xml:\"value\"`\n    // many other fields\n}\n</code></pre>\n\n<p>Then when <code>Date</code> uses the other field name:</p>\n\n<pre><code>type MyOtherType struct {\n    MyType // Embed the original type for all other fields\n    Date     []string `xml:\"anotherValue\"`\n}\n</code></pre>\n\n<p>Then after unmarshaling of <code>MyOtherType</code>, it's easy to move the <code>Date</code> value into the original struct:</p>\n\n<pre><code>type data MyOtherType\nerr := json.Unmarshal(..., &amp;data)\ndata.MyType.Date = data.Date\nreturn data.MyType // will of MyType, and fully populated\n</code></pre>\n\n<p>Note that this only works for unmarshaling. If you need to also marshal this data, a similar trick can be used, but the mechanics around it must be essentially reversed.</p>\n"}], "owner": {"reputation": 2703, "user_id": 1712880, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/cxC9W.jpg?s=128&g=1", "display_name": "Hamid Mohayeji", "link": "https://stackoverflow.com/users/1712880/hamid-mohayeji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1559293413, "creation_date": 1558881843, "last_edit_date": 1559293413, "question_id": 56314512, "link": "https://stackoverflow.com/questions/56314512/conditional-dynamic-struct-tags", "title": "Conditional (Dynamic) Struct Tags", "body": "<p>I'm trying to parse some xml documents in Go. I need to define a few structs for this purpose, and my struct tags depend on a certain condition.</p>\n\n<p>Imagine the following code (even though I know it won't work)</p>\n\n<pre><code>if someCondition {\n    type MyType struct {\n        // some common fields\n        Date    []string `xml:\"value\"`\n    }\n} else {\n    type MyType struct {\n        // some common fields\n        Date    []string `xml:\"anotherValue\"`\n    }\n}\n\nvar t MyType\n// do the unmarshalling ...\n</code></pre>\n\n<p>The problem is that these two structs have lots of fields in common. The only difference is in one of the fields and I want to prevent duplication. How can I solve this problem?</p>\n"}, {"tags": ["c", "go", "raspberry-pi3", "led"], "comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 1, "creation_date": 1558895812, "post_id": 56314418, "comment_id": 99241717, "body": "Better to post example code fragments than to reference external resources.  I am no Go expert (i.e. zero knowledge) so cannot really post an answer,  but looking at some of the example Go code for this library, it seems to me at a guess that because <code>MakeWS2811()</code> takes a <i>pointer</i> to the <code>opt</code> structure, you may simply be able to change the <code>opt.Channels[n].Brightness</code> and then render.  That is when you render, it uses the current state of the <code>opt</code> not the state it was when <code>MakeWS2811()</code> was called."}], "answers": [{"comments": [{"owner": {"reputation": 659, "user_id": 130651, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3420f58ebdd0c8a97af02f22bf9b99ec?s=128&d=identicon&r=PG", "display_name": "Brent Parker", "link": "https://stackoverflow.com/users/130651/brent-parker"}, "edited": false, "score": 0, "creation_date": 1559400497, "post_id": 56318581, "comment_id": 99412571, "body": "I knew that each time the C lib renders, it scales. I was trying to get around doing it in my code by controlling that scaling value. Guess it can&#39;t. Thanks for taking a look at it. I&#39;ll just have to scale it in my code."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "reply_to_user": {"reputation": 659, "user_id": 130651, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3420f58ebdd0c8a97af02f22bf9b99ec?s=128&d=identicon&r=PG", "display_name": "Brent Parker", "link": "https://stackoverflow.com/users/130651/brent-parker"}, "edited": false, "score": 0, "creation_date": 1559500077, "post_id": 56318581, "comment_id": 99431341, "body": "Ah yes you mentioned in the question you already knew how to do it in your code. I think the original author might appreciate you submitting your change to the library as a PR."}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": true, "score": 1, "last_activity_date": 1558919607, "creation_date": 1558919607, "answer_id": 56318581, "question_id": 56314418, "link": "https://stackoverflow.com/questions/56314418/is-there-a-way-to-modify-the-brightness-of-leds-in-rpi-ws281x-go-library-after-c/56318581#56318581", "title": "Is there a way to modify the brightness of LEDs in rpi-ws281x-go library after calling MakeWS2811()?", "body": "<p>@Clifford <a href=\"https://github.com/rpi-ws281x/rpi-ws281x-go/blob/d1c4b49fa01da378f9c24e72a1cf042795dc5a44/ws2811_arm.go#L58\" rel=\"nofollow noreferrer\">MakeWS2811(...)</a> does take a pointer, but it looks like it makes a copy of the options in C.</p>\n\n<p>However the returned instance has a <a href=\"https://github.com/rpi-ws281x/rpi-ws281x-go/blob/d1c4b49fa01da378f9c24e72a1cf042795dc5a44/ws2811.go#L135\" rel=\"nofollow noreferrer\">Leds(nChannel)</a> method, giving direct access to set the colours of LEDs. You can reduce the colour value to reduce the brightness (approximately). </p>\n\n<pre><code>...\nopt.Channels[0].Brightness = ... original value 0 to 255\nws, err := MakeWS2811(&amp;opts)\n...\n\nws.Leds(0)[0] = 0xff //bright red\nws.Leds(0)[1] = 0x7f //half as bright\nws.Render()\n</code></pre>\n\n<p>Note each time the C lib renders, it still <a href=\"https://github.com/jgarff/rpi_ws281x/blob/5b73b22517040423a657cc5e245529a9ed90d4d6/ws2811.c#L1140\" rel=\"nofollow noreferrer\">scales</a> the colours you set by the original brightness.</p>\n"}], "owner": {"reputation": 659, "user_id": 130651, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3420f58ebdd0c8a97af02f22bf9b99ec?s=128&d=identicon&r=PG", "display_name": "Brent Parker", "link": "https://stackoverflow.com/users/130651/brent-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 56318581, "answer_count": 1, "score": 0, "last_activity_date": 1558919607, "creation_date": 1558881109, "question_id": 56314418, "link": "https://stackoverflow.com/questions/56314418/is-there-a-way-to-modify-the-brightness-of-leds-in-rpi-ws281x-go-library-after-c", "title": "Is there a way to modify the brightness of LEDs in rpi-ws281x-go library after calling MakeWS2811()?", "body": "<p>I've been playing with a Raspberry Pi and Golang to animate some WS2812 LEDs. I've been using the rpi-ws281x-go (<a href=\"https://github.com/rpi-ws281x/rpi-ws281x-go\" rel=\"nofollow noreferrer\">https://github.com/rpi-ws281x/rpi-ws281x-go</a>) library which is a Go wrapper around a C library (<a href=\"https://github.com/jgarff/rpi_ws281x\" rel=\"nofollow noreferrer\">https://github.com/jgarff/rpi_ws281x</a>). I'm not extremely familiar with C let alone Go wrappers of C libraries. </p>\n\n<p>I can see that in the C code, I can access and change the brightness of the LEDs which is applied every time the render function is called. However, in the Go wrapper library, I don't see a way to access that variable. I can see that when I call ws2811.MakeWS2811(&amp;opt), I can set the brightness in the opt struct. How can I change that brightness after calling MakeWS2811()?</p>\n\n<p>I know how to apply my own brightness in my own animation functions in Go, but that seems redundant since the C function is going to do the same thing.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1558875894, "post_id": 56313747, "comment_id": 99236789, "body": "In Go you don&#39;t throw, you return error values. Take a look at the std lib and the pattern will become obvious. For example (<a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Open</a>)."}, {"owner": {"reputation": 293, "user_id": 7929009, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/ce5000c07e6fbaad215f658d6b793455?s=128&d=identicon&r=PG&f=1", "display_name": "Biswajit", "link": "https://stackoverflow.com/users/7929009/biswajit"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558876112, "post_id": 56313747, "comment_id": 99236840, "body": "@mkopriva, thanks for prompt response \u2026 my question was about &quot;throws&quot; not &quot;throw&quot; , where caller bound to handle or re throw (return in case of go) error/exception if caller use my function in his/her code.."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558876387, "post_id": 56313747, "comment_id": 99236906, "body": "There is no &quot;throws&quot; nor &quot;throw&quot; in Go. You already seem to be aware about error <code>return</code>s in Go and that&#39;s what you should be using. Is it insufficient?"}, {"owner": {"reputation": 293, "user_id": 7929009, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/ce5000c07e6fbaad215f658d6b793455?s=128&d=identicon&r=PG&f=1", "display_name": "Biswajit", "link": "https://stackoverflow.com/users/7929009/biswajit"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558876962, "post_id": 56313747, "comment_id": 99237018, "body": "thanks a lot\u2026 got you point , yes we can return the error and/or output. just one last thing , is there any way through which I can  , forced into to handle the error to the caller , as func body provider... ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1558877010, "post_id": 56313747, "comment_id": 99237034, "body": "If by &quot;bound&quot; you mean that the compiler should complain if the caller ignores the error then there&#39;s no such thing in Go. A caller can simply choose to discard the returned error by assigning it to the blank identifier and there&#39;s nothing you can do about that as the implementer of the called function. However ignoring errors is heavily discouraged by the community and anyone who doesn&#39;t follow the convention and ends up with a broken program can blame only themselves."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558877296, "post_id": 56313747, "comment_id": 99237089, "body": "The most you can do is to provide extra documentation for your function that warns its users of the dangers of ignoring the returned error value and, if applicable, additionally provide details about how the error should be handled if it&#39;s not <code>nil</code>."}], "answers": [{"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1558922714, "creation_date": 1558922714, "answer_id": 56318860, "question_id": 56313747, "link": "https://stackoverflow.com/questions/56313747/how-to-write-throwsin-java-like-code-in-golang/56318860#56318860", "title": "How to write throws(in java) like code in golang", "body": "<p>No, you cannot do that. Go does not support throwing exceptions.</p>\n\n<p>As you have noticed, you can panic and recover, but it's not the same thing.</p>\n"}], "owner": {"reputation": 293, "user_id": 7929009, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/ce5000c07e6fbaad215f658d6b793455?s=128&d=identicon&r=PG&f=1", "display_name": "Biswajit", "link": "https://stackoverflow.com/users/7929009/biswajit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1558922714, "creation_date": 1558875734, "last_edit_date": 1558877071, "question_id": 56313747, "link": "https://stackoverflow.com/questions/56313747/how-to-write-throwsin-java-like-code-in-golang", "title": "How to write throws(in java) like code in golang", "body": "<p>Is there any way in Golang for a func to \"throws\"(like in java) an error?<br>\nThrough Which I can specify , my func may return error and caller needs to handle the error. </p>\n\n<p>I am just trying to mimic \"throws\" like approach which we have in java. \nMay be this is very basic elementary type question , sorry for that , I am new in golang. </p>\n\n<p>Note : I have tried panic, defer, recover , but problem is that if both the functions/methods is in same go file it is working properly , but if suppose both(caller and func) are different go file it is starting a different go routine , \"defer\" at caller level is not working properly. </p>\n\n<p>I guess this approach is not also equivalent like \"throws\" , where function provider is not handling the error but caller did that , and take the recovery action. Function body provider just specify it may return some exception and caller have to handle the exception.  </p>\n\n<p>Thanks in advance... </p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 2183, "user_id": 10029810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ee9acb32ea179266c431ba3232807f?s=128&d=identicon&r=PG&f=1", "display_name": "nodediggity", "link": "https://stackoverflow.com/users/10029810/nodediggity"}, "is_accepted": true, "score": 4, "last_activity_date": 1558867795, "creation_date": 1558867795, "answer_id": 56312831, "question_id": 56312801, "link": "https://stackoverflow.com/questions/56312801/go-api-in-container-not-returning-any-response/56312831#56312831", "title": "Go API in container not returning any response", "body": "<p>I think you need to remove the host portion from your <code>Addr</code> property.</p>\n\n<pre><code>srv := &amp;http.Server{\n    Handler:      r,\n    Addr:         \":8080\",\n    WriteTimeout: 15 * time.Second,\n    ReadTimeout:  15 * time.Second,\n}\n</code></pre>\n"}], "owner": {"reputation": 881, "user_id": 10823240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a276bfb478e7358374a2c95458734f1d?s=128&d=identicon&r=PG&f=1", "display_name": "Tim J", "link": "https://stackoverflow.com/users/10823240/tim-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 56312831, "answer_count": 1, "score": 0, "last_activity_date": 1558867795, "creation_date": 1558867524, "question_id": 56312801, "link": "https://stackoverflow.com/questions/56312801/go-api-in-container-not-returning-any-response", "title": "Go API in container not returning any response", "body": "<p>I have a simple API written in GO using Mux.</p>\n\n<p>When running locally it works, however I am trying to containerize this app.</p>\n\n<p>My <code>main.go</code> looks like this</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"time\"\n    \"log\"\n    \"github.com/gorilla/mux\"\n    \"github.com/&lt;username&gt;/tweet-media-api/controllers\"\n)\n\nfunc main() {\n\n    r := mux.NewRouter()\n\n    c := controllers.Controller{}\n\n    r.HandleFunc(\"/\", c.BaseRoute()).Methods(\"GET\")\n    r.HandleFunc(\"/healthz\", c.HealthzRoute()).Methods(\"GET\")\n\n    srv := &amp;http.Server{\n        Handler:      r,\n        Addr:         \"127.0.0.1:8080\",\n        WriteTimeout: 15 * time.Second,\n        ReadTimeout:  15 * time.Second,\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n</code></pre>\n\n<p>and my project is basically set out like this</p>\n\n<p><a href=\"https://i.stack.imgur.com/cA0T5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cA0T5.png\" alt=\"enter image description here\"></a></p>\n\n<p>I am using <code>go version go1.11.4 darwin/amd64</code> and my project is using go modules.</p>\n\n<p>I have tried to create a multi stage <code>Dockerfile</code> as below</p>\n\n<pre><code># build stage\nFROM golang:alpine AS build-env\nADD . /src\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache git\nRUN cd /src &amp;&amp; go build -o goapp\n\n# final stage\nFROM alpine\nWORKDIR /app\nCOPY --from=build-env /src/goapp /app/\nEXPOSE 8080\nENTRYPOINT ./goapp\n</code></pre>\n\n<p>I run <code>docker build . -t my-app</code> in the root of the project and this completes with </p>\n\n<pre><code>Successfully built ebb41cfbef59\nSuccessfully tagged my-app:latest\n</code></pre>\n\n<p>However when I run <code>docker run -p 8080:8080 my-app</code> there is no output from the terminal and a curl request on <code>http://localhost:8080/</code> returns no response. This is also the same for a browser request.</p>\n\n<p>I am very new to Docker and confused as to why this build is not working.</p>\n\n<p>I know that my container is running my app as I added   </p>\n\n<pre><code>fmt.Println(\"Running\")\n</code></pre>\n\n<p>and this was printed to the console.</p>\n"}, {"tags": ["go", "runtime", "stack-trace"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1558881594, "creation_date": 1558881594, "answer_id": 56314486, "question_id": 56312755, "link": "https://stackoverflow.com/questions/56312755/how-to-get-info-about-last-called-func-in-go/56314486#56314486", "title": "How to get info about last called func in Go?", "body": "<blockquote>\n  <p>Is it possible to get name of the last called function and args that were passed to?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 11, "user_id": 11557461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2674d40ad60464ba72eeb21e4ba7ee4?s=128&d=identicon&r=PG&f=1", "display_name": "blank.teer", "link": "https://stackoverflow.com/users/11557461/blank-teer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558881594, "creation_date": 1558867036, "question_id": 56312755, "link": "https://stackoverflow.com/questions/56312755/how-to-get-info-about-last-called-func-in-go", "title": "How to get info about last called func in Go?", "body": "<p>Is it possible to get name of the last called function and args that were passed to?</p>\n\n<pre><code>func main() {\n    f(1)\n    log.Printf(\"%s(%s=%d)\", // how to paste here \"f(arg=1)\"? )\n}\n\nfunc f(arg int) {\n    ...\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1558850293, "post_id": 56310856, "comment_id": 99231817, "body": "What is the actual problem here? Can you put the output you are getting and a link to a runnable example on go playground?"}, {"owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1558851125, "post_id": 56310856, "comment_id": 99231943, "body": "I&#39;ve edited it to include the playground. The output varies when run multiple times."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1558857693, "creation_date": 1558857693, "answer_id": 56311736, "question_id": 56310856, "link": "https://stackoverflow.com/questions/56310856/combination-using-goroutine/56311736#56311736", "title": "Combination using goroutine", "body": "<p>You have a data race. Your results are undefined.</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x00c00009c010 by main goroutine:\n  reflect.typedmemmove()\n      /home/peter/go/src/runtime/mbarrier.go:177 +0x0\n  reflect.packEface()\n      /home/peter/go/src/reflect/value.go:119 +0x103\n  reflect.valueInterface()\n      /home/peter/go/src/reflect/value.go:1027 +0x16f\n  fmt.(*pp).printValue()\n      /home/peter/go/src/reflect/value.go:997 +0x38f7\n  fmt.(*pp).printValue()\n      /home/peter/go/src/fmt/print.go:868 +0xec7\n  fmt.(*pp).printArg()\n      /home/peter/go/src/fmt/print.go:715 +0x2ee\n  fmt.(*pp).doPrintln()\n      /home/peter/go/src/fmt/print.go:1172 +0xad\n  fmt.Fprintln()\n      /home/peter/go/src/fmt/print.go:263 +0x65\n  main.main()\n      /home/peter/go/src/fmt/print.go:273 +0x14b\n\nPrevious write at 0x00c00009c010 by goroutine 8:\n  main.CombinadicK.func1()\n      /home/peter/racer.go:48 +0x1e6\n\nGoroutine 8 (running) created at:\n  main.CombinadicK()\n      /home/peter/racer.go:26 +0x96\n  main.Combinadic.func1()\n      /home/peter/racer.go:12 +0xda\n==================\n[3]\n[3]\n[4]\n[4]\n[2 3]\n[2 4]\n[1 4]\n[3 4]\n[3 4]\n[3 4]\n[1 3 4]\n[1 3 4]\n[1 3 4]\n[2 3 4]\n[1 2 3 4]\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n\n<p><code>racer.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc Combinadic(values []float64) &lt;-chan []float64 {\n    ch := make(chan []float64)\n    go func() {\n        for i := 0; i &lt; len(values); i++ {\n\n            for value := range CombinadicK(values, i+1) {\n                ch &lt;- value\n            }\n\n        }\n        close(ch)\n    }()\n\n    return ch\n\n}\n\nfunc CombinadicK(values []float64, k int) &lt;-chan []float64 {\n    chnl := make(chan []float64)\n    go func() {\n        n := len(values)\n\n        t := k\n\n        c := make([]int, t+3)\n        current := make([]float64, t)\n\n        x := 0\n        j := 0\n\n        for j = 1; j &lt;= t; j++ {\n            c[j] = j - 1\n        }\n\n        c[t+1] = n\n        c[t+2] = 0\n\n        j = t\n\n        for {\n            for i := 0; i &lt; len(current); i++ {\n                current[i] = values[c[i+1]]\n            }\n\n            chnl &lt;- current\n\n            if j &gt; 0 {\n                x = j\n            } else {\n                if c[1]+1 &lt; c[2] {\n                    c[1]++\n                    continue\n                } else {\n                    j = 2\n                }\n            }\n\n            for {\n                c[j-1] = j - 2\n                x = c[j] + 1\n                if x == c[j+1] {\n                    j++\n                } else {\n                    break\n                }\n            }\n\n            c[j] = x\n            j--\n\n            if j &gt;= t {\n                break\n            }\n        }\n\n        close(chnl)\n    }()\n\n    return chnl\n}\n\nfunc main() {\n    elements := []float64{1, 2, 3, 4}\n    for v := range Combinadic(elements) {\n        fmt.Println(v)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/hhQgVdqe6l1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hhQgVdqe6l1</a></p>\n\n<hr>\n\n<p><a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go: Data Race Detector</a> </p>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1558857693, "creation_date": 1558847988, "last_edit_date": 1558851040, "question_id": 56310856, "link": "https://stackoverflow.com/questions/56310856/combination-using-goroutine", "title": "Combination using goroutine", "body": "<p>I'm trying to get a code to work that pretty much involves channels in goroutine (in a yield-like behavior in C#)</p>\n\n<p>The code involves getting an iterable matrix from a slice like so:</p>\n\n<pre><code>elements := []float64{1, 2, 3, 4}\n\nexpected := [][]float64{\n    {1},\n    {2},\n    {3},\n    {4},\n    {1, 2},\n    {1, 3},\n    {2, 3},\n    {1, 4},\n    {2, 4},\n    {3, 4},\n    {1, 2, 3},\n    {1, 2, 4},\n    {1, 3, 4},\n    {2, 3, 4},\n    {1, 2, 3, 4},\n}\n</code></pre>\n\n<p>I've tried applying Knuth's by doing:</p>\n\n<pre><code>func Combinadic(values []float64) &lt;-chan []float64 {\n    ch := make(chan []float64)\n    go func() {\n        for i := 0; i &lt; len(values); i++ {\n\n            for value := range CombinadicK(values, i+1) {\n                ch &lt;- value\n            }\n\n        }\n        close(ch)\n    }()\n\n    return ch\n\n}\n\nfunc CombinadicK(values []float64, k int) &lt;-chan []float64 {\n    chnl := make(chan []float64)\n    go func() {\n        n := len(values)\n\n        t := k\n\n        c := make([]int, t+3)\n        current := make([]float64, t)\n\n        x := 0\n        j := 0\n\n        for j = 1; j &lt;= t; j++ {\n            c[j] = j - 1\n        }\n\n        c[t+1] = n\n        c[t+2] = 0\n\n        j = t\n\n        for {\n            for i := 0; i &lt; len(current); i++ {\n                current[i] = values[c[i+1]]\n            }\n\n            chnl &lt;- current\n\n            if j &gt; 0 {\n                x = j\n            } else {\n                if c[1]+1 &lt; c[2] {\n                    c[1]++\n                    continue\n                } else {\n                    j = 2\n                }\n            }\n\n            for {\n                c[j-1] = j - 2\n                x = c[j] + 1\n                if x == c[j+1] {\n                    j++\n                } else {\n                    break\n                }\n            }\n\n            c[j] = x\n            j--\n\n            if j &gt;= t {\n                break\n            }\n        }\n\n        close(chnl)\n    }()\n\n    return chnl\n}\n</code></pre>\n\n<p>It appears to give out random number per row, but the structure of the expected (the count of items per row) appears to be ok.</p>\n\n<p>The code in <a href=\"https://play.golang.org/p/vGA_R6PLAbm\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": ["mysql", "database", "go"], "comments": [{"owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "edited": false, "score": 2, "creation_date": 1558829553, "post_id": 56309605, "comment_id": 99229405, "body": "You&#39;re not going to get a lot of love on SO for this kind of a question- that said, I&#39;d still offer advice to: 1) Learn how to locally run a script on a cronjob (i.e. <code>crontab</code> for *nix environs.) 2) After that, learn to leverage this cronjob either in EC2 or through AWS CloudWatch scheduling to trigger a Lambda function (written in Go) that will GET the JSON data via the API you&#39;ve discovered then post this data to your DB for further use."}], "answers": [{"tags": [], "owner": {"reputation": 79883, "user_id": 205608, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/61eE0.png?s=128&g=1", "display_name": "O. Jones", "link": "https://stackoverflow.com/users/205608/o-jones"}, "is_accepted": false, "score": 2, "last_activity_date": 1558829866, "creation_date": 1558829866, "answer_id": 56309711, "question_id": 56309605, "link": "https://stackoverflow.com/questions/56309605/how-does-one-update-mysql-database-periodically-separate-from-website/56309711#56309711", "title": "How does one update MySQL database periodically separate from website", "body": "<p>You need a UNIX/Linux subsystem known as <em>cron</em> to do this. cron lets you rig a program to run at a specific interval on your machine.</p>\n\n<p>Bluehost\u2019s cron support lets you run php scripts. I don\u2019t believe they support running other kinds of programs. </p>\n\n<p>If you have some other always-on machine that runs your golang program, you can run it there. But, to do that, you will have to configure Bluehost to allow an external connection to your MySQL server so that program can connect. Ask their customers support people about that.</p>\n\n<p><strong>Pro tip:</strong> every 30 seconds may be too high an update frequency to use on a shared service like Bluehost. That kind of frequency is tricky to manage even if you completely control the server. </p>\n"}], "owner": {"reputation": 11, "user_id": 11556196, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FU67F_d3o8M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re69sivpxzm7DgwLAmavrJrTyQa4w/mo/photo.jpg?sz=128", "display_name": "Matthew Nazari", "link": "https://stackoverflow.com/users/11556196/matthew-nazari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558829866, "creation_date": 1558828331, "question_id": 56309605, "link": "https://stackoverflow.com/questions/56309605/how-does-one-update-mysql-database-periodically-separate-from-website", "title": "How does one update MySQL database periodically separate from website", "body": "<p>I am trying to build a way to log all the times my friends and I are on our video game server. I found an api which returns a JSON file of online players given a server\u2019s IP address.</p>\n\n<p>I plan to receive a new JSON file every 30 seconds and then log player gaming sessions by figuring out when they get on and when they are no longer off.</p>\n\n<p>The problem is that this is my first time using a database like this for my websites. I want to use (and will use) Golang to retrieve the JSON file and update my MySQL database of player logs.</p>\n\n<p>PROBLEM: I have no freaking clue how to have my Golang file run every 30 seconds to update my database. I can get a simple program to grab data and update a local database easily, but I\u2019m lost on how to get this to run on my website and to have it run every 30ish seconds 24/7. I\u2019m used to CRUD with simple html forms and other things related to user input, but I\u2019ve never thought of changing my database separately from website interactions</p>\n\n<p>Is there a standard solution to my problem? Am I thinking about this all wrong? Do I make sense? Does God really exist!!?</p>\n\n<ul>\n<li>I\u2019m using BlueHost</li>\n<li>I insist on Golang for the experience</li>\n<li>first time using stackoverflow idk if my question was too long</li>\n</ul>\n"}, {"tags": ["go", "struct", "type-conversion"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558814611, "post_id": 56307987, "comment_id": 99226962, "body": "<code>(*MyTime)(someVar.ThisDate)</code> The <code>someVar.ThisDate</code> is already a <code>*time.Time</code> right? so you do not need the <code>*</code> in front of it. Additionally when converting to pointer types, ie <code>*T</code>, I would recommed to always put the pointer type in extra parentheses, ie <code>(*T)</code>. <a href=\"https://play.golang.com/p/jH9Q07sizID\" rel=\"nofollow noreferrer\">play.golang.com/p/jH9Q07sizID</a>"}, {"owner": {"reputation": 1897, "user_id": 4935114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0153a62f6ea54536d6171fa5e91620c8?s=128&d=identicon&r=PG&f=1", "display_name": "Doron Behar", "link": "https://stackoverflow.com/users/4935114/doron-behar"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558817101, "post_id": 56307987, "comment_id": 99227462, "body": "That&#39;s very helpful, thank you! Could you perhaps explain further this syntax? I&#39;ve seen it many times and I don&#39;t know even how to search for it in order to find documentation about it. Perhaps even a link to the proper place in <a href=\"http://tour.golang.org/\" rel=\"nofollow noreferrer\">tour.golang.org</a> would do."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1558817216, "post_id": 56307987, "comment_id": 99227479, "body": "<a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions</a> <i>If the type starts with the operator * or &lt;-, or if the type starts with the keyword func and has no result list, it must be parenthesized when necessary to avoid ambiguity</i>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1558817668, "post_id": 56307987, "comment_id": 99227566, "body": "If you understand the concept of operator precedence, or order-of-evaluation, you can see that <code>*T(v)</code> could be interpreted in two ways and is therefore ambiguous, so to <i>avoid the ambiguity</i> you can make your intent clear by adding parentheses <code>(*T)(v)</code>."}, {"owner": {"reputation": 1897, "user_id": 4935114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0153a62f6ea54536d6171fa5e91620c8?s=128&d=identicon&r=PG&f=1", "display_name": "Doron Behar", "link": "https://stackoverflow.com/users/4935114/doron-behar"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1558818059, "post_id": 56307987, "comment_id": 99227635, "body": "That&#39;s an excellent explanation @mkopriva - exactly what I was missing. Please feel free to put these words into an answer I&#39;ll mark as accepted."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558861003, "post_id": 56307987, "comment_id": 99233775, "body": "Go doesn&#39;t have typecasting at all."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1558975729, "post_id": 56307987, "comment_id": 99266837, "body": "Please take time to also absorb what Flimzy said: in Go, there is no type_casting_ \u2014 that is, forced reinterpretation of a value of one type as that of another. Instead, Go has type <i>conversions;</i> which differ in that they ever allow to convert values between compatible types where compatible roughly meaning &quot;representing values which have the same memory layouts for their data&quot;."}, {"owner": {"reputation": 1897, "user_id": 4935114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0153a62f6ea54536d6171fa5e91620c8?s=128&d=identicon&r=PG&f=1", "display_name": "Doron Behar", "link": "https://stackoverflow.com/users/4935114/doron-behar"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1559025476, "post_id": 56307987, "comment_id": 99278407, "body": "Thanks @kostix, I edited the title of the question."}], "answers": [{"tags": [], "owner": {"reputation": 1897, "user_id": 4935114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0153a62f6ea54536d6171fa5e91620c8?s=128&d=identicon&r=PG&f=1", "display_name": "Doron Behar", "link": "https://stackoverflow.com/users/4935114/doron-behar"}, "is_accepted": true, "score": 0, "last_activity_date": 1559025838, "creation_date": 1559025838, "answer_id": 56336397, "question_id": 56307987, "link": "https://stackoverflow.com/questions/56307987/type-conversion-between-two-struct-pointers/56336397#56336397", "title": "Type conversion between two struct pointers", "body": "<p>The problem is the ambiguous syntax of <code>*T(v)</code> or whatever else you tried there. The <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Golang's spec</a> gives useful examples for type conversions as this, quoting:</p>\n\n<pre><code>*Point(p)        // same as *(Point(p))\n(*Point)(p)      // p is converted to *Point\n</code></pre>\n\n<p>Therefor, since <code>*Point</code> is needed, <code>*T(v)</code> should be used.</p>\n"}], "owner": {"reputation": 1897, "user_id": 4935114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0153a62f6ea54536d6171fa5e91620c8?s=128&d=identicon&r=PG&f=1", "display_name": "Doron Behar", "link": "https://stackoverflow.com/users/4935114/doron-behar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 56336397, "answer_count": 1, "score": 0, "last_activity_date": 1559025838, "creation_date": 1558812109, "last_edit_date": 1559025446, "question_id": 56307987, "link": "https://stackoverflow.com/questions/56307987/type-conversion-between-two-struct-pointers", "title": "Type conversion between two struct pointers", "body": "<p>I have a <code>struct</code> that consists of a custom <code>time.Time</code> defined for the sake of it having a custom <code>MarshalJSON()</code> interface, following <a href=\"https://stackoverflow.com/a/23696303/4935114\">this answer</a>'s suggestion:</p>\n\n<pre><code>type MyTime time.Time\nfunc (s myTime) MarshalJSON() ([]byte, error) {\n    t := time.Time(s)\n    return []byte(t.Format(`\"20060102T150405Z\"`)), nil\n}\n</code></pre>\n\n<p>I define a <code>MyStruct</code> type with <code>ThisDate</code> and <code>ThatDate</code> fields of type <code>*MyTime</code>:</p>\n\n<pre><code>type MyStruct struct {\n    ThisDate *MyTime `json:\"thisdate,omitempty\"`\n    ThatDate *MyTime `json:\"thatdate,omitempty\"`\n}\n</code></pre>\n\n<p>As far as I understand, I need to use <code>*MyTime</code> and not <code>MyTime</code> so the <code>omitempty</code> tag will have an effect when I'll <code>MarshalJSON</code> a variable of this type, following <a href=\"https://stackoverflow.com/a/18088527/4935114\">this answer</a>'s suggestion.</p>\n\n<p>I use a library that has a function that returns me a <code>struct</code> with some fields of type <code>*time.Time</code>:</p>\n\n<pre><code>someVar := Lib.GetVar()\n</code></pre>\n\n<p>I tried to define a variable of type <code>MyStruct</code> like this:</p>\n\n<pre><code>myVar := &amp;MyStruct{\n    ThisDate: someVar.ThisDate\n    ThatDate: someVar.ThatDate\n}\n</code></pre>\n\n<p>Naturally, it gives me a compilation error:</p>\n\n<pre><code>cannot use someVar.ThisDate (variable of type *time.Time) as *MyTime value in struct literal ...\n</code></pre>\n\n<p>I tried typecasting <code>someVar.ThisDate</code> with <code>*</code>/<code>&amp;</code> and without these without luck. I thought the following would work:</p>\n\n<pre><code>myVar := &amp;MyStruct{\n    ThisDate: *MyTime(*someVar.ThisDate)\n    ThatDate: *MyTime(*someVar.ThatDate)\n}\n</code></pre>\n\n<p>But it gives me a different compilation error:</p>\n\n<pre><code>invalid operation: cannot indirect MyTime(*someVar.ThisDate) (value of type MyTime) ...\n</code></pre>\n\n<p>It seems I probably lack basic understanding of pointers and dereferences in Go. Never the less, I would like to avoid finding a specific solution for my issue which comes down to the combination of the need to make <code>omitempty</code> have an effect and a custom <code>MarshalJSON</code>.</p>\n"}, {"tags": ["mongodb", "go", "mgo", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 11554838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9d88085d8f40613a9af01b0477e6912?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Shopin", "link": "https://stackoverflow.com/users/11554838/sergey-shopin"}, "edited": false, "score": 0, "creation_date": 1558872047, "post_id": 56310466, "comment_id": 99235988, "body": "Thank you so match! Ive combined what I have done with what you have written (specifically my array filters were incorrect). So it helped!"}], "tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": true, "score": 9, "last_activity_date": 1558843717, "last_edit_date": 1558843717, "creation_date": 1558842166, "answer_id": 56310466, "question_id": 56306164, "link": "https://stackoverflow.com/questions/56306164/mongo-go-how-to-use-arrayfilter-to-find-elem-in-array-of-objects-inside-array-o/56310466#56310466", "title": "Mongo-go how to use arrayFilter to find elem in &quot;array of objects inside array of objects&quot;", "body": "<p>try this:</p>\n\n<p>mongo-go-driver:</p>\n\n<pre><code>coll.FindOneAndUpdate(\n    context.Background(),\n    bson.D{\n        {\"id\", \"1234\"},\n        {\"achievements.scope\", \"life achievements\"},\n        {\"achievements.list._id\", 1},\n    },\n    bson.M{\"$set\": bson.M{\"achievements.$.list.$[elem].title\"\": \"some new test\"}},\n    options.FindOneAndUpdate().SetArrayFilters(options.ArrayFilters{\n        Filters: []interface{}{bson.M{\"elem._id\": 1}},\n    }),\n)\n</code></pre>\n\n<p>which \"translates\" to shell:</p>\n\n<pre><code>db.user.findOneAndUpdate(\n  {\"id\": \"1234\",\"achievements.scope\": \"life achievements\",\"achievements.list._id\": 1},\n  {$set: {\"achievements.$.list.$[elem].title\": \"some new test\"}},\n  { arrayFilters: [  { \"elem._id\": 1 } ]}\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 11554838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9d88085d8f40613a9af01b0477e6912?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Shopin", "link": "https://stackoverflow.com/users/11554838/sergey-shopin"}, "is_accepted": false, "score": 1, "last_activity_date": 1558872391, "creation_date": 1558872391, "answer_id": 56313334, "question_id": 56306164, "link": "https://stackoverflow.com/questions/56306164/mongo-go-how-to-use-arrayfilter-to-find-elem-in-array-of-objects-inside-array-o/56313334#56313334", "title": "Mongo-go how to use arrayFilter to find elem in &quot;array of objects inside array of objects&quot;", "body": "<p>So, with help of @owlwalks, we have found the decision:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>doc := coll.FindOneAndUpdate(\n        context.Background(),\n        bson.D{\n            {\"_id\", \"1234\"},\n            {\"achievements.scope\", \"life achievements\"},\n        },\n        bson.D{\n            {\"$set\", bson.D{\n                {\"achievements.$.list.$[elem].title\", \"some new text\"},\n            }},\n        },\n        options.FindOneAndUpdate().SetArrayFilters(options.ArrayFilters{\n            Filters: []interface{}{bson.D{\n                    {\"elem._id\", 1},\n                }},\n        }).SetReturnDocument(1),\n    )\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 11554838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9d88085d8f40613a9af01b0477e6912?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Shopin", "link": "https://stackoverflow.com/users/11554838/sergey-shopin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3007, "favorite_count": 0, "accepted_answer_id": 56310466, "answer_count": 2, "score": 3, "last_activity_date": 1558872433, "creation_date": 1558797765, "last_edit_date": 1558872433, "question_id": 56306164, "link": "https://stackoverflow.com/questions/56306164/mongo-go-how-to-use-arrayfilter-to-find-elem-in-array-of-objects-inside-array-o", "title": "Mongo-go how to use arrayFilter to find elem in &quot;array of objects inside array of objects&quot;", "body": "<p>Lets imagine a JSON like:</p>\n\n<pre><code>\"user\": {\n  \"id\": \"1234\",\n  ...some fields,\n  \"achievements\": [\n    {\n      \"scope\": \"life achievements\",\n      \"list\": [\n        {\"_id\": 1, \"title\": \"some text\", \"gotAt\": \"some date\"},\n        {\"_id\": 2, \"title\": \"some other text\", \"gotAt\": \"some date\"}\n      ]\n    },\n    {\n      \"scope\": \"sport achievements\",\n      \"list\": [\n        {\"_id\": 1, \"title\": \"sport\", \"gotAt\": \"some date\"},\n        {\"_id\": 2, \"title\": \"some other sport\", \"gotAt\": \"some date\"}\n      ]\n    },\n    {\n      \"scope\": \"academic achievements\",\n      \"list\": [\n        {\"_id\": 1, \"title\": \"some text\", \"gotAt\": \"some date\"},\n        {\"_id\": 2, \"title\": \"some other text\", \"gotAt\": \"some date\"}\n      ]\n    },\n  ]\n}\n</code></pre>\n\n<p>I need to UPDATE for example the first life achievement (with id 1) using mongoDb and Golang driver Mongo-go for it</p>\n\n<p>The problem is in the nesting level. I can get some array element by $ mongoDb operator, but here i need to identify every user achievement by the activity scope (life, sport, academic etc) and _id field of achievement. So I need to make a search inside an array of objects inside other array of objects.</p>\n\n<p>Thats what ive done (it doesnt work anyway)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>doc := coll.FindOneAndUpdate(\n        context.Background(),\n        bson.D{\n            {\"_id\", \"1234\"},\n            {\"achievements.scope\", \"life achievements\"},\n            {\"achievements.list._id\", 1},\n        },\n        bson.D{\n            {\"$set\", bson.D{\n                {\"achievements.$.list.$[elem].title\", \"some new test\"},\n            }},\n        },\n        options.FindOneAndUpdate().SetArrayFilters(options.ArrayFilters{\n            Filters: append(make([]interface{}, 0), bson.D{\n                {\"elem\", bson.D{\n                    {\"achievements.list._id\", 1},\n                }},\n            }),\n        }).SetReturnDocument(1),\n    )\n</code></pre>\n\n<p>I expect this query to update only one element specified by \"id\" and \"scope\" fields. May be I use arrayFilters incorretly, or may be I set  param of FindOneAndUpdate function incorrectly. Now it doesnt throw any error nor updates the document. Please help me</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "edited": false, "score": 0, "creation_date": 1558797783, "post_id": 56306012, "comment_id": 99222903, "body": "Not sure if that&#39;s even possible and I wouldn&#39;t complicate things that much. You have <code>RowsAffected</code> but that only returns the count of rows that have been updated. Also you can use <a href=\"http://gorm.io/docs/transactions.html\" rel=\"nofollow noreferrer\">Transactions</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 6853753, "user_type": "registered", "profile_image": "https://graph.facebook.com/1093705174047596/picture?type=large", "display_name": "Dennys Azevedo", "link": "https://stackoverflow.com/users/6853753/dennys-azevedo"}, "is_accepted": false, "score": 0, "last_activity_date": 1558830677, "creation_date": 1558830677, "answer_id": 56309765, "question_id": 56306012, "link": "https://stackoverflow.com/questions/56306012/update-select-atomic-gorm-orm/56309765#56309765", "title": "Update, select atomic. GORM ORM", "body": "<p>It's possible having only a little downside as far as I know</p>\n\n<p>Assuming your model is called <code>Job</code>, you can do something like this...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var jobs []Job\ndb.Find(&amp;jobs).Where(\"status = ?\", StatusPending).Update(\"status\", StatusRunning)\n</code></pre>\n\n<p>The lines affect will be in the <code>jobs var</code>, but I have to say that you will receive the lines how they were BEFORE the Update, so the status of the models will be 'PENDING'</p>\n"}], "owner": {"reputation": 1, "user_id": 4865303, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GwIoqygSmt4/AAAAAAAAAAI/AAAAAAAAACg/WdyeNVSNwx8/photo.jpg?sz=128", "display_name": "David Rhidians", "link": "https://stackoverflow.com/users/4865303/david-rhidians"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 242, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558830677, "creation_date": 1558796740, "last_edit_date": 1558806078, "question_id": 56306012, "link": "https://stackoverflow.com/questions/56306012/update-select-atomic-gorm-orm", "title": "Update, select atomic. GORM ORM", "body": "<p>Can I do something like this in gorm , psql?</p>\n\n<pre><code>UPDATE job SET status = 'RUNNING' WHERE status = \n'PENDING' RETURNING *\n</code></pre>\n\n<p>I want to get all rows that were changed by the update with a single atomic operation. If there are other solutions please write it.</p>\n"}, {"tags": ["html", "http", "go", "web"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1558799168, "post_id": 56305805, "comment_id": 99223235, "body": "Please show what you have tried and what didn&#39;t work. This should be reasonably straightforward using the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">html/template</a> package."}], "answers": [{"comments": [{"owner": {"reputation": 90, "user_id": 10666991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8ed2aa590dc61c12f19caaa731db61?s=128&d=identicon&r=PG&f=1", "display_name": "Ofir", "link": "https://stackoverflow.com/users/10666991/ofir"}, "edited": false, "score": 0, "creation_date": 1558803947, "post_id": 56306889, "comment_id": 99224413, "body": "Thank you! But my main problem is passing a list of this struct. How can I access to each struct in the list, within the html code, in that way?"}, {"owner": {"reputation": 330, "user_id": 1524867, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/R1Wat.jpg?s=128&g=1", "display_name": "Drew Ogryzek", "link": "https://stackoverflow.com/users/1524867/drew-ogryzek"}, "reply_to_user": {"reputation": 90, "user_id": 10666991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8ed2aa590dc61c12f19caaa731db61?s=128&d=identicon&r=PG&f=1", "display_name": "Ofir", "link": "https://stackoverflow.com/users/10666991/ofir"}, "edited": false, "score": 0, "creation_date": 1558804743, "post_id": 56306889, "comment_id": 99224639, "body": "I&#39;ve updated the answer to include iterating through a range."}], "tags": [], "owner": {"reputation": 330, "user_id": 1524867, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/R1Wat.jpg?s=128&g=1", "display_name": "Drew Ogryzek", "link": "https://stackoverflow.com/users/1524867/drew-ogryzek"}, "is_accepted": true, "score": 1, "last_activity_date": 1558804715, "last_edit_date": 1558804715, "creation_date": 1558803245, "answer_id": 56306889, "question_id": 56305805, "link": "https://stackoverflow.com/questions/56305805/how-to-show-a-table-from-a-slice-with-my-struct/56306889#56306889", "title": "How to show a table from a slice with my struct", "body": "<p>It seems like you want the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">Go Template</a> package.</p>\n\n<p>Here's an example of how you may use it:\nDefine a handler that passes an instance of a struct with some defined field(s) to a view that uses Go Templates:</p>\n\n<pre><code>type MyStruct struct {\n        SomeField string\n}\n\nfunc MyStructHandler(w http.ResponseWriter, r *http.Request) {\n        ms := MyStruct{\n                SomeField: \"Hello Friends\",\n        }\n\n        t := template.Must(template.ParseFiles(\"./showmystruct.html\"))\nt.Execute(w, ms)\n}\n</code></pre>\n\n<p>Access the struct fields using the Go Template syntax in your view (showmystruct.html):</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;title&gt;Show My Struct&lt;/title&gt;\n&lt;h1&gt;{{ .SomeField }}&lt;/h1&gt;\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>If you are interested particularly in passing a list, and iterating over that, then the <code>{{ range }}</code> keyword is useful. Also, there's a pretty common pattern (at least in my world) where you pass a <code>PageData{}</code> struct to the view.</p>\n\n<p>Here's an expanded example, adding a list of structs, and a <code>PageData</code> struct (so we can access its fields in the template):</p>\n\n<pre><code>type MyStruct struct {\n    SomeField string\n}\n\ntype PageData struct {\n    Title string\n    Data []MyStruct\n}\n\nfunc MyStructHandler(w http.ResponseWriter, r *http.Request) {\n        data := PageData{\n            Title: \"My Super Awesome Page of Structs\",\n            Data: []MyStruct{\n                MyStruct{\n                    SomeField: \"Hello Friends\",\n                },\n                MyStruct{\n                    SomeField: \"Goodbye Friends\",\n                },\n            }\n\n        t := template.Must(template.ParseFiles(\"./showmystruct.html\"))\n        t.Execute(w, data)\n\n}\n</code></pre>\n\n<p>And the modified template (showmystruct.html):</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;title&gt;{{ .Title }}&lt;/title&gt;\n&lt;ul&gt;\n  {{ range .Data }}\n    &lt;li&gt;{{ .SomeField }}&lt;/li&gt;\n  {{ end }}\n&lt;/ul&gt;\n</code></pre>\n"}], "owner": {"reputation": 90, "user_id": 10666991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8ed2aa590dc61c12f19caaa731db61?s=128&d=identicon&r=PG&f=1", "display_name": "Ofir", "link": "https://stackoverflow.com/users/10666991/ofir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 56306889, "answer_count": 1, "score": 0, "last_activity_date": 1612275934, "creation_date": 1558795073, "last_edit_date": 1612275934, "question_id": 56305805, "link": "https://stackoverflow.com/questions/56305805/how-to-show-a-table-from-a-slice-with-my-struct", "title": "How to show a table from a slice with my struct", "body": "<p>I want to show a table that each row contains my struct data.</p>\n<p>Here is my struct:</p>\n<pre><code>type My_Struct struct {\nFIRST_FIELD       string\nSECOND_FIELD      string\nTHIED_FIELD       string\n}\n</code></pre>\n<p>Here is my html code:</p>\n<pre><code>&lt;table id=&quot;t01&quot;&gt;\n&lt;tr&gt;\n    &lt;th&gt;FIRST FIELD&lt;/th&gt;\n    &lt;th&gt;SECOND FIELD&lt;/th&gt;\n    &lt;th&gt;THIRD FIELD&lt;/th&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n    &lt;td&gt;FIRST_OBJ_HERE_SHOULD_BE_THE_FIRST_FIELD&lt;/td&gt;\n    &lt;td&gt;FIRST_OBJ_HERE_SHOULD_BE_THE_SECOND_FIELD&lt;/td&gt;\n    &lt;td&gt;FIRST_OBJ_HERE_SHOULD_BE_THE_THIRD_FIELD&lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n    &lt;td&gt;SECOND_OBJ_HERE_SHOULD_BE_THE_FIRST_FIELD&lt;/td&gt;\n    &lt;td&gt;SECOND_OBJ_HERE_SHOULD_BE_THE_SECOND_FIELD&lt;/td&gt;\n    &lt;td&gt;SECOND_OBJ_HERE_SHOULD_BE_THE_THIRD_FIELD&lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;/table&gt;\n</code></pre>\n<p>As you see, I want to pass a slice with my struct (each one contains 3 files) to this html code, and I want the the whole slice will be set in this table - each row contains one struct data.</p>\n<p>How can I achieve this?</p>\n"}, {"tags": ["string", "go", "eol"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558790568, "post_id": 56305212, "comment_id": 99221036, "body": "What have you tried? Include your code. What problems did you encounter?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1558790659, "post_id": 56305212, "comment_id": 99221061, "body": "This is a slightly peculiar problem. Are newlines the only thing that need to be converted? Are you sure you don&#39;t just need to properly escape the entire string into whatever format you need?"}, {"owner": {"reputation": 430, "user_id": 929686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mfqEb.jpg?s=128&g=1", "display_name": "Allen Fisher", "link": "https://stackoverflow.com/users/929686/allen-fisher"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1558866643, "post_id": 56305212, "comment_id": 99234934, "body": "@Flimzy it was indeed just the newlines. This data is part of a bigger JSON blob that needed to be one value in a key-value pair"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558900608, "post_id": 56305212, "comment_id": 99242902, "body": "So what if that data has a literal <code>\\n</code> string in it? You don&#39;t want to escape that?"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1558794196, "creation_date": 1558794196, "answer_id": 56305677, "question_id": 56305212, "link": "https://stackoverflow.com/questions/56305212/convert-line-endings-to-n-literals/56305677#56305677", "title": "Convert line endings to &quot;\\n&quot; literals", "body": "<p>I have a feeling this is an <a href=\"https://en.wikipedia.org/wiki/XY_problem\" rel=\"nofollow noreferrer\">XY</a> problem...</p>\n\n<p>but to simply replace a newline byte '\\n' with a 2-char string <code>\\n</code>, use:</p>\n\n<pre><code>strings.ReplaceAll(data, \"\\n\", \"\\\\n\")\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Xmg4pgqFy5O\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Xmg4pgqFy5O</a></p>\n\n<p>Output:</p>\n\n<pre><code>{\"name\": 2019-05-25,\\n\"tracker\": {\\n\"project\": {\\n  \"uri\": \"/project/87\",\\n ....\n</code></pre>\n\n<p><strong>Note:</strong> this does <em>not</em> handle other formatting characters such as tab (<code>\\t</code>) carriage-return (<code>\\r</code>) etc.</p>\n"}, {"comments": [{"owner": {"reputation": 430, "user_id": 929686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mfqEb.jpg?s=128&g=1", "display_name": "Allen Fisher", "link": "https://stackoverflow.com/users/929686/allen-fisher"}, "edited": false, "score": 1, "creation_date": 1558866145, "post_id": 56306411, "comment_id": 99234824, "body": "Thanks. This is what I ended up doing. Not quite sure why it wasn&#39;t working when I first tried it, but this is exactly what I needed. Thanks also for the before Go 1.12 piece. My build boxes are still on 1.11."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1558800335, "last_edit_date": 1558800335, "creation_date": 1558799550, "answer_id": 56306411, "question_id": 56305212, "link": "https://stackoverflow.com/questions/56305212/convert-line-endings-to-n-literals/56306411#56306411", "title": "Convert line endings to &quot;\\n&quot; literals", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := `\"project\": {\n  \"uri\": \"/project/87\",\n  \"name\": \"Allen's Test\"\n},`\n    fmt.Println(s)\n    s = strings.ReplaceAll(s, \"\\n\", `\\n`)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/lKZw78yOuMc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lKZw78yOuMc</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"project\": {\n  \"uri\": \"/project/87\",\n  \"name\": \"Allen's Test\"\n},\n\"project\": {\\n  \"uri\": \"/project/87\",\\n  \"name\": \"Allen's Test\"\\n},\n</code></pre>\n\n<hr>\n\n<p>For before Go 1.12, write:</p>\n\n<pre><code>s = strings.Replace(s, \"\\n\", `\\n`, -1)\n</code></pre>\n"}], "owner": {"reputation": 430, "user_id": 929686, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mfqEb.jpg?s=128&g=1", "display_name": "Allen Fisher", "link": "https://stackoverflow.com/users/929686/allen-fisher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 1, "closed_date": 1558839238, "accepted_answer_id": 56306411, "answer_count": 2, "score": -1, "last_activity_date": 1558966830, "creation_date": 1558790492, "last_edit_date": 1558966830, "question_id": 56305212, "link": "https://stackoverflow.com/questions/56305212/convert-line-endings-to-n-literals", "closed_reason": "Not suitable for this site", "title": "Convert line endings to &quot;\\n&quot; literals", "body": "<p>I have an interesting problem to solve. Because of a tool that I have to talk to, I need to convert newlines to the literal string <code>\\n</code> I have the following data</p>\n\n<pre><code>{\"name\": 2019-05-25,\n\"tracker\": {\n\"project\": {\n  \"uri\": \"/project/87\",\n  \"name\": \"Allen's Test\"\n},\n\"uri\": \"/tracker/57483\",\n\"name\": \"Tasks\"\n        },\n\"description\": \"[{Table\n\n||Stack\n||Current Version\n||New Version\n||Changes\n|common\n|1.0.214\n|1.0.214\n|* blah - [#345|https://blah.com/345]\n\n|workflow\n|2.2.23\n|2.2.23\n|* [ES-12345] blah - [#1087|https://blah.com/1087]\n\n}]\",\n\"descFormat\": \"Wiki\"}\n</code></pre>\n\n<p>so basically instead of a multiline string, I need to convert it to a single line string with \\n's where the tool on the backend will convert it. I'm using go and not quite sure where to start. I asssume I need raw strings, but many of the source bits are api calls that have the newlines built in. </p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["docker", "go"], "owner": {"reputation": 379, "user_id": 8575803, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dade10f0dac8c4b62839dfbd845ced8?s=128&d=identicon&r=PG&f=1", "display_name": "In0cenT", "link": "https://stackoverflow.com/users/8575803/in0cent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 812, "favorite_count": 1, "closed_date": 1558784243, "answer_count": 0, "score": 5, "last_activity_date": 1558784671, "creation_date": 1558784114, "last_edit_date": 1558784671, "question_id": 56304449, "link": "https://stackoverflow.com/questions/56304449/can-i-pass-docker-run-arguments-to-optional-golang-flags", "closed_reason": "Duplicate", "title": "Can I pass Docker run arguments to optional Golang flags?", "body": "<p>I want to run a simple go script in a docker container. The script has some flags like the two examples bellow.</p>\n\n<p>Flags:</p>\n\n<pre><code>dataSource := flag.String(\"input\", \"\", \"Path\")\n...\nconcurrency := flag.Int(\"concurrency\", 10, \"Concurrency\")\nflag.Parse()\n</code></pre>\n\n<p>Some flags have defaults set and are optional. Others are mandatory to be set by the user. How would I pass arguments in the docker run command to the go script without having the user to enter all arguments?</p>\n\n<p>Dockerfile:</p>\n\n<pre><code>FROM golang:alpine AS builder\nRUN apk update &amp;&amp; apk add --no-cache git\nWORKDIR $GOPATH/go/src/app\nENV GOBIN=/usr/local/bin\nCOPY . .\nRUN go get github.com/lib/pq\nRUN go build -o /go/bin/Import\nFROM scratch\nCOPY --from=builder /go/bin/Import /go/bin/Import\nENTRYPOINT [\"/go/bin/Import\"\"]\n</code></pre>\n\n<p>I've read the docs about <a href=\"https://docs.docker.com/v17.09/engine/reference/builder/#entrypoint\" rel=\"noreferrer\">ENTRYPOINT</a> but could not find anything suitable for me. Is it even possible or doesn't it make sense?</p>\n\n<p>I've read through posts like this one: <a href=\"https://stackoverflow.com/questions/42370404/pass-optional-arguments-when-running-a-docker-image\">Pass optional arguments when running a Docker image</a> . They simply pass single arguments, how would I define the default value for those?</p>\n\n<p>Thanks for any help</p>\n"}, {"tags": ["mysql", "go", "alpine", "go-cdk"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1558935130, "post_id": 56303638, "comment_id": 99248688, "body": "Does the container have access to your aws account, eg <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html\" rel=\"nofollow noreferrer\">aws configure</a>?"}, {"owner": {"reputation": 3237, "user_id": 9741769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b0913fe3d348f510777caaf5540169?s=128&d=identicon&r=PG&f=1", "display_name": "Blokje5", "link": "https://stackoverflow.com/users/9741769/blokje5"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1558941209, "post_id": 56303638, "comment_id": 99250783, "body": "Yes, it is able to send a file to the s3 bucket, so that is not the problem."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1558943700, "post_id": 56303638, "comment_id": 99251822, "body": "Well it&#39;s good it&#39;s partly working :-) Some random suggestions: 1) upgrade/update to latest Alpine Linux image as possibly the Alpine Linux image version has a problem, 2) switch from Alpine Linux image to Go:stretch, 3) in your code wrap all errors in fmt.Errorf(...) to pinpoint exactly where the error is coming from, 4) can you dump to file, then upload the file? 5) reduce <a href=\"https://github.com/fog/fog/issues/824\" rel=\"nofollow noreferrer\">latency</a>: is the mysqldump in the container slower? Can you increase container resources? Configure more frequent writes in smaller chunks to prevent aws thinking the socket is idle?"}, {"owner": {"reputation": 3237, "user_id": 9741769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b0913fe3d348f510777caaf5540169?s=128&d=identicon&r=PG&f=1", "display_name": "Blokje5", "link": "https://stackoverflow.com/users/9741769/blokje5"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1559029381, "post_id": 56303638, "comment_id": 99280255, "body": "Yeah I ended up writing it to local disk and moving that to s3. Still strange that it breaks, haven&#39;t figured out why."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1559079398, "post_id": 56303638, "comment_id": 99305667, "body": "I guess if the mysqldump is slower in the container then on the host (eg, host might have advantage of unix socket), that might delay the writes to aws, increasing latency to the point that aws closes the connection. Glad you got it working."}], "owner": {"reputation": 3237, "user_id": 9741769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b0913fe3d348f510777caaf5540169?s=128&d=identicon&r=PG&f=1", "display_name": "Blokje5", "link": "https://stackoverflow.com/users/9741769/blokje5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 360, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558777243, "creation_date": 1558777243, "question_id": 56303638, "link": "https://stackoverflow.com/questions/56303638/errno-32-broken-pipe-on-alpine-linux-docker-image-when-passing-exec-stdout-to-s3", "title": "Errno 32 broken pipe on Alpine Linux Docker image when passing exec stdout to s3 bucket using the go cloud development kit", "body": "<p>I wrote a small utility to pipe the output of the mysqldump command to an s3 bucket in golang, which I intend to use to snapshot and restore our database in an end-to-end test environment. When I run this locally, everything works as expected: the utility correctly pipes the mysqldump output to the s3 bucket. However, when running in the Alpine Linux Docker image, I get a broken pipe error. The utility then sends a empty file to the s3 bucket.</p>\n\n<p>To execute mysqldump, I simply use the <code>exec</code> package. Code for mysqldump:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (conf *MySQLConfig) DumpDatabases(stdout io.Writer) error {\n    args := []string{\"-u\", conf.User, fmt.Sprintf(\"--password=%s\", conf.Password), \"-h\", conf.Host, \"--databases\"}\n    args = append(args, conf.Databases...)\n    cmd := exec.Command(\"mysqldump\", args...)\n\n    cmd.Stdout = stdout\n    cmd.Stderr = os.Stderr\n\n    err := cmd.Start()\n    if err != nil {\n        return err\n    }\n    cmd.Wait()\n\n    return nil\n}\n</code></pre>\n\n<p>The upload to the S3 bucket utilises the <code>go-cdk</code>. It expects a function that expects an <code>io.Writer</code> as input and returns an <code>error</code>. In this case the following snippet is executed to pipe the output of <code>mysqldump</code> to s3:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>bucket.Upload(func(w io.Writer) error { return mysqlConf.DumpDatabases(w) })\n</code></pre>\n\n<p>Code for the upload:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (b *Bucket) Upload(writeFunc func(io.Writer) error) error {\n    // Open a connection to the bucket.\n    ctx := context.Background()\n\n    bucket, err := blob.OpenBucket(ctx, b.Url)\n\n    if err != nil {\n        return err\n    }\n    defer bucket.Close()\n\n    // Add encryption header\n    beforeWrite := func(asFunc func(interface{}) bool) error {\n        var input *s3manager.UploadInput\n        if asFunc(&amp;input) {\n            input.ServerSideEncryption = aws.String(\"AES256\")\n        }\n        return nil\n    }\n\n    opts := &amp;blob.WriterOptions{}\n    opts.BeforeWrite = beforeWrite\n\n    w, err := bucket.NewWriter(ctx, generateKey(), opts)\n    if err != nil {\n        return err\n    }\n\n    err = writeFunc(w)\n    if err != nil {\n        return err\n    }\n\n    if err := w.Close(); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Any clue why I get a broken pipe error when running this code on Alpine Linux, while it works as expected locally? Any suggestions on how to debug this issue to figure out what exactly is happening? Should I utilise buffered IO?</p>\n"}, {"tags": ["go", "systemd", "go-echo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1558776616, "post_id": 56303271, "comment_id": 99218109, "body": "No particular reason why this should happen. Do note you run the service as root, and when you test I assume you do it with a normal user. Check if this may have an effect on what your app does. Other than that this can&#39;t be answered without seeing your code."}, {"owner": {"reputation": 1550, "user_id": 3079776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/NmNaz.png?s=128&g=1", "display_name": "M14", "link": "https://stackoverflow.com/users/3079776/m14"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558776743, "post_id": 56303271, "comment_id": 99218144, "body": "I resolved the issue by using <code>supervisor</code> instead of <code>systemd</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558776792, "post_id": 56303271, "comment_id": 99218161, "body": "Also, does your app launch other processes that outlive your app? If so and your app dies often, since it is auto-restarted, those new processes might quickly grow in number..."}, {"owner": {"reputation": 1550, "user_id": 3079776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/NmNaz.png?s=128&g=1", "display_name": "M14", "link": "https://stackoverflow.com/users/3079776/m14"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558776837, "post_id": 56303271, "comment_id": 99218171, "body": "No this particular app does not use any other process."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 4, "creation_date": 1558787800, "post_id": 56303271, "comment_id": 99220380, "body": "<code>ExecStart=&#47;var&#47;www&#47;myapp&#47;public_html&#47;my.app</code> This looks <i>very</i> odd to me. furthermore, it is run as <code>root</code>, which is an absolute &quot;No no&quot; for a webserver - if someone is able to hijack the process, the attacker has root permissions. Not to mention directory traversal and other stuff that might easily happen. When using the unit, what does <code>systemctl status myapp</code> say?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1558803949, "post_id": 56303271, "comment_id": 99224414, "body": "Obviously using supervisord is just a workaround, not a real solution. You probably forgot to set your <code>WorkingDirectory=</code> and some bug is causing your program to freak out because of some missing file."}], "owner": {"reputation": 1550, "user_id": 3079776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/NmNaz.png?s=128&g=1", "display_name": "M14", "link": "https://stackoverflow.com/users/3079776/m14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 307, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558774836, "creation_date": 1558774271, "last_edit_date": 1558774836, "question_id": 56303271, "link": "https://stackoverflow.com/questions/56303271/go-server-out-of-memory-when-running-as-systemd-service", "title": "go server out of memory when running as systemd service", "body": "<p>I have created a webserver using the Echo router. It act as a REST endpoint. I tried to deploy it in an Ubuntu server using <code>systemd</code>. The requests are getting out of memory when I try to run it as a service. However it is working fine when I run it in terminal What could be the issue.</p>\n\n<p><strong>my service file</strong></p>\n\n<pre><code>[Unit]\nDescription=myapp\n\n[Service]\nType=simple\nUser=root\nEnvironment=ENV=PRODUCTION\nExecStart=/var/www/myapp/public_html/my.app\nRestart=always\nRestartSec=5s\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "edited": false, "score": 0, "creation_date": 1558763316, "post_id": 56302053, "comment_id": 99215681, "body": "I added those now as mentioned above. Though the prompt is no more seen ,I get <code>go: modernc.org&#47;strutil@v1.0.0: unknown revision v1.0.0 go: modernc.org&#47;xc@v1.0.0: unknown revision v1.0.0 go: modernc.org&#47;mathutil@v1.0.0: unknown revision v1.0.0 go: modernc.org&#47;cc@v1.0.0: unknown revision v1.0.0 go: modernc.org&#47;golex@v1.0.0: unknown revision v1.0.0 go: error loading module requirements</code>"}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "reply_to_user": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "edited": false, "score": 0, "creation_date": 1558764290, "post_id": 56302053, "comment_id": 99215822, "body": "@ambikanair <code>modernc.org&#47;mathutil</code> has no tag v1.0.0?"}, {"owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "edited": false, "score": 0, "creation_date": 1558766445, "post_id": 56302053, "comment_id": 99216151, "body": "I am using <code>go.mod</code> and to create a vendor folder I execute <code>go mod vendor</code> durin which the above error is seen. So in the <code>mod</code> file I have not specified <code>modernc.org&#47;</code> anywhere. May be this is indirect dependency"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1558763022, "last_edit_date": 1558763022, "creation_date": 1558762680, "answer_id": 56302053, "question_id": 56300888, "link": "https://stackoverflow.com/questions/56300888/authentication-errors-while-using-go-test/56302053#56302053", "title": "Authentication errors while using go test", "body": "<p>This is normal SSH behavior when it does not know the host keys. The go tooling does not surface the prompt asking you to accept (or reject) the host keys.</p>\n\n<p>You can add them yourself by running:</p>\n\n<pre><code># Fetch keys for gitlab.com, save them to a temporary file.\n$ ssh-keyscan -H gitlab.com &gt; tmpkeys\n# Print the checksums\n$ ssh-keygen -l -f tmpkeys\n2048 SHA256:ROQFvPThGrW4RuWLoL9tq9I9zJ42fK4XywyRtbOz/EQ |1|acl3SWCVoYBF6aZrd2FSWIafzT8=|fu8Ivfg6HIGVxsFSx5u3aZwY6CQ= (RSA)\n256 SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw |1|LMWC/o9XJxW3EtS0hN8/WBBkPrk=|JocpRioPZiOte6ek33XOO6JljQY= (ECDSA)\n256 SHA256:eUXGGm1YGsMAS7vkcx6JOJdOGHPem5gQp4taiCfCLB8 |1|BAhrVESJhSsdsGsXHXzY1bvW3P0=|p4KuzvnpUqZA/PGKGkjN0sXKsuk= (ED25519)\n# If satisfied with the checksums, append the keys to the known hosts file.\n$ cat tmpkeys &gt;&gt; ~/.ssh/known_hosts \n</code></pre>\n\n<p>The host key checksums can be verified on <a href=\"https://docs.gitlab.com/ee/user/gitlab_com/#ssh-host-keys-fingerprints\" rel=\"nofollow noreferrer\">gitlab's site</a>.</p>\n\n<p>Once you've done this: try the command again, it should stop prompting you for host keys as they will be known.</p>\n"}], "owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 56302053, "answer_count": 1, "score": 3, "last_activity_date": 1558763022, "creation_date": 1558745995, "question_id": 56300888, "link": "https://stackoverflow.com/questions/56300888/authentication-errors-while-using-go-test", "title": "Authentication errors while using go test", "body": "<p>I am using <code>go test</code> command after setting <code>export GO111MODULE=on</code> to update <code>go.mod</code> and run a test suite.</p>\n\n<p>I see so many authentication errors like below</p>\n\n<pre><code>The authenticity of host 'gitlab.com (35.231.145.151)' can't be established.\nECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.\nAre you sure you want to continue connecting (yes/no)? The authenticity of host 'gitlab.com (35.231.145.151)' can't be established.\nECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.\nAre you sure you want to continue connecting (yes/no)? The authenticity of host 'gitlab.com (35.231.145.151)' can't be established.\nECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.\nAre you sure you want to continue connecting (yes/no)? The authenticity of host 'gitlab.com (35.231.145.151)' can't be established.\nECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.\nAre you sure you want to continue connecting (yes/no)? go: modernc.org/cc@v1.0.0: unknown revision v1.0.0\ngo: modernc.org/mathutil@v1.0.0: unknown revision v1.0.0\nThe authenticity of host 'gitlab.com (35.231.145.151)' can't be established.\nECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.\nAre you sure you want to continue connecting (yes/no)? go: modernc.org/strutil@v1.0.0: unknown revision v1.0.0\ngo: modernc.org/golex@v1.0.0: unknown revision v1.0.0\n</code></pre>\n\n<p>go version is <code>go1.12.1 linux/amd64</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 5, "creation_date": 1558735949, "post_id": 56300021, "comment_id": 99212251, "body": "<a href=\"https://floating-point-gui.de/\" rel=\"nofollow noreferrer\">floating-point-gui.de</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558800007, "post_id": 56300021, "comment_id": 99223445, "body": "See related / possible duplicate: <a href=\"https://stackoverflow.com/questions/26120311/why-does-adding-0-1-multiple-times-remain-lossless\">Why does adding 0.1 multiple times remain lossless?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 392, "user_id": 1779833, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/PYY1C.jpg?s=128&g=1", "display_name": "Jo&#227;o Costa", "link": "https://stackoverflow.com/users/1779833/jo%c3%a3o-costa"}, "is_accepted": false, "score": 1, "last_activity_date": 1558736013, "creation_date": 1558736013, "answer_id": 56300058, "question_id": 56300021, "link": "https://stackoverflow.com/questions/56300021/golang-not-incrementing-by-0-1/56300058#56300058", "title": "Golang not incrementing by 0.1", "body": "<p>Short answer:\nIt has to do with how numbers are stored in a computer.</p>\n\n<p>Specifically for GoLang you might want to read <a href=\"https://www.golang-book.com/books/intro/3\" rel=\"nofollow noreferrer\">\"Floating Point Numbers\"</a></p>\n"}, {"tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": false, "score": 5, "last_activity_date": 1558737512, "creation_date": 1558737512, "answer_id": 56300186, "question_id": 56300021, "link": "https://stackoverflow.com/questions/56300021/golang-not-incrementing-by-0-1/56300186#56300186", "title": "Golang not incrementing by 0.1", "body": "<p>A binary floating-point number can't hold 1/10 exactly, just like a decimal number with a finite number of digits can't hold 1/3 exactly. When you keep adding 0.1 repeatedly, the errors add up to enough that they show up in your program's output.</p>\n\n<p>The best way to fix this is to use an integer as your loop control variable, and calculate your floating-point value from it at each iteration:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for i := 1; i &lt; 50; i++ {\n    f := float64(i) / 10\n    fmt.Printf(\"%v, \", f)\n}\n</code></pre>\n\n<p>Note that I'm dividing by 10 instead of multiplying by 0.1 (actually by the binary approximation of 0.1).</p>\n"}], "owner": {"reputation": 199, "user_id": 706382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04c48ab5e0e2b2f4f0c41f7783a00d4?s=128&d=identicon&r=PG", "display_name": "Khanivore", "link": "https://stackoverflow.com/users/706382/khanivore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "closed_date": 1558778524, "answer_count": 2, "score": 0, "last_activity_date": 1558737512, "creation_date": 1558735703, "last_edit_date": 1558736712, "question_id": 56300021, "link": "https://stackoverflow.com/questions/56300021/golang-not-incrementing-by-0-1", "closed_reason": "Duplicate", "title": "Golang not incrementing by 0.1", "body": "<p>Following Go code </p>\n\n<p><code>for i := 0.0 ; i &lt; 5 ; i+=0.1 {\n    fmt.Printf(\"%v, \", i)\n}</code></p>\n\n<p>results in this (partial) output</p>\n\n<pre><code>0, 0.1, 0.2, 0.30000000000000004, 0.4, 0.5\n</code></pre>\n\n<p>Why am I getting 0.30000000000000004 instead of 0.3?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1558734935, "post_id": 56299907, "comment_id": 99211995, "body": "If the goroutines access independent fields, then no."}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 2342228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70bec81388062ef3b3cfba0cfa695cf?s=128&d=identicon&r=PG", "display_name": "Matthew Dempsky", "link": "https://stackoverflow.com/users/2342228/matthew-dempsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1558863179, "creation_date": 1558863179, "answer_id": 56312303, "question_id": 56299907, "link": "https://stackoverflow.com/questions/56299907/should-i-protect-a-struct-object-with-mutex/56312303#56312303", "title": "Should I protect a struct object with mutex?", "body": "<p>You do not need a mutex for this program. As far as the Go memory model is concerned, separate fields of a struct are separate variables. Since the four goroutines are accessing four separate (sub-)variables, there is no data race, even without the mutex.</p>\n\n<p>You can verify this by removing the mutex and running your program with the race detector enabled: <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/race_detector.html</a></p>\n"}], "owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 56312303, "answer_count": 1, "score": 0, "last_activity_date": 1558863179, "creation_date": 1558734805, "last_edit_date": 1558735077, "question_id": 56299907, "link": "https://stackoverflow.com/questions/56299907/should-i-protect-a-struct-object-with-mutex", "title": "Should I protect a struct object with mutex?", "body": "<p>I use 4 go routines to assign different member variables of a struct instance. Each member variable is only accessed by one go routine.</p>\n\n<p>Do I need to add mutex when accessing the struct instance?</p>\n\n<p>I am not sure if the 4 go routines access the same memory. I feel I should be cause all of them accesses the holder.</p>\n\n<p>This code demonstrates what I'm doing.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    var res Response\n\n    var mu sync.Mutex\n\n    wg.Add(1)\n    go func() {\n\n        defer wg.Done()\n        mu.Lock()\n        defer mu.Unlock()\n        res.A = []string{\"a\"}\n    }()\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        mu.Lock()\n        defer mu.Unlock()\n        res.B = \"b\"\n    }()\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        mu.Lock()\n        defer mu.Unlock()\n        res.C = 100\n    }()\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        mu.Lock()\n        defer mu.Unlock()\n        res.D = map[string]string{\n            \"d\": \"dd\",\n        }\n    }()\n\n    wg.Wait()\n\n    fmt.Println(res)\n\n}\n\ntype Response struct {\n    A []string\n    B string\n    C int\n    D map[string]string\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1558733528, "post_id": 56299648, "comment_id": 99211670, "body": "Is your question here asking for an exhaustive list of the differences in behavior between the two ways of defining a function named <code>myFunction</code>? I think that can be provided; just checking."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1558735110, "post_id": 56299648, "comment_id": 99212033, "body": "The var approach is not idiomatic and godoc will not display the &quot;functions&quot; as functions;"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1558745503, "post_id": 56299648, "comment_id": 99213700, "body": "yes <code>var MyFunction = func(){}</code> is very JavaScript-y.  When in doubt, go with the simpler more declarative form."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558785506, "post_id": 56299648, "comment_id": 99219878, "body": "Why do you believe using <code>var</code> will help with unit tests? This is a code smell to me. I suspect your unit test approach can be improved."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1558986586, "creation_date": 1558986586, "answer_id": 56331733, "question_id": 56299648, "link": "https://stackoverflow.com/questions/56299648/defining-function-using-var-vs-function/56331733#56331733", "title": "defining function using var vs function", "body": "<p>The chief distinction between the two forms is that they differ not only in syntax but rather in their <em>semantics:</em></p>\n\n<ul>\n<li>The \"normal\" form which uses the <code>func name (...)</code> form\ncreates a regular named function.</li>\n<li>What you call \"create a function using <code>var</code>\" is actually creating a so-called anonymous function and assigning its value to a variable.</li>\n</ul>\n\n<p>The difference is that in Go, anonymous functions behave as <em>closures,</em> while regular functions do not.</p>\n\n<p>A closure is a function which \"captures\" any variables from its outer lexical scope which are used in the function's body (while not being shadowed by local variables and function arguments there).</p>\n\n<p>The distinction may not be apparent when either form it used at the top level of a package \u2014 that is, outside of any function's body, \u2014 since the outer scope in this case is the package's global variables, but inside other functions the distinction is apparent: the \"normal\" form simply cannot be used.</p>\n\n<p>Other distinction is that you can replace the value in a variable containing a function value, while you cannot do the same with the normal function.</p>\n\n<p>Still, if we're talking about the top-level code, the suggestion offered by Flimzy holds: in production Go code, having global variables containing function values is code smell <em>until</em> it can be proved to be otherwise.</p>\n"}], "owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1558986586, "creation_date": 1558732818, "question_id": 56299648, "link": "https://stackoverflow.com/questions/56299648/defining-function-using-var-vs-function", "title": "defining function using var vs function", "body": "<p>exported:</p>\n\n<pre><code>var MyFunction = func(){}\nfunction MyFunction func(){}\n</code></pre>\n\n<p>unexported:</p>\n\n<pre><code>var myFunction = func(){}\nfunction myFunction func(){}\n</code></pre>\n\n<p>I read the <a href=\"https://stackoverflow.com/questions/336859/var-functionname-function-vs-function-functionname\">var functionName = function() {} vs function functionName() {}</a> this is about Javascript.</p>\n\n<p>The reason I am considering changing from <code>function myFunction func(){}</code> to <code>var myFunction = func(){}</code> is the later makes me easier to do my unit test.</p>\n\n<p>So I am wondering if there's anything I need to pay attention to before making this change.</p>\n"}, {"tags": ["go", "go-get"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1558727833, "post_id": 56298583, "comment_id": 99209991, "body": "Why have you structured it this way? If you want to use the standard tools, you need to follow the same guidelines that the tools use."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558730267, "post_id": 56298583, "comment_id": 99210777, "body": "Also <i>how</i> have you structured it this way? I didn&#39;t think github would let you do that unless it&#39;s a git submodule,  in which case you&#39;d probably need to import it using the original git repo URL instead of pointing at the submodule."}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1558736343, "post_id": 56298583, "comment_id": 99212363, "body": "is gomodule is on?"}, {"owner": {"reputation": 108, "user_id": 3340308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df6a8e5b9b9b3c0a67a49750e3824430?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek627", "link": "https://stackoverflow.com/users/3340308/abhishek627"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1558756609, "post_id": 56298583, "comment_id": 99214799, "body": "@JimB In my company, we have a common project, inside that we have different directories referring to whether it is infrastructure code or service code, inside service dir, we have all the individual services. Is that the wrong structure to maintain the code ? What would you suggest in this case?"}, {"owner": {"reputation": 108, "user_id": 3340308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df6a8e5b9b9b3c0a67a49750e3824430?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek627", "link": "https://stackoverflow.com/users/3340308/abhishek627"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558756740, "post_id": 56298583, "comment_id": 99214814, "body": "@Adrian I used github as an example because I thought it would be similar for all version controls. I&#39;m using gitlab for company actually. And that allows this structure."}, {"owner": {"reputation": 108, "user_id": 3340308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df6a8e5b9b9b3c0a67a49750e3824430?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek627", "link": "https://stackoverflow.com/users/3340308/abhishek627"}, "reply_to_user": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1558757104, "post_id": 56298583, "comment_id": 99214867, "body": "@Maruf Tuhin In go module usage page, I read that we should not do init in subdir but at dir level. Is that correct ?"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 1, "creation_date": 1558790235, "post_id": 56298583, "comment_id": 99220960, "body": "@abhishek627, seems like, that is correct. Whenever you run <code>go mod init</code>, it will consider it as a root directory and it will create a <code>go.mod</code> on that path. So, you need to be on root of a project while initializing go mod."}], "owner": {"reputation": 108, "user_id": 3340308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df6a8e5b9b9b3c0a67a49750e3824430?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek627", "link": "https://stackoverflow.com/users/3340308/abhishek627"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558726152, "creation_date": 1558726152, "question_id": 56298583, "link": "https://stackoverflow.com/questions/56298583/how-to-use-go-get-to-get-nested-project-structure", "title": "How to use go-get to get nested project structure", "body": "<p>I have a github structure like :</p>\n\n<p>group_name/Project_dir/Project_subdir which looks like this <code>git@github.com:group_name/project_dir/subdir.git</code> on github . I'm trying to use go-get to get the project but it treats <code>go get github.com/group_name/project_dir/subdir</code> like group_name/project_dir.git and fails. </p>\n\n<p>I have done <code>go get github.com/group_name/project_dir/subdir.git</code> but it pulls the code to subdir.git folder.</p>\n\n<p>Is there any other way to get this code in subdir folder apart from manually doing <code>mv subdir.get subdir</code> ?</p>\n"}, {"tags": ["html", "go", "web-scraping", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 8167884, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xSTePLbwCkI/AAAAAAAAAAI/AAAAAAAAAJM/nMxEW2rxk8A/photo.jpg?sz=128", "display_name": "TheFlyBiker 420", "link": "https://stackoverflow.com/users/8167884/theflybiker-420"}, "edited": false, "score": 0, "creation_date": 1558723685, "post_id": 56298113, "comment_id": 99208507, "body": "Also show what logs in your console when trying to console log the result from the fetch."}, {"owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "edited": false, "score": 0, "creation_date": 1558883743, "post_id": 56298113, "comment_id": 99238647, "body": "Thank you for the suggestion. Actually, I already have a User-Agent set to Mozilla/5.0. How can I get some logs ? I can share the query with you and the list of tags that I get from the GoQuery selection"}, {"owner": {"reputation": 37, "user_id": 8167884, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xSTePLbwCkI/AAAAAAAAAAI/AAAAAAAAAJM/nMxEW2rxk8A/photo.jpg?sz=128", "display_name": "TheFlyBiker 420", "link": "https://stackoverflow.com/users/8167884/theflybiker-420"}, "reply_to_user": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "edited": false, "score": 0, "creation_date": 1558893613, "post_id": 56298113, "comment_id": 99241214, "body": "No i meant update your question with all the information."}], "tags": [], "owner": {"reputation": 37, "user_id": 8167884, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xSTePLbwCkI/AAAAAAAAAAI/AAAAAAAAAJM/nMxEW2rxk8A/photo.jpg?sz=128", "display_name": "TheFlyBiker 420", "link": "https://stackoverflow.com/users/8167884/theflybiker-420"}, "is_accepted": false, "score": 0, "last_activity_date": 1558723605, "creation_date": 1558723605, "answer_id": 56298113, "question_id": 56297845, "link": "https://stackoverflow.com/questions/56297845/cannot-collect-all-nodes-of-google-search-result-with-goquery-some-nodes-are-mi/56298113#56298113", "title": "Cannot collect all nodes of Google search result with goquery: some nodes are missing", "body": "<p>This has happened to me before. I was trying to web scrape with python beautiful soup package and the same thing was happening.</p>\n\n<p>Later it turned out that the html markup returned when trying to fetch it was actually the markup the server returned after finding a bot. I solved this by setting the <code>User-Agent</code> to <code>Mozilla/5.0</code>.</p>\n\n<p>Hope this helps in your quest to solve this.\nYou can start by updating the code for the fetch request you have performed.</p>\n"}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558723605, "creation_date": 1558722291, "question_id": 56297845, "link": "https://stackoverflow.com/questions/56297845/cannot-collect-all-nodes-of-google-search-result-with-goquery-some-nodes-are-mi", "title": "Cannot collect all nodes of Google search result with goquery: some nodes are missing", "body": "<p>I am trying to collect results of a google search page in GoLang using the goquery library. In order to achieve this, I am collecting all nodes of a goquery selection with goquery. The problem is that the selection returned by Find(\"*\") does not seem to contain all the nodes of the HTML document. Question: does the method collect ALL nodes with the whole tree structure or not ? If not, is there a method to collect them all ?</p>\n\n<p>I tried using the goquery Find(\"*\") method applied to the whole document selection. So nodes with certain attributes are not returned, although they are in the HTML document. For instance, nodes with  are not recognized</p>\n\n<p>alltags := doc.Find(\"*\") //doc is the HTML doc with the Google search</p>\n\n<p>The selection does not contain the div tags with class=\"srg\". The same applies to other class values such as \"bkWMgd\", \"rc\" for example.</p>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558722638, "post_id": 56297843, "comment_id": 99208076, "body": "Where is that output coming from? Assuming the caller of the code shown is printing the error returned, the quoted output doesn&#39;t match any of the returned errors."}, {"owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558723019, "post_id": 56297843, "comment_id": 99208247, "body": "sorry multiple iterations of the code changed the output. I&#39;ve fixed it to show the latest, which comes from this line <code>return errors.Wrap(err3, &quot;ssh wait failed&quot;)</code>, at other times for newer hosts it just hangs after printing the exec on first line."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558724802, "post_id": 56297843, "comment_id": 99208924, "body": "You&#39;re recording the stdout/stderr from the command but don&#39;t seem to be doing anything with it. Have you tried logging that to see what the output is? It likely sheds some light on the issue."}, {"owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558725457, "post_id": 56297843, "comment_id": 99209152, "body": "It actually prints those to the screen later on in the code, I truncated that part since it never gets there and the wait hangs forever. I just tried adding some prints for those before the wait() and they are empty, so nothing is coming out."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558725686, "post_id": 56297843, "comment_id": 99209252, "body": "It probably hangs because you never close the input. <code>ssh</code> is just sitting there waiting for something to happen until the connection times out and closes."}, {"owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558727622, "post_id": 56297843, "comment_id": 99209911, "body": "So the input from p1 that pipes to ssh should complete the execution, and interesting part is that it happens successfully that way if I omit <code>StrictHostKeyChecking=no</code> . But you&#39;re right, I have a feeling that is what the issue is and I can&#39;t quite figure out how to add a close, since the close call is only supported on StdinPipe"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558727892, "post_id": 56297843, "comment_id": 99210012, "body": "You&#39;re creating the pipe so you can assign it to a local var (which would be of type <code>io.ReadCloser</code>) and then close it when you need to. Since you know what you&#39;ve assigned to <code>Stdin</code>, you could also do <code>p2.Stdin.(io.Closer).Close()</code>."}, {"owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558729177, "post_id": 56297843, "comment_id": 99210436, "body": "Nope, adding a close right before the wait didn&#39;t help. It doesnt seem to be capturing  any input."}, {"owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558729703, "post_id": 56297843, "comment_id": 99210612, "body": "Ah I captured the closing error, it says <code>closing failed: close |0: file already closed</code> ; so looks like the the connection either never establishes or closes immediately."}], "owner": {"reputation": 1, "user_id": 11551748, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j3YViQvqQwc/AAAAAAAAAAI/AAAAAAAAAD8/_8QAjj-AxDk/photo.jpg?sz=128", "display_name": "jkhan", "link": "https://stackoverflow.com/users/11551748/jkhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558722643, "creation_date": 1558722281, "last_edit_date": 1558722643, "question_id": 56297843, "link": "https://stackoverflow.com/questions/56297843/go-exec-command-hangs-on-stricthostkeychecking-no", "title": "Go exec.Command hangs on StrictHostKeyChecking=no", "body": "<p>I'm trying to ssh in to a group of servers that don't support a regular shell. The /crypto/ssh library doesn't work for these hence I'm using a direct ssh through <code>exec.Command</code>. </p>\n\n<p>Now the problem is that this command just hangs if I pass <code>-o StrictHostKeyChecking=no</code> , i.e:\n<code>exec.Command(\"ssh\", \"-o\", \"StrictHostKeyChecking=no\", config.User + \"@\" + host)</code></p>\n\n<p>but works for a simple </p>\n\n<p><code>exec.Command(\"ssh\", \"-T\", config.User + \"@\" + host)</code></p>\n\n<p>The full block of code is here (it basically just needs to pipe a command to an ssh connection like so</p>\n\n<p><code>echo hostname | ssh -T -o StrictHostKeyChecking=no user1@db1-ar6.name.local</code>: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>p1 := exec.Command(\"echo\", config.Command)\np2 := exec.Command(\"ssh\", \"-o\", \"StrictHostKeyChecking=no\", config.User + \"@\" + host)\n//p2 := exec.Command(\"ssh\", \"-T\", config.User + \"@\" + host) //doesn't work\n\nfmt.Println(p2) //checking output\n\nvar stdout, stderr bytes.Buffer\np2.Stdout = &amp;stdout\np2.Stderr = &amp;stderr\n\np2.Stdin, _ = p1.StdoutPipe()       // p1 pipe to p2 ssh\n\n\nerr1 := p2.Start()  // start ssh command but dont wait for it to finish\nif err1 != nil {\n  return errors.Wrap(err1, \"starting ssh session failed\")\n        }\n\nerr2 := p1.Run()    // run pipe command and wait for it to finish\nif err2 != nil {\n  return errors.Wrap(err2, config.Command+\" failed\", )\n         }\n\n\nerr3 := p2.Wait()   // ssh wait for pipe to close\nif err3 != nil {\n  return errors.Wrap(err3, \"ssh wait failed\")\n         }\n</code></pre>\n\n<p>Output is, and the wait function fails:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>&amp;{/usr/bin/ssh [ssh -o StrictHostKeyChecking=no user1@db1-ar6.name.local] []  &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; false [] [] [] [] &lt;nil&gt; &lt;nil&gt;}\n2019/05/24 10:28:41 ssh wait failed: exit status 255\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1558711095, "post_id": 56295357, "comment_id": 99203335, "body": "does the doc examples answer your question ? <a href=\"https://golang.org/pkg/encoding/binary/#example_ByteOrder_get\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/binary/#example_ByteOrder_get</a> see put"}, {"owner": {"reputation": 11, "user_id": 11544147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1bc2f1764f8ee3e8973736613063f56?s=128&d=identicon&r=PG&f=1", "display_name": "Natasha", "link": "https://stackoverflow.com/users/11544147/natasha"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1558711206, "post_id": 56295357, "comment_id": 99203385, "body": "I can get example? :)"}], "owner": {"reputation": 11, "user_id": 11544147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1bc2f1764f8ee3e8973736613063f56?s=128&d=identicon&r=PG&f=1", "display_name": "Natasha", "link": "https://stackoverflow.com/users/11544147/natasha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "closed_date": 1558711638, "answer_count": 0, "score": 0, "last_activity_date": 1558710782, "creation_date": 1558710782, "question_id": 56295357, "link": "https://stackoverflow.com/questions/56295357/change-byte-order-of-bigint", "closed_reason": "Duplicate", "title": "Change byte order of bigint", "body": "<p>I have a bigint variable can be change it to []byte arry with <code>x.Bytes()</code> (x is my bigint variable) call</p>\n\n<p>How can change byte order of this big int or converted to []byte, from big (default) to little endian?</p>\n"}, {"tags": ["go", "testing", "fail-fast"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1558706992, "post_id": 56294288, "comment_id": 99201145, "body": "I don&#39;t believe it&#39;s currently possible. For what&#39;s planned for the future, see the Go issue tracker in Github and the Go mailing lists. I wouldn&#39;t expect it any time soon though; one of the major goals of Go is to have the build/test cycle as fast as possible, and typically there&#39;s a lot more value from knowing about everything that failed than just the first thing that failed, so I doubt this is a high-demand feature."}, {"owner": {"reputation": 5032, "user_id": 815781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wnZ4A.jpg?s=128&g=1", "display_name": "Onlyjob", "link": "https://stackoverflow.com/users/815781/onlyjob"}, "edited": false, "score": 1, "creation_date": 1571659718, "post_id": 56294288, "comment_id": 103302744, "body": "Relevant discussion is here: <a href=\"https://github.com/golang/go/issues/33038\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/33038</a>"}], "owner": {"reputation": 637, "user_id": 2674545, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b457d0ae8b274c1e64eb463d367c330d?s=128&d=identicon&r=PG", "display_name": "Rok", "link": "https://stackoverflow.com/users/2674545/rok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1558706690, "creation_date": 1558706690, "question_id": 56294288, "link": "https://stackoverflow.com/questions/56294288/is-there-an-elegant-way-run-go-module-tests-with-nested-packages-in-parallel-in", "title": "Is there an elegant way run Go module tests with nested packages in parallel in a fail fast manner?", "body": "<p>I have a Go project that uses modules. The module contains many packages, which are nested.</p>\n\n<p>When I let Go figure out the package structure by passing <code>./...</code> to <code>go test</code> it runs the tests in parallel (the default behaviour).</p>\n\n<p>Testing a single package with the <code>-failfast</code> flag works, it stops at the first failure, however what I'd like to achieve is to use <code>-failfast</code> across all the packages combined (for increased CI/CD throughput). When the first test in one of the packages that are tested in parallel by a single <code>go test ./...</code> invocation fails, I'd like to stop the whole test suite.</p>\n\n<p>Is this even possible with the current version of the go testing utility? If not, is there perhaps a plan to implement such thing in the future?</p>\n\n<p>I did not find a solution that would enable me to do this in parallel yet, however one thing that I thought of is to combine something like <code>go test -failfast</code>, <code>go list ./...</code> and <code>xargs</code> and run tests in a sequence (not parallely). I'd check the output of the last tested package and stop everything on first failure. This doesn't sound that good though and will probably be quite a bit slower.</p>\n\n<p>So yeah, are there any existing solutions or approaches that I haven't found/thought of?</p>\n\n<p>Thanks!</p>\n\n<p><code>go version go1.12 darwin/amd64</code></p>\n"}, {"tags": ["windows", "amazon-web-services", "go", "windows-installer", "ntfs"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558705648, "post_id": 56293951, "comment_id": 99200356, "body": "How are you compiling to MSI? That&#39;s not supported natively by the Go toolchain."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1558705699, "post_id": 56293951, "comment_id": 99200385, "body": "This might not be Go related, as when I tried MSI installers in the past on attached drives (created using <code>subst</code>), I always got similar errors (&quot;path not found&quot;). I always had to switch to the original folder that was attached as a new drive for MSI to work."}, {"owner": {"reputation": 41, "user_id": 11550558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5644b429902fc54222b96c9b9c86623e?s=128&d=identicon&r=PG&f=1", "display_name": "Fern", "link": "https://stackoverflow.com/users/11550558/fern"}, "edited": false, "score": 0, "creation_date": 1558706602, "post_id": 56293951, "comment_id": 99200932, "body": "Creating the msi using wix and wine. @icza- can you specify &quot;switch to the original folder that was attached as a new drive for the msi to work&quot;- do you mean literally dump the msi there or change directories into that? Thanks so much for the help everyone!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558706693, "post_id": 56293951, "comment_id": 99200987, "body": "So is it actually compiling Go code to MSI, or are you just using it to make an installer for a Go application? If it&#39;s the latter, the Go code (or the fact that it&#39;s Go at all) is irrelevant, it&#39;s the MSI and its scripts that are the issue."}, {"owner": {"reputation": 41, "user_id": 11550558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5644b429902fc54222b96c9b9c86623e?s=128&d=identicon&r=PG&f=1", "display_name": "Fern", "link": "https://stackoverflow.com/users/11550558/fern"}, "edited": false, "score": 0, "creation_date": 1558708676, "post_id": 56293951, "comment_id": 99202124, "body": "Fair point. It&#39;s building to WINDOWS, (GOOS=windows, GOARCH=386) and then being run through wix. Sounds like this might be a good place to start as I can stop looking at the code and look for better ways to build the msi..."}, {"owner": {"reputation": 34253, "user_id": 129130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/FJpdt.gif?s=128&g=1", "display_name": "Stein &#197;smul", "link": "https://stackoverflow.com/users/129130/stein-%c3%85smul"}, "edited": false, "score": 0, "creation_date": 1558736241, "post_id": 56293951, "comment_id": 99212335, "body": "Does the app work when you set it up manually? I don&#39;t really see how the MSI itself is to blame here?"}, {"owner": {"reputation": 34253, "user_id": 129130, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/FJpdt.gif?s=128&g=1", "display_name": "Stein &#197;smul", "link": "https://stackoverflow.com/users/129130/stein-%c3%85smul"}, "edited": false, "score": 0, "creation_date": 1558743246, "post_id": 56293951, "comment_id": 99213415, "body": "As I said, not sure I understand the actual problem properly, but <a href=\"https://stackoverflow.com/a/510225/129130\">here is a link with information on what credentials different system accounts present to the network</a> (among lots of other details)."}], "owner": {"reputation": 41, "user_id": 11550558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5644b429902fc54222b96c9b9c86623e?s=128&d=identicon&r=PG&f=1", "display_name": "Fern", "link": "https://stackoverflow.com/users/11550558/fern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1558705465, "creation_date": 1558705465, "question_id": 56293951, "link": "https://stackoverflow.com/questions/56293951/golang-msi-cant-see-mounted-drives-on-windows", "title": "Golang MSI can&#39;t see mounted drives on windows", "body": "<p>So I have an windows msi installer that I created by cross compiling from a golang program and installed on a client windows machine. The program sends data out from a folder on the windows machine to a Kinesis stream. The program works fine for all files and folders on the local C:\\ drive.<br>\nMy issue is that when the client is using a mounted NTFS drive (\"I://, J://, D://\") I get an error message with </p>\n\n<pre><code>level=info msg=\"Ignoring target I:\\\\xml with invalid stat: open I:\\\\xml: The system cannot find the path specified.\"\n</code></pre>\n\n<p>No matter the mounted drive (E,F,G, etc) I get the same error message. \nI've tried this across multiple clients and received the same error. </p>\n\n<p>So just for background- I'm compiling the program using <a href=\"https://dl.winehq.org/wine-builds/Release.key\" rel=\"nofollow noreferrer\">wine</a> to get it to an msi when building. The program is taking on a SYSTEM USER role and I've already checked permissions on the mounted directories (and made them wide open- still no luck). Been banging my head against the wall over this one for a while so the question is: has anyone else had an issue like this? </p>\n\n<p>Don't know how much this will help but here is the specific portion of GO code I'm using:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>p, err := filepath.Abs(t.Path)\n            if err != nil {\n                Logger.Infof(\"Ignoring invalid target path: %s, error: %s\", t.Path, err)\n                continue\n            }\n            _, err = os.Lstat(t.Path)\n            if err != nil {\n                Logger.Infof(\"Ignoring target %s with invalid stat: %s\", t.Path, err)\n                continue\n            }\n            c.targets = append(c.targets, site.WatchTarget{p, t.SrcTag})\n</code></pre>\n\n<p>I've tried os.Stat, Lstat and even os.Open to no avail. Just about at the end of my tether on this one.  </p>\n\n<p>The ideal result would be a suggestion on any changes you could suggest that would allow a system user from a cross compiled go program to see mounted network drives.</p>\n"}, {"tags": ["linux", "bash", "shell", "ubuntu", "go"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1558701265, "post_id": 56292719, "comment_id": 99197882, "body": "If by &quot;manual input&quot; you mean entry <i>at an interactive shell</i>, then the problem is that sourcing the file sets variables/aliases/etc. <i>inside the shell that does the sourcing</i>, and the shell running your script is different from the user&#39;s interactive interpreter. If instead by &quot;not working&quot; you mean that you get an error like <code>source: command not found</code>, that means you&#39;re using <code>sh</code> when you should be using <code>bash</code>. If instead by &quot;not working&quot; you mean that aliases aren&#39;t set, that&#39;s because aliases are off-by-default in interactive interpreters."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1558701291, "post_id": 56292719, "comment_id": 99197900, "body": "However, the very fact that we need to guess which of many possible interpretations you mean means that this isn&#39;t a question sufficiently well-specified as to be answerable."}, {"owner": {"reputation": 11, "user_id": 7896221, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fU1yi-Bnkdw/AAAAAAAAAAI/AAAAAAAAAHA/uMwSUG8ashs/photo.jpg?sz=128", "display_name": "Tobias O.R. Alke", "link": "https://stackoverflow.com/users/7896221/tobias-o-r-alke"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1558702091, "post_id": 56292719, "comment_id": 99198382, "body": "Thank you for your reply. I updated the question with to whole script. Execution of the last line won&#39;t work, without any errors. Seems it works, but, command &quot;go version&quot; or even &quot;go&quot; won&#39;t be recognized. At this point, golang won&#39;t work. I need to open a terminal by myself and tipe in &quot;source ~/.profile&quot; to work permanently."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1558703507, "post_id": 56292719, "comment_id": 99199134, "body": "Right -- <code>source</code> runs something <i>in the shell that you&#39;re actively running</i>. In a script, that&#39;s the shell that runs the script, <b>not</b> the shell the user started the script from. So <code>source ~&#47;.bashrc</code> in that context will change the <code>GOPATH</code> <b>for the script itself</b>, but not for the user who started the script... and since you&#39;re doing that right before the script exits, changing anything in the script&#39;s own environment is not very useful."}, {"owner": {"reputation": 301322, "user_id": 26428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S1BbQ.png?s=128&g=1", "display_name": "Dennis Williamson", "link": "https://stackoverflow.com/users/26428/dennis-williamson"}, "edited": false, "score": 0, "creation_date": 1558715154, "post_id": 56292719, "comment_id": 99205204, "body": "I&#39;m voting to reopen this question since I would post the following as an answer which is different to the one in the linked question and specific to this one. Use <code>exec bash</code> or something similar instead of <code>source ~&#47;.profile</code> - this replaces the currently running Bash with another instance which will itself load the new <code>.profile</code>. Or source the script itself rather than running it - then the commands in the script are run in the <i>current</i> shell, <i>including</i> the <code>source ~&#47;.profile</code>."}, {"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 1, "creation_date": 1558716154, "post_id": 56292719, "comment_id": 99205576, "body": "Why would you <code>sudo echo</code> a string? Usually <code>echo</code> doesn&#39;t need any particular privileges. You also don&#39;t need <code>sudo</code> to remove a file you downloaded as yourself a few commands back."}], "answers": [{"comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1558716868, "post_id": 56296714, "comment_id": 99205848, "body": "Given as this discards all the other state in the OP&#39;s original shell, it&#39;s a very big hammer. I would be very surprised and dismayed if running some random program left me in a new interactive shell that didn&#39;t have any functions/variables/etc active except those defined in my dotfiles."}, {"owner": {"reputation": 301322, "user_id": 26428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S1BbQ.png?s=128&g=1", "display_name": "Dennis Williamson", "link": "https://stackoverflow.com/users/26428/dennis-williamson"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1558716989, "post_id": 56296714, "comment_id": 99205888, "body": "@CharlesDuffy: True. I&#39;ll note that in my answer."}], "tags": [], "owner": {"reputation": 301322, "user_id": 26428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S1BbQ.png?s=128&g=1", "display_name": "Dennis Williamson", "link": "https://stackoverflow.com/users/26428/dennis-williamson"}, "is_accepted": false, "score": 1, "last_activity_date": 1558717120, "last_edit_date": 1558717120, "creation_date": 1558716699, "answer_id": 56296714, "question_id": 56292719, "link": "https://stackoverflow.com/questions/56292719/not-working-source-profile-inside-bash-script/56296714#56296714", "title": "Not working \u201esource ~/.profile\u201c inside bash script", "body": "<p>Preferred:</p>\n\n<p>Source the script itself rather than running it - then the commands in the script are run in the <em>current</em> shell, <em>including</em> the <code>source ~/.profile</code>.</p>\n\n<p>Alternative (since this replaces the running shell, history, variable values, and other state will be lost. So there should be a <em>very</em> good reason to use this method):</p>\n\n<p>Use <code>exec bash</code> or something similar instead of <code>source ~/.profile</code> - this replaces the currently running Bash with another instance which will itself load the new <code>.profile</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1558721398, "post_id": 56297613, "comment_id": 99207575, "body": "Actually isn&#39;t the recommendation to use <code>apt-get</code> over <code>apt</code> in scripts still?"}, {"owner": {"reputation": 11, "user_id": 7896221, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fU1yi-Bnkdw/AAAAAAAAAAI/AAAAAAAAAHA/uMwSUG8ashs/photo.jpg?sz=128", "display_name": "Tobias O.R. Alke", "link": "https://stackoverflow.com/users/7896221/tobias-o-r-alke"}, "edited": false, "score": 0, "creation_date": 1558725803, "post_id": 56297613, "comment_id": 99209291, "body": "Thank&#39;s for refinement, it&#39;s prefereable, but didn&#39;t solve the problem. Even if i start a new terminal, or reboot the whole computer after executing the installation script, golang won&#39;t be recognized until i manually type in &quot;source ~/.profile&quot; - The other suggestions i need to think about. My skills in bash/shell scripts are currently not so deep."}, {"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "reply_to_user": {"reputation": 11, "user_id": 7896221, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fU1yi-Bnkdw/AAAAAAAAAAI/AAAAAAAAAHA/uMwSUG8ashs/photo.jpg?sz=128", "display_name": "Tobias O.R. Alke", "link": "https://stackoverflow.com/users/7896221/tobias-o-r-alke"}, "edited": false, "score": 0, "creation_date": 1558755062, "post_id": 56297613, "comment_id": 99214644, "body": "Your Bash configuration is hosed in other interesting ways if it doesn&#39;t read <code>.profile</code> when you log in."}], "tags": [], "owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "is_accepted": false, "score": 0, "last_activity_date": 1558721116, "creation_date": 1558721116, "answer_id": 56297613, "question_id": 56292719, "link": "https://stackoverflow.com/questions/56292719/not-working-source-profile-inside-bash-script/56297613#56297613", "title": "Not working \u201esource ~/.profile\u201c inside bash script", "body": "<p>Here is a refactoring which defers the decision to the user and cleans up the script somewhat.</p>\n\n<pre><code>#!/bin/bash\n# Put this in a variable so there is only one place to update\ntarball='go1.12.5.linux-amd64.tar.gz'\nsudo apt update\nsudo apt -y upgrade\n# cd || why would you?\ncurl -O \"https://dl.google.com/go/$tarball\"\ntar xvf \"$tarball\"\nsudo chown -R root:root ./go\nsudo mv go /usr/local\nrm \"$tarball\"\nprintf '%s\\n' \"export GOPATH=\\$HOME/work\" \\\n       \"export PATH=\\$PATH:/usr/local/go/bin:\\$GOPATH/bin\" &gt;&gt; ~/.profile\necho \"$0: done. source ~/.profile or exec bash to activate new settings.\" &gt;&amp;2\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7896221, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fU1yi-Bnkdw/AAAAAAAAAAI/AAAAAAAAAHA/uMwSUG8ashs/photo.jpg?sz=128", "display_name": "Tobias O.R. Alke", "link": "https://stackoverflow.com/users/7896221/tobias-o-r-alke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1558721116, "creation_date": 1558700946, "last_edit_date": 1558703573, "question_id": 56292719, "link": "https://stackoverflow.com/questions/56292719/not-working-source-profile-inside-bash-script", "title": "Not working \u201esource ~/.profile\u201c inside bash script", "body": "<p>To permanently update ~/.profile with source, only working on manual input. Also reboot of the whole system won\u2018t update ~/.profile and i need to update it manual.</p>\n\n<p>Is there a special code style to use it as working code inside a bash/shell script or is this special code not intended to be used in automated scripts?</p>\n\n<p>Need it to automate installation of golang.</p>\n\n<p>In the following code the line \"source ~/.profile\" won't work, and without any error messages, the rest is working fine:</p>\n\n<pre><code>#!/bin/bash\nsudo apt update\nsudo apt -y upgrade\ncd ~\ncurl -O https://dl.google.com/go/go1.12.5.linux-amd64.tar.gz\ntar xvf go1.12.5.linux-amd64.tar.gz\nsudo chown -R root:root ./go\nsudo mv go /usr/local\ncd ~\nsudo rm go1.12.5.linux-amd64.tar.gz\nsudo echo \"export GOPATH=\\$HOME/work\" &gt;&gt; ~/.profile\nsudo echo \"export PATH=\\$PATH:/usr/local/go/bin:\\$GOPATH/bin\" &gt;&gt; ~/.profile\nsource ~/.profile\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 755, "user_id": 4654175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zHkjV.png?s=128&g=1", "display_name": "Shubham Sharma", "link": "https://stackoverflow.com/users/4654175/shubham-sharma"}, "edited": false, "score": 0, "creation_date": 1558864481, "post_id": 56312438, "comment_id": 99234449, "body": "Correct! But then how do I get away with it and actually call the function?"}, {"owner": {"reputation": 755, "user_id": 4654175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zHkjV.png?s=128&g=1", "display_name": "Shubham Sharma", "link": "https://stackoverflow.com/users/4654175/shubham-sharma"}, "edited": false, "score": 0, "creation_date": 1558866178, "post_id": 56312438, "comment_id": 99234832, "body": "Great! I will look into it!"}, {"owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1588905024, "post_id": 56312438, "comment_id": 109086888, "body": "Did you ever find a solution to this? Would love more information"}], "tags": [], "owner": {"reputation": 96, "user_id": 2342228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70bec81388062ef3b3cfba0cfa695cf?s=128&d=identicon&r=PG", "display_name": "Matthew Dempsky", "link": "https://stackoverflow.com/users/2342228/matthew-dempsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1558864189, "creation_date": 1558864189, "answer_id": 56312438, "question_id": 56292071, "link": "https://stackoverflow.com/questions/56292071/how-to-pass-a-function-pointer-to-a-c-code-in-go/56312438#56312438", "title": "How to pass a function pointer to a C code in Go", "body": "<p>The runtime error is actually complaining about the <code>unsafe.Pointer(data)</code> argument. The <code>bytes.Buffer</code> type has internal (Go) pointers, and cgo doesn't allow passing pointers to C if those pointers point to Go objects that contain Go pointers themselves.</p>\n\n<p>These rules are detailed in the cgo documentation here: <a href=\"https://golang.org/cmd/cgo/#hdr-Passing_pointers\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/#hdr-Passing_pointers</a></p>\n\n<p>The short summary is that the Go garbage collector needs to be aware when Go pointers are modified. The Go compilers make sure that compiled code appropriately informs the garbage collector, but C compilers don't know to do this. So to prevent GC problems, cgo simply doesn't allow passing pointers like this.</p>\n"}], "owner": {"reputation": 755, "user_id": 4654175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zHkjV.png?s=128&g=1", "display_name": "Shubham Sharma", "link": "https://stackoverflow.com/users/4654175/shubham-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558864189, "creation_date": 1558698514, "last_edit_date": 1558700265, "question_id": 56292071, "link": "https://stackoverflow.com/questions/56292071/how-to-pass-a-function-pointer-to-a-c-code-in-go", "title": "How to pass a function pointer to a C code in Go", "body": "<p>I want to write a small go application for processing videos and decided to use this library <a href=\"https://github.com/giorgisio/goav/\" rel=\"nofollow noreferrer\">goav</a> which is a FFmpeg binding for go. However, it does not support reading the video straightaway from memory. As a workaround, I decided to call the C function directly. </p>\n\n<p>The signature of the function I want to call is as follows.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>AVIOContext *avio_alloc_context(\n                  unsigned char *buffer,\n                  int buffer_size,\n                  int write_flag,\n                  void *opaque,\n                  int (*read_packet)(void *opaque, uint8_t *buf, int buf_size),\n                  int (*write_packet)(void *opaque, uint8_t *buf, int buf_size),\n                  int64_t (*seek)(void *opaque, int64_t offset, int whence));\n</code></pre>\n\n<p>The go code I wrote to call this -</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package video\n\n// #include&lt;libavformat/avio.h&gt;\nimport \"C\"\nimport (\n  \"bytes\"\n  \"github.com/giorgisio/goav/avformat\"\n  \"github.com/giorgisio/goav/avutil\"\n  \"unsafe\"\n)\n\nfunc DecodeStream(data *bytes.Buffer) {\n  bufferSize := 8192\n  formatContext := avformat.AvformatAllocContext()\n  buffer := (*C.uchar)(avutil.AvMalloc(uintptr(bufferSize)))\n  ioContext := C.avio_alloc_context(\n    buffer,\n    C.int(bufferSize),\n    C.int(0),\n    unsafe.Pointer(data),\n    &amp;[0]byte{},\n    &amp;[0]byte{},\n    &amp;[0]byte{}, \n  )                                       // &lt;- error in this line\n  formatContext.SetPb((*avformat.AvIOContext)(unsafe.Pointer(ioContext)))\n  if formatContext.AvformatFindStreamInfo(nil) &lt; 0 {\n    panic(\"Couldn't find stream info\")\n  }\n  println(\"DURATION: \", formatContext.Duration())\n}\n</code></pre>\n\n<p>However, I am getting this error <code>runtime error: cgo argument has Go pointer to Go pointer</code>. </p>\n\n<p>I tried replacing <code>&amp;[0]byte{}</code> with <code>nil</code> too. Can't seem to get away!</p>\n"}, {"tags": ["go", "automated-tests", "cucumber"], "comments": [{"owner": {"reputation": 305, "user_id": 1089572, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q9Jyg.jpg?s=128&g=1", "display_name": "Ryan Nel", "link": "https://stackoverflow.com/users/1089572/ryan-nel"}, "edited": false, "score": 0, "creation_date": 1560413525, "post_id": 56291532, "comment_id": 99730181, "body": "I&#39;ve got the same issue. Did you find a fix for this?"}, {"owner": {"reputation": 31, "user_id": 5036375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d908cfaba617b732e7a180ebb17667f?s=128&d=identicon&r=PG&f=1", "display_name": "Dipali", "link": "https://stackoverflow.com/users/5036375/dipali"}, "reply_to_user": {"reputation": 305, "user_id": 1089572, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q9Jyg.jpg?s=128&g=1", "display_name": "Ryan Nel", "link": "https://stackoverflow.com/users/1089572/ryan-nel"}, "edited": false, "score": 0, "creation_date": 1567579638, "post_id": 56291532, "comment_id": 101999534, "body": "not yet, actually left this, once again I will try with my new project structure"}, {"owner": {"reputation": 1042, "user_id": 1314467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d2de3d42024063a4d7dcef45ed368dc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishmeet", "link": "https://stackoverflow.com/users/1314467/ishmeet"}, "edited": false, "score": 0, "creation_date": 1604315218, "post_id": 56291532, "comment_id": 114300809, "body": "Hey, I am facing the same issue, did you find a fix for this ?"}, {"owner": {"reputation": 111, "user_id": 1542778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3fc3444375d06a3f970671917ffdb42?s=128&d=identicon&r=PG", "display_name": "jesusnoseq", "link": "https://stackoverflow.com/users/1542778/jesusnoseq"}, "edited": false, "score": 0, "creation_date": 1611267703, "post_id": 56291532, "comment_id": 116403875, "body": "I solved this issue by moving my project outside of gopath"}], "owner": {"reputation": 31, "user_id": 5036375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d908cfaba617b732e7a180ebb17667f?s=128&d=identicon&r=PG&f=1", "display_name": "Dipali", "link": "https://stackoverflow.com/users/5036375/dipali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 411, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1559027932, "creation_date": 1558696415, "last_edit_date": 1559027932, "question_id": 56291532, "link": "https://stackoverflow.com/questions/56291532/error-failed-to-compile-testmain-package-while-running-godog-in-a-project-outs", "title": "Error &quot;failed to compile testmain package&quot; while running godog in a project outside GOPATH that uses the go modules", "body": "<p>Using godog I am able to run feature file successfully. Now when I create module using \"go mod init mytest.com/automation\"; and try to run feature file using godog getting below error:</p>\n\n<p>failed to compile testmain package: exit status 2 - output: C:\\Users\\\\AppData\\Local\\Temp\\go-build685806736\\b001_testmain.go:5:2: can't find import: \"mytest.com/automation/C_/Users//sample_automation_golang/src/features\"</p>\n\n<p>I saw similar issue being reported in past but that is marked resolved now: <a href=\"https://github.com/DATA-DOG/godog/issues/136\" rel=\"nofollow noreferrer\">https://github.com/DATA-DOG/godog/issues/136</a></p>\n\n<p>Can someone help with this error? </p>\n"}, {"tags": ["go", "concurrency", "volatile"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558694515, "post_id": 56290928, "comment_id": 99194335, "body": "Your code is woefully incomplete. It&#39;s hard to judge whether it has any issues beyond that."}, {"owner": {"reputation": 2922, "user_id": 929981, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/66Mz4.png?s=128&g=1", "display_name": "jtepe", "link": "https://stackoverflow.com/users/929981/jtepe"}, "edited": false, "score": 1, "creation_date": 1558694781, "post_id": 56290928, "comment_id": 99194449, "body": "1) Memory fences, by use of mutexes golang.org/pkg/sync{/atomic} As for 2) Yes, use channels, mutexes, or atomics"}, {"owner": {"reputation": 3504, "user_id": 3502543, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z13lg.jpg?s=128&g=1", "display_name": "Maksym", "link": "https://stackoverflow.com/users/3502543/maksym"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558694897, "post_id": 56290928, "comment_id": 99194502, "body": "@Flimzy thanks for your comment, added Stop function"}, {"owner": {"reputation": 2922, "user_id": 929981, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/66Mz4.png?s=128&g=1", "display_name": "jtepe", "link": "https://stackoverflow.com/users/929981/jtepe"}, "edited": false, "score": 1, "creation_date": 1558695036, "post_id": 56290928, "comment_id": 99194576, "body": "@Maksym Yes. It has a data race. Besides, your main goroutine (executing main) runs to end and kills off the other goroutine in the process."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1558702914, "post_id": 56290928, "comment_id": 99198828, "body": "&quot;How does golang solve visibility issue?&quot; What do you mean by &quot;visibility issue&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 6892582, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wWXpJnaodf8/AAAAAAAAAAI/AAAAAAAAASo/iUT9ySE-cgg/photo.jpg?sz=128", "display_name": "Denis Sedchenko", "link": "https://stackoverflow.com/users/6892582/denis-sedchenko"}, "is_accepted": true, "score": 0, "last_activity_date": 1558695024, "creation_date": 1558695024, "answer_id": 56291164, "question_id": 56290928, "link": "https://stackoverflow.com/questions/56290928/golang-visibility-or-cpu-thread-cache-issue/56291164#56291164", "title": "Golang visibility or CPU thread cache issue", "body": "<p>I recommend to use <a href=\"https://godoc.org/context#CancelFunc\" rel=\"nofollow noreferrer\">context.WithCancel</a> to stop goroutines in this case.</p>\n"}], "owner": {"reputation": 3504, "user_id": 3502543, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z13lg.jpg?s=128&g=1", "display_name": "Maksym", "link": "https://stackoverflow.com/users/3502543/maksym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 56291164, "answer_count": 1, "score": -3, "last_activity_date": 1558695024, "creation_date": 1558694149, "last_edit_date": 1558694770, "question_id": 56290928, "link": "https://stackoverflow.com/questions/56290928/golang-visibility-or-cpu-thread-cache-issue", "title": "Golang visibility or CPU thread cache issue", "body": "<p>1) How does golang solve visibility issue?</p>\n\n<p>2) Is there any issues with below code?</p>\n\n<pre><code>package main\n\ntype Service struct {\n    stop bool\n}\n\nfunc (s *Service) Run() {\n    for !s.stop {\n        //Some logic\n    }\n}\n\nfunc (s *Service) Stop() {\n    s.stop = true\n}\n\nfunc main() {\n    s := &amp;Service{}\n    go s.Run()\n    //Some logic\n    s.Stop()\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "parallel-processing", "goroutine", "database-deadlocks"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558693497, "post_id": 56290498, "comment_id": 99193778, "body": "There is no single, direct answer to this. And this is not specific to Go. This problem can occur in any database system, in any language. A <a href=\"https://www.google.nl/search?q=site%3Astackoverflow.com+how+to+avoid+database+deadlocks&amp;oq=site%3Astackoverflow.com+how+to+avoid+database+deadlocks&amp;aqs=chrome..69i57j69i58.7020j0j7&amp;sourceid=chrome&amp;ie=UTF-8\" rel=\"nofollow noreferrer\">simple search</a> shows that essentially the same question has been asked countless times. I suggest reading through the answers, to find one or more that applies to your situation."}, {"owner": {"reputation": 81552, "user_id": 562459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3UR9.png?s=128&g=1", "display_name": "Mike Sherrill &#39;Cat Recall&#39;", "link": "https://stackoverflow.com/users/562459/mike-sherrill-cat-recall"}, "edited": false, "score": 1, "creation_date": 1558693627, "post_id": 56290498, "comment_id": 99193866, "body": "<i>Parallel</i> and <i>concurrent</i> are technical terms in database work. I think you mean <i>concurrent</i> here. Edit your question, and be consistent with the right term."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558693816, "post_id": 56290498, "comment_id": 99193980, "body": "They&#39;re also technical terms in Go. <a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">Suggested watching</a>."}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558697627, "post_id": 56290498, "comment_id": 99195964, "body": "@Flimzy I understand. We have tried solving the issue by restarting the new transaction after some delay, but still the deadlock issue occurs. So we are finding solution that we can implement in go to restart the transaction &amp; resolve this deadlock."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558697983, "post_id": 56290498, "comment_id": 99196163, "body": "Best to avoid the deadlock entirely, rather than to restart transactions."}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "edited": false, "score": 0, "creation_date": 1558698020, "post_id": 56290498, "comment_id": 99196182, "body": "@Peter We have tried restarting the transaction in GO, but the solution did not work as you  can see in the above code"}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558698099, "post_id": 56290498, "comment_id": 99196224, "body": "@Flimzy Can you please suggest some way on how to avoid that in above scenario. As we have already brainstormed on that part."}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558698393, "post_id": 56290498, "comment_id": 99196369, "body": "@Flimzy  I have updated the question as you see. I need the solution in GO to retry the question. Can you please unmark it as duplication. Thanks."}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "edited": false, "score": 0, "creation_date": 1558698411, "post_id": 56290498, "comment_id": 99196379, "body": "@Peter I have updated the question as you see. I need the solution in GO to retry the question. Can you please unmark it as duplication. Thanks."}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "edited": false, "score": 0, "creation_date": 1558698637, "post_id": 56290498, "comment_id": 99196505, "body": "@Peter I am also updating the content. You can check the updates"}, {"owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1558698810, "post_id": 56290498, "comment_id": 99196591, "body": "@Flimzy I have updated the content. You can also check the updates"}], "owner": {"reputation": 451, "user_id": 4786262, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VUimV4mqnQo/AAAAAAAAAAI/AAAAAAAAAGk/kcHO40TFfDM/photo.jpg?sz=128", "display_name": "Mukund Sonaiya", "link": "https://stackoverflow.com/users/4786262/mukund-sonaiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 0, "closed_date": 1558698012, "answer_count": 0, "score": 3, "last_activity_date": 1558698769, "creation_date": 1558692609, "last_edit_date": 1558698769, "question_id": 56290498, "link": "https://stackoverflow.com/questions/56290498/how-to-resolve-database-deadlock-issue-caused-by-parallel-goroutines-using-retry", "closed_reason": "Duplicate", "title": "How to resolve database deadlock issue caused by parallel goroutines using retry transaction?", "body": "<p>We are working to build an exchange using Go. Following components are there in the system of now:</p>\n\n<ul>\n<li>Frontend     </li>\n<li>Backend</li>\n<li>Matching Engine.</li>\n</ul>\n\n<p>Here is how the system works:</p>\n\n<ul>\n<li>User creates an order which goes to Backend. </li>\n<li>Backend processes the new order in following manner :\n\n<ul>\n<li>It validates the order request data &amp; then a db transaction is created for updating users account balance in account table &amp; new order is inserted in the order table. </li>\n<li>After db interaction is completed; backend produces a new order message in queue. </li>\n</ul></li>\n<li>Matching Engine processes the new order from the queue and pushes the engine response(i.e updated orders &amp; trades) in another queue</li>\n<li><p>Backend consumes the engine response as below:</p>\n\n<ul>\n<li>Multiple goroutines run in parallel to process engine response &amp;store the updates received in engine response. </li>\n<li>For storing the the updates,  a database transaction is created within each goroutine to update the users account balance, orders &amp; store new trades. </li>\n</ul></li>\n<li><p>Problem occurs during this stage when concurrent (parallel) transactions try to update the same users account at a time, a deadlock is created in DB as multiple transaction try to lock the same record. Also while a users previously placed orders are being matched and processed user can create new order as mentioned in step 2, so transaction created in step 2 also tries to update the same users account in database which is being accessed by backend to store Matching Engine response. This also adds to the chances of deadlock. </p></li>\n<li><p>How to properly manage and prevent the database deadlock generated in above mentioned flow.</p></li>\n<li><p>We have tried a solution to retry transaction by following code but the deadlock issue can still be reproduced</p></li>\n</ul>\n\n<pre><code>    // Update accounts, orders, trades with max retry of 5\n    for i := 0; i &lt; 5; i++ {\n        err = nil\n        time.Sleep(10 * time.Second)\n        if err = manager.saveEngineResponse(newEngineResponse, accountUpdatesToDoRef, &amp;updatedOrders); err == nil {\n            break\n        }\n        logger.Debug(\"Error saving engine response\", err)\n    }\n    if err != nil {\n        logger.Fatal(err)\n        return\n    }\n</code></pre>\n\n<blockquote>\n  <p>Error : Error 1213: Deadlock found when trying to get lock; try\n  restarting transaction</p>\n</blockquote>\n\n<p>I have refered the link : <a href=\"https://stackoverflow.com/questions/2332768/how-to-avoid-mysql-deadlock-found-when-trying-to-get-lock-try-restarting-trans\">How to avoid mysql &#39;Deadlock found when trying to get lock; try restarting transaction&#39;</a>\nwhich states that by keeping the operations in a specific order deadlocks can be avoided. And in the above scenario all transaction will first update account, then order &amp; then trades if any. So the order of operations  is consistent in different transactions</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1558696724, "post_id": 56290279, "comment_id": 99195434, "body": "<a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Remote_import_paths</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1558696920, "post_id": 56290279, "comment_id": 99195539, "body": "And for the details on module versions: <a href=\"https://golang.org/cmd/go/#hdr-Module_compatibility_and_semantic_versioning\" rel=\"nofollow noreferrer\">golang.org/cmd/go/&hellip;</a>"}, {"owner": {"reputation": 2220, "user_id": 6760793, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh5.googleusercontent.com/-US2Oq5rBR78/AAAAAAAAAAI/AAAAAAAAAAs/w0iHDW7Skcg/photo.jpg?sz=128", "display_name": "Dennie de Lange", "link": "https://stackoverflow.com/users/6760793/dennie-de-lange"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1558915083, "post_id": 56290279, "comment_id": 99245269, "body": "Note to self: go vanity urls"}], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 7, "last_activity_date": 1558692525, "creation_date": 1558692525, "answer_id": 56290474, "question_id": 56290279, "link": "https://stackoverflow.com/questions/56290279/how-does-go-know-where-to-get-packages-from/56290474#56290474", "title": "How does go know where to get packages from", "body": "<p>It's simple, check it out:</p>\n\n<pre><code>$&gt; curl https://goa.design/plugins/cors/dsl\n&lt;!DOCTYPE html&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en-us\"&gt;\n&lt;head&gt;\n  &lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"&gt;\n\n\n  &lt;meta name=\"go-import\" content=\"goa.design/plugins git https://github.com/goadesign/plugins\"&gt;\n  &lt;meta name=\"go-source\" content=\"goa.design/plugins _ https://github.com/goadesign/plugins/tree/master/{/dir} https://github.com/goadesign/plugins/blob/master{/dir}/{file}#L{line}\"&gt;\n</code></pre>\n\n<p>The key here is in the  tag named \"go-import\". When <code>go get</code> requests <a href=\"https://goa.design/\" rel=\"noreferrer\">https://goa.design/</a>..., it hits that HTML file and knows that \"goa.design/....\" must be retrieved using git from <a href=\"https://github.com/goadesign/plugins\" rel=\"noreferrer\">https://github.com/goadesign/plugins</a>.</p>\n\n<p>Here is a good <a href=\"https://jve.linuxwall.info/blog/index.php?post/2015/08/26/Hosting_Go_code_on_Github_with_custom_import_path\" rel=\"noreferrer\">article</a></p>\n"}], "owner": {"reputation": 2220, "user_id": 6760793, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh5.googleusercontent.com/-US2Oq5rBR78/AAAAAAAAAAI/AAAAAAAAAAs/w0iHDW7Skcg/photo.jpg?sz=128", "display_name": "Dennie de Lange", "link": "https://stackoverflow.com/users/6760793/dennie-de-lange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 56290474, "answer_count": 1, "score": 0, "last_activity_date": 1558692525, "creation_date": 1558691941, "question_id": 56290279, "link": "https://stackoverflow.com/questions/56290279/how-does-go-know-where-to-get-packages-from", "title": "How does go know where to get packages from", "body": "<p>When I import a package in a go application (using modules and vscode with golang plugin): </p>\n\n<pre><code>import (\n   cors \"goa.design/plugins/cors/dsl\"\n)\n</code></pre>\n\n<p>go automatically retrieves the package. \nHow does go know where to get it from? \nI figured it simply pulls the sources from github.com, but the repository for this project is at <code>https://github.com/goadesign/goa</code> no <code>.</code> in the name. \nAnd if I change the import to: </p>\n\n<pre><code>import (\n   cors \"goa.design/plugins/v3/cors/dsl\"\n)\n</code></pre>\n\n<p>It retrieves the <code>v3</code> package. I would gladly RTFM, but not sure which FM I need to read. </p>\n\n<p>Btw: this is my second day on <code>go</code> so this is magic to me. </p>\n"}]