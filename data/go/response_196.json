[{"tags": ["json", "go", "stream"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1539199345, "post_id": 52746987, "comment_id": 92419313, "body": "<a href=\"https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#example_Decoder_Decode_stream</a> (hint: <code>dec.Token</code>)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1539202254, "post_id": 52746987, "comment_id": 92420606, "body": "I&#39;m voting to close this question as off-topic because the go documentation linked in the above comment provides example code that does exactly this."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1539203817, "post_id": 52748199, "comment_id": 92421290, "body": "I looked at Token(), it looked like it just kept reading from the stream until it found the closing bracket or brace for the first one it read, and adds all the read part to a buffer, if this is case it would read all of the response into memory which is what i was trying to avoid. I will dig back into Decoder to see if i have misunderstood."}, {"owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1539206774, "post_id": 52748199, "comment_id": 92422434, "body": "looks like its using a buffered window rather than loading the whole lot, although what i cant tell from my experiment is if the window size is increasing by 512 bytes each cycle   <a href=\"https://play.golang.org/p/P7Wjj1aFrKk\" rel=\"nofollow noreferrer\">play.golang.org/p/P7Wjj1aFrKk</a>"}, {"owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1539207692, "post_id": 52748199, "comment_id": 92422744, "body": "even if it is that means it will only grow to just over 1MB whilst parsing a 1GB json file. could be a problem if im serving multiple request, i like to keep my Go services below the size of the configuration file for a spring-boot app ;)"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1539202866, "creation_date": 1539202866, "answer_id": 52748199, "question_id": 52746987, "link": "https://stackoverflow.com/questions/52746987/how-can-i-read-json-objects-one-at-a-time-from-a-stream-containing-a-json-array/52748199#52748199", "title": "How can I read json objects one at a time from a stream containing a json array without loading the whole array into memory?", "body": "<p>The example listed in the<a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\"><code>json.Decoder.Decode(...)</code> method documentation</a> shows exactly this.</p>\n\n<p>In short, you do the following steps:</p>\n\n<ol>\n<li>Read a token using <code>dec.Token()</code> (and optionally expect it to be an open square bracket)</li>\n<li>Read tokens using <code>dec.Decode()</code> while <code>dec.More()</code></li>\n<li>Optionally, read the final closing square bracket.</li>\n</ol>\n\n<p>For example (<a href=\"https://play.golang.com/p/RrQXFfRKYti\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>dec := json.NewDecoder(jsonStream)\ntype Item struct{ Name string }\n\n// Read the open bracket.\nt, err := dec.Token()\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"OK: %T: %v\\n\", t, t)\n\n// While the array contains values.\nfor dec.More() {\n    // Decode an array value.\n    var item Item\n    err := dec.Decode(&amp;item)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"OK: item=%#v\\n\", item)\n}\n\n// Read the closing bracket.\nt, err = dec.Token()\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"OK: %T: %v\\n\", t, t)\n// OK: json.Delim: [\n// OK: item=main.Item{Name:\"Value1\"}\n// OK: item=main.Item{Name:\"Value2\"}\n// OK: item=main.Item{Name:\"Value3\"}\n// OK: json.Delim: ]\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 52748199, "answer_count": 1, "score": 1, "last_activity_date": 1539334775, "creation_date": 1539197633, "last_edit_date": 1539334775, "question_id": 52746987, "link": "https://stackoverflow.com/questions/52746987/how-can-i-read-json-objects-one-at-a-time-from-a-stream-containing-a-json-array", "title": "How can I read json objects one at a time from a stream containing a json array without loading the whole array into memory?", "body": "<p>To reduce memory usage and reduce latency i want to start processing the json objects returned in a http response before they have all been sent.\nI am trying to write a method on my web service client that will query a web service returning a channel that will feed the structs from the web request as the come off the stream. </p>\n\n<pre><code>    func (c *Client) GetMyObj() (&lt;-chan models.MyObj, &lt;-chan error) {\n       outChan := make(chan models.MyObj)\n       errChan := make(chan error)\n       go func() {\n          resp, err := httpClient.Get(c.ServiceUrl, \"text/plain;charset=UTF-8\", nil)\n          if err != nil {\n            errChan &lt;- err\n            return\n          }\n          if resp.Status != \"200 OK\" {\n             errChan &lt;- fmt.Errorf(\"http error: %1\", resp.Status)\n             return\n          }\n\n          dec := json.NewDecoder(resp.Body)\n\n          for dec.More() {\n             myO:= models.MyObj{}\n             err := dec.Decode(&amp;MyO)\n             if err != nil {\n                errChan &lt;- err\n                return\n             }\n             outChan &lt;- dfe\n          }           \n       }()\n\n       return outChan, errChan\n    }\n</code></pre>\n\n<p>Unfortunately this produces an exception when it reads the preceding opening square bracket.The json document would look something like the below but with many more objects in the array and more properties on the object, but you get the idea:</p>\n\n<pre><code>    [{\"name\":\"Value\"}\n    ,{\"name\":\"Value\"}\n    ,{\"name\":\"Value\"}]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1539198066, "creation_date": 1539198066, "answer_id": 52747100, "question_id": 52746928, "link": "https://stackoverflow.com/questions/52746928/sync-once-do-using-compareandswapint32/52747100#52747100", "title": "sync.Once.Do() using CompareAndSwapInt32", "body": "<p>Removing the mutex breaks one of the <a href=\"https://golang.org/pkg/sync/#Once.Do\" rel=\"nofollow noreferrer\">documented behaviours</a>:</p>\n\n<blockquote>\n  <p>no call to Do returns until the one call to f returns</p>\n</blockquote>\n"}], "owner": {"reputation": 1342, "user_id": 5508532, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/67f7923644113e4d8897b755a75b8272?s=128&d=identicon&r=PG&f=1", "display_name": "binary01", "link": "https://stackoverflow.com/users/5508532/binary01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 52747100, "answer_count": 1, "score": 1, "last_activity_date": 1539198066, "creation_date": 1539197410, "question_id": 52746928, "link": "https://stackoverflow.com/questions/52746928/sync-once-do-using-compareandswapint32", "title": "sync.Once.Do() using CompareAndSwapInt32", "body": "<p>Go implements the <a href=\"https://golang.org/pkg/sync/#Once\" rel=\"nofollow noreferrer\">sync.Once</a> as such:</p>\n\n<pre><code>type Once struct {\n    m    Mutex\n    done uint32\n}\n\nfunc (o *Once) Do(f func()) {\n    if atomic.LoadUint32(&amp;o.done) == 1 {\n        return\n    }\n    // Slow-path.\n    o.m.Lock()\n    defer o.m.Unlock()\n    if o.done == 0 {\n        defer atomic.StoreUint32(&amp;o.done, 1)\n        f()\n    }\n}\n</code></pre>\n\n<p>I'm trying to understand the need for the mutex here, what would be the issue with implementing it as this ?</p>\n\n<pre><code>func (o *Once) Do(f func()) {\n  if atomic.CompareAndSwapUInt32(&amp;o.done, 0, 1) {\n    f()\n  }\n}\n</code></pre>\n"}, {"tags": ["date", "go", "time"], "comments": [{"owner": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "edited": false, "score": 0, "creation_date": 1539194457, "post_id": 52746225, "comment_id": 92417049, "body": "And what is the issue?"}, {"owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "reply_to_user": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "edited": false, "score": 0, "creation_date": 1539194592, "post_id": 52746225, "comment_id": 92417101, "body": "updated question with error kosa"}, {"owner": {"reputation": 6423, "user_id": 110315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bdceba5404ea259ccb28e261f3e22c0?s=128&d=identicon&r=PG", "display_name": "raidfive", "link": "https://stackoverflow.com/users/110315/raidfive"}, "edited": false, "score": 4, "creation_date": 1539194831, "post_id": 52746225, "comment_id": 92417230, "body": "The <code>.Format()</code> function returns a string representation of the datetime, not a <code>Time</code> struct."}], "answers": [{"comments": [{"owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539195330, "post_id": 52746382, "comment_id": 92417461, "body": "why it is showing in negative. It should show something like 40m (eg: 40 minutes)"}, {"owner": {"reputation": 6423, "user_id": 110315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bdceba5404ea259ccb28e261f3e22c0?s=128&d=identicon&r=PG", "display_name": "raidfive", "link": "https://stackoverflow.com/users/110315/raidfive"}, "reply_to_user": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539195876, "post_id": 52746382, "comment_id": 92417709, "body": "@btcuser I was running this on <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> but I&#39;ve updated the answer to reflect the output on my machine in the PDT timezone. As for the negative value, that&#39;s correct since it&#39;s currentTime sub pastTime."}], "tags": [], "owner": {"reputation": 6423, "user_id": 110315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bdceba5404ea259ccb28e261f3e22c0?s=128&d=identicon&r=PG", "display_name": "raidfive", "link": "https://stackoverflow.com/users/110315/raidfive"}, "is_accepted": false, "score": 1, "last_activity_date": 1539195884, "last_edit_date": 1539195884, "creation_date": 1539195075, "answer_id": 52746382, "question_id": 52746225, "link": "https://stackoverflow.com/questions/52746225/difference-between-the-past-date-time-and-current-time-in-minutes-in-golang/52746382#52746382", "title": "Difference between the past date time and current time in minutes in golang", "body": "<p>Drop the <code>.Format()</code> function call on <code>time.Now()</code> like below. Also I've updated the <code>layout string</code> to match the format for <code>pasttimestr</code>.</p>\n\n<pre><code>func main() {\n    //fetching current time\n    currentTime := time.Now()\n    //past time comes in as string\n    pasttimestr := \"2018-10-10 23:00\"\n    layout := \"2006-01-02 15:04\"\n    //converting string to date\n    pasttime, err := time.Parse(layout, pasttimestr)\n        if err != nil {\n        fmt.Println(err)\n    }\n    //differnce between pastdate and current date\n    diff := currentTime.Sub(pasttime)\n    fmt.Println(\"difference time is : \", diff)\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>difference time is :  -4h36m32.001213s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539195509, "post_id": 52746458, "comment_id": 92417539, "body": "for me it is displaying:Past Time:  2018-10-10 23:00:00 +0000 UTC Current Time:  2018-10-10 23:47:19.3722015 +0530 IST m=+0.005323000 time difference is 4h42m40.6277985s or 282.677129975 in minutes"}, {"owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539195533, "post_id": 52746458, "comment_id": 92417551, "body": "it should be 48minutes"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539195815, "post_id": 52746458, "comment_id": 92417678, "body": "Looks like reverting the pasttime and current time was a mistake, actually. I have updated the code and output."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 1, "creation_date": 1539195868, "post_id": 52746458, "comment_id": 92417703, "body": "The reason you get 4+ hours is because your &quot;past time&quot; does not have a time zone, so it assumes that the time is in UTC"}, {"owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539196016, "post_id": 52746458, "comment_id": 92417764, "body": "how can we convert the same in IST format? Any idea?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "edited": false, "score": 0, "creation_date": 1539196369, "post_id": 52746458, "comment_id": 92417928, "body": "Updated code and output. Now it parses the past time as the same zone as current time."}], "tags": [], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "is_accepted": true, "score": 3, "last_activity_date": 1539196773, "last_edit_date": 1539196773, "creation_date": 1539195370, "answer_id": 52746458, "question_id": 52746225, "link": "https://stackoverflow.com/questions/52746225/difference-between-the-past-date-time-and-current-time-in-minutes-in-golang/52746458#52746458", "title": "Difference between the past date time and current time in minutes in golang", "body": "<p>You should probably remove the format function call from current time to get the actual time struct rather than a string representation and and fix the layout for past time</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    //fetching current time\n    currentTime := time.Now()\n    loc := currentTime.Location()\n    //past time comes in as string\n    pasttimestr := \"2018-10-10 23:00\"\n    layout := \"2006-01-02 15:04\"\n    //converting string to date\n    pasttime, err := time.ParseInLocation(layout, pasttimestr, loc)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"Past Time: \", pasttime)\n    fmt.Println(\"Current Time: \", currentTime)\n    //differnce between pastdate and current date\n    diff := currentTime.Sub(pasttime)\n    fmt.Printf(\"time difference is %v or %v in minutes\\n\", diff, diff.Minutes())\n}\n</code></pre>\n\n<p>Gives me </p>\n\n<pre><code>Past Time:  2018-10-10 23:00:00 -0400 EDT\nCurrent Time:  2018-10-10 14:31:34.865259 -0400 EDT m=+0.000351797\ntime difference is -8h28m25.134741s or -508.41891235 in minutes\n</code></pre>\n"}], "owner": {"reputation": 213, "user_id": 9223221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db22d31457019f8db39916c60d012fc?s=128&d=identicon&r=PG&f=1", "display_name": "btc user", "link": "https://stackoverflow.com/users/9223221/btc-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1930, "favorite_count": 0, "accepted_answer_id": 52746458, "answer_count": 2, "score": 1, "last_activity_date": 1539196773, "creation_date": 1539194419, "last_edit_date": 1539194570, "question_id": 52746225, "link": "https://stackoverflow.com/questions/52746225/difference-between-the-past-date-time-and-current-time-in-minutes-in-golang", "title": "Difference between the past date time and current time in minutes in golang", "body": "<p>I have current time and past time, Im trying to findout difference in minutes.</p>\n\n<p>Here is my code im trying, although im new to go.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    //fetching current time\n    currentTime := time.Now().Format(\"2006-01-02 15:04:05\")\n    //past time comes in as string\n    pasttimestr := \"2018-10-10 23:00\"\n    layout := \"2006-01-02 15:04:05\"\n    //converting string to date\n    pasttime, err := time.Parse(layout, pasttimestr)\n        if err != nil {\n        fmt.Println(err)\n    }\n    //differnce between pastdate and current date\n    diff := currentTime.Sub(pasttime)\n    fmt.Println(\"difference time in min : \", diff)\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code># command-line-arguments\n.\\dates.go:21:21: currentTime.Sub undefined (type string has no field or method Sub)\n</code></pre>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 791, "user_id": 3529908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/684156fa87f3a84dc9f899a476e07e20?s=128&d=identicon&r=PG&f=1", "display_name": "C0ol_Cod3r", "link": "https://stackoverflow.com/users/3529908/c0ol-cod3r"}, "is_accepted": true, "score": 0, "last_activity_date": 1539355255, "creation_date": 1539355255, "answer_id": 52781918, "question_id": 52746147, "link": "https://stackoverflow.com/questions/52746147/saving-extra-data-with-golang/52781918#52781918", "title": "Saving Extra Data With GoLang", "body": "<p>This is how I got it to work, please let me know if this is not correct or if there is a better way.</p>\n\n<p>So I added the <code>Profile</code> struct to a wrapper/nested struct, like so:</p>\n\n<pre><code>type ProfileWrapper struct {\n  gorm.Model\n  ProfileData Profile\n  AddressID int `json:\"address_id\"`\n}\n</code></pre>\n\n<p>So I then changed/updated the json data I was sending into this struct to this:</p>\n\n<pre><code>{\n  \"ProfileData\": {\n      \"company\": \"testing-with-add-0001\",\n      \"date_added\": \"9067-11-09T00:00:00+00:00\"\n  },\n  \"address_id\": 3\n}\n</code></pre>\n\n<p>So to saved the profile I did this,</p>\n\n<pre><code>db.Create( &amp;p.ProfileData )\n</code></pre>\n\n<p>I then built a new struct for the Profile Address information to be created/added, like so:</p>\n\n<pre><code>pd := structs.ProfileAddress{AddressFK: p.AddressID, ProfileFK: profileID}\n\ndb.Create( &amp;pd )\n</code></pre>\n\n<p>Not sure if this is the best way of doing this, but it seems to work. If this is wrong please let me know.</p>\n\n<p>Thanks.</p>\n"}], "owner": {"reputation": 791, "user_id": 3529908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/684156fa87f3a84dc9f899a476e07e20?s=128&d=identicon&r=PG&f=1", "display_name": "C0ol_Cod3r", "link": "https://stackoverflow.com/users/3529908/c0ol-cod3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 52781918, "answer_count": 1, "score": 0, "last_activity_date": 1539355255, "creation_date": 1539194066, "question_id": 52746147, "link": "https://stackoverflow.com/questions/52746147/saving-extra-data-with-golang", "title": "Saving Extra Data With GoLang", "body": "<p>So I am using Go Lang 1.10.3 with the Echo framework with Gorm and Postgres as my database.</p>\n\n<p>I have the three tables / structs , Profile, Addresses and Profile_addresses</p>\n\n<p>The structs are as follows,</p>\n\n<p>Profile</p>\n\n<pre><code>type Profile struct {\n  gorm.Model\n  Company string `gorm:\"size:255\" json:\"company\"`\n  AddedDate time.Time `gorm:\"type:date\" json:\"date_added\"`\n  ProfileAddresses []ProfileAddress `gorm:\"foreignkey:profile_fk\" json:\"address_id\"`\n}\n</code></pre>\n\n<p>Address</p>\n\n<pre><code>type Address struct {\n  gorm.Model \n  AddressLine1 string `gorm:\"size:255\" json:\"line1\"`\n  AddressLine2 string `gorm:\"size:255\" json:\"line2\"`\n  AddressLine3 string `gorm:\"size:255\" json:\"line3\"`\n  City string `gorm:\"size:200\" json:\"city\"`\n  Country string `gorm:\"size:255\" json:\"country\"`\n  Postcode string `gorm:\"size:12\" json:\"postcode\"`\n  ProfileAddresses []ProfileAddress `gorm:\"foreignkey:address_fk\"`\n}\n</code></pre>\n\n<p>And Profile Address</p>\n\n<pre><code>type ProfileAddress struct {\n  gorm.Model\n  Archive bool `json:\"archive\"`\n\n  Profile Profile\n  Address Address\n  AddressFK int`gorm:\"ForeignKey:id\"`\n  ProfileFK int`gorm:\"ForeignKey:id\"`\n}\n</code></pre>\n\n<p>These tables all get made fine but I am now trying to save an address ID to the Profile Address table when making a new Profile. Posting data to <code> /profile/add </code> (with Postman) including the following data</p>\n\n<pre><code>{\n  \"company\": \"testing-000001\",\n  \"date_added\": \"3051-11-09T00:00:00+00:00\",\n  \"address_id\": 3\n}\n</code></pre>\n\n<p>Now I can save a new profile and a new address but not save this data. I have only just added the <code>json:\"address_id\"`</code> option to the end of the <code>Profile struct</code> but that did not work.</p>\n\n<p>I have set this up like so, as one profile might have many address so there needs to be a linked table with all the address ids. I sure that I could do this in a two stage step, e.g. save the profile, then save the addresses I want to add to that profile but I would like to get this to work. I also dont need to create a new address, these would have already been added into the system.</p>\n\n<p>So what am I doing wrong?</p>\n\n<p>Any help most welcome.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1539187659, "post_id": 52744468, "comment_id": 92413497, "body": "The formatting rules for go doc are themselves documented: <a href=\"https://golang.org/pkg/go/doc/#ToHTML\" rel=\"nofollow noreferrer\">golang.org/pkg/go/doc/#ToHTML</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1539189810, "post_id": 52745058, "comment_id": 92414756, "body": "I stumbled upon this truth a few minutes after @Adrian commented, but thanks for more info and reinforcement."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1559044288, "last_edit_date": 1592644375, "creation_date": 1539189677, "answer_id": 52745058, "question_id": 52744468, "link": "https://stackoverflow.com/questions/52744468/godoc-documentation-not-outputting-lists/52745058#52745058", "title": "Godoc documentation not outputting lists", "body": "<p>As others noted, &quot;lists&quot; in comments will not be turned into HTML lists (such as <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>).</p>\n<p>Recommended reading: <a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"nofollow noreferrer\">Godoc: documenting Go code</a>. Quoting from it:</p>\n<blockquote>\n<p>Godoc is conceptually related to Python's <a href=\"http://www.python.org/dev/peps/pep-0257/\" rel=\"nofollow noreferrer\">Docstring</a> and Java's <a href=\"http://www.oracle.com/technetwork/java/javase/documentation/index-jsp-135444.html\" rel=\"nofollow noreferrer\">Javadoc</a>, but its design is simpler. The comments read by godoc are not language constructs (as with Docstring) nor must they have their own machine-readable syntax (as with Javadoc). Godoc comments are just good comments, the sort you would want to read even if godoc didn't exist.</p>\n</blockquote>\n<p>Only the following transformations are performed when generating HTML docs:</p>\n<blockquote>\n<p>There are a few formatting rules that Godoc uses when converting comments to HTML:</p>\n<ul>\n<li>Subsequent lines of text are considered part of the same paragraph; you must leave a blank line to separate paragraphs.</li>\n<li>Pre-formatted text must be indented relative to the surrounding comment text (see gob's <a href=\"https://golang.org/src/pkg/encoding/gob/doc.go\" rel=\"nofollow noreferrer\">doc.go</a> for an example).</li>\n<li>URLs will be converted to HTML links; no special markup is necessary.</li>\n</ul>\n</blockquote>\n<p><strong>What you may do to &quot;mimic&quot; lists:</strong></p>\n<p>Using the following comment:</p>\n<pre><code>// Fv1 is just an example.\n//\n// Here's a list:\n//\n// -First item\n//\n// -Second item\n//\n// -Third item\n//\n// This is the closing line.\n</code></pre>\n<p>Results in the following output:</p>\n<blockquote>\n<p>Fv1 is just an example.</p>\n<p>Here's a list:</p>\n<p>-First item</p>\n<p>-Second item</p>\n<p>-Third item</p>\n<p>This is the closing line.</p>\n</blockquote>\n<p>A slight variation giving better visual appearance is to use the bullet \u2022 character instead of the dash:</p>\n<pre><code>// Fv1 is just an example.\n//\n// Here's a list:\n//\n// \u2022 First item\n//\n// \u2022 Second item\n//\n// \u2022 Third item\n//\n// This is the closing line.\n</code></pre>\n<p>Results in (<a href=\"https://godoc.org/github.com/google/go-cmp/cmp\" rel=\"nofollow noreferrer\"><code>github.com/google/go-cmp</code></a> uses it):</p>\n<blockquote>\n<p>Fv1 is just an example.</p>\n<p>Here's a list:</p>\n<p>\u2022 First item</p>\n<p>\u2022 Second item</p>\n<p>\u2022 Third item</p>\n<p>This is the closing line.</p>\n</blockquote>\n<p>Or you may indent the list items (1 additional space is enough, but you can use more to your liking):</p>\n<pre><code>// Fv2 is just another example.\n//\n// Here's a list:\n//  -First item\n//  -Second item\n//  -Third item\n//\n// This is the closing line.\n</code></pre>\n<p>Which yields this in the generated doc:</p>\n<blockquote>\n<p>Fv2 is just another example.</p>\n<p>Here's a list:</p>\n<pre><code>-First item\n-Second item\n-Third item\n</code></pre>\n<p>This is the closing line.</p>\n</blockquote>\n<p>You may create &quot;nested&quot; lists like this, identation is kept (as it will be a pre-formatted block):</p>\n<pre><code>// Fv3 is just another example.\n//\n// Here's a list:\n//   -First item\n//     -First.First item\n//     -First.Second item\n//   -Second item\n//\n// This is the closing line.\n</code></pre>\n<p>Result in doc:</p>\n<blockquote>\n<p>Fv3 is just another example.</p>\n<p>Here's a list:</p>\n<pre><code>-First item\n  -First.First item\n  -First.Second item\n-Second item\n</code></pre>\n<p>This is the closing line.</p>\n</blockquote>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 934, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1559044288, "creation_date": 1539187504, "last_edit_date": 1539187692, "question_id": 52744468, "link": "https://stackoverflow.com/questions/52744468/godoc-documentation-not-outputting-lists", "title": "Godoc documentation not outputting lists", "body": "<p>I have, throughout the project I'm responsible for testing and documenting, created documentation for the functions and methods, in the following format: </p>\n\n<pre><code>// CheckPermissionArray checks that values is an array that contains the `expectedValue`\n//\n// Parameters:\n//\n// - `values` : the array to check\n// - `expectedValue` : the value to search for\n//\n// Returns:\n//\n// - an error iff `expectedValue` is not in `values`\n</code></pre>\n\n<p>The boss and other programmers approve of this format, but the problem is that godoc doesn't recognize the list:</p>\n\n<p><a href=\"https://i.stack.imgur.com/MdISx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MdISx.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is there a way to get the list to be recognized?</p>\n\n<p>Visual Studio Code was, to a point, recognizing this documentation just fine, albeit a bit buggy.</p>\n"}, {"tags": ["go", "tcp", "request"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1539185625, "post_id": 52743803, "comment_id": 92412263, "body": "There&#39;s no such thing as a &quot;request path&quot; or URI in TCP. You need to find another way to pass in the information."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539185708, "post_id": 52743803, "comment_id": 92412316, "body": "I removed the tcp term. i just need access to the request path inside the handleConnection function"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1539185793, "post_id": 52743803, "comment_id": 92412369, "body": "Changing the wording doesn&#39;t change the fact that a bare TCP connection has no notion of a URI. URIs are layer 7, your socket is layer 4."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539185865, "post_id": 52743803, "comment_id": 92412416, "body": "@Adrian so theres no way to obtain the request path prior to the tcp net dial. how does it successfully pass the request to the api instances in my tcp code and return a response?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539186001, "post_id": 52743803, "comment_id": 92412495, "body": "It&#39;s in the layer 7 payload. The path would be in the HTTP request line (e.g. <code>HTTP&#47;1.0 GET &#47;users&#47;jkushner</code>) and the hostname would be in the Host request header."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539186085, "post_id": 52743803, "comment_id": 92412555, "body": "@Adrian I see. So the apis are able to see because its in the http request line."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1539186256, "post_id": 52743803, "comment_id": 92412668, "body": "Why the downvote here? This seems like a valid question..."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1539190546, "post_id": 52743803, "comment_id": 92415174, "body": "Note that there&#39;s also HTTP 1.1, HTTP/2 and QUIC. Also note that once you read something off your network stack it&#39;s now your responsibility to handle that payload."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539185916, "post_id": 52743901, "comment_id": 92412444, "body": "It isn&#39;t &quot;likely not possible&quot;, it&#39;s just not possible, though HTTP isn&#39;t the only protocol that uses URIs (see: FTP, SQL, IRC, email, etc)."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539185932, "post_id": 52743901, "comment_id": 92412457, "body": "@Adrian I changed the wording to be more precise."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1539186019, "last_edit_date": 1539186019, "creation_date": 1539185740, "answer_id": 52743901, "question_id": 52743803, "link": "https://stackoverflow.com/questions/52743803/retrieve-uri-path-from-net-conn/52743901#52743901", "title": "Retrieve uri path from net.Conn", "body": "<p>This is not possible because not every TCP connection is an HTTP connection and the TCP protocol has no concept of URIs. Many other protocols are built on TCP and it's not that protocol's responsibility to know about them.</p>\n\n<p>HTTP is an <a href=\"https://en.wikipedia.org/wiki/Application_layer\" rel=\"nofollow noreferrer\">Application Layer (layer 7) protocol</a> which uses the <a href=\"https://en.wikipedia.org/wiki/Transport_layer\" rel=\"nofollow noreferrer\">TCP Transport Layer (layer 4) protocol</a>. As such, TCP connections have no concept of HTTP because lower layer protocols have no concept of the layers that may be built on top of them.</p>\n\n<p>You can learn more by reading about the <a href=\"https://en.wikipedia.org/wiki/OSI_model\" rel=\"nofollow noreferrer\">OSI model</a>.</p>\n"}], "owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 52743901, "answer_count": 1, "score": 0, "last_activity_date": 1539283128, "creation_date": 1539185465, "last_edit_date": 1539283128, "question_id": 52743803, "link": "https://stackoverflow.com/questions/52743803/retrieve-uri-path-from-net-conn", "title": "Retrieve uri path from net.Conn", "body": "<p>I'm working with someone else's code and I need some assistance. </p>\n\n<p>Here we have a tcp load balancer. What I need is access to the request uri from this piece of code <strong>before we do the net dial</strong>. </p>\n\n<p>I looked through the API Documentation here: <a href=\"https://golang.org/pkg/net/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/</a> but was unable to find any relevant methods under the <code>net.Conn</code> namespace for retrieving the current request path.</p>\n\n<pre><code>func copy(wc io.WriteCloser, r io.Reader) {\n    defer wc.Close()\n    io.Copy(wc, r)    \n}\n\nfunc handleConnection(us net.Conn, backend BA.Backend) {\n    if backend == nil {\n        log.Printf(\"no backend available for connection from %s\", us.RemoteAddr())\n        us.Close()\n        return\n    }           \n\n    ip:=us.RemoteAddr().String()\n    parts:=strings.Split(ip,\":\")\n    ip=parts[0]\n\n    //w := bufio.NewWriter(us)\n    //w.WriteString(+\"\\n\")\n    //w.Flush()    \n    ds, err := net.Dial(\"tcp\", backend.String())\n    if err != nil {\n        log.Printf(\"failed to dial %s: %s\", backend, err)\n        us.Close()\n        return\n    }\n\n    // Ignore errors\n    go copy(ds, us)\n    go copy(us, ds)\n}\n\nfunc tcpBalance(bind string, backends BA.Backends) error {    \n    log.Println(\"using tcp balancing\")\n    ln, err := net.Listen(\"tcp\", bind)\n    if err != nil {\n        return fmt.Errorf(\"failed to bind: %s\", err)\n    }\n\n    log.Printf(\"listening on %s, balancing %d backends\", bind, backends.Len())\n\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            log.Printf(\"failed to accept: %s\", err)\n            continue\n        }        \n        go handleConnection(conn, backends.Choose())\n    }\n\n    return err\n}\n</code></pre>\n"}, {"tags": ["arrays", "file", "go", "byte"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539182881, "post_id": 52742845, "comment_id": 92410499, "body": "What makes you think there&#39;s an issue with the number of writes? In regard to your second question, no, it writes what you tell it to when you tell it to, with no magic. If you want all-or-nothing writes, you&#39;ll have to write to a buffer in memory, then write that buffer to file at the end."}, {"owner": {"reputation": 47, "user_id": 10452537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s0V2Q.jpg?s=128&g=1", "display_name": "JohnPatel23", "link": "https://stackoverflow.com/users/10452537/johnpatel23"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539183279, "post_id": 52742845, "comment_id": 92410734, "body": "Adrian, if sample above appears fine to more seasoned Go programmers here, then I&#39;m happy to be fine with it as well - it just left me feeling there was a better way.  I was thinking about the buffer approach as well, thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1539184302, "post_id": 52742845, "comment_id": 92411449, "body": "There&#39;s not any such thing as an &quot;all or nothing&quot; write. If you need the file write to be atomic, the only way (on posix) is to write a temp file and mv it over the original. Otherwise if you want to buffer your writes, then buffer them. That&#39;s what the <code>bufio</code> package is for."}, {"owner": {"reputation": 152, "user_id": 3389196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38351195d5d3a3789c77b617455f72c5?s=128&d=identicon&r=PG&f=1", "display_name": "user3389196", "link": "https://stackoverflow.com/users/3389196/user3389196"}, "edited": false, "score": 0, "creation_date": 1539185067, "post_id": 52742845, "comment_id": 92411938, "body": "There&#39;s a library for atomic writes: <a href=\"https://github.com/natefinch/atomic\" rel=\"nofollow noreferrer\">github.com/natefinch/atomic</a>"}], "answers": [{"tags": [], "owner": {"reputation": 647, "user_id": 857156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66412a85a83783c2061838e1b44a9bbb?s=128&d=identicon&r=PG", "display_name": "Dave Gray", "link": "https://stackoverflow.com/users/857156/dave-gray"}, "is_accepted": true, "score": 0, "last_activity_date": 1539205089, "creation_date": 1539205089, "answer_id": 52748682, "question_id": 52742845, "link": "https://stackoverflow.com/questions/52742845/go-using-for-write-to-file-bytes-optimize-in-golang/52748682#52748682", "title": "Go using for write to file bytes optimize in golang", "body": "<p>The easiest way to write to a buffer in memory is using the <code>bytes</code> package, which provides a <code>Buffer</code> type. Since <code>Buffer</code> implements <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\">the <code>Writer</code> interface</a>, you can update your <code>Write</code> calls to use the <code>Buffer</code> instead, and then use the <a href=\"https://golang.org/pkg/bytes/#Buffer.WriteTo\" rel=\"nofollow noreferrer\"><code>Buffer.WriteTo</code></a> method to write the accumulated data out to the file. Here's what that looks like, with the loops combined also:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    //for dev purposes set to 256\n    const SignatureLength int = 256\n\n    certPEMBlock, err := ioutil.ReadFile(\"testsign.crt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    //OPEN FILE TO APPEND CERT INFORMATION INTO\n    f, err := os.OpenFile(\"appendMe.txt\", os.O_CREATE|os.O_APPEND|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var buf bytes.Buffer\n    for {\n        var certDERBlock *pem.Block\n        certDERBlock, certPEMBlock = pem.Decode(certPEMBlock)\n        if certDERBlock == nil {\n            break\n        }\n\n        if certDERBlock.Type == \"CERTIFICATE\" {\n            cert, err := x509.ParseCertificate(certDERBlock.Bytes)\n            if err != nil {\n                log.Println(err)\n                continue\n            }\n\n            //APPEND CERT INFO TO FILE\n            //VERSION\n            if _, err := buf.Write([]byte(strconv.Itoa(cert.Version))); err != nil {\n                log.Fatal(err)\n            }\n            //KEY ID\n            if _, err := buf.Write(cert.SubjectKeyId); err != nil {\n                log.Fatal(err)\n            }\n            //SIGNATURE LENGTH\n            if _, err := buf.Write([]byte(strconv.Itoa(SignatureLength))); err != nil {\n                log.Fatal(err)\n            }\n            //COMMON NAME\n            if _, err := buf.Write([]byte(cert.Subject.CommonName)); err != nil {\n                log.Fatal(err)\n            }\n        }\n    } //end for\n\n    // write data accumulated in buf out to f\n    buf.WriteTo(f)\n\n    //CLOSE THE FILE\n    if err := f.Close(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 10452537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s0V2Q.jpg?s=128&g=1", "display_name": "JohnPatel23", "link": "https://stackoverflow.com/users/10452537/johnpatel23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1285, "favorite_count": 0, "accepted_answer_id": 52748682, "answer_count": 1, "score": 0, "last_activity_date": 1539224584, "creation_date": 1539182588, "last_edit_date": 1539224584, "question_id": 52742845, "link": "https://stackoverflow.com/questions/52742845/go-using-for-write-to-file-bytes-optimize-in-golang", "title": "Go using for write to file bytes optimize in golang", "body": "<p>I have the following program that prints out information about each certificate in a <code>.pem</code> file:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    //for dev purposes set to 256\n    const SignatureLength int = 256\n\n    certPEMBlock, err := ioutil.ReadFile(\"testsign.crt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var blocks [][]byte\n    for {\n        var certDERBlock *pem.Block\n        certDERBlock, certPEMBlock = pem.Decode(certPEMBlock)\n        if certDERBlock == nil {\n            break\n        }\n\n        if certDERBlock.Type == \"CERTIFICATE\" {\n            blocks = append(blocks, certDERBlock.Bytes)\n        }\n    } //end for\n\n    //OPEN FILE TO APPEND CERT INFORMATION INTO\n    f, err := os.OpenFile(\"appendMe.txt\", os.O_CREATE|os.O_APPEND|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for _, block := range blocks {\n        cert, err := x509.ParseCertificate(block)\n        if err != nil {\n            log.Println(err)\n            continue\n        }\n\n        //APPEND CERT INFO TO FILE\n        //VERSION\n        if _, err := f.Write([]byte(strconv.Itoa(cert.Version))); err != nil {\n            log.Fatal(err)\n        }\n        //KEY ID\n        if _, err := f.Write(cert.SubjectKeyId); err != nil {\n            log.Fatal(err)\n        }\n        //SIGNATURE LENGTH\n        if _, err := f.Write([]byte(strconv.Itoa(SignatureLength))); err != nil {\n            log.Fatal(err)\n        }\n        //COMMON NAME\n        if _, err := f.Write([]byte(cert.Subject.CommonName)); err != nil {\n            log.Fatal(err)\n        }\n\n    } //end for\n\n    //CLOSE THE FILE\n    if err := f.Close(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>it works, but notice that each line separately writes to the file.  That seems a bit wasteful, but I am not clear about options in Go...do I create an array...do I slice it from the cert...another for loop...</p>\n\n<p><strong>QUESTION</strong></p>\n\n<p>Instead of f.Write() on each line, what is the proper or alternative approach in Go?</p>\n\n<p>Instead of using the cert.*, should I be capturing that data into a struct or array?</p>\n\n<p><strong>Follow up</strong></p>\n\n<p>let's say the last write or any write fails, does Go roll back changes or does last write not get written to the file?  This needs to be an all or nothing write.</p>\n\n<p>(this is me learning as I do, thanks for your help)</p>\n"}, {"tags": ["go", "image-processing", "amazon-s3"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1539182804, "post_id": 52742759, "comment_id": 92410456, "body": "No. S3 is just a blob store. The only information it knows about the blobs are simple metadata like key, size, creation date, and so forth. You could tag them with their dimensions when you upload them if dimensions are known at that time, then you could read the tags to get the dimensions back out, but that&#39;s about it."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 3, "last_activity_date": 1539183739, "creation_date": 1539183739, "answer_id": 52743220, "question_id": 52742759, "link": "https://stackoverflow.com/questions/52742759/determine-image-size-of-file-in-aws-s3-without-downloading-the-image/52743220#52743220", "title": "Determine image size of file in aws s3 without downloading the image", "body": "<p>You can do a partial download of the object using the range header\nSee this SO answer <a href=\"https://stackoverflow.com/questions/36436057/s3-how-to-do-a-partial-read-seek-without-downloading-the-complete-file\">S3: How to do a partial read / seek without downloading the complete file?</a></p>\n\n<p>in the AWS go sdk func (Downloader) DownloadWithContext seems like it should provide range feature</p>\n\n<p>Once you have the partial file it may be possible to extract the size information, see this answer <a href=\"https://stackoverflow.com/questions/10423942/what-is-the-header-size-of-png-jpg-jpeg-bmp-gif-and-other-common-graphics-for\">What is the header size of png, jpg/jpeg, bmp, gif and other common graphics format?</a></p>\n"}], "owner": {"reputation": 7661, "user_id": 115201, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/db3538aab7917bc8a3c79957bb9b94e4?s=128&d=identicon&r=PG", "display_name": "cupakob", "link": "https://stackoverflow.com/users/115201/cupakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1404, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539183739, "creation_date": 1539182320, "question_id": 52742759, "link": "https://stackoverflow.com/questions/52742759/determine-image-size-of-file-in-aws-s3-without-downloading-the-image", "title": "Determine image size of file in aws s3 without downloading the image", "body": "<p>I have some images (jpg, png) uploaded to aws s3 bucket. I want to extract some informations (lambda is written in golang) from the image (width and height). Is it possible to do this without downloading the image?</p>\n"}, {"tags": ["sorting", "go", "interface", "slice"], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 6, "last_activity_date": 1539180104, "creation_date": 1539180104, "answer_id": 52742033, "question_id": 52741924, "link": "https://stackoverflow.com/questions/52741924/golang-sort-the-interface-slice/52742033#52742033", "title": "Golang: Sort the interface slice", "body": "<p>This is an easy task for <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"noreferrer\"><code>sort.Slice(...)</code></a> and is very similar to the example there!</p>\n\n<p>All you need to do is call that function with your \"anything\" slice and a \"Less\" function which compares the result of <code>anything[x].getName()</code>.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/mGXY-4v67Nr\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>sort.Slice(anything, func(i, j int) bool {\n  return anything[i].getName() &lt; anything[j].getName()\n})\n// Now the items in \"anything\" are sorted alphabetically by name.\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 6233314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6035d37ffe0720c744f2eba8e95ad9e4?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Wong", "link": "https://stackoverflow.com/users/6233314/joe-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539180104, "creation_date": 1539179781, "question_id": 52741924, "link": "https://stackoverflow.com/questions/52741924/golang-sort-the-interface-slice", "title": "Golang: Sort the interface slice", "body": "<p>I implemented an interface geometry and have a slice of it []geometry,</p>\n\n<pre><code>anything := []geometry{\n        rect{width: 3, height: 4, name: \"rect\"},\n        circle{radius: 5, name: \"circle\"},\n}\n</code></pre>\n\n<p>now I want to sort the slice by name, change the sequence of elements in the slice. I can use getName function to get the name. After sorting, I want it like a slice like</p>\n\n<pre><code>{circle{radius: 5, name: \"circle\"},rect{width: 3, height: 4, name: \"rect\"},}\n</code></pre>\n\n<p>Here is the code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"sort\"\n)\n\ntype geometry interface {\n    area() float64\n    perim() float64\n    getName() string\n}\n\ntype rect struct {\n    width, height float64\n    name          string\n}\n\ntype circle struct {\n    radius float64\n    name   string\n}\n\nfunc (r rect) area() float64 {\n    return r.width * r.height\n}\nfunc (r rect) perim() float64 {\n    return 2*r.width + 2*r.height\n}\nfunc (r rect) getName() string {\n    return r.name\n}\n\nfunc (c circle) area() float64 {\n    return math.Pi * c.radius * c.radius\n}\nfunc (c circle) perim() float64 {\n    return 2 * math.Pi * c.radius\n}\nfunc (c circle) getName() string {\n    return c.name\n}\n\nfunc main() {\n    anything := []geometry{\n        rect{width: 3, height: 4, name: \"rect\"},\n        circle{radius: 5, name: \"circle\"},\n    }\n    for i := range anything {\n        fmt.Println(anything[i].getName())\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "datetime-parsing"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539180216, "post_id": 52741860, "comment_id": 92408812, "body": "what does <code>m=+xxx</code> mean?"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539180313, "post_id": 52741860, "comment_id": 92408878, "body": "I got it from <code>mongo</code> db column&#39;s value."}], "answers": [{"comments": [{"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1539181022, "post_id": 52742153, "comment_id": 92409306, "body": "Leo K after removing the <code>m=...</code> and applied provided format string its working well, but could we not parse with <code>m=...</code> ?"}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1539181337, "post_id": 52742153, "comment_id": 92409504, "body": "as I said, <code>time.Parse()</code> cannot handle input that contains extra characters - the input <b>must</b> look exactly like the format template. There are no &#39;wildcard&#39; characters. The format should contain either numbers or the string &#39;MST&#39; that act as placeholders or other literal characters (and anything that isn&#39;t a placeholder must appear exactly in the input, otherwise it is seen as invalid)."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1539181475, "post_id": 52742153, "comment_id": 92409602, "body": "Thanks @Leo K , I appreciate for your help."}], "tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": true, "score": 1, "last_activity_date": 1539180491, "creation_date": 1539180491, "answer_id": 52742153, "question_id": 52741860, "link": "https://stackoverflow.com/questions/52741860/parse-mongo-db-fields-value-date-into-golang-with-parse-method-of-time-packag/52742153#52742153", "title": "Parse mongo db field&#39;s value &quot;date&quot; into golang with parse method of time package", "body": "<p>Unless the <code>m=...</code> part is known to be constant (in which case you should include it in your format string as-is), you will have to strip it from the input string before passing it to <code>time.Parse()</code>. There is no way to tell <code>time.Parse()</code> that it should ignore a part of the input (except if it is always the same string).</p>\n\n<p>NOTE you should provide a complete time specifier as the format, not just \"2006-02-01\", because if you don't, the library will extend it in its own way to include hours, minutes and seconds - which isn't necessarily the way you want it (in your case it automatically added <code>T15:04:05.999999999Z07:00</code> - but your input data contains a space after the date, not <code>T</code>, so it won't match). In your case (judging by your example input data), the format string should be like this: <code>2006-02-01 15:04:05.000000000 -0700 MST</code></p>\n"}], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 52742153, "answer_count": 1, "score": 0, "last_activity_date": 1539180491, "creation_date": 1539179605, "question_id": 52741860, "link": "https://stackoverflow.com/questions/52741860/parse-mongo-db-fields-value-date-into-golang-with-parse-method-of-time-packag", "title": "Parse mongo db field&#39;s value &quot;date&quot; into golang with parse method of time package", "body": "<p>I've <code>created_date</code> column as a string and value of it like <code>2018-10-04 15:42:19.000404667 +0000 UTC m=+103.387519062</code> which I got from <code>mongo</code> db columns and now I inserted it into <code>mysql</code> table and of course it is of <code>string</code> type. Now the problem is that I can't parse it and formatted it as well, here I tried with below code to parse but can't get solution.</p>\n\n<pre><code>tm, err := time.Parse(\"2006-02-01\", \"2018-10-04 15:42:19.000404667 +0000 UTC m=+103.387519062\")\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>And it printed with some errors like :</p>\n\n<blockquote>\n  <p>parsing time \"2018-10-04 15:42:19.000404667 +0000 UTC m=+103.387519062\" as \"2006-01-02T15:04:05.999999999Z07:00\": cannot parse \" 15:42:19.000404667 +0000 UTC m=+103.387519062\" as \"T\"</p>\n</blockquote>\n\n<p>I tried with different <code>const</code> of <code>time</code> package but still digging into it, what I'm missing here or am I doing parse with wrong <code>date</code> type.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1539176969, "post_id": 52741013, "comment_id": 92406732, "body": "There is no need to do that, unmarshal the json into structs and then marshal it if you want."}], "answers": [{"comments": [{"owner": {"reputation": 98, "user_id": 5224649, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c8be661a7be412d0f875a85bdb58c754?s=128&d=identicon&r=PG&f=1", "display_name": "Morales", "link": "https://stackoverflow.com/users/5224649/morales"}, "edited": false, "score": 0, "creation_date": 1539178544, "post_id": 52741153, "comment_id": 92407731, "body": "Thank you, working as expected. I know it might be useless in most cases, but it is for demo purposes and I wanted to look it human readable ;) Thanks again!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1539177344, "creation_date": 1539177344, "answer_id": 52741153, "question_id": 52741013, "link": "https://stackoverflow.com/questions/52741013/pretty-json-retrieved-from-response-in-golang/52741153#52741153", "title": "Pretty JSON retrieved from response in GoLang", "body": "<p>There is <a href=\"https://golang.org/pkg/encoding/json/#Indent\" rel=\"noreferrer\"><code>json.Indent()</code></a> for this purpose. Example using it:</p>\n\n<pre><code>src := []byte(`{\"foo\":\"bar\",\"x\":1}`)\n\ndst := &amp;bytes.Buffer{}\nif err := json.Indent(dst, src, \"\", \"  \"); err != nil {\n    panic(err)\n}\n\nfmt.Println(dst.String())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/vOnLqH4GozW\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\n  \"foo\": \"bar\",\n  \"x\": 1\n}\n</code></pre>\n\n<p>But indentation is just for human eyes, it carries the same information, and libraries don't need indented JSON.</p>\n\n<p>Also see: <a href=\"https://stackoverflow.com/questions/42788045/is-there-a-jq-wrapper-for-golang-that-can-produce-human-readable-json-output/42788236#42788236\">Is there a jq wrapper for golang that can produce human readable JSON output?</a></p>\n"}], "owner": {"reputation": 98, "user_id": 5224649, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c8be661a7be412d0f875a85bdb58c754?s=128&d=identicon&r=PG&f=1", "display_name": "Morales", "link": "https://stackoverflow.com/users/5224649/morales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2670, "favorite_count": 1, "accepted_answer_id": 52741153, "answer_count": 1, "score": 1, "last_activity_date": 1539177344, "creation_date": 1539176881, "question_id": 52741013, "link": "https://stackoverflow.com/questions/52741013/pretty-json-retrieved-from-response-in-golang", "title": "Pretty JSON retrieved from response in GoLang", "body": "<p>I retrieve JSON as GET response from and endpoint</p>\n\n<pre><code>response, _ := http.Get(\"https://website-returning-json-value.com\")\ndata, _ := ioutil.ReadAll(response.Body)\nw.Write(data)\n</code></pre>\n\n<p>It returns me a JSON value, which is OK, but it is very ugly (no indents etc.). I would like to make it pretty. I've read that there is util function like MarshalIndent which does the job, but this works for JSON object (?) and ReadAll function returns []byte, so it does not work. I read the documentation regarding encoding/json package but there's a lot of information and I got a little bit stuck/confused.</p>\n\n<p>As far as I understand it should be done, I should get []byte via ReadAll function -> convert it to the JSON -> prettify it -> turn to []byte again.</p>\n"}, {"tags": ["go", "methods", "interface", "composition", "type-assertion"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1539174000, "post_id": 52739991, "comment_id": 92404783, "body": "Only *CUx has a DoBar. Stop trying to simulate inheritance by embedding. Embedding is just syntactical sugar. Write out the Embeddings and you&#39;ll see."}, {"owner": {"reputation": 89, "user_id": 429441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e742d52c1c070f5e5c9f3b2af71d7243?s=128&d=identicon&r=PG", "display_name": "Christian Schmizz", "link": "https://stackoverflow.com/users/429441/christian-schmizz"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1539174904, "post_id": 52739991, "comment_id": 92405344, "body": "@Volker But <code>Qux</code> fails at the Type Assertion <code>subject.(Bar)</code> although it implements <code>DoBar()</code> itself?!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1539175772, "post_id": 52739991, "comment_id": 92405908, "body": "No it does not have a DoBar method."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 429441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e742d52c1c070f5e5c9f3b2af71d7243?s=128&d=identicon&r=PG", "display_name": "Christian Schmizz", "link": "https://stackoverflow.com/users/429441/christian-schmizz"}, "edited": false, "score": 0, "creation_date": 1539175910, "post_id": 52740616, "comment_id": 92406012, "body": "Thank you, @icza."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1539175927, "last_edit_date": 1539175927, "creation_date": 1539175530, "answer_id": 52740616, "question_id": 52739991, "link": "https://stackoverflow.com/questions/52739991/why-does-this-type-assertion-on-a-direct-implemented-interface-fail/52740616#52740616", "title": "Why does this Type Assertion on a direct implemented interface fail?", "body": "<p><code>Qux.DoBar()</code> has pointer receiver, so only <code>*Qux</code> implements <code>Bar</code> but not <code>Qux</code>. The type <code>Qux</code> and the pointer type to it <code>*Qux</code> are different types with different <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method sets</a>.</p>\n\n<p>Using a value of type <code>*Qux</code> does implement <code>Bar</code>:</p>\n\n<pre><code>Check(&amp;Qux{bar: bar{name: \"*Qux\"}})\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/SPBg4Gz3gSG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>*Qux has Nameable\n*Qux has Bar: DoBar\n</code></pre>\n\n<p>Also if you change the receiver of <code>Qux.DoBar()</code> to be non-pointer:</p>\n\n<pre><code>func (q Qux) DoBar() string {\n    return \"DoBar\"\n}\n</code></pre>\n\n<p>Then both <code>Qux</code> and <code>*Qux</code> will implement <code>Bar</code>:</p>\n\n<pre><code>Check(bar{name: \"bar\"})\nCheck(Qux{bar: bar{name: \"Qux\"}})\nCheck(&amp;Qux{bar: bar{name: \"*Qux\"}})\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/qanZTG2KIV4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>bar has Nameable\nQux has Nameable\nQux has Bar: DoBar\n*Qux has Nameable\n*Qux has Bar: DoBar\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/40823315/x-does-not-implement-y-method-has-a-pointer-receiver/40824044#40824044\">X does not implement Y (... method has a pointer receiver)</a></p>\n"}], "owner": {"reputation": 89, "user_id": 429441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e742d52c1c070f5e5c9f3b2af71d7243?s=128&d=identicon&r=PG", "display_name": "Christian Schmizz", "link": "https://stackoverflow.com/users/429441/christian-schmizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 52740616, "answer_count": 1, "score": 0, "last_activity_date": 1539175927, "creation_date": 1539173540, "last_edit_date": 1539175675, "question_id": 52739991, "link": "https://stackoverflow.com/questions/52739991/why-does-this-type-assertion-on-a-direct-implemented-interface-fail", "title": "Why does this Type Assertion on a direct implemented interface fail?", "body": "<p>I am struggling with Go's Type Assertion mechanism. In the below example the Type Assertion for <code>Qux.(Bar)</code> fails.</p>\n\n<p>Why does a direct implementation of <code>DoBar()</code> at <code>Qux</code> not fullfill the <code>Bar</code> interface?</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\ntype Nameable interface {\n    Name() string\n}\n\ntype Foo interface {\n    Nameable\n    DoFoo() string\n}\n\ntype Bar interface {\n    Nameable\n    DoBar() string\n}\n\ntype bar struct {\n    name string\n}\n\nfunc (b bar) Name() string {\n    return b.name\n}\n\n// Qux embeds bar and is expected to fullfill Nameable interface\ntype Qux struct {\n    bar\n}\n\nfunc (q *Qux) DoBar() string {\n    return \"DoBar\"\n}\n\nfunc Check(subject Nameable) {\n    if N, ok := subject.(Nameable); ok {\n        fmt.Printf(\"%s has Nameable\\n\", N.Name())\n    } \n\n    if F, ok := subject.(Foo); ok {\n        fmt.Printf(\"%s has Foo: %s\\n\", F.Name(), F.DoFoo())\n    }\n\n    if B, ok := subject.(Bar); ok {\n        fmt.Printf(\"%s has Bar: %s\\n\", B.Name(), B.DoBar())\n    }\n}\n\nfunc main() {\n    Check(bar{name: \"bar\"})\n    Check(Qux{bar: bar{name: \"Qux\"}})\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PPkUMUu58JW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PPkUMUu58JW</a></p>\n\n<p>Output:</p>\n\n<pre><code>bar has Nameable\nQux has Nameable\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1539212794, "post_id": 52739912, "comment_id": 92424200, "body": "Thanks I have fixed the issue."}], "answers": [{"comments": [{"owner": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "edited": false, "score": 0, "creation_date": 1539181393, "post_id": 52740143, "comment_id": 92409537, "body": "I have conditions in this format: <code>[]interface{}, for JSON arrays</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "edited": false, "score": 0, "creation_date": 1539181887, "post_id": 52740143, "comment_id": 92409862, "body": "@engrhussainahmad then you just need to loop over slice of interface."}, {"owner": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "edited": false, "score": 0, "creation_date": 1539212811, "post_id": 52740143, "comment_id": 92424204, "body": "Thanks I have fixed the issue."}, {"owner": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "edited": false, "score": 0, "creation_date": 1539849701, "post_id": 52740143, "comment_id": 92652573, "body": "Thanks for your help. I have fixed it."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1539174031, "creation_date": 1539174031, "answer_id": 52740143, "question_id": 52739912, "link": "https://stackoverflow.com/questions/52739912/cast-emtpy-interface-to-its-equivalent-type-in-golang/52740143#52740143", "title": "Cast emtpy interface to its equivalent type in Golang", "body": "<p>You can implement recursion to get the underlying value of interface using type assertions. Implement a Switch case and then call it recursively until you found the primitive type for unknown types. Since if you are parsing anything inside the interface it will surely be of below types.</p>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays // slice of interface{}\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n\n<p>Check for below code on how to implement the approach.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n     res, err := g.Execute( // Sends a query to Gremlin Server with bindings\n           \"g.V(x)\",\n            map[string]string{\"x\": \"1234\"},\n            map[string]string{},\n     )\n     if err != nil {\n          fmt.Println(err)\n          return\n     }\n     fetchValue(res)\n}\n\nfunc fetchValue(value interface{}) {\n    switch value.(type) {\n    case string:\n        fmt.Printf(\"%v is an interface \\n \", value)\n    case bool:\n        fmt.Printf(\"%v is bool \\n \", value)\n    case float64:\n        fmt.Printf(\"%v is float64 \\n \", value)\n    case []interface{}:\n        fmt.Printf(\"%v is a slice of interface \\n \", value)\n        for _, v := range value.([]interface{}) { // use type assertion to loop over []interface{}\n            fetchValue(v)\n        }\n    case map[string]interface{}:\n        fmt.Printf(\"%v is a map \\n \", value)\n        for _, v := range value.(map[string]interface{}) { // use type assertion to loop over map[string]interface{}\n            fetchValue(v)\n        }\n    default:\n        fmt.Printf(\"%v is unknown \\n \", value)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 632, "user_id": 4377055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFXnX.jpg?s=128&g=1", "display_name": "engrhussainahmad", "link": "https://stackoverflow.com/users/4377055/engrhussainahmad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 52740143, "answer_count": 1, "score": -1, "last_activity_date": 1539177840, "creation_date": 1539173275, "last_edit_date": 1539177840, "question_id": 52739912, "link": "https://stackoverflow.com/questions/52739912/cast-emtpy-interface-to-its-equivalent-type-in-golang", "title": "Cast emtpy interface to its equivalent type in Golang", "body": "<p>Convert dynamic interface to its equivalent type. For example if value is int it should return int and if is string so it return int.</p>\n\n<p>Code example:</p>\n\n<pre><code>var options = bson.M{}\nfor _, val := range conditions {\n    var attr, operator, value interface{}\n    cons := val.(map[interface{}]interface{})\n\n    for range cons {\n        attr     = cons[\"attribute\"]\n        operator = cons[\"operator\"]\n        value    = cons[\"value\"]\n        switch operator {\n            case \"==\":\n                operator = \"$eq\"\n            case \"!=\":\n                operator = \"$ne\"\n            case \"()\":\n                operator = \"$in\"\n                value = []string{fmt.Sprintf(\"%v\", value)}\n        }\n        options[attr.(string)] = bson.M{operator.(string): value. \n        (int)}\n    }\n}\n</code></pre>\n\n<p>Conditions come in below format.</p>\n\n<pre><code>conditions []interface{}\ncons = append(cons, map[interface{}]interface{}{\"attribute\": \n\"discontinued\", \"operator\": \"!=\", \"value\": 1})\n\ncons = append(cons, map[interface{}]interface{}{\"attribute\": \"status\", \n\"operator\": \"==\", \"value\": 1})\n\ncons = append(cons, map[interface{}]interface{}{\"attribute\": \n\"visibility\", \"operator\": \"==\", \"value\": 4})\n</code></pre>\n\n<p>But the <em>\"value\": 4</em> OR <em>\"value\": 1</em> is not confirm.  </p>\n\n<p><strong>Error thrown:</strong> <em>interface conversion: interface {} is string, not int</em></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 10484045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/292c424e4e30b631c5d9862139e72e41?s=128&d=identicon&r=PG&f=1", "display_name": "n00py", "link": "https://stackoverflow.com/users/10484045/n00py"}, "edited": false, "score": 0, "creation_date": 1539199063, "post_id": 52740316, "comment_id": 92419165, "body": "Here is the error:  exit status 1: The filename, directory name, or volume label syntax is incorrect.   Not sure why it says this, but I can try splitting the command into multi arguments."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 19, "user_id": 10484045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/292c424e4e30b631c5d9862139e72e41?s=128&d=identicon&r=PG&f=1", "display_name": "n00py", "link": "https://stackoverflow.com/users/10484045/n00py"}, "edited": false, "score": 0, "creation_date": 1539265526, "post_id": 52740316, "comment_id": 92446179, "body": "Yes, it seems the error is because Windows cannot recognize &quot;dir C:\\\\&quot; as a command file. Let us know if it works after splitting the arguments into a slice."}, {"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 0, "creation_date": 1597959280, "post_id": 52740316, "comment_id": 112310720, "body": "It is giving an error: &#39;executable file not found in %PATH%&#39;"}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 1, "last_activity_date": 1539174556, "creation_date": 1539174556, "answer_id": 52740316, "question_id": 52739895, "link": "https://stackoverflow.com/questions/52739895/how-can-i-run-the-dir-command-with-golang/52740316#52740316", "title": "How can I run the dir command with golang?", "body": "<p>First of all, never ignore errors. The call to <code>cmd.Run()</code> returns an error, you should always check it:</p>\n\n<pre><code>if err := cmd.Run(); err != nil {\n    fmt.Printf(os.Stderr, \"%v\", err)\n}\n</code></pre>\n\n<p>Try that and you might see why your command is failing.</p>\n\n<p>Without knowing the error, it's hard to help fixing your problem, but I'd guess you need to split the string <code>command</code> into several fields and append them to <code>cmdArgs</code>. When running <code>runCommand(\"dir C:\\\\\")</code>, your <code>cmdArgs</code> is actually <code>[]string{\"/c\", \"dir C:\\\\\")</code>, I think it should be <code>[]string{\"/c\", \"dir\", \"C:\\\\\"}</code>. Take a look at the function <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>strings.Split(string, string)</code></a>, it might help you. But that's just a guess, we need to know the exact error message you're having for a proper solution :)</p>\n"}], "owner": {"reputation": 19, "user_id": 10484045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/292c424e4e30b631c5d9862139e72e41?s=128&d=identicon&r=PG&f=1", "display_name": "n00py", "link": "https://stackoverflow.com/users/10484045/n00py"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1539174556, "creation_date": 1539173197, "last_edit_date": 1539173274, "question_id": 52739895, "link": "https://stackoverflow.com/questions/52739895/how-can-i-run-the-dir-command-with-golang", "title": "How can I run the dir command with golang?", "body": "<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os/exec\"\n)\n\nfunc runCommand(command string) io.Writer{\n    cmdName := \"cmd.exe\"\n    cmdArgs := []string{\"/c\", command}\n    fmt.Println(\"Running command: \" + command)\n    cmd := exec.Command(cmdName, cmdArgs...)\n    var out bytes.Buffer\n    var stderr bytes.Buffer\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n    cmd.Run()\n    return cmd.Stdout\n\n}\nfunc main(){\n    fmt.Println(runCommand(\"dir\"))  // Prints the output of dir for the current directory\n    fmt.Println(runCommand(\"dir C:\\\\\")) // Prints nothing\n    fmt.Println(runCommand(\"dir C:\\\\Users\\\\\"))  //Prints the output of dir for the users directory\n    fmt.Println(runCommand(\"dir C:\\\\..\\\\\"))  // Prints the output of dir for the C drive (What I want)\n}\n</code></pre>\n\n<p>I'm expecting that when I execute <strong>dir C:\\</strong> That I would get the output as if I had ran in in a windows command prompt.  Instead I get nothing.  Intestingly, any other path when running <strong>dir</strong> works just fine.  I can even see <strong>C:\\</strong> If I instead execute <strong>C:\\..\\</strong>  Why is this?  I don't understand why this happens, and every other windows command I have given it works fine.  </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3, "user_id": 7739468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f77d3d5ea31d7d2dcf227c0c302095?s=128&d=identicon&r=PG&f=1", "display_name": "Den Emeryanov", "link": "https://stackoverflow.com/users/7739468/den-emeryanov"}, "edited": false, "score": 0, "creation_date": 1539174412, "post_id": 52739829, "comment_id": 92405036, "body": "@DenEmeryanov you can accept my answer if it helped."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1539173325, "last_edit_date": 1539173325, "creation_date": 1539172985, "answer_id": 52739829, "question_id": 52739694, "link": "https://stackoverflow.com/questions/52739694/for-loop-ends-with-its-body/52739829#52739829", "title": "For loop ends with its body", "body": "<p>The inside loop will never execute because the slice does not have a value it is empty so insert a random value into the slice and then range over it. </p>\n\n<p>There are other things to notice as well since <code>rand.Intn</code> already returns int then there is no need to type cast it into int. </p>\n\n<pre><code>int(rand.Intn(len(x))) // no requirement to typecast it into int.\n</code></pre>\n\n<p>One more thing is the length of map is <code>0</code> which is why the <code>rand.Intn</code> will throw an error when running your code.</p>\n\n<pre><code>wIndex := int(rand.Intn(len(x))) // This will throw an error.\n</code></pre>\n\n<p>Change your code as below.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\nfunc main() {\n\n    var x = make(map[int]float32)\n    var s []int\n    var value = 100\n    for i := 1; i &lt;= 10; i++ {\n        wIndex := rand.Intn(10) // random Index choice among map values\n        s = append(s, wIndex)\n        for _, v := range s { //end of loop here (if exactly it returnts to loop before)\n            if v != wIndex {\n                x[wIndex] += float32(value)\n            }\n        }\n    }\n    fmt.Println(s)\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Working Example on <a href=\"https://play.golang.org/p/0usp-5o1OfX\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539173127, "post_id": 52739834, "comment_id": 92404177, "body": "<code>if len(x) == 0</code>, it panics"}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": true, "score": 0, "last_activity_date": 1539173311, "last_edit_date": 1539173311, "creation_date": 1539172999, "answer_id": 52739834, "question_id": 52739694, "link": "https://stackoverflow.com/questions/52739694/for-loop-ends-with-its-body/52739834#52739834", "title": "For loop ends with its body", "body": "<p>You start with an empty <code>s</code> slice. So you will never enter your inner for loop where you add elements to the slice.</p>\n\n<p>Here is an alternative and straight forward way to do it:</p>\n\n<pre><code>for i := 1; i &lt;= 10; i++ {\n    wIndex := int(rand.Intn(len(x) + 1)) \n    found := false\n    for _, v := range s {\n        if v == wIndex {\n            found = true\n            break\n        }\n     }\n     if !found {\n        s = append(s, wIndex)\n        x[wIndex] += float32(value)\n     }\n }\n</code></pre>\n\n<ul>\n<li><p>note that you need to convert the value to a float32, so <code>x[wIndex] += float32(value)</code> instead of just <code>x[wIndex] += value</code></p></li>\n<li><p><code>rand.Intn(n int)</code> generates numbers in the range [0,n), so you need to add 1 to cover the proper range, and avoid panic when the map is empty.</p></li>\n</ul>\n"}], "owner": {"reputation": 3, "user_id": 7739468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f77d3d5ea31d7d2dcf227c0c302095?s=128&d=identicon&r=PG&f=1", "display_name": "Den Emeryanov", "link": "https://stackoverflow.com/users/7739468/den-emeryanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 52739834, "answer_count": 2, "score": -1, "last_activity_date": 1539173325, "creation_date": 1539172552, "last_edit_date": 1539172729, "question_id": 52739694, "link": "https://stackoverflow.com/questions/52739694/for-loop-ends-with-its-body", "title": "For loop ends with its body", "body": "<p>For loop ends with its body and dont go furter</p>\n\n<p>I need find wIndex, check if its in the slice, if no add value\nWhere I go wrong?</p>\n\n<pre><code>var x make(map[int]float32, 10)\nvar s []int\nvar value = 100\nfor i := 1; i &lt;= 10; i++ {\n    wIndex := int(rand.Intn(len(x))) // random Index choice among map values\n    for _, v := range s {            //end of loop here (if exactly it returnts to loop before)\n        if v != wIndex {\n            s = append(s, wIndex)\n            x[wIndex] += value\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "server-sent-events"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539174987, "post_id": 52739182, "comment_id": 92405401, "body": "No special treatment is required to support SSE, for details and example, see <a href=\"https://stackoverflow.com/questions/48267616/why-is-golang-http-resposnsewriter-execution-being-delayed/48270817#48270817\">Why is Golang http.ResponseWriter execution being delayed?</a> Most likely your client closes the connection, not the server. Although intermediate gateways and proxies might close it if the connection is idle, so it&#39;s good practice to send &quot;ping&quot; messages periodically even if there is no data to send."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539180042, "post_id": 52739182, "comment_id": 92408699, "body": "One thing that might be missing from your solution: you have to set certain response headers before sending the first data frame, such as <code>ContentType=text&#47;event-stream</code> and <code>Connection=keep-alive</code>. See the linked answer for details."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539227550, "post_id": 52739182, "comment_id": 92427287, "body": "actually indeed it needs configuration, as I said if you change &quot;WriteTimeout&quot; this is the time when the conection will get closed and the server won&#39;t send any data, you could try the same example from your link, and setting &quot;WriteTimeout&quot; to for example 10 seconds, you will see that the server won&#39;t send any data since 10 seconds have past, but what I do not know is why is this the case if &quot;IdleTimeout&quot; is supposed to handle this situation not WriteTimeout"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539227568, "post_id": 52739182, "comment_id": 92427289, "body": "I&#39;m sending the right headers"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539228180, "post_id": 52739182, "comment_id": 92427390, "body": "This happens even sending the right headers"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 528, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1539171282, "creation_date": 1539170791, "last_edit_date": 1539171282, "question_id": 52739182, "link": "https://stackoverflow.com/questions/52739182/what-should-i-configure-to-handle-sse-in-golang-http-server", "title": "What should I configure to handle SSE in golang http.server", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">http.server</a> can be configure with these parameters:</p>\n\n<pre><code>ReadTimeout, WriteTimeout,IdleTimeout and others\n</code></pre>\n\n<p>I was just playing with parameters to see in which cases would be better to configure with SSE, so following the same structured from <a href=\"https://gist.github.com/schmohlio/d7bdb255ba61d3f5e51a512a7c0d6a85\" rel=\"nofollow noreferrer\">here</a>\nI just add some prints to see when the clients conects and when disconects, like: </p>\n\n<pre><code> ....\n    notify := rw.(http.CloseNotifier).CloseNotify()\n     fmt.Fprintf(w, \"data: .\\n\\n\") `//I add this because [onopen][3] won\u00b4t` fire if nothing is sent when start conecting\n    fmt.Println(\" conecting\")\n        for {\n            select {\n            case &lt;-notify:\n    fmt.Println(\"closing\")\n                return\n            default:\n\n                // Write to the ResponseWriter\n                // Server Sent Events compatible\n                fmt.Fprintf(rw, \"data: %s\\n\\n\", &lt;-messageChan)\n\n                // Flush the data immediatly instead of buffering it for later.\n                flusher.Flush()\n            }\n        } \n</code></pre>\n\n<p>So the only value that if I changed, it prints \"closing\" is <code>WriteTimeout</code> but reading <a href=\"https://blog.gopheracademy.com/advent-2016/exposing-go-on-the-internet/\" rel=\"nofollow noreferrer\">this article</a> it is confuse to me this part: </p>\n\n<blockquote>\n  <p>Finally, Go 1.8 introduces IdleTimeout which limits server-side the\n  amount of time a Keep-Alive connection will be kept idle before being\n  reused</p>\n</blockquote>\n\n<p>But as I said even if I change <code>IdleTimeout</code> the client won't close, is it because the first time the client conects I write to it, or is it a bug?\nWhich of three should I change then?\nGo version: 1.11.1</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1539168606, "post_id": 52738288, "comment_id": 92401531, "body": "You\u2019re not putting functions /object/ in your map, you put whatever the functions returns. Or I\u2019m missing something?"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539168957, "post_id": 52738288, "comment_id": 92401730, "body": "both validateMatchPattern and validateLength are returning error value"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1539168973, "post_id": 52738288, "comment_id": 92401735, "body": "How might you call one of these functions?"}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1539169169, "post_id": 52738288, "comment_id": 92401858, "body": "@mgagnon The functions return another funtions, which then will be called when needed."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1539169231, "post_id": 52738288, "comment_id": 92401899, "body": "A map is almost certainly the wrong tool here. Note that every static map (i.e. there are no inserts or deletes at runtime) can also be expressed with a switch/case statement, which is more flexible in terms of types."}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1539169247, "post_id": 52738288, "comment_id": 92401913, "body": "@DavidMaze The functions are returning another function. The idea is iterate on the map and call the functions when needed, create an array of errors and then return it."}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1539169414, "post_id": 52738288, "comment_id": 92402028, "body": "@Peter Can be. The idea about using map is to create a correlation between the required fields and the function that will validate them. This will be done for each country, so that&#39;s why I thought about having a simple map[string]function would be easier to implement the validations for each country."}, {"owner": {"reputation": 9898, "user_id": 116546, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/967bbcaf95419a577f2443cd31658216?s=128&d=identicon&r=PG", "display_name": "drdaeman", "link": "https://stackoverflow.com/users/116546/drdaeman"}, "edited": false, "score": 0, "creation_date": 1539169882, "post_id": 52738288, "comment_id": 92402319, "body": "What&#39;s the signature of your <code>validateFoo</code> functions? I assume those are high-order functions and their signatures are something like <code>validateExistence(field string, message string) func (string) error</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 1, "last_activity_date": 1539170016, "creation_date": 1539170016, "answer_id": 52738955, "question_id": 52738288, "link": "https://stackoverflow.com/questions/52738288/map-of-strings-and-generic-functions-in-golang/52738955#52738955", "title": "Map of strings and generic functions in Golang", "body": "<p>If I was designing this, I'd break this problem down like so:</p>\n\n<ol>\n<li>I want a map of validators, each of which takes a string and returns a human-readable error.</li>\n<li>I want to be able to pair a simple validator that returns a yes-or-no answer with an error message.</li>\n<li>I need a set of simple validators.</li>\n</ol>\n\n<p>Note that in all of these cases you need functions that return functions.  The length validator, for example, can be:</p>\n\n<pre><code>func validateLength(min, max int) func(string) bool {\n        return func(s string) bool {\n                return len(s) &gt;= min &amp;&amp; len(s) &lt;= max\n        }\n}\n</code></pre>\n\n<p>Then you can wrap this in a function that produces the error</p>\n\n<pre><code>func makeValidator(f func(string) bool, msg string) func(string) error {\n        return func(s string) error {\n                if !f(s) {\n                        return errors.New(msg)\n                }\n                return nil\n        }\n}\n</code></pre>\n\n<p>Now you have a couple of layers that build the functions that go into the map, so you can create</p>\n\n<pre><code>rt := map[string]func(string) error {\n        \"Address\": makeValidator(\n                validateLength(0, 35),\n                \"Address must have up to 35 chars.\"\n        )\n}\n</code></pre>\n\n<p>This doesn't pair it with the specific field (and indeed the suggestion from comments to just write this in code is probably a good one) but if you needed this to really be generic you could use <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflection</a> to look at the contents of a structure.</p>\n"}], "owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1539170016, "creation_date": 1539167825, "question_id": 52738288, "link": "https://stackoverflow.com/questions/52738288/map-of-strings-and-generic-functions-in-golang", "title": "Map of strings and generic functions in Golang", "body": "<p>I'm trying to create a map that will map strings to functions. Not all functions have the same signature. For example, I'd like to have something like this:</p>\n\n<pre><code>rf := map[string]func(...interface{}) error{\n    \"FirstName\":        validateExistence(a.FirstName, \"FirstName is required.\"),\n    \"Postcode\":         validateMatchPattern(a.Postcode, `^\\d{5}$`, \"Could not match pattern for postcode.\"),\n    \"Address\":          validateLength(a.Address, 0, 35, \"Address must have up to 35 chars.\"),\n}\n</code></pre>\n\n<p>I'm getting this error:</p>\n\n<pre><code>cannot use validateExistence(\"FirstName is required.\") (type func(string) error) as type func(...interface {}) error in map value\n</code></pre>\n\n<p>If I change the map declaration to <code>map[string]func(f string, m string) error</code> the error for the <code>FirstName</code> is solved, but I get other errors for the other two functions:</p>\n\n<pre><code>cannot use validateMatchPattern(a.Postcode, \"^\\\\d{5}$\", \"Could not match pattern for postcode.\") (type error) as type func(string) error in map value\ncannot use validateLength(a.Address, 0, 35, \"Address must have up to 35 chars.\") (type error) as type func(string) error in map value\n</code></pre>\n\n<p>I understand the issue is in the map declaration, in the <code>func(...interface{})</code> to be more precise. This part must have the same signatures as the function I'm using as key.</p>\n\n<p>So, my question is: is there any other way to declare the map that can hold functions with different signatures?</p>\n"}, {"tags": ["sql", "database", "go", "cubrid"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539163779, "post_id": 52735474, "comment_id": 92398617, "body": "did you install <code>gcc</code>?"}, {"owner": {"reputation": 41, "user_id": 9118457, "user_type": "registered", "profile_image": "https://graph.facebook.com/611598582338529/picture?type=large", "display_name": "V&#245; Ho&#224;i Danh", "link": "https://stackoverflow.com/users/9118457/v%c3%b5-ho%c3%a0i-danh"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1539223612, "post_id": 52735474, "comment_id": 92426504, "body": "Yes, I did.  but they show an error: library not found for -lnsl"}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 4706519, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0X7Ys.jpg?s=128&g=1", "display_name": "hgryoo", "link": "https://stackoverflow.com/users/4706519/hgryoo"}, "is_accepted": false, "score": 1, "last_activity_date": 1587627021, "creation_date": 1587627021, "answer_id": 61381639, "question_id": 52735474, "link": "https://stackoverflow.com/questions/52735474/golang-connect-to-cubrid/61381639#61381639", "title": "Golang connect to Cubrid", "body": "<p>Here is the official CUBRID Go Driver.\n<a href=\"https://github.com/CUBRID/cubrid-go\" rel=\"nofollow noreferrer\">https://github.com/CUBRID/cubrid-go</a></p>\n"}], "owner": {"reputation": 41, "user_id": 9118457, "user_type": "registered", "profile_image": "https://graph.facebook.com/611598582338529/picture?type=large", "display_name": "V&#245; Ho&#224;i Danh", "link": "https://stackoverflow.com/users/9118457/v%c3%b5-ho%c3%a0i-danh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1587627021, "creation_date": 1539158863, "question_id": 52735474, "link": "https://stackoverflow.com/questions/52735474/golang-connect-to-cubrid", "title": "Golang connect to Cubrid", "body": "<p>I want to make a connection from Golang project to Cubrid DB, run on Windows and Linux.\nI found the driver github.com/sabzil/cubrid but it don't work on windows.\nPlease give me a way to solve it!!!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1539160767, "post_id": 52735844, "comment_id": 92396759, "body": "<code>ReadString</code> method is higher level function, it doesn&#39;t limit buffer size, it copies whole data to new <code>[]byte</code>. default buffer size is <code>4096</code>. one should use <code>ReadSlice</code>method if one doesn&#39;t want to copy data."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1539173447, "last_edit_date": 1539173447, "creation_date": 1539160147, "answer_id": 52735844, "question_id": 52735236, "link": "https://stackoverflow.com/questions/52735236/no-buffer-size-limit-in-bufio-newreader-readstring/52735844#52735844", "title": "No buffer size limit in bufio.NewReader.ReadString()?", "body": "<p>For example,</p>\n\n<pre><code>message, err := bufio.NewReaderSize(conn, 1024).ReadString('\\n')\n</code></pre>\n\n<hr>\n\n<p>To limit the data read, use an <code>io.LimitedReader</code>. For example,</p>\n\n<pre><code>rdr := bufio.NewReader(&amp;io.LimitedReader{R: conn, N: 1024})\nmessage, err := rdr.ReadString('\\n')\n</code></pre>\n"}], "owner": {"reputation": 19241, "user_id": 614944, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f92772ec8a16758d669026f736aa7f0f?s=128&d=identicon&r=PG", "display_name": "daisy", "link": "https://stackoverflow.com/users/614944/daisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 1, "accepted_answer_id": 52735844, "answer_count": 1, "score": 1, "last_activity_date": 1539173447, "creation_date": 1539157894, "question_id": 52735236, "link": "https://stackoverflow.com/questions/52735236/no-buffer-size-limit-in-bufio-newreader-readstring", "title": "No buffer size limit in bufio.NewReader.ReadString()?", "body": "<p>I have a socket client that read response like this:</p>\n\n<pre><code>message, err := bufio.NewReader(conn).ReadString('\\n')\n</code></pre>\n\n<p>It works perfectly, but the ReadString method seems to have no limit on the buffer size.</p>\n\n<p>Is it possible to add one? I didn't find much in bufio's document.</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539160452, "post_id": 52734529, "comment_id": 92396591, "body": "This is hard to answer. It would be helpful if you could add some code of what you have tried so far."}, {"owner": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539234763, "post_id": 52734529, "comment_id": 92428970, "body": "Thank you for your response. I have just added an example code to the question."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "edited": false, "score": 0, "creation_date": 1539213474, "post_id": 52737940, "comment_id": 92424379, "body": "Thank you, this is very helpful. Is there a way to carry out the test if the <code>OutputPaths</code> is set to <code>[]string{&quot;stdout&quot;}</code> though?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "edited": false, "score": 1, "creation_date": 1539227296, "post_id": 52737940, "comment_id": 92427250, "body": "Generally, yes. os.Stdout is just a variable that can be reassigned. But I strongly recommend not doing that, because of the side effects. I&#39;m not sure that you will see the test report, for instance. The Output fields should not influence how the logger works, so I&#39;m not sure why you want to use <code>&quot;stdout&quot;</code> in the test."}, {"owner": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "edited": false, "score": 0, "creation_date": 1539234564, "post_id": 52737940, "comment_id": 92428913, "body": "Gotcha, I have just added an example in the question to clarify what I mean, basically I would like to test the logger returned by the function <code>GetLogger()</code>. But from your response, it seems that it would be better if I just pass the <code>outputPaths</code> as a function parameter, so I can have a different value for the unit test?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "edited": false, "score": 1, "creation_date": 1539248964, "post_id": 52737940, "comment_id": 92435739, "body": "Either that or return the config instead of the finished logger and have the caller call Build()."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 7, "last_activity_date": 1539166682, "creation_date": 1539166682, "answer_id": 52737940, "question_id": 52734529, "link": "https://stackoverflow.com/questions/52734529/testing-zap-logging-for-a-logger-built-from-a-custom-config/52737940#52737940", "title": "Testing zap logging for a Logger built from a custom Config", "body": "<p>Zap has a concept of <a href=\"https://godoc.org/go.uber.org/zap#Sink\" rel=\"noreferrer\">sinks</a>, destinations for log messages. For testing, implement a sink that simply remembers messages (for instance in a bytes.Buffer):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"net/url\"\n    \"strings\"\n    \"testing\"\n    \"time\"\n\n    \"go.uber.org/zap\"\n)\n\n// MemorySink implements zap.Sink by writing all messages to a buffer.\ntype MemorySink struct {\n    *bytes.Buffer\n}\n\n// Implement Close and Sync as no-ops to satisfy the interface. The Write \n// method is provided by the embedded buffer.\n\nfunc (s *MemorySink) Close() error { return nil }\nfunc (s *MemorySink) Sync() error  { return nil }\n\n\nfunc TestLogger(t *testing.T) {\n    // Create a sink instance, and register it with zap for the \"memory\" \n    // protocol.\n    sink := &amp;MemorySink{new(bytes.Buffer)}\n    zap.RegisterSink(\"memory\", func(*url.URL) (zap.Sink, error) {\n        return sink, nil\n    })\n\n    conf := zap.NewProductionConfig() // TODO: replace with real config\n\n    // Redirect all messages to the MemorySink.    \n    conf.OutputPaths = []string{\"memory://\"}\n\n    l, err := conf.Build()\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    l.Info(\"failed to fetch URL\",\n        zap.String(\"url\", \"http://example.com\"),\n        zap.Int(\"attempt\", 3),\n        zap.Duration(\"backoff\", time.Second),\n    )\n\n    // Assert sink contents\n\n    output := sink.String()\n    t.Logf(\"output = %s\", output)\n\n    if !strings.Contains(output, `\"url\":\"http://example.com\"`) {\n        t.Error(\"output missing: url=http://example.com\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 3485638, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003689786406/picture?type=large", "display_name": "Yury  Petrov", "link": "https://stackoverflow.com/users/3485638/yury-petrov"}, "is_accepted": false, "score": 6, "last_activity_date": 1592862172, "creation_date": 1592862172, "answer_id": 62523955, "question_id": 52734529, "link": "https://stackoverflow.com/questions/52734529/testing-zap-logging-for-a-logger-built-from-a-custom-config/62523955#62523955", "title": "Testing zap logging for a Logger built from a custom Config", "body": "<p>zap has a special <code>zaptest/observer</code> module made for unit testing:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package test\n\nimport (\n    &quot;testing&quot;\n\n    &quot;go.uber.org/zap&quot;\n    &quot;go.uber.org/zap/zaptest/observer&quot;\n)\n\nfunc setupLogsCapture() (*zap.Logger, *observer.ObservedLogs) {\n    core, logs := observer.New(zap.InfoLevel)\n    return zap.New(core), logs\n}\n\nfunc Test(t *testing.T) {\n    logger, logs := setupLogsCapture()\n    \n    logger.Warn(&quot;This is the warning&quot;)\n    \n    if logs.Len() != 1 {\n        t.Errorf(&quot;No logs&quot;)\n    } else {\n        entry := logs.All()[0]\n        if entry.Level != zap.WarnLevel || entry.Message != &quot;This is the warning&quot; {\n            t.Errorf(&quot;Invalid log entry %v&quot;, entry)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 645707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0236b3816d19236bb1a6cbc4d40da14?s=128&d=identicon&r=PG", "display_name": "Freddie Sunarso", "link": "https://stackoverflow.com/users/645707/freddie-sunarso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2442, "favorite_count": 0, "accepted_answer_id": 52737940, "answer_count": 2, "score": 2, "last_activity_date": 1592862172, "creation_date": 1539155209, "last_edit_date": 1539234365, "question_id": 52734529, "link": "https://stackoverflow.com/questions/52734529/testing-zap-logging-for-a-logger-built-from-a-custom-config", "title": "Testing zap logging for a Logger built from a custom Config", "body": "<p>I have a Zap logger that is generated from a custom Config (i.e. config.Build()). I would like to test the logger by calling, for example, logger.Info() in the test method and assert the result to see if it is according to the config set. How can I achieve this?</p>\n\n<p><strong>EDIT: Adding a code example in the following</strong></p>\n\n<pre><code>func GetLogger() *zap.Logger{\n config := &amp;zap.Config{\n  Encoding: \"json\",\n  Level: zap.NewAtomicLevelAt(zapcore.InfoLevel),\n  OutputPaths: []string{\"stdout\"},\n  ErrorOutputPaths: []string{\"stdout\"},\n  EncoderConfig: zapcore.EncoderConfig{\n   MessageKey: \"@m\",\n   LevelKey:    \"@l\",\n   EncodeLevel: zapcore.CapitalLevelEncoder,\n   TimeKey:    \"@t\",\n   EncodeTime: zapcore.EpochMillisTimeEncoder,\n   CallerKey:     \"@c\",\n   EncodeCaller:  zapcore.ShortCallerEncoder,\n   StacktraceKey: \"@x\",\n  },\n }\n return config.Build()\n}\n</code></pre>\n"}, {"tags": ["go", "ffmpeg"], "comments": [{"owner": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 2, "creation_date": 1539154761, "post_id": 52734159, "comment_id": 92393481, "body": "Same answer applies here: <a href=\"https://video.stackexchange.com/q/21315/1871\">video.stackexchange.com/q/21315/1871</a> Stick the with text file method. Look into generating it at runtime, like at <a href=\"https://video.stackexchange.com/a/12906/1871\">video.stackexchange.com/a/12906/1871</a>"}], "answers": [{"tags": [], "owner": {"reputation": 168, "user_id": 7737245, "user_type": "registered", "accept_rate": 12, "profile_image": "https://lh6.googleusercontent.com/-y3mcneRr054/AAAAAAAAAAI/AAAAAAAAABM/_tJuZlnCpzQ/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/7737245/leon"}, "is_accepted": true, "score": 1, "last_activity_date": 1539154636, "creation_date": 1539154636, "answer_id": 52734359, "question_id": 52734159, "link": "https://stackoverflow.com/questions/52734159/how-to-use-command-line-to-stitch-two-wav-together-using-ffmpeg-in-linux/52734359#52734359", "title": "how to use command line to stitch two wav together using ffmpeg in linux?", "body": "<p>Try this one</p>\n\n<pre><code>ffmpeg -i 1.wav -i 2.wav -i 3.wav ...... -i {n}.wav -filter_complex '[0:0][1:0]......[{n-1}:0]concat=n={n}:v=0:a=1[out]' -map '[out]' final.wav\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 10125197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86b25799321a9bc9e1bdc81648217145?s=128&d=identicon&r=PG&f=1", "display_name": "spartaslave", "link": "https://stackoverflow.com/users/10125197/spartaslave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 52734359, "answer_count": 1, "score": 0, "last_activity_date": 1539154636, "creation_date": 1539153839, "last_edit_date": 1539154144, "question_id": 52734159, "link": "https://stackoverflow.com/questions/52734159/how-to-use-command-line-to-stitch-two-wav-together-using-ffmpeg-in-linux", "title": "how to use command line to stitch two wav together using ffmpeg in linux?", "body": "<p>I have installed ffmpeg on debian and I tried the two command lines.\nThere are two files under the same directory, they are first.wav and second.wav\nThe first method is to create a txt file, inside a.txt, they are</p>\n\n<pre><code>file 'first.wav'\nfile 'second.wav'\n</code></pre>\n\n<p>I have run</p>\n\n<pre><code>ffmpeg -f concat -i a.txt -c copy final.wav\n</code></pre>\n\n<p>then I run it, it could work fine.\nBut I want to try another method,\nwhich is </p>\n\n<pre><code>ffmpeg -i \"concat:first.wav|second.wav\" -c copy final2.wav\n</code></pre>\n\n<p>there is not error with the sdcond command line, but it only capture the first file and the length of final2.wav is almost same as first.wav. File second.wav is not stitched at all.\nAs I am using golang to execute the command line, I want to use </p>\n\n<pre><code>cmd := exec.Command(\"ffmpeg\",args)\n</code></pre>\n\n<p>to stitch the medias together, I can read all the media files into an array, but this API cannot work for the array, so I want to stitch the files together to </p>\n\n<pre><code>\"concat:file1.wav|file2.wav|file3.wav|......\"\n</code></pre>\n\n<p>in this case it could be easy to stitch the files together and I do not need to loop the cmd.\nlike</p>\n\n<pre><code>cmd = exec.Command(\"ffmpeg\",\"-i\",\"concat:first.wav|second.wav|third.wav|......\",\"-c\",\"copy\",\"final2.wav\")\n</code></pre>\n\n<p>I do not want to create any extra files like a.txt file as I need to delete it later and this may also touch the permission.\nSo is there any possible solution for the second command line?</p>\n"}, {"tags": ["asynchronous", "go", "goroutine"], "comments": [{"owner": {"reputation": 107, "user_id": 2715821, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6e2c1f7817c37a0a912c3186b05d5eea?s=128&d=identicon&r=PG&f=1", "display_name": "Feralus", "link": "https://stackoverflow.com/users/2715821/feralus"}, "edited": false, "score": 0, "creation_date": 1539150957, "post_id": 52733184, "comment_id": 92391725, "body": "The problem is, that the channel could be empty and the range operation blocks until it reads something from the channel. You can simply close the channel after wg.Wait(). Because you can be sure no go routine writes in it anymore."}, {"owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "reply_to_user": {"reputation": 107, "user_id": 2715821, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6e2c1f7817c37a0a912c3186b05d5eea?s=128&d=identicon&r=PG&f=1", "display_name": "Feralus", "link": "https://stackoverflow.com/users/2715821/feralus"}, "edited": false, "score": 0, "creation_date": 1539151658, "post_id": 52733184, "comment_id": 92392017, "body": "Thank you.  That is almost exactly what I ended up doing and it worked well.  Thank you for your help."}], "answers": [{"tags": [], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "is_accepted": false, "score": 1, "last_activity_date": 1539150462, "creation_date": 1539150462, "answer_id": 52733371, "question_id": 52733184, "link": "https://stackoverflow.com/questions/52733184/golang-chan-is-hanging-when-looping-through-the-results/52733371#52733371", "title": "Golang Chan is hanging when looping through the results", "body": "<p>So, not long after posting I figured a solution.   My problem was really two fold:</p>\n\n<ol>\n<li>Closing my channel so that it knew when to stop listening</li>\n<li>Using inconsistent methods to get my data from my goroutine to my calling function.   For errors I was using chan's but for custom structs I was just setting it.  I generisized my chan to an interface{} and then did a type switch on it when processing to determine the type of struct that it was.</li>\n</ol>\n\n<p>^^^ fixing these issues made my code work but here is what my code ended up as..</p>\n\n<pre><code>func createWorkoutPlanForUserPreconditionCheck(planID, userID, transactionID *string) (*sharedstructs.Plan, *sharedstructs.User, *sharedstructs.Profile, error) {\n    if planID == nil || userID == nil || transactionID == nil {\n        return nil, nil, nil, sharedstructs.InvalidData{Msg: \"Cannot pass in Nil Parameters\"}\n    }\n\n    outputChannel := make(chan interface{}, 3)\n    var wg sync.WaitGroup\n    wg.Add(3)\n\n    //Get the Plan from the Plan ID\n    go func() {\n        defer wg.Done()\n        returnedPlan, readError := readPlan(*planID)\n        if readError != nil || returnedPlan == nil {\n            outputChannel &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            outputChannel &lt;- *returnedPlan\n        }\n    }()\n\n    //Get the User\n    go func() {\n        defer wg.Done()\n        returnedUser, getUserError := userdomain.GetUserByID(*userID, *transactionID)\n        if getUserError != nil || &amp;returnedUser == nil {\n            outputChannel &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            outputChannel &lt;- returnedUser\n        }\n    }()\n\n    //Get the Profile\n    go func() {\n        defer wg.Done()\n        readProfile, getProfileError := profiledomain.GetProfile(*userID, *transactionID)\n        if getProfileError != nil || readProfile == nil {\n            outputChannel &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            outputChannel &lt;- *readProfile\n        }\n    }()\n\n    wg.Wait()\n    close(outputChannel)\n\n    plan := sharedstructs.Plan{}\n    user := sharedstructs.User{}\n    profile := sharedstructs.Profile{}\n    for result := range outputChannel {\n        switch result.(type) {\n        case sharedstructs.InvalidData:\n            return nil, nil, nil, result.(sharedstructs.InvalidData)\n        case sharedstructs.Plan:\n            plan = result.(sharedstructs.Plan)\n        case sharedstructs.User:\n            user = result.(sharedstructs.User)\n        case sharedstructs.Profile:\n            profile = result.(sharedstructs.Profile)\n        }\n    }\n\n    return &amp;plan, &amp;user, &amp;profile, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539153676, "creation_date": 1539149422, "last_edit_date": 1539153676, "question_id": 52733184, "link": "https://stackoverflow.com/questions/52733184/golang-chan-is-hanging-when-looping-through-the-results", "title": "Golang Chan is hanging when looping through the results", "body": "<p>I am pretty new to GoLang channels, but it isn't working as I would expect.</p>\n\n<p>I have a function that I want to call 3 separate goroutines on and then wait for them all to complete.   If I get an error then I am trying to put it on the CHAN and then handle the error after <code>wg.Wait()</code> completes.   </p>\n\n<p>Unfortunately, when looping through the CHAN results it will hang.  I hypothesize as it is still waiting for the CHAN to get filled but not all goroutines will throw errors.   </p>\n\n<p>What is the best way to handle looping through channels that won't always be populated?   I also know that I don't have to use CHANs here, but I wanted to make sure that I understood them.  </p>\n\n<p>Below is my code.</p>\n\n<pre><code>func createWorkoutPlanForUserPreconditionCheck(planID, userID, transactionID *string) (*sharedstructs.Plan, *sharedstructs.User, *sharedstructs.Profile, error) {\n    if planID == nil || userID == nil || transactionID == nil {\n        return nil, nil, nil, sharedstructs.InvalidData{Msg: \"Cannot pass in Nil Parameters\"}\n    }\n\n    plan := sharedstructs.Plan{}\n    user := sharedstructs.User{}\n    profile := sharedstructs.Profile{}\n    //myError := sharedstructs.InvalidData{}\n    ch := make(chan sharedstructs.InvalidData, 3)\n\n    var wg sync.WaitGroup\n    wg.Add(3)\n    //Get the Plan from the Plan ID\n    go func() {\n        defer wg.Done()\n        returnedPlan, readError := readPlan(*planID)\n        if readError != nil || returnedPlan == nil {\n            ch &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            plan = *returnedPlan\n        }\n    }()\n\n    //Get the User\n    go func() {\n        defer wg.Done()\n        returnedUser, getUserError := userdomain.GetUserByID(*userID, *transactionID)\n        if getUserError != nil || &amp;returnedUser == nil {\n            ch &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            user = returnedUser\n        }\n    }()\n\n    //Get the Profile\n    go func() {\n        defer wg.Done()\n        readProfile, getProfileError := profiledomain.GetProfile(*userID, *transactionID)\n        if getProfileError != nil || readProfile == nil {\n            ch &lt;- sharedstructs.InvalidData{Msg: \"Could Not Retreive the User with ID: \" + *userID}\n        } else {\n            profile = *readProfile\n        }\n    }()\n\n    wg.Wait()\n\n    ////\"Hangs Here\" - PUT MY ERROR HANDLING LOGIC HERE\n    for err := range ch {\n        fmt.Println(err.Error())\n    }\n\n    return &amp;plan, &amp;user, &amp;profile, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1337, "user_id": 903766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94253e3b2045fbf75c05e81a92035e37?s=128&d=identicon&r=PG", "display_name": "ctt", "link": "https://stackoverflow.com/users/903766/ctt"}, "edited": false, "score": 0, "creation_date": 1539134470, "post_id": 52731284, "comment_id": 92387693, "body": "<code>:=</code> is strictly used to declare variables.  If you need to assign to an existing variable (like <code>c.file</code>) you need to use <code>=</code>."}, {"owner": {"reputation": 1337, "user_id": 903766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94253e3b2045fbf75c05e81a92035e37?s=128&d=identicon&r=PG", "display_name": "ctt", "link": "https://stackoverflow.com/users/903766/ctt"}, "edited": false, "score": 0, "creation_date": 1539134519, "post_id": 52731284, "comment_id": 92387709, "body": "And Go requires you to read every variable that is written to.  If you don&#39;t plan on reading <code>err</code>, replace it with <code>_</code> in your assignment."}, {"owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "edited": false, "score": 0, "creation_date": 1539134549, "post_id": 52731284, "comment_id": 92387715, "body": "Correct but using <code>=</code> would still cause an error because err would not be declared first to be assigned. See my answer."}, {"owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "reply_to_user": {"reputation": 1337, "user_id": 903766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94253e3b2045fbf75c05e81a92035e37?s=128&d=identicon&r=PG", "display_name": "ctt", "link": "https://stackoverflow.com/users/903766/ctt"}, "edited": false, "score": 0, "creation_date": 1539134597, "post_id": 52731284, "comment_id": 92387725, "body": "@ctt he needs the error as he is planning to return it from the function."}, {"owner": {"reputation": 1337, "user_id": 903766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94253e3b2045fbf75c05e81a92035e37?s=128&d=identicon&r=PG", "display_name": "ctt", "link": "https://stackoverflow.com/users/903766/ctt"}, "edited": false, "score": 0, "creation_date": 1539134785, "post_id": 52731284, "comment_id": 92387760, "body": "If s/he needs to return it, then he needs to do his two-l-value assignment with <code>=</code> and declare <code>err</code> ahead of time.  You&#39;ve provided one possible option.  Another is to use a <code>var</code> statement to declare <code>err</code> prior to the dual-value assignment."}, {"owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "edited": false, "score": 1, "creation_date": 1539135317, "post_id": 52731284, "comment_id": 92387884, "body": "You followed my answer partially. You updated the assignment operator but not the named return type. You need to use (err error) as return type and not just error. See the image in my answer."}, {"owner": {"reputation": 1337, "user_id": 903766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94253e3b2045fbf75c05e81a92035e37?s=128&d=identicon&r=PG", "display_name": "ctt", "link": "https://stackoverflow.com/users/903766/ctt"}, "edited": false, "score": 1, "creation_date": 1539135414, "post_id": 52731284, "comment_id": 92387920, "body": "@toffee consider reading the comments and answer very carefully.  They end up explaining precisely the errors you&#39;re seeing."}], "answers": [{"comments": [{"owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "edited": false, "score": 0, "creation_date": 1539134655, "post_id": 52731334, "comment_id": 92387734, "body": "In this case both c.file and err are declared before hand and you can use assignment without facing a problem."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "edited": false, "score": 0, "creation_date": 1539135105, "post_id": 52731334, "comment_id": 92387827, "body": "Where err is declared? It not works, <code>Goland</code> tell me <code>Unresolved reference </code>err``, look at my updated question"}, {"owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "reply_to_user": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "edited": false, "score": 0, "creation_date": 1539135199, "post_id": 52731334, "comment_id": 92387854, "body": "err is a named return here. Take a look at your function and my function definition very carefully <code>func (c *FileController)OpenFile(path string)error</code> and <code>func (c *FileController)OpenFile(path string)(err error)</code>"}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "edited": false, "score": 0, "creation_date": 1539135663, "post_id": 52731334, "comment_id": 92387979, "body": "Yes, It works now, if I return <code>(err error)</code>,  Did it mean &quot;I want to return err, so please help me declare err first&quot;?   I notice you not declare err first. c.file exists, but err not."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "edited": false, "score": 0, "creation_date": 1539136347, "post_id": 52731334, "comment_id": 92388119, "body": "I solve by myself about <code>named return values</code>, Thank you!  From <code>Go doc</code> <code>Go&#39;s return values may be named. If so, they are treated as variables defined at the top of the function.</code>"}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1539143466, "post_id": 52731334, "comment_id": 92389648, "body": "<i>&quot;Using a short variable declaration requires both variables to not be declared first&quot;</i> - Not true.  To use a short variable declaration, at least <i>one</i> must not be declared."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1539146135, "post_id": 52731334, "comment_id": 92390247, "body": "@LukeJoshuaPark I am not sure, <code>err</code> is not be declared, why <code>c.file, err :=**************</code> is not working? Goland said : <code>Unresolved reference &#39;err&#39;</code>"}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1539245430, "post_id": 52731334, "comment_id": 92433676, "body": "@LukeJoshuaPark , Hi, I am really want to know what you said about <code>&quot; To use a short variable declaration, at least one must not be declared.&quot;</code>  In my case, c.file is declared, err is a new variable, But why <code>Goland IDE</code> tell me <code>unresolved reference err</code>  if you don&#39;t have time, you can give me some url or keywords, I will do by myself, Thankyou!"}], "tags": [], "owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "is_accepted": true, "score": 3, "last_activity_date": 1539135275, "last_edit_date": 1539135275, "creation_date": 1539134507, "answer_id": 52731334, "question_id": 52731284, "link": "https://stackoverflow.com/questions/52731284/golang-short-variable-declarations-show-err-unresolved/52731334#52731334", "title": "Golang short variable declarations show err unresolved", "body": "<p>The problem here is because you are using :=</p>\n\n<p>Using a short variable declaration requires both variables to not be declared first. In your case c.file is declared and err is not. Hence the error. Try the following snippet instead.</p>\n\n<pre><code>func (c *FileController)OpenFile(path string)(err error){\n    c.file, err = os.OpenFile(path,os.O_CREATE | os.O_RDWR,0755)\n\n    //return some value these\n}\n</code></pre>\n\n<p>This should work just fine</p>\n\n<p><a href=\"https://i.stack.imgur.com/NwnPN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NwnPN.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2138, "favorite_count": 0, "accepted_answer_id": 52731334, "answer_count": 1, "score": 0, "last_activity_date": 1539311809, "creation_date": 1539134039, "last_edit_date": 1539311809, "question_id": 52731284, "link": "https://stackoverflow.com/questions/52731284/golang-short-variable-declarations-show-err-unresolved", "title": "Golang short variable declarations show err unresolved", "body": "<p>I am a new hand come from <code>Java</code> to <code>Go</code></p>\n\n<p>Look at my codes</p>\n\n<pre><code>package utils\n\nimport \"os\"\n\ntype FileController struct{\n    file *os.File\n}\n\nfunc (c *FileController)OpenFile(path string)error{\n    c.file, err := os.OpenFile(path,os.O_CREATE | os.O_RDWR,0755)\n\n    //return some value these\n}\n</code></pre>\n\n<p>I want to open a file but this not works</p>\n\n<p>Goland tell me <code>Unresolved reference 'err'</code></p>\n\n<p>If I init err first, I write follow codes</p>\n\n<pre><code>var err error\nc.file, err = os.OpenFile(path,os.O_CREATE | os.O_RDWR,0755)\n</code></pre>\n\n<p><code>Goland</code> also tell me <code>Unused variable 'err'</code> </p>\n\n<p>But if I use </p>\n\n<pre><code>f, err := os.OpenFile(path,os.O_CREATE | os.O_RDWR,0755)\nc.file = f\n_ = err\n</code></pre>\n\n<p>I works</p>\n\n<p>I think <code>:=</code> will works at least have a un-declaration variable in left</p>\n\n<p>c.file already been inited, err a new variable.</p>\n\n<p>Should I must use second way?</p>\n\n<p>I feel that the first way is not elegant.</p>\n\n<hr>\n\n<p><strong>Update-1</strong> </p>\n\n<p>When I use @GreatDharmatma method.</p>\n\n<p>Golang tell me <code>Unresolved variable err</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/fPnIH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fPnIH.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p><strong>Update-2</strong></p>\n\n<p>It's works, I not notice @GreatDharmatma return <code>(err error)</code></p>\n\n<p>It's my fault.</p>\n\n<p><strong>This's a Summary:</strong></p>\n\n<ol>\n<li><p><code>:=</code> used only if all of left variable not declare before</p></li>\n<li><p>if <code>a variable</code> have been declared before(like c.file).</p>\n\n<p>We need pre-declare <code>err</code> before <code>os.OpenFile(path,os.O_CREATE | os.O_RDWR,0755)</code></p>\n\n<p><code>var err error</code></p></li>\n<li><p>Another way to solve this problem is use <code>named return value</code> as <code>@GreatDharmatma</code> said.</p></li>\n</ol>\n\n<p>From <code>Golang docs</code></p>\n\n<p><a href=\"https://tour.golang.org/basics/7\" rel=\"nofollow noreferrer\">Docs-Named-variable</a></p>\n\n<blockquote>\n  <p>Go's return values may be named. If so, they are treated as variables defined at the top of the function.</p>\n</blockquote>\n\n<p>Thank all of you!\nHave a nice day!</p>\n\n<hr>\n\n<p><strong>Update-3 After two days</strong></p>\n\n<p>From @LukeJoshuaPark comment.</p>\n\n<blockquote>\n  <p>Using a short variable declaration requires both variables to not be declared first\" - Not true. To use a short variable declaration, at least one must not be declared</p>\n</blockquote>\n\n<p>What <code>LukeJoshuaPark</code> is right, I ask a same in <code>golang-nuts</code></p>\n\n<p><em>My reply</em></p>\n\n<pre><code>For all typed object such as `type *** struct`, `type *** func()`, `type **** int`, their field cannot be redeclare? and cannot be used at left side of `:=`?\n</code></pre>\n\n<p><em>heat-heart firend said</em></p>\n\n<blockquote>\n  <p>That is correct. A member field cannot be on the left side of :=</p>\n  \n  <p>This is the from the spec:</p>\n  \n  <p>It is shorthand for a regular variable declaration with initializer expressions but no types:</p>\n  \n  <p>\"var\" IdentifierList = ExpressionList .</p>\n  \n  <p>So, </p>\n  \n  <p>x, y:=values</p>\n  \n  <p>is identical to</p>\n  \n  <p>var x, y = values</p>\n  \n  <p>Applying this rule to your example, it becomes:</p>\n  \n  <p>var c.file, err=os.OpenFile...</p>\n  \n  <p>which is not valid. </p>\n</blockquote>\n\n<h2><em>Thanks.Question Over</em></h2>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "edited": false, "score": 0, "creation_date": 1539132857, "post_id": 52731121, "comment_id": 92387354, "body": "Are you on Windows? It works fine for me on OS X but you might have <a href=\"https://stackoverflow.com/questions/17401709/why-doesnt-fmt-scanf-in-go-wait-for-user-input\">this issue</a> resolved by using a <code>\\n</code> at the end of your patterns, i.e. <code>fmt.Scanf(&quot;%s\\n&quot;, &amp;n.name)</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10481362"}, "reply_to_user": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "edited": false, "score": 0, "creation_date": 1539133132, "post_id": 52731121, "comment_id": 92387414, "body": "@Matt Yes I&#39;m in Windows, and now works, thanks!"}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "edited": false, "score": 0, "creation_date": 1539133298, "post_id": 52731121, "comment_id": 92387456, "body": "Great. It seems to be a bug with different line endings (Windows uses <code>\\r\\n</code> to terminate a line, most other OS&#39;s just use <code>\\n</code>). <code>Scanf</code> consumes <code>blah\\r</code> and drops the <code>\\r</code>, but it does not consume the <code>\\n</code> so the next call to <code>Scanf</code> finds <code>\\n</code> in the buffer, consumes it and drops it."}], "answers": [{"comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1539152200, "post_id": 52733719, "comment_id": 92392281, "body": "adding \\n instead of \\r to the input patterns also works, as discussed in the comments"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10481362"}, "edited": false, "score": 0, "creation_date": 1539181588, "post_id": 52733719, "comment_id": 92409675, "body": "Yes I&#39;m using Windows... Windows, why you can&#39;t be normal?"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 1, "last_activity_date": 1539152055, "creation_date": 1539152055, "answer_id": 52733719, "question_id": 52731121, "link": "https://stackoverflow.com/questions/52731121/flushing-stdin-buffer-in-golang/52733719#52733719", "title": "Flushing stdin buffer in Golang?", "body": "<p>This is a little difficult to reproduce on go 1.11 on Ubuntu\nI am guessing you are using a Microsoft operating system of some sort\nMicrosoft have line endings of \\r\\n, return + newline whereas Unix-like systems have just \\n newline only</p>\n\n<p>If I fake up an input file for your program that has \\r\\n line endings\nit does seem to skip</p>\n\n<p>Whereas an input file with only \\n makes the program work correctly</p>\n\n<p>Adding explicit \\r to the pattern as shown seems to fix the problem</p>\n\n<pre><code>fmt.Print(\"Name? \")\nfmt.Scanf(\"%s\\r\", &amp;n.name)\n\nfmt.Print(\"Last name? \")\nfmt.Scanf(\"%s\\r\", &amp;n.surnm)\n\nfmt.Print(\"Age? \")\nfmt.Scanf(\"%d\\r\", &amp;n.age)\n</code></pre>\n\n<p>This is curious as the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">go documentation on scanf</a> states</p>\n\n<blockquote>\n  <p>In all the scanning functions, a carriage return followed immediately\n  by a newline is treated as a plain newline (\\r\\n means the same as\n  \\n).</p>\n</blockquote>\n\n<p>To be fair, once the changes above are made the code behaves the same for \\n files and \\r\\n files</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10481362"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 0, "accepted_answer_id": 52733719, "answer_count": 1, "score": 1, "last_activity_date": 1539152055, "creation_date": 1539132294, "question_id": 52731121, "link": "https://stackoverflow.com/questions/52731121/flushing-stdin-buffer-in-golang", "title": "Flushing stdin buffer in Golang?", "body": "<p>I'm new programming with Go.\nI've been writing this little program that uses structures.\nIt's a structure called user, which has as values, first name, last name and age.\nThe problem lies when entering data, more specifically when it comes to entering the last name, this error happens:\n<a href=\"https://i.stack.imgur.com/puMjq.png\" rel=\"nofollow noreferrer\">a screenshot of the error</a></p>\n\n<p>You can see from the image that when you introduces data in the name field,\nignores last name field, and jumps to age.</p>\n\n<p>Having knowledge in C, this error happens when the buffer has not been flushed. (but C is a different language from Go)</p>\n\n<p>As I know, Go stdin read is unbuffered.\nSo how would you solve this problem?</p>\n\n<p>Here's the code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype user struct {\n    name, surnm string\n    age int\n}\n\nfunc main() {\n\n    n := new(user)\n\n    fmt.Print(\"Name? \")\n    fmt.Scanf(\"%s\", &amp;n.name)\n\n    fmt.Print(\"Last name? \")\n    fmt.Scanf(\"%s\", &amp;n.surnm)\n\n    fmt.Print(\"Age? \")    \n    fmt.Scanf(\"%d\", &amp;n.age)\n\n    fmt.Println(n.name)         \n    fmt.Println(n.surnm)\n    fmt.Println(n.age)\n\n}\n</code></pre>\n\n<p>Sorry if my question is a little bit stupid, but how I said, I am new at Go.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1539126862, "post_id": 52730473, "comment_id": 92386030, "body": "That interface does not define any behaviour around truncating the data. You&#39;re going to have to create a new interface that add such a method, or work on a specific type like <code>*os.File</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10481215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/154e7583877f5ea03d2b3ba25ec7a203?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/10481215/john-doe"}, "edited": false, "score": 0, "creation_date": 1539191450, "post_id": 52731789, "comment_id": 92415642, "body": "Hey Peter, this works but I am unable to understand why. I probably just need to learn more about interfaces &amp; go, but what function exactly is &quot;Truncate(size int64) error&quot; calling?  Is it somehow accessing the original *os.File.Truncate? Or is there another Truncate that I missed in the docs?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1539139550, "last_edit_date": 1539139550, "creation_date": 1539138848, "answer_id": 52731789, "question_id": 52730473, "link": "https://stackoverflow.com/questions/52730473/deleting-bytes-from-a-io-readwriteseekervia-file/52731789#52731789", "title": "Deleting bytes from a io.ReadWriteSeeker(via file)", "body": "<p>If the <code>io.ReadWriteSeeker</code> value also supports a <code>Truncate</code> method, like an *os.File value.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc truncate(rws io.ReadWriteSeeker, size int64) error {\n    type Truncater interface {\n        Truncate(size int64) error\n    }\n    t, ok := rws.(Truncater)\n    if !ok {\n        return fmt.Errorf(\"truncate: unable to truncate\")\n    }\n    return t.Truncate(size)\n}\n\nfunc main() {\n    filename := `/tmp/truncate.test.file`\n    f, err := os.Create(filename)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    defer f.Close()\n    n, err := f.Write([]byte(\"test data\"))\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    data, err := ioutil.ReadFile(filename)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    fmt.Println(string(data))\n\n    // truncate io.ReadWriteSeeker\n    err = truncate(f, int64(n-1))\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n\n    data, err = ioutil.ReadFile(filename)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    fmt.Println(string(data))\n    os.Remove(filename)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pp4IUSoKo4M\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pp4IUSoKo4M</a></p>\n\n<p>Output:</p>\n\n<pre><code>test data\ntest dat\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10481215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/154e7583877f5ea03d2b3ba25ec7a203?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/10481215/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "accepted_answer_id": 52731789, "answer_count": 1, "score": 1, "last_activity_date": 1539139550, "creation_date": 1539126660, "question_id": 52730473, "link": "https://stackoverflow.com/questions/52730473/deleting-bytes-from-a-io-readwriteseekervia-file", "title": "Deleting bytes from a io.ReadWriteSeeker(via file)", "body": "<p>Let's say I have an io.ReadWriteSeeker that is reading an writing from a certain file.</p>\n\n<p>At some point I decide I want to remove some bytes from the file (specifically the end) and reduce its length.</p>\n\n<p>Whats the right way to go about this?</p>\n\n<ul>\n<li><p>I can't just overwrite it by seeking because I want to end up with a shorter file.</p></li>\n<li><p>io.CopyN will similarly not work (as src is smaller than dest)</p></li>\n</ul>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1539139958, "post_id": 52730436, "comment_id": 92388836, "body": "<code>myXML = &quot;&lt;OuterTag&gt;&quot; + myXML + &quot;&lt;OuterTag&gt;&quot;</code> :)"}, {"owner": {"reputation": 37, "user_id": 6139269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe5c850f29537ebc4e9aee33b7e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Junxi", "link": "https://stackoverflow.com/users/6139269/junxi"}, "reply_to_user": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1539140931, "post_id": 52730436, "comment_id": 92389039, "body": "Thanks har07. I think there might be a more structured way."}], "answers": [{"tags": [], "owner": {"reputation": 37, "user_id": 6139269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe5c850f29537ebc4e9aee33b7e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Junxi", "link": "https://stackoverflow.com/users/6139269/junxi"}, "is_accepted": false, "score": 1, "last_activity_date": 1539195044, "creation_date": 1539195044, "answer_id": 52746372, "question_id": 52730436, "link": "https://stackoverflow.com/questions/52730436/add-outer-tags-in-an-xml-string-in-golang/52746372#52746372", "title": "Add Outer Tags in an XML String in Golang", "body": "<p>I figured out a way, may not be the best but it works.\nSimply utilize xml.Encoder.EncodeToken()</p>\n\n<p>The original xml is CharData that implements xml.Token interface.\n'OuterTag' is StartElement which also implements xml.Token interface.</p>\n\n<pre><code>encoder := xml.NewEncoder(buf)\nouterTag := xml.StartElement {Name: xml.Name{Space:\"\", Local:\"OuterTag\"}}\nencoder.EncodeToken(outerTag)\ndefer encoder.EncodeToken(outerTag.End())\nencoder.EncodeToken(originalXmlBytes)\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 6139269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe5c850f29537ebc4e9aee33b7e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Junxi", "link": "https://stackoverflow.com/users/6139269/junxi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539195044, "creation_date": 1539126381, "question_id": 52730436, "link": "https://stackoverflow.com/questions/52730436/add-outer-tags-in-an-xml-string-in-golang", "title": "Add Outer Tags in an XML String in Golang", "body": "<p>I wonder if it's possible to add outer tags to a given XML string.\nFor example, to wrap up my XML string with </p>\n\n<p>INPUT:</p>\n\n<pre><code>&lt;My&gt;&lt;XML&gt;&lt;String&gt;Something Here...&lt;/String&gt;&lt;/XML&gt;&lt;/My&gt;\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code>&lt;OuterTag&gt;&lt;My&gt;&lt;XML&gt;&lt;String&gt;Something Here...&lt;/String&gt;&lt;/XML&gt;&lt;/My&gt;&lt;/OuterTag&gt;\n</code></pre>\n\n<p>I've tried xml.Encoder.EncodeToken(), xml.Encoder.Encode() but it doesn't work out.</p>\n\n<p>I'm asking this because I'd like to wrap up my XML to a SOAP envelope, as Golang doesn't built-in SOAP support.</p>\n\n<p>Any idea is appreciated!</p>\n"}, {"tags": ["go", "wait"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1539123793, "post_id": 52730011, "comment_id": 92385363, "body": "What do you mean by &quot;Those remaining 5 goroutines have to be called?&quot; At what point in execution do they need to get before you can move on? This needs to addressed on an architectural level and merits more thought than this quick SO question."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1539174835, "last_edit_date": 1539174835, "creation_date": 1539124441, "answer_id": 52730237, "question_id": 52730011, "link": "https://stackoverflow.com/questions/52730011/concurrency-design-in-golang-wait-for-a-certain-number-of-goroutines/52730237#52730237", "title": "Concurrency Design in golang - wait for a certain number of goroutines", "body": "<p>Since you are communicating with remote servers, it probably makes sense to have a <a href=\"https://golang.org/pkg/context#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a> that gets canceled once 5 of your 10 requests complete. You would pass that context to whatever network function you are using.</p>\n\n<p>For example:</p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background())\nn := int32(10)\n// Inside the goroutine\nif atomic.AddInt32(&amp;n, -1) == 5 {\n    cancel()\n}\n&lt;-ctx.Done() // returns once the context is canceled\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 4459820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3bf2d73bba3bc541e2f6c08d5ccb292?s=128&d=identicon&r=PG&f=1", "display_name": "Palash Ahuja", "link": "https://stackoverflow.com/users/4459820/palash-ahuja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 52730237, "answer_count": 1, "score": 2, "last_activity_date": 1539174835, "creation_date": 1539122874, "last_edit_date": 1539123868, "question_id": 52730011, "link": "https://stackoverflow.com/questions/52730011/concurrency-design-in-golang-wait-for-a-certain-number-of-goroutines", "title": "Concurrency Design in golang - wait for a certain number of goroutines", "body": "<p>I have a list of 10 servers, out of which one of those servers is a <em>primary</em>. It has the responsibility of sending a <em>request</em> to remaining 9 servers and has to wait for a reply for <em>at least 5 of them.</em> I can send these requests asynchronously using goroutines, and once I have received the reply from <em>at least 5 of them</em>, I can proceed with my execution. How do I design this using go, in general? Feel free to use any tools you like. You can assume these 10 servers are isolated, and have nothing shared between them. </p>\n"}, {"tags": ["firebase", "go", "google-cloud-firestore", "google-admin-sdk"], "comments": [{"owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "edited": false, "score": 1, "creation_date": 1539121649, "post_id": 52729467, "comment_id": 92384698, "body": "A field can&#39;t exist directly within a collection.  A collection or subcollection can only contain documents, and documents contain fields."}, {"owner": {"reputation": 411025, "user_id": 209103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/12d378e6a9788ab9c94bbafe242b82b4?s=128&d=identicon&r=PG", "display_name": "Frank van Puffelen", "link": "https://stackoverflow.com/users/209103/frank-van-puffelen"}, "edited": false, "score": 0, "creation_date": 1539142066, "post_id": 52729467, "comment_id": 92389332, "body": "Sounds like an answer Doug."}, {"owner": {"reputation": 627, "user_id": 4869748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8c1c0c9cb723cd9175854835384b4e?s=128&d=identicon&r=PG&f=1", "display_name": "Godfrey", "link": "https://stackoverflow.com/users/4869748/godfrey"}, "edited": false, "score": 0, "creation_date": 1571229379, "post_id": 52729467, "comment_id": 103169845, "body": "How about retrieving the entire doc, unmarshal it and then get the value from the struct ?"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 10207596, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VfXOx.jpg?s=128&g=1", "display_name": "Skoff", "link": "https://stackoverflow.com/users/10207596/skoff"}, "is_accepted": false, "score": 0, "last_activity_date": 1600855790, "creation_date": 1600855790, "answer_id": 64025624, "question_id": 52729467, "link": "https://stackoverflow.com/questions/52729467/golang-firebase-admin-sdk/64025624#64025624", "title": "Golang Firebase admin SDK", "body": "<p>First of all like @Doug Stevenson said a collection only contains documents. So know we can use this structure as a foundation for our request.</p>\n<pre><code>Collection (CollectionA) -&gt; Document (documentX) -&gt; Collection (CollectionB) -&gt; Document (documentY) -&gt; Field (FieldB)\n</code></pre>\n<p>You should consider to read a little within the go documentation of the firebase admin sdk.\n<a href=\"https://godoc.org/cloud.google.com/go/firestore\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/firestore</a></p>\n<p>There you can see that we can chain our requests as needed. So your query would look like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>dsnapp2, err := client.Collection(&quot;Collection1&quot;).Doc(&quot;documentX&quot;).Collection(&quot;Collection1&quot;).Document(&quot;documentY&quot;).Get(ctx)\nm := dsnapp2.Data() // it is important to use the := operator if you havn't initialized the variable yet\n\nfmt.Printf(&quot;222  Document data: %#v\\n&quot;, m[&quot;FieldB&quot;)\n</code></pre>\n<p>But if you need more than one field you should consider to unmarshal your result, like the first document (documentX), to an struct. From there you are also able to get your needed fields.</p>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1600855790, "creation_date": 1539119878, "question_id": 52729467, "link": "https://stackoverflow.com/questions/52729467/golang-firebase-admin-sdk", "title": "Golang Firebase admin SDK", "body": "<p>Assuming a Firebase Datastore Db that is...</p>\n\n<pre><code>Collection(\"Collection1\").\nDocument(\"documentX\").\nCollection(\"CollectionA\").\nfield(\"FieldB\")\n</code></pre>\n\n<p>In Golang, using firebase admin SDK... What would the code be to get value of FieldB in GoLang?\nthis is what I've tried...</p>\n\n<pre><code>// dsnapp, err :=     client.Collection(\"Collection1/documentX\").Get(ctx)\n// dsnapp, err := client.Collection(\"Collection1\").Document(\"documentX\").Collection[\"CollectionA\"].Get(ctx)\n\ndsnapp2, err := client.Collection(\"Collection1\").Doc(\"documentX\").Get(ctx)\nm = dsnapp2.Data()\nfmt.Printf(\"222  Document data: %#v\\n\", m[\"CollectionA\"][\"FieldB\")\n</code></pre>\n\n<p>and assorted other techniques...   any suggestions?</p>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1539119953, "post_id": 52728626, "comment_id": 92384087, "body": "You can get started by looking at <a href=\"https://golang.org/pkg/runtime/#ReadMemStats\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/#ReadMemStats</a> and then possibly use Linux profiling tools if that is the OS you are using."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1539121120, "post_id": 52728626, "comment_id": 92384500, "body": "&quot;As far as I can tell no part of my program should be using a large amount of stack space.&quot; Without code, nor can we."}], "owner": {"reputation": 63, "user_id": 4993041, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qx-CSqRXiWU/AAAAAAAAAAI/AAAAAAAAAGQ/pJs2hP8xlC8/photo.jpg?sz=128", "display_name": "Evan Thomas", "link": "https://stackoverflow.com/users/4993041/evan-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1539115882, "creation_date": 1539115882, "question_id": 52728626, "link": "https://stackoverflow.com/questions/52728626/how-to-profile-large-stack-in-go", "title": "how to profile large stack in go", "body": "<p>I have a toy go problem i'm working on to try to learn more about go profiling. If i'm reading the profile correctly my program is spending 43% of cumulative cpu time in runtime.morestack. My understanding is that runtime.morestack should only be called when a goroutine's stack exceeds the amount allocated for it. As far as I can tell no part of my program should be using a large amount of stack space. Is there a way I can I look at how large my stacks are? (Both the size are and what variables are on each stack frame?</p>\n\n<p>I've run <code>pprof.Lookup(\"goroutine\").WriteTo(f, 0)</code> but it looks like this doesn't report the size of the stack frames or their contents.</p>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1539143961, "post_id": 52727987, "comment_id": 92389762, "body": "The item is publicly accessible through a public url. But you cannot access a bucket without credentials."}, {"owner": {"reputation": 4897, "user_id": 795053, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7281b1d9f19c2c5f8a9c5fc45e81450e?s=128&d=identicon&r=PG", "display_name": "Alex Flint", "link": "https://stackoverflow.com/users/795053/alex-flint"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539187857, "post_id": 52727987, "comment_id": 92413601, "body": "@Himanshu can I use the AWS SDK for Go to get the public URL for an object? I know I could construct it manually but I&#39;d rather not."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539188067, "post_id": 52727987, "comment_id": 92413720, "body": "When you are uploading an to AWS S3 bucket using GO SDK, They actually provide you a location of where the object is stored in the response. This is public location which is actually a url to the aws bucket along with the region added and bucket name."}], "answers": [{"tags": [], "owner": {"reputation": 18271, "user_id": 447344, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hq0lN.jpg?s=128&g=1", "display_name": "Thomas Decaux", "link": "https://stackoverflow.com/users/447344/thomas-decaux"}, "is_accepted": false, "score": 0, "last_activity_date": 1600958245, "creation_date": 1600958245, "answer_id": 64048786, "question_id": 52727987, "link": "https://stackoverflow.com/questions/52727987/using-the-s3-client-from-the-aws-sdk-for-go-without-credentials/64048786#64048786", "title": "Using the S3 client from the AWS SDK for Go without credentials", "body": "<p>When creating the session:</p>\n<pre><code>sess := session.Must(session.NewSession(&amp;aws.Config{\n        Credentials: credentials.AnonymousCredentials,\n        ....\n    }))\n</code></pre>\n"}], "owner": {"reputation": 4897, "user_id": 795053, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7281b1d9f19c2c5f8a9c5fc45e81450e?s=128&d=identicon&r=PG", "display_name": "Alex Flint", "link": "https://stackoverflow.com/users/795053/alex-flint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1600958245, "creation_date": 1539112867, "question_id": 52727987, "link": "https://stackoverflow.com/questions/52727987/using-the-s3-client-from-the-aws-sdk-for-go-without-credentials", "title": "Using the S3 client from the AWS SDK for Go without credentials", "body": "<p>I am using the Go AWS SDK to access an object in an S3 bucket. I instantiate <code>s3.S3</code>, then call</p>\n\n<pre><code>s3client.GetObject(...)\n</code></pre>\n\n<p>The object I am accessing is publicly accessible, so I do not wish to provide any credentials. However, if I do not provide any credentials then I get the following error:</p>\n\n<pre><code>NoCredentialProviders: no valid providers in chain. Deprecated.\\n\\tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors\n</code></pre>\n"}, {"tags": ["parsing", "go", "binary"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1539111632, "post_id": 52727404, "comment_id": 92380570, "body": "your <code>testBytes</code> numbers are big endian. Why are you expecting little endian values?"}, {"owner": {"reputation": 824, "user_id": 4580653, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/MVlIV.jpg?s=128&g=1", "display_name": "pulse0ne", "link": "https://stackoverflow.com/users/4580653/pulse0ne"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539115429, "post_id": 52727404, "comment_id": 92382211, "body": "ah, wow. thank you! I knew I was too close to the problem and missing something simple"}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 1, "last_activity_date": 1539112619, "creation_date": 1539112619, "answer_id": 52727921, "question_id": 52727404, "link": "https://stackoverflow.com/questions/52727404/binary-read-not-producing-expected-values-in-struct/52727921#52727921", "title": "binary.Read() not producing expected values in struct", "body": "<p>Yes BigEndian works much better</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\ntype Header struct {\n    Type        [4]byte\n    Creator     [4]byte\n    Uid         uint32\n    Next        uint32\n    RecordCount uint16\n}\n\nfunc main() {\n    testBytes := []byte{66, 79, 79, 75, 77, 79, 66, 73, 0, 0, 1, 17, 0, 0, 0, 0, 0, 136}\n\n    h := Header{}\n    buf := bytes.NewBuffer(testBytes)\n    binary.Read(buf, binary.BigEndian, &amp;h)\n\n    fmt.Printf(\"%s\\n\", h.Type)    // BOOK, as expected\n    fmt.Printf(\"%s\\n\", h.Creator) // MOBI, as expected\n    fmt.Printf(\"%d\\n\", h.Next)    // 0, as expected\n\n    fmt.Printf(\"%d\\n\", h.Uid)\n    // expecting Uid to be 273, but it's 285278208...\n    fmt.Printf(\"%d\\n\", h.RecordCount)\n    // expecting RecordCount to be 136, but it's 34816...\n}\n</code></pre>\n"}], "owner": {"reputation": 824, "user_id": 4580653, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/MVlIV.jpg?s=128&g=1", "display_name": "pulse0ne", "link": "https://stackoverflow.com/users/4580653/pulse0ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 52727921, "answer_count": 1, "score": 1, "last_activity_date": 1539112619, "creation_date": 1539110322, "last_edit_date": 1539111247, "question_id": 52727404, "link": "https://stackoverflow.com/questions/52727404/binary-read-not-producing-expected-values-in-struct", "title": "binary.Read() not producing expected values in struct", "body": "<p>I'm trying to make a MOBI file parser and I'm running into a bit of an issue with trying to parse some of the binary into a struct with binary.Read().</p>\n\n<p>I'm thinking it's an alignment issue, but I'm at a loss for why I'm not getting expected values. I've run the .mobi file through libmobi to test my code's output against, as well as inspected the binary of the .mobi in order to verify that I'm not crazy and the libmobi code wasn't doing something weird (which it's not).</p>\n\n<p>Here's a stripped-down example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\ntype Header struct {\n    Type        [4]byte\n    Creator     [4]byte\n    Uid         uint32\n    Next        uint32\n    RecordCount uint16\n}\n\nfunc main() {\n    testBytes := []byte{66, 79, 79, 75, 77, 79, 66, 73, 0, 0, 1, 17, 0, 0, 0, 0, 0, 136}\n\n    h := Header{}\n    buf := bytes.NewBuffer(testBytes)\n    binary.Read(buf, binary.LittleEndian, &amp;h)\n\n    fmt.Printf(\"%s\\n\", h.Type)    // BOOK, as expected\n    fmt.Printf(\"%s\\n\", h.Creator) // MOBI, as expected\n    fmt.Printf(\"%d\\n\", h.Next)    // 0, as expected\n\n    fmt.Printf(\"%d\\n\", h.Uid)\n    // expecting Uid to be 273, but it's 285278208...\n    fmt.Printf(\"%d\\n\", h.RecordCount)\n    // expecting RecordCount to be 136, but it's 34816...\n}\n</code></pre>\n\n<p>Any help would be greatly appreciated!</p>\n\n<p>EDIT: here are the hex bytes from doing a <code>xxd</code> on <code>book.mobi</code>:</p>\n\n<p><code>424f 4f4b 4d4f 4249 0000 0111 0000 0000 0088</code></p>\n"}, {"tags": ["dictionary", "go", "concurrency", "mutex"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 8, "creation_date": 1539108501, "post_id": 52726814, "comment_id": 92379098, "body": "Your <code>GetBids2</code> function returns an unsynchronized reference when that function returns. So the runtime is able to detect this and panic."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1539108506, "post_id": 52726814, "comment_id": 92379103, "body": "You&#39;re not protecting the reads with a lock, you&#39;re passing the maps into <code>fmt.Printf</code>"}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1539123727, "post_id": 52726814, "comment_id": 92385343, "body": "I understood, I&#39;ll copy it to another temporary variable."}], "owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1539107824, "creation_date": 1539107824, "question_id": 52726814, "link": "https://stackoverflow.com/questions/52726814/go-software-panics-for-concurrent-access-despite-being-handled-by-mutexes", "title": "go - software panics for concurrent access despite being handled by mutexes", "body": "<p>i have a map that is being read and written by 3 goroutines constantly, the program always ends up with a \"fatal error: concurrent map iteration and map write\" despite me setting up the mutex to protect it, I know I could use sync.Map or I could sync with a channel but I'd really like to understand what I am doing wrong. this is the code:</p>\n\n<pre><code>//book.go\ntype OrderbookMap map[float64]float64\n\ntype Orderbook struct {\n    Bids     OrderbookMap\n    Asks     OrderbookMap\n    Symbol   string\n    IsInit   bool\n    UpdateId int\n    mu sync.Mutex\n}\n\nfunc (book *Orderbook) Init() {\n\n    book.mu.Lock()\n    defer book.mu.Unlock()\n\n    if book.IsInit {\n        return\n    }\n    book.Asks = make(OrderbookMap)\n    book.Bids = make(OrderbookMap)\n    book.IsInit = true\n}\n//functions with mutexes\nfunc DelBid2(b *Orderbook, price float64) {\n    b.mu.Lock()\n    defer b.mu.Unlock()\n    if _, ok := b.Bids[price]; ok {\n        delete(b.Bids, price)\n    } else {\n        fmt.Printf(\"VALUE NOT FOUND %v\\n\", price)\n    }\n}\n\n\nfunc AddBid2(b *Orderbook, price float64, qty float64) {\n    b.mu.Lock()\n    defer b.mu.Unlock()\n    b.Bids[price] = qty\n}\n\n\nfunc GetBids2(b *Orderbook) OrderbookMap {\n    b.mu.Lock()\n    defer b.mu.Unlock()\n    return b.Bids\n}\n\n//TesterFile.go\nfunc TestBookRace(t *testing.T) {\n    var B Orderbook\n    B.Init()\n    //add\n    go func() {\n        for {\n            b, q := rFloat(), rFloat()\n            AddBid2(&amp;B, b, q)\n            fmt.Printf(\"ADD %v NEW: %v\\n\", b, GetBids2(&amp;B))\n        }\n    }()\n    //del\n    go func() {\n        for {\n            b := rFloat()\n\n            DelBid2(&amp;B, b)\n            fmt.Printf(\"DEL %v NEW: %v\\n\", b, GetBids2(&amp;B))\n        }\n    }()\n    //read\n    go func() {\n        for {\n            fmt.Printf(\"READ %v\\n\", GetBids2(&amp;B))\n        }\n    }()\n\n\n    for { time.Sleep(10 * time.Second)}\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 783, "user_id": 10385798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6b95e04462cabe326d0daa530b314d1?s=128&d=identicon&r=PG&f=1", "display_name": "Lars Hendriks", "link": "https://stackoverflow.com/users/10385798/lars-hendriks"}, "edited": false, "score": 1, "creation_date": 1539334110, "post_id": 52726305, "comment_id": 92473188, "body": "could you share the mongodb log files, and mongostats if possible? also pls show us the socketoptions you defined ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539431770, "post_id": 52726305, "comment_id": 92505764, "body": "Which <code>mgo</code> driver are you using? Please post full package path you use to import it."}, {"owner": {"reputation": 3457, "user_id": 3345844, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9ed3fc6301afd47a0a5ef1c97c4ab8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Atish", "link": "https://stackoverflow.com/users/3345844/atish"}, "edited": false, "score": 0, "creation_date": 1539589511, "post_id": 52726305, "comment_id": 92541701, "body": "can you check if your connection is doing some heavy ops on mongodb?"}, {"owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1539636508, "post_id": 52726305, "comment_id": 92566238, "body": "@icza answered in the edits"}, {"owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "reply_to_user": {"reputation": 783, "user_id": 10385798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6b95e04462cabe326d0daa530b314d1?s=128&d=identicon&r=PG&f=1", "display_name": "Lars Hendriks", "link": "https://stackoverflow.com/users/10385798/lars-hendriks"}, "edited": false, "score": 0, "creation_date": 1539636516, "post_id": 52726305, "comment_id": 92566243, "body": "@LarsHendriks in the edits"}, {"owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "reply_to_user": {"reputation": 3457, "user_id": 3345844, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9ed3fc6301afd47a0a5ef1c97c4ab8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Atish", "link": "https://stackoverflow.com/users/3345844/atish"}, "edited": false, "score": 0, "creation_date": 1539636524, "post_id": 52726305, "comment_id": 92566247, "body": "@Astro answered in the edits"}], "answers": [{"comments": [{"owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "edited": false, "score": 0, "creation_date": 1539697064, "post_id": 52824802, "comment_id": 92589663, "body": "Thanks, that was my initial idea to switch the drivers because I know that the mgo driver is not maintained anymore. However, I wanted to better understand the root cause of a problem. One idea I had is that because mgo driver connects to the replica set directly and holds connection to primary, it failed when primary failed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "edited": false, "score": 0, "creation_date": 1539698535, "post_id": 52824802, "comment_id": 92590633, "body": "@RuslanN There are even more fixes in <code>globalsign&#47;mgo</code> related to connectivity, the one I quoted seems to be the issue / directly related to your problem. Does switching to <code>globalsign&#47;mgo</code> fixes your problem?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1539640471, "last_edit_date": 1539640471, "creation_date": 1539637820, "answer_id": 52824802, "question_id": 52726305, "link": "https://stackoverflow.com/questions/52726305/mongodb-connection-fails-on-multiple-app-servers/52824802#52824802", "title": "MongoDB connection fails on multiple app servers", "body": "<p>First, the <code>mgo</code> driver you are using: <code>gopkg.in/mgo.v2</code> developed by Gustavo Niemeyer (hosted at <a href=\"https://github.com/go-mgo/mgo\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo</a>) is not maintained anymore.</p>\n\n<p>Instead use the community supported fork <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\"><code>github.com/globalsign/mgo</code></a>. This one continues to get patched and evolve.</p>\n\n<p>Its changelog includes: <em>\"Improved connection handling\"</em> which seems to be directly relating to your issue.</p>\n\n<p>Its details can be read here <a href=\"https://github.com/globalsign/mgo/pull/5\" rel=\"nofollow noreferrer\">https://github.com/globalsign/mgo/pull/5</a> which points to the original pull request <a href=\"https://github.com/go-mgo/mgo/pull/437\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo/pull/437</a>:</p>\n\n<blockquote>\n  <p>If mongoServer fail to dial server, it will close all sockets that are alive, whether they're currently use or not.\n  There are two cons:</p>\n  \n  <ul>\n  <li><p>Inflight requests will be interrupt rudely.</p></li>\n  <li><p>All sockets closed at the same time, and likely to dial server at the same time. Any occasional fail in the massive dial requests (high concurrency scenario) will make all sockets closed again, and repeat...(It happened in our production environment)</p></li>\n  </ul>\n  \n  <p>So I think sockets currently in use should closed after idle.</p>\n</blockquote>\n\n<p>Note that the <code>github.com/globalsign/mgo</code> has backward compatible API, it basically just added a few new things / features (besides the fixes and patches), which means you should be able to just change the import paths and all should be working without further changes.</p>\n"}], "owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1539640471, "creation_date": 1539105701, "last_edit_date": 1539636445, "question_id": 52726305, "link": "https://stackoverflow.com/questions/52726305/mongodb-connection-fails-on-multiple-app-servers", "title": "MongoDB connection fails on multiple app servers", "body": "<p>We have mongodb with mgo driver for golang. There are two app servers connecting to mongodb running besides apps (golang binaries). Mongodb runs as a replica set and each server connects two primary or secondary depending on replica's current state. </p>\n\n<p>We have experienced the <code>SocketException handling request, closing client connection: 9001 socket exception</code> on one of the mongo servers( which resulted in the connection to mongodb from our apps to die. After that, replica set continued to be functional but our second server (on which the error didn't happen) the connection died as well. </p>\n\n<p>In the golang logs it was manifested as:</p>\n\n<p><code>read tcp 10.10.0.5:37698-\\u003e10.10.0.7:27017: i/o timeout\n</code></p>\n\n<p>Why did this happen? How can this be prevented?</p>\n\n<p>As I understand, <code>mgo</code> connects to the whole replica by the url (it detects whole topology by the single instance's url) but why did dy\u00b7ing of the connection on one of the servers killed it on second one? </p>\n\n<p>Edit:</p>\n\n<ol>\n<li>Full package path that is used <code>\"gopkg.in/mgo.v2\"</code></li>\n<li>Unfortunately can't share mongo files here. But besides the socketexecption mongo logs don't contain anything useful. There is indication of some degree of lock contention where lock acquired time is quite high some times but nothing beyond that </li>\n<li>MongoDB does some heavy indexing some times but the wasn't any unusual spikes recently so it's nothing beyond normal </li>\n</ol>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "edited": false, "score": 0, "creation_date": 1539104876, "post_id": 52725631, "comment_id": 92377348, "body": "but how about if it has more <code>(?:(\\\\w+)\u263e(\\\\w+)\u263d)</code>... then i need to add more pairs... I hope to have a solution that match <b>0 to N</b> pairs"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "edited": false, "score": 0, "creation_date": 1539105335, "post_id": 52725631, "comment_id": 92377586, "body": "sure, still I&#39;m digging into it to be more valid solution for this."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "edited": false, "score": 1, "creation_date": 1539173949, "post_id": 52725631, "comment_id": 92404742, "body": "I tried more but can&#39;t get success, you please go through this <a href=\"https://www.regular-expressions.info/captureall.html\" rel=\"nofollow noreferrer\">link,</a> may be you could find something."}], "tags": [], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "is_accepted": false, "score": 1, "last_activity_date": 1539103396, "last_edit_date": 1539103396, "creation_date": 1539103068, "answer_id": 52725631, "question_id": 52725176, "link": "https://stackoverflow.com/questions/52725176/golang-complex-regex-with-findallstringsubmatch/52725631#52725631", "title": "Golang complex regex with FindAllStringSubmatch", "body": "<p>You have set your <code>regex</code> like <code>\u26e6(\\\\w+)\u26ef(?:(\\\\w+)\u263e(\\\\w+)\u263d)*</code> which prints only two level of <code>key</code> and <code>value</code>, like it prints as per your <code>regex</code>:</p>\n\n<pre><code>[[\"\u26e6superman\u26efshirt\u263eblue\u263d\" \"superman\" \"shirt\" \"blue\"]\n[\"\u26e6joker\u26ef\" \"joker\" \"\" \"\"]\n[\"\u26e6spiderman\u26efage\u263e15yo\u263dgirl\u263eCindy\u263d\" \"spiderman\" \"girl\" \"Cindy\"]]\n</code></pre>\n\n<p>I increase the regex one more <code>key</code> and <code>value</code> pairs and it prints the <code>age</code> value as well, follow the below code for <code>regex</code>:</p>\n\n<pre><code>re := regexp.MustCompile(\"\u26e6(\\\\w+)\u26ef(?:(\\\\w+)\u263e(\\\\w+)\u263d)*(?:(\\\\w+)\u263e(\\\\w+)\u263d)*\")\n    fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"\u26e6superman\u26efshirt\u263eblue\u263d\u26e6joker\u26ef\u26e6spiderman\u26efage\u263e15yo\u263dgirl\u263eCindy\u263d\", -1))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1539112504, "post_id": 52727500, "comment_id": 92380959, "body": "Brilliant. I can&#39;t believe I&#39;ve never thought of doing regex in two phases like this. TIL."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1539110786, "creation_date": 1539110786, "answer_id": 52727500, "question_id": 52725176, "link": "https://stackoverflow.com/questions/52725176/golang-complex-regex-with-findallstringsubmatch/52727500#52727500", "title": "Golang complex regex with FindAllStringSubmatch", "body": "<p>You cannot capture arbitrary number of substrings with a single capturing group. You need to match the whole record first, and then match the subparts of it with another regex.</p>\n\n<p>See an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    str := \"\u26e6superman\u26efshirt\u263eblue\u263d\u26e6joker\u26ef\u26e6spiderman\u26efage\u263e15yo\u263dgirlFriend\u263eCindy\u263d\"\n\n    re_main := regexp.MustCompile(`\u26e6(\\w+)\u26ef((?:\\w+\u263e\\w+\u263d)*)`)\n    re_aux := regexp.MustCompile(`(\\w+)\u263e(\\w+)\u263d`)\n    for _, match := range re_main.FindAllStringSubmatch(str, -1) {\n        fmt.Printf(\"%v\\n\", match[1])\n        for _, match_aux := range re_aux.FindAllStringSubmatch(match[2], -1) {      \n            fmt.Printf(\"%v: %v\\n\", match_aux[1], match_aux[2])\n        }\n        fmt.Println(\"--END OF MATCH--\") \n    }  \n}\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/1zaUSPujhAg\" rel=\"nofollow noreferrer\">Go demo</a></p>\n\n<p>Output:</p>\n\n<pre><code>superman\nshirt: blue\n--END OF MATCH--\njoker\n--END OF MATCH--\nspiderman\nage: 15yo\ngirlFriend: Cindy\n--END OF MATCH--\n</code></pre>\n\n<p>Here, <code>\u26e6(\\w+)\u26ef((?:\\w+\u263e\\w+\u263d)*)</code> is the main regex that matches and captures into Group 1 the main \"key\" and the string of the other key-values is captured into Group 2. Then, you need to iterate over the found matches, and collect all key-values from the Group 2 using <code>(\\w+)\u263e(\\w+)\u263d</code>.</p>\n"}], "owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 52727500, "answer_count": 2, "score": 1, "last_activity_date": 1539110786, "creation_date": 1539101222, "question_id": 52725176, "link": "https://stackoverflow.com/questions/52725176/golang-complex-regex-with-findallstringsubmatch", "title": "Golang complex regex with FindAllStringSubmatch", "body": "<p>I have a <em>superheroes</em> string, <strong>all</strong> of them have <em>name</em>s, but <strong>not all</strong> of them have attributes.</p>\n\n<p>It has a format of <code>\u26e6name\u26efattrName\u263eattrData\u263d</code>, where the <code>attrName\u263eattrData\u263d</code> is optional.</p>\n\n<p>So, the <em>superheroes</em> string is:</p>\n\n<p><code>\u26e6superman\u26efshirt\u263eblue\u263d\u26e6joker\u26ef\u26e6spiderman\u26efage\u263e15yo\u263dgirlFriend\u263eCindy\u263d</code></p>\n\n<p>I want to use Regex to extract the string, and populates the result into a <em>slice of map</em>, as such:</p>\n\n<pre><code>[ {name: superman, shirt: blue},\n  {name: joker},\n  {name: spiderman, age: 15yo, girlFriend: Cindy} ]\n</code></pre>\n\n<p>I can't get it done in Go playground. I use the regex <code>\u26e6(\\\\w+)\u26ef(?:(\\\\w+)\u263e(\\\\w+)\u263d)*</code>, but it only can capture single attribute, i.e. regex unable to capture the <code>age</code> attributes.</p>\n\n<p>My code is:</p>\n\n<pre><code>func main() {\n    re := regexp.MustCompile(\"\u26e6(\\\\w+)\u26ef(?:(\\\\w+)\u263e(\\\\w+)\u263d)*\")\n    fmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"\u26e6superman\u26efshirt\u263eblue\u263d\u26e6joker\u26ef\u26e6spiderman\u26efage\u263e15yo\u263dgirlFriend\u263eCindy\u263d\", -1))\n}\n</code></pre>\n\n<p>The Go Playground code is at here: <a href=\"https://play.golang.org/p/Epv66LVwuRK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Epv66LVwuRK</a></p>\n\n<p>The run result is:</p>\n\n<pre><code>[\n    [\"\u26e6superman\u26efshirt\u263eblue\u263d\" \"superman\" \"shirt\" \"blue\"]\n    [\"\u26e6joker\u26ef\" \"joker\" \"\" \"\"]\n    [\"\u26e6spiderman\u26efage\u263e15yo\u263dgirlFriend\u263eCindy\u263d\" \"spiderman\" \"girlFriend\" \"Cindy\"]\n]\n</code></pre>\n\n<p>The <code>age</code> is missing, any idea?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 0, "creation_date": 1539103272, "post_id": 52724781, "comment_id": 92376606, "body": "This may help <a href=\"https://stackoverflow.com/questions/50704319/xxx-type-in-generated-pb-go-file\" title=\"xxx type in generated pb go file\">stackoverflow.com/questions/50704319/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 7060199, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/51b4e0f1117b2ae94e68239aaad68097?s=128&d=identicon&r=PG&f=1", "display_name": "Nagaraj M", "link": "https://stackoverflow.com/users/7060199/nagaraj-m"}, "edited": false, "score": 0, "creation_date": 1539135112, "post_id": 52725697, "comment_id": 92387831, "body": "i remove the &quot;(gogoproto.nullable) = false&quot; still same, its generating BondedValidators     []github_com_gallactic_gallactic_core_validator.Validator"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1589529132, "post_id": 52725697, "comment_id": 109335764, "body": "In this <a href=\"https://github.com/gogo/protobuf/issues/421#issuecomment-402633940\" rel=\"nofollow noreferrer\">conversation</a> you can find the reason why <code>gogoproto.nullable</code> option don&#39;t work in <code>proto3</code> syntax."}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": false, "score": 1, "last_activity_date": 1539103304, "creation_date": 1539103304, "answer_id": 52725697, "question_id": 52724781, "link": "https://stackoverflow.com/questions/52724781/create-array-pointer-in-protobuf-using-go-lang/52725697#52725697", "title": "Create array pointer in protobuf using go lang", "body": "<p>gogo proto will remove the pointers when you use the <code>nullable=false</code> option, so you'll need to remove the <code>(gogoproto.nullable) = false</code> options from the proto definition to have it generate []*foo</p>\n"}], "owner": {"reputation": 147, "user_id": 7060199, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/51b4e0f1117b2ae94e68239aaad68097?s=128&d=identicon&r=PG&f=1", "display_name": "Nagaraj M", "link": "https://stackoverflow.com/users/7060199/nagaraj-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1570, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1539103304, "creation_date": 1539099739, "question_id": 52724781, "link": "https://stackoverflow.com/questions/52724781/create-array-pointer-in-protobuf-using-go-lang", "title": "Create array pointer in protobuf using go lang", "body": "<p>I am new to grpc, I have created proto file with service called Accounts,have method name GetValidators,I want to create silce pointer []* to BondedValidators and UnbondingValidators variable inside the message which is using (gogoproto.customtype).</p>\n\n<pre><code>syntax = 'proto3';\npackage grpc;\n\nimport \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\nimport \"google/api/annotations.proto\";\nimport \"google/protobuf/struct.proto\";\n\noption (gogoproto.marshaler_all) = false;\noption (gogoproto.unmarshaler_all) = false;\noption (gogoproto.sizer_all) = false;\noption (gogoproto.goproto_registration) = true;\noption (gogoproto.messagename_all) = true;\noption (gogoproto.protosizer_all) =false;\n\nservice Accounts {\nrpc GetValidators(Empty) returns (ValidatorOutput);\n}\n\nmessage ValidatorOutput {\nuint64 BlockHeight  = 1 ;       \nrepeated google.protobuf.ListValue  BondedValidators  = 2   [(gogoproto.customtype) = \"github.com/gallactic/gallactic/core/validator.Validator\", (gogoproto.nullable) = false];\nrepeated google.protobuf.ListValue  UnbondingValidators  = 3 [(gogoproto.customtype) = \"github.com/gallactic/gallactic/core/validator.Validator\", (gogoproto.nullable) = false];\n}\n</code></pre>\n\n<p>whenever below code is used  :</p>\n\n<pre><code>protoc -I/usr/local/include -I. -I$GOPATH/src-I$GOPATH/src/github.com/grpcecosystem/grpc-gateway/third_party/googleapis --gofast_out=plugins=grpc:./ ./protobuf/account.proto\n</code></pre>\n\n<p>Its generate output in .pb.go file, with three extra variable</p>\n\n<pre><code>type ValidatorOutput struct {\nBlockHeight          uint64                        `protobuf:\"varint,1,opt,name=BlockHeight,proto3\" json:\"BlockHeight,omitempty\"`\nBondedValidators     []github_com_gallactic_gallactic_core_validator.Validator `protobuf:\"bytes,2,rep,name=BondedValidators,customtype=github.com/gallactic/gallactic/core/validator.Validator\" json:\"BondedValidators\"`\nUnbondingValidators  []github_com_gallactic_gallactic_core_validator.Validator `protobuf:\"bytes,3,rep,name=UnbondingValidators,customtype=github.com/gallactic/gallactic/core/validator.Validator\" json:\"UnbondingValidators\"`\nXXX_NoUnkeyedLiteral struct{}                                                   `json:\"-\"`\nXXX_unrecognized     []byte                                                     `json:\"-\"`\nXXX_sizecache        int32                                                      `json:\"-\"`\n }\n</code></pre>\n\n<p>output should be </p>\n\n<pre><code>type ValidatorOutput struct {\nBlockHeight          uint64                                                     `protobuf:\"varint,1,opt,name=BlockHeight,proto3\" json:\"BlockHeight,omitempty\"`\nBondedValidators     []*github_com_gallactic_gallactic_core_validator.Validator `protobuf:\"bytes,2,rep,name=BondedValidators,customtype=github.com/gallactic/gallactic/core/validator.Validator\" json:\"BondedValidators\"`\nUnbondingValidators  []*github_com_gallactic_gallactic_core_validator.Validator `protobuf:\"bytes,3,rep,name=UnbondingValidators,customtype=github.com/gallactic/gallactic/core/validator.Validator\" json:\"UnbondingValidators\"`\n}  \n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539095241, "post_id": 52723325, "comment_id": 92372151, "body": "Am I correct in assuming that you do not parse/encode the JSON? As in you do not have a <code>struct</code> representation of the data and also do not want to add one? Also, could you add your attempted solution to your question?"}], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "is_accepted": false, "score": 0, "last_activity_date": 1539095473, "creation_date": 1539095473, "answer_id": 52723490, "question_id": 52723325, "link": "https://stackoverflow.com/questions/52723325/how-to-rename-a-root-field-in-json-string-without-affecting-inner-fields-of-same/52723490#52723490", "title": "How to rename a root field in json string without affecting inner fields of same name using regexp in golang?", "body": "<p>I think it is better for you to write some programmatical modificator for the json object. For example, you could try to use <a href=\"https://github.com/qntfy/kazaam\" rel=\"nofollow noreferrer\">https://github.com/qntfy/kazaam</a> or any other json transformation library.</p>\n\n<p>You could also write some data structure with custom json marshaller which takes both \"id\" on unmarshalling step and produces \"uuid\" on marshalling step.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1539096227, "creation_date": 1539096227, "answer_id": 52723760, "question_id": 52723325, "link": "https://stackoverflow.com/questions/52723325/how-to-rename-a-root-field-in-json-string-without-affecting-inner-fields-of-same/52723760#52723760", "title": "How to rename a root field in json string without affecting inner fields of same name using regexp in golang?", "body": "<p>regex is the wrong tool for this task. You need to do actual (minimal) JSON parsing.  The easiest way to do this is probably with a simple <code>map[string]json.RawMessage</code>, so that only the keys are fully parsed.  Example:</p>\n\n<pre><code>var payload map[string]json.RawMessage\nif err := json.Unmarshal(input, &amp;payload); err != nil {\n    panic(err)\n}\npayload[\"uuid\"] = payload[\"id\"] // Copy from 'id' to 'uuid'\ndelete(payload, \"id\") // Delete the old 'id' key/value\noutput, err := json.Marshal(payload)\nif err != nil {\n    panic(err)\n}\n// output now has your desired content\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539154582, "post_id": 52724225, "comment_id": 92393398, "body": "This will work, but it&#39;s inefficient and overly verbose.  See my answer for essentially an optimized version of this approach."}], "tags": [], "owner": {"reputation": 60, "user_id": 6641436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/806aecadba95a889f8cc1f4552642c65?s=128&d=identicon&r=PG&f=1", "display_name": "nitin", "link": "https://stackoverflow.com/users/6641436/nitin"}, "is_accepted": false, "score": 0, "last_activity_date": 1539154605, "last_edit_date": 1539154605, "creation_date": 1539097741, "answer_id": 52724225, "question_id": 52723325, "link": "https://stackoverflow.com/questions/52723325/how-to-rename-a-root-field-in-json-string-without-affecting-inner-fields-of-same/52724225#52724225", "title": "How to rename a root field in json string without affecting inner fields of same name using regexp in golang?", "body": "<p>One thing of which you can take advantage over regex in golang is that when you don't have defined structure for your JSON to be parsed then you can parse that in an map of string and empty interface that is map[string]interface{}\nNow let's start with initially unmarshing your raw string into such map.\nNow you can delete the root element of the JSON which you want to change and replace it with another value and again marshal it to get the new string</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    str := `{\"id\":\"xxx\",\"person\":{\"id\":\"yyy\",\"name\":\"abc\"},\"box\":{\"id\":\"zzz\"}}`\n    mp := make(map[string]interface{})\n    if err := json.Unmarshal([]byte(str), &amp;mp); err != nil {\n    fmt.Println(\"some error occured\")\n    } else {\n        value := mp[\"id\"].(string)\n        delete(mp, \"id\")\n        mp[\"uuid\"] = value\n    }\n    finalAns , _ := json.Marshal(mp)\n    fmt.Println(string(finalAns))\n}\n</code></pre>\n\n<p>Output :\n{\"box\":{\"id\":\"zzz\"},\"person\":{\"id\":\"yyy\",\"name\":\"abc\"},\"uuid\":\"xxx\"}</p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "closed_date": 1539099155, "answer_count": 3, "score": -6, "last_activity_date": 1539154605, "creation_date": 1539094945, "question_id": 52723325, "link": "https://stackoverflow.com/questions/52723325/how-to-rename-a-root-field-in-json-string-without-affecting-inner-fields-of-same", "closed_reason": "Needs details or clarity", "title": "How to rename a root field in json string without affecting inner fields of same name using regexp in golang?", "body": "<p>I have a json raw string </p>\n\n<pre><code>{\"id\":\"xxx\",\"person\":{\"id\":\"yyy\",\"name\":\"abc\"},\"box\":{\"id\":\"zzz\"}}\n</code></pre>\n\n<p>I want to rename the field \"id\" in root to \"uuid\" without affecting the inner \"id\" fields.</p>\n\n<p>How can I do this?</p>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1539097649, "post_id": 52723047, "comment_id": 92373701, "body": "Could you, please, provide your request with headers (the cause of error)."}, {"owner": {"reputation": 233, "user_id": 8198255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397363516ab15fee72d9cee5fec024b9?s=128&d=identicon&r=PG&f=1", "display_name": "az rnd", "link": "https://stackoverflow.com/users/8198255/az-rnd"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1539149638, "post_id": 52723047, "comment_id": 92391225, "body": "var config = {headers:  {         &#39;kubernetes-api-key&#39;: &#39;eVBaXmU5XcbMhdorUMpUO6eQI1Jv8pDK&#39;,     }     };     $http.Post(&quot;<a href=\"http://localhost:8080/send\" rel=\"nofollow noreferrer\">localhost:8080/send</a>&quot;, config)     .then(function(response) {         console.log(response)     });"}, {"owner": {"reputation": 233, "user_id": 8198255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397363516ab15fee72d9cee5fec024b9?s=128&d=identicon&r=PG&f=1", "display_name": "az rnd", "link": "https://stackoverflow.com/users/8198255/az-rnd"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1539149695, "post_id": 52723047, "comment_id": 92391244, "body": "I have used custom header. I have added customer header in allowed headers. But not working."}], "answers": [{"tags": [], "owner": {"reputation": 769, "user_id": 2647655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qGHOi.png?s=128&g=1", "display_name": "kataras", "link": "https://stackoverflow.com/users/2647655/kataras"}, "is_accepted": false, "score": 2, "last_activity_date": 1576087154, "last_edit_date": 1576087154, "creation_date": 1540340312, "answer_id": 52959450, "question_id": 52723047, "link": "https://stackoverflow.com/questions/52723047/cors-issue-while-accessing-golang-iris-framework-rest-calls-in-frontend/52959450#52959450", "title": "Cors issue while accessing golang iris framework rest calls in frontend", "body": "<p>You have to allow the <code>OPTIONS</code> HTTP Method for your <code>Party/Group</code> or the whole app using the <code>.AllowMethods(iris.MethodOptions)</code> function. The <a href=\"https://github.com/kataras/iris/blob/master/_examples/experimental-handlers/cors/simple/main.go\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris/blob/master/_examples/experimental-handlers/cors/simple/main.go</a> example shows you the way already.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/iris-contrib/middleware/cors\"\n    \"github.com/kataras/iris/v12\"\n)\n\ntype User struct {\n    Name string\n}\n\nfunc main() {\n    app := iris.New()\n\n    crs := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"*\"},\n        AllowedMethods:   []string{\"GET\", \"POST\", \"DELETE\"},\n        AllowCredentials: true,\n    })\n    app.Use(crs)\n    //\n    app.AllowMethods(iris.MethodOptions) // &lt;- HERE\n    app.Post(\"/send\", func(ctx iris.Context) {\n        // deployment Object\n        name := User{}\n        ctx.ReadJSON(&amp;name)\n        fmt.Println(name)\n    })\n\n    app.Run(iris.Addr(\":8080\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 8198255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397363516ab15fee72d9cee5fec024b9?s=128&d=identicon&r=PG&f=1", "display_name": "az rnd", "link": "https://stackoverflow.com/users/8198255/az-rnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 930, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576087154, "creation_date": 1539093999, "question_id": 52723047, "link": "https://stackoverflow.com/questions/52723047/cors-issue-while-accessing-golang-iris-framework-rest-calls-in-frontend", "title": "Cors issue while accessing golang iris framework rest calls in frontend", "body": "<p>I am using golang iris framework for adding users through rest calls. This is my code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/iris-contrib/middleware/cors\"\n    \"github.com/kataras/iris\"\n)\n\ntype User struct {\n    Name string\n}\n\nfunc main() {\n    app := iris.New()\n\n    crs := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"*\"},\n        AllowedMethods:   []string{\"GET\", \"POST\", \"DELETE\"},\n        AllowCredentials: true,\n    })\n    app.Use(crs)\n    //\n    app.Post(\"/send\", func(ctx iris.Context) {\n        // deployment Object\n        name := User{}\n        ctx.ReadJSON(&amp;name)\n        fmt.Println(name)\n    })\n\n    app.Run(iris.Addr(\"localhost:8080\"))\n}\n</code></pre>\n\n<p>It is working fine. But I am getting cors error in front ajax calls. I have added cors options. But still I am getting the below error.</p>\n\n<pre><code>    Cross-Origin Request Blocked: The Same Origin Policy disallows reading the \nremote resource at http://localhost:8080/send. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing).  (unknown)\n</code></pre>\n\n<p>I couldn't find what is the error. Please anyone help to solve this issue.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539093021, "post_id": 52722555, "comment_id": 92370656, "body": "Where is your custom MarshalJSON method?"}, {"owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539094335, "post_id": 52722555, "comment_id": 92371543, "body": "It is     func (f *Flavor) MarshalJSON() ([]byte, error) { see the link in the code sample"}, {"owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539094447, "post_id": 52722555, "comment_id": 92371617, "body": "This guy seems to have encountered the same issue.  <a href=\"https://github.com/golang/go/issues/7536\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/7536</a> But  when adding a custom MarshalJSON I can only have either a pointer receiver or a value receiver but not both."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539094867, "post_id": 52722555, "comment_id": 92371896, "body": "Please put all relevant code directly in the question."}], "answers": [{"comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539094057, "post_id": 52722930, "comment_id": 92371382, "body": "I am still wondering, why <code>json.Marshal(&amp;d)</code> invokes the custom marshaller, while <code>json.Marshal(d)</code>  does not. Do you know why?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1539094389, "post_id": 52722930, "comment_id": 92371577, "body": "@Leon Because <code>&amp;d</code> is of type <code>*Flavor</code>. Please read <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_sets</a> and the linked details."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539094833, "post_id": 52722930, "comment_id": 92371872, "body": "I thought the same at first, but printing the type of <code>(&amp;d).Flavor</code> and  <code>d.Flavor</code> (either with <code>reflect</code> or <code>%T</code> with <code>Printf</code>) both yield <code>main.Flavor</code>, not <code>*main.Flavor</code>, which makes sense. Also, both <code>reflect.Type</code>s return <code>false</code> for <code>Implements(reflect.TypeOf(new(json.Marshaler)).Elem())</code> (As expected, <code>true</code> is returned for the <code>reflect.PtrTo</code> type). That is why it surprises me, that the second approach works."}, {"owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "edited": false, "score": 0, "creation_date": 1539095954, "post_id": 52722930, "comment_id": 92372629, "body": "and the language prevents me from just providing a handler for value and pointer.  This <b>wont</b> compile.. I have to pick      func (f *Flavor) MarshalJSON() ([]byte, error) {     \treturn []byte(strconv.Quote(f.String())), nil     }      func (f Flavor) MarshalJSON() ([]byte, error) {     \treturn []byte(strconv.Quote(f.String())), nil     }  So that means I have to aware when the member members implementation bleeds up to the containing struct level."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 2, "creation_date": 1539095968, "post_id": 52722930, "comment_id": 92372634, "body": "@Leon Ooops, sorry. &amp;d is of type *Desert, so forget the last comment. The reason probably is: Go lets you call pointer-receiver-methods on value-receivers if the value is addressable. If you call json.Marshal(d) you pass a copy of d to json.Marshal and this copy contains a copy of the Flavour. Such copies tend to be not addressable."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539096108, "post_id": 52722930, "comment_id": 92372712, "body": "@Leon If you call json.Marshal(&amp;d) then *d.Flavor is addressable and thus you can invoke the ponter-receivermethod on it. Why not define the MarshalJSON <i>only</i> on Flavor like here: <a href=\"https://play.golang.org/p/qJaes9Mfktt\" rel=\"nofollow noreferrer\">play.golang.org/p/qJaes9Mfktt</a>"}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539096171, "post_id": 52722930, "comment_id": 92372750, "body": "@Volker Ah okay, that makes sense."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1539096575, "post_id": 52722930, "comment_id": 92373003, "body": "@Volker Also, I am not the asker, but this behavior surprised me and I mainly wanted to understand why it works the way it does."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 5, "last_activity_date": 1539093748, "last_edit_date": 1539093748, "creation_date": 1539093654, "answer_id": 52722930, "question_id": 52722555, "link": "https://stackoverflow.com/questions/52722555/why-does-encoding-json-struct-members-not-invoking-custom-marshaljson/52722930#52722930", "title": "Why does encoding JSON struct members not invoking custom MarshalJSON?", "body": "<p>In your code <code>Flavor</code> does <strong>not</strong> have a method MarshalJSON as you defined the method for <code>*Flavor</code> only. </p>\n\n<p>If you want <code>type Flavor</code> to have the MarshalJSON method you must define it on <code>Flavor</code> not <code>*Flavor</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "is_accepted": false, "score": -1, "last_activity_date": 1539096740, "creation_date": 1539096740, "answer_id": 52723934, "question_id": 52722555, "link": "https://stackoverflow.com/questions/52722555/why-does-encoding-json-struct-members-not-invoking-custom-marshaljson/52723934#52723934", "title": "Why does encoding JSON struct members not invoking custom MarshalJSON?", "body": "<p>oh huh.  I think you had it Volker and Leon. I had assumed that I needed a pointer receiver for MarshalJSON since UnmarshalJSON definitely needs a pointer receiver.  But </p>\n\n<pre><code>func (f Flavor) MarshalJSON() ([]byte, error) {\n...\nfunc (f *Flavor) UnmarshalJSON(b []byte) error {\n...\n</code></pre>\n\n<p>and mixing the receivers causes the expected output for both json.Marshal(d) <strong>and</strong> json.Marshal(&amp;d)</p>\n"}], "owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 52722930, "answer_count": 2, "score": -1, "last_activity_date": 1539097924, "creation_date": 1539092498, "last_edit_date": 1539097924, "question_id": 52722555, "link": "https://stackoverflow.com/questions/52722555/why-does-encoding-json-struct-members-not-invoking-custom-marshaljson", "title": "Why does encoding JSON struct members not invoking custom MarshalJSON?", "body": "<p>In Golang, I have a struct whose member is a custom int type with constant values.  Basically, the custom type is a logical enum. </p>\n\n<pre><code>type Flavor int\n\nconst (\n    Vanilla Flavor = iota\n    Chocolate\n    Strawberry\n)\n\nfunc (f *Flavor) MarshalJSON() ([]byte, error) {\n    return []byte(strconv.Quote(f.String())), nil\n}\n</code></pre>\n\n<p>The custom type has defined MarshalJSON and UnmarshalJSON functions so when I serialize the custom type to JSON, I expect to get the <strong>string</strong> of the value in the serialized output, not the int value. </p>\n\n<p>My issue is that if I have a pointer to a containing type, then the containing type marshals using the custom function but if try to marshal with just a struct value, the custom MarshalJSON is not invoked by the JSON package</p>\n\n<pre><code>type Dessert struct {\n    Flavor Flavor `json:\"flavor\"`\n    Count  int\n}\n....\n    d := Dessert{Strawberry, 13}\n\n    b, err = json.Marshal(d) // !! does not invoke members Marshal !!\n    b, err = json.Marshal(&amp;d) // works as expected\n....\n</code></pre>\n\n<p>produces </p>\n\n<pre><code>{\"flavor\":2,\"Count\":13}\n{\"flavor\":\"Strawberry\",\"Count\":13}\n</code></pre>\n\n<p>I expected the second output in both case.<br>\nWhy does passing a struct value not invoke MarshalJSON on the member but it does encode otherwise correct JSON? </p>\n\n<p>see  <a href=\"https://play.golang.org/p/mOl1GHhgynf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mOl1GHhgynf</a>\nfor full working code</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1539092497, "post_id": 52722197, "comment_id": 92370297, "body": "Headers are not part of the Body. They are already &quot;pre-read&quot; and parsed into <code>http.Repsonse.Header</code>."}, {"owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1539092641, "post_id": 52722197, "comment_id": 92370389, "body": "@mkopriva: It is not headers, the content shown here is from the body of the response. You can test it via postman"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1539092769, "post_id": 52722197, "comment_id": 92370478, "body": "@Arun the response is a reflection of the request headers you sent the URL. Your browser sends different headers than the Go http client."}, {"owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1539093172, "post_id": 52722197, "comment_id": 92370761, "body": "@Not_a_Golfer: I have understood the situation. I have set the headers same as the browser, and I got the results."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1539109908, "post_id": 52722197, "comment_id": 92379774, "body": "@Arun my bad, I misread your question."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1539119369, "post_id": 52722197, "comment_id": 92383866, "body": "@Arun you clearly missed something. I set the Accept header and got back a valid response. Use some sniffer to see what&#39;s really going on."}], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1539092102, "post_id": 52722399, "comment_id": 92370023, "body": "Running the code locally, the response doen&#39;t contain the Accept value."}, {"owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "edited": false, "score": 0, "creation_date": 1539092447, "post_id": 52722399, "comment_id": 92370272, "body": "@saddam: I have printed that but it does not contain Accept. It shows <code>{Header:{Accept: Close:close} URL:https:&#47;&#47;httpbin.org&#47;get}</code>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "edited": false, "score": 2, "creation_date": 1539092716, "post_id": 52722399, "comment_id": 92370439, "body": "@Arun the response you got from httpbin doesn&#39;t contain Accept because you did not send an Accept header. Send one and you&#39;ll get one back."}], "tags": [], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "is_accepted": false, "score": 1, "last_activity_date": 1539097852, "last_edit_date": 1539097852, "creation_date": 1539092055, "answer_id": 52722399, "question_id": 52722197, "link": "https://stackoverflow.com/questions/52722197/parsing-rest-api-response/52722399#52722399", "title": "Parsing REST API Response", "body": "<p>Your code is doing well but here I think your <code>Accept</code> key does not return from API  that's why it's not showing the <code>Accept</code> value. To check the <code>key</code>, <code>value</code> pair of your struct, use the below <code>print</code> method.</p>\n\n<pre><code>fmt.Printf(\"%+v\\n\", responseStruct)\n</code></pre>\n\n<p>To overcome from this situation you need to send <code>Accept</code> with request into <code>header</code> before request the <a href=\"https://httpbin.org/get\" rel=\"nofollow noreferrer\">API</a> like:</p>\n\n<pre><code>req.Header.Set(\"Accept\", \"value\")\nresponse, err := hc.Do(req)\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>Then you will get the <code>Accept</code> value in <code>decoded</code> struct as :</p>\n\n<pre><code>{Header:{Accept:value Close:close} URL:https://httpbin.org/get}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "edited": false, "score": 0, "creation_date": 1539141394, "post_id": 52724853, "comment_id": 92389172, "body": "I think the apiResponse unexported is not a problem because I am calling it from the same file. Thanks for providing link to <code>json-to-go</code> tool."}, {"owner": {"reputation": 1, "user_id": 10098588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f6c381fd29c5a87ce971d8fd3c4d2fb?s=128&d=identicon&r=PG&f=1", "display_name": "James Tunnicliffe", "link": "https://stackoverflow.com/users/10098588/james-tunnicliffe"}, "reply_to_user": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "edited": false, "score": 1, "creation_date": 1539244501, "post_id": 52724853, "comment_id": 92433226, "body": "Correct - it is the members that need to be exported for the JSON package to pick them up. <a href=\"https://play.golang.org/p/P2QRiaE6Gfg\" rel=\"nofollow noreferrer\">play.golang.org/p/P2QRiaE6Gfg</a> shows your code works fine as long as the API returns the headers you expect."}], "tags": [], "owner": {"reputation": 1, "user_id": 10098588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f6c381fd29c5a87ce971d8fd3c4d2fb?s=128&d=identicon&r=PG&f=1", "display_name": "James Tunnicliffe", "link": "https://stackoverflow.com/users/10098588/james-tunnicliffe"}, "is_accepted": false, "score": 0, "last_activity_date": 1539100046, "creation_date": 1539100046, "answer_id": 52724853, "question_id": 52722197, "link": "https://stackoverflow.com/questions/52722197/parsing-rest-api-response/52724853#52724853", "title": "Parsing REST API Response", "body": "<p>apiResponse is unexported - you need to change it to something like APIResponse. You may find that pasting the JSON you want to decode into <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> will make all the code you need!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type AutoGenerated struct {\n    Args struct {\n    } `json:\"args\"`\n    Headers struct {\n        Accept                  string `json:\"Accept\"`\n        AcceptEncoding          string `json:\"Accept-Encoding\"`\n        AcceptLanguage          string `json:\"Accept-Language\"`\n        Connection              string `json:\"Connection\"`\n        Dnt                     string `json:\"Dnt\"`\n        Host                    string `json:\"Host\"`\n        UpgradeInsecureRequests string `json:\"Upgrade-Insecure-Requests\"`\n        UserAgent               string `json:\"User-Agent\"`\n    } `json:\"headers\"`\n    Origin string `json:\"origin\"`\n    URL    string `json:\"url\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1539100046, "creation_date": 1539091503, "last_edit_date": 1539093075, "question_id": 52722197, "link": "https://stackoverflow.com/questions/52722197/parsing-rest-api-response", "title": "Parsing REST API Response", "body": "<p>I am new to golang. I was writing a program to parse the json response of the API: <a href=\"https://httpbin.org/get\" rel=\"nofollow noreferrer\">https://httpbin.org/get</a>. I have used the following code to parse the response:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\ntype Headers struct {\n    Close  string `json:\"Connection\"`\n    Accept string `json:\"Accept\"`\n}\n\ntype apiResponse struct {\n    Header Headers `json:\"headers\"`\n    URL    string  `json:\"url\"`\n}\n\nfunc main() {\n    apiRoot := \"https://httpbin.org/get\"\n    req, err := http.NewRequest(\"GET\", apiRoot, nil)\n    if err != nil {\n        fmt.Println(\"Couldn't prepare request\")\n        os.Exit(1)\n    }\n    response, err := http.DefaultClient.Do(req)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    defer response.Body.Close()\n    var responseStruct apiResponse\n    err = json.NewDecoder(response.Body).Decode(&amp;responseStruct)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    fmt.Printf(\"%v\\n\", responseStruct)\n}\n</code></pre>\n\n<p>When I run this code the output is:</p>\n\n<pre><code>$ go run parse.go\n{{close } https://httpbin.org/get}\n</code></pre>\n\n<p>From the output, as we can see the \"Accept\" key in json response is not decoded. Why is it so? How can I parse that string from response body?</p>\n"}, {"tags": ["python", "authentication", "go", "smtp", "gmail"], "answers": [{"tags": [], "owner": {"reputation": 5, "user_id": 8912473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2612d433a0de3559deb7eacc946f0a34?s=128&d=identicon&r=PG&f=1", "display_name": "hamdy.aea", "link": "https://stackoverflow.com/users/8912473/hamdy-aea"}, "is_accepted": false, "score": 0, "last_activity_date": 1539108533, "creation_date": 1539108533, "answer_id": 52726995, "question_id": 52721545, "link": "https://stackoverflow.com/questions/52721545/gmail-smtp-authentication-always-fail/52726995#52726995", "title": "Gmail SMTP authentication always fail", "body": "<p>It\u2019s solved. My login was wrong.</p>\n"}], "owner": {"reputation": 5, "user_id": 8912473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2612d433a0de3559deb7eacc946f0a34?s=128&d=identicon&r=PG&f=1", "display_name": "hamdy.aea", "link": "https://stackoverflow.com/users/8912473/hamdy-aea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1531, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539108533, "creation_date": 1539089528, "last_edit_date": 1539093148, "question_id": 52721545, "link": "https://stackoverflow.com/questions/52721545/gmail-smtp-authentication-always-fail", "title": "Gmail SMTP authentication always fail", "body": "<p>I created this software in python 3 </p>\n\n<pre><code>import smtplib\nTO = 'anywhere@mail.com'\nSUBJECT = 'Text subject of the mail'\nTEXT = 'Text of the mail'\n\ngmail_sender = 'yourMail@gmail.com'\ngmail_passwd = 'password'\nserver = smtplib.SMTP('smtp.gmail.com', 587)\nserver.ehlo()\nserver.starttls()\nserver.login(gmail_sender, gmail_passwd)\nBODY = '\\r\\n'.join(['To: %s' % TO,\n                    'From: %s' % gmail_sender,\n                    'Subject: %s' % SUBJECT,\n                    '', TEXT])\ntry:\n    server.sendmail(gmail_sender, [TO], BODY)\n    print ('email sent')\nexcept:\n    print ('error sending mail')\nserver.quit()\n</code></pre>\n\n<p>The first day the software worked well but now I always have an authentification error from gmail :</p>\n\n<pre><code>   smtplib.SMTPAuthenticationError: (535, b'5.7.8 Username and Password not accepted. Learn more at\\n5.7.8  https://support.google.com/mail/?p=BadCredentials o81-v6sm9180362wmo.38 - gsmtp')\n</code></pre>\n\n<p>What I did already is :</p>\n\n<p>I desactivated the unlock captchar from this link :</p>\n\n<p><a href=\"https://accounts.google.com/DisplayUnlockCaptcha\" rel=\"nofollow noreferrer\">https://accounts.google.com/DisplayUnlockCaptcha</a> </p>\n\n<p>and I have enabled the less secure apps from this link:</p>\n\n<p><a href=\"https://www.google.com/settings/security/lesssecureapps\" rel=\"nofollow noreferrer\">https://www.google.com/settings/security/lesssecureapps</a></p>\n\n<p>But still the same, I can't send an e-mail anymore. It doesn't seems that there's a Python software problem because I wrote the same software in Go and I still receive the same error.</p>\n"}, {"tags": ["java", "go", "zcash"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1539090122, "post_id": 52721484, "comment_id": 92368583, "body": "not strictly correct as the amount/address/memo fields are in their own map in the Go version.  In practice though when you are converting all the rest of the code might be just fine"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 0, "last_activity_date": 1539098846, "creation_date": 1539098846, "answer_id": 52724515, "question_id": 52721484, "link": "https://stackoverflow.com/questions/52721484/how-to-convert-equivalent-go-code-to-java-code/52724515#52724515", "title": "How to convert equivalent GO code to Java code?", "body": "<pre><code>Params: []interface{}{\n            from, // first parameter is address to send from (where the ZEC comes from)\n            []interface{}{\n                map[string]interface{}{\n                    \"amount\":  msgval,\n                    \"address\": to,\n                    \"memo\":    hex.EncodeToString([]byte(msg)),\n                },\n            },\n</code></pre>\n\n<p>Reads roughly like this <em>pseudocode:</em></p>\n\n<pre><code>Params =&gt; Array&lt;Object&gt;(\n    $from,\n    Array&lt;Object&gt;(\n       Hash&lt;String, Object&gt;(\n           \"amount\" =&gt; msgval,\n           \"address\" =&gt; to,\n           \"memo\" =&gt; hex.EncodeToString(msg),\n       )\n    )\n)\n</code></pre>\n\n<p>So, whatever to put in <code>Params</code> is</p>\n\n<ol>\n<li>An array of objects (i.e. of any type), in which</li>\n<li>The 1st element is the \"from\" addres,</li>\n<li>The 2nd element is another array,</li>\n<li>In which the 1st element is a hash map of string to objects\n(of any type), which you've already created.</li>\n</ol>\n"}], "owner": {"reputation": 1997, "user_id": 4755440, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f3986f07d030aa72a6e8f01fbd4b5a61?s=128&d=identicon&r=PG&f=1", "display_name": "Paras", "link": "https://stackoverflow.com/users/4755440/paras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2395, "favorite_count": 0, "accepted_answer_id": 52724515, "answer_count": 1, "score": 0, "last_activity_date": 1539098846, "creation_date": 1539089331, "last_edit_date": 1539090089, "question_id": 52721484, "link": "https://stackoverflow.com/questions/52721484/how-to-convert-equivalent-go-code-to-java-code", "title": "How to convert equivalent GO code to Java code?", "body": "<p>I'm making an RPC call using a Java library, I'm taking refrence from a GO code which I need to convert to java. I fairly know nothing about the go syntax. Can anyone help me describe the following code :</p>\n\n<pre><code>Params: []interface{}{\n            from, // first parameter is address to send from (where the ZEC comes from)\n            []interface{}{\n                map[string]interface{}{\n                    \"amount\":  msgval,\n                    \"address\": to,\n                    \"memo\":    hex.EncodeToString([]byte(msg)),\n                },\n            },\n</code></pre>\n\n<p>Below is how, I'm trying the equivalent Java code :</p>\n\n<pre><code>Map&lt;String,Object&gt; params = new HashMap&lt;&gt;();\n      params.put( \"from\", fromAddress );\n      params.put( \"amount\", 1.0000 );\n      params.put( \"address\", toAddress );\n      params.put( \"memo\", hexMessage );\n</code></pre>\n\n<p>Below is the argument description :</p>\n\n<p>This is an Asynchronous RPC call. Send funds from an\naddress to multiple outputs. The address can be a\ntaddr or a zaddr. Amounts is a list containing key/value\npairs corresponding to the addresses and amount to pay.\nEach output address can be in taddr or zaddr format.\nWhen sending to a zaddr, you also have the option of\nof attaching a memo in hexadecimal format.</p>\n\n<p>Is this correct?</p>\n"}, {"tags": ["oop", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1539090408, "post_id": 52721311, "comment_id": 92368789, "body": "Your question does not make any sense. First note that the empty struct is treated special. Your question seems to be about other stuff than the empty struct. Second: No, you will have to deal with pointers in Go. Third: The language is called Go, not golang."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1539090970, "post_id": 52721311, "comment_id": 92369210, "body": "You should stick to &quot;putting stars everywhere&quot;. In Go named pointer types are, AFAICT, useless and you most likely won&#39;t need them, just ignore the fact that it&#39;s possible to define them. (Also this <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/5EIKbImHRqs\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/5EIKbImHRqs</a>)"}, {"owner": {"reputation": 9, "user_id": 8516034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f469c5e6c43ea71358f57171de7eca?s=128&d=identicon&r=PG&f=1", "display_name": "ppawelec", "link": "https://stackoverflow.com/users/8516034/ppawelec"}, "edited": false, "score": 0, "creation_date": 1539091065, "post_id": 52721311, "comment_id": 92369279, "body": "I added an attribute to avoid special cases. The question is about the * before struct in type definition. It defines a reference, but I don&#39;t know if I can use it in meaningful way."}, {"owner": {"reputation": 9, "user_id": 8516034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f469c5e6c43ea71358f57171de7eca?s=128&d=identicon&r=PG&f=1", "display_name": "ppawelec", "link": "https://stackoverflow.com/users/8516034/ppawelec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1539091233, "post_id": 52721311, "comment_id": 92369395, "body": "@mkopriva many thanks, that&#39;s exactly what I asked about."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1539092134, "post_id": 52721311, "comment_id": 92370052, "body": "No it does not define a &quot;reference&quot;. Do not thing about pointers as references: The y are not."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1539104688, "post_id": 52721311, "comment_id": 92377257, "body": "Use the following to create a value: <code>Object(&amp;struct{ X int }{X: 1})</code> .  Go programs use pointers.  You will have an easier time writing Go code if you don&#39;t fight that fact."}], "answers": [{"tags": [], "owner": {"reputation": 1174, "user_id": 4201661, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9GrGWDH8rOs/AAAAAAAAAAI/AAAAAAAAAEw/IwJ4rsVy0e0/photo.jpg?sz=128", "display_name": "Peter Stace", "link": "https://stackoverflow.com/users/4201661/peter-stace"}, "is_accepted": false, "score": 0, "last_activity_date": 1539123135, "creation_date": 1539123135, "answer_id": 52730045, "question_id": 52721311, "link": "https://stackoverflow.com/questions/52721311/defining-type-as-a-reference-in-golang/52730045#52730045", "title": "Defining type as a reference in golang", "body": "<p>If you don't want to pass pointers around everywhere, you don't have to. You could just pass your structs around by value.</p>\n\n<p>E.g.</p>\n\n<p>Define your struct as:</p>\n\n<pre><code>type Object struct{\n  X int\n}\n</code></pre>\n\n<p>And then define your functions as:</p>\n\n<pre><code>func DoStuffToObject(obj Object) {\n    // Do things with obj here\n}\n</code></pre>\n\n<p>There's nothing wrong with passing around objects by value if that's what you wish to do.</p>\n"}], "owner": {"reputation": 9, "user_id": 8516034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f469c5e6c43ea71358f57171de7eca?s=128&d=identicon&r=PG&f=1", "display_name": "ppawelec", "link": "https://stackoverflow.com/users/8516034/ppawelec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1539123135, "creation_date": 1539088771, "last_edit_date": 1539090828, "question_id": 52721311, "link": "https://stackoverflow.com/questions/52721311/defining-type-as-a-reference-in-golang", "title": "Defining type as a reference in golang", "body": "<p>To my surprise this block</p>\n\n<pre><code>type Object *struct{\n  X int\n}\n</code></pre>\n\n<p>compiles in golang. However, I don't know how to create an instance of the underlying struct.</p>\n\n<p>Functionally, what I wanted to achieve is to remove all the stars from all type signatures without hacks (redefining the type and other tricks). This would make the type/structs very much like Java classes.</p>\n\n<p>The question is - is this construction supported in golang? Or should I stick to putting stars everywhere?</p>\n"}, {"tags": ["go", "mutex", "channel", "goroutine"], "owner": {"reputation": 163, "user_id": 5713751, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4e61ab6ffa46be6b3f1929b1a4b09481?s=128&d=identicon&r=PG", "display_name": "alexander", "link": "https://stackoverflow.com/users/5713751/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1539086237, "creation_date": 1539085666, "last_edit_date": 1539086237, "question_id": 52720352, "link": "https://stackoverflow.com/questions/52720352/return-a-value-in-a-loop-before-continuing-a-loop-goroutines-mutex-or-channels", "title": "return a value in a loop before continuing a loop: goroutines, mutex or channels?", "body": "<p>My database structure contains the following fields: <code>catalog.id</code>, <code>catalog.category_id</code>, <code>catalog.name</code> and its related field, <code>category.name</code> and <code>category.id</code> .</p>\n\n<p>While importing csv records containing fields of <code>csv_category_name</code> and <code>csv_catalog_name</code>using golang, as the loop starts I want to check if <code>csv_category_name</code> exists in the field <code>category.name</code> and return its  value to be inserted in <code>catalog.category_id</code> otherwise, create a <code>category.name</code> and return <code>category.id</code> retain the value in the memory so it can be inserted into catalog.cateogory_id in the rest of the loop with a similar condition before the loop continues  </p>\n\n<p>i believe there could be an easier way but with my limited knowledge in golang,  I have drafted a code and i believe with your suggestion i can provide a better result</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n)\n\nfunc main() {\n    cname := models.Category{\n        CategoryName: c.Name, // this to be picked from loop\n    }\n    bb, err := models.CategoryByID(db, 4)\n    if err != nil {\n        cname.Save(db)\n        return cname\n    }\n\n    for {\n        var c CatalogCSV\n\n        //CheckorCreate when the loop starts and use the value in the rest of the loop\n\n        if err := dec.Decode(&amp;c); err == io.EOF {\n            break\n        } else if err != nil {\n            log.Fatal(err)\n        }\n\n        a := models.Catalog{\n            CatalogName:         c.Catalogname,\n            CatalogCategoryName: c.Categoryname, // This is part of the initial CSV file\n            CataloCategoryID:    b.ID,           // this is to be picked from CategoryByID\n        }\n\n        // save author to database\n        err = a.Save(db)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["azure", "go", "dep"], "answers": [{"tags": [], "owner": {"reputation": 260, "user_id": 3761716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iY3GQ.jpg?s=128&g=1", "display_name": "MarStr", "link": "https://stackoverflow.com/users/3761716/marstr"}, "is_accepted": false, "score": 1, "last_activity_date": 1541524541, "creation_date": 1541524541, "answer_id": 53176813, "question_id": 52720047, "link": "https://stackoverflow.com/questions/52720047/uppdating-azure-sdk-for-go-library-dependancies/53176813#53176813", "title": "Uppdating azure-sdk-for-go library dependancies", "body": "<p>Looks like your updating from a quite old version, since <code>github.com/Azure/azure-sdk-for-go/arm/compute</code> has been deprecated and removed almost a year ago while this SDK was still in preview.</p>\n\n<p>To move forward, you should update your compute path to <code>github.com/Azure/azure-sdk-for-go/services/compute/mgmt/2018-10-01/compute</code>. There will be several other breaking changes to adopt since then as well.</p>\n"}], "owner": {"reputation": 662, "user_id": 1887912, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cb3aa8025d2e06f2adac3f3a8a6388de?s=128&d=identicon&r=PG", "display_name": "JonB", "link": "https://stackoverflow.com/users/1887912/jonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541524541, "creation_date": 1539084719, "question_id": 52720047, "link": "https://stackoverflow.com/questions/52720047/uppdating-azure-sdk-for-go-library-dependancies", "title": "Uppdating azure-sdk-for-go library dependancies", "body": "<p>What is the best practice to carry out this task?</p>\n\n<p>What I tried so far, simply run command <code>dep ensure -update github.com/Azure/azure-sdk-for-go</code>\nthat threw the following error:</p>\n\n<pre><code>    Warning: the following project(s) have [[constraint]] stanzas in Gopkg.toml:\n\n  \u2717  github.com/gravitational/trace\n  .....\n</code></pre>\n\n<p><code>dep ensure</code> gives me similar error as <code>dep -update</code> command. <code>dep check</code> gives following output:</p>\n\n<pre><code># Gopkg.lock is out of sync:\ngithub.com/Azure/azure-sdk-for-go/arm/compute: imported or required, but missing from Gopkg.lock's input-imports\n.....\n</code></pre>\n\n<p>and</p>\n\n<pre><code># vendor is out of sync:\ncloud.google.com/go: no digest in Gopkg.lock to compare against hash of vendored tree\ngithub.com/Azure/azure-sdk-for-go: no digest in Gopkg.lock to compare against hash of vendored tree\n....\n</code></pre>\n\n<p>This is a rather large project. Should I manually remove all existing dependencies in the code to the old <code>import azure-sdk-for-go</code>? or should <code>deb</code> be able to carry out this task?\nIw'e tried various hacks to get this working, like for instance, manually modifying the <code>Gopk.lock</code> file, deleting the <code>azure-sdk-for-go</code> folder in the <code>vendor</code> folder, but so far I had no luck. Any help on this would be much appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "is_accepted": true, "score": 0, "last_activity_date": 1539154968, "creation_date": 1539154968, "answer_id": 52734464, "question_id": 52719604, "link": "https://stackoverflow.com/questions/52719604/defaulting-structs-used-as-destination-for-yaml-data-in-golang/52734464#52734464", "title": "Defaulting structs used as destination for yaml data in golang", "body": "<p>Ok, so the pattern I did not see was quite obviouse: The \"deepest leaf\" of a configuration overwrites everything below, either with the given data or with the go defaults for empty values:</p>\n\n<p>That means that a struct like this...</p>\n\n<pre><code>[key_string]:\n  input:\n    listener: [string]\n    static: [string]\n  output:\n    listener: [string]\n    details:\n      filter: [string]\n      retention: [string]\n</code></pre>\n\n<p>... defaulted with the data...</p>\n\n<pre><code>defaults:\n  input:\n    listener: 127.0.0.1:8910\n    static: default\n  output:\n    listener: 127.0.0.1:8989\n    details:\n      filter: '*foo*'\n      retention: 3h\n</code></pre>\n\n<p>... feeded with a yaml of this form..</p>\n\n<pre><code>empty:\n\nboth:\n  input:\n  output:\n\ninput: &amp;input\n  input:\n\ninput-modified-with-anchor:\n  &lt;&lt;: *input\n  input:\n    static: NOTDEFAULT\n\ninput-modified-without-anchor:\n  input:\n    static: NOTDEFAULT\n\noutput: &amp;output\n  output:\n\noutput-modified-with-anchor:\n  &lt;&lt;: *output\n  output:\n    details:\n      filter: NOTDEFAULT\n\noutput-modified-without-anchor:\n  output:\n    details:\n      filter: NOTDEFAULT\n</code></pre>\n\n<p>... turn out as...</p>\n\n<pre><code>both:\n  input:\n    listener: \"\"\n    static: \"\"\n  output:\n    listener: \"\"\n    details:\n      filter: \"\"\n      retention: \"\"\nempty:\n  input:\n    listener: \"\"\n    static: \"\"\n  output:\n    listener: \"\"\n    details:\n      filter: \"\"\n      retention: \"\"\ninput:\n  input:\n    listener: \"\"\n    static: \"\"\n  output:\n    listener: 127.0.0.1:8989\n    details:\n      filter: '*foo*'\n      retention: 3h\ninput-modified-with-anchor:\n  input:\n    listener: 127.0.0.1:8910\n    static: NOTDEFAULT\n  output:\n    listener: 127.0.0.1:8989\n    details:\n      filter: '*foo*'\n      retention: 3h\ninput-modified-without-anchor:\n  input:\n    listener: 127.0.0.1:8910\n    static: NOTDEFAULT\n  output:\n    listener: 127.0.0.1:8989\n    details:\n      filter: '*foo*'\n      retention: 3h\n</code></pre>\n\n<p>For my use case this is a too complicated behavior, I therefore try a different approach: I if demanded I inject a default config into the yaml and put a reference to its anchor in each section. I feel like this is more transparent and reproducible to the end user. Heres an ugly draft of the func:</p>\n\n<pre><code>func injectYAML(data []byte) ([]byte, error) {\n    // render a default section an add an anchor\n    key := \"injected_defaults\"\n    defaultData := Config{key: Defaults()}\n    var defaultSection []byte\n    defaultSection, _ = yaml.Marshal(defaultData)\n    defaultSection = bytes.Replace(defaultSection, []byte(key+\":\"), []byte(key+\": &amp;\"+key), 1)\n\n    // get list of sections in input data\n    c := Config{}\n    err := yaml.Unmarshal(data, &amp;c)\n    if err != nil {\n        return data, fmt.Errorf(\"Error while reading sections from yaml: %s\", err.Error())\n    }\n\n    // remove \"---\" at beginning when present\n    data = bytes.TrimLeft(data, \"---\")\n\n    // add reference to default section to each section\n    lines := bytes.Split(data, []byte(\"\\n\"))\n    var updatedLines [][]byte\n    for _, line := range lines {\n        updatedLines = append(updatedLines, line)\n        for section := range c {\n            if bytes.HasPrefix(line, []byte(section+\":\")) {\n                updatedLines = append(updatedLines, []byte(\"  &lt;&lt;: *\"+key))\n            }\n        }\n    }\n    updatedData := bytes.Join(updatedLines, []byte(\"\\n\"))\n\n    // compose injected yaml\n    out := []byte(\"---\\n\")\n    out = append(out, defaultSection...)\n    out = append(out, updatedData...)\n    return out, nil\n}\n</code></pre>\n\n<p>Full example at: <a href=\"https://github.com/unprofession-al/configuration/tree/7c2eb7da58b51f52b50f2a0fbac193c799c9eb08\" rel=\"nofollow noreferrer\">https://github.com/unprofession-al/configuration/tree/7c2eb7da58b51f52b50f2a0fbac193c799c9eb08</a></p>\n"}], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 52734464, "answer_count": 1, "score": 0, "last_activity_date": 1539154968, "creation_date": 1539083368, "last_edit_date": 1539083632, "question_id": 52719604, "link": "https://stackoverflow.com/questions/52719604/defaulting-structs-used-as-destination-for-yaml-data-in-golang", "title": "Defaulting structs used as destination for yaml data in golang", "body": "<p>I try to improve the user experience of a cli I maintain. A main goal is to provide reasonable defaults. It uses <code>yaml</code> extensively for configuration. </p>\n\n<p>A basic demo implementation of the configuration can be found here: <a href=\"https://github.com/unprofession-al/configuration/tree/bf5a89b3eee7338899b28c047f3795546ce3d2e6\" rel=\"nofollow noreferrer\">https://github.com/unprofession-al/configuration/tree/bf5a89b3eee7338899b28c047f3795546ce3d2e6</a></p>\n\n<p><strong>General</strong></p>\n\n<p>The main configuration looks like this:</p>\n\n<pre><code>type Config map[string]ConfigSection\n\ntype ConfigSection struct {\n    Input  InputConfig  `yaml:\"input\"`\n    Output OutputConfig `yaml:\"output\"`\n}\n</code></pre>\n\n<p><code>Config</code> holds a bunch of <code>ConfigSections</code>. This allow the user to define variations of the configuration (lets say <code>prod</code>, <code>dev</code> and <code>testing</code> for example) and use YAML Achors to do so.</p>\n\n<p>The parts of the <code>ConfigSection</code> (<code>Input</code> and <code>Output</code>) would be defined in the package that consumes the configuration. Each of this part provides a <code>Defaults()</code> and a custom <code>UnmarshalYAML()</code> func. Also <code>ConfigSection</code> itself provides an <code>UnmarshalYAML()</code> func. This idea is stolen from   <a href=\"https://github.com/go-yaml/yaml/issues/165#issuecomment-255223956\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml/issues/165#issuecomment-255223956</a>.</p>\n\n<p><strong>Question</strong></p>\n\n<p>In <code>data.go</code> in the repo some test input as well as the expected output is defined. Running the tests (<code>go test -v</code>) shows:</p>\n\n<ul>\n<li>Having nothing defined in the ConfigSection (<code>empty</code> example) no defaults are applied.</li>\n<li>If a part (of a <code>ConfigSection</code>) with no data field is defined, this part will have no defaults. The \"undefined\" part has defaults (see <code>input</code>, <code>output</code>).</li>\n<li>If both parts are defined (as is section <code>both</code>) but have no data fields, any defaults are set.</li>\n</ul>\n\n<p>I see no pattern at all and ran out of ideas why this works like this and how to get the expected results (eg. get the test to pass). </p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "is_accepted": false, "score": 5, "last_activity_date": 1539105235, "creation_date": 1539105235, "answer_id": 52726185, "question_id": 52719015, "link": "https://stackoverflow.com/questions/52719015/using-gin-gonic-and-some-scheduler-in-golang/52726185#52726185", "title": "Using Gin gonic and some scheduler in Golang", "body": "<p>I am doing something similar, where I cache some API results and refresh cache every few seconds. I do not use anything beyond the standard library though. Here is some sample code.</p>\n\n<pre><code>func UpdateCache() {\n    var lock sync.Mutex\n    timer1 := time.NewTicker(time.Second * 10) \n    defer timer1.Stop()\n    timer2 := time.NewTicker(time.Second * 5) \n    defer timer2.Stop()\n    for {\n        /* run forever */\n        select {\n        case &lt;-timer1.C:\n            go func() {\n                lock.Lock()\n                defer lock.Unlock()\n                /* do things I need done every 10 seconds */\n            }()\n        case &lt;-timer2.C:\n            go func() {\n                lock.Lock()\n                defer lock.Unlock()\n                /* do things I need done every 5 seconds */\n            }()\n        }\n    }\n}\n</code></pre>\n\n<p>And in the main() I have</p>\n\n<pre><code>go UpdateCache()\nrouter := gin.Default()\n/* setup all the routes */\nlisten := os.Getenv(\"SERVICE_ADDR\")\nrouter.Run(listen)\n</code></pre>\n\n<p>I think the problem you are running into is that you start running your routes in routes.Init() and it blocks and never gets to your cron setup.</p>\n"}, {"tags": [], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "is_accepted": true, "score": 5, "last_activity_date": 1539110185, "creation_date": 1539110185, "answer_id": 52727369, "question_id": 52719015, "link": "https://stackoverflow.com/questions/52719015/using-gin-gonic-and-some-scheduler-in-golang/52727369#52727369", "title": "Using Gin gonic and some scheduler in Golang", "body": "<p>You need to execute the gocron inside a goroutine, since the main goroutine will block (I guess <code>routes.Init()</code> starts an HTTP server too?)</p>\n\n<pre><code>func main() {\n    settings.AppSettings = settings.ReadSettings()\n\n    db.InitOracleDataBase()\n    OracleEnv, OracleSrv, OracleSes := db.GetOracleDB()\n    defer OracleEnv.Close()\n    defer OracleSrv.Close()\n    defer OracleSes.Close()\n\n    go func() {\n        gocron.Every(5).Seconds().Do(prOk)\n        &lt;-gocron.Start()\n    }()\n\n    routes.Init()\n}\n</code></pre>\n"}], "owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2083, "favorite_count": 0, "accepted_answer_id": 52727369, "answer_count": 2, "score": 2, "last_activity_date": 1539110185, "creation_date": 1539081497, "last_edit_date": 1539093881, "question_id": 52719015, "link": "https://stackoverflow.com/questions/52719015/using-gin-gonic-and-some-scheduler-in-golang", "title": "Using Gin gonic and some scheduler in Golang", "body": "<p>I have some REST service in <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin Gonic</a>, and I need to do some job every 5 seconds using some scheduler. I've tried <code>rakanalh</code> and <code>gocron</code> but it seems that every code written after initializing crons or gin routes will not execute.</p>\n\n<pre><code>func main() {\n    settings.AppSettings = settings.ReadSettings()\n\n    db.InitOracleDataBase()\n    OracleEnv, OracleSrv, OracleSes := db.GetOracleDB()\n    defer OracleEnv.Close()\n    defer OracleSrv.Close()\n    defer OracleSes.Close()\n\n    routes.Init()\n\n\n    gocron.Every(5).Seconds().Do(prOk)\n    &lt;-gocron.Start()\n\n\n}\n</code></pre>\n\n<p>prOk just prints OK, and it never will be executed, until I comment <code>routes.init()</code>.\nHow it's possible to run both cron and gin routes concurrently? </p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": true, "score": 1, "last_activity_date": 1539082517, "creation_date": 1539082517, "answer_id": 52719354, "question_id": 52718845, "link": "https://stackoverflow.com/questions/52718845/how-to-pass-vars-with-chan-between-functions/52719354#52719354", "title": "How to pass vars with chan between functions", "body": "<p>You should use a second channel for what you want to do. You could get away with using a single channel and switching on the result, but that's not really ideal - you're basically trying to put two different types of objects into the same channel, and your program will end up being a lot cleaner and easier to reason about if you just have one channel per data type / intended transformation. </p>\n"}], "owner": {"reputation": 942, "user_id": 7147393, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nonlb.jpg?s=128&g=1", "display_name": "Russiancold", "link": "https://stackoverflow.com/users/7147393/russiancold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 52719354, "answer_count": 1, "score": 1, "last_activity_date": 1539082517, "creation_date": 1539080997, "last_edit_date": 1539081336, "question_id": 52718845, "link": "https://stackoverflow.com/questions/52718845/how-to-pass-vars-with-chan-between-functions", "title": "How to pass vars with chan between functions", "body": "<p>I'm implementing a simple mechanism of passing variable between two goroutines with a channel. Here is my code:</p>\n\n<pre><code>pipe := make(chan string)\ngo func(out chan string, data string) { //1st goroutine\n        out &lt;- DataSignerMd5(data)\n    }(pipe, data)\ngo func(in chan string) {               //2nd goroutine\n        data := &lt;-in\n        in &lt;- DataSignerCrc32(data)\n    }(pipe)\ncrcMdData := &lt;- pipe\n</code></pre>\n\n<p>More likely, <code>crcMdData</code> pulls a variable from <code>pipe</code> before 2nd goroutine. I guess that I simply can create another channel to make this work. But maybe it's possible with a single <code>pipe</code>?</p>\n"}, {"tags": ["regex", "csv", "go", "concurrency"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1539091297, "post_id": 52718808, "comment_id": 92369434, "body": "Backtracking is a regex issue. I added a regex tag."}], "answers": [{"comments": [{"owner": {"reputation": 1930, "user_id": 1724692, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4323f2e0f98aabe064f6bdc049f1d4c3?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1724692/michael"}, "edited": false, "score": 0, "creation_date": 1539090775, "post_id": 52721587, "comment_id": 92369088, "body": "Thanks, this is a nice tip I was not aware of."}, {"owner": {"reputation": 1930, "user_id": 1724692, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4323f2e0f98aabe064f6bdc049f1d4c3?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1724692/michael"}, "edited": false, "score": 0, "creation_date": 1539091017, "post_id": 52721587, "comment_id": 92369244, "body": "This is much better <code>readLines took 31.606206481s</code> - Appart from this change, do you see anything else that can be improved in the program structure ? - The regrex pattern will be feeded dynamically"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 1930, "user_id": 1724692, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4323f2e0f98aabe064f6bdc049f1d4c3?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1724692/michael"}, "edited": false, "score": 0, "creation_date": 1539092062, "post_id": 52721587, "comment_id": 92369995, "body": "Do some more profiling and see what might be good to try next"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1539089674, "creation_date": 1539089674, "answer_id": 52721587, "question_id": 52718808, "link": "https://stackoverflow.com/questions/52718808/how-to-optimize-a-csv-loader-with-pprof/52721587#52721587", "title": "How to optimize a CSV loader with pprof?", "body": "<p>MatchString looks for any match on the string\nSo you can get rid of the anchors and the wildcarding\nThe wildcarding at both ends is usually slow in regexp engines</p>\n\n<p>example showing this on go 1.10</p>\n\n<pre><code>package reggie\n\nimport (\n        \"regexp\"\n        \"testing\"\n)\n\nvar pattern = regexp.MustCompile(`^.*foo.*$`)\nvar pattern2 = regexp.MustCompile(`foo`)\n\nfunc BenchmarkRegexp(b *testing.B) {\n        for i := 0; i &lt; b.N; i++ {\n                pattern.MatchString(\"youfathairyfoobar\")\n        }\n}\n\nfunc BenchmarkRegexp2(b *testing.B) {\n        for i := 0; i &lt; b.N; i++ {\n                pattern2.MatchString(\"youfathairyfoobar\")\n        }\n}\n$ go test -bench=.\ngoos: darwin\ngoarch: amd64\nBenchmarkRegexp-4        3000000           471 ns/op\nBenchmarkRegexp2-4      20000000           101 ns/op\nPASS\nok      _/Users/jsandrew/wip/src/reg    4.031s\n</code></pre>\n"}], "owner": {"reputation": 1930, "user_id": 1724692, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4323f2e0f98aabe064f6bdc049f1d4c3?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1724692/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1539091128, "creation_date": 1539080857, "last_edit_date": 1539091128, "question_id": 52718808, "link": "https://stackoverflow.com/questions/52718808/how-to-optimize-a-csv-loader-with-pprof", "title": "How to optimize a CSV loader with pprof?", "body": "<p>I am trying to optimize a CSV loading process that is basically doing a regex search in a large CSV file (+4GB - 31033993 records for my experiment)\nI managed to build a multiprocessing logic to read the CSV but when I analyze the CPU profiling using <code>pprof</code> I think my regex search is not optimized. Could you help me improve this code so that it can read the CSV much quickly?</p>\n\n<p><a href=\"https://i.stack.imgur.com/45PbQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/45PbQ.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my code so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"regexp\"\n    \"runtime\"\n    \"runtime/pprof\"\n    \"strings\"\n    \"sync\"\n)\n\nfunc processFile(path string) [][]string {\n    file, err := os.Open(path)\n    if err != nil {\n        log.Println(\"Error:\", err)\n    }\n    var pattern = regexp.MustCompile(`^.*foo.*$`)\n    numCPU := runtime.NumCPU()\n    jobs := make(chan string, numCPU+1)\n\n    fmt.Printf(\"Strategy: Parallel, %d Workers ...\\n\", numCPU)\n\n    results := make(chan []string)\n    wg := new(sync.WaitGroup)\n    for w := 1; w &lt;= numCPU; w++ {\n        wg.Add(1)\n        go parseRecord(jobs, results, wg, pattern)\n    }\n    go func() {\n        scanner := bufio.NewScanner(file)\n        for scanner.Scan() {\n            jobs &lt;- scanner.Text()\n        }\n        close(jobs)\n    }()\n\n    go func() {\n        wg.Wait()\n        close(results)\n    }()\n\n    lines := [][]string{}\n    for line := range results {\n        lines = append(lines, line)\n    }\n\n    return lines\n}\n\nfunc parseRecord(jobs &lt;-chan string, results chan&lt;- []string, wg *sync.WaitGroup, pattern *regexp.Regexp) {\n    defer wg.Done()\n    for j := range jobs {\n        if pattern.MatchString(j) {\n            x := strings.Split(string(j), \"\\n\")\n            results &lt;- x\n        }\n\n    }\n}\n\nfunc split(r rune) bool {\n    return r == ','\n}\n\nfunc main() {\n    f, err := os.Create(\"perf.data\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    pprof.StartCPUProfile(f)\n    defer pprof.StopCPUProfile()\n\n    pathFlag := flag.String(\"file\", \"\", `The CSV file to operate on.`)\n    flag.Parse()\n    lines := processFile(*pathFlag)\n    fmt.Println(\"loaded\", len(lines), \"records\")\n}\n</code></pre>\n\n<p>When I process the file without any regex constraint I am getting a reasonable computing time (I simply load the parsed string into the 2D array without any <code>pattern.MatchString()</code>)</p>\n\n<p><code>\nStrategy: Parallel, 8 Workers ...\nloaded 31033993 records\n2018/10/09 11:46:38 readLines took 30.611246035s\n</code></p>\n\n<p>Instead, when I run the above code with the Regex constraint I am getting this result:</p>\n\n<p><code>\nStrategy: Parallel, 8 Workers ...\nloaded 143090 records\n2018/10/09 12:04:32 readLines took 1m24.029830907s\n</code></p>\n"}, {"tags": ["loops", "go"], "comments": [{"owner": {"reputation": 1397, "user_id": 3975711, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/756de1bfefa4329d2d23dd5975c24306?s=128&d=identicon&r=PG&f=1", "display_name": "Sergii Vorobei", "link": "https://stackoverflow.com/users/3975711/sergii-vorobei"}, "edited": false, "score": 0, "creation_date": 1539079595, "post_id": 52718189, "comment_id": 92362144, "body": "You can use some ORM, e.g. GORM for automating this"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539079691, "post_id": 52718189, "comment_id": 92362213, "body": "Could you show us some code of what you have tried so far?"}, {"owner": {"reputation": 21, "user_id": 5840259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e647a0e4c7b2b7a90ad1b5eefcf7b9a?s=128&d=identicon&r=PG&f=1", "display_name": "Adel", "link": "https://stackoverflow.com/users/5840259/adel"}, "edited": false, "score": 0, "creation_date": 1539080125, "post_id": 52718189, "comment_id": 92362466, "body": "I managed to move the result rows into a struct for manipulating them. But, I got stuck finding method other than looping"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 1, "creation_date": 1539080869, "post_id": 52718189, "comment_id": 92362937, "body": "What&#39;s wrong about looping? One way or another, explicit or implicit, that is always going to be a loop with this schema."}], "owner": {"reputation": 21, "user_id": 5840259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e647a0e4c7b2b7a90ad1b5eefcf7b9a?s=128&d=identicon&r=PG&f=1", "display_name": "Adel", "link": "https://stackoverflow.com/users/5840259/adel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1539079664, "creation_date": 1539078968, "last_edit_date": 1539079664, "question_id": 52718189, "link": "https://stackoverflow.com/questions/52718189/moving-data-into-dimension-struct-from-database-query", "title": "Moving data into dimension struct from database query", "body": "<p>I have a Join table as follows:</p>\n\n<pre><code>ID | CategroyID | ItemID | sizeID\n 1 |          1 |      1 |      1\n 2 |          1 |      1 |      2\n</code></pre>\n\n<p>I want to convert into struct as follows </p>\n\n<pre><code>type Category struct {\n    categoryID int\n    items []int\n    Sizes []int\n}\n</code></pre>\n\n<p>What are possible ways other than <code>looping</code>?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 2, "last_activity_date": 1539080380, "creation_date": 1539080380, "answer_id": 52718664, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement/52718664#52718664", "title": "Is golang defer statement execute before or after return statement?", "body": "<p>In the <strong>first</strong> test, the value of the parameter <code>x</code> is evaluated when the line containing the <code>defer</code> runs. And it happens in line 1 when <code>x</code> is still 0. </p>\n\n<p>Note, that even though <code>fmt.Printf</code> will be called later, it's parameters are evaluated ahead of time.</p>\n\n<p>In the <strong>third</strong> test, the value of the parameter <code>x</code> is set to 7 before the <code>defer</code> statement runs. Again, this happens before the actual invocation of <code>fmt.Printf</code>. </p>\n\n<p>The <strong>second</strong> test is a little different. Variable <code>x</code> is within the scope of the anonymous function. It's value is evaluated when the function runs, which happens when the test function returns. By that time <code>x</code> is 9.</p>\n"}, {"tags": [], "owner": {"reputation": 396, "user_id": 4641689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d41b3f3cc75d119e8b0b5cbd79da65?s=128&d=identicon&r=PG&f=1", "display_name": "Tranvu Xuannhat", "link": "https://stackoverflow.com/users/4641689/tranvu-xuannhat"}, "is_accepted": false, "score": 3, "last_activity_date": 1539081483, "creation_date": 1539081483, "answer_id": 52719010, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement/52719010#52719010", "title": "Is golang defer statement execute before or after return statement?", "body": "<p>I will refer to <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Defer_statements</a> to explain your results.  </p>\n\n<p>Question 2: Defer executes after return.</p>\n\n<p>Question 1: From the docs </p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked.  </p>\n</blockquote>\n\n<ul>\n<li><p>Test 1: Defer invokes fmt.Println. fmt.Println evaluates the value of x, which is 0 (zero value). test1() return 9 in the main function.  </p></li>\n<li><p>Test 2: Defer invokes func() {}. fmt.Println only evaluates x when func() {} is executed (after return). Hence, x is evaluated to 9. test2() return 9 in the main function.</p></li>\n<li><p>Test 3: Defer invokes fmt.Println. fmt.Println evaluates the value of x, which is 7 (x is assigned to 7). test3() return 9 in the main function.  </p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 168, "user_id": 3270012, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w5xo5.png?s=128&g=1", "display_name": "rb16", "link": "https://stackoverflow.com/users/3270012/rb16"}, "is_accepted": false, "score": 0, "last_activity_date": 1539093546, "creation_date": 1539093546, "answer_id": 52722899, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement/52722899#52722899", "title": "Is golang defer statement execute before or after return statement?", "body": "<p>It's not before or after, it's all about if the defer statement is present in the stack or not. \nif it is (if the control reaches to the defer statement it saves stores statement into the stack), then after it will execute after the return statement.</p>\n\n<p>for example - </p>\n\n<pre><code>func testing() err {\n    x, err := doSomething();\n    if err != nil {\n       return;\n    }\n    defer fmt.Println(\"hello\")\n    return nil\n}\n</code></pre>\n\n<p>So if  <code>err != nil</code> this defer will never execute, because program returned before the control reaches to the defer statement.</p>\n\n<p>Now come to your Question (all will reach to the defer statement)\n1. case, the statement stored in the stack is <code>defer fmt.Printf(\"in defer: x = %d\\n\", x)</code> (with zero value of x)</p>\n\n<ol start=\"2\">\n<li>case - the statement stored in the stack is <strong>A function</strong> </li>\n</ol>\n\n<p><code>defer func() {\n        fmt.Printf(\"in defer: x = %d\\n\", x)\n    }()</code></p>\n\n<p>Which is dependent on x (Note in the stack the defer statement is a function, and the value of a function will be assigned at the time of function execution)</p>\n\n<ol start=\"3\">\n<li>Case - <code>defer fmt.Printf(\"in defer: x = %d\\n\", x)</code> with value 7 </li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1384, "user_id": 4296218, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xH28YeHMo9Q/AAAAAAAAAAI/AAAAAAAAABE/ad2T99eOL2s/photo.jpg?sz=128", "display_name": "James Shi", "link": "https://stackoverflow.com/users/4296218/james-shi"}, "is_accepted": true, "score": 11, "last_activity_date": 1541740106, "last_edit_date": 1541740106, "creation_date": 1541738249, "answer_id": 53219947, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement/53219947#53219947", "title": "Is golang defer statement execute before or after return statement?", "body": "<p>Thanks @dev.bmax @Tranvu Xuannhat @rb16. With your help, I found the key explanation from <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"noreferrer\">Defer_statements</a>.</p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked. </p>\n</blockquote>\n\n<p>We can break up <code>defer ...</code> into three parts.</p>\n\n<ol>\n<li>invoke defer, evaluating the value of function parameter.</li>\n<li>execute defer, pushing a function in to stack.</li>\n<li>execute functions in stack <strong>after return or panic</strong>.</li>\n</ol>\n\n<p>I made a new test4 to explain.</p>\n\n<pre><code>func test4() (x int) {\n    defer func(n int) {\n        fmt.Printf(\"in defer x as parameter: x = %d\\n\", n)\n        fmt.Printf(\"in defer x after return: x = %d\\n\", x)\n    }(x)\n\n    x = 7\n    return 9\n}\n</code></pre>\n\n<p>In test4, </p>\n\n<ol>\n<li>invoke defer, evaluating the value of <em>n</em>, <em>n = x = 0</em>, so x as parameter is 0.</li>\n<li>execute defer, pushing <code>func(n int)(0)</code> onto stack.</li>\n<li>execute <code>func(n int)(0)</code> after <code>return 9</code>, n in <code>fmt.Printf(\"in defer x as parameter: x = %d\\n\", n)</code> has been evaluated, x in <code>fmt.Printf(\"in defer x after return: x = %d\\n\", x)</code> will be evaluated now, x is 9\u3002</li>\n</ol>\n\n<p>So, got the result:</p>\n\n<pre><code>test4\nin defer x as parameter: x = 0\nin defer x after return: x = 9\nin main: x = 9\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14425565, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ODrNcofW2OU/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmVgxg72H_lc4g2ZoB2vDszesSrcA/photo.jpg?sz=128", "display_name": "ist xu", "link": "https://stackoverflow.com/users/14425565/ist-xu"}, "is_accepted": false, "score": 0, "last_activity_date": 1602328189, "creation_date": 1602328189, "answer_id": 64292739, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement/64292739#64292739", "title": "Is golang defer statement execute before or after return statement?", "body": "<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc deque(a *[]int) {\n    *a = (*a)[1:]\n}\n\nfunc test_defer(a* []int) int{\n    defer deque(a)\n\n    return (*a)[0]\n}\n\nfunc main() {\n    a := []int{1,2}\n    fmt.Println(test_defer(&amp;a))\n    fmt.Println(a)\n}\n</code></pre>\n<p>try this code</p>\n<pre><code>go run test.go \n1\n[2]\n</code></pre>\n<p>test_defer return 1, so defer is executed after return</p>\n"}], "owner": {"reputation": 1384, "user_id": 4296218, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xH28YeHMo9Q/AAAAAAAAAAI/AAAAAAAAABE/ad2T99eOL2s/photo.jpg?sz=128", "display_name": "James Shi", "link": "https://stackoverflow.com/users/4296218/james-shi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4987, "favorite_count": 4, "accepted_answer_id": 53219947, "answer_count": 5, "score": 9, "last_activity_date": 1602328189, "creation_date": 1539078838, "question_id": 52718143, "link": "https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement", "title": "Is golang defer statement execute before or after return statement?", "body": "<p>I have a question about golang defer: <strong>Is golang defer statement execute before or after return statement?</strong></p>\n\n<p>I have read <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"noreferrer\">Defer_statements</a>. But I do not got the answer.</p>\n\n<p>I made a simple test:</p>\n\n<pre><code>func test1() (x int) {\n    defer fmt.Printf(\"in defer: x = %d\\n\", x)\n\n    x = 7\n    return 9\n}\n\nfunc test2() (x int) {\n    defer func() {\n        fmt.Printf(\"in defer: x = %d\\n\", x)\n    }()\n\n    x = 7\n    return 9\n}\n\nfunc test3() (x int) {\n    x = 7\n    defer fmt.Printf(\"in defer: x = %d\\n\", x)\n    return 9\n}\n\nfunc main() {\n    fmt.Println(\"test1\")\n    fmt.Printf(\"in main: x = %d\\n\", test1())\n    fmt.Println(\"test2\")\n    fmt.Printf(\"in main: x = %d\\n\", test2())\n    fmt.Println(\"test3\")\n    fmt.Printf(\"in main: x = %d\\n\", test3())\n}\n</code></pre>\n\n<p>In <code>test1()</code>, using <code>Printf</code>to print x after defer.\nIn <code>test2()</code>, using a anonymous function to print x after defer.\nIn <code>test3()</code>, using <code>Printf</code>to print x after defer, but defer after <code>x = 7</code>.</p>\n\n<p>But the result is:</p>\n\n<pre><code>test1\nin defer: x = 0\nin main: x = 9\ntest2\nin defer: x = 9\nin main: x = 9\ntest3\nin defer: x = 7\nin main: x = 9\n</code></pre>\n\n<p>So, is any one can explain:\n1. why got this result? why test1 prints 0, test2 print9, test3 prints 7.\n2. is defer statement excutes after return or before return?</p>\n\n<p>Thanks a lot.</p>\n"}, {"tags": ["multithreading", "go"], "answers": [{"comments": [{"owner": {"reputation": 844, "user_id": 1726468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NULGa.png?s=128&g=1", "display_name": "Christian M. Raymonds", "link": "https://stackoverflow.com/users/1726468/christian-m-raymonds"}, "edited": false, "score": 0, "creation_date": 1539078880, "post_id": 52718051, "comment_id": 92361707, "body": "I have one more question. What happens if I don&#39;t pass a pointer to the mutex i.e. instead of &amp;Mutex{}, if I just do Mutex{}?"}], "tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": true, "score": 4, "last_activity_date": 1539079858, "last_edit_date": 1539079858, "creation_date": 1539078545, "answer_id": 52718051, "question_id": 52718003, "link": "https://stackoverflow.com/questions/52718003/golang-thread-not-executing-every-time/52718051#52718051", "title": "Golang thread not executing every time", "body": "<p>When your <code>main</code> returns, all other threads are killed. As your <code>main</code> returns right after starting all threads, some of them don't get to print. You can use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> to wait for all threads to stop:</p>\n\n<pre><code>func main() {\n    m := &amp;sync.Mutex{}\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 300; i++ {\n        wg.Add(1)\n        go func(i int) {\n            defer wg.Done()\n            threder(m, i)\n        }(i)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>About your comment: If you do not pass the <code>sync.Mutex</code> as a pointer, but the value, to the function the <code>sync.Mutex</code> will be copied and each copy will operate independently of each other. Therefore there will be no synchronization between threads, as they all use their own, independent <code>sync.Mutex</code>. Also, you must not copy a <code>sync.Mutex</code> after the first use, as stated in the <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">docs</a>. This would not happen in your case, as you copy before using the <code>sync.Mutex</code>, but be aware of it.</p>\n"}], "owner": {"reputation": 844, "user_id": 1726468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NULGa.png?s=128&g=1", "display_name": "Christian M. Raymonds", "link": "https://stackoverflow.com/users/1726468/christian-m-raymonds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1539080306, "accepted_answer_id": 52718051, "answer_count": 1, "score": -1, "last_activity_date": 1539080360, "creation_date": 1539078379, "question_id": 52718003, "link": "https://stackoverflow.com/questions/52718003/golang-thread-not-executing-every-time", "closed_reason": "Duplicate", "title": "Golang thread not executing every time", "body": "<p>So, I am testing Golang. I understand fmt.Println is not thread safe. So, I was trying out sync.Mutex. The following is the program:</p>\n\n<pre><code>func threder(mux *Mutex, i int) {\n    mux.Lock()\n    fmt.Println(\"I am thread: \", i)\n    mux.Unlock()\n    return\n}\n\nfunc main() {\n    m := &amp;Mutex{}\n    for i := 0; i &lt; 300; i++ {\n        go threder(m, i)\n    }\n}\n</code></pre>\n\n<p>I am expecting 300 lines of output. But, I am getting 80-90 lines. Where am I wrong?</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "edited": false, "score": 0, "creation_date": 1539146607, "post_id": 52732175, "comment_id": 92390383, "body": "yes, you are right, I must run cmd in root dir relative to import path.  Thank you give me idea!"}], "tags": [], "owner": {"reputation": 499, "user_id": 3698225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22429640f60f3dfb8838c4be602d293?s=128&d=identicon&r=PG", "display_name": "GreatDharmatma", "link": "https://stackoverflow.com/users/3698225/greatdharmatma"}, "is_accepted": true, "score": 1, "last_activity_date": 1539142099, "creation_date": 1539142099, "answer_id": 52732175, "question_id": 52717653, "link": "https://stackoverflow.com/questions/52717653/protobuf-import-cannot-find-file-when-use-golang1-11-with-module/52732175#52732175", "title": "Protobuf import &quot;cannot find file&quot; when use Golang1.11 with module", "body": "<p>Looks like you are mixing up paths</p>\n\n<p>Your import path is</p>\n\n<p><code>import \"chaochaogege.com/filecatcher/common/ChunkInfo.proto\";</code></p>\n\n<p>If you want to run protoc from inside filecatcher/common then you would want to shorten your import to just <code>import \"ChunkInfo.proto\"</code> and run the command you are trying to run now. It will work.</p>\n\n<p>But if you want to keep your import statement as it is, then you would have to navigate to the parent directory of chaochaogege.com and run the following command from there as follows:</p>\n\n<p><code>protoc -I chaochaogege.com/filecatcher/common/ chaogege.com/filecatcher/common/ChunkInfo.proto --go_out=chaochaogege.com/filecatcher/common/</code></p>\n"}, {"tags": [], "owner": {"reputation": 322, "user_id": 8756461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbb80c5a935e43c5deea97cd4f4b1248?s=128&d=identicon&r=PG&f=1", "display_name": "George.", "link": "https://stackoverflow.com/users/8756461/george"}, "is_accepted": false, "score": 0, "last_activity_date": 1588476189, "last_edit_date": 1588476189, "creation_date": 1588471970, "answer_id": 61568793, "question_id": 52717653, "link": "https://stackoverflow.com/questions/52717653/protobuf-import-cannot-find-file-when-use-golang1-11-with-module/61568793#61568793", "title": "Protobuf import &quot;cannot find file&quot; when use Golang1.11 with module", "body": "<p>I know this question already has an accepted answer, but I wanted to share what worked for me, and to re-enforce one of the two proposals the accepted solution stated.</p>\n\n<p>I discovered that regardless of where I was running the <code>protoc</code> command from (whether it was from the source of the project directory or the subdirectory containing the proto files), shortening the import path to just the file name (ie. ChunkInfo.proto) worked. Note that all my proto files were in the same subdirectory.</p>\n\n<p>Importing the full path from the source of the project directory to the proto file has not worked for me, and I am not exactly sure why. Hope this helps. </p>\n"}], "owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4284, "favorite_count": 2, "accepted_answer_id": 52732175, "answer_count": 2, "score": 1, "last_activity_date": 1588476189, "creation_date": 1539077337, "question_id": 52717653, "link": "https://stackoverflow.com/questions/52717653/protobuf-import-cannot-find-file-when-use-golang1-11-with-module", "title": "Protobuf import &quot;cannot find file&quot; when use Golang1.11 with module", "body": "<p>I'm use Golang 1.11 with module support, So my project is <strong>not</strong> put in <code>$GOPATH</code></p>\n\n<p>I am want to compile <code>proto</code> file,</p>\n\n<p>My files structure</p>\n\n<p><a href=\"https://i.stack.imgur.com/XnMuM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XnMuM.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>my <code>TaskInfo.proto</code></p>\n\n<pre><code>syntax = \"proto3\";\npackage chaochaogege.filecatcher.common;\n\noption go_package = \"common\";\n\nimport \"chaochaogege.com/filecatcher/common/ChunkInfo.proto\";\n\nmessage TaskInfo{\n    string name = 1;\n    string storePath = 2;\n    uint32 workersNum = 3;\n    uint32 totalSize = 4;\n    repeated chaochaogege.filecatcher.common.ChunkInfo chunkInfo = 5;\n}\n</code></pre>\n\n<hr>\n\n<p>ChunkInfo.proto</p>\n\n<pre><code>syntax = \"proto3\";\npackage chaochaogege.filecatcher.common;\n\noption go_package = \"common\";\n\nmessage ChunkInfo{\n    uint32 startBytes = 1;\n    uint32 endBytes = 2;\n    uint32 totalBytes = 3;\n    uint32 downloaded = 4;\n    uint32 orderId = 5;\n\n}\n</code></pre>\n\n<hr>\n\n<p>go.mod</p>\n\n<pre><code>module chaochaogege.com/filecatcher\n\nrequire (\n  github.com/golang/protobuf v1.2.0\n)\n</code></pre>\n\n<p>When I run follow (in filecatcher/common directory)</p>\n\n<pre><code>protoc --go_out=./ TaskInfo.proto\n</code></pre>\n\n<p>protoc said:</p>\n\n<pre><code>chaochaogege.com/filecatcher/common/ChunkInfo.proto: File not found.TaskInfo.proto: Import \"chaochaogege.com/filecatcher/common/ChunkInfo.proto\" was not found or had errors.\nTaskInfo.proto:13:14: \"chaochaogege.filecatcher.common.ChunkInfo\" is notdefined.\n</code></pre>\n\n<p>I have googled, But all of questions are not about go module</p>\n\n<p>Did I use wrong import path or My config is not correct?</p>\n\n<p>If Stackoverflow cannot anwser my question, I think it's a bug.\nI should go to Github issue for report..</p>\n"}, {"tags": ["go", "testing", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "is_accepted": false, "score": 1, "last_activity_date": 1539077964, "creation_date": 1539077964, "answer_id": 52717847, "question_id": 52717533, "link": "https://stackoverflow.com/questions/52717533/how-to-create-gin-context-from-http-request-and-httptest-responserecorder/52717847#52717847", "title": "How to create gin.Context from *http.Request and *httptest.ResponseRecorder?", "body": "<p>Ok, so it seems there is <a href=\"https://godoc.org/github.com/gin-gonic/gin#CreateTestContext\" rel=\"nofollow noreferrer\">CreateTestContext</a> that does what I was looking for.</p>\n\n<pre><code>func CreateTestContext(w http.ResponseWriter) (c *Context, r *Engine)\n</code></pre>\n\n<blockquote>\n  <p>CreateTestContext returns a fresh engine and context for testing purposes</p>\n</blockquote>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1389, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1539077964, "creation_date": 1539076943, "question_id": 52717533, "link": "https://stackoverflow.com/questions/52717533/how-to-create-gin-context-from-http-request-and-httptest-responserecorder", "title": "How to create gin.Context from *http.Request and *httptest.ResponseRecorder?", "body": "<p>I would like to create a test helper for <a href=\"https://github.com/gin-gonic/gin/\" rel=\"nofollow noreferrer\">gin</a> similar to <a href=\"https://godoc.org/github.com/stretchr/testify/assert#HTTPBodyContains\" rel=\"nofollow noreferrer\">testify's HTTPBodyContain</a>.</p>\n\n<p>I am having a hard time creating <code>gin.Context</code> from <code>*http.Request</code> and <code>*httptest.ResponseRecorder</code>. I've already written something like this:</p>\n\n<pre><code>func HTTPBodyContains(t *testing.T, handler gin.HandlerFunc, method, url string, values url.Values, str interface{}, msgAndArgs ...interface{}) bool {\n    body := HTTPBody(handler, method, url, values)\n\n    contains := strings.Contains(body, fmt.Sprint(str))\n    if !contains {\n        assert.Fail(t, fmt.Sprintf(\"Expected response body for \\\"%s\\\" to contain \\\"%s\\\" but found \\\"%s\\\"\", url+\"?\"+values.Encode(), str, body))\n    }\n\n    return contains\n}\n\nfunc HTTPBody(handler gin.HandlerFunc, method, url string, values url.Values) string {\n    w := httptest.NewRecorder()\n    req, err := http.NewRequest(method, url+\"?\"+values.Encode(), nil)\n    if err != nil {\n        return \"\"\n    }\n    handler(&amp;gin.Context{\n        Request: req,\n        Writer:  gin.ResponseWriter(w),\n    })\n    return w.Body.String()\n}\n</code></pre>\n\n<p>but this wouldn't work</p>\n\n<pre><code>Writer:  gin.ResponseWriter(w)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1539113485, "post_id": 52717180, "comment_id": 92381365, "body": "are you interested in using the fields of your Object -types? are they ever going to be nested?"}, {"owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "reply_to_user": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1539143966, "post_id": 52717180, "comment_id": 92389765, "body": "Yes the fields of Object-type contains actual data. These fields will not be nested as currently there is no such requirements. I have updated above with an example program."}], "owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1539144072, "creation_date": 1539075798, "last_edit_date": 1539144072, "question_id": 52717180, "link": "https://stackoverflow.com/questions/52717180/how-to-have-generic-struct-from-a-set-of-nested-struct-in-golang", "title": "How to have generic struct from a set of nested struct in golang", "body": "<p>In my application I need make two different REST request containing JSON as payload. Now for two different API basic block of JSON contain common structure as below</p>\n\n<pre><code>{\n    \"request\": {\n        \"data\": {\n            \"Object\": [\n                {\n                    &lt;Payload based on API&gt;\n                }\n            ]\n        }\n    }\n}\n</code></pre>\n\n<p>To implement this I have written below code in two different packages</p>\n\n<h2>auth.go</h2>\n\n<pre><code>package auth\n\ntype ReqJSONAuth struct {\n    Request struct {\n        Data struct {\n            Object []Object `json:\"Object\"`\n        } `json:\"data\"`\n    } `json:\"request\"`\n}\n\n\ntype Object struct {\n    User User `json:\"user\"`\n}\n\ntype User struct {\n    CustomerID string  //`json:\"customerid\"`\n    IPAddress string  `json:\"pbxaddress\"`\n    NoOfUsers  string  //`json:\"noofusers\"`\n}\n\nfunc (j *ReqJSON) User() []User     { return j.Request.Data.Object.User } \nfunc (j *ReqJSON) SetUsers(u []User) { j.Request.Data.Object.User = u }\nfunc main() {\n    var j ReqJSON\n    j.SetUser(User{\n            UserID:    \"_id\",\n            IPAddr:    \"1.1.1.1\",\n            Noofusers: \"100\",\n            Qos:       \"34\",\n            ID:        \"kldjflkdfjlkdjfkld\",\n            Domain:    \"xyz.com\",\n    })\n\n    b, err := json.MarshalIndent(j, \"\", \"  \")\n    fmt.Println(err, string(b))\n}\n</code></pre>\n\n<h2>metadata.go</h2>\n\n<pre><code>package metadata\n\ntype ReqJSONMeta struct {\n    Request struct {\n        Data struct {\n            Object []Object `json:\"Object\"`\n        } `json:\"data\"`\n    } `json:\"request\"`\n}\n\ntype Object struct {\n    Meta Meta `json:\"metadata\"`\n}\n\ntype Meta struct {\n    CustomerID            string `json:\"customerId\"`\n    FilePath              string `json:\"filePath\"`\n    FileName              string `json:\"fileName\"`\n}\nfunc (j *ReqJSONMeta) User() []User     { return j.Request.Data.Object.User } \nfunc (j *ReqJSONMeta) SetUsers(u []User) { j.Request.Data.Object.User = u }\n</code></pre>\n\n<p>The above code works but I am want to refactor to make it more clean and generic so that we can add more API in future in current framework.\nHow I can achieve the same.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9, "user_id": 9202177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ns0uY.png?s=128&g=1", "display_name": "Derek Booher", "link": "https://stackoverflow.com/users/9202177/derek-booher"}, "edited": false, "score": 2, "creation_date": 1539072740, "post_id": 52716100, "comment_id": 92357873, "body": "Despite having just asked this... after reading over it for the umpteenth time I think I finally got it.. the original ac := &lt;- ch is not initializing a copy of the argument, it&#39;s pulling a value out of it and initializing that as a new variable. It seems simple now but I&#39;ve been banging my head against this for hours lol"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539116062, "post_id": 52716100, "comment_id": 92382497, "body": "You are correct. <code>ac</code> is initialized with the type and value of the message it receives from <code>ch</code> when it does the read."}], "owner": {"reputation": 9, "user_id": 9202177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ns0uY.png?s=128&g=1", "display_name": "Derek Booher", "link": "https://stackoverflow.com/users/9202177/derek-booher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1539072203, "creation_date": 1539072203, "question_id": 52716100, "link": "https://stackoverflow.com/questions/52716100/golang-why-does-this-ac-variable-initialize-as-chan-time-duration-rather-than-c", "title": "Golang: why does this ac variable initialize as chan time.Duration rather than chan chan time.Duration?", "body": "<p>New gopher here. The following code works for me, but I'm confused by the doStuff function. Why is it true that the ac variable is of type chan time.Duration, rather than chan chan time.Duration?</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"sync\"\n  \"time\"\n)\n\n// the function to be run inside a goroutine. It receives a channel on ch, sleeps for t, then sends t\n// on the channel it received\nfunc doStuff(t time.Duration, ch &lt;-chan chan time.Duration) {\n  ac := &lt;-ch\n  time.Sleep(t)\n  ac &lt;- t\n}\n\nfunc main() {\n  // create the channel-over-channel type\n  sendCh := make(chan chan time.Duration)\n\n  recvCh := make(chan time.Duration)\n\n  // use this to block until all goroutines have received the ack and logged\n  var wg sync.WaitGroup\n\n  // start up 10 doStuff goroutines\n  for i := 0; i &lt; 10; i++ {\n    go doStuff(time.Duration(i+1)*time.Second, sendCh)\n    // send channels to each doStuff goroutine. doStuff will \"ack\" by sending its sleep time back\n    sendCh &lt;- recvCh\n    wg.Add(1)\n    go func() {\n      defer wg.Done()\n      log.Printf(\"slept for %s\", &lt;-recvCh)\n    }()\n  }\n\n  wg.Wait()\n}\n</code></pre>\n\n<p>What is ac := &lt;- ch doing, and why does ac &lt;- t work? </p>\n\n<p>The first thing I tried was to just remove the ac variable because it at first seemed like an unnecessary extra step, but doing this causes the output to be sequential rather than concurrent:</p>\n\n<pre><code>func doStuff(t time.Duration, ch &lt;-chan chan time.Duration) {\n  time.Sleep(t)\n  &lt;- ch &lt;- t\n}\n</code></pre>\n\n<p>So I started experimenting, to me it seems like it's just initializing a new variable as a copy of the argument sendCh, which is an empty chan chan time.Duration. so I tried the following:</p>\n\n<pre><code>func doStuff(t time.Duration, ch &lt;-chan chan time.Duration) {\n  // What makes this different from the original code?\n  ac := make(chan chan time.Duration)\n  time.Sleep(t)\n  ac &lt;- t\n}\n// This gives an immediate error: cannot use t (type time.Duration) as type chan time.Duration in send\n</code></pre>\n\n<p>Okay, that makes sense. I can't send a time.Duration to a channel of channels of time.Duration, I need to send a channel of time.Duration. Gotcha... but I don't know why the original code works, since it seems to me this should have been the same aside from the original being a receive only channel. So I imported fmt and checked the type of ac, and sure enough its a chan time.Duration. Why? </p>\n\n<p>My final experiment was to try initializing ac as a chan time.Duration directly, which caused deadlock:</p>\n\n<pre><code>func doStuff(t time.Duration, ch &lt;-chan chan time.Duration) {\n  ac := make(chan time.Duration)\n  time.Sleep(t)\n  ac &lt;- t\n  // this causes deadlock\n}\n</code></pre>\n\n<p>What the heck lol... So, to summarize, I don't understand why in the original code ac := &lt;- ch causes it to be initialized as a channel of time.Duration rather than a channel of channels of time.Duration, and I don't understand why the changes I made in the experiments caused the different error conditions that they did. Any insight appreciated!</p>\n"}, {"tags": ["go", "axios", "nuxt.js", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 369, "user_id": 1867162, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MRuqM.jpg?s=128&g=1", "display_name": "luminol", "link": "https://stackoverflow.com/users/1867162/luminol"}, "edited": false, "score": 0, "creation_date": 1539103521, "post_id": 52715788, "comment_id": 92376710, "body": "This is the answer. I provided the final solution below. With gin-gonic, we must use the function, <code>c.GetRawData()</code>, and then unmarshal that data into a struct."}], "tags": [], "owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "is_accepted": true, "score": 3, "last_activity_date": 1539073524, "last_edit_date": 1539073524, "creation_date": 1539071151, "answer_id": 52715788, "question_id": 52715545, "link": "https://stackoverflow.com/questions/52715545/axios-post-on-gin-gonic-golang-server-not-working/52715788#52715788", "title": "Axios POST on Gin-Gonic (golang) Server Not Working", "body": "<p>I think the problem is not with gin or not gin, it's just with your call. Notice that you're accessing to the <code>c.PostForm</code> values but in your axios call you're not sending a form values, you're sending a json, so in your variables the value is empty. If you're using Postman I suppose you're doing well sending a PostForm, but not in your axios. My recommendation is to still sending a Post (also add a content-type: application-json header) and <code>c.Bind</code> the body to a struct or a map[string]interface{} and then cast to your specific types in your handler.</p>\n"}, {"tags": [], "owner": {"reputation": 369, "user_id": 1867162, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MRuqM.jpg?s=128&g=1", "display_name": "luminol", "link": "https://stackoverflow.com/users/1867162/luminol"}, "is_accepted": false, "score": 1, "last_activity_date": 1539073231, "creation_date": 1539073231, "answer_id": 52716395, "question_id": 52715545, "link": "https://stackoverflow.com/questions/52715545/axios-post-on-gin-gonic-golang-server-not-working/52716395#52716395", "title": "Axios POST on Gin-Gonic (golang) Server Not Working", "body": "<p>There is no JSON POST Retrieval built into gin-gonic, and from what I understand, in Go's basic Web Server Package. Instead, we need to use c.GetRawData(), and then unmarshal the results into a struct! Since the c.GetRawData() includes <code>data: { userId: 121, productId: 12, token: tok_visa }</code>, the struct must also contain the <code>data</code> json field as well. I hope this helps someone else! Thanks @Carles</p>\n\n<pre><code>type Buy struct {\n    Data struct {\n        User    int64 `json:\"userId\" binding:\"required\"`\n        Product int64 `json:\"productId\" binding:\"required\"`\n        Token   string `json:\"token\"`\n    } `json:\"data\"`\n}\n\nfunc BuyProduct(c *gin.Context) {\n\n    a := Buy{}\n    b, err := c.GetRawData()\n    if err != nil {\n        panic(err)\n    }\n    json2.Unmarshal(b, &amp;a)\n    userId := a.Data.User\n    productId := a.Data.Product\n\n    token := a.Data.Token\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 1867162, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MRuqM.jpg?s=128&g=1", "display_name": "luminol", "link": "https://stackoverflow.com/users/1867162/luminol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1981, "favorite_count": 0, "accepted_answer_id": 52715788, "answer_count": 2, "score": 2, "last_activity_date": 1577568829, "creation_date": 1539070174, "last_edit_date": 1577568829, "question_id": 52715545, "link": "https://stackoverflow.com/questions/52715545/axios-post-on-gin-gonic-golang-server-not-working", "title": "Axios POST on Gin-Gonic (golang) Server Not Working", "body": "<p>I can use GET, but I cannot use POST from axios, sending data to my gin-gonic golang server. It works perfectly in Postman. When I shoot over the request with Axios, I get nothing in return.</p>\n\n<p>When I go into the gin-gonic server, it shows that it returned a 500 error. Upon further inspection, I see that none of the post variables had been accessed by gin. </p>\n\n<p>When I have used Postman, the server returns the array as specified.  I have a feeling that it might have to do with headers, but I truly am stumped. I have encountered this problem about 6 months ago and never figured it out. Now I remember why I didn't continue with axios and nuxt :).</p>\n\n<p>Here is the golang gin-gonic server route.</p>\n\n<pre><code>func initServer() {\n    router := gin.Default()\n    config := cors.DefaultConfig()\n    config.AddAllowHeaders(\"*\",)\n    config.AllowAllOrigins = true\n    config.AllowMethods = []string{\"POST\", \"GET\"}\n    router.Use(cors.New(config))\n    v1 := router.Group(\"/api/v1/stripe\")\n    {\n        v1.POST(\"/pay\", BuyProduct)\n        v1.POST(\"/card\", UpdateCard)\n        v1.GET(\"/products\", GetAllProducts)\n        v1.GET(\"/products/id/:productId\", GetProduct)\n        v1.GET(\"/products/types/:typeId\", GetProductType)\n        v1.GET(\"/products/types\", GetAllProductTypes)\n    }\n\n    // You can get individual args with normal indexing.\n    serverAddress := \"127.0.0.1:8080\"\n    if len(os.Args) &gt; 1 {\n        arg := os.Args[1]\n        serverAddress = fmt.Sprintf(\"127.0.0.1:%v\", arg)\n    }\n\n    router.Run(serverAddress)\n}\n</code></pre>\n\n<p>Here is the receiver function that processes the router calls when the endpoint is hit</p>\n\n<pre><code>func BuyProduct(c *gin.Context) {\n\n    postUserID := c.PostForm(\"userId\")\n    postProductId := c.PostForm(\"productId\")\n    token := c.PostForm(\"token\")\n\n    userId, err := strconv.Atoi(postUserID)\n    if err != nil {\n    panic(err)\n    }\n    productId, err := strconv.Atoi(postProductId)\n    if err != nil {\n        panic(err)\n    }\n\n    custy := user.InitCustomer(int64(userId), token)\n    custy.GetStripeCustomerData()\n    custy.SelectProduct(products.NewProduct(int64(productId)))\n    custy.Purchase()\n\n    c.JSON(200, gin.H{\"status\": 200,\n        \"product\": custy.Product,\n        \"user\": *custy.Saver.User,\n        \"subscriptions\": *custy.Subscriptions,\n        \"ch\": custy.Logs,\n    })\n\n    return\n}\n</code></pre>\n\n<p>Here is my axios (nuxt) code. </p>\n\n<pre><code>async purchaseSubscription() {\n    const paid = await \n    this.$axios.$post('http://localhost:8080/api/v1/stripe/pay', { data: { \n        userId: \"121\",\n        productId: this.productId,\n    }, query: {  } })\n    this.paid = paid\n},\n</code></pre>\n\n<p>Here is the error I get in the gin-gonic server in go</p>\n\n<blockquote>\n  <p>2018/10/09 00:12:34 [Recovery] 2018/10/09 - 00:12:34 panic recovered:<br>\n  POST /api/v1/stripe/pay HTTP/1.1<br>\n  Host: localhost:8080<br>\n  Accept: application/json, text/plain, <em>/</em><br>\n  Accept-Encoding: gzip, deflate, br<br>\n  Accept-Language: en-US,en;q=0.9<br>\n  Cache-Control: no-cache<br>\n  Connection: keep-alive<br>\n  Content-Length: 52<br>\n  Content-Type: application/json;charset=UTF-8<br>\n  Dnt: 1<br>\n  Origin: <a href=\"http://localhost:3000\" rel=\"nofollow noreferrer\">http://localhost:3000</a><br>\n  Pragma: no-cache<br>\n  Referer: <a href=\"http://localhost:3000/\" rel=\"nofollow noreferrer\">http://localhost:3000/</a><br>\n  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36<br>\n  strconv.Atoi: parsing \"\": invalid syntax<br>\n  /usr/local/go/src/runtime/panic.go:502 (0x102aca8)<br>\n    gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d),   uint32(d.siz), uint32(d.siz))<br>\n  /Users/joealai/go/src/sovrin-mind-stripe/sm-stripe.go:150 (0x15f9ee5)<br>\n    BuyProduct: panic(err)<br>\n  [GIN] 2018/10/09 - 00:12:34 | 500 |    1.079498ms |       127.0.0.1 | POST     /api/v1/stripe/pay</p>\n</blockquote>\n"}, {"tags": ["mysql", "go", "multipartform-data"], "comments": [{"owner": {"reputation": 32469, "user_id": 1529673, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/O6MQS.jpg?s=128&g=1", "display_name": "Strawberry", "link": "https://stackoverflow.com/users/1529673/strawberry"}, "edited": false, "score": 0, "creation_date": 1539068269, "post_id": 52714937, "comment_id": 92355485, "body": "Note that this is less popular than simply storing the image in a file server, and storing a path to the image in the database. Also, performance is likely to be disappointing for images above ca. 100k. Nonetheless, if you still want to do this then there are surely dozens of tutorials explaining how"}, {"owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "reply_to_user": {"reputation": 32469, "user_id": 1529673, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/O6MQS.jpg?s=128&g=1", "display_name": "Strawberry", "link": "https://stackoverflow.com/users/1529673/strawberry"}, "edited": false, "score": 0, "creation_date": 1539068365, "post_id": 52714937, "comment_id": 92355533, "body": "I am aware of that and I still want to do this. I was trying to find a tutorial but couldn&#39;t for Golang."}], "answers": [{"tags": [], "owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "is_accepted": false, "score": 1, "last_activity_date": 1539070107, "creation_date": 1539070107, "answer_id": 52715526, "question_id": 52714937, "link": "https://stackoverflow.com/questions/52714937/trying-to-upload-image-through-an-api-and-store-it-in-a-mysql-database/52715526#52715526", "title": "Trying to upload image through an API and store it in a MySQL database", "body": "<p>Solved it by converting my <code>imageFile</code> to a string like this: </p>\n\n<p><code>encodedImage := base64.StdEncoding.EncodeToString(imageFile)</code></p>\n\n<p>Then I stored the <code>encodedImage</code> into my database's <code>image</code> column (of type <code>BLOB</code>)</p>\n"}], "owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539070107, "creation_date": 1539067955, "question_id": 52714937, "link": "https://stackoverflow.com/questions/52714937/trying-to-upload-image-through-an-api-and-store-it-in-a-mysql-database", "title": "Trying to upload image through an API and store it in a MySQL database", "body": "<p>So I'm trying to upload image through an API and store it in a MySQL database. I'm unsure how to convert the <code>imageFile</code> to something that I can store in my DB. </p>\n\n<p>I'm trying to store this image into a <code>blob</code> field on the <code>image</code> column of this table: </p>\n\n<pre><code>CREATE TABLE runkdb.uploaded_challenge (\n    id int NOT NULL AUTO_INCREMENT,\n    challenge_id int NOT NULL,\n    user_id int NOT NULL,\n    created_at DATETIME NOT NULL,\n    image_caption TEXT,\n    image_path varchar(255),\n    image BLOB,\n    score int DEFAULT 0,\n    primary key (id)\n);\n</code></pre>\n\n<p>This is part of the API function that tries to store the data:</p>\n\n<pre><code>// Parse the request\nimageFile := make([]byte, 0)\nimage, _, err := req.FormFile(\"image\")\nif err != nil {\n    // No image\n    glog.Error(\"Error parsing image\")\n    responseMessage.Message = \"Error parsing image\"\n    w.WriteHeader(400)\n    json.NewEncoder(w).Encode(responseMessage)\n    return\n} else {\n    //if !strings.HasPrefix(fileHeader.Header[\"Content-Type\"][0], \"image\") {\n        // Something wrong with file type\n    //}\n    imageFile, err = ioutil.ReadAll(image)\n    if err != nil {\n        // Error reading uploaded image from stream\n        glog.Error(\"Error reading image\")\n        responseMessage.Message = \"Error reading image\"\n        w.WriteHeader(400)\n        json.NewEncoder(w).Encode(responseMessage)\n        return\n    }\n}\n\nimageCaption := req.Form.Get(\"image_caption\")\n\n// Create DB connection\ntxn, err := api.db.Begin()\nif err != nil {\n    glog.Error(\"Error creating database transaction\")\n    responseMessage.Message = \"Error creating database transaction\"\n    w.WriteHeader(500)\n    json.NewEncoder(w).Encode(responseMessage)\n    return\n}\n\nt := time.Now()\ncreatedAtTimeString := fmt.Sprintf(t.Format(\"2006-01-02 15:04:05\"))\nimageByteString := string(imageFile)\nquery := fmt.Sprintf(\"INSERT INTO uploaded_challenge (challenge_id, user_id, created_at, image_caption, image) VALUES ('%d', '%d', '%s', '%s', '%s');\", id, userID, createdAtTimeString, imageCaption, imageByteString)\nprint(query)\nresult, err := txn.Exec(query)\nif err != nil {\n    txn.Rollback()\n    glog.Error(\"Error inserting challenge into database\")\n    responseMessage.Message = \"Error inserting challenge into database\"\n    w.WriteHeader(406)\n    json.NewEncoder(w).Encode(responseMessage)\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "rounding"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1539056362, "post_id": 52712958, "comment_id": 92351700, "body": "See <a href=\"https://play.golang.org/p/UVuNExG9XiL\" rel=\"nofollow noreferrer\">play.golang.org/p/UVuNExG9XiL</a>.  The expression <code>1.015*100</code> is a <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a> and is evaluated exactly.  The expression <code>x*100</code> is evaluated using float64s."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1539099546, "last_edit_date": 1539099546, "creation_date": 1539067222, "answer_id": 52714759, "question_id": 52712958, "link": "https://stackoverflow.com/questions/52712958/rounding-value-half-up-to-2-decimal-places-in-go/52714759#52714759", "title": "Rounding value half-up to 2 decimal places in Go", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language\n  Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">Constants</a></p>\n  \n  <p>Numeric constants represent exact values of arbitrary precision and do\n  not overflow. </p>\n  \n  <p>Implementation restriction: Although numeric constants have arbitrary\n  precision in the language, a compiler may implement them using an\n  internal representation with limited precision. That said, every\n  implementation must:</p>\n  \n  <ul>\n  <li>Represent floating-point constants, including the parts of a    complex constant, with a mantissa of at least 256 bits and a signed<br>\n  binary exponent of at least 16 bits.</li>\n  <li>Round to the nearest representable constant if unable to represent    a floating-point or complex constant due to limits on    precision.</li>\n  </ul>\n  \n  <p>These requirements apply both to literal constants and to the result\n  of evaluating constant expressions.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">Constant expressions</a></p>\n  \n  <p>Constant expressions may contain only constant operands and are\n  evaluated at compile time. </p>\n  \n  <p>Constant expressions are always evaluated exactly; intermediate values\n  and the constants themselves may require precision significantly\n  larger than supported by any predeclared type in the language. </p>\n  \n  <p>Implementation restriction: A compiler may use rounding while\n  computing untyped floating-point or complex constant expressions; see\n  the implementation restriction in the section on constants. This\n  rounding may cause a floating-point constant expression to be invalid\n  in an integer context, even if it would be integral when calculated\n  using infinite precision, and vice versa.</p>\n</blockquote>\n\n<hr>\n\n<p>Implement the <code>RoundHalfUp</code> function like the Go compiler does for <code>math.Round(1.015*100) / 100</code>. <code>1.015*100</code> is a untyped floating-point constant expression. Use the <code>math/big</code> package with at least 256 bits of precision. Go <code>float64</code> (IEEE-754 64-bit floating-point) has 53 bits of precision.</p>\n\n<p>For example, with 256 bits of precision (constant expression),</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"math/big\"\n)\n\nfunc RoundHalfUp(x string) float64 {\n    // math.Round(x*100) / 100\n    xf, _, err := big.ParseFloat(x, 10, 256, big.ToNearestEven)\n    if err != nil {\n        panic(err)\n    }\n    xf100, _ := new(big.Float).Mul(xf, big.NewFloat(100)).Float64()\n    return math.Round(xf100) / float64(100)\n}\n\nfunc main() {\n    fmt.Println(RoundHalfUp(\"1.015\"))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/uqtYwP4o22B\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uqtYwP4o22B</a></p>\n\n<p>Output:</p>\n\n<pre><code>1.02\n</code></pre>\n\n<hr>\n\n<p>If we only use 53 bits of precision (<code>float64</code>):</p>\n\n<pre><code>xf, _, err := big.ParseFloat(x, 10, 53, big.ToNearestEven)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ejz-wkuycaU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ejz-wkuycaU</a></p>\n\n<p>Output:</p>\n\n<pre><code>1.01\n</code></pre>\n"}], "owner": {"reputation": 977, "user_id": 1419809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0Plto.jpg?s=128&g=1", "display_name": "Pauli", "link": "https://stackoverflow.com/users/1419809/pauli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2156, "favorite_count": 1, "accepted_answer_id": 52714759, "answer_count": 1, "score": 3, "last_activity_date": 1539099546, "creation_date": 1539055881, "question_id": 52712958, "link": "https://stackoverflow.com/questions/52712958/rounding-value-half-up-to-2-decimal-places-in-go", "title": "Rounding value half-up to 2 decimal places in Go", "body": "<p>Rounding positive value (example here: 1.015) half-up to 2 decimal places using <code>math.Round()</code> in Go:</p>\n\n<pre><code>fmt.Println(math.Round(1.015*100) / 100)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UPUFCUbIbTi\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>I got: <code>1.02</code>. That's correct.</p>\n\n<p>But when I employed a function to do the same job:</p>\n\n<pre><code>func RoundHalfUp(x float64) float64 {\n    return math.Round(x*100) / 100\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/w6yA29y9LTS\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>I got <code>1.01</code>.</p>\n\n<p>What's wrong with the <code>RoundHalfUp</code> function?</p>\n"}, {"tags": ["go", "kubernetes", "google-cloud-platform", "google-cloud-sql", "google-kubernetes-engine"], "comments": [{"owner": {"reputation": 48205, "user_id": 2989261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b03110b84c83464a58832d4d55ff4542?s=128&d=identicon&r=PG", "display_name": "Rico", "link": "https://stackoverflow.com/users/2989261/rico"}, "edited": false, "score": 1, "creation_date": 1539061926, "post_id": 52712907, "comment_id": 92353027, "body": "Can you post you deployment or pod spec for your cloudsql proxy?"}, {"owner": {"reputation": 1763, "user_id": 6588456, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/1FIX2.jpg?s=128&g=1", "display_name": "night-gold", "link": "https://stackoverflow.com/users/6588456/night-gold"}, "edited": false, "score": 0, "creation_date": 1539063097, "post_id": 52712907, "comment_id": 92353373, "body": "Is the API correctly activated? Sometimes the error message for the API is a bit unclear..."}, {"owner": {"reputation": 87, "user_id": 6641502, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ECGH4.jpg?s=128&g=1", "display_name": "Korede Aderele", "link": "https://stackoverflow.com/users/6641502/korede-aderele"}, "edited": false, "score": 0, "creation_date": 1539093388, "post_id": 52712907, "comment_id": 92370904, "body": "i&#39;m pretty sure i&#39;ve got the API activated and the service account credentials mounted on."}], "answers": [{"comments": [{"owner": {"reputation": 619, "user_id": 1691669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d015c37694e58bd159f3b312981039e2?s=128&d=identicon&r=PG", "display_name": "outofcoffee", "link": "https://stackoverflow.com/users/1691669/outofcoffee"}, "edited": false, "score": 0, "creation_date": 1576880057, "post_id": 52748663, "comment_id": 105049556, "body": "I had built the Docker image from the source at <a href=\"https://github.com/GoogleCloudPlatform/cloudsql-proxy\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/cloudsql-proxy</a> and saw this issue. To get this working I had to add the &#39;ca-certificates.crt&#39; file from the official image cloudsql-proxy image to /etc/ssl/certs, which is one of the locations golang looks for certificates (on Debian)."}], "tags": [], "owner": {"reputation": 7568, "user_id": 3645370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZfsLt.png?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/3645370/david"}, "is_accepted": true, "score": 5, "last_activity_date": 1547212166, "last_edit_date": 1547212166, "creation_date": 1539205004, "answer_id": 52748663, "question_id": 52712907, "link": "https://stackoverflow.com/questions/52712907/failure-to-connect-to-proxy-certificate-signed-by-unknown-authority/52748663#52748663", "title": "Failure to connect to proxy &quot;Certificate signed by unknown authority&quot;", "body": "<p>The error message indicates that your client is not able to trust the certificate of <a href=\"https://www.googleapis.com\" rel=\"nofollow noreferrer\">https://www.googleapis.com</a>. There are two possible causes for this:</p>\n\n<ol>\n<li><p>Your client does not know what root certificates to trust. The official <a href=\"https://cloud.google.com/sql/docs/mysql/connect-docker\" rel=\"nofollow noreferrer\">cloudsql-proxy docker image</a> includes root certificates, so if you are using that image, this is not your problem. If you are not using that image, you should (or at least install ca certificates in your image).</p></li>\n<li><p>Your outbound traffic is being intercepted by a proxy server that is using a different, untrusted, certificate. This might be malicious (in which case you need to investigate who is intercepting your traffic). More benignly, you might be in a organization using an outbound proxy to inspect traffic according to policy. If this is the case, you should build a new docker image that includes the CA certificate used by your organization's outbound proxy.</p></li>\n</ol>\n"}], "owner": {"reputation": 87, "user_id": 6641502, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ECGH4.jpg?s=128&g=1", "display_name": "Korede Aderele", "link": "https://stackoverflow.com/users/6641502/korede-aderele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 1, "accepted_answer_id": 52748663, "answer_count": 1, "score": 4, "last_activity_date": 1547212166, "creation_date": 1539055482, "last_edit_date": 1547209693, "question_id": 52712907, "link": "https://stackoverflow.com/questions/52712907/failure-to-connect-to-proxy-certificate-signed-by-unknown-authority", "title": "Failure to connect to proxy &quot;Certificate signed by unknown authority&quot;", "body": "<p>I'm attempting to connect to a CloudSQL instance via a cloudsql-proxy container on my Kubernetes deployment. I have the cloudsql credentials mounted and the value of <code>GOOGLE_APPLICATION_CREDENTIALS</code> set. </p>\n\n<p>However, I'm still receiving the following error in my logs:</p>\n\n<pre><code>2018/10/08 20:07:28 Failed to connect to database: Post https://www.googleapis.com/sql/v1beta4/projects/[projectID]/instances/[appName]/createEphemeral?alt=json&amp;prettyPrint=false: oauth2: cannot fetch token: Post https://oauth2.googleapis.com/token: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>My connection string looks like this: </p>\n\n<pre><code>[dbUser]:[dbPassword]@cloudsql([instanceName])/[dbName]]?charset=utf8&amp;parseTime=True&amp;loc=Local\n</code></pre>\n\n<p>And the proxy dialer is shadow-imported as:</p>\n\n<pre><code>_ github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql\n</code></pre>\n\n<p>Anyone have an idea what might be missing?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Deployment Spec looks something like this (JSON formatted):</p>\n\n<pre><code>{\n  \"replicas\": 1,\n  \"selector\": {\n    ...\n  },\n  \"template\": {\n    ...\n    \"spec\": {\n      \"containers\": [\n        {\n          \"image\": \"[app-docker-imager]\",\n          \"name\": \"...\",\n          \"env\": [\n            ...\n            {\n              \"name\": \"MYSQL_PASSWORD\",\n              ...\n            },\n            {\n              \"name\": \"MYSQL_USER\",\n              ...\n            },\n            {\n              \"name\": \"GOOGLE_APPLICATION_CREDENTIALS\",\n              \"value\": \"...\"\n            }\n          ],\n\n          \"ports\": [\n            {\n              \"containerPort\": 8080,\n              \"protocol\": \"TCP\"\n            }\n          ],\n          \"volumeMounts\": [\n            {\n              \"mountPath\": \"/secrets/cloudsql\",\n              \"name\": \"[secrets-mount-name]\",\n              \"readOnly\": true\n            }\n          ]\n        },\n        {\n          \"command\": [\n            \"/cloud_sql_proxy\",\n            \"-instances=...\",\n            \"-credential_file=...\"\n          ],\n          \"image\": \"gcr.io/cloudsql-docker/gce-proxy:1.11\",\n          \"name\": \"...\",\n          \"ports\": [\n            {\n              \"containerPort\": 3306,\n              \"protocol\": \"TCP\"\n            }\n          ],\n          \"volumeMounts\": [\n            {\n              \"mountPath\": \"/secrets/cloudsql\",\n              \"name\": \"[secrets-mount-name]\",\n              \"readOnly\": true\n            }\n          ]\n        }\n      ],\n      \"volumes\": [\n        {\n          \"name\": \"[secrets-mount-name]\",\n          \"secret\": {\n            \"defaultMode\": 420,\n            \"secretName\": \"[secrets-mount-name]\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>\n"}, {"tags": ["list", "loops", "go", "stdin", "listiterator"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1539049727, "post_id": 52712160, "comment_id": 92350370, "body": "Get rid of any trailing newlines: &quot;\\n&quot; or &quot;\\r\\n&quot;."}, {"owner": {"reputation": 368, "user_id": 1538111, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/60cd75d8909aa1c1318d2e93d7507990?s=128&d=identicon&r=PG", "display_name": "Muhammad Farag", "link": "https://stackoverflow.com/users/1538111/muhammad-farag"}, "edited": false, "score": 0, "creation_date": 1539051112, "post_id": 52712160, "comment_id": 92350628, "body": "Hey Haw Wang, update your code in <code>mytest</code> to  <code>a,err := strconv.Atoi(st) \tif(err != nil){ \t\tprintln(err.Error()) \t}</code> You should see the error."}], "owner": {"reputation": 41, "user_id": 10475733, "user_type": "registered", "profile_image": "https://graph.facebook.com/2181808425475355/picture?type=large", "display_name": "Hao Wang", "link": "https://stackoverflow.com/users/10475733/hao-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 19, "favorite_count": 0, "closed_date": 1539049753, "answer_count": 0, "score": 0, "last_activity_date": 1539050018, "creation_date": 1539049019, "last_edit_date": 1539050018, "question_id": 52712160, "link": "https://stackoverflow.com/questions/52712160/golang-is-not-parsing-the-last-element-of-stdin", "closed_reason": "Duplicate", "title": "golang is not parsing the last element of stdin", "body": "<p>I am trying to write a golang program where it will parse the stdin line to line and compute the sum of all positive integers on each line.</p>\n\n<p>Attached is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc mytest(st string) bool {\n    a, _ := strconv.Atoi(st)\n    return a &gt; 0\n\n}\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    for {\n        line, err := reader.ReadString('\\n')\n\n        if err == io.EOF {\n            //          fmt.Print(line)\n            break\n        }\n\n        // fmt.Print(line)\n        res := 0\n        qq := strings.Split(line, \" \")\n\n        // fmt.Println(qq)\n\n        for _, val := range qq {\n            if mytest(val) {\n                as, _ := strconv.Atoi(val)\n                fmt.Println(as)\n                res += as * as\n            }\n\n        }\n\n        fmt.Println(res) // [test]\n\n    }\n}\n</code></pre>\n\n<p>I am not sure why the for loop cannot reach the last element of the list. \nFor example, if the stdin is</p>\n\n<pre><code>3 -1 1 14\n1 6 16\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>10\n37\n</code></pre>\n\n<p>so that 14 and 16 is not parsed in the inner for loop at </p>\n\n<pre><code>for _,val := range qq \n</code></pre>\n\n<p>Can anybody help me take a look?</p>\n"}, {"tags": ["sql", "postgresql", "go", "go-gorm", "sql-in"], "comments": [{"owner": {"reputation": 3347, "user_id": 3140992, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/RiDg4.jpg?s=128&g=1", "display_name": "citynorman", "link": "https://stackoverflow.com/users/3140992/citynorman"}, "edited": false, "score": 1, "creation_date": 1539047708, "post_id": 52712022, "comment_id": 92350011, "body": "you create a table with the user_id you need and do a left join"}], "answers": [{"comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 2, "creation_date": 1539067347, "post_id": 52712260, "comment_id": 92355057, "body": "Joining to a values clause instead of an <code>IN</code> is another option that sometimes is faster as well. See e.g. <a href=\"https://stackoverflow.com/questions/52387410\">here</a>"}, {"owner": {"reputation": 473266, "user_id": 939860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed7cecf2bd835cf5670d271d0d104f51?s=128&d=identicon&r=PG", "display_name": "Erwin Brandstetter", "link": "https://stackoverflow.com/users/939860/erwin-brandstetter"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1539167208, "post_id": 52712260, "comment_id": 92400703, "body": "Yes, a <code>VALUES</code> expression is one form of a subquery, and this is typically faster for big sets. A variation on the theme: pass an array and <code>unnest</code> in a subquery. Info and link to more for each in the linked answer above."}], "tags": [], "owner": {"reputation": 473266, "user_id": 939860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed7cecf2bd835cf5670d271d0d104f51?s=128&d=identicon&r=PG", "display_name": "Erwin Brandstetter", "link": "https://stackoverflow.com/users/939860/erwin-brandstetter"}, "is_accepted": true, "score": 7, "last_activity_date": 1539050518, "last_edit_date": 1539050518, "creation_date": 1539049862, "answer_id": 52712260, "question_id": 52712022, "link": "https://stackoverflow.com/questions/52712022/what-is-the-most-performant-way-to-rewrite-a-large-in-clause/52712260#52712260", "title": "What is the most performant way to rewrite a large IN clause?", "body": "<p>You can replace <code>user_id IN (value [, ...])</code> with one of:</p>\n\n<pre><code>user_id IN (subquery)\nuser_id = ANY (subquery)\nuser_id = ANY (array expression)\n</code></pre>\n\n<p>Neither subqueries nor arrays exhibit the same limitation. The shortest input syntax would be:</p>\n\n<pre><code>user_id = ANY ('{1,2,3}'::int[])  -- make array type match type of user_id\n</code></pre>\n\n<p>Details and more options:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/31191507/how-to-use-any-instead-of-in-in-a-where-clause-with-rails/31192557#31192557\">How to use ANY instead of IN in a WHERE clause with Rails?</a></li>\n</ul>\n\n<p><strong>Or</strong> you might create a (temporary) table <code>tmp_usr(user_id int)</code>, import to it, maybe with SQL <code>COPY</code> or psql <code>\\copy</code> instead of <code>INSERT</code> for best performance with <strong>very big sets</strong>, and then <em>join</em> to the table like:</p>\n\n<pre><code>SELECT SUM(total_amount)\nFROM   tbl\nJOIN   tmp_usr USING (user_id)\nGROUP  BY user_id;\n</code></pre>\n\n<p>BTW, <code>GROUP BY user_id</code> without including <code>user_id</code> in the <code>SELECT</code> list looks suspicious. May be a simplified example query.</p>\n"}], "owner": {"reputation": 1261, "user_id": 1703854, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5f41010c9e8f1c939704135336aa0282?s=128&d=identicon&r=PG", "display_name": "Jay Lane", "link": "https://stackoverflow.com/users/1703854/jay-lane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1351, "favorite_count": 0, "accepted_answer_id": 52712260, "answer_count": 1, "score": 3, "last_activity_date": 1539050941, "creation_date": 1539047556, "last_edit_date": 1539050941, "question_id": 52712022, "link": "https://stackoverflow.com/questions/52712022/what-is-the-most-performant-way-to-rewrite-a-large-in-clause", "title": "What is the most performant way to rewrite a large IN clause?", "body": "<p>I wrote an API using go and gorm that runs calculations on our database and returns the results.</p>\n\n<p>I just hit the parameter limit for an <code>IN</code> condition when using an aggregate. Example query:</p>\n\n<pre><code>SELECT SUM(total_amount) from Table where user_id in(...70k parameters) group by user_id\n</code></pre>\n\n<p>One of my current edge cases has > 65535 user ids so my Postgres client is throwing an error:</p>\n\n<blockquote>\n<pre><code>got 66037 parameters but PostgreSQL only supports 65535 parameters\n</code></pre>\n</blockquote>\n\n<p>I'm not sure what the best way to approach this is. One that will handle the large amount of parameters for this edge case while not affecting my typical use case. Do I chunk the ids and iterate through multiple queries storing it in memory until I have all the data I need? Use <code>ANY(VALUES)</code>...</p>\n\n<p>Obviously from the query I have very limited knowledge of Postgres so any help would be incredibly appreciated.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-iam"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539092209, "post_id": 52711629, "comment_id": 92370106, "body": "In every AWS SDK, the way to use a machine role is to not specify any credentials. Machine role will be assumed by default if one is available on the VM."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1539124805, "post_id": 52711629, "comment_id": 92385590, "body": "oh but how do I create v4 new signer without specifying the credentials?"}], "answers": [{"tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 3, "last_activity_date": 1539044994, "creation_date": 1539044994, "answer_id": 52711747, "question_id": 52711629, "link": "https://stackoverflow.com/questions/52711629/aws-get-role-based-credentials-in-golang/52711747#52711747", "title": "AWS get role based credentials in golang", "body": "<p>I finally found another way using session.</p>\n\n<pre><code>config := aws.Config{\n    Region: aws.String(os.Getenv(\"AWS_REGION\")),\n}\nsess := session.Must(session.NewSession(&amp;config))    \nsigner := v4.NewSigner(sess.Config.Credentials)\n</code></pre>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1390, "favorite_count": 0, "accepted_answer_id": 52711747, "answer_count": 1, "score": 1, "last_activity_date": 1539044994, "creation_date": 1539043664, "question_id": 52711629, "link": "https://stackoverflow.com/questions/52711629/aws-get-role-based-credentials-in-golang", "title": "AWS get role based credentials in golang", "body": "<p>I want to use v4 signing for AWS requests. However, I need the credentials variable to use the signing process.</p>\n\n<p>Now, I can successfully sign the request using id and secret key (which I don't want to do).</p>\n\n<p>I have a lambda function that has a proper permission. So the question is how do I use that permission for my credentials variable?</p>\n\n<p>Here's what I tried using id and key</p>\n\n<pre><code>creds := credentials.NewStaticCredentials(os.Getenv(\"AWS_ACCESS_KEY_ID\"), os.Getenv(\"AWS_SECRET_ACCESS_KEY\"), \"\")\nsigner := v4.NewSigner(creds)\n</code></pre>\n\n<p>and I looked at the documentation at <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/</a></p>\n\n<p>which listed all the methods for creating credentials</p>\n\n<ul>\n<li><code>func NewChainCredentials(providers []Provider) *Credentials</code></li>\n<li><code>func NewCredentials(provider Provider) *Credentials</code></li>\n<li><code>func NewEnvCredentials() *Credentials</code></li>\n<li><code>func NewSharedCredentials(filename, profile string) *Credentials</code></li>\n<li><code>func NewStaticCredentials(id, secret, token string) *Credentials</code></li>\n<li><code>func NewStaticCredentialsFromCreds(creds Value) *Credentials</code></li>\n</ul>\n\n<p>Which method can I use for my use case?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1539064265, "post_id": 52711535, "comment_id": 92353786, "body": "I haven&#39;t seen any libraries that currently do this but I would guess you could use the call stack of the log function, looking at the prior frame and pulling the package from that?"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1539128586, "post_id": 52711535, "comment_id": 92386399, "body": "I will try to implement."}], "answers": [{"comments": [{"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1539128570, "post_id": 52716907, "comment_id": 92386396, "body": "Thanks for your explanation, I will try and will let know, if i am able to get something."}], "tags": [], "owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "is_accepted": false, "score": 1, "last_activity_date": 1539074891, "creation_date": 1539074891, "answer_id": 52716907, "question_id": 52711535, "link": "https://stackoverflow.com/questions/52711535/how-to-write-logs-into-multiple-files/52716907#52716907", "title": "How to write logs into multiple files?", "body": "<p>One approach you could take is to implement the <strong>Observer</strong> pattern. It's a great approach when you need to make several things happen with the same input/event. In your case, logging the same input to different logs. You can find more information <a href=\"https://github.com/tmrts/go-patterns/blob/master/behavioral/observer.md\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>In a situation you described and following this <a href=\"https://play.golang.org/p/cr8jEmDmw0\" rel=\"nofollow noreferrer\">example</a>, you can do following things:</p>\n\n<ol>\n<li>Your different logging implementations (with different logging destination folders) can implement the <code>Observer</code> interface by putting your logging code for each logging implementation in <code>OnNotify</code> method.</li>\n<li><p>Create an instance of <code>eventNotifier</code> and register all your logging implementations with <code>eventNotifier.Register</code> method. Something like:</p>\n\n<pre><code>  notifier := eventNotifier{\n     observers: map[Observer]struct{}{},\n  }\n\n  notifier.Register(netAppLogger)\n\n  notifier.Register(ibmLogger)\n</code></pre></li>\n<li><p>Use <code>eventNotifier.Notify</code> whenever and wherever you need to do logging and it will use all registered logging implementations.</p></li>\n</ol>\n"}], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539074891, "creation_date": 1539042936, "question_id": 52711535, "link": "https://stackoverflow.com/questions/52711535/how-to-write-logs-into-multiple-files", "title": "How to write logs into multiple files?", "body": "<p>In Golang how you guys manage to write logs into multiple file base on the package name.</p>\n\n<p>For example in my current app, I am trying to collect multiple hardware stats from different packages called Netapp, IBM etc but under the same application. So, I would like to write logs from those package in separate folder like /var/log/myapp/netapp.log and /var/log/myapp/ibm.log? </p>\n\n<p>Any pointer or clue would be very helpful ?</p>\n\n<p>Thanks James</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539092016, "post_id": 52711458, "comment_id": 92369963, "body": "Please check the command you&#39;re using to build. You&#39;re trying to build an object named <code>386</code>, the arguments and flags are out of order, and you should be building a package, not an individual file."}, {"owner": {"reputation": 35, "user_id": 3307731, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQuer.jpg?s=128&g=1", "display_name": "mangoman", "link": "https://stackoverflow.com/users/3307731/mangoman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539093317, "post_id": 52711458, "comment_id": 92370855, "body": "I agree I made a mistake, but then I passed cross compilation params like below.  <code>CGO_ENABLED=1 GOARCH=386 go build -o 386 insuanceCalculator.so -buildmode=c-shared .&#47;src&#47;packageName&#47;insuanceCalculator.go</code>  but now I am getting below error.  <code>In file included from &#47;usr&#47;include&#47;features.h:371,                  from &#47;usr&#47;include&#47;stdlib.h:25,                  from _cgo_export.c:2: &#47;usr&#47;include&#47;gnu&#47;stubs.h:7:27: error: gnu&#47;stubs-32.h: No such file or directory</code>  I believe it is looking for 32 bit C libraries?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539094432, "post_id": 52711458, "comment_id": 92371609, "body": "If you&#39;re compiling for 32bit with cgo, then it&#39;s going to look for 32bit C libraries. Make sure you can compile a 32bit C program on its own. (and your command still doesn&#39;t make sense, what is <code>insuanceCalculator.so</code> supposed to be doing in the arguments? See <code>go help build</code> for the appropriate options)"}, {"owner": {"reputation": 35, "user_id": 3307731, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQuer.jpg?s=128&g=1", "display_name": "mangoman", "link": "https://stackoverflow.com/users/3307731/mangoman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539095132, "post_id": 52711458, "comment_id": 92372071, "body": "And also, my project has more than one file with main() function, so I had to specify which file with main function I need to build the library from."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1539095253, "post_id": 52711458, "comment_id": 92372158, "body": "The go tools primarily are used on packages, so if you have multiple <code>main</code> functions, you need to separate those into proper packages. See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}], "owner": {"reputation": 35, "user_id": 3307731, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQuer.jpg?s=128&g=1", "display_name": "mangoman", "link": "https://stackoverflow.com/users/3307731/mangoman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 650, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1539042274, "creation_date": 1539042274, "question_id": 52711458, "link": "https://stackoverflow.com/questions/52711458/how-to-build-32-bit-c-shared-library-from-go-lang-code", "title": "How to build 32 bit c-shared library from go-lang code?", "body": "<p>I have a code go-lang which itself is a standalone application. But part of it I want to externalize as c-shared library for the consumers which are running on 32bit(386) architecture. I tried executing the below command, but it is failing.</p>\n\n<p><code>go build -o 386 insuanceCalculator.so -buildmode=c-shared ./src/packageName/insuanceCalculator.go</code></p>\n\n<p>And I am getting following error</p>\n\n<p><code>can't load package: package main: build constraints exclude all Go files in /Users/user1/Documents/go/insuranceCalcProject/src/packageName\nmake: *** [installLib] Error 1</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1539039418, "post_id": 52710882, "comment_id": 92348339, "body": "len on an array is a compile time constant and is therefore thread-safe.  If you meant to ask about len on a slice, then the answer is no."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1539040832, "post_id": 52710882, "comment_id": 92348664, "body": "yes sorry I meant slice"}], "answers": [{"comments": [{"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1539040812, "post_id": 52711026, "comment_id": 92348657, "body": "So it is a race for the exactness of the answer but if I&#39;m just interested in &quot;acceptable values&quot;  and no panics (such as read/write in a map) is it ok?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 1, "creation_date": 1539041046, "post_id": 52711026, "comment_id": 92348704, "body": "@Thomas: The results of a data race are undefined. Don&#39;t do it! See my reference for the perils of &quot;benign&quot; data races."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1539040807, "last_edit_date": 1539040807, "creation_date": 1539038681, "answer_id": 52711026, "question_id": 52710882, "link": "https://stackoverflow.com/questions/52710882/is-len-thread-safe-in-golang/52711026#52711026", "title": "Is len() thread safe in golang?", "body": "<p>It is a race condition. The results are undefined. For example,</p>\n\n<p><code>racer.go</code>:</p>\n\n<pre><code>package main\n\nfunc main() {\n    m := make(map[int]int)\n    l := 0\n    go func() {\n        for {\n            l = len(m)\n        }\n    }()\n    for i := 0; i &lt; 10000; i++ {\n        m[i] = i\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x00c00008e000 by goroutine 5:\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:8 +0x5f\n\nPrevious write at 0x00c00008e000 by main goroutine:\n  runtime.mapassign_fast64()\n      /home/peter/go/src/runtime/map_fast64.go:92 +0x0\n  main.main()\n      /home/peter/gopath/src/racer.go:12 +0xba\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:6 +0x92\n==================\nFound 1 data race(s)\nexit status 66\n$\n</code></pre>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Race_condition\" rel=\"nofollow noreferrer\">Wikipedia: Race condition</a></p>\n\n<p><a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">The Go Blog: Introducing the Go Race Detector</a></p>\n\n<p><a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go: Data Race Detector</a> </p>\n\n<p><a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">Benign Data Races: What Could Possibly Go Wrong?</a></p>\n"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1446, "favorite_count": 2, "accepted_answer_id": 52711026, "answer_count": 1, "score": 8, "last_activity_date": 1539040807, "creation_date": 1539037553, "question_id": 52710882, "link": "https://stackoverflow.com/questions/52710882/is-len-thread-safe-in-golang", "title": "Is len() thread safe in golang?", "body": "<p>I'm logging every second the length of a map; I don't care if I have the \"exact\" value / race conditions (off by one is ok). I'm interested to know if this could cause a panic and if I <strong>have</strong> to enclose <code>len()</code> with some <code>.RLock()/Unlock()</code> or not.</p>\n\n<p>I'm asking because <strong>concurrent reads/writes in a map will cause a panic</strong> (Go detects that) but I don't know if reading the length counts as a \"read\". I have tried with a test program but cannot produce a crash but I'd rather have an exact answer, at least for the sake of it.</p>\n\n<p>If it matters I'm interested in both len for arrays and for maps.\nThanks!</p>\n"}, {"tags": ["go", "filter", "routes", "gorilla"], "comments": [{"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1539028392, "post_id": 52709106, "comment_id": 92344579, "body": "The <a href=\"https://github.com/gorilla/mux#registered-urls\" rel=\"nofollow noreferrer\">documentation</a> states that: &quot;All variables defined in the route are required, and their values must conform to the corresponding patterns.&quot; Accordingly, you will probably have to register the routes multiple times to match each case."}], "answers": [{"comments": [{"owner": {"reputation": 518, "user_id": 8111821, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlLWJ.jpg?s=128&g=1", "display_name": "JD Allen", "link": "https://stackoverflow.com/users/8111821/jd-allen"}, "edited": false, "score": 0, "creation_date": 1604962886, "post_id": 52709743, "comment_id": 114502833, "body": "This doesn&#39;t work for me:  cannot use r.URL (type *url.URL) as type string in argument to url.Parse"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1539078582, "last_edit_date": 1539078582, "creation_date": 1539030932, "answer_id": 52709743, "question_id": 52709106, "link": "https://stackoverflow.com/questions/52709106/how-to-use-multiple-parameters-in-query-router/52709743#52709743", "title": "How to use multiple parameters in query router", "body": "<p>This is a little bit confusing in the beginning, but your route is always the same here:</p>\n\n<pre><code>  /applications/filter/?date=today\n  /applications/filter/?status=true\n  /applications/filter/?date=today&amp;status=true\n</code></pre>\n\n<p>It is always <code>/applications/filter/</code>.</p>\n\n<p>In that case you just need to map one route here. The handle func receives the <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">request</a>. Inside the request you can <a href=\"https://golang.org/pkg/net/url/#ParseQuery\" rel=\"nofollow noreferrer\">parse the url</a>.</p>\n\n<p><a href=\"https://play.golang.org/p/op49nTJSlCP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/op49nTJSlCP</a></p>\n\n<p>Putting all together it could look like:</p>\n\n<pre><code>router.HandleFunc(\"/applications/filter/\",func(w http.ResponseWriter,r *http.Request){\n    // in production you should handle the errors!\n    // I am just skipping this to keep the example simple\n    u, _ := url.Parse(r.URL)\n    v := u.Query()\n    if _,ok := v[date]; ok {\n        // do something with dae\n    }\n})\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2040, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1539078582, "creation_date": 1539027966, "last_edit_date": 1539063894, "question_id": 52709106, "link": "https://stackoverflow.com/questions/52709106/how-to-use-multiple-parameters-in-query-router", "title": "How to use multiple parameters in query router", "body": "<p>everybody!\nThe question is:\nHow to write  multiple parameters in query router, so I can write one, two or more parameters like this:</p>\n\n<pre><code>  /applications/filter/?date=today\n  /applications/filter/?status=true\n  /applications/filter/?date=today&amp;status=true\n</code></pre>\n\n<p>I tried this, but it does not work for single parameter, only for two: </p>\n\n<pre><code>router.HandleFunc(\"/applications/filter/\", authMiddle.RequiresLogin(authContrl.FilterDateStatus())).\n        Queries(\"date\", \"{date}\", \"status\", \"{status}\").Methods(\"GET\")\n</code></pre>\n"}, {"tags": ["json", "xml", "mongodb", "parsing", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539027944, "post_id": 52709030, "comment_id": 92344372, "body": "Go for interface for dynamic xml and there is no need to convert the xml to json and store into mongoDB. Better is to read the file into chunks and parse it into interface then store the data inside mongoDB."}, {"owner": {"reputation": 358, "user_id": 1813543, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zs0Ot.jpg?s=128&g=1", "display_name": "Beach Chicken", "link": "https://stackoverflow.com/users/1813543/beach-chicken"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539028295, "post_id": 52709030, "comment_id": 92344535, "body": "Would you mind explaining this a bit? If I understand you correctly you are saying just try to read the XML in a chunked fashion so I won&#39;t have to convert it to JSON and store it in mongoDB? Is this correct? If so, of course that is one way to do it, but I would prefer to store it in MongoDB so parsing it to JSON. This because the querying I have to do on this data."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 175019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a815a6dcad96dae8e73433369c40666?s=128&d=identicon&r=PG", "display_name": "Nigel Ainscoe", "link": "https://stackoverflow.com/users/175019/nigel-ainscoe"}, "edited": false, "score": 0, "creation_date": 1578683532, "post_id": 52710643, "comment_id": 105532090, "body": "This solution requires a fixed structure XML, i.e. Person needs to be defined as a struct and so does not answer the OPs question. I also have this problem and if I get a solution I will endeavor to post it here. Although my solution may be to use Python ;-)"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1539035869, "creation_date": 1539035869, "answer_id": 52710643, "question_id": 52709030, "link": "https://stackoverflow.com/questions/52709030/using-to-to-convert-large-xml-files-to-json-to-store-in-mongodb/52710643#52710643", "title": "Using to to convert large XML files to JSON to store in MongoDB", "body": "<p>Go provides a <a href=\"https://golang.org/pkg/encoding/xml/#Decoder\" rel=\"nofollow noreferrer\">builtin XML stream parser at <code>encoding/xml.Decoder</code></a>.</p>\n\n<p>A typical usage pattern is to read tokens until you find something of interest and then unmarshal the token into an XML tagged struct, then handle that data accordingly.  This way you're only loading into memory what is required for a single XML token <em>or</em> to unmarshal an interesting bit of data.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/sNuG2VVe1uv\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>d := xml.NewDecoder(xmlStream)\nfor {\n  // Decode the next token from the stream...\n  token, err := d.Token()\n  if err == io.EOF {\n    break\n  }\n  check(err)\n\n  // Switch behavior based on the token type.\n  switch el := token.(type) {\n  case xml.StartElement:\n    // Handle \"person\" start elements by unmarshaling from XML...\n    if el.Name.Local == \"person\" {\n      var p Person\n      err := d.DecodeElement(&amp;p, &amp;el)\n      check(err)\n\n      // ...then marshal to JSON...\n      jsonbytes, err := json.Marshal(p)\n      check(err)\n\n      // ...then take other action (e.g. insert into database).\n      fmt.Printf(\"OK: %s\\n\", string(jsonbytes))\n      // OK: {\"Id\":\"123\",\"Name\":\"Alice\",\"Age\":30}\n    }\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 358, "user_id": 1813543, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/zs0Ot.jpg?s=128&g=1", "display_name": "Beach Chicken", "link": "https://stackoverflow.com/users/1813543/beach-chicken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 526, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1539035869, "creation_date": 1539027652, "question_id": 52709030, "link": "https://stackoverflow.com/questions/52709030/using-to-to-convert-large-xml-files-to-json-to-store-in-mongodb", "title": "Using to to convert large XML files to JSON to store in MongoDB", "body": "<p>For a project of mine I have to deal with XML files over 2GB. I would like to store the data mongoDB. I have decided to give it a try using the Go language. But I have a bit of trouble figuring out the best way to do this in Go.</p>\n\n<p>I've seen a lot of examples with a fixed XML structure, but the data structure I get is dynamic, so using some kind of predefined struct isn't going to work for me.</p>\n\n<p>Now I stumbled upon this package: <a href=\"https://github.com/basgys/goxml2json\" rel=\"nofollow noreferrer\">https://github.com/basgys/goxml2json</a> which looks very promising, but there are a few things I don't get:</p>\n\n<ul>\n<li>The example given in the readme is using a XML string, but I don't see anything in the code that accepts a file.</li>\n<li>Given the example, I have 2GB xml files, I cannot simply load the whole XML file in memory. This would flud my server.</li>\n</ul>\n\n<p>I think it is good to say, I just have to convert the XML data just once to its JSON form so I can store it in mongoDB.</p>\n\n<p>Does some of you have some ideas on how to parse XML files efficiently to JSON using Go?</p>\n"}, {"tags": ["go", "ansible", "ansible-2.x", "ansible-inventory"], "comments": [{"owner": {"reputation": 3767, "user_id": 5431173, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5cc099bed59473fb573fe169561bc244?s=128&d=identicon&r=PG&f=1", "display_name": "Akshay Sood", "link": "https://stackoverflow.com/users/5431173/akshay-sood"}, "edited": false, "score": 0, "creation_date": 1539027168, "post_id": 52708857, "comment_id": 92344060, "body": "I already read that solution and it is not answering my question"}], "owner": {"reputation": 3767, "user_id": 5431173, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5cc099bed59473fb573fe169561bc244?s=128&d=identicon&r=PG&f=1", "display_name": "Akshay Sood", "link": "https://stackoverflow.com/users/5431173/akshay-sood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3622, "favorite_count": 0, "closed_date": 1539026883, "answer_count": 0, "score": 4, "last_activity_date": 1539055140, "creation_date": 1539026775, "last_edit_date": 1539055140, "question_id": 52708857, "link": "https://stackoverflow.com/questions/52708857/get-output-of-ansible-task-in-proper-readable-format-like-json", "closed_reason": "Duplicate", "title": "Get output of ansible task in proper readable format like JSON", "body": "<p>I am trying to read a content of file. Lets say I have a hosts file in <code>/etc/hosts</code>. I want to read the content of the file. When I run ansible playbook it contains several logs containing task name and symbols.</p>\n\n<p>ansible playbook file:</p>\n\n<pre><code>- hosts: all\n  remote_user: \"{{ ansible_user }}\"\n  vars:\n    ansible_become_pass: \"{{ ansible_ssh_pass }}\"\n\n  tasks:\n    - name: Read file\n      command: cat /etc/hosts\n      register: response\n\n    - debug: msg=\"Content of file is {{ response }}\"\n</code></pre>\n\n<p>Logs emitted by ansible:</p>\n\n<pre><code>$ ansible-playbook -i inventory.yml playbook.yml \n\nPLAY [all] *************************************************************************************************************************************************************************************************\n\nTASK [Gathering Facts] *************************************************************************************************************************************************************************************\nok: [18.222.139.140]\n\nTASK [Read file] *******************************************************************************************************************************************************************************************\nchanged: [18.222.139.140]\n\nTASK [debug] ***********************************************************************************************************************************************************************************************\nok: [18.222.139.140] =&gt; {\n    \"msg\": \"Content of file is {'stderr_lines': [], u'changed': True, u'end': u'2018-10-08 19:21:52.968466', 'failed': False, u'stdout': u'127.0.0.1 localhost\\\\n\\\\n# The following lines are desirable for IPv6 capable hosts\\\\n::1 ip6-localhost ip6-loopback\\\\nfe00::0 ip6-localnet\\\\nff00::0 ip6-mcastprefix\\\\nff02::1 ip6-allnodes\\\\nff02::2 ip6-allrouters\\\\nff02::3 ip6-allhosts\\\\nHii just testing', u'cmd': [u'cat', u'/etc/hosts'], u'rc': 0, u'start': u'2018-10-08 19:21:52.966509', u'stderr': u'', u'delta': u'0:00:00.001957', 'stdout_lines': [u'127.0.0.1 localhost', u'', u'# The following lines are desirable for IPv6 capable hosts', u'::1 ip6-localhost ip6-loopback', u'fe00::0 ip6-localnet', u'ff00::0 ip6-mcastprefix', u'ff02::1 ip6-allnodes', u'ff02::2 ip6-allrouters', u'ff02::3 ip6-allhosts', u'Hii just testing']}\"\n}\n\nPLAY RECAP *************************************************************************************************************************************************************************************************\n18.222.139.140             : ok=3    changed=1    unreachable=0    failed=0   \n</code></pre>\n\n<p>The issue is, I just want this output </p>\n\n<pre><code>{\n  \"msg\": \"Content of file is {'stderr_lines': [], u'changed': True, u'end': u'2018- \n  10-08 19:21:52.968466', 'failed': False, u'stdout': u'127.0.0.1 localhost\\\\n\\\\n# \n  The following lines are desirable for IPv6 capable hosts\\\\n::1 ip6-localhost ip6- \n  loopback\\\\nfe00::0 ip6-localnet\\\\nff00::0 ip6-mcastprefix\\\\nff02::1 ip6- \n  allnodes\\\\nff02::2 ip6-allrouters\\\\nff02::3 ip6-allhosts\\\\nHii just testing', \n  u'cmd': [u'cat', u'/etc/hosts'], u'rc': 0, u'start': u'2018-10-08 19:21:52.966509', \n  u'stderr': u'', u'delta': u'0:00:00.001957', 'stdout_lines': [u'127.0.0.1 \n  localhost', u'', u'# The following lines are desirable for IPv6 capable hosts', \n  u'::1 ip6-localhost ip6-loopback', u'fe00::0 ip6-localnet', u'ff00::0 ip6- \n  mcastprefix', u'ff02::1 ip6-allnodes', u'ff02::2 ip6-allrouters', u'ff02::3 ip6- \n  allhosts', u'Hii just testing']}\"\n}\n</code></pre>\n\n<p>or any other output that can be parsed through a program.</p>\n\n<p>Any help/suggestion would be appreciated.</p>\n\n<p>I am using go-lang to invoke <code>ansible-playbook</code> command</p>\n"}, {"tags": ["http", "go", "testing"], "answers": [{"tags": [], "owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "is_accepted": true, "score": 2, "last_activity_date": 1539023901, "creation_date": 1539023901, "answer_id": 52708262, "question_id": 52707948, "link": "https://stackoverflow.com/questions/52707948/how-to-test-http-requests-in-go/52708262#52708262", "title": "How to test http requests in go", "body": "<p>You could use <code>httptest.NewServer</code></p>\n\n<pre><code>func TestDeleteApp(t *testing.T) {\n    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintln(w, \"Hello, client\")\n    }))\n    defer ts.Close()\n\n    baseURL = ts.URL + \"/\"\n\n    DeleteApp(\"platform\", \"hostname\", \"header\")\n\n}\n</code></pre>\n\n<p>This rewrites your global <code>baseURL</code>, so it can't be a const (you might want to just pass it as a parameter). You can write test assertions in the <code>http.HandlerFunc</code> or based on the response.</p>\n"}], "owner": {"reputation": 151, "user_id": 5959651, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/195fa12ab8961f3ae65ce685060794a3?s=128&d=identicon&r=PG&f=1", "display_name": "Lin0523", "link": "https://stackoverflow.com/users/5959651/lin0523"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 52708262, "answer_count": 1, "score": 0, "last_activity_date": 1539023901, "creation_date": 1539022442, "question_id": 52707948, "link": "https://stackoverflow.com/questions/52707948/how-to-test-http-requests-in-go", "title": "How to test http requests in go", "body": "<p>I have a go package that is basically a wrapper for a python API. I'm not sure how to test the errors for http.NewRequest, client.Do, and ioutil.ReadAll. I know that httptest exists but I'm pretty new to go and I could not get it to work. Any help would be appreciated!</p>\n\n<pre><code>func DeleteApp(platform string, hostname string, header string) error {\n\nif platform == \"\" || hostname == \"\" {\n    fmt.Printf(\"[DELETE APP] Platform and hostname can not be empty strings\")\n    return errors.New(\"[DELETE APP] Platform and hostname can not be empty strings\")\n}\nurl := fmt.Sprintf(baseURL+\"delete-app/%s/%s\", platform, hostname)\n\n// Create client &amp; set timeout\nclient := &amp;http.Client{}\nclient.Timeout = time.Second * 15\n\n// Create request\nreq, err := http.NewRequest(\"DELETE\", url, nil)\nif err != nil {\n    fmt.Printf(\"[DELETE APP] Could not create request : %v\", err)\n    return err\n}\n\n//check for optional header\nif header != \"\" {\n    req.Header.Add(\"X-Fields\", header)\n}\n\n// Fetch Request\nresp, err := client.Do(req)\nif err != nil {\n    fmt.Printf(\"[DELETE APP] Could not fetch request : %v\", err)\n    return err\n}\ndefer resp.Body.Close()\n\n//Read Response Body\nrespBody, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    fmt.Printf(\"[DELETE APP] Could not read response body : %v\", err)\n    return err\n}\n\nfmt.Println(\"response Status : \", resp.Status)\nfmt.Println(\"response Headers : \", resp.Header)\nfmt.Println(\"response Body : \", string(respBody))\n\nreturn nil\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1539020478, "post_id": 52707474, "comment_id": 92341226, "body": "You have to specifically <code>go get</code> each of the packages it is saying are not on your system (e.g. <code>go get github.com&#47;disintegration&#47;imaging</code>). It does not make any attempt to retrieve them automatically. That would be VERY BAD from a security standpoint if it just arbitrarily downloaded code from the internet and compiled it."}, {"owner": {"reputation": 2675, "user_id": 451726, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d1ad7c4d445fc9cedacdefeb2b5e213e?s=128&d=identicon&r=PG", "display_name": "404 Not Found", "link": "https://stackoverflow.com/users/451726/404-not-found"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539020613, "post_id": 52707474, "comment_id": 92341294, "body": "I&#39;ll try that, but I&#39;m still curious why go isn&#39;t doing it automatically now? When I first cloned the project and ran <code>go build</code> it started downloading all of the packages. What artifact is still present that is preventing go from getting them?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1539020828, "post_id": 52707474, "comment_id": 92341376, "body": "Because I could make a legit library, get thousands of people to use it, then decide to be malicious after hooking people, add <b>one line</b> to any of the source files to import a malicious external repo, and it would then automatically retrieve it, compile it, and subsequently people would run it. I&#39;m pretty sure you remember incorrectly, as I can&#39;t imagine it ever automatically downloading 3rd party code."}, {"owner": {"reputation": 2675, "user_id": 451726, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d1ad7c4d445fc9cedacdefeb2b5e213e?s=128&d=identicon&r=PG", "display_name": "404 Not Found", "link": "https://stackoverflow.com/users/451726/404-not-found"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539022069, "post_id": 52707474, "comment_id": 92341961, "body": "Perhaps because I&#39;m new to Go, I&#39;m misunderstanding the output, but this is what happened the first time: <a href=\"https://pastebin.com/GAPPZRu7\" rel=\"nofollow noreferrer\">pastebin.com/GAPPZRu7</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2675, "user_id": 451726, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d1ad7c4d445fc9cedacdefeb2b5e213e?s=128&d=identicon&r=PG", "display_name": "404 Not Found", "link": "https://stackoverflow.com/users/451726/404-not-found"}, "is_accepted": false, "score": 0, "last_activity_date": 1539023124, "creation_date": 1539023124, "answer_id": 52708088, "question_id": 52707474, "link": "https://stackoverflow.com/questions/52707474/force-redownload-completely-clean-environment/52708088#52708088", "title": "Force redownload/completely clean environment", "body": "<p>After reading up to respond to comments, I stumbled upon the <code>go mod verify</code> command which appears to have fixed my issues. </p>\n"}], "owner": {"reputation": 2675, "user_id": 451726, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d1ad7c4d445fc9cedacdefeb2b5e213e?s=128&d=identicon&r=PG", "display_name": "404 Not Found", "link": "https://stackoverflow.com/users/451726/404-not-found"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1539063878, "creation_date": 1539020363, "last_edit_date": 1539063878, "question_id": 52707474, "link": "https://stackoverflow.com/questions/52707474/force-redownload-completely-clean-environment", "title": "Force redownload/completely clean environment", "body": "<p>First off, I have no experience with go, I'm just trying to build a project from github. </p>\n\n<p>My problem: When I use <code>go build</code> in a cloned go project I get a bunch of errors like this:</p>\n\n<pre><code>transform.go:28:2: cannot find package \"github.com/disintegration/imaging\" in any of:\n        /usr/lib/go/src/github.com/disintegration/imaging (from $GOROOT)\n        /home/marcus/go/src/github.com/disintegration/imaging (from $GOPATH)\nimageproxy.go:34:2: cannot find package \"github.com/gregjones/httpcache\" in any of:\n        /usr/lib/go/src/github.com/gregjones/httpcache (from $GOROOT)\n        /home/marcus/go/src/github.com/gregjones/httpcache (from $GOPATH)\ntransform.go:29:2: cannot find package \"github.com/muesli/smartcrop\" in any of:\n        /usr/lib/go/src/github.com/muesli/smartcrop (from $GOROOT)\n        /home/marcus/go/src/github.com/muesli/smartcrop (from $GOPATH)\n</code></pre>\n\n<p>What happened: I broke everything because I started deleting random directories hoping to fix a different issue I was having. I deleted my <code>~/go</code> directory, and the <code>~/.cache/go-build</code> directory. </p>\n\n<p>What I've tried: So far, besides the deletions that caused the problem, I've tried <code>go clean -cache -modcache</code>; Adding the <code>-r</code> flag produces the same errors as above. <code>go build -a</code> also produces the same errors. I have also tried reinstalling go with <code>pacman -S go</code>. </p>\n\n<p>My <code>go env</code> is:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/home/marcus/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/marcus/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build315222728=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>I know I was doing things unexpected, but I'm surprised Go is struggling here. How can I make Go realize that the packages are not present <em>and that it should fix that by downloading them</em>? Or, how can I clean my environment to remove whatever artifacts are still present that are making Go think the packages should still exist? </p>\n"}, {"tags": ["go", "append", "2d", "slice"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1539016682, "post_id": 52706495, "comment_id": 92339543, "body": "By specifying a size using <code>[number]</code> notation, you are not creating a slice, you are creating an array."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1539017044, "post_id": 52706495, "comment_id": 92339713, "body": "One question, why are you using arrays/slices for this in the first place? This seems more a job for a single dimensional slice full of structs that contain, and thus provide a name for, each of the fields instead of an index. That&#39;s better for readability, but again, it depends on <b>why</b> you want/need to use arrays/slices."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 0, "creation_date": 1539017075, "post_id": 52706495, "comment_id": 92339729, "body": "oh crap, that explains why i&#39;m struggling so much. But then, my problem remains, is there a way to append data to a 2D array ? or is it simpler to delete my zeros when i&#39;m done ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1539017142, "post_id": 52706495, "comment_id": 92339763, "body": "You cannot append or delete elements from an array because arrays are fixed size.  It sounds like a slice is more appropriate here."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1539017958, "post_id": 52706495, "comment_id": 92340118, "body": "Go has no 2D slices (or arrays as in your actual code). Only slices of slices, or arrays of arrays."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 0, "creation_date": 1539022093, "post_id": 52706881, "comment_id": 92341973, "body": "with this method, can I append a row in 2 shots ? meaning i append the first 3 columns of a row, then do something else, then come back and complete the last 3 columns ?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 1, "creation_date": 1539023567, "post_id": 52706881, "comment_id": 92342610, "body": "@Hugues yes. If the <code>row</code> struct is still in scope after &quot;doing something else&quot;, you can just set the values. If not, you just need to know the index of the row you are working on and could access it that way, e.g. <code>rows[i].More = 1.1</code> You can <code>append</code> the <code>row</code> to the slice at any point in time and still modify it later by index too, if you wish."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 1, "last_activity_date": 1539018112, "last_edit_date": 1539018112, "creation_date": 1539017620, "answer_id": 52706881, "question_id": 52706495, "link": "https://stackoverflow.com/questions/52706495/how-to-append-to-a-2d-slice/52706881#52706881", "title": "How to append to a 2d slice", "body": "<p>For better readability, and easier slice handling, just create a struct type and fill a slice with them. This allows you to properly name each field instead of magic index numbers and makes it easier to fill in the rows as well as utilize later. Unless there is some specific reason to use arrays/slices for the columns, this is more idiomatic Go. The following example would fill a slice with however many results you have, and no more.</p>\n\n<p>Full example here: <a href=\"https://play.golang.org/p/mLtabqO8MNj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mLtabqO8MNj</a></p>\n\n<pre><code>type Row struct {\n    Thing   float64\n    Data    float64\n    More    float64\n    Stuff   float64\n    Another float64\n    Number  float64\n}\n\nvar rows []*Row\n\nnumResults := 15\nfor i := 0; i &lt;= numResults; i++ {\n    row := &amp;Row{}\n    row.Thing = 2.5\n    // ... fill values\n    rows = append(rows, row)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539019121, "post_id": 52706985, "comment_id": 92340625, "body": "I like the note you added. If you use arrays specifically, you <b>must</b> then write your own code that utilizes it. There is practically nothing in any library that natively utilizes arrays in their exported APIs."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539019244, "post_id": 52706985, "comment_id": 92340678, "body": "@RayfenWindspear I am sorry but I did not get your point, the note that I have written is specific to golang. That&#39;s why you always see slices in places of arrays in libraries created for golang. Also Slice are much comfortable to use from developer point of view since you need not to worry about the length since it grows according to requirement using build in function append."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539019433, "post_id": 52706985, "comment_id": 92340776, "body": "The point of my comment was Go uses slices everywhere, as such, if you write your code using arrays for some reason, you are going to have to continue to write your own code to use them. Nowhere else will be using them, so you can&#39;t simply pass them into another library. i.e. Don&#39;t use arrays."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1539019524, "post_id": 52706985, "comment_id": 92340823, "body": "@RayfenWindspear oh I get it. You are absolutely right in this case. Slices are used every where in place of arrays."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 0, "creation_date": 1539021459, "post_id": 52706985, "comment_id": 92341659, "body": "@Himanshu, the only thing i&#39;m not sure of is: i have 6 columns, i compute the data for the first 3 columns, then, I compute some more data that depends on the first 3 columns to get to the last 3 columns. Can I append  the first 3 columns of a row first, then later on write the last 3 columns of that same row ? Or I can only append to a new row ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 1, "creation_date": 1539022777, "post_id": 52706985, "comment_id": 92342260, "body": "@Hugues yes you can just create one more temp slice and append it to the first one temp slice and then append the whole slice to the parent slice."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1539027204, "last_edit_date": 1539027204, "creation_date": 1539018094, "answer_id": 52706985, "question_id": 52706495, "link": "https://stackoverflow.com/questions/52706495/how-to-append-to-a-2d-slice/52706985#52706985", "title": "How to append to a 2d slice", "body": "<p>In Golang slices are preferred in place of arrays.</p>\n\n<p>Creating so many rows in prior is not required, just create a slice every time you are looping over your data to add a new row in the parent slice. That will help you to have only required number of rows and you need to worry about the length Since you are appending a slice at an index of parent slice. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\nfunc main() {\n    orders := make([][]float64, 0) // create my 2d slice with zeros\n    for i := 0; i &lt;= 6; i++ {\n        value := rand.Float64()\n        temp := make([]float64, 0)\n        temp = append(temp, value)\n        orders = append(orders, [][]float64{temp}...)\n    }\n    fmt.Println(orders)\n}\n</code></pre>\n\n<p>Please check working code on <a href=\"https://play.golang.org/p/ReDIvH_l85b\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>If you notice I am creating a new <code>temp</code> slice in loop which contains the <code>float64</code> value and then appending value to the temp slice which I have passed to the parent slice.</p>\n\n<p>So everytime I append the temp slice to the parent slice a new row will be created.</p>\n\n<p><strong>Note:</strong></p>\n\n<blockquote>\n  <p>Arrays have their place, but they're a bit inflexible, so you don't\n  see them too often in Go code. Slices, though, are everywhere. They\n  build on arrays to provide great power and convenience.</p>\n</blockquote>\n\n<p><strong>Edited:</strong></p>\n\n<p>To work on first 3 columns and then manipulate the values for next 3 columns which will be added to the temp slice and appended to the main slice. Use below code logic:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"strconv\"\n)\n\nfunc main() {\n    orders := make([][]float64, 0) // create my 2d slice with zeros\n    for i := 0; i &lt;= 6; i++ {\n        value := rand.Float64()\n        // logic to create first 3 columns\n        temp := make([]float64, 0)\n        temp = append(temp, value)\n\n        temp2 := make([]float64, 3)\n\n        // logic to create next 3 columns on basis of previous 3 columns\n        for j, value := range temp {\n            addcounter, _ := strconv.ParseFloat(\"1\", 64)\n            temp2[j] = value + addcounter\n        }\n\n        temp = append(temp, temp2...)\n        orders = append(orders, [][]float64{temp}...)\n    }\n    fmt.Println(orders)\n}\n</code></pre>\n\n<p>Working <a href=\"https://play.golang.org/p/4EiDI0aHwjf\" rel=\"nofollow noreferrer\">Example</a></p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 0, "creation_date": 1539023026, "post_id": 52707943, "comment_id": 92342360, "body": "with this method, can I append a row in 2 shots ? meaning i append the first 3 columns of a row, then do something else, then come back and complete the last 3 columns of that same row ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 0, "creation_date": 1539023344, "post_id": 52707943, "comment_id": 92342497, "body": "I assumed that rows all contain 6 elements based on comments from other questions. Is that correct?   If so, there&#39;s no need to append more values with this answer."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "edited": false, "score": 1, "creation_date": 1539024012, "post_id": 52707943, "comment_id": 92342795, "body": "Each row in this answer is a six element array.  The elements that are not explicitly set in the composite literal are initialized to zero. You can access the elements of the array at any time using an index expression like <code>orders[i][3]</code>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1539023231, "last_edit_date": 1539023231, "creation_date": 1539022419, "answer_id": 52707943, "question_id": 52706495, "link": "https://stackoverflow.com/questions/52706495/how-to-append-to-a-2d-slice/52707943#52707943", "title": "How to append to a 2d slice", "body": "<p>Given that the outer container has an unknown number of elements and the inner container has exactly six elements, use a slice of arrays.</p>\n\n<pre><code>var orders [][6]float64\nfor i := start_line; i &lt;= end_line; i++ {\n    if sell_signal == \"1\" {\n        n, err = strconv.ParseFloat(df[i][11], 64)\n        if err != nil {\n            // handle error\n        }\n        orders = append(orders, [6]float64{1: float64(i + 1), 2: n})\n    }\n}\n</code></pre>\n\n<p>This code uses a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> [6]float64 value instead of assigning element by element as in the question.</p>\n\n<p>You can come back and access elements of the [6]float64 at a later time.  For example:</p>\n\n<pre><code> orders[i][3] = orders[i][1] + orders[i][2]\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3182, "favorite_count": 0, "accepted_answer_id": 52707943, "answer_count": 3, "score": 0, "last_activity_date": 1539027693, "creation_date": 1539016009, "last_edit_date": 1539027693, "question_id": 52706495, "link": "https://stackoverflow.com/questions/52706495/how-to-append-to-a-2d-slice", "title": "How to append to a 2d slice", "body": "<p>I have data that is created rows by rows, 6 columns, I don't know the final number of rows in advance.</p>\n\n<p>Currently i'm creating a 2D slice of 200x6 with all zeros and then i replace these zeros gradually with my data, row by row. The data comes from another dataframe df</p>\n\n<p>It works but i don't like to end up with the last rows of my slice full of zeros. I see 2 solutions:\n- I delete all the last rows with only zeros when I'm done\n- I create an empty slice and append my data progressively to it</p>\n\n<p>I tried various things but could not figure out how to code any of these 2 solutions.</p>\n\n<p>Currently my code looks like this:</p>\n\n<pre><code>var orders [200][6]float64  // create my 2d slice with zeros\norder_line := 0\n\nfor i := start_line; i &lt;= end_line; i++ {\n    if sell_signal == \"1\" {\n        //record line number and sold price in orders slice\n        orders[order_line][1] =  float64(i+1)\n        orders[order_line][2],err = strconv.ParseFloat(df[i][11], 64)\n        order_line = order_line + 1\n     }\n}\n</code></pre>\n\n<p>I looked at the Append command, but I tried all sorts of combinations to make it work on a 2d slice, could not find one that works.</p>\n\n<p>edit: from the comments below I understand that i'm actually creating an array, not a slice, and there is no way to append data to an array.</p>\n"}, {"tags": ["dictionary", "if-statement", "go", "syntax"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1539014479, "post_id": 52705926, "comment_id": 92338578, "body": "The <a href=\"https://tour.golang.org/moretypes/22\" rel=\"nofollow noreferrer\">two-value form of map lookups is covered in the tour</a>, as are <a href=\"https://tour.golang.org/flowcontrol/6\" rel=\"nofollow noreferrer\">statements before if conditions</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1539020293, "post_id": 52705926, "comment_id": 92341151, "body": "Why not take the Tour of Go?"}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 8704430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e348ef7b41694b6635199391d860889e?s=128&d=identicon&r=PG&f=1", "display_name": "user40176", "link": "https://stackoverflow.com/users/8704430/user40176"}, "edited": false, "score": 0, "creation_date": 1539014426, "post_id": 52705976, "comment_id": 92338550, "body": "So, I can see in either case that <code>temp</code> must be assigned <code>superhero[&quot;Superman&quot;]</code>.  And in your code, it is more clear what the other variable is doing. But what precisely does <code>ok</code> get assigned to...and why? How else might this sort of syntax show up in Golang?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 153, "user_id": 8704430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e348ef7b41694b6635199391d860889e?s=128&d=identicon&r=PG&f=1", "display_name": "user40176", "link": "https://stackoverflow.com/users/8704430/user40176"}, "edited": false, "score": 0, "creation_date": 1539019502, "post_id": 52705976, "comment_id": 92340812, "body": "Have a read of effective go (linked above) for more info. this is known as the comma, ok idiom. ok is assigned true if there is a value for this key in the map, or false if there is not  (in this case &quot;Superman&quot; is the key)."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1539014211, "last_edit_date": 1539014211, "creation_date": 1539013994, "answer_id": 52705976, "question_id": 52705926, "link": "https://stackoverflow.com/questions/52705926/golang-syntax-in-if-statement-with-a-map/52705976#52705976", "title": "Golang syntax in &quot;if&quot; statement with a map", "body": "<p>It's more normal to use ok for the boolean variable name. This is equivalent to: </p>\n\n<pre><code>temp, ok := superhero[\"Superman\"]\nif ok {\n    fmt.Println(temp[\"realname\"], temp[\"city\"])\n}\n</code></pre>\n\n<p>The ok is true if there was a key in the map. So there are two forms of map access built into the language, and two forms of this statement. Personally I think this slightly more verbose form with one more line of code is much clearer, but you can use either.So the other form would be: </p>\n\n<pre><code>if temp, ok := superhero[\"Superman\"]; ok {\n    fmt.Println(temp[\"realname\"], temp[\"city\"])\n}\n</code></pre>\n\n<p>As above. For more see <a href=\"https://golang.org/doc/effective_go.html#maps\" rel=\"nofollow noreferrer\">effective go</a> here: </p>\n\n<blockquote>\n  <p>For obvious reasons this is called the \u201ccomma ok\u201d idiom. In this\n  example, if the key is present, the value will be set appropriately and ok\n  will be true; if not, the value will be set to zero and ok will be\n  false. </p>\n</blockquote>\n\n<p>The two forms for accessing maps are: </p>\n\n<pre><code>// value and ok set if key is present, else ok is false\nvalue, ok := map[key]\n\n// value set if key is present\nvalue := map[key]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1539015465, "last_edit_date": 1539015465, "creation_date": 1539014319, "answer_id": 52706075, "question_id": 52705926, "link": "https://stackoverflow.com/questions/52705926/golang-syntax-in-if-statement-with-a-map/52706075#52706075", "title": "Golang syntax in &quot;if&quot; statement with a map", "body": "<p>A two-value assignment tests for the existence of a key: </p>\n\n<pre><code>i, ok := m[\"route\"]\n</code></pre>\n\n<blockquote>\n  <p>In this statement, the first value (i) is assigned the value stored\n  under the key \"route\". If that key doesn't exist, i is the value\n  type's zero value (0). The second value (ok) is a bool that is true if\n  the key exists in the map, and false if not.</p>\n</blockquote>\n\n<p>This check is basically used when we are not confirmed about the data inside the map. So we just check for a particular key and if it exists we assign the value to variable. It is a O(1) check.</p>\n\n<p>In your example try to search for a key inside the map which does not exists as:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    // We can store multiple items in a map as well\n\n    superhero := map[string]map[string]string{\n        \"Superman\": map[string]string{\n            \"realname\": \"Clark Kent\",\n            \"city\":     \"Metropolis\",\n        },\n\n        \"Batman\": map[string]string{\n            \"realname\": \"Bruce Wayne\",\n            \"city\":     \"Gotham City\",\n        },\n    }\n\n    // We can output data where the key matches Superman\n\n    if temp, hero := superhero[\"Superman\"]; hero {\n        fmt.Println(temp[\"realname\"], temp[\"city\"])\n    }\n\n    // try to search for a key which doesnot exist\n\n    if value, ok := superhero[\"Hulk\"]; ok {\n        fmt.Println(value)\n    } else {\n        fmt.Println(\"key not found\")\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/F_Ow0PoKXEP\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}, {"tags": [], "owner": {"reputation": 1948, "user_id": 8690313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-hQ93tpA6Lmk/AAAAAAAAAAI/AAAAAAAAB2I/7F3CoNnnhts/photo.jpg?sz=128", "display_name": "Prajval M", "link": "https://stackoverflow.com/users/8690313/prajval-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1539016491, "last_edit_date": 1539016491, "creation_date": 1539015635, "answer_id": 52706406, "question_id": 52705926, "link": "https://stackoverflow.com/questions/52705926/golang-syntax-in-if-statement-with-a-map/52706406#52706406", "title": "Golang syntax in &quot;if&quot; statement with a map", "body": "<pre><code>if temp, hero := superhero[\"Superman\"]; hero\n</code></pre>\n\n<p>in go is similar to writing:</p>\n\n<pre><code>temp, hero := superhero[\"Superman\"]\nif hero {\n    ....\n}\n</code></pre>\n\n<p>Here is <strong>\"Superman\"</strong> is mapped to a value, hero will be <code>true</code> </p>\n\n<p>else <code>false</code></p>\n\n<p>In go every query to a map will return an optional second argument which will tell if a certain key is present or not</p>\n\n<p><a href=\"https://play.golang.org/p/Hl7MajLJV3T\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Hl7MajLJV3T</a></p>\n"}], "owner": {"reputation": 153, "user_id": 8704430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e348ef7b41694b6635199391d860889e?s=128&d=identicon&r=PG&f=1", "display_name": "user40176", "link": "https://stackoverflow.com/users/8704430/user40176"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2118, "favorite_count": 0, "accepted_answer_id": 52706075, "answer_count": 3, "score": 1, "last_activity_date": 1539016491, "creation_date": 1539013817, "question_id": 52705926, "link": "https://stackoverflow.com/questions/52705926/golang-syntax-in-if-statement-with-a-map", "title": "Golang syntax in &quot;if&quot; statement with a map", "body": "<p>I am reading a tutorial here: <a href=\"http://www.newthinktank.com/2015/02/go-programming-tutorial/\" rel=\"nofollow noreferrer\">http://www.newthinktank.com/2015/02/go-programming-tutorial/</a></p>\n\n<p>On the \"Maps in Maps\" section it has:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    // We can store multiple items in a map as well\n\n    superhero := map[string]map[string]string{\n        \"Superman\": map[string]string{\n            \"realname\":\"Clark Kent\",\n            \"city\":\"Metropolis\",\n        },\n\n        \"Batman\": map[string]string{\n            \"realname\":\"Bruce Wayne\",\n            \"city\":\"Gotham City\",\n        },\n    }\n\n    // We can output data where the key matches Superman\n\n    if temp, hero := superhero[\"Superman\"]; hero {\n        fmt.Println(temp[\"realname\"], temp[\"city\"])\n    }\n\n}\n</code></pre>\n\n<p>I don't understand the \"if\" statement. Can someone walk me through the syntax on this line:</p>\n\n<pre><code>if temp, hero := superhero[\"Superman\"]; hero {\n</code></pre>\n\n<p>Like <code>if temp</code> seems nonsensical to an outsider as temp isn't even defined anywhere. What would that even accomplish? Then <code>hero := superhero[\"Superman\"]</code> looks like an assignment. But what is the semicolon doing? why is the final <code>hero</code> there?</p>\n\n<p>Can someone help a newbie out?</p>\n\n<p>Many thanks.</p>\n"}, {"tags": ["mongodb", "go", "type-conversion", "mongo-go"], "comments": [{"owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "edited": false, "score": 1, "creation_date": 1539012661, "post_id": 52705553, "comment_id": 92337606, "body": "have you tried the <code>NewArray()</code>? See the example <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#example-Array\" rel=\"nofollow noreferrer\">godoc.org/github.com/mongodb/mongo-go-driver/bson#example-Ar&zwnj;&#8203;ray</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 2, "creation_date": 1549731916, "post_id": 52705612, "comment_id": 96011953, "body": "This no longer appears to work and your NewArray link just goes to the top of the documentation page."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1549811894, "last_edit_date": 1549811894, "creation_date": 1539012627, "answer_id": 52705612, "question_id": 52705553, "link": "https://stackoverflow.com/questions/52705553/convert-a-string-slice-to-a-bson-array/52705612#52705612", "title": "Convert a string slice to a BSON array", "body": "<p>Edit: The code in the question and this answer is no longer relevant because the bson.Array type was deleted from the package. At the time of this edit, the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#A\" rel=\"nofollow noreferrer\">bson.A</a> and basic slice operations should be used to construct arrays. </p>\n\n<p>Use the factory function <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#NewArray\" rel=\"nofollow noreferrer\">NewArray</a> to create the array:</p>\n\n<pre><code>result := bson.NewArray()\nfor _, data := range myData {\n        value := bson.VC.String(data)\n        result.Append(value)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 10764663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e14bea69a4a2f6bcd0e3473549ba56de?s=128&d=identicon&r=PG&f=1", "display_name": "Dai Maou", "link": "https://stackoverflow.com/users/10764663/dai-maou"}, "is_accepted": false, "score": 1, "last_activity_date": 1576649382, "creation_date": 1576649382, "answer_id": 59386346, "question_id": 52705553, "link": "https://stackoverflow.com/questions/52705553/convert-a-string-slice-to-a-bson-array/59386346#59386346", "title": "Convert a string slice to a BSON array", "body": "<p>As mentioned by @Cerise bson.Array has since been deleted. I do this with multiple utility functions as follows:</p>\n\n<pre><code>func BSONStringA(sa []string) (result bson.A) {\n  result = bson.A{}\n  for_, e := range sa {\n    result = append(result, e)\n  }\n  return\n}\n\nfunc BSONIntA(ia []string) (result bson.A) {\n  // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 561, "user_id": 3564720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KiSNg.jpg?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/3564720/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1593, "favorite_count": 0, "accepted_answer_id": 52705612, "answer_count": 2, "score": 1, "last_activity_date": 1576649382, "creation_date": 1539012444, "last_edit_date": 1539012515, "question_id": 52705553, "link": "https://stackoverflow.com/questions/52705553/convert-a-string-slice-to-a-bson-array", "title": "Convert a string slice to a BSON array", "body": "<p>I am trying to insert an array into a MongoDB instance using Go. I have the <code>[] string</code> slice in Go and want to convert it into a <code>BSON</code> array to pass it to the DB using the <code>github.com/mongodb/mongo-go-driver</code> driver.</p>\n\n<pre><code>var result bson.Array\n    for _, data := range myData {\n        value := bson.VC.String(data)\n        result.Append(value)\n}\n</code></pre>\n\n<p>This loops over each element of my input data and tries to append it to the <code>BSON</code> array. However the line with the <code>Append()</code> fails with <code>panic: document is nil</code>. How should I do this conversion?</p>\n"}, {"tags": ["go", "apache-kafka", "apache-kafka-streams", "sarama"], "answers": [{"comments": [{"owner": {"reputation": 1307, "user_id": 2761700, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/eknnf.jpg?s=128&g=1", "display_name": "scandel", "link": "https://stackoverflow.com/users/2761700/scandel"}, "edited": false, "score": 1, "creation_date": 1539076710, "post_id": 52707313, "comment_id": 92360307, "body": "Yes! Thank you so much. And also, didn&#39;t need the line <code>Timestamp: time.Now()</code>. In fact &quot;Timestamp is the timestamp assigned to the message by the broker&quot; (<a href=\"https://godoc.org/github.com/Shopify/sarama#ProducerMessage\" rel=\"nofollow noreferrer\">documentation</a>)."}], "tags": [], "owner": {"reputation": 18208, "user_id": 1765189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673318e1268e43679dc9ab6835a39604?s=128&d=identicon&r=PG", "display_name": "Mickael Maison", "link": "https://stackoverflow.com/users/1765189/mickael-maison"}, "is_accepted": true, "score": 4, "last_activity_date": 1539019597, "creation_date": 1539019597, "answer_id": 52707313, "question_id": 52704889, "link": "https://stackoverflow.com/questions/52704889/invalid-timestamp-when-writing-a-kafka-producer-with-sarama/52707313#52707313", "title": "Invalid Timestamp when writing a Kafka producer with sarama", "body": "<p>Sarama defaults to Kafka Version 0.8.2. It means it will use the old 0.8.2 format requests when talking to brokers.</p>\n\n<p>As timestamp support was only added in 0.10, if you don't specify a Version >= 0.10 explicitly, your timestamp won't be forwarded to the brokers.</p>\n\n<p>You need to add <code>config.Version = sarama.V0_10_0_0</code> to your code and timestamps will work.</p>\n"}], "owner": {"reputation": 1307, "user_id": 2761700, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/eknnf.jpg?s=128&g=1", "display_name": "scandel", "link": "https://stackoverflow.com/users/2761700/scandel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2182, "favorite_count": 1, "accepted_answer_id": 52707313, "answer_count": 1, "score": 2, "last_activity_date": 1539019597, "creation_date": 1539010284, "question_id": 52704889, "link": "https://stackoverflow.com/questions/52704889/invalid-timestamp-when-writing-a-kafka-producer-with-sarama", "title": "Invalid Timestamp when writing a Kafka producer with sarama", "body": "<p>I have a Kafka instance running (locally, in a Docker) and I created a producer in Go, using the <a href=\"https://godoc.org/github.com/Shopify/sarama\" rel=\"nofollow noreferrer\">sarama package</a>.</p>\n\n<p>As I want to use Kafka Streams on my topic, the producer has to embed a timestamp in the messages, or I get this ugly error message: </p>\n\n<blockquote>\n  <p>org.apache.kafka.streams.errors.StreamsException: Input record\n  ConsumerRecord(topic = crawler_events, partition = 0, offset = 0,\n  CreateTime = -1, serialized key size = -1, serialized value size =\n  187, headers = RecordHeaders(headers = [], isReadOnly = false), key =\n  null, value = {XXX}) has invalid (negative)\n  timestamp. Possibly because a pre-0.10 producer client was used to\n  write this record to Kafka without embedding a timestamp, or because\n  the input topic was created before upgrading the Kafka cluster to\n  0.10+. Use a different TimestampExtractor to process this data.</p>\n</blockquote>\n\n<p>Here is the portion of code sending the message in my Go program: </p>\n\n<pre class=\"lang-go prettyprint-override\"><code>// Init a connection to the Kafka host,\n// create the producer,\n// and count successes and errors in delivery\nfunc (c *kafkaClient) init() {\n    config := sarama.NewConfig()\n    config.Producer.Return.Successes = true\n    c.config = *config\n    var err error\n    c.producer, err = sarama.NewAsyncProducer(c.hosts, &amp;c.config)\n    if err != nil {\n        panic(err)\n    }\n    go func() {\n        for range c.producer.Successes() {\n            c.successes++\n        }\n    }()\n    go func() {\n        for range c.producer.Errors() {\n            c.errors++\n        }\n    }()\n}\n\n// Send a message to the Kafka topic, WITH TIMESTAMP\nfunc (c *kafkaClient) send(event string) {\n    message := &amp;sarama.ProducerMessage{\n        Topic: c.topic,\n        Value: sarama.StringEncoder(event),\n        Timestamp: time.Now(),\n    }\n    c.producer.Input() &lt;- message\n    c.enqueued++\n}\n</code></pre>\n\n<p>As you can see, the timestamp I try to send is <code>time.Now()</code>. </p>\n\n<p>When I run the console consumer to see the received timestamps:</p>\n\n<pre><code>docker-compose exec kafka /opt/kafka/bin/kafka-console-consumer.sh \\\n  --bootstrap-server localhost:9092 --topic crawler_events \\\n  --from-beginning --property print.timestamp=true\n</code></pre>\n\n<p>I see they are all \"-1\": </p>\n\n<pre><code>CreateTime:-1   {\"XXX\"}\n</code></pre>\n\n<p>When adding a message to the topic with the console producer, I have the expected timestamps like: </p>\n\n<pre><code>CreateTime:1539010180284        hello\n</code></pre>\n\n<p>What am I doing wrong? Thanks for your help. </p>\n"}, {"tags": ["go", "grpc", "http2"], "comments": [{"owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 1, "creation_date": 1539010266, "post_id": 52704727, "comment_id": 92336254, "body": "Nope, but there&#39;s an open PR with a marshaller that would support it: <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/pull/548/files\" rel=\"nofollow noreferrer\">github.com/grpc-ecosystem/grpc-gateway/pull/548/files</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1539010268, "post_id": 52704727, "comment_id": 92336258, "body": "You said it yourself: grpc-gateway expects JSON. If you give it form encoded data (or anything other than JSON, really) it&#39;s going to complain."}, {"owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 0, "creation_date": 1539010285, "post_id": 52704727, "comment_id": 92336274, "body": "More discussion: <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/issues/7\" rel=\"nofollow noreferrer\">github.com/grpc-ecosystem/grpc-gateway/issues/7</a>"}, {"owner": {"reputation": 952, "user_id": 2091965, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/1c1285c630291af3766d5b8c6cd80a15?s=128&d=identicon&r=PG", "display_name": "eignhpants", "link": "https://stackoverflow.com/users/2091965/eignhpants"}, "reply_to_user": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 0, "creation_date": 1539010793, "post_id": 52704727, "comment_id": 92336595, "body": "@maxm would I need to fork the runtime itself to use this proposed marshaller? Or can it be added &#39;in-place&#39; somewhere? I am not very experienced with gRPC and golang yet."}, {"owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 0, "creation_date": 1539011061, "post_id": 52704727, "comment_id": 92336758, "body": "Presumably you can just build from this fork: <a href=\"https://github.com/jinleileiking/grpc-gateway\" rel=\"nofollow noreferrer\">github.com/jinleileiking/grpc-gateway</a>. But the code doesn&#39;t have any tests written against it and it&#39;s entirely unclear if it works."}, {"owner": {"reputation": 952, "user_id": 2091965, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/1c1285c630291af3766d5b8c6cd80a15?s=128&d=identicon&r=PG", "display_name": "eignhpants", "link": "https://stackoverflow.com/users/2091965/eignhpants"}, "edited": false, "score": 0, "creation_date": 1539011171, "post_id": 52704727, "comment_id": 92336810, "body": "Yea my problem is this is in a highly automated system, and for reasons that would be a lot of trouble. Is there any &quot;simple&quot; way to get at the raw request body? Even as a string or something? The solutions in the posted threads have led me no where (or didn&#39;t work in the system/beyond my current skill level)."}], "owner": {"reputation": 952, "user_id": 2091965, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/1c1285c630291af3766d5b8c6cd80a15?s=128&d=identicon&r=PG", "display_name": "eignhpants", "link": "https://stackoverflow.com/users/2091965/eignhpants"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 670, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1539009741, "creation_date": 1539009741, "question_id": 52704727, "link": "https://stackoverflow.com/questions/52704727/can-grpc-support-x-www-form-encoded-data", "title": "Can gRPC support `x-www-form-encoded` data?", "body": "<p>I am trying to accept a POST request from an external service, but the data is <code>x-www-form-encoded</code> data. Our system is gRPC, but we use <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"nofollow noreferrer\">grpc-gateway</a> to pass json rest requests. </p>\n\n<p>If I add to following to my <code>.proto</code> file</p>\n\n<pre><code>rpc Action(ActionRequest) returns (ActionResponse) {\n    option (google.api.http) = {\n        post: \"/v1/action\"\n        body: \"*\"\n    };\n}\n</code></pre>\n\n<p>Any messages I try and create will fail with </p>\n\n<pre><code>`invalid character 'p' looking for beginning of value - Error: rpc error: code = InvalidArgument desc = invalid character 'p' looking for beginning of value`\n</code></pre>\n\n<p>This makes sense as 'p' is the first character of the <code>x-www-form-encoded</code> data (payload is the object name).</p>\n\n<p>It would so far appear I don't have access to the raw request body, and it seems it may be possible with a custom marshaller that feels like overkill, and probably out of scope.</p>\n\n<p>However I cannot for the life of me see how to access this data. I <a href=\"https://github.com/googleapis/googleapis/blob/master/google/api/httpbody.proto\" rel=\"nofollow noreferrer\">have tried adding another proto from googleapis</a>. However I have found the documentation for this aspect of gRPC difficult to follow and I may be doing it wrong.</p>\n"}, {"tags": ["go", "heroku"], "answers": [{"comments": [{"owner": {"reputation": 6612, "user_id": 1401202, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/c6c31f018cbb2c264b877339b9568568?s=128&d=identicon&r=PG", "display_name": "kpg", "link": "https://stackoverflow.com/users/1401202/kpg"}, "edited": false, "score": 0, "creation_date": 1539060529, "post_id": 52705079, "comment_id": 92352696, "body": "I am running to install after making the changes and restarting the server."}, {"owner": {"reputation": 6612, "user_id": 1401202, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/c6c31f018cbb2c264b877339b9568568?s=128&d=identicon&r=PG", "display_name": "kpg", "link": "https://stackoverflow.com/users/1401202/kpg"}, "edited": false, "score": 0, "creation_date": 1539076400, "post_id": 52705079, "comment_id": 92360121, "body": "Running the go server directly works correctly, so I guess the problem must lie with Heroku somehow."}], "tags": [], "owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "is_accepted": false, "score": 0, "last_activity_date": 1539010952, "creation_date": 1539010952, "answer_id": 52705079, "question_id": 52704150, "link": "https://stackoverflow.com/questions/52704150/how-can-i-see-the-changes-i-make-to-a-go-app-running-in-heroku-local/52705079#52705079", "title": "How can I see the changes I make to a Go app running in Heroku local?", "body": "<p>Every time you make a change to a Go file in the project you need to run <code>go install</code> and stop and restart the heroku local server.</p>\n\n<p>You might want to just run the server yourself with <code>PORT=5000 go run main.go</code> so that you only have to restart one thing. Or you can check out something like <a href=\"https://github.com/pilu/fresh\" rel=\"nofollow noreferrer\">https://github.com/pilu/fresh</a> which will listen to filesystem changes and restart your server for you.</p>\n"}], "owner": {"reputation": 6612, "user_id": 1401202, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/c6c31f018cbb2c264b877339b9568568?s=128&d=identicon&r=PG", "display_name": "kpg", "link": "https://stackoverflow.com/users/1401202/kpg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539060619, "creation_date": 1539007802, "last_edit_date": 1539060619, "question_id": 52704150, "link": "https://stackoverflow.com/questions/52704150/how-can-i-see-the-changes-i-make-to-a-go-app-running-in-heroku-local", "title": "How can I see the changes I make to a Go app running in Heroku local?", "body": "<p>I admit I'm a GoLang newbie. In an attempt to learn Go, I developed an app about a year ago (based on <a href=\"https://github.com/heroku/go-getting-started\" rel=\"nofollow noreferrer\">the Heroku Getting started repository</a>) and deployed it to Heroku. I used the <code>heroku local</code> server to develop it locally and deployed it successfully. Now I want to make some changes but I don't have the original source, so I have cloned the app from the Heroku repository.</p>\n\n<p>I have got it running locally with the following steps:</p>\n\n<ol>\n<li><code>export GOPATH=~/project_path</code></li>\n<li><code>export GOBIN=$GOPATH/bin</code></li>\n<li><code>go get</code></li>\n<li><code>go install</code></li>\n<li><code>heroku local</code></li>\n</ol>\n\n<p>So far, so good. The problem is that when I make a simple change to the code in <code>main.go</code>, it doesn't show up in the browser. I've tried running <code>go install</code> and restarting the server after making the change but it makes no difference.</p>\n\n<p>I've noticed that the file name in the Procfile is now incorrect (<code>go-getting-started</code> instead of the name of my project folder) but the server still runs and changing the name doesn't make any difference, locally at least. Same goes for the Dockerfile.</p>\n\n<p>What am I doing wrong please?</p>\n"}, {"tags": ["java", "string", "go", "messageformat"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539010203, "post_id": 52704113, "comment_id": 92336213, "body": "I tried to format your code, but there are some significant errors in it so that I cannot guess what your are trying to do. Please format your code properly and try to formulate a precise question."}, {"owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539010649, "post_id": 52704113, "comment_id": 92336503, "body": "here is executed code in Java: <a href=\"http://tpcg.io/7P5ih4\" rel=\"nofollow noreferrer\">tpcg.io/7P5ih4</a>"}, {"owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539010812, "post_id": 52704113, "comment_id": 92336603, "body": "@mbuechmann one i tired in Go <a href=\"https://play.golang.org/p/O_wUZjQ4Ux3\" rel=\"nofollow noreferrer\">play.golang.org/p/O_wUZjQ4Ux3</a>"}, {"owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1539011013, "post_id": 52704113, "comment_id": 92336729, "body": "@mbuechmann i have copied the links , i am looking for the similar thing done in java in Golang"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1539015978, "last_edit_date": 1539015978, "creation_date": 1539010888, "answer_id": 52705059, "question_id": 52704113, "link": "https://stackoverflow.com/questions/52704113/message-format-in-java-and-how-to-replicate-the-same-in-golang/52705059#52705059", "title": "Message format in java and how to replicate the same in Golang", "body": "<p>This is detailed at <a href=\"https://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html\" rel=\"nofollow noreferrer\"><code>java.text.MessageFormat</code></a>. The string you pass to <a href=\"https://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html#format-java.lang.String-java.lang.Object...-\" rel=\"nofollow noreferrer\"><code>MessageFormat.format()</code></a> is a <em>pattern</em>. A pattern consists of <em>format elements</em>. The form of a format element is:</p>\n\n<pre><code> FormatElement:\n         { ArgumentIndex }\n         { ArgumentIndex , FormatType }\n         { ArgumentIndex , FormatType , FormatStyle }\n</code></pre>\n\n<p>So in the first format element:</p>\n\n<pre><code>{0,number,#}\n</code></pre>\n\n<p><code>0</code> is the argument index whose value to format.</p>\n\n<p><code>number</code> is a format type, and <code>#</code> is a format style, more specifically a <em>subformat pattern</em>. This means the argument will be formatted using a subformat of:</p>\n\n<pre><code>new DecimalFormat(subformatPattern, DecimalFormatSymbols.getInstance(getLocale()))\n</code></pre>\n\n<p>The <code>#</code> subformat is described at <a href=\"https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html\" rel=\"nofollow noreferrer\"><code>java.text.DecimalFormat</code></a>. It simply means to not use fraction digits, only display it as an integer, and if it is not an integer, it will be rounded (using the <a href=\"https://docs.oracle.com/javase/8/docs/api/java/math/RoundingMode.html#HALF_EVEN\" rel=\"nofollow noreferrer\"><code>RoundingMode.HALF_EVEN</code></a> mode).</p>\n\n<p>In Go to format an integer number, you may simply use the <code>%d</code> verb as you did, which will yield the same output format for integer numbers. If the number is a floating point number, this won't work (<code>%d</code> can only be used for integers). If the number is a floating point number, use the <code>%f</code> verb, more specifically <code>%.0f</code> to tell it to round to an integer, or the shortest form <code>%.f</code>.</p>\n\n<p>Also your Java version puts the last argument in double quotes, so you should do the same in Go.</p>\n\n<pre><code>value := fmt.Sprintf(\"%d,%s,%s,%s,\\\"%s\\\"\",\n    0,\n    \"5bb2b35c67525f9e845648df370652b8\",\n    \"Vm:vm-289\",\n    \"1.1.1.1:113\", \"ABC-Testvm-1\")\n\nfmt.Println(value)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/o9Vatozde6_d\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0,5bb2b35c67525f9e845648df370652b8,Vm:vm-289,1.1.1.1:113,\"ABC-Testvm-1\"\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 1, "accepted_answer_id": 52705059, "answer_count": 1, "score": 1, "last_activity_date": 1539015978, "creation_date": 1539007686, "last_edit_date": 1539011072, "question_id": 52704113, "link": "https://stackoverflow.com/questions/52704113/message-format-in-java-and-how-to-replicate-the-same-in-golang", "title": "Message format in java and how to replicate the same in Golang", "body": "<p>Here's the Java code:</p>\n\n<pre><code>AtomicInteger obIndex = new AtomicInteger(0);\nMessageFormat.format(\"{0,number,#},{1},{2},{3},\\\"{4}\\\"\",\n    obIndex.getAndIncrement(),\n    \"5bb2b35c67525f9e845648df370652b8\",\n    \"Vm:vm-289\",\n    \"1.1.1.1:113\",\n    \"ABC-Testvm-1\");\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0,5bb2b35c67525f9e845648df370652b8,Vm:vm-289,1.1.1.1:113,\"ABC-Testvm-1\"\n</code></pre>\n\n<p>I tried this in Go:</p>\n\n<pre><code>value := fmt.Sprintf(\"%d,%s,%s,%s,%s\",\n    0,\n    \"5bb2b35c67525f9e845648df370652b8\",\n    \"Vm:vm-289\",\n    \"1.1.1.1:113\", \"ABC-Testvm-1\")\nfmt.Println(value)\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>0,5bb2b35c67525f9e845648df370652b8,Vm:vm-289,1.1.1.1:113,ABC-Testvm-1\n</code></pre>\n\n<p>What is the significance of <code>{0,number,#}</code> and how can I get the same in Go?</p>\n"}, {"tags": ["go", "merge", "concatenation"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539008118, "post_id": 52704109, "comment_id": 92334976, "body": "open a file write to buffer and append the buffer data to another file."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 10452537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s0V2Q.jpg?s=128&g=1", "display_name": "JohnPatel23", "link": "https://stackoverflow.com/users/10452537/johnpatel23"}, "edited": false, "score": 0, "creation_date": 1539009330, "post_id": 52704395, "comment_id": 92335724, "body": "Thanks William Poussier, Your clear and concise answer has opened my eyes:)  Appreciate it!"}, {"owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "edited": false, "score": 0, "creation_date": 1603291261, "post_id": 52704395, "comment_id": 113991490, "body": "If you are planning to automate this process somehow you may want to replace <code>OpenFile()</code> with <code>Create()</code>..."}], "tags": [], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "is_accepted": true, "score": 3, "last_activity_date": 1539008616, "creation_date": 1539008616, "answer_id": 52704395, "question_id": 52704109, "link": "https://stackoverflow.com/questions/52704109/how-to-merge-or-combine-2-files-into-single-file/52704395#52704395", "title": "How to merge or combine 2 files into single file", "body": "<p>Based on your question, you want to create a new file with the content of both files.</p>\n\n<p>You can use <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\">io.Copy</a> to achieve that.</p>\n\n<p>Here is a simple command-line tool implementing it.</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    if len(os.Args) != 4 {\n        log.Fatalln(\"Usage: %s &lt;zip&gt; &lt;signed&gt; &lt;output&gt;\\n\", os.Args[0])\n    }\n    zipName, signedName, output := os.Args[1], os.Args[2], os.Args[3]\n\n    zipIn, err := os.Open(zipName)\n    if err != nil {\n        log.Fatalln(\"failed to open zip for reading:\", err)\n    }\n    defer zipIn.Close()\n\n    signedIn, err := os.Open(signedName)\n    if err != nil {\n        log.Fatalln(\"failed to open signed for reading:\", err)\n    }\n    defer signedIn.Close()\n\n    out, err := os.OpenFile(output, os.O_CREATE|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatalln(\"failed to open outpout file:\", err)\n    }\n    defer out.Close()\n\n    n, err := io.Copy(out, zipIn)\n    if err != nil {\n        log.Fatalln(\"failed to append zip file to output:\", err)\n    }\n    log.Printf(\"wrote %d bytes of %s to %s\\n\", n, zipName, output)\n\n    n, err = io.Copy(out, signedIn)\n    if err != nil {\n        log.Fatalln(\"failed to append signed file to output:\", err)\n    }\n    log.Printf(\"wrote %d bytes of %s to %s\\n\", n, signedName, output)\n}\n</code></pre>\n\n<p>Basically, it open both files you want to merge, create a new one and copy the content of each file to the new file.</p>\n"}], "owner": {"reputation": 47, "user_id": 10452537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s0V2Q.jpg?s=128&g=1", "display_name": "JohnPatel23", "link": "https://stackoverflow.com/users/10452537/johnpatel23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3192, "favorite_count": 0, "accepted_answer_id": 52704395, "answer_count": 1, "score": 0, "last_activity_date": 1539018017, "creation_date": 1539007667, "last_edit_date": 1539018017, "question_id": 52704109, "link": "https://stackoverflow.com/questions/52704109/how-to-merge-or-combine-2-files-into-single-file", "title": "How to merge or combine 2 files into single file", "body": "<p>I need to take tmp1.zip and append it's tmp1.signed file to the end of it; creating a new tmp1.zip.signed file using Go. \nIt's essentially same as cat   | sc \nI could call cmd line from Go, but that seems super inefficient (and cheesy).</p>\n\n<p><strong>So far</strong></p>\n\n<p>Google-ing the words \"go combine files\" et. al. yields minimal help.  </p>\n\n<p>But I have come across a couple of options that I have tried such as ..</p>\n\n<pre><code>    f, err := os.OpenFile(\"tmp1.txt\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\nif err != nil {\n    log.Fatal(err)\n}\nif _, err := f.Write([]byte(\"appended some data\\n\")); err != nil {\n    log.Fatal(err)\n}\nif err := f.Close(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>But that is just getting strings added to the end of the file, not really merging the two files, or appending the signature to the original file.</p>\n\n<p><strong>Question</strong></p>\n\n<p>Assuming I am asking the right questions to get one file appended to another, Is there a better sample of how exactly to merge two files into one using Go?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 4, "creation_date": 1539003074, "post_id": 52702722, "comment_id": 92331904, "body": "you are getting 400 http status code in your response try to print the errors do not skip them when you are creating the request."}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1539064640, "post_id": 52702722, "comment_id": 92353925, "body": "The most likely reason is that your query parameters are not URL encoded."}], "owner": {"reputation": 33, "user_id": 9963364, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uxL_-UHkgpY/AAAAAAAAAAI/AAAAAAAAAAw/SKL1UAEGf_M/photo.jpg?sz=128", "display_name": "Dipikanta Dutta", "link": "https://stackoverflow.com/users/9963364/dipikanta-dutta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 304, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1539003944, "creation_date": 1539002948, "last_edit_date": 1539003944, "question_id": 52702722, "link": "https://stackoverflow.com/questions/52702722/how-to-fetch-data-from-a-third-party-using-rest-api-in-golang", "title": "How to fetch data from a third party using REST Api in golang", "body": "<p>I am trying to get data from another application using REST Api. I am able to login and get the token value but not able to get the data.</p>\n\n<p>Below is my code:</p>\n\n<pre><code>func main() {\n    url := \"https://******.***.****.**:***/api/jwt/login\"\n    payload := strings.NewReader(\"username=****&amp;password=****\")\n    req, _ := http.NewRequest(\"POST\", url, payload)\n    req.Header.Add(\"content-type\", \"application/x-www-form-urlencoded\")\n    req.Header.Add(\"cache-control\", \"no-cache\")\n    res, _ := http.DefaultClient.Do(req)\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n    s := string(body)\n    fmt.Println(res)\n    fmt.Println(string(body))\n    var token = \"AR-JWT \"+s \n    url1 := \"https://***.***.**.**:**/api/arsys/v1/entry/HPD:Help Desk/?q='Last Resolved Date' &gt;= \\\"01/09/2018\\\"&amp;fields=values(Incident Number,Customer Login ID,Last       Resolved Date,Assigned Group)\"\n    req1, _ := http.NewRequest(http.MethodGet, url1, nil)\n    req1.Header.Set(\"authorization\", token)\n    req1.Header.Set(\"cache-control\", \"no-cache\")\n    req1.Header.Set(\"Content-Type\", \"application/json\")\n    res1, _ := http.DefaultClient.Do(req1)\n    defer res1.Body.Close()\n    body1, _ := ioutil.ReadAll(res1.Body)\n    fmt.Println(res1)\n    fmt.Println(string(body1))\n}\n</code></pre>\n\n<p>I can get the result \"body\" but not the data. Below is the error:</p>\n\n<pre><code>&amp;{400 Unknown Version 400 HTTP/1.1 1 1 map[Content-Length:[0]] 0xc04211c0c0 0 [] true false map[] 0xc042106100 0xc042180160} \n</code></pre>\n\n<p>Can anyone please tell me where am I going wrong?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539003567, "post_id": 52702590, "comment_id": 92332218, "body": "what is the error you are getting and where are the structs that you want to compare."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1539012146, "last_edit_date": 1539012146, "creation_date": 1539007914, "answer_id": 52704179, "question_id": 52702590, "link": "https://stackoverflow.com/questions/52702590/recursively-expanding-struct-definition-containing-pointers/52704179#52704179", "title": "Recursively expanding struct definition containing pointers", "body": "<p>If the field type is a pointer, then use the element type of the pointer.  Otherwise, the logic is the same as in the linked question.</p>\n\n<pre><code>func printFields(prefix string, t reflect.Type) {\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        fmt.Printf(\"%v%v %v\\n\", prefix, f.Name, f.Type)\n        ft := f.Type\n        if ft.Kind() == reflect.Ptr {\n            ft = ft.Elem()\n        }\n        if ft.Kind() == reflect.Struct {\n            printFields(fmt.Sprintf(\"  %v\", prefix), ft)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/y5qs0Yi5sFe\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>The following code handles the more general case where the fields can be arrays, slices, channels, pointers or combinations of these kinds.</p>\n\n<pre><code>func printFields(prefix string, t reflect.Type) {\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        fmt.Printf(\"%v%v %v\\n\", prefix, f.Name, f.Type)\n        ft := f.Type\n        for ft.Kind() == reflect.Ptr ||\n            ft.Kind() == reflect.Slice ||\n            ft.Kind() == reflect.Array ||\n            ft.Kind() == reflect.Chan {\n            ft = ft.Elem()\n        }\n        if ft.Kind() == reflect.Struct {\n            printFields(fmt.Sprintf(\"  %v\", prefix), ft)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/o-55S28Je59\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 603, "user_id": 3583807, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33621d98b061051b0523a49d493a9281?s=128&d=identicon&r=PG&f=1", "display_name": "user3583807", "link": "https://stackoverflow.com/users/3583807/user3583807"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27, "favorite_count": 0, "accepted_answer_id": 52704179, "answer_count": 1, "score": 0, "last_activity_date": 1539073269, "creation_date": 1539002573, "last_edit_date": 1539073269, "question_id": 52702590, "link": "https://stackoverflow.com/questions/52702590/recursively-expanding-struct-definition-containing-pointers", "title": "Recursively expanding struct definition containing pointers", "body": "<p>This question based on following:\n<a href=\"https://stackoverflow.com/questions/42819318/recursively-expanding-struct-definition\">go reflection deeply in struct</a>\nI need same thing - expand struct definition to pass it then as JSON object but with only difference that struct contains pointers to another structs. So, provided code unable to handle that. I tried to modify it in following way:</p>\n\n<pre><code>func printFields(prefix string, t reflect.Type) {\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        fmt.Printf(\"%v%v %v\\n\", prefix, f.Name, f.Type)\n        if f.Type.Kind() == reflect.Struct {\n            fmt.Println(reflect.New(f.Type))\n            printFields(fmt.Sprintf(\"  %v\", prefix), f.Type)\n        } else if f.Type.Kind() == reflect.Ptr {\n            fmt.Println(\"type \", f.Type )\n            printFields(fmt.Sprintf(\"  %v\", prefix), f.Type)\n        }\n    }\n}\n</code></pre>\n\n<p>But it falls to panic in a case of pointers. How to fix that? </p>\n\n<p>EDIT:\ngot what I needed:</p>\n\n<pre><code>func printFields(prefix string, t reflect.Type) {\n    if t.Kind() != reflect.Struct {\n        return\n    }\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        fmt.Printf(\"%v%v %v\\n\", prefix, f.Name, f.Type)\n        if f.Type.Kind() == reflect.Struct {\n            fmt.Println(reflect.New(f.Type))\n            printFields(fmt.Sprintf(\"  %v\", prefix), f.Type)\n        } else if f.Type.Kind() == reflect.Ptr {\n            printFields(fmt.Sprintf(\"  %v\", prefix), f.Type.Elem())\n        }\n    }\n}\n\nfunc printExpandedStruct(s interface{}) {\n    printFields(\"\", reflect.ValueOf(s).Type())\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1539002106, "post_id": 52702419, "comment_id": 92331326, "body": "Why do you want to escape the <code>1</code>?"}, {"owner": {"reputation": 41, "user_id": 10473064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e958240a96a19ebc5cb08584832ef8e?s=128&d=identicon&r=PG&f=1", "display_name": "yutian", "link": "https://stackoverflow.com/users/10473064/yutian"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1539002474, "post_id": 52702419, "comment_id": 92331528, "body": "I want to reference the group (\\d), &#39;\\1&#39; can work with python and cpp. How to do in golang?"}, {"owner": {"reputation": 512, "user_id": 1430191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E1uBA.png?s=128&g=1", "display_name": "Vadim Pashkov", "link": "https://stackoverflow.com/users/1430191/vadim-pashkov"}, "edited": false, "score": 1, "creation_date": 1539017480, "post_id": 52702419, "comment_id": 92339896, "body": "Hi! I think this could be helpful for you: <a href=\"https://stackoverflow.com/questions/23968992/how-to-match-a-regex-with-backreference-in-go\" title=\"how to match a regex with backreference in go\">stackoverflow.com/questions/23968992/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 115430, "user_id": 47529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aaee40db39ad6b164cfb89cb6ad4d176?s=128&d=identicon&r=PG", "display_name": "chaos", "link": "https://stackoverflow.com/users/47529/chaos"}, "is_accepted": false, "score": 0, "last_activity_date": 1599172148, "creation_date": 1599172148, "answer_id": 63732470, "question_id": 52702419, "link": "https://stackoverflow.com/questions/52702419/how-to-reference-group-with-golang-regex/63732470#63732470", "title": "how to reference group with golang regex", "body": "<p>golang's RE2 engine does not support backreferences.</p>\n"}], "owner": {"reputation": 41, "user_id": 10473064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e958240a96a19ebc5cb08584832ef8e?s=128&d=identicon&r=PG&f=1", "display_name": "yutian", "link": "https://stackoverflow.com/users/10473064/yutian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1599172148, "creation_date": 1539002002, "last_edit_date": 1539189943, "question_id": 52702419, "link": "https://stackoverflow.com/questions/52702419/how-to-reference-group-with-golang-regex", "title": "how to reference group with golang regex", "body": "<p>I want to match some repeated number like 1111, but '\\1' is  invalid escape sequence in golang. How to do that?</p>\n\n<pre><code>reg := regexp.MustCompile(`(\\d)\\1{3}`)\n</code></pre>\n"}, {"tags": ["go", "unzip", "zipfile"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1538997396, "post_id": 52700695, "comment_id": 92328498, "body": "You already did. <code>buf</code> contains the file contents."}, {"owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1538998285, "post_id": 52700695, "comment_id": 92328997, "body": "Thank you @Peter. I&#39;ve got the content, but I don&#39;t know how to dump it into a file. Because I need to be able to access this content later. I&#39;m trying and I can&#39;t find the correct way."}, {"owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1538999779, "post_id": 52700695, "comment_id": 92329868, "body": "Thank you, I know how to read the documentation and I don&#39;t know how your answer can help.  I have tried: <code>ioutil.WriteFile(&quot;.&#47;sentinel&#47;validations&#47;&quot;+f.Name, buf ,os.ModePerm)</code>. But I get: <code>37mDEBU[0m[0000] cloneValidations - Starting 31mFATA[0m[0000] flate: corrupt input before offset 4</code>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1539003650, "post_id": 52700695, "comment_id": 92332264, "body": "It seems every time I comment you change the question. <code>ioutil.WriteFile</code> will not produce an error message that starts with <code>&quot;flate:&quot;</code>. I would expect that from either the <code>f.Open</code> or <code>ioutil.ReadAll</code> call, but your question suggests that both are successful. It&#39;s really not clear what you&#39;re asking here."}], "answers": [{"tags": [], "owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1539013673, "creation_date": 1539013673, "answer_id": 52705890, "question_id": 52700695, "link": "https://stackoverflow.com/questions/52700695/unzip-password-zip-using-golang/52705890#52705890", "title": "Unzip password zip using golang", "body": "<p>I finally managed to decompress the contents of the zip. I wasn't getting all the files correctly because it didn't differentiate from the paths to the files directly.</p>\n\n<p>I have solved it in the following way:</p>\n\n<pre><code>r, err := zip.OpenReader(\"./path/to/the.zip\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer r.Close()\n\nfor _, f := range r.File {\n    if f.IsEncrypted() {\n        f.SetPassword(\"$83?ksdfkjsdKJHJKjdH/_B)+}C`\")\n    }\n    r, err := f.Open()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    buf, err := ioutil.ReadAll(r)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer r.Close()\n\n    if f.FileInfo().IsDir() {\n        // Make Folder\n        os.MkdirAll(fpath, os.ModePerm)\n    } else {\n        ioutil.WriteFile(\"./sentinel/validations/\"+f.Name, buf ,os.ModePerm)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1207, "favorite_count": 0, "accepted_answer_id": 52705890, "answer_count": 1, "score": 0, "last_activity_date": 1539013673, "creation_date": 1538995945, "last_edit_date": 1538996886, "question_id": 52700695, "link": "https://stackoverflow.com/questions/52700695/unzip-password-zip-using-golang", "title": "Unzip password zip using golang", "body": "<p>I'm trying to decompress a zip file in golang (with password).</p>\n\n<pre><code>    r, err := zip.OpenReader(\"./path/to/the.zip\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer r.Close()\n\n    for _, f := range r.File {\n        if f.IsEncrypted() {\n            f.SetPassword(\"$83?Lu{5nKbXxncjdH/_B)+}C`\")\n        }\n        r, err := f.Open()\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        buf, err := ioutil.ReadAll(r)\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer r.Close()\n\n        fmt.Printf(\"Size of %v: %v byte(s)\\n\", f.Name, len(buf))\n    }\n</code></pre>\n\n<p>I'm at this point where using the repository <a href=\"https://github.com/yeka/zip\" rel=\"nofollow noreferrer\">https://github.com/yeka/zip</a> I get the following output:</p>\n\n<pre><code>Size of cmxxxgapi/: 0 byte(s)\nSize of cmxpi/vxxxxxxxx.yml: 326 byte(s)\nSize of cmxxxpi/valxxxxxxe.yml: 379 byte(s)\nSize of validations_javxxxo_mxxxxxxxon.yml: 722 byte(s)\nSize of validations_xxx_mxxxxxxxxo.yml: 4322 byte(s)\nSize of validations_xxxxse.yml: 65 byte(s)\n</code></pre>\n\n<p>How can I decompress all those files and have them accessible from my binary.</p>\n\n<p>Thank you very much.</p>\n\n<p>Ps. I can't use exec.</p>\n"}, {"tags": ["amazon-web-services", "api", "go", "sdk", "amazon-cognito"], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 4751687, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1060829973946754/picture?type=large", "display_name": "msbomrel", "link": "https://stackoverflow.com/users/4751687/msbomrel"}, "edited": false, "score": 0, "creation_date": 1617200280, "post_id": 55432926, "comment_id": 118238253, "body": "If you can help me. <a href=\"https://stackoverflow.com/questions/61317364/how-to-programmatically-enable-or-disable-mfa-for-a-logged-user-in-aws-cognito-u\" title=\"how to programmatically enable or disable mfa for a logged user in aws cognito u\">stackoverflow.com/questions/61317364/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1613, "user_id": 5013336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d627dbf935d8dcb71c8eff8a223e97cc?s=128&d=identicon&r=PG", "display_name": "Arka Mukherjee", "link": "https://stackoverflow.com/users/5013336/arka-mukherjee"}, "is_accepted": false, "score": 0, "last_activity_date": 1553959571, "creation_date": 1553959571, "answer_id": 55432926, "question_id": 52699133, "link": "https://stackoverflow.com/questions/52699133/how-to-enable-cognito-user-mfa/55432926#55432926", "title": "How to enable cognito user MFA", "body": "<p>There are only two API calls to enable/disable MFA for a user in a Cognito User Pool:</p>\n\n<ul>\n<li>SetUserMFAPreference[a]</li>\n<li>AdminSetUserMFAPreference[b]</li>\n</ul>\n\n<p>As stated in the official AWS API documentation, both of these API calls do not return any response JSON, and there would be an empty HTTP 200 response if the API calls execute without any errors. \nTo test and understand the behaviour of the APIs, I would recommend Cognito users to test them via the AWS CLI, before using them in an SDK of a chosen programming language. </p>\n\n<h1>References</h1>\n\n<p>[a]. <a href=\"https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_SetUserMFAPreference.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_SetUserMFAPreference.html</a></p>\n\n<p>[b]. <a href=\"https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html</a></p>\n"}], "owner": {"reputation": 31, "user_id": 9812197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Denys Nahurnyi", "link": "https://stackoverflow.com/users/9812197/denys-nahurnyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 800, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1553959571, "creation_date": 1538990639, "last_edit_date": 1539004629, "question_id": 52699133, "link": "https://stackoverflow.com/questions/52699133/how-to-enable-cognito-user-mfa", "title": "How to enable cognito user MFA", "body": "<p>I faced an issue that when I call</p>\n\n<pre><code>enableMFAStatus, err := cogIProv.AdminSetUserMFAPreferenceWithContext(ctx, &amp;cip.AdminSetUserMFAPreferenceInput{\n    UserPoolId: aws.String(userPoolID),\n    Username:   aws.String(username),\n    SMSMfaSettings: &amp;cip.SMSMfaSettingsType{\n        Enabled:      aws.Bool(enableMFA),\n        PreferredMfa: aws.Bool(true),\n    },\n})\n</code></pre>\n\n<p>it just do nothing with success response. Are there some other ways to enable SMS MFA for cognito userpool user?</p>\n"}, {"tags": ["go", "data-structures", "set"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1538990107, "post_id": 52698924, "comment_id": 92324421, "body": "For a &quot;nice&quot; set, use a map with <code>bool</code> value type (with <code>true</code> values) and exploit the zero value. For a set with smallest memory footprint, use a map with <code>struct{}</code> value type (and use the comma-ok idiom to tell if a value is in the set / map)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1538992693, "post_id": 52698924, "comment_id": 92325907, "body": "For details and examples, see <a href=\"https://stackoverflow.com/questions/33207197/how-can-i-create-an-array-that-contains-unique-strings/33207265#33207265\">How can I create an array that contains unique strings?</a>"}, {"owner": {"reputation": 795, "user_id": 4297035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/my4fZ.jpg?s=128&g=1", "display_name": "Soroush", "link": "https://stackoverflow.com/users/4297035/soroush"}, "edited": false, "score": 0, "creation_date": 1603714774, "post_id": 52698924, "comment_id": 114114283, "body": "As an alternative, you can use an open-source library. <a href=\"https://github.com/soroushj/menge\" rel=\"nofollow noreferrer\"><code>github.com&#47;soroushj&#47;menge</code></a> covers all basic types, including floats. <a href=\"https://pkg.go.dev/k8s.io/apimachinery/pkg/util/sets\" rel=\"nofollow noreferrer\"><code>k8s.io&#47;apimachinery&#47;pkg&#47;util&#47;sets</code></a> implements sets of integers and strings, but not floats."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 4, "last_activity_date": 1538993267, "last_edit_date": 1538993267, "creation_date": 1538992200, "answer_id": 52699631, "question_id": 52698924, "link": "https://stackoverflow.com/questions/52698924/how-can-i-build-a-set/52699631#52699631", "title": "How can I build a set?", "body": "<p>Using a <code>map[float64]bool</code> (or map[float64]struct{}) works well <strong>unless</strong> you need to have NaNs in the set in which case it will fail.</p>\n\n<p>Float sets need extra logic to handle the NaN case as NaNs can be used as map indices but do not work as expected.</p>\n\n<p>You should define your own FloatSet which consists of two fields: One <code>map[float64]struct{}</code> for all \"normal\" floats (including the Infs) and one <code>hasNaN bool</code> field for NaNs. Insert, Lookup, Remove code need both an extra code path to handle NaNs.</p>\n\n<p>The \"happy\" path is perfectly covered by icza's answer but floats always need special treatment for NaNs. (Unless your set will never contain NaNs, until it will contain a NaN and your code will fail with a hard to detect bug.)</p>\n"}], "owner": {"reputation": 1930, "user_id": 1724692, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4323f2e0f98aabe064f6bdc049f1d4c3?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1724692/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1539001652, "creation_date": 1538989936, "last_edit_date": 1539001652, "question_id": 52698924, "link": "https://stackoverflow.com/questions/52698924/how-can-i-build-a-set", "title": "How can I build a set?", "body": "<p>Given an array of float64 (or any other thing), I would like to build a <code>set</code> similar to the set we find in python.  What is the best approach to designing such a data structure?</p>\n\n<p>So far I managed to build a set using a map but it seems awkward to repurpose map to build a set.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n\n    var scores = []float64{\n        12.0, 6.0, 19.0, 20.0, 2.0, 8.0, 20.0,\n    }\n\n    set := make(map[float64]bool)\n    for _, t := range scores {\n        set[t] = true\n    }\n\n    unk := make([]float64, 0, len(set))\n    for t := range set {\n        unk = append(unk, t)\n    }\n\n    sort.Float64s(unk)\n    fmt.Println(unk)\n}\n</code></pre>\n\n<p>Will produce</p>\n\n<blockquote>\n  <p>[2 6 8 12 19 20]</p>\n</blockquote>\n"}, {"tags": ["c", "go", "makefile", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 45838, "user_id": 1362568, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/EAFi0.jpg?s=128&g=1", "display_name": "Mike Kinghan", "link": "https://stackoverflow.com/users/1362568/mike-kinghan"}, "edited": false, "score": 0, "creation_date": 1538991677, "post_id": 52698861, "comment_id": 92325296, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12573816/what-is-an-undefined-reference-unresolved-external-symbol-error-and-how-do-i-fix\">What is an undefined reference/unresolved external symbol error and how do I fix it?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 0, "last_activity_date": 1538991435, "creation_date": 1538991435, "answer_id": 52699384, "question_id": 52698861, "link": "https://stackoverflow.com/questions/52698861/error-accessing-aerospike-c-client-through-cgo/52699384#52699384", "title": "Error accessing aerospike C client through Cgo", "body": "<p>You need to link with the relevant library.  I believe the library is called <code>-laerospike</code>.  In this case, the <code>cgo</code> directive would look like this:</p>\n\n<pre><code>// #cgo LDFLAGS: -laerospike\n</code></pre>\n\n<p>See <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">the cgo documentation</a>.</p>\n\n<p>Furthermore, you need to link in the relevant example code.  I don't see a <code>put</code> example in the official repository.  You will likely have to copy part of its sources directly in the <code>cgo</code> section of your Go file because examples are usually not intended for direct linking.</p>\n"}], "owner": {"reputation": 131, "user_id": 10472133, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O0rxjXkeBeQ/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU0-cr_qPS3oVBFYnZS2W0WUzttCQ/mo/photo.jpg?sz=128", "display_name": "rithik r", "link": "https://stackoverflow.com/users/10472133/rithik-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539004654, "creation_date": 1538989703, "last_edit_date": 1539004654, "question_id": 52698861, "link": "https://stackoverflow.com/questions/52698861/error-accessing-aerospike-c-client-through-cgo", "title": "Error accessing aerospike C client through Cgo", "body": "<p>I am trying to learn Cgo, so i tried accessing aerospike client from Cgo</p>\n\n<pre><code>package main  \n// #cgo CFLAGS: -g -Wall\n// #include &lt;stdlib.h&gt;\n// #include &lt;string.h&gt;\n// #include \"aerospike-client-c/examples/put/example_utils.h\"\nimport \"C\"\nimport (\n\"unsafe\"\n)\nfunc main() {  \n   retvals := C.putitnew()\n  _=retvals\n}\n</code></pre>\n\n<p>But i get below errors. ( Please note the C program runs successfully when i do make and make run ). </p>\n\n<pre><code>undefined reference to `example_get_opts'\n./aerospike-client-c/examples/put/example.c:66: undefined reference to \n`example_connect_to_aerospike'\n./aerospike-client-c/examples/put/example.c:69: undefined reference to \n`example_remove_test_record'\n./aerospike-client-c/examples/put/example.c:78: undefined reference to \n  `as_record_init'\n./aerospike-client-c/examples/put/example.c:79: undefined reference to \n`as_record_set_int64'\n/tmp/go-build283334635/b046/_x002.o: In function `as_record_set_str':\n....\n</code></pre>\n\n<p>So i believe the issue is with the configuration in Makefile. I have searched for entire day and tried many solutions but invain. Can you help me how i could import Makefile in Cgo?  Or an alternative to help me execute this successfully..</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 53111, "user_id": 41596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e3d742bdb6a1937a032125eef40aa874?s=128&d=identicon&r=PG", "display_name": "alexn", "link": "https://stackoverflow.com/users/41596/alexn"}, "edited": false, "score": 1, "creation_date": 1538987523, "post_id": 52698194, "comment_id": 92323014, "body": "Read until you find the Content-Length header, then you decide if you want to continue or not."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1538988880, "post_id": 52698194, "comment_id": 92323783, "body": "Read N+1 bytes. If the last byte is readable, the response is too long. If it&#39;s not, it&#39;s not."}], "answers": [{"comments": [{"owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "edited": false, "score": 2, "creation_date": 1538988923, "post_id": 52698288, "comment_id": 92323810, "body": "Not all responses have Content-Length"}], "tags": [], "owner": {"reputation": 8760, "user_id": 195727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/06237052745686cba3fcb34d056d3cad?s=128&d=identicon&r=PG", "display_name": "Dzung Nguyen", "link": "https://stackoverflow.com/users/195727/dzung-nguyen"}, "is_accepted": false, "score": 0, "last_activity_date": 1538987512, "creation_date": 1538987512, "answer_id": 52698288, "question_id": 52698194, "link": "https://stackoverflow.com/questions/52698194/limit-bytes-to-read-from-http-response/52698288#52698288", "title": "Limit bytes to read from HTTP response", "body": "<p>You can check the content length field in request header to get the total file size. </p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 3, "last_activity_date": 1538990663, "last_edit_date": 1538990663, "creation_date": 1538990271, "answer_id": 52699025, "question_id": 52698194, "link": "https://stackoverflow.com/questions/52698194/limit-bytes-to-read-from-http-response/52699025#52699025", "title": "Limit bytes to read from HTTP response", "body": "<p>Simply try to read your maximum acceptable size plus 1 byte. For an acceptable size of 1MB:</p>\n\n<pre><code>var res *http.Response\n\nb := make([]byte, 1&lt;&lt;20+1)\nn, err := io.ReadFull(res.Body, b)\nswitch err {\ncase nil:\n    log.Fatal(\"Response larger than 1MB\")\ncase io.ErrUnexpectedEOF:\n    // That's okay; the response is exactly 1MB or smaller.\n    b = b[:n]\ndefault:\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>You can also do the same thing with an <a href=\"https://golang.org/pkg/io/#LimitedReader\" rel=\"nofollow noreferrer\">io.LimitedReader</a>:</p>\n\n<pre><code>var res *http.Response\n\nr := &amp;io.LimitedReader{\n    R: res.Body,\n    N: 1&lt;&lt;20 + 1,\n}\n\n// handle response body somehow\nio.Copy(ioutil.Discard, r)\n\nif r.N == 0 {\n    log.Fatal(\"Response larger than 1MB\")\n}\n</code></pre>\n\n<p>Note that both methods limit the <em>uncompressed</em> size. Significantly fewer bytes may traverse the network if the response is compressed. You need be clear about whether you want to limit network or memory usage and adjust the limit accordingly, possibly on a case-by-case basis.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1538998419, "last_edit_date": 1538998419, "creation_date": 1538992443, "answer_id": 52699702, "question_id": 52698194, "link": "https://stackoverflow.com/questions/52698194/limit-bytes-to-read-from-http-response/52699702#52699702", "title": "Limit bytes to read from HTTP response", "body": "<p>Additionally to Peter's answer, there is a ready solution in the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\"><code>net/http</code></a> package: <a href=\"https://golang.org/pkg/net/http/#MaxBytesReader\" rel=\"nofollow noreferrer\"><code>http.MaxBytesReader()</code></a>:</p>\n\n<pre><code>func MaxBytesReader(w ResponseWriter, r io.ReadCloser, n int64) io.ReadCloser\n</code></pre>\n\n<blockquote>\n  <p>MaxBytesReader is similar to io.LimitReader but is intended for limiting the size of incoming request bodies. In contrast to io.LimitReader, MaxBytesReader's result is a ReadCloser, returns a non-EOF error for a Read beyond the limit,  and closes the underlying reader when its Close method is called.</p>\n</blockquote>\n\n<p>Originally it was \"designed\" for limiting the size of incoming <em>request</em> bodies, but it can be used to limit incoming <em>response</em> bodies as well. For that, simply pass <code>nil</code> for the <code>ResponseWriter</code> parameter.</p>\n\n<p>Example using it:</p>\n\n<pre><code>{\n    body := ioutil.NopCloser(bytes.NewBuffer([]byte{0, 1, 2, 3, 4}))\n    r := http.MaxBytesReader(nil, body, 4)\n    buf, err := ioutil.ReadAll(r)\n    fmt.Println(\"When body is large:\", buf, err)\n}\n\n{\n    body := ioutil.NopCloser(bytes.NewBuffer([]byte{0, 1, 2, 3, 4}))\n    r := http.MaxBytesReader(nil, body, 5)\n    buf, err := ioutil.ReadAll(r)\n    fmt.Println(\"When body is exact (OK):\", buf, err)\n}\n\n{\n    body := ioutil.NopCloser(bytes.NewBuffer([]byte{0, 1, 2, 3, 4}))\n    r := http.MaxBytesReader(nil, body, 6)\n    buf, err := ioutil.ReadAll(r)\n    fmt.Println(\"When body is small (OK):\", buf, err)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/2GlegE7VPZC\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>When body is large: [0 1 2 3] http: request body too large\nWhen body is exact (OK): [0 1 2 3 4] &lt;nil&gt;\nWhen body is small (OK): [0 1 2 3 4] &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1267, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1538998419, "creation_date": 1538987159, "last_edit_date": 1538988844, "question_id": 52698194, "link": "https://stackoverflow.com/questions/52698194/limit-bytes-to-read-from-http-response", "title": "Limit bytes to read from HTTP response", "body": "<p>I need to read responses from user provided URLs</p>\n\n<p>I don't want them to overload my server with links to huge files.</p>\n\n<p>I want to read N bytes max and return an error if there are more bytes to read.</p>\n\n<p>I can read N bytes, but how I detect, that file is incomplete (assuming corner cases when remote file is exactly N bytes long)?</p>\n"}, {"tags": ["go", "testing", "mocking"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1538984361, "post_id": 52697285, "comment_id": 92321384, "body": "Could you show your attempts?"}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1538985479, "post_id": 52697285, "comment_id": 92321947, "body": "I created an interface containing that method as described here: <a href=\"https://dev.to/dmigwi/mocking-methods-in-go-5fg\" rel=\"nofollow noreferrer\">dev.to/dmigwi/mocking-methods-in-go-5fg</a> . I am missing the correct way how to instantiate and use the mocked class in tests"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1538985713, "post_id": 52697285, "comment_id": 92322061, "body": "Post your code."}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1538992107, "post_id": 52697285, "comment_id": 92325535, "body": "I added the code to the first posting"}], "answers": [{"comments": [{"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538995676, "post_id": 52700347, "comment_id": 92327568, "body": "Thank you. I tested your code, but it still calls the isTokenValid() method on the ApiGateway type. Am I missing something?"}, {"owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "reply_to_user": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538995862, "post_id": 52700347, "comment_id": 92327678, "body": "Yes , sorry I&#39;ve missed the fact that the &quot;New&quot; is not necessary here, you need to initialize new <code>MockAdapter</code> manually instead of calling the real <code>New()</code>. Otherwise, you can create a NewMock() here returning the mock... I&#39;ve changed the test"}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538996092, "post_id": 52700347, "comment_id": 92327827, "body": "Ah thanks. With type MockAdapter struct { \tApeGatewayAdapter } i would get access to the &quot;original&quot; methods."}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538996908, "post_id": 52700347, "comment_id": 92328238, "body": "There is still a problem. When I call gateway.GetDevice() (which makes a call to isTokenValid() ) from my test, it lands in the original isTokenValid() method and not in the stubbed one."}, {"owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "reply_to_user": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538997210, "post_id": 52700347, "comment_id": 92328411, "body": "You need to mock all methods, you cannot decide one method yes and other no, because you&#39;re mocking the object, not the methods"}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538997283, "post_id": 52700347, "comment_id": 92328458, "body": "Mmmh then this approach doesnt fit exactly. I want to test the logik of my original type but with one method mocked."}, {"owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "reply_to_user": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538997457, "post_id": 52700347, "comment_id": 92328537, "body": "The thing you want to achieve is not possible. You cannot create one type with some methods, and then create a different method (mock) for the previous type just to test it. The way of doing this is using an interface and creating a mock of your type. I recommend you read this article talking about this issue in detail <a href=\"https://medium.com/agrea-technogies/mocking-dependencies-in-go-bb9739fef008\" rel=\"nofollow noreferrer\">medium.com/agrea-technogies/&hellip;</a>"}, {"owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 0, "creation_date": 1538997535, "post_id": 52700347, "comment_id": 92328580, "body": "In my particullar case I need to extract all the token operations to a type, then i can mock it"}, {"owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "reply_to_user": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "edited": false, "score": 1, "creation_date": 1538998786, "post_id": 52700347, "comment_id": 92329293, "body": "At the end the testing is depending your code and your needs but if you undesrtand the idea I presented on the example before you&#39;ll be successfull always! Hope it helps you and feel free to contact me if need something else"}], "tags": [], "owner": {"reputation": 379, "user_id": 4948631, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FyT99NCwTng/AAAAAAAAAAI/AAAAAAAAARY/wmcBOo-0Nmc/photo.jpg?sz=128", "display_name": "charly3pins", "link": "https://stackoverflow.com/users/4948631/charly3pins"}, "is_accepted": true, "score": 1, "last_activity_date": 1538995972, "last_edit_date": 1538995972, "creation_date": 1538994698, "answer_id": 52700347, "question_id": 52697285, "link": "https://stackoverflow.com/questions/52697285/mocking-methods-in-test/52700347#52700347", "title": "Mocking methods in test", "body": "<p>The problem is that you defined the <code>isTokenValid()</code> in your <code>MockAdapter</code> instead of your <code>ApeGatewayAdapter</code>. So, when you are trying to test it says that </p>\n\n<blockquote>\n  <p>scsGateway.isTokenValid undefined (type *ApiGateway has no field or\n  method isTokenValid)</p>\n</blockquote>\n\n<p>You need to change your architecture in your structs because you've created a method <code>New()</code> for the adaptaer (and it's okay) but the important thing here (and almost always in Go) is returning an interface! </p>\n\n<p><code>isTokenValid()</code> is defined for the external type (in your test case for the <code>MockAdapter</code>) so you cannot call it unless you change the definition of your types or you change the implementation of the method from <code>MockAdapter</code> to <code>ApeGatewayAdapter</code>.</p>\n\n<p>I think the best solution should be removing the <code>StubAdapter</code> and working directly with the <code>ApiGateway</code> and define the method <code>isTokenValid()</code> for this types. Then your test should works removing the internal <code>ApeGatewayAdapter</code>and using only the <code>MockAdapter</code> to mock the apigateway and its method.</p>\n\n<p>Your code should look like this:</p>\n\n<p><strong>gateway.go</strong></p>\n\n<pre><code>package gateway\n\ntype ApeGatewayAdapter interface {\n    isTokenValid() bool\n}\n\ntype ApiGateway struct {\n    username string\n    password string\n    auth     Auth\n}\n\ntype Auth struct {\n    token   string\n    validTo int32\n}\n\nfunc (a ApiGateway) isTokenValid() bool {\n    // TODO add your validations\n    return true\n}\n\nfunc New(host string, scheme string, username string, password string) ApeGatewayAdapter {\n\n    return ApiGateway{username, password, Auth{}}\n}\n</code></pre>\n\n<p><strong>gateway_test</strong></p>\n\n<pre><code>package gateway\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\ntype MockAdapter struct {\n}\n\nfunc (m MockAdapter) isTokenValid() bool {\n    return true\n}\n\n\nfunc TestApiGateway_GetDevice(t *testing.T) {\n\n    gateway := MockAdapter{}\n    if gateway.isTokenValid() != true {\n        t.Error(\"Not true\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1574, "user_id": 1461499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bOMwp.jpg?s=128&g=1", "display_name": "Alex Tbk", "link": "https://stackoverflow.com/users/1461499/alex-tbk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 52700347, "answer_count": 1, "score": 0, "last_activity_date": 1538995972, "creation_date": 1538983347, "last_edit_date": 1538992093, "question_id": 52697285, "link": "https://stackoverflow.com/questions/52697285/mocking-methods-in-test", "title": "Mocking methods in test", "body": "<p>I have a class i want to test:</p>\n\n<pre><code>type ApiGateway struct {\n    username  string\n    password  string\n    scsClient *scsClient.APIDocumentation\n    auth      Auth\n}\n\ntype Auth struct {\n    token   string\n    validTo int32\n}\n\nfunc New(host string, scheme string, username string, password string) *ApiGateway {\n    var config = scsClient.TransportConfig{host, \"/\", []string{scheme}}\n    var client = scsClient.NewHTTPClientWithConfig(strfmt.Default, &amp;config)\n\n    return &amp;ApiGateway{username, password, client, Auth{}}\n}\n\nfunc (s *ApiGateway) isTokenValid() bool { ... }\n</code></pre>\n\n<p>This isTokenValid method is called from every other method inside the class in order to verify and/or update the API token. In tests I want to mock this method, so it always returns true for example. </p>\n\n<p>How do I archieve that?</p>\n\n<hr>\n\n<p>Edit: \nMy Code:</p>\n\n<p><strong>apiGateway.go</strong></p>\n\n<pre><code>type StubAdapter struct {\n    ApeGatewayAdapter\n}\n\ntype ApeGatewayAdapter interface {\n    isTokenValid() bool\n}\n\ntype ApiGateway struct {\n    username  string\n    password  string\n    scsClient *scsClient.APIDocumentation\n    auth      Auth\n    adapter ApeGatewayAdapter\n}\n\ntype Auth struct {\n    token   string\n    validTo int32\n}\n\nfunc New(host string, scheme string, username string, password string, a ApeGatewayAdapter) *ApiGateway {\n    var config = scsClient.TransportConfig{host, \"/\", []string{scheme}}\n    var client = scsClient.NewHTTPClientWithConfig(strfmt.Default, &amp;config)\n\n    return &amp;ApiGateway{username, password, client, Auth{}, a}\n}\n</code></pre>\n\n<p><strong>apiGateway_test.go</strong></p>\n\n<pre><code>type MockAdapter struct {\n    ApeGatewayAdapter\n}\n\nfunc (m MockAdapter) isTokenValid() bool {\n    return true\n}\n\nfunc TestApiGateway_GetDevice(t *testing.T) {\n    var scsGateway = New(\"foo.com\", \"http\", \"testuser\", \"testpwd\", MockAdapter{})\n\n    fmt.Println(scsGateway.isTokenValid())\n}\n</code></pre>\n\n<p>I would expect the test to call my mocked method and return <em>true</em> which it doesnt.</p>\n"}, {"tags": ["go", "virtual-file"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1538983948, "post_id": 52697277, "comment_id": 92321179, "body": "Do you actually have to mock an entire file? I&#39;m not sure how a slice of bytes would logically implement <code>Readdir</code> (other than <code>[]os.FileInfo{}, someErr</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1538985561, "post_id": 52697764, "comment_id": 92321991, "body": "admittedly I&#39;m not sure if <code>MockFile.Stat()</code> quite lives up to its expectation. It could be that <code>MockFileInfo</code> should take a <code>MockFile</code> rather than a <code>*MockFile</code>. What happens if you <code>os.Stat</code> a real file, then change its size? Does the file size change reflect in the <code>os.FileInfo</code>?"}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1538985381, "creation_date": 1538985381, "answer_id": 52697764, "question_id": 52697277, "link": "https://stackoverflow.com/questions/52697277/simples-way-to-make-a-byte-into-a-virtual-file-object-in-golang/52697764#52697764", "title": "Simples way to make a []byte into a &quot;virtual&quot; File object in golang?", "body": "<p>Seems simple enough to mock this yourself.</p>\n\n<pre><code>type MockFile struct {\n    data    []byte\n    isOpen  bool\n    offset  int64\n}\n\ntype MockFileInfo struct {\n    mockFile *MockFile\n}\nfunc (mfi *MockFileInfo) Name() string       { return \"MockFile\" }\nfunc (mfi *MockFileInfo) Size() int64        { return len(mfi.data) }\nfunc (mfi *MockFileInfo) Mode() os.FileMode  { return os.ModeIrregular }\nfunc (mfi *MockFileInfo) ModTime() time.Time { return time.Now() }\nfunc (mfi *MockFileInfo) IsDir() bool        { return false }\nfunc (mfi *MockFileInfo) Sys() interface     { return nil }\n\nfunc (mf *MockFile) Read(p []byte) (n int, err error) {\n    if mf.isOpen {\n        n = copy(p, mf.data[mf.offset:])\n        mf.offset += n\n    } else {\n        err = errors.New(\"Cannot read from closed MockFile\")\n    }\n    return\n}\n\nfunc (mf *MockFile) Close() error {\n    if !mf.isOpen {\n        return errors.New(\"Cannot close an already closed MockFile\")\n    mf.isOpen = false\n    return nil\n}\n\nfunc (mf *MockFile) Seek(offset int64, whence int) (ret int64, err error) {\n    var relativeTo int64\n    switch whence {\n        case 0:\n            relativeTo = 0\n        case 1:\n            relativeTo = mf.offset\n        case 2:\n            relativeTo = len(mf.data)\n    }\n    ret := relativeTo + offset\n    if ret &lt; 0 || ret &gt; len(mf.data) {\n        return -1, errors.New(\"New offset would fall outside of the MockFile\")\n    }\n    mf.offset = ret\n    return\n}\n\nfunc (mf *MockFile) Readdir(count int) ([]os.FileInfo, error) {\n    if count &lt;= 0 {\n        return []os.FileInfo{}, nil\n    }\n    return []os.FileInfo{}, errors.New(\"MockFiles have no associated directory\")\n}\n\nfunc (mf *MockFile) Stat() (os.FileInfo, error) {\n    return MockFileInfo{mf}\n}\n\nfunc OpenMockFile(data []byte) *MockFile {\n    mf := MockFile{data, true, 0}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1538989000, "last_edit_date": 1538989000, "creation_date": 1538985951, "answer_id": 52697900, "question_id": 52697277, "link": "https://stackoverflow.com/questions/52697277/simples-way-to-make-a-byte-into-a-virtual-file-object-in-golang/52697900#52697900", "title": "Simples way to make a []byte into a &quot;virtual&quot; File object in golang?", "body": "<p>There is no ready solution for this in the standard library, but it's not that hard to do it yourself.</p>\n\n<p>What we need is this <a href=\"https://golang.org/pkg/net/http/#File\" rel=\"noreferrer\"><code>http.File</code></a> interface:</p>\n\n<pre><code>type File interface {\n        io.Closer\n        io.Reader\n        io.Seeker\n        Readdir(count int) ([]os.FileInfo, error)\n        Stat() (os.FileInfo, error)\n}\n</code></pre>\n\n<p>Please note that we can utilize <a href=\"https://golang.org/pkg/bytes/#Reader\" rel=\"noreferrer\"><code>bytes.Reader</code></a> to do the heavy task, as that alone implements <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> and <a href=\"https://golang.org/pkg/io/#Seeker\" rel=\"noreferrer\"><code>io.Seeker</code></a>. <a href=\"https://golang.org/pkg/io/#Closer\" rel=\"noreferrer\"><code>io.Closer</code></a> can be a noop, and <code>Readdir()</code> may return <code>nil, nil</code> as we're mocking a file not a directory, its <code>Readdir()</code> won't even be called.</p>\n\n<p>The \"hardest\" part is to mock <code>Stat()</code> to return a value that implements <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"noreferrer\"><code>os.FileInfo</code></a>.</p>\n\n<p>Here's a simple mocked <code>FileInfo</code>:</p>\n\n<pre><code>type myFileInfo struct {\n    name string\n    data []byte\n}\n\nfunc (mif myFileInfo) Name() string       { return mif.name }\nfunc (mif myFileInfo) Size() int64        { return int64(len(mif.data)) }\nfunc (mif myFileInfo) Mode() os.FileMode  { return 0444 }        // Read for all\nfunc (mif myFileInfo) ModTime() time.Time { return time.Time{} } // Return anything\nfunc (mif myFileInfo) IsDir() bool        { return false }\nfunc (mif myFileInfo) Sys() interface{}   { return nil }\n</code></pre>\n\n<p>And with that we have everything to create our mocked <code>http.File</code>:</p>\n\n<pre><code>type MyFile struct {\n    *bytes.Reader\n    mif myFileInfo\n}\n\nfunc (mf *MyFile) Close() error { return nil } // Noop, nothing to do\n\nfunc (mf *MyFile) Readdir(count int) ([]os.FileInfo, error) {\n    return nil, nil // We are not a directory but a single file\n}\n\nfunc (mf *MyFile) Stat() (os.FileInfo, error) {\n    return mf.mif, nil\n}\n</code></pre>\n\n<p>Example using it (try it on the <a href=\"https://play.golang.org/p/2RK40-pTRAH\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>data := []byte{0, 1, 2, 3}\n\nmf := &amp;MyFile{\n    Reader: bytes.NewReader(data),\n    mif: myFileInfo{\n        name: \"somename.txt\",\n        data: data,\n    },\n}\n\nvar f http.File = mf\n_ = f\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 593, "user_id": 4804845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/92WGu.png?s=128&g=1", "display_name": "Markus T.", "link": "https://stackoverflow.com/users/4804845/markus-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1587382174, "creation_date": 1587382174, "answer_id": 61321409, "question_id": 52697277, "link": "https://stackoverflow.com/questions/52697277/simples-way-to-make-a-byte-into-a-virtual-file-object-in-golang/61321409#61321409", "title": "Simples way to make a []byte into a &quot;virtual&quot; File object in golang?", "body": "<p>If you are looking this answer to gzip http2 push, you can do it with just options:</p>\n\n<pre><code>options := &amp;http.PushOptions{\n                Header: http.Header{\n                    \"Accept-Encoding\": r.Header[\"Accept-Encoding\"],\n                },\n            }\n            if err := pusher.Push(filePush, options); err != nil {\n                log.Printf(\"Failed to push: %v\", err)\n                return\n            }\n</code></pre>\n"}], "owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1917, "favorite_count": 0, "accepted_answer_id": 52697900, "answer_count": 3, "score": 3, "last_activity_date": 1587382174, "creation_date": 1538983306, "question_id": 52697277, "link": "https://stackoverflow.com/questions/52697277/simples-way-to-make-a-byte-into-a-virtual-file-object-in-golang", "title": "Simples way to make a []byte into a &quot;virtual&quot; File object in golang?", "body": "<p>I know there are Go libraries that create entire filesystems like <a href=\"https://godoc.org/golang.org/x/tools/godoc/vfs\" rel=\"nofollow noreferrer\">VFS</a>. But I only want to make a byte array into something that can fulfil the <a href=\"https://golang.org/pkg/net/http/#File\" rel=\"nofollow noreferrer\">File</a> interface.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1572193178, "last_edit_date": 1572193178, "creation_date": 1538983901, "answer_id": 52697397, "question_id": 52696921, "link": "https://stackoverflow.com/questions/52696921/reading-bytes-into-go-buffer-with-a-fixed-stride-size/52697397#52697397", "title": "Reading bytes into Go buffer with a fixed stride size", "body": "<blockquote>\n  <p>Reading bytes into Go buffer with a fixed stride size</p>\n  \n  <p>read and process 1024 bytes at a time in my file given by filename.</p>\n  \n  <p>accommodate the final stride in which the buffer will contain fewer\n  than 1024 bytes.</p>\n</blockquote>\n\n<hr>\n\n<p>For number of bytes read guarantees, use <code>ioutil.ReadFull</code>. For efficient stream reads, use <code>bufio.Reader</code>. For efficiency, allocate the read buffer once and reuse it.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    stride := 1024\n    filename := testname(stride)\n\n    f, err := os.Open(filename)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    defer f.Close()\n\n    r := bufio.NewReader(f)\n    buf := make([]byte, 0, stride)\n    for {\n        n, err := io.ReadFull(r, buf[:cap(buf)])\n        buf = buf[:n]\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            if err != io.ErrUnexpectedEOF {\n                fmt.Fprintln(os.Stderr, err)\n                break\n            }\n        }\n\n        fmt.Println(\"read n bytes...\", n)\n        // process buf\n    }\n}\n\nfunc testname(stride int) string {\n    f, err := ioutil.TempFile(\"\", \"test.stride.\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n    _, err = f.Write(make([]byte, 2*stride+stride/2))\n    if err != nil {\n        panic(err)\n    }\n    return f.Name()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/iYOY-z7hkoz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iYOY-z7hkoz</a></p>\n\n<p>Output:</p>\n\n<pre><code>read n bytes... 1024\nread n bytes... 1024\nread n bytes... 512\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3065, "favorite_count": 1, "accepted_answer_id": 52697397, "answer_count": 1, "score": 2, "last_activity_date": 1572193178, "creation_date": 1538981829, "last_edit_date": 1572191421, "question_id": 52696921, "link": "https://stackoverflow.com/questions/52696921/reading-bytes-into-go-buffer-with-a-fixed-stride-size", "title": "Reading bytes into Go buffer with a fixed stride size", "body": "<p>I'd like to read and process 1024 bytes at a time in my file given by filename. I don't understand how to construct the outer loop correctly, especially to accommodate the final stride in which the buffer will contain fewer than 1024 bytes</p>\n\n<p>What I have tried:</p>\n\n<pre><code>fs, _ := os.Open(filename)\ndefer fs.Close()\nn := 1024 // 1kb\nbuff := make([]byte, n)\nfor {\n    buff = make([]byte, n) // is this initialized correctly?\n    n1, err := fs.Read(buff)\n    if err != nil {\n        if err == io.EOF {\n            break\n        }\n        fmt.Println(err)\n        break\n    }\n    fmt.Println(\"read n1 bytes...\", n1)\n    fmt.Println(buff)\n}\n</code></pre>\n\n<p>I have seen the following resources:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/13660864/reading-specific-number-of-bytes-from-a-buffered-reader-in-golang\">Reading specific number of bytes from a buffered reader in golang</a></li>\n<li><a href=\"https://stackoverflow.com/questions/24817494/read-arbitrary-amount-of-bytes-into-buffer-golang\">Read arbitrary amount of bytes into buffer Golang</a></li>\n<li><a href=\"https://stackoverflow.com/questions/14514201/how-to-read-a-binary-file-in-go\">How to read a binary file in Go</a></li>\n<li><a href=\"https://stackoverflow.com/questions/27814408/working-with-raw-bytes-from-a-network-in-go\">Working with raw bytes from a network in go</a></li>\n<li><a href=\"https://gobyexample.com/reading-files\" rel=\"nofollow noreferrer\">https://gobyexample.com/reading-files</a></li>\n<li><a href=\"https://stackoverflow.com/questions/28639859/writing-into-fixed-size-buffers-in-golang-with-offsets\">Writing into fixed size Buffers in Golang with offsets</a></li>\n<li><a href=\"https://rwinslow.com/posts/use-flatbuffers-in-golang/\" rel=\"nofollow noreferrer\">https://rwinslow.com/posts/use-flatbuffers-in-golang/</a></li>\n<li><a href=\"https://stackoverflow.com/questions/8757389/reading-file-line-by-line-in-go\">reading file line by line in go</a></li>\n<li><a href=\"https://stackoverflow.com/questions/29313133/how-do-i-read-in-a-large-flat-file-in-golang\">How do I read in a large flat file in Golang</a></li>\n<li><a href=\"https://golang.org/pkg/io/#ReadFull\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#ReadFull</a></li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1538980177, "post_id": 52696496, "comment_id": 92319383, "body": "This is because the key <code>hobbies</code> returns an <code>interface{}</code> type, not a <code>map[string]string</code>, If your data has a fixed schema, then I&#39;d suggest you make a struct and unmarshal to that!"}], "answers": [{"comments": [{"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1538980350, "post_id": 52696571, "comment_id": 92319450, "body": "This is not a solution to his actual problem, he is fumbling with the basics of data types in Golang, and suggesting a lib won&#39;t actually help with that."}, {"owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "reply_to_user": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1538980827, "post_id": 52696571, "comment_id": 92319664, "body": "You are right, since i think that jsoniter is better than golang json, so i recommend this lib, sorry."}], "tags": [], "owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "is_accepted": false, "score": 0, "last_activity_date": 1538981229, "last_edit_date": 1538981229, "creation_date": 1538980229, "answer_id": 52696571, "question_id": 52696496, "link": "https://stackoverflow.com/questions/52696496/how-to-get-map-value-using-json-marshal/52696571#52696571", "title": "How to get map value using json marshal", "body": "<p>I use jsoniter(github.com/json-iterator/go) which is very fast and compatible with golang json package to do this:</p>\n\n<p>the code could be like this</p>\n\n<pre><code>jsoniter.Get([]byte(str), \"hobbies\", \"name\")\n</code></pre>\n\n<p>Or u can write code like this when using golang json:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := `{\n       \"Bangalore_City\": \"35_Temperature\",\n       \"NewYork_City\": \"31_Temperature\",\n       \"Copenhagen_City\": \"29_Temperature\",\n       \"hobbies\" : {\n           \"name\" : \"username\"\n       }\n    }`\n    var m map[string]interface{}\n    json.Unmarshal([]byte(str), &amp;m)\n    // since m[\"hobbies\"] is an interface type, u can't use it \n    // as a map[string]string type, so add a \".(map[string]string)\"\n    // to change this interface, then u can get the value of key \"name\"\n    fmt.Println(m[\"hobbies\"].(map[string]string)[\"name\"])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 3332681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cba3885fa0b634ab1b7585da4240fa?s=128&d=identicon&r=PG&f=1", "display_name": "colega", "link": "https://stackoverflow.com/users/3332681/colega"}, "is_accepted": false, "score": 1, "last_activity_date": 1538985897, "creation_date": 1538985897, "answer_id": 52697891, "question_id": 52696496, "link": "https://stackoverflow.com/questions/52696496/how-to-get-map-value-using-json-marshal/52697891#52697891", "title": "How to get map value using json marshal", "body": "<p>You need to type assert on <code>m[\"hobbies\"]</code> to be a <code>map[string]interface{}</code> too,\nlike <a href=\"https://play.golang.org/p/1GtWeUPHlMx\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>fmt.Println(m[\"hobbies\"].(map[string]interface{})[\"name\"])\n</code></pre>\n\n<p>You can also <a href=\"https://play.golang.org/p/0Jfe26kxmgF\" rel=\"nofollow noreferrer\">check that it has the expected type before accessing the name</a> </p>\n"}], "owner": {"reputation": 233, "user_id": 8198255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397363516ab15fee72d9cee5fec024b9?s=128&d=identicon&r=PG&f=1", "display_name": "az rnd", "link": "https://stackoverflow.com/users/8198255/az-rnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1432, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1538986136, "creation_date": 1538979939, "last_edit_date": 1538986136, "question_id": 52696496, "link": "https://stackoverflow.com/questions/52696496/how-to-get-map-value-using-json-marshal", "title": "How to get map value using json marshal", "body": "<p>I need to convert json string to map. Here is my go program.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := `{\n       \"Bangalore_City\": \"35_Temperature\",\n       \"NewYork_City\": \"31_Temperature\",\n       \"Copenhagen_City\": \"29_Temperature\",\n       \"hobbies\" : {\n           \"name\" : \"username\"\n       }\n    }`\n    var m map[string]interface{}\n    json.Unmarshal([]byte(str), &amp;m)\n\n    fmt.Println(m[\"hobbies\"][\"name\"])\n}\n</code></pre>\n\n<p>If I use this code I am getting the below error. </p>\n\n<pre><code>get.go:26:26: invalid operation: m[\"hobbies\"][\"name\"] (type interface {} does not support indexing)\n</code></pre>\n\n<p>Please anyone help to fix this issue. Thanks in advance</p>\n"}, {"tags": ["go", "go-chi"], "answers": [{"tags": [], "owner": {"reputation": 411, "user_id": 3770792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S1CEE.png?s=128&g=1", "display_name": "Stefan Wuthrich - Altafino", "link": "https://stackoverflow.com/users/3770792/stefan-wuthrich-altafino"}, "is_accepted": true, "score": 2, "last_activity_date": 1539258717, "creation_date": 1539258717, "answer_id": 52759388, "question_id": 52696109, "link": "https://stackoverflow.com/questions/52696109/how-to-get-route-inside-middleware-go-chi/52759388#52759388", "title": "How to get route inside middleware go-chi", "body": "<p>Resolved based on <a href=\"https://medium.com/@szablowska.patrycja/chi-and-missing-urlparam-in-middleware-9435c48a063b\" rel=\"nofollow noreferrer\">https://medium.com/@szablowska.patrycja/chi-and-missing-urlparam-in-middleware-9435c48a063b</a></p>\n\n<pre><code>r := chi.NewRouter()\nr.Route(\"/myroute\", func(r chi.Router) {\n    r.With(myMiddleware).Route(\"/{myparam}\", func(r chi.Router) {\n        r.Get(\"/\", getHandler)\n        r.Put(\"/\", putHandler)\n    })\n})\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 3770792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S1CEE.png?s=128&g=1", "display_name": "Stefan Wuthrich - Altafino", "link": "https://stackoverflow.com/users/3770792/stefan-wuthrich-altafino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2983, "favorite_count": 0, "accepted_answer_id": 52759388, "answer_count": 1, "score": 0, "last_activity_date": 1539258717, "creation_date": 1538977894, "last_edit_date": 1539059870, "question_id": 52696109, "link": "https://stackoverflow.com/questions/52696109/how-to-get-route-inside-middleware-go-chi", "title": "How to get route inside middleware go-chi", "body": "<p>To check authorization i need to know the route inside the authorization middleware. I checked docs from go-chi and did it that way:</p>\n\n<pre><code>func Authenticator(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    // .............\n    next.ServeHTTP(w, r)\n    routePattern := chi.RouteContext(r.Context()).RoutePattern()\n    fmt.Println(\"AUTHORIZATION:\", routePattern, route)\n\n    routepath := strings.Replace(routePattern, \"/v1\", \"\", 1) // todo use api prefix from config\n    routepath = strings.Replace(routepath, \"/*\", \"\", 1)\n\n    fmt.Println(\"ROUTEPATH:\", routepath, route)\n\n    if !CheckAuthorization(*token, routepath, method, \"*\", \"*\", \"*\") {\n        http.Error(w, http.StatusText(401), 401)\n        return\n    }\n\n    })\n}\n</code></pre>\n\n<p>which gives me what I need.\nBut now obviously authorization is passed, so if check for routepattern handler is already executed (wrote result to client)</p>\n\n<p>Is there any other way to get the route inside of a middleware without next.ServerHTTP(w,r) before checking the RoutePattern() ?</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1538976103, "post_id": 52695724, "comment_id": 92317964, "body": "Show the code please, with error."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1538976390, "post_id": 52695724, "comment_id": 92318045, "body": "There is an example in the godoc <a href=\"https://godoc.org/github.com/go-redis/redis#ParseURL\" rel=\"nofollow noreferrer\">godoc.org/github.com/go-redis/redis#ParseURL</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 4, "last_activity_date": 1538976269, "creation_date": 1538976269, "answer_id": 52695839, "question_id": 52695724, "link": "https://stackoverflow.com/questions/52695724/connect-to-a-redis-server-using-redis-schema-url/52695839#52695839", "title": "Connect to a redis server using redis schema URL", "body": "<p>You can use the <a href=\"https://godoc.org/github.com/go-redis/redis#ParseURL\" rel=\"nofollow noreferrer\">ParseURL</a> function in go-redis</p>\n\n<pre><code>opt, _ := redis.ParseURL(\"redis://:qwerty@localhost:6379\")\nclient := redis.NewClient(opt)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6442122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caec1a925b74f6e1b116ac3e02985497?s=128&d=identicon&r=PG&f=1", "display_name": "BogdanDarius", "link": "https://stackoverflow.com/users/6442122/bogdandarius"}, "is_accepted": false, "score": 0, "last_activity_date": 1594845377, "creation_date": 1594845377, "answer_id": 62923372, "question_id": 52695724, "link": "https://stackoverflow.com/questions/52695724/connect-to-a-redis-server-using-redis-schema-url/62923372#62923372", "title": "Connect to a redis server using redis schema URL", "body": "<p>If you are using <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis</a> remove <code>redis://</code> from client address to avoid the error <code>too many colons in address</code>.</p>\n"}], "owner": {"reputation": 5932, "user_id": 3541205, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/6d36383f353f79d903e2e0946b73e8f7?s=128&d=identicon&r=PG", "display_name": "aks", "link": "https://stackoverflow.com/users/3541205/aks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1660, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1594845377, "creation_date": 1538975430, "last_edit_date": 1538976886, "question_id": 52695724, "link": "https://stackoverflow.com/questions/52695724/connect-to-a-redis-server-using-redis-schema-url", "title": "Connect to a redis server using redis schema URL", "body": "<p>I'm trying to connect to a Redis server which is hosted on a url like this.</p>\n\n<p><code>redis://h:asdfqwer1234asdf@ec2-111-1-1-1.compute-1.amazonaws.com:38799</code></p>\n\n<p>I have tried to use 2 libraries and none of them is able to connect to the server. I've used <a href=\"https://github.com/mediocregopher/radix.v3\" rel=\"nofollow noreferrer\">redix.v3</a> and <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis</a>.</p>\n\n<p>With <code>redix.v3</code> I get panic error when using the above like URL.</p>\n\n<p>On <code>go-redis</code> I got an error about there being too many colons in the url and I've tried using this url\n<code>[redis://h:asdfqwer1234asdf@ec2-111-1-1-1.compute-1.amazonaws.com]:38799</code> which was suggested on some post.</p>\n\n<p>Still no luck. Has anyone successfully connected to a Redis server?</p>\n\n<blockquote>\n  <p>Code and Error for redix.v3</p>\n</blockquote>\n\n<pre><code>func main() {\n    fmt.Println(\"running\")\n    client, err := radix.NewPool(\"tcp\", \"redis://h:asdfqwer1234asdf@ec2-111-1-1-1.compute-1.amazonaws.com:38799\", 10)\n    if err != nil {\n        // handle error\n    }\n\n    var fooVal string\n    err = client.Do(radix.Cmd(&amp;fooVal, \"SET\", \"foo\", \"hello\"))\n    fmt.Println(err, fooVal)\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4f2b7e]\n\ngoroutine 1 [running]:\ngithub.com/mediocregopher/radix%2ev3.(*Pool).getExisting(0x0, 0x0, 0x0, 0x0)\n    /home/aks/go/src/github.com/mediocregopher/radix.v3/pool.go:365 +0x4e\ngithub.com/mediocregopher/radix%2ev3.(*Pool).get(0x0, 0x40aa78, 0x51afe0, 0x525120)\n    /home/aks/go/src/github.com/mediocregopher/radix.v3/pool.go:403 +0x2f\ngithub.com/mediocregopher/radix%2ev3.(*Pool).Do(0x0, 0x7f6478467fd0, 0xc0000e2070, 0x0, 0x0)\n    /home/aks/go/src/github.com/mediocregopher/radix.v3/pool.go:440 +0x37\nmain.main()\n    /home/aks/hello.go:17 +0x19e\nexit status 2\n</code></pre>\n\n<blockquote>\n  <p>Code and error for go-redis</p>\n</blockquote>\n\n<pre><code>client := redis.NewClient(&amp;redis.Options{\n        Addr:     \"redis://h:asdfqwer1234asdf@ec2-111-1-1-1.compute-1.amazonaws.com:38799\",\n        Password: \"\", // no password set\n        DB:       0,  // use default DB\n    })\n\n// setup eviction policy on the redis client\nclient.ConfigSet(\"maxmemory\", Config.RedisMaxMemory)\nclient.ConfigSet(\"maxmemory-policy\", \"allkeys-lru\")\n\n_, err := client.Ping().Result()\n\nif err != nil {\n    log.Println(\"Redis: failed to connect\", err)\n} else {\n    log.Println(\"Redis: connected\")\n}\n</code></pre>\n\n<p>The Error:</p>\n\n<pre><code>2018/10/08 10:57:29 Redis: failed to connect dial tcp: address redis://h:asdfqwer1234asdf@ec2-111-1-1-1.compute-1.amazonaws.com:38799: too many colons in address\n</code></pre>\n"}, {"tags": ["go", "time"], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538977705, "post_id": 52695949, "comment_id": 92318457, "body": "can we do it in other way?"}, {"owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538978311, "post_id": 52695949, "comment_id": 92318688, "body": "like you are using <code>Sprintf</code> in your example. Will you produce the same result by removing it?"}, {"owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538979051, "post_id": 52695949, "comment_id": 92318941, "body": "I don&#39;t want to use <code>fmt</code> to produce this result is there any different method?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1538980078, "last_edit_date": 1538980078, "creation_date": 1538976995, "answer_id": 52695949, "question_id": 52695659, "link": "https://stackoverflow.com/questions/52695659/how-to-get-current-hour-and-minutes-in-two-digit-using-go/52695949#52695949", "title": "How to get current hour and minutes in two digit using go?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    hours, minutes, _ := time.Now().Clock()\n    currUTCTimeInString := fmt.Sprintf(\"%d%02d\", hours, minutes)\n    fmt.Println(currUTCTimeInString)\n    hours, minutes = 9, 0\n    currUTCTimeInString = fmt.Sprintf(\"%d%02d\", hours, minutes)\n    fmt.Println(currUTCTimeInString)\n    hours, minutes = 10, 0\n    currUTCTimeInString = fmt.Sprintf(\"%d%02d\", hours, minutes)\n    fmt.Println(currUTCTimeInString)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2300\n900\n1000\n</code></pre>\n\n<hr>\n\n<p>Or, using <code>strconv</code>,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    hours, minutes := 9, 00\n    h := strconv.Itoa(hours)\n    m := strconv.Itoa(minutes)\n    if minutes &lt; 10 {\n        m = \"0\" + m\n    }\n    hm := h + m\n    fmt.Println(hm)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>900\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538979457, "post_id": 52695953, "comment_id": 92319110, "body": "Aren&#39;t you trying to get the hours and minutes in two digit string format? You can try this <code>time.Now().Format(&quot;1504&quot;)</code> and it will give you the proper format. For example, <code>t, _ := time.Parse(&quot;15:04&quot;, &quot;09:11&quot;)``fmt.Println(t.Format(&quot;1504&quot;))</code>"}, {"owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538979964, "post_id": 52695953, "comment_id": 92319300, "body": "see I tried your example too and this will give me the format <code>0905</code> I need <code>905</code> <a href=\"https://play.golang.org/p/Kz6uJt8eyaH\" rel=\"nofollow noreferrer\">play.golang.org/p/Kz6uJt8eyaH</a>"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538984993, "post_id": 52695953, "comment_id": 92321695, "body": "Oh I though the title was &quot;hour <b>and</b> minutes&quot;. Anyway, the answer by @peterSO should suffice."}, {"owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1538987221, "post_id": 52695953, "comment_id": 92322843, "body": "but I show my expected output in question but for your precious time thanks"}, {"owner": {"reputation": 2679, "user_id": 3081480, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UVerL.jpg?s=128&g=1", "display_name": "Kyle Chadha", "link": "https://stackoverflow.com/users/3081480/kyle-chadha"}, "reply_to_user": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "edited": false, "score": 0, "creation_date": 1600836654, "post_id": 52695953, "comment_id": 113210099, "body": "@misha not sure if this is the most elegant way, but it works: <a href=\"https://play.golang.org/p/2n1Nf2AUzbn\" rel=\"nofollow noreferrer\">play.golang.org/p/2n1Nf2AUzbn</a>"}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 4, "last_activity_date": 1538977019, "creation_date": 1538977019, "answer_id": 52695953, "question_id": 52695659, "link": "https://stackoverflow.com/questions/52695659/how-to-get-current-hour-and-minutes-in-two-digit-using-go/52695953#52695953", "title": "How to get current hour and minutes in two digit using go?", "body": "<p>You should probably use <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">time.Format</a>.</p>\n\n<pre><code>time.Now().Format(\"1504\")\n</code></pre>\n\n<p>Note that the reference time in the time package is</p>\n\n<pre><code>Mon Jan 2 15:04:05 -0700 MST 2006\n</code></pre>\n\n<p>So the sample code above gives you the concatenated hours(15) minutes(04)</p>\n"}], "owner": {"reputation": 79, "user_id": 10031581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686926de56fb3840ee7a53bc269fdc21?s=128&d=identicon&r=PG&f=1", "display_name": "misha", "link": "https://stackoverflow.com/users/10031581/misha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4536, "favorite_count": 2, "accepted_answer_id": 52695949, "answer_count": 2, "score": 3, "last_activity_date": 1538980078, "creation_date": 1538974922, "question_id": 52695659, "link": "https://stackoverflow.com/questions/52695659/how-to-get-current-hour-and-minutes-in-two-digit-using-go", "title": "How to get current hour and minutes in two digit using go?", "body": "<p>I'm using time package in go for taking the time into string but there is a problem is that when the time is <code>9:00 AM or 10:00 AM</code> then the below code will output for 9:00AM is <code>90</code> and for 10:00AM is <code>100</code> but if there is time <code>9:11AM or 10:11AM</code> then the output for 9:11AM is <code>911</code> and for 10:11AM is <code>1011</code> The problem is if there is 10:00AM then it will give the minutes in two digits number not in single single digit. The code I'm using is </p>\n\n<pre><code>hours, minutes, _ := time.Now().Clock()\nfmt.Println(hours, minutes)\n</code></pre>\n\n<p>I want that it will produce the result in two digit like <code>10:00AM</code> then it will give <code>1000</code> and if there is <code>10:11AM</code> then it will give me <code>1011</code>.</p>\n\n<p>Basically I want to convert them into the string using:-</p>\n\n<pre><code> currUTCTimeInString := strconv.Itoa(hours) + strconv.Itoa(minutes)\n</code></pre>\n\n<p>Can anybody help me for this.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-appsync"], "answers": [{"comments": [{"owner": {"reputation": 4499, "user_id": 6241856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eyH0Z.jpg?s=128&g=1", "display_name": "Ionut Trestian", "link": "https://stackoverflow.com/users/6241856/ionut-trestian"}, "edited": false, "score": 0, "creation_date": 1539023089, "post_id": 52697740, "comment_id": 92342383, "body": "Just to add to this, you can either do a GET or POST to your AppSync GraphQL endpoint from Lambda and you will need to sigv4 sign your requests as the answer above mentions. The go client you mention is the control plane client for Go for most AWS services (for AppSync this provides the CRUD operations for your AppSync entities)."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1539038835, "post_id": 52697740, "comment_id": 92348204, "body": "can you provide an example how to sign the request from <a href=\"https://godoc.org/github.com/machinebox/graphql\" rel=\"nofollow noreferrer\">godoc.org/github.com/machinebox/graphql</a>? I&#39;ve been trying without any success"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1539045291, "post_id": 52697740, "comment_id": 92349583, "body": "Thanks for pointing me to the right way (http request instead of using aws lib)! I found a way using a plain http request (not elegant, though). If you want your answer to be accepted (or not.. it&#39;s up to you) please provide an example of how to use those lib so people can directly see your answer and not mine :)"}, {"owner": {"reputation": 6086, "user_id": 2531132, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a842165f1df19a0b40a0684baeb2353b?s=128&d=identicon&r=PG", "display_name": "thomasmichaelwallace", "link": "https://stackoverflow.com/users/2531132/thomasmichaelwallace"}, "edited": false, "score": 0, "creation_date": 1539073963, "post_id": 52697740, "comment_id": 92358592, "body": "I took a look (as I said, go is not a language I know too well-) and it seems because you have to know the body to sign, and you have to sign ahead of making the request, you can&#39;t use that library and have to do the forming yourself."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1539125035, "post_id": 52697740, "comment_id": 92385659, "body": "yeah I also realized that you have to include the body. I took a look at other graphql libraries and it seems it&#39;s also following the same pattern (you don&#39;t get to see the body). But thanks a lot! I know where to go from now :) I&#39;m in the process of creating a library specifically for appsync (it&#39;s for internal use only). I&#39;ll update this question if I found another library that can be used for this!"}], "tags": [], "owner": {"reputation": 6086, "user_id": 2531132, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a842165f1df19a0b40a0684baeb2353b?s=128&d=identicon&r=PG", "display_name": "thomasmichaelwallace", "link": "https://stackoverflow.com/users/2531132/thomasmichaelwallace"}, "is_accepted": false, "score": 1, "last_activity_date": 1538985285, "creation_date": 1538985285, "answer_id": 52697740, "question_id": 52694693, "link": "https://stackoverflow.com/questions/52694693/calling-appsync-mutation-from-lambda-with-golang/52697740#52697740", "title": "Calling AppSync Mutation from Lambda with Golang", "body": "<p>The problem is that that API/library is designed to help you create/update app-sync instances.</p>\n\n<p>If you want to actually invoke them then you need to POST to the GraphQL endpoint.</p>\n\n<p>The easiest way for testing is to sign-in to the AWS AppSync Console, press the 'Queries' button in the sidebar and then enter and run your mutation.</p>\n\n<p>I'm not great with go, but from what I can see there are client libraries for GraphQL in golang (e.g. <a href=\"https://godoc.org/github.com/machinebox/graphql\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/machinebox/graphql</a>).</p>\n\n<p>If you are using IAM then you'll need to sign your request with a v4 signature (see this article for details: <a href=\"https://docs.aws.amazon.com/general/latest/gr/signing_aws_api_requests.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/general/latest/gr/signing_aws_api_requests.html</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1548054086, "post_id": 52711796, "comment_id": 95390909, "body": "Its work like a charm bro, thanks for saving my day. I used OpenID Connect that associated with Firebase Token, then I just set Issuer URL link to my Firebase app without using aws v4 signer"}], "tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 2, "last_activity_date": 1539045513, "creation_date": 1539045513, "answer_id": 52711796, "question_id": 52694693, "link": "https://stackoverflow.com/questions/52694693/calling-appsync-mutation-from-lambda-with-golang/52711796#52711796", "title": "Calling AppSync Mutation from Lambda with Golang", "body": "<p>I found a way of using plain <code>http.Request</code> and AWS v4 signing. (Thanks to @thomasmichaelwallace for pointing this method out)</p>\n\n<pre><code>client := new(http.Client)\n// construct the query\nquery := AppSyncPublish{\n    Query: `\n        mutation ($userid: ID!) {\n            publishMessage(\n                userid: $userid\n            ){\n                userid\n            }\n        }\n    `,\n    Variables: PublishInput{\n        UserID:     \"wow\",\n    },\n}\nb, err := json.Marshal(&amp;query)\nif err != nil {\n    fmt.Println(err)\n}\n\n// construct the request object\nreq, err := http.NewRequest(\"POST\", os.Getenv(\"APPSYNC_URL\"), bytes.NewReader(b))\nif err != nil {\n    fmt.Println(err)\n}\nreq.Header.Set(\"Content-Type\", \"application/json\")\n\n// get aws credential\nconfig := aws.Config{\n    Region: aws.String(os.Getenv(\"AWS_REGION\")),\n}\nsess := session.Must(session.NewSession(&amp;config))\n\n\n//sign the request\nsigner := v4.NewSigner(sess.Config.Credentials)\nsigner.Sign(req, bytes.NewReader(b), \"appsync\", \"ap-southeast-1\", time.Now())\n\n//FIRE!!\nresponse, _ := client.Do(req)\n\n//print the response\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(response.Body)\nnewStr := buf.String()\n\nfmt.Printf(newStr)\n</code></pre>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 962, "favorite_count": 0, "accepted_answer_id": 52711796, "answer_count": 2, "score": 1, "last_activity_date": 1539045513, "creation_date": 1538966112, "last_edit_date": 1539040042, "question_id": 52694693, "link": "https://stackoverflow.com/questions/52694693/calling-appsync-mutation-from-lambda-with-golang", "title": "Calling AppSync Mutation from Lambda with Golang", "body": "<p>I'm trying to invoke a mutation from lambda (specifically using golang). I used <code>AWS_IAM</code> as the authentication method of my AppSync API. I also give <code>appsync:GraphQL</code> permission to my lambda.</p>\n\n<p>However, after looking at the docs here: <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/appsync/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/appsync/</a></p>\n\n<p>I can't find any documentation on how to invoke the appsync from the library. Can anyone point me to the right direction here?</p>\n\n<p>P.S. I don't want to query or subscribe or anything else from lambda. It's just a mutation</p>\n\n<p>Thanks!</p>\n\n<p>------<strong>UPDATE</strong>-------</p>\n\n<p>Thanks to @thomasmichaelwallace for informing me to use <a href=\"https://godoc.org/github.com/machinebox/graphql\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/machinebox/graphql</a></p>\n\n<p>Now the problem is how can I sign the request from that package using aws v4?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 5, "creation_date": 1538948540, "post_id": 52693089, "comment_id": 92313087, "body": "I am a bit confused. You are storing what you download in memory and memory usage is therefore high, correct? Now I am not sure what your question is. Could you please clarify what you are trying to archive?"}, {"owner": {"reputation": 3, "user_id": 5905997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2ec1a3e3a8ce83d5178282df310f95?s=128&d=identicon&r=PG&f=1", "display_name": "prlucknow", "link": "https://stackoverflow.com/users/5905997/prlucknow"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1538949458, "post_id": 52693089, "comment_id": 92313289, "body": "Leon, I am reading the response into the memory mapped byte slice. I have edited the question&#39;s body. Reading the response directly into memory mapped byte slice should not increase the memory usage if I am not wrong."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1538951152, "post_id": 52693089, "comment_id": 92313664, "body": "If you are using the <code>mmap</code> syscall, then the behavior is probably system, or at-least OS specific. Maybe you can pass some flags to <code>mmap</code> to get the kernel not remove old data from memory, but I do not know enough to give you this answer. Maybe also add the code you use to create your memory mapped slices in the question."}, {"owner": {"reputation": 3, "user_id": 5905997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2ec1a3e3a8ce83d5178282df310f95?s=128&d=identicon&r=PG&f=1", "display_name": "prlucknow", "link": "https://stackoverflow.com/users/5905997/prlucknow"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1538951592, "post_id": 52693089, "comment_id": 92313761, "body": "added the code."}, {"owner": {"reputation": 21338, "user_id": 145279, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/r9KgA.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/145279/will"}, "edited": false, "score": 6, "creation_date": 1538957719, "post_id": 52693089, "comment_id": 92314742, "body": "I still don&#39;t see the code."}], "answers": [{"tags": [], "owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "is_accepted": true, "score": 0, "last_activity_date": 1538980676, "creation_date": 1538980676, "answer_id": 52696665, "question_id": 52693089, "link": "https://stackoverflow.com/questions/52693089/increase-in-memory-usage-while-reading-http-response/52696665#52696665", "title": "Increase in memory usage while reading http response", "body": "<p>As far as I concern, the copy move  is just like you allocate a new array and copy elements into it, the memory will be double size of the initial array. By the way, after read data from http response body, you should close it, like:</p>\n\n<pre><code>defer resp.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5905997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2ec1a3e3a8ce83d5178282df310f95?s=128&d=identicon&r=PG&f=1", "display_name": "prlucknow", "link": "https://stackoverflow.com/users/5905997/prlucknow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 52696665, "answer_count": 1, "score": -1, "last_activity_date": 1538980676, "creation_date": 1538947725, "last_edit_date": 1538953637, "question_id": 52693089, "link": "https://stackoverflow.com/questions/52693089/increase-in-memory-usage-while-reading-http-response", "title": "Increase in memory usage while reading http response", "body": "<p>I am working on a tool where I have 300 routines that are downloading a file from a public cloud. All routines are parallely downloading the file block by block (api's supported by cloud). I initially create a file of given size and the memory map it. \nNow I am reading the response body directly into the memory mapped byte slice using the io.ReadFull api. With this, memory eventually spikes to 100%.</p>\n"}, {"tags": ["string", "go", "decoding", "string-decoding"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 2, "creation_date": 1538946281, "post_id": 52692804, "comment_id": 92312596, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12357865/how-do-i-unpack-various-form-of-integers-in-a-byte-buffer-in-golang\">How do I unpack various form of integers in a byte buffer in Golang?</a>"}, {"owner": {"reputation": 21338, "user_id": 145279, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/r9KgA.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/145279/will"}, "edited": false, "score": 0, "creation_date": 1538959348, "post_id": 52692804, "comment_id": 92314952, "body": "I don&#39;t think its quite a duplicate, and it will be useful for those coming from Ruby to see it answered in this context."}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1538962133, "post_id": 52694112, "comment_id": 92315347, "body": "Huh, that&#39;s cool. I&#39;ve used encoding/binary before, but somehow up until now I never noticed that it handled structs :)"}, {"owner": {"reputation": 21338, "user_id": 145279, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/r9KgA.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/145279/will"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1538967411, "post_id": 52694112, "comment_id": 92316164, "body": "Yeah, I just came across it the other day myself :)"}], "tags": [], "owner": {"reputation": 21338, "user_id": 145279, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/r9KgA.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/145279/will"}, "is_accepted": true, "score": 4, "last_activity_date": 1538959267, "creation_date": 1538959267, "answer_id": 52694112, "question_id": 52692804, "link": "https://stackoverflow.com/questions/52692804/string-decoding-in-golang/52694112#52694112", "title": "String Decoding in Golang", "body": "<p>Try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"log\"\n)\n\ntype UnpackedThing struct {\n    First  uint32\n    Second uint32\n    Third  uint32\n\n    Fourth float32\n    Fifth  float32\n}\n\nfunc main() {\n    input := bytes.NewBufferString(\"]\\x00\\x00@\\x00\\x8C\\xD2\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00h.\\x9FAjK\\x8FG\\xC0T\\x87UX\\xA1CH\\xB7\\x80\\x82}\\xBB\\xF9\\x8F\\xBAcqF{\\xE31/Zx\\xC0\\x04\\xFF\\b\\xA0\\xBD\\a\\x9E\\x0F\\x14c+\\b\\xD3\\xE8\\xE1\\xC2\\x1C7\\xBCmd/j\\xC1H\\x191~\\x91F\\b5-\\x8A\\x9F(\\\\\\xF1\\x16/\\x0F\\xEA\\xD9\\x94rV\\xEC\\xBB\\xCB\\x12qJ\\x05\\b\\x04 {R\\xB8\\xA4\\xA9\\xD0)v\\x97&lt;\\xCA\\x92\\xB6U\\b)\\x1D\\x1D\\xF1\\x00\\xE4U\\x8DB\\x16/v\\xEC[bLTW\\xB2\\xFB\\x0F\\x91\\x05\\xAA\\x9C\\xBD\\x8E\\x1A\\xFB\\xDFUJ\\xB8\\xDE\\xF5m\\xC8Z\\xC1\\v\\\\|\\r;\\xB6\\xE6\\xA6\\x13o\\x91\\xE1\\xBA\\x9An\\x8B\\x01W\\xB9\\\"\\x12+\\x9B[\\xC7\\xCD\\xC2O+\\f^|\\xE1G\\x86.%m\\xB2x\\xF1j\\x1B\\\"\\xE41Bu_\\x16J\\xE4M\\x7F\\xC5U[\\xB9\\xD0\\xC7\\xECu\\xE53\\xB4)\\xD5\\x80|\\xB7.\\xD2\\f\\xF3\\x16\\x8B\\xE3\\x13\\x81\\x02:5\\x88\\x0F\")\n    var unpacked UnpackedThing\n\n    err := binary.Read(input, binary.LittleEndian, &amp;unpacked)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"[%d, %d, %d, %f, %f]\\n\",\n        unpacked.First, unpacked.Second, unpacked.Third, unpacked.Fourth, unpacked.Fifth)\n}\n</code></pre>\n\n<p>We're creating a struct that properly represents the binary format, then using <code>binary.Read()</code> to read our bytes into this struct. One thing to note is that golang's strings don't understand <code>\\e</code>, so it must be converted to <code>\\x1b</code>.</p>\n\n<p>Output:</p>\n\n<pre><code>*@x~/go/src/stackoverflow.com/binunpack\u2995 go run main.go\n2018/10/07 17:39:16 [1073741917, 13798400, 0, 2417851639229258349412352.000000, 58518597001656773736660992.000000]\n*@x~/go/src/stackoverflow.com/binunpack\u2995\n</code></pre>\n"}], "owner": {"reputation": 449, "user_id": 2572921, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nepMs.jpg?s=128&g=1", "display_name": "Ben Toogood", "link": "https://stackoverflow.com/users/2572921/ben-toogood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 943, "favorite_count": 0, "accepted_answer_id": 52694112, "answer_count": 1, "score": 2, "last_activity_date": 1538959267, "creation_date": 1538945472, "question_id": 52692804, "link": "https://stackoverflow.com/questions/52692804/string-decoding-in-golang", "title": "String Decoding in Golang", "body": "<p>In Ruby, I'm using the string.unpack method to decode some data. I'm migrating this code into a Golang app, however I can't find a corresponding method in the standard library? </p>\n\n<p>The ruby code is: <code>str.unpack('&gt;LLLff')</code></p>\n\n<p>What is the best way to implement this in Go?</p>\n\n<hr>\n\n<p>Example data:</p>\n\n<pre><code>]\\x00\\x00@\\x00\\x8C\\xD2\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00h.\\x9FAjK\\x8FG\\xC0T\\x87UX\\xA1CH\\xB7\\x80\\x82}\\xBB\\xF9\\x8F\\xBAcqF{\\xE31/Zx\\xC0\\x04\\xFF\\b\\xA0\\xBD\\a\\x9E\\x0F\\x14c+\\b\\xD3\\xE8\\xE1\\xC2\\x1C7\\xBCmd/j\\xC1H\\x191~\\x91F\\b5-\\x8A\\x9F(\\\\\\xF1\\x16/\\x0F\\xEA\\xD9\\x94rV\\xEC\\xBB\\xCB\\x12qJ\\x05\\b\\x04 {R\\xB8\\xA4\\xA9\\xD0)v\\x97&lt;\\xCA\\x92\\xB6U\\b)\\x1D\\x1D\\xF1\\x00\\xE4U\\x8DB\\x16/v\\xEC[bLTW\\xB2\\xFB\\x0F\\x91\\x05\\xAA\\x9C\\xBD\\x8E\\x1A\\xFB\\xDFUJ\\xB8\\xDE\\xF5m\\xC8Z\\xC1\\v\\\\|\\r;\\xB6\\xE6\\xA6\\x13o\\x91\\xE1\\xBA\\x9An\\x8B\\x01W\\xB9\\\"\\x12+\\x9B[\\xC7\\xCD\\xC2O+\\f^|\\xE1G\\x86.%m\\xB2x\\xF1j\\e\\\"\\xE41Bu_\\x16J\\xE4M\\x7F\\xC5U[\\xB9\\xD0\\xC7\\xECu\\xE53\\xB4)\\xD5\\x80|\\xB7.\\xD2\\f\\xF3\\x16\\x8B\\xE3\\x13\\x81\\x02:5\\x88\\x0F\n</code></pre>\n\n<p>Should map to:\n     <code>[1073741917, 13798400, 0, 2.4178516392292583e+24, 5.851859700165677e+25]</code></p>\n"}, {"tags": ["linux", "go", "systemd"], "comments": [{"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1538940289, "post_id": 52691984, "comment_id": 92311049, "body": "Should have mentioned that..I am using Ubuntu."}, {"owner": {"reputation": 2206, "user_id": 1420237, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f427f4dce4e8cd75b6154bae65629e88?s=128&d=identicon&r=PG", "display_name": "Lucas Werkmeister", "link": "https://stackoverflow.com/users/1420237/lucas-werkmeister"}, "edited": false, "score": 1, "creation_date": 1539100649, "post_id": 52691984, "comment_id": 92375347, "body": "If there isn\u2019t a specific Go API for the journal, you could either use the <code>sd-journal</code> C API via some Go-C bindings (see <code>man 3 sd-journal</code>) or run <code>journalctl</code> with a suitable output format (e.\u202fg. <code>journalctl -o json</code>) and parse that. I\u2019m not sure which option would be preferable."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1539129087, "post_id": 52691984, "comment_id": 92386541, "body": "systemd questions should get asked over at sibling site <a href=\"https://unix.stackexchange.com/\">unix.stackexchange.com</a>    the entry point is dir /etc/systemd/system in which are subdirs for various services in each subdir are its config files which may or may not contain log config details ... I suggest you figure out how to create a toy systemd service of your own then do battle on viewing its logging where you are starting from a known known"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 1, "creation_date": 1539129931, "post_id": 52691984, "comment_id": 92386724, "body": "I viewed it more as a Go question. unix.stackexchange.com doesn&#39;t have a Go tag. ;("}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1539144107, "post_id": 52691984, "comment_id": 92389804, "body": "@MarissaLevy it is a binary encoded so you cannot be able to put that in a file. Since it is used to view system logs on linux terminal."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1539154789, "creation_date": 1539154789, "answer_id": 52734410, "question_id": 52691984, "link": "https://stackoverflow.com/questions/52691984/how-do-i-analyze-journalctl-logs-outside-of-journalctl/52734410#52734410", "title": "How do I analyze journalctl logs outside of journalctl?", "body": "<p>You can get some clues with projects like:</p>\n\n<ul>\n<li><a href=\"https://github.com/ChimeraCoder/journalctl-go\" rel=\"nofollow noreferrer\"><code>ChimeraCoder/journalctl-go</code></a></li>\n<li><a href=\"https://github.com/eparis/access-daemon\" rel=\"nofollow noreferrer\"><code>eparis/access-daemon</code></a></li>\n<li><a href=\"https://github.com/chrissnell/kube-journald-filter\" rel=\"nofollow noreferrer\"><code>chrissnell/kube-journald-filter</code></a> which uses <a href=\"https://github.com/coreos/go-systemd/tree/master/sdjournal\" rel=\"nofollow noreferrer\"><code>coreos/go-systemd/</code> <code>sdjournal</code> package</a>, with a <a href=\"https://github.com/coreos/go-systemd/blob/b14d3eb023cc860c82b1bb143bb98122d3c40224/sdjournal/journal.go#L315-L316\" rel=\"nofollow noreferrer\">Journal class</a> following the <a href=\"https://www.freedesktop.org/software/systemd/man/systemd.journal-fields.html\" rel=\"nofollow noreferrer\">fields of an actual journal</a>.<br>\nSee the <a href=\"https://github.com/coreos/go-systemd/blob/b14d3eb023cc860c82b1bb143bb98122d3c40224/sdjournal/journal_test.go\" rel=\"nofollow noreferrer\">test class <code>journal_test.go</code></a>.</li>\n</ul>\n\n<p>Or you could directly forward it to an external syslog, as in <a href=\"https://github.com/pmorton/journalfwd\" rel=\"nofollow noreferrer\"><code>pmorton/journalfwd</code></a>.</p>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1033, "favorite_count": 4, "accepted_answer_id": 52734410, "answer_count": 1, "score": 1, "last_activity_date": 1539154789, "creation_date": 1538939767, "last_edit_date": 1538942894, "question_id": 52691984, "link": "https://stackoverflow.com/questions/52691984/how-do-i-analyze-journalctl-logs-outside-of-journalctl", "title": "How do I analyze journalctl logs outside of journalctl?", "body": "<p>I need to collect some stats from my systemd log files, like how many users pass in a certain query string parameter to my service. I know I can view this information in journalctl but I can't figure out how to do so in Go so that I can aggregate the data. I've been looking for a library for this but can't seem to find anything and I can't figure out where the log files are actually stored.</p>\n"}, {"tags": ["json", "string", "go"], "answers": [{"comments": [{"owner": {"reputation": 203, "user_id": 7919991, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c67ec46250dd36b37af6c51f7ee6c899?s=128&d=identicon&r=PG&f=1", "display_name": "nihal", "link": "https://stackoverflow.com/users/7919991/nihal"}, "edited": false, "score": 0, "creation_date": 1540735611, "post_id": 52692253, "comment_id": 92965034, "body": "Thanks for this code. However, I am looking to enhance it for nested json arrays. I tried recursion but couldn&#39;t get it to work. For example, I would like procMap to handle the following json :  { &quot;assetId&quot;:&quot;&quot;, &quot;lineItems&quot;:[ \t{&quot;lineItemId&quot;:&quot;&quot;, \t&quot;Expenses&quot;:&quot;&quot;, \t&quot;Date&quot;:&quot;&quot;, \t&quot;comment&quot;: [ {&quot;userId&quot;:&quot;&quot;,&quot;comment&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;&quot;},...] \t}, \t....  \t] }   Note: My json has nested arrays. Currently my program calls procMap once per array row. This results in a lot of conversions/recoversions before/after the call, redundant and dirty code."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1538952333, "last_edit_date": 1538952333, "creation_date": 1538941713, "answer_id": 52692253, "question_id": 52690337, "link": "https://stackoverflow.com/questions/52690337/intersection-of-json-strings/52692253#52692253", "title": "Intersection of JSON strings", "body": "<p>Simply create a function which \"clones\" a map based on a template and a source map.</p>\n\n<p>The solution would iterate over the entries of the template map, and for each <code>(k, v)</code> pair generate an entry in the destination map as follows:</p>\n\n<ul>\n<li><p>If <code>v</code> is not a map, simply get the value for the <code>k</code> key from the source map, and use this in the destination.</p></li>\n<li><p>If <code>v</code> is also a map, then call this \"cloner\" recursively with the new template map being <code>v</code> and the new source being the value from the source for the <code>k</code> key. The result of this recursive call will be the value for the <code>k</code> key in the destination map.</p></li>\n</ul>\n\n<p>This is how it could look like:</p>\n\n<pre><code>func procMap(tmpl, src map[string]interface{}) (dst map[string]interface{}) {\n    dst = map[string]interface{}{}\n\n    for k, v := range tmpl {\n        if innerMap, ok := v.(map[string]interface{}); ok {\n            dst[k] = procMap(innerMap, src[k].(map[string]interface{}))\n        } else {\n            dst[k] = src[k]\n        }\n    }\n\n    return dst\n}\n</code></pre>\n\n<p>And that's all.</p>\n\n<p>Testing it:</p>\n\n<pre><code>// tmpljson is the template JSON\nvar tmpl map[string]interface{}\nif err := json.Unmarshal([]byte(tmpljson), &amp;tmpl); err != nil {\n    panic(err)\n}\n\n// srcjson is the source JSON\nvar src map[string]interface{}\nif err := json.Unmarshal([]byte(srcjson), &amp;src); err != nil {\n    panic(err)\n}\n\ndst := procMap(tmpl, src)\n\nenc := json.NewEncoder(os.Stdout)\nenc.SetIndent(\"\", \"  \")\nif err := enc.Encode(dst); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Output with your example JSONs (try it on the <a href=\"https://play.golang.org/p/yONY1K46rwM\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\n  \"id\": \"831\",\n  \"options\": {\n    \"leatherseats\": \"black\",\n    \"sunroof\": \"full\"\n  }\n}\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>The solution <em>assumes</em> the source map conforms to the template. That is, if the template contains a map for some key, the source map is also expected to contain a map for the same key. If this cannot be guaranteed, the <code>procMap()</code> function should be extended with a check to avoid a runtime panic, like this:</p>\n\n<pre><code>for k, v := range tmpl {\n    if innerMap, ok := v.(map[string]interface{}); ok {\n        if src2, ok2 := src[k].(map[string]interface{}); ok2 {\n            dst[k] = procMap(innerMap, src2)\n        } else {\n            log.Printf(\"src is not conform to template at key %q\", k)\n        }\n    } else {\n        dst[k] = src[k]\n    }\n}\n</code></pre>\n\n<p>Also note that JSON arrays (slices) are not treated in any special way, meaning if the template contains a slice, the value from the source is used as-is, and no recursion happens if the slice contains maps. The solution can easily be extended to handle slices too, which is left as an exercise for the reader.</p>\n"}], "owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 52692253, "answer_count": 1, "score": 5, "last_activity_date": 1540461901, "creation_date": 1538928176, "last_edit_date": 1539693742, "question_id": 52690337, "link": "https://stackoverflow.com/questions/52690337/intersection-of-json-strings", "title": "Intersection of JSON strings", "body": "<p>I'm trying to find a way to use one JSON string as a \"template\" of sorts to apply to another JSON string. For instance, if my template looks as follows:</p>\n\n<pre><code>{\n   \"id\": \"1\",\n   \"options\": {\n      \"leatherseats\": \"1\",\n      \"sunroof\": \"1\"\n   }\n}\n</code></pre>\n\n<p>which I then apply to the following JSON string:</p>\n\n<pre><code>{\n   \"id\": \"831\",\n   \"serial\": \"19226715\",\n   \"options\": {\n      \"leatherseats\": \"black\",\n      \"sunroof\": \"full\",\n      \"fluxcapacitor\": \"yes\"\n   }\n}\n</code></pre>\n\n<p>I'd like a resultant JSON string as follows:</p>\n\n<pre><code>{\n   \"id\": \"831\",\n   \"options\": {\n      \"leatherseats\": \"black\",\n      \"sunroof\": \"full\",\n   }\n}\n</code></pre>\n\n<p>Unfortunately I can't rely on either the template nor the input to be of a fixed format so I can't marshall/unmarshall into defined interfaces.</p>\n\n<p>I got as far as writing a recursive function that traverses the template to construct a slice of string with the name of each node that is to be included.</p>\n\n<pre><code>func traverseJSON(key string, value interface{}) []string {\n    var retval []string\n    unboxed, ok := value.(map[string]interface{})\n    if ok {\n        for newkey, newvalue := range unboxed {\n            retval = append(retval, recurse(fmt.Sprintf(\"%s.%s\", key, newkey), newvalue)...)\n        }\n    } else {\n        retval = append(retval, fmt.Sprintf(\"%s\", key))\n    }\n    return retval\n}\n</code></pre>\n\n<p>I call this function as follows:</p>\n\n<pre><code>template := `my JSON template here`\nvar result map[string]interface{}\njson.Unmarshal([]byte(template), &amp;result)\n\nvar nodenames []string\nnodenames = append(nodenames, traverseJSON(\"\", result)...)\n</code></pre>\n\n<p>I was then going to write a second function that takes this slice of node names to construct a JSON string from the input JSON string but ran out of steam and started thinking that I might be on the wrong track anyway.</p>\n\n<p>Any help on this would be appreciated.</p>\n"}, {"tags": ["go", "synchronization", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1538930106, "post_id": 52689901, "comment_id": 92308090, "body": "Like variables of other types, assignment to a function variable is not atomic.  The code is not threadsafe if retFunc can be called concurrently with the assignment in the select."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1538939040, "post_id": 52689901, "comment_id": 92310692, "body": "As ThunderCat wrote, just because type of <code>secretFunc</code> is a function, it&#39;s no exception to the simple rule: if multiple goroutines access a variable concurrently, and at least one of the accesses is a write, then synchronization is required."}], "owner": {"reputation": 1830, "user_id": 1927794, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b7b26bda58eac7f333cc428421a711cd?s=128&d=identicon&r=PG", "display_name": "Arkady", "link": "https://stackoverflow.com/users/1927794/arkady"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1538938937, "answer_count": 0, "score": 0, "last_activity_date": 1538925758, "creation_date": 1538925245, "last_edit_date": 1538925758, "question_id": 52689901, "link": "https://stackoverflow.com/questions/52689901/is-it-goroutine-safe-to-reassign-pointer-to-function", "closed_reason": "Duplicate", "title": "Is it goroutine-safe to reassign pointer to function?", "body": "<p>I have sharable object. Let's call it OBJ.</p>\n\n<p>I wanted rarely update it. And to be able to read it frequently without locking.</p>\n\n<p>I've tried this:</p>\n\n<pre><code>func Initialize() (func() func() OBJ, func()) {\n    genFunc := func() func() OBJ {\n        OBJ := getNewObject()\n        secretFunc := func() OBJ {\n            return OBJ\n        }\n        return secretFunc\n    }\n    secretFunc := genFunc()\n\n    timer := time.NewTicker(time.Duration(timeoutSec) * time.Second)\n\n    finish := make(chan bool)\n    go func() {\n        for {\n            select {\n            case &lt;-finish:\n                close(finish)\n                return\n            case &lt;-timer.C:\n                secretFunc = genFunc()\n            }\n        }\n    }()\n\n    retFunc := func() func() OBJ {\n        return secretFunc\n    }\n\n    shutDownRet := func() {\n        finish &lt;- true\n        timer.Stop()\n    }\n    return retFunc, shutDownRet\n}\n</code></pre>\n\n<p>In this example, real sharable is not an OBJ, but function \"secretFunc\". </p>\n\n<p>Is it thread/goroutine safe to do this trick with replacement of secretFunc without any locking? I would like to avoid using <code>CAS</code> &amp; <code>unsafe.Pointers</code>.</p>\n\n<p>If this is not safe, what is the pattern (if it exists) to implement this to be safe?</p>\n"}, {"tags": ["go", "csrf", "hybris"], "comments": [{"owner": {"reputation": 7393, "user_id": 247843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efb28219278d4fb05b46c7806fad2c76?s=128&d=identicon&r=PG", "display_name": "gp.", "link": "https://stackoverflow.com/users/247843/gp"}, "edited": false, "score": 0, "creation_date": 1538914101, "post_id": 52687618, "comment_id": 92303715, "body": "there could be more that one cookie needed for session here. better than copying cookies use cookie jar that takes care of cookie handling.. this could help <a href=\"https://stackoverflow.com/questions/12756782/go-http-post-and-use-cookies#19386573\" title=\"go http post and use cookies%2319386573\">stackoverflow.com/questions/12756782/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 10330947, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tdhBF3R9YeI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO1whMTKeJJU59o93tllfmh3K4atg/mo/photo.jpg?sz=128", "display_name": "Asha Kabra", "link": "https://stackoverflow.com/users/10330947/asha-kabra"}, "is_accepted": true, "score": 0, "last_activity_date": 1538934098, "last_edit_date": 1538934098, "creation_date": 1538933645, "answer_id": 52691113, "question_id": 52687618, "link": "https://stackoverflow.com/questions/52687618/post-operation-fails-with-csrf-token-validation-failed-error/52691113#52691113", "title": "Post operation fails with &quot;CSRF token validation failed&quot; error", "body": "<p>It worked!\nAs mentioned by @gp, I had to copy all cookies instead of just setting header. I did below change in code snippet</p>\n\n<pre><code>//request.Header.Set(\"Cookie\", res.Header.Get(\"Set-Cookie\"))\nfor i := 0; i &lt; len(res.Cookies()); i++ {\n    request.AddCookie(res.Cookies()[i])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 852, "user_id": 5257091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc47a8cf1d2b724d380ca93f5223eb93?s=128&d=identicon&r=PG&f=1", "display_name": "Hasnaa Ibraheem", "link": "https://stackoverflow.com/users/5257091/hasnaa-ibraheem"}, "is_accepted": false, "score": 0, "last_activity_date": 1610438194, "creation_date": 1610438194, "answer_id": 65679919, "question_id": 52687618, "link": "https://stackoverflow.com/questions/52687618/post-operation-fails-with-csrf-token-validation-failed-error/65679919#65679919", "title": "Post operation fails with &quot;CSRF token validation failed&quot; error", "body": "<p>I face it with tomcat 9 sometimes, in my case, just logout and relogin solve the issue. <br>It seems that the java app was using an expired cookie but didn't redirect me to the logout page by mistake.</p>\n"}], "owner": {"reputation": 21, "user_id": 10330947, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tdhBF3R9YeI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO1whMTKeJJU59o93tllfmh3K4atg/mo/photo.jpg?sz=128", "display_name": "Asha Kabra", "link": "https://stackoverflow.com/users/10330947/asha-kabra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6310, "favorite_count": 0, "accepted_answer_id": 52691113, "answer_count": 2, "score": 0, "last_activity_date": 1610438194, "creation_date": 1538908196, "last_edit_date": 1603956498, "question_id": 52687618, "link": "https://stackoverflow.com/questions/52687618/post-operation-fails-with-csrf-token-validation-failed-error", "title": "Post operation fails with &quot;CSRF token validation failed&quot; error", "body": "<p>I am trying POST operation on SAP Hybris C4C entity.</p>\n\n<p>I came across many blogs where it was mentioned that we need to send X-CSRF-Token during POST which can first be retrieved using GET operation.</p>\n\n<p>I was successfully able to do that using Postman. as Postman stores cookie not causing to CSRF token validation failure.</p>\n\n<p>But, I actually want to call this using golang. And I was getting everytime error as \"CSRF token validation failed\". Then after going through many blogs I found we not only have to set X-CSRF-Token but also Cookie so that HTTP POST is not treated as new session. otherwise the csrf token we sent does not match with current session causing error.</p>\n\n<p>Even after following above two leads, I am still getting error. Below is the code snippet, I am not sure what else is missing.</p>\n\n<p>Code snippet: </p>\n\n<pre><code>auth := \"******:*****\"\nbasicAuth := base64.StdEncoding.EncodeToString([]byte(auth))\n\ngeturl := \"https://******.crm.ondemand.com/sap/c4c/odata/v1/c4codataapi\"\nreq, _ := http.NewRequest(\"GET\", geturl, nil)\nreq.Header.Set(\"Authorization\", \"Basic \"+basicAuth)\nreq.Header.Set(\"X-Csrf-Token\", \"Fetch\")\ncli := &amp;http.Client{}\nres, _ := cli.Do(req)\n\ninputMap := make(map[string]interface{})\ninputMap[\"PriorityCodeText\"] = \"Normal\"\ninputJSON, _ := json.Marshal(inputMap)\n\nurl := \"https://*******.crm.ondemand.com/sap/c4c/odata/v1/c4codataapi/OpportunityCollection\"\nrequest, _ := http.NewRequest(\"POST\", url, bytes.NewBuffer(inputJSON))\nrequest.Header.Set(\"Authorization\", \"Basic \"+basicAuth)\nrequest.Header.Set(\"X-Csrf-Token\", res.Header.Get(\"X-Csrf-Token\"))\nrequest.Header.Set(\"Cookie\", res.Header.Get(\"Set-Cookie\"))\nrequest.Header.Set(\"X-Requested-With\", \"XMLHttpRequest\")\nrequest.Header.Set(\"Content-Type\", \"application/atomsvc+xml\")\nrequest.Header.Set(\"DataServiceVersion\", \"2.0\")\n//request.Header.Set(\"Accept\", \"application/atom+xml\")\nclient := &amp;http.Client{}\nresp, _ := client.Do(request)\nfmt.Printf(\"Response status code is: %d\", resp.StatusCode)\njsonResponseData, _ := ioutil.ReadAll(resp.Body)\nfmt.Printf(\"Response is: %s\", jsonResponseData)\n</code></pre>\n"}]