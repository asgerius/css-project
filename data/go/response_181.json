[{"tags": ["go", "casting", "type-conversion", "dice"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1530143381, "post_id": 51072845, "comment_id": 89135351, "body": "i, err := strconv.Atoi(input[:1])"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530182615, "post_id": 51072845, "comment_id": 89150002, "body": "Go doesn&#39;t have type casting. You&#39;re also not talking about typecasting at all. You&#39;re talking about type conversion and string parsing."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530182634, "post_id": 51072845, "comment_id": 89150017, "body": "More important: What have you tried, and what problems did you encounter? Show your code."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1530143750, "creation_date": 1530143750, "answer_id": 51072915, "question_id": 51072845, "link": "https://stackoverflow.com/questions/51072845/golang-typecasting/51072915#51072915", "title": "Golang Typecasting", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    input := \"3d6\"\n    i := int(input[0] - '0')\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/061miKcXdIF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/061miKcXdIF</a></p>\n\n<p>Output:</p>\n\n<pre><code>3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 510, "user_id": 929861, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/78b7fffa0b32c016b013c5edd1c945d9?s=128&d=identicon&r=PG&f=1", "display_name": "tonymke", "link": "https://stackoverflow.com/users/929861/tonymke"}, "is_accepted": false, "score": 1, "last_activity_date": 1530178731, "last_edit_date": 1530178731, "creation_date": 1530157178, "answer_id": 51074360, "question_id": 51072845, "link": "https://stackoverflow.com/questions/51072845/golang-typecasting/51074360#51074360", "title": "Golang Typecasting", "body": "<p>There's two problems here:</p>\n\n<h2>How to convert a string to an integer</h2>\n\n<p>The most straightforward method is the <a href=\"https://golang.org/pkg/strconv/#Atoi\" rel=\"nofollow noreferrer\"><code>Atoi</code></a> (ASCII to integer) function in the <code>strconv</code> package., which will take a string of numeric characters and coerce them into an integer for you.</p>\n\n<h2>How to extract meaningful components of a known string pattern</h2>\n\n<p>In order to use <code>strconv.Atoi</code>, we need the numeric characters of the input by themselves. There's lots of ways to slice and dice a string.</p>\n\n<ul>\n<li><p>You can just grab the first and last characters directly - <code>input[:1]</code> and <code>input[2:]</code> are the ticket.</p></li>\n<li><p>You could split the string into two strings on the character \"d\". Look at the <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>split</code></a> method, a member of the <code>strings</code> package.</p></li>\n<li><p>For more complex problems in this space, <em><a href=\"https://en.wikipedia.org/wiki/Regular_expression\" rel=\"nofollow noreferrer\">regular expressions</a></em> are used. They're a way to define a pattern the computer can look for. For example, the regular expression <code>^x(\\d+)$</code> will match on any string that starts with the character <code>x</code> and is followed by one or more numeric characters. It will provide direct access to the numeric characters it found by themselves.</p>\n\n<ul>\n<li>Go has first class support for regular expressions via its <a href=\"https://golang.org/pkg/regexp\" rel=\"nofollow noreferrer\"><code>regexp</code></a> package.</li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 5, "user_id": 9952642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccbe2c2138ed90086eb396cafc7030b6?s=128&d=identicon&r=PG&f=1", "display_name": "Fatih Canbekli", "link": "https://stackoverflow.com/users/9952642/fatih-canbekli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "answer_count": 2, "score": -3, "last_activity_date": 1530178731, "creation_date": 1530143106, "question_id": 51072845, "link": "https://stackoverflow.com/questions/51072845/golang-typecasting", "title": "Golang Typecasting", "body": "<p>I have specific questions for my project</p>\n\n<p>input = \"3d6\"</p>\n\n<p>I want to convert this string some parts to integer. For instance I want to use input[0] like integer.\nHow can I do this?</p>\n"}, {"tags": ["go", "struct", "mapping"], "comments": [{"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 4, "creation_date": 1530139958, "post_id": 51072463, "comment_id": 89134626, "body": "What do you mean by &quot;mapping that changes dynamically&quot;? Can you give more details on the problem you are trying to solve?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530140294, "post_id": 51072463, "comment_id": 89134715, "body": "Your question is unclear, but you can&#39;t create a type that isn&#39;t declared somewhere."}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "edited": false, "score": 0, "creation_date": 1530176995, "post_id": 51072463, "comment_id": 89146472, "body": "I was thinking to create a separate .go file that stores the last state of the created struct, and update this file if the received .json cannot be unmarshalled. This way the last known state can always be accessed without having to manually update the struct itself. I was thinking to do this by using the mapping of the newly received .json to update the struct. I hope it makes sense."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530195557, "post_id": 51072463, "comment_id": 89158844, "body": "What are you doing with this proposed <code>.go</code> file? Compiling a new program and exec&#39;ing into that? If you have dynamic keys you really just have to use a map."}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1530139835, "creation_date": 1530139835, "question_id": 51072463, "link": "https://stackoverflow.com/questions/51072463/is-it-possible-to-generate-struct-from-mapping-in-golang", "title": "Is it possible to generate struct from mapping in golang", "body": "<p>I have a mapping that changes dynamically with fields being added and removed, I was wondering if it was possible to create a struct like that</p>\n\n<pre><code>type Stats struct {\ncnt      int\ncategory map[string]Events\n}\n</code></pre>\n\n<p>Without having to declare it beforehand. Thanks!</p>\n"}, {"tags": ["python", "macos", "sockets", "go", "networking"], "comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1530132695, "post_id": 51071020, "comment_id": 89132234, "body": "Are you 100% sure you&#39;re not running an old build with a different port or something..? <code>http.ListenAndServe</code> also calls <code>net.Listen(&quot;tcp&quot;, addr)</code> internally: <a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2728\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/net/http/server.go#L272&zwnj;&#8203;8</a>"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1530132734, "post_id": 51071020, "comment_id": 89132257, "body": "yup, 100% certain"}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1530132766, "post_id": 51071020, "comment_id": 89132281, "body": "It might be useful to add a <code>time.Sleep(10 * time.Second)</code> call to the end of your Go program and get <code>netstat</code> output while it&#39;s running."}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "edited": false, "score": 0, "creation_date": 1530132980, "post_id": 51071020, "comment_id": 89132357, "body": "Excellent idea: <a href=\"https://gist.github.com/llimllib/9f86f61a9436e9f59edf39d97c9b8dca\" rel=\"nofollow noreferrer\">gist.github.com/llimllib/9f86f61a9436e9f59edf39d97c9b8dca</a> . It binds to <code>tcp46</code> instead of <code>tcp4</code> or <code>tcp6</code>, but I don&#39;t know what that really means?"}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1530143766, "post_id": 51071020, "comment_id": 89135417, "body": "Can you provide the output to <code>lsof -i -T f | grep 8888</code> while the Go program is running?"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1530150539, "post_id": 51071020, "comment_id": 89136701, "body": "@chuckx <code>lsof -i -T f | grep 8888</code> is empty both before the program runs and while it runs, are you sure those are correct Mac lsof options?"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1530150962, "post_id": 51071020, "comment_id": 89136758, "body": "@chuckx ok, I think I found the relevant results in the output, they don&#39;t list the port number but here they are: <a href=\"https://gist.github.com/llimllib/854d8b737ad2405479b64eb5f70ce0fa\" rel=\"nofollow noreferrer\">gist.github.com/llimllib/854d8b737ad2405479b64eb5f70ce0fa</a>"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1530151193, "post_id": 51071020, "comment_id": 89136806, "body": "@chuckx thank you for the idea! Here is a <i>much</i> faster lsof invocation to study the problem: <code>lsof -i :8888 -T f</code> (which outputs the same as before)"}], "answers": [{"tags": [], "owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "is_accepted": true, "score": 2, "last_activity_date": 1530153408, "creation_date": 1530153408, "answer_id": 51073906, "question_id": 51071020, "link": "https://stackoverflow.com/questions/51071020/golang-net-listen-binds-to-port-thats-already-in-use/51073906#51073906", "title": "Golang net.Listen binds to port that&#39;s already in use", "body": "<p>OK, I think I have a story to tell about why this happens:</p>\n\n<ol>\n<li>Docker on mac, when mapping a port, binds to IPv4 <code>0.0.0.0:&lt;port&gt;</code> and IPv6 <code>[::1]:&lt;port&gt;</code>. Note that on IPv6 it maps to the equivalent of <code>localhost</code> rather than <code>0.0.0.0</code>, which would be <code>[::]</code>!</li>\n<li>Golang, when opening a socket to listen on, by default opens an IPv6 socket that is mapped in some way to also listen to IPv4. (I still don't completely understand this <code>tcp46</code> type, so if you have good docs <em>please</em> point me to them!).</li>\n<li>So my golang program was opening an IPv6 socket on <code>[::]:8888</code>, the equivalent of <code>0.0.0.0:8888</code> in IPv6. This succeeded because docker was listening on <code>[::1]</code> (the equivalent of 127.0.0.1), <em>not</em> <code>[::]</code></li>\n<li>That's it! So the golang program succeeded even though it will only get connected to by a client connecting on IPv6 from a non-loopback address (I think, I got too tired to test this, give me a break)</li>\n</ol>\n\n<p>My coworker reports that on Ubuntu, docker listens on <code>[::]</code>, which is why he was unable to reproduce the problem I was seeing. This seems like the sensible behavior! And I have no idea why it doesn't do so on mac.</p>\n\n<p>I also think it's surprising and possibly a bit wrong that Go happily succeeds in this instance, even though it's creating a socket that's very difficult to actually access? But I can't say that it's definitely a bug, and I <em>definitely</em> don't feel like trying to report it as such to the go project.</p>\n"}, {"comments": [{"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "edited": false, "score": 1, "creation_date": 1530191221, "post_id": 51074226, "comment_id": 89155696, "body": "Thank you for your help! I don&#39;t think we would have cracked it without that lsof, and this is valuable information on this strange corner of unix networking :)"}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": false, "score": 1, "last_activity_date": 1530157971, "last_edit_date": 1530157971, "creation_date": 1530156255, "answer_id": 51074226, "question_id": 51071020, "link": "https://stackoverflow.com/questions/51071020/golang-net-listen-binds-to-port-thats-already-in-use/51074226#51074226", "title": "Golang net.Listen binds to port that&#39;s already in use", "body": "<p>Regarding the <code>tcp46</code> output from <code>netstat</code>, I can't find any documentation but I did find the relevant source.</p>\n\n<p>From <a href=\"https://opensource.apple.com/source/network_cmds/network_cmds-543/netstat.tproj/inet.c.auto.html\" rel=\"nofollow noreferrer\">network_cmds-543/netstat.proj/inet.c</a>:</p>\n\n<pre><code>void\nprotopr(uint32_t proto,     /* for sysctl version we pass proto # */\n        char *name, int af)\n{\n\n...\n\n    struct xinpcb_n *inp = NULL;\n\n...\n\n            const char *vchar;\n\n#ifdef INET6\n            if ((inp-&gt;inp_vflag &amp; INP_IPV6) != 0)\n                vchar = ((inp-&gt;inp_vflag &amp; INP_IPV4) != 0)\n                ? \"46\" : \"6 \";\n            else\n#endif\n                vchar = ((inp-&gt;inp_vflag &amp; INP_IPV4) != 0)\n                ? \"4 \" : \"  \";\n</code></pre>\n\n<p><code>xinpcb_n</code> is defined in <a href=\"https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/netinet/in_pcb.h#L425\" rel=\"nofollow noreferrer\">bsd/netinet/in_pcb.h</a>.</p>\n\n<pre><code> * struct inpcb captures the network layer state for TCP, UDP and raw IPv6\n * and IPv6 sockets.\n</code></pre>\n\n<p>Elsewhere in that file, the <code>inp_vflag</code> is documented as <code>/* INP_IPV4 or INP_IPV6 */</code>. Those are in turn defined as:</p>\n\n<pre><code>#define INP_IPV4    0x1\n#define INP_IPV6    0x2\n</code></pre>\n\n<p>So basically, when a socket has both v4 and v6 bits set, it will display <code>46</code> in the protocol column.</p>\n\n<hr>\n\n<p>Regarding Go, there's <a href=\"https://github.com/golang/go/blob/ef9217e7bd9c854e4f8d2d79ff8aec550130cbc4/src/net/sock_posix.go#L18\" rel=\"nofollow noreferrer\">this <code>socket()</code> function in the net package</a>:</p>\n\n<pre><code>func socket(ctx context.Context, net string, family, sotype, proto int, ipv6only bool, laddr, raddr sockaddr, ctrlFn func(string, string, syscall.RawConn) error) (fd *netFD, err error) {\n\n...\n\nif err = setDefaultSockopts(s, family, sotype, ipv6only); err != nil {\n</code></pre>\n\n<p><code>setDefaultSockopts()</code> has per platform definitions, here's an excerpt from <a href=\"https://github.com/golang/go/blob/257d6c48e0abde069e5acc67f719a129d0017186/src/net/sockopt_bsd.go#L15\" rel=\"nofollow noreferrer\">the BSD variant</a>: </p>\n\n<pre><code>func setDefaultSockopts(s, family, sotype int, ipv6only bool) error {\n\n...\n\n    if supportsIPv4map() &amp;&amp; family == syscall.AF_INET6 &amp;&amp; sotype != syscall.SOCK_RAW {\n        // Allow both IP versions even if the OS default\n        // is otherwise. Note that some operating systems\n        // never admit this option.\n        syscall.SetsockoptInt(s, syscall.IPPROTO_IPV6, syscall.IPV6_V6ONLY, boolint(ipv6only))\n</code></pre>\n\n<p>So, allowing of both IP versions on a socket is driven by the <code>ipv6Only</code> boolean. After a little more digging, I found <a href=\"https://github.com/golang/go/blob/ef9217e7bd9c854e4f8d2d79ff8aec550130cbc4/src/net/ipsock_posix.go#L72\" rel=\"nofollow noreferrer\">where this is decided</a> and includes a detailed explanation of the logic:</p>\n\n<pre><code>// favoriteAddrFamily returns the appropriate address family for the\n// given network, laddr, raddr and mode.\n//\n// If mode indicates \"listen\" and laddr is a wildcard, we assume that\n// the user wants to make a passive-open connection with a wildcard\n// address family, both AF_INET and AF_INET6, and a wildcard address\n// like the following:\n//\n//  - A listen for a wildcard communication domain, \"tcp\" or\n//    \"udp\", with a wildcard address: If the platform supports\n//    both IPv6 and IPv4-mapped IPv6 communication capabilities,\n//    or does not support IPv4, we use a dual stack, AF_INET6 and\n//    IPV6_V6ONLY=0, wildcard address listen. The dual stack\n//    wildcard address listen may fall back to an IPv6-only,\n//    AF_INET6 and IPV6_V6ONLY=1, wildcard address listen.\n//    Otherwise we prefer an IPv4-only, AF_INET, wildcard address\n//    listen.\n//\n//  - A listen for a wildcard communication domain, \"tcp\" or\n//    \"udp\", with an IPv4 wildcard address: same as above.\n//\n//  - A listen for a wildcard communication domain, \"tcp\" or\n//    \"udp\", with an IPv6 wildcard address: same as above.\n//\n//  - A listen for an IPv4 communication domain, \"tcp4\" or \"udp4\",\n//    with an IPv4 wildcard address: We use an IPv4-only, AF_INET,\n//    wildcard address listen.\n//\n//  - A listen for an IPv6 communication domain, \"tcp6\" or \"udp6\",\n//    with an IPv6 wildcard address: We use an IPv6-only, AF_INET6\n//    and IPV6_V6ONLY=1, wildcard address listen.\n//\n// Otherwise guess: If the addresses are IPv4 then returns AF_INET,\n// or else returns AF_INET6. It also returns a boolean value what\n// designates IPV6_V6ONLY option.\n//\n// Note that the latest DragonFly BSD and OpenBSD kernels allow\n// neither \"net.inet6.ip6.v6only=1\" change nor IPPROTO_IPV6 level\n// IPV6_V6ONLY socket option setting.\n</code></pre>\n"}], "owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3477, "favorite_count": 1, "accepted_answer_id": 51073906, "answer_count": 2, "score": 5, "last_activity_date": 1530157971, "creation_date": 1530131745, "last_edit_date": 1530152016, "question_id": 51071020, "link": "https://stackoverflow.com/questions/51071020/golang-net-listen-binds-to-port-thats-already-in-use", "title": "Golang net.Listen binds to port that&#39;s already in use", "body": "<p>Port 8888 is already bound on my (OS X 10.13.5) system, by a process running inside a docker container:</p>\n\n<pre><code>$ netstat -an | grep 8888\ntcp6       0      0  ::1.8888               *.*                    LISTEN\ntcp4       0      0  *.8888                 *.*                    LISTEN\n</code></pre>\n\n<p>A python program which tries to bind to that port (using as close to the socket options of golang as I can manage), fails in the way I expect:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>import socket\nimport fcntl\nimport os\n\n\ndef main():\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    flag = fcntl.fcntl(sock.fileno(), fcntl.F_GETFL)\n    fcntl.fcntl(sock.fileno(), fcntl.F_SETFL, flag | os.O_NONBLOCK)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)\n    sock.bind((\"0.0.0.0\", 8888))\n    sock.listen(5)\n\n\nmain()\n</code></pre>\n\n<p>fails with:</p>\n\n<pre><code>$ python test.py\nTraceback (most recent call last):\n  File \"test.py\", line 15, in &lt;module&gt;\n    main()\n  File \"test.py\", line 11, in main\n    sock.bind((\"0.0.0.0\", 8888))\nOSError: [Errno 48] Address already in use\n</code></pre>\n\n<p>But a go program creating a connection via <code>net.Listen</code> does not fail, as I expect it to:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    _, err := net.Listen(\"tcp\", \"0.0.0.0:8888\")\n    if err != nil {\n        fmt.Printf(\"Connection error: %s\\n\", err)\n    } else {\n        fmt.Println(\"Listening\")\n    }\n}\n</code></pre>\n\n<p>Succeeds with:</p>\n\n<pre><code>$ go run test.go\nListening\n</code></pre>\n\n<p>A coworker reports that with the same setup, his Ubuntu system correctly fails the go program.</p>\n\n<p>Why does this succeed on a Mac, and how can I get the net.Listen to show an error in binding to port 8888?</p>\n\n<p>edit: If I occupy port 8888 with a simple go program like:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    log.Fatal(http.ListenAndServe(\"0.0.0.0:8888\", nil))\n}\n</code></pre>\n\n<p>Then <code>test.go</code> correctly fails to bind to the port. However the docker process (which is running basically that ^^^) does not cause it to fail.</p>\n\n<p>edit 2: If I specify \"tcp4\", then the program does indeed fail as I expect. If I specify \"tcp6\", it succeeds but netstat says it binds to <code>*</code> instead of <code>::1</code>:</p>\n\n<pre><code>$ netstat -an | grep 8888\ntcp6       0      0  *.8888                 *.*                    LISTEN\ntcp6       0      0  ::1.8888               *.*                    LISTEN\ntcp4       0      0  *.8888                 *.*                    LISTEN\n</code></pre>\n\n<p>So, specifying \"tcp4\" will solve my actual problem, but I really want to understand what the heck is going on with the \"tcp46\" connection type, and I can't find any documentation. Help!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530126797, "post_id": 51069813, "comment_id": 89129705, "body": "The <code>json</code> package can decode into an <code>interface{}</code>. What problem are you encountering?"}], "answers": [{"tags": [], "owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "is_accepted": true, "score": 1, "last_activity_date": 1530127726, "creation_date": 1530127726, "answer_id": 51070123, "question_id": 51069813, "link": "https://stackoverflow.com/questions/51069813/unmarshaling-json-into-struct-while-supporting-different-types-for-value-of-an-a/51070123#51070123", "title": "Unmarshaling JSON into struct while supporting different types for value of an attribute", "body": "<p>You should decode to an empty interface (<code>interface{}</code>). Because it has no methods, every type implements it.</p>\n\n<pre><code>type Data struct {\n    Config interface{}\n}\n</code></pre>\n\n<p>I have created <a href=\"https://play.golang.org/p/ReMgI4PpwZ0\" rel=\"nofollow noreferrer\">an elaborate Playground</a> demonstrating this.</p>\n"}], "owner": {"reputation": 2300, "user_id": 811922, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2adbe7f77f554b38362fd8969e22d5a9?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/811922/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 51070123, "answer_count": 1, "score": -1, "last_activity_date": 1530127726, "creation_date": 1530126331, "question_id": 51069813, "link": "https://stackoverflow.com/questions/51069813/unmarshaling-json-into-struct-while-supporting-different-types-for-value-of-an-a", "title": "Unmarshaling JSON into struct while supporting different types for value of an attribute", "body": "<p>Is there any possibility in Golang to unmarshal a JSON object into a struct in which the JSON object has an attribute that can be either object or array (or generally supports various types) in different cases?</p>\n\n<p>for example in one case JSON may look like this:</p>\n\n<pre><code>{\n    \"config\": {\n        \"source\": \"config.cnf\"\n    }\n}\n</code></pre>\n\n<p>but in the same time, the JSON may be like this as well:</p>\n\n<pre><code>{\n    \"config\": [ \"value1\", \"value2\" ]\n}\n</code></pre>\n\n<p>if so, how would the struct look like?</p>\n"}, {"tags": ["go", "type-assertion"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1530126174, "post_id": 51069683, "comment_id": 89129417, "body": "For starters, you can&#39;t use a <code>sync.Map</code> value, since it cannot be copied. This code will fail <code>go vet</code>"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530192803, "post_id": 51069683, "comment_id": 89156890, "body": "but I can use it&#39;s pointer because sync.Map it&#39;s a struct"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530193105, "post_id": 51069683, "comment_id": 89157125, "body": "yes, that&#39;s the point. <code>sync.Map</code> is a struct containing data structures that can&#39;t be safely copied."}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1530136121, "post_id": 51070664, "comment_id": 89133534, "body": "are you sure? I thought with maps you couldn&#39;t do that <a href=\"https://www.youtube.com/watch?v=Tl7mi9QmLns\" rel=\"nofollow noreferrer\">youtube.com/watch?v=Tl7mi9QmLns</a> minute 21:31 explains why, or sync.Map behave different?, that&#39;s why I didn&#39;t pass a pointer in first place"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1530139366, "post_id": 51070664, "comment_id": 89134497, "body": "@JohnBalvinArias: &quot;Can I take the address of a value slot someplace in the bucket in my [plain Go] <code>map</code>. In Go, you can&#39;t do that.&quot; Keith Randall. That&#39;s true for Go <code>sync.Map</code>s too, They are built on top of a plain Go map protected by a mutex. That&#39;s interesting, but it is not relevant to your problem. Why do you think it is?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1530139668, "post_id": 51070664, "comment_id": 89134563, "body": "@JohnBalvinArias: You pass the address of a mapb struct as a value, which is treated like a uintptr integer and stored in an internal memory bucket. You can&#39;t ask for the memory address of the uintptr value storage location. You can pass in the key and the map will find it for you and return the uintptr value as an address to you."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1530140003, "post_id": 51070664, "comment_id": 89134633, "body": "You should use the race detector to test your program. <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">The Go Blog: Introducing the Go Race Detector</a> and <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Data Race Detector</a>."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1530140274, "post_id": 51070664, "comment_id": 89134708, "body": "You right! I forgot the fact that sync.Map is actually a struct, not an actually map, thanks!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1530144064, "last_edit_date": 1530144064, "creation_date": 1530130190, "answer_id": 51070664, "question_id": 51069683, "link": "https://stackoverflow.com/questions/51069683/is-the-adress-value-return-by-map-loadorstore-the-same-as-the-input-in-case-of-n/51070664#51070664", "title": "is the adress value return by map.LoadOrStore the same as the input in case of nested maps?", "body": "<p>As I explain later, you should use pointers for the <code>sync.Map</code> types. Therefore, we can simplify to:</p>\n\n<pre><code>var mapa, mapb = new(sync.Map), new(sync.Map)\nvar key string\n\nif actual, loaded := mapa.LoadOrStore(key, mapb); loaded {\n    if maps, ok := actual.(*sync.Map); ok {\n        mapb = maps\n    } else {\n        // handle loaded value type assertion error\n    }\n}\n</code></pre>\n\n<p>Now the assignments are cheap because we are assigning pointers (<code>*sync.Map</code>)  not structs (<code>sync.Map</code>).</p>\n\n<hr>\n\n<blockquote>\n  <p>Package sync</p>\n\n<pre><code>import \"sync\" \n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">type Map</a></p>\n  \n  <p>Map is like a Go map[interface{}]interface{} but is safe for\n  concurrent use by multiple goroutines without additional locking or\n  coordination. Loads, stores, and deletes run in amortized constant\n  time.</p>\n  \n  <p>The Map type is specialized. Most code should use a plain Go map\n  instead, with separate locking or coordination, for better type safety\n  and to make it easier to maintain other invariants along with the map\n  content.</p>\n  \n  <p>The Map type is optimized for two common use cases: (1) when the entry\n  for a given key is only ever written once but read many times, as in\n  caches that only grow, or (2) when multiple goroutines read, write,\n  and overwrite entries for disjoint sets of keys. In these two cases,\n  use of a Map may significantly reduce lock contention compared to a Go\n  map paired with a separate Mutex or RWMutex.</p>\n  \n  <p>The zero Map is empty and ready for use. A Map must not be copied\n  after first use.</p>\n\n<pre><code>type Map struct {\n        // contains filtered or unexported fields\n}\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#Map.LoadOrStore\" rel=\"nofollow noreferrer\">func (*Map) LoadOrStore</a></p>\n\n<pre><code>func (m *Map) LoadOrStore(key, value interface{}) (actual interface{}, loaded bool)\n</code></pre>\n  \n  <p>LoadOrStore returns the existing value for the key if present.\n  Otherwise, it stores and returns the given value. The loaded result is\n  true if the value was loaded, false if stored.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>A <code>sync.Map</code> must not be copied after first use.</p>\n</blockquote>\n\n<p>In Go, all arguments and receivers are passed by value, as if by assignment (a copy). For example, <code>go vet</code> reports a <code>sync.Map</code> copy error,</p>\n\n<pre><code>// go vet: variable declaration copies lock value to arg: sync.Map contains sync.Mutex\nvar m sync.Map\nvar arg interface{} = m\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var map1, map2 sync.Map\n// go vet: call of map1.LoadOrStore copies lock value: sync.Map contains sync.Mutex\nmap1.LoadOrStore(\"key\", map2)\n</code></pre>\n\n<p>Use pointers. For example,</p>\n\n<pre><code>    var m sync.Map\n    var arg interface{} = &amp;m\n</code></pre>\n\n<p>and </p>\n\n<pre><code>    var map1, map2 sync.Map\n    map1.LoadOrStore(\"key\", &amp;map2)\n</code></pre>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 2, "accepted_answer_id": 51070664, "answer_count": 1, "score": 1, "last_activity_date": 1530144064, "creation_date": 1530125739, "last_edit_date": 1592644375, "question_id": 51069683, "link": "https://stackoverflow.com/questions/51069683/is-the-adress-value-return-by-map-loadorstore-the-same-as-the-input-in-case-of-n", "title": "is the adress value return by map.LoadOrStore the same as the input in case of nested maps?", "body": "<p>I'm doing a nested <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">sync.Map</a> but I wonder if I can save some few lines of code if the value returned by <code>LoadOrStore </code> is the same as the input in case of a map, I mean this:</p>\n<pre><code>var mapa sync.Map\nmapaInterFace, ok := sessiones.LoadOrStore(userID,mapa)\nif ok {\n    mapa,ok=mapaInterFace.(sync.Map)\n    if !ok{\n        return errors.New(&quot;type assertion&quot;)\n    }\n}\n</code></pre>\n<p>If <code>mapa</code> were the same as the returned by <code>LoadOrStore</code> when the value is stored, I can immediately use it, but if not I have to add after the previous code, the type assertion:</p>\n<pre><code>mapa,ok=mapaInterFace.(sync.Map)\n    if !ok{\n        return errors.New(&quot;type assertion&quot;)\n    }\n</code></pre>\n<p>and doing some often it can make some ugly code</p>\n<p>Update: <code>sessiones</code> is type sync.Map</p>\n"}, {"tags": ["database", "mongodb", "go", "nosql", "mgo"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1530125327, "post_id": 51069544, "comment_id": 89129012, "body": "Can you elaborate the <i>logical AND</i> behavior you desire? Matching all the fields, not any of them?"}, {"owner": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "reply_to_user": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 1, "creation_date": 1530125523, "post_id": 51069544, "comment_id": 89129118, "body": "I am hoping to get a result where each value in the map matches the corresponding field in the database. So I would like it to be something like bson.M{&quot;$and&quot; : all of the k,v pairs}"}, {"owner": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "reply_to_user": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1530125680, "post_id": 51069544, "comment_id": 89129192, "body": "So yes, matching all of the fields"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "edited": false, "score": 0, "creation_date": 1530128058, "post_id": 51069997, "comment_id": 89130244, "body": "I forgot to remove that line before copying! Thank you. Also we just found a bug in the code from a colleague of mine that was causing our &quot;query&quot; problem that turns out wasn&#39;t even a db issue... Gotta love human error"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "edited": false, "score": 0, "creation_date": 1530128173, "post_id": 51069997, "comment_id": 89130294, "body": "@bagreeni Please see my edit. You don&#39;t even need this <code>sel()</code> conversion: you can just use your original <code>map[string]string</code> map without conversion!"}, {"owner": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "edited": false, "score": 0, "creation_date": 1530128791, "post_id": 51069997, "comment_id": 89130549, "body": "Thank you! This is extremely helpful to know"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "edited": false, "score": 0, "creation_date": 1530130802, "post_id": 51069997, "comment_id": 89131374, "body": "@bagreeni I provided exact description (with reference) about what can be used as the query."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1530130738, "last_edit_date": 1530130738, "creation_date": 1530127174, "answer_id": 51069997, "question_id": 51069544, "link": "https://stackoverflow.com/questions/51069544/dynamically-query-mongodb-with-golang/51069997#51069997", "title": "Dynamically query mongodb with golang", "body": "<p>I don't know what this line is supposed to mean:</p>\n\n<pre><code>result[ ] = \"$in\"\n</code></pre>\n\n<p>As it is a compile-time error.</p>\n\n<p>But the elements of the query document (the conditions) are in logical AND connection by default, so this is all it takes:</p>\n\n<pre><code>func sel(query map[string]string) bson.M {\n    result := make(bson.M, len(query))\n    for k, v := range query {\n        result[k] = v\n    }\n    return result\n}\n</code></pre>\n\n<p>If this gives you all the documents in the collection, then that means all the key-value pairs match all the documents. Experiment with simple filters to see that it works.</p>\n\n<p><strong>Also note that the <a href=\"https://godoc.org/github.com/globalsign/mgo\" rel=\"nofollow noreferrer\"><code>mgo</code></a> package also accepts a wide range of maps and structs, not just <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#M\" rel=\"nofollow noreferrer\"><code>bson.M</code></a>.</strong> Documentation of <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Find\" rel=\"nofollow noreferrer\"><code>Collection.Find()</code></a> has this to say about the allowed types:</p>\n\n<blockquote>\n  <p>The document may be a map or a struct value capable of being marshalled with bson. The map may be a generic one using interface{} for its key and/or values, such as bson.M, or it may be a properly typed map. Providing nil as the document is equivalent to providing an empty document such as bson.M{}.</p>\n</blockquote>\n\n<p>So you can use your map which is of type <code>map[string]string</code> without converting it:</p>\n\n<pre><code>err = c.Find(items).Sort(\"-createdAt\").All(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 10001696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739731ad9e2ad23a9fa05e60b346479c?s=128&d=identicon&r=PG&f=1", "display_name": "bagreeni", "link": "https://stackoverflow.com/users/10001696/bagreeni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2111, "favorite_count": 0, "accepted_answer_id": 51069997, "answer_count": 1, "score": 4, "last_activity_date": 1530157026, "creation_date": 1530125130, "last_edit_date": 1530157026, "question_id": 51069544, "link": "https://stackoverflow.com/questions/51069544/dynamically-query-mongodb-with-golang", "title": "Dynamically query mongodb with golang", "body": "<p>I'm trying to query my mongodb database using golang (and the mgo library) with only one function, and the method I am currently using is:</p>\n\n<pre><code>er = c.Find(sel(items)).Sort(\"-createdAt\").All(&amp;result)\n</code></pre>\n\n<p>Where items is a map and the key is the name of the field I am searching inthe db, and the value is what I want to search by.</p>\n\n<p>and sel() is:</p>\n\n<pre><code>func sel(query map[string]string) bson.M {\nresult := make(bson.M, len(query))\nresult[ ] = \"$in\"\nfor k, v := range query {\n    result[k] = v\n}\nreturn result\n</code></pre>\n\n<p>currently it will return all of the results where at least one of the fields matches the input map. (So a logical OR) however I would like it to return the logical AND of these fields.</p>\n\n<p>Does anyone have suggestions on how to modify the existing code or a new way of efficiently querying the database?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["validation", "url", "go"], "comments": [{"owner": {"reputation": 91128, "user_id": 1229023, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/75b840909603c238921a81032efd57eb?s=128&d=identicon&r=PG", "display_name": "raina77ow", "link": "https://stackoverflow.com/users/1229023/raina77ow"}, "edited": false, "score": 3, "creation_date": 1530125253, "post_id": 51069484, "comment_id": 89128973, "body": "Why do you think that <code>https:&#47;&#47;aaaa</code> is not valid yet <code>https:&#47;&#47;google</code> is valid? What about <code>https:&#47;&#47;localhost</code>?"}, {"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "reply_to_user": {"reputation": 91128, "user_id": 1229023, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/75b840909603c238921a81032efd57eb?s=128&d=identicon&r=PG", "display_name": "raina77ow", "link": "https://stackoverflow.com/users/1229023/raina77ow"}, "edited": false, "score": 0, "creation_date": 1530125328, "post_id": 51069484, "comment_id": 89129013, "body": "<code>https:&#47;&#47;google</code> is not valid"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1530126781, "post_id": 51069484, "comment_id": 89129701, "body": "<code>https:&#47;&#47;google</code> is a valid URL. The validity of a URL has nothing to do with whether or not the domain or path actually exists (which is something that can change over time, unlike URL validity, which can only change by an update to the URL spec)."}], "answers": [{"comments": [{"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530125456, "post_id": 51069594, "comment_id": 89129069, "body": "I&#39;m trying to validate URLs that can be redirected to and therefore <code>http:&#47;&#47;aaa</code> clearly should not be valid."}, {"owner": {"reputation": 4376, "user_id": 959140, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/66Jhu.png?s=128&g=1", "display_name": "Robin Andersson", "link": "https://stackoverflow.com/users/959140/robin-andersson"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 5, "creation_date": 1530125735, "post_id": 51069594, "comment_id": 89129218, "body": "If a URL is valid and if the URL actually leads to something that works is two different things."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530127010, "post_id": 51069594, "comment_id": 89129813, "body": "And indeed requires actually testing it and changes with execution context and over time. On one machine, <code>http:&#47;&#47;localhost&#47;foo&#47;bar</code> might yield a response, and on another, it might not. Likewise, on the machine where it yields a response, it might not a minute later (if a file is removed or a service is stopped). URL/URI validity is a question of valid <i>syntax</i>, not fitness for any other purpose."}], "tags": [], "owner": {"reputation": 4376, "user_id": 959140, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/66Jhu.png?s=128&g=1", "display_name": "Robin Andersson", "link": "https://stackoverflow.com/users/959140/robin-andersson"}, "is_accepted": true, "score": 3, "last_activity_date": 1531170151, "last_edit_date": 1531170151, "creation_date": 1530125341, "answer_id": 51069594, "question_id": 51069484, "link": "https://stackoverflow.com/questions/51069484/url-validation-seems-broken/51069594#51069594", "title": "URL validation seems broken", "body": "<p>You have confused domains with URLs, the domain is only a part of the URL.</p>\n\n<p>Valid domain examples are: <code>www.google.com</code>, <code>localhost</code> and <code>a.b.c.a.google.com</code>.</p>\n\n<p>In order for a URL to be valid the scheme/protocol part (normally <code>https://</code>) must be there, see <a href=\"https://en.wikipedia.org/wiki/URL#Syntax\" rel=\"nofollow noreferrer\">syntax at Wikipedia for an easy explanation</a>.</p>\n\n<p><code>http://aaa</code> is a valid URL by the same rules as <code>http://localhost</code> is valid</p>\n"}, {"comments": [{"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530142192, "post_id": 51069900, "comment_id": 89135113, "body": "The second link returns false."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530143177, "post_id": 51069900, "comment_id": 89135304, "body": "@ninesalt Works For Me\u2122 It should tell you why it returned false."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530203171, "post_id": 51069900, "comment_id": 89163680, "body": "@ninesalt <code>net.LookupHost</code> requires making a network connection to a DNS server. I&#39;m going to assume play.golang.org doesn&#39;t allow that for security reasons. For example, <code>fmt.Println( http.Get(&quot;http:&#47;&#47;example.com&#47;&quot;) )</code> says <code>&lt;nil&gt; Get http:&#47;&#47;example.com&#47;: dial tcp: Protocol not available</code>. It&#39;ll work on a real machine with a network connection."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 5, "last_activity_date": 1530127698, "last_edit_date": 1530127698, "creation_date": 1530126647, "answer_id": 51069900, "question_id": 51069484, "link": "https://stackoverflow.com/questions/51069484/url-validation-seems-broken/51069900#51069900", "title": "URL validation seems broken", "body": "<p>Most of those are domain names. <code>https://aaaa</code> is a valid URL. <code>/google</code> is not a URL, but it is acceptable to <a href=\"https://golang.org/pkg/net/url/#ParseRequestURI\" rel=\"nofollow noreferrer\"><code>ParseRequestURI</code></a> because it also accepts absolute paths.</p>\n\n<blockquote>\n  <p>\"<em>rawurl is interpreted only as an absolute URI</em> <strong><em>or an absolute path</em></strong>\"</p>\n</blockquote>\n\n<p>When you ask <code>ParseRequestURI</code> you're asking for a strict syntax check of either an absolute URL or an absolute path. An absolute path is anything like <code>/foo/bar</code>. What is and is not an absolute URL is covered by <a href=\"https://pretty-rfc.herokuapp.com/RFC3986\" rel=\"nofollow noreferrer\">RFC 3986</a>. The basic grammar for a URI is this.</p>\n\n<pre><code>URI         = scheme \":\" hier-part [ \"?\" query ] [ \"#\" fragment ]\n\nhier-part   = \"//\" authority path-abempty\n            / path-absolute\n            / path-rootless\n            / path-empty\n</code></pre>\n\n<p>An \"absolute URL\" means the <code>path</code> part is an absolute path or empty, so <code>path-abempty</code> or <code>path-absolute</code> above. <code>http</code> and <code>https</code> URLs can only be absolute. <code>foo:bar/baz</code> is an example of a relative URL.</p>\n\n<p>And here's an example.</p>\n\n<pre><code>  foo://example.com:8042/over/there?name=ferret#nose\n  \\_/   \\______________/\\_________/ \\_________/ \\__/\n   |           |            |            |        |\nscheme     authority       path        query   fragment\n   |   _____________________|__\n  / \\ /                        \\\n  urn:example:animal:ferret:nose\n</code></pre>\n\n<p><code>google.com</code> has no <code>scheme</code>, so it is not a URL. <code>https://aaaa</code> has a scheme, <code>https</code> and a <code>hier-part</code>, <code>//aaaa</code>, so it is a URL. It doesn't have a <code>query</code> or <code>fragement</code>, but they are optional.</p>\n\n<p>Obviously this is a bit broad. In the real world you need to narrow down your requirements. Usually it's something like...</p>\n\n<ol>\n<li>Validate it is a URL, which you're not quite doing by calling <code>ParseRequestURI</code> because it can also be an absolute path.</li>\n<li>Check it has an acceptable scheme, <code>url.Scheme</code>. This will discard absolute paths.</li>\n<li>Check it has a valid domain name, <code>url.Host</code>.</li>\n</ol>\n\n<p>And any other checks you might want to do to restrict what you consider to be a valid URL.</p>\n\n<p>So your full check might look like...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/url\"\n    \"errors\"\n)\n\nfunc isValidURL(tocheck string) (bool, error) {\n    // Check it's an Absolute URL or absolute path\n    uri, err := url.ParseRequestURI(tocheck)\n    if err != nil {\n        return false, err\n    }\n\n    // Check it's an acceptable scheme\n    switch uri.Scheme {\n        case \"http\":\n        case \"https\":\n        default:\n            return false, errors.New(\"Invalid scheme\")\n    }\n\n    // Check it's a valid domain name\n    _,err = net.LookupHost(uri.Host)\n    if err != nil {\n        return false, err\n    }\n\n    return true, nil\n}\n\nfunc main() {\n    // False, no scheme\n    fmt.Println(isValidURL(\"/google\"))\n    // True, good scheme, good domain\n    fmt.Println(isValidURL(\"https://google.com\"))\n    // False, bad domain\n    fmt.Println(isValidURL(\"http://halghalghlakdjfl.blarg\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "accepted_answer_id": 51069594, "answer_count": 2, "score": -2, "last_activity_date": 1531170151, "creation_date": 1530124916, "question_id": 51069484, "link": "https://stackoverflow.com/questions/51069484/url-validation-seems-broken", "title": "URL validation seems broken", "body": "<p>I'm trying to validate a URL using Go's standard library. This is what my code currently looks like.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc isValidURL(tocheck string) bool {\n    _, err := url.ParseRequestURI(tocheck)\n    return err == nil\n}\n\nfunc main() {\n    fmt.Println(isValidURL(\"google.com\"))      //returns false, expected true\n    fmt.Println(isValidURL(\"www.google.com\"))  //returns false, expected true\n    fmt.Println(isValidURL(\"google\"))          //returns false, expected false\n    fmt.Println(isValidURL(\"/google\"))         //returns true, expected false\n}\n</code></pre>\n\n<p>All three examples print false, even though the first two should be true. I then tried appending <code>https://</code> to the beginning of URLs that don't start with them, but then everything, like <code>https://aaaa</code> is parsed as valid. What can I do to make sure it only returns true when the URL is actually valid?</p>\n"}, {"tags": ["http", "go", "server"], "answers": [{"comments": [{"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530120164, "post_id": 51068332, "comment_id": 89126491, "body": "Hmm.. this seems a bit hard-coded I think. Is there any way to serve all CSS files in a generic way similar to this? or serve all files in <code>web</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530120285, "post_id": 51068332, "comment_id": 89126553, "body": "There are a lot of ways you could do it. The question said you wanted to serve &quot;a css file&quot;, but the basic technique of &quot;look at the URL and determine what to serve&quot; that you&#39;re already using for index.html offers plenty of flexibility to do absolutely anything."}, {"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530120551, "post_id": 51068332, "comment_id": 89126696, "body": "What do you mean &quot;nothing&quot;? What would you recommend to make this more general?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530123167, "post_id": 51068332, "comment_id": 89127971, "body": "I&#39;m not sure I follow, I never said &quot;nothing&quot;. To make this more general, you&#39;ll have to figure out what you need and implement it. You can&#39;t have two handlers that both handle every URL; you&#39;ll need to write some logic to decide which handler serves what."}, {"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530123947, "post_id": 51068332, "comment_id": 89128323, "body": "Sorry I mean &quot;anything&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1530125493, "post_id": 51068332, "comment_id": 89129095, "body": "By anything I just mean there are a lot of options - you&#39;re writing your own custom router at this point, which I&#39;m a big proponent of. But as I commented above, your situation is not simple enough for a one-size-fits-all generic approach."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1530120177, "last_edit_date": 1530120177, "creation_date": 1530120118, "answer_id": 51068332, "question_id": 51068298, "link": "https://stackoverflow.com/questions/51068298/how-can-i-serve-a-css-file-and-have-dynamic-routing/51068332#51068332", "title": "How can I serve a CSS file and have dynamic routing?", "body": "<p>Your original solution was nearly there, all you have to do is add a branch:</p>\n\n<pre><code>if r.URL.Path == \"/\" {\n    http.ServeFile(w, r, \"./web/index.html\")\n} else if r.URL.Path == \"/styles.css\" {\n    http.ServeFile(w, r, \"./web/styles.css\")\n} else {\n    // ...\n</code></pre>\n\n<p>Of course this can be tailored as needed - you could check for any file ending in \".css\" using <code>strings.HasSuffix</code>, for example.</p>\n"}], "owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 51068332, "answer_count": 1, "score": 1, "last_activity_date": 1530120177, "creation_date": 1530119959, "question_id": 51068298, "link": "https://stackoverflow.com/questions/51068298/how-can-i-serve-a-css-file-and-have-dynamic-routing", "title": "How can I serve a CSS file and have dynamic routing?", "body": "<p>I'm trying to set up an HTTP server in Go using only the standard library. The server should be able to accept requests of the form <code>/:uuid</code> and should be able to serve an <code>index.html</code> file as well as a css file imported in it. This is what my code looked like:</p>\n\n<pre><code> func indexHandler(w http.ResponseWriter, r *http.Request) {\n    // serve index.html\n    if r.URL.Path == \"/\" {\n        http.ServeFile(w, r, \"./web/index.html\")\n    } else {\n        // if the path is /randomwords, redirect to mapped URL\n        randomwords := r.URL.Path[1:]\n        url := getMappedURL(randomwords)\n        http.Redirect(w, r, url, http.StatusFound)\n    }\n}\n\nfunc main() {\n  http.HandleFunc(\"/\", indexHandler)\n  log.Println(\"listening on port 5000\")\n  http.ListenAndServe(\":5000\", nil)\n}\n</code></pre>\n\n<p>This serves the html file and is able to accept requests like <code>/:something</code> but the problem is that it doesn't include the CSS file. After some googling, I changed the main function to this:</p>\n\n<pre><code>func main() {\n    fs := http.FileServer(http.Dir(\"web\"))\n    http.Handle(\"/\", fs)\n    log.Println(\"listening on port 5000\")\n    http.ListenAndServe(\":5000\", nil)\n}\n</code></pre>\n\n<p>This serves both the HTML and the CSS files but it doesn't allow routes of the form <code>:something</code>. I can't figure out how to have both of these features.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1530116835, "post_id": 51066786, "comment_id": 89124872, "body": "Variables that are declared within a function are not visible outside the function. Why not have the function return the values that you want to check in the loop?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9928003, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LrdoByu_iNw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2QukRw-eLIwbitt-wYyBnnsa1_BQ/mo/photo.jpg?sz=128", "display_name": "Alex Treichler", "link": "https://stackoverflow.com/users/9928003/alex-treichler"}, "edited": false, "score": 0, "creation_date": 1530118012, "post_id": 51067588, "comment_id": 89125459, "body": "I appreciate the help.  I tested this code and it works.  Going to dissect it more, so I can understand what is going on.  THank you."}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 0, "last_activity_date": 1530117148, "creation_date": 1530117148, "answer_id": 51067588, "question_id": 51066786, "link": "https://stackoverflow.com/questions/51066786/using-variable-from-function-in-for-loop-golang/51067588#51067588", "title": "Using variable from Function in for loop - Golang", "body": "<p>You can try returning a results from the option_quote function, here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n)\n\nvar json_stock_response Json\n\n//endless loop\nfunc main() {\n    var target_price = 1.0\n    for {\n        bid, ask := option_quote()\n\n        fmt.Println(\"Bid:\", bid, \"Ask:\", ask)\n        if bid &lt;= target_price {\n            fmt.Printf(\"Closing trade, bid is: %f\\n\", bid)\n            break\n        }\n    }\n}\n\n//This function is used to get the quotes\nfunc option_quote() (bid, ask float64) {\n\n    url := \"https://api.tradier.com/v1/markets/quotes\"\n\n    payload := strings.NewReader(\"symbols=AAPL180629C00162500\")\n\n    req, _ := http.NewRequest(\"POST\", url, payload)\n\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    req.Header.Add(\"accept\", \"application/json\")\n    req.Header.Add(\"Authorization\", \"Bearer XXX\")\n    req.Header.Add(\"Cache-Control\", \"no-cache\")\n    req.Header.Add(\"Postman-Token\", \"9d669b80-0ed2-4988-a225-56b2f018c5c6\")\n\n    res, _ := http.DefaultClient.Do(req)\n\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n\n    //parse response into Json Data\n    json.Unmarshal([]byte(body), &amp;json_stock_response)\n\n    var c_bid float64 = json_stock_response.Quotes.Quote.Bid\n    var c_ask float64 = json_stock_response.Quotes.Quote.Ask\n\n    return c_bid, c_ask\n}\n\n//Structure of the Json Response back from Traider when getting an option             quote\n\ntype Json struct {\n    Quotes struct {\n        Quote struct {\n            Symbol           string      `json:\"symbol\"`\n            Description      string      `json:\"description\"`\n            Exch             string      `json:\"exch\"`\n            Type             string      `json:\"type\"`\n            Last             float64     `json:\"last\"`\n            Change           float64     `json:\"change\"`\n            ChangePercentage float64     `json:\"change_percentage\"`\n            Volume           int         `json:\"volume\"`\n            AverageVolume    int         `json:\"average_volume\"`\n            LastVolume       int         `json:\"last_volume\"`\n            TradeDate        int64       `json:\"trade_date\"`\n            Open             interface{} `json:\"open\"`\n            High             interface{} `json:\"high\"`\n            Low              interface{} `json:\"low\"`\n            Close            interface{} `json:\"close\"`\n            Prevclose        float64     `json:\"prevclose\"`\n            Week52High       float64     `json:\"week_52_high\"`\n            Week52Low        float64     `json:\"week_52_low\"`\n            Bid              float64     `json:\"bid\"`\n            Bidsize          int         `json:\"bidsize\"`\n            Bidexch          string      `json:\"bidexch\"`\n            BidDate          int64       `json:\"bid_date\"`\n            Ask              float64     `json:\"ask\"`\n            Asksize          int         `json:\"asksize\"`\n            Askexch          string      `json:\"askexch\"`\n            AskDate          int64       `json:\"ask_date\"`\n            OpenInterest     int         `json:\"open_interest\"`\n            Underlying       string      `json:\"underlying\"`\n            Strike           float64     `json:\"strike\"`\n            ContractSize     int         `json:\"contract_size\"`\n            ExpirationDate   string      `json:\"expiration_date\"`\n            ExpirationType   string      `json:\"expiration_type\"`\n            OptionType       string      `json:\"option_type\"`\n            RootSymbol       string      `json:\"root_symbol\"`\n        } `json:\"quote\"`\n    } `json:\"quotes\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9928003, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LrdoByu_iNw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2QukRw-eLIwbitt-wYyBnnsa1_BQ/mo/photo.jpg?sz=128", "display_name": "Alex Treichler", "link": "https://stackoverflow.com/users/9928003/alex-treichler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1530147457, "creation_date": 1530114207, "last_edit_date": 1530147457, "question_id": 51066786, "link": "https://stackoverflow.com/questions/51066786/using-variable-from-function-in-for-loop-golang", "title": "Using variable from Function in for loop - Golang", "body": "<p>I am still learning to code in Golang and this might be an easy question, but I have searched online and the Go site and have not been the ability to resolve it.  I have the following code below.  When running, it essentially will run the <code>option_quote</code> function, which will print out the <code>\"Ask\"</code> and <code>\"Bid\"</code> of the option.  Right now <code>for</code> is just an endless loop.  </p>\n\n<p>However, I want to perform a new action if certain criteria are met based on the <code>c_bid</code> variable that is within the <code>option_quote</code> Function.</p>\n\n<p>My goal is this:</p>\n\n<p>The program will continue to loop through the <code>option_quote</code> function in order to obtain the current price of the option.  If the Current price of the option is greater than or equal to a specific value, then perform a different action.</p>\n\n<p>Something like</p>\n\n<pre><code>for c_bid &gt; target_price {\n    continue getting looping through quotes\n}\nif target_price &gt;= c_bid {\n    close_trade\n}\n</code></pre>\n\n<p>The code I currently have:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n)\n\nvar json_stock_response Json\n\n//endless loop\nfunc main() {\n    for {\n        option_quote()\n    }\n}\n\n//This function is used to get the quotes\nfunc option_quote() {\n\n    url := \"https://api.tradier.com/v1/markets/quotes\"\n\n    payload := strings.NewReader(\"symbols=AAPL180629C00162500\")\n\n    req, _ := http.NewRequest(\"POST\", url, payload)\n\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    req.Header.Add(\"accept\", \"application/json\")\n    req.Header.Add(\"Authorization\", \"Bearer XXX\")\n    req.Header.Add(\"Cache-Control\", \"no-cache\")\n    req.Header.Add(\"Postman-Token\", \"9d669b80-0ed2-4988-a225-56b2f018c5c6\")\n\n    res, _ := http.DefaultClient.Do(req)\n\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n\n    //parse response into Json Data\n    json.Unmarshal([]byte(body), &amp;json_stock_response)\n\n    //fmt.Println(res)\n    // This will print out only the \"Ask\" value\n    var option_symbol string = json_stock_response.Quotes.Quote.Symbol\n    var c_bid float64 = json_stock_response.Quotes.Quote.Bid\n    var c_ask float64 = json_stock_response.Quotes.Quote.Ask\n\n    fmt.Println(\"Option:\", option_symbol, \"Bid:\", c_bid, \"Ask:\", c_ask)\n}\n\n//Structure of the Json Response back from Traider when getting an option             quote\n\ntype Json struct {\n    Quotes struct {\n        Quote struct {\n            Symbol           string      `json:\"symbol\"`\n            Description      string      `json:\"description\"`\n            Exch             string      `json:\"exch\"`\n            Type             string      `json:\"type\"`\n            Last             float64     `json:\"last\"`\n            Change           float64     `json:\"change\"`\n            ChangePercentage float64     `json:\"change_percentage\"`\n            Volume           int         `json:\"volume\"`\n            AverageVolume    int         `json:\"average_volume\"`\n            LastVolume       int         `json:\"last_volume\"`\n            TradeDate        int64       `json:\"trade_date\"`\n            Open             interface{} `json:\"open\"`\n            High             interface{} `json:\"high\"`\n            Low              interface{} `json:\"low\"`\n            Close            interface{} `json:\"close\"`\n            Prevclose        float64     `json:\"prevclose\"`\n            Week52High       float64     `json:\"week_52_high\"`\n            Week52Low        float64     `json:\"week_52_low\"`\n            Bid              float64     `json:\"bid\"`\n            Bidsize          int         `json:\"bidsize\"`\n            Bidexch          string      `json:\"bidexch\"`\n            BidDate          int64       `json:\"bid_date\"`\n            Ask              float64     `json:\"ask\"`\n            Asksize          int         `json:\"asksize\"`\n            Askexch          string      `json:\"askexch\"`\n            AskDate          int64       `json:\"ask_date\"`\n            OpenInterest     int         `json:\"open_interest\"`\n            Underlying       string      `json:\"underlying\"`\n            Strike           float64     `json:\"strike\"`\n            ContractSize     int         `json:\"contract_size\"`\n            ExpirationDate   string      `json:\"expiration_date\"`\n            ExpirationType   string      `json:\"expiration_type\"`\n            OptionType       string      `json:\"option_type\"`\n            RootSymbol       string      `json:\"root_symbol\"`\n        } `json:\"quote\"`\n    } `json:\"quotes\"`\n}\n</code></pre>\n"}, {"tags": ["go", "desktop", "linux-mint"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1530112253, "post_id": 51066148, "comment_id": 89122263, "body": "A traditional Go binary is not really a &quot;desktop application&quot;, it&#39;s a command-line application. Try running it in a terminal, or creating an application definition for your OS that will run your binary in a persistent terminal."}, {"owner": {"reputation": 11, "user_id": 1759818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d09f97d72def19eec8f7517292ab7f?s=128&d=identicon&r=PG", "display_name": "user1759818", "link": "https://stackoverflow.com/users/1759818/user1759818"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530121008, "post_id": 51066148, "comment_id": 89126918, "body": "OK I understand that - in Windows I would have run it in Dos or Powershell &quot;box&quot; and then I would have known when it ended I would hit return and the box would close - none of this would have required any extra code. So I need to set up a &quot;desktop&quot; item that points to a Terminal a runs the binary in that. Better start to readmy linux 101. Thanks."}], "owner": {"reputation": 11, "user_id": 1759818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d09f97d72def19eec8f7517292ab7f?s=128&d=identicon&r=PG", "display_name": "user1759818", "link": "https://stackoverflow.com/users/1759818/user1759818"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1530112056, "creation_date": 1530112056, "question_id": 51066148, "link": "https://stackoverflow.com/questions/51066148/linux-go-program-how-to-acknowledge-it-has-run", "title": "linux go program how to acknowledge it has run", "body": "<p>Apologies in advance but I am a recent \"convert\" from Windows to Linux. Have a Go binary which looks at my NAS and emails me a report on the content. It is invoked by double clicking a desktop icon. However there is no acknowledgement that it has run, only receipt of the emails some 30 seconds later. Is there a simple way in Linux desktop to show it has actually run? Again, apologies for my ignorance.</p>\n"}, {"tags": ["unit-testing", "go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530110216, "post_id": 51065482, "comment_id": 89120915, "body": "A small sleep is generally sufficient and shouldn&#39;t have a significant impact on test execution times. There&#39;s also <a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow noreferrer\"><code>runtime.Gosched()</code></a> which yields to another goroutine without any sleep delay at all."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530110548, "post_id": 51065482, "comment_id": 89121143, "body": "IMO using a sleep for synchronization in tests is a code smell that will often fail in the future. Create some sort of synchronized side effect that you can observe in the tests."}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530111938, "post_id": 51065482, "comment_id": 89122054, "body": "@JimB my code (my business logic) doesn&#39;t require any synchronized side effect. I much prefer not to add them merely due to some testing problem."}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530112013, "post_id": 51065482, "comment_id": 89122098, "body": "@Adrian that&#39;s a nice idea, but <code>Gosched</code> won&#39;t allow me to select which goroutine is selected, am I right? We&#39;re running our tests in parallel, and I fear that creates problems"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530112068, "post_id": 51065482, "comment_id": 89122135, "body": "Neither does sleep. No matter what you use, you cannot control the behavior of the scheduler."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530112193, "post_id": 51065482, "comment_id": 89122225, "body": "@sazary: if there are no observable side effects, then the code is not reliably testable. If you want to write testable code, there are some concessions you have to make. Having a small test hook to ensure something happened is not asking much, and is a common pattern."}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530171688, "post_id": 51065482, "comment_id": 89143382, "body": "@JimB I don&#39;t think adding a side effect is best solution. Usually we change the target method with a &quot;spy&quot; or mock, and part of it&#39;s job is to tell us how many times it has been called and with which arguments it has been called."}], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 0, "creation_date": 1530111869, "post_id": 51065770, "comment_id": 89122008, "body": "thank you for your comment, but as far as I can see, it&#39;s not different that much from 1st solution that I have written, and it has they same draw backs, doesn&#39;t it?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 1, "creation_date": 1530112448, "post_id": 51065770, "comment_id": 89122394, "body": "it&#39;s similar in the sense that you are using synchronisation techniques. Maybe something is unclear in my answer, but the method described above encapsulates all the synchronisation inside the mock, and you do not pollute the production code."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "edited": false, "score": 0, "creation_date": 1530163422, "post_id": 51065770, "comment_id": 89139532, "body": "this solution has few problems: 1) test will hang forever if goroutine is not called, 2) test will panic if the goroutine has been called more than once"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "edited": false, "score": 0, "creation_date": 1530163890, "post_id": 51065770, "comment_id": 89139690, "body": "3) m.CallCount += 1 is not safe because there can be a race if exec method is called in multiple goroutines"}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 0, "creation_date": 1530172103, "post_id": 51065770, "comment_id": 89143624, "body": "@Zak you&#39;re right, this is better than my 1st solution"}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "reply_to_user": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "edited": false, "score": 0, "creation_date": 1530172144, "post_id": 51065770, "comment_id": 89143653, "body": "@Maxim your points are valid, and I think Zak has removed them for brevity"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 0, "creation_date": 1530194695, "post_id": 51065770, "comment_id": 89158253, "body": "@sazary I don&#39;t think Zak has removed anything because there&#39;s simply no solution for 1 and 2 with sync.WaitGroup."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 14, "last_activity_date": 1530110879, "creation_date": 1530110879, "answer_id": 51065770, "question_id": 51065482, "link": "https://stackoverflow.com/questions/51065482/how-to-test-if-a-goroutine-has-been-called-while-unit-testing-in-golang/51065770#51065770", "title": "How to test if a goroutine has been called while unit testing in Golang?", "body": "<p>Use a <code>sync.WaitGroup</code> inside the mock</p>\n\n<p>You can extend <code>mockInterface</code> to allow it to wait for the other goroutine to finish</p>\n\n<pre><code>type mockInterface struct{\n    wg sync.WaitGroup // create a wait group, this will allow you to block later\n    CallCount int\n}\n\nfunc (m *mockInterface) exec() {\n    m.wg.Done() // record the fact that you've got a call to exec\n    m.CallCount += 1\n}\n\nfunc (m *mockInterface) currentCount() int {\n    m.wg.Wait() // wait for all the call to happen. This will block until wg.Done() is called.\n    return m.CallCount\n}\n</code></pre>\n\n<p>In the tests you can do:</p>\n\n<pre><code>mock := &amp;mockInterface{}\nmock.wg.Add(1) // set up the fact that you want it to block until Done is called once.\n\nmethod(mock)\n\nif mock.currentCount() != 1 {  // this line with block\n    // trimmed\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": -1, "last_activity_date": 1530117979, "creation_date": 1530117979, "answer_id": 51067810, "question_id": 51065482, "link": "https://stackoverflow.com/questions/51065482/how-to-test-if-a-goroutine-has-been-called-while-unit-testing-in-golang/51067810#51067810", "title": "How to test if a goroutine has been called while unit testing in Golang?", "body": "<p>first of all I would use a mock generator, i.e. github.com/gojuno/minimock\ninstead of writing mocks yourself:</p>\n\n<p>minimock -f example.go -i MyInterface -o my_interface_mock_test.go</p>\n\n<p>then your test can look like this (btw the test stub is also generated with github.com/hexdigest/gounit)</p>\n\n<pre><code>func Test_method(t *testing.T) {\n    type args struct {\n        intr MyInterface\n    }\n    tests := []struct {\n        name string\n        args func(t minimock.Tester) args\n    }{\n        {\n            name: \"check if exec is called\",\n            args: func(t minimock.Tester) args {\n                return args{\n                    intr: NewMyInterfaceMock(t).execMock.Return(),\n                }\n            },\n        },\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            mc := minimock.NewController(t)\n            defer mc.Wait(time.Second)\n\n            tArgs := tt.args(mc)\n\n            method(tArgs.intr)\n        })\n    }\n}\n</code></pre>\n\n<p>In this test</p>\n\n<pre><code>defer mc.Wait(time.Second)\n</code></pre>\n\n<p>Waits for all mocked methods to be called.</p>\n"}, {"comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530175714, "post_id": 51075426, "comment_id": 89145642, "body": "adding timeouts will not enforce the goroutines to be scheduled, and therefore the calls to <code>exce()</code> to happen. It only <i>increases the chances</i> of it happening. Timeouts are always the wrong solution, because optimising the timeout for different platforms, CPUs, execution times etc is impossible"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530187249, "post_id": 51075426, "comment_id": 89153151, "body": "In this case timeout doesn&#39;t matter because here we have reads from the channels  which enforce goroutines to be scheduled."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530190597, "post_id": 51075426, "comment_id": 89155289, "body": "Sure, but nothing forces the call to <code>exec</code> to happen in less than one second. You just hope that I <i>probably</i> will happen. Logically there&#39;s no way to assume that it will."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530191559, "post_id": 51075426, "comment_id": 89155947, "body": "Yes, and you hope the test will succeed in your example above. Logically there&#39;s no way to assume that wg.Wait will return, right? Reasonable timeout here is just a protection from the test that can hang forever. In my case it will hang for a second, fail and go test will continue to execute remaining tests."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530192171, "post_id": 51075426, "comment_id": 89156401, "body": "In the answer I gave, and the scenario described by you here; In my case, it&#39;s a programming error. But the behaviour is well defined and deterministic. In your case it&#39;s a scheduler that&#39;s to blame and the behaviour is undefined and non-deterministic. Take your pick!"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 1, "creation_date": 1530194397, "post_id": 51075426, "comment_id": 89158057, "body": "Practically that what will happen with you answer: you will stuck waiting for the failed test forever. Yes it&#39;s a programming error but you&#39;ll have to find it yourself because there won&#39;t be clear output from go test. In my case there is practical 1 second deadline that will work only for FAILED test, after test hit this deadline there will be clear output from go test command. In practice I have never experienced any problems with such approach because 1 second is more than enough. But yes, theoretically it&#39;s not deterministic. So keep theoretisizing."}, {"owner": {"reputation": 3097, "user_id": 3070062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20c7574a287e2a9be02000157f65532?s=128&d=identicon&r=PG&f=1", "display_name": "Falco", "link": "https://stackoverflow.com/users/3070062/falco"}, "edited": false, "score": 0, "creation_date": 1584110706, "post_id": 51075426, "comment_id": 107344311, "body": "If we are testing code which will actually be used in a real live scenario, every method will implicitly have some kind of deadline, after which every human tester would consider the method failed. If I write unit tests for e.g. a webserver and the whole API-call will have a timeout of 3 seconds, it is probably safe to fail the test of a single subroutine if it is not executed in 1s on the testing machine. I want this test to fails we will have to change the underlying code to fullfil our business requirements."}, {"owner": {"reputation": 3097, "user_id": 3070062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20c7574a287e2a9be02000157f65532?s=128&d=identicon&r=PG&f=1", "display_name": "Falco", "link": "https://stackoverflow.com/users/3070062/falco"}, "edited": false, "score": 0, "creation_date": 1584110864, "post_id": 51075426, "comment_id": 107344392, "body": "And if the go-runtime in use can not provide the functionality to schedule a simple routine on the well defined testing-machine with enough resources in under 1s 99.999% of the time, it is not suited for most real life requirements (even if the specs would theoretically still call this runtime compliant)"}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 4, "last_activity_date": 1530164568, "creation_date": 1530164568, "answer_id": 51075426, "question_id": 51065482, "link": "https://stackoverflow.com/questions/51065482/how-to-test-if-a-goroutine-has-been-called-while-unit-testing-in-golang/51075426#51075426", "title": "How to test if a goroutine has been called while unit testing in Golang?", "body": "<p>This test won't hang forever as with sync.WaitGroup solution proposed above. It will hang for a second (in this particular example) in case when there is no call to mock.exec:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n    \"time\"\n)\n\ntype mockInterface struct {\n    closeCh chan struct{}\n}\n\nfunc (m *mockInterface) exec() {\n    close(closeCh)\n}\n\nfunc TestMethod(t *testing.T) {\n    mock := mockInterface{\n        closeCh: make(chan struct{}),\n    }\n\n    method(mock)\n\n    select {\n    case &lt;-closeCh:\n    case &lt;-time.After(time.Second):\n        t.Fatalf(\"expected call to mock.exec method\")\n    }\n}\n</code></pre>\n\n<p>This is basically what mc.Wait(time.Second) in my answer above.</p>\n"}], "owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13306, "favorite_count": 1, "accepted_answer_id": 51065770, "answer_count": 3, "score": 11, "last_activity_date": 1530164568, "creation_date": 1530109993, "question_id": 51065482, "link": "https://stackoverflow.com/questions/51065482/how-to-test-if-a-goroutine-has-been-called-while-unit-testing-in-golang", "title": "How to test if a goroutine has been called while unit testing in Golang?", "body": "<p>suppose that we have a method like this:</p>\n\n<pre><code>func method(intr MyInterface) {\n    go intr.exec()\n} \n</code></pre>\n\n<p>In unit testing <code>method</code>, we want to assert that <code>inter.exec</code> has been called once and only once; so we can mock it with another mock struct in tests, which will give us functionality to check if it has been called or not:  </p>\n\n<pre><code>type mockInterface struct{\n    CallCount int\n}\n\nfunc (m *mockInterface) exec() {\n    m.CallCount += 1\n}\n</code></pre>\n\n<p>And in unit tests:</p>\n\n<pre><code>func TestMethod(t *testing.T) {\n    var mock mockInterface{}\n    method(mock)\n    if mock.CallCount != 1 {\n        t.Errorf(\"Expected exec to be called only once but it ran %d times\", mock.CallCount)\n    }\n}\n</code></pre>\n\n<p>Now, the problem is that since <code>intr.exec</code> is being called with <code>go</code> keyword, we can't be sure that when we reach our assertion in tests, it has been called or not.  </p>\n\n<h2>Possible Solution 1:</h2>\n\n<p>Adding a channel to arguments of <code>intr.exec</code> may solve this: we could wait on receiving any object from it in tests, and after receiving an object from it then we could continue to assert it being called. This channel will be completely unused in production (non-test) codes. \nThis will work but it adds unnecessary complexity to non-test codes, and may make large codebases incomprehensible. </p>\n\n<h2>Possible Solution 2:</h2>\n\n<p>Adding a relatively small sleep to tests before assertion may give us some assurance that the goroutine will be called before sleep is finished:</p>\n\n<pre><code>func TestMethod(t *testing.T) {\n    var mock mockInterface{}\n    method(mock)\n\n    time.sleep(100 * time.Millisecond)\n\n    if mock.CallCount != 1 {\n        t.Errorf(\"Expected exec to be called only once but it ran %d times\", mock.CallCount)\n    }\n}\n</code></pre>\n\n<p>This will leave non-test codes as they are now.<br>\nThe problem is that it will make tests slower, and will make them flaky, since they may break in some random circumstances. </p>\n\n<h2>Possible Solution 3:</h2>\n\n<p>Creating a utility function like this:</p>\n\n<pre><code>var Go = func(function func()) {\n    go function()\n} \n</code></pre>\n\n<p>And rewrite <code>method</code> like this:</p>\n\n<pre><code>func method(intr MyInterface) {\n    Go(intr.exec())\n} \n</code></pre>\n\n<p>In tests, we could change <code>Go</code> to this:</p>\n\n<pre><code>var Go = func(function func()) {\n    function()\n} \n</code></pre>\n\n<p>So, when we're running tests, <code>intr.exec</code> will be called synchronously, and we can be sure that our mock method is called before assertion.<br>\nThe only problem of this solution is that it's overriding a fundamental structure of golang, which is not right thing to do.   </p>\n\n<hr>\n\n<p>These are solutions that I could find, but non are satisfactory as far as I can see. What is best solution?</p>\n"}, {"tags": ["go", "import-csv"], "comments": [{"owner": {"reputation": 1909, "user_id": 2225619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/286a6578091bb7b170a254eb8b5c100d?s=128&d=identicon&r=PG", "display_name": "Capricorn", "link": "https://stackoverflow.com/users/2225619/capricorn"}, "edited": false, "score": 0, "creation_date": 1530098298, "post_id": 51061377, "comment_id": 89112707, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26126235/panic-runtime-error-index-out-of-range-in-go\">panic: runtime error: index out of range in Go</a>"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "reply_to_user": {"reputation": 1909, "user_id": 2225619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/286a6578091bb7b170a254eb8b5c100d?s=128&d=identicon&r=PG", "display_name": "Capricorn", "link": "https://stackoverflow.com/users/2225619/capricorn"}, "edited": false, "score": 0, "creation_date": 1530099064, "post_id": 51061377, "comment_id": 89113130, "body": "@Capricorn I don&#39;t get how I will write it in my code can you please explain it"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530099427, "post_id": 51061377, "comment_id": 89113354, "body": "Try to print number of records before inserting to mongo, and then provide the index of <code>record</code> slice. As I can see there can be only one mistake in your code and that is you are providing an index to <code>record</code> slice which does not exists."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1530099616, "post_id": 51061377, "comment_id": 89113449, "body": "<code>record</code> doesn&#39;t have 8 elements in it, it&#39;s length will match the number of columns in the csv row. So indexing outside of the <code>record</code>&#39;s range results in a runtime error. A quick fix would be to do <code>row := make([]string, 8); copy(row, record)</code> and then use <code>row</code> to construct <code>Mongo</code>."}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530099947, "post_id": 51061377, "comment_id": 89113644, "body": "@Himanshu can you tell me where the error is"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530100148, "post_id": 51061377, "comment_id": 89113769, "body": "@Himanshu as you say i will print the records see in discussion"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530100252, "post_id": 51061377, "comment_id": 89113828, "body": "<code>[Michaelhycle Michaelhycle yrf45@mail4you.racing asd]</code> //records <code>&lt;nil&gt;</code> //err <code>panic: runtime error: index out of range</code>  <code>goroutine 1 [running]:</code> <code>main.main()</code> \t<code>&#47;home&#47;iron&#47;go&#47;src&#47;go-training&#47;How_to_load_csv_file&#47;main.go:&zwnj;&#8203;55 +0x90d</code>"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1530100327, "post_id": 51061377, "comment_id": 89113869, "body": "@mkopriva can you provide me a example of it?"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530100665, "post_id": 51062097, "comment_id": 89114109, "body": "it is alright for now but if the user want to add new field in it then it will take <code>7</code> more then for this how will we do."}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530101204, "post_id": 51062097, "comment_id": 89114488, "body": "if user will create a new field in csv file then we have to change this <code>padding := make([]string, 8) </code> to <code>9</code>. I&#39;m right?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530101216, "post_id": 51062097, "comment_id": 89114499, "body": "@ansh: The length of the padding allocation should be one more that the maximum element index referenced, In this case, <code>record[7]</code>, <code>8 = 7 + 1</code>. If you add <code>record[8]</code>, allocate <code>9 = 8 + 1</code>."}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530101514, "post_id": 51062097, "comment_id": 89114705, "body": "one more thing if the field is empty then it will not save into the database, right?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530101726, "post_id": 51062097, "comment_id": 89114850, "body": "@ansh: You have <code>omitempty</code> for the <code>Mongo</code> <code>struct</code> fields which should omit any empty fields on a write."}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530102046, "post_id": 51062097, "comment_id": 89115089, "body": "okay @peterSO for this answer and thanks for giving me your golden time for solving my question. :p"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530102058, "post_id": 51062097, "comment_id": 89115100, "body": "@ansh: &quot;The &quot;omitempty&quot; option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.&quot;"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530102178, "post_id": 51062097, "comment_id": 89115169, "body": "okay once again thanks @peterSO I&#39;m new on go so thats why little bit difficult for me"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1530101012, "last_edit_date": 1530101012, "creation_date": 1530100277, "answer_id": 51062097, "question_id": 51061377, "link": "https://stackoverflow.com/questions/51061377/how-on-the-place-of-empty-space-in-the-csv-file-the-empty-string-value-is-added/51062097#51062097", "title": "How on the place of empty space in the csv file the empty string value is added in database", "body": "<p>Make sure that you have slice elements for <code>record[0]</code> through <code>record[7]</code>. Add empty padding elements. For example,</p>\n\n<pre><code>reader := csv.NewReader(file)\npadding := make([]string, 8)  // 0 thru 7\nfor {\n    record, err := reader.Read()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        panic(err)\n    }\n    record = append(record, padding...)\n    err = c.Insert(&amp;Mongo{record[0], record[1], record[2], record[3], record[4], record[5], record[6], record[7]})\n\n    if err != nil {\n        panic(err)\n    }\n    log.Printf(\"%#v\", record)\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 1, "accepted_answer_id": 51062097, "answer_count": 1, "score": 0, "last_activity_date": 1530101012, "creation_date": 1530098130, "last_edit_date": 1530100787, "question_id": 51061377, "link": "https://stackoverflow.com/questions/51061377/how-on-the-place-of-empty-space-in-the-csv-file-the-empty-string-value-is-added", "title": "How on the place of empty space in the csv file the empty string value is added in database", "body": "<p>My csv file having user data like this:</p>\n\n<pre><code> firstname|lastname|Email| other fields are empty\n          |        |     |\n          |        |     |\n          |        |     |\n          |        |     |\n</code></pre>\n\n<p>The code I'm using is:</p>\n\n<pre><code> package main\n\nimport (\n \"encoding/csv\"\n \"gopkg.in/mgo.v2\"\n \"io\"\n \"log\"\n \"os\"\n)\n\ntype Mongo struct {\n  // Id          int    `json:\"_id\" bson:\"_id\"`\n  FirstName   string `json:\"first_name,omitempty\" bson:\"first_name,omitempty\"`\n  LastName    string `json:\"last_name,omitempty\" bson:\"last_name,omitempty\"`\n  Email       string `json:\"email,omitempty\" bson:\"email,omitempty\"`\n  PhoneNumber string `json:\"phone_number,omitempty\" bson:\"phone_number,omitempty\"`\n  Gender      string `json:\"gender,omitempty\" bson:\"gender,omitempty\"`\n  Address     string `json:\"address,omitempty\" bson:\"address,omitempty\"`\n  Apartment   string `json:\"apartment,omitempty\" bson:\"apartment,omitempty\"`\n  Description string `json:\"description,omitempty\" bson:\"description,omitempty\"`\n }\n\nfunc main() {\n\n session, err := mgo.Dial(\"localhost\")\n if err != nil {\n    panic(err)\n }\n\n defer session.Close()\n session.SetMode(mgo.Monotonic, true)\n\n c := session.DB(\"Import_Users\").C(\"users\")\n\n file, err := os.Open(\"customers.csv\")\n\n if err != nil {\n    panic(err)\n }\n defer file.Close()\n\n reader := csv.NewReader(file)\n\n for {\n    record, err := reader.Read()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        panic(err)\n    }\n\n    err = c.Insert(&amp;Mongo{record[0], record[1], record[2], record[3], record[4], record[5], record[6], record[7]})\n\n    if err != nil {\n        panic(err)\n    }\n    log.Printf(\"%#v\", record)\n }\n}\n</code></pre>\n\n<p>The error is coming while running:</p>\n\n<blockquote>\n  <p>Error:-\n  panic: runtime error: index out of range</p>\n  \n  <p>goroutine 1 [running]:\n  main.main()\n    /home/iron/go/src/go-training/How_to_load_csv_file/main.go:53 +0x830\n  exit status 2</p>\n</blockquote>\n\n<p>How can I solve this error?</p>\n"}, {"tags": ["go", "sonarqube"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530086115, "post_id": 51057243, "comment_id": 89105118, "body": "I don&#39;t understand your question. What are you trying to do, and what problems are you having?"}], "answers": [{"tags": [], "owner": {"reputation": 629, "user_id": 6619811, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GgE_-pIeidI/AAAAAAAAAAI/AAAAAAAARRg/0kkX9SLO1R4/photo.jpg?sz=128", "display_name": "Alban A. - SonarSource Team", "link": "https://stackoverflow.com/users/6619811/alban-a-sonarsource-team"}, "is_accepted": true, "score": 3, "last_activity_date": 1530094161, "creation_date": 1530094161, "answer_id": 51060061, "question_id": 51057243, "link": "https://stackoverflow.com/questions/51057243/gosonar-how-to-generate-go-test-json-report-json/51060061#51060061", "title": "GoSonar : how to generate go test -json &gt; report.json", "body": "<p>In the Makefile, you generate the coverage report using:</p>\n\n<p><code>go test -coverprofile $(package)/cover.out $(package)</code></p>\n\n<p>To generate the test report you need to add:</p>\n\n<p><code>go test -coverprofile $(package)/cover.out -json $(package) &gt; $(package)/test-report.json</code></p>\n\n<p>Or if you prefer a single report, you can create an empty file:</p>\n\n<p><code>echo -n &gt; test-report.json</code></p>\n\n<p>And append all the tests to it:</p>\n\n<p><code>go test -coverprofile $(package)/cover.out -json $(package) &gt;&gt; test-report.json</code></p>\n\n<p>Note: I removed <code>-covermode=count</code> because it's not useful if the report is only used by SonarGo.</p>\n"}], "owner": {"reputation": 29, "user_id": 7297164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vSPLm.gif?s=128&g=1", "display_name": "Rocky", "link": "https://stackoverflow.com/users/7297164/rocky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1719, "favorite_count": 0, "accepted_answer_id": 51060061, "answer_count": 1, "score": -3, "last_activity_date": 1531170214, "creation_date": 1530085558, "last_edit_date": 1531170214, "question_id": 51057243, "link": "https://stackoverflow.com/questions/51057243/gosonar-how-to-generate-go-test-json-report-json", "title": "GoSonar : how to generate go test -json &gt; report.json", "body": "<p>How to generate <code>go test -json &gt; report.json</code></p>\n\n<p>Golang Version: Go1.10.3</p>\n\n<p>SonarQube Properties: sonar.go.tests.reportPaths = report.json</p>\n\n<p>Offical Sonar Document -> <a href=\"https://docs.sonarqube.org/display/PLUG/Unit+Tests+Results+Import\" rel=\"nofollow noreferrer\">https://docs.sonarqube.org/display/PLUG/Unit+Tests+Results+Import</a></p>\n\n<p>Makefile </p>\n\n<pre><code>.PHONY: test\ntest:\n    @$(foreach package,$(packages), \\\n        go test -coverprofile $(package)/cover.out -covermode=count $(package);)\n\n.PHONY: cover\ncover-xml:\n    @$(foreach package,$(packages), \\\n        gocov convert $(package)/cover.out | gocov-xml &gt; $(package)/coverage.xml;)\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 1273, "user_id": 4380247, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/CcTFe.jpg?s=128&g=1", "display_name": "acrazing", "link": "https://stackoverflow.com/users/4380247/acrazing"}, "edited": false, "score": 0, "creation_date": 1530083711, "post_id": 51056652, "comment_id": 89103764, "body": "In c++, I can use <code>const</code> variable as the length of array, but golang can not do it for const must be computed when compile."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1530083920, "post_id": 51056652, "comment_id": 89103868, "body": "You can&#39;t. Arrays have a fixed length. Use a slice."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1530083959, "post_id": 51056652, "comment_id": 89103888, "body": "What is the actual problem you&#39;re trying to solve? Your question seems like an XY Problem."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1530084085, "post_id": 51056652, "comment_id": 89103960, "body": "If you already have the slice (whose backing array you&#39;d like to get), you can use the slice to change the elements, you don&#39;t need an array for that. You&#39;re just complicating things and making your own task more difficult."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1530095091, "post_id": 51056652, "comment_id": 89110623, "body": "<a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">The XY Problem</a>: The XY problem is asking about your attempted solution rather than your actual problem. This leads to enormous amounts of wasted time and energy, both on the part of people asking for help, and on the part of those providing help."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 5, "last_activity_date": 1530097492, "last_edit_date": 1530097492, "creation_date": 1530089403, "answer_id": 51058422, "question_id": 51056652, "link": "https://stackoverflow.com/questions/51056652/how-do-i-create-array-with-dynamic-length-rather-than-slice-in-golang/51058422#51058422", "title": "How do I create array with dynamic length rather than slice in golang?", "body": "<p>To add to the <a href=\"https://stackoverflow.com/users/1705598/icza\">@icza</a>'s comment, you can easily extract the underlying array by using <code>&amp;data[0]</code>\u2014assuming <code>data</code> is an initialized slice. IOW, there's no need to jump through the hoops here: the address of the first slice's element is actually the address of the first slot in the slice's underlying array\u2014no magic here.</p>\n\n<p>Since taking an address of an element of an array is creating\na reference to that memory\u2014as long as the garbage collector is\nconcerned\u2014you can safely let the slice itself go out of scope\nwithout the fear of that array's memory becoming inaccessible.</p>\n\n<p>The only thing which you can't really do with the resulting\npointer is passing around the result of dereferencing it.\nThat's simply because arrays in Go have their length encoded in\ntheir type, so you'll be unable to create a function to accept\nsuch array\u2014because you do not know the array's length in advance.</p>\n\n<p>Now please stop and think.</p>\n\n<p>After extracting the backing array from a slice, you have\na pointer to the array's memory.\nTo sensibly carry it around, you'll also need to carry around\nthe array's length\u2026 but this is precisely what slices do:\nthey pack the address of a backing array with the length of the\ndata in it (and also the capacity).</p>\n\n<p>Hence really I think you should reconsider your problem\nas from where I stand I'm inclined to think it's a non-problem\nto begin with.</p>\n\n<p>There <em>are</em> cases where wielding pointers to the backing arrays\nextracted from slices may help: for instance, when \"pooling\"\nsuch arrays (say, via <code>sync.Pool</code>) to reduce memory churn\nin certain situations, but these are concrete problems.\nIf you have a concrete problem, please explain <em>it,</em>\nnot your attempted solution to it\u2014what @Flimzy said.</p>\n\n<hr>\n\n<p><strong>Update</strong> I think I should may be better explain the</p>\n\n<blockquote>\n  <p>you can't really do with the resulting\n  pointer is passing around the result of dereferencing it.</p>\n</blockquote>\n\n<p>bit.</p>\n\n<p>A crucial point about arrays in Go (as opposed to slices)\nis that arrays\u2014as everything in Go\u2014are passed around\n<em>by value,</em> and for arrays that means their data is copied.</p>\n\n<p>That is, if you have</p>\n\n<pre><code>var a, b [8 * 1024 * 1024]byte\n...\nb = a\n</code></pre>\n\n<p>the statement <code>b = a</code> would really copy 8 MiB of data.\nThe same obviously applies to arguments of functions.</p>\n\n<p>Slices sidestep this problem by holding a pointer\nto the underlying (backing) array. So a slice value\nis a little <code>struct</code> type containing\na pointer and two integers.\nHence copying it is really cheap but \"in exchange\" it\nhas reference semantics: both the original value and\nits copy point to the same backing array\u2014that is,\nreference the same data.</p>\n\n<p>I really advise you to read these two pieces,\nin the indicated order:</p>\n\n<ol>\n<li><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></li>\n<li><a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">https://blog.golang.org/slices</a></li>\n</ol>\n"}], "owner": {"reputation": 1273, "user_id": 4380247, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/CcTFe.jpg?s=128&g=1", "display_name": "acrazing", "link": "https://stackoverflow.com/users/4380247/acrazing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1703, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1530097492, "creation_date": 1530083610, "question_id": 51056652, "link": "https://stackoverflow.com/questions/51056652/how-do-i-create-array-with-dynamic-length-rather-than-slice-in-golang", "title": "How do I create array with dynamic length rather than slice in golang?", "body": "<p>For example: I want to use reflect to get a slice's data as an array to manipulate it.</p>\n\n<pre><code>func inject(data []int) {\n    sh := (*reflect.SliceHeader)(unsafe.Pointer(&amp;data))\n    dh := (*[len(data)]int)(unsafe.Pointer(sh.Data))\n    printf(\"%v\\n\", dh)\n}\n</code></pre>\n\n<p>This function will emit a compile error for <code>len(data)</code> is not a constant. How should I fix it?</p>\n"}, {"tags": ["go", "protoc"], "answers": [{"tags": [], "owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1530082130, "creation_date": 1530082130, "answer_id": 51056243, "question_id": 51056116, "link": "https://stackoverflow.com/questions/51056116/protoc-command-not-working-with-go-generate/51056243#51056243", "title": "protoc command not working with go generate", "body": "<p>ok, this is dumb.</p>\n\n<p>the answer is to not use the <code>-n</code> flag in the <code>go generate</code> command.  that just prints what to execute without actually executing.</p>\n"}], "owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1069, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530082130, "creation_date": 1530081680, "question_id": 51056116, "link": "https://stackoverflow.com/questions/51056116/protoc-command-not-working-with-go-generate", "title": "protoc command not working with go generate", "body": "<p>I have the following .proto file:</p>\n\n<pre><code>$GOPATH/src/github.com/path/to/package/myPkg.proto\n</code></pre>\n\n<p>with the following first few lines:</p>\n\n<pre><code>syntax=\"proto3\";\npackage myPkg;\noption go_package = \"github.com/path/to/package\";\n</code></pre>\n\n<p>Then I am creating a .go file with the following</p>\n\n<pre><code>//go:generate protoc -I $GOPATH/src/github.com/path/to/package --go_out=plugins=grpc:$GOPATH/src myPkg.proto\npackage someRandomGoPackage\n</code></pre>\n\n<p>The above <code>protoc</code> command works perfectly when run from <code>bash</code> (a new <code>myPkg.pb.go</code> is created under <code>github.com/path/to/package</code>), but it does nothing when I run <code>go generate -x -v -n</code> except print the command.</p>\n"}, {"tags": ["go", "networking", "tcp"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530081781, "post_id": 51056058, "comment_id": 89102753, "body": "What have you tried so far?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1530082170, "post_id": 51056058, "comment_id": 89102964, "body": "Is <code>b:=make([]byte,4); con.Read(b)</code> too obvious?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1530082343, "post_id": 51056058, "comment_id": 89103055, "body": "<code>io.ReadFull()</code> should be preferred, <code>con.Read()</code> does not guarantee that the full slice will be populated. Also <code>binary.LittleEndian.Uint32()</code> if you don&#39;t want to shuffle bytes manually."}, {"owner": {"reputation": 197, "user_id": 9502074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a20dac1f1b7756c2ae77f563f3724270?s=128&d=identicon&r=PG", "display_name": "Korrat", "link": "https://stackoverflow.com/users/9502074/korrat"}, "edited": false, "score": 0, "creation_date": 1530082613, "post_id": 51056058, "comment_id": 89103197, "body": "Why don&#39;t use <code>binary.Read</code> directly?"}], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": true, "score": 0, "last_activity_date": 1530118776, "creation_date": 1530118776, "answer_id": 51068014, "question_id": 51056058, "link": "https://stackoverflow.com/questions/51056058/read-specific-number-of-bytes-which-is-in-acceptable-data/51068014#51068014", "title": "Read specific number of bytes which is in acceptable data", "body": "<p>Try using this:</p>\n\n<p>package main</p>\n\n<p>import (\n    \"encoding/binary\"\n    \"io\"\n)</p>\n\n<pre><code>func ReadPacket(r io.Reader) ([]byte, error) {\n    lenB := make([]byte, 4)\n\n    if _, err := r.Read(lenB); err != nil {\n        return nil, err\n    }\n\n    //you can use BigEndian depending on the proto\n    l := binary.LittleEndian.Uint32(lenB)\n\n    packet := make([]byte, l)\n\n    _, err := r.Read(packet)\n\n    return packet, err\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8725918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21837d64e37d0cea9ab66cedbe2ec24d?s=128&d=identicon&r=PG&f=1", "display_name": "flyingv805", "link": "https://stackoverflow.com/users/8725918/flyingv805"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 51068014, "answer_count": 1, "score": -4, "last_activity_date": 1530118776, "creation_date": 1530081417, "last_edit_date": 1530115385, "question_id": 51056058, "link": "https://stackoverflow.com/questions/51056058/read-specific-number-of-bytes-which-is-in-acceptable-data", "title": "Read specific number of bytes which is in acceptable data", "body": "<p>I have a binary package of data, but length of the package is a first 4 bytes of it. Is there a correct way to read length and then read whole package with net.Conn in GoLang?</p>\n"}, {"tags": ["go", "timezone", "zoneinfo"], "answers": [{"comments": [{"owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 2, "creation_date": 1530219563, "post_id": 51054866, "comment_id": 89170493, "body": "Thanks @chuckx. Let me layout my understanding of the proposed solution to see if I understand correctly.  1. Make a local version of loadTzinfoFromZip that I can use since this method is not exported 2. Use that method to get the []bytes of the timeinfo.zip file for the version I want to use 3. Use LoadLocationFromTZData exclusively throughout my code instead of LoadLocation"}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "reply_to_user": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 1, "creation_date": 1530220581, "post_id": 51054866, "comment_id": 89170881, "body": "Sounds about right. Extracted the steps into the answer."}, {"owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 0, "creation_date": 1530220868, "post_id": 51054866, "comment_id": 89170976, "body": "Thanks. I&#39;ll try it out and report back."}, {"owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 1, "creation_date": 1530736791, "post_id": 51054866, "comment_id": 89343437, "body": "It turns out that getting the correct bytes out of the zip file was a real pain so instead I went with a strategy of extracting the zip and then it becomes much easier to get the bytes out of the correct time zone file. I created a repo for this that I&#39;ll link to from my question."}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": true, "score": 2, "last_activity_date": 1530220567, "last_edit_date": 1530220567, "creation_date": 1530075938, "answer_id": 51054866, "question_id": 51053321, "link": "https://stackoverflow.com/questions/51053321/detect-if-zoneinfo-fails-in-go/51054866#51054866", "title": "Detect if ZONEINFO fails in Go", "body": "<p>Maybe consider not relying on the environment variable?</p>\n\n<p>If you're not averse to distributing the unzipped fileset, you can easily use <a href=\"https://golang.org/pkg/time/#LoadLocationFromTZData\" rel=\"nofollow noreferrer\"><code>LoadLocationFromTZData(name string, data []byte)</code></a>. The second argument is the contents of an individual timezone file.</p>\n\n<p>For reference, the functionality for processing a zip file is found in the unexported function <a href=\"https://github.com/golang/go/blob/f03ee913e210e1b09bd33ed35c03ec8e4fc270be/src/time/zoneinfo_read.go#L262\" rel=\"nofollow noreferrer\"><code>loadTzinfoFromZip()</code></a>.</p>\n\n<p>Step-by-step approach extracted from @Slotherooo's comment:</p>\n\n<ol>\n<li>Make a local version of <a href=\"https://github.com/golang/go/blob/f03ee913e210e1b09bd33ed35c03ec8e4fc270be/src/time/zoneinfo_read.go#L262\" rel=\"nofollow noreferrer\"><code>time.loadTzinfoFromZip(zipfile, name string) ([]byte, error)</code></a></li>\n<li>Use that method to extract the <code>[]byte</code> for the desired location from a <code>timeinfo.zip</code> file</li>\n<li>Use <a href=\"https://golang.org/pkg/time/#LoadLocationFromTZData\" rel=\"nofollow noreferrer\"><code>time.LoadLocationFromTZData()</code></a> exclusively instead of <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\"><code>time.LoadLocation</code></a></li>\n</ol>\n"}], "owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 0, "accepted_answer_id": 51054866, "answer_count": 1, "score": 3, "last_activity_date": 1530737135, "creation_date": 1530062830, "last_edit_date": 1530737135, "question_id": 51053321, "link": "https://stackoverflow.com/questions/51053321/detect-if-zoneinfo-fails-in-go", "title": "Detect if ZONEINFO fails in Go", "body": "<p>In Go, you can specify a specific zoneinfo.zip file to be used by adding a ZONEINFO environment variable that points to the specific file you'd like to use for time zone information. This is great as it allows me to ensure that the versions of the IANA time zone database that I'm using on my front-end and my back-end are the same.</p>\n\n<p>However, there does not appear to be any way to detect if use of the specified zone info file has failed. Looking at the source code (<a href=\"https://golang.org/src/time/zoneinfo.go\" rel=\"nofollow noreferrer\">https://golang.org/src/time/zoneinfo.go</a>), it looks like any errors using the specified file will fail quietly and then go will proceed to check for default OS locations or the default $GOROOT location to pull time zone information from there. This is not the behavior that I would prefer as I would like to know with certainty that I am using my specified version of zone info.</p>\n\n<p>I've thought of the following in terms of solutions, but I'm not happy with any of them.</p>\n\n<ol>\n<li>I can check that the environment variable is set myself, but this is at best a partial solution as it doesn't tell me if the file is actually usable by LoadLocation.</li>\n<li>I can ensure none of the backup locations for zone info exist. This seems a bit extreme and means that I have to be extremely careful about the environment that the code is running in in both dev and production settings.</li>\n</ol>\n\n<p>Does anyone know of a more elegant way to ensure that I am using the zoneinfo.zip file specified by my ZONEINFO environment variable?</p>\n\n<p><strong>Update:</strong> To address this problem I too inspiration from @chuckx's answer below and put together <a href=\"https://github.com/slotheroo/knozone\" rel=\"nofollow noreferrer\">a Go package</a> that takes the guess work out of which time zone database is being used. Included in the readme are instructions on how to get the correct version of the time zone database using a Go installation. </p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1530063810, "post_id": 51053081, "comment_id": 89097843, "body": "Try run <code>go clean</code> and see if the problem re-occur. If it does, run the code out of IDE."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 8, "last_activity_date": 1530066006, "creation_date": 1530066006, "answer_id": 51053645, "question_id": 51053081, "link": "https://stackoverflow.com/questions/51053081/the-execute-order-differ-from-code-order/51053645#51053645", "title": "The execute order differ from code order", "body": "<p>First, note that <code>println()</code> writes to <code>os.Stderr</code>.</p>\n\n<p><a href=\"https://golang.org/pkg/builtin/#println\" rel=\"noreferrer\">https://golang.org/pkg/builtin/#println</a></p>\n\n<blockquote>\n  <p>...and writes the result to standard error</p>\n</blockquote>\n\n<p>It seems Jetbrain's IDEs would show you <code>Stderr</code> lines at the end and in a different colour.</p>\n\n<p>This is a smaller program that would let you reproduce the same behaviour:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Fprintln(os.Stderr, \"to stderr\")\n    fmt.Fprintln(os.Stdout, \"to stdout\")\n}\n</code></pre>\n\n<p>You will see the output inverted, with the <code>to stderr</code> line shown in red.</p>\n\n<p>You cannot reproduce this outside the IDE cause then stderr and stdout ouput will be interleaved.</p>\n"}], "owner": {"reputation": 983, "user_id": 7861179, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9c2400b191f563b54923485cf44d3c2b?s=128&d=identicon&r=PG&f=1", "display_name": "rellocs wood", "link": "https://stackoverflow.com/users/7861179/rellocs-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 51053645, "answer_count": 1, "score": 1, "last_activity_date": 1530084010, "creation_date": 1530060301, "last_edit_date": 1530084010, "question_id": 51053081, "link": "https://stackoverflow.com/questions/51053081/the-execute-order-differ-from-code-order", "title": "The execute order differ from code order", "body": "<p>I execute this code snippet in goland IDE but found the output order is NOTthe same as what I expected:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\nfunc main() {\n\n    println(\"===========================\")\n    println(\"---------------------------\")\n    r,_:= div(6,3)\n    fmt.Println(r)\n}\n\nfunc div(x, y int) (int, error) {\n    defer println(\"dispose...\")\n    if y == 0 {\n        return 0, errors.New(\"division by zero\")\n    }\n    return x / y, nil\n}\n</code></pre>\n\n<p>output:</p>\n\n<p><a href=\"https://i.stack.imgur.com/47xOz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/47xOz.png\" alt=\"enter image description here\"></a></p>\n\n<ol>\n<li>why the out order is differ from code order</li>\n<li>why the output in different color(white &amp; red), I use goland IDE by jetbrain</li>\n</ol>\n\n<p>I could not reproduce in <a href=\"https://play.golang.org/p/2T5LOt7FRDn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2T5LOt7FRDn</a>\nMy Local env: windows 10 + go1.10.3 windows/amd64 + GoLand 2018.1.4</p>\n"}, {"tags": ["go", "google-cloud-datastore", "datastore"], "comments": [{"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1530060734, "post_id": 51052834, "comment_id": 89097293, "body": "Is there a reason you are not using the <code>datastore.NewKey</code> or<code>datastore.NewIncompleteKey</code> methods?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1530061302, "post_id": 51052834, "comment_id": 89097392, "body": "neither incomplete key nor nameKey accept namespace in its argument, so that&#39;s why I directly use it like that"}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1530070290, "post_id": 51054036, "comment_id": 89099112, "body": "is it be good practice to put all user data into the same namespace? or namespace is for organice bigger data"}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1530070613, "post_id": 51054036, "comment_id": 89099187, "body": "Namespaces are designed primarily for multi-tenancy applications - to partition the data. Note that if you&#39;re using them you have to be consistent in their use. For example if you make queries they are contained to one namespace, see <a href=\"https://stackoverflow.com/questions/50071038/are-datastore-indexes-same-across-multiple-namespaces/50078730#50078730\" title=\"are datastore indexes same across multiple namespaces\">stackoverflow.com/questions/50071038/&hellip;</a>"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1530072811, "post_id": 51054036, "comment_id": 89099624, "body": "is multi-tenancy meaning &quot;multi- rent&quot;? don&#39;t undestand the meaning, I translated to my native language but it does not make sense to me"}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1530104820, "post_id": 51054036, "comment_id": 89117015, "body": "It is similar to that - your app would be serving your customers&#39; services on their behalf and you want their data partitioned separately. See <a href=\"https://cloud.google.com/appengine/docs/standard/python/multitenancy/multitenancy\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/python/multitenancy&zwnj;&#8203;/&hellip;</a> Just like Google serves all GAE apps, without an app interacting with each-other."}], "tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": true, "score": 0, "last_activity_date": 1530183926, "last_edit_date": 1592644375, "creation_date": 1530069405, "answer_id": 51054036, "question_id": 51052834, "link": "https://stackoverflow.com/questions/51052834/difference-between-namespace-and-ancestor-in-data-structure/51054036#51054036", "title": "Difference between namespace and ancestor in data structure", "body": "<p>The difference is that the namespace contention corner case you mentioned is just a transient one, equivalent (from the root cause perspective), if you want, with <a href=\"https://cloud.google.com/datastore/docs/best-practices#high_readwrite_rates_to_a_narrow_key_range\" rel=\"nofollow noreferrer\">this one</a>:</p>\n<blockquote>\n<p>...</p>\n<p>If you create new entities at a very high rate for a kind which\npreviously had very few existing entities. Bigtable will start off\nwith all entities on the same tablet server and will take some time to\nsplit the range of keys onto separate tablet servers.</p>\n<p>...</p>\n</blockquote>\n<p>The transient lasts only until sufficient tablet splits occur to keep up with the write ops rate. For the case you quoted a gradual traffic ramp-up will give time for these splits to happen before hitting errors, avoiding the issue. Even without a gradual ramp-up - contention may occur only until the splits happen, after which it disappears.</p>\n<p>Using an ancestry, on the other hand, raises a permanent problem, of a different kind. All entities sharing the same ancestry are placed in the same entity group and thus all share the maximum 1 write per second per entity group rate. The larger the group the higher risk of contention. Using non-ancestor related entities (with or without namespaces) effectively creates entity groups with a size of one - minimal contention of this type.</p>\n<p>So unless you really, really need the ancestry, I'd suggest to try to avoid it if your expected usage patterns leave room for contention.</p>\n<p>Side note: that article only touches on the write contention, but you should be aware that contention can occur at read as well (in transactions), see <a href=\"https://stackoverflow.com/questions/32927068/contention-problems-in-google-app-engine/45496048#45496048\">Contention problems in Google App Engine</a>. The entity group size matters in this case as well as a transaction attempts to lock the entire entity group.</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 51054036, "answer_count": 1, "score": -1, "last_activity_date": 1530183926, "creation_date": 1530057757, "last_edit_date": 1530114488, "question_id": 51052834, "link": "https://stackoverflow.com/questions/51052834/difference-between-namespace-and-ancestor-in-data-structure", "title": "Difference between namespace and ancestor in data structure", "body": "<p>What could be the diference between</p>\n\n<pre><code>key := datastore.NameKey(\"user\", userID, nil)\nclient.Put(ctx,datastore.IncompleteKey(\"session\",key),&amp;sessionUser)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>key :=&amp;datastore.Key{Kind:\"session\",Parent:nil,Namespace:userID}\nclient.Put(ctx,key,&amp;sessionUser)\n</code></pre>\n\n<p>Why would they be different if they both have the same write/read that can cause <a href=\"https://cloud.google.com/appengine/articles/scaling/contention\" rel=\"nofollow noreferrer\">contention</a> \nFrom this <a href=\"https://cloud.google.com/datastore/docs/best-practices\" rel=\"nofollow noreferrer\">article</a></p>\n\n<blockquote>\n  <p>Cloud Datastore prepends the namespace and the kind of the root entity group to the Bigtable row key. You can hit a hotspot if you start to write to a new namespace or kind without gradually ramping up traffic.</p>\n</blockquote>\n\n<p>I'm really confuse how should I strut my data because of that, \nby the way, which of them is faster when reading?</p>\n"}, {"tags": ["ssl", "go", "subdomain", "lets-encrypt"], "owner": {"reputation": 49, "user_id": 2128973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370f72e6edb9fe48cdcc25de4574e9a7?s=128&d=identicon&r=PG", "display_name": "Djordje Marcetin", "link": "https://stackoverflow.com/users/2128973/djordje-marcetin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 579, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1530068024, "creation_date": 1530053429, "last_edit_date": 1530068024, "question_id": 51052352, "link": "https://stackoverflow.com/questions/51052352/how-to-setup-autotls-for-wildcard-subdomains-in-iris-golang-framework", "title": "How to setup AutoTLS for wildcard subdomains in Iris GoLang Framework", "body": "<p>Usage of * (star) as the wildcard is not working:</p>\n\n<pre>\n\napp.Run(iris.AutoTLS(\":443\", \"*.example.com\", \"mail@example.com\")) \n\n</pre>\n\n<p>Case of entering subdomains manual is working:</p>\n\n<pre>\n\napp.Run(iris.AutoTLS(\":443\", \"sub1.example.com sub2.example.com sub3.example.com\", \"mail@example.com\")) \n\n</pre>\n\n<p>There are a lot of subdomains and it should not be manually controlled. \nAlso if put every subdomain in the list it will be huge and it will not work as of letsencrypt limitations.</p>\n\n<p>Followed this example for wildcard subdomains method:\n<a href=\"https://github.com/kataras/iris/blob/master/_examples/subdomains/wildcard/main.go\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris/blob/master/_examples/subdomains/wildcard/main.go</a> </p>\n\n<p>If subdomains are deleted and if there is cert file on host subdomain will work although it is not listed whitelist field.</p>\n\n<pre>\n\napp.Run(iris.AutoTLS(\":443\", \"sub3.example.com\", \"mail@example.com\")) \n\n</pre>\n\n<p>So I am presuming autocert function should be executed for each subdomain when visited.</p>\n\n<pre>\n\nfunc dynamicSubdomainHandler(ctx iris.Context) {\n    username := ctx.Subdomain()\n    ctx.Writef(\"Hello from dynamic subdomain path: %s, here you can handle the route for dynamic subdomains, handle the user: %s\", ctx.Path(), username)\n\nXXX autocert( \"username.example.com\", \"mail@example.com\")) XXX\n\n}\n</pre>\n\n<p><strong>EDIT:</strong>\nLimitations of letsencrypt are 20 certificates per registered domain per week, but it allows combining up to 100 Names into a single certificate.</p>\n\n<p>So, the idea described above is not a right solution as this should be a new function with a counter. That function then should fill one certificate with subdomains until reach 100 and that request a new certificate which will be filed until 100 and so on. In that way, we can get 2000 subdomains per week, 100 names by 20 certificates per week.\nThis should be implemented in Iris as there are AutoTLS and Wildcard subdomains but they are not working together. Wildcards are not wildcards if you need to set value anywhere.</p>\n"}, {"tags": ["html", "go", "proxy", "raspberry-pi", "mjpeg"], "answers": [{"tags": [], "owner": {"reputation": 1250, "user_id": 2370086, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lC6Qg.jpg?s=128&g=1", "display_name": "Radoslav Stoyanov", "link": "https://stackoverflow.com/users/2370086/radoslav-stoyanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1562187471, "creation_date": 1562187471, "answer_id": 56877833, "question_id": 51051597, "link": "https://stackoverflow.com/questions/51051597/how-can-i-use-mjpg-streamer-in-own-html/56877833#56877833", "title": "How can I use mjpg-streamer in own html?", "body": "<p>You can embed it with an <code>&lt;img&gt;</code> tag passing the proxy handler to the image source like this:</p>\n\n<pre><code>&lt;img src=\"http://teichfries.de/stream_simple.html\" /&gt;\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9996743, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7bWUseqvZaY/AAAAAAAAAAI/AAAAAAAAABI/U2KJtz7bukM/photo.jpg?sz=128", "display_name": "Max", "link": "https://stackoverflow.com/users/9996743/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 559, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1562187471, "creation_date": 1530048491, "question_id": 51051597, "link": "https://stackoverflow.com/questions/51051597/how-can-i-use-mjpg-streamer-in-own-html", "title": "How can I use mjpg-streamer in own html?", "body": "<p>I wrote a little webserver in go to show temperature and a livestream of my pond. I used the mjpg-streamer to create the stream on my RaspberryPi. \nThe server gives back a html in which I use an iframe to show the livestream of the mjpg-streamer. Unfortunately this only works while beeing in the same local network as the pi. I want to access it from outside so I tried using a little proxy to access the port on the pi where the streamer sits. Unfortunately, I still get no image (only the default 'no-image-source' icon). The proxy seems to work, because the website asks me for the login and password I configuered within the streamer. </p>\n\n<p>Is there a way to make the stream show up on the webpage from outside the network using the proxy or something else, or to embed the stream directly into my html file without the use of an iframe and proxy? </p>\n\n<p>The go webserver:</p>\n\n<pre><code> package main\n\nimport (\n\"net/http\"\n\"strings\"\n\"os\"\n\"os/exec\"\n\"net/url\"\n\"net/http/httputil\"\n\"html/template\"\n)\n\nconst MYFILE = \"temperatures.csv\"\n\n\nfunc readFile() (string){\n\n    file, err := os.Open(MYFILE)\n    if err != nil {\n        panic(err)\n    }\n    defer file.Close()\n\n    buf := make([]byte, 10)\n    stat, err := os.Stat(MYFILE)\n    start := stat.Size() - 10\n    _, err = file.ReadAt(buf, start)\n    xs := string(buf)\n    xs = strings.Split(xs,\",\")[1]\n    xs = xs[:len(xs)-2]\n    xs = xs + \" \u00b0C\"\n    return xs\n\n}\n\nfunc main() {\n\n    go func() {\n        exec.Command(\"python\", \"/home/pi/tempsensor.py\").Run()\n        }()\n\n        go func() {\n            exec.Command(\"python\", \"/home/pi/go/src/webserver/display_temp.py\", \"-d\", \"sh1106\").Run()\n            }()\n\n            go func() {\n                exec.Command(\"python\", \"/home/pi/go/src/webserver/startVid.py\").Run()\n                }()\n\n\n\n\n                http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        //exec.Command(\"python\",\"/home/pi/pyplot.py\").Run()\n                    t, _ := template.ParseFiles(\"home.html\")\n                    t.Execute(w, readFile())\n                    })\n                http.HandleFunc(\"/fix.png\", func(w http.ResponseWriter, r *http.Request) {\n                    http.ServeFile(w, r, \"/home/pi/fix.png\")\n                    })\n                http.HandleFunc(\"/fish.svg\", func(w http.ResponseWriter, r *http.Request) {\n                    http.ServeFile(w, r, \"/home/pi/go/src/webserver/resources/fish.svg\")\n                    })\n\n                u, _ := url.Parse(\"http://localhost:9000\")\n                http.Handle(\"/stream_simple.html\", httputil.NewSingleHostReverseProxy(u))\n\n                http.ListenAndServe(\":8080\", nil)\n            }\n</code></pre>\n\n<p>the html (for now, please just ignore the tablet an phone part of it):</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n\n  &lt;link rel=\"stylesheet\" href=\"https://code.getmdl.io/1.3.0/material.red-lime.min.css\" /&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/icon?family=Material+Icons\"&gt;\n  &lt;script defer src=\"https://code.getmdl.io/1.3.0/material.min.js\"&gt;&lt;/script&gt;\n  &lt;link rel=\"shortcut icon\" href=\"/fish.svg\"&gt;\n  &lt;link rel=\"icon\" href=\"/fish.svg\"&gt;\n\n\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n  &lt;meta name=\"description\" content=\"A front-end template that helps you build fast, modern mobile web apps.\"&gt;\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, minimum-scale=1.0\"&gt;\n  &lt;title&gt;Teich\u00fcberwachung Familie Fries&lt;/title&gt;\n\n  &lt;meta name=\"mobile-web-app-capable\" content=\"yes\"&gt;\n  &lt;link rel=\"icon\" sizes=\"192x192\" href=\"images/android-desktop.png\"&gt;\n  &lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\"&gt;\n  &lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\"&gt;\n  &lt;meta name=\"apple-mobile-web-app-title\" content=\"Material Design Lite\"&gt;\n  &lt;link rel=\"apple-touch-icon-precomposed\" href=\"images/ios-desktop.png\"&gt;\n  &lt;meta name=\"msapplication-TileImage\" content=\"images/touch/ms-touch-icon-144x144-precomposed.png\"&gt;\n  &lt;meta name=\"msapplication-TileColor\" content=\"#3372DF\"&gt;\n\n  &lt;!-- &lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js\"&gt;&lt;/script&gt; --&gt;\n\n&lt;/head&gt;\n\n\n\n\n&lt;body bgcolor=\"#5b5b5b\"&gt;\n  &lt;style&gt;\n  a.mdl-js-ripple-effect { position: relative; }\n  .mdl-navigation__link:hover {\n    color: #b4fd64;\n  }\n  .mdl-navigation__link:hover {\n    border-bottom-style: solid;\n  }\n\n  .mdl-grid {\n    margin-top: 50px;\n    margin-bottom: 50px;\n    max-width: 1000px;\n  }\n  .mdl-button {\n    margin-right: 20px;\n  }\n\n&lt;/style&gt;\n\n\n\n&lt;div class=\"mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs\"&gt;\n  &lt;header class=\"mdl-layout__header\"&gt;\n    &lt;div class=\"mdl-layout__header-row\"&gt;\n      &lt;!-- Title --&gt;\n      &lt;span class=\"mdl-layout-title\"&gt;\n        &lt;a href=\"/internal\"&gt;\n          &lt;img href=\"/internal\" class=\"mdl-logo-image\" src=\"/fish.svg\" height=\"42\"&gt;\n        &lt;/a&gt;\n      &lt;/span&gt;\n      &lt;!-- Add spacer, to align navigation to the right --&gt;\n      &lt;div class=\"mdl-layout-spacer\"&gt;&lt;/div&gt;\n      &lt;!-- Navigation. We hide it in small screens. --&gt;\n      &lt;nav class=\"mdl-navigation\"&gt;\n\n                &lt;form method=\"post\" action=\"/logout\"&gt;\n                        &lt;button class=\"mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect\"&gt;Log out&lt;/button&gt;\n                &lt;/form&gt;\n\n       &lt;/nav&gt;\n    &lt;/div&gt;\n  &lt;/header&gt;\n  &lt;main class=\"mdl-layout__content\"&gt;\n    &lt;!-- start of content --&gt;\n\n    &lt;style&gt;\n\n\n    .mdl-card{\n        min-height: 0px;\n    }\n\n\n    .big.mdl-card-video.mdl-card {\n      width: 90%;\n      height: 770px;\n      margin-top: 50px;\n      margin-bottom: 50px;\n    }\n    .medium.mdl-card-video.mdl-card {\n      height: 386px;\n    }\n    .small.mdl-card-video.mdl-card {\n      height: 219px;\n    }\n\n\n    .big.mdl-card-temperature.mdl-card {\n      width: 90%;\n      margin-top: 50px;\n      margin-bottom: 50px;\n    }\n    .medium.mdl-card-temperature.mdl-card {\n      height: 192px;\n    }\n    .small.mdl-card-temperature.mdl-card {\n      height: 102px;\n    }\n\n\n\n\n\n\n    .mdl-card-video &gt; .mdl-card__title {\n      color: #fff;\n      text-align: center;\n    }\n\n    .mdl-card-video &gt; .mdl-card__menu {\n      color: #fff;\n    }\n    .mdl-card-temperature &gt; .mdl-card__menu {\n      color: #fff;\n    }\n\n    .frame {\n        border:none;\n        background-color:none;\n        margin: auto; align:middle;\n        /*height:auto;  width:100%;*/\n        /*-moz-transform:scale(0.60);\n        -moz-transform-origin: 0 0;\n        -o-transform: scale(0.60);\n        -o-transform-origin: 0 0;\n        -webkit-transform: scale(0.65);\n        -webkit-transform-origin: 20% 0;*/\n    }\n\n    .temp {\n     padding: 5px;\n    }\n\n\n    @media (max-width: 999px) {\n      .mdl-card-temperature.mdl-card {\n        width: 85%;\n        margin-top: 50px;\n        margin-bottom: 50px;\n      }\n      .mdl-card-video.mdl-card {\n        width: 85%;\n        margin-top: 50px;\n        margin-bottom: 50px;\n      }\n    }\n\n  &lt;/style&gt;\n\n  &lt;center&gt;\n\n&lt;!-- Desktop Version --&gt;\n\n    &lt;div class=\"big mdl-card-video mdl-card mdl-shadow--8dp mdl mdl-cell--hide-phone mdl-cell--hide-tablet\"&gt;\n      &lt;div class=\"mdl-card__media\"&gt;\n          &lt;center&gt;\n            &lt;button class=\"mdl-button mdl-button--colored \" style=\"font-size: 200%;\"&gt;{{.}}&lt;/button&gt;\n\n          &lt;/center&gt;\n        &lt;/div&gt;\n      &lt;div class=\"mdl-card__media \"&gt;\n        &lt;iframe class='frame' height=900px src=\"http://teichfries.de/stream_simple.html\" scrolling=no&gt;&lt;/iframe&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div class=\"big mdl-card-temperature mdl-card mdl-shadow--8dp mdl-cell--hide-phone mdl-cell--hide-tablet\"&gt;\n      &lt;div class=\"mdl-card__media \"&gt;\n        &lt;img class=\"temp\" src='http://192.168.178.57:8080/fix.png' style='width: calc(100% - 10px);'&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n\n\n&lt;!-- Tablet Version --&gt;\n\n    &lt;div class=\"medium mdl-card-video mdl-card mdl-shadow--8dp mdl mdl-cell--hide-desktop mdl-cell--hide-phone\"&gt;\n          &lt;div class=\"mdl-card__media\"&gt;\n              &lt;center&gt;\n                &lt;button class=\"mdl-button mdl-button--colored \" style=\"font-size: 200%;\"&gt;{{.}}&lt;/button&gt;\n\n              &lt;/center&gt;\n            &lt;/div&gt;\n          &lt;div class=\"mdl-card__media \"&gt;\n            &lt;img class=\"temp\" src='http://teichfries.de/?action=snapshot' style='width: calc(100% - 10px);'&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"medium mdl-card-temperature mdl-card mdl-shadow--8dp mdl-cell--hide-desktop mdl-cell--hide-phone\"&gt;\n          &lt;div class=\"mdl-card__media \"&gt;\n            &lt;img class=\"temp\" src='http://192.168.178.57:8080/fix.png' style='width: calc(100% - 10px);'&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n\n&lt;!-- Phone Version --&gt;\n\n            &lt;div class=\"small mdl-card-video mdl-card mdl-shadow--8dp mdl mdl-cell--hide-desktop mdl-cell--hide-tablet\"&gt;\n                  &lt;div class=\"mdl-card__media\"&gt;\n                      &lt;center&gt;\n                        &lt;button class=\"mdl-button mdl-button--colored \" style=\"font-size: 200%;\"&gt;{{.}}&lt;/button&gt;\n\n                      &lt;/center&gt;\n                    &lt;/div&gt;\n                  &lt;div class=\"mdl-card__media \"&gt;\n                    &lt;img class=\"temp\" src='http://192.168.178.57:9000/?action=snapshot' style='width: calc(100% - 10px);'&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n                &lt;div class=\"small mdl-card-temperature mdl-card mdl-shadow--8dp mdl-cell--hide-desktop mdl-cell--hide-tablet\"&gt;\n                  &lt;div class=\"mdl-card__media \"&gt;\n                    &lt;img class=\"temp\" src='http://192.168.178.57:8080/fix.png' style='width: calc(100% - 10px);'&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n\n\n\n  &lt;/center&gt;\n&lt;/main&gt;\n\n&lt;/div&gt;\n\n\n\n\n&lt;/body&gt;\n</code></pre>\n\n<p>Thanks for your help,</p>\n\n<p>Max</p>\n"}, {"tags": ["go", "error-handling", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1530047984, "post_id": 51051486, "comment_id": 89094070, "body": "The compile error says: &quot;Error method has pointer receiver&quot;. You need to use a pointer."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 2, "creation_date": 1530049637, "post_id": 51051486, "comment_id": 89094641, "body": "You will have better luck with <a href=\"https://play.golang.org/p/S9ynJV9a2ma\" rel=\"nofollow noreferrer\"><code>printError(&amp;e)</code></a>."}, {"owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "edited": false, "score": 0, "creation_date": 1530105959, "post_id": 51051486, "comment_id": 89117887, "body": "(When you jump back into Go and seriously need to review.) On a side note, I fortuitously found Dave Cheney&#39;s excellent <a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\" rel=\"nofollow noreferrer\">article on errors</a> when searching for <code>os.PathError</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5547, "user_id": 131658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66b0d64c07b143d59ee5327d0617a01d?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/131658/bartosz"}, "is_accepted": true, "score": 5, "last_activity_date": 1530053319, "creation_date": 1530053319, "answer_id": 51052337, "question_id": 51051486, "link": "https://stackoverflow.com/questions/51051486/os-patherror-does-not-implement-error/51052337#51052337", "title": "os.PathError does not implement error", "body": "<p>Read about method sets here: <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"noreferrer\">https://golang.org/ref/spec#Method_sets</a></p>\n\n<blockquote>\n  <p>The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T)</p>\n</blockquote>\n\n<p>You are trying to call a function taking the <code>error</code> interface using type <code>os.PathError</code>. According to the above, it does not implement <code>Error() string</code>, because that method is defined on type <code>*os.PathError</code>.</p>\n\n<p>Having <code>os.PathError</code> you can get <code>*os.PathError</code> using the <code>&amp;</code> operator:</p>\n\n<p><code>printError(&amp;os.PathError{...})</code></p>\n"}], "owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1457, "favorite_count": 0, "accepted_answer_id": 51052337, "answer_count": 1, "score": 2, "last_activity_date": 1530102724, "creation_date": 1530047853, "last_edit_date": 1530102724, "question_id": 51051486, "link": "https://stackoverflow.com/questions/51051486/os-patherror-does-not-implement-error", "title": "os.PathError does not implement error", "body": "<p>The <a href=\"https://golang.org/src/os/error.go?s=750:813#L17\" rel=\"nofollow noreferrer\"><code>PathError</code></a> type found in Golang's <code>os</code> library:</p>\n\n<pre><code>type PathError struct {\n    Op   string\n    Path string\n    Err  error\n}\n\nfunc (e *PathError) Error() string { return e.Op + \" \" + e.Path + \": \" + e.Err.Error() }\n</code></pre>\n\n<p><em>nearly</em> fulfills Go's <a href=\"https://golang.org/src/builtin/builtin.go?s=10990:11030#L245\" rel=\"nofollow noreferrer\"><code>error</code> interface</a>:</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n\n<p>However, when trying to pass it as an error, you get the following compile time error:</p>\n\n<pre><code>cannot use (type os.PathError) as type error in argument... \nos.PathError does not implement error (Error method has pointer receiver)\n</code></pre>\n\n<p>Why would <code>os.PathError</code> use a pointer receiver for the Error method, and just avoid meeting the requirements of the error interface?</p>\n\n<p>Full example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    e := os.PathError{Path: \"/\"}\n    printError(e)\n}\n\nfunc printError(e error) {\n    fmt.Println(e)\n}\n</code></pre>\n"}, {"tags": ["go", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": true, "score": 3, "last_activity_date": 1530048291, "last_edit_date": 1530048291, "creation_date": 1530047882, "answer_id": 51051492, "question_id": 51050854, "link": "https://stackoverflow.com/questions/51050854/find-file-with-name-recursively-in-parent-directories-in-go/51051492#51051492", "title": "Find file with name recursively in parent directories in Go", "body": "<p>Here's one way you can walk backwards and read each <code>file.json</code> along the way.</p>\n\n<blockquote>\n  <p>Example project directory structure:</p>\n</blockquote>\n\n<pre><code>./\n  - main.go\n  ./my\n    - file.json &gt; {\"location\": \"/my\"}\n    ./my/sub\n      - file.json &gt; {\"location\": \"/my/sub\"}\n      ./my/sub/dir\n        - file.json &gt; {\"location\": \"/my/sub/dir\"}\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>main.go</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    basePath := \"./\"\n    targetPath := basePath + \"my/sub/dir\"\n    fileName := \"file.json\"\n\n    for {\n        rel, _ := filepath.Rel(basePath, targetPath)\n\n        // Exit the loop once we reach the basePath.\n        if rel == \".\" {\n            break\n        }\n\n        // Simple file reading logic.\n        dat, err := ioutil.ReadFile(fmt.Sprintf(\"%v/%v\", targetPath, fileName))\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(string(dat))\n\n        // Going up!\n        targetPath += \"/..\"\n    }\n\n}\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Output:</p>\n</blockquote>\n\n<pre><code>{ \"location\": \"/my/sub/dir\" }\n{ \"location\": \"/my/sub\" }\n{ \"location\": \"/my\" }\n</code></pre>\n\n<p><em>Hope you find this approach useful.</em></p>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "accepted_answer_id": 51051492, "answer_count": 1, "score": 1, "last_activity_date": 1530048291, "creation_date": 1530044567, "last_edit_date": 1530044972, "question_id": 51050854, "link": "https://stackoverflow.com/questions/51050854/find-file-with-name-recursively-in-parent-directories-in-go", "title": "Find file with name recursively in parent directories in Go", "body": "<p>I have a directory:</p>\n\n<pre><code>basepath + /my/sub/directory\n</code></pre>\n\n<p>In that subdirectory, I have multiple instances of a file with name <code>file.json</code></p>\n\n<p>Example:</p>\n\n<pre><code>my/file.json\nmy/sub/file.json\nmy/sub/directory/file.json\n</code></pre>\n\n<p>What I want to do is use the full directory path and walk BACK up the file tree until I hit the <code>basepath</code> and find all the filepaths for the <code>file.json</code> </p>\n\n<p>I looked at <code>filepath.Walk</code> but that seems to go downwards through the directory tree, not upwards</p>\n"}, {"tags": ["http", "go", "https", "http-headers"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1530042669, "post_id": 51050415, "comment_id": 89091844, "body": "There&#39;s no such thing as &quot;nested headers&quot;. What does the request that the <code>RestClient</code> sends actually look like?"}, {"owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530044797, "post_id": 51050415, "comment_id": 89092756, "body": "@JimB added it to the end. Thanks, to me it looks like I just need some query params."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530112367, "post_id": 51050415, "comment_id": 89122338, "body": "Yeah, looks like Ruby is calling it a header for no apparent reason, it&#39;s just appending query string values."}], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": true, "score": 1, "last_activity_date": 1530200660, "creation_date": 1530200660, "answer_id": 51086922, "question_id": 51050415, "link": "https://stackoverflow.com/questions/51050415/how-to-send-nested-headers-for-a-golang-http-request/51086922#51086922", "title": "How to send nested headers for a Golang HTTP request", "body": "<p>I just ran your Ruby code and found out that it doesn't actually send any headers, instead it adds query params to your request:</p>\n\n<pre><code>PUT /?foo=bar HTTP/1.1\nAccept: */*; q=0.5, application/xml\nAccept-Encoding: gzip, deflate\nUser-Agent: Ruby\nHost: localhost:8080\n</code></pre>\n\n<p>So you can just use this code to reproduce it in Go:</p>\n\n<pre><code>req, _ := http.NewRequest(\"PUT\", url, strings.NewReader(`{\"foo\": \"bar\"}`))\nclient := &amp;http.Client{}\nrsp, err = client.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 51086922, "answer_count": 1, "score": -3, "last_activity_date": 1530200660, "creation_date": 1530042541, "last_edit_date": 1530044747, "question_id": 51050415, "link": "https://stackoverflow.com/questions/51050415/how-to-send-nested-headers-for-a-golang-http-request", "title": "How to send nested headers for a Golang HTTP request", "body": "<p>I have an older script like the following in Ruby that I'n trying to copy in Golang</p>\n\n<pre><code>RestClient::Request.execute(\n    url: \"myurl\",\n    method: :put,\n    headers: {\n      params: {\n        foo: 'bar'\n      }\n })\n</code></pre>\n\n<p>This is what I have so far in Golang:</p>\n\n<pre><code>req, _ := http.NewRequest(\"PUT\", url, nil)\nreq.Header.Add(\"params\", \"{\\\"foo\\\": \\\"bar\\\"}\")\nclient := &amp;http.Client{}\nrsp, err = client.Do(req)\n</code></pre>\n\n<p>This isn't working but, I'm not sure what to do. Do I need to format that string differently?</p>\n\n<p>The header for the request is: </p>\n\n<pre><code>map[Accept:[*/*] Accept-Encoding:[gzip, deflate] User-Agent:[rest-client/2.0.2 (my_pc x86_64) ruby/2.4.2p198] Content-Length:[0] Content-Type:[application/x-www-form-urlencoded]]\n</code></pre>\n\n<p>The request dump (using httputil.DumpRequest) is:</p>\n\n<pre><code>PUT /my_path?foo=bar HTTP/1.1\nHost: localhost:8080\nAccept: */*\nAccept-Encoding: gzip, deflate\nContent-Length: 0\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: rest-client/2.0.2 (my_pc) ruby/2.4.2p198\n</code></pre>\n\n<p>It looks like I just need to put the info in the path as query parameter. Unless there is something else I should check. The content length is 0 so there is not body either. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1530074592, "post_id": 51050209, "comment_id": 89100023, "body": "You shouldn&#39;t have a defer call at the end of the function. Are you exiting the test early in the <code>&#47;&#47; do stuff</code>? Maybe post all your code to make things easier."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 1, "creation_date": 1530143772, "post_id": 51068166, "comment_id": 89135418, "body": "I see.  hmm unfortunately the file was created in a function and lf is out of scope.   It does explain why it&#39;s happening though."}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1530145440, "post_id": 51068166, "comment_id": 89135764, "body": "I modified the function that sets logging to also return the *os.File handle.  Then used your suggestion, but I had to reverse the order for the defer statements:  \tdefer os.Remove(logFile); defer lf.Close()"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1530163267, "post_id": 51068166, "comment_id": 89139487, "body": "You have to close file handle before removing the file. The file will not really be deleted until the last handle is closed."}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": true, "score": 1, "last_activity_date": 1530119424, "creation_date": 1530119424, "answer_id": 51068166, "question_id": 51050209, "link": "https://stackoverflow.com/questions/51050209/go-test-delete-logger-setlogging-log-file/51068166#51068166", "title": "Go Test delete logger.SetLogging log file", "body": "<p>Try calling:</p>\n\n<pre><code>lf.Close()\n</code></pre>\n\n<p>before </p>\n\n<pre><code>os.Remove(logFile)\n</code></pre>\n\n<p>or you can replace</p>\n\n<pre><code>defer os.Remove(logFile)\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>defer func() {\n  lf.Close()\n  os.Remove(logFile)\n}()\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 51068166, "answer_count": 1, "score": 1, "last_activity_date": 1530143672, "creation_date": 1530041573, "last_edit_date": 1530143672, "question_id": 51050209, "link": "https://stackoverflow.com/questions/51050209/go-test-delete-logger-setlogging-log-file", "title": "Go Test delete logger.SetLogging log file", "body": "<p>I have a TestCase for a function that defines a log file path, then sets logger, so that <code>log.*</code> statements are written to standard out and the log file:</p>\n\n<pre><code>lf, err := os.Create(logFile)\nmw := io.MultiWriter(os.Stdout, lf)\nlog.SetOutput(mw)\n</code></pre>\n\n<p>In my Test case I'm attempting to cleanup at the end, but it appears there is a lock on the file still, which means the Os.Remove() call is not working (or even returning an error)</p>\n\n<p>I've tried to SetOutput to nil as well as using a defer statement. </p>\n\n<pre><code>func TestSetLogging(t *testing.T) {\n// do stuff\n...\nlog.Println(\"this should be in logger file\")\n\n// cleanup\nlog.SetOutput(nil)\ndefer os.Remove(logFile)\n}\n</code></pre>\n\n<p>Yet, the logFile still appears on disk. How can I delete this file?</p>\n"}, {"tags": ["testing", "go", "integration-testing", "wildcard"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 1, "creation_date": 1530036770, "post_id": 51049101, "comment_id": 89089389, "body": "For the <i>alternative</i> part, I&#39;d recommend this great answer: <a href=\"https://stackoverflow.com/a/41407042/4636715\">stackoverflow.com/a/41407042/4636715</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1530037194, "post_id": 51049101, "comment_id": 89089560, "body": "Flags usually go before arguments. What happens when you swap <code>.&#47;...</code> and <code>-tags=integration</code>?"}, {"owner": {"reputation": 361, "user_id": 3990979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a9a388d68d9ac363855f8def3b8004?s=128&d=identicon&r=PG&f=1", "display_name": "Jorgese", "link": "https://stackoverflow.com/users/3990979/jorgese"}, "edited": false, "score": 0, "creation_date": 1530089425, "post_id": 51049101, "comment_id": 89106995, "body": "Hi Peter, I get the same result. I tried both and unfortunately, I posted it xD."}], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 1, "last_activity_date": 1530201295, "creation_date": 1530201295, "answer_id": 51087095, "question_id": 51049101, "link": "https://stackoverflow.com/questions/51049101/integration-tests-wildcard-ignore-tags/51087095#51087095", "title": "Integration tests, wildcard ignore tags", "body": "<p>Within your integration tests you can use:</p>\n\n<pre><code>func Test_SomeIntegration(t *testing.T) {\n    if testing.Short() {\n      t.Skip(\"skipping test\")\n    }\n    ...\n}\n</code></pre>\n\n<p>And then pass -short flag to the go test command to skip integration tests:</p>\n\n<pre><code>go test -short ./...\n</code></pre>\n"}], "owner": {"reputation": 361, "user_id": 3990979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a9a388d68d9ac363855f8def3b8004?s=128&d=identicon&r=PG&f=1", "display_name": "Jorgese", "link": "https://stackoverflow.com/users/3990979/jorgese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530201295, "creation_date": 1530036511, "last_edit_date": 1530096731, "question_id": 51049101, "link": "https://stackoverflow.com/questions/51049101/integration-tests-wildcard-ignore-tags", "title": "Integration tests, wildcard ignore tags", "body": "<p>I would like to separate my integration tests from the unit tests. I have read that I can do it including tags in the test file:</p>\n\n<pre><code>// +build integration\n</code></pre>\n\n<p>On the other hand, I select all the packages from my project by using wildcards <code>./...</code></p>\n\n<p>Unfortunately, I have problems, tags are ignored because of the wildcard.</p>\n\n<pre><code>go test ./... -tags=integration\n</code></pre>\n\n<p>or</p>\n\n<pre><code>go test -tags=integration ./...\n</code></pre>\n\n<p>Do you have any solution or alternative to it?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1530036034, "post_id": 51048961, "comment_id": 89089084, "body": "I believe you&#39;re looking for <code>Type.Elem()</code>."}, {"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530036507, "post_id": 51048961, "comment_id": 89089289, "body": "That&#39;s it, thanks! If you write that as an answer, I&#39;ll accept it"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1530036790, "creation_date": 1530036790, "answer_id": 51049162, "question_id": 51048961, "link": "https://stackoverflow.com/questions/51048961/removing-a-pointer-from-reflect-type/51049162#51049162", "title": "Removing a pointer from reflect.Type", "body": "<p>I believe you're looking for <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>Type.Elem()</code></a>:</p>\n\n<blockquote>\n  <p>Elem returns a type's element type.</p>\n</blockquote>\n\n<p>In the case of a pointer, the \"element type\" is the type the pointer points to.</p>\n\n<pre><code>func foo(x interface{}) {\n    typ := reflect.TypeOf(x)\n    fmt.Printf(\"%v\", typ) // prints **Foo\n    realType := typ.Elem()\n    fmt.Printf(\"%v\", realType) // prints *Foo\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/7Vx58ASPZQz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7Vx58ASPZQz</a></p>\n"}], "owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 51049162, "answer_count": 1, "score": 0, "last_activity_date": 1530036790, "creation_date": 1530035882, "question_id": 51048961, "link": "https://stackoverflow.com/questions/51048961/removing-a-pointer-from-reflect-type", "title": "Removing a pointer from reflect.Type", "body": "<p>I have a <code>reflect.Type</code> that contains a double-pointer to a struct. I'd like to be able to remove one level of indirection to have a pointer to the struct. Is this possible? For example, I'd like to do this:</p>\n\n<pre><code>func foo(x interface{}) {\n    typ := reflect.TypeOf(x)\n    fmt.Printf(\"%v\", typ) // prints **Foo\n    realType := typ.PointsTo()\n    fmt.Printf(\"%v\", typ) // prints *Foo\n}\n</code></pre>\n\n<p>But as far as I can see, this functionality does not exist. There is an <code>Indirect</code> function that operates on <code>Value</code>s, but I can't see anything similar that works on <code>Type</code>s.</p>\n"}, {"tags": ["go", "ethereum", "solidity", "abi", "contract"], "comments": [{"owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "edited": false, "score": 0, "creation_date": 1530529730, "post_id": 51048954, "comment_id": 89253698, "body": "Can you provide the smart contract source code?"}, {"owner": {"reputation": 1973, "user_id": 2056426, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Ge8I5.png?s=128&g=1", "display_name": "delos", "link": "https://stackoverflow.com/users/2056426/delos"}, "edited": false, "score": 0, "creation_date": 1553884524, "post_id": 51048954, "comment_id": 97566342, "body": "@BigHead I&#39;m running into the same issue, did you manage to solve this?"}], "owner": {"reputation": 53, "user_id": 9996012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6b529075e70c01f30c471a32e8e0095?s=128&d=identicon&r=PG&f=1", "display_name": "BigHead", "link": "https://stackoverflow.com/users/9996012/bighead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 386, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1530035842, "creation_date": 1530035842, "question_id": 51048954, "link": "https://stackoverflow.com/questions/51048954/getting-error-when-calling-method-on-ethereum-smart-contract-abi-unmarshalling", "title": "Getting Error when calling method on ethereum smart contract (abi: unmarshalling empty output)", "body": "<p>I am using Go to interact with an ethereum smart contract hosted on the rinkby test network and get the following error when executing a method on the contract:\n\"abi: unmarshalling empty output\"</p>\n\n<p>Do you have any idea what could be causing this?</p>\n\n<p>This is my code for instantiating the contract and calling the method.Creating the contract does not return any errors. I've used abigen to generate the go-binding for the rpc calls. </p>\n\n<pre><code>conn, err := ethclient.Dial(gethPath)\nif err != nil {\n    log.Fatalf(\"Failed to connect to the Ethereum client: %v\", err)\n    return false\n}\n\ncontract, err := NewTestContract(common.HexToAddress(contractAddress), conn)\nif err != nil {\n    log.Fatalf(\"Failed to instantiate contract: %v\", err)\n    return false\n}\ncontract.someExistingMethod();\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530035555, "post_id": 51048852, "comment_id": 89088809, "body": "To solve what? What issue did you run into?"}, {"owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530035675, "post_id": 51048852, "comment_id": 89088874, "body": "sorry @Adrian I forget, I update the issue now, hahaha :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1530035851, "post_id": 51048852, "comment_id": 89088976, "body": "I don&#39;t think you can perform arithmetic in templates, you&#39;d have to write a user function. Or you could get rid of all the template logic and <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-child\" rel=\"nofollow noreferrer\">just do it in CSS</a>."}, {"owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530036014, "post_id": 51048852, "comment_id": 89089070, "body": "@Adrian Is there any alternative template library in <b>golang</b> make me to do these stuff?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530036057, "post_id": 51048852, "comment_id": 89089097, "body": "Recommendations for third-party libraries are off-topic for Stack Overflow."}, {"owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530036149, "post_id": 51048852, "comment_id": 89089146, "body": "Is it illegal here for the recommendations, even it could be very helpful!"}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 1, "creation_date": 1530036269, "post_id": 51048852, "comment_id": 89089197, "body": "I guess you can try opening an issue on the GitHub page. This one looks like your case, but complaining for the <code>=</code> operand. <a href=\"https://github.com/golang/go/issues/10608\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/10608</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1530036381, "post_id": 51048852, "comment_id": 89089244, "body": "It doesn&#39;t matter how helpful you might find a recommendation. <a href=\"https://stackoverflow.com/help/on-topic\">Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.</a>"}, {"owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "edited": false, "score": 0, "creation_date": 1530036683, "post_id": 51048852, "comment_id": 89089359, "body": "Thanks guys for this enlightenment. &lt;3"}, {"owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "edited": false, "score": 0, "creation_date": 1530037530, "post_id": 51048852, "comment_id": 89089712, "body": "I created a new issue here <a href=\"https://github.com/golang/go/issues/26068\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/26068</a>"}], "answers": [{"tags": [], "owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "is_accepted": true, "score": 2, "last_activity_date": 1530066778, "creation_date": 1530066778, "answer_id": 51053744, "question_id": 51048852, "link": "https://stackoverflow.com/questions/51048852/how-to-do-if-else-conditions-inside-loop-in-golang-templates/51053744#51053744", "title": "How to do IF/ELSE conditions inside LOOP in golang templates?", "body": "<p>You can't use operators like +, -, *, /, or % in templates, unfortunately. Instead you have to write custom functions and use a funcMap to bring them into your template.</p>\n\n<p>Here's an example on the Go Playground that detects even integers applied to a slightly modified version of your template text.</p>\n\n<p><a href=\"https://play.golang.org/p/LWEhE_TI31o\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LWEhE_TI31o</a></p>\n"}], "owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 0, "accepted_answer_id": 51053744, "answer_count": 1, "score": 0, "last_activity_date": 1530066778, "creation_date": 1530035435, "last_edit_date": 1530035649, "question_id": 51048852, "link": "https://stackoverflow.com/questions/51048852/how-to-do-if-else-conditions-inside-loop-in-golang-templates", "title": "How to do IF/ELSE conditions inside LOOP in golang templates?", "body": "<p>I tried to do this test to figure out how to make conditions like this:</p>\n\n<pre><code>&lt;h1&gt;Country Index&lt;/h1&gt;\n\n&lt;style&gt;\n.odd{\n    background: orange;\n    color: black;\n    font-size: 1.5em;\n}\n.even{\n    background: rgb(0, 121, 235);\n    color: white;\n    font-size: 1.5em;\n}\n&lt;/style&gt;\n\n&lt;ul&gt;\n    {{ range $index, $item := .Tee }}\n        {{ if $index % 2 == 0 }}\n            &lt;li class=\"even\"&gt;{{ $index }} - {{ $item }}&lt;/li&gt;\n        {{ else }}\n            &lt;li class=\"odd\"&gt;{{ $index }} - {{ $item }}&lt;/li&gt;\n        {{ end }}\n    {{ end }}\n&lt;/ul&gt;\n</code></pre>\n\n<p>I got this error \"<strong>unexpected \"%\" in operand</strong>\".</p>\n\n<p>Any suggestions to solve this?</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530033346, "post_id": 51048245, "comment_id": 89087694, "body": "Is GetData called multiple times?"}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530033671, "post_id": 51048245, "comment_id": 89087863, "body": "Yes, I have a function that checks for a regex match in the buffer, if no match is found and the timeout hasn&#39;t occurred it calls GetData again."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530036267, "post_id": 51048245, "comment_id": 89089196, "body": "Every call to GetData starts a goroutine to read the connection and those goroutines can be left hanging when GetData returns.  These goroutines will eventual read data, but the data will be ignored.  Describe the higher level problem you are trying to solve.  Are you call regex match on s.Buffer until match is found or timeout?"}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530037270, "post_id": 51048245, "comment_id": 89089591, "body": "The main problem is that I never get any new data after the initial call to GetData and I&#39;m guessing it has something to do with my go routines and use of channels. Yes I check s.Buffer to see if it matches some regex or timeout if no match is found in a reasonable amount of time."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 4902910, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3QnTwzmObQk/AAAAAAAAAAI/AAAAAAAAGuE/BEE5Pn0GO9Y/photo.jpg?sz=128", "display_name": "Roman Dodin", "link": "https://stackoverflow.com/users/4902910/roman-dodin"}, "edited": false, "score": 0, "creation_date": 1618554931, "post_id": 51049828, "comment_id": 118640982, "body": "in this example, what will cleanup the goroutine started with <code>go s.Reader()</code> if it blocks on <code>n, err := s.Stdout.Read(data)</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 53, "user_id": 4902910, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3QnTwzmObQk/AAAAAAAAAAI/AAAAAAAAGuE/BEE5Pn0GO9Y/photo.jpg?sz=128", "display_name": "Roman Dodin", "link": "https://stackoverflow.com/users/4902910/roman-dodin"}, "edited": false, "score": 0, "creation_date": 1618555313, "post_id": 51049828, "comment_id": 118641112, "body": "@RomanDodin The call to <code>s.Stdout.Read</code> returns immediately with an error when the application closes the underlying network connection.  How that happens is outside the scope of the question."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1530039761, "creation_date": 1530039761, "answer_id": 51049828, "question_id": 51048245, "link": "https://stackoverflow.com/questions/51048245/reading-data-from-ssh-session-golang/51049828#51049828", "title": "Reading Data from SSH Session Golang", "body": "<p>Start a single reader goroutine for the session. This goroutine reads from the session and sends data to a channel.</p>\n\n<p>In the main goroutine, select in a loop with cases for data received and timeout.  Process each case as appropriate.</p>\n\n<pre><code>type SSHLib struct {\n    Stdout io.Reader\n    Buffer string\n    Data   chan string  // &lt;-- Add this member\n}\n\n// New creates a new SSHLib. This example shows the code \n// relevant to reading stdout only. \nfunc New() *SSHLib {\n    s := &amp;SSHLib{Data: make(chan string)}\n    go s.Reader()\n    return s\n}\n\n// Reader reads data from stdout in a loop.\nfunc (s *SSHLib) Reader() {\n    var data = make([]byte, 1024)\n    for {\n        n, err := s.Stdout.Read(data)\n        if err != nil {\n            // Handle error\n            return\n        }\n        s.Data &lt;- string(data[:n])\n    }\n}\n\n// GetData receives data until regexp match or timeout.\nfunc (s *SSHLib) GetData() {\n    t := time.NewTimer(time.Second)\n    defer t.Stop()\n    for {\n        select {\n        case d := &lt;-s.Data:\n            s.Buffer += d\n            // Check for regexp match in S.Buffer\n        case &lt;-t.C:\n            // Handle timeout\n            return\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 51049828, "answer_count": 1, "score": 0, "last_activity_date": 1530039761, "creation_date": 1530033085, "question_id": 51048245, "link": "https://stackoverflow.com/questions/51048245/reading-data-from-ssh-session-golang", "title": "Reading Data from SSH Session Golang", "body": "<p>I posted a similar question <a href=\"https://stackoverflow.com/questions/51046139/reading-data-from-socket-golang/51046333?noredirect=1#comment89085103_51046333\">here</a> for reading from a telnet session.</p>\n\n<p>I am trying to read data from an SSH session in golang. I wrote the following functions to try to accomplish this.</p>\n\n<p>I was running into an issue where I was trying to read from stdout and it was empty and it caused my program to lock. To try to work around this I wrote BufferSocketData, it checks the channel ReadDataFromSocket is supposed to append to and if it has data it adds it to the buffer. If after 1 second it still hasn't received any data it stops the read.</p>\n\n<p>This isn't working correctly though and I'm unsure why. Only the first read gets new data subsequent reads return an empty string even if there is data in the buffer.</p>\n\n<p>In my previous question I was able to use SetReadDeadline to limit the amount of time reading from the socket, is there something similar I can use with an SSH session? or do I need to use a different strategy all together?</p>\n\n<pre><code>/*\nReadDataFromSocket - Attempts to read any data in the socket.\n*/\nfunc ReadDataFromSocket(sock io.Reader, c chan string) {\n    var recvData = make([]byte, 1024)\n    var numBytes, _ = sock.Read(recvData)\n    c &lt;- string(recvData[:numBytes])\n}\n\n/*\nBufferSocketData - Read information from the socket and store it in the buffer.\n*/\nfunc (s *SSHLib) BufferSocketData(inp chan string, out chan string) {\n    var data string\n    var timeout int64 = 1000 // 1 second timeout.\n    var start = utils.GetTimestamp()\n\n    for utils.GetTimestamp()-start &lt; timeout {\n        select {\n        case data = &lt;-inp:\n        default:\n        }\n        if data != \"\" {\n            break\n        }\n    }\n    out &lt;- data\n}\n\n/*\nGetData - Start goroutines to get and buffer data.\n*/\nfunc (s *SSHLib) GetData() {\n    var sockCh = make(chan string)\n    var buffCh = make(chan string)\n\n    go ReadDataFromSocket(s.Stdout, sockCh)\n    go s.BufferSocketData(sockCh, buffCh)\n\n    var data = &lt;-buffCh\n\n    if data != \"\" {\n        s.Buffer += data\n    }\n}\n</code></pre>\n\n<p>Please let me know if you need any other information.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 5, "creation_date": 1530031250, "post_id": 51047624, "comment_id": 89086621, "body": "Welcome to Stack Overflow. Please read the <a href=\"https://stackoverflow.com/tour\">About</a> and <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> pages soon.  Please don&#39;t post images of text \u2014 include the text as text.  For tables like the one in the first image (I&#39;ve not looked at the others), copy&#39;n&#39;paste the text into the SO editor window, then select it, and use the <b><code>{}</code></b> button above the edit box to indent it as code.  (The icing on the cake is to put a line <code>&lt;!-- language: lang-none --&gt;</code> on a line on its own with a blank line before and after to avoid the table being marked up as text.  That is entirely optional, though.)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1530033163, "post_id": 51047624, "comment_id": 89087600, "body": "Your question is entirely unreadable, due to the images of text. Copy and paste the <i>relevant</i> text directly into the question instead."}, {"owner": {"reputation": 137, "user_id": 9995664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AkRhM.jpg?s=128&g=1", "display_name": "Anque", "link": "https://stackoverflow.com/users/9995664/anque"}, "edited": false, "score": 0, "creation_date": 1530033792, "post_id": 51047624, "comment_id": 89087920, "body": "edited. pls, read again it :)"}, {"owner": {"reputation": 137, "user_id": 9995664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AkRhM.jpg?s=128&g=1", "display_name": "Anque", "link": "https://stackoverflow.com/users/9995664/anque"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530035327, "post_id": 51047624, "comment_id": 89088697, "body": "@peterSO, thanks a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 9995664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AkRhM.jpg?s=128&g=1", "display_name": "Anque", "link": "https://stackoverflow.com/users/9995664/anque"}, "edited": false, "score": 0, "creation_date": 1530035269, "post_id": 51048683, "comment_id": 89088660, "body": "wow, it&#39;s almost solved my problem. but now, i have the list of books, each of which have NOT ALL selected tags, but at least 1. i need books with ALL selected tags)"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 137, "user_id": 9995664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AkRhM.jpg?s=128&g=1", "display_name": "Anque", "link": "https://stackoverflow.com/users/9995664/anque"}, "edited": false, "score": 0, "creation_date": 1530035677, "post_id": 51048683, "comment_id": 89088878, "body": "The usual approach is to add a <code>having count(*) = length_of_tags</code> clause."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 1, "last_activity_date": 1530035322, "last_edit_date": 1530035322, "creation_date": 1530034713, "answer_id": 51048683, "question_id": 51047624, "link": "https://stackoverflow.com/questions/51047624/how-to-and-operator-for-all-elements-of-list/51048683#51048683", "title": "How to &quot;and&quot; operator for all elements of list?", "body": "<p>Something like this:</p>\n\n<pre><code>gotoboox.tags.title IN ('Crime', 'Comedia')\n</code></pre>\n\n<p>is, more or less, a short way to write:</p>\n\n<pre><code>gotoboox.tags.title = 'Crime' or gotoboox.tags.title = 'Comedia'\n</code></pre>\n\n<p>so you don't want to supply an array for the placeholder in <code>IN ($1)</code> unless <code>tags.title</code> is itself an array (which it isn't).</p>\n\n<p>If you want to pass a slice for the placeholder and use <code>pq.Array</code>, you want to use <a href=\"https://www.postgresql.org/docs/current/static/functions-comparisons.html#id-1.5.8.28.16\" rel=\"nofollow noreferrer\"><code>= ANY(array)</code></a> in the SQL:</p>\n\n<pre><code>query := `... WHERE gotoboox.tags.title = any ($1) ...`\nrows, err := p.Db.Query(query, pq.Array(tags))\n</code></pre>\n\n<p>Alternatively, if <code>tags</code> had <code>n</code> elements then you could build a string like:</p>\n\n<pre><code>\"$1,$2,...,$n\"\n</code></pre>\n\n<p><code>fmt.Sprintf</code> that into your SQL (which is perfectly safe since you know exactly what's in the strings):</p>\n\n<pre><code>p := placeholders(len(tags))\nq := fmt.Sprintf(\"select ... where gotoboox.tags.title in (%s) ...\", p)\n</code></pre>\n\n<p>and then supply values for all those placeholders when you query:</p>\n\n<pre><code>rows, err := p.DB.Query(q, tags...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 236, "user_id": 9985034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d58144fa4aa6ddd3b3796c3ebaccf14c?s=128&d=identicon&r=PG&f=1", "display_name": "Sabari", "link": "https://stackoverflow.com/users/9985034/sabari"}, "is_accepted": false, "score": 0, "last_activity_date": 1530035719, "creation_date": 1530035719, "answer_id": 51048924, "question_id": 51047624, "link": "https://stackoverflow.com/questions/51047624/how-to-and-operator-for-all-elements-of-list/51048924#51048924", "title": "How to &quot;and&quot; operator for all elements of list?", "body": "<p>Below query will results in books with all selected tags.</p>\n\n<pre>\nselect \n  b.id, \n  b.title \nfrom \n  books b \n  join books_tags bt on bt.book_id = b.id \n  join tags t on bt.tag_id = t.id \nwhere \n  t.title = any($1) \ngroup by \n  b.id, \n  b.title \nhaving \n  count(*)= cardinality($1)\n\n</pre>\n"}], "owner": {"reputation": 137, "user_id": 9995664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AkRhM.jpg?s=128&g=1", "display_name": "Anque", "link": "https://stackoverflow.com/users/9995664/anque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1530038965, "accepted_answer_id": 51048683, "answer_count": 2, "score": -2, "last_activity_date": 1530035719, "creation_date": 1530030616, "last_edit_date": 1530034716, "question_id": 51047624, "link": "https://stackoverflow.com/questions/51047624/how-to-and-operator-for-all-elements-of-list", "closed_reason": "Not suitable for this site", "title": "How to &quot;and&quot; operator for all elements of list?", "body": "<p>i have the books with different tags (crime, fantastic, dramatic etc.).\nthat's my sql-code:</p>\n\n<pre><code>query := `\n    SELECT gotoboox.books.id, gotoboox.books.title \n    FROM gotoboox.books \n    LEFT JOIN gotoboox.books_tags ON gotoboox.books.id = gotoboox.books_tags.book_id \n    LEFT JOIN gotoboox.tags ON gotoboox.books_tags.tag_id = gotoboox.tags.id \n    WHERE gotoboox.tags.title IN ($1) \n    GROUP BY gotoboox.books.title, gotoboox.books.id\n`\nrows, err := p.Db.Query(query, pq.Array(tags))\n</code></pre>\n\n<p>but i have got empty result.\nfor example, if i write </p>\n\n<pre><code>..WHERE gotoboox.tags.title IN ('Crime', 'Comedia').. // WITHOUT pg.Array()\n</code></pre>\n\n<p>its okay.</p>\n\n<p>so, i need pass correctly my pq.Array(tags) to the 'where in'-statement.</p>\n\n<p><strong>P.S.</strong> tags is a slice of strings. \"tags []string\"</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 919, "user_id": 848538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bafbc91c0f9f74f8291ee738ec9fb1b?s=128&d=identicon&r=PG", "display_name": "jittakal", "link": "https://stackoverflow.com/users/848538/jittakal"}, "edited": false, "score": 0, "creation_date": 1530028070, "post_id": 51046557, "comment_id": 89084821, "body": "You are closing Db connection within Open function itself, how can it is available for further operation? <code>defer Db.Close()</code>"}, {"owner": {"reputation": 919, "user_id": 848538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bafbc91c0f9f74f8291ee738ec9fb1b?s=128&d=identicon&r=PG", "display_name": "jittakal", "link": "https://stackoverflow.com/users/848538/jittakal"}, "edited": false, "score": 0, "creation_date": 1530028651, "post_id": 51046557, "comment_id": 89085185, "body": "<a href=\"https://play.golang.org/p/IgA1hRc_2xt\" rel=\"nofollow noreferrer\">Without major changes Open function</a>"}, {"owner": {"reputation": 138, "user_id": 4289609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8c6bf56348316e009d7d33b8e7cebdf?s=128&d=identicon&r=PG", "display_name": "igniz87", "link": "https://stackoverflow.com/users/4289609/igniz87"}, "reply_to_user": {"reputation": 919, "user_id": 848538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bafbc91c0f9f74f8291ee738ec9fb1b?s=128&d=identicon&r=PG", "display_name": "jittakal", "link": "https://stackoverflow.com/users/848538/jittakal"}, "edited": false, "score": 0, "creation_date": 1530029513, "post_id": 51046557, "comment_id": 89085676, "body": "ah, i see. got it. thanks @jittakal ."}], "answers": [{"tags": [], "owner": {"reputation": 138, "user_id": 4289609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8c6bf56348316e009d7d33b8e7cebdf?s=128&d=identicon&r=PG", "display_name": "igniz87", "link": "https://stackoverflow.com/users/4289609/igniz87"}, "is_accepted": true, "score": 3, "last_activity_date": 1530419550, "creation_date": 1530419550, "answer_id": 51120421, "question_id": 51046557, "link": "https://stackoverflow.com/questions/51046557/gorm-db-connection-on-other-package/51120421#51120421", "title": "GORM DB Connection on other package", "body": "<p>As start learning GO, usually we put everything on single main.go file, and we think to split the code to multiple files.</p>\n\n<p>That is the time Dependency <strong>Injection comes</strong> to play.</p>\n\n<p>we can create something like this <strong>Env</strong> to store the handler.</p>\n\n<pre><code>type Env struct {\n    db *sql.DB\n    logger *log.Logger\n    templates *template.Template\n}\n</code></pre>\n\n<p>and create something like this in <strong>models/db.go</strong></p>\n\n<pre><code>package models\n\nimport (\n    \"database/sql\"\n    _ \"github.com/lib/pq\"\n)\n\nfunc NewDB(dataSourceName string) (*sql.DB, error) {\n    db, err := sql.Open(\"postgres\", dataSourceName)\n    if err != nil {\n        return nil, err\n    }\n    if err = db.Ping(); err != nil {\n        return nil, err\n    }\n    return db, nil\n}\n</code></pre>\n\n<p><strong>main.go</strong> files</p>\n\n<pre><code>package main\n\nimport (\n    \"namastra/gin/models\"\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Env struct {\n    db *sql.DB\n}\n\nfunc main() {\n    db, err := models.NewDB(\"postgres://user:pass@localhost/bookstore\")\n    if err != nil {\n        log.Panic(err)\n    }\n    env := &amp;Env{db: db}\n\n    http.HandleFunc(\"/peoples\", env.peoplesIndex)\n    http.ListenAndServe(\":3000\", nil)\n}\n\nfunc (env *Env) peoplesIndex(w http.ResponseWriter, r *http.Request) {\n   # ...\n}\n</code></pre>\n\n<p>and in <strong>models/people.go</strong></p>\n\n<pre><code>package models\n\nimport \"database/sql\"\n\ntype Book struct {\n    Isbn   string\n    Title  string\n    Author string\n    Price  float32\n}\n\nfunc AllPeoples(db *sql.DB) ([]*People, error) {\n    rows, err := db.Query(\"SELECT * FROM peoples\")\n    if err != nil {\n        return nil, err\n    }\n    defer rows.Close()\n\n    # ... ommited for simplicity\n}\n</code></pre>\n\n<p>you can read the full code &amp; explanation in <a href=\"https://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">Alex Edwards post </a></p>\n"}], "owner": {"reputation": 138, "user_id": 4289609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8c6bf56348316e009d7d33b8e7cebdf?s=128&d=identicon&r=PG", "display_name": "igniz87", "link": "https://stackoverflow.com/users/4289609/igniz87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5097, "favorite_count": 0, "accepted_answer_id": 51120421, "answer_count": 1, "score": 2, "last_activity_date": 1530419612, "creation_date": 1530027009, "last_edit_date": 1530419612, "question_id": 51046557, "link": "https://stackoverflow.com/questions/51046557/gorm-db-connection-on-other-package", "title": "GORM DB Connection on other package", "body": "<p>I start learning Go, reading about pointers, and want to split my database connection , and handler function for API. Already tried myself, by following this <a href=\"https://stackoverflow.com/questions/50751788/how-to-import-gorm-db-connection-from-another-file-or-package\">solution</a> , but when i trying to read data, i am having this error </p>\n\n<p><strong>[2018-06-26 21:59:45]  sql: database is closed</strong>\nthis is my source code.</p>\n\n<p>db.go</p>\n\n<pre><code>package db\n\nimport (\n\"fmt\"\n\n\"github.com/jinzhu/gorm\"\n\"github.com/joho/godotenv\"\n\n\"os\"\n)\n\nvar Db *gorm.DB\n\nfunc Open() error {\n\n  var err error\n  _ = godotenv.Load(\".env\")\n\n  dbType := os.Getenv(\"DB_TYPE\")\n  dbConnString := os.Getenv(\"DB_CONN_STRING\")\n\n  Db, err = gorm.Open(dbType, dbConnString)\n  if err != nil {\n    fmt.Println(err)\n  }\n  Db.LogMode(true)\n  defer Db.Close()\n\n  return err\n}\n\nfunc Close() error {\n    return Db.Close()\n}\n</code></pre>\n\n<p>person.go</p>\n\n<pre><code>package model\n\nimport (\n    \"github.com/jinzhu/gorm\"\n    \"github.com/gin-gonic/gin\"\n    \"fmt\"\n    \"namastra/gin/result\"\n    \"namastra/gin/db\"\n)\n\ntype Person struct {\n    gorm.Model\n    FirstName string `json:\u201dfirstname\u201d`\n    LastName  string `json:\u201dlastname\u201d`\n}\n\n/*var db *gorm.DB\nvar err error*/\n\nfunc GetPeople(c *gin.Context) {\n\n    var people []result.Person\n    if err := db.Db.Select(\"ID,first_name,last_name\").Find(&amp;people).Error; err != nil {\n        c.AbortWithStatus(404)\n        fmt.Println(err)\n    } else {\n        c.JSON(200, people)\n    }\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"namastra/gin/handler\"\n    \"namastra/gin/model\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/adam-hanna/jwt-auth/jwt\"\n    \"github.com/gin-gonic/gin\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n\n    \"namastra/gin/db\"\n)\n\nfunc main() {\nif err := db.Open(); err != nil {\n    // handle error\n    panic(err)\n}\ndefer db.Close()\n\nrouter := gin.Default()\nrouter.Use(gin.Recovery())\nprivate := router.Group(\"/auth\")\n\n....(ommited)\n\nrouter.GET(\"/\", gin.WrapH(regularHandler))\nrouter.GET(\"/people/\", model.GetPeople)\nrouter.Run(\"127.0.0.1:3000\")\n}\n</code></pre>\n\n<p>Sorry for my bad english, any kind of help is appreciated.</p>\n\n<p>thank you.</p>\n\n<p>edit1: <strong>case closed.</strong></p>\n\n<p>solution is by removing </p>\n\n<pre><code>defer Db.Close()\n</code></pre>\n\n<p>from db.go.</p>\n\n<p>edi2: <strong>update some knowledge i learn by working in go project</strong></p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1530026343, "post_id": 51046308, "comment_id": 89083775, "body": "I&#39;ve also tried using a <code>*Foo</code> as the parameter to <code>constructFoo</code>, but that does not work either, since <code>**Foo_impl</code> isn&#39;t a <code>*Foo</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1530030685, "post_id": 51046308, "comment_id": 89086337, "body": "You can&#39;t pass <code>nil</code> pointers and somehow initialized them, since it&#39;s the pointer value that&#39;s nil. Like you said, you need a <code>**Foo_impl</code> if you want to initialize the pointer itself. Why is it a problem to write separate constructors? If there is no real constructor logic and it can be done in a single function, why can&#39;t you use struct literals or values like most code?"}, {"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530031070, "post_id": 51046308, "comment_id": 89086530, "body": "I&#39;m trying to write a function that will initialize all of the mocks that I need for a test. I have a lot of mock structs, and I don&#39;t want to write 20 identical constructors for all of them. They all need to be initialized in exactly the same way, so I thought this would make things easier."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530032416, "post_id": 51046308, "comment_id": 89087204, "body": "@NateMara you can pass an interface which will accept any struct and then get its underlying type."}], "answers": [{"comments": [{"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1530029245, "post_id": 51046575, "comment_id": 89085534, "body": "In reality, I&#39;m trying to create a varadic function that accepts multiple nil pointers to <code>Foo</code>s of different concrete types (around 20 different types), and initialize all of them. So I&#39;m doing this to try and avoid writing the 20 separate constructors that would be required."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1530043401, "post_id": 51046575, "comment_id": 89092157, "body": "Looks like it&#39;s faster to just write them ;)) Go ain&#39;t no Lisp"}, {"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1530043477, "post_id": 51046575, "comment_id": 89092197, "body": "I was able to make a function that did what I wanted. It&#39;s not pretty, but it works. <a href=\"https://stackoverflow.com/a/51049680/3204951\">stackoverflow.com/a/51049680/3204951</a>"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 1, "creation_date": 1530083860, "post_id": 51046575, "comment_id": 89103838, "body": "Good for you, although I would raise an ideological argument that using <code>reflect</code> for your case is an overkill (and a runtime perf penalty), as I said Go is not self-reflecting-self-modifying Lisp and really the Go way is to simply write 20 constructors, or if you have 120 - just generate them, not necessarily by <code>go generate</code>, maybe by shell/awk/Python oneliner. I am sure Go creators, esp. Ken, would agree with me. :]"}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 3, "last_activity_date": 1530027055, "creation_date": 1530027055, "answer_id": 51046575, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51046575#51046575", "title": "Indirect of interface type in Go", "body": "<p>But why can't you be more idiomatic and do</p>\n\n<pre><code>func constructFoo() Foo {\n    return &amp;Foo_impl{} \n}\n</code></pre>\n\n<p>then, in main:</p>\n\n<pre><code>func main() {\n    fmt.Println(constructFoo().Foo(10))\n}\n</code></pre>\n\n<p>?</p>\n\n<p>Also, there is <a href=\"https://medium.com/@cep21/what-accept-interfaces-return-structs-means-in-go-2fe879e25ee8\" rel=\"nofollow noreferrer\">accept interfaces, return structs</a> approach which may be interesting for you.</p>\n\n<p>Hope this helps a bit.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6789898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lJBzCnlI8qE/AAAAAAAAAAI/AAAAAAAAB-M/gYHIps2Lm6A/photo.jpg?sz=128", "display_name": "\u6797\u5b50\u7bc6", "link": "https://stackoverflow.com/users/6789898/%e6%9e%97%e5%ad%90%e7%af%86"}, "is_accepted": false, "score": 0, "last_activity_date": 1530028371, "creation_date": 1530028371, "answer_id": 51046978, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51046978#51046978", "title": "Indirect of interface type in Go", "body": "<p>In Go, if we have a type</p>\n\n<pre><code>type Foo_impl struct {}\n</code></pre>\n\n<p>We usually using</p>\n\n<pre><code>func NewFoo_impl() *Foo_impl\n</code></pre>\n\n<p>to create this instance of this structure(if need)</p>\n\n<p>There is no instance of the interface, we just say a type implement an interface or not.</p>\n\n<p>So your code can be</p>\n\n<pre><code>var x Foo\nx = NewFoo_impl()\n// or x = &amp;Foo_impl{}\n</code></pre>\n\n<p>About indirect the interface type, it's not hard to understand by knowing it just like <code>void*</code> in C.</p>\n\n<p>Dereference it won't return the type you want, in fact, the compiler also doesn't know how to deal with it. It became an incomplete type, so Go's decision is disallowing it.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1530035014, "last_edit_date": 1530035014, "creation_date": 1530033564, "answer_id": 51048373, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51048373#51048373", "title": "Indirect of interface type in Go", "body": "<p>Implementing an interface will help you to pass mock structs to your function and then using type assertion you can get the value of struct. Basically interface is the only way in which you can wrap your any type and pass it to the function and then using type assertions you can get the underlying value.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n)\n\ntype Foo interface {\n    Foo(int) int\n}\n\ntype Foo_impl struct {}\n\nfunc (f *Foo_impl) Foo(x int) int {\n    return x * 2\n}\n\nfunc main() {\n    var x *Foo_impl\n    constructFoo(x)\n}\n\nfunc constructFoo(x interface{}) {\n    fmt.Println(x.(interface{}).(*Foo_impl).Foo(10)) // dereference the type to call the function  on pointer receiver\n}\n</code></pre>\n\n<p>Also It is required to dereference the value of type struct passed to the constructor to call the method using pointer receiver.</p>\n\n<p>Check working code on <a href=\"https://play.golang.org/p/MpfEGzJHCy_N\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>In Golang <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Type assertions</a> is defined as: </p>\n\n<blockquote>\n  <p>For an expression x of interface type and a type T, the primary\n  expression</p>\n\n<pre><code>x.(T)\n</code></pre>\n  \n  <p>asserts that x is not nil and that the value stored in x is of type T.\n  The notation x.(T) is called a type assertion.</p>\n  \n  <p>More precisely, if T is not an interface type, x.(T) asserts that the\n  dynamic type of x is identical to the type T. In this case, T must\n  implement the (interface) type of x; otherwise the type assertion is\n  invalid since it is not possible for x to store a value of type T. If\n  T is an interface type, x.(T) asserts that the dynamic type of x\n  implements the interface T.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1530034624, "creation_date": 1530034624, "answer_id": 51048660, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51048660#51048660", "title": "Indirect of interface type in Go", "body": "<p>Here is a solution for your requirements, however a pointer of the type that is being passed to you constructor method can not be nil, one way to address it is to use default instance.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n)\n\n\nvar defaultFooImpl = &amp;Foo_impl{}\n\ntype Foo interface {\n    Foo(int) int\n}\n\ntype Foo_impl struct {\n    id int\n}\n\nfunc (f *Foo_impl) Foo(x int) int {\n    return x * 2\n}\n\n\n\nfunc main() {\n    var x *Foo_impl = defaultFooImpl\n    constructFoo(x)\n\n    fmt.Println(\"Hello, playground %v\", x)\n}\n\nfunc constructFoo(x Foo) {\n    switch value :=x.(type) {\n        case *Foo_impl:\n            *value = Foo_impl{2}\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1530035850, "creation_date": 1530035850, "answer_id": 51048956, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51048956#51048956", "title": "Indirect of interface type in Go", "body": "<p>Yet another approach with varadic function that accepts multiple nil pointers to Foo, </p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n)\n\ntype Foo interface {\n    Foo(int) int\n}\n\ntype Foo_impl struct {\n    id int\n}\n\nfunc (f *Foo_impl) Foo(x int) int {\n    return x * 2\n}\n\n\n\nfunc main() {\n    var x *Foo_impl\n    var x1 = []Foo{x}\n    constructFoo(x1...)\n\n\n    fmt.Println(\"Hello, playground %v\", x1[0])\n}\n\nfunc constructFoo(x ...Foo) {\n    for i, foo := range x {\n        switch  (foo).(type) {\n            case *Foo_impl:\n                x[i] = &amp;Foo_impl{2}\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "is_accepted": true, "score": 1, "last_activity_date": 1530039107, "creation_date": 1530039107, "answer_id": 51049680, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go/51049680#51049680", "title": "Indirect of interface type in Go", "body": "<p>I was able to write a function that did what I want</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Y interface {\n    SetX(int)\n}\n\ntype X struct {\n    test int\n}\n\nfunc (x *X) SetX(param int) {\n    x.test = param\n}\n\nfunc main() {\n    var x *X\n    y := foo(&amp;x)\n    y.SetX(12)\n    fmt.Printf(\"%+v\", x)\n}\n\nfunc foo(x interface{}) Y {\n    t := reflect.TypeOf(x)\n    pointerType := t.Elem()\n    realType := pointerType.Elem()\n\n    pointer := reflect.New(realType)\n    reflect.Indirect(reflect.ValueOf(x)).Set(pointer)\n\n    return pointer.Interface().(Y)\n}\n</code></pre>\n\n<p>The <code>foo</code> function can initialize any double pointer to a type that implements <code>Y</code>, and it returns the new instance as a <code>Y</code>.</p>\n"}], "owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3583, "favorite_count": 0, "accepted_answer_id": 51049680, "answer_count": 6, "score": 4, "last_activity_date": 1530039107, "creation_date": 1530026142, "question_id": 51046308, "link": "https://stackoverflow.com/questions/51046308/indirect-of-interface-type-in-go", "title": "Indirect of interface type in Go", "body": "<p>I'm trying to create a function that will create a new instance of an interface, and assign that instance to a variable that has the type of the interface. Here is a simple example program (which does not compile):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo interface {\n    Foo(int) int\n}\n\ntype Foo_impl struct {}\n\nfunc (f *Foo_impl) Foo(x int) int {\n    return x * 2\n}\n\nfunc main() {\n    var x *Foo_impl\n    constructFoo(x)\n\n    fmt.Println(\"Hello, playground\")\n}\n\nfunc constructFoo(x Foo) {\n    *x = Foo_impl{} // Blows up here - invalid indirect of x (type Foo)\n}\n</code></pre>\n\n<p>Is it possible via reflection to indirect an interface variable, and assign to the underlying value? If I were not using interfaces, I would do something like this,</p>\n\n<pre><code>func main() {\n    var x int\n    foo(&amp;x)\n    fmt.Printf(\"%d\\n\", x)\n}\n\nfunc foo(x *int) {\n    *x = 4\n}\n</code></pre>\n\n<p>And as expected, this will print out 4. The issue is that interface variables cannot be indirected in the normal way. Is there a way around this?</p>\n"}, {"tags": ["sockets", "go"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "edited": false, "score": 0, "creation_date": 1530027432, "post_id": 51046333, "comment_id": 89084457, "body": "This works perfectly. I have another function that attempts reads until a regex match is made or a timeout occurs so GetData performing a single read is exactly what I need. Thanks!"}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "edited": false, "score": 0, "creation_date": 1530027815, "post_id": 51046333, "comment_id": 89084682, "body": "You wouldn&#39;t happen to know how to do something similar with an SSH session object would you?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "edited": false, "score": 0, "creation_date": 1530028521, "post_id": 51046333, "comment_id": 89085103, "body": "A different approach is required for an SSH session object. Ask a new question about that."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "edited": false, "score": 0, "creation_date": 1530033113, "post_id": 51046333, "comment_id": 89087575, "body": "Wrote a new question <a href=\"https://stackoverflow.com/questions/51048245/reading-data-from-ssh-session-golang\">here</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1530026864, "last_edit_date": 1530026864, "creation_date": 1530026224, "answer_id": 51046333, "question_id": 51046139, "link": "https://stackoverflow.com/questions/51046139/reading-data-from-socket-golang/51046333#51046333", "title": "Reading Data from Socket Golang", "body": "<p>Use <a href=\"https://godoc.org/net#Conn.SetReadDeadline\" rel=\"nofollow noreferrer\">SetReadDeadline</a> to read data with a time limit:</p>\n\n<pre><code>func (tn *TelnetLib) GetData() {\n    tn.Conn.SetReadDeadline(time.Second)\n    recvData := make([]byte, 1024)\n    n, err := tn.Conn.Read(recvData)\n    if n &gt; 0 {\n       // do something with recvData[:n]\n    }\n    if e, ok := err.(interface{ Timeout() bool }); ok &amp;&amp; e.Timeout() {\n        // handle timeout\n    } else if err != nil {\n       // handle error\n    }\n}\n</code></pre>\n\n<p>Note that a single call Read may not read all data sent by the peer.  You may want to accumulate data by calling Read in a loop or call <a href=\"https://godoc.org/io#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull</a>.</p>\n"}], "owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3338, "favorite_count": 1, "accepted_answer_id": 51046333, "answer_count": 1, "score": 0, "last_activity_date": 1530026864, "creation_date": 1530025703, "question_id": 51046139, "link": "https://stackoverflow.com/questions/51046139/reading-data-from-socket-golang", "title": "Reading Data from Socket Golang", "body": "<p>I'm trying to read data from a telnet session in golang. I wrote the following functions in an attempt to accomplish this.</p>\n\n<p>Initially I was having an issue where I was reading from a socket with no data so it would lock and never return. BufferSocketData is my attempt to work around this issue as I can't know if there is data to read. The idea is it will wait 1 second before determining there is not data in the socket and return an empty string. </p>\n\n<p>GetData seems to work the first time there is new data in the buffer, but beyond that it gets no new data. I'm sure this has something to do with my use of goroutines and channels, I'm new to go and I'm sure I'm not using them correctly.</p>\n\n<p>Any ideas as to why my subsequent reads return no data?</p>\n\n<pre><code>/*\nReadDataFromSocket - Attempts to read any data in the socket.\n*/\nfunc ReadDataFromSocket(sock io.Reader, c chan string) {\n    var recvData = make([]byte, 1024)\n    var numBytes, _ = sock.Read(recvData)\n    c &lt;- string(recvData[:numBytes])\n}\n\n/*\nBufferSocketData - Read information from the socket and store it in the buffer.\n*/\nfunc (tn *TelnetLib) BufferSocketData(inp chan string, out chan string) {\n    var data string\n    var timeout int64 = 1000 // 1 second timeout.\n    var start = utils.GetTimestamp()\n\n    for utils.GetTimestamp()-start &lt; timeout {\n        select {\n        case data = &lt;-inp:\n        default:\n        }\n        if data != \"\" {\n            break\n        }\n    }\n    out &lt;- data\n}\n\n/*\nGetData - Start goroutines to get and buffer data.\n*/\nfunc (tn *TelnetLib) GetData() {\n    var sockCh = make(chan string)\n    var buffCh = make(chan string)\n\n    go ReadDataFromSocket(tn.Conn, sockCh)\n    go tn.BufferSocketData(sockCh, buffCh)\n\n    var data = &lt;-buffCh\n\n    if data != \"\" {\n        tn.Buffer += data\n    }\n}\n</code></pre>\n\n<p>Please let me know if you need any additional information.</p>\n"}, {"tags": ["web-services", "go", "swagger", "web-frameworks", "swagger-codegen"], "comments": [{"owner": {"reputation": 482, "user_id": 1246241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYQ8w.jpg?s=128&g=1", "display_name": "utx0_", "link": "https://stackoverflow.com/users/1246241/utx0"}, "edited": false, "score": 1, "creation_date": 1543469288, "post_id": 51045834, "comment_id": 93932591, "body": "What did you end up doing with this problem @ashish? I&#39;m in the same boat."}], "answers": [{"tags": [], "owner": {"reputation": 465, "user_id": 10633734, "user_type": "registered", "profile_image": "https://graph.facebook.com/2240338519333236/picture?type=large", "display_name": "Daniel Titkov", "link": "https://stackoverflow.com/users/10633734/daniel-titkov"}, "is_accepted": false, "score": 0, "last_activity_date": 1599349278, "creation_date": 1599349278, "answer_id": 63759457, "question_id": 51045834, "link": "https://stackoverflow.com/questions/51045834/how-to-use-golang-echo-web-framework-with-swagger-go/63759457#63759457", "title": "How to use golang echo web framework with swagger-go?", "body": "<p>Found this package: <a href=\"https://github.com/swaggo/echo-swagger\" rel=\"nofollow noreferrer\">https://github.com/swaggo/echo-swagger</a>\nMaybe it'll help. I'm going to use it though haven't tried yet.</p>\n"}], "owner": {"reputation": 5192, "user_id": 5246058, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/36299274b998e4730d3def882d84f7d6?s=128&d=identicon&r=PG&f=1", "display_name": "ashish singh", "link": "https://stackoverflow.com/users/5246058/ashish-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 620, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1599349278, "creation_date": 1530024758, "question_id": 51045834, "link": "https://stackoverflow.com/questions/51045834/how-to-use-golang-echo-web-framework-with-swagger-go", "title": "How to use golang echo web framework with swagger-go?", "body": "<p>i have setup a web server from existing <code>swagger.yml</code> using <a href=\"https://github.com/go-swagger/go-swagger\" rel=\"nofollow noreferrer\">go-swagger</a>\nwhich already gives me validations and routing for the apis</p>\n\n<p>I want to use <a href=\"https://echo.labstack.com/\" rel=\"nofollow noreferrer\">echo</a> web framework to develop this server futher, Is there a way to integrate these two so that i can use functionalities provided by both of them.</p>\n\n<p>Basically if i implement everything in echo from scratch i give up on validations and routing provided by go-swagger out of the box and will have to write not so dev friendly annotations on echo code(compared to swagger.yml)</p>\n\n<p>or any similar tool for echo ?</p>\n"}, {"tags": ["go", "streamwriter", "writer"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1530023543, "post_id": 51045256, "comment_id": 89081971, "body": "I guess you&#39;ll need yet another wrapper, that implements <code>io.WriterCloser</code>, prints out the data and delegates the rest to the wrapped writer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530023643, "post_id": 51045256, "comment_id": 89082039, "body": "Possible duplicates, writing to multiple io.Writers: <a href=\"https://stackoverflow.com/questions/36719525/how-to-log-messages-to-the-console-and-a-file-both-in-golang/36719588#36719588\" title=\"how to log messages to the console and a file both in golang\">stackoverflow.com/questions/36719525/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/45351208/read-contents-from-what-io-writer-writes/45351271#45351271\" title=\"read contents from what io writer writes\">stackoverflow.com/questions/45351208/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/48326997/how-to-pipe-stdout-from-os-exec-to-file-and-to-terminal/48327112#48327112\" title=\"how to pipe stdout from os exec to file and to terminal\">stackoverflow.com/questions/48326997/&hellip;</a>,"}, {"owner": {"reputation": 1707, "user_id": 1127809, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/swoRv.jpg?s=128&g=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/1127809/florian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530029402, "post_id": 51045256, "comment_id": 89085622, "body": "@JimB you are absolutely right, didn&#39;t find them before."}], "answers": [{"tags": [], "owner": {"reputation": 395, "user_id": 1100219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/783c3326adf4b1876a1a41eb8099fd23?s=128&d=identicon&r=PG", "display_name": "Alexander Davydov", "link": "https://stackoverflow.com/users/1100219/alexander-davydov"}, "is_accepted": true, "score": 2, "last_activity_date": 1530023859, "creation_date": 1530023859, "answer_id": 51045552, "question_id": 51045256, "link": "https://stackoverflow.com/questions/51045256/log-data-of-io-writer/51045552#51045552", "title": "Log Data of io.Writer", "body": "<p>You might want to take a look at <a href=\"https://golang.org/pkg/io/#MultiWriter\" rel=\"nofollow noreferrer\">MultiWriter</a> from io package: it creates a writer that duplicates its writes to all the provided writers, similar to the Unix tee(1) command.</p>\n"}], "owner": {"reputation": 1707, "user_id": 1127809, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/swoRv.jpg?s=128&g=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/1127809/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "closed_date": 1530030497, "accepted_answer_id": 51045552, "answer_count": 1, "score": 0, "last_activity_date": 1530024007, "creation_date": 1530023015, "question_id": 51045256, "link": "https://stackoverflow.com/questions/51045256/log-data-of-io-writer", "closed_reason": "Duplicate", "title": "Log Data of io.Writer", "body": "<p>I'd like to create a method that takes a \u00eco.Writer<code>and wraps a</code>cipher.StreamWriter` around, to encrypt the writer. For Debugging Reasons, I'd like to print out what data passes the writer. How do I achieve this?</p>\n\n<p>The Crypto Code is just placeholder, so fixed key, iv and so on is just for testing things out.</p>\n\n<pre><code>func NewEncryptionWriter(w io.Writer) io.WriteCloser {\n    key, _ := hex.DecodeString(\"6368616e676520746869732070617373\")\n    c, _ := aes.NewCipher(key)\n    iv := make([]byte, aes.BlockSize)\n    return &amp;cipher.StreamWriter{S: cipher.NewOFB(c, iv), W: w}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1530022215, "post_id": 51044828, "comment_id": 89081043, "body": "You forgot to call <code>tr.Next()</code> in your first example, so there&#39;s nothing yet to read."}], "answers": [{"comments": [{"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "edited": false, "score": 0, "creation_date": 1530023165, "post_id": 51045047, "comment_id": 89081702, "body": "Thanks, sir, I got the bytes from Buffer.Bytes() <a href=\"https://play.golang.org/p/JJVI0Wyx3l7\" rel=\"nofollow noreferrer\">playground 3</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1530022412, "creation_date": 1530022412, "answer_id": 51045047, "question_id": 51044828, "link": "https://stackoverflow.com/questions/51044828/ioutil-readall-gives-0-bytes-for-tar-reader/51045047#51045047", "title": "ioutil.ReadAll gives 0 bytes for tar reader", "body": "<p>The program writes the archive to a <a href=\"https://godoc.org/bytes#Buffer\" rel=\"nofollow noreferrer\">bytes.Buffer</a>.  Call <a href=\"https://godoc.org/bytes#Buffer.Bytes\" rel=\"nofollow noreferrer\">Buffer.Bytes()</a> to get the archive bytes.</p>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 51045047, "answer_count": 1, "score": 0, "last_activity_date": 1530022412, "creation_date": 1530021780, "question_id": 51044828, "link": "https://stackoverflow.com/questions/51044828/ioutil-readall-gives-0-bytes-for-tar-reader", "title": "ioutil.ReadAll gives 0 bytes for tar reader", "body": "<p>I create a tar file in memory:</p>\n\n<pre><code>var buf bytes.Buffer\ntw := tar.NewWriter(&amp;buf)\nfiles := map[string][]byte{\n    \"1.txt\": []byte(\"11\"),\n    \"2.txt\": []byte(\"2\"),\n}\nfor fileName, bStr := range files {\n    b := []byte(bStr)\n    hdr := &amp;tar.Header{\n        Name: fileName,\n        Mode: 0600,\n        Size: int64(len(b)),\n    }\n    log.Printf(\"include the file to the tar %+v\\n\", hdr)\n    if err := tw.WriteHeader(hdr); err != nil {\n        err := fmt.Errorf(\"couldn't write a header: %+v\", err)\n        log.Println(err)\n        return\n    }\n    if _, err := tw.Write(b); err != nil {\n        err := fmt.Errorf(\"couldn't write file %+v to tar: %+v\", fileName, err)\n        log.Println(err)\n        return\n    }\n}\nif err := tw.Close(); err != nil {\n    log.Println(err)\n    return\n}\n</code></pre>\n\n<p>But unable to convert this tar file to bytes.\n<a href=\"https://play.golang.org/p/z7bZMSybsBy\" rel=\"nofollow noreferrer\">playground 1</a></p>\n\n<pre><code>    b, err := ioutil.ReadAll(tr)\n    if err != nil {\n        err = fmt.Errorf(\"could not read file data\")\n        log.Println(err)\n        return\n    }\n    log.Printf(\"read %+v bytes\", len(b))\n</code></pre>\n\n<p>It just prints 0 bytes:</p>\n\n<pre><code>2018/06/26 16:57:04 main.go:67: read 0 bytes\n</code></pre>\n\n<p>But I can read the content of the tar, file by file:</p>\n\n<pre><code>for {\n    hdr, err := tr.Next()\n    if err == io.EOF {\n        break // End of archive\n    }\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Contents of %s:\\n\", hdr.Name)\n    if _, err := io.Copy(os.Stdout, tr); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jHckq1gJca6\" rel=\"nofollow noreferrer\">playground 2</a></p>\n\n<p>It prints </p>\n\n<pre><code>Contents of 2.txt:\n2\nContents of 1.txt:\n11\n</code></pre>\n\n<p>as expected.</p>\n\n<p>So it means that my tar file is not empty. I just need to convert it to bytes for further pushing to glcoud storage. But looks like I mess around with readers and writers and can hardly figure out how to convert tar to bytes in the memory.</p>\n"}, {"tags": ["go", "struct", "slice"], "answers": [{"comments": [{"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1530025887, "post_id": 51044845, "comment_id": 89083474, "body": "As soon as I read your answer, I could see what I&#39;d done! Thanks, the key was changing the struct name. Perhaps I need more coffee, thanks!"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 3, "last_activity_date": 1530024295, "last_edit_date": 1530024295, "creation_date": 1530021827, "answer_id": 51044845, "question_id": 51044741, "link": "https://stackoverflow.com/questions/51044741/appending-to-struct-slice-in-go/51044845#51044845", "title": "Appending to struct slice in Go", "body": "<p>The error is in the loop where you are calling <code>AddItem</code> function on Cluster method receiver which is not defined inside <code>getClusters</code> function. Define <code>Cluster</code> struct before for loop and then call the function <code>c.AddItem</code> as defined below:</p>\n\n<pre><code>func getClusters(searchDir string) Clusters {\n\n    fileList := make([]string, 0)\n    fileList = append(fileList, \"f1\", \"f2\", \"f3\")\n\n    ClusterData := []Cluster{}\n    c := Clusters{Cluster: ClusterData} // change the struct name passed to Clusters struct\n\n    for _, file := range fileList {\n\n        entry := Cluster{Name: \"name\" + file, Path: \"path\" + file}\n        c.AddItem(entry)\n    }\n    return c\n\n}\n</code></pre>\n\n<p>you have defined the same struct name to <code>Clusters</code> struct that's  why the error</p>\n\n<blockquote>\n  <p>cmd/directories.go:43:20: Cluster is not a type</p>\n</blockquote>\n\n<p>Checkout working code on <a href=\"https://play.golang.org/p/VzDEDq_qysh\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p>In Golang <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Composite literal</a> is defined as:</p>\n\n<blockquote>\n  <p>Composite literals construct values for structs, arrays, slices, and maps and create a new value each time they are evaluated. They\n  consist of the type of the literal followed by a brace-bound list of\n  elements. Each element may optionally be preceded by a corresponding\n  key.</p>\n</blockquote>\n\n<p>Also Have a look on struct literals section defined in above link for <code>Composite</code>literals to get more description.</p>\n"}, {"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 3, "last_activity_date": 1530022303, "last_edit_date": 1530022303, "creation_date": 1530021965, "answer_id": 51044891, "question_id": 51044741, "link": "https://stackoverflow.com/questions/51044741/appending-to-struct-slice-in-go/51044891#51044891", "title": "Appending to struct slice in Go", "body": "<p>You need to define <code>c</code> <strong>before</strong> entering the loop in which you use it.</p>\n\n<p>The <code>Cluster is not a type</code> error is due to using the same <code>Cluster</code> name as the type and the variable, try using a different variable name.</p>\n\n<pre><code>clusterArr := []Cluster{}\nc := Clusters{clusterArr}\n\nfor _, file := range fileList {\n   ....\n}\n</code></pre>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4967, "favorite_count": 0, "accepted_answer_id": 51044845, "answer_count": 2, "score": 1, "last_activity_date": 1531308193, "creation_date": 1530021540, "last_edit_date": 1531308193, "question_id": 51044741, "link": "https://stackoverflow.com/questions/51044741/appending-to-struct-slice-in-go", "title": "Appending to struct slice in Go", "body": "<p>I have two structs, like so:</p>\n\n<pre><code>// init a struct for a single item\ntype Cluster struct {\n  Name string\n  Path string\n}\n\n// init a grouping struct\ntype Clusters struct {\n  Cluster []Cluster\n}\n</code></pre>\n\n<p>What I want to do is append to new items to the clusters struct. So I wrote a method, like so:</p>\n\n<pre><code>func (c *Clusters) AddItem(item Cluster) []Cluster {\n  c.Cluster = append(c.Cluster, item)\n  return c.Cluster\n}\n</code></pre>\n\n<p>The way my app works, I loop through some directories then append the name of the final directory and it's path. I have a function, that is called:</p>\n\n<pre><code>func getClusters(searchDir string) Clusters {\n\n  fileList := make([]string, 0)\n  //clusterName := make([]string, 0)\n  //pathName := make([]string, 0)\n\n  e := filepath.Walk(searchDir, func(path string, f os.FileInfo, err error) error {\n    fileList = append(fileList, path)\n    return err\n  })\n\n  if e != nil {\n    log.Fatal(\"Error building cluster list: \", e)\n  }\n\n  for _, file := range fileList {\n\n    splitFile := strings.Split(file, \"/\")\n    // get the filename\n    fileName := splitFile[len(splitFile)-1]\n\n    if fileName == \"cluster.jsonnet\" {\n      entry := Cluster{Name: splitFile[len(splitFile)-2], Path: strings.Join(splitFile[:len(splitFile)-1], \"/\")}\n      c.AddItem(entry)\n\n    }\n  }\n  Cluster := []Cluster{}\n  c := Clusters{Cluster}\n\n  return c\n\n}\n</code></pre>\n\n<p>The problem here is that I don't know the correct way to do this.</p>\n\n<p>Currently, I'm getting:</p>\n\n<blockquote>\n  <p>cmd/directories.go:41:4: undefined: c</p>\n</blockquote>\n\n<p>So I tried moving this:</p>\n\n<pre><code>Cluster := []Cluster{}\nc := Clusters{Cluster}\n</code></pre>\n\n<p>Above the for loop - <code>range</code>. The error I get is:</p>\n\n<blockquote>\n  <p>cmd/directories.go:43:20: Cluster is not a type</p>\n</blockquote>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["json", "loops", "dictionary", "go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1530019151, "creation_date": 1530019151, "answer_id": 51043932, "question_id": 51043433, "link": "https://stackoverflow.com/questions/51043433/join-range-block-in-go-template/51043932#51043932", "title": "Join range block in go template", "body": "<p>Here's an example how to do it with templates, but I strongly recommend to use the 2nd approach if you want to generate JSON.</p>\n\n<h2>Sticking with templates</h2>\n\n<p>Since you're ranging over a map, you can't (simply) do it. In case of slices you could check the index variable (examples: <a href=\"https://stackoverflow.com/questions/42662525/go-template-remove-the-last-comma-in-range-loop\">Go template remove the last comma in range loop</a>; and <a href=\"https://stackoverflow.com/questions/50085038/detect-last-item-inside-an-array-using-range-inside-go-templates/50085210#50085210\">detect last item inside an array using range inside go-templates</a>), but in case of maps you can't do that.</p>\n\n<p>Knowing if you're at the first (or last) iteration is a <em>state</em> which you must maintain yourself. And example is to use custom functions or methods for this.</p>\n\n<p>Here's an example implementation:</p>\n\n<pre><code>type Params struct {\n    Env     map[string]string\n    Counter int\n}\n\nfunc (p *Params) IncMore() bool {\n    p.Counter++\n    return p.Counter &lt; len(p.Env)\n}\n\nconst src = `\"environment\": [\n   {{- range $k,$v := .Env }}\n     {\n       \"name\": \"{{ $k }}\",\n       \"value\": \"{{ $v }}\"\n     }{{if $.IncMore}},{{end}}\n   {{- end }}\n   ]`\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>func main() {\n    t := template.Must(template.New(\"\").Parse(src))\n    p := &amp;Params{\n        Env: map[string]string{\n            \"name\":   \"test\",\n            \"region\": \"us-east-1\",\n        },\n    }\n    err := t.Execute(os.Stdout, p)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Es5Mr2xG0E7\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\"environment\": [\n     {\n       \"name\": \"name\",\n       \"value\": \"test\"\n     },\n     {\n       \"name\": \"region\",\n       \"value\": \"us-east-1\"\n     }\n   ]\n</code></pre>\n\n<h2>Use <code>encoding/json</code>  to generate JSON</h2>\n\n<p>If you're goal is to generate JSON, you should use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package to generate valid JSON document. The above template has no knowledge about JSON syntax and context, and the values of the map entries are not escaped when written to the output, so you may still end up with invalid JSON.</p>\n\n<p>Best would be to generate the JSON like this:</p>\n\n<pre><code>type Entry struct {\n    Name  string `json:\"name\"`\n    Value string `json:\"value\"`\n}\n\ntype Params struct {\n    Env []Entry `json:\"environment\"`\n}\n\nfunc main() {\n    enc := json.NewEncoder(os.Stdout)\n    enc.SetIndent(\"\", \"  \") // Optional\n    p := &amp;Params{\n        Env: []Entry{\n            {Name: \"name\", Value: \"test\"},\n            {Name: \"region\", Value: \"us-east-1\"},\n        },\n    }\n    err := enc.Encode(p)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/1oW70RzoVET\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\n  \"environment\": [\n    {\n      \"name\": \"name\",\n      \"value\": \"test\"\n    },\n    {\n      \"name\": \"region\",\n      \"value\": \"us-east-1\"\n    }\n  ]\n}\n</code></pre>\n"}], "owner": {"reputation": 586, "user_id": 2800787, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/283f85e418d93c4e6cccb55ed88502d5?s=128&d=identicon&r=PG&f=1", "display_name": "Deepak", "link": "https://stackoverflow.com/users/2800787/deepak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1171, "favorite_count": 1, "accepted_answer_id": 51043932, "answer_count": 1, "score": 1, "last_activity_date": 1530298094, "creation_date": 1530017549, "last_edit_date": 1530298094, "question_id": 51043433, "link": "https://stackoverflow.com/questions/51043433/join-range-block-in-go-template", "title": "Join range block in go template", "body": "<p>I have a go template like this:</p>\n\n<pre><code> \"environment\": [\n   {{- range $k,$v := .env }}\n     {\n       \"name\": \"{{ $k }}\",\n       \"value\": \"{{ $v }}\"\n     },\n   {{- end }}\n   ]\n</code></pre>\n\n<p>and i am getting the output below:</p>\n\n<pre><code>     \"environment\": [\n    {\n      \"name\": \"name\",\n      \"value\": \"test\"\n    },\n    {\n      \"name\": \"region\",\n      \"value\": \"us-east-1\"\n    },\n  ]\n</code></pre>\n\n<p>and i want to render it like below:</p>\n\n<pre><code>    \"environment\": [\n    {\n      \"name\": \"name\",\n      \"value\": \"bxbd\"\n    },\n    {\n      \"name\": \"region\",\n      \"value\": \"us-east-1\"\n    }\n  ]\n</code></pre>\n\n<p>I am not able to get rid of the last comma to make valid json.\nOr is it possible to somehow send the complete range block to some custom  join function?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "edited": false, "score": 0, "creation_date": 1530011995, "post_id": 51041516, "comment_id": 89074183, "body": "Which line corresponds to  /home/webonise/go/src/github.com/gror/controllers/controller&zwnj;&#8203;_test.go:364 ?"}, {"owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "reply_to_user": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "edited": false, "score": 0, "creation_date": 1530092640, "post_id": 51041516, "comment_id": 89109020, "body": "I got the answer- If the function I was testing contains template at that time you have to give the absolute path.Thus,the issue is resolved now.Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1530093619, "post_id": 51059741, "comment_id": 89109631, "body": "Changing <code>$PATH</code> like that is going to mess up your shell badly."}, {"owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1530099005, "post_id": 51059741, "comment_id": 89113098, "body": "you know any alternative solution?"}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1530100358, "post_id": 51059741, "comment_id": 89113889, "body": "Use a different variable name? But surely there are other ways, based on the working directory?"}, {"owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1530103679, "post_id": 51059741, "comment_id": 89116173, "body": "For temporary purpose,I know only this solution.If someone want to do permanent changes then their are other options available as you said."}], "tags": [], "owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "is_accepted": true, "score": 0, "last_activity_date": 1530093559, "last_edit_date": 1530093559, "creation_date": 1530093329, "answer_id": 51059741, "question_id": 51041516, "link": "https://stackoverflow.com/questions/51041516/unable-to-test-template-in-golang/51059741#51059741", "title": "unable to test template in golang", "body": "<p>If you want to test a method that contains template which is executing inside that particular method then you have to provide the absolute path.</p>\n\n<p>Follow these steps:</p>\n\n<ol>\n<li><p>Set current working directory in your terminal:</p>\n\n<pre><code>export varname=\"absolutepath\"\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>export PATH=\"/go/src/github.com/project1\"\n</code></pre></li>\n<li><p>Use this command in your terminal:</p>\n\n<pre><code>echo $varname\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>echo $PATH\n/go/src/github.com/project1\n</code></pre>\n\n<p>It will give you full path that you have set.</p></li>\n<li><p>In your program use this:</p>\n\n<pre><code>path := os.Getenv(\"PATH\")\nt, err := template.ParseFiles(Path + \"views/dockerconfig.gtpl\")\nif err != nil {\n    fmt.Println(errors.New(\"unable to execute the template\"))\n}\nt.Execute(w, nil)\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 1, "accepted_answer_id": 51059741, "answer_count": 1, "score": -2, "last_activity_date": 1530093559, "creation_date": 1530011543, "question_id": 51041516, "link": "https://stackoverflow.com/questions/51041516/unable-to-test-template-in-golang", "title": "unable to test template in golang", "body": "<pre><code>//This is my controller test function that test for GET Item request  \n    func TestGetItem(t *testing.T) {\n        s := GetDockerItemControllerImpl{\n            GetDockerService: GetItemReqSuccessImplTest{},\n        }\n\n        for _, test := range testCaseGetItemFullSuccess {\n            router := mux.NewRouter()\n            router.HandleFunc(\"/docker/config/{id}\", s.GetDockerConfig())//this will run controller function GetDockerConfig()\n\n            ts := httptest.NewServer(router)\n            defer ts.Close()\n\n            req, err := http.NewRequest(test.Method, test.URL, nil)\n\n            if err != nil {\n                t.Fatal(err)\n            }\n            rr := httptest.NewRecorder()\n            router.ServeHTTP(rr, req)\n\n            if status := rr.Code; status != test.expectStatus {\n                t.Errorf(\"handler returned wrong status code: got %v want %v\",\n                    status, test.expectStatus)\n            }\n\n        }\n    }\n\n    //Controller function\n        func (s *GetDockerItemControllerImpl) GetDockerConfig() http.HandlerFunc {\n            return func(w http.ResponseWriter, req *http.Request) {\n            var rootobject models.Root\n            vars := mux.Vars(req)\n\n            if bson.IsObjectIdHex(vars[\"id\"]) {\n            rootobject.ID = bson.ObjectIdHex(vars[\"id\"])\n\n            marshalData, unmarshalErr := json.Marshal(rootobject)\n                if unmarshalErr != nil {\n                http.Error(w, \"Unprocessable Entity error\", http.StatusUnprocessableEntity)\n                return\n                }\n\n                rootobject, err := s.GetDockerService.GetItem(marshalData)\n                if err != nil {\n                http.Error(w, \"Bad Request\", http.StatusBadRequest)\n                return\n                }\n\n                t, err := template.ParseFiles(\"./views/dockerconfigDetails.gtpl\")\n                if err != nil {\n                http.Error(w, \"Internal Server Error\", http.StatusInternalServerError)\n                return\n                }\n\n                t.ExecuteTemplate(w, \"dockerconfigDetails.gtpl\", rootobject)\n                if err != nil {\n                http.Error(w, \"Record not found of this ID:\"+vars[\"id\"], http.StatusNotFound)\n                return\n                }\n                } else {\n                http.Error(w, \"Invalid Id bad request\", http.StatusBadRequest)\n                }\n            }}\n</code></pre>\n\n<p>- This is my controller function that execute template.\n   - In controller test func i have created a mock server that hits for a particular URL.\n-On running get test -v command i am getting this---- FAIL: TestGetItem (0.00s)\n    panic: runtime error: invalid memory address or nil pointer dereference [recovered]\n            panic: runtime error: invalid memory address or nil pointer dereference\n    [signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x5927a0]</p>\n\n<pre><code>goroutine 9 [running]:\ntesting.tRunner.func1(0xc4201263c0)\n        /home/webonise/niketa/go/src/testing/testing.go:711 +0x2d2\npanic(0x7cc060, 0xa5bcc0)\n        /home/webonise/niketa/go/src/runtime/panic.go:491 +0x283\nhtml/template.(*Template).lookupAndEscapeTemplate(0x0, 0x845b99, 0x18, 0x0, 0x0, 0x0)\n        /home/webonise/niketa/go/src/html/template/template.go:144 +0x50\nhtml/template.(*Template).ExecuteTemplate(0x0, 0x7f9afab510e8, 0xc420060b80, 0x845b99, 0x18, 0x808400, 0xc42011c880, 0x0, 0x0)\n        /home/webonise/niketa/go/src/html/template/template.go:133 +0x43\ngithub.com/gror/controllers.(*GetDockerItemControllerImpl).GetDockerConfig.func1(0xa2f540, 0xc420060b80, 0xc42012a500)\n        /home/webonise/go/src/github.com/gror/controllers/controller.go:149 +0x3ce\nnet/http.HandlerFunc.ServeHTTP(0xc4200472a0, 0xa2f540, 0xc420060b80, 0xc42012a500)\n        /home/webonise/niketa/go/src/net/http/server.go:1918 +0x44\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc420128a80, 0xa2f540, 0xc420060b80, 0xc42012a500)\n        /home/webonise/go/src/github.com/gorilla/mux/mux.go:162 +0xed\ngithub.com/gror/controllers.TestGetItem(0xc4201263c0)\n        /home/webonise/go/src/github.com/gror/controllers/controller_test.go:364 +0x500\ntesting.tRunner(0xc4201263c0, 0x8575a8)\n        /home/webonise/niketa/go/src/testing/testing.go:746 +0xd0\ncreated by testing.(*T).Run\n        /home/webonise/niketa/go/src/testing/testing.go:789 +0x2de\nexit status 2\nFAIL    github.com/gror/controllers     0.007s\n</code></pre>\n"}, {"tags": ["go", "google-bigquery", "gcloud"], "comments": [{"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1530019101, "post_id": 51040470, "comment_id": 89078800, "body": "Struct values cannot be <code>nil</code> i.e. BigQuery&#39;s <code>NULL</code>: <a href=\"https://stackoverflow.com/questions/30131052/golang-set-type-struct-to-nil\" title=\"golang set type struct to nil\">stackoverflow.com/questions/30131052/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1124, "user_id": 3719105, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/naAxR.jpg?s=128&g=1", "display_name": "Praveen_Shukla", "link": "https://stackoverflow.com/users/3719105/praveen-shukla"}, "edited": false, "score": 0, "creation_date": 1594315660, "post_id": 51044870, "comment_id": 111090720, "body": "slight correction. Instead of <code>Amount bigquery.NullInt64</code> it should be  <code>Amount bigquery.NullInt64 </code>bigquery:&quot;amount&quot;``"}], "tags": [], "owner": {"reputation": 1633, "user_id": 6915507, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XnOmr.jpg?s=128&g=1", "display_name": "VictorGGl", "link": "https://stackoverflow.com/users/6915507/victorggl"}, "is_accepted": true, "score": 7, "last_activity_date": 1530021885, "creation_date": 1530021885, "answer_id": 51044870, "question_id": 51040470, "link": "https://stackoverflow.com/questions/51040470/exception-after-mapping-bigquerys-rows-with-null-to-struct/51044870#51044870", "title": "Exception after mapping bigquery&#39;s rows with null to struct", "body": "<p>You can use any of the bigquery.Null types that you can see <a href=\"https://godoc.org/cloud.google.com/go/bigquery#InferSchema\" rel=\"noreferrer\">in this link</a>:</p>\n\n<pre><code>STRING      NullString\nBOOL        NullBool\nINTEGER     NullInt64\nFLOAT       NullFloat64\nTIMESTAMP   NullTimestamp\nDATE        NullDate\nTIME        NullTime\nDATETIME    NullDateTime\n</code></pre>\n\n<p>In your case you would have to change your line</p>\n\n<pre><code>Amount int `nullable`\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>Amount bigquery.NullInt64\n</code></pre>\n\n<p>In the <a href=\"https://godoc.org/cloud.google.com/go/bigquery#RowIterator.Next\" rel=\"noreferrer\">same link</a> it states:</p>\n\n<blockquote>\n  <p>It is an error to attempt to read a BigQuery NULL value into a struct field, unless the field is of type []byte or is one of the special Null types: NullInt64, NullFloat64, NullBool, NullString, NullTimestamp, NullDate, NullTime or NullDateTime. </p>\n</blockquote>\n"}], "owner": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1931, "favorite_count": 2, "accepted_answer_id": 51044870, "answer_count": 1, "score": 3, "last_activity_date": 1530021885, "creation_date": 1530008406, "last_edit_date": 1530008557, "question_id": 51040470, "link": "https://stackoverflow.com/questions/51040470/exception-after-mapping-bigquerys-rows-with-null-to-struct", "title": "Exception after mapping bigquery&#39;s rows with null to struct", "body": "<p>I have a BigQuery table with this schema:</p>\n\n<pre><code>name    STRING  NULLABLE     \nage     INTEGER NULLABLE  \namount  INTEGER NULLABLE\n</code></pre>\n\n<p>and this two rows:</p>\n\n<pre><code>1   Batgirl 23  123  \n2   Batman  22  null     \n</code></pre>\n\n<p>What I am trying to do is a select from Go on this table which is working really fine:</p>\n\n<pre><code>ctx := context.Background()\nclient, err := bigquery.NewClient(ctx, projectID)\n\nq := client.Query(\"SELECT * FROM test.user_test LIMIT 1000\")\n\nit, err := q.Read(ctx)\nif err != nil {\n    log.Fatal(err)\n}\nfor {\n    var values []bigquery.Value\n    err := it.Next(&amp;values)\n    if err == iterator.Done {\n        break\n    }\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(values)\n}\n</code></pre>\n\n<p>the above code is working like a charm, it gets the select and it prints both rows like this:</p>\n\n<pre><code>[Batman 22 &lt;nil&gt;]\n[Batgirl 23 123]\n</code></pre>\n\n<p>Batman is shown with the nil value. The problem comes when I am trying to store this rows in a struct with this code:</p>\n\n<pre><code>type test struct {\n    Name   string\n    Age    int\n    Amount int `nullable`\n}\n\nq := client.Query(\"SELECT * FROM test.test_user LIMIT 1000\")\n\nif err != nil {\n    log.Fatal(err)\n}\n\nit, err := q.Read(ctx)\nif err != nil {\n    log.Fatal(err)\n}\nfor {\n    var c test\n    err := it.Next(&amp;c)\n    if err == iterator.Done {\n        break\n    }\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>the above code iterates the results query and it stores both values in a struct that I can manipulate later. It works fine when there aren't any null columns (which is not my case now because I have a null amount on Batman), so I am getting the next error:</p>\n\n<pre><code>bigquery: NULL values cannot be read into structs\n</code></pre>\n\n<p>What I have tried to fix this is making the struct field nullable like this:</p>\n\n<pre><code>type test struct {\n    Name   string\n    Age    int\n    Amount int `bigquery:\",nullable\"`\n}\n</code></pre>\n\n<p>But this is doing basically nothing. I am starting to learn Go and I don't really understand why I can't have nil values in structs or how I can fix this, so these are my two questions:</p>\n\n<ol>\n<li><p>How can I store my row results with null values?</p></li>\n<li><p>Why has google decided that a nil value can't be set on a struct field?</p></li>\n</ol>\n"}, {"tags": ["mysql", "go", "aws-lambda"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529998985, "post_id": 51037167, "comment_id": 89066444, "body": "This is not answering your question, but: Are you saving the passwords in plain text in the database?"}, {"owner": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529999344, "post_id": 51037167, "comment_id": 89066640, "body": "yes, it is stored as plan text. and the same go syntax works in plain go build but not  in AWS Lambda"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529999504, "post_id": 51037167, "comment_id": 89066720, "body": "This is, again, not about your original question. But I would urgently advise you to use password encryption."}, {"owner": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529999650, "post_id": 51037167, "comment_id": 89066811, "body": "Thanks for the advice! It is actually bad naming as the purpose of those base32  text are for redeem something, and those should be named as redeem codes or something."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1530000042, "post_id": 51037167, "comment_id": 89067038, "body": "Ah, ok. Then these are just tokens. Makes sense."}, {"owner": {"reputation": 373, "user_id": 4007614, "user_type": "registered", "profile_image": "https://graph.facebook.com/1402721551/picture?type=large", "display_name": "Gianmarco Carrieri", "link": "https://stackoverflow.com/users/4007614/gianmarco-carrieri"}, "edited": false, "score": 0, "creation_date": 1530003237, "post_id": 51037167, "comment_id": 89068829, "body": "i&#39;m not a developer, i don&#39;t know how go works, but,just a simple question, is it normal to close the connection before execute the query?"}, {"owner": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "edited": false, "score": 0, "creation_date": 1530003557, "post_id": 51037167, "comment_id": 89069029, "body": "not common, but in go&#39;s case, It is idiomatic to defer db.Close() if the sql.DB should not have a lifetime beyond the scope of the function."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 373, "user_id": 4007614, "user_type": "registered", "profile_image": "https://graph.facebook.com/1402721551/picture?type=large", "display_name": "Gianmarco Carrieri", "link": "https://stackoverflow.com/users/4007614/gianmarco-carrieri"}, "edited": false, "score": 0, "creation_date": 1530006180, "post_id": 51037167, "comment_id": 89070658, "body": "@GianmarcoCarrieri in Go, <code>defer</code> will make a function wait until the surrounding function returns before executing it, so in this case <code>db.Close()</code> is the last thing that is called."}, {"owner": {"reputation": 813, "user_id": 884401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f763605dae774cf724cc1e8b19f8669?s=128&d=identicon&r=PG", "display_name": "Nathan Phetteplace", "link": "https://stackoverflow.com/users/884401/nathan-phetteplace"}, "edited": false, "score": 0, "creation_date": 1530020830, "post_id": 51037167, "comment_id": 89080020, "body": "Is your db within a vpc?  If so, you need to enable vpc access for your lambda function to have access to the instance.  However, I suppose it would fail opening the connection and not at the prepare statement."}, {"owner": {"reputation": 462, "user_id": 5457306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vw1zh.jpg?s=128&g=1", "display_name": "Vallie", "link": "https://stackoverflow.com/users/5457306/vallie"}, "edited": false, "score": 0, "creation_date": 1580470876, "post_id": 51037167, "comment_id": 106116984, "body": "but should db.Close() be even there. Since that will keep opening and closing connections each time the lambda is called. Wouldn&#39;t it?"}], "answers": [{"tags": [], "owner": {"reputation": 450, "user_id": 6284370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HihDM.jpg?s=128&g=1", "display_name": "Sameera Piyasundara", "link": "https://stackoverflow.com/users/6284370/sameera-piyasundara"}, "is_accepted": false, "score": 0, "last_activity_date": 1530060259, "creation_date": 1530060259, "answer_id": 51053076, "question_id": 51037167, "link": "https://stackoverflow.com/questions/51037167/database-connection-hanging-on-aws-lamda/51053076#51053076", "title": "Database connection hanging on AWS Lamda", "body": "<p>If it is a RDS operation, I think it is getting timeout. The default timeout of a lambda function is 6 seconds and therefore it is getting timeout before the operation finishes with RDS. To avoid this you do not have to increase the timeout. Instead of that you can make \"callBackWaitsForEmptyEventLoop\" false as your first line of code in lambda function. </p>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "edited": false, "score": 0, "creation_date": 1530091879, "post_id": 51058461, "comment_id": 89108521, "body": "Thanks. VPC is exact the reason that Lambda get blocked and no log in Lambda side. Since I was still coding, I put Lambda function in my Default VPC. On the other hand, the RDS was prepared and put in specific VPC. After adding my function into that db&#39;s VPC, it works fine."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "edited": false, "score": 0, "creation_date": 1530093083, "post_id": 51058461, "comment_id": 89109304, "body": "glad to hear it.  Hope this helps other people to avoid this problem!"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1530089523, "creation_date": 1530089523, "answer_id": 51058461, "question_id": 51037167, "link": "https://stackoverflow.com/questions/51037167/database-connection-hanging-on-aws-lamda/51058461#51058461", "title": "Database connection hanging on AWS Lamda", "body": "<p>It's probably the AWS security groups</p>\n\n<p>The lambda tries to connect but the security groups time it out as they block it forever</p>\n\n<p>Attach the AWSLambdaVPCAccessExecutionRole policy to your lambda and ensure the Lambda is in a VPC.  Check the database security groups allow access from the VPC</p>\n\n<p>There are some more pointers in this question <a href=\"https://stackoverflow.com/questions/37030704/allow-aws-lambda-to-access-rds-database\">Allow AWS Lambda to access RDS Database</a></p>\n"}], "owner": {"reputation": 41, "user_id": 5057348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ueHKgDDAsgk/AAAAAAAAAAI/AAAAAAAANJI/gqY-m6qPDpM/photo.jpg?sz=128", "display_name": "Thomas Kao", "link": "https://stackoverflow.com/users/5057348/thomas-kao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1530089523, "creation_date": 1529997973, "last_edit_date": 1529998063, "question_id": 51037167, "link": "https://stackoverflow.com/questions/51037167/database-connection-hanging-on-aws-lamda", "title": "Database connection hanging on AWS Lamda", "body": "<p>I am trying to do basic db connection in AWS Lambda with Go, and for some reason, it got stuck at db.prepare() and no log is presented in cloudwatch.</p>\n\n<pre><code>func Handler(request Request) (Response, error) {\n\n    db, err := sql.Open(\"mysql\", dbUsername+\":\"+dbPassword+\"@tcp(\"+dbURL+\":\"+dbPort+\")/\"+dbName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n    stmt, err := db.Prepare(\"SELECT id, password FROM package_passwords WHERE password = ?\")\n    return Response{\n        Message: \"rows\",\n        Ok:      false,\n    }, nil\n}\n</code></pre>\n\n<p>weird thing is that the code above stuck at least more than 5 second in AWS Lambda while it works fine in plain go run/ go build.</p>\n"}, {"tags": ["go", "middleware", "interceptor", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 1721369, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/G5XzB.jpg?s=128&g=1", "display_name": "Nitin Savant", "link": "https://stackoverflow.com/users/1721369/nitin-savant"}, "edited": false, "score": 0, "creation_date": 1530547322, "post_id": 51037136, "comment_id": 89263937, "body": "I&#39;m a bit confused. If by &quot;in control of the code that creates the ServerStream object&quot;, you mean control over the clients that make RPC calls, then no, I don&#39;t have control. I am, however, in control of all the server-side code. How else could I access the request?"}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "reply_to_user": {"reputation": 750, "user_id": 1721369, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/G5XzB.jpg?s=128&g=1", "display_name": "Nitin Savant", "link": "https://stackoverflow.com/users/1721369/nitin-savant"}, "edited": false, "score": 0, "creation_date": 1530557716, "post_id": 51037136, "comment_id": 89268530, "body": "No, I meant the part of the GO program that creates the ServerStream (the thing that listens for those requests that you want to see and log). That code should be part of your executable (though not necessarily something you wrote - it may be in a package someone else developed, I can&#39;t know that)."}], "tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": false, "score": 2, "last_activity_date": 1529997888, "creation_date": 1529997888, "answer_id": 51037136, "question_id": 51036485, "link": "https://stackoverflow.com/questions/51036485/accessing-grpc-request-object-in-custom-interceptor-middleware/51037136#51037136", "title": "Accessing gRPC request object in custom interceptor/middleware", "body": "<p>The stream handler can be called multiple times during the lifetime of the request that created the stream, that's why the request is not part of the arguments to the handler (and to any interceptor, either). You could place the request (or better, a copy of the data that you want logged and not a reference to the request itself) in the stream context (assuming you are in control of the code that creates the ServerStream object). I would rather log the request parameters once, when the stream is created and not on every call to the handler (so each request is logged once only).</p>\n"}, {"comments": [{"owner": {"reputation": 1836, "user_id": 1574034, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e5ec2a91be754c20903349048d16ed2a?s=128&d=identicon&r=PG", "display_name": "Naveen Ramanathan", "link": "https://stackoverflow.com/users/1574034/naveen-ramanathan"}, "edited": false, "score": 1, "creation_date": 1590074593, "post_id": 52597433, "comment_id": 109547992, "body": "The above code doesn&#39;t answer the question of how to get the actual request. This code intercepts the server stream rather than the request."}, {"owner": {"reputation": 459, "user_id": 3215378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6a30b900904ae9c7d01c07bd1a305b?s=128&d=identicon&r=PG&f=1", "display_name": "user3215378", "link": "https://stackoverflow.com/users/3215378/user3215378"}, "edited": false, "score": 0, "creation_date": 1602883202, "post_id": 52597433, "comment_id": 113871167, "body": "I confirm your solution work, but you make a little error it&#39; not &#39;return l.RecvMsg(m)&#39; but &#39;l.inner.RecvMsg(m)&#39;. The message in RecvMsg is effectively the request itself."}], "tags": [], "owner": {"reputation": 15256, "user_id": 43786, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/40d8767cf48359c6e880fb66a6916de6?s=128&d=identicon&r=PG", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/43786/nicholas"}, "is_accepted": false, "score": 3, "last_activity_date": 1538421138, "creation_date": 1538421138, "answer_id": 52597433, "question_id": 51036485, "link": "https://stackoverflow.com/questions/51036485/accessing-grpc-request-object-in-custom-interceptor-middleware/52597433#52597433", "title": "Accessing gRPC request object in custom interceptor/middleware", "body": "<p>This is a bit old now, but the easiest way to extend your interception into the stream is to create a <strong>grpc.ServerStream</strong> wrapper, then wrap the real ServerStream in your interceptor. In that way, your intercepting code can handle the received and sent messages in the stream.</p>\n\n<pre><code>// A wrapper for the real grpc.ServerStream\ntype LoggingServerStream struct {\n    inner           grpc.ServerStream\n}\n\nfunc (l LoggingServerStream) SetHeader(m metadata.MD) error {\n    return l.SetHeader(m)\n}\n\nfunc (l LoggingServerStream) SendHeader(m metadata.MD) error {\n    return l.SendHeader(m)\n}\n\nfunc (l LoggingServerStream) SetTrailer(m metadata.MD) {\n    l.SetTrailer(m)\n}\n\nfunc (l LoggingServerStream) Context() context.Context {\n    return l.Context()\n}\n\nfunc (l LoggingServerStream) SendMsg(m interface{}) error {\n    fmt.Printf(\"Sending Message: type=%s\\n\", reflect.TypeOf(m).String())\n    return l.SendMsg(m)\n}\n\nfunc (l LoggingServerStream) RecvMsg(m interface{}) error {\n    fmt.Printf(\"Receiving Message: type=%s\\n\", reflect.TypeOf(m).String())\n    return l.RecvMsg(m)\n}\n</code></pre>\n\n<p>The interceptor:</p>\n\n<pre><code>func LoggingStreamInterceptor() grpc.StreamServerInterceptor {\n    return func(srv interface{}, ss grpc.ServerStream, info *grpc.StreamServerInfo, handler grpc.StreamHandler) error {\n        return handler(srv, LoggingServerStream{inner:ss})\n    }\n}\n</code></pre>\n\n<p>Any state you need to keep and go in your wrapper.</p>\n"}], "owner": {"reputation": 750, "user_id": 1721369, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/G5XzB.jpg?s=128&g=1", "display_name": "Nitin Savant", "link": "https://stackoverflow.com/users/1721369/nitin-savant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2595, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1538421138, "creation_date": 1529995681, "question_id": 51036485, "link": "https://stackoverflow.com/questions/51036485/accessing-grpc-request-object-in-custom-interceptor-middleware", "title": "Accessing gRPC request object in custom interceptor/middleware", "body": "<p>gRPC's Go library provides interfaces for creating your own custom interceptors (i.e. middleware functions), and I'm attempting to write two logging interceptors. The first is a Unary Server Interceptor where I'm easily able to log the request parameters using the object passed into the interceptor function. </p>\n\n<pre><code>func loggingUnary(context context.Context, req interface{}, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler) (interface{}, error) {\n    start := time.Now()\n    resp, err := handler(context, req)\n\n    printLogMessage(err, info.FullMethod, context, time.Since(start), req)\n\n    return resp, err\n}\n</code></pre>\n\n<p>How can I do the same with the Stream Server Interceptor which doesn't conveniently pass the request object as a parameter? Is there another way to access the request?</p>\n\n<pre><code>func loggingStream(srv interface{}, stream grpc.ServerStream, info *grpc.StreamServerInfo, handler grpc.StreamHandler) error {\n    start := time.Now()\n    err := handler(srv, stream)\n\n    printLogMessage(err, info.FullMethod, stream.Context(), time.Since(start), \"\")\n\n    return err\n}\n</code></pre>\n"}, {"tags": ["go", "encoding", "utf-8"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1529992985, "post_id": 51035745, "comment_id": 89063438, "body": "This blog post explains it in details: <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">Strings, bytes, runes and characters in Go</a>"}, {"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1530049107, "post_id": 51035745, "comment_id": 89094462, "body": "Where is this UTF-8 encoding table that shows 255 rows? Wouldn&#39;t it show U+0080 through U+00FF as taking two bytes?"}], "answers": [{"comments": [{"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1530049226, "post_id": 51036331, "comment_id": 89094495, "body": "&quot;Go uses UTF-8 encoding&quot; seems like a gross oversimplification, given that a string is a sequence of bytes that, if it represents text at all, could be in any encoding."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1530054886, "last_edit_date": 1530054886, "creation_date": 1529995038, "answer_id": 51036331, "question_id": 51035745, "link": "https://stackoverflow.com/questions/51035745/how-does-go-handle-characters-larger-than-a-single-byte/51036331#51036331", "title": "How does Go handle characters larger than a single byte?", "body": "<p>Go uses <a href=\"https://en.wikipedia.org/wiki/UTF-8\" rel=\"nofollow noreferrer\">UTF-8</a> encoding for source files, string literals, []rune to string conversions, string to []rune conversions, integer to string conversions and on range over string. </p>\n\n<p>UTF-8 uses one to four bytes to encode a character.</p>\n"}], "owner": {"reputation": 1438, "user_id": 3628276, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46f9ea9666fc2139f4178b8eadf0a64?s=128&d=identicon&r=PG&f=1", "display_name": "zarathustra", "link": "https://stackoverflow.com/users/3628276/zarathustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 2, "accepted_answer_id": 51036331, "answer_count": 1, "score": 1, "last_activity_date": 1530054886, "creation_date": 1529992544, "last_edit_date": 1529999614, "question_id": 51035745, "link": "https://stackoverflow.com/questions/51035745/how-does-go-handle-characters-larger-than-a-single-byte", "title": "How does Go handle characters larger than a single byte?", "body": "<p>In Go a byte is the same as an uint8. Which means a byte can store a value between 0 and 255.</p>\n\n<p>A string can also be written as a slice of bytes. I've read that there are almost no differences between a string and a slice of bytes (except the mutability).</p>\n\n<p>So how is it possible in Go to write something like \"\u4e16\u754c\" when this is clearly not in the first 255 characters in the UTF-8 encoding table? How does Go handle characters that are not within the first 255 rows in the UTF8 encoding table?</p>\n"}, {"tags": ["json", "string", "go", "stdin"], "answers": [{"comments": [{"owner": {"reputation": 623, "user_id": 7154308, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7c9532852ef1cf4acafa980432850fa3?s=128&d=identicon&r=PG&f=1", "display_name": "GianMS", "link": "https://stackoverflow.com/users/7154308/gianms"}, "edited": false, "score": 0, "creation_date": 1529992548, "post_id": 51035528, "comment_id": 89063273, "body": "If bufio.NewReader(file) is replaced with bufio.NewReader(os.Stdin), goroutine is blocked."}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "reply_to_user": {"reputation": 623, "user_id": 7154308, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7c9532852ef1cf4acafa980432850fa3?s=128&d=identicon&r=PG&f=1", "display_name": "GianMS", "link": "https://stackoverflow.com/users/7154308/gianms"}, "edited": false, "score": 0, "creation_date": 1529993410, "post_id": 51035528, "comment_id": 89063591, "body": "I cleaned up the code to show a full working program. If you need to launch a separate goroutine you will have to do that yourself."}], "tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": false, "score": 2, "last_activity_date": 1529992876, "last_edit_date": 1529992876, "creation_date": 1529991445, "answer_id": 51035528, "question_id": 51035458, "link": "https://stackoverflow.com/questions/51035458/read-json-object-from-stdin-in-golang/51035528#51035528", "title": "Read json object from stdin in golang", "body": "<p>When you call <code>json.Unmarshal</code> you should have the full JSON object in hand, otherwise you're just trying to unmarshal some partial object that makes no sense to the parser.</p>\n\n<ul>\n<li>Read from stdin into a buffer that is large enough to hold the entire JSON object.</li>\n<li>Unmarshal the JSON object</li>\n</ul>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"fmt\"\n    \"os\"\n    \"bufio\"\n    \"encoding/json\"\n)\n\n\nfunc main() {\n\n    var buf bytes.Buffer\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        line, err := reader.ReadString('\\n')\n        if err != nil {\n            if err == io.EOF {\n                buf.WriteString(line)\n                break // end of the input\n            } else {\n                fmt.Println(err.Error())\n                os.Exit(1) // something bad happened\n            }   \n        }   \n        buf.WriteString(line)\n\n    }   \n\n    fmt.Printf(\"valid json? %v\\n\", json.Valid(buf.Bytes()))\n\n    type MedicalRecord struct {\n        Name string `json:\"name\"`\n        Age int `json:\"age\"`\n    }   \n\n    var record MedicalRecord\n    err := json.Unmarshal(buf.Bytes(), &amp;record)\n    if err != nil {\n        fmt.Println(err.Error())\n        os.Exit(1) // something bad happened\n    }   \n\n    fmt.Printf(\"name: %s, age: %d\\n\", record.Name, record.Age)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 9, "last_activity_date": 1529993711, "creation_date": 1529993711, "answer_id": 51036021, "question_id": 51035458, "link": "https://stackoverflow.com/questions/51035458/read-json-object-from-stdin-in-golang/51036021#51036021", "title": "Read json object from stdin in golang", "body": "<p>Use a <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"noreferrer\">*json.Decoder</a> to consume JSON from an io.Reader:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"os\"\n)\n\ntype MedicalRecord struct{}\n\nfunc main() {\n    var record MedicalRecord\n\n    err := json.NewDecoder(os.Stdin).Decode(&amp;record)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>You can consume multiple consecutive JSON documents by calling Decode repeatedly:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\ntype MedicalRecord struct{}\n\nfunc main() {\n    var record MedicalRecord\n\n    dec := json.NewDecoder(os.Stdin)\n    for {\n        err := dec.Decode(&amp;record)\n        if err == io.EOF {\n            return\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 623, "user_id": 7154308, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7c9532852ef1cf4acafa980432850fa3?s=128&d=identicon&r=PG&f=1", "display_name": "GianMS", "link": "https://stackoverflow.com/users/7154308/gianms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3423, "favorite_count": 0, "accepted_answer_id": 51036021, "answer_count": 2, "score": 3, "last_activity_date": 1529993711, "creation_date": 1529991058, "question_id": 51035458, "link": "https://stackoverflow.com/questions/51035458/read-json-object-from-stdin-in-golang", "title": "Read json object from stdin in golang", "body": "<p>How to read a json object from stdin?\nI want to copy and paste a json object into the stdin, read it and unmarshal it.\nHere is the code:</p>\n\n<pre><code>    var input string\n    _, err := fmt.Scan(&amp;input)\n    if err != nil {\n        fmt.Println(err)\n        continue\n    }\n\n    var record MedicalRecord\n    if err := json.Unmarshal([]byte(input), &amp;record); err != nil {\n        log.Println(err)\n        continue\n    }\n</code></pre>\n\n<p>And the errors are printed to console.</p>\n\n<pre><code>&gt; 2018/06/26 00:26:32 invalid character ':' after top-level value\n&gt; 2018/06/26 00:26:32 unexpected end of JSON input\n&gt; 2018/06/26 00:26:32 invalid character ':' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ',' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ':' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ',' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ':' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ',' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ':' after top-level value\n&gt; 2018/06/26 00:26:32 invalid character ',' after top-level value\n</code></pre>\n\n<p>If I'm not mistaken, Go is reading until it finds '\\n' . How can I solve this problem?</p>\n"}, {"tags": ["go", "amazon-s3", "boto3", "aws-sdk-go"], "comments": [{"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1529979506, "post_id": 51033909, "comment_id": 89060107, "body": "The field <code>x-amz-signature</code> has different key in the json. Is that relevant..?"}, {"owner": {"reputation": 11, "user_id": 9749443, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Harsh Gupta", "link": "https://stackoverflow.com/users/9749443/harsh-gupta"}, "reply_to_user": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1529979685, "post_id": 51033909, "comment_id": 89060146, "body": "I have manually checked parsing errors by printing out each value that gets passed into the form. Unfortunately, no error there!"}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1529980121, "post_id": 51033909, "comment_id": 89060225, "body": "Just to be sure, try <code>json.Unmarshal</code> for getting json into the map. It is less error prone than manually assigning each field."}, {"owner": {"reputation": 11, "user_id": 9749443, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Harsh Gupta", "link": "https://stackoverflow.com/users/9749443/harsh-gupta"}, "reply_to_user": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1529980196, "post_id": 51033909, "comment_id": 89060244, "body": "Already tried! No luck there either."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1529999691, "post_id": 51033909, "comment_id": 89066839, "body": "not to be the annoying you want X try Y guy, but why do you not use the the aws go wrapper? <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go</a>"}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1530008035, "post_id": 51033909, "comment_id": 89071774, "body": "@HarshGupta the <code>file</code> section must be the last one written to the form."}], "owner": {"reputation": 11, "user_id": 9749443, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Harsh Gupta", "link": "https://stackoverflow.com/users/9749443/harsh-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 776, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1529997432, "creation_date": 1529978429, "last_edit_date": 1529997432, "question_id": 51033909, "link": "https://stackoverflow.com/questions/51033909/bucket-post-must-contain-a-field-named-key-error", "title": "&quot;Bucket POST must contain a field named &#39;key&#39;&quot; error", "body": "<p>I am trying to upload a file to s3 using a presigned POST URL (generated using boto3).</p>\n\n<p>These are the fields in the generated presigned URL:</p>\n\n<pre><code>{\"acl\":\"private\",\n\"key\":\"4982bfe3-fae9-42a5-9502-4cc3fcd9ee87__swcli\",\n\"x-amz-algorithm\":\n\"AWS4-HMAC-SHA256\",\n\"x-amz-credential\":\"AKIAICDC2ZVHRX25EYNQ/20180626/us-east-1/s3/aws4_request\",\n\"x-amz-date\":\"20180626T014755Z\",\n\"policy\":\"eyJleDE0NzU1WiJ9XX0=\",\n\"x-amz signature\":\"f803ef38cbdd8a16\"}\n</code></pre>\n\n<p>I am using this code to make the request</p>\n\n<pre><code>x := make(map[string]string)\nx[\"key\"],_ = jsonparser.GetString(*fields,\"key\")\nx[\"acl\"],_ = jsonparser.GetString(*fields,\"acl\")\nx[\"x-amz-algorithm\"],_ = jsonparser.GetString(*fields,\"x-amz-algorithm\")\nx[\"x-amz-credential\"],_ = jsonparser.GetString(*fields,\"x-amz-credential\")\nx[\"x-amz-date\"],_ = jsonparser.GetString(*fields,\"x-amz-date\")\nx[\"policy\"],_ = jsonparser.GetString(*fields,\"policy\")\nx[\"x-amz-signature\"],_ = jsonparser.GetString(*fields,\"x-amz-signature\")\n\nc := new(http.Client)\nreq := request.NewRequest(c)\nreq.Data = x\nf, err := os.Open(\"filewriter.go\")\nif err!=nil{\n    fmt.Println(\"errored\")\n}\n\nreq.Files = []request.FileField{\n    request.FileField{\"file\", \"filewriter.go\", f},\n}\nresp, err := req.Post(\"http://btrads-78.s3.amazonaws.com\")\nfmt.Println((resp.Text()))`\n</code></pre>\n\n<p>And receiving this error:\n<code>Bucket POST must contain a field named 'key'.  If it is specified, please check the order of the fields.</code></p>\n\n<p>I have tried trying different combinations of order of <code>key</code> in x and using different HTTP client, but I am getting the same error. What am I doing wrong?</p>\n"}, {"tags": ["rest", "web-services", "go", "webserver", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1529964526, "last_edit_date": 1529964526, "creation_date": 1529961630, "answer_id": 51031945, "question_id": 51031631, "link": "https://stackoverflow.com/questions/51031631/goroutine-already-started-in-go-web-server-from-request-but-client-disconnects/51031945#51031945", "title": "Goroutine already started in Go web server from request but client disconnects, is it possible for a web server to close that particular goroutine?", "body": "<p>The per-connection goroutine exits on return from the handler if there's an error reading or writing to the connection, or when request or response headers indicate that the connection should be closed.</p>\n\n<p>Handlers can check for a closed connection using the <a href=\"https://godoc.org/context#Context\" rel=\"nofollow noreferrer\">Context</a> returned from <a href=\"https://godoc.org/net/http#Request.Context\" rel=\"nofollow noreferrer\">Request.Context()</a>. </p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529963574, "post_id": 51032112, "comment_id": 89056899, "body": "It&#39;s not valid to use an <code>http.ResponseWriter</code> after the handler has returned. Your first example isn&#39;t going to work."}, {"owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529964313, "post_id": 51032112, "comment_id": 89057101, "body": "@JimB - thanks for calling that out, the example has been updated"}], "tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": true, "score": 5, "last_activity_date": 1529965539, "last_edit_date": 1529965539, "creation_date": 1529962605, "answer_id": 51032112, "question_id": 51031631, "link": "https://stackoverflow.com/questions/51031631/goroutine-already-started-in-go-web-server-from-request-but-client-disconnects/51032112#51032112", "title": "Goroutine already started in Go web server from request but client disconnects, is it possible for a web server to close that particular goroutine?", "body": "<p>Other than exiting on the return from a called handler on a read or write error - the executing go routine will not automatically handle cleaning up longer running operations, but Go provides nice ways of handling this. </p>\n\n<p>First, if you are not familiar with the <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">context package</a> - it is a powerful and idiomatic way to synchronize go routines with cancellation behavior, I highly recommend reading the blog <a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">Go Concurrency Patterns: Context</a>. </p>\n\n<p>Something like the following:</p>\n\n<pre><code>func MyServiceFunc(ctx context.Context) {\n    for {\n        select {\n        case &lt;-ctx.Done():\n            break\n        default:\n            //do work\n        }\n    }\n}\n\nfunc MyRequestHandler(res http.ResponseWriter, req *http.Request) {\n    MyServiceFunc(req.Context())       \n   //write response...\n}\n</code></pre>\n\n<p>Or you could use the <a href=\"https://golang.org/pkg/net/http/#CloseNotifier\" rel=\"noreferrer\">CloseNotifier</a> interface of which a <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\">http.ResponseWriter</a> also implements, you could do something like the following simple example:</p>\n\n<pre><code>func MyServiceFunc(notifier &lt;-chan bool) {\n    for {\n        select {\n        case &lt;-notifier:\n            break\n        default:\n            //do work\n        }\n    }\n}\n\n\nfunc MyRequestHandler(res http.ResponseWriter, req *http.Request) {\n    notifier := res.(http.CloseNotifier).CloseNotify()\n    MyServiceFunc(notifier)\n    //write response...\n}\n</code></pre>\n\n<p>Or, and simple example using combining both approaches:</p>\n\n<pre><code>func MyRequestHandler(res http.ResponseWriter, req *http.Request) {\n\n    notifier := res.(http.CloseNotifier).CloseNotify()\n    ctx, cancel := context.WithCancel(req.Context())\n\n    go func(closer &lt;-chan bool) {\n        &lt;-closer //the notifer blocks until the send\n        cancel() //explicitly cancel all go routines\n    }(notifier)\n\n    go MyServiceFunc(ctx)\n    MyOtherServiceFunc(ctx)\n    //write response...\n}\n</code></pre>\n"}], "owner": {"reputation": 283, "user_id": 8091409, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/caddbf74cbce6baab47a0f887893cc28?s=128&d=identicon&r=PG&f=1", "display_name": "RichyDavisWindow3", "link": "https://stackoverflow.com/users/8091409/richydaviswindow3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 1, "accepted_answer_id": 51032112, "answer_count": 2, "score": 0, "last_activity_date": 1529965539, "creation_date": 1529959991, "question_id": 51031631, "link": "https://stackoverflow.com/questions/51031631/goroutine-already-started-in-go-web-server-from-request-but-client-disconnects", "title": "Goroutine already started in Go web server from request but client disconnects, is it possible for a web server to close that particular goroutine?", "body": "<p>Whenever a web request comes in from the client it would spawn a goroutine to handle each. If the client just happen to disconnect from the connection, is it possible for a web server to close that particular goroutine or will that goroutine find out that the client had already diconnected after it had executed all its code?</p>\n"}, {"tags": ["go", "cassandra", "gocql"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9975520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbffb679a9ae3e309450bbec137b6e9e?s=128&d=identicon&r=PG&f=1", "display_name": "DKM", "link": "https://stackoverflow.com/users/9975520/dkm"}, "edited": false, "score": 1, "creation_date": 1531341923, "post_id": 51031618, "comment_id": 89565310, "body": "Can you help with an example where we pass an mocked instance of a cassandra session. The above example is good but isn&#39;t comprehensive enough. I wandering if i&#39;ve something like sarecords := summarizeRecords(fileid, &quot;CURRENT_CHARGES_BY_SUBACCOUNT_SERVICE_TYPE&quot;, dat, Csession) where Csession := *gocql.session can we pass a mocked instance of Csession which is nothing but a mocked or faked version of the cassandra session."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 31, "user_id": 9975520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbffb679a9ae3e309450bbec137b6e9e?s=128&d=identicon&r=PG&f=1", "display_name": "DKM", "link": "https://stackoverflow.com/users/9975520/dkm"}, "edited": false, "score": 0, "creation_date": 1531379715, "post_id": 51031618, "comment_id": 89575632, "body": "in your <code>summarizeRecords(...)</code> method, type the function accepts for <code>Csession</code> would be <code>SessionInterface</code> from above and not <code>*gocql.session</code>"}, {"owner": {"reputation": 31, "user_id": 9975520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbffb679a9ae3e309450bbec137b6e9e?s=128&d=identicon&r=PG&f=1", "display_name": "DKM", "link": "https://stackoverflow.com/users/9975520/dkm"}, "edited": false, "score": 0, "creation_date": 1531499806, "post_id": 51031618, "comment_id": 89634547, "body": "can i have a sample example where in we make use of the cassandra mocked session to query the DB."}, {"owner": {"reputation": 822, "user_id": 304627, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3c7937727245441d3d064072e1cf552?s=128&d=identicon&r=PG", "display_name": "Landon Poch", "link": "https://stackoverflow.com/users/304627/landon-poch"}, "edited": false, "score": 0, "creation_date": 1548101044, "post_id": 51031618, "comment_id": 95414416, "body": "-1.  From what I can tell this wont work.  If a method returns a pointer to a struct, you can&#39;t just create an interface for that struct that is returned.  Even an empty interface doesn&#39;t work.  From what I can tell, golang doesn&#39;t work like that.  Structural typing in golang is a lie."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 822, "user_id": 304627, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3c7937727245441d3d064072e1cf552?s=128&d=identicon&r=PG", "display_name": "Landon Poch", "link": "https://stackoverflow.com/users/304627/landon-poch"}, "edited": false, "score": 0, "creation_date": 1565261559, "post_id": 51031618, "comment_id": 101301945, "body": "@LandonPoch: sure you can. That is the power of interfaces. You can use them to mock out packages/code that someone else created without having to change that code. That is not possible with most other languages."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 4, "last_activity_date": 1529959897, "creation_date": 1529959897, "answer_id": 51031618, "question_id": 51031167, "link": "https://stackoverflow.com/questions/51031167/how-can-we-mock-cassandra-session-using-golang/51031618#51031618", "title": "How can we mock cassandra session using golang?", "body": "<p>In general the best thing to do is to use interfaces instead of the real cassandra library implementation.</p>\n\n<p>You've not included an example so I've created on below:</p>\n\n<pre><code>type Service struct {\n    session *gocql.Session\n}\n\nfunc (s *Service) Tweets() {\n\n    var id gocql.UUID\n    var text string\n\n    q := `SELECT id, text FROM tweet WHERE timeline = ? LIMIT 1`\n    if err := s.session.Query(q, \"me\").Consistency(gocql.One).Scan(&amp;id, &amp;text); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Tweet:\", id, text)\n\n}\n</code></pre>\n\n<p>In this example we use the <code>s.session</code> field from the <code>*Service</code> method receiver.</p>\n\n<p>Instead of using the session directly, we can create interfaces that allow us to later create mocks.</p>\n\n<pre><code>// SessionInterface allows gomock mock of gocql.Session\ntype SessionInterface interface {\n    Query(string, ...interface{}) QueryInterface\n}\n\n// QueryInterface allows gomock mock of gocql.Query\ntype QueryInterface interface {\n    Bind(...interface{}) QueryInterface\n    Exec() error\n    Iter() IterInterface\n    Scan(...interface{}) error\n}\n</code></pre>\n\n<p>Now our updated code might look like:</p>\n\n<pre><code>type Service struct {\n    session SessionInterface\n}\n</code></pre>\n\n<p>This means that we can implement the <code>SessionInterface</code> with a mock implementation and control the return values for testing.</p>\n\n<p>Full code example of interfaces <a href=\"https://github.com/gocql/gocql/issues/415#issuecomment-277530829\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 2271, "user_id": 1258206, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5755725ec0aec99e7132aa4c40f224e0?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/1258206/tom"}, "is_accepted": false, "score": 2, "last_activity_date": 1584026114, "creation_date": 1584026114, "answer_id": 60656977, "question_id": 51031167, "link": "https://stackoverflow.com/questions/51031167/how-can-we-mock-cassandra-session-using-golang/60656977#60656977", "title": "How can we mock cassandra session using golang?", "body": "<p>This question is a bit old, but I also found the <a href=\"https://godoc.org/github.com/willfaught/gockle\" rel=\"nofollow noreferrer\">gockle</a> library, which contains an <code>interface</code> for the mock-worth driver components.  This library is referenced by the <code>gocql</code> library in the <a href=\"https://github.com/gocql/gocql#ecosystem\" rel=\"nofollow noreferrer\">README</a>. </p>\n"}], "owner": {"reputation": 31, "user_id": 9975520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbffb679a9ae3e309450bbec137b6e9e?s=128&d=identicon&r=PG&f=1", "display_name": "DKM", "link": "https://stackoverflow.com/users/9975520/dkm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1774, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1584026114, "creation_date": 1529957514, "question_id": 51031167, "link": "https://stackoverflow.com/questions/51031167/how-can-we-mock-cassandra-session-using-golang", "title": "How can we mock cassandra session using golang?", "body": "<p>Q : Is there any way to mock casssandra session using go without actually connecting to any keyspace/schema/DB. Can we mock cassandra for unit testing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1529959805, "post_id": 51031116, "comment_id": 89055580, "body": "This is largely opinion based, but I&#39;ll give my opinion anyway: general best practice in Go is &quot;accept interfaces, return structs&quot;. And an exported function should never reference an unexported type in its signature. So, I would recommend the first version."}], "answers": [{"comments": [{"owner": {"reputation": 134, "user_id": 1589471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a61b8e08bbee31b000a76eb716e2191a?s=128&d=identicon&r=PG", "display_name": "psampaz", "link": "https://stackoverflow.com/users/1589471/psampaz"}, "edited": false, "score": 0, "creation_date": 1530218709, "post_id": 51031585, "comment_id": 89170181, "body": "After searching a little bit more based on this answer, I ended up in this great talk by Francesc Campoy Flores called &quot;Understanding Go Interfaces&quot;.  Must see for everyone searching to understand Go interfaces better. <a href=\"https://www.youtube.com/watch?v=F4wUrj6pmSI\" rel=\"nofollow noreferrer\">youtube.com/watch?v=F4wUrj6pmSI</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 7, "last_activity_date": 1529961417, "last_edit_date": 1529961417, "creation_date": 1529959741, "answer_id": 51031585, "question_id": 51031116, "link": "https://stackoverflow.com/questions/51031116/export-interfaces-instead-of-structs-from-golang-packages/51031585#51031585", "title": "Export interfaces instead of structs from golang packages", "body": "<p>Interfaces in Go work (and are used) a bit differently that what you'd expect if you come from other languages such as Java.</p>\n\n<p>In Go, the object <em>implementing</em> the interface does not need to <em>explicitly</em> say it implements it.</p>\n\n<p>That has subtle ramifications, such as the <em>consumer</em> of a type being able to decouple from the <em>implementation</em> even if the implementing side did not bother (or think about) creating an interface in the first place.</p>\n\n<p>So, the idiomatic way in Go would be to use a variation of your first approach.</p>\n\n<p>You'd define <code>customer1.go</code> exactly as you did (so implementation of the type is as simple as possible).</p>\n\n<p>Then <strong>if necessary</strong> you can de-couple in the consumer (your <code>main</code> package in this case) by defining an interface there:</p>\n\n<pre><code>type Customer interface {\n    Name() string\n}\n\nfunc main() {\n\n    var c1 Customer\n    c1 := customer1.NewCustomer(\"John\")\n    fmt.Println(c1.Name())\n\n}\n</code></pre>\n\n<p>That way, your <code>main</code> implementation can work with any type that has a <code>Name()</code> method, even if the package implementing the type in the first place did not think about that need.</p>\n\n<p>To achieve extensibility, this is usually also applied for functions you export that receive parameters.</p>\n\n<p>If you are exporting a function like this:</p>\n\n<pre><code>func PrintName(customer Customer) {\n    fmt.Println(customer.Name())\n}\n</code></pre>\n\n<p>Then that function can be invoked with any object that implements <code>Customer</code> (any of your implementations would work for example).</p>\n"}], "owner": {"reputation": 134, "user_id": 1589471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a61b8e08bbee31b000a76eb716e2191a?s=128&d=identicon&r=PG", "display_name": "psampaz", "link": "https://stackoverflow.com/users/1589471/psampaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3181, "favorite_count": 1, "accepted_answer_id": 51031585, "answer_count": 1, "score": 6, "last_activity_date": 1529961417, "creation_date": 1529957249, "last_edit_date": 1529959568, "question_id": 51031116, "link": "https://stackoverflow.com/questions/51031116/export-interfaces-instead-of-structs-from-golang-packages", "title": "Export interfaces instead of structs from golang packages", "body": "<p>Below you can find three different ways of calling a method Name() of a customer struct. The result is exactly the same but each one of the three package exports different things:</p>\n\n<pre><code>package main\n\nimport (\n    \"customer1\"\n    \"customer2\"\n    \"customer3\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n\n    c1 := customer1.NewCustomer(\"John\")\n    fmt.Println(c1.Name())\n\n    c2 := customer2.NewCustomer(\"John\")\n    fmt.Println(c2.Name())\n\n    c3 := customer3.NewCustomer(\"John\")\n    fmt.Println(c3.Name())\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>John\nJohn\nJohn\n</code></pre>\n\n<p>customer1.go (Export Customer struct and Name() method)</p>\n\n<pre><code>package customer1\n\ntype Customer struct {\n    name string\n}\n\nfunc NewCustomer(name string) * Customer{\n    return &amp;Customer{name: name}\n}\n\nfunc (c *Customer) Name() string {\n    return c.name\n}\n</code></pre>\n\n<p>customer2.go (Do not export customer struct. Export only Name() method)</p>\n\n<pre><code>package customer2\n\ntype customer struct {\n    name string\n}\n\nfunc NewCustomer(name string) *customer {\n    return &amp;customer{name: name}\n}\n\nfunc (c *customer) Name() string {\n    return c.name\n}\n</code></pre>\n\n<p>customer3.go (Do not export customer struct. Export Customer Interface)</p>\n\n<pre><code>package customer3\n\ntype Customer interface {\n    Name() string\n}\ntype customer struct {\n    name string\n}\n\nfunc NewCustomer(name string) Customer {\n    return &amp;customer{name: name}\n}\n\nfunc (c *customer) Name() string {\n    return c.name\n}\n</code></pre>\n\n<p>My question is which approach you would recommend and why? Which is better in terms of extensibility and maintainability? Which one you would use for a large project? </p>\n\n<p>It seems that customer3 approach is officially discouraged (// DO NOT DO IT!!!) as you can read here <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#interfaces\" rel=\"noreferrer\">https://github.com/golang/go/wiki/CodeReviewComments#interfaces</a></p>\n"}, {"tags": ["c++11", "go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "is_accepted": false, "score": 1, "last_activity_date": 1530309107, "creation_date": 1530309107, "answer_id": 51109843, "question_id": 51030039, "link": "https://stackoverflow.com/questions/51030039/cgo-doesnt-include-cxxflags/51109843#51109843", "title": "cgo doesn&#39;t include CXXFLAGS", "body": "<p>Please refer to the following SO question: <a href=\"https://stackoverflow.com/questions/495598/difference-between-cppflags-and-cxxflags-in-gnu-make#495646\">Difference between CPPFLAGS and CXXFLAGS in GNU Make</a> to figure out which flags you really need in the context of your program.</p>\n\n<p>If you are calling pure C code (and not C++ code), I don't think you will need <code>CXX_FLAGS</code>:</p>\n\n<blockquote>\n  <p><code>CPPFLAGS</code> are supposed to be flags for the C PreProcessor; <code>CXXFLAGS</code> are flags for the C++ compiler.</p>\n</blockquote>\n\n<p>You might also want to check your <code>go env</code>. If you really need this flag, you can try to compile your program using <code>env CGO_CXXFLAGS=\"-std=c++11\" go build &lt;YOUR_CODE&gt;</code>.</p>\n"}], "owner": {"reputation": 119, "user_id": 5083152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d54baa37686a11a6b706ea0736fa0303?s=128&d=identicon&r=PG", "display_name": "co11ter", "link": "https://stackoverflow.com/users/5083152/co11ter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 964, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1592921448, "creation_date": 1529952361, "question_id": 51030039, "link": "https://stackoverflow.com/questions/51030039/cgo-doesnt-include-cxxflags", "title": "cgo doesn&#39;t include CXXFLAGS", "body": "<p>I want to call C code in Golang:</p>\n\n<pre><code>// #cgo CFLAGS: -I/usr/include/c++/8.1.1/bits\n// #cgo CXXFLAGS: -std=gnu++11\n// #include \"c++0x_warning.h\"\nimport \"C\"\n</code></pre>\n\n<p>but get error:</p>\n\n<pre><code>In file included from ./main.go:5:\n/usr/include/c++/8.1.1/bits/c++0x_warning.h:32:2: error: #error This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n</code></pre>\n\n<p>So cgo doesn't use CXXFLAGS. I tried <code>-std=c++11</code> and it doesn't work too. What I do wrong?</p>\n\n<pre><code>$ go version\ngo version go1.10.3 linux/amd64\n</code></pre>\n"}, {"tags": ["json", "http", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1529951892, "post_id": 51029868, "comment_id": 89052090, "body": "&quot;I cannot Unmarshall it&quot; - why? What happens? Please post any error(s) you get and the invalid response body you received."}, {"owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "edited": false, "score": 2, "creation_date": 1529952028, "post_id": 51029868, "comment_id": 89052156, "body": "If you just want to see the response so you can decode it, then you can use <code>fmt.Println(string(body))</code>.  However, I would say that the output of <code>log.Fatal(jsonErr)</code> should be providing the information that you need to fix the problem, likely that the <code>place</code> type, or one(all) of its fields is not exported."}, {"owner": {"reputation": 320, "user_id": 4140475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb662a48fb0d327aa1b1b876469db21?s=128&d=identicon&r=PG&f=1", "display_name": "OmegaNalphA", "link": "https://stackoverflow.com/users/4140475/omeganalpha"}, "reply_to_user": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "edited": false, "score": 0, "creation_date": 1529952363, "post_id": 51029868, "comment_id": 89052336, "body": "I realized the issue, I wasn&#39;t receiving JSON at all since the url was incorrect. thank you @threeve for the string(body) recommendation that helped me realize the mistake, it&#39;s working now!"}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 4140475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb662a48fb0d327aa1b1b876469db21?s=128&d=identicon&r=PG&f=1", "display_name": "OmegaNalphA", "link": "https://stackoverflow.com/users/4140475/omeganalpha"}, "is_accepted": true, "score": -1, "last_activity_date": 1529952308, "creation_date": 1529952308, "answer_id": 51030028, "question_id": 51029868, "link": "https://stackoverflow.com/questions/51029868/using-http-client-for-places-api-in-golang-unmarshall-json-and-invalid-characte/51030028#51030028", "title": "Using HTTP Client for Places API in golang, Unmarshall JSON and invalid characters", "body": "<p>Thank you for the help, ended up finding the answer. The issue was partly with my understanding of the Places API, I had entered <code>https://maps.googleapis.com/maps/api/place/findplacefromtext/</code> but need to make sure to put <code>https://maps.googleapis.com/maps/api/place/findplacefromtext/json</code> The JSON part at the end specifies the return type, otherwise my body was constantly getting 404 errors. This can be fixed by adding:</p>\n\n<pre><code>if res.StatusCode == 404 {\n    log.Fatal(\"Hit a 404\")\n}\n</code></pre>\n\n<p>Also, if you just want to print out the byte string, this worked for me </p>\n\n<pre><code>n := len(body)\ns := string(body[:n])\n\npln(s)\n</code></pre>\n\n<p>this allows you to see what is being printed easier</p>\n"}], "owner": {"reputation": 320, "user_id": 4140475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb662a48fb0d327aa1b1b876469db21?s=128&d=identicon&r=PG&f=1", "display_name": "OmegaNalphA", "link": "https://stackoverflow.com/users/4140475/omeganalpha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 51030028, "answer_count": 1, "score": -2, "last_activity_date": 1529952308, "creation_date": 1529951604, "question_id": 51029868, "link": "https://stackoverflow.com/questions/51029868/using-http-client-for-places-api-in-golang-unmarshall-json-and-invalid-characte", "title": "Using HTTP Client for Places API in golang, Unmarshall JSON and invalid characters", "body": "<p>I am pretty new to Go, learning how to use it. Wanted to test hitting the Google Places API, but am having some trouble in writing the request. It seems the request goes through, I receive something in the body, but I cannot Unmarshall it. I just want to see the json printed in string form so I can try to decode it. Any help is appreciated, thank you!</p>\n\n<pre><code>type place struct {\n    Name string `json:candidates`\n}\n\nfunc main() {\n    places(\"Grill\")\n}\n\nfunc places(inputText string) {\nurl := \"https://maps.googleapis.com/maps/api/place/findplacefromtext/\"\n\nplacesClient := http.Client{\n    Timeout: time.Second * 10,\n}\n\nreq, err := http.NewRequest(http.MethodGet, url, nil)\nif err != nil {\n    log.Fatal(err)\n}\n\nreq.Header.Set(\"User-Agent\", \"Testing how to query API's from parameters\")\nq := req.URL.Query()\nq.Add(\"key\", PLACES_KEY)\nq.Add(\"input\", inputText)\nq.Add(\"inputtype\", \"textquery\")\nreq.URL.RawQuery = q.Encode()\npln(req.URL.String())\n\nres, getErr := placesClient.Do(req)\nif getErr != nil {\n    log.Fatal(getErr)\n}\n\nbody, readErr := ioutil.ReadAll(res.Body)\nif readErr != nil {\n    log.Fatal(readErr)\n}\n\noutput := place{}\njsonErr := json.Unmarshal(body, &amp;output)\nif jsonErr != nil {\n    log.Fatal(jsonErr)\n}\n\npln(output)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1529951837, "creation_date": 1529951837, "answer_id": 51029926, "question_id": 51029856, "link": "https://stackoverflow.com/questions/51029856/go-lang-run-a-shell-to-check-all-files-in-a-directory/51029926#51029926", "title": "go lang run a shell to check all files in a directory", "body": "<p>Wildcards like this are evaluated by the shell, not by <code>ls</code>, and <code>exec</code> does not use a shell. You could do something like:</p>\n\n<pre><code>exec.Command(\"bash\", \"-c\", \"ls *.txt\")\n</code></pre>\n\n<p><strong>However</strong>, it's unnecessarily complicated &amp; inefficient to list files this way in your Go program. You'd be better served just scanning the files directly in Go using e.g. <a href=\"https://golang.org/pkg/io/ioutil/#ReadDir\" rel=\"nofollow noreferrer\"><code>ReadDir</code></a>.</p>\n"}], "owner": {"reputation": 275, "user_id": 8552794, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3lufd.jpg?s=128&g=1", "display_name": "Venkata S S K M Chaitanya", "link": "https://stackoverflow.com/users/8552794/venkata-s-s-k-m-chaitanya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 51029926, "answer_count": 1, "score": -2, "last_activity_date": 1529951837, "creation_date": 1529951534, "question_id": 51029856, "link": "https://stackoverflow.com/questions/51029856/go-lang-run-a-shell-to-check-all-files-in-a-directory", "title": "go lang run a shell to check all files in a directory", "body": "<p>Can someone let me know how to run \"<code>ls *.txt</code>\" as a shell command in go.</p>\n\n<p>I have run using <code>exec.Command(\"ls\", \"*.txt\")</code>, It shows *.txt file not found.</p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 1014, "user_id": 2447860, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ce99f307eeddec0a6912d7b9b73e91e2?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Zheng", "link": "https://stackoverflow.com/users/2447860/eric-zheng"}, "edited": false, "score": 9, "creation_date": 1591152918, "post_id": 51031713, "comment_id": 109944347, "body": "&quot;Multiple returns on the same mock.&quot; doesn&#39;t work for me. It keep returning the last one for multiple calls"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 11, "last_activity_date": 1529960467, "creation_date": 1529960467, "answer_id": 51031713, "question_id": 51029598, "link": "https://stackoverflow.com/questions/51029598/mocking-same-functions-with-different-response-many-times-one-after-the-other-in/51031713#51031713", "title": "Mocking same functions with different response many times one after the other in Go lang", "body": "<p>The gomock package provides a number methods for ordering.</p>\n\n<p>A note before examples: Using the example you've given, once <code>first</code> is called once, and returns it's values. It will be marked as \"used\" and \"complete\", and not considered again.</p>\n\n<p>You will need to set up the expectations again if this has happened.</p>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>By default, expected calls are not enforced to run in any particular order. Call order dependency can be enforced by use of InOrder and/or Call.After. Call.After can create more varied call order dependencies, but InOrder is often more convenient.</p>\n</blockquote>\n\n<p><a href=\"https://godoc.org/github.com/golang/mock/gomock\" rel=\"noreferrer\">Link</a></p>\n\n<h2>Two choices for ordering mocks</h2>\n\n<p><strong>Ordering of separate mocks</strong>:</p>\n\n<pre><code>first := mockClient.EXPECT().Do(gomock.Any()).Return(defaultResponse, nil)\nsecond := mockClient.EXPECT().Do(gomock.Any()).Return(defaultResp, nil)\n\ngomock.InOrder(\n    first,\n    second,\n)\n</code></pre>\n\n<p>Seeing as the mocks accept exactly the same arguments, you can set up...</p>\n\n<p><strong>Multiple returns on the same mock</strong>.</p>\n\n<pre><code>mockClient.EXPECT().\n    Do(gomock.Any()).\n    Return(defaultResponse, nil).\n    Return(defaultResp, nil)\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 6596838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f85db4278d0860e53b56ce4d70ed89d8?s=128&d=identicon&r=PG&f=1", "display_name": "Ananth Upadhya", "link": "https://stackoverflow.com/users/6596838/ananth-upadhya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8560, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1529960467, "creation_date": 1529950373, "question_id": 51029598, "link": "https://stackoverflow.com/questions/51029598/mocking-same-functions-with-different-response-many-times-one-after-the-other-in", "title": "Mocking same functions with different response many times one after the other in Go lang", "body": "<pre><code>first := mockClient.EXPECT().Do(gomock.Any()).Return(defaultResponse, nil)\nmockClient.EXPECT().Do(gomock.Any()).Return(defaultResp, nil).After(first)\n</code></pre>\n\n<p>How can i call these two mocks one after the other many times ? Is this the correct way to call mocks? I need to execute the first mock first and then the second mockclient. So i have followed this approach. But i need to call them for series of test inputs in my UNIT tests.Where every time the first one should executed first and the second one after that. But i see this is happening for only once and the next time only the second one is called.</p>\n"}, {"tags": ["go", "go-gorm", "go-gin"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1529948225, "post_id": 51028869, "comment_id": 89050450, "body": "Would you happen to be asking because of an &quot;update&quot; workflow? <a href=\"http://doc.gorm.io/crud.html#update\" rel=\"nofollow noreferrer\">doc.gorm.io/crud.html#update</a>, ie getting the object, modifying a field, and not wanting to update/overwrite fields with those zero vaules?"}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1529948479, "post_id": 51028869, "comment_id": 89050567, "body": "@dm03514 the update workflow is working as intended in my other methods and I don&#39;t mind the default value stuff, I just really don&#39;t want to send an entire object out from the api with every table key even if empty, I guess I&#39;m also trying to avoid just returning a mapped object also, I&#39;d prefer to edit my pointer and just return that for the output."}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1529948588, "post_id": 51028869, "comment_id": 89050617, "body": "I&#39;ve updated my question to also include the gin handler to give a little better context of the whole process I&#39;m currently doing"}, {"owner": {"reputation": 4316, "user_id": 486035, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1654e9816b6e407e1daced17ac4fcf3b?s=128&d=identicon&r=PG", "display_name": "phemmer", "link": "https://stackoverflow.com/users/486035/phemmer"}, "edited": false, "score": 1, "creation_date": 1529948722, "post_id": 51028869, "comment_id": 89050669, "body": "Your fields are empty. If you want them to be null, you need a field that is capable of null. A string cannot be null. A pointer to a string can be."}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "reply_to_user": {"reputation": 4316, "user_id": 486035, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1654e9816b6e407e1daced17ac4fcf3b?s=128&d=identicon&r=PG", "display_name": "phemmer", "link": "https://stackoverflow.com/users/486035/phemmer"}, "edited": false, "score": 0, "creation_date": 1529948828, "post_id": 51028869, "comment_id": 89050723, "body": "@Patrick If you see in the response even when a property is made <code>null</code> it&#39;s not removed from the object, I&#39;m looking to remove these properties so it can then be sent back off as json in the return, I don&#39;t think simply setting them to a nullable type will change that"}], "answers": [{"comments": [{"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1529949145, "post_id": 51029235, "comment_id": 89050856, "body": "Looks promising, based on the description I&#39;ll give it a try."}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1529949314, "post_id": 51029235, "comment_id": 89050931, "body": "This is precisely what I have been looking for and could not find from the gorm manual, thank you very much for your answer."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 6, "last_activity_date": 1529949035, "creation_date": 1529949035, "answer_id": 51029235, "question_id": 51028869, "link": "https://stackoverflow.com/questions/51028869/how-can-i-remove-a-property-from-a-object/51029235#51029235", "title": "How can I remove a property from a object", "body": "<p>You can specify the <code>omitempty</code> tag in your object's fields definitions.</p>\n\n<p>Example:</p>\n\n<pre><code>Email string `json:\",omitempty\"`\n</code></pre>\n\n<p>If you define the fields that way, empty values will not be present in the JSON output:</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<blockquote>\n  <p>The \"omitempty\" option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.</p>\n</blockquote>\n"}], "owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2395, "favorite_count": 2, "accepted_answer_id": 51029235, "answer_count": 1, "score": 0, "last_activity_date": 1539070622, "creation_date": 1529947514, "last_edit_date": 1539070622, "question_id": 51028869, "link": "https://stackoverflow.com/questions/51028869/how-can-i-remove-a-property-from-a-object", "title": "How can I remove a property from a object", "body": "<p>I have a User struct:</p>\n\n<pre><code>type User struct {\n    gorm.Model\n    Email         string\n    Password      string\n    AccountType   int\n    CompanyId     int\n    FirstName     string\n    LastName      string\n    PhoneNumber   string\n    RecoveryEmail string\n    Contractor    bool `gorm:\"sql:'not null' default:'false'\"`\n}\n</code></pre>\n\n<p>I'm using this struct to get a row from the database using <code>gorm</code>:</p>\n\n<pre><code>// Get a specific user from the database.\nfunc getUser(id uint) (*User, error) {\n\n    var user User\n\n    if err := database.Connection.Select(\"id, created_at, email, account_type, company_id, first_name, last_name\").Where(\"id = ? \", id).First(&amp;user).Error; err != nil {\n        return nil, err\n    }\n\n    fmt.Println(&amp;user)\n    return &amp;user, nil\n}\n</code></pre>\n\n<p>My Gin hanlder:</p>\n\n<pre><code>// @Summary Attempts to get a existing user by id\n// @tags users\n// @Router /api/users/getUserById [get]\nfunc HandleGetUserById(c *gin.Context) {\n    // Were using delete params as it shares the same interface.\n    var json deleteParams\n\n    if err := c.Bind(&amp;json); err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"message\": \"No user ID found, please try again.\"})\n        return\n    }\n\n    outcome, err := getUser(json.Id)\n\n    if err != nil {\n        c.JSON(http.StatusInternalServerError, gin.H{\"message\": \"Something went wrong while trying to process that, please try again.\", \"error\": err.Error()})\n        log.Println(err)\n        return\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        \"message\": \"Successfully found user\",\n        \"user\":    outcome,\n    })\n\n}\n</code></pre>\n\n<p>It returns back everything fine, but when I return <code>&amp;user</code> the fields not selected are returned back with default values:</p>\n\n<pre><code>{\n    \"message\": \"Successfully found user\",\n    \"user\": {\n        \"ID\": 53,\n        \"CreatedAt\": \"2018-06-24T00:05:49.761736+01:00\",\n        \"UpdatedAt\": \"0001-01-01T00:00:00Z\",\n        \"DeletedAt\": null,\n        \"Email\": \"jack@jackner.com\",\n        \"Password\": \"\",\n        \"AccountType\": 0,\n        \"CompanyId\": 2,\n        \"FirstName\": \"\",\n        \"LastName\": \"\",\n        \"PhoneNumber\": \"\",\n        \"RecoveryEmail\": \"\",\n        \"Contractor\": false\n    }\n}\n</code></pre>\n\n<p>Is there a way in go to remove empty or null properties from an object? Or will I have to send back an object instead with the values mapped to said new object? If there's a simple way of doing the former with a helper function I'd like to know how.</p>\n"}, {"tags": ["docker", "go", "versioning"], "comments": [{"owner": {"reputation": 6973, "user_id": 1252307, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/538fa74aef355cfc62f8d292e215a24d?s=128&d=identicon&r=PG", "display_name": "kev", "link": "https://stackoverflow.com/users/1252307/kev"}, "edited": false, "score": 1, "creation_date": 1548892056, "post_id": 51028784, "comment_id": 95711016, "body": "Just ran into the same issue: <code>client version 1.40 is too new. Maximum supported API version is 1.39.</code> It doesn&#39;t make sense to me to set the client version to something higher than the currently supported API version (1.39 as of now): <a href=\"https://docs.docker.com/develop/sdk/\" rel=\"nofollow noreferrer\">docs.docker.com/develop/sdk</a>."}], "answers": [{"tags": [], "owner": {"reputation": 20114, "user_id": 691711, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/bf26891a2ec4eca6dd1962a6804f5a40?s=128&d=identicon&r=PG", "display_name": "zero298", "link": "https://stackoverflow.com/users/691711/zero298"}, "is_accepted": false, "score": 30, "last_activity_date": 1529948760, "last_edit_date": 1529948760, "creation_date": 1529947494, "answer_id": 51028864, "question_id": 51028784, "link": "https://stackoverflow.com/questions/51028784/can-i-pin-docker-api-version-client-version-1-38-is-too-new-maximum-supported/51028864#51028864", "title": "Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37", "body": "<p>You can ask for a version specifically with <a href=\"https://godoc.org/github.com/docker/docker/client#NewClientWithOpts\" rel=\"noreferrer\"><code>NewClientWithOpts()</code></a>.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/docker/docker/api/types/container\"\n    \"github.com/docker/docker/client\"\n    \"golang.org/x/net/context\"\n)\n\nfunc main() {\n    ctx := context.Background()\n    cli, err := client.NewClientWithOpts(client.WithVersion(\"1.37\"))\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>See <a href=\"https://docs.docker.com/develop/sdk/#versioned-api-and-sdk\" rel=\"noreferrer\">Versioned API and SDK</a>.  At the tail end it brings up using the Go API and (tries) to link to the relevant code:</p>\n\n<blockquote>\n  <p>You can specify the API version to use, in one of the following ways:</p>\n  \n  <ul>\n  <li><p>...</p></li>\n  <li><p>...</p></li>\n  <li><p>...</p></li>\n  <li><p>For the SDKs, you can also specify the API version programmatically, as a parameter to the <code>client</code> object. See the <a href=\"https://github.com/moby/moby/blob/master/client/client.go#L136\" rel=\"noreferrer\">Go\n  constructor</a>\n  or the <a href=\"https://docker-py.readthedocs.io/en/stable/client.html\" rel=\"noreferrer\">Python SDK documentation for\n  <code>client</code></a>.</p></li>\n  </ul>\n</blockquote>\n\n<p>The docs hard link to a line number on the <code>master</code> branch which has probably changed, but the code above should provide you with enough context to understand.</p>\n"}, {"tags": [], "owner": {"reputation": 1518, "user_id": 3150057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32880beea401dfe8fdccd7bced822d5d?s=128&d=identicon&r=PG", "display_name": "Henry Blyth", "link": "https://stackoverflow.com/users/3150057/henry-blyth"}, "is_accepted": true, "score": 11, "last_activity_date": 1564428571, "creation_date": 1564428571, "answer_id": 57260324, "question_id": 51028784, "link": "https://stackoverflow.com/questions/51028784/can-i-pin-docker-api-version-client-version-1-38-is-too-new-maximum-supported/57260324#57260324", "title": "Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37", "body": "<p>I had the exact same problem and @zero298's answer worked perfectly for me =)</p>\n\n<p>Then I found <code>client.WithAPIVersionNegotiation()</code> and that also worked!</p>\n\n<p>If you don't require pinning the version and just want the code to work with whatever version your machine is running, I think this option will suite your needs.</p>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 8493508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6259e5a1326126e6553800ba4029d522?s=128&d=identicon&r=PG&f=1", "display_name": "yadda", "link": "https://stackoverflow.com/users/8493508/yadda"}, "is_accepted": false, "score": 2, "last_activity_date": 1579935934, "last_edit_date": 1579935934, "creation_date": 1579934464, "answer_id": 59906970, "question_id": 51028784, "link": "https://stackoverflow.com/questions/51028784/can-i-pin-docker-api-version-client-version-1-38-is-too-new-maximum-supported/59906970#59906970", "title": "Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37", "body": "<pre><code>ctx := context.Background()\ncli, err := client.NewClientWithOpts(client.FromEnv)\nif err != nil {\n   panic(err)\n}\ncli.NegotiateAPIVersion(ctx)  // this line can negotiate API version\n</code></pre>\n\n<p><a href=\"https://github.com/moby/moby/blob/master/client/client.go#L205\" rel=\"nofollow noreferrer\">NegotiateAPIVersion</a> of client method can solve this API version mismatch problem.</p>\n"}], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9797, "favorite_count": 3, "accepted_answer_id": 57260324, "answer_count": 3, "score": 20, "last_activity_date": 1579935934, "creation_date": 1529947143, "last_edit_date": 1578408166, "question_id": 51028784, "link": "https://stackoverflow.com/questions/51028784/can-i-pin-docker-api-version-client-version-1-38-is-too-new-maximum-supported", "title": "Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37", "body": "<p>Is there a way to pin docker API version using the golang client? (short of using <a href=\"https://github.com/golang/dep\" rel=\"noreferrer\">dep for vendoring</a>)</p>\n\n<p>code below fails with</p>\n\n<pre><code>client version 1.38 is too new. Maximum supported API version is 1.37\n</code></pre>\n\n<p>This code ran fine until recently</p>\n\n<pre><code>go version go1.9.5 linux/amd64\n</code></pre>\n\n<p>here is :  <code>docker version</code></p>\n\n<pre><code>Client:\n Version:      18.05.0-ce\n API version:  1.37\n Go version:   go1.9.5\n Git commit:   f150324\n Built:        Wed May  9 22:16:25 2018\n OS/Arch:      linux/amd64\n Experimental: false\n Orchestrator: swarm\n\nServer:\n Engine:\n  Version:      18.05.0-ce\n  API version:  1.37 (minimum version 1.12)\n  Go version:   go1.9.5\n  Git commit:   f150324\n  Built:        Wed May  9 22:14:32 2018\n  OS/Arch:      linux/amd64\n  Experimental: false\n</code></pre>\n\n<p>this kicks up the API version mismatch</p>\n\n<pre><code>package main\n\n// kill off some containers\n\nimport (\n    \"fmt\"\n\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/client\"\n    \"golang.org/x/net/context\"\n\n    \"strings\"\n)\n\nfunc main() {\n    ctx := context.Background()\n    cli, err := client.NewEnvClient()\n    if err != nil {\n        panic(err) // &lt;--- crashes here due to API mismatch\n    }\n\n    containers, err := cli.ContainerList(ctx, types.ContainerListOptions{})\n    if err != nil {\n        panic(err)\n    }\n\n    for _, container := range containers {\n\n        if strings.Contains(container.Image, \"enduser\") || strings.Contains(container.Image, \"admin\") {\n\n            fmt.Println(\"\\n we found enduser or admin so lets stop it\\n\")\n\n            fmt.Print(\"Stopping container \", container.ID[:10], \"... \")\n            if err := cli.ContainerStop(ctx, container.ID, nil); err != nil {\n                panic(err)\n            }\n            fmt.Println(\"Success\")\n        }\n    }\n}\n</code></pre>\n\n<p>In English, the above error is because the default client version of the github repo client library is newer than version supported by Docker ... so to address the comment - one approach which works is to request a lower version of the repo library to match Docker, not to request a higher version</p>\n\n<p>Below approach to negotiate also works fine </p>\n\n<blockquote>\n  <p>cli, err := client.NewClientWithOpts(client.WithAPIVersionNegotiation())</p>\n</blockquote>\n"}, {"tags": ["go", "utf"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1529945209, "post_id": 51028256, "comment_id": 89048937, "body": "When you take the first letter, you have a rune, not a byte."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1529948071, "post_id": 51028256, "comment_id": 89050383, "body": "Read <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a>"}], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1529945399, "post_id": 51028309, "comment_id": 89049036, "body": "Any comments on the <code>[]rune</code> conversion vs. <a href=\"https://godoc.org/unicode/utf8#DecodeRuneInString\" rel=\"nofollow noreferrer\"><code>utf8&#47;DecodeRuneInString</code></a>?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1529945412, "post_id": 51028309, "comment_id": 89049043, "body": "OP might find <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">Strings, bytes, runes and characters in Go</a> useful."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1529945576, "post_id": 51028309, "comment_id": 89049135, "body": "@TimCooper: the question didn&#39;t really describe the intent, but the <code>utf8</code> functions are also options I can add ;)"}, {"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "edited": false, "score": 0, "creation_date": 1529945973, "post_id": 51028309, "comment_id": 89049352, "body": "Thanks, a perfect answer"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1529945807, "last_edit_date": 1529945807, "creation_date": 1529945217, "answer_id": 51028309, "question_id": 51028256, "link": "https://stackoverflow.com/questions/51028256/i-incorrectly-decoded-utf8-characters-%c5%a1%c4%91%c5%be%c4%8d%c4%87/51028309#51028309", "title": "I incorrectly decoded utf8 characters - \u0161\u0111\u017e\u010d\u0107", "body": "<p><code>\u0160</code> is more than one byte. One method to index runes is to convert the string to <code>[]rune</code></p>\n\n<pre><code>c := []rune(word)[0]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/NBUopxe-ik1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NBUopxe-ik1</a></p>\n\n<p>You can also use the functions provided in the <code>utf8</code> package, like <a href=\"https://godoc.org/unicode/utf8#DecodeRune\" rel=\"nofollow noreferrer\"><code>utf8.DecodeRune</code></a> and <a href=\"https://godoc.org/unicode/utf8#DecodeRuneInString\" rel=\"nofollow noreferrer\"><code>utf8.DecodeRuneInString</code></a> to iterate over the individual codepoints in the utf8 string.</p>\n\n<pre><code>r, _ := utf8.DecodeRuneInString(word)\nfmt.Println(word, string(r))\n</code></pre>\n"}], "owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "accepted_answer_id": 51028309, "answer_count": 1, "score": -4, "last_activity_date": 1529945911, "creation_date": 1529945023, "last_edit_date": 1529945911, "question_id": 51028256, "link": "https://stackoverflow.com/questions/51028256/i-incorrectly-decoded-utf8-characters-%c5%a1%c4%91%c5%be%c4%8d%c4%87", "title": "I incorrectly decoded utf8 characters - \u0161\u0111\u017e\u010d\u0107", "body": "<p>I have a word which contains some of these characters - \u0161\u0111\u017e\u010d\u0107. When I take the first letter out of that word, I'll have a <code>byte</code>, when I convert that <code>byte</code> into string I'll get incorrectly decoded string.\nCan someone help me figure out how to decode properly the extracter letter.\nThis is example code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    word := \"\u0160KOLA\"\n    c := word[0]\n\n    fmt.Println(word, string(c)) // \u0160KOLA \u00c5\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6T2FX4vN3-U\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6T2FX4vN3-U</a></p>\n"}, {"tags": ["go", "makefile", "gnu-make", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1529947014, "last_edit_date": 1529947014, "creation_date": 1529943495, "answer_id": 51027886, "question_id": 51027113, "link": "https://stackoverflow.com/questions/51027113/template-ident-after-generate/51027886#51027886", "title": "Template ident after generate", "body": "<p>Use tab characters in the template to produce tabs in the output. To fix the template in the question, replace the spaces before <code>@echo</code> with a tab character.</p>\n\n<p><a href=\"https://play.golang.org/p/c7v6eNsI2Fy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/c7v6eNsI2Fy</a></p>\n\n<p>If you cannot put tabs in the template for some reason, then use <code>{{\"\\t\"}}</code> to produce a tab in the output:</p>\n\n<pre><code>{{\"\\t\"}}echo {{.Text}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/3B-oIW-aCb4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3B-oIW-aCb4</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 51027886, "answer_count": 1, "score": 1, "last_activity_date": 1529947014, "creation_date": 1529940772, "last_edit_date": 1529944387, "question_id": 51027113, "link": "https://stackoverflow.com/questions/51027113/template-ident-after-generate", "title": "Template ident after generate", "body": "<p>I'm generating a <code>makefile</code> using GO <code>text/template</code>\nThe template is generated <strong>as expected</strong> (with the right content ) but the problem is that it\u2019s not <strong>indented</strong> with <strong>tabs</strong> and I got errors while running <code>make</code> command after generation.</p>\n\n<p><strong>This is the output of the template:</strong> </p>\n\n<pre><code>all: app app_2\n\nDIR = $(PWD)\n.PHONY: app\napp:\n@echo \"run module 1\"\n\n.PHONY: app_2\napp_2:\n@echo \"run module 2\u201d\n</code></pre>\n\n<p>When I run make I got error \"makefile:7: *** missing separator.  Stop.\u201d (This is the line with the first echo\u201d)</p>\n\n<p>If I change the ideation to <code>tab</code> (after the file was generated) with <code>Goland</code> or <code>vsCode</code>, I was able to <strong>run the file successfully</strong> and see the expected output..., any idea how to make it work with go text/template ?</p>\n\n<p><strong>This is the template</strong></p>\n\n<pre><code>all: {{- range .Load.Proc}} {{.Name}}{{end}}\n\n\n{{- range .Load.Proc}}\n.PHONY: {{.Name}}\n{{.Name}}:\n    @echo {{.Text}}\n{{end}}\n</code></pre>\n\n<p>This is the makefile issue: <a href=\"https://stackoverflow.com/questions/16931770/makefile4-missing-separator-stop\">makefile:4: *** missing separator. Stop</a> but for me it's a problem since I want to generate the file without the need to manually change the indentation.</p>\n"}, {"tags": ["macos", "go", "rabbitmq", "command"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529941111, "post_id": 51027084, "comment_id": 89046750, "body": "What are you expecting in <code>logs_from_rabbit.log</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": true, "score": 1, "last_activity_date": 1529946408, "creation_date": 1529946408, "answer_id": 51028606, "question_id": 51027084, "link": "https://stackoverflow.com/questions/51027084/rabbitmq-go-tutorial-log-printf-cant-write-to-disk-file/51028606#51028606", "title": "RabbitMQ Go tutorial log.Printf can&#39;t write to disk file?", "body": "<p>It seems your redirect is missing logs from the standard error output.</p>\n\n<p>Try:</p>\n\n<pre><code>go run receive_logs_direct.go warning error &gt;stdout.log 2&gt;stderr.log\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>go run receive_logs_direct.go warning error 2&gt;&amp;1 &gt;full.log\n</code></pre>\n"}], "owner": {"reputation": 34, "user_id": 4955437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hhxcn.jpg?s=128&g=1", "display_name": "Ray Lei", "link": "https://stackoverflow.com/users/4955437/ray-lei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 51028606, "answer_count": 1, "score": 0, "last_activity_date": 1529946408, "creation_date": 1529940661, "question_id": 51027084, "link": "https://stackoverflow.com/questions/51027084/rabbitmq-go-tutorial-log-printf-cant-write-to-disk-file", "title": "RabbitMQ Go tutorial log.Printf can&#39;t write to disk file?", "body": "<p>I'm following the RabbitMQ tutorial via go. Here is the link: <a href=\"https://www.rabbitmq.com/tutorials/tutorial-four-go.html\" rel=\"nofollow noreferrer\">https://www.rabbitmq.com/tutorials/tutorial-four-go.html</a></p>\n\n<p>when I run the following command to log message to file:</p>\n\n<pre><code>go run receive_logs_direct.go warning error&gt;logs_from_rabbit.log\n</code></pre>\n\n<p>But the logs_from_rabbit.log file  still empty.</p>\n\n<p><a href=\"https://i.stack.imgur.com/oarSg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oarSg.png\" alt=\"enter image description here\"></a></p>\n\n<p>What's wrong with it? </p>\n"}, {"tags": ["c++", "go", "gcc", "go-build"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529939886, "post_id": 51026558, "comment_id": 89045968, "body": "Have you tried using the environment variables listed in the <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">documentation</a>: <code>CGO_CFLAGS, CGO_CPPFLAGS, CGO_CXXFLAGS, CGO_FFLAGS and CGO_LDFLAGS</code>"}, {"owner": {"reputation": 145, "user_id": 5100116, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sAxhBdN30Hs/AAAAAAAAAAI/AAAAAAAAA_M/jHIbJn01VHA/photo.jpg?sz=128", "display_name": "kyle sexton", "link": "https://stackoverflow.com/users/5100116/kyle-sexton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529940336, "post_id": 51026558, "comment_id": 89046279, "body": "No; I saw those in the page I linked as environment variables, but again didn&#39;t see any documentation on how to set them.  The page you linked seems to have some documentation on how to set them, so I&#39;ll be trying that.  Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 5100116, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sAxhBdN30Hs/AAAAAAAAAAI/AAAAAAAAA_M/jHIbJn01VHA/photo.jpg?sz=128", "display_name": "kyle sexton", "link": "https://stackoverflow.com/users/5100116/kyle-sexton"}, "edited": false, "score": 0, "creation_date": 1529940803, "post_id": 51026874, "comment_id": 89046585, "body": "That produces:  <code>go build</code>  <code># runtime&#47;cgo</code>  <code>gcc: error: &quot;-std=c++11&quot;: Invalid argument</code>"}, {"owner": {"reputation": 145, "user_id": 5100116, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sAxhBdN30Hs/AAAAAAAAAAI/AAAAAAAAA_M/jHIbJn01VHA/photo.jpg?sz=128", "display_name": "kyle sexton", "link": "https://stackoverflow.com/users/5100116/kyle-sexton"}, "edited": false, "score": 0, "creation_date": 1529941756, "post_id": 51026874, "comment_id": 89047129, "body": "If I run that without the quotes and then run go build, it produces a different error that makes more sense: <code>go build</code> <code># runtime&#47;cgo</code> <code>cc1.exe: error: command line option &#39;-std=c++11&#39; is valid for C++&#47;ObjC++ but not for C [-Werror]</code> <code>cc1.exe: all warnings being treated as errors</code>"}, {"owner": {"reputation": 145, "user_id": 5100116, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sAxhBdN30Hs/AAAAAAAAAAI/AAAAAAAAA_M/jHIbJn01VHA/photo.jpg?sz=128", "display_name": "kyle sexton", "link": "https://stackoverflow.com/users/5100116/kyle-sexton"}, "edited": false, "score": 0, "creation_date": 1529947917, "post_id": 51026874, "comment_id": 89050319, "body": "I tried <code>set CGO_CXXFLAGS=-std=c++11</code> and then <code>go build</code> and that works.  After reading some <a href=\"https://golang.org/cmd/go/#hdr-Environment_variables\" rel=\"nofollow noreferrer\">more documentation</a>, it seems that CPP is for the C preprocessor, and CXX is for C++.   Thanks for getting me there.  If you change your answer to CXX I&#39;ll accept it."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1529948828, "last_edit_date": 1529948828, "creation_date": 1529939980, "answer_id": 51026874, "question_id": 51026558, "link": "https://stackoverflow.com/questions/51026558/specifying-go-builds-version-of-c/51026874#51026874", "title": "Specifying go build&#39;s version of C++", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a></p>\n  \n  <p><a href=\"https://golang.org/cmd/cgo/#hdr-Using_cgo_with_the_go_command\" rel=\"nofollow noreferrer\">Using cgo with the go command</a></p>\n  \n  <p>All the cgo CPPFLAGS and CFLAGS directives in a package are\n  concatenated and used to compile C files in that package. All the\n  CPPFLAGS and CXXFLAGS directives in a package are concatenated and\n  used to compile C++ files in that package. All the CPPFLAGS and FFLAGS\n  directives in a package are concatenated and used to compile Fortran\n  files in that package. All the LDFLAGS directives in any package in\n  the program are concatenated and used at link time. All the pkg-config\n  directives are concatenated and sent to pkg-config simultaneously to\n  add to each appropriate set of command-line flags.</p>\n</blockquote>\n\n<hr>\n\n<p>On Windows:</p>\n\n<pre><code>set CGO_CXXFLAGS=-std=c++11\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 5100116, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sAxhBdN30Hs/AAAAAAAAAAI/AAAAAAAAA_M/jHIbJn01VHA/photo.jpg?sz=128", "display_name": "kyle sexton", "link": "https://stackoverflow.com/users/5100116/kyle-sexton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1786, "favorite_count": 0, "accepted_answer_id": 51026874, "answer_count": 1, "score": 3, "last_activity_date": 1529948828, "creation_date": 1529939016, "last_edit_date": 1529942228, "question_id": 51026558, "link": "https://stackoverflow.com/questions/51026558/specifying-go-builds-version-of-c", "title": "Specifying go build&#39;s version of C++", "body": "<p>I'm trying to build a go project that uses a third party library (GDAL) that's written in C and C++.  I've run into this error:</p>\n\n<pre><code>In file included from contour.cpp:31:0:\ncpl_port.h:187:6: error: #error Must have C++11 or newer.\n #    error Must have C++11 or newer.\n      ^\nIn file included from C:/TDM-GCC-64/lib/gcc/x86_64-w64-mingw32/5.1.0/include/c++/type_traits:35:0,\n                 from cpl_conv.h:372,\n                 from contour.cpp:39:\nC:/TDM-GCC-64/lib/gcc/x86_64-w64-mingw32/5.1.0/include/c++/bits/c++0x_warning.h:32:2: error: #error This file requires compiler and library support for the ISO C++ 2011 standard. This support is currently experimental, and must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n #error This file requires compiler and library support for the \\\n  ^\n</code></pre>\n\n<p>Some searching tells me this is expected, and the fix is to simply set a flag on the compiler (<a href=\"https://stackoverflow.com/questions/10363646/compiling-c11-with-g\">not go related, but still pertinent</a>).</p>\n\n<p>I've read through <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\">go's documentation</a> on building, and while it suggests it's possible to specify options to individual compilers, it doesn't explicitly spell out how, nor does it provide any examples.</p>\n\n<p>I've tried the following just guessing, and while the go build command accepts them, they produce the same error, so they don't work.</p>\n\n<pre><code>go build -gcflags -std=gnu++11 -ldflags -std=gnu++11\ngo build -gcflags -std=c++11 -ldflags -std=c++11\ngo build -gcflags -std=c++11\ngo build -gcflags -std=all=gnu++11 -ldflags -std=all=gnu++11\n</code></pre>\n\n<p>How can I tell go to tell gcc to compile with C++11 or newer?</p>\n\n<p>Edit: As requested by PeterSO:</p>\n\n<pre><code>H:\\&gt;go version\ngo version go1.10.2 windows/amd64\n\nH:\\&gt;go env\nset GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\ksexton\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=H:\\ksexton\\Go;\nset GORACE=\nset GOROOT=C:\\Go\nset GOTMPDIR=\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\ksexton\\AppData\\Local\\Temp\\go-build937852322=/tmp/go-build -gno-record-gcc-switches\n\nH:\\&gt;gcc --version\ngcc (tdm64-1) 5.1.0\nCopyright (C) 2015 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nH:\\&gt;g++ --version\ng++ (tdm64-1) 5.1.0\nCopyright (C) 2015 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 3, "creation_date": 1529950506, "post_id": 51026376, "comment_id": 89051468, "body": "Just copy paste <code>TestMain</code> into each package you need global setup/teardown? What you want probably isn&#39;t possible since packages are totally independent of one another, go doesn&#39;t see a heirarchy. It seems repetitive but it&#39;s going to take you five minutes."}], "answers": [{"tags": [], "owner": {"reputation": 306, "user_id": 15118064, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsWd3.png?s=128&g=1", "display_name": "Steven Masley", "link": "https://stackoverflow.com/users/15118064/steven-masley"}, "is_accepted": false, "score": 0, "last_activity_date": 1612147775, "creation_date": 1612147775, "answer_id": 65986563, "question_id": 51026376, "link": "https://stackoverflow.com/questions/51026376/golang-global-setup-for-all-tests-within-same-and-other-sub-modules/65986563#65986563", "title": "Golang global setup for all tests (within same and other sub modules).", "body": "<p>If you came from an <code>init</code> function, you could always make a test package that has the <code>init</code> code you'd like to run for your unit tests, and import that for the side effect.</p>\n<p>Make pkg called <code>initializetest</code>, implement the <code>init()</code> function, then in all your test files, import it like so:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n  _ &quot;project/path/initializetest&quot;\n)\n</code></pre>\n<hr />\n<p>I don't totally like this, as init() side effects can be a pain to debug. Calling the setup explicitly for each unit test would be better.</p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1712, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1612147775, "creation_date": 1529938451, "question_id": 51026376, "link": "https://stackoverflow.com/questions/51026376/golang-global-setup-for-all-tests-within-same-and-other-sub-modules", "title": "Golang global setup for all tests (within same and other sub modules).", "body": "<p>I generally try to run the command <code>go test ./...</code> for CI/CD pipeline which used to run all test cases among all the subdirectories.</p>\n\n<p>But I recently refactored my code to take config file path from flag parsing and then reading and initializing all variables(required before server startup).This change required to remove all initialization code from \n<code>init function -&gt; custom function</code> which will be called from main.  </p>\n\n<p>Now everything relates is done but all test cases are not working as I need to call all the custom functions from somewhere.</p>\n\n<p>I tried using the TestMain feature but I think it is only working for the same module and all test cases are failing.</p>\n\n<pre><code>func TestMain(m *testing.M) { \n    mySetupFunction()\n    retCode := m.Run()\n    myTeardownFunction()\n    os.Exit(retCode)\n}\n</code></pre>\n\n<p>Need help to know how can I create a global test setup or would like to know is there any other better way for above-mentioned refactoring.</p>\n\n<p>I have my modules structure as follow</p>\n\n<pre><code>A\n    B\n    C\n    D\n        E\n            F\n        G\n            H\n    I\nmain.go \n</code></pre>\n\n<p>where parent module is A which contains main.go and various others module some nested to the deep level and all of them are having their own test cases</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529957609, "post_id": 51030930, "comment_id": 89054586, "body": "You have to read or write to a pipe to detect the other side closing."}, {"owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529959764, "post_id": 51030930, "comment_id": 89055564, "body": "@JimB - on POSIX one can use select/poll to get notified when the read end is closed. It seems Golang just does not provide access to that functionality in its API and the only workaround is to use unsafe and syscall.Select, <a href=\"https://github.com/golang/go/issues/26049\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/26049</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529961523, "post_id": 51030930, "comment_id": 89056208, "body": "How do you detect that the read end has been closed?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529965161, "post_id": 51030930, "comment_id": 89057276, "body": "I see Rob had the same question as I did, and you answered in the issue tracker. I would double check that you can actually block until you get a <code>POLLERR</code> without it returning <code>POLLOUT</code> immediately, or without having to fill the kernel buffer for the pipe."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529969141, "post_id": 51030930, "comment_id": 89058216, "body": "Ah, the behavior seems to be Linux specific :/ You do get a <code>POLLERR</code> immediately. That would be the solution if you need to do it without calling Write."}, {"owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529969969, "post_id": 51030930, "comment_id": 89058416, "body": "@JimB - poll is not provided by syscall with Go on Linux, but epoll is. So <a href=\"https://play.golang.org/p/xjWY-VqtQ60\" rel=\"nofollow noreferrer\">play.golang.org/p/xjWY-VqtQ60</a> implemets that wait for pipe close. With it go <code>run example.go | sleep 1</code> terminates in 1 second."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1529979659, "post_id": 51030930, "comment_id": 89060141, "body": "Not that it makes a big difference, but Poll is in <a href=\"https://godoc.org/golang.org/x/sys/unix#Poll\" rel=\"nofollow noreferrer\"><code>x&#47;sys&#47;unix</code></a>"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1529956276, "question_id": 1334078}, "owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 523, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1530005682, "creation_date": 1529938225, "last_edit_date": 1530005682, "question_id": 51030930, "link": "https://stackoverflow.com/questions/51030930/detect-stdout-connected-to-a-pipe-was-closed-on-the-read-end-in-golang", "title": "Detect stdout connected to a pipe was closed on the read end in golang", "body": "<p>Is there a portable way in Golang to detect that os.Stdout that is connected to a pipe to another process was closed on the read end without writing something to it? I am writing a command line helper that should exit if its stdout was closed because, for example, the process connected to the read end of the pipe exited. For example, when run from a shell like:</p>\n\n<pre><code>go run my_helper.go | sleep 1\n</code></pre>\n\n<p>the helper should exit when the sleep process exits closing the read end of the pipe without waiting for explicit kill signal or an input that triggers eventual non-zero write to stdout.</p>\n\n<p>I though I could just poll stdout periodically writing zero-length slices, but it seems Go optimized zero-length writes and did nothing in such cases. I.e. </p>\n\n<pre><code>n, err := os.Stdout.Write(nil)\n</code></pre>\n\n<p>returns <code>0, nil</code> even if os.Stdout was closed on the read end.</p>\n\n<p>As the code needs to run only on Linux, I can workaround this in principle using <code>syscall.Select</code> and waiting for write errors on <code>os.Stdout</code>, but maybe I missed something.</p>\n"}, {"tags": ["go", "aerospike"], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 4960414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eed9229cac8ae44671f7468aa72429a5?s=128&d=identicon&r=PG&f=1", "display_name": "Khosrow Afroozeh", "link": "https://stackoverflow.com/users/4960414/khosrow-afroozeh"}, "is_accepted": true, "score": 5, "last_activity_date": 1529939915, "creation_date": 1529939915, "answer_id": 51026849, "question_id": 51025744, "link": "https://stackoverflow.com/questions/51025744/how-to-use-a-connection-pool-to-an-aerospike-server/51026849#51026849", "title": "How to use a connection pool to an aerospike server", "body": "<p>You don't need to. The Go client for aerospike automatically pools the connections internally.</p>\n\n<p>You just need to make a <code>Client</code> to the database and hang on to that single instance, and that object will take care of the rest for you. There are a few variables you can set in the <code>ClientPolicy</code> to tweak the internal connection pool.</p>\n"}], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 51026849, "answer_count": 1, "score": 3, "last_activity_date": 1529944591, "creation_date": 1529936555, "last_edit_date": 1529944591, "question_id": 51025744, "link": "https://stackoverflow.com/questions/51025744/how-to-use-a-connection-pool-to-an-aerospike-server", "title": "How to use a connection pool to an aerospike server", "body": "<p>I want to connect to an aerospike server using golang </p>\n\n<p>I am not able to get any library that gives such an option \nDefault golang libraries for redis etc have clear pooling examples. Not sure why they are missing for aerospike</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1529936037, "post_id": 51024832, "comment_id": 89043551, "body": "Please include a self-contained piece of code that reproduces your problem. What you posted should not output what you are describing."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1529936145, "post_id": 51024832, "comment_id": 89043626, "body": "@TimCooper - what do you mean by  &quot;not output what you are describing&quot; ? can you please elaborate ?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1529936664, "post_id": 51024832, "comment_id": 89043985, "body": "There is no reason why changing your template loop to be on a single line would cause items to be omitted. Something else is obviously going wrong with the code."}], "answers": [{"tags": [], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "is_accepted": true, "score": 0, "last_activity_date": 1529961021, "creation_date": 1529961021, "answer_id": 51031833, "question_id": 51024832, "link": "https://stackoverflow.com/questions/51024832/writes-value-in-the-same-line/51031833#51031833", "title": "Writes value in the same line", "body": "<p>The <code>-</code> character prevents new lines so adding a <code>-</code> before the closing <code>}}</code> should do the trick. </p>\n\n<p><a href=\"https://play.golang.org/p/a-P-yPJtm9W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/a-P-yPJtm9W</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"os\"\nimport \"text/template\"\n\nconst temp = `\n{{- range .Apps -}}\n{{- .Name -}}\n{{- end -}}\n`\n\ntype file struct {\n    Apps []app\n}\n\ntype app struct {\n    Name string\n}\n\nfunc main() {\n    data := file{\n        Apps: []app{\n            app{\"foo\"}, \n            app{\"bar\"},\n        },\n    }\n    t := template.Must(template.New(\"foo\").Parse(temp))\n\n    err := t.Execute(os.Stdout, data)\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 51031833, "answer_count": 1, "score": 0, "last_activity_date": 1529961021, "creation_date": 1529933796, "last_edit_date": 1529944614, "question_id": 51024832, "link": "https://stackoverflow.com/questions/51024832/writes-value-in-the-same-line", "title": "Writes value in the same line", "body": "<p>I\u2019ve the following code which works to generate the names\nOne after another:</p>\n\n<pre><code>{{- range .File.apps}}\n\n{{ .Name}}\n\n{{- end}}\n</code></pre>\n\n<p><strong>This prints</strong> </p>\n\n<pre><code>app1\n\napp2\n\napp3 \n</code></pre>\n\n<p>The problem is that I need to get it In the <strong>same line</strong> and not one after other</p>\n\n<pre><code>app1 app2 app3\n</code></pre>\n\n<p>When I try like following it remove the firsts entry and put only the last value. i.e. i'll get only <code>app3</code></p>\n\n<pre><code>{{- range .File.apps}} {{ .Name}} {{- end}}\n</code></pre>\n\n<p>How can I do that?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "edited": false, "score": 0, "creation_date": 1531408639, "post_id": 51087611, "comment_id": 89595011, "body": "no, actually was using TempFile() to create a random temp file, then os.Remove() to remove it before creating the socket using that same name."}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 0, "last_activity_date": 1530203187, "creation_date": 1530203187, "answer_id": 51087611, "question_id": 51024502, "link": "https://stackoverflow.com/questions/51024502/dial-unixgram-no-such-file-or-directory-error/51087611#51087611", "title": "Dial unixgram: no such file or directory error", "body": "<p>I think you forgot to put \"defer\" keyword before:</p>\n\n<pre><code>os.Remove(uc.localSock.Name())\n</code></pre>\n\n<p>in your lib.go file. Once you fix it you'll get \"address already in use\" error.</p>\n"}, {"tags": [], "owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "is_accepted": true, "score": 0, "last_activity_date": 1531408975, "creation_date": 1531408975, "answer_id": 51309366, "question_id": 51024502, "link": "https://stackoverflow.com/questions/51024502/dial-unixgram-no-such-file-or-directory-error/51309366#51309366", "title": "Dial unixgram: no such file or directory error", "body": "<p>My issue turned out to be a race condition in lib_test.go. I had a goroutine to create my listen socket and then immediately called Connect() from the library, but the listen socket wasn't ready yet. Adding a small delay fixed the issue.</p>\n\n<p>Original:</p>\n\n<pre><code>go listen(reply)\n_, err := Connect(\"/tmp/foobar\")\n</code></pre>\n\n<p>Fix:</p>\n\n<pre><code>go listen(reply)\ntime.Sleep(time.Second * 1)\n_, err := Connect(\"/tmp/foobar\")\n</code></pre>\n\n<p>I know there are better long term solutions but this at least got me rolling again.</p>\n"}], "owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 1, "accepted_answer_id": 51309366, "answer_count": 2, "score": 1, "last_activity_date": 1531408975, "creation_date": 1529932825, "last_edit_date": 1529935741, "question_id": 51024502, "link": "https://stackoverflow.com/questions/51024502/dial-unixgram-no-such-file-or-directory-error", "title": "Dial unixgram: no such file or directory error", "body": "<p>I've written a small library that talks to wpa_supplicant. I've verified it works with a test application but I wanted to add a unit test as well. My unit test is not able to connect to the unix socket. I get the error 'no such file or directory' but both socket files get created.</p>\n\n<p>lib.go</p>\n\n<pre><code>package libwpa\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype Conn struct {\n    uconn     *net.UnixConn //Linux specific\n    localSock *os.File\n}\n\nfunc Connect(usock string) (*Conn, error) {\n    var (\n        uc  *Conn\n        err error\n    )\n    uc = &amp;Conn{}\n\n    if uc.localSock, err = ioutil.TempFile(\"/tmp\", \"wpa_supplicant\"); err != nil {\n        return uc, err\n    }\n    os.Remove(uc.localSock.Name())\n\n    uc.uconn, err = net.DialUnix(\"unixgram\",\n        &amp;net.UnixAddr{Name: uc.localSock.Name(), Net: \"unixgram\"},\n        &amp;net.UnixAddr{Name: usock, Net: \"unixgram\"})\n    if err != nil {\n        return uc, err\n    }\n\n    return uc, nil\n}\n</code></pre>\n\n<p>lib_test.go</p>\n\n<pre><code>package libwpa\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net\"\n    \"os\"\n    \"testing\"\n)\n\nfunc listen(reply chan&lt;- []byte) {\n    conn, err := net.ListenUnixgram(\"unixgram\", &amp;net.UnixAddr{Name: \"/tmp/foobar\", Net: \"unixgram\"})\n    if err != nil {\n        fmt.Printf(\"failed to listen: %v\\n\", err)\n        panic(err)\n    }\n    defer os.Remove(\"/tmp/foobar\")\n\n    f, _ := ioutil.ReadDir(\"/tmp\")\n    for _, d := range f {\n        fmt.Printf(\"%v\\n\", d.Name())\n    }\n\n    buf := make([]byte, 2048)\n    n, uaddr, err := conn.ReadFromUnix(buf)\n    if err != nil {\n        fmt.Printf(\"LISTEN: Error: %v\\n\", err)\n    } else {\n        fmt.Printf(\"LISTEN: received %v bytes from %+v\\n\", n, uaddr)\n        fmt.Printf(\"LISTEN: %v\\n\", string(buf))\n    }\n\n    conn.Close()\n    reply &lt;- buf\n}\n\nfunc Test_Connect(t *testing.T) {\n    reply := make(chan []byte, 2)\n    go listen(reply)\n    _, err := Connect(\"/tmp/foobar\")\n    if err != nil {\n        t.Fatalf(\"Failed to connect: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Running it I get</p>\n\n<pre><code>$ go test                                                                                                                                                                                                                                                    \n--- FAIL: Test_Connect (0.00s)\n        lib_test.go:42: Failed to connect: dial unixgram /tmp/wpa_supplicant208023735-&gt;/tmp/foobar: connect: no such file or directory\nFAIL\nexit status 1\nFAIL    _/home/code/apps/go/src/crown/libwpa 0.006s\n\n$ ls /tmp/{foobar,wpa*}                                                                                                                                                                                                                                        \n/tmp/foobar=  /tmp/wpa_supplicant923064975=\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubernetes-helm", "kubernetes-ingress"], "answers": [{"comments": [{"owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "edited": false, "score": 0, "creation_date": 1530109227, "post_id": 51046006, "comment_id": 89120230, "body": "Thank you for the answer. Did what you suggested. It shows: <code>$ kubectl get svc NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443&#47;TCP             2d solar-demo   ClusterIP   10.106.81.209   &lt;none&gt;        3000&#47;TCP,3001&#47;TCP   4m</code> However, I have two containers in my Pod. How would ingress know to send 3000 to <code>solar-api</code> and 3001 to <code>solar-svc</code>"}, {"owner": {"reputation": 2796, "user_id": 9892073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pVaKd.png?s=128&g=1", "display_name": "aurelius", "link": "https://stackoverflow.com/users/9892073/aurelius"}, "reply_to_user": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "edited": false, "score": 0, "creation_date": 1530178563, "post_id": 51046006, "comment_id": 89147494, "body": "The reason is how networking in pods works and how we configured the communication from Ingress through service to the pod itself. Since the containers inside pods share all the ports and we mapped service to reach \u201ccity\u201d on port 3000 and \u201csolar\u201d on port 3001, it forwards the request to the specified ports (remember to change names in config files to solar-api and solar-svc instead of my-app). You can find an article on networking inside of pods under this <a href=\"https://medium.com/google-cloud/understanding-kubernetes-networking-pods-7117dd28727\" rel=\"nofollow noreferrer\">link</a>."}], "tags": [], "owner": {"reputation": 2796, "user_id": 9892073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pVaKd.png?s=128&g=1", "display_name": "aurelius", "link": "https://stackoverflow.com/users/9892073/aurelius"}, "is_accepted": true, "score": 1, "last_activity_date": 1530025306, "creation_date": 1530025306, "answer_id": 51046006, "question_id": 51024198, "link": "https://stackoverflow.com/questions/51024198/load-balancing-k8s-pods-with-operator-framework/51046006#51046006", "title": "Load balancing K8s Pods with operator-framework", "body": "<blockquote>\n  <p>What do I need to add have ingress or something running in front of my pods?</p>\n</blockquote>\n\n<p>Yes, <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/#what-is-ingress\" rel=\"nofollow noreferrer\">Ingress</a> is designed for that kind of tasks. </p>\n\n<p><code>Ingress</code> has a <code>path-based</code> routing, which will be able  to set up the same configuration as you mentioned in your example with Nginx. Moreover, one of the most popular implementations of <code>Ingress</code> is <code>Nginx</code> as a proxy.</p>\n\n<p><code>Ingress</code> is basically a set of rules that allows traffic, otherwise dropped or forwarded elsewhere, to reach the cluster services.<br>\nHere is an example of an Ingress configuration:</p>\n\n<pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: my-app\nspec:\n  rules:\n  - host: '' # Empty value means \u2018any host\u2019\n    http:\n      paths:\n      - path: /city\n        backend:\n          serviceName: myapp\n          servicePort: 3000\n      - path: /solar\n        backend:\n          serviceName: myapp\n          servicePort: 3001\n</code></pre>\n\n<p>Also, because a <code>Pod</code> is not a static thing, you should create a <code>Service</code> object which will be a static entry point of your application for <code>Ingress</code>.</p>\n\n<p>Here is an example of the <code>Service</code>:</p>\n\n<pre><code>kind: Service\napiVersion: v1\nmetadata:\n  name: myapp\nspec:\n  selector:\n    app: \"NAME_OF_YOUR_DEPLOYMENT\"\n  ports:\n  - name: city\n    protocol: TCP\n    port: 3000\n    targetPort: 3000\n  - name: solar\n    protocol: TCP\n    port: 3001\n    targetPort: 3001\n</code></pre>\n"}], "owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 51046006, "answer_count": 1, "score": 0, "last_activity_date": 1530025306, "creation_date": 1529931934, "question_id": 51024198, "link": "https://stackoverflow.com/questions/51024198/load-balancing-k8s-pods-with-operator-framework", "title": "Load balancing K8s Pods with operator-framework", "body": "<p>I built a simple operator, by tweaking the memcached example. The only major difference is that I need two docker images in my pods. Got the deployment running. My test.yaml used to deploy with <code>kubectl</code>.</p>\n\n<pre><code>apiVersion: \"cache.example.com/v1alpha1\"\nkind: \"Memcached\"\nmetadata:\n  name: \"solar-demo\"\nspec:\n  size: 3\n  group: cache.example.com\n  names:\n    kind: Memcached\n    listKind: MemcachedList\n    plural: solar-demos\n    singular: solar-demo\n  scope: Namespaced\n  version: v1alpha1\n</code></pre>\n\n<p>I am still missing one piece though - load-balancing part. Currently, under Docker we are using the <code>nginx</code> image working as a reverse-proxy configured as:</p>\n\n<pre><code>upstream api_microservice {\n  server api:3000;\n}\nupstream solar-svc_microservice {\n  server solar-svc:3001;\n}\nserver {\n  listen $NGINX_PORT default;\n\n  location /city {\n    proxy_pass http://api_microservice;\n  }\n\n  location /solar {\n    proxy_pass http://solar-svc_microservice;\n  }\n\n  root /html;\n  location / {\n    try_files /$uri /$uri/index.html /$uri.html /index.html=404;\n  }\n}\n</code></pre>\n\n<p>I want my cluster to expose the port <code>8080</code> and forward to ports <code>3000</code> and <code>3001</code> to my images running inside Pods.</p>\n\n<p>My deployment:</p>\n\n<pre><code>dep := &amp;appsv1.Deployment{\n    TypeMeta: metav1.TypeMeta{\n        APIVersion: \"apps/v1\",\n        Kind:       \"Deployment\",\n    },\n    ObjectMeta: metav1.ObjectMeta{\n        Name:      m.Name,\n        Namespace: m.Namespace,\n    },\n    Spec: appsv1.DeploymentSpec{\n        Replicas: &amp;replicas,\n        Selector: &amp;metav1.LabelSelector{\n            MatchLabels: ls,\n        },\n        Template: v1.PodTemplateSpec{\n            ObjectMeta: metav1.ObjectMeta{\n                Labels: ls,\n            },\n            Spec: v1.PodSpec{\n                Containers: []v1.Container{\n                    {\n                        Image:   \"shmukler/docker_solar-svc\",\n                        Name:    \"solar-svc\",\n                        Command: []string{\"npm\", \"run\", \"start-solar-svc\"},\n                        Ports: []v1.ContainerPort{{\n                            ContainerPort: 3001,\n                            Name:          \"solar-svc\",\n                        }},\n                    },\n                    {\n                        Image:   \"shmukler/docker_solar-api\",\n                        Name:    \"api\",\n                        Command: []string{\"npm\", \"run\", \"start-api\"},\n                        Ports: []v1.ContainerPort{{\n                            ContainerPort: 3000,\n                            Name:          \"solar-api\",\n                        }},\n                    },\n                },\n            },\n        },\n    }\n</code></pre>\n\n<p>What do I need to add have <code>ingress</code> or something running in front of my pods?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1529929434, "post_id": 51023359, "comment_id": 89039220, "body": "The desired behavior is unclear. As in Go, ranging through a map is unordered, what if you have already visit <code>&quot;4&quot;</code> before? What do you expect? Please clearify this."}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1529929675, "post_id": 51023359, "comment_id": 89039376, "body": "@leafbebop program guarantees that it always adds an unique value into the map. I just to  need to see it while iteration (no matter in which order)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1529930162, "post_id": 51023359, "comment_id": 89039694, "body": "Just remember to insert 4 and do it <i>after</i> iterating through the map. So dead obvious that this cannot be the answer. Do you have any unmentioned constraints?"}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1529930987, "post_id": 51023359, "comment_id": 89040202, "body": "@Volker Actually yes. The real scheme is <code>map[pid]*Process</code>. And I send signals them via <code>chan</code> to start to do job while ranging. However, <code>Process</code> can create child process and child process also can do in own turn (not always). If <code>Process</code> created a child I also need to send <code>start</code> signal to child. Because I don&#39;t know the depth of &quot;creating child process&quot; I can&#39;t do it after <i>iterating</i>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1529931571, "post_id": 51023359, "comment_id": 89040558, "body": "Well, maybe a map is not the right structure at all for something that sound awfully treeish."}], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 3, "last_activity_date": 1529929746, "creation_date": 1529929746, "answer_id": 51023530, "question_id": 51023359, "link": "https://stackoverflow.com/questions/51023359/a-safe-way-to-add-a-key-to-map-in-golang/51023530#51023530", "title": "A safe way to add a key to map in Golang", "body": "<p>Create another map with the items you want to add to the original map, and after the iteration, you merge them.</p>\n\n<pre><code>var m = make(map[string]int)\nm[\"1\"] = 1 \nm[\"2\"] = 2 \nm[\"3\"] = 3 \n\nvar n = make(map[string]int)\n\nfor k := range m { \n    if strings.EqualFold(\"2\", k) {\n        n[\"4\"] = 4 \n    }   \n}   \n\nfor k, v := range n { \n    m[k] = v \n}   \n\nfor _, v := range m { \n    fmt.Println(v)\n}\n</code></pre>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5496, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1529929746, "creation_date": 1529929189, "question_id": 51023359, "link": "https://stackoverflow.com/questions/51023359/a-safe-way-to-add-a-key-to-map-in-golang", "title": "A safe way to add a key to map in Golang", "body": "<p>Due to this fact:</p>\n\n<blockquote>\n  <p>If a map entry is created during iteration, that entry may be produced\n  during the iteration or may be skipped. The choice may vary for each\n  entry created and from one iteration to the next.</p>\n</blockquote>\n\n<p>It's not safe to add key-values to map during iteration:</p>\n\n<pre><code>var m = make(map[string]int)\nm[\"1\"] = 1\nm[\"2\"] = 2\nm[\"3\"] = 3\n\nfor k, v := range m {\n    if strings.EqualFold( \"2\", k){\n        m[\"4\"] = 4\n    }\n    fmt.Println(k, v)\n}\n</code></pre>\n\n<p>Sometimes <code>\"4\"</code> key is produced, sometimes not. </p>\n\n<p>What is the workaround to make it always produced?</p>\n"}, {"tags": ["go", "google-bigquery", "gcloud"], "comments": [{"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529925405, "post_id": 51022028, "comment_id": 89036776, "body": "How are you determining that the insert is not working?"}, {"owner": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "reply_to_user": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529926502, "post_id": 51022028, "comment_id": 89037418, "body": "I go to the bigQuery console and I run a select * that returns no data (I have been doing a lot of selects and refreshing the page but&#39;s still not working)"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529927546, "post_id": 51022028, "comment_id": 89038023, "body": "You&#39;re hitting this problem: <a href=\"https://stackoverflow.com/questions/36846571/bigquery-table-truncation-before-streaming-not-working\" title=\"bigquery table truncation before streaming not working\">stackoverflow.com/questions/36846571/&hellip;</a>"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529929221, "post_id": 51022028, "comment_id": 89039104, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/36846571/bigquery-table-truncation-before-streaming-not-working\">BigQuery table truncation before streaming not working</a>"}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "reply_to_user": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529930540, "post_id": 51022028, "comment_id": 89039930, "body": "@GrahamPolley Neither the <a href=\"https://stackoverflow.com/q/36846571/\">possible duplicate</a> nor <a href=\"https://stackoverflow.com/q/36415265/\">the other question referenced in that one</a> have an actual solution to the issue, other than &quot;wait&quot; (and comments on those questions suggest it to be ~5 min rather than 2, signaling some inconsistent behaviour). Maybe we could come up with some code that works around this limitation before closing this as a duplicate?"}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "reply_to_user": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1529945299, "post_id": 51022028, "comment_id": 89048980, "body": "@GrahamPolley I&#39;ve been running some small tests, and it looks to me that the delay now is &lt;10s. It&#39;s likely that the delay time depends on the context of the tests I&#39;ve run (schema, region, ...), but it could also be that the <a href=\"https://stackoverflow.com/a/36417177/\">previous answers</a> are outdated after a couple of years. Do you have any insight on this? Have you seen ~2min delays lately?"}], "answers": [{"tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": true, "score": 3, "last_activity_date": 1529946117, "last_edit_date": 1529946117, "creation_date": 1529944989, "answer_id": 51028246, "question_id": 51022028, "link": "https://stackoverflow.com/questions/51022028/golang-code-is-not-inserting-on-bigquerys-table-after-i-have-created-it-from-co/51028246#51028246", "title": "Golang code is not inserting on BigQuery&#39;s table after I have created it from code", "body": "<p>According to this <a href=\"https://stackoverflow.com/a/36417177\">old answer</a>, it might take up to 2 min for a BigQuery streaming buffer to be properly attached to a deleted and immediately re-created table.</p>\n\n<p>I have run some tests, and in my case it just took a few seconds until the table is availabe instead of the 2~5 min reported on other questions. The resulting code is quite different from yours, but the concepts should apply.</p>\n\n<p>What I tried is, instead of directly inserting the rows, adding them on a buffered channel, and wait until you can verify that the current table is properly saving the values before start sending them.</p>\n\n<p>I've used a quite simpler struct to run my tests (so it was easier to write the code):</p>\n\n<pre><code>type Row struct {\n    ByteField []byte\n}\n</code></pre>\n\n<p>I generated my rows the following way:</p>\n\n<pre><code>func generateRows(rows chan&lt;- *Row) {\n    for {\n            randBytes := make([]byte, 100)\n            _, _ = rand.Read(randBytes)\n            rows &lt;- &amp;row{randBytes}\n            time.Sleep(time.Millisecond * 500) // use whatever frequency you need to insert rows at\n    }\n}\n</code></pre>\n\n<p>Notice how I'm sending the rows to the channel. Instead of generating them, you just have to get them from your data source.</p>\n\n<p>The next part is finding a way to check if the table is properly saving the rows. What I did was trying to insert one of the buffered rows into the table, recover that row, and verify if everything is OK. If the row is not properly returned, send it back to the buffer.</p>\n\n<pre><code>func unreadyTable(rows chan *row) bool {\n    client, err := bigquery.NewClient(context.Background(), project)\n    if err != nil {return true}\n\n    r := &lt;-rows // get a row to try to insert       \n    uploader := client.Dataset(dataset).Table(table).Uploader()\n    if err := uploader.Put(context.Background(), r); err != nil {rows &lt;- r;return true}\n\n    i, err := client.Query(fmt.Sprintf(\"select * from `%s.%s.%s`\", project, dataset, table)).Read(context.Background())\n    if err != nil {rows &lt;- r; return true}\n    var testRow []bigquery.Value\n    if err := i.Next(&amp;testRow); err != nil {rows &lt;- r;return true}\n    if reflect.DeepEqual(&amp;row{testrow[0].([]byte)}, r) {return false} // there's probably a better way to check if it's equal\n    rows &lt;- r;return true\n}\n</code></pre>\n\n<p>With a function like that, we only need to add <code>for ; unreadyTable(rows); time.Sleep(time.Second) {}</code> to block until it's safe to insert the rows.</p>\n\n<p>Finally, we put everything together:</p>\n\n<pre><code>func main() {\n\n    // initialize a channel where the rows will be sent\n    rows := make(chan *row, 1000) // make it big enough to hold several minutes of rows\n\n    // start generating rows to be inserted\n    go generateRows(rows)\n\n    // create the BigQuery client\n    client, err := bigquery.NewClient(context.Background(), project)\n    if err != nil {/* handle error */}\n\n    // delete the previous table\n    if err := client.Dataset(dataset).Table(table).Delete(context.Background()); err != nil {/* handle error */}\n\n    // create the new table\n    schema, err := bigquery.InferSchema(row{})\n    if err != nil {/* handle error */}\n    if err := client.Dataset(dataset).Table(table).Create(context.Background(), &amp;bigquery.TableMetadata{Schema: schema}); err != nil {/* handle error */}\n\n    // wait for the table to be ready\n    for ; unreadyTable(rows); time.Sleep(time.Second) {}\n\n    // once it's ready, upload indefinitely\n    for {\n            if len(rows) &gt; 0 { // if there are uninserted rows, create a batch and insert them\n                    uploader := client.Dataset(dataset).Table(table).Uploader()\n                    insert := make([]*row, min(500, len(rows))) // create a batch of all the rows on buffer, up to 500\n                    for i := range insert {insert[i] = &lt;-rows}\n                    go func(insert []*row) { // do the actual insert async\n                            if err := uploader.Put(context.Background(), insert); err != nil {/* handle error */}\n                    }(insert)\n            } else { // if there are no rows waiting to be inserted, wait and check again\n                    time.Sleep(time.Second)\n            }\n    }\n}\n</code></pre>\n\n<p>Note: Since <code>math.Min()</code> does not like ints, I had to include <code>func min(a,b int)int{if a&lt;b{return a};return b}</code>.</p>\n\n<p>Here's my <a href=\"https://gist.github.com/Jofre/bd12e524a76f338d08b4af66c6dd5c99\" rel=\"nofollow noreferrer\">full working example</a>.</p>\n"}], "owner": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 911, "favorite_count": 0, "accepted_answer_id": 51028246, "answer_count": 1, "score": 1, "last_activity_date": 1529946117, "creation_date": 1529924827, "question_id": 51022028, "link": "https://stackoverflow.com/questions/51022028/golang-code-is-not-inserting-on-bigquerys-table-after-i-have-created-it-from-co", "title": "Golang code is not inserting on BigQuery&#39;s table after I have created it from code", "body": "<p>I have a BigQuery table with this schema:</p>\n\n<pre><code>name    STRING  NULLABLE    \nage     INTEGER NULLABLE    \namount  INTEGER NULLABLE\n</code></pre>\n\n<p>And I can succesfully insert on the table with this code:</p>\n\n<pre><code>ctx := context.Background()\nclient, err := bigquery.NewClient(ctx, projectID)\nif err != nil {\n    log.Fatal(err)\n}\n\nu := client.Dataset(dataSetID).Table(\"test_user\").Uploader()\n\nsavers := []*bigquery.StructSaver{\n    {Struct: test{Name: \"Sylvanas\", Age: 23, Amount: 123}},\n}\n\nif err := u.Put(ctx, savers); err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"rows inserted!!\")\n</code></pre>\n\n<p>This works fine because the table is already created on bigquery, what I want to do now is deleting the table if exist and creating it again from code:</p>\n\n<pre><code>type test struct {\n    Name   string\n    Age    int\n    Amount int\n}\n\nif err := client.Dataset(dataSetID).Table(\"test_user\").Delete(ctx); err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"table deleted\")\n\nt := client.Dataset(dataSetID).Table(\"test_user\")\n\n// Infer table schema from a Go type.\nschema, err := bigquery.InferSchema(test{})\n\nif err := t.Create(ctx,\n    &amp;bigquery.TableMetadata{\n        Name:           \"test_user\",\n        Schema:         schema,\n    }); err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"table created with the test schema\")\n</code></pre>\n\n<p>This is also working really nice because is deleting the table and creating it with the infered schema from my struct test.</p>\n\n<p>The problem is coming when I try to do the above insert after the delete/create process. No error is thrown but it is not inserting data (and the insert works fine if I comment the delete/create part).</p>\n\n<p>What am I doing wrong?\nDo I need to commit the create table transaction somehow in order to insert or maybe do I need to close the DDBB connection?</p>\n"}, {"tags": ["go", "timer", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1529923421, "post_id": 51021549, "comment_id": 89035624, "body": "Please provide a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. The code you&#39;ve provided is not sufficient to diagnose the problem."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1529933543, "post_id": 51023107, "comment_id": 89041872, "body": "While this is <i>an</i> issue with the posted code, it is not the cause of the issue stated in the question."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1529939153, "post_id": 51023107, "comment_id": 89045534, "body": "I disagree, <code>undefined: Q30sticker in Q30sticker.Stop</code> is a compile time error happening because <code>&lt;-chan Time</code> doesn&#39;t define a <code>Stop</code> method."}, {"owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "edited": false, "score": 0, "creation_date": 1530081673, "post_id": 51023107, "comment_id": 89102700, "body": "could you explain in detail."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530086003, "post_id": 51023107, "comment_id": 89105053, "body": "This is what I attempted to explain above, if anything in the answer doesn&#39;t make sense; I can clarify it"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1529928319, "creation_date": 1529928319, "answer_id": 51023107, "question_id": 51021549, "link": "https://stackoverflow.com/questions/51021549/unable-to-stop-the-timer-ticker/51023107#51023107", "title": "Unable to stop the timer ticker", "body": "<p>As per the docs <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p><code>Ticker</code> has an exported field <code>C</code>.</p>\n\n<pre><code>type Ticker struct {\n        C &lt;-chan Time // The channel on which the ticks are delivered.\n        // contains filtered or unexported fields\n}\n</code></pre>\n\n<p>You can receive the \"ticks\", or heartbeats on the <code>C</code> channel, but if you are doing this:</p>\n\n<pre><code>Q30sticker := time.NewTicker(time.Second * 30).C\n</code></pre>\n\n<p>then <code>Q30sticker</code> holds a reference to the channel <code>C</code> and not the ticker type. It is the <code>time.Ticker</code> struct that defines the <code>Stop</code> method.</p>\n\n<p>Update your variable to hold the ticker type (by removing <code>.C</code>):</p>\n\n<pre><code>Q30sticker := time.NewTicker(time.Second * 30)\n</code></pre>\n\n<p>And where you receive from the channel, use the <code>.</code> dot syntax to access the channel.</p>\n\n<pre><code>&lt;-Q30sticker.C\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1530115404, "creation_date": 1529923262, "last_edit_date": 1530115404, "question_id": 51021549, "link": "https://stackoverflow.com/questions/51021549/unable-to-stop-the-timer-ticker", "title": "Unable to stop the timer ticker", "body": "<p>I have defined few tickers and when I try to stop them, I see below</p>\n\n<blockquote>\n  <p>undefined: ticker in ticker.Stop</p>\n  \n  <p>undefined: Q30sticker in Q30sticker.Stop</p>\n</blockquote>\n\n<p>Code sample:</p>\n\n<pre><code>if activenode() {\n                    cipaflage = true\n                    break\n\n                } else {\n                    if cipaflage == true {\n                        defer ticker.Stop()\n                        defer Q30sticker.Stop()\n                        cipaflage = false\n                        }\n                    continue\n                }\n</code></pre>\n\n<p>And I have declared the ticker as below</p>\n\n<pre><code>ticker := time.NewTicker(59 * time.Second)\nQ30sticker := time.NewTicker(time.Second * 30).C\n</code></pre>\n"}, {"tags": ["go", "makefile"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1529921908, "post_id": 51019790, "comment_id": 89034746, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/12057852/13860\">stackoverflow.com/q/12057852/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "is_accepted": true, "score": 3, "last_activity_date": 1529918684, "creation_date": 1529918684, "answer_id": 51020145, "question_id": 51019790, "link": "https://stackoverflow.com/questions/51019790/generate-make-file/51020145#51020145", "title": "Generate make file", "body": "<p>You can generate it as <code>Makefile.project</code> and document to be run as <code>make -f Makefile.project</code></p>\n"}, {"tags": [], "owner": {"reputation": 2005, "user_id": 328977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3610fa6c9f38e6f252d19e918632b8ba?s=128&d=identicon&r=PG", "display_name": "buff", "link": "https://stackoverflow.com/users/328977/buff"}, "is_accepted": false, "score": 3, "last_activity_date": 1529919430, "creation_date": 1529919430, "answer_id": 51020361, "question_id": 51019790, "link": "https://stackoverflow.com/questions/51019790/generate-make-file/51020361#51020361", "title": "Generate make file", "body": "<p>You can give your <code>Makefile</code> whatever filename. Then <code>make</code> must be executed with parameter <code>-f &lt;your_filename&gt;</code> or <code>--file=&lt;your_filename&gt;</code>. See <a href=\"https://www.gnu.org/software/make/manual/html_node/Makefile-Names.html\" rel=\"nofollow noreferrer\">make manual on filenames</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3432, "user_id": 604642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48daad611ba387f8473b0c1e5792aa3f?s=128&d=identicon&r=PG", "display_name": "shawnhcorey", "link": "https://stackoverflow.com/users/604642/shawnhcorey"}, "is_accepted": false, "score": 0, "last_activity_date": 1529927804, "creation_date": 1529927804, "answer_id": 51022944, "question_id": 51019790, "link": "https://stackoverflow.com/questions/51019790/generate-make-file/51022944#51022944", "title": "Generate make file", "body": "<p>Which version of make are you using? Some versions run special makefiles before others. For example, GNU make looks for the following files and runs the first one it finds: <code>GNUmakefile</code>, <code>Makefile</code>, <code>makefile</code>.</p>\n\n<p>If you are using GNU make, then name your generated file <code>GNUmakefile</code> and add in the making any makefile already in the directory. That way, anyone running <code>make</code> in the directory will automatically run the generated makefike first.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 51020145, "answer_count": 3, "score": -2, "last_activity_date": 1529927804, "creation_date": 1529917548, "last_edit_date": 1529921863, "question_id": 51019790, "link": "https://stackoverflow.com/questions/51019790/generate-make-file", "title": "Generate make file", "body": "<p>I have a golang CLI program which generates a <code>makefile</code> to a specific project. While this works, there is an issue when the project already has a makefile. Of course I can check that in advance to avoid collusion, but how is it suggested to do it? </p>\n\n<p>I'm not an expert in makefiles, but how can I create second makefile (maybe with the project name or something) that user can run via make (I guess with additional steps or info to the terminal)</p>\n"}, {"tags": ["go", "google-bigquery", "gcloud"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1529918248, "post_id": 51019702, "comment_id": 89032527, "body": "Please show your failing code."}], "answers": [{"comments": [{"owner": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "edited": false, "score": 0, "creation_date": 1529922760, "post_id": 51020993, "comment_id": 89035253, "body": "so, considering that BigQuery is a OLAP. Do you think that a better aproach would be selecting all the rows from the table and creating a new table with the new updated column?"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "reply_to_user": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "edited": false, "score": 0, "creation_date": 1529922925, "post_id": 51020993, "comment_id": 89035357, "body": "depends on the problem you&#39;re trying to solve, and what your env looks like. That said, we&#39;ve used that approach many times - mainly for ELT and ad-hoc."}], "tags": [], "owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "is_accepted": true, "score": 2, "last_activity_date": 1529921568, "creation_date": 1529921568, "answer_id": 51020993, "question_id": 51019702, "link": "https://stackoverflow.com/questions/51019702/how-to-update-a-bigquery-row-in-golang/51020993#51020993", "title": "How to update a bigquery row in golang", "body": "<p>Updating rows is not specific to Go, or any other client library. If you want to update data in BigQuery, you need to use <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language\" rel=\"nofollow noreferrer\">DML</a> (Data Manipulation Language) via SQL. So, essentially you already have the main part working (running a query) - you just need to change this SQL to use DML.</p>\n\n<p>But, a word of caution: BigQuery is a OLAP service. Don't use it for OLTP. Also, there are <a href=\"https://cloud.google.com/bigquery/quotas#data_manipulation_language_statements\" rel=\"nofollow noreferrer\">quotas</a> with using DML. Make sure you familiarise yourself with them.</p>\n"}], "owner": {"reputation": 646, "user_id": 7699712, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/W7Qhr.png?s=128&g=1", "display_name": "Blazerg", "link": "https://stackoverflow.com/users/7699712/blazerg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1109, "favorite_count": 0, "accepted_answer_id": 51020993, "answer_count": 1, "score": 1, "last_activity_date": 1529921568, "creation_date": 1529917218, "question_id": 51019702, "link": "https://stackoverflow.com/questions/51019702/how-to-update-a-bigquery-row-in-golang", "title": "How to update a bigquery row in golang", "body": "<p>I have a go program connected to a bigquery table. This is the table's schema:</p>\n\n<pre><code>name    STRING  NULLABLE    \nage     INTEGER NULLABLE    \namount  INTEGER NULLABLE\n</code></pre>\n\n<p>I have succeded at queryng the data of this table and printing all rows on console with this code:</p>\n\n<pre><code>ctx := context.Background()\nclient, err := bigquery.NewClient(ctx, projectID)\n\nq := client.Query(\"SELECT * FROM test.test_user LIMIT 1000\")\n\nit, err := q.Read(ctx)\nif err != nil {\n    log.Fatal(err)\n}\n    for {\n        var values []bigquery.Value\n        err := it.Next(&amp;values)\n        if err == iterator.Done {\n            break\n        }\n        if err != nil {\n            // TODO: Handle error.\n        }\n            fmt.Println(values)\n    }\n</code></pre>\n\n<p>And I also have succeded to insert data on the table from a struct using this code:</p>\n\n<pre><code>type test struct {\n    Name   string\n    Age    int\n    Amount int\n}\nu := client.Dataset(\"testDS\").Table(\"test_user\").Uploader()\n\nsavers := []*bigquery.StructSaver{\n    {Struct: test{Name: \"Jack\", Age: 23, Amount:123}, InsertID: \"id1\"},\n}\n\nif err := u.Put(ctx, savers); err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"rows inserted!!\")\n</code></pre>\n\n<p>Now, what I am failing to do is updating rows. What I want to do is selecting all the rows and update all of them with an operation (for example: amount = amount * 2)</p>\n\n<p>How can I achieve this using golang?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1529916971, "post_id": 51018533, "comment_id": 89031754, "body": "<code>Downloader</code> was designed to do concurrent download / upload, it can&#39;t work with a single <code>io.Writer</code>, so you can&#39;t stream with that. Here&#39;s an example that can be used to stream to / from S3: <a href=\"https://gist.github.com/howeyc/5021940\" rel=\"nofollow noreferrer\">copy files to / from s3</a>"}, {"owner": {"reputation": 91, "user_id": 7631731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0c09651dbf799641805b8ec1aab4c88?s=128&d=identicon&r=PG&f=1", "display_name": "pappix", "link": "https://stackoverflow.com/users/7631731/pappix"}, "edited": false, "score": 0, "creation_date": 1576533623, "post_id": 51018533, "comment_id": 104923579, "body": "Looks like this can be done disabling concurrency on the Downloader and adding a fake &quot;WriterAt&quot; just to satisfy the interface. Here a <a href=\"https://dev.to/flowup/using-io-reader-io-writer-in-go-to-stream-data-3i7b\" rel=\"nofollow noreferrer\">post</a> that details the main steps to get this to work."}], "owner": {"reputation": 727, "user_id": 1985162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/548146a0387d6b4062ede923e39e431b?s=128&d=identicon&r=PG", "display_name": "OhadBasan", "link": "https://stackoverflow.com/users/1985162/ohadbasan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 431, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1529913017, "creation_date": 1529913017, "question_id": 51018533, "link": "https://stackoverflow.com/questions/51018533/io-pipe-with-writeatbuffer", "title": "io.Pipe with WriteAtBuffer", "body": "<p>I would like to download and upload a file to aws s3 using streaming.\nI wished to use io.Pipe but I can't because the downloader struct</p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#Downloader.Download\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#Downloader.Download</a></p>\n\n<p>uses a \"WriterAt\" interface. and io.Pipe provides an io.Writer\nI didnt succeed using the regular GetObject because it creates it downloads the object and doesn't receive a writer \nany solution for that?</p>\n\n<p>thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7651219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6070fa34121f203306585d85342972?s=128&d=identicon&r=PG&f=1", "display_name": "user7651219", "link": "https://stackoverflow.com/users/7651219/user7651219"}, "edited": false, "score": 0, "creation_date": 1529919832, "post_id": 51019214, "comment_id": 89033520, "body": "yes, it will stop. i&#39;m just wondering it will be throw a fatal error <code>deadlock</code> when the range loop over,  but when i add <code>send_writer := multipart.NewWriter(body_buf)</code>, the error is gone"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 1, "user_id": 7651219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6070fa34121f203306585d85342972?s=128&d=identicon&r=PG&f=1", "display_name": "user7651219", "link": "https://stackoverflow.com/users/7651219/user7651219"}, "edited": false, "score": 0, "creation_date": 1529920244, "post_id": 51019214, "comment_id": 89033772, "body": "The <code>send_writer := multipart.NewWriter(body_buf)</code> shouldn&#39;t play any part in how the program works with given code. If it does then your actual code is different than the one you posted here."}, {"owner": {"reputation": 1, "user_id": 7651219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6070fa34121f203306585d85342972?s=128&d=identicon&r=PG&f=1", "display_name": "user7651219", "link": "https://stackoverflow.com/users/7651219/user7651219"}, "edited": false, "score": 0, "creation_date": 1529920796, "post_id": 51019214, "comment_id": 89034126, "body": "that is actual code, i did not call the function, but it does affect the program, my go version is 1.10.2"}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 0, "last_activity_date": 1529915521, "creation_date": 1529915521, "answer_id": 51019214, "question_id": 51018491, "link": "https://stackoverflow.com/questions/51018491/when-i-add-multipart-newwriterbody-buf-the-program-will-not-stop/51019214#51019214", "title": "when i add multipart.NewWriter(body_buf), the program will not stop", "body": "<p>The program will not stop as you never close the channel and thus the range loop over it will not terminate. Close the channel in <code>loop</code> like</p>\n\n<pre><code>func loop() {\n    for i := 0; i &lt; 10; i++ {\n        channel &lt;- \"dd\"\n    }\n    close(channel)\n}\n</code></pre>\n\n<p>and it should stop.</p>\n"}], "owner": {"reputation": 1, "user_id": 7651219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6070fa34121f203306585d85342972?s=128&d=identicon&r=PG&f=1", "display_name": "user7651219", "link": "https://stackoverflow.com/users/7651219/user7651219"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1529915521, "creation_date": 1529912824, "question_id": 51018491, "link": "https://stackoverflow.com/questions/51018491/when-i-add-multipart-newwriterbody-buf-the-program-will-not-stop", "title": "when i add multipart.NewWriter(body_buf), the program will not stop", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"mime/multipart\"\n    \"bytes\"\n)\n\nvar channel chan string = make(chan string)\n\nfunc recognize(file_path string) {\n    body_buf := &amp;bytes.Buffer{}\n    fmt.Println(body_buf)\n\n    send_writer := multipart.NewWriter(body_buf)\n    fmt.Println(send_writer)\n}\n\nfunc loop() {\n    for i := 0; i &lt; 10; i++ {\n        channel &lt;- \"dd\"\n    }\n}\n\n\nfunc main() {\n    go loop()\n    for v :=  range channel {\n        fmt.Println(len(channel), v)\n    }\n}\n</code></pre>\n\n<p>the program will not stop,  even i don't call the <code>recognize</code> function, i don't know why, how to explain that</p>\n\n<p>when i remove the</p>\n\n<p><code>send_writer := multipart.NewWriter(body_buf)</code></p>\n\n<p>the program will stop and get fatal error: deadlock</p>\n\n<p>what make it difference, who can tell me</p>\n"}, {"tags": ["pointers", "go", "struct", "reference"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1529914778, "last_edit_date": 1529914778, "creation_date": 1529912325, "answer_id": 51018395, "question_id": 51018357, "link": "https://stackoverflow.com/questions/51018357/how-does-a-pointer-to-a-struct-or-array-value-in-go-work/51018395#51018395", "title": "How does a pointer to a struct or array value in Go work?", "body": "<p><code>&amp;Person{}</code> is a language \"construct\", it's part of the spec: it allocates a new variable of <code>Person</code> type, and provides you the address of that anonymous variable. </p>\n\n<p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Spec: Composite literals:</a></p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Taking the address</a> of a composite literal generates a pointer to a unique <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">variable</a> initialized with the literal's value.</p>\n</blockquote>\n\n<p>Also: <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">Spec: Variables:</a></p>\n\n<blockquote>\n  <p>Calling the built-in function <a href=\"https://golang.org/ref/spec#Allocation\" rel=\"nofollow noreferrer\">new</a> or <strong>taking the address of a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> allocates storage for a variable at run time</strong>.</p>\n</blockquote>\n\n<p><code>&amp;999</code> is not allowed by the language spec. The possible operands of the address operators are listed in the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Spec: Address operators:</a></p>\n\n<blockquote>\n  <p>The operand must be <em>addressable</em>, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. As an exception to the addressability requirement, <code>x</code> may also be a (possibly parenthesized) <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>.</p>\n</blockquote>\n\n<p><code>p := Person{}</code> creates a new variable <code>p</code> whose type will be <code>Person</code>. <code>p := &amp;Person{}</code> creates a new variable whose type will be <code>*Person</code>.</p>\n\n<p>See possible duplicate: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n\n<p>When you print the values with the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package, it has certain rules how to print values of different types:</p>\n\n<blockquote>\n  <p>For compound objects, the elements are printed using these rules, recursively, laid out like this:</p>\n\n<pre><code>struct:             {field0 field1 ...}\narray, slice:       [elem0 elem1 ...]\nmaps:               map[key1:value1 key2:value2]\npointer to above:   &amp;{}, &amp;[], &amp;map[]\n</code></pre>\n</blockquote>\n\n<p>When you use <code>fmt.Println()</code>, the default formatting rules will be applied, which for a value of type <code>*int</code> is the <code>%p</code> verb, which will print the memory address in hexadecimal format, but for a pointer to struct it prints the struct value prepended with an <code>&amp;</code> sign (<code>&amp;{}</code>). You can read more about it in related question: <a href=\"https://stackoverflow.com/questions/42039827/difference-between-golang-pointers/42042673#42042673\">Difference between golang pointers</a></p>\n\n<p>If you want to print the pointed value, dereference the pointer and pass the pointed value, e.g.:</p>\n\n<pre><code>var p = new(int)\n*p = 12\nfmt.Println(*p) // Prints 12\n</code></pre>\n\n<p>As to why to create a pointer to a value (and not a value), see these related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values\">Pointers vs. values in parameters and return values</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/31932822/why-should-constructor-of-go-return-address\">Why should constructor of Go return address?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/40823315/go-x-does-not-implement-y-method-has-a-pointer-receiver\">Go, X does not implement Y (... method has a pointer receiver)</a></p>\n"}], "owner": {"reputation": 219, "user_id": 6348859, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/62b73b324bd147d947bfc723467ba9ff?s=128&d=identicon&r=PG&f=1", "display_name": "sermonion x", "link": "https://stackoverflow.com/users/6348859/sermonion-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1529920526, "creation_date": 1529912185, "last_edit_date": 1529920526, "question_id": 51018357, "link": "https://stackoverflow.com/questions/51018357/how-does-a-pointer-to-a-struct-or-array-value-in-go-work", "title": "How does a pointer to a struct or array value in Go work?", "body": "<p>Considering the following Go struct:</p>\n\n<pre><code>type Person struct {\n    Name    string\n    Age     int\n    Country string\n}\n</code></pre>\n\n<p>I have encountered numerious times the following use:</p>\n\n<pre><code>p := &amp;Person{\"Adam\", 33, \"Argentina\"}\n</code></pre>\n\n<p>Yet I can not see the point in pointing to a struct value, and I wonder, how does it differ from:</p>\n\n<pre><code>n := &amp;999 // Error\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>How is it even possible to point to a value, even if it is a struct or array and not a primitive like a string or int? Strange enough, the following doesn't contribute to my understanding:</p>\n\n<pre><code>fmt.Println(p, &amp;p) // outputs: &amp;{Adam 33 Argentina} 0xc042084018\n</code></pre></li>\n<li><p>Why would a programmer want to declare a struct instance by a pointer? What could you achieve doing so?</p></li>\n</ol>\n"}, {"tags": ["go", "import", "package", "microservices"], "comments": [{"owner": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 0, "creation_date": 1551256193, "post_id": 51017164, "comment_id": 96569440, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52123627/how-to-import-a-local-go-module-not-in-gopath\">How to import a local Go module not in GOPATH?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1529907873, "creation_date": 1529907873, "answer_id": 51017403, "question_id": 51017164, "link": "https://stackoverflow.com/questions/51017164/go-local-packages-and-modules/51017403#51017403", "title": "Go local packages and modules", "body": "<ol>\n<li><p>your import path must be valid in <code>$GOPATH/libPath</code> syntax</p></li>\n<li><p>for that you can share your services source code as much as you want and just seprate bin by using multiple main package</p></li>\n<li><p>if you mean directory by second files, there is no best practice for that, as long as it doesnt concern your code complexity, you can do that too</p></li>\n</ol>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4671628"}, "edited": false, "score": 0, "creation_date": 1529915511, "post_id": 51018399, "comment_id": 89030940, "body": "Thank you so much  for such complete answer and explanation ! Appreciate it"}, {"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1537047297, "post_id": 51018399, "comment_id": 91643382, "body": "Is it possible to reference local modules on the PC (not on git) with the new <i>go.mod</i> file? Suppose you have two modules on your desktop in different directories. How to use code from one in the other? How does go, with the <i>go.mod</i> file, know where this directory is located? Right now I need to push new code from one directory to Git and synchronize it (<code>go mod tidy</code> or <code>go get -u ...</code>) with the other project when it&#39;s online."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 1, "creation_date": 1537084359, "post_id": 51018399, "comment_id": 91649162, "body": "@MartinNiederl Yes. Use the replace directive in the go.mod file like <code>replace girhub.com&#47;you&#47;pr =&gt; ..&#47;..&#47;some&#47;where&#47;local</code>"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1529948203, "last_edit_date": 1529948203, "creation_date": 1529912361, "answer_id": 51018399, "question_id": 51017164, "link": "https://stackoverflow.com/questions/51017164/go-local-packages-and-modules/51018399#51018399", "title": "Go local packages and modules", "body": "<p>First: Read \"How to Write Go Code\" and stick to it and only to it.</p>\n\n<ol>\n<li><p>There are no \"local packages\" for the go tool. Forget that distinction of local, non-local, remote, whatever. For the go tool there are just packages and these packages have an import path. This import path determines where the go tool will look for the code in the filesystem. If your import path is <code>import \"int.microsoft/secret/new/foo\"</code> then your code for package foo must be located on your machine under `$GOPATH/src/int.microsoft/secret/new/foo\".</p>\n\n<p>For <code>go build</code> and (go install, go test, ...) there is <em>no</em> meaning in the import path at all: \"int.microsoft/secret/new/foo\" is no other string than \"example1/foo\" or \"github.com/someone/tool7/bar\". These are just strings and the packages are searched in these paths. None of these packages is a \"local\" package, they all are just packages.</p>\n\n<p>So if you put your code for package \"whatever\" under $GOPATH/src/some/strange/path/whatever you have to import it like <code>import \"some/strange/path/whatever\"</code>.</p></li>\n<li><p>If you want to share your code with someone else, keep a remote backup or want to use a codehosting site like github to simplify synchronizing your three workstations you can upload your code to e.g. github. This is unrelated to how you import your packages.</p>\n\n<p>The <em>only</em> subcommand in the go tool where import path do have an additional meaning other than being a path is for <code>go get</code> which knows about a few code hosting sites like github and interpretes an import path of \"github.com/someone/prjct\" and can clone this git repo for your, conveniently placing it in the right folder under your $GOPATH.</p>\n\n<p>So: No. There is absolutely no need to upload each and every bit of code. (E.g. I have a lot of stuff just on my machine under $GOPATH/src/tmp).</p>\n\n<p>Splitting code into a) different packages and b different files is unrelated to all this. Just do as you find convenient and logical.</p></li>\n<li><p>Well, no; simpliy because you cannot keep several files in one file. Did you mean \"several files in one folder\"? Yes that is fine. Split into files and packages if the split makes sense. Take a look at the standard library or any other open source project.</p></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4671628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2122, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1529948203, "creation_date": 1529906660, "question_id": 51017164, "link": "https://stackoverflow.com/questions/51017164/go-local-packages-and-modules", "title": "Go local packages and modules", "body": "<p>I have just started learning GO development, read a lot of articles and documentation, however haven't found a concrete answer. </p>\n\n<p>There are some questions </p>\n\n<ol>\n<li>How to use local packages? Using <code>./../</code> doesn't work, I can put all my source code under <code>vendror/src</code> directory, but it makes my project structure  to look not like I want</li>\n<li>Should I always upload somewhere in remote repository my packages? Is it possible to keep them local. Event if I develop a microservice, a microservice itself is a monolith application. And I don't want my microservice to have a single file. I want to split logic between several files.</li>\n<li>Is it fine to keep all files in a single file? </li>\n</ol>\n\n<p>I know that this question has been already asked several times, however I haven't found any complete answer.</p>\n\n<p>I would be grateful for any help. Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1529909231, "post_id": 51016901, "comment_id": 89027804, "body": "@Volker one could do without the snarkiness. if you cannot be helpful, do not respond at all."}, {"owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "edited": false, "score": 0, "creation_date": 1529966416, "post_id": 51016901, "comment_id": 89057580, "body": "@dopatraman - running your example, minus the <code>SendRequest</code> function - i was able to get this example running without the send to the channel blocking"}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529909259, "post_id": 51017027, "comment_id": 89027819, "body": "i am reading from the channel on the main thread. please see the updated question:"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529910678, "post_id": 51017027, "comment_id": 89028509, "body": "@dopatraman you send the request before starting to read from the channel, and the request is blocked by writing to it."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529943910, "post_id": 51017027, "comment_id": 89048263, "body": "thanks for the info. but i must sheepishly admit that i still cannot get it to work. do you mind posting some pseudo code? how would you change what im doing right now?"}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 2, "last_activity_date": 1529912143, "last_edit_date": 1529912143, "creation_date": 1529905910, "answer_id": 51017027, "question_id": 51016901, "link": "https://stackoverflow.com/questions/51016901/passing-value-to-channel-is-blocking-the-thread-for-some-reason/51017027#51017027", "title": "Passing value to channel is blocking the thread for some reason", "body": "<p>Because the channel is <a href=\"https://gobyexample.com/channel-buffering\" rel=\"nofollow noreferrer\">unbuffered</a>, the send operation blocks until there's someone who is ready to receive from them. Making the channel buffered will only defer the blocking, so you always need some reading goroutine.</p>\n\n<p>Update to your update: the control flow of the program would go like this:</p>\n\n<ol>\n<li>Server starts listening</li>\n<li><code>main</code> sends the request and waits for the response</li>\n<li>Server receives the request and tries to write to the channel</li>\n<li><code>main</code> reads from the channel</li>\n</ol>\n\n<p>4 may happen only after 2, which is blocked by 3 which is blocked because 4 is not happening yet. A classical deadlock.</p>\n"}, {"tags": [], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "is_accepted": false, "score": 0, "last_activity_date": 1529965329, "creation_date": 1529965329, "answer_id": 51032533, "question_id": 51016901, "link": "https://stackoverflow.com/questions/51016901/passing-value-to-channel-is-blocking-the-thread-for-some-reason/51032533#51032533", "title": "Passing value to channel is blocking the thread for some reason", "body": "<p>I think @bereal gave a good explanation about using an <em>unbuffered</em> or <em>synchronous</em> channel.</p>\n\n<p>Another way to make things work is to make the channel buffered by changing the line that creates the channel to:</p>\n\n<pre><code>ch := make(chan interface{}, 1)   // added the 1\n</code></pre>\n\n<p>This will prevent the function from being blocked.</p>\n"}, {"tags": [], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "is_accepted": false, "score": 0, "last_activity_date": 1530181793, "creation_date": 1530181793, "answer_id": 51080603, "question_id": 51016901, "link": "https://stackoverflow.com/questions/51016901/passing-value-to-channel-is-blocking-the-thread-for-some-reason/51080603#51080603", "title": "Passing value to channel is blocking the thread for some reason", "body": "<p>I added missing parts in your code and run it, everything works well. I don't see any block. Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"errors\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\ntype Server struct{}\n\nfunc (s *Server) Listen() chan interface{} {\n    ch := make(chan interface{})\n    http.HandleFunc(\"/\", handle(ch))\n    go http.ListenAndServe(\":8080\", nil)\n    return ch\n}\n\nfunc handle(ch chan interface{}) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        b, err := ioutil.ReadAll(r.Body)\n        defer r.Body.Close()\n        if err != nil {\n            ch &lt;- errors.New(string(500))\n            return\n        }\n        w.Write([]byte(\"Hello World\"))\n        log.Print(\"about to pass to handler channel\")\n        ch &lt;- bytes.NewBuffer(b)\n        log.Print(\"passed to handler channel\")\n    }\n}\n\n// SendRequest send request\nfunc SendRequest(method string, url string, data []byte) {\n    tr := &amp;http.Transport{\n        MaxIdleConns:       10,\n        IdleConnTimeout:    30 * time.Second,\n        DisableCompression: true,\n    }\n    client := &amp;http.Client{Transport: tr}\n    reader := bytes.NewReader(data)\n    req, err := http.NewRequest(method, url, reader)\n    if err != nil {\n        panic(err)\n    }\n    client.Do(req)\n}\n\nfunc main() {\n    n := new(Server)\n    listenerChan := n.Listen()\n    go SendRequest(\"POST\", \"http://localhost:8080\", []byte(\"hello\"))\n    for listenedMsg := range listenerChan {\n        log.Print(\"listened message&gt;&gt;&gt;&gt; \", listenedMsg)\n    }\n}\n</code></pre>\n\n<p>And the output are:</p>\n\n<pre><code>2018/06/28 17:22:10 about to pass to handler channel\n2018/06/28 17:22:10 passed to handler channel\n2018/06/28 17:22:10 listened message&gt;&gt;&gt;&gt; hello\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1530181793, "creation_date": 1529905137, "last_edit_date": 1529909935, "question_id": 51016901, "link": "https://stackoverflow.com/questions/51016901/passing-value-to-channel-is-blocking-the-thread-for-some-reason", "title": "Passing value to channel is blocking the thread for some reason", "body": "<p>I'm using a channel to pass messages from an HTTP handler:</p>\n\n<pre><code>package server\n\nimport (\n    \"bytes\"\n    \"errors\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Server struct {}\n\nfunc (s Server) Listen() chan interface{} {\n    ch := make(chan interface{})\n    http.HandleFunc(\"/\", handle(ch))\n    go http.ListenAndServe(\":8080\", nil)\n    return ch\n}\n\nfunc handle(ch chan interface{}) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        b, err := ioutil.ReadAll(r.Body)\n        defer r.Body.Close()\n        if err != nil {\n            ch &lt;- errors.New(string(500))\n            return\n        }\n        w.Write([]byte(\"Hello World\"))\n        log.Print(\"about to pass to handler channel\")\n        ch &lt;- bytes.NewBuffer(b)\n        log.Print(\"passed to handler channel\")\n    }\n} \n</code></pre>\n\n<p>When I make a request to the server running on port 8080, the thread blocks on this line:</p>\n\n<pre><code>ch &lt;- bytes.NewBuffer(b)\n</code></pre>\n\n<p>Why is this happening? If you notice, I'm running the listener in a goroutine. I also figured that HTTP handles happen in a separate thread. If I delete the above line, the thread becomes unblocked and the program works as expected. What am I doing wrong?</p>\n\n<p>To clarify, I want to be able to pass the body of a POST request to a channel. Help.</p>\n\n<p><strong>UPDATE:</strong>\nI'm reading from the channel on the main thread:</p>\n\n<pre><code>listenerChan := n.Listen()\ngo SendRequest(\"POST\", \"http://localhost:8080\", []byte(\"hello\"))\nfor listenedMsg := range listenerChan {\n    log.Print(\"listened message&gt;&gt;&gt;&gt; \", listenedMsg)\n}\n</code></pre>\n\n<p>But the thread still blocks on the same line. For clarification, there is nothing wrong with how im sending the request. If I remove the channel send line above, the thread doesnt block.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3625, "user_id": 249552, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/kQlfx.png?s=128&g=1", "display_name": "jacob", "link": "https://stackoverflow.com/users/249552/jacob"}, "edited": false, "score": 2, "creation_date": 1529901229, "post_id": 51016232, "comment_id": 89025115, "body": "Try doing <code>which go</code> and make sure it&#39;s the one in your <code>&#47;usr&#47;local</code> directory, if not then it&#39;s because you&#39;ve not removed the previous version."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1529903330, "post_id": 51016232, "comment_id": 89025681, "body": "<code>find &#47; -name go</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1529906019, "post_id": 51016232, "comment_id": 89026528, "body": "It is simple: Use the installation instruction from golang.org. Not some random blog post."}], "answers": [{"tags": [], "owner": {"reputation": 435, "user_id": 907343, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/RZb2l.jpg?s=128&g=1", "display_name": "Robus", "link": "https://stackoverflow.com/users/907343/robus"}, "is_accepted": false, "score": 1, "last_activity_date": 1529901267, "creation_date": 1529901267, "answer_id": 51016355, "question_id": 51016232, "link": "https://stackoverflow.com/questions/51016232/go-is-still-showing-old-version/51016355#51016355", "title": "Go is still showing old version", "body": "<p>Try Purge command and re-install GO.</p>\n\n<pre><code>sudo apt-get purge golang*\n</code></pre>\n\n<p>even if this doesn't work try</p>\n\n<pre><code>sudo rm -rf /usr/local/go\n</code></pre>\n"}], "owner": {"reputation": 881, "user_id": 2856499, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1d43a271f443e881cff40145013e6d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/2856499/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1529905153, "creation_date": 1529900293, "question_id": 51016232, "link": "https://stackoverflow.com/questions/51016232/go-is-still-showing-old-version", "title": "Go is still showing old version", "body": "<p>I have installed go on my ubuntu machine following this guide here <a href=\"https://medium.com/@patdhlk/how-to-install-go-1-9-1-on-ubuntu-16-04-ee64c073cd79\" rel=\"nofollow noreferrer\">https://medium.com/@patdhlk/how-to-install-go-1-9-1-on-ubuntu-16-04-ee64c073cd79</a></p>\n\n<p>However, when I do go version I am getting this still </p>\n\n<p>go version go1.2.1 linux/amd64</p>\n\n<p>I tried to do an apt-get remove go but it didnt work. </p>\n\n<p>What should I do now</p>\n"}, {"tags": ["date", "parsing", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1529898347, "post_id": 51015998, "comment_id": 89024550, "body": "For one time.Parse returns an object of type time.Time, whose String() interface{} is predefined to print out the time value in a very specific way. If you want it to print out the time again in the way it was ingested then you have to format yourself again. eg. <code>fmt.Println(t1.Format(&quot;2006-01-02&quot;))</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1529906128, "post_id": 51015998, "comment_id": 89026581, "body": "Never, literally never ever emit error checking. The errors are there for good reason and tell you what&#39;s wrong."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1529911752, "post_id": 51015998, "comment_id": 89029021, "body": ":facepalm: Don&#39;t ignore errors!"}, {"owner": {"reputation": 131, "user_id": 4404794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMuEY.jpg?s=128&g=1", "display_name": "Blockhuette", "link": "https://stackoverflow.com/users/4404794/blockhuette"}, "edited": false, "score": 0, "creation_date": 1529952242, "post_id": 51015998, "comment_id": 89052272, "body": "Thanks, guys, very instructive! The t1.Format command also helped a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 4404794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMuEY.jpg?s=128&g=1", "display_name": "Blockhuette", "link": "https://stackoverflow.com/users/4404794/blockhuette"}, "edited": false, "score": 1, "creation_date": 1529952164, "post_id": 51016038, "comment_id": 89052227, "body": "Thanks a lot for this brillant explanation - great pleasure to read! I again read the golang doc on ReadString and found: &quot;ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter.&quot; The latter I did not expect but now I know."}], "tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 1, "last_activity_date": 1529899622, "last_edit_date": 1529899622, "creation_date": 1529898404, "answer_id": 51016038, "question_id": 51015998, "link": "https://stackoverflow.com/questions/51015998/golang-date-parsing-malfunction/51016038#51016038", "title": "Golang date parsing malfunction", "body": "<p>When you read <code>datestring</code>, it has a line feed (<code>\\n</code>) termination character at the end. <code>time.Parse()</code> reads this as a parse error since it's not in your format string so you will need to handle this.</p>\n\n<p>One way is to strip it off with <code>strings.TrimSpace()</code> as follow:</p>\n\n<pre><code>datestring, _ = reader.ReadString('\\n')\ndatestring = strings.TrimSpace(datestring)\n</code></pre>\n\n<p>You can alternately add a <code>\\n</code> to your string format, but trimming the line feed would be my preference since it uses a more standard time format string.</p>\n\n<pre><code>t1, _ := time.Parse(\"2006-01-02\\n\", datestring)\n</code></pre>\n\n<p>To debug this, you should handle the error from <code>time.Parse()</code> like so:</p>\n\n<pre><code>t1, err := time.Parse(\"2006-01-02\", datestring) //0001-01-01 00:00:00 +0000 UTC\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>This will return the following error indicating there is additional text in your string. Note the closing double quote <code>\"</code> does not immediately follow the date.</p>\n\n<pre><code>panic: parsing time \"2018-06-24\n\": extra text: \n\n\ngoroutine 1 [running]:\nmain.main()\n    /path/to/main.go:19 +0x503\nexit status 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 4404794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMuEY.jpg?s=128&g=1", "display_name": "Blockhuette", "link": "https://stackoverflow.com/users/4404794/blockhuette"}, "is_accepted": false, "score": 0, "last_activity_date": 1529952478, "creation_date": 1529952478, "answer_id": 51030064, "question_id": 51015998, "link": "https://stackoverflow.com/questions/51015998/golang-date-parsing-malfunction/51030064#51030064", "title": "Golang date parsing malfunction", "body": "<p>I finally came up with this solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    // User date input\n    var datestring string\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Input start date in format yyyy-mm-dd (e.g. 2018-06-24):\\n\")\n    datestring, _ = reader.ReadString('\\n')\n    datestring = strings.TrimSpace(datestring)\n\n    // Formatted date output\n    t1, err := time.Parse(\"2006-01-02\", datestring) //0001-01-01 00:00:00 +0000 UTC\n    t2 := t1.Format(\"2006-01-02\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Result: %v\\n\", t2)\n}\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 4404794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMuEY.jpg?s=128&g=1", "display_name": "Blockhuette", "link": "https://stackoverflow.com/users/4404794/blockhuette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 494, "favorite_count": 0, "accepted_answer_id": 51016038, "answer_count": 2, "score": 0, "last_activity_date": 1529952478, "creation_date": 1529897962, "last_edit_date": 1529911724, "question_id": 51015998, "link": "https://stackoverflow.com/questions/51015998/golang-date-parsing-malfunction", "title": "Golang date parsing malfunction", "body": "<p>I'm trying to parse a user-input date string in the form yyyy-mm-dd (with nothing else behind) so that I can write it the same way into a file (again with nothing else behind).\nHowever the user input is not read correctly and I don't know why. Any hint would be great.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    var datestring string\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Startdatum im Format yyyy-mm-dd eingeben (z.B. 2018-06-24):\\n\")\n    datestring, _ = reader.ReadString('\\n')\n    fmt.Printf(\"Type: %T, Value: %v\", datestring, datestring)\n\n    t1, _ := time.Parse(\"2006-01-02\", datestring)   //0001-01-01 00:00:00 +0000 UTC\n    t2, _ := time.Parse(\"2006-01-02\", \"2018-05-27\") //2018-05-27 00:00:00 +0000 UTC\n    fmt.Printf(\"%v\\n%v\\n\", t1, t2)\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1529898686, "post_id": 51015877, "comment_id": 89024604, "body": "Outside of your question I suggest you read <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">blog.golang.org/package-names</a> Your naming conventions aren&#39;t very Go like."}, {"owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1529898928, "post_id": 51015877, "comment_id": 89024654, "body": "@reticentroot I love to know what are you referring above that is not correct or rather I say not very go like?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1529899127, "post_id": 51015877, "comment_id": 89024690, "body": "I linked you to the official Go documentation on Package naming.  Read the first ~4 paragraphs. However, to be explicate  <code>dodly_logger </code> is not the proper way to name a Go package.  Most Go linters will catch that oversight as well. Go doesn&#39;t typical use underscores in package naming.  If need be use <code>-</code> over <code>_</code>"}, {"owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1529899200, "post_id": 51015877, "comment_id": 89024708, "body": "@reticentroot ok."}], "answers": [{"comments": [{"owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "edited": false, "score": 0, "creation_date": 1529898188, "post_id": 51015991, "comment_id": 89024523, "body": "I have to do the same(the package level var, init method etc) inside the helper&#39;s package as well right?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1529898608, "post_id": 51015991, "comment_id": 89024586, "body": "If you&#39;re going to create a package level anything in Go and expect to be able to call or access the data in another package. The function, struct, var, or constant must be exported. <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">tour.golang.org/basics/3</a>"}, {"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1529898617, "post_id": 51015991, "comment_id": 89024590, "body": "Yes, set it again in subsequent helper packages.  Alternately, if you want the same logger across packages, you can have a method instead of NewLogger() that returns a new one, or an already created one."}], "tags": [], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "is_accepted": false, "score": 0, "last_activity_date": 1529897881, "creation_date": 1529897881, "answer_id": 51015991, "question_id": 51015877, "link": "https://stackoverflow.com/questions/51015877/how-to-use-constant-across-go-package/51015991#51015991", "title": "How to use constant across go package", "body": "<p>Create a package level variable with <code>var</code>. </p>\n\n<p>package main</p>\n\n<pre><code>import (\n    logger \"dodly_logger/logger\"\n    helpers \"dodly_logger/helpers\"\n)\n\nvar dlogger logger.Logger\n\nfunc init() {\n    dlogger = logger.NewLogger()\n}\n\nfunc main() {\n    dlogger.Info(\"Starting Main\")\n    a()\n}\n\nfunc a() {\n    dlogger.Info(\"in a\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 750, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529898268, "creation_date": 1529896747, "last_edit_date": 1529898268, "question_id": 51015877, "link": "https://stackoverflow.com/questions/51015877/how-to-use-constant-across-go-package", "title": "How to use constant across go package", "body": "<p>I'm writing my first go code and I'm trying to convince myself what I'm doing is not wrong. </p>\n\n<p>anyway, here the project the tree structure.</p>\n\n<pre><code>.\n\u251c\u2500\u2500 helpers\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 common.go\n\u251c\u2500\u2500 logger\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 util.go\n\u251c\u2500\u2500 logger_example\n\u2514\u2500\u2500 runner.go\n</code></pre>\n\n<p>The main file to look over here is <code>logger/util.go</code> which look like this.</p>\n\n<pre><code>package logger\n\nimport (\n  \"log\"\n  \"os\"\n)\n\ntype Logger struct {\n  *log.Logger\n}\n\nfunc (l *Logger) Info(v ...interface{}) {\n  l.SetPrefix(\"Info: \")\n  l.Println(v...)\n}\n\nfunc (l *Logger) Error(v ...interface{}) {\n  l.SetPrefix(\"Error: \")\n  l.Println(v...)\n}\n\nfunc (l *Logger) Warn(v ...interface{}) {\n  l.SetPrefix(\"Warn: \")\n  l.Println(v...)\n}\n\nfunc (l *Logger) Debug(v ...interface{}) {\n  l.SetPrefix(\"Debug: \")\n  l.Println(v...)\n}\n\n\n\nfunc NewLogger() *Logger {\n  logger := log.New(os.Stdout, \"\", log.Ldate|log.Ltime|log.Lshortfile)\n  return &amp;Logger{logger}\n}\n</code></pre>\n\n<p>As you all can see, I'm just setting the prefix to <code>\"INFO | WARN | ERROR | DEBUG\"</code></p>\n\n<p>On the <code>main</code> package I have safely created a Logger instance and VOILA it worked. </p>\n\n<p>Only until I decided to add a <code>helpers</code> package and now things do not look the way I wanted.</p>\n\n<p>since the <code>logger.Logger</code> instance created inside <code>main</code> package, I have to pass it reference to every since package function where I want to invoke the logger statement. (see the below example ..) </p>\n\n<pre><code>// dodly_logger/logger/common.go\npackage helpers\n\nimport \"dodly_logger/logger\"\nfunc Display(dodlyLogger *logger.Logger) {\n  dodlyLogger.Info(\"Inside a helper package\")\n}\n</code></pre>\n\n<p>The Main package..</p>\n\n<pre><code>package main\n\nimport (\n  logger \"dodly_logger/logger\"\n  helpers \"dodly_logger/helpers\"\n)\n\nfunc main() {\n  dodlyLogger := logger.NewLogger()\n  dodlyLogger.Info(\"INFO MESSAGE\")\n  dodlyLogger.Error(\"ERROR MESSAGE\")\n  // Ehh, I have to pass the dodlyLogger ..\n  helpers.Display(dodlyLogger)\n}\n</code></pre>\n\n<p>Ok, now I know my GOLang knowledge is not complete hence I'm hoping people over here can point me how can I write this more clinically wherein I do not have to pass the reference of the <code>logger.Logger</code> to every function for which I need to log.</p>\n"}, {"tags": ["go", "exec"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1529899260, "creation_date": 1529899260, "answer_id": 51016115, "question_id": 51015569, "link": "https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable/51016115#51016115", "title": "exec.Command() in Go with environment variable", "body": "<p>From <a href=\"https://gobyexample.com/environment-variables\" rel=\"nofollow noreferrer\">Go by Example: Environment Variables</a>, you can try (instead of a system command <code>echo</code>) to use <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"nofollow noreferrer\"><code>os.Getenv</code></a>:</p>\n\n<pre><code>fmt.Println(\"PATH:\", os.Getenv(\"PATH\"))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1529904527, "post_id": 51016624, "comment_id": 89026014, "body": "That seems more accurate than my answer. +1"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1529911208, "post_id": 51016624, "comment_id": 89028757, "body": "@VonC, while this answer is indeed better in addressing what was asked, I&#39;m afraid there is an XY problem, and your approach may be better. So I&#39;d say it all depends on what <i>really</i> the OP wanted to do. I, for one, would even use <code>os.LookupEnv</code> actually\u2014to trap the case when the <code>PATH</code> variable is unset in the environment for some reason."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1529914308, "post_id": 51016624, "comment_id": 89030283, "body": "No problem. I will leave my answer here for the moment, but I liked your approach."}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": false, "score": 7, "last_activity_date": 1529915274, "last_edit_date": 1529915274, "creation_date": 1529903376, "answer_id": 51016624, "question_id": 51015569, "link": "https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable/51016624#51016624", "title": "exec.Command() in Go with environment variable", "body": "<p>Your command is not being interpreted by a shell, which is why the expected variable substitution is not occurring.</p>\n\n<p>From the <a href=\"https://golang.org/pkg/os/exec/\" rel=\"noreferrer\"><code>exec</code> package documentation</a>:</p>\n\n<blockquote>\n  <p>...the os/exec package intentionally does not invoke the system shell\n  and does not expand any glob patterns or handle other expansions,\n  pipelines, or redirections typically done by shells.  </p>\n</blockquote>\n\n<p>... </p>\n\n<blockquote>\n  <p>To expand environment variables, use package os's ExpandEnv.</p>\n</blockquote>\n\n<p>So to achieve the desired result in your example:</p>\n\n<pre><code>out, err := exec.Command(\"echo\", os.ExpandEnv(\"$PATH\")).Output()\n</code></pre>\n\n<p>It's worth reviewing the set of functions for getting environment variables and using what works best for your particular use case:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/os/#ExpandEnv\" rel=\"noreferrer\"><code>func ExpandEnv(s string) string</code></a> - ExpandEnv replaces ${var} or $var in the string according to the values of the current environment variables. References to undefined variables are replaced by the empty string.</li>\n<li><a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"noreferrer\"><code>func Getenv(key string) string</code></a> - Getenv retrieves the value of the environment variable named by the key. It returns the value, which will be empty if the variable is not present. To distinguish between an empty value and an unset value, use LookupEnv.</li>\n<li><a href=\"https://golang.org/pkg/os/#LookupEnv\" rel=\"noreferrer\"><code>func LookupEnv(key string) (string, bool)</code></a> - LookupEnv retrieves the value of the environment variable named by the key. If the variable is present in the environment the value (which may be empty) is returned and the boolean is true. Otherwise the returned value will be empty and the boolean will be false.</li>\n</ul>\n"}], "owner": {"reputation": 87, "user_id": 1742320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f6c5ed3867da9738b6297293439b45?s=128&d=identicon&r=PG", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/1742320/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4436, "favorite_count": 3, "answer_count": 2, "score": 3, "last_activity_date": 1529915274, "creation_date": 1529893518, "last_edit_date": 1529903594, "question_id": 51015569, "link": "https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable", "title": "exec.Command() in Go with environment variable", "body": "<p>I would like to run following code in Go: </p>\n\n<pre><code>out, err := exec.Command(\"echo\", \"$PATH\").Output()\n</code></pre>\n\n<p>The result was:</p>\n\n<pre><code>$PATH\n</code></pre>\n\n<p>Instead of the expected value of \"PATH=/bin...\".</p>\n\n<p>Why? And how can I get the expected value?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1529901937, "post_id": 51015548, "comment_id": 89025313, "body": "It is exactly that: given you don&#39;t have any other way to identify it - you must do that explicitly via arguments. And as always - explicit is better than implicit."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1529906225, "post_id": 51015548, "comment_id": 89026611, "body": "This is a design decision by the language authors. Thread-identity is easily miss-used in larger codebases that the designed the language to not even allow this use."}], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "is_accepted": false, "score": 0, "last_activity_date": 1529957600, "creation_date": 1529957600, "answer_id": 51031196, "question_id": 51015548, "link": "https://stackoverflow.com/questions/51015548/why-does-a-goroutine-have-no-identity/51031196#51031196", "title": "Why does a goroutine have no identity", "body": "<p>I recommend looking at this post for an example of why someone might want to get information about the current thread/thread a function is running in:\n<a href=\"https://stackoverflow.com/questions/2374451/how-to-tell-if-a-thread-is-the-main-thread-in-c-sharp\">stackoverflow - main threads in C#</a></p>\n\n<p>As pointed out in the question, conditioning the behavior of a function on certain thread requirements (most likely) produces fragile/error-prone code that is difficult to debug.</p>\n\n<p>I guess what your text book is trying to say is that a function should never rely on running in a specific thread, look up threads, etc. because this can cause unexpected behavior (especially in an API, if it's not obvious to the end-user that a function has to run in a specific thread). In Go, anything like that is impossible purely by language design. The behavior of a goroutine never depends on threads or something similar just because goroutines <code>don't have an identity</code> as you say correctly.</p>\n"}, {"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 2, "last_activity_date": 1531227801, "creation_date": 1531227801, "answer_id": 51266024, "question_id": 51015548, "link": "https://stackoverflow.com/questions/51015548/why-does-a-goroutine-have-no-identity/51266024#51266024", "title": "Why does a goroutine have no identity", "body": "<p>Let's say we have the following code:</p>\n\n<pre><code>func doubler(num int) { \n    return num + num\n}\n</code></pre>\n\n<p><code>doubler(5)</code> will return <code>10</code>. <code>go doubler(5)</code> will also return <code>10</code>.</p>\n\n<p>You can do the same with some sort of thread-local storage, if you want:</p>\n\n<pre><code>func doubler() { \n    return getThreadLocal(\"num\") + getThreadLocal(\"num\")\n}\n</code></pre>\n\n<p>And we could run this with something like:</p>\n\n<pre><code>go func() {\n    setThreadLocal(\"num\", 10)\n    doubler()\n}()\n</code></pre>\n\n<p>But which is clearer? The variant which explicitly passes the <code>num</code> argument, or the variant which \"magically\" gets this from sort of thread-local storage?</p>\n\n<p>This is what is meant with \"action at a distance\". The line <code>setThreadLocal(\"num\", 10)</code> (which is distant) affects how <code>doubler()</code> behaves.</p>\n\n<hr>\n\n<p>This example is clearly artificial, but the same principle applies with more real examples. For example, in some environments it's not uncommon to use thread-local store things such as user information, or other \"global\" variables.</p>\n\n<p>This is why the paragraph you quoted compared it to global variables: thread-local storage <em>are</em> global variables, applicable only to the current thread.</p>\n\n<p>When you passing parameters as arguments things are a lot clearer defined. There is no magic (often undocumented) global state that you need to think of when debugging things or writing tests.</p>\n"}], "owner": {"reputation": 329, "user_id": 9437085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bZbW0.jpg?s=128&g=1", "display_name": "gyuaisdfaasf", "link": "https://stackoverflow.com/users/9437085/gyuaisdfaasf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1531227801, "creation_date": 1529893246, "last_edit_date": 1531227031, "question_id": 51015548, "link": "https://stackoverflow.com/questions/51015548/why-does-a-goroutine-have-no-identity", "title": "Why does a goroutine have no identity", "body": "<p>I new to golang and I am reading the example from the book gopl.</p>\n\n<p>Section 9.8.4 of The Go Programming Language book explains why Goroutines have no notion of identity that is accessible to the programmer</p>\n\n<blockquote>\n  <p>Goroutines have no notion of identity that is accessible to the programmer. This is by design, since thread-local storage tends to be abused. For example, in a web server implemented in a language with thread-local storage, it\u2019s common for many functions to \ufb01nd information about the HTTP request on whose behalf they are currently working by looking in that storage. However, just as with programs that rely excessively on global variables, this can lead to an unhealthy \u2018\u2018action at a distance\u2019\u2019 in which the behavior of a function is not determined by its arguments alone, but by the identity of the thread in which it runs. Consequently, if the identity of the thread should change\u2014some worker threads are enlisted to help, say\u2014the function misbehaves mysteriously.</p>\n</blockquote>\n\n<p>and use the example of web server to illustrate this point. However, I have difficulty in understanding why the so called \"action at a distance\" is a bad practice and how this leads to </p>\n\n<blockquote>\n  <p>a function is not determined by its arguments alone, but by the identity of the thread in which it runs.</p>\n</blockquote>\n\n<p>could anyone give an explanation for this(preferably in short code snippets)</p>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["go", "credentials", "credential-manager"], "answers": [{"tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 0, "last_activity_date": 1530005685, "creation_date": 1530005685, "answer_id": 51039540, "question_id": 51015400, "link": "https://stackoverflow.com/questions/51015400/go-package-wincred-adding-spaces-when-converting-password-from-byte-to-string/51039540#51039540", "title": "Go package wincred adding spaces when converting password from []byte to string", "body": "<p>The returned result looks like <a href=\"https://en.wikipedia.org/wiki/UTF-16\" rel=\"nofollow noreferrer\">UTF-16</a>.</p>\n\n<p>Is <code>wincred</code>'s UTF-16 conversion working properly? Good to check with the authors.</p>\n"}, {"tags": [], "owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "is_accepted": true, "score": 0, "last_activity_date": 1539145905, "creation_date": 1539145905, "answer_id": 52732664, "question_id": 51015400, "link": "https://stackoverflow.com/questions/51015400/go-package-wincred-adding-spaces-when-converting-password-from-byte-to-string/52732664#52732664", "title": "Go package wincred adding spaces when converting password from []byte to string", "body": "<p>As a workaround I'm removing the null bytes which work's for my purposes for the time being but this is unlikely to be the right solution. </p>\n\n<pre><code>bytes.Replace(myBytes, []byte(\"\\000\"), nil, -1)\n</code></pre>\n"}], "owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 52732664, "answer_count": 2, "score": 2, "last_activity_date": 1539145905, "creation_date": 1529891825, "last_edit_date": 1529893617, "question_id": 51015400, "link": "https://stackoverflow.com/questions/51015400/go-package-wincred-adding-spaces-when-converting-password-from-byte-to-string", "title": "Go package wincred adding spaces when converting password from []byte to string", "body": "<p>I'm using Windows Credential Manager to store database credentials for my application built in Go through the <a href=\"https://github.com/danieljoos/wincred\" rel=\"nofollow noreferrer\">wincred package</a>.</p>\n\n<p>It works for retrieving passwords for credentials created by the package itself, however for credentials created straight through Windows Credential Manager, the package is adding \"spaces\" (byte '0') between the characters when converting from []byte to string.</p>\n\n<pre><code>//Retrieve a credential object\npackage main\n\nimport (\n    \"fmt\"\n    \"github.com/danieljoos/wincred\"\n)\n\nfunc main() {\n    cred, err := wincred.GetGenericCredential(\"myGoApplication\")\n    if err == nil {\n        fmt.Println(string(cred.CredentialBlob))\n    }\n} \n</code></pre>\n\n<p>In the example above I've set the password for \"myGoApplication\" as 123456, but it retrieves as</p>\n\n<blockquote>\n  <p>1 2 3 4 5 6</p>\n</blockquote>\n\n<p>The []byte representation is</p>\n\n<blockquote>\n  <p>[49 0 50 0 51 0 52 0 53 0 54 0]</p>\n</blockquote>\n\n<p>I'm wondering if anyone has any idea on what might be causing this issue.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1529883077, "post_id": 51014764, "comment_id": 89022271, "body": "The type of <code>Sample.Env</code> is a string. Change the signature of the <code>call</code> method accordingly: <code>func (p *Sample) call() *string {</code>"}, {"owner": {"reputation": 31, "user_id": 9986553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21565eb98116ef12edc9addb7fa24b5?s=128&d=identicon&r=PG&f=1", "display_name": "lamesaint", "link": "https://stackoverflow.com/users/9986553/lamesaint"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1529890025, "post_id": 51014764, "comment_id": 89023244, "body": "It works. Thank you.Could you please suggest how to convert the memory address returned in main to format to print its value"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9986553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21565eb98116ef12edc9addb7fa24b5?s=128&d=identicon&r=PG&f=1", "display_name": "lamesaint", "link": "https://stackoverflow.com/users/9986553/lamesaint"}, "edited": false, "score": 0, "creation_date": 1529888970, "post_id": 51015006, "comment_id": 89023052, "body": "It works. Thank you.Could you please suggest how to convert the memory address returned in main to format to print its value."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 0, "last_activity_date": 1530956310, "last_edit_date": 1530956310, "creation_date": 1529886645, "answer_id": 51015006, "question_id": 51014764, "link": "https://stackoverflow.com/questions/51014764/how-to-return-a-struct-variable-in-a-method/51015006#51015006", "title": "How to return a struct variable in a method", "body": "<p>Function types are defined by the keyword <code>func</code>, followed by an optional receiver, followed by the function name, the parameter list between parentheses (which may be empty), and the result list (which may be empty), and then the function body.</p>\n\n<p>The result list (zero or more types) is the contract for what the function will return.  It can be a list of types or a list of named parameters including their types.</p>\n\n<p>In your function definition for <code>call()</code>:</p>\n\n<pre><code>func (p *Sample) call() *Sample.Env {\n</code></pre>\n\n<p>Your result list does not meet this expectation.  <code>*Sample.Env</code> is a pointer to the <code>Env</code> property of type <code>Sample</code>, but not a type itself.</p>\n\n<p>Your function returns value <code>&amp;p.Env</code>.  If you modify your function signature so that the result list is simply the type of <code>&amp;p.Env</code>, then your program will run.  <code>p.Env</code> is a string, therefore <code>&amp;p.Env</code> is a pointer to a string.  <code>*string</code> is the type \"pointer to a string.\"  Therefore if you change your function signature to this your code will work:</p>\n\n<pre><code>func (p *Sample) call() *string {\n</code></pre>\n\n<p>See:</p>\n\n<ol>\n<li><a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">Function Types</a></li>\n<li><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">Types</a></li>\n</ol>\n\n<h2>Post script</h2>\n\n<p>The return type of <code>call()</code> is <code>*string</code> -- that is, a pointer to a string.  So to print it you simply dereference it to a string with the asterisk:</p>\n\n<pre><code>env := pa.call()\nfmt.Printf(\"Env is %s\\n\", *env)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9986553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21565eb98116ef12edc9addb7fa24b5?s=128&d=identicon&r=PG&f=1", "display_name": "lamesaint", "link": "https://stackoverflow.com/users/9986553/lamesaint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1062, "favorite_count": 0, "accepted_answer_id": 51015006, "answer_count": 1, "score": -1, "last_activity_date": 1530956310, "creation_date": 1529883014, "last_edit_date": 1529885791, "question_id": 51014764, "link": "https://stackoverflow.com/questions/51014764/how-to-return-a-struct-variable-in-a-method", "title": "How to return a struct variable in a method", "body": "<p>This program does not compile. It shows that the <code>Env</code> method is not available on the struct <code>sample</code> on method <code>call</code>. I can access the <code>Env</code> variable directly in the main program, but I'm curious to know why this is not compiling.</p>\n\n<pre><code>package main\n\n//Sample is a struct\ntype Sample struct {\n    Env string\n}\n\nfunc main() {\n    pa := &amp;Sample{Env: \"acd\"}\n    pa.call()\n}\n\nfunc (p *Sample) call() *Sample.Env {\n    return &amp;p.Env\n}\n</code></pre>\n"}, {"tags": ["go", "libchan"], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529884786, "post_id": 51014666, "comment_id": 89022482, "body": "I&#39;m still having trouble understanding how the pipe can span the network. what are <code>receiver</code> and <code>sender</code> in your last example if not in-memory channels? Also, <code>end1</code> and <code>end2</code> dont seem to be doing anything."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529885092, "post_id": 51014666, "comment_id": 89022526, "body": "My question is specifically related to this line in your <code>ReceiveTestRoutine</code>: <code>if err := msg.Ret.Send(message); err != nil {             t.Fatal(err)         }</code> how can the <code>Ret</code> send if its being stored inmemory on the client? The client and server machines will not share memory in real life."}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529885995, "post_id": 51014666, "comment_id": 89022648, "body": "Added a bit more clarification at the end to illustrate the parallel to the unit test. As you point out, there&#39;s no shared memory involved. It&#39;s just a pair of <code>libchan.Sender</code>/<code>libchan.Receiver</code>, just like you get from <code>Pipe()</code>. The difference being the network transport in-between instead of the in-memory channel utilized in the unit test."}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529886346, "post_id": 51014666, "comment_id": 89022694, "body": "Also, my snippet from <code>inmem_test.go</code> does not include the whole <code>SpawnPipeTestRoutines()</code> implementation, just the part necessary for the communications explanation. <code>end1</code> and <code>end2</code> end up being used to verify that the client and server functions complete without any test failures."}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": false, "score": 0, "last_activity_date": 1579167459, "last_edit_date": 1579167459, "creation_date": 1529881631, "answer_id": 51014666, "question_id": 51014324, "link": "https://stackoverflow.com/questions/51014324/need-help-understanding-how-libchan-works/51014666#51014666", "title": "Need help understanding how libchan works", "body": "<p>First, it's good to know that all <code>Pipe()</code> does is make a channel and return the in-memory sender/receiver pair.</p>\n\n<p>From <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/inmem.go#L74\" rel=\"nofollow noreferrer\"><code>inmem.go</code></a>:</p>\n\n<pre><code>// Pipe returns an inmemory Sender/Receiver pair.\nfunc Pipe() (Receiver, Sender) {\n    c := make(chan interface{})\n    return pReceiver(c), pSender(c)\n}\n</code></pre>\n\n<p>Then you can look in <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/inmem_test.go\" rel=\"nofollow noreferrer\"><code>inmem_test.go</code></a> for a simple end-to-end example.</p>\n\n<p><a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/inmem_test.go#L14\" rel=\"nofollow noreferrer\">This struct</a> is the equivalent of <code>RemoteCommand</code> from the demo.</p>\n\n<pre><code>type InMemMessage struct {\n    Data   string\n    Stream io.ReadWriteCloser\n    Ret    Sender\n}\n</code></pre>\n\n<p>In <code>TestInmemRetPipe()</code>, a simple client and server are created. </p>\n\n<p><a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/inmem_test.go#L21\" rel=\"nofollow noreferrer\">The client</a> creates a local sender/receiver pair using <code>Pipe()</code>, while <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/inmem_test.go#L40\" rel=\"nofollow noreferrer\">the server</a> simply uses the <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/libchan.go#L18\" rel=\"nofollow noreferrer\"><code>libchan.Sender</code> interface</a> in the <code>InMemMessage</code> struct. </p>\n\n<p>Note that the client and server are functions which receive a <code>Sender</code> or <code>Receiver</code> as an argument respectively. More on this in the next code snippet.</p>\n\n<pre><code>func TestInmemRetPipe(t *testing.T) {\n    client := func(t *testing.T, w Sender) {\n        ret, retPipe := Pipe()\n        message := &amp;InMemMessage{Data: \"hello\", Ret: retPipe}\n\n        err := w.Send(message)\n        if err != nil {\n            t.Fatal(err)\n        }\n        msg := &amp;InMemMessage{}\n        err = ret.Receive(msg)\n        if err != nil {\n            t.Fatal(err)\n        }\n\n        if msg.Data != \"this better not crash\" {\n            t.Fatalf(\"%#v\", msg)\n        }\n\n    }\n    server := func(t *testing.T, r Receiver) {\n        msg := &amp;InMemMessage{}\n        err := r.Receive(msg)\n        if err != nil {\n            t.Fatal(err)\n        }\n\n        if msg.Data != \"hello\" {\n            t.Fatalf(\"Wrong message:\\n\\tExpected: %s\\n\\tActual: %s\", \"hello\", msg.Data)\n        }\n        if msg.Ret == nil {\n            t.Fatal(\"Message Ret is nil\")\n        }\n\n        message := &amp;InMemMessage{Data: \"this better not crash\"}\n        if err := msg.Ret.Send(message); err != nil {\n            t.Fatal(err)\n        }\n    }\n    SpawnPipeTestRoutines(t, client, server)\n\n}\n</code></pre>\n\n<p><code>SpawnPipeTestRoutines()</code> executes the client and server functions. In this function, another sender/receiver pair is instantiated via <code>Pipe()</code>.  </p>\n\n<p><strong>In the demo application, the function being performed here by <code>Pipe()</code> (i.e. facilitating communication between the client and server instances) is instead handled via network communications.</strong></p>\n\n<pre><code>func SpawnPipeTestRoutines(t *testing.T, s SendTestRoutine, r ReceiveTestRoutine) {\n    end1 := make(chan bool)\n    end2 := make(chan bool)\n\n    receiver, sender := Pipe()\n\n    go func() {\n        defer close(end1)\n        s(t, sender)\n        err := sender.Close()\n        if err != nil {\n            t.Fatalf(\"Error closing sender: %s\", err)\n        }\n    }()\n\n    go func() {\n        defer close(end2)\n        r(t, receiver)\n    }()\n    ...\n</code></pre>\n\n<p>In the demo application, the communication is facilitated by calls to <a href=\"https://godoc.org/github.com/docker/libchan/spdy#Transport.NewSendChannel\" rel=\"nofollow noreferrer\">Transport.NewSendChannel()</a> on the client and <a href=\"https://godoc.org/github.com/docker/libchan/spdy#Transport.WaitReceiveChannel\" rel=\"nofollow noreferrer\">Transport.WaitReceiveChannel()</a>, which return a <code>libchan.Sender</code> and <code>libchan.Receiver</code> respectively. These libchan instances handle facilitating the \"pipe\" via the network.</p>\n\n<p>From client.go:</p>\n\n<pre><code>sender, err := transport.NewSendChannel()\n...\nerr = sender.Send(command)\n</code></pre>\n\n<p>From server.go:</p>\n\n<pre><code>receiver, err := t.WaitReceiveChannel()\n...\nerr := receiver.Receive(command)\n</code></pre>\n\n<p>In both cases, the prerequisite transport configuration is done beforehand (i.e. binding to sockets, utilizing TLS, etc.). </p>\n\n<p>It's probably also worth noting that <a href=\"https://github.com/docker/libchan/tree/master/spdy\" rel=\"nofollow noreferrer\">the spdy library being used is part of the libchan distribution</a>, hence it providing libchan primitives.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1579167459, "creation_date": 1529877631, "question_id": 51014324, "link": "https://stackoverflow.com/questions/51014324/need-help-understanding-how-libchan-works", "title": "Need help understanding how libchan works", "body": "<p>I'm trying to use the <a href=\"https://github.com/docker/libchan/\" rel=\"nofollow noreferrer\">libchan</a> library to send messages between machines using a go channel-like transport.</p>\n\n<p>From what I've gathered, the rough idea is this:</p>\n\n<ol>\n<li>You have a SPDY client that sends a serialized command object to an address over tcp. This command object contains a libchan channel called a <code>Pipe</code> that the response is sent through.</li>\n<li>When the server receives an incoming connection, it waits for a command object. When it gets one, it sends a response through the <code>Pipe</code> contained in the object.</li>\n</ol>\n\n<p>Here's my point of confusion. For a channel to persist between two machines, they'd have to share memory or atleast share an abstraction that connects the two of them. From my grokking of the libchan codebase, I have no idea how this could be possible.</p>\n\n<p>Here's a snippet from the example in the repo:</p>\n\n<pre><code>// client\n\n    receiver, remoteSender := libchan.Pipe()\n    command := &amp;RemoteCommand{\n        Cmd:        os.Args[1],\n        Args:       os.Args[2:],\n        Stdin:      os.Stdin,\n        Stdout:     os.Stdout,\n        Stderr:     os.Stderr,\n        StatusChan: remoteSender,\n    }\n\n    err = sender.Send(command)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = receiver.Receive(response)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    os.Exit(response.Status)\n</code></pre>\n\n<p>and the server:</p>\n\n<pre><code>// server\nt := spdy.NewTransport(p)\n\n        go func() {\n            for {\n                receiver, err := t.WaitReceiveChannel()\n                if err != nil {\n                    log.Print(\"receiver error\")\n                    log.Print(err)\n                    break\n                }\n                log.Print(\"about to spawn receive proc\")\n                go func() {\n                    for {\n                        command := &amp;RemoteReceivedCommand{}\n                        err := receiver.Receive(command)\n                        returnResult := &amp;CommandResponse{}\n                        if res != nil {\n                            if exiterr, ok := res.(*exec.ExitError); ok {\n                                returnResult.Status = exiterr.Sys(). \n                              (syscall.WaitStatus).ExitStatus()\n                            } else {\n                                log.Print(\"res\")\n                                log.Print(res)\n                                returnResult.Status = 10\n                            }\n                        }\n                        err = command.StatusChan.Send(returnResult)\n</code></pre>\n\n<p>The point I'm trying to hone in is here:</p>\n\n<pre><code>libchan.Pipe()\n</code></pre>\n\n<p>According to the source, this returns a channel. One reference is kept on the client, and the other is sent to the server. This channel is then used to pipe values from the latter to the former. How does this actually work in practice?</p>\n\n<p>Full code for <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/examples/rexec/client.go\" rel=\"nofollow noreferrer\">client</a> and <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/examples/rexec/rexec_server/server.go\" rel=\"nofollow noreferrer\">server</a></p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "edited": false, "score": 0, "creation_date": 1529927892, "post_id": 51014074, "comment_id": 89038248, "body": "Ok thanks that clears things up, better than &quot;You cannot use the Cloud Datastore client library with Go applications in the App Engine standard environment.&quot;"}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "reply_to_user": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "edited": false, "score": 3, "creation_date": 1529942083, "post_id": 51014074, "comment_id": 89047314, "body": "If this answers your question, feel free to accept it."}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": true, "score": 4, "last_activity_date": 1529958620, "last_edit_date": 1529958620, "creation_date": 1529875418, "answer_id": 51014074, "question_id": 51013956, "link": "https://stackoverflow.com/questions/51013956/google-golang-org-appengine-datastore-vs-cloud-google-com-go-datastore/51014074#51014074", "title": "google.golang.org/appengine/datastore vs cloud.google.com/go/datastore", "body": "<p>From the <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/#connecting_to_datastore_name_short_with_app_engine\" rel=\"nofollow noreferrer\"><strong>Connecting to Cloud Datastore with App Engine</strong> section in the App Engine Cloud Datastore Overview</a>:</p>\n\n<blockquote>\n  <p>You cannot use the Cloud Datastore client library with Go applications\n  in the App Engine standard environment.</p>\n</blockquote>\n\n<p>Basically, <code>cloud.google.com/go/datastore</code> is for using Cloud Datastore <em>outside of the App Engine standard environment</em>. This includes non-App Engine environments, as well as the App Engine flexible environment.</p>\n\n<p><code>google.golang.org/appengine/datastore</code> is for using it <em>within the App Engine standard environment</em>.</p>\n\n<p>For local testing of the App Engine standard environment, look into using <a href=\"https://cloud.google.com/appengine/docs/standard/go/tools/local-devserver-command\" rel=\"nofollow noreferrer\">dev_appserver.py</a> which provides integration with the Cloud Datastore emulator via the <code>--support_datastore_emulator</code> flag.</p>\n"}], "owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 629, "favorite_count": 0, "accepted_answer_id": 51014074, "answer_count": 1, "score": 3, "last_activity_date": 1529958620, "creation_date": 1529874311, "last_edit_date": 1529875728, "question_id": 51013956, "link": "https://stackoverflow.com/questions/51013956/google-golang-org-appengine-datastore-vs-cloud-google-com-go-datastore", "title": "google.golang.org/appengine/datastore vs cloud.google.com/go/datastore", "body": "<p>I built a small go app, for use in AppEngine. I run the go locally through <code>go run ..</code>, and I am trying to use the datastore.</p>\n\n<p>I run the datastore emulator locally through <code>gcloud beta emulators datastore start</code> and by exporting <code>DATASTORE_EMULATOR_HOST</code> the go app can locally connect to it.</p>\n\n<p>So I built my app using <code>cloud.google.com/go/datastore</code>, but when I deployed this to AppEngine any go code that connects to the datastore seems to make the whole app fail with a timeout.</p>\n\n<p>Whilst trying to debug this I ran into code using <code>google.golang.org/appengine/datastore</code> and writing some test code I got things to work on AppEngine.</p>\n\n<p>However this <em>datastore</em> does not seem to be able to connect to the datastore emulator.</p>\n\n<ol>\n<li>Has anyone run into the timeout issue when using <code>cloud.google.com/go/datastore</code>? I seem to read on different answers that people say to use <em>this</em> package and not the golang.org package for some reason.</li>\n<li>Can I use <code>cloud.google.com/go/datastore</code> on AppEngine? I would prefer to use this package, since it works with the datastore emulator.</li>\n</ol>\n\n<p>I am using the following code, in short:</p>\n\n<pre><code>import \"cloud.google.com/go/datastore\"\n...\nctx := appengine.NewContext(r)\n...\nclient, err := datastore.NewClient(dsCtx, projectID)\n...\nkey := datastore.IDKey(TestKind, testID, nil)\nerr = client.Get(ctx, key, &amp;data)\n</code></pre>\n\n<p>This is the code that times out on AppEngine, but works fine locally.</p>\n\n<p>The code that likewise works on AppEngine is this:</p>\n\n<pre><code>import \"google.golang.org/appengine/datastore\"\n...\nctx := appengine.NewContext(r)\nkey := datastore.NewKey(ctx, TestKind, \"\", testID, nil)\nerr := datastore.Get(ctx, key, &amp;data)\n</code></pre>\n\n<p>And this will fail locally with the following:</p>\n\n<pre><code>Metadata fetch failed: Get http://metadata/computeMetadata/v1/instance/attributes/gae_project: dial tcp: lookup metadata: no such host\n</code></pre>\n\n<p>Any help would be much appreciated.</p>\n"}, {"tags": ["python", "go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": false, "score": 3, "last_activity_date": 1530308640, "last_edit_date": 1530308640, "creation_date": 1529872317, "answer_id": 51013708, "question_id": 51012776, "link": "https://stackoverflow.com/questions/51012776/compatibility-between-a-grpc-server-in-go-and-a-client-in-python/51013708#51013708", "title": "Compatibility between a gRPC server in Go and a client in Python", "body": "<p>gRPC provides error handling that fits the language being used.</p>\n\n<p>As you noted, in a <a href=\"https://github.com/grpc/grpc-go/blob/8e187527667212cfe1b2b64727c7f83e95c6591f/examples/route_guide/server/server.go#L126\" rel=\"nofollow noreferrer\">Go server</a> you return an error:</p>\n\n<pre><code>func (s *routeGuideServer) RouteChat(stream pb.RouteGuide_RouteChatServer) error {\nfor {\n    in, err := stream.Recv()\n    if err == io.EOF {\n        return nil\n    }\n    if err != nil {\n        return err\n    }\n    ...\n</code></pre>\n\n<p>In a Python client, you execute the API call in a <code>try</code> statement (contrived example, since the official documentation doesn't demonstrate this):</p>\n\n<pre><code>while True:\n  try:\n    received_route_note = stub.RouteChat(sent_route_note_iterator)\n  except grpc.Error as e:\n    print(e.details())\n    break\n</code></pre>\n\n<p>Conversely, in a Python server, you set the context and, optionally, raise an exception:</p>\n\n<ul>\n<li><p>example from the <a href=\"https://grpc.io/docs/reference/python/generated-code.html\" rel=\"nofollow noreferrer\">Python Generated Code Reference</a>:</p>\n\n<pre><code>def TellFortune(self, request, context):\n  \"\"\"Returns the horoscope and zodiac sign for the given month and day.\n  errors: invalid month or day, fortune unavailable\n  \"\"\"\n  context.set_code(grpc.StatusCode.UNIMPLEMENTED)\n  context.set_details('Method not implemented!')\n  raise NotImplementedError('Method not implemented!')\n</code></pre></li>\n<li><p>example from the <a href=\"https://github.com/grpc/grpc/blob/master/src/python/grpcio_tests/tests/testing/_server_application.py\" rel=\"nofollow noreferrer\">grpc repository</a></p>\n\n<pre><code>def UnUn(self, request, context):\n  if _application_common.UNARY_UNARY_REQUEST == request:\n      return _application_common.UNARY_UNARY_RESPONSE\n  else:\n      context.set_code(grpc.StatusCode.INVALID_ARGUMENT)\n      context.set_details('Something is wrong with your request!')\n      return services_pb2.Down()\n</code></pre></li>\n</ul>\n\n<p>And in a <a href=\"https://github.com/grpc/grpc-go/blob/8e187527667212cfe1b2b64727c7f83e95c6591f/examples/route_guide/client/client.go#L119\" rel=\"nofollow noreferrer\">Go client</a> an <code>error</code> object is (one of) the result parameters:</p>\n\n<pre><code>stream, err := client.RouteChat(ctx)\nif err != nil {\n    log.Fatalf(\"%v.RouteChat(_) = _, %v\", client, err)\n}\n</code></pre>\n\n<hr>\n\n<p>It's unfortunate that the official documentation doesn't seem to explicitly cover error handling practices.</p>\n\n<p>A good 3rd party reference I found is at <a href=\"http://avi.im/grpc-errors/\" rel=\"nofollow noreferrer\">http://avi.im/grpc-errors/</a></p>\n"}], "owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536345253, "creation_date": 1529864722, "last_edit_date": 1529872630, "question_id": 51012776, "link": "https://stackoverflow.com/questions/51012776/compatibility-between-a-grpc-server-in-go-and-a-client-in-python", "title": "Compatibility between a gRPC server in Go and a client in Python", "body": "<p>I want to know about the compatibility about a gRPC service in Go and a client in Python.</p>\n\n<p>For instance <a href=\"https://grpc.io/docs/tutorials/basic/go.html\" rel=\"nofollow noreferrer\">if the service is implemented in Go</a>, it will have signatures like this:</p>\n\n<pre><code>...\n\nfunc (s *routeGuideServer) GetFeature(ctx context.Context, point *pb.Point) (*pb.Feature, error) {\n        ...\n}\n...\n\nfunc (s *routeGuideServer) ListFeatures(rect *pb.Rectangle, stream pb.RouteGuide_ListFeaturesServer) error {\n        ...\n}\n...\n\nfunc (s *routeGuideServer) RecordRoute(stream pb.RouteGuide_RecordRouteServer) error {\n        ...\n}\n...\n\nfunc (s *routeGuideServer) RouteChat(stream pb.RouteGuide_RouteChatServer) error {\n        ...\n}\n</code></pre>\n\n<p>Note how <code>error</code> objects are returned.</p>\n\n<p>Now, if I have to <a href=\"https://grpc.io/docs/tutorials/basic/python.html\" rel=\"nofollow noreferrer\">implement the client in Python it will be something like this</a>:</p>\n\n<pre><code>feature = stub.GetFeature(point)\nfor received_route_note in stub.RouteChat(sent_route_note_iterator):\n</code></pre>\n\n<p>What happens to the <code>error</code> field that is returned by the Go service implementation? If there is an error from the server side how can it be handled in the Python client?</p>\n"}, {"tags": ["http", "go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "is_accepted": true, "score": 6, "last_activity_date": 1529854082, "creation_date": 1529854082, "answer_id": 51011321, "question_id": 51010538, "link": "https://stackoverflow.com/questions/51010538/go-gorilla-mux-subrouter-with-static-files/51011321#51011321", "title": "Go Gorilla mux subrouter with static files", "body": "<p>Try changing the sub fileserver line to (include the <code>sub</code> path in the StripPrefix call)</p>\n\n<pre><code>sub.Handle(\"/static\", http.StripPrefix(\"/sub/static\", http.FileServer(http.Dir(\"./\"))))\n</code></pre>\n\n<p>The code below works for me</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Index\"))\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.Handle(\"/static\", http.StripPrefix(\"/static\", http.FileServer(http.Dir(\"./\"))))\n    r.HandleFunc(\"/\", index)\n\n    sub := r.PathPrefix(\"/sub\").Subrouter()\n    sub.Handle(\"/static\", http.StripPrefix(\"/sub/static\", http.FileServer(http.Dir(\"./\"))))\n    sub.HandleFunc(\"/\", index)\n\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 7468692, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208091754318419/picture?type=large", "display_name": "No&#232; Murr", "link": "https://stackoverflow.com/users/7468692/no%c3%a8-murr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1104, "favorite_count": 0, "accepted_answer_id": 51011321, "answer_count": 1, "score": 1, "last_activity_date": 1529854082, "creation_date": 1529848161, "question_id": 51010538, "link": "https://stackoverflow.com/questions/51010538/go-gorilla-mux-subrouter-with-static-files", "title": "Go Gorilla mux subrouter with static files", "body": "<h1>Problem</h1>\n\n<p>Hello, I want to create a web server that presents 2 pages and 2 static directory using a router and a subrouter.</p>\n\n<p>I cannot understand why the static directory served by the router is shown while the static server handled by the subrouter is not working.</p>\n\n<p>The code,the file system scheme and the web pages: shown and wanted are shown below.</p>\n\n<h1>File system scheme</h1>\n\n<pre><code>ProjectFolder/\n    testFile\n    test.go\n</code></pre>\n\n<h1>Code</h1>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Index\"));\n}\n\nfunc main () {\n    r := mux.NewRouter()\n    sub := r.PathPrefix(\"/sub\").Subrouter()\n    r.HandleFunc(\"/\", index)\n    r.Handle(\"/static\", http.StripPrefix(\"/static\", http.FileServer(http.Dir(\"./\"))))\n    sub.Handle(\"/static\", http.StripPrefix(\"/static\", http.FileServer(http.Dir(\"./\"))))\n    sub.HandleFunc(\"/\", index)\n\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<h1>Pages that I want in the web server</h1>\n\n<pre><code>http://localhost:8080/ ----&gt; (index)\nhttp://localhost:8080/static ---&gt; (presentation of the file systemfolder)\nhttp://localhost:8080/sub/ ---&gt; (index)\nhttp://localhost:8080/sub/static ---&gt; (presentation of the file system folder)\n</code></pre>\n\n<h1>Pages that I have in the web server</h1>\n\n<pre><code>http://localhost:8080/ ----&gt; (index)\nhttp://localhost:8080/static ---&gt; (presentation of the file system folder)\nhttp://localhost:8080/sub/ ---&gt; (index)\nhttp://localhost:8080/sub/static ---&gt; (404 page not found)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1529836358, "post_id": 51008599, "comment_id": 89010839, "body": "Your second attempt is the correct one, using only <code>&quot;client&quot;</code> will look for such a package in <code>$GOPATH&#47;src&#47;client</code>. That said, I&#39;m unsure why in both cases the error message mentions &quot;transport&quot; in the paths.. Is any of your code, that you haven&#39;t shared, referencing a &quot;transport&quot; package?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1529848421, "post_id": 51008599, "comment_id": 89013760, "body": "Please read &quot;How to Write Go Code&quot; carefully one more time. Then ask yourself why <code>import &quot;client&quot;</code> should work. That simply is not how import works with the go tool. Just stick to what &quot;How to Write Go Code&quot; tells you. Word for word."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1529870523, "post_id": 51008599, "comment_id": 89019695, "body": "Did you read the question @Volker? <code>github.com&#47;user&#47;myproject&#47;client</code> threw an error."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1529905846, "post_id": 51008599, "comment_id": 89026463, "body": "I did and your question, the error(s) and your code do not make much sense if combined: They are inconsistent. And you have some strange Go installation. It is really up to <i>you</i> to provide enough sound and consistent information so that <i>we</i> can help you."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529937244, "post_id": 51008599, "comment_id": 89044330, "body": "Dear Volker, can you explain what he is doing wrong? I think he is doing exactly as it should be done, but something else is wrong, which I explained in my answer. I wonder if you agree with this, please elaborate, we might all learn from that. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529870505, "post_id": 51009771, "comment_id": 89019684, "body": "Did you read my question? trying to import <code>github.com&#47;user&#47;myproject&#47;client</code> threw an error"}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1529876875, "post_id": 51009771, "comment_id": 89021193, "body": "I edited my answer, so it will be better readable for others which land on this page."}], "tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": 0, "last_activity_date": 1529922761, "last_edit_date": 1529922761, "creation_date": 1529841854, "answer_id": 51009771, "question_id": 51008599, "link": "https://stackoverflow.com/questions/51008599/cannot-find-package-within-project-directory/51009771#51009771", "title": "Cannot find package within project directory", "body": "<p>You should not import <code>clien</code>t but which path is coming from <code>GOPATH/src</code>, in this particular case <code>github.com/user/myproject/client</code> because that is your path.</p>\n\n<p>I see that the way you describe your problem is not exactly the way it is on your computer. You replaced some things. That is understandable, you do not want to tell the world how your computer looks like. So you replaced your name with \"<code>&lt;me&gt;</code>\". </p>\n\n<p>You also replaced the projectname, with <code>MyProject</code> in your question, that is also, just like the user name, a potential spot for an error which we cannot see, because you replaced it. Never use long names in development-paths on Windows, because Windows is doing dirty tricks with them, sometimes.</p>\n\n<p>I am sure there is something the matter which is a problem. Try using your short-directory name in the go-path. Check this: <a href=\"https://superuser.com/questions/1182040/strange-short-path-name-on-windows\">https://superuser.com/questions/1182040/strange-short-path-name-on-windows</a></p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 600, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1529922761, "creation_date": 1529832500, "question_id": 51008599, "link": "https://stackoverflow.com/questions/51008599/cannot-find-package-within-project-directory", "title": "Cannot find package within project directory", "body": "<p>I've been trying to solve this problem for the past two hours. I cannot, for the life of me, understand how the folks who developed Go did such a fine job with the language but such a terrible job with package management.</p>\n\n<p>Here is my <code>go env</code> output:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/&lt;me&gt;/Library/Caches/go-build\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/&lt;me&gt;/Documents/Proj/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/opt/go/libexec\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/opt/go/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/z4/b3lxy_51405_b8pb_680l4xh0000gn/T/go-build063693521=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>Notice that my <code>GOPATH</code> and <code>GOROOT</code> are set.</p>\n\n<p>Here is the structure of my go workspace (<code>/Users/&lt;me&gt;/Documents/Proj/go</code>):</p>\n\n<pre><code>go/\n|-bin/\n|-pkg/\n|-src/\n  |--github.com/\n    |--user/\n      |--myproject/\n        |--client/\n          |--client.go\n        |--main.go\n</code></pre>\n\n<p>Here is my <code>client.go</code> file:</p>\n\n<pre><code>// client.go\npackage client\n\ntype MyClient struct {}\n</code></pre>\n\n<p>this is my <code>main.go</code> file:</p>\n\n<pre><code>// main.go\npackage main\n\nimport \"client\"\n\nfunc main() {}\n</code></pre>\n\n<p>When I run <code>go build</code> in the project root, I get this error:</p>\n\n<pre><code>main.go:4:2: cannot find package \"client\" in any of:\n    /usr/local/opt/go/libexec/src/transport (from $GOROOT)\n    /Users/&lt;me&gt;/Documents/Proj/go/src/transport (from $GOPATH)\n</code></pre>\n\n<p>The first time this happened, I tried to correct the path above:</p>\n\n<pre><code>// main.go\npackage main\n\nimport \"github.com/user/myproject/client\"\n\nfunc main() {}\n</code></pre>\n\n<p>Then I got this error:</p>\n\n<pre><code>main.go:4:2: cannot find package \"client\" in any of:\n    /usr/local/opt/go/libexec/src/transport (from $GOROOT)\n    /Users/&lt;me&gt;/Documents/Proj/go/src/github.com/user/myproject/transport (from $GOPATH)\n</code></pre>\n\n<p>Which is bizarre, since the package exists at that exact path.</p>\n\n<p>What am I doing wrong??</p>\n"}, {"tags": ["go", "bcrypt"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1529831017, "post_id": 51008351, "comment_id": 89009763, "body": "Whats the type and length of the password column in your database?"}, {"owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1529831862, "post_id": 51008351, "comment_id": 89009919, "body": "It&#39;s <code>varchar(50)</code>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1529831960, "post_id": 51008351, "comment_id": 89009937, "body": "Thats too short."}, {"owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1529832288, "post_id": 51008351, "comment_id": 89009984, "body": "@tkausl Thanks. I changed a length of column and everything works!"}], "answers": [{"tags": [], "owner": {"reputation": 12147, "user_id": 4378400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wsSe.jpg?s=128&g=1", "display_name": "Yury Fedorov", "link": "https://stackoverflow.com/users/4378400/yury-fedorov"}, "is_accepted": true, "score": 4, "last_activity_date": 1529838339, "creation_date": 1529838339, "answer_id": 51009314, "question_id": 51008351, "link": "https://stackoverflow.com/questions/51008351/bcrypt-hashedsecret-too-short-to-be-a-bcrypted-password/51009314#51009314", "title": "Bcrypt hashedSecret too short to be a bcrypted password", "body": "<p><code>bcrypt</code> produces hashes of 59-60 bytes (see <a href=\"https://stackoverflow.com/questions/5881169/what-column-type-length-should-i-use-for-storing-a-bcrypt-hashed-password-in-a-d\">this answer</a> for details). In order to store the hash as <code>varchar</code>, you need to ensure its size is sufficient. According to your <a href=\"https://stackoverflow.com/questions/51008351/bcrypt-hashedsecret-too-short-to-be-a-bcrypted-password#comment89009919_51008351\">comment</a>, you use <code>varchar(50)</code>, which is not enough, and that's the reason that changing its size fixed your problem.</p>\n"}], "owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2905, "favorite_count": 0, "accepted_answer_id": 51009314, "answer_count": 1, "score": 1, "last_activity_date": 1543984382, "creation_date": 1529830466, "last_edit_date": 1529833766, "question_id": 51008351, "link": "https://stackoverflow.com/questions/51008351/bcrypt-hashedsecret-too-short-to-be-a-bcrypted-password", "title": "Bcrypt hashedSecret too short to be a bcrypted password", "body": "<p>I want to create a user authentication system using Go and I am stuck with logging into an account. I use bcrypt to hash passwords than I save it to the database (MySQL). The problem shows when I want to compare it with an inserted password. I have this error: <code>hashedSecret too short to be a bcrypted password</code>. I don't know what I'm doing wrong. Here is my code:</p>\n\n<p><code>models.go</code></p>\n\n<pre><code>type User struct {\n    ID       string `json:\"id\"`\n    Username string `json:\"username\"`\n    Password string `json:\"password\"`\n    IsAdmin  bool   `json:\"is_admin\"`\n}\n</code></pre>\n\n<p><code>user-routes.go (login func)</code></p>\n\n<pre><code>err := db.QueryRow(\"SELECT Password FROM Users WHERE Username = ?\", user.Username).Scan(&amp;storedPass)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // hashed password\n    fmt.Println(storedPass, []byte(storedPass))\n    err = bcrypt.CompareHashAndPassword([]byte(storedPass), []byte(user.Password))\n    if err != nil {\n        // Here is error\n        fmt.Println(err.Error())\n    }\n</code></pre>\n\n<p><code>user-routes.go (register func)</code></p>\n\n<pre><code>stmt, err := db.Prepare(`INSERT INTO Users(Username, Password, IsAdmin) VALUES (?, ?, 0)`)\n    if err != nil {\n        log.Fatal(err)\n    }\nhash, _ := bcrypt.GenerateFromPassword([]byte(user.Password), 10)\nres, err := stmt.Exec(user.Username, string(hash))\n</code></pre>\n\n<p>It looks like the error is when I compare hashed password with an inserted password. Also, I save a password to a database without any errors.</p>\n\n<pre><code>+----+----------+----------------------------------------------------+---------+\n| ID | Username | Password                                           | IsAdmin |\n+----+----------+----------------------------------------------------+---------+\n| 38 | test2    | $2a$10$5WwRQahtjgmaeIKRGXGZNOLVAv5EXUidRwbnZeryq9e |       0 |\n+----+----------+----------------------------------------------------+---------+\n</code></pre>\n"}, {"tags": ["go", "go-interface", "libchan"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 4, "last_activity_date": 1595962207, "last_edit_date": 1595962207, "creation_date": 1529832214, "answer_id": 51008556, "question_id": 51008324, "link": "https://stackoverflow.com/questions/51008324/trying-to-implement-polymorphism-with-go-interfaces/51008556#51008556", "title": "trying to implement polymorphism with go interfaces", "body": "<p>As you already know interfaces in Go are satisfied implicitly.</p>\n<p>But, as the error states,</p>\n<pre><code>WaitReceiveChannel() (libchan.Receiver, error)\n</code></pre>\n<p>and</p>\n<pre><code>WaitReceiveChannel() (ReceiverStream, error)\n</code></pre>\n<p>are two different <em>method types</em>, resulting in <code>libchan.Transport</code> not implicitly implementing <code>InboundTransport</code>.</p>\n<p>To work around this you have to write a thin wrapper around <code>libchan.Transport</code> that implements the <code>InboundTransport</code> properly.</p>\n<pre><code>type TransportWrapper struct {\n    t *libchan.Transport\n}\n\nfunc (w *TransportWrapper) WaitReceiveChannel() (Receiver, error) {\n    return w.t.WaitReceiveChannel()\n}\n\n// ...\n\nfunc (ln SpdyListener) Accept(addr string) InboundTransport {\n    var listener net.Listener\n    var err error\n    listener, err = net.Listen(&quot;tcp&quot;, addr)\n    if err != nil {\n        log.Fatal(err)\n    }\n    c, err := listener.Accept()\n    if err != nil {\n        log.Fatal(err)\n    }\n    p, err := spdy.NewSpdyStreamProvider(c, true)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return &amp;TransportWrapper{spdy.NewTransport(p)}\n}\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1595962207, "creation_date": 1529830221, "question_id": 51008324, "link": "https://stackoverflow.com/questions/51008324/trying-to-implement-polymorphism-with-go-interfaces", "title": "trying to implement polymorphism with go interfaces", "body": "<p>I'm trying to create a layer on top of a third party library, in this case <a href=\"https://github.com/docker/libchan/\" rel=\"nofollow noreferrer\">libchan</a>. Here's an interface I've defined:</p>\n\n<pre><code>type ReceiverStream interface {\n    Receive(msg interface{}) error\n}\n\ntype InboundTransport interface {\n    WaitReceiveChannel() (ReceiverStream, error)\n}\n</code></pre>\n\n<p>The <code>InboundTransport</code> is meant to be a stand-in for a type <code>Transport</code>:</p>\n\n<pre><code>// libchan.go\ntype Transport interface {\n    // NewSendChannel creates and returns a new send channel.  The receive\n    // end will get picked up on the remote end of the transport through\n    // the remote calling WaitReceiveChannel.\n    NewSendChannel() (Sender, error)\n\n    // WaitReceiveChannel waits for a new channel be created by the\n    // remote end of the transport calling NewSendChannel.\n    WaitReceiveChannel() (Receiver, error)\n}\n</code></pre>\n\n<p>Just for context, this is the <code>libchan.Receiver</code> definition (please note that it matches my <code>ReceiverStream</code>:</p>\n\n<pre><code>// libchan.go\ntype Receiver interface {\n    // Receive receives a message sent across the channel from\n    // a sender on the other side of the underlying transport.\n    // Receive is expected to receive the same object that was\n    // sent by the Sender, any differences between the\n    // receive and send type should be handled carefully.  It is\n    // up to the application to determine type compatibility, if\n    // the receive object is incompatible, Receiver will\n    // throw an error.\n    Receive(message interface{}) error\n}\n</code></pre>\n\n<p>The <code>Transport</code> is returned by the libchan library <a href=\"https://github.com/docker/libchan/blob/0328dcec840a0659448faf08af087135fffb7fde/spdy/session.go#L62\" rel=\"nofollow noreferrer\">here</a>: </p>\n\n<pre><code>// libchan/session.go:62\nfunc NewTransport(provider StreamProvider) libchan.Transport {\n...\n}\n</code></pre>\n\n<p>Since <code>libchan.Transport</code> and <code>InboundTransport</code> share a <code>WaitReceiveChannel() (ReceiverStream, error)</code> method, I figured I should be able to sub one for the other, like so:</p>\n\n<pre><code>func (ln SpdyListener) Accept(addr string) InboundTransport {\n    var listener net.Listener\n    var err error\n    listener, err = net.Listen(\"tcp\", addr)\n    if err != nil {\n        log.Fatal(err)\n    }\n    c, err := listener.Accept()\n    if err != nil {\n        log.Fatal(err)\n    }\n    p, err := spdy.NewSpdyStreamProvider(c, true)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return spdy.NewTransport(p)\n}\n</code></pre>\n\n<p>But I get an error:</p>\n\n<pre><code>cannot use spdy.NewTransport(p) (type libchan.Transport) as type InboundTransport in return argument:\n    libchan.Transport does not implement InboundTransport (wrong type for WaitReceiveChannel method)\n        have WaitReceiveChannel() (libchan.Receiver, error)\n        want WaitReceiveChannel() (ReceiverStream, error)\n</code></pre>\n\n<p>I assume that what this error means is that a type of <code>ReceiverStream</code> does not match <code>libchan.Receiver</code>, but I thought that golang interfaces were implicit, meaning that as long as the return type implements the same methods as the expected interface, it would pass compilation. Is there anything I can change so that I can superimpose a self-defined interface onto one returned by a third part library?</p>\n\n<p>TLDR: A third party lib is returning an object of interface <code>Transport</code>. The <code>Transport</code> interface specifies a method <code>WaitReceiveChannel()</code>. I have a self-defined interface <code>InboundTransport</code> that also specifies <code>WaitReceiveChannel()</code>. The third-party method I'm calling returns an object that implements <code>Transport</code> by way of method <code>WaitReceiveChannel()</code>. I assumed that it would also implement <code>InboundTransport</code> since the latter also specifies a <code>WaitReceiveChannel()</code> of the same type. This isn't working. Why not?</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1529821283, "post_id": 51006918, "comment_id": 89007975, "body": "there is no way panic happening, but in my opinion, you dont need that, garbage collector will do it for you"}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 4, "last_activity_date": 1529815864, "last_edit_date": 1529815864, "creation_date": 1529814928, "answer_id": 51006982, "question_id": 51006918, "link": "https://stackoverflow.com/questions/51006918/looping-in-parallel/51006982#51006982", "title": "Looping in parallel", "body": "<p><code>wg.Wait</code> won't return until all the worker goroutines are done. When <code>wg.Wait</code> is called in the closer goroutine, you've already called <code>wg.Add(1)</code> once for each worker goroutine, so <code>wg.Wait</code> won't return until <code>wg.Done</code> has been called the same number of times, and that happens when the goroutine function returns. Therefore, the closer goroutine won't call <code>close</code> until all the worker goroutines have finished what they're doing.</p>\n\n<p>As you said, it is theoretically possible that <code>wg</code>'s counter may reach 0 while still in the loop that creates the workers, but once the loop finishes, the counter will only be 0 once all the goroutines have finished. Since you aren't starting the closer goroutine until the loop completes, there's no danger of <code>wg.Wait</code> returning before all the workers are done.</p>\n"}], "owner": {"reputation": 329, "user_id": 9437085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bZbW0.jpg?s=128&g=1", "display_name": "gyuaisdfaasf", "link": "https://stackoverflow.com/users/9437085/gyuaisdfaasf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1529833866, "creation_date": 1529813826, "last_edit_date": 1529833866, "question_id": 51006918, "link": "https://stackoverflow.com/questions/51006918/looping-in-parallel", "title": "Looping in parallel", "body": "<p>I new to <code>golang</code> and I am reading the example from the book <em>gopl</em>.</p>\n\n<p>There is an example of making thumbnails in parallel:</p>\n\n<pre><code>func makeThumbnails6(filenames &lt;-chan string) int64 {\n    sizes := make(chan int64)\n    var wg sync.WaitGroup // number of working goroutines\n    for f := range filenames {\n        wg.Add(1)\n        // worker\n        go func(f string) {\n            defer wg.Done()\n            thumb, err := thumbnail.ImageFile(f)\n            if err != nil {\n                log.Println(err)\n                return\n            }\n            info, _ := os.Stat(thumb) // OK to ignore error\n            sizes &lt;- info.Size()\n        }(f)\n    }\n\n    // closer\n    go func() {\n        wg.Wait()\n        close(sizes)\n    }()\n\n    var total int64\n    for size := range sizes {\n        total += size\n    }\n    return total\n}\n</code></pre>\n\n<p>My doubt is that will it be possible that the closer passes the <code>wg.Wait()</code> before all files are processed?</p>\n\n<p>E.g if <code>work1</code> finishes its job and decreases <code>wg</code> to zero, then some magical scheduling happens and <code>close</code> get the time to run and close the channel?</p>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1529812453, "post_id": 51006751, "comment_id": 89006864, "body": "Either you make two <code>struct</code>s or you make <code>details</code> a <code>map[string]interface{}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1529822187, "post_id": 51007265, "comment_id": 89008096, "body": "While this is a great answer, it does not seem to foot the desired outcome, as there is no dynamic naming. This will have to be done in a <code>map</code>"}], "tags": [], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "is_accepted": true, "score": 3, "last_activity_date": 1529819225, "creation_date": 1529819225, "answer_id": 51007265, "question_id": 51006751, "link": "https://stackoverflow.com/questions/51006751/unmarshal-with-changing-json-attribute/51007265#51007265", "title": "Unmarshal with changing JSON attribute", "body": "<p>I am not sure you can have a single struct unless you are ok with a string interface map, but You can prevent the <em>details</em> from being decoded by setting them as a <code>json.RawMessage</code> type int he struct. You can then decode the unknown-typed json data by attempting to decode it into one type, if that returns an error then you try with the next type.</p>\n\n<p>Here is some code, that should give you a better idea to what I am talking about.</p>\n\n<p><a href=\"https://play.golang.org/p/06owmiJXNaO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/06owmiJXNaO</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nconst json1 = `{\"name\": \"foo\", \"details\":[1, 2, 3]}`\nconst json2 = `{\"name\": \"foo\", \"details\":{\"a\": [1, 2, 3]}}`\n\ntype data struct {\n    Name    string          `json:\"name\"`\n    Details json.RawMessage `json:\"details\"`\n}\n\ntype detailsone []int\n\ntype detailstwo struct {\n    A []int `json:\"a\"`\n}\n\nfunc main() {\n    var d1, d2 data\n    json.Unmarshal([]byte(json1), &amp;d1)\n    json.Unmarshal([]byte(json2), &amp;d2)\n\n    fmt.Printf(\"%+v\\n\", d1)\n    fmt.Printf(\"%+v\\n\", d2)\n\n    var err error\n    var b1 detailsone\n    var b2 detailstwo\n\n    // json1\n    err = json.Unmarshal([]byte(d1.Details), &amp;b1)\n    if err == nil {\n        fmt.Printf(\"d1 is an []int: %+v\\n\", b1)\n    }\n    err = json.Unmarshal([]byte(d1.Details), &amp;b2)\n    if err == nil {\n        fmt.Printf(\"d1 is an detailstwo struct: %+v\\n\", b2)\n    }\n\n    // json2\n    err = json.Unmarshal([]byte(d2.Details), &amp;b1)\n    if err == nil {\n        fmt.Printf(\"d2 is an []int: %+v\\n\", b1)\n    }\n    err = json.Unmarshal([]byte(d2.Details), &amp;b2)\n    if err == nil {\n        fmt.Printf(\"d2 is an detailstwo struct: %+v\\n\", b2)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1529822016, "post_id": 51007494, "comment_id": 89008075, "body": "The problem with this implementation is that OP would have to define every possible field, and that does not seem to be the desired effect."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1529823406, "post_id": 51007494, "comment_id": 89008296, "body": "how about now ?"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1529823565, "post_id": 51007494, "comment_id": 89008328, "body": "yeah that looks better, but then at that point, you would only need the <code>Base</code> struct, and<code>Data</code> within it because essentially, you&#39;d be pushing into <code>Data</code>, which you could give an inheritance feel to if attached a func to <code>Base</code> accepting a <code>string</code> for key and <code>interface{}</code> for value"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1529823786, "post_id": 51007494, "comment_id": 89008368, "body": "didn&#39;t get what youre saying at all :|"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1529823398, "last_edit_date": 1529823398, "creation_date": 1529821610, "answer_id": 51007494, "question_id": 51006751, "link": "https://stackoverflow.com/questions/51006751/unmarshal-with-changing-json-attribute/51007494#51007494", "title": "Unmarshal with changing JSON attribute", "body": "<pre><code>type Base struct {\n    Data map[string]interface{}\n\n    Details struct {\n        *D1\n        *D2\n    } `json:\"details\"\n}\n\ntype D1 struct {\n    Detail1 string\n    Detail2 string\n}\n\ntype D2 struct {\n    AnotherDetail1 string\n    AnotherDetail2 string\n}\n</code></pre>\n\n<p>you can find filled struct by comparing them with <code>nil</code></p>\n"}], "owner": {"reputation": 828, "user_id": 662017, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0b1bad601ac2781fc1a5dd2160121a44?s=128&d=identicon&r=PG", "display_name": "Alwin Doss", "link": "https://stackoverflow.com/users/662017/alwin-doss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 51007265, "answer_count": 2, "score": 0, "last_activity_date": 1529833912, "creation_date": 1529811438, "last_edit_date": 1529833912, "question_id": 51006751, "link": "https://stackoverflow.com/questions/51006751/unmarshal-with-changing-json-attribute", "title": "Unmarshal with changing JSON attribute", "body": "<p>I have a JSON object whose details can contain different types of JSON objects, the rest of the JSON remains the same, in such a case how can I have a single struct in Golang to handle both types of JSON</p>\n\n<p><strong>JSON 1:</strong></p>\n\n<pre><code>{\n   \"field1\":\"\",\n   \"field2\":\"\",\n   \"field3\":\"\",\n   \"field4\":\"\",\n   \"field5\":\"\",\n   \"field6\":\"\",\n   \"field7\":\"\",\n   \"details\":{\n      \"detail1\":\"\",\n      \"detail2\":[\n         {\n            \"arr1\":\"\",\n            \"arr2\":{\n               \"id\":\"\",\n               \"name\":\"\"\n            },\n            \"list\":[\n               {\n                  \"id\":\"\",\n                  \"version\":1,\n                  \"name\":\"\"\n               }\n            ]\n         }\n      ]\n   },\n   \"user\":{\n      \"id\":\"\",\n      \"name\":\"\"\n   }\n}\n</code></pre>\n\n<p><strong>JSON 2:</strong></p>\n\n<pre><code>{\n   \"field1\":\"\",\n   \"field2\":\"\",\n   \"field3\":\"\",\n   \"field4\":\"\",\n   \"field5\":\"\",\n   \"field6\":\"\",\n   \"field7\":\"\",\n   \"details\":{\n      \"anotherdetail1\":\"\",\n      \"anotherdetail2\":[\n         {\n            \"arr7\":\"\",\n            \"arr8\":{\n               \"id\":\"\",\n               \"name\":\"\"\n            },\n            \"arr10\":{\n\n            }\n         }\n      ]\n   },\n   \"user\":{\n      \"id\":\"\",\n      \"name\":\"\"\n   }\n}\n</code></pre>\n\n<p>My goal is to use a single struct for both these JSON objects. In a language like Java I would create a Parent Class which resembles details in a generic way and have 2 child classes to resemble the type of details that vary and during runtime I would create an object of a child type and assign it to the Parent. I am unsure how this is done in Go.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 3, "creation_date": 1529811903, "post_id": 51006592, "comment_id": 89006806, "body": "I&#39;m not sure I understand where you expected to gain performance.  You&#39;re running the same code - just on a different goroutine with the added overhead of <i>using</i> the concurrency functionality to return your results to a another goroutine.  The fact that you&#39;re running code in parallel doesn&#39;t mean that it is magically faster - you do the exact same thing with added overhead."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1529813165, "post_id": 51006592, "comment_id": 89006956, "body": "Thanks, I had a feeling it was the added overhead.  Guess I imagined it wouldn&#39;t be so stark."}], "answers": [{"comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1529812005, "post_id": 51006780, "comment_id": 89006820, "body": "+1 Designing concurrent interactions is more involved than just starting stuff in a goroutine and expecting performance improvements."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1529812955, "post_id": 51006780, "comment_id": 89006927, "body": "That&#39;s great info on the unbuffered / buffered channels in <code>exampleQueuedChannel</code>.  I had a feeling that there was some accumulated expense to the goroutines in <code>exampleWaitGroup</code> (makes me think of &quot;nickel and dimed&quot; saying). Interesting info on the logger, too.  Thanks for the tips."}], "tags": [], "owner": {"reputation": 4316, "user_id": 486035, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1654e9816b6e407e1daced17ac4fcf3b?s=128&d=identicon&r=PG", "display_name": "phemmer", "link": "https://stackoverflow.com/users/486035/phemmer"}, "is_accepted": false, "score": 5, "last_activity_date": 1529811852, "creation_date": 1529811852, "answer_id": 51006780, "question_id": 51006592, "link": "https://stackoverflow.com/questions/51006592/why-do-sequential-loops-run-faster-than-concurrent-methods-in-go/51006780#51006780", "title": "Why do sequential loops run faster than concurrent methods in Go?", "body": "<p>In <code>exampleQueuedChannel</code> you're not doing anything in parallel. Yes you've launched another goroutine, but there is no parallel processing. The reason being is that <code>queue</code> is an unbuffered chan. When you write to an unbuffered chan, the writer blocks until someone reads off it. So essentially you block while writing, then the scheduler has to put the goroutine to sleep, and go wake up the reading goroutine. Then that one goes to sleep and the writer wakes back up. So you're thrashing between the two goroutines and the scheduler is getting a heavy workout.<br>\nIf you want to get better performance here, use a buffered chan. And if you want even more performance, bulk up multiple items per chan message <sup><em>(For a long technical explanation of the performance impact of channels, read <a href=\"https://www.jtolio.com/2016/03/go-channels-are-bad-and-you-should-feel-bad/\" rel=\"noreferrer\">this</a>)</sup></em>.</p>\n\n<p>In <code>exampleWaitGroup</code>, you're launching a new goroutine for every line. While launching new goroutines isn't expensive, it's not free either, and is also more work for the scheduler. <a href=\"https://medium.com/i0exception/runtime-overhead-of-using-defer-in-go-7140d5c40e32\" rel=\"noreferrer\"><code>defer</code> is also not free</a>. Also your logger <a href=\"https://github.com/golang/go/blob/d6a27e8edcd992b36446c5021a3c7560d983e9a6/src/log/log.go#L153\" rel=\"noreferrer\">uses a mutex</a>, so if two of your goroutines try to log at the same time, one is going to be put to sleep, and again, more scheduler work.</p>\n\n<p>You can investigate these matters on your own by <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"noreferrer\">launching your code under a profiler</a>, and investigating where the bottlenecks lie.</p>\n"}, {"comments": [{"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1529812609, "post_id": 51006790, "comment_id": 89006879, "body": "That&#39;s a fair note on <code>testing</code>... I was just trying to do some quick and dirty times.  I am familiar with that idiom and Rob Pike&#39;s talk. Fair point on limited number of cores (I&#39;m running two, FYI). Thanks"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1529811970, "creation_date": 1529811970, "answer_id": 51006790, "question_id": 51006592, "link": "https://stackoverflow.com/questions/51006592/why-do-sequential-loops-run-faster-than-concurrent-methods-in-go/51006790#51006790", "title": "Why do sequential loops run faster than concurrent methods in Go?", "body": "<p>Before answering the question, I would like to point out that your method of benchmarking is problematic. I would not say a 200-line file is large or sufficent for purpose of benchmarking. And there is an \"official\" way of benchmarking in Go, which you can read in docs of <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">testing</a>.</p>\n\n<p>There is a Go Idiom, probably the most famouse one, saying: <strong>Concurrency is not Parallelism</strong>. What most expects to make program run faster is <strong>parallelism</strong>, not <strong>concurrency</strong>. In fact, on a single-core CPU, where <strong>parallelism</strong> is not possible, <strong>concurrency</strong> usually makes thing slower, because switching between goroutines (threads, coroutine, whatsoever), has costs.</p>\n\n<p>In your code, it is much like the situation of single-core. There is not much parellelism, but much switching between goroutines. Furthermore, <code>fmt.Println</code> includes an IO operation, and that operation requires synchronizing, which cannot bennefit from parellelism. </p>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "is_accepted": false, "score": 1, "last_activity_date": 1529826470, "creation_date": 1529826470, "answer_id": 51007922, "question_id": 51006592, "link": "https://stackoverflow.com/questions/51006592/why-do-sequential-loops-run-faster-than-concurrent-methods-in-go/51007922#51007922", "title": "Why do sequential loops run faster than concurrent methods in Go?", "body": "<p>I don't think there should be a performance gain. In a producer/consumer scenario, introducing concurrency(for consumers) only makes sense if your consumer is slower than the producer. You should expect a performance gain the that case by introducing multiple consumers.</p>\n\n<p>But here the consumer is already significantly faster than the producer(the IO) hence no performance gain. </p>\n"}], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 2, "answer_count": 3, "score": 3, "last_activity_date": 1529826470, "creation_date": 1529808629, "last_edit_date": 1529814849, "question_id": 51006592, "link": "https://stackoverflow.com/questions/51006592/why-do-sequential-loops-run-faster-than-concurrent-methods-in-go", "title": "Why do sequential loops run faster than concurrent methods in Go?", "body": "<p><strong>Scenario:</strong>\nI want to read a large text file fast (e.g. <code>lorem.txt</code> with 4.5 millon lines in example below) . I have tried three different ways in code below.</p>\n\n<ol>\n<li>Non-concurrent sequential processing</li>\n<li>Channels and goroutines</li>\n<li>Waitgroup and goroutines</li>\n</ol>\n\n<p><strong>Pseudo-Benchmarks:</strong> \nHere is a typical output I get when I run this below; output below is quick and dirty time deltas and not full-fledged profiling / bench marking / testing. </p>\n\n<pre><code>sequential:     43.541828091 secs 4714074 lines\nqueued channel: 80.986544385 secs 4714074 lines\nwait group:     260.200473751 secs 4712266 lines\n</code></pre>\n\n<p><strong>Question:</strong>\nWhy are sequential loops faster than two other methods below? Am I missing something?</p>\n\n<p><strong>Update</strong>\nI ran the example code on a much bigger text file (see <em>Scenario</em>).  I also \"reset\" the logger for each example just in case not doing so would have some compounding memory issue between the example functions.  Also as others have noted, my computer is dual core, which may be one of many issues with my code.  Thanks for all feedback / answers.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nvar (\n    textFile = \"lorem.txt\"\n    buf      bytes.Buffer\n    l        = log.New(&amp;buf, \"logger: \", log.Lshortfile)\n    wg       sync.WaitGroup\n    delta1   float64\n    delta2   float64\n    delta3   float64\n    cnt1     = 0\n    cnt2     = 0\n    cnt3     = 0\n)\n\nfunc main() {\n\n    // Wait Group Example\n    exampleWaitGroup()\n\n    // Queued Channel Example\n    exampleQueuedChannel()\n\n    // Sequential Loop Example\n    exampleSequentialLoop()\n\n    benchmarks := fmt.Sprintf(\"sequential:\\t%v secs %v lines\\nqueued channel:\\t%v secs %v lines\\nwait group:\\t%v secs %v lines\\n\",\n        delta1, cnt1,\n        delta2, cnt2,\n        delta3, cnt3,\n    )\n\n    fmt.Println(benchmarks)\n\n}\n\nfunc exampleSequentialLoop() {\n\n    buf.Reset()\n    l = log.New(&amp;buf, \"logger: \", log.Lshortfile)\n\n    start := time.Now()\n\n    file1, err := os.Open(textFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer file1.Close()\n\n    scanner := bufio.NewScanner(file1)\n\n    for scanner.Scan() {\n        cnt1++\n        l.Println(scanner.Text())\n    }\n\n    end := time.Now()\n    delta1 = end.Sub(start).Seconds()\n\n}\n\nfunc exampleQueuedChannel() {\n\n    buf.Reset()\n    l = log.New(&amp;buf, \"logger: \", log.Lshortfile)\n\n    start := time.Now()\n    queue := make(chan string)\n    done := make(chan bool)\n\n    go processQueue(queue, done)\n\n    file2, err := os.Open(textFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer file2.Close()\n\n    scanner := bufio.NewScanner(file2)\n\n    for scanner.Scan() {\n        queue &lt;- scanner.Text()\n    }\n\n    end := time.Now()\n    delta2 = end.Sub(start).Seconds()\n}\n\nfunc exampleWaitGroup() {\n\n    buf.Reset()\n    l = log.New(&amp;buf, \"logger: \", log.Lshortfile)\n\n    start := time.Now()\n\n    file3, err := os.Open(textFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer file3.Close()\n\n    scanner := bufio.NewScanner(file3)\n\n    for scanner.Scan() {\n        wg.Add(1)\n        go func(line string) {\n            defer wg.Done()\n            l.Println(line)\n            cnt3++\n        }(scanner.Text())\n    }\n\n    wg.Wait()\n\n    end := time.Now()\n    delta3 = end.Sub(start).Seconds()\n\n}\n\nfunc processQueue(queue chan string, done chan bool) {\n    for line := range queue {\n        l.Println(line)\n        cnt2++\n    }\n    done &lt;- true\n}\n</code></pre>\n"}, {"tags": ["http", "redirect", "go"], "comments": [{"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "edited": false, "score": 0, "creation_date": 1529795895, "post_id": 51005037, "comment_id": 89004985, "body": "Can you post your Execute method?"}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 5129446, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F9GFT.jpg?s=128&g=1", "display_name": "aerth", "link": "https://stackoverflow.com/users/5129446/aerth"}, "is_accepted": false, "score": 2, "last_activity_date": 1529797854, "creation_date": 1529797854, "answer_id": 51005912, "question_id": 51005037, "link": "https://stackoverflow.com/questions/51005037/go-multiple-response-writeheader-calls/51005912#51005912", "title": "Go multiple response.WriteHeader calls", "body": "<p>You are writing (using <code>w</code>) and then later trying to redirect (also using <code>w</code>) using <code>302</code> header redirection.</p>\n\n<p>You can only send headers once, and if you start writing to w it assumes a <code>200</code> header (OK)</p>\n\n<p>Also, Its best if you check the http.Method before writing to the ResponseWriter (<code>w</code>)</p>\n\n<p>And, Remember to <code>return</code> after a redirection or handing over the ResponseWriter and Request pair to another function!</p>\n\n<p>Hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1529799806, "last_edit_date": 1529799806, "creation_date": 1529799434, "answer_id": 51006026, "question_id": 51005037, "link": "https://stackoverflow.com/questions/51005037/go-multiple-response-writeheader-calls/51006026#51006026", "title": "Go multiple response.WriteHeader calls", "body": "<blockquote>\n  <p>How can I display the login page and still be able to redirect to a different page? </p>\n</blockquote>\n\n<p>Have a different route for authentication.  Make the login form submit to the authentication route.  Have a separate handler for authentication as well.</p>\n\n<p>For example, your login form:</p>\n\n<pre><code>&lt;form method=\"post\" action=\"/auth\"&gt;\n</code></pre>\n\n<p>your Go main:</p>\n\n<pre><code>http.HandleFunc(\"/\", homeHandler)\nhttp.HandleFunc(\"/auth\", authHandler)\n</code></pre>\n\n<p>When authentication processing is complete you can redirect the user to the appropriate page.  You could pass a parameter in the query string that contains the destination path for the redirect.</p>\n"}], "owner": {"reputation": 13, "user_id": 9402926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf8ccc2b3f8562999e90eab4c16a514?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/9402926/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1624, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1529799806, "creation_date": 1529787888, "question_id": 51005037, "link": "https://stackoverflow.com/questions/51005037/go-multiple-response-writeheader-calls", "title": "Go multiple response.WriteHeader calls", "body": "<p>So I'm writing a basic webapp and I'm having trouble redirecting the user after a sucessfull login. The code is:</p>\n\n<pre><code>t, err := template.ParseFiles(\"home.html\")\nif err != nil {\n    log.Fatal(\"template.ParseFiles: \", err)\n}\n\nerr = t.Execute(w, nil)\nif err != nil {\n    log.Fatal(\"t.Execute: \", err)\n}\n\nif r.Method == \"POST\" {\n    r.ParseForm()\n    user := r.FormValue(\"username\")\n    pass := r.FormValue(\"password\")\n\n    if checkLogin(user, pass) {\n        loggedIn = true\n        http.Redirect(w, r, \"/home\", 302)\n    }\n}\n</code></pre>\n\n<p>The error message is: \"http: multiple response.WriteHeader calls\".</p>\n\n<p>My problem is that I don't see a way to serve the html file containing the login-form without calling t.Execute which sets the header.</p>\n\n<p>How can I display the login page and still be able to redirect to a different page? </p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529781150, "post_id": 51004292, "comment_id": 89002077, "body": "Please post the code you have tried to generate this error"}, {"owner": {"reputation": 108, "user_id": 6446849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f27546c2c52adf25ebb3e11cca49104?s=128&d=identicon&r=PG&f=1", "display_name": "ECourant", "link": "https://stackoverflow.com/users/6446849/ecourant"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529781496, "post_id": 51004292, "comment_id": 89002156, "body": "@Himanshu I&#39;ve added code for an example"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1529782356, "post_id": 51004292, "comment_id": 89002344, "body": "Did you import <code>_ &quot;github.com&#47;lib&#47;pq&quot;</code> in addition to <code>database&#47;sql</code>?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 1, "creation_date": 1529782360, "post_id": 51004292, "comment_id": 89002346, "body": "You assume that you can read the whole response with single read (and that it is not bigger than 2048 bytes). This might not be the case. Isn&#39;t there response length in the start of the response packet? Or shouldn&#39;t the <code>rConn.Read()</code> return indicator that whole response is read (ie <code>io.EOF</code> or some other special error)?"}, {"owner": {"reputation": 108, "user_id": 6446849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f27546c2c52adf25ebb3e11cca49104?s=128&d=identicon&r=PG&f=1", "display_name": "ECourant", "link": "https://stackoverflow.com/users/6446849/ecourant"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1529782506, "post_id": 51004292, "comment_id": 89002374, "body": "@jrefior I&#39;m not importing either of those, this is all built from scratch."}, {"owner": {"reputation": 108, "user_id": 6446849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f27546c2c52adf25ebb3e11cca49104?s=128&d=identicon&r=PG&f=1", "display_name": "ECourant", "link": "https://stackoverflow.com/users/6446849/ecourant"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529782655, "post_id": 51004292, "comment_id": 89002413, "body": "@ain The length bytes at the beginning of each of the responses are the same though aren&#39;t they? But with one of them I&#39;m not getting the entire response from the stream, and if I retrieved a smaller stream like 128 bytes it still might be missing a chunk at the end"}, {"owner": {"reputation": 108, "user_id": 6446849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f27546c2c52adf25ebb3e11cca49104?s=128&d=identicon&r=PG&f=1", "display_name": "ECourant", "link": "https://stackoverflow.com/users/6446849/ecourant"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529782758, "post_id": 51004292, "comment_id": 89002446, "body": "@ain or am I mis interpretting the meaning of the ...I at the end of the response? And should I not look for it at all, is that what you mean?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1529782790, "post_id": 51004292, "comment_id": 89002452, "body": "You only make a single read! It might take several reads to get the whole stream. So after first read you should determine the packet length and then read until you have whole stream read into buffer."}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529783878, "post_id": 51004292, "comment_id": 89002665, "body": "@ECourant Sorry, changed the read loop, try this: for {     data := make([]byte, 256)     n, err := rConn.Read(data)     if err != nil {         if err == io.EOF {            rBuf.Write(data[:n])            break         }         panic(err)     }     rBuf.Write(data[:n])  }"}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 2, "last_activity_date": 1529856195, "last_edit_date": 1529856195, "creation_date": 1529853623, "answer_id": 51011266, "question_id": 51004292, "link": "https://stackoverflow.com/questions/51004292/postgresql-not-returning-a-complete-response-when-there-is-an-error/51011266#51011266", "title": "PostgreSQL not returning a complete response when there is an error", "body": "<p>Is it hitting the <code>panic</code> and printing an error message?  Is it breaking out of the loop before it's done reading?</p>\n\n<p>In the \"changed code\" section, you are panicking even on <code>io.EOF</code> and you aren't doing anything with the read bytes in that case.  Try removing the <code>panic</code>, and using the read bytes before error handling (as you were in the \"before\" snippet), and loop until you get a read error.  I would at least want to find out/test:</p>\n\n<pre><code>buf := new(bytes.Buffer)\nfor {\n    data := make([]byte, 2048)\n    n, err := rConn.Read(data)\n    if n &gt; 0 {\n        buf.Write(data[:n])\n    }\n    if err != nil {\n        log.Printf(\"Error reading from connection: %s\\n\", err)\n        break\n    }\n}\nlog.Printf(\"Received: %s\\n\", buf.String())\n</code></pre>\n"}], "owner": {"reputation": 108, "user_id": 6446849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f27546c2c52adf25ebb3e11cca49104?s=128&d=identicon&r=PG&f=1", "display_name": "ECourant", "link": "https://stackoverflow.com/users/6446849/ecourant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529856195, "creation_date": 1529780999, "last_edit_date": 1529783080, "question_id": 51004292, "link": "https://stackoverflow.com/questions/51004292/postgresql-not-returning-a-complete-response-when-there-is-an-error", "title": "PostgreSQL not returning a complete response when there is an error", "body": "<p>I'm getting an issue that happens when I run a query that results in an error.</p>\n\n<p>For example, if I run the following query</p>\n\n<pre><code>SELECT * FROM users WHERE account_id=1;\n</code></pre>\n\n<p>The table users does not have an account_id column.</p>\n\n<p>The correct error message returns:</p>\n\n<pre><code> 00000000  45 00 00 00 6e 53 45 52  52 4f 52 00 56 45 52 52  |E...nSERROR.VERR|\n 00000010  4f 52 00 43 34 32 37 30  33 00 4d 63 6f 6c 75 6d  |OR.C42703.Mcolum|\n 00000020  6e 20 22 61 63 63 6f 75  6e 74 5f 69 64 22 20 64  |n \"account_id\" d|\n 00000030  6f 65 73 20 6e 6f 74 20  65 78 69 73 74 00 50 32  |oes not exist.P2|\n 00000040  37 00 46 70 61 72 73 65  5f 72 65 6c 61 74 69 6f  |7.Fparse_relatio|\n 00000050  6e 2e 63 00 4c 33 32 39  33 00 52 65 72 72 6f 72  |n.c.L3293.Rerror|\n 00000060  4d 69 73 73 69 6e 67 43  6f 6c 75 6d 6e 00 00 5a  |MissingColumn..Z|\n 00000070  00 00 00 05 49                                    |....I|\n</code></pre>\n\n<p>Note the ending of the response.</p>\n\n<p>But every now and then I will get the following response from PostgreSQL.</p>\n\n<pre><code> 00000000  45 00 00 00 6e 53 45 52  52 4f 52 00 56 45 52 52  |E...nSERROR.VERR|\n 00000010  4f 52 00 43 34 32 37 30  33 00 4d 63 6f 6c 75 6d  |OR.C42703.Mcolum|\n 00000020  6e 20 22 61 63 63 6f 75  6e 74 5f 69 64 22 20 64  |n \"account_id\" d|\n 00000030  6f 65 73 20 6e 6f 74 20  65 78 69 73 74 00 50 32  |oes not exist.P2|\n 00000040  37 00 46 70 61 72 73 65  5f 72 65 6c 61 74 69 6f  |7.Fparse_relatio|\n 00000050  6e 2e 63 00 4c 33 32 39  33 00 52 65 72 72 6f 72  |n.c.L3293.Rerror|\n 00000060  4d 69 73 73 69 6e 67 43  6f 6c 75 6d 6e 00 00     |MissingColumn..|\n</code></pre>\n\n<p>And the client then fails to parse the response because it's missing the ending.</p>\n\n<p>Is this something I'm doing wrong, or is this possibly a bug in PostgreSQL?</p>\n\n<p>I'm receiving the response from PostgreSQL in Golang's net.Conn via Read()</p>\n\n<p>Thoughts?</p>\n\n<p>The script to create the table:</p>\n\n<pre><code> DROP TABLE IF EXISTS ready.public.users;\n\n CREATE TABLE ready.public.users\n (\n   user_id             UUID             NOT NULL,\n   email               VARCHAR(325)     NOT NULL,\n   password            VARCHAR(2000)    NULL,\n   first_name          VARCHAR(200)     NULL,\n   last_name           VARCHAR(200)     NULL,\n   global_permissions  BIGINT DEFAULT 1 NOT NULL,\n   is_system           BOOLEAN          NOT NULL DEFAULT false,\n   is_device_only      BOOLEAN          NOT NULL DEFAULT false,\n   date_created        TIMESTAMP        NOT NULL,\n   date_updated        TIMESTAMP        NULL,\n   date_last_logged_in TIMESTAMP        NULL,\n   date_last_seen      TIMESTAMP        NULL\n );\n</code></pre>\n\n<p>The code I have in my golang library.</p>\n\n<pre><code> rConn.Write(buf.Bytes())\n\n data := make([]byte, 2048)\n n, err := rConn.Read(data)\n data = data[:n]\n if err != nil {\n    if err != io.EOF {\n        panic(err)\n    } else {\n        log.Printf(\"received err: %v\", err)\n    }\n }\n</code></pre>\n\n<p>The value of buf.Bytes() is:</p>\n\n<pre><code> 00000000  50 00 00 00 2e 00 53 45  4c 45 43 54 20 2a 20 46  |P.....SELECT * F|\n 00000010  52 4f 4d 20 75 73 65 72  73 20 57 48 45 52 45 20  |ROM users WHERE |\n 00000020  61 63 63 6f 75 6e 74 5f  69 64 3d 31 00 00 00 42  |account_id=1...B|\n 00000030  00 00 00 0c 00 00 00 00  00 00 00 00 44 00 00 00  |............D...|\n 00000040  06 50 00 45 00 00 00 09  00 00 00 01 f6 53 00 00  |.P.E.........S..|\n 00000050  00 04                                             |..|\n</code></pre>\n\n<p>Changing my code to read the response from postgresql to this still results in the same response from the server.</p>\n\n<pre><code> rBuf := &amp;bytes.Buffer{}\n for {\n    data := make([]byte, 256)\n    n, err := rConn.Read(data)\n    if err != nil {\n        panic(err)\n    }\n    rBuf.Write(data[:n])\n    if n &lt; 256 {\n        break\n    }\n }\n go log.Printf(\"received:\\n%v\", hex.Dump(rBuf.Bytes()))\n</code></pre>\n"}, {"tags": ["go", "p2p", "file-transfer", "nat", "upnp"], "comments": [{"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529785319, "post_id": 51004291, "comment_id": 89002973, "body": "This is not a Go question, but a network question. Go cannot override limitations set by the network-environments in which computers are."}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529785607, "post_id": 51004291, "comment_id": 89003021, "body": "@BertVerhees I agree with you. But I used go tag just for explanations, if someone wants give me some github libraries."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529785943, "post_id": 51004291, "comment_id": 89003087, "body": "There is no go-library that can resolve limitations which are created by the network-setup. When there is no route to an IP address, no go-library can make you reach that computer. It is a TCPIP/routing problem, you have to solve with the network administrator."}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529787516, "post_id": 51004291, "comment_id": 89003453, "body": "@BertVerhees I mean, maybe there is some way to solve my problem. Like dynamic dns or some kind of service mesh."}, {"owner": {"reputation": 703, "user_id": 3670165, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1jKMw.jpg?s=128&g=1", "display_name": "jbuchel", "link": "https://stackoverflow.com/users/3670165/jbuchel"}, "edited": false, "score": 0, "creation_date": 1529791387, "post_id": 51004291, "comment_id": 89004328, "body": "You need another server, which you know the IP/port of, so that you can exchange the ports and IP&#39;s in the NAT boxes so that you can set up a P2P connection."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529793634, "post_id": 51004291, "comment_id": 89004701, "body": "The skype model is that a server becomes a supernode in skype context. The computers which want the P2P still do not get to know each others IP addresses which they have inside their NAT area. Those addresses are not addressable outside the NAT, so knowing them would be useless. The skype trick is that the P2P needing computers behind the NAT initiate a contact, which is, of course mostly permitted because the NAT router supports that direction of connection."}, {"owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1529849853, "post_id": 51004291, "comment_id": 89014140, "body": "Why is this tagged as bittorrent?"}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1529849936, "post_id": 51004291, "comment_id": 89014163, "body": "@the8472 I removed this tag."}], "answers": [{"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": 0, "last_activity_date": 1529794204, "last_edit_date": 1529794204, "creation_date": 1529789894, "answer_id": 51005241, "question_id": 51004291, "link": "https://stackoverflow.com/questions/51004291/how-to-communicate-between-two-nodes-behind-nat/51005241#51005241", "title": "How to communicate between two Nodes behind NAT?", "body": "<p>Max, I make it an answer to your question.</p>\n\n<p>Which computers you can reach configured on a network or cannot reach, cannot be overridden by software on a computer. That would be a security-breach, and it could be a cause for address conflicts, because in different NAT-area\u015b the same IP addresses can be in use.</p>\n\n<p>So, You cannot see computers behind a router, if that router uses NAT.\nThe router does not advertise these addresses. </p>\n\n<p>The purpose of NAT is to have a special island of IP-addresses which no-one outside the NAT section can see. In this way, a company can use fewer unique IP-addresses to have a good functioning network. Another purpose is security. The router also hides the MAC-addresses of the computers inside the NAT area. A router can hide many things. </p>\n\n<p>Computers inside a NAT-area can initiate contact to computers outside the NAT ((if permitted) the router will remember the computer and keep a address-translation for it), but there is no way a computer outside the NAT can address a computer inside the NAT. It can only reply to a computer from inside. It does that by replying to the router, and the router will know to which computer in the NAT area to forward the reply.</p>\n\n<p>Go does not provide libraries which can solve these external limitations. Live with it. There is nothing you can do.</p>\n\n<p>As JBuchel explains the skype model can work if there are some extra provisions, like open UDP ports, and extra server/computer, etc. This is in fact a rearrangement of the network configuration, which cannot be done without the help of system/network administrators.</p>\n\n<p>But if there is support on that level, the solution is so much easier, just remove the computer from the NAT and give it an IP address that is visible for the other computer.</p>\n"}, {"comments": [{"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529791667, "post_id": 51005375, "comment_id": 89004375, "body": "Also for Skype, the computer inside initiates the TCP/IP contact. The trick can work if a router fo"}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529792044, "post_id": 51005375, "comment_id": 89004450, "body": "The trick is that the computer inside the NAT is triggered to initiate a session to outside the NAT. It is explained here.<a href=\"https://www.theregister.co.uk/2003/10/08/how_does_skype_get_through/\" rel=\"nofollow noreferrer\">theregister.co.uk/2003/10/08/how_does_skype_get_through</a>  But necessary remain special settings on routers and firewalls to allow UDP"}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529792478, "post_id": 51005375, "comment_id": 89004538, "body": "Jbuchel, Max also wants to know with which go library this can be solved. My opinion is that this is not possible, but maybe you have other information."}, {"owner": {"reputation": 703, "user_id": 3670165, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1jKMw.jpg?s=128&g=1", "display_name": "jbuchel", "link": "https://stackoverflow.com/users/3670165/jbuchel"}, "reply_to_user": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529796326, "post_id": 51005375, "comment_id": 89005034, "body": "I don\u2019t know of any library that does that, but it doesn\u2019t sound too hard to implement yourself. But maybe some time..."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1529796656, "post_id": 51005375, "comment_id": 89005084, "body": "It was a tricky question. I am sorry for that. You don&#39;t need a library, the way skype handles it can be done within standard network functionality. The problem is in the external provisions needed."}], "tags": [], "owner": {"reputation": 703, "user_id": 3670165, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1jKMw.jpg?s=128&g=1", "display_name": "jbuchel", "link": "https://stackoverflow.com/users/3670165/jbuchel"}, "is_accepted": false, "score": 4, "last_activity_date": 1529791049, "creation_date": 1529791049, "answer_id": 51005375, "question_id": 51004291, "link": "https://stackoverflow.com/questions/51004291/how-to-communicate-between-two-nodes-behind-nat/51005375#51005375", "title": "How to communicate between two Nodes behind NAT?", "body": "<p>The idea is that you have a rendez-vous server, which the nodes 1 and 2 connect to. For that they must know the IP of the rendez-vous server.</p>\n\n<p>It goes as follows:\n1) 1 and 2 both send UDP packets to the RS. N1 (NAT box of Node 1) and N2 create an entry in the translation table, which maps the IP of the nodes to the IP/Port of the RS.\n2) The RS passes (EIP1,EP1) to Node 2. This is the Tulpe containing the public IP of the NAT box and the public port. The RS sends (EIP2,EP2) to Node 1.\n3) Node 1 creates a mapping in the translation table: (IP1,EP1,EIP2,EP2).\n4) Node 2 does the same but with (IP2,EP2,EIP1,EP1).</p>\n\n<p>Note: Step 3 and 4 happen, because each Node sends a UDP packet to the just received tuple (IP,Port) and therefore the NAT box adds a new entry.\nIn the worst case, these messages have to be sent more than once.</p>\n\n<p>This trick enables that both nodes get ahold of the public IP\u2019s and have the correct ports.</p>\n\n<p>This provides a good way of establishing peer to peer connections for e.g. Skype.</p>\n\n<p>I hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 2429982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72659be776c53f71d41335adf2adf6f5?s=128&d=identicon&r=PG", "display_name": "Upperwal", "link": "https://stackoverflow.com/users/2429982/upperwal"}, "is_accepted": false, "score": 1, "last_activity_date": 1537975850, "creation_date": 1537975850, "answer_id": 52521385, "question_id": 51004291, "link": "https://stackoverflow.com/questions/51004291/how-to-communicate-between-two-nodes-behind-nat/52521385#52521385", "title": "How to communicate between two Nodes behind NAT?", "body": "<p>Libp2p has no such limitations. </p>\n\n<p>The chat example which you quoted is programmed in such a way that it cannot support private IP's behind NAT <strong>BUT</strong> Libp2p support NAT Traversal techniques like Hole Punching, STUN, TURN like protocol and bootstrapping using rendezvous point using DHT for now. This is what you need.</p>\n\n<p>Following examples may be useful to you:</p>\n\n<ol>\n<li>chat-with-rendezvous: <a href=\"https://github.com/libp2p/go-libp2p-examples/tree/master/chat-with-rendezvous\" rel=\"nofollow noreferrer\">https://github.com/libp2p/go-libp2p-examples/tree/master/chat-with-rendezvous</a></li>\n<li>chat-with-tor: <a href=\"https://github.com/libp2p/go-libp2p-examples/pull/1\" rel=\"nofollow noreferrer\">https://github.com/libp2p/go-libp2p-examples/pull/1</a></li>\n</ol>\n"}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3305, "favorite_count": 2, "answer_count": 3, "score": 3, "last_activity_date": 1537975850, "creation_date": 1529780977, "last_edit_date": 1529849923, "question_id": 51004291, "link": "https://stackoverflow.com/questions/51004291/how-to-communicate-between-two-nodes-behind-nat", "title": "How to communicate between two Nodes behind NAT?", "body": "<p>I have some nodes. Each node belongs to other network. Each node has private IP like <strong>192.168.0.2</strong> and stays behind NAT. </p>\n\n<p>Is there any possibility to communicate between Nodes? Actually, I need to transfer files between these independent nodes.</p>\n\n<p>I try to use this project - <a href=\"https://github.com/libp2p/go-libp2p\" rel=\"nofollow noreferrer\"><a href=\"https://github.com/libp2p/go-libp2p\" rel=\"nofollow noreferrer\">https://github.com/libp2p/go-libp2p</a></a>. But <strong>libp2p</strong> has some limitations:</p>\n\n<ol>\n<li>Both nodes have private IP address (same network)</li>\n<li>At least one of them has a public IP address.</li>\n</ol>\n\n<p>But I have nodes with private IP address, and they belongs to different network.</p>\n\n<hr>\n\n<p><strong>Update.</strong></p>\n\n<p>There are such solutions:</p>\n\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Hole_punching_(networking)\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Hole_punching_(networking)</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Universal_Plug_and_Play\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Universal_Plug_and_Play</a></li>\n<li><a href=\"https://stackoverflow.com/a/8524609/1756750\">https://stackoverflow.com/a/8524609/1756750</a></li>\n<li><a href=\"https://stackoverflow.com/questions/20939222/udp-tcp-hole-punching-vs-upnp-vs-stun-vs\">UDP/TCP hole punching vs UPnP vs STUN vs?</a></li>\n<li><a href=\"https://stackoverflow.com/a/31623109/1756750\">https://stackoverflow.com/a/31623109/1756750</a></li>\n<li><a href=\"https://stackoverflow.com/questions/5077720/behind-nat-to-behind-nat-connection\">Behind NAT to behind NAT connection</a></li>\n<li><a href=\"http://www.brynosaurus.com/pub/net/p2pnat/\" rel=\"nofollow noreferrer\">http://www.brynosaurus.com/pub/net/p2pnat/</a></li>\n</ul>\n"}, {"tags": ["go", "encryption", "public-key-encryption", "gnupg"], "comments": [{"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1529777635, "post_id": 51003636, "comment_id": 89001296, "body": "You are ignoring errors.  Change the code to check for errors."}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1529777768, "post_id": 51003636, "comment_id": 89001326, "body": "As far as I can tell, you encrypt the bytes before you even read the file.  You have to encrypt the bytes after you read them in."}], "answers": [{"tags": [], "owner": {"reputation": 5438, "user_id": 256465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tga4A.jpg?s=128&g=1", "display_name": "sultan", "link": "https://stackoverflow.com/users/256465/sultan"}, "is_accepted": true, "score": 1, "last_activity_date": 1529842853, "last_edit_date": 1529842853, "creation_date": 1529778272, "answer_id": 51003951, "question_id": 51003636, "link": "https://stackoverflow.com/questions/51003636/unable-to-decrypt-binary-file/51003951#51003951", "title": "Unable to decrypt binary file", "body": "<p>Sorry guys to take your time it appears that <code>Encode</code> function accepts <code>FileHints</code> struct so passing with binary from solves the problem</p>\n\n<pre><code>w, _ := openpgp.Encrypt(buf, entitylist, nil, &amp;openpgp.FileHints{IsBinary: true}, nil)\n</code></pre>\n\n<p>More details on <a href=\"https://godoc.org/golang.org/x/crypto/openpgp#FileHints\" rel=\"nofollow noreferrer\">FileHints</a></p>\n\n<pre><code>// FileHints contains metadata about encrypted files. This metadata is, itself,\n// encrypted.\ntype FileHints struct {\n    // IsBinary can be set to hint that the contents are binary data.\n    IsBinary bool\n    // FileName hints at the name of the file that should be written. It's\n    // truncated to 255 bytes if longer. It may be empty to suggest that the\n    // file should not be written to disk. It may be equal to \"_CONSOLE\" to\n    // suggest the data should not be written to disk.\n    FileName string\n    // ModTime contains the modification time of the file, or the zero time if not applicable.\n    ModTime time.Time\n}\n</code></pre>\n\n<p>Thanks.</p>\n"}], "owner": {"reputation": 5438, "user_id": 256465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tga4A.jpg?s=128&g=1", "display_name": "sultan", "link": "https://stackoverflow.com/users/256465/sultan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 51003951, "answer_count": 1, "score": 0, "last_activity_date": 1529844590, "creation_date": 1529775797, "last_edit_date": 1529844590, "question_id": 51003636, "link": "https://stackoverflow.com/questions/51003636/unable-to-decrypt-binary-file", "title": "Unable to decrypt binary file", "body": "<p>I've been trying to encrypt <code>docx</code> file using GPG public key and go's <code>openpgp</code> library. It encrypts document but then I am unable to decrypt it using my private key.</p>\n\n<p>Already tried to do the same with plain text file and decryption worked without any problems.</p>\n\n<p>What am I missing here?</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"golang.org/x/crypto/openpgp\"\n    \"bytes\"\n    \"io/ioutil\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    entitylist, _ := openpgp.ReadArmoredKeyRing(bytes.NewBufferString(...))\n\n    buf := new(bytes.Buffer)\n    w, _ := openpgp.Encrypt(buf, entitylist, nil, nil, nil)\n    b, _ := ioutil.ReadFile(\"in.docx\")\n\n    w.Write(b)\n    w.Close()\n\n    bts, _ := ioutil.ReadAll(buf)\n    ioutil.WriteFile(\"out.gpg\", bts, os.ModePerm)\n}\n</code></pre>\n"}, {"tags": ["debugging", "go", "visual-studio-code"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529775386, "post_id": 51002196, "comment_id": 89000683, "body": "This may be because your workspace root path is different from the directory you have opened."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529779143, "post_id": 51002196, "comment_id": 89001643, "body": "Have you tried to change the settings according to my answer and then run your code from <code>main.go</code>"}, {"owner": {"reputation": 23, "user_id": 9982405, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZfXDU_ImrRw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3V_T2B9lW5Pkw1Y7JwSPSDpjIa2w/mo/photo.jpg?sz=128", "display_name": "threespy", "link": "https://stackoverflow.com/users/9982405/threespy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529779411, "post_id": 51002196, "comment_id": 89001707, "body": "Yes but it doesn&#39;t work. I wrote a post below"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529780422, "post_id": 51002196, "comment_id": 89001914, "body": "when you run debugger does it show any error in <code>PROBLEMS</code> or <code>DEBUG CONSOLE</code>"}, {"owner": {"reputation": 23, "user_id": 9982405, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZfXDU_ImrRw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3V_T2B9lW5Pkw1Y7JwSPSDpjIa2w/mo/photo.jpg?sz=128", "display_name": "threespy", "link": "https://stackoverflow.com/users/9982405/threespy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529780591, "post_id": 51002196, "comment_id": 89001953, "body": "time=&quot;2018-06-23T21:01:55+02:00&quot; level=info msg=&quot;launching process with args: [c:\\\\Users\\\\Lenovo\\\\go\\\\src\\\\hello\\\\debug]&quot; layer=debugger"}, {"owner": {"reputation": 23, "user_id": 9982405, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZfXDU_ImrRw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3V_T2B9lW5Pkw1Y7JwSPSDpjIa2w/mo/photo.jpg?sz=128", "display_name": "threespy", "link": "https://stackoverflow.com/users/9982405/threespy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529780690, "post_id": 51002196, "comment_id": 89001980, "body": "this is in debug windows. Problems window is clear"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529780892, "post_id": 51002196, "comment_id": 89002031, "body": "Go to <code>debug</code> icon add configuration select <code>Launch Package</code> and remove old configurations see if it works"}, {"owner": {"reputation": 23, "user_id": 9982405, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZfXDU_ImrRw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3V_T2B9lW5Pkw1Y7JwSPSDpjIa2w/mo/photo.jpg?sz=128", "display_name": "threespy", "link": "https://stackoverflow.com/users/9982405/threespy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1529783311, "post_id": 51002196, "comment_id": 89002560, "body": "Unfortunately, it also does not work. I&#39;ve tried everything with the launch.json file already"}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1529826870, "post_id": 51002196, "comment_id": 96446111, "body": "The issue is with the new Go version. References <a href=\"https://github.com/derekparker/delve/issues/1245\" rel=\"nofollow noreferrer\">github.com/derekparker/delve/issues/1245</a> <a href=\"https://github.com/Microsoft/vscode-go/issues/1752\" rel=\"nofollow noreferrer\">github.com/Microsoft/vscode-go/issues/1752</a>"}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1567352481, "post_id": 51002196, "comment_id": 101932222, "body": "This <code>launch.json</code> and setup worked for me: <a href=\"https://stackoverflow.com/a/57746989/2175188\">stackoverflow.com/a/57746989/2175188</a>."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1529918525, "last_edit_date": 1529918525, "creation_date": 1529775438, "answer_id": 51003575, "question_id": 51002196, "link": "https://stackoverflow.com/questions/51002196/vs-code-debug-golang-delve-debuger/51003575#51003575", "title": "VS Code debug golang. Delve debuger", "body": "<blockquote>\n  <p>Based on how you install delve it will either end up in your PATH or\n  GOPATH/bin. If dlv binary is in your GOPATH/bin and this GOPATH is not\n  set as an environment variable, then make sure your PATH points to\n  this GOPATH/bin so that the Go extension can find the dlv binary.</p>\n</blockquote>\n\n<p>Try to change the directory to filename to run the project from <code>main.go</code> of your project folder as</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${fileDirname}\",\n            \"env\": {},\n            \"args\": [],\n            \"showLog\": true\n        }\n    ]\n}\n</code></pre>\n\n<p>Make sure $GOPATH is set (e.g. as ~/.go)\nOn terminal run the command</p>\n\n<pre><code>go env\n</code></pre>\n\n<p>to check for <code>GOROOT</code> and <code>GOPATH</code> variables to see if delve is synchronized with them</p>\n\n<p>For more information Checkout <a href=\"https://github.com/derekparker/delve/blob/master/Documentation/installation/linux/install.md\" rel=\"nofollow noreferrer\">How to configure Delve</a></p>\n"}], "owner": {"reputation": 23, "user_id": 9982405, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZfXDU_ImrRw/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3V_T2B9lW5Pkw1Y7JwSPSDpjIa2w/mo/photo.jpg?sz=128", "display_name": "threespy", "link": "https://stackoverflow.com/users/9982405/threespy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1743, "favorite_count": 0, "accepted_answer_id": 51003575, "answer_count": 1, "score": 2, "last_activity_date": 1529918525, "creation_date": 1529764682, "question_id": 51002196, "link": "https://stackoverflow.com/questions/51002196/vs-code-debug-golang-delve-debuger", "title": "VS Code debug golang. Delve debuger", "body": "<p>I have a problem with the Delve debuger in visual studio code. Debugging begins but nothing happens. There is only information in the console: </p>\n\n<pre><code>time=\"2018-06-23T16:35:55+02:00\" level=info msg=\"launching process with args: [C:\\\\Users\\\\LenovoPC\\\\go\\\\src\\\\test\\\\debug]\" layer=debugger\n</code></pre>\n\n<p>Configuration of launch.json</p>\n\n<pre><code>\"version\": \"0.2.0\",\n\"configurations\": [\n    {\n        \"name\": \"Launch\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"remotePath\": \"\",\n        \"port\": 2345,\n        \"host\": \"127.0.0.1\",\n        \"program\": \"${workspaceRoot}\",\n        \"env\": {},\n        \"args\": [],\n        \"showLog\": true\n    }\n]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "edited": false, "score": 0, "creation_date": 1529764958, "post_id": 51002219, "comment_id": 88998167, "body": "That was an observation that I deliberately did. Q is , since channel blocks and later I initialize it, should it not just unblock and work? I am not able to understand the problem it can cause."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "reply_to_user": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "edited": false, "score": 1, "creation_date": 1529765086, "post_id": 51002219, "comment_id": 88998197, "body": "@curiousengineer: No. It&#39;s not going to monitor the <code>c</code> variable and switch channels when <code>c</code> gets assigned. It&#39;s trying to send on a nil channel, and it&#39;s going to stay on that channel. The channel and the variable are separate."}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "edited": false, "score": 0, "creation_date": 1529765357, "post_id": 51002219, "comment_id": 88998288, "body": "thanks, that is helpful, hence, when I add a 2-3 second sleep right before the <code>incorrect location of make...</code>, I do see the fatal exception. I guess right now program is apparently working because the channel is mostly getting initialized, and adding a sleep makes the situation deliberate? I changed the snippet so that you can see what I mean. Is my understanding correct now?"}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "edited": false, "score": 0, "creation_date": 1529765532, "post_id": 51002219, "comment_id": 88998342, "body": "However, now if I move the <code>make</code> to correct location, and write to channel once and read once, things are perfect, but if I write 3 times and read only once, why is the deadlock not coming now?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1529765735, "post_id": 51002219, "comment_id": 88998405, "body": "If you write 3 times and read only once you have a goroutine leak but not a deadlock as the main routine will exit after reading the first value."}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529766683, "post_id": 51002219, "comment_id": 88998617, "body": "@ain, thanks. After I have written once, I do one read, the 2nd write will go into the channel and no one will read it. That is what I understand. The third write is where the go routine is blocked is what I understand. I understand mem leaks and all quite well from C days, here can you explain if the channel is blocked, why is it not a dead lock and the leak is the resources being leaked with this blocked go routine?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529770604, "post_id": 51002219, "comment_id": 88999520, "body": "No, because the channel is unbuffered, the goroutine which writes into the channel will block on the secod write. So the goroutine will be sitting there, waiting someone to read from the channel, so it can write (the second value) into it. But in the meantime the main routine exits and thus program finishes. At that time the goroutine is still running, althought it is in blocked state. This means the goroutine is leaked, but there is no deadlock."}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529778555, "post_id": 51002219, "comment_id": 89001505, "body": "@ain, after the main routine exits are you saying system level resource is leaked forever? Usually when a program is killed mem is returned to system mostly. Here the routine is leaking resource even if main program exited? Is there some good literature explaining these in detail?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 1, "creation_date": 1529781089, "post_id": 51002219, "comment_id": 89002063, "body": "When main exits then OS will release all resources of the proccess, so no &quot;resource is leaked forever&quot;. It is just that well written program should terminate it&#39;s goroutines itself, not leave them running."}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1529782354, "post_id": 51002219, "comment_id": 89002343, "body": "@ain, u have been helpful thanks. I understand well things like if two threads each take a lock and then want to wait on a lock that the other has it is deadlock. Or a wrong thread wakes up cannot take a lock and sleeps all might lock. What would be a dead lock scenario for channels and generally programming language might not know of it but goland does throw that panic at times. Can you tell me what deadlock means in channel world"}], "tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": false, "score": 6, "last_activity_date": 1529764897, "creation_date": 1529764897, "answer_id": 51002219, "question_id": 51002195, "link": "https://stackoverflow.com/questions/51002195/go-channel-not-deadlocked-or-locked/51002219#51002219", "title": "Go channel not deadlocked or locked", "body": "<p>Create the channel <em>before</em> you try to write to it. If the <code>func</code> goroutine tries to send elements through <code>c</code> before there's actually a channel there, it ends up using a nil channel, which blocks forever.</p>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "is_accepted": false, "score": -2, "last_activity_date": 1529827172, "creation_date": 1529827172, "answer_id": 51008010, "question_id": 51002195, "link": "https://stackoverflow.com/questions/51002195/go-channel-not-deadlocked-or-locked/51008010#51008010", "title": "Go channel not deadlocked or locked", "body": "<p>This is an interesting experiment. I don't know if its possible but this type of error should be caught by the compiler, there should be a feature that checks at the compile-time if anything is writing in a <code>nil</code> channel.</p>\n"}], "owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1529827172, "creation_date": 1529764681, "last_edit_date": 1529765350, "question_id": 51002195, "link": "https://stackoverflow.com/questions/51002195/go-channel-not-deadlocked-or-locked", "title": "Go channel not deadlocked or locked", "body": "<p>I have a small snippet of code like this</p>\n\n<pre><code>func main() {\n    var c chan string\n    go func() {\n        c &lt;- \"let's get started\"//write1\n        //c &lt;- \"let's get started\"//write2\n        //c &lt;- \"let's get started\"//write3\n        fmt.Println(\"wrote the stuff....\")\n    }()\n    //time.Sleep(3 * time.Second) //adding this always shows fatal exception\n    c = make(chan string)\n    fmt.Println(&lt;-c)\n}\n</code></pre>\n\n<p>I do not see the output <code>wrote the stuff....</code> on console if I uncomment <code>//write2</code> and <code>write3</code> code snippet lines. I understand that probably I don't see it is because the channel is unbuffered and totally synchronous, and there is only one read happening outside the channel. However, when program exits, the go routine is blocked, why is there no error like <code>deadlocked...</code> or something in this case that I see?</p>\n"}, {"tags": ["go", "encryption", "aes", "cbc-mode"], "comments": [{"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1554953137, "post_id": 51001126, "comment_id": 97940942, "body": "Could this be padding?  If your writer is writing exactly a multiple of 16 bytes, then you&#39;ll end up with one spare block at the end of just encrypted zeroes."}], "owner": {"reputation": 37, "user_id": 8427591, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ee6xFalrEj4/AAAAAAAAAAI/AAAAAAAAT_g/wxNUVXikrfs/photo.jpg?sz=128", "display_name": "Marcel Kocks", "link": "https://stackoverflow.com/users/8427591/marcel-kocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1529756650, "creation_date": 1529756650, "question_id": 51001126, "link": "https://stackoverflow.com/questions/51001126/decryption-of-every-1024th-block-fails", "title": "Decryption of every 1024th block fails", "body": "<p>i am trying to implement a reader in golang to decrypt data (provided by a reader) and validate the data (hmac + sha256) at the same time.</p>\n\n<p>Decrypting the complete data as one block and validating it afterwards works. The data can be rather big, so i don\u00b4t want to hold in a data array.</p>\n\n<p>The reader implementation works for the most part, but the result of every 1024th aes block is wrong.</p>\n\n<pre><code>func (r *mediaReader) Read(dst []byte) (n int, err error) {\nif m := len(dst); m%r.cbc.BlockSize() != 0 {\n    m = (m / r.cbc.BlockSize()) * r.cbc.BlockSize()\n    dst = dst[:m]\n}\n\nn, err = r.limitedReader.Read(dst)\n\nr.cbc.CryptBlocks(dst, dst)\n\ntmp := r.fileLength - int64(n)\nif tmp &lt; 0 || err == io.EOF {\n    n += int(tmp)\n}\nr.total += n\n\nr.fileLength -= int64(n)\nr.hash.Write(dst)\nif r.fileLength &lt;= 0 || err == io.EOF {\n    //validate\n    mac := make([]byte, 10)\n    nn, rr := r.fullReader.Read(mac)\n    if rr != nil {\n        return n, rr\n    }\n    if nn != 10 {\n        return n, fmt.Errorf(\"not enougth data remaining\")\n    }\n    if !hmac.Equal(mac, r.hash.Sum(nil)) {\n        return n, fmt.Errorf(\"invalid media hmac\\n%v\\n%v\", r.hash.Sum(nil)[:10], mac)\n    }\n    //SUCCESS\n    return n, io.EOF\n}\nreturn n, err\n}\n</code></pre>\n\n<p>The <code>limitedReader</code> uses the fullReader and ends 10 bytes before the fullReader does. Snippet of mediaReader creation:</p>\n\n<pre><code>h := hmac.New(sha256.New, macKey)\nh.Write(iv)\n\ncbc := cipher.NewCBCDecrypter(block, iv)\n\nmedia := &amp;io.LimitedReader{R: fullReader, N: length - 10}\n\nreturn &amp;mediaReader{\n    limitedReader: media,\n    fullReader:    fullReader,\n    hash:          h,\n    fileLength:    fileLength,\n    cbc:           cbc,\n    total:         0,\n}\n</code></pre>\n\n<p>Does anyone regocnize what I am doing wrong?\nWrong decrypted bytes: \n16384-16399; 1 * 1024 * 16 (AES Blocksize); 16 wrong bytes\n32768-32783; 2 * 1024 * 16 (AES Blocksize); 16 wrong bytes\n49152-49167; 3 * 1024 * 16 (AES Blocksize); 16 wrong bytes\n...</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 795, "user_id": 1343961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfdf749836ffbb6a2ea195402ada9ee?s=128&d=identicon&r=PG", "display_name": "archit gupta", "link": "https://stackoverflow.com/users/1343961/archit-gupta"}, "edited": false, "score": 0, "creation_date": 1529785997, "post_id": 51000948, "comment_id": 89003106, "body": "seems to be a syntax error: DateCreation    time.Time <code>gorm:&quot;column:dateCreation</code>"}, {"owner": {"reputation": 795, "user_id": 1343961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfdf749836ffbb6a2ea195402ada9ee?s=128&d=identicon&r=PG", "display_name": "archit gupta", "link": "https://stackoverflow.com/users/1343961/archit-gupta"}, "edited": false, "score": 2, "creation_date": 1529786053, "post_id": 51000948, "comment_id": 89003122, "body": "right after DateCreation you are missing &quot;"}, {"owner": {"reputation": 315, "user_id": 5342427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d3f939f739ee4adca858ded1682dbb3?s=128&d=identicon&r=PG&f=1", "display_name": "rbo13", "link": "https://stackoverflow.com/users/5342427/rbo13"}, "reply_to_user": {"reputation": 795, "user_id": 1343961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfdf749836ffbb6a2ea195402ada9ee?s=128&d=identicon&r=PG", "display_name": "archit gupta", "link": "https://stackoverflow.com/users/1343961/archit-gupta"}, "edited": false, "score": 1, "creation_date": 1530005998, "post_id": 51000948, "comment_id": 89070531, "body": "I agree with @archit gupta, you have a syntax error in your DateCreation. It is missing closing (&quot;).  <code>gorm:&quot;column:dateCreation</code> should be <code>gorm:&quot;column:dateCreation&quot;</code>"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 713, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1529826684, "creation_date": 1529755188, "last_edit_date": 1529826684, "question_id": 51000948, "link": "https://stackoverflow.com/questions/51000948/gorm-dont-find-a-column-field-with-quotes", "title": "gorm don&#39;t find a column field with quotes", "body": "<p>Here is my code : </p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n  \"time\"\n    \"fmt\"\n)\n\n\nfunc (Rank) TableName() string {\n    return \"Score_rank\"\n}\n\n// Overriding Column Name\ntype Rank struct {\n    Id   int64     `gorm:\"column:id\"`\n    DateCreation    time.Time `gorm:\"column:dateCreation`\n    Score         time.Time    `gorm:\"column:score\"`\n    Rank         time.Time   `gorm:\"column:rank\"`\n    ReceiverId       int64     `gorm:\"column:receiver_id\"`\n}\n\n\nfunc main() {\n    db, err := gorm.Open(\"postgres\", \"host=127.0.0.1 port=5432 user=toto dbname=repsys password=akaburrules\")\n    defer db.Close()\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n\n\n    var rank Rank\n    //db.First(&amp;rank)\n    db.First(&amp;rank)\n    fmt.Println(rank)\n    fmt.Println(rank.ReceiverId)\n    fmt.Println(rank.DateCreation)\n}\n</code></pre>\n\n<p>The output is : </p>\n\n<pre><code>{3 0001-01-01 00:00:00 +0000 UTC 2018-06-23 13:34:35 +0200 CEST 2018-06-23 13:34:36 +0200 CEST 3}\n3\n0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>but the problem is that the rank.DateCreation is false :</p>\n\n<p><a href=\"https://i.stack.imgur.com/TSPBu.png\" rel=\"nofollow noreferrer\">pgadmin</a></p>\n\n<p>i don t understand why i have : 0001-01-01 00:00:00 +0000 UTC for dateCreation. It seems to be also a blank value</p>\n\n<p>the value should be : \n2018-06-23 13:34:11+02</p>\n\n<p>here is the pg admin view of my db\n<a href=\"https://i.stack.imgur.com/3tYAE.png\" rel=\"nofollow noreferrer\">pg admin view of my db </a></p>\n\n<p>edit :</p>\n\n<p>Here is the script of creation for my db : </p>\n\n<pre><code>  \"dateCreation\" timestamp with time zone,\n  score timestamp with time zone,\n  rank timestamp with time zone,\n</code></pre>\n\n<p>the problem may be : </p>\n\n<blockquote>\n  <p>\"dateCreation\" timestamp with time zone</p>\n</blockquote>\n\n<p>, the quote.</p>\n\n<p>So how to map this field witth the quote ?</p>\n\n<p>Thanks and regards</p>\n"}]