[{"tags": ["python", "go", "exec", "low-latency"], "comments": [{"owner": {"reputation": 740, "user_id": 7315159, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wLttyc9kcd4/AAAAAAAAAAI/AAAAAAAAAj4/ypMqEHWkiOM/photo.jpg?sz=128", "display_name": "Niayesh Isky", "link": "https://stackoverflow.com/users/7315159/niayesh-isky"}, "edited": false, "score": 0, "creation_date": 1553131165, "post_id": 55271734, "comment_id": 97275965, "body": "I don&#39;t know much about Golang, but does it have support for opening a pipe to a command and keeping it open? That way, you could have only one instance of the python script stay running and listen on stdin, which is probably faster than the HTTP version."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553163577, "post_id": 55271734, "comment_id": 97286221, "body": "Transpile your Python code to Go with grumpy. Or use a Python interpreter in your Go code or call out to C-Python directly via github.com/sbinet/go-python"}, {"owner": {"reputation": 21, "user_id": 7681939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11f7d5d6b6ba20863d6b28ffa0b47b1?s=128&d=identicon&r=PG&f=1", "display_name": "user7681939", "link": "https://stackoverflow.com/users/7681939/user7681939"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553183254, "post_id": 55271734, "comment_id": 97298409, "body": "@Volker Thanks for the suggestion.  Unfortunately, I can&#39;t do this. I mentioned Python but in reality the other process could be one of many (Python2.7, Python3.5, nodeJS, JS, Go itself, Java, Ruby, etc.)"}, {"owner": {"reputation": 21, "user_id": 7681939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11f7d5d6b6ba20863d6b28ffa0b47b1?s=128&d=identicon&r=PG&f=1", "display_name": "user7681939", "link": "https://stackoverflow.com/users/7681939/user7681939"}, "reply_to_user": {"reputation": 740, "user_id": 7315159, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wLttyc9kcd4/AAAAAAAAAAI/AAAAAAAAAj4/ypMqEHWkiOM/photo.jpg?sz=128", "display_name": "Niayesh Isky", "link": "https://stackoverflow.com/users/7315159/niayesh-isky"}, "edited": false, "score": 0, "creation_date": 1553288514, "post_id": 55271734, "comment_id": 97343653, "body": "@Niayesh Thanks for suggesting pipes. The Golang program that spawns the python process needs to collect three things from the python process (stdout and stderr logs and most important a response).  The response is most important and needs lowest latency. The logs can be collected slowly.  How can I do this using pipes?  I can create a bidirectional pipe and redirect stdout and stderr but how do I also get a response back from python to go.  E.g. The Golang process spawns a python process (python test.py). test.py is a user function that has stdout and stderr and returns a json response."}], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": false, "score": 0, "last_activity_date": 1553135744, "creation_date": 1553135744, "answer_id": 55272973, "question_id": 55271734, "link": "https://stackoverflow.com/questions/55271734/speed-up-access-to-python-programs-from-golangs-exec-packaqe/55272973#55272973", "title": "Speed up access to python programs from Golang&#39;s exec packaqe", "body": "<p>Approach 1: Simple HTTP server and client</p>\n\n<p>Approach 2: Local socket or pipe</p>\n\n<p>Approach 3: Shared memory</p>\n\n<p>Approach 4: GRPC server and client</p>\n\n<p>In fact, I prefer the GRPC method by stream way, it will hold the connection (because of HTTP/2), it's easy, fast and secure. And it's easy moving python node to another machine.</p>\n"}], "owner": {"reputation": 21, "user_id": 7681939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11f7d5d6b6ba20863d6b28ffa0b47b1?s=128&d=identicon&r=PG&f=1", "display_name": "user7681939", "link": "https://stackoverflow.com/users/7681939/user7681939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553135744, "creation_date": 1553125413, "last_edit_date": 1553125775, "question_id": 55271734, "link": "https://stackoverflow.com/questions/55271734/speed-up-access-to-python-programs-from-golangs-exec-packaqe", "title": "Speed up access to python programs from Golang&#39;s exec packaqe", "body": "<p>I need suggestions on how to speed up access to python programs when called from Golang.  I really need fast access time (very low latency).</p>\n\n<p>Approach 1:<br>\nfunc main() {<br>\n...<br>\n...<br>\n        cmd = exec.Command(\"python\", \"test.py\")<br>\n        o, err = cmd.CombinedOutput()<br>\n...<br>\n}</p>\n\n<p>If my test.py file is a basic print \"HelloWorld\" program, the execution time is over 50ms.  I assume most of the time is for loading the shell and python in memory.</p>\n\n<p>Approach 2:\nThe above approach can be speeded up substantially by having python start a HTTP server and then gaving the Go code POST a HTTP request and get the response from the HTTP server (python).  Speeds up response times to less than 5ms.\nI guess the main reason for this is probably because the python interpretor is already loaded and warm in memory.</p>\n\n<p>Are there other approaches I can use similar to approach 2 (shared memory, etc.) which could speed up the response from my python code?.  Our application requires extremely low latency and the 50 ms I am currently seeing from using Golang's exec package is not going to cut it.</p>\n\n<p>thanks,</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"tags": [], "owner": {"reputation": 1106, "user_id": 15148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0OgWa.jpg?s=128&g=1", "display_name": "andrel", "link": "https://stackoverflow.com/users/15148/andrel"}, "is_accepted": false, "score": 1, "last_activity_date": 1553121709, "last_edit_date": 1553121709, "creation_date": 1553120272, "answer_id": 55270981, "question_id": 55270928, "link": "https://stackoverflow.com/questions/55270928/how-to-pass-multidimensional-array-in-arbitrary-size-as-function-argument-in-go/55270981#55270981", "title": "How to pass multidimensional array in arbitrary size as function argument in GO", "body": "<p>Interesting question. This should work</p>\n\n<pre><code>a := [][]string{\n    {\"line\", \"tiger\"},\n    {\"cat\", \"dog\"},\n    {\"pigeon\", \"hamster\"},\n}\nPrintArray(a[:])\n</code></pre>\n\n<p>From the error messages, I would guess that arrays defined with size are of different types.</p>\n\n<p>For example, if the <code>PrintArray</code> looks like this:</p>\n\n<p><code>func PrintArray(a [3][2]string) {</code></p>\n\n<p>Then you can pass it an array defined as:</p>\n\n<p><code>a := [3][2]string</code>.</p>\n\n<p>If we vary the numbers in either the <code>PrintArray</code> method or <code>a</code>, so that they differ, we get an error message that says:</p>\n\n<p><code>cannot use a (type [3][2]string) as type [3][1]string in argument to PrintArray</code></p>\n"}, {"comments": [{"owner": {"reputation": 1931, "user_id": 3445926, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/075p2.jpg?s=128&g=1", "display_name": "FisNaN", "link": "https://stackoverflow.com/users/3445926/fisnan"}, "edited": false, "score": 0, "creation_date": 1553120628, "post_id": 55271009, "comment_id": 97273281, "body": "Is there a way to define the size of inner array?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1931, "user_id": 3445926, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/075p2.jpg?s=128&g=1", "display_name": "FisNaN", "link": "https://stackoverflow.com/users/3445926/fisnan"}, "edited": false, "score": 0, "creation_date": 1553121717, "post_id": 55271009, "comment_id": 97273602, "body": "See my revised answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1553121694, "last_edit_date": 1553121694, "creation_date": 1553120415, "answer_id": 55271009, "question_id": 55270928, "link": "https://stackoverflow.com/questions/55270928/how-to-pass-multidimensional-array-in-arbitrary-size-as-function-argument-in-go/55271009#55271009", "title": "How to pass multidimensional array in arbitrary size as function argument in GO", "body": "<p>In Go, <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">array types</a> and <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slice types</a> are distinct. Pass slices to slices.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := [][]string{\n        {\"line\", \"tiger\"},\n        {\"cat\", \"dog\"},\n        {\"pigeon\", \"hamster\"},\n    }\n    PrintSlices(a)\n}\n\nfunc PrintSlices(a [][]string) {\n    for _, v1 := range a {\n        for _, v2 := range v1 {\n            fmt.Printf(\"%s \", v2)\n        }\n        fmt.Printf(\"\\n\")\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/3mPDTIEUQmT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3mPDTIEUQmT</a></p>\n\n<p>Output:</p>\n\n<pre><code>line tiger \ncat dog \npigeon hamster\n</code></pre>\n\n<hr>\n\n<p>To allocate a matrix:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc NewMatrix(rows, cols int) [][]int {\n    m := make([][]int, rows)\n    for r := range m {\n        m[r] = make([]int, cols)\n    }\n    return m\n}\n\nfunc main() {\n    m := NewMatrix(3, 2)\n    fmt.Println(m)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/qvwQu2giRcP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qvwQu2giRcP</a></p>\n\n<p>Output:</p>\n\n<pre><code>[[0 0] [0 0] [0 0]]\n</code></pre>\n"}], "owner": {"reputation": 1931, "user_id": 3445926, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/075p2.jpg?s=128&g=1", "display_name": "FisNaN", "link": "https://stackoverflow.com/users/3445926/fisnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 1, "accepted_answer_id": 55271009, "answer_count": 2, "score": 0, "last_activity_date": 1553121709, "creation_date": 1553119939, "question_id": 55270928, "link": "https://stackoverflow.com/questions/55270928/how-to-pass-multidimensional-array-in-arbitrary-size-as-function-argument-in-go", "title": "How to pass multidimensional array in arbitrary size as function argument in GO", "body": "<p>I'm new to GO. There is the problem I'm facing.</p>\n\n<p>The function takes a 2D array in arbitrary size as argument:</p>\n\n<pre><code>func PrintArray(a [][]string) {\n    for _, v1 := range a {\n        for _, v2 := range v1 {\n            fmt.Printf(\"%s \", v2)\n        }\n        fmt.Printf(\"\\n\")\n    }\n}\n</code></pre>\n\n<p>As you can see, since the nested loop uses <code>range</code>. The size of the array really doesn't matter.</p>\n\n<p>But when I try to call this function:</p>\n\n<pre><code>a := [3][2]string{\n    {\"line\", \"tiger\"},\n    {\"cat\", \"dog\"},\n    {\"pigeon\", \"hamster\"},\n}\nPrintArray(a[:])\n</code></pre>\n\n<p>It complains about:</p>\n\n<blockquote>\n  <p>cannot use a[:] (type [][2]string) as type [][]string in argument to PrintArray</p>\n</blockquote>\n\n<p>However, it won't compile with <code>a[:][:]</code> either.</p>\n\n<p>What is the correct way to define a multidimensional array in arbitrary size in GO lang?</p>\n"}, {"tags": ["java", "go", "microservices", "netflix-eureka", "netflix-zuul"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10553991, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205218055288638/picture?type=large", "display_name": "Ankur B. Roy", "link": "https://stackoverflow.com/users/10553991/ankur-b-roy"}, "edited": false, "score": 1, "creation_date": 1553112054, "post_id": 55269046, "comment_id": 97269546, "body": "Thanks Laksitha, let me try that."}, {"owner": {"reputation": 33, "user_id": 10553991, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205218055288638/picture?type=large", "display_name": "Ankur B. Roy", "link": "https://stackoverflow.com/users/10553991/ankur-b-roy"}, "edited": false, "score": 0, "creation_date": 1553145300, "post_id": 55269046, "comment_id": 97278890, "body": "Is not .getNextServerFromEureka(vipAddress, false); always picks from what is registered in Eureka Server ? In that case, how to register this &#39;on-spring Java service&#39; in Eureka ?  Registering in Eureka is still not done."}, {"owner": {"reputation": 3624, "user_id": 1293087, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FuLOs.jpg?s=128&g=1", "display_name": "Laksitha Ranasingha", "link": "https://stackoverflow.com/users/1293087/laksitha-ranasingha"}, "reply_to_user": {"reputation": 33, "user_id": 10553991, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205218055288638/picture?type=large", "display_name": "Ankur B. Roy", "link": "https://stackoverflow.com/users/10553991/ankur-b-roy"}, "edited": false, "score": 0, "creation_date": 1553158646, "post_id": 55269046, "comment_id": 97283636, "body": "I said non-spring &amp; that\u2019s Netflix documentation. You have to try out and get it working, look for any issues reported on github too. We\u2019re not able to do thorough troubleshooting in stackoverflow."}], "tags": [], "owner": {"reputation": 3624, "user_id": 1293087, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FuLOs.jpg?s=128&g=1", "display_name": "Laksitha Ranasingha", "link": "https://stackoverflow.com/users/1293087/laksitha-ranasingha"}, "is_accepted": false, "score": 0, "last_activity_date": 1553111201, "creation_date": 1553111201, "answer_id": 55269046, "question_id": 55268592, "link": "https://stackoverflow.com/questions/55268592/in-eureka-server-discovey-and-registration-of-services-applications-not-develop/55269046#55269046", "title": "In Eureka Server, Discovey and Registration of Services/Applications NOT developed in Spring", "body": "<p>It's like any other backend service; you have to use the right <strong>client</strong>. For example, if you have non-spring Java services, you could use;</p>\n\n<pre><code>InstanceInfo nextServerInfo = DiscoveryManager.getInstance()\n                .getDiscoveryClient()\n                .getNextServerFromEureka(vipAddress, false);\n\n        Socket s = new Socket();\n        int serverPort = nextServerInfo.getPort();\n        try {\n            s.connect(new InetSocketAddress(nextServerInfo.getHostName(),\n                    serverPort));\n        } catch (IOException e) {\n            System.err.println(\"Could not connect to the server :\"\n                    + nextServerInfo.getHostName() + \" at port \" + serverPort);\n        }\n</code></pre>\n\n<p><a href=\"https://github.com/Netflix/eureka/wiki/Understanding-eureka-client-server-communication\" rel=\"nofollow noreferrer\">https://github.com/Netflix/eureka/wiki/Understanding-eureka-client-server-communication</a></p>\n\n<p>Here's a Python client;</p>\n\n<p><a href=\"https://pypi.org/project/py-eureka-client/\" rel=\"nofollow noreferrer\">https://pypi.org/project/py-eureka-client/</a></p>\n\n<p>A golang client;</p>\n\n<p><a href=\"https://github.com/hudl/fargo\" rel=\"nofollow noreferrer\">https://github.com/hudl/fargo</a></p>\n"}], "owner": {"reputation": 33, "user_id": 10553991, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205218055288638/picture?type=large", "display_name": "Ankur B. Roy", "link": "https://stackoverflow.com/users/10553991/ankur-b-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 747, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553112893, "creation_date": 1553109351, "last_edit_date": 1553112893, "question_id": 55268592, "link": "https://stackoverflow.com/questions/55268592/in-eureka-server-discovey-and-registration-of-services-applications-not-develop", "title": "In Eureka Server, Discovey and Registration of Services/Applications NOT developed in Spring", "body": "<p>How can web applications built without Spring (say, on Java-JEE and Go) be discovered and registered in Eureka Server ?</p>\n\n<p>In a Spring-Boot application, it is easy to add these annotations:</p>\n\n<pre><code>@EnableDiscoveryClient\n@SpringBootApplication\n</code></pre>\n\n<p>before</p>\n\n<pre><code>public class EurekaClientApp{\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaClientApp.class, args);\n    }\n}\n</code></pre>\n\n<p>and in configuration, application.properties</p>\n\n<pre><code>eureka.client.register-with-eureka=true\neureka.client.fetch-registry=true\n</code></pre>\n\n<p>But for applications which were built not as Spring-Boot or for that matter as Microservices, how should they be discovered and registered as clients by Eureka Server</p>\n"}, {"tags": ["go", "maps", "logic"], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553107215, "post_id": 55267869, "comment_id": 97267134, "body": "In Go pointers are valid key types for maps, while your suggestion may or may not fix OP&#39;s issue, claiming that the use of pointers as keys causes the problem is just inaccurate."}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553107881, "post_id": 55267869, "comment_id": 97267487, "body": "In Go, you cannot have a non pointer struct as a key in a Go map. I&#39;ve tried. The compiler complains."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108018, "post_id": 55267869, "comment_id": 97267557, "body": "@RichardJohnCatalano that&#39;s incorrect, non-pointer structs are valid key types: <a href=\"https://play.golang.com/p/c9MQTFrzLoU\" rel=\"nofollow noreferrer\">play.golang.com/p/c9MQTFrzLoU</a>"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553108022, "post_id": 55267869, "comment_id": 97267559, "body": "@mkopriva I never claimed that pointers are not valid key types for maps. They are being wrongly used in the example and I suggested an alternative which could solve the problem."}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553108158, "post_id": 55267869, "comment_id": 97267608, "body": "@mkopriva That&#39;s so strange...it&#39;s allowing me to now but I swear it wasn&#39;t letting me before on the problem that I based this example off of. Either way switching to a non pointer for some reason solves this. Must have something to do with the copies getting tangled and dropped?"}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108241, "post_id": 55267869, "comment_id": 97267644, "body": "Could there be a problem if I were to use an exported struct type as a key in the map?"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108251, "post_id": 55267869, "comment_id": 97267646, "body": "@RichardJohnCatalano The reason is known. You are using the map to remove duplicates. Pointers to the same skill content can be different and thus the strange behavior you are seeing!!"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108306, "post_id": 55267869, "comment_id": 97267677, "body": "@RichardJohnCatalano Nope, there is no problem with that, it will still work."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108390, "post_id": 55267869, "comment_id": 97267719, "body": "@RichardJohnCatalano you can use structs as long as all of the members of the struct are comparable <a href=\"https://play.golang.com/p/yHQfhgiGO8E\" rel=\"nofollow noreferrer\">play.golang.com/p/yHQfhgiGO8E</a>"}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108457, "post_id": 55267869, "comment_id": 97267747, "body": "So if they contain slices of embedded structs, would that make them no longer comparable?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108540, "post_id": 55267869, "comment_id": 97267788, "body": "@RichardJohnCatalano correct, <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Comparison_operators</a> <code>Slice, map, and function values are not comparable.</code> So a struct type that has one or more fields of those types cannot be used as a key in a map."}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108582, "post_id": 55267869, "comment_id": 97267809, "body": "Ahhhh...in that case, what would you recommend for how I go about it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108641, "post_id": 55267869, "comment_id": 97267836, "body": "@RichardJohnCatalano well in your example <code>skill</code> is a string so its hard to tell. Is skill in the actual code a struct?"}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1553108765, "post_id": 55267869, "comment_id": 97267887, "body": "in the actual code this was based on skill is a struct containing a string and two slices of structs for which in each struct contain two strings."}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553108909, "post_id": 55267869, "comment_id": 97267966, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/190388/discussion-between-richard-john-catalano-and-mkopriva\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 3, "last_activity_date": 1553108469, "last_edit_date": 1553108469, "creation_date": 1553106700, "answer_id": 55267869, "question_id": 55266979, "link": "https://stackoverflow.com/questions/55266979/map-seems-to-drop-values-in-recursion/55267869#55267869", "title": "Map seems to drop values in recursion", "body": "<p>This has nothing to do with Golang maps dropping any values.</p>\n\n<p>The problem is that you are using a map of skill pointers and not skills. Two pointers to the same skill content can be different.</p>\n\n<blockquote>\n  <p><code>skillsSet := make(map[*skill]bool)</code> </p>\n</blockquote>\n\n<p>If you change this to <code>map[skill]bool</code>, this should work. You may try it out!</p>\n"}], "owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 55267869, "answer_count": 1, "score": 1, "last_activity_date": 1553108469, "creation_date": 1553103325, "last_edit_date": 1553105968, "question_id": 55266979, "link": "https://stackoverflow.com/questions/55266979/map-seems-to-drop-values-in-recursion", "title": "Map seems to drop values in recursion", "body": "<p>I've been working on a problem and I figured I would demonstrate it using a pokemon setup. I am reading from a file, parsing the file and creating objects/structs from them. This normally isn't a problem except now I need to implement interface like inheriting of traits. I don't want there to be duplicate skills in there so I figured I could use a map to replicate a set data structure. However it seems that in the transitive phase of my recursive parsePokemonFile function (see the implementsComponent case), I appear to be losing values in my map. </p>\n\n<p>I am using the inputs like such:</p>\n\n<p>4 files</p>\n\n<p>Ratatta:</p>\n\n<pre><code>name=Ratatta\nskills=Tackle:normal,Scratch:normal\n</code></pre>\n\n<p>Bulbosaur:</p>\n\n<pre><code>name=Bulbosaur\nimplements=Ratatta\nskills=VineWhip:leaf\n</code></pre>\n\n<p>Oddish:</p>\n\n<pre><code>name=Oddish\nimplements=Ratatatt\nskills=Acid:poison\n</code></pre>\n\n<p>Venosaur:</p>\n\n<pre><code>name=Venosaur\nimplements=bulbosaur,oddish\n</code></pre>\n\n<p>I'm expecting the output for the following code to be something like</p>\n\n<pre><code>Begin!\n{Venosaur [{VineWhip leaf} {Acid poison} {Tackle normal} {Scratch normal}]}\n</code></pre>\n\n<p>but instead I get</p>\n\n<pre><code>Begin!\n{Venosaur [{VineWhip leaf} {Acid poison}]}\n</code></pre>\n\n<p>What am I doing wrong? Could it be a logic error? Or am I making an assumption about the map holding values that I shouldn't?</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\n// In order to create a set of pokemon abilities and for ease of creation and lack of space being taken up\n// We create an interfacer capability that imports the skills and attacks from pokemon of their previous evolution\n// This reduces the amount of typing of skills we have to do.\n// Algorithm is simple. Look for the name \"implements=x\" and then add x into set.\n// Unfortunately it appears that the set is dropping values on transitive implements interfaces\n\nfunc main() {\n     fmt.Println(\"Begin!\")\n    dex, err := parsePokemonFile(\"Venosaur\")\n    if err != nil {\n        fmt.Printf(\"Got error: %v\\n\", err)\n    }\n    fmt.Printf(\"%v\\n\", dex)\n}\n\ntype pokemon struct {\n    Name   string\n    Skills []skill\n}\n\ntype skill struct {\n    SkillName string\n    Type      string\n}\n\nfunc parsePokemonFile(filename string) (pokemon, error) {\n    file, err := os.Open(filename)\n    if err != nil {\n        return pokemon{}, err\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    var builtPokemon pokemon\n    for scanner.Scan() {\n        component, returned := parseLine(scanner.Text())\n        switch component {\n        case nameComponent:\n            builtPokemon.Name = returned\n        case skillsComponent:\n            skillsStrings := strings.Split(returned, \",\")\n            var skillsArr []skill\n            // split skills and add them into pokemon skillset\n            for _, skillStr := range skillsStrings {\n                skillPair := strings.Split(skillStr, \":\")\n                skillsArr = append(skillsArr, skill{SkillName: skillPair[0], Type: skillPair[1]})\n            }\n            builtPokemon.Skills = append(builtPokemon.Skills, skillsArr...)\n        case implementsComponent:\n            implementsArr := strings.Split(returned, \",\")\n            // create set to remove duplicates\n            skillsSet := make(map[*skill]bool)\n            for _, val := range implementsArr {\n                // recursively call the pokemon files and get full pokemon\n                implementedPokemon, err := parsePokemonFile(val)\n                if err != nil {\n                    return pokemon{}, err\n                }\n                // sieve out the skills into a set\n                for _, skill := range implementedPokemon.Skills {\n                    skillsSet[&amp;skill] = true\n                }\n            }\n            // append final set into the currently being built pokemon\n            for x := range skillsSet {\n                builtPokemon.Skills = append(builtPokemon.Skills, *x)\n            }\n        }\n    }\n    return builtPokemon, nil\n}\n\ntype component int\n\n// components to denote where to put our strings when it comes time to assemble what we've parsed\nconst (\n    nameComponent component = iota\n    implementsComponent\n    skillsComponent\n)\n\nfunc parseLine(line string) (component, string) {\n    arr := strings.Split(line, \"=\")\n    switch arr[0] {\n    case \"name\":\n        return nameComponent, arr[1]\n    case \"implements\":\n        return implementsComponent, arr[1]\n    case \"skills\":\n        return skillsComponent, arr[1]\n    default:\n        panic(\"Invalid field found\")\n    }\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1553103567, "post_id": 55266935, "comment_id": 97265300, "body": "Welcome to StackOverflow! This question is pretty broad. Have you done any research? Have you tried implementing what you&#39;re talking about? Can you show your attempt and explain what issues you ran into?"}, {"owner": {"reputation": 1, "user_id": 11233494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa8a06612696b9757e2b25cd55a918c?s=128&d=identicon&r=PG&f=1", "display_name": "user278762", "link": "https://stackoverflow.com/users/11233494/user278762"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553104764, "post_id": 55266935, "comment_id": 97265931, "body": "Thanks! :) Yes I have and fetching stuff from my database is no problem. The problem is to actually do the query that is based on date rather than going by id or something like that. A lot of the examples are, when searching for this, in javascript it seems (and timestamp also throws me off:)). Like <a href=\"https://stackoverflow.com/questions/13314678/mongodb-only-fetch-documents-created-in-the-last-24hrs\" title=\"mongodb only fetch documents created in the last 24hrs\">stackoverflow.com/questions/13314678/&hellip;</a> Maybe something like this: <code>db.getCollection(&quot;COLLECTION_NAME&quot;).find({&quot;createdAt&quot;:{$gt:n&zwnj;&#8203;ew Date(Date.now() - 24*60*60 * 1000)}})</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553104956, "post_id": 55266935, "comment_id": 97266017, "body": "If you&#39;ve tried doing what you&#39;re describing and run into issues, can you edit your question with the problematic code and explain what specific issue(s) you&#39;re having with that code?"}, {"owner": {"reputation": 1, "user_id": 11233494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa8a06612696b9757e2b25cd55a918c?s=128&d=identicon&r=PG&f=1", "display_name": "user278762", "link": "https://stackoverflow.com/users/11233494/user278762"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553116097, "post_id": 55266935, "comment_id": 97271567, "body": "Sure, added in OP, thanks!"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1553145754, "post_id": 55266935, "comment_id": 97278989, "body": "Both mgo and the official MongoDB Go driver use <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> for the language conversion to BSON Date. So you need that type and not just the numeric milliseconds. If you have somehow managed to store your dates as &quot;strings&quot;, then you would need to do your math for the intervals and parse the Date ( Time struct ) into a string format and use those within the query range. If you have &quot;strings&quot;, you would be advised to convert these to BSON date as a priority."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1553145949, "post_id": 55266935, "comment_id": 97279042, "body": "Note. mgo has basically been dropped from further maintenance, with the exception of a few private forks of the project offering some limited updates. It would likely better serve your interests to switch to the Official MongoDB Go driver, since it was basically created in response to original maintainers of other projects ceasing further maintenance themselves. Expect ongoing API changes with MongoDB not to be supported in other non-officially backed projects."}, {"owner": {"reputation": 1, "user_id": 11233494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa8a06612696b9757e2b25cd55a918c?s=128&d=identicon&r=PG&f=1", "display_name": "user278762", "link": "https://stackoverflow.com/users/11233494/user278762"}, "edited": false, "score": 0, "creation_date": 1553199599, "post_id": 55266935, "comment_id": 97306646, "body": "Thanks for information about that. The above issue causing a &quot;null&quot; was actually a timezone issue and is now solved."}], "owner": {"reputation": 1, "user_id": 11233494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa8a06612696b9757e2b25cd55a918c?s=128&d=identicon&r=PG&f=1", "display_name": "user278762", "link": "https://stackoverflow.com/users/11233494/user278762"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "closed_date": 1553145567, "answer_count": 0, "score": 0, "last_activity_date": 1553116075, "creation_date": 1553103154, "last_edit_date": 1553116075, "question_id": 55266935, "link": "https://stackoverflow.com/questions/55266935/how-to-fetch-n-hours-documents-from-mongodb-via-go", "closed_reason": "Duplicate", "title": "How to fetch n hours documents from mongodb via go?", "body": "<p>I have a database that already have a \"createdStamp\" field containing a Unix timestamp per post.</p>\n\n<p>In my query to the database, I'd like to only list \"n hours back\" and retrieve the documents that are within that range (from now and one hour back for example). Using mgo as driver. Newbie at go.</p>\n\n<p>Any ideas on how to do that? </p>\n\n<p>Tested this, but not working only giving a null as return:</p>\n\n<pre><code>func (m *SongsDAO) HourBack() ([]Song, error) {\n   currentTime := time.Now().Unix() - 3600\n   var songs []Song\n   err := db.C(COLLECTION).Find(bson.M{\"createdStamp\": bson.M{\"$gt\": currentTime}}).All(&amp;songs)\n   return songs, err\n}\n</code></pre>\n"}, {"tags": ["c", "go", "types", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553101901, "post_id": 55266246, "comment_id": 97264353, "body": "What is the intent of <code>unsafe.Pointer(uintptr(unsafe.Pointer(&amp;nums)))</code>? The extra <code>unintptr</code> and <code>unsafe.Pointer</code> shouldn&#39;t be doing anything."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10559464"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553102277, "post_id": 55266246, "comment_id": 97264610, "body": "Thanks for pointing that out. It was probably just from a hasty copy paste. It could be removed."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user10559464"}, "is_accepted": false, "score": 0, "last_activity_date": 1553101672, "creation_date": 1553101672, "answer_id": 55266486, "question_id": 55266246, "link": "https://stackoverflow.com/questions/55266246/golang-cgo-c-int-size-differences/55266486#55266486", "title": "Golang cgo *C.int size differences", "body": "<p>I figured it out. Silly mistake. I am incrementing by the size of the pointer - 64bit address - rather than the size of the int. Revised go file:</p>\n\n<pre><code>package main\n\n/*\nint addNums(int *nums);\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var nums [2]int32\n    fmt.Println(unsafe.Sizeof(nums))\n    numsPtr := (*C.int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;nums))))\n    fmt.Println(numsPtr)\n    *numsPtr = 199\n    numsPtr = (*C.int)(unsafe.Pointer(uintptr(unsafe.Pointer(numsPtr)) + unsafe.Sizeof(*numsPtr)))\n    fmt.Println(numsPtr)\n    *numsPtr = 3\n    res, err := C.addNums((*C.int)(unsafe.Pointer(&amp;nums)))\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(res)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10559464"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 810, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553102304, "creation_date": 1553100968, "last_edit_date": 1553102304, "question_id": 55266246, "link": "https://stackoverflow.com/questions/55266246/golang-cgo-c-int-size-differences", "title": "Golang cgo *C.int size differences", "body": "<p>I am exploring CGO and I have run into a quirk where the size of C.int in the go runtime is 8 bytes but the C int is 4 bytes. I understand that Go ints can be 64 bits or 32 bits depending on architecture, and that C ints are always 32 bits. Is \nthere a standard way for telling go to use 4 bytes for C.int types? I have not been able to find documentation that deals with this.</p>\n\n<p>Because of this the code does not function as anticipated. It basically adds the low side to the high side of the first int. It never references the second int passed.</p>\n\n<p>Thanks in advance.</p>\n\n<p>Actual output:</p>\n\n<pre><code>0xc00001a0b0\n0xc00001a0b8\n0xc00001a0b0\n0xc00001a0b4\n199\n0\n199\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\n/*\nint addNums(int *nums);\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var nums [2]C.int\n    numsPtr := (*C.int)(unsafe.Pointer(&amp;nums))\n    fmt.Println(numsPtr)\n    *numsPtr = 199\n    numsPtr = (*C.int)(unsafe.Pointer(uintptr(unsafe.Pointer(numsPtr)) + unsafe.Sizeof(numsPtr)))\n    fmt.Println(numsPtr)\n    *numsPtr = 3\n    res, err := C.addNums((*C.int)(unsafe.Pointer(&amp;nums[0])))\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(res)\n}\n</code></pre>\n\n<p>lib.c</p>\n\n<pre><code>long addNums(int *nums)\n{\n  printf(\"%p\\n\", &amp;nums[0]);\n  printf(\"%p\\n\", &amp;nums[1]);\n  printf(\"%d\\n\", nums[0]);\n  printf(\"%d\\n\", nums[1]);\n  return (nums[0] + nums[1]);\n}\n</code></pre>\n"}, {"tags": ["go", "decorator"], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1553101337, "last_edit_date": 1553101337, "creation_date": 1553101124, "answer_id": 55266297, "question_id": 55265978, "link": "https://stackoverflow.com/questions/55265978/how-to-decorate-functions-with-different-signatures-in-golang/55266297#55266297", "title": "How to decorate functions with different signatures in Golang?", "body": "<p>Disclaimer the only decoration I've done is through embedding structs, but one way could be to define a type for the function you'd like to decorate (not strictly necessary but will make signatures simpler):</p>\n\n<pre><code>type SpendTXFn = func SpendTx(senderID, recipientID string, amount, fee utils.BigInt, payload string, ttl, nonce uint64) (rlpRawMsg []byte, err error)\n</code></pre>\n\n<p>Now functions can talk in terms of this type, a decorator function would contain the same call signature as this type</p>\n\n<pre><code>func EncodedSpendTX(s SpendTX) SpendTX {\n     return func(senderID, recipientID string, amount, fee utils.BigInt, payload string, ttl, nonce uint64) (rlpRawMsg []byte, err error) {\n        // compute decorated result \n        res, err := s(senderID, recipientID, amount, fee, payload, ttl, nonce)\n        if err != nil {\n          return res, err\n        } \n        // encode the res\n        // return encoded res\n     }\n}\n</code></pre>\n\n<p>Now you can decorate your SpendTX function:</p>\n\n<pre><code>decorated := EncodedSpendTX(originalSpendTx)\n\ndecorated(...) -&gt; []byte, err\n</code></pre>\n\n<p>Downsides of this is there is a decorator per function type.  Upsides are <a href=\"https://medium.com/dm03514-tech-blog/designpatterns-considering-decorators-b4968a8006e8\" rel=\"nofollow noreferrer\">many with my favorite being</a> that the encoding is easy to test and separate from the original logic, so it doesn't require any mutation to your original function. </p>\n\n<hr>\n\n<p>Actually I think this is the approach that go's http middleware takes through <code>http.Handler</code></p>\n\n<p><a href=\"https://www.alexedwards.net/blog/making-and-using-middleware\" rel=\"nofollow noreferrer\">https://www.alexedwards.net/blog/making-and-using-middleware</a></p>\n"}], "owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 496, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553101337, "creation_date": 1553100098, "question_id": 55265978, "link": "https://stackoverflow.com/questions/55265978/how-to-decorate-functions-with-different-signatures-in-golang", "title": "How to decorate functions with different signatures in Golang?", "body": "<p>I tried to apply decorators from this famous <a href=\"https://www.youtube.com/watch?v=xyDkyFjzFVc\" rel=\"nofollow noreferrer\">Golang decorators talk</a> but it only works for him because all the functions he's decorating are attached to a struct, and he's just decorating one Do() function. Every other tutorial I've seen also does it this way, which is quite annoying.</p>\n\n<p>I want to decorate these functions with a base58/64 encoder function</p>\n\n<pre><code>func SpendTx(senderID, recipientID string, amount, fee utils.BigInt, payload string, ttl, nonce uint64) (rlpRawMsg []byte, err error)\nfunc NamePreclaimTx(accountID, commitmentID string, fee uint64, ttl, nonce uint64) (rlpRawMsg []byte, err error)\nfunc NameClaimTx(accountID, name string, nameSalt, fee uint64, ttl, nonce uint64) (rlpRawMsg []byte, err error)\n...\n</code></pre>\n\n<p>As you can see, the arguments are all different, and they are also pure functions, not attached to a struct. But they all return []byte and an error, so this should be possible.</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1553100109, "post_id": 55265456, "comment_id": 97263291, "body": "@CeriseLim&#243;n: I don&#39;t believe that&#39;s the question. See <a href=\"https://play.golang.org/p/0IX_KqXwsoF\" rel=\"nofollow noreferrer\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1553116737, "last_edit_date": 1553116737, "creation_date": 1553115803, "answer_id": 55270156, "question_id": 55265456, "link": "https://stackoverflow.com/questions/55265456/difference-between-text-template-templates-and-html-template-templates/55270156#55270156", "title": "Difference between text/template.Templates and html/template.Templates", "body": "<p>Templates returned by <a href=\"https://golang.org/pkg/text/template/#New\" rel=\"nofollow noreferrer\"><code>text/template.New()</code></a> and <a href=\"https://golang.org/pkg/html/template/#New\" rel=\"nofollow noreferrer\"><code>html/template.New()</code></a> are both <em>incomplete templates</em> without a \"body\", they cannot yet be used to generate any output. You can verify this if you try to execute them:</p>\n\n<pre><code>t := ttemplate.New(\"t\")\nh := htemplate.New(\"h\")\nfmt.Println(t.Execute(os.Stdout, nil))\nfmt.Println(h.Execute(os.Stdout, nil))\n</code></pre>\n\n<p>Outputs (try it on the <a href=\"https://play.golang.org/p/X3SOx0czHIX\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>template: t: \"t\" is an incomplete or empty template\ntemplate: \"h\" is an incomplete or empty template\n</code></pre>\n\n<p>Returning incomplete templates in the associated templates has no significance, and is an implementation detail. One package chose to include it, the other chose not to.</p>\n\n<p>Note that if you \"complete\" the template definitions by actually parsing anything, both will include and return the self template in the associated templates, there is no difference in them:</p>\n\n<pre><code>t := ttemplate.Must(ttemplate.New(\"t\").Parse(\"t\"))\nh := htemplate.Must(htemplate.New(\"h\").Parse(\"h\"))\nfmt.Println(len(t.Templates()), len(h.Templates()))\nfmt.Println(t.Execute(os.Stdout, nil))\nfmt.Println(h.Execute(os.Stdout, nil))\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/nq-vkK35fag\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1 1\nt&lt;nil&gt;\nh&lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 4108077, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2YNQ9.png?s=128&g=1", "display_name": "hjjg200", "link": "https://stackoverflow.com/users/4108077/hjjg200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 55270156, "answer_count": 1, "score": 2, "last_activity_date": 1553116737, "creation_date": 1553098475, "last_edit_date": 1553115905, "question_id": 55265456, "link": "https://stackoverflow.com/questions/55265456/difference-between-text-template-templates-and-html-template-templates", "title": "Difference between text/template.Templates and html/template.Templates", "body": "<p>Recently, I noticed that <code>Templates()</code> of <code>html/template.Template</code> works differently from the one of <code>text/template.Template</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// go1.12\nfunc main() {\n    t := template.New( \"\" )\n    println( len( t.Templates() ) )\n}\n</code></pre>\n\n<p>The result of this code depends on whether you imported <code>text/template</code> or <code>html/template</code>. You'll notice that the text one prints 0 while the other prints 1. Becuase of this, I looked into the GoDoc and the html one's documentation said that <code>Templates()</code> includes itself -- but no further explanation. And I thought there must be some reason why; why does it have to be different from each other?</p>\n"}, {"tags": ["mysql", "go", "driver"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553098346, "post_id": 55265236, "comment_id": 97262177, "body": "The connection string is irrelevant. What matters is DNS resolution on the MySQL server itself."}, {"owner": {"reputation": 1, "user_id": 4678751, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pq02rSYJ8UQ/AAAAAAAAAAI/AAAAAAAAAWU/ThmKZmGWHH0/photo.jpg?sz=128", "display_name": "Lyubo", "link": "https://stackoverflow.com/users/4678751/lyubo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553103791, "post_id": 55265236, "comment_id": 97265405, "body": "This let&#39;s me in from server1: mysql -h 10.127.8.161 -u root"}], "owner": {"reputation": 1, "user_id": 4678751, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pq02rSYJ8UQ/AAAAAAAAAAI/AAAAAAAAAWU/ThmKZmGWHH0/photo.jpg?sz=128", "display_name": "Lyubo", "link": "https://stackoverflow.com/users/4678751/lyubo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553097811, "creation_date": 1553097811, "question_id": 55265236, "link": "https://stackoverflow.com/questions/55265236/go-sql-driver-mysql-uses-hostname-rather-than-ip", "title": "go-sql-driver/mysql uses hostname rather than IP", "body": "<p>I have <em>server1</em> and <em>server2</em>. On <em>server1</em> I have a Go app, trying to connect to MySQL on <em>server2</em>.</p>\n\n<p>Here are the IPs: \n<em>server1</em> 10.127.8.160;\n<em>server2</em> 10.127.8.161</p>\n\n<p>I get the following error:</p>\n\n<pre><code>Error 1045: Access denied for user 'root'@'server1' (using password: NO)\n</code></pre>\n\n<p>This is the connection string i am using:</p>\n\n<pre><code>root:@(10.127.8.161:3306)/mydatabase\n</code></pre>\n\n<p>The password for root is empty string. I also tried 'root@' (without the column) with the same result. I don't think this is important, but I figured I should mention it. </p>\n\n<p>This is what I have in <em>server2</em>. I have privileges for <em>server1</em>, but only by IP. The connection comes from <em>server1</em> by hostname instead. </p>\n\n<pre><code>+------------------------------------------------------+\n| Grants for root@10.127.8.160                         |\n+------------------------------------------------------+\n| GRANT ALL PRIVILEGES ON *.* TO 'root'@'10.127.8.160' |\n+------------------------------------------------------+\n</code></pre>\n\n<p>The question is how do I make it connect using its IP not its hostname? I don't have much control over <em>server2</em> to add more privileges.</p>\n\n<p>And for completeness this are the privileges for hostname:</p>\n\n<pre><code>SHOW GRANTS FOR 'root'@'server1'    \nERROR 1141 (42000) at line 1: There is no such grant defined for user 'root' on host 'server1'\n</code></pre>\n\n<p>Link to the driver:\n<a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql</a></p>\n\n<p>Thanks</p>\n"}, {"tags": ["java", "sorting", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1553092360, "post_id": 55263220, "comment_id": 97257776, "body": "Please write valid benchmarks before you worry about performance. See <a href=\"https://stackoverflow.com/q/30202611/13860\">this post</a>. Go provides a perfectly usable, and useful, benchmarking mechanism. You should use it when benchmarking Go code."}, {"owner": {"reputation": 296564, "user_id": 34088, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a4d6f03a8879432d8563aefbf48e787?s=128&d=identicon&r=PG", "display_name": "Aaron Digulla", "link": "https://stackoverflow.com/users/34088/aaron-digulla"}, "edited": false, "score": 0, "creation_date": 1553092415, "post_id": 55263220, "comment_id": 97257822, "body": "Is <code>Float64</code> an object or primitive type in Go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 296564, "user_id": 34088, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a4d6f03a8879432d8563aefbf48e787?s=128&d=identicon&r=PG", "display_name": "Aaron Digulla", "link": "https://stackoverflow.com/users/34088/aaron-digulla"}, "edited": false, "score": 1, "creation_date": 1553092535, "post_id": 55263220, "comment_id": 97257910, "body": "@AaronDigulla: float64 in go is a primitive type, but the sort package works through an interface abstraction, so there is always some overhead for the benefit of generalization."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553093095, "post_id": 55263220, "comment_id": 97258386, "body": "Take the benchmarks from package sort and port them to Java. This might be interesting."}, {"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 3, "creation_date": 1553093448, "post_id": 55263220, "comment_id": 97258664, "body": "Did you try sort.Slice? sort.Slice avoids some of the interface overhead of sort.Sort (which is used by sort.Float64s). If that doesn&#39;t help try profiling your code to see where the time is spent (<a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1553097339, "post_id": 55263220, "comment_id": 97261493, "body": "The sort function is not necessarily &quot;inferior&quot;, the overhead comes from the package providing a generic sort. If you encounter a problem where sorting huge numbers of float64s is your performance bottleneck, then you can implement or find a package for sorting float64s directly, rather than through this abstraction."}, {"owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553098729, "post_id": 55263220, "comment_id": 97262429, "body": "@JimB, what we are comparing to here is an even more generic Java Array.sort method which surely has more abstraction than the Go sort function? After all Java is almost regarded as the most prominent example of over-abstraction nowadays. I guess I can try write a quick sort directly and test it but I doubt the little abstraction Go does here is the source of such a huge performance drop when compared to the much more abstracted Java method."}, {"owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1553099027, "post_id": 55263220, "comment_id": 97262615, "body": "@Flimzy, your comment is still invalid and irrelevant here since you still have not pointed out which part of the two blocks of testing code is so-called &quot;invalid&quot; for you. Or maybe you can take a couple minute to write your so-called &quot;valid benchmark&quot; to test the result for yourself and post some valid comments. Thanks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553099065, "post_id": 55263220, "comment_id": 97262643, "body": "@hellopeach: <code>Go</code> does not have generics, which means specialization needs to be done manually. Yes, go could implement specialized sorts for the helper functions like <code>sort.Float64</code>, but for most cases the &quot;generic&quot; (meaning using the <code>sort.Interface</code>, not &quot;generics&quot;) implementation is adequate. Generating specialized sort from the reference implementation (maybe possible by adapting the generation used for <code>sort.Slice</code>) would be interesting exercise."}, {"owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553099389, "post_id": 55263220, "comment_id": 97262877, "body": "@JimB, and? what? still the Java&#39;s Arrays.sort method looks more generic (nothing about the &quot;generics programming&quot; paradigm of course, which was not what I meant in the first place) and more abstracted than the Go&#39;s sort.Float64s function, so if abstraction is the problem here, it should affect Java&#39;s sorting method even more."}, {"owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553100148, "post_id": 55263220, "comment_id": 97263317, "body": "@Volker, yup it&#39;d be interesting, but right now I&#39;m more concerned about the performance degradation after migrating from Java to Go so my hands are kinda full here now. I&#39;ll have to find the reason for the performance degradation ASAP and find a fix or optimization, or have to revert everything back to Java, or maybe off-load the computation heavy (ie. sorting heavy) part to numpy or something..."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1553103053, "post_id": 55263220, "comment_id": 97265012, "body": "Sorting doubles (float64) would be faster using radix sort, but only if you can cast a double to a 64 bit integer without actually modifying the data. C / C++ can do this, and if not dealing with special cases like NAN, then doubles can be treated as 64 bit sign + magnitude integers for the purpose of sorting."}, {"owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "edited": false, "score": 0, "creation_date": 1556550549, "post_id": 55263220, "comment_id": 98467791, "body": "Go is just not yet as efficient as Java today is."}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1553096562, "post_id": 55263670, "comment_id": 97260910, "body": "The Java implementation is so long because it contains overloaded functions for all the primitive integer types, not because it is so much fancier."}, {"owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "edited": false, "score": 0, "creation_date": 1553099711, "post_id": 55263670, "comment_id": 97263070, "body": "@Aaron, I doubt it, since this is just a simple array sort on a uniform distribution of random numbers, which I think mathematically has little room for optimization already, maybe some optimization can yield some small improvements, but three times the performance? And coupled to the fact that Go compiled to native binary where Java still runs on a VM (and we are talking about the not so new Java 8 here, not bleeding edge Java 12 and stuff) That&#39;s why I think something must be wrong here, just not sure where yet..."}, {"owner": {"reputation": 296564, "user_id": 34088, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a4d6f03a8879432d8563aefbf48e787?s=128&d=identicon&r=PG", "display_name": "Aaron Digulla", "link": "https://stackoverflow.com/users/34088/aaron-digulla"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553100750, "post_id": 55263670, "comment_id": 97263653, "body": "@Volker The code of the individual methods is also much longer than the ~40 lines of the core sort algorithm in Go."}, {"owner": {"reputation": 296564, "user_id": 34088, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a4d6f03a8879432d8563aefbf48e787?s=128&d=identicon&r=PG", "display_name": "Aaron Digulla", "link": "https://stackoverflow.com/users/34088/aaron-digulla"}, "reply_to_user": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "edited": false, "score": 0, "creation_date": 1553100842, "post_id": 55263670, "comment_id": 97263718, "body": "@hellopeach It depends what optimizations the VM can do before running the code. Go is compiled to generic x86 code. Java is compiled to the code for your specific CPU. The only other option is that Go uses an indirect array. The Java double[] array should be a continuous range of memory. If Go uses pointer indirection for each element, that will cost a lot of time but I doubt it."}], "tags": [], "owner": {"reputation": 296564, "user_id": 34088, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a4d6f03a8879432d8563aefbf48e787?s=128&d=identicon&r=PG", "display_name": "Aaron Digulla", "link": "https://stackoverflow.com/users/34088/aaron-digulla"}, "is_accepted": false, "score": -2, "last_activity_date": 1553093389, "creation_date": 1553093389, "answer_id": 55263670, "question_id": 55263220, "link": "https://stackoverflow.com/questions/55263220/why-is-my-go-array-sorting-code-much-slower-than-java/55263670#55263670", "title": "Why is my Go array sorting code much slower than Java?", "body": "<p>Twenty years ago, Java 1.1 was slow. Since then, thousands of people have put their minds to the task to fix that. Today, Java code is usually on par or faster than C++. With Java 12 and GraalVM, we're all going to see another boost.</p>\n\n<p>Bad code in Java can be slow but the same is true for C++. Java doesn't come with a brain, you have to use your own :-)</p>\n\n<p>To answer the question, the code looks correct. My guess is that <a href=\"http://hg.openjdk.java.net/jdk8/jdk8/jdk/file/687fd7c7986d/src/share/classes/java/util/DualPivotQuicksort.java\" rel=\"nofollow noreferrer\">Java's sort implementation</a> has in fact been optimized to the brink with data from thousands of use cases. Just look at the length: ~3000 lines with tons of corner cases compared to <a href=\"https://golang.org/src/sort/sort.go?h=quickSort\" rel=\"nofollow noreferrer\">500 in Go</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1553121389, "post_id": 55267961, "comment_id": 97273519, "body": "Using go&#39;s unsafe.pointer, you could treat an array of float64&#39;s as an array of uint64&#39;s, and then use radix sort. Java doesn&#39;t have an equivalent, but C / C++ does. Other than special values like NAN, the float64&#39;s treated as uint64&#39;s would actually be treated as 64 bit sign + magnitude integers for the purpose of radix sort."}], "tags": [], "owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "is_accepted": false, "score": 2, "last_activity_date": 1553107038, "creation_date": 1553107038, "answer_id": 55267961, "question_id": 55263220, "link": "https://stackoverflow.com/questions/55263220/why-is-my-go-array-sorting-code-much-slower-than-java/55267961#55267961", "title": "Why is my Go array sorting code much slower than Java?", "body": "<p>thanks for @JimB and @nussjustin's suggestions, I wrote a simple quicksort implementation myself, and it worked the magic!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc qsort(s []float64) []float64 {\n    if len(s) &lt; 2 {\n        return s\n    }\n\n    left, right := 0, len(s)-1\n\n    pivot := 0\n\n    s[pivot], s[right] = s[right], s[pivot]\n\n    for i := range s {\n        if s[i] &lt; s[right] {\n            s[left], s[i] = s[i], s[left]\n            left++\n        }\n    }\n\n    s[left], s[right] = s[right], s[left]\n\n    qsort(s[:left])\n    qsort(s[left+1:])\n\n    return s\n}\n\nfunc main() {\n    fmt.Println(\"Starting\")\n    const x = 1000000\n    const y = x * 10\n    var s [y]float64\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n    start1 := time.Now()\n    for i := 0; i &lt; y; i++ {\n        s[i] = r1.NormFloat64()\n    }\n    end1 := time.Since(start1)\n    ss := s[:]\n    start2 := time.Now()\n    ss = qsort(ss)\n    end2 := time.Since(start2)\n    fmt.Println(end1)\n    fmt.Println(end2)\n    fmt.Println(\"Number: \", ss[x])\n}\n</code></pre>\n\n<p>with this super crude quicksort, now I'm able to achieve the following results</p>\n\n<pre><code>Starting\n276.763ms\n1.589941s\nNumber:  -1.281875446690731 \n</code></pre>\n\n<p>now it's consistently around 15% faster than Java's Arrays.sort method!</p>\n\n<p>I also implemented a quicksort method specifically for array of double in Java to replace Arrays.sort method to see if I can get any performance gain, the performance ends up around the same as Arrays.sort, still around 10% to 15% slower than Go. It seems the Arrays.sort somehow already achieves the best performance possible in Java, and you don't gain anything by stripping away the abstractions.</p>\n\n<p>So I guess the lesson is that if you want performance in Go's sorting, then implement a quicksort function yourself, don't use the built-in sort functions, even the sort.Slice is around twice slower than a self-written sort function, and the sort.Float64s is more than three times (sometimes four times) slower!</p>\n\n<p>I guess these results can finally shut those commenters up about their so-called \"invalid benchmark\" stuff. Like I said, the performance degradation after migrating from Java to Go is quite real for my production system, and I'd be in a pinch if it cannot be fixed ASAP, now hopefully after replacing all those sort functions, we can finally see a decent performance improvement on our production system so I can have a peace sleep tonight :)</p>\n"}], "owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 1, "answer_count": 2, "score": -3, "last_activity_date": 1553107038, "creation_date": 1553092229, "last_edit_date": 1553103484, "question_id": 55263220, "link": "https://stackoverflow.com/questions/55263220/why-is-my-go-array-sorting-code-much-slower-than-java", "title": "Why is my Go array sorting code much slower than Java?", "body": "<p>After migrating one of my computing heavy backend programs from Java to Go, I find that the performance degraded instead of improving. I tested around some and it seems the array sorting code is the culprit (which I used heavily in my program). I have written the below two simplified programs to do a comparison, and somehow it seems Go's built-in sort function is a lot slower than Java's Arrays.sort method?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sort\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(\"Starting\")\n    const x = 1000000\n    const y = x * 10\n    var s [y]float64\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n    start1 := time.Now()\n    for i := 0; i &lt; y; i++ {\n        s[i] = r1.Float64()\n    }\n    end1 := time.Since(start1)\n    ss := s[:]\n    start2 := time.Now()\n    sort.Float64s(ss)\n    end2 := time.Since(start2)\n    fmt.Println(end1)\n    fmt.Println(end2)\n    fmt.Println(\"Number: \", ss[x])\n}\n</code></pre>\n\n<p>and it produces results like this:</p>\n\n<pre><code>Starting\n136.6331ms  // The time taken to generate 10,000,000 random numbers\n3.456781s   // The time taken to sort the 10,000,000 random numbers\nNumber:  0.10000285497001288\n</code></pre>\n\n<p>While with the Java program here</p>\n\n<pre><code>import java.util.*;\n\nclass RSTest {\n    public static void main(String[] args) {\n        System.out.println(\"Starting\");\n        int x = 1000000;\n        int y = x * 10;\n        Random gen = new Random(System.currentTimeMillis());\n        double[] s = new double[y];\n        long start1 = System.nanoTime();\n        for (int i = 0; i &lt; y; i++) {\n            s[i] = gen.nextDouble();\n        }\n        long end1 = System.nanoTime();\n        long start2 = System.nanoTime();\n        Arrays.sort(s);\n        long end2 = System.nanoTime();\n        System.out.println((end1 - start1) / (1000000000.0));\n        System.out.println((end2 - start2) / (1000000000.0));\n        System.out.println(s[x]);\n    }\n}\n</code></pre>\n\n<p>the results are like this</p>\n\n<pre><code>Starting\n0.2252634  // The time taken to generate 10,000,000 random numbers\n1.0303157  // The time taken to sort the 10,000,000 random numbers\n0.0999513608326642\n</code></pre>\n\n<p>the Go program takes around 130ms to generate 10 million random numbers and assign them to an array while Jave takes around 230ms to generate 10 million random numbers and assign them to an array, this part I think is the improvement I expect from going from Java to Go.</p>\n\n<p>But for the sorting part, it took Java only around 1s to sort the 10 million random numbers but it took Go around 3.5s to do the 10 million random number sort? And this is quite consistent from multiple runs of the test.</p>\n\n<p>So does that mean Go's built-in sort function is really this much inferior to Java's Arrays.sort method? Or did I use Go's sort function wrong? Or something is wrong with my programs?</p>\n\n<p>Thanks.</p>\n\n<p>Note: this is from Go 1.11 and Java 8, the current versions I'm running on my server. Also, please note that the two programs I posted here are purely for testing purposes that I have written in a couple minutes so may (or rather, most certainly do) contain some code that doesn't make much sense for real production systems.</p>\n\n<p>Some Update:</p>\n\n<p>Thanks to @nussjustin's suggestion, I tried sort.Slice with some promising results.</p>\n\n<p>As currently I'm out of office and using a slower notebook, the baseline results for the two above tests are like this now:</p>\n\n<p>For the Java Arrays.sort test</p>\n\n<pre><code>Starting\n0.3590694\n1.6030528 // The time taken to sort the 10,000,000 random numbers\n0.10000905418967532\n</code></pre>\n\n<p>For the Go sort.Float64s test</p>\n\n<pre><code>Go\nStarting\n233.1957ms\n5.4633992s // The time taken to sort the 10,000,000 random numbers\nNumber:  0.10002801819954663\n</code></pre>\n\n<p>And now after modifying the Go test with sort.Slice</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sort\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(\"Starting\")\n    const x = 1000000\n    const y = x * 10\n    var s [y]float64\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n    start1 := time.Now()\n    for i := 0; i &lt; y; i++ {\n        s[i] = r1.Float64()\n    }\n    end1 := time.Since(start1)\n    ss := s[:]\n    start2 := time.Now()\n    sort.Slice(ss, func(i, j int) bool { return ss[i] &lt; ss[j] })\n    end2 := time.Since(start2)\n    fmt.Println(end1)\n    fmt.Println(end2)\n    fmt.Println(\"Number: \", ss[x])\n}\n</code></pre>\n\n<p>The result is a big improvement over sort.Float64s, but still not as good as Java's array sort</p>\n\n<pre><code>Starting\n281.4262ms\n3.6745684s // The time taken to sort the 10,000,000 random numbers\nNumber:  0.10010604106864159\n</code></pre>\n\n<p>And I think someone complained that there is only 1 distribution for the tests (who later removed his comment), I tested for sorting normal distribution of random numbers too (albeit I'd say such a huge performance difference in sorting uniform distribution of random numbers is already quite a bad sign since the algorithms of sorting uniform distribution of random numbers should be quite mature already)</p>\n\n<p>I just replace the random number generator from uniform distribution to normal distribution like this</p>\n\n<p>Go:</p>\n\n<pre><code>s[i] = r1.NormFloat64()\n</code></pre>\n\n<p>Java:</p>\n\n<pre><code>s[i] = gen.nextGaussian();\n</code></pre>\n\n<p>And the result of Java's Arrays.sort method is</p>\n\n<pre><code>Starting\n1.4126348\n1.6118655\n-1.2820310313627319\n</code></pre>\n\n<p>And Go's sort.Slice </p>\n\n<pre><code>Starting\n434.9106ms\n3.8936811s\nNumber:  -1.2818667132095363\n</code></pre>\n\n<p>So Go is sort.Slice is still about twice slower than Java's Arrays.sort, same as for uniform distribution of random numbers. The good thing is that in generating the normal distribution of random numbers, Go is three times faster than Java, compared to about 70% faster in generating uniform distribution of numbers.</p>\n"}, {"tags": ["go", "martini"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 2, "creation_date": 1553083473, "post_id": 55260250, "comment_id": 97251921, "body": "Both <code>app.go</code> &amp; <code>main.go</code> need to be in the same directory which doesn&#39;t seem to be the case since <code>main.go</code> is under the directory <code>controller</code> where <code>app.go</code> isn&#39;t."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553083531, "post_id": 55260250, "comment_id": 97251954, "body": "Which directories are the two files in?"}, {"owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553083669, "post_id": 55260250, "comment_id": 97252034, "body": "@Flimzy I have updated the question in which I have mentioned the structure"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1553083704, "post_id": 55260250, "comment_id": 97252060, "body": "Thanks. The problem is indeed exactly as @Abdullah described. Those two files must be in the same directory to be part of the same package."}, {"owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553083776, "post_id": 55260250, "comment_id": 97252111, "body": "@Flimzy I have put the file in the same hierarchy ,still issue is the same"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1553083820, "post_id": 55260250, "comment_id": 97252137, "body": "Alternatively to the other suggestions, you can <i>export</i> the handlers, import the package where the handlers are defined, and then reference the handlers with the package&#39;s name as the qualifier."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553083837, "post_id": 55260250, "comment_id": 97252150, "body": "@MrugeshThaker hierarchy is not the same as directory."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1553083870, "post_id": 55260250, "comment_id": 97252170, "body": "Please read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1553083872, "post_id": 55260250, "comment_id": 97252171, "body": "@MrugeshThaker What command do you use to run your app?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553083913, "post_id": 55260250, "comment_id": 97252193, "body": "@MrugeshThaker also you should avoid naming all of your packages <code>main</code>."}, {"owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553083920, "post_id": 55260250, "comment_id": 97252197, "body": "@mkopriva I have updated the question for that"}, {"owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1553084011, "post_id": 55260250, "comment_id": 97252259, "body": "@Abdullah go run app.go"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553084077, "post_id": 55260250, "comment_id": 97252297, "body": "@MrugeshThaker that compiles and executes only the app.go file, ignoring the main.go file."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1553084104, "post_id": 55260250, "comment_id": 97252317, "body": "Exactly the problem. Use <code>go run .&#47;...</code> instead."}, {"owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1553084208, "post_id": 55260250, "comment_id": 97252393, "body": "@Abdullah it worked . If you can put it as solution which might help future readers."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553084542, "post_id": 55260250, "comment_id": 97252627, "body": "Whoever told you to run your code via <code>go run</code> did you do a disfavour: Never use go run to run code (except if this is a one-file script). Build your programs with <code>go build</code> and than execute them. If this is too enterprisey: Write yourself a make file which emulates what go build does."}], "answers": [{"tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 3, "last_activity_date": 1553084662, "creation_date": 1553084662, "answer_id": 55260736, "question_id": 55260250, "link": "https://stackoverflow.com/questions/55260250/route-method-becomes-undefined-in-main-package-file/55260736#55260736", "title": "route method becomes undefined in main package file", "body": "<p>There are two problems:</p>\n\n<h3>#1</h3>\n\n<p>You need to have both files in the same directory with the same package name; namely, <code>main</code>.</p>\n\n<h3>#2</h3>\n\n<p>You need to compile and execute all files in this directory which you can do either using:</p>\n\n<ul>\n<li><p><code>go run ./...</code> to execute all files in this directory, or,</p></li>\n<li><p><code>go run app.go main.go</code> to execute just these two files.</p></li>\n</ul>\n\n<hr>\n\n<p>Alternatively, as suggested by @mkopriva, you can move and export all handler functions to a different package, let's call it <code>package handlers</code> and just import this package in your <code>main</code> app.</p>\n"}], "owner": {"reputation": 3481, "user_id": 4588730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10203654780478885/picture?type=large", "display_name": "Mrugesh Thaker", "link": "https://stackoverflow.com/users/4588730/mrugesh-thaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 55260736, "answer_count": 1, "score": -4, "last_activity_date": 1553084662, "creation_date": 1553083114, "last_edit_date": 1553083890, "question_id": 55260250, "link": "https://stackoverflow.com/questions/55260250/route-method-becomes-undefined-in-main-package-file", "title": "route method becomes undefined in main package file", "body": "<p>My code is as shown below :</p>\n\n<p>app.go</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-martini/martini\"\n)\n\nfunc main() {\n    app := martini.Classic()\n\n    app.Group(\"/books\", func(r martini.Router) {\n\n        r.Get(\"/:id\", getBooks)\n        r.Post(\"/new\", newBook)\n        r.Put(\"/update/:id\", updateBook)\n        r.Delete(\"/delete/:id\", deleteBook)\n    })\n\n    app.RunOnAddr(\":8080\")\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport \"github.com/go-martini/martini\"\n\nfunc getBooks() string {\n\n    return \"get books api called\"\n}\n\nfunc newBook() string {\n    return \"Psot book api called\"\n}\n\nfunc updateBook(params martini.Params) string {\n    return \"put api called \" + params[\"id\"]\n}\n\nfunc deleteBook(params martini.Params) string {\n    return \"delete api called \" + params[\"id\"]\n}\n</code></pre>\n\n<p>But somehow when I run the code , it gives me the following error :</p>\n\n<p><code>./app.go:16:17: undefined: getBooks\n./app.go:17:18: undefined: newBook\n./app.go:18:24: undefined: updateBook\n./app.go:19:27: undefined: deleteBook</code></p>\n\n<p>So is there any way to solve this problem? </p>\n\n<p>the project structure is as follows:</p>\n\n<pre><code>goProject\n----&gt;app.go\n----&gt;main.go\n</code></pre>\n"}, {"tags": ["arrays", "go", "multidimensional-array"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1553083242, "creation_date": 1553083242, "answer_id": 55260296, "question_id": 55260106, "link": "https://stackoverflow.com/questions/55260106/how-and-why-does-this-simple-for-loop-using-range-work-for-printing-a-simple-3d/55260296#55260296", "title": "How and why does this SIMPLE For loop using range work for printing a simple 3D array in Go?", "body": "<p>Your code doesn't do what you think it does. You're iterating over the top-level array in each loop. The fact that every array has exactly 2 elements gives you the illusion of success. The failure is more obvious if you print out the values, rather than the indexes (<a href=\"https://play.golang.org/p/ioETiagLh8D\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>var board = [2][2][2]string{\n    {\n        {\"a\", \"b\"},\n        {\"c\", \"d\"},\n    },\n    {\n        {\"e\", \"f\"},\n        {\"g\", \"h\"},\n    },\n}\n\nfor _, rowValue := range board {\n    for _, columnValue := range board {\n        for _, thirdValue := range board {\n            fmt.Println(rowValue, columnValue, thirdValue)\n            fmt.Println()\n        }\n    }\n}\n</code></pre>\n\n<p>What you want is for each inner loop to iterate over the inner array (<a href=\"https://play.golang.org/p/ruwGDQKdYdx\" rel=\"nofollow noreferrer\">playground link</a>):</p>\n\n<pre><code>for _, rowValue := range board {\n    for _, columnValue := range rowValue {\n        for _, thirdValue := range columnValue {\n            fmt.Printf(\"\\t%s\", thirdValue)\n        }\n        fmt.Printf(\"\\n\")\n    }\n    fmt.Printf(\"\\n\\n\")\n}\n</code></pre>\n\n<p>which gives this output:</p>\n\n<pre><code>a   b\nc   d\n\n\ne   f\ng   h\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11231788, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kQXGQxPVqHM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rev9wdJtzJ3d0IQ8GGzWRU4ZXMZwQ/mo/photo.jpg?sz=128", "display_name": "Atlas_Group", "link": "https://stackoverflow.com/users/11231788/atlas-group"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 55260296, "answer_count": 1, "score": -3, "last_activity_date": 1553083242, "creation_date": 1553082611, "last_edit_date": 1553082654, "question_id": 55260106, "link": "https://stackoverflow.com/questions/55260106/how-and-why-does-this-simple-for-loop-using-range-work-for-printing-a-simple-3d", "title": "How and why does this SIMPLE For loop using range work for printing a simple 3D array in Go?", "body": "<p>I tried to use the range function this way to print a board and it just worked, but I can't resolve why ? How is the row, column count interrated over?</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    var board [2][2][2]string\n\n    for row := range board {\n        for column := range board {\n            for third := range board {\n                fmt.Print(row, column, third)\n                fmt.Println()\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["variables", "go", "scope", "stack-trace"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553086815, "post_id": 55260722, "comment_id": 97254067, "body": "Not sure why this was downvoted. It&#39;s short, but it is correct."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1553084623, "creation_date": 1553084623, "answer_id": 55260722, "question_id": 55259572, "link": "https://stackoverflow.com/questions/55259572/is-there-a-way-to-get-the-names-and-values-of-variables-in-scope/55260722#55260722", "title": "Is there a way to get the names and values of variables in scope?", "body": "<blockquote>\n  <p>Is there a way to get the names and values of variables in scope?</p>\n</blockquote>\n\n<p>No.</p>\n"}, {"tags": [], "owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "is_accepted": false, "score": 0, "last_activity_date": 1553136434, "creation_date": 1553136434, "answer_id": 55273047, "question_id": 55259572, "link": "https://stackoverflow.com/questions/55259572/is-there-a-way-to-get-the-names-and-values-of-variables-in-scope/55273047#55273047", "title": "Is there a way to get the names and values of variables in scope?", "body": "<p>Sort of.  You can use github.com/jwells131313/goethe to set thread-local-variables on goethe threads (special threads that have a thread id).   It's sort of frowned upon though.</p>\n"}], "owner": {"reputation": 9, "user_id": 1490466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b66768a7569d15a70b3f86b35a34318?s=128&d=identicon&r=PG", "display_name": "user1490466", "link": "https://stackoverflow.com/users/1490466/user1490466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1553136434, "creation_date": 1553080855, "question_id": 55259572, "link": "https://stackoverflow.com/questions/55259572/is-there-a-way-to-get-the-names-and-values-of-variables-in-scope", "title": "Is there a way to get the names and values of variables in scope?", "body": "<p>I'm trying to write a handler for logger that sends events to sentry.\nI'd like to include as context the variables in scope for easier debugging.\nIs there a way to do this ( short of a WriteHeapDump ) ?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1553077835, "post_id": 55258546, "comment_id": 97248528, "body": "What is a &quot;default case for JSON export&quot;?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1553078119, "post_id": 55258546, "comment_id": 97248686, "body": "@icza I believe they&#39;re talking about the letter case, ie CamelCase vs snake_case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1553078338, "post_id": 55258546, "comment_id": 97248852, "body": "There isn&#39;t a simpler solution. You have to use struct tags."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1553078485, "post_id": 55258546, "comment_id": 97248945, "body": "@Soullivaneuh The <code>encoding&#47;json</code> package doesn&#39;t provide the option the set the default letter-case. The best you could do to avoid writing the tags by hand is to write a program that manipulates the source code and generates the tags for you. The set of packages under <code>go&#47;</code>, e.g. <code>go&#47;ast</code>, <code>go&#47;types</code> can help you with this."}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 0, "creation_date": 1553078719, "post_id": 55258546, "comment_id": 97249071, "body": "Yes, I mean camel case, snake etc... I&#39;m not sure that manipulate the source code will be less cumbersome than writing the tags. I&#39;m quite surprised that a recent language like go does not provide this kind of possibility. Do you know if an issue is opened about this?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1553079246, "post_id": 55258546, "comment_id": 97249372, "body": "I&#39;m not sure whether there are or aren&#39;t open issues regarding an option that allows to set the way the field names are marshaled by default, but I wouldn&#39;t hold my breath if I were you. I know, however, that there do exist 3rd party json packages and maybe they do provide the option you desire, but as I&#39;ve personally never used these packages you&#39;ll have to do the search yourself. Another option would be to fork <code>encoding&#47;json</code>, modify it, and use that fork instead of the std lib, but this clearly has its own downsides."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1553086886, "post_id": 55258546, "comment_id": 97254108, "body": "A custom JSON marshaler could achieve this. It&#39;s non-trivial to implement, but very doable, since all you are doing is changing the default (unnamed) tag-name retrieval."}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 0, "creation_date": 1553087969, "post_id": 55258546, "comment_id": 97254759, "body": "I would indeed avoid to rely on a fork just for that. :-)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553089291, "post_id": 55258546, "comment_id": 97255604, "body": "&quot;I&#39;m quite surprised that a recent language like go does not provide this kind of possibility&quot; - take a look at the reasoning and purpose behind the creation of the language. A key focus on Go is on simplicity and minimal feature set. Catering to every edge case is directly opposed to the goals of the language."}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 1, "creation_date": 1553090902, "post_id": 55258546, "comment_id": 97256725, "body": "Yes, but I especially don&#39;t see the &quot;simplicity&quot; of re-defining each struct field just because we can&#39;t set a case option. There is maybe some reason but I can&#39;t figure out now."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1553082732, "post_id": 55259172, "comment_id": 97251459, "body": "A custom JSON  marshaler could achieve what the OP requires."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1553086914, "post_id": 55259172, "comment_id": 97254122, "body": "@colminator: That doesn&#39;t sound <i>easier</i> than maintaining tags, though :P"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553087167, "post_id": 55259172, "comment_id": 97254261, "body": "@Flimzy correct. But this answer uses the language &quot;there are no opportunities to export&quot; in the format the OP requested. And that statement is clearly false."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1553087238, "post_id": 55259172, "comment_id": 97254309, "body": "The question is clearly about the standard library&#39;s <code>json</code> package. Answering within that context should not require additional qualifiers."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1553087409, "post_id": 55259172, "comment_id": 97254406, "body": "I like to keep people&#39;s options open. When I see &quot;you can&#39;t do that&quot; - I just think &quot;Challenge Accepted!&quot;"}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 1, "creation_date": 1553087888, "post_id": 55259172, "comment_id": 97254696, "body": "I&#39;m not against using an external library for that if necessary, even if it would be better to have this under the root one."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 1, "creation_date": 1553088274, "post_id": 55259172, "comment_id": 97254932, "body": "@Soullivaneuh there are some recent additions to the json package even in the last year e.g. <code>json.Decoder.DisallowUnknownFields</code> - which add new functionality without breaking backward compatibility. So in theory, the go team could add a <code>json.Encoder.CamelCaseTags</code>."}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 1, "creation_date": 1553088412, "post_id": 55259172, "comment_id": 97255022, "body": "I&#39;ll accept the answer as it indeed match the precise question: Can I do this with the native package? And indeed, the proposal was made and refused: <a href=\"https://github.com/golang/go/issues/23027\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/23027</a> I don&#39;t understand why it&#39;s refused, but right."}, {"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1553088452, "post_id": 55259172, "comment_id": 97255039, "body": "@colminator Look at the issue link. Do you think I should try a new one?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1553088699, "post_id": 55259172, "comment_id": 97255213, "body": "Consider the return on investment. I&#39;ve written marshalers/unmarshalers. You will learn <i>A LOT</i> - and more about the reflect pkg than you&#39;d ever care to know. I don&#39;t regret it. But was the effort worth it, for the problem you are trying to solve - that is what you have to ask yourself."}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 1, "last_activity_date": 1553168548, "last_edit_date": 1553168548, "creation_date": 1553079622, "answer_id": 55259172, "question_id": 55258546, "link": "https://stackoverflow.com/questions/55258546/default-case-option-for-go-json-marshal/55259172#55259172", "title": "Default case option for go json marshal?", "body": "<p>Unfortunately there are no opportunities to export your fields into <code>snake_case</code> so you have to maintain tags by yourself.</p>\n\n<p>Technically you can use method <code>MarshalJSON</code> and perform all manipulations inside this method, but it isn't easier way...</p>\n"}, {"comments": [{"owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 0, "creation_date": 1553163037, "post_id": 55263150, "comment_id": 97285940, "body": "Thanks for the addition! Just, I have the feeling to reinvent the wheel like that. :-/"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "reply_to_user": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "edited": false, "score": 0, "creation_date": 1553163728, "post_id": 55263150, "comment_id": 97286304, "body": "@Soullivaneuh You are welcome :) I would call it a hack rather than reinventing the wheel."}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": false, "score": 1, "last_activity_date": 1553092031, "last_edit_date": 1592644375, "creation_date": 1553092031, "answer_id": 55263150, "question_id": 55258546, "link": "https://stackoverflow.com/questions/55258546/default-case-option-for-go-json-marshal/55263150#55263150", "title": "Default case option for go json marshal?", "body": "<p>As mentioned by @Vladimir Kovpak, you can't do this with the standard library, at least at the moment.</p>\n<hr />\n<p>Though, inspired by <a href=\"https://stackoverflow.com/a/46979561/5198756\">this</a>, you can achieve something close to what you want to do. Check out <code>MarshalIndentSnakeCase</code>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func MarshalIndentSnakeCase(v interface{}, prefix, indent string) ([]byte, error) {\n    b, err := json.MarshalIndent(v, prefix, indent)\n    if err != nil {\n        return nil, err\n    }\n\n    x := convertKeys(b) // Here convert all keys from CamelCase to snake_case\n\n    buf := &amp;bytes.Buffer{}\n    err = json.Indent(buf, []byte(x), prefix, indent)\n    if err != nil {\n        return nil, err\n    }\n\n    return buf.Bytes(), nil\n}\n</code></pre>\n<h3>Down Sides:</h3>\n<ul>\n<li>You have to do the same in the opposite direction for Unmashalling to work.</li>\n<li>The order of elements is lost due to using a <code>map</code> inside <code>convertKeys()</code>.</li>\n</ul>\n<hr />\n<p>Try it on <a href=\"https://play.golang.org/p/_jDJQUF1MnJ\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 2024, "user_id": 1731473, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e63f9df521795ecff55b8b769931686f?s=128&d=identicon&r=PG", "display_name": "Soullivaneuh", "link": "https://stackoverflow.com/users/1731473/soullivaneuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 1, "accepted_answer_id": 55259172, "answer_count": 2, "score": 0, "last_activity_date": 1553168548, "creation_date": 1553077691, "last_edit_date": 1553078634, "question_id": 55258546, "link": "https://stackoverflow.com/questions/55258546/default-case-option-for-go-json-marshal", "title": "Default case option for go json marshal?", "body": "<p>I have the following structures to export onto json:</p>\n\n<pre><code>type ExportedIncident struct {\n    Title      string `json:\"title\"`\n    Host       string `json:\"host\"`\n    Status     string `json:\"status\"`\n    Date       string `json:\"date\"`\n    Notes      []ExportedNote `json:\"notes\"`\n    LogEntries []ExportedLogEntry `json:\"log_entries\"`\n}\n</code></pre>\n\n<p>And I want underscore cased fields, so I had to define each field just for that as described in this answer: <a href=\"https://stackoverflow.com/a/11694255/1731473\">https://stackoverflow.com/a/11694255/1731473</a></p>\n\n<p>But it's really cumbersome and I believe there is a simpler solution in Go, but I can't find it.</p>\n\n<p>How can I set default letter-case (underscore, snake, camel...) for JSON export?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553077122, "post_id": 55258333, "comment_id": 97248135, "body": "Try replacing <code>.*</code> with <code>AND</code> in your regexp."}, {"owner": {"reputation": 1634, "user_id": 8180401, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3fed8ee5eeed1edb427e4032cca93de5?s=128&d=identicon&r=PG&f=1", "display_name": "LaSul", "link": "https://stackoverflow.com/users/8180401/lasul"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553077272, "post_id": 55258333, "comment_id": 97248220, "body": "I tried but this is not working.. <a href=\"https://regex101.com/r/RaKxXP/3/\" rel=\"nofollow noreferrer\">regex101.com/r/RaKxXP/3</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1553077375, "post_id": 55258333, "comment_id": 97248275, "body": "My bad, does this work for you? <a href=\"https://regex101.com/r/RaKxXP/4\" rel=\"nofollow noreferrer\">regex101.com/r/RaKxXP/4</a>"}, {"owner": {"reputation": 1634, "user_id": 8180401, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3fed8ee5eeed1edb427e4032cca93de5?s=128&d=identicon&r=PG&f=1", "display_name": "LaSul", "link": "https://stackoverflow.com/users/8180401/lasul"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553077468, "post_id": 55258333, "comment_id": 97248334, "body": "Perfect ! You can post the answer and I will accept it :) Thanks a lot"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553077820, "post_id": 55258333, "comment_id": 97248518, "body": "the existing answers are equally good, if not better, you can go ahead a mark one of them."}, {"owner": {"reputation": 1634, "user_id": 8180401, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3fed8ee5eeed1edb427e4032cca93de5?s=128&d=identicon&r=PG&f=1", "display_name": "LaSul", "link": "https://stackoverflow.com/users/8180401/lasul"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553077942, "post_id": 55258333, "comment_id": 97248591, "body": "You&#39;re a good guy :)"}], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 5, "last_activity_date": 1553077862, "last_edit_date": 1553077862, "creation_date": 1553077496, "answer_id": 55258481, "question_id": 55258333, "link": "https://stackoverflow.com/questions/55258333/how-to-find-and-replace-between-characters/55258481#55258481", "title": "How to find and replace between characters", "body": "<p>You may use a regex like <code>\\([^()]*\\)</code> to match strings inside innermost parentheses and use <a href=\"https://golang.org/pkg/regexp/#Regexp.ReplaceAllStringFunc\" rel=\"noreferrer\"><code>ReplaceAllStringFunc</code></a> to only replace all <code>AND</code> with <code>OR</code> inside the matched texts:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"strings\"\n        \"regexp\"\n)\n\nfunc main() {\n        input := `country == \"BR\" AND (leftHour &gt;= 6 AND rightHour &lt; 24)`\n        r := regexp.MustCompile(`\\([^()]*\\)`)\n        fmt.Println(r.ReplaceAllStringFunc(input, func(m string) string {\n                return strings.ReplaceAll(m, \"AND\", \"OR\")\n        }))\n}\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/sfwQo64R0Dr\" rel=\"noreferrer\">Go demo</a></p>\n\n<p>Note you may replace <code>AND</code> using a second regex:</p>\n\n<pre><code>return regexp.MustCompile(`\\bAND\\b`).ReplaceAllString(m, \"OR\")\n</code></pre>\n\n<p>that will replace <code>AND</code> that are whole words regardless of whether there is a space or not. See <a href=\"https://play.golang.org/p/SwxmOigExpv\" rel=\"noreferrer\">this Go demo</a>.</p>\n"}], "owner": {"reputation": 1634, "user_id": 8180401, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3fed8ee5eeed1edb427e4032cca93de5?s=128&d=identicon&r=PG&f=1", "display_name": "LaSul", "link": "https://stackoverflow.com/users/8180401/lasul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 55258481, "answer_count": 1, "score": 2, "last_activity_date": 1553078052, "creation_date": 1553077019, "last_edit_date": 1553078052, "question_id": 55258333, "link": "https://stackoverflow.com/questions/55258333/how-to-find-and-replace-between-characters", "title": "How to find and replace between characters", "body": "<p>I'm trying to replace the second \"AND\" by \"OR\" in the following string: </p>\n\n<p><code>country == \"BR\" AND (leftHour &gt;= 6 AND rightHour &lt; 24)</code></p>\n\n<p>My strategy is to do this with regex : <code>\\((.*)\\)</code>\nBut this matches all characters between brackets and I just want to match the <code>AND</code>between the two brackets.</p>\n\n<p>In Go would be perfect, but the good regex could suffice.</p>\n\n<p>Edit : The string is not fixed and we can have multiple \"AND\" before like, example : \n<code>currency == \"USD\" AND country == \"BR\" AND (leftHour &gt;= 6 AND rightHour &lt; 24)</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553088245, "post_id": 55258101, "comment_id": 97254913, "body": "Try disabling HTTP2. Per <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">the docs</a>, &quot;For HTTP/2, this currently only controls the number of new connections being created at a time, instead of the total number.&quot; Also review your code; you have some nonsensical settings here, such as <code>MaxIdleConns</code> greater than <code>MaxConns</code>. It would also be useful to know how long &quot;a long time&quot; is, and by how much it is exceeding 50 connections (e.g. having 51 open connections could just be a delay between Go closing a connection  and the OS closing the socket)."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553088507, "post_id": 55258101, "comment_id": 97255079, "body": "30 minutes to be sure, connections go up to 70+. If they are already closed, then <code>netstat</code> would not report them as ESTABLISHED. Also, I&#39;ve already tried setting both the <code>MaxIdleConns</code> and <code>MaxConnsPerHost</code> to 50 to no avail. Anyway, I&#39;ll try disabling HTTP2 and get back to you. Thanks!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553088790, "post_id": 55258101, "comment_id": 97255268, "body": "If they are closed <i>by the OS</i>, netstat would not report them as ESTABLISHED. All Go can do is make a syscall to close the connection, at which point it considers it closed and frees up an available connection per MaxConns. That doesn&#39;t mean the OS has actually closed the socket; it just means that it should, get closed. Typically there is no appreciable delay, but with 500 threads opening and closing connections as fast as the CPU will let them, I wouldn&#39;t be that surprised to detect a discrepancy."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553089188, "post_id": 55258101, "comment_id": 97255526, "body": "I&#39;m wondering why the supposedly 50 initial connections are not totally reused since this is a very busy client. At 500 threads, those 50 connections won&#39;t have enough idle time to be sent back to the idle pool. We actually have an issue in one of our systems where we set the <code>MaxIdleConns</code> and after five days netstat is reporting 1000+ established connections. We seem to experience the same issue as this: <a href=\"https://www.reddit.com/r/golang/comments/9hi208/nethttp_client_high_number_of_established/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/9hi208/&hellip;</a>"}], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 908, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1553076352, "creation_date": 1553076166, "last_edit_date": 1553076352, "question_id": 55258101, "link": "https://stackoverflow.com/questions/55258101/net-http-transport-exceeding-maxconnsperhost", "title": "net/http Transport Exceeding MaxConnsPerHost", "body": "<p>I have a simple program below which is a simple HTTP client and server. I'm testing  if <code>MaxConnsPerHost</code> in <code>http.Transport</code> introduced in <strong>Go 1.11</strong> is working as advertised. However, when I run the code more than 10-30 minutes, the ESTABLISHED connections slowly exceeds the set <code>MaxConnsPerHost</code>. Am I doing something wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n\n    // Server\n    //\n    go func() {\n\n        if err := http.ListenAndServe(\":8081\", http.HandlerFunc(\n            func(w http.ResponseWriter, r *http.Request) {\n                w.Write([]byte(\"hi\"))\n            },\n        )); err != nil {\n            log.Fatal(err)\n        }\n\n    }()\n\n    // Client settings\n    //\n    c := &amp;http.Client{\n        Timeout: 30 * time.Second,\n        Transport: &amp;http.Transport{\n            Proxy: http.ProxyFromEnvironment,\n            DialContext: (&amp;net.Dialer{\n                Timeout:   30 * time.Second,\n                KeepAlive: 30 * time.Second,\n                DualStack: true,\n            }).DialContext,\n            MaxIdleConns:          100,\n            IdleConnTimeout:       90 * time.Second,\n            TLSHandshakeTimeout:   10 * time.Second,\n            ExpectContinueTimeout: 1 * time.Second,\n            MaxConnsPerHost:       50,\n        },\n    }\n\n    // Worker loop\n    //\n    threads := 500\n    for i := 0; i &lt; threads; i++ {\n\n        go func() {\n\n            for {\n\n                req, err := http.NewRequest(\"GET\", \"http://localhost:8081\", nil)\n                if err != nil {\n                    log.Fatal(err)\n                }\n\n                res, err := c.Do(req)\n                if err != nil {\n                    log.Fatal(err)\n                }\n\n                if _, err := ioutil.ReadAll(res.Body); err != nil {\n                    log.Fatal(err)\n                }\n\n                res.Body.Close()\n            }\n\n        }()\n    }\n\n    var done chan bool\n    &lt;-done\n    log.Println(\"Done\")\n\n}\n</code></pre>\n\n<p>After running this for a long time, the ESTABLISHED connections reported by <code>netstat</code> is already exceeding 50.</p>\n\n<p>P.S. We have an in issue in one of our services which horribly leaks ESTABLISHED connections even though we are properly closing the response's Body. It is currently built using <strong>Go 1.10</strong> and I was hoping <strong>Go 1.11</strong> <code>MaxConnsPerHost</code> would be a solution but it seems to also crack under heavy load.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553073672, "post_id": 55257171, "comment_id": 97245997, "body": "Include your Go code. It&#39;s impossible to find a bug we can&#39;t see."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1553076470, "post_id": 55257171, "comment_id": 97247761, "body": "Your working command line example uses <code>nsiId</code>, is this a typo? it should be <code>Id</code>."}, {"owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "edited": false, "score": 0, "creation_date": 1553077663, "post_id": 55257171, "comment_id": 97248437, "body": "yes it should be Id, a typo mistake"}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "is_accepted": false, "score": 0, "last_activity_date": 1553085072, "creation_date": 1553085072, "answer_id": 55260853, "question_id": 55257171, "link": "https://stackoverflow.com/questions/55257171/mongodb-bson-m-query/55260853#55260853", "title": "MongoDB bson.M query", "body": "<p>this worked</p>\n\n<p>query := bson.M{\"allowedNssaiList.allowedSnssaiList.allowedSnssai.sst\": sst, \"allowedNssaiList.allowedSnssaiList.nsiInformationList.nsiId\": nsiId}</p>\n"}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553085072, "creation_date": 1553073247, "last_edit_date": 1553077510, "question_id": 55257171, "link": "https://stackoverflow.com/questions/55257171/mongodb-bson-m-query", "title": "MongoDB bson.M query", "body": "<p>I am trying to query using bison all JSON data in MongoDB with two fields but am getting null as result.</p>\n\n<pre><code>{\n        \"allowedList\": [\n            {\n                \"List\": [\n                    {\n                        \"allow\": {\n                            \"ss\": 1,\n                        },\n                        \"Information\": [\n                            {\n                                \"Id\": \"Id1\"\n                            }\n                        ]\n                    }\n                ]\n            }\n        ]\n        }\n</code></pre>\n\n<p>I was able to filter all using the MongoDB at command line using</p>\n\n<pre><code>    db.slicedb.find({\"allowedList.List.allow.ss\":1,\"allowedList.List.Information.nsiId\":\"Id-Id21\"}) \nbut using \n\nquery := bson.M{\"allowedList.List.allow\": bson.M{\"ss\": sst}, \"allowedList.List.Information\": bson.M{\"Id\": Id}}\n</code></pre>\n\n<p>sst and Id are integer and string input to the query function</p>\n\n<pre><code>err := db.C(COLLECTION).Find(query).All(&amp;specificSlices)\n</code></pre>\n\n<p>but is not working, am getting null even though there are json data that match the two field. Can someone help point out what was wrong with my query? </p>\n\n<p>Server and database config</p>\n\n<pre><code>type SliceDataAccess struct {\n        Server   string\n        Database string\n   }\n\n\n\nvar db *mgo.Database\n\nconst (\n    COLLECTION = \"slicedb\"\n  )\n</code></pre>\n\n<p>Establish a connection to database</p>\n\n<pre><code>func (m *SliceDataAccess) Connect() {\n        session, err := mgo.DialWithTimeout(m.Server, 20*time.Second)\n            if err != nil {\n                log.Fatal(err)\n            }\n            db = session.DB(m.Database)\n        }\n</code></pre>\n\n<p>Structs fields </p>\n\n<pre><code>type InstanceInfo struct {\n     ID     string    `json:\"nfId\" bson:\"_id\"`\n     AllowedList []AllowedNssai `json:\"allowedList\" bson:\"allowedList\"`\n\n   }\n\ntype AllowedNssai struct {\n        List []AllowedSnssai `json:\"List,omitempty\" bson:\"List\"`\n        ...\n     }\n\ntype AllowedSnssai struct {\n      Allow *Snssai `json:\"allow,omitempty\" bson:\"allow\"`\n      Information []NsiInformation `json:\"Information,omitempty\" bson:\"Information\"`\n\n  }\n\ntype NsiInformation struct {\n      Id string `json:\"Id\" bson:\"Id\"`\n   }\n\n\n\n\ntype Snssai struct {\n      Ss int32  `json:\"sst\" bson:\"ss\"`\n\n   }\n</code></pre>\n\n<p>Query function defined</p>\n\n<pre><code>func (m *SliceDataAccess) FindAll(sst int32, nsiId string ([]InstanceInfo, error) {\nvar specificSlices []InstanceInfo\n\nquery := bson.M{\"allowedList.List.allow\": bson.M{\"ss\": sst}, \"allowedList.List.Information\": bson.M{\"Id\": nsiId}}\n\nerr := db.C(COLLECTION).Find(query).All(&amp;specificSlices)\nif err != nil {\n       return specificSlices, err\n       }\n        return specificSlices, nil\n     }\n</code></pre>\n\n<p>HTTP handler function for request and response</p>\n\n<pre><code>func AvailabilityGet(w http.ResponseWriter, r *http.Request) \n            var slice InstanceInfo\n            err := json.NewDecoder(r.Body).Decode(&amp;slice)\n            if err != nil {\n                respondWithError(w, http.StatusBadRequest, \"Object body not well decoded\")\n                return\n            }\n            sst := slice.AllowedList[0].List[0].Allow.Sst\n            nsiId := slice.AllowedList[0].List[0].Information[0].Id\n\n            specificSlices, err := da.FindAll(sst, nsiId)\n\n            json.NewEncoder(w).Encode(specificSlices)\n        }\n</code></pre>\n\n<p>Attached is my the full go code i have done. </p>\n"}, {"tags": ["json", "go", "hash", "cryptography"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1553070654, "post_id": 55256365, "comment_id": 97244401, "body": "You should be able to preserve the order if you avoid using <code>map</code>s."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553070713, "post_id": 55256365, "comment_id": 97244422, "body": "so if I marshal and unmarshal and marshal again it will produce the same order? I&#39;ll test"}, {"owner": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 0, "creation_date": 1553070874, "post_id": 55256365, "comment_id": 97244510, "body": "which version of go are you using?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553070957, "post_id": 55256365, "comment_id": 97244537, "body": "@mkopriva Output is deterministic even if you use maps: <i>&quot;The map keys are sorted and used as JSON object keys...&quot;</i> So all in all, output should be deterministic if you don&#39;t use custom marshaler in which you screw up the order."}, {"owner": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1553071035, "post_id": 55256365, "comment_id": 97244573, "body": "@icza IFAK starting from Go 1.12+(map value and it will be sorted by key automatically)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1553071347, "post_id": 55256365, "comment_id": 97244717, "body": "@icza however what about the case where they are first unmarshaling something into a map and then marshaling that map back to json later, the output of the marshaling would not be guaranteed to be the same as the input to the unmarshaling, say in a case where the original input&#39;s keys aren&#39;t sorted. Not sure if that&#39;s the case where OP is seeing the inconsistency of the order though."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553071432, "post_id": 55256365, "comment_id": 97244763, "body": "@mkopriva Yes, that&#39;s true. Unmarshaling and marshaling again might be different. What I&#39;m saying is that marshaling only with <code>encoding&#47;json</code>, the output will be deterministic / same. At least if the same Go version is used."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1553071499, "post_id": 55256365, "comment_id": 97244805, "body": "@icza ok, got it. Thanks"}, {"owner": {"reputation": 30237, "user_id": 6371459, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0DDLp.jpg?s=128&g=1", "display_name": "pedrofb", "link": "https://stackoverflow.com/users/6371459/pedrofb"}, "edited": false, "score": 7, "creation_date": 1553072807, "post_id": 55256365, "comment_id": 97245492, "body": "To verify a signed message you do not need to perform the unmarshall. The signature is made on the JSON string encoded in base64url, and the verification is done directly on the base64. Only if the verification is correct the message is decoded and the unmarshall performed. This is how JWS (Json Web Signature) standard works. Once validated, the order of the nodes is not significant"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1553080595, "post_id": 55256365, "comment_id": 97250201, "body": "Yes, and since signature signing / verification <i>includes</i> hashing the message, you might as well follow that idea. That has been tested well and it&#39;s nicely symmetric with signing. Just replace the signature with the hash value. You might simply look up an existing signing application and skip the signature calculation: just base 64 the hash instead."}], "answers": [{"tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": false, "score": 2, "last_activity_date": 1554952774, "creation_date": 1554952774, "answer_id": 55624198, "question_id": 55256365, "link": "https://stackoverflow.com/questions/55256365/how-to-obtain-same-hash-from-json/55624198#55624198", "title": "How to obtain same hash from json", "body": "<p>JOSE JWS will absolutely do what you want at the cost of having to manage keys for signatures and verification.</p>\n\n<p>But let's assume that you don't really need the whole key management stuff and general crypto functionality in JOSE and you're not SUPER concerned about performance (so a little string mangling in this process is OK).</p>\n\n<p>You could dumbly unmarshal your JSON and re-marshal it, then just hash that:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha256\"\n    \"encoding/hex\"\n    \"fmt\"\n    json \"encoding/json\"\n)\n\n// NB These docs are strictly-speaking the same.\nconst DOCA = \"{ \\\"foo\\\": 1.23e1, \\\"bar\\\": { \\\"baz\\\": true, \\\"abc\\\": 12 } }\"\nconst DOCB = \"{ \\\"bar\\\": { \\\"abc\\\": 12, \\\"baz\\\": true }, \\\"foo\\\": 12.3 }\"\n\nfunc hash(doc string) string {\n    // Dumb af, but it's a cheap way to specific the most generic thing\n    // you can :-/\n    var v interface{}\n    json.Unmarshal([]byte(doc), &amp;v) // NB: You should handle errors :-/\n    cdoc, _ := json.Marshal(v)\n    sum := sha256.Sum256(cdoc)\n    return hex.EncodeToString(sum[0:])\n}\n\nfunc main() {\n    fmt.Println(DOCA)\n    fmt.Printf(\"Hash: %s\\n\", hash(DOCA))\n    fmt.Println(DOCB)\n    fmt.Printf(\"Hash: %s\\n\", hash(DOCB))\n}\n</code></pre>\n\n<p>The output of this program (at least in the golang docker container) is:</p>\n\n<pre><code>{ \"foo\": 1.23e1, \"bar\": { \"baz\": true, \"abc\": 12 } }\nHash: d50756fbb830f8335187a3f427603944c566772365d8d8e6f6760cd2868c8a73\n{ \"bar\": { \"abc\": 12, \"baz\": true }, \"foo\": 12.3 }\nHash: d50756fbb830f8335187a3f427603944c566772365d8d8e6f6760cd2868c8a73\n</code></pre>\n\n<p>The nice thing about this approach is that, for the cost of some performance, you get insulated from whatever dumb junk you did while marshalling your JSON in the first place (so, unlike other suggestions, you don't have to think about what you might be doing with custom Marshallers and whatnot).  This is especially a big deal when you forget that this was an issue at all in version 3.8 of your code a year from now, implement something that messes with the marshal order, and start breaking things.</p>\n\n<p>And, of course, you could always add the hash to the resulting struct and marshal again with the extra item in the map.  Obviously you want to optimize a bit for performance if you're worried about it at all and properly handle errors, but this is a good prototype anyway :-)</p>\n\n<p>Oh, and if you're super-worried about edge cases biting you, you could also use <a href=\"https://github.com/gibson042/canonicaljson-go\" rel=\"nofollow noreferrer\">canonical JSON</a> to marshal, since it's specifically designed for this type of use (though, honestly, I couldn't come up with an example in my testing where c-json worked but go's default json didn't).</p>\n"}], "owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1554952774, "creation_date": 1553070387, "last_edit_date": 1553070456, "question_id": 55256365, "link": "https://stackoverflow.com/questions/55256365/how-to-obtain-same-hash-from-json", "title": "How to obtain same hash from json", "body": "<p>I need to sign a JSON but I noticed that unmarshaling/marshaling can change JSON's order which might make the signature invalid.</p>\n\n<p>Is there anyway to produce the same hash from a JSON string despite its order?</p>\n\n<p>I've had a look at JOSE but couldn't find the function that actually hashes JSON.</p>\n"}, {"tags": ["go", "cryptography", "ecdsa"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1553070733, "post_id": 55256246, "comment_id": 97244433, "body": "There is no error, therefore <code>err.Error()</code> is a nil-pointer dereference."}, {"owner": {"reputation": 48, "user_id": 6901586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cecf942eb33ce02b684adbe6fba097d?s=128&d=identicon&r=PG&f=1", "display_name": "user6901586", "link": "https://stackoverflow.com/users/6901586/user6901586"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1553080473, "post_id": 55256246, "comment_id": 97250134, "body": "thanks @Peter that was it"}], "answers": [{"comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1553122211, "post_id": 55257641, "comment_id": 97273738, "body": "Ouch, terrible API design. Now that&#39;s an NPE waiting to happen."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 2, "last_activity_date": 1553074728, "creation_date": 1553074728, "answer_id": 55257641, "question_id": 55256246, "link": "https://stackoverflow.com/questions/55256246/unable-to-parse-ecdsa-key-with-go-x509-pkg/55257641#55257641", "title": "Unable to parse ECDSA key with Go X509 pkg", "body": "<p>add error check.</p>\n\n<pre><code>func main() {\n    blk, _ := pem.Decode([]byte(b))\n    key, err := x509.ParseECPrivateKey(blk.Bytes)\n    if err != nil {\n        fmt.Println((err.Error()))\n    }\n\n    fmt.Println(key)\n}\n</code></pre>\n"}], "owner": {"reputation": 48, "user_id": 6901586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cecf942eb33ce02b684adbe6fba097d?s=128&d=identicon&r=PG&f=1", "display_name": "user6901586", "link": "https://stackoverflow.com/users/6901586/user6901586"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 55257641, "answer_count": 1, "score": 0, "last_activity_date": 1553074728, "creation_date": 1553069876, "last_edit_date": 1553070775, "question_id": 55256246, "link": "https://stackoverflow.com/questions/55256246/unable-to-parse-ecdsa-key-with-go-x509-pkg", "title": "Unable to parse ECDSA key with Go X509 pkg", "body": "<p>I'm trying to parse an ECDSA secp384r1 curve key using Go's crypto/x509 package using the following code (<a href=\"https://play.golang.org/p/opFLBMaKhDv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/opFLBMaKhDv</a>):</p>\n\n<pre><code>import (\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n)\n\nvar b = `-----BEGIN EC PRIVATE KEY-----\nMIGkAgEBBDBsee4GAKz9Jo603xmGZ0uYEbJAoUgNqCYjDiLfj6zG4fvVSiCVxoTx\nrVcvW2lmVcmgBwYFK4EEACKhZANiAATm6yBej3NVXnXAydMdLvrIB0PMr/fT6VCD\nMB2pXzqxbQs8tYt3Rqd0HnzAZyYb1KhOX5lG0MyBDohhPRXqWE3gMhEq47BdzC7G\ngEftttcFKXX/PSxsZUDL6GiliaB0/9E=\n-----END EC PRIVATE KEY-----`\n\nfunc main() {\n    blk, _ := pem.Decode([]byte(b))\n    _, err := x509.ParseECPrivateKey(blk.Bytes)\n    fmt.Println((err.Error()))\n}\n</code></pre>\n\n<p>but hitting the following panic </p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x10e9366]\n</code></pre>\n\n<p>Can someone pls tell me what i'm doing wrong here?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "edited": false, "score": 0, "creation_date": 1553083764, "post_id": 55255851, "comment_id": 97252099, "body": "The gorilla websocket code works for me, I get the expected close code in the client. You call <code>Upgrade(w, r)</code>, but the proper signature in (latest) gorilla is <code>Upgrade(http.ResponseWriter, *http.Request, http.Header)</code>, typo in example or are you using some old gorilla version?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1553091589, "post_id": 55255851, "comment_id": 97257233, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  In particular, show the code for <code>Upgrade</code>"}, {"owner": {"reputation": 2017, "user_id": 2213958, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1936f3ddfc25fdb2c9e286823e091dd1?s=128&d=identicon&r=PG", "display_name": "yountae.kang", "link": "https://stackoverflow.com/users/2213958/yountae-kang"}, "reply_to_user": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "edited": false, "score": 0, "creation_date": 1553130765, "post_id": 55255851, "comment_id": 97275883, "body": "@johlo I added my Upgrade function. Is it because nil header? I used codes from this example <a href=\"https://github.com/gorilla/websocket/blob/master/examples/chat/client.go\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket/blob/master/examples/chat/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2017, "user_id": 2213958, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1936f3ddfc25fdb2c9e286823e091dd1?s=128&d=identicon&r=PG", "display_name": "yountae.kang", "link": "https://stackoverflow.com/users/2213958/yountae-kang"}, "is_accepted": false, "score": 0, "last_activity_date": 1553221707, "creation_date": 1553221707, "answer_id": 55292032, "question_id": 55255851, "link": "https://stackoverflow.com/questions/55255851/websocket-write-close-message-always-send-1006/55292032#55292032", "title": "websocket Write Close Message always send 1006", "body": "<p>This is all because the \"Sleep\"</p>\n\n<pre><code>//time.Sleep(10*time.Second)\nconn.Close()\n</code></pre>\n\n<p>After removing Sleep, The code works fine.</p>\n"}], "owner": {"reputation": 2017, "user_id": 2213958, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1936f3ddfc25fdb2c9e286823e091dd1?s=128&d=identicon&r=PG", "display_name": "yountae.kang", "link": "https://stackoverflow.com/users/2213958/yountae-kang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 243, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553221707, "creation_date": 1553068318, "last_edit_date": 1553131162, "question_id": 55255851, "link": "https://stackoverflow.com/questions/55255851/websocket-write-close-message-always-send-1006", "title": "websocket Write Close Message always send 1006", "body": "<p>I want to send close code to client, but It is always 1006.</p>\n\n<p>I tried,</p>\n\n<pre><code>func ServeWs(w http.ResponseWriter, r *http.Request) {\n    conn := Upgrade(w, r)\n    msg := websocket.FormatCloseMessage(4001, \"myError\")\n    // case 1\n    conn.WriteMessage(websocket.CloseMessage, msg)\n\n    // case 2\n    //conn.WriteControl(websocket.CloseMessage, msg, time.Now().Add(time.Second))\n\n    // case 3\n    //w, err := conn.NextWriter(websocket.CloseMessage)\n    //if err != nil {\n    //  return\n    //}\n    //if _, err = w.Write(msg); err != nil {\n    //  log.Println(err)\n    //}\n    //w.Close()\n\n    time.Sleep(10*time.Second)\n    conn.Close()\n}\n\nfunc Upgrade(w http.ResponseWriter, r *http.Request) *websocket.Conn{\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Println(err)\n        return nil\n    }\n    return conn\n}\n</code></pre>\n\n<p>But Not worked all these cases. How can I send except 1006 to client?</p>\n\n<p>I also tested Node js ws package to verify client's. </p>\n\n<pre><code>const WebSocket = require('ws');\n\nconst ws = new WebSocket.Server({ port: 8088 });\n\nws.on('connection', function connection(ws) {\n  ws.close(1000, 'bac');\n});\n</code></pre>\n\n<p>This javascript codes worked fine.</p>\n\n<p>=== Added ===</p>\n\n<p>Client Codes for testing. In chrome dev tool console, paste below</p>\n\n<pre><code>conn = new WebSocket(\"ws://127.0.0.1:8088/connect\"); conn.onclose = function(evt){console.log(\"do\", evt);}; conn.onerror = function(err){console.log(\"err\", err);}; conn.onmessage = function(msg){console.log(\"msg\", msg);};\n</code></pre>\n"}, {"tags": ["go", "artifactory", "jfrog-cli", "go-modules"], "comments": [{"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 0, "creation_date": 1553190155, "post_id": 55254524, "comment_id": 97302439, "body": "Try running <code>jfrog rt go &quot;build .&#47;...&quot; --no-registry</code> (with build and <code>.&#47;...</code>) in quotes. That seems to work on my machine (after removing my local package cache I can see the modules being downloaded from GitHub)"}, {"owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "reply_to_user": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 0, "creation_date": 1553233020, "post_id": 55254524, "comment_id": 97315553, "body": "Ha! That worked, thanks. If you make it an answer, I&#39;ll accept it"}], "answers": [{"comments": [{"owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "edited": false, "score": 0, "creation_date": 1553468493, "post_id": 55303058, "comment_id": 97384525, "body": "strange though that you can&#39;t do <code>jfrog rt go &quot;build .&#47;...&quot;</code>"}, {"owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "edited": false, "score": 0, "creation_date": 1553469103, "post_id": 55303058, "comment_id": 97384657, "body": "I mean <code>jfrog rt go &quot;build .&#47;...&quot; --no-registry</code> works for me but <code>jfrog rt go &quot;build .&#47;...&quot;</code> doesn&#39;t"}], "tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": true, "score": 0, "last_activity_date": 1553268766, "creation_date": 1553268766, "answer_id": 55303058, "question_id": 55254524, "link": "https://stackoverflow.com/questions/55254524/jfrog-go-commands-with-parameters/55303058#55303058", "title": "jfrog go commands with parameters", "body": "<p>Can you run <code>jfrog rt go \"build ./...\" --no-registry</code> (with <code>build</code> and <code>./...</code>) in quotes. That seems to work on my machine (after removing my local package cache I can see the modules being downloaded from GitHub).</p>\n"}], "owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 55303058, "answer_count": 1, "score": 1, "last_activity_date": 1553268766, "creation_date": 1553062163, "question_id": 55254524, "link": "https://stackoverflow.com/questions/55254524/jfrog-go-commands-with-parameters", "title": "jfrog go commands with parameters", "body": "<p><a href=\"https://jfrog.com/blog/goproxy-artifactory-go-registries/\" rel=\"nofollow noreferrer\">Documentation</a> suggests to build a project with <code>jfrog rt go build --no-registry</code>. We are using go modules and the command fails on recognising current module - <code>can't load package: package  unknown import path cannot find module providing package</code>, same as <code>go build</code> does. </p>\n\n<p><code>go build ./...</code> does work though but I can't do <code>jfrog rt go build ./.. --no-registry</code>. Does <code>jfrog rt go build --no-registry</code> do anything else apart from calling <code>go build</code> anyway? Is there a way to pass the parameters?</p>\n"}, {"tags": ["go", "artifactory", "jfrog-cli"], "answers": [{"comments": [{"owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "edited": false, "score": 0, "creation_date": 1553469249, "post_id": 55268356, "comment_id": 97384680, "body": "Thanks! I&#39;m still confused by the workflow suggested by the documentation. This part ` Since the package\u2019s modules are not yet available in Artifactory, to resolve dependencies through Artifactory, you need to use the \u2018no-registry\u2019 flag in order to get the dependencies sources from GitHub and let Go create modules from them.` seems to be implying that you can&#39;t use artifactory as a proxy."}, {"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "reply_to_user": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "edited": false, "score": 1, "creation_date": 1553476077, "post_id": 55268356, "comment_id": 97385862, "body": "I get your point and I think we need to improve our docs a bit to explain that more clearly. It all depends on which command you use to build your Go app. If you do not use the JFrog CLI, and set the GOPROXY to your Artifactory URL, Artifactory will be used as a proxy. If you use the JFrog CLI and use the <code>--no-registry</code> flag, it will bypass Artifactory completely and thus not cache the modules."}, {"owner": {"reputation": 3528, "user_id": 57776, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8EIEK.jpg?s=128&g=1", "display_name": "Matthew Olenik", "link": "https://stackoverflow.com/users/57776/matthew-olenik"}, "edited": false, "score": 1, "creation_date": 1565214872, "post_id": 55268356, "comment_id": 101287004, "body": "@retgits this does not answer the question! The link you have in #1 is expressly the opposite -- it makes NO mention of GOPROXY at all, instead it explicitly tells you to use the JFrog CLI, which is precisely what we are trying to avoid. If you simply set GOPROXY and use the Go tools alone, you&#39;ll always get a 400 bad request."}, {"owner": {"reputation": 535, "user_id": 546757, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/3e1a3747e45df2c6e79c5029b4947c24?s=128&d=identicon&r=PG", "display_name": "Alan Cabrera", "link": "https://stackoverflow.com/users/546757/alan-cabrera"}, "reply_to_user": {"reputation": 3528, "user_id": 57776, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8EIEK.jpg?s=128&g=1", "display_name": "Matthew Olenik", "link": "https://stackoverflow.com/users/57776/matthew-olenik"}, "edited": false, "score": 0, "creation_date": 1605197835, "post_id": 55268356, "comment_id": 114583146, "body": "I&#39;m running into the same problems @MatthewOlenik is."}], "tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": true, "score": 1, "last_activity_date": 1553108499, "creation_date": 1553108499, "answer_id": 55268356, "question_id": 55254279, "link": "https://stackoverflow.com/questions/55254279/remote-repository-for-a-go-project-in-artifactory-doesnt-proxy/55268356#55268356", "title": "Remote repository for a go project in Artifactory doesn&#39;t proxy?", "body": "<p>I understand your confusion on the blog post you mentioned, though I have a feeling the intent of the writer was to more show how the JFrog CLI can be used.</p>\n\n<p>To answer your questions:</p>\n\n<p>1) Yes, you don't have to use the JFrog CLI to build. Please check out <a href=\"https://www.jfrog.com/confluence/display/RTF/Go+Registry#GoRegistry-RemoteRepositories\" rel=\"nofollow noreferrer\">the documentation on how to set up a remote repository</a> for Go. This will guide you through setting up GitHub or <a href=\"https://gocenter.io\" rel=\"nofollow noreferrer\">GoCenter</a> as a remote repository for your Go builds. This will allow you to set the GOPROXY environment variable following this structure <code>&lt;protocol&gt;://&lt;username&gt;:&lt;password&gt;@&lt;artifactory domain&gt;/api/go/&lt;go repository&gt;</code>.</p>\n\n<p>2) Remote repositories will absolutely act as a proxy, caching the contents you download from the remote repository (copying a part from the <a href=\"https://www.jfrog.com/confluence/display/RTF/Go+Registry#GoRegistry-RemoteRepositories\" rel=\"nofollow noreferrer\">user guide</a>: <code>A remote Go repository in Artifactory serves as a caching proxy for a public Go registry such as GoCenter or GitHub.</code>)</p>\n"}], "owner": {"reputation": 916, "user_id": 1398455, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/81cbdaad02093504d3e4ac0a1e87a286?s=128&d=identicon&r=PG", "display_name": "Leo", "link": "https://stackoverflow.com/users/1398455/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 0, "accepted_answer_id": 55268356, "answer_count": 1, "score": 1, "last_activity_date": 1553108499, "creation_date": 1553060815, "question_id": 55254279, "link": "https://stackoverflow.com/questions/55254279/remote-repository-for-a-go-project-in-artifactory-doesnt-proxy", "title": "Remote repository for a go project in Artifactory doesn&#39;t proxy?", "body": "<p>I'm trying to understand how to work with a remote repository in Artifactory for a Go project. My initial expectation was that it'll work transparently,  all I would need to do is to point <code>GORPOXY</code> variable to a virtual repository (with local and remote behind it), do <code>go build</code> and dependencies will either be downloaded from the Artifactory cache or Artifactory would download them transparently. Similar to the way it works for maven dependencies.</p>\n\n<p>When I tried that, it complained that the dependencies weren't found in artifactory. Ok.</p>\n\n<p>Reading <a href=\"https://jfrog.com/blog/goproxy-artifactory-go-registries/\" rel=\"nofollow noreferrer\">the documentation</a> two things stand out. First, there's nothing there about <code>GOPROXY</code> and everything is about using artifactory cli. That's a big downside for several reasons.\nSecond, is that you need to publish dependencies manually with <code>jfrog rt go-publish go --self=false --deps=ALL</code> and then dependencies appear under a local repository. </p>\n\n<p>So I'm trying to figure out if 1) I can avoid using JFrog CLI and 2) what's the point of remote repositories if they don't proxy? Or maybe I'm missing something?</p>\n\n<p>Artifactory 6.3.0</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1553065050, "post_id": 55254054, "comment_id": 97242015, "body": "try <code>&#47;workspace&#47;util</code> =&gt; <code>..&#47;..&#47;util</code>"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1553066319, "post_id": 55254054, "comment_id": 97242514, "body": "@beiping96 I tried that but the folder became <code>&#47;util&#47;go.mod</code> I guess this is because of the <code>PROJECT_ROOT=${REPO_NAME}</code> env in the cloudbuild config"}], "answers": [{"tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 0, "last_activity_date": 1553087077, "creation_date": 1553087077, "answer_id": 55261425, "question_id": 55254054, "link": "https://stackoverflow.com/questions/55254054/failed-using-replace-directive-in-gcp-cloudbuild/55261425#55261425", "title": "Failed using `replace` directive in gcp cloudbuild", "body": "<p>I managed to get it working by using <code>vendor</code> and omitting <code>go.mod</code> and <code>go.sum</code> in serverless package (by using package.exclude).</p>\n\n<p>Here's my updated <code>cloudbuild.yaml</code>:</p>\n\n<pre><code>steps:\n- name: 'gcr.io/cloud-builders/npm'\n  args: ['install']\n- name: 'gcr.io/cloud-builders/go'\n  dir: 'api/giam'\n  args: ['mod', 'edit', '-replace', 'bitbucket.org/myusername/mybackend/util=/workspace/util']\n  env: ['GOPATH=/src', 'GO111MODULE=on']\n- name: 'gcr.io/cloud-builders/go'\n  dir: 'api/giam'\n  args: ['mod', 'vendor']\n  env: ['GOPATH=/src', 'GO111MODULE=on']\n- name: 'softinstigate/serverless'\n  args: ['deploy', '-v']\n  dir: 'api/giam'\n  env: ['GOPATH=/src', 'GO111MODULE=on']\n</code></pre>\n\n<p>and my <code>go.mod</code>:</p>\n\n<pre><code>module mybackend\n\nrequire (\n    bitbucket.org/myusername/mybackend/util v0.0.0\n    google.golang.org/api v0.2.1-0.20190318183801-2dc3ad4d67ba\n)\n\nreplace bitbucket.org/myusername/mybackend/util =&gt; ../../util\n</code></pre>\n\n<p>as per github issue in <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/issues/743\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/issues/743</a>,\nit says that you need to exclude go.mod and go.sum in the deployment, otherwise the vendor won't be used. That's why in <code>serverless.yml</code> I use:</p>\n\n<pre><code>package:\n  exclude:\n    - ./**\n  include:\n    - vendor/**\n    - '*.go'\n</code></pre>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 55261425, "answer_count": 1, "score": 1, "last_activity_date": 1553090963, "creation_date": 1553059532, "last_edit_date": 1592644375, "question_id": 55254054, "link": "https://stackoverflow.com/questions/55254054/failed-using-replace-directive-in-gcp-cloudbuild", "title": "Failed using `replace` directive in gcp cloudbuild", "body": "<p>I'm trying to build my go application using <code>serverless framework</code> in cloudbuild.</p>\n<p>Here's my project structure</p>\n<pre><code>/api\n   /giam\n      go.mod\n      API.go\n   /other_folders...\n/util\n   go.mod\n   util.go\n\n</code></pre>\n<p>Here's my build steps:</p>\n<pre><code>steps:\n- name: 'gcr.io/cloud-builders/npm'\n  args: ['install']\n- name: 'softinstigate/serverless'\n  args: ['deploy', '-v']\n  dir: 'api/giam'\n  env: ['PROJECT_ROOT=${REPO_NAME}', 'GO111MODULE=on']\n</code></pre>\n<p>and here's my <code>go.mod</code> in <code>api/giam</code></p>\n<pre><code>module mybackend\n\nrequire bitbucket.org/myusername/mybackend/util v0.0.0\n\nreplace bitbucket.org/myusername/mybackend/util =&gt; /workspace/util\n</code></pre>\n<p>and I confirmed that I have a <code>go.mod</code> in my <code>util</code> folder.</p>\n<p>and here's the content</p>\n<pre><code>module util\n\nrequire cloud.google.com/go v0.37.1\n</code></pre>\n<h3>The error</h3>\n<p>I got this error while running the cloudbuild..</p>\n<pre><code>{&quot;ResourceType&quot;:&quot;cloudfunctions.v1beta2.function&quot;,&quot;ResourceErrorCode&quot;:&quot;400&quot;,&quot;ResourceErrorMessage&quot;:&quot;Build failed: go: parsing util/go.mod: open /workspace/util/go.mod: no such file or directory\\ngo: error loading module requirements\\n&quot;}\n</code></pre>\n<p>if I got this right, the error is that it cannot find the <code>/workspace/util/go.mod</code></p>\n<p>I tried <code>ls</code> in the cloudbuild, specifically in <code>/workspace/util</code> and I found the <code>go.mod</code> file.</p>\n<p>I'm pretty stuck here.. I don't know what to do next..</p>\n"}, {"tags": ["json", "go", "openpgp"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553088597, "post_id": 55254423, "comment_id": 97255142, "body": "The &quot;somehow&quot; would be: making the value you provide conform to the format expected for a key."}, {"owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553092328, "post_id": 55254423, "comment_id": 97257751, "body": "But I do type conversion. Also when it reads from json it still reads as text."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1553097460, "post_id": 55254423, "comment_id": 97261567, "body": "I&#39;m not saying it&#39;s not the right variable type or that it isn&#39;t text. The format expected for a key includes two newlines after the header, you had one. Your answer says the change &quot;fixed it somehow&quot; as if it were a mystery, but in fact you&#39;ve just corrected your input data to match the specified format for that data. You can find more information on the expected data format in <a href=\"https://tools.ietf.org/html/rfc4880#section-7\" rel=\"nofollow noreferrer\">RFC4880, Section 7</a>."}, {"owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553122084, "post_id": 55254423, "comment_id": 97273715, "body": "I see, thanks a lot for clearing that up. It never occurred to me that not having the extra line could invalidate the entire key."}], "tags": [], "owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "is_accepted": true, "score": 1, "last_activity_date": 1553122131, "last_edit_date": 1553122131, "creation_date": 1553061567, "answer_id": 55254423, "question_id": 55253937, "link": "https://stackoverflow.com/questions/55253937/eof-error-while-reading-pgp-keys-from-json-golang/55254423#55254423", "title": "EOF error while reading PGP keys from JSON Golang", "body": "<p>I found a solution to this while randomly trying stuff, and I am as surprised as you (future answer reader) are. If someone can provide an explanation, I'd be thankful.</p>\n\n<p>I was storing the keys in JSON by replacing all newlines with \"\\n\" so that I can store it in a single line. You know how PGP keys have an empty line right after <code>-----BEGIN PGP PUBLIC KEY BLOCK-----</code>? Well, in my file, I had something like </p>\n\n<pre><code>\"publicKeys\": {\n    \"Flex\": \"-----BEGIN PGP PUBLIC KEY BLOCK-----\\nQfdsf....\"\n}\n</code></pre>\n\n<p>Adding that extra empty line, i.e. changing it to </p>\n\n<pre><code>\"publicKeys\": {\n    \"Flex\": \"-----BEGIN PGP PUBLIC KEY BLOCK-----\\n\\nQfdsf....\"\n}\n</code></pre>\n\n<p><strong>EDIT:</strong> As @Adrian mentioned in the comments, this was because it's an invalid PGP key if the line isn't there anymore according to the RFC spec. This is how it should be.</p>\n"}], "owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 55254423, "answer_count": 1, "score": 1, "last_activity_date": 1553122131, "creation_date": 1553058784, "question_id": 55253937, "link": "https://stackoverflow.com/questions/55253937/eof-error-while-reading-pgp-keys-from-json-golang", "title": "EOF error while reading PGP keys from JSON Golang", "body": "<p>I'm developing an API using Golang, and I have a JSON file <code>keys.json</code> as follows:</p>\n\n<pre><code>{\n  \"publicKeys\": {\n    \"Flex\": \"&lt;valid pgp public key&gt;\",\n    \"Flex2\": \"&lt;valid pgp public key&gt;\"\n  },\n  \"privateKey\": \"&lt;valid pgp private key&gt;\"\n}\n\n</code></pre>\n\n<p>To unmarshal this, I have the following model</p>\n\n<pre><code>type PGPKeys struct {\n    PublicKeys map[string]string `json:\"publicKeys\"`\n    PrivateKey string            `json:\"privateKey\"`\n}\n</code></pre>\n\n<p>and I unmarshal the code using </p>\n\n<pre><code>keysJSONFile, err := os.Open(keysPath)\n    if keysJSONFile != nil {\n        defer keysJSONFile.Close()\n    }\n    if err != nil {\n        return nil, err\n    }\n\n    keysJSONBytes, err := ioutil.ReadAll(keysJSONFile)\n    if err != nil {\n        return nil, err\n    }\n\n    var pgpKeys PGPKeys\n    err = json.Unmarshal(keysJSONBytes, &amp;pgpKeys)\n    if err != nil {\n        return nil, err\n    }\n</code></pre>\n\n<p>Later, when I use <code>openpgp</code> to get the public key packet, I am met with <code>EOF</code> error which <code>armor.Decode</code> returns when it's unable to find any blocks -- but I'm not sure why it's happening</p>\n\n<pre><code>func GetPublicKeyPacket(publicKey []byte) (*packet.PublicKey, error) {\n    publicKeyReader := bytes.NewReader(publicKey)\n    block, err := armor.Decode(publicKeyReader)\n    if err != nil {\n        return nil, err\n    }\n\n    if block.Type != openpgp.PublicKeyType {\n        return nil, errors.New(\"Invalid public key data\")\n    }\n\n    packetReader := packet.NewReader(block.Body)\n    pkt, err := packetReader.Next()\n    if err != nil {\n        return nil, err\n    }\n\n    key, ok := pkt.(*packet.PublicKey)\n    if !ok {\n        return nil, err\n    }\n    return key, nil\n}\n</code></pre>\n\n<p><strong>NOTE:</strong> When I call the function, I do type conversion using something like</p>\n\n<pre><code>publicKeyPacket, err := pgp.GetPublicKeyPacket([]byte(h.PGPKeys.PublicKeys[h.Config.PGPIdentifier]))\n</code></pre>\n\n<p>Finally, I have tried moving the keys into individual TXT files and <strong>that works</strong> but for some reason having them in JSON does not</p>\n"}, {"tags": ["json", "api", "go", "controller", "beego"], "comments": [{"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1553053473, "post_id": 55252980, "comment_id": 97238724, "body": "the type of m1 is map, but the result type of append is list"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 1, "creation_date": 1553053568, "post_id": 55252980, "comment_id": 97238748, "body": "define m1 as []interface{}"}], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1553053895, "post_id": 55253309, "comment_id": 97238834, "body": "<code>tickets, ptotal, err := models.GetAllTicket(query, fields, sortby, order, offset, limit)</code> thats how i takes 3 variables, tickets is <code>tickets []interface{}</code> ptotal is <code>int64</code> error <code>error</code>"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "reply_to_user": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 1, "creation_date": 1553054095, "post_id": 55253309, "comment_id": 97238881, "body": "i&#39;m not sure had understand what you mean"}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1553054495, "post_id": 55253309, "comment_id": 97238964, "body": "but I declare variable by  using  := in <code>tickets, ptotal, err :=</code> but why do i have to use var at top of it? Please explain?"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "reply_to_user": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1553057912, "post_id": 55253309, "comment_id": 97239683, "body": "Oh, it&#39;s not necessary, I just want to make it clear about the type of value"}], "tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 2, "last_activity_date": 1553054271, "last_edit_date": 1553054271, "creation_date": 1553053809, "answer_id": 55253309, "question_id": 55252980, "link": "https://stackoverflow.com/questions/55252980/nested-map-return-json-array/55253309#55253309", "title": "Nested map return json array[]", "body": "<pre><code>var tickets []interface{}\nvar ptotal int64\ntickets, ptotal, err := models.GetAllTicket(query, fields, sortby, order, offset, limit)\nif err != nil {\n    // bulabula\n}\ni.Data[\"json\"] = append(tickets, map[string]int64{\"totalpage\": ptotal})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 1, "creation_date": 1553058111, "post_id": 55253451, "comment_id": 97239744, "body": "<a href=\"https://stackoverflow.com/questions/55234195/how-to-append-or-combine-2-array-golang-beego/55235252#55235252\" title=\"how to append or combine 2 array golang beego\">stackoverflow.com/questions/55234195/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1391, "user_id": 240750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7aec284f4746da267863b4f3363a30f?s=128&d=identicon&r=PG", "display_name": "Cytown", "link": "https://stackoverflow.com/users/240750/cytown"}, "is_accepted": false, "score": 1, "last_activity_date": 1553054830, "creation_date": 1553054830, "answer_id": 55253451, "question_id": 55252980, "link": "https://stackoverflow.com/questions/55252980/nested-map-return-json-array/55253451#55253451", "title": "Nested map return json array[]", "body": "<p>try this:</p>\n\n<pre><code>var data = map[string]map[string]string{\n    \"ticket\": map[string]string{},\n    \"totalpage\": map[string]string{},\n    \"c\": map[string]string{},\n}\n\ndata[\"ticket\"][\"w\"] = \"vrniairvnai\"\ndata[\"totalpage\"][\"w\"] = \"ten\"\nfmt.Println(data)\n\nvar data2 = make(map[string]interface{})\ndata2[\"data\"] = data\ndata2[\"int\"] = 10\nfmt.Println(data2)\n</code></pre>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 55253309, "answer_count": 2, "score": -1, "last_activity_date": 1553057465, "creation_date": 1553051248, "last_edit_date": 1553057465, "question_id": 55252980, "link": "https://stackoverflow.com/questions/55252980/nested-map-return-json-array", "title": "Nested map return json array[]", "body": "<p>How can I create a nested JSON array? Is there any other easy way to do it?</p>\n\n<p>I tried this:</p>\n\n<pre><code>var m1 = make(map[string]interface{})\nm1 = append(tickets, ptotal)                      //error is here\ni.Data[\"json\"] = m1\ni.ServeJSON()\n</code></pre>\n\n<p>but it shows this error:</p>\n\n<blockquote>\n  <p>cannot use append(tickets, ptotal) (type []interface {}) as type map[string]interface {} in assignment</p>\n</blockquote>\n\n<p>I can do this, but it's not nested at all:</p>\n\n<pre><code>// some := append(tickets, map[string]int64{\"totalpage\": ptotal})\n</code></pre>\n\n<p>I want this JSON:</p>\n\n<pre><code>[\n  {tickets\n     name:value,\n  },\n],\n[\n  {\n   totalpage: 10\n  }\n]\n</code></pre>\n\n<p>I want like <a href=\"https://play.golang.org/p/FQm274Nv4g0\" rel=\"nofollow noreferrer\">Playground of mine</a></p>\n"}, {"tags": ["go", "testing", "gomega"], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": false, "score": 2, "last_activity_date": 1553050759, "creation_date": 1553050759, "answer_id": 55252909, "question_id": 55252807, "link": "https://stackoverflow.com/questions/55252807/test-whether-a-function-was-called/55252909#55252909", "title": "Test whether a function was called", "body": "<ol>\n<li>you can mock implementation of the interface, like</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>globalIndex\ntype Mock struct{}\n\nfunc (m Mock) SomeFunc(){\n    globalIndex++\n}\n\nfunc testA(t *testing.T) {\n    a := ExampleModule{\n        AnotherModule: Mock{},\n    }\n    a.A()\n    assert(globalIndex == 1)\n}\n\n</code></pre>\n\n<ol start=\"2\">\n<li>try <code>testify</code>. <code>AssertExpectations</code> can help you</li>\n</ol>\n\n<p><a href=\"https://github.com/stretchr/testify#mock-package\" rel=\"nofollow noreferrer\">https://github.com/stretchr/testify#mock-package</a></p>\n"}], "owner": {"reputation": 133, "user_id": 8009447, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NsF_W2IXiRA/AAAAAAAAAAI/AAAAAAAAAfE/eTwrtffBE-M/photo.jpg?sz=128", "display_name": "Frieda", "link": "https://stackoverflow.com/users/8009447/frieda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553056072, "creation_date": 1553049845, "last_edit_date": 1553056072, "question_id": 55252807, "link": "https://stackoverflow.com/questions/55252807/test-whether-a-function-was-called", "title": "Test whether a function was called", "body": "<p>Given this struct and function:</p>\n\n<pre><code>type ExampleModule struct {\n  DB                   *database.Store\n  AnotherModule        AnotherModuleInterface\n}\n\nfunc(m *ExampleModule) A (i int, id int[]) error{\n  err := m.AnotherModuke.SomeFunc(i, id)\n}\n</code></pre>\n\n<p>How can I make a unit test to make sure that <code>SomeFunc</code> is called when I run the function <code>A</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1553045682, "post_id": 55252106, "comment_id": 97237148, "body": "<a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1553045429, "creation_date": 1553045429, "answer_id": 55252306, "question_id": 55252106, "link": "https://stackoverflow.com/questions/55252106/why-does-the-capacity-of-a-slice-change-when-you-drop-the-first-n-items-but-not/55252306#55252306", "title": "Why does the capacity of a slice change when you drop the first n items but not the last n items?", "body": "<p>A slice has a buffer under the covers. The capacity is the size of that buffer. Removing items from the end does not alter the buffer size.</p>\n\n<p>You are creating a new slice from an existing slice but starting the index of the new slice at 2. The new slice still points to the same underlying buffer (but offset by 2). The buffer size (and capacity) for this new slice is thus 2 less.</p>\n\n<p>Capacity makes sense when you see how append works. Append tries to reuse the same underlying buffer - but if the capacity is filled, then a reallocation and copy is performed.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 9, "last_activity_date": 1553085515, "last_edit_date": 1553085515, "creation_date": 1553047328, "answer_id": 55252494, "question_id": 55252106, "link": "https://stackoverflow.com/questions/55252106/why-does-the-capacity-of-a-slice-change-when-you-drop-the-first-n-items-but-not/55252494#55252494", "title": "Why does the capacity of a slice change when you drop the first n items but not the last n items?", "body": "<p>Go slices are implemented as a struct:</p>\n\n<p><code>src/runtime/slice.go</code>:</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<hr>\n\n<p>Revise your <code>printSlice</code> function to show the pointer to the underlying array:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    // Drop its last two values\n    s = s[:len(s)-2]\n    printSlice(s)\n\n    // Drop its first two values.\n    s = s[2:]\n    printSlice(s)\n}\n\nfunc printSlice(s []int) {\n    var ptr *int\n    if cap(s) &gt;= 1 {\n        ptr = &amp;s[:cap(s)][0]\n    }\n    fmt.Printf(\"ptr=%p len=%d cap=%d %v\\n\", ptr, len(s), cap(s), s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pk3cpE_LsUV\" rel=\"noreferrer\">https://play.golang.org/p/pk3cpE_LsUV</a></p>\n\n<p>Output:</p>\n\n<pre><code>ptr=0x450000 len=6 cap=6 [2 3 5 7 11 13]\nptr=0x450000 len=4 cap=6 [2 3 5 7]\nptr=0x450008 len=2 cap=4 [5 7]\n</code></pre>\n\n<p>See how your slicing operations adjust the pointer, the length, and the capacity. A slice is simply a view of or window into the underlying array.</p>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification:</a></p>\n\n<ul>\n<li><p><a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">Slice types</a> </p></li>\n<li><p><a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"noreferrer\">Slice expressions</a></p></li>\n</ul>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 3, "accepted_answer_id": 55252494, "answer_count": 2, "score": 5, "last_activity_date": 1553085515, "creation_date": 1553043538, "question_id": 55252106, "link": "https://stackoverflow.com/questions/55252106/why-does-the-capacity-of-a-slice-change-when-you-drop-the-first-n-items-but-not", "title": "Why does the capacity of a slice change when you drop the first n items but not the last n items?", "body": "<p>I am going through the tour of Go and wanted to know the following:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    // Drop its last two values\n    s = s[:len(s)-2]\n    printSlice(s)\n\n    // Drop its first two values.\n    s = s[2:]\n    printSlice(s)\n}\n\nfunc printSlice(s []int) {\n    fmt.Printf(\"len=%d cap=%d %v\\n\", len(s), cap(s), s)\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>len=6 cap=6 [2 3 5 7 11 13]\nlen=4 cap=6 [2 3 5 7]\nlen=2 cap=4 [5 7]\n</code></pre>\n\n<p>Why does the capacity of the slice stay the same when you drop the last 2 items but changes when you drop the first 2?</p>\n\n<p><a href=\"https://play.golang.org/p/ZNKwOYKDqOi\" rel=\"noreferrer\">https://play.golang.org/p/ZNKwOYKDqOi</a></p>\n"}, {"tags": ["go", "time", "unix-timestamp", "rfc3339", "leap-second"], "answers": [{"comments": [{"owner": {"reputation": 1868, "user_id": 499567, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c4ba4a2ce571f71370d270a21633e7e3?s=128&d=identicon&r=PG", "display_name": "Techrocket9", "link": "https://stackoverflow.com/users/499567/techrocket9"}, "edited": false, "score": 0, "creation_date": 1553099463, "post_id": 55253516, "comment_id": 97262921, "body": "The convention of the service is to serialize all timestamps to RFC3339Nano format.  I&#39;m willing to break convention if necessary, but I want a case for why it&#39;s necessary."}], "tags": [], "owner": {"reputation": 1391, "user_id": 240750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7aec284f4746da267863b4f3363a30f?s=128&d=identicon&r=PG", "display_name": "Cytown", "link": "https://stackoverflow.com/users/240750/cytown"}, "is_accepted": false, "score": 0, "last_activity_date": 1553055431, "creation_date": 1553055431, "answer_id": 55253516, "question_id": 55251584, "link": "https://stackoverflow.com/questions/55251584/can-a-golang-rfc3339nano-timestamp-be-reliably-converted-to-and-from-a-unix-time/55253516#55253516", "title": "Can a golang RFC3339Nano timestamp be reliably converted to and from a Unix timestamp?", "body": "<p>I think you suffer this kind of trouble with no reason, why don't you just use the Unix() directly store to the database and restore with that?</p>\n"}], "owner": {"reputation": 1868, "user_id": 499567, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c4ba4a2ce571f71370d270a21633e7e3?s=128&d=identicon&r=PG", "display_name": "Techrocket9", "link": "https://stackoverflow.com/users/499567/techrocket9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 715, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556047264, "creation_date": 1553039322, "last_edit_date": 1556047264, "question_id": 55251584, "link": "https://stackoverflow.com/questions/55251584/can-a-golang-rfc3339nano-timestamp-be-reliably-converted-to-and-from-a-unix-time", "title": "Can a golang RFC3339Nano timestamp be reliably converted to and from a Unix timestamp?", "body": "<p>In my golang application I'm using a Unix second-resolution timestamp (generated with <code>time.Now().UTC().Unix()</code>) as part of a salt in the hash function used for request authentication.</p>\n\n<p>There's a desire to store this timestamp in a datastore, where the convention is RFC3339 nanosecond-resolution timestamp strings generated by the golang <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">RFC3339Nano function</a>, along with the hash for authentication.</p>\n\n<p>The question: Is there any risk that the RFC3339Nano can't be reversed exactly to the original Unix timestamp, in the event that the hash needs to be reauthenticated later?</p>\n\n<p>I know there are some issues with <a href=\"https://stackoverflow.com/questions/16539436/unix-time-and-leap-seconds\">leap seconds</a> which apply to Unix timestamps; is it ever possible that round-tripping through RFC3339Nano will result in a different timestamp, thus erroneously invalidating the signature?</p>\n\n<p>The RFC3339Nano timestamp and the Unix timestamp are generated from the same time.Time struct.</p>\n\n<p>I'm inclined to think it will work since <a href=\"https://www.ietf.org/rfc/rfc3339.txt\" rel=\"nofollow noreferrer\">leap-seconds spawn an extra 61st second at the day of their occurrence</a>, which I expect would map back to the same Unix timestamp as the previous second. The reverse would clearly fail though.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1553033764, "creation_date": 1553033764, "answer_id": 55250770, "question_id": 55249733, "link": "https://stackoverflow.com/questions/55249733/parse-yaml-with-deep-structure-and-array-value/55250770#55250770", "title": "parse yaml with deep structure and array value", "body": "<p>I'm not sure marshaling <em>into</em> a type an <code>interface{}</code> will work. Marshalers rely on reflection to know where to put the data, so they need a concrete type value to know how to store each field/item.</p>\n\n<p>If you have a complex YAML config, you can paste it into an online <a href=\"https://mengzhuo.github.io/yaml-to-go/\" rel=\"nofollow noreferrer\">YAML-to-go</a> generator to yield a compatible type definition:</p>\n\n<pre><code>type AutoGenerated struct {\n    Version       string `yaml:\"version\"`\n    RunParameters struct {\n        Before []struct {\n            Runner  string `yaml:\"runner\"`\n            Options struct {\n                Cmd []string `yaml:\"cmd\"`\n            } `yaml:\"options\"`\n            Supported string `yaml:\"supported\"`\n        } `yaml:\"before\"`\n        After []struct {\n            Runner  string `yaml:\"runner\"`\n            Options struct {\n                Cmd []string `yaml:\"cmd\"`\n            } `yaml:\"options\"`\n            Supported string `yaml:\"supported\"`\n        } `yaml:\"after\"`\n    } `yaml:\"run-parameters\"`\n}\n</code></pre>\n\n<p>It's recommended to pull out the sub-types and define them explicitly - for reuse. </p>\n\n<p>Finally, if a field is optional, then change it to a pointer - the caveat being you will have to check for nil when accessing any sub-fields to avoid runtime panics.</p>\n"}, {"tags": [], "owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "is_accepted": false, "score": 1, "last_activity_date": 1553033787, "creation_date": 1553033787, "answer_id": 55250773, "question_id": 55249733, "link": "https://stackoverflow.com/questions/55249733/parse-yaml-with-deep-structure-and-array-value/55250773#55250773", "title": "parse yaml with deep structure and array value", "body": "<p>You need to change </p>\n\n<pre><code>type RunParams struct {\n    BeforeExec map[string]interface{} `yaml:\"before,omitempty\"`\n    AfterExec  map[string]interface{} `yaml:\"after,omitempty\"`\n}\n</code></pre>\n\n<p>to unmarshall to array of map</p>\n\n<pre><code>type RunParams struct {\n    BeforeExec []map[string]interface{} `yaml:\"before,omitempty\"`\n    AfterExec  []map[string]interface{} `yaml:\"after,omitempty\"`\n}\n</code></pre>\n\n<p>And there would be changes that you need to make to your code for supporting array of map.</p>\n"}, {"tags": [], "owner": {"reputation": 1391, "user_id": 240750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7aec284f4746da267863b4f3363a30f?s=128&d=identicon&r=PG", "display_name": "Cytown", "link": "https://stackoverflow.com/users/240750/cytown"}, "is_accepted": false, "score": 1, "last_activity_date": 1553060268, "creation_date": 1553060268, "answer_id": 55254178, "question_id": 55249733, "link": "https://stackoverflow.com/questions/55249733/parse-yaml-with-deep-structure-and-array-value/55254178#55254178", "title": "parse yaml with deep structure and array value", "body": "<p>try this:</p>\n\n<pre><code>type RunParams struct {\n    BeforeExec []Runners `yaml:\"before,omitempty\"`\n    AfterExec  []Runners `yaml:\"after,omitempty\"`\n}\n\ntype Runners struct {\n    Runner string `yaml:\"runner,omitempty\"`\n    Options map[string]interface{} `yaml:\"options,omitempty\"`\n    Supported string `yaml:\"supported,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 2, "accepted_answer_id": 55250770, "answer_count": 3, "score": 0, "last_activity_date": 1553060268, "creation_date": 1553028438, "question_id": 55249733, "link": "https://stackoverflow.com/questions/55249733/parse-yaml-with-deep-structure-and-array-value", "title": "parse yaml with deep structure and array value", "body": "<p>im trying to parse the following yaml and I got error, the yaml is valid according <a href=\"https://codebeautify.org/yaml-validator/cb4510d0\" rel=\"nofollow noreferrer\">https://codebeautify.org/yaml-validator/cb4510d0</a>\nI try to use interface and still I dont able to parse the file.\nwhat I need is:</p>\n\n<ol>\n<li>print the values like <code>runner1</code> <code>runner2</code> and <code>runner3</code></li>\n<li>cmd values</li>\n</ol>\n\n<p>any idea why interface is not working in this case? </p>\n\n<p>the error is:</p>\n\n<pre><code>2019/03/19 22:42:11 Error : yaml: unmarshal errors:\n  line 6: cannot unmarshal !!seq into map[string]interface {}\n  line 22: cannot unmarshal !!seq into map[string]interface {}\n</code></pre>\n\n<p>this is what I tried</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\nvar runContent = []byte(`\nversion: \"1.1\"\n\nrun-parameters:\n  before:\n    - runner: runner1\n      options: \n        cmd:\n         - value1\n         - value2\n      supported: k8s\n\n    - runner: runner2\n      options: \n        cmd:\n         - value3\n         - value4\n      supported: aws\n\n\n  after:\n    - runner: runner3\n      options: \n        cmd:\n         - value6\n         - value7\n      supported: aws\n\n\n`)\n\ntype FTD struct {\n    Version     string     `yaml:\"version,omitempty\"`\n    BuildParams *RunParams `yaml:\"run-parameters,omitempty\"`\n}\n\ntype RunParams struct {\n    BeforeExec map[string]interface{} `yaml:\"before,omitempty\"`\n    AfterExec  map[string]interface{} `yaml:\"after,omitempty\"`\n}\n\nfunc main() {\n    runners := &amp;FTD{}\n    // parse mta yaml\n    err := yaml.Unmarshal(runContent, runners)\n    if err != nil {\n        log.Fatalf(\"Error : %v\", err)\n    }\n    // for _, v := range runners.BuildParams.BeforeExec {\n    //  fmt.Printf(\"%#v\\n\", v)\n    // }\n\n    // fmt.Println(runners.BuildParams.BeforeExec[\"run-parameters\"])\n\n    // if _, ok := runners.BuildParams.BeforeExec[\"run-parameters\"]; ok {\n    //  run := runners.BuildParams.BeforeExec[\"run-parameters\"].(map[interface{}]interface{})[\"run\"]\n    //  fmt.Println(\"run: \", run)\n    // }\n\n    runParams, ok := runners.BuildParams.BeforeExec[\"run-parameters\"]\n\n    if !ok {\n        // handle lack of \"run-parameters\" in BeforeExec\n    }\n\n    runParamsMap, ok := runParams.(map[interface{}]interface{})\n\n    if !ok {\n        // handle \"run-parameters\" not being a map\n    }\n\n    run, ok := runParamsMap[\"run\"]\n\n    if !ok {\n        // handle lack of \"run\" inside \"run-parameters\"\n    }\n\n    runStr, ok := run.(string)\n\n    if !ok {\n        // handle \"run\" not being a string\n    }\n\n    fmt.Println(\"run: \", runStr)\n\n}\n</code></pre>\n"}, {"tags": ["go", "url"], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1553022461, "post_id": 55248254, "comment_id": 97229399, "body": "Thanks, yes, the path library was the problem.  I switched to using .ResolveReference instead and it&#39;s working marvelous"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1553021885, "creation_date": 1553021885, "answer_id": 55248254, "question_id": 55248217, "link": "https://stackoverflow.com/questions/55248217/http-query-string-question-mark-becomes-3/55248254#55248254", "title": "http query string: question mark becomes %3", "body": "<p>That's because you're appending the query string to the path, so the library is correctly escaping <code>?</code> to make for a valid URL. If you want <code>token=&lt;top_secret&gt;</code> to be treated as part of the query, you need to add it to the query instead:</p>\n\n<pre><code>endpoint:= \"/buildWithParameters\" \n\n// ... \n\nq.Add(\"token\", \"&lt;top_secret&gt;\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "is_accepted": false, "score": 0, "last_activity_date": 1553022688, "creation_date": 1553022688, "answer_id": 55248446, "question_id": 55248217, "link": "https://stackoverflow.com/questions/55248217/http-query-string-question-mark-becomes-3/55248446#55248446", "title": "http query string: question mark becomes %3", "body": "<p>As @Flimzy pointed out, it was the Path library causing my issue.  The following base.ResolveReference() method resolved:</p>\n\n<pre><code>// concat server and build job\nu, err := url.Parse(server)\nu.Path = path.Join(u.Path, endpoint)\nendpoint := u.String()\n</code></pre>\n\n<p>replaced with:</p>\n\n<pre><code>// concat server and build job\nbase, err := url.Parse(server)\nendpoint, err := url.Parse(endpoint)\nendpoint = base.ResolveReference(endpoint)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1553022726, "creation_date": 1553022726, "answer_id": 55248457, "question_id": 55248217, "link": "https://stackoverflow.com/questions/55248217/http-query-string-question-mark-becomes-3/55248457#55248457", "title": "http query string: question mark becomes %3", "body": "<p>You're creating it with <code>url.Parse</code>, then appending the query string to the path (which it's handling correctly, by escaping it). If you do it the other way around (construct your complete URL, then parse it), it can do its job:</p>\n\n<pre><code>server := \"server.com\"\nendpoint := \"/buildWithParameters?token=&lt;top_secret&gt;\" \n\n// concat server and build job\nu, err := url.Parse(path.Join(server, endpoint))\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 1, "answer_count": 3, "score": -5, "last_activity_date": 1553129014, "creation_date": 1553021743, "last_edit_date": 1553129014, "question_id": 55248217, "link": "https://stackoverflow.com/questions/55248217/http-query-string-question-mark-becomes-3", "title": "http query string: question mark becomes %3", "body": "<p>Attempting to append to an existing queryString, but '?' that proceeds the query string is being replaced with '%3'</p>\n\n<pre><code> server := \"server.com\"\n endpoint:= \"/buildWithParameters?token=&lt;top_secret&gt;\" \n\n// concat server and build job\n    u, err := url.Parse(server)\n    u.Path = path.Join(u.Path, endpoint)\n    endpoint := u.String()\n\n    // since we are appending to existing querystring, request is needed for parsing\n    req, err := http.NewRequest(\"POST\", endpoint, nil)\n    if err != nil {\n        return fmt.Errorf(\"Error creating post request: (%v)\", err)\n    }\n\n    // read existing query string\n    q := req.URL.Query()\n\n\n    q.Add(\"key\", \"value\")\n\n    req.URL.RawQuery = q.Encode()\n\n\n    log.Println(req.URL.String())\n</code></pre>\n\n<p>The output is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>https://server.com/job/jobbyjob/buildWithParameters%3Ftoken=&lt;top_secret&gt;?key=value\n</code></pre>\n"}, {"tags": ["go", "certificate", "certificate-store"], "comments": [{"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 0, "creation_date": 1553020832, "post_id": 55247597, "comment_id": 97228590, "body": "According to the docs for Windows API in C++ (which Go is based on) <code>CertOpenSystemsStoreW</code>: &quot;Only current user certificates are accessible using this method, not the local machine store.&quot; So I believe you&#39;ll need to use <code>CertOpenStore</code>. Reference <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/wincrypt/nf-wincrypt-certopensystemstorew#remarks\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/desktop/api/wincrypt/&hellip;</a>"}, {"owner": {"reputation": 23, "user_id": 550096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/158b6c5e43934601a1f723ebd8f36ed0?s=128&d=identicon&r=PG", "display_name": "user550096", "link": "https://stackoverflow.com/users/550096/user550096"}, "reply_to_user": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 0, "creation_date": 1553021007, "post_id": 55247597, "comment_id": 97228680, "body": "Thanks, Devin. I have tried that and although it still works for Current User I am unable to convert it to work for Local Machine and that&#39;s what I&#39;m looking for. I&#39;ve edited the question to clarify."}, {"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 0, "creation_date": 1553021113, "post_id": 55247597, "comment_id": 97228723, "body": "Thanks for adding <code>CertOpenStore</code> option as well. Have you tried replacing <code>CERT_SYSTEM_STORE_CURRENT_USER</code> with <code>CERT_SYSTEM_STORE_LOCAL_MACHINE</code>?"}, {"owner": {"reputation": 23, "user_id": 550096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/158b6c5e43934601a1f723ebd8f36ed0?s=128&d=identicon&r=PG", "display_name": "user550096", "link": "https://stackoverflow.com/users/550096/user550096"}, "reply_to_user": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 0, "creation_date": 1553021222, "post_id": 55247597, "comment_id": 97228779, "body": "That&#39;s what throws an exception because the store handle returned as zero: Exception 0xc0000005 0x0 0x70 0x7ffa61532cf0 PC=0x7ffa61532cf0 syscall.Syscall(0x7ffa61532c80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0) \tC:/Go/src/runtime/syscall_windows.go:172 +0xc6 syscall.CertEnumCertificatesInStore(0x0, 0x0, 0x0, 0x0, 0x0) \tC:/Go/src/syscall/zsyscall_windows.go:1148 +0x9d main.loadTheSystemCerts(0x0, 0x0, 0x0)"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 550096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/158b6c5e43934601a1f723ebd8f36ed0?s=128&d=identicon&r=PG", "display_name": "user550096", "link": "https://stackoverflow.com/users/550096/user550096"}, "is_accepted": false, "score": 0, "last_activity_date": 1553028685, "creation_date": 1553028685, "answer_id": 55249776, "question_id": 55247597, "link": "https://stackoverflow.com/questions/55247597/how-do-you-retrieve-a-list-of-the-local-machine-windows-certificate-store-using/55249776#55249776", "title": "How do you retrieve a list of the Local Machine Windows certificate store using Go?", "body": "<p>You do use the following code snippet as mentioned in the comments above to retrieve the certs: </p>\n\n<pre><code>    store, err := syscall.CertOpenStore(\n       windows.CERT_STORE_PROV_SYSTEM,\n       0,\n       0,\n       windows.CERT_SYSTEM_STORE_LOCAL_MACHINE, \n       uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(\"MY\"))))\n</code></pre>\n\n<p>But there were a few things going on here as to why specifically it wasn't working initially:</p>\n\n<ol>\n<li>You must run the program as Administrator otherwise the store will be returned as 0.</li>\n<li>I was not running VS Code as Administrator: I thought I was, but you have to kill all instances in order to do so!</li>\n<li>The code to retrieve the last error didn't seem to work in this situation in Go but when I switched over to working in C++ I did see the access denied error.</li>\n</ol>\n"}], "owner": {"reputation": 23, "user_id": 550096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/158b6c5e43934601a1f723ebd8f36ed0?s=128&d=identicon&r=PG", "display_name": "user550096", "link": "https://stackoverflow.com/users/550096/user550096"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 970, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553028685, "creation_date": 1553019484, "last_edit_date": 1553020964, "question_id": 55247597, "link": "https://stackoverflow.com/questions/55247597/how-do-you-retrieve-a-list-of-the-local-machine-windows-certificate-store-using", "title": "How do you retrieve a list of the Local Machine Windows certificate store using Go?", "body": "<p>Go allows you to pretty easily retrieve the Personal Windows cert store handle for the Current User using the following command: </p>\n\n<pre><code>store, err := syscall.CertOpenSystemStore(0, syscall.StringToUTF16Ptr(\"MY\")) // Personal Certificates\n</code></pre>\n\n<p>However, when I try to retrieve the Local Machine Personal cert store I always end up with either an empty store handle, and exception or error that the store was not found, CRYPT_E_NOT_FOUND. </p>\n\n<p>Alternatively, you can use this method:</p>\n\n<pre><code>    store, err := syscall.CertOpenStore(\n       windows.CERT_STORE_PROV_SYSTEM, \n       0,\n       0,\n       windows.CERT_SYSTEM_STORE_CURRENT_USER,\n       uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(\"MY\")))) \n</code></pre>\n\n<p>But when I swap out the values for the Local Machine store I start seeing the errors referenced above.</p>\n\n<p>How do you successfully retrieve the Local Machine cert store in Windows using Go?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1553018455, "post_id": 55247194, "comment_id": 97227402, "body": "Yes, there are some nice 3rd party packages such as <a href=\"https://github.com/inconshreveable/go-update\" rel=\"nofollow noreferrer\">github.com/inconshreveable/go-update</a> or <a href=\"https://github.com/rhysd/go-github-selfupdate\" rel=\"nofollow noreferrer\">github.com/rhysd/go-github-selfupdate</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1553018551, "post_id": 55247194, "comment_id": 97227450, "body": "@icza that library almost certainly does exactly what OP laid out in the question, using a supervisor process to perform the update. There&#39;s no way around it, because Windows locks the executable while it&#39;s running."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553023906, "post_id": 55247194, "comment_id": 97230061, "body": "@Adrian Yes, it could be. I haven&#39;t looked into how it is implemented."}, {"owner": {"reputation": 1039, "user_id": 1722117, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Mw4zy.jpg?s=128&g=1", "display_name": "Arnaud Ali&#232;s", "link": "https://stackoverflow.com/users/1722117/arnaud-ali%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1610890299, "post_id": 55247194, "comment_id": 116269327, "body": "This one does the job <a href=\"https://github.com/mouuff/go-rocket-update\" rel=\"nofollow noreferrer\">github.com/mouuff/go-rocket-update</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1553154239, "post_id": 55247280, "comment_id": 97281637, "body": "I can actually execute the new version and exit the currently running exe to restart the app. Which meant I didn&#39;t have to skip that step."}], "tags": [], "owner": {"reputation": 1273, "user_id": 2287427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b12dacf80e8ab397c3fdcd4f0d49c32d?s=128&d=identicon&r=PG", "display_name": "Dave S", "link": "https://stackoverflow.com/users/2287427/dave-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1553030755, "last_edit_date": 1553030755, "creation_date": 1553018346, "answer_id": 55247280, "question_id": 55247194, "link": "https://stackoverflow.com/questions/55247194/how-to-self-update-application-while-running/55247280#55247280", "title": "How to self update application while running", "body": "<p>No.  Windows locks writing to or deleting an executable file or DLL while there are any processes running it.</p>\n\n<p>See for example this SO question - <a href=\"https://stackoverflow.com/questions/196897/locking-executing-files-windows-does-linux-doesnt-why\">Locking Executing Files: Windows does, Linux doesn&#39;t. Why?</a></p>\n\n<p>If it's OK to run an out-of-date version of the application and you only need it updated for the next time that it is run (skipping the step <code>Secondary app executes main app.</code> of restarting the application immediately) then see <strong>Sami Sallinen</strong>'s answer for renaming the running EXE and DLLs.</p>\n"}, {"comments": [{"owner": {"reputation": 1273, "user_id": 2287427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b12dacf80e8ab397c3fdcd4f0d49c32d?s=128&d=identicon&r=PG", "display_name": "Dave S", "link": "https://stackoverflow.com/users/2287427/dave-s"}, "edited": false, "score": 0, "creation_date": 1553021533, "post_id": 55247459, "comment_id": 97228921, "body": "This will work great if you don&#39;t need the application to switch to using the new version immediately ( <code>5. Secondary app executes main app.</code> )"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1553029747, "post_id": 55247459, "comment_id": 97232675, "body": "This approach actually works for me but my question is, does it work for all versions of windows? I mean, including Win7 and above? Specially when I distribute my app."}, {"owner": {"reputation": 1273, "user_id": 2287427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b12dacf80e8ab397c3fdcd4f0d49c32d?s=128&d=identicon&r=PG", "display_name": "Dave S", "link": "https://stackoverflow.com/users/2287427/dave-s"}, "edited": false, "score": 0, "creation_date": 1553030523, "post_id": 55247459, "comment_id": 97232941, "body": "Yes, you can rename the EXE file for a running process in Windows Pro version\t10.0.17134 Build 17134, I tried it earlier."}, {"owner": {"reputation": 2348, "user_id": 5820440, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eQxPRvll8zs/AAAAAAAAAAI/AAAAAAAAFZ8/meZGJQSwVro/photo.jpg?sz=128", "display_name": "Sami Sallinen", "link": "https://stackoverflow.com/users/5820440/sami-sallinen"}, "edited": false, "score": 0, "creation_date": 1553079239, "post_id": 55247459, "comment_id": 97249366, "body": "I have been using this approach in a an installer (renames old version if in use etc) but not really doing a self-update for ~10 years and haven&#39;t seen a problem with it so far. So I guess it should work across different windows versions quite well."}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1553154410, "post_id": 55247459, "comment_id": 97281700, "body": "Already started distributing it and can confirm it works on all platform I&#39;ve distributed it to. The only thing is I cannot delete the old app. So I just delete it on start of the new app instead of deleting it while downloading."}], "tags": [], "owner": {"reputation": 2348, "user_id": 5820440, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eQxPRvll8zs/AAAAAAAAAAI/AAAAAAAAFZ8/meZGJQSwVro/photo.jpg?sz=128", "display_name": "Sami Sallinen", "link": "https://stackoverflow.com/users/5820440/sami-sallinen"}, "is_accepted": true, "score": 3, "last_activity_date": 1553018993, "creation_date": 1553018993, "answer_id": 55247459, "question_id": 55247194, "link": "https://stackoverflow.com/questions/55247194/how-to-self-update-application-while-running/55247459#55247459", "title": "How to self update application while running", "body": "<p>The executable file is locked while running. However you can rename the file even though you can't delete it. So download the new app to a temporary file, make your app rename the app.exe to app-old.exe and then rename the temp file to app.exe. Also delete app-old.exe before downloading beginning the rename craze. </p>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "accepted_answer_id": 55247459, "answer_count": 2, "score": 1, "last_activity_date": 1553030755, "creation_date": 1553018001, "question_id": 55247194, "link": "https://stackoverflow.com/questions/55247194/how-to-self-update-application-while-running", "title": "How to self update application while running", "body": "<p>I have a self updating standalone application in windows. The current update process goes as:</p>\n\n<ol>\n<li>Main app downloads file from server and save it to disk with a temporary name.</li>\n<li>Main app executes a secondary app with parameters.</li>\n<li>Main app exits.</li>\n<li>Secondary app renames temporary file to overwrite main app.exe.</li>\n<li>Secondary app executes main app.</li>\n<li>Secondary app exits.</li>\n</ol>\n\n<p>The above works. But I'm wondering if its possible to do this without using a secondary app? Particularly with Golang.</p>\n"}, {"tags": ["go", "firefox", "certificate"], "comments": [{"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1553017617, "post_id": 55247017, "comment_id": 97226987, "body": "maybe this? You can use it with Let&#39;s Encrypt <a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/acme/autocert</a> - not sure it hits your specific use case, it is more for ssl things"}, {"owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "reply_to_user": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1553017756, "post_id": 55247017, "comment_id": 97227052, "body": "@Slabgorb - no I don&#39;t think that helps - I have the certificates I need, the question is how to install these into the browser."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1553018035, "post_id": 55247017, "comment_id": 97227214, "body": "I&#39;d start with comprehending <a href=\"https://wiki.mozilla.org/CA/AddRootToFirefox\" rel=\"nofollow noreferrer\">wiki.mozilla.org/CA/AddRootToFirefox</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553018384, "post_id": 55247017, "comment_id": 97227374, "body": "It&#39;s going to vary by browser. It&#39;s probably easier to add a certificate to the OS&#39; trusted certificate store."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553018459, "post_id": 55247017, "comment_id": 97227406, "body": "@Adrian, I believe FF uses it&#39;s own store, independent of the OS."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553018689, "post_id": 55247017, "comment_id": 97227530, "body": "It does, but it should treat that as supplementary to the OS&#39; trusted certificates."}, {"owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1553021845, "post_id": 55247017, "comment_id": 97229082, "body": "@kostix comment best so far - that wiki explains that &quot;Since Firefox does not use the operating system&#39;s certificate store by default, these CA certificates must be added in to Firefox using one of the following methods.&quot; - but then shows how FF can be persuaded to look at the OS trusted certificates.  That might be the route.."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1553069208, "post_id": 55247017, "comment_id": 97243762, "body": "The point of using letsencrypt is that you <i>don&#39;t need to install certs in the browser</i>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1553074531, "post_id": 55247017, "comment_id": 97246492, "body": "@richp10, yes, your analysis is about 100% correct, but note that FF can be persuaded to look into the OS-specific cert store only on Windows. Linux-based platforms simply do not have one (most of them have an OpenSSL-specific system-wide one, also used by GNUTLS FWIW, but the &quot;NSS&quot; library used by FF to handle SSL/TLS-related stuff is not able to access it), and I honestly have no idea what the situation is on OS X platforms (I suspect there people tend to, ahem, think different and use what&#39;s preinstalled)."}], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 5029542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QrTVj.jpg?s=128&g=1", "display_name": "William", "link": "https://stackoverflow.com/users/5029542/william"}, "is_accepted": false, "score": 0, "last_activity_date": 1612990776, "creation_date": 1612990776, "answer_id": 66144932, "question_id": 55247017, "link": "https://stackoverflow.com/questions/55247017/programmatically-install-an-ssl-certificate-into-a-browsers-store/66144932#66144932", "title": "Programmatically install an SSL certificate into a browser&#39;s store", "body": "<p>I'm late to this but you <em>can</em> programmatically add self-signed or untrusted root certs to FireFox that are distribution wide (not tied to any user's browser). Here's what I got to work on Ubuntu 18.04 with FireFox 85.0:</p>\n<ol>\n<li>Add the cert (with .crt extension in PEM format) to /usr/local/share/ca-certificates or /usr/share/ca-certificates. Either is fine but you need to update the install location in JSON below.</li>\n<li><code>sudo update-ca-certificates</code></li>\n<li>Create this json file: <code>/usr/lib/firefox/distribution/policies.json</code> with the code below</li>\n</ol>\n<pre><code>{\n    &quot;policies&quot;: {\n        &quot;Certificates&quot;: {\n            &quot;ImportEnterpriseRoots&quot;: true,\n            &quot;Install&quot;: [\n                &quot;/usr/local/share/ca-certificates/&lt;$NAMEOFYOURCERT.crt&gt;&quot;\n      ]\n    }\n  }\n}\n</code></pre>\n<p>You could really skip steps 1/2 and point the Install location in the policies.json file to wherever the cert is located but this ensures your OS trusts the cert too, not just FireFox.</p>\n<p>Pretty simple to script these instructions into a bootstrap script for OS installs or a one-off script to hand to users to run if you trust them.</p>\n"}], "owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 483, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1612990776, "creation_date": 1553017291, "last_edit_date": 1553017896, "question_id": 55247017, "link": "https://stackoverflow.com/questions/55247017/programmatically-install-an-ssl-certificate-into-a-browsers-store", "title": "Programmatically install an SSL certificate into a browser&#39;s store", "body": "<p>I have an application written in Go which needs the web browser (ideally Firefox) to have a self-signed certificate installed. </p>\n\n<p>Of course I can provide instructions to end users on how to install a certificate, but this is far from ideal. </p>\n\n<p>Ideally, I want to programatically add the certificate - using a firefox API, command line, registry hack or some other approach.  Of course I would love a cross platform solution, but even windows only would be a start. </p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1553017999, "post_id": 55246959, "comment_id": 97227190, "body": "I would start by creating a custom []Right type, and then adding an UnmarshalXML method to the []Right type"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1553169567, "post_id": 55246959, "comment_id": 97289604, "body": "Forgive me, but there are too many asumptions and implicit guarantees in this. Why not wrap each individual right in an according, anonymous <code>&lt;right&gt;</code> tag?"}], "answers": [{"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": true, "score": 1, "last_activity_date": 1553695764, "creation_date": 1553695764, "answer_id": 55379296, "question_id": 55246959, "link": "https://stackoverflow.com/questions/55246959/can-go-combine-xml-child-nodes-without-dedicated-root-element-when-unmarshling/55379296#55379296", "title": "Can go combine XML child nodes without dedicated root element when unmarshling?", "body": "<p>I'm using <code>XPath</code> library <a href=\"https://github.com/antchfx/xmlquery\" rel=\"nofollow noreferrer\">xmlquery</a> not Go marshal/unmash method.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"github.com/antchfx/xmlquery\"\n)\n\nfunc main() {\n    s := `\n?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;SessionInfo&gt;\n   &lt;SID&gt;abc123&lt;/SID&gt;\n   &lt;Rights&gt;\n      &lt;Name&gt;NAS&lt;/Name&gt;\n      &lt;Access&gt;2&lt;/Access&gt;\n      &lt;Name&gt;App&lt;/Name&gt;\n      &lt;Access&gt;1&lt;/Access&gt;\n   &lt;/Rights&gt;\n&lt;/SessionInfo&gt;\n`\n    doc, err := xmlquery.Parse(strings.NewReader(s))\n    if err != nil {\n        panic(err)\n    }\n    for _, elem := range xmlquery.Find(doc, \"//SessionInfo\") {\n        sid := xmlquery.FindOne(elem, \"SID\")\n        fmt.Printf(\"sid: %s\\n\", sid.InnerText())\n        for _, name := range xmlquery.Find(elem, \"Rights/Name\") {\n            fmt.Printf(\"name: %s\\n\", name.InnerText())\n        }\n    }\n}\n\n</code></pre>\n\n<p>output</p>\n\n<pre><code>sid: abc123\nname: NAS\nname: App\n</code></pre>\n"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 55379296, "answer_count": 1, "score": 0, "last_activity_date": 1553695764, "creation_date": 1553017043, "question_id": 55246959, "link": "https://stackoverflow.com/questions/55246959/can-go-combine-xml-child-nodes-without-dedicated-root-element-when-unmarshling", "title": "Can go combine XML child nodes without dedicated root element when unmarshling?", "body": "<p>I have an XML structure to work with were a part looks like</p>\n\n<pre><code>   &lt;Rights&gt;\n      &lt;Name&gt;NAS&lt;/Name&gt;\n      &lt;Access&gt;2&lt;/Access&gt;\n      &lt;Name&gt;App&lt;/Name&gt;\n      &lt;Access&gt;1&lt;/Access&gt;\n   &lt;/Rights&gt;\n</code></pre>\n\n<p>This is (obviously) a list, and it is guaranteed that it contains of pairs <code>Name, Access</code> (and always in that particular order). My question: Can I use the <code>encoding/xml</code> package's <code>Unmarshal</code> function to unmarshal <code>Name</code> and <code>Access</code> in a single struct?</p>\n\n<p>Consider the following example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nvar XML = []string{`\n?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;SessionInfo&gt;\n   &lt;SID&gt;abc123&lt;/SID&gt;\n   &lt;Rights&gt;\n      &lt;Name&gt;NAS&lt;/Name&gt;\n      &lt;Access&gt;2&lt;/Access&gt;\n      &lt;Name&gt;App&lt;/Name&gt;\n      &lt;Access&gt;1&lt;/Access&gt;\n   &lt;/Rights&gt;\n&lt;/SessionInfo&gt;\n`,`\n&lt;SessionInfo&gt;\n   &lt;SID&gt;def456&lt;/SID&gt;\n   &lt;Rights /&gt;\n&lt;/SessionInfo&gt;\n`}\n\ntype Right struct {\n    Name string\n    Access int\n}\n\ntype SessionInfo struct {\n    XMLName   xml.Name `xml:\"SessionInfo\"`\n    SID       string\n    Rights    []Right\n}\n\nfunc main() {\n    for _,entry := range XML {\n        info := SessionInfo{}\n        if err := xml.Unmarshal([]byte(entry), &amp;info); err != nil {\n            fmt.Println(\"Marshal failed\", err.Error())\n            continue\n        }\n        fmt.Printf(\"%+v\\n\", info)\n    }\n}\n</code></pre>\n\n<p>This doesn't work as expected:</p>\n\n<pre><code>// Only the first value is found\n{SID:abc123 Rights:[{Name:App Access:1}]} \n// One (not existing) value was found and the struct's zero value was used\n{SID:def456 Rights:[{Name: Access:0}]}\n</code></pre>\n\n<p>I could (and this works) define the properties independent of each other like</p>\n\n<pre><code>Names []string `xml:\"Rights&gt;Name\"`\nAccesses []int `xml:\"Rights&gt;Access\"`\n</code></pre>\n\n<p>But I'd prefer the structure format of the first version without converting them manually.</p>\n\n<p>Is there a way to get the expected result?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 2936, "user_id": 39791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661c7cc5565e5bc21fb0fc22c0354fef?s=128&d=identicon&r=PG", "display_name": "Joe McMahon", "link": "https://stackoverflow.com/users/39791/joe-mcmahon"}, "edited": false, "score": 1, "creation_date": 1553017517, "post_id": 55247020, "comment_id": 97226932, "body": "Remember that your goroutine&#39;s <code>default:</code> case will need to periodically yield control or it will happily tootle along and never check for whether it received the cancellation <code>Context</code> or not."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 2936, "user_id": 39791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661c7cc5565e5bc21fb0fc22c0354fef?s=128&d=identicon&r=PG", "display_name": "Joe McMahon", "link": "https://stackoverflow.com/users/39791/joe-mcmahon"}, "edited": false, "score": 1, "creation_date": 1553017730, "post_id": 55247020, "comment_id": 97227034, "body": "@JoeMcMahon, that&#39;s what I mean by &quot;Check ctx in strategic places&quot;. I hope the update makes it obvious now."}, {"owner": {"reputation": 2936, "user_id": 39791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661c7cc5565e5bc21fb0fc22c0354fef?s=128&d=identicon&r=PG", "display_name": "Joe McMahon", "link": "https://stackoverflow.com/users/39791/joe-mcmahon"}, "edited": false, "score": 0, "creation_date": 1553018559, "post_id": 55247020, "comment_id": 97227455, "body": "It does, and thanks for adding it. I have the scars from trying to debug that particular issue!"}, {"owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "edited": false, "score": 0, "creation_date": 1553086193, "post_id": 55247020, "comment_id": 97253664, "body": "Thanks folks for this awesome solution. The map of cancel functions is clever."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1553017692, "last_edit_date": 1553017692, "creation_date": 1553017300, "answer_id": 55247020, "question_id": 55246721, "link": "https://stackoverflow.com/questions/55246721/how-to-stop-one-of-multilpe-of-the-same-goroutine/55247020#55247020", "title": "How to stop one of multilpe of the same goroutine", "body": "<p>You cannot stop a goroutine \"from the outside\". You have to pass some kind of cancellation signal to each goroutine and remember them for later in the main goroutine. A <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\">Context</a> is typically used as a cancellation signal. The goroutine then has to check for cancellation and exit voluntarily:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n)\n\ntype Event struct {\n    Action string\n    URI    string\n}\n\nfunc main() {\n    var eventCh chan Event\n\n    ctx := context.Background()\n\n    cancels := make(map[string]context.CancelFunc) // Maps URIs to cancellation functions.\n\n    for event := range eventCh {\n        switch event.Action {\n        case \"START\":\n            if cancels[event.URI] != nil {\n                panic(\"duplicate URI: \" + event.URI)\n            }\n\n            ctx, cancel := context.WithCancel(ctx)\n            cancels[event.URI] = cancel\n            defer cancel() // cancel must always be called to free resources.\n\n            go func(u string) {\n                // Awesome goroutine code\n\n                // Check ctx.Done or ctx.Err in strategic places and return if done.\n                select {\n                case &lt;-ctx.Done():\n                    return\n                default:\n                }\n\n                // More awesome goroutine code\n\n                if ctx.Err() != nil {\n                    return\n                }\n\n                // Even more awesome goroutine code\n\n            }(event.URI)\n\n        case \"STOP\":\n            if cancel, ok := cancels[event.URI]; ok {\n                cancel()\n                delete(cancels, event.URI)\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 55247020, "answer_count": 1, "score": 0, "last_activity_date": 1553017692, "creation_date": 1553016139, "last_edit_date": 1553016442, "question_id": 55246721, "link": "https://stackoverflow.com/questions/55246721/how-to-stop-one-of-multilpe-of-the-same-goroutine", "title": "How to stop one of multilpe of the same goroutine", "body": "<p>As it will be made obvious soon, I am a golang n00b.</p>\n\n<p>I have some go code that starts goroutines based on an event channel. Say it starts 2 goroutines because we receive 2 events of type START. </p>\n\n<p>The goroutine is started with an uri as parameter, which gives us something unique about it. </p>\n\n<p>Later we receive one event of type STOP. </p>\n\n<p>How can I stop the goroutine that was started with the same uri ? </p>\n\n<pre><code>for {\n            select {\n            case event := &lt;-eventCh:\n                if event.Entry != nil {\n                    switch event.Action {\n                    case foo.START:\n                        log.Println(\"uri: \", event.Entry.URI)\n\n                        go func(c chan []byte, u string) error{\n                            //awesome goroutine code\n                        }(myChan, event.Entry.URI)\n\n                    case foo.STOP:\n                        log.Println(\"uri: \", event.Entry.URI)\n                        //I'd like to terminate the goroutine that matches event.Entry.URI\n                    }\n                }\n            }\n        }\n</code></pre>\n"}, {"tags": ["go", "goji"], "answers": [{"comments": [{"owner": {"reputation": 116, "user_id": 6782816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fafcf8852a5144602fff8dca2bb93bc?s=128&d=identicon&r=PG&f=1", "display_name": "Magiq", "link": "https://stackoverflow.com/users/6782816/magiq"}, "edited": false, "score": 0, "creation_date": 1553022469, "post_id": 55247291, "comment_id": 97229404, "body": "I need ServeHTTP define his routes, since it&#39;s module responsobility to set his own routes"}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "reply_to_user": {"reputation": 116, "user_id": 6782816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fafcf8852a5144602fff8dca2bb93bc?s=128&d=identicon&r=PG&f=1", "display_name": "Magiq", "link": "https://stackoverflow.com/users/6782816/magiq"}, "edited": false, "score": 0, "creation_date": 1553044015, "post_id": 55247291, "comment_id": 97236826, "body": "You need not ServeHTTP for routes. goji&#39; middleware.SubRouter has ServeHTTP. middlewre.SubRouter code is <a href=\"https://github.com/zenazn/goji/blob/4a0a089f56dffba35ba29a37303bbc3e3e496f96/web/middleware/subrouter.go\" rel=\"nofollow noreferrer\">github.com/zenazn/goji/blob/&hellip;</a>."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 0, "last_activity_date": 1553018382, "creation_date": 1553018382, "answer_id": 55247291, "question_id": 55246659, "link": "https://stackoverflow.com/questions/55246659/goji-subrouter-returns-404/55247291#55247291", "title": "Goji SubRouter returns 404", "body": "<p>If you change it like this, you can get post data.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/zenazn/goji\"\n    \"github.com/zenazn/goji/web\"\n    \"github.com/zenazn/goji/web/middleware\"\n)\n\ntype handler struct{}\n\nfunc (h handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"OK\")\n}\n\nfunc main() {\n    subMux := web.New()\n    subMux.Use(middleware.SubRouter)\n    subMux.Post(\"/:id\", handler{})\n\n    goji.Handle(\"/inner/*\", subMux)\n    goji.Serve()\n}\n</code></pre>\n"}], "owner": {"reputation": 116, "user_id": 6782816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fafcf8852a5144602fff8dca2bb93bc?s=128&d=identicon&r=PG&f=1", "display_name": "Magiq", "link": "https://stackoverflow.com/users/6782816/magiq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553018382, "creation_date": 1553015920, "question_id": 55246659, "link": "https://stackoverflow.com/questions/55246659/goji-subrouter-returns-404", "title": "Goji SubRouter returns 404", "body": "<p>Here is some code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/zenazn/goji\"\n    \"github.com/zenazn/goji/web\"\n    \"github.com/zenazn/goji/web/middleware\"\n)\n\ntype handler struct{}\n\nfunc (h handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    subMux := web.New()\n    subMux.Use(middleware.SubRouter)\n    subMux.Post(\"/:id\", func(c web.C, w http.ResponseWriter, r *http.Request) {\n        fmt.Fprint(w, \"OK\")\n    })\n\n    subMux.ServeHTTP(w, r)\n}\n\nfunc main() {\n    goji.Handle(\"/inner/*\", handler{})\n    goji.Serve()\n}\n</code></pre>\n\n<p>The main idea around this to encapsulate handler routes and use standart net/http Handler interface. So why the following code produce 404 and not use subrouter ?</p>\n\n<pre><code>curl -X POST http://localhost:8000/inner/5\n404 page not found\n</code></pre>\n"}, {"tags": ["postgresql", "go", "amazon-rds", "go-gorm"], "comments": [{"owner": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "edited": false, "score": 0, "creation_date": 1553009337, "post_id": 55243561, "comment_id": 97222136, "body": "did you configure it as &#39;publicly accessible&#39;?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "edited": false, "score": 0, "creation_date": 1553010286, "post_id": 55243561, "comment_id": 97222789, "body": "@Praveen that&#39;s not necessary, they&#39;re connecting using private IP address. It&#39;s likely a security group issue."}, {"owner": {"reputation": 1346, "user_id": 1734678, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sDCCX.jpg?s=128&g=1", "display_name": "Evans M.", "link": "https://stackoverflow.com/users/1734678/evans-m"}, "edited": false, "score": 0, "creation_date": 1557067742, "post_id": 55243561, "comment_id": 98634075, "body": "Have you tried IP address in your db_host?"}], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 5842750, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-a087jpeWMFI/AAAAAAAAAAI/AAAAAAAAAEI/1UNDLjCnYTs/photo.jpg?sz=128", "display_name": "Shahid Peerzade", "link": "https://stackoverflow.com/users/5842750/shahid-peerzade"}, "is_accepted": false, "score": 0, "last_activity_date": 1554203750, "creation_date": 1554203750, "answer_id": 55473433, "question_id": 55243561, "link": "https://stackoverflow.com/questions/55243561/cannot-connect-to-rds-postgres-using-golang-gorm/55473433#55473433", "title": "Cannot connect to RDS Postgres using Golang Gorm", "body": "<p>I am using this function to connect to my postgres database on RDS</p>\n\n<pre><code>package database\n\nimport (\n    \"fmt\"\n\n    \"github.com/jinzhu/gorm\"\n    config \"github.com/spf13/viper\"\n)\n\nfunc Connect() (*gorm.DB, error) {\n    return gorm.Open(\n        \"postgres\",\n        fmt.Sprintf(\n            \"host=%s port=%s user=%s dbname=%s password=%s\",\n            config.GetString(\"postgres.host\"),\n            config.GetString(\"postgres.port\"),\n            config.GetString(\"postgres.user\"),\n            config.GetString(\"postgres.dbname\"),\n            config.GetString(\"postgres.password\"),              \n        ),\n    )\n}\n</code></pre>\n\n<p>Please check if you have access to your RDS database before running this.\nYou can check if you have access to the database from AWS console -> RDS -> database ->  -> [scroll down] under Security group rules\nYou can see if you have added access to the security group to access your database from your network.</p>\n\n<p>You can learn more about security groups here \n<a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#VPCSecurityGroups\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#VPCSecurityGroups</a></p>\n"}], "owner": {"reputation": 2343, "user_id": 4532065, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/477b5c1ec36a72979cde174ad9902d9f?s=128&d=identicon&r=PG&f=1", "display_name": "sinusGob", "link": "https://stackoverflow.com/users/4532065/sinusgob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 936, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1554203750, "creation_date": 1553006335, "question_id": 55243561, "link": "https://stackoverflow.com/questions/55243561/cannot-connect-to-rds-postgres-using-golang-gorm", "title": "Cannot connect to RDS Postgres using Golang Gorm", "body": "<p>I got this error when trying to connect to my RDS Postgres Endpoint</p>\n\n<blockquote>\n  <p>dial tcp 172.xx.xx.x:5432: i/o timeout panic: runtime error: invalid\n  memory address or nil pointer dereference [signal SIGSEGV:\n  segmentation violation code=0x1 addr=0x98 pc=0x1600d16]</p>\n</blockquote>\n\n<p>Seems like there's some problem connecting to the endpoint</p>\n\n<p>.Env file</p>\n\n<pre><code>DB_HOST=dbname.asdasddsa.ap-southeast-1.rds.amazonaws.com\nDB_PORT=5432\nDB_USER=username\nDB_NAME=dbname\nDB_PASSWORD=password\n</code></pre>\n\n<p>My database.go file</p>\n\n<pre><code>func InitDB() *gorm.DB {\n    loadEnv() // For environment variables\n    psqlInfo := fmt.Sprintf(\"host=%s user=%s dbname=%s sslmode=disable password=%s\",\n        os.Getenv(\"DB_HOST\"),\n        os.Getenv(\"DB_USER\"),\n        os.Getenv(\"DB_NAME\"),\n        os.Getenv(\"DB_PASSWORD\"),\n    )\n\n    db, err := gorm.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        fmt.Println(err)\n        return nil\n    }\n    fmt.Println(\"Connected to the Database\")\n    DB = db\n    return DB\n}\n</code></pre>\n\n<p>Do i need to configure anything in my RDS AWS? I followed this article </p>\n\n<p><a href=\"https://aws.amazon.com/getting-started/tutorials/create-connect-postgresql-db/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/getting-started/tutorials/create-connect-postgresql-db/</a> </p>\n\n<p>and followed the exact steps for the configuration</p>\n\n<p>Regards,</p>\n"}, {"tags": ["loops", "go", "memory-leaks"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1553005289, "post_id": 55243071, "comment_id": 97219418, "body": "The application is using the ticker correctly.  If the leak is in this goroutine, then the problem is in <code>&#47;&#47; do updates</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1553005296, "post_id": 55243071, "comment_id": 97219425, "body": "Welcome to StackOverflow! The value you get back in the loop is just the time the ticker went off, it&#39;s likely allocated on the stack, and only lives for the duration of one loop iteration. It cannot leak. The ticker, if it is meant to have the lifetime of your application, also by definition cannot leak. Can you perhaps elaborate on what makes you think you have a memory leak and how you identified the quoted code as the source of the leak?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1553005513, "post_id": 55243071, "comment_id": 97219581, "body": "If the ticker causes a memory leak, that means there&#39;s a very serious bug in Go, because the ticker is essentially just a channel."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1553006113, "post_id": 55243071, "comment_id": 97219991, "body": "Go shipts with a next level tool called <code>pprof</code> which will help you trace the exact source of memory leak in your program by showing the total memory used and/or the total allocated per statement.  There are tons of blog posts online about how to use this (and great documentation on golang.org).   I tried my hand at explaining it too <a href=\"https://medium.com/dm03514-tech-blog/sre-debugging-simple-memory-leaks-in-go-e0a9e6d63d4d\" rel=\"nofollow noreferrer\">medium.com/dm03514-tech-blog/&hellip;</a>"}, {"owner": {"reputation": 95, "user_id": 11226696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6826e365be13c6ac6dbf45cfbb3ac6bf?s=128&d=identicon&r=PG&f=1", "display_name": "JackR", "link": "https://stackoverflow.com/users/11226696/jackr"}, "edited": false, "score": 0, "creation_date": 1553007192, "post_id": 55243071, "comment_id": 97220693, "body": "Thank you all for your help, and clarifications.  I ran two different version of my program with and without the use of the go routine, and over the same time period the one with the go routine leaked memory.  Apologies in prematurely assuming it was the ticker. It actually calls a method to update a file...I know a very easy way to leak memory there is by leaving descriptors open, so I&#39;ve made sure to have a <code>defered reader.Close()</code> as soon as I try opening it successfully. But even then... I don&#39;t give it updates yet. So it just checks file status, and then waits for the next 2 minutes."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1553007299, "post_id": 55243071, "comment_id": 97220758, "body": "Is <code>defer reader.Close()</code> called directly from the loop in <code>checkForUpdates</code>?  If so, that&#39;s the problem.  Deferred calls are executed on return from the function."}, {"owner": {"reputation": 95, "user_id": 11226696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6826e365be13c6ac6dbf45cfbb3ac6bf?s=128&d=identicon&r=PG&f=1", "display_name": "JackR", "link": "https://stackoverflow.com/users/11226696/jackr"}, "edited": false, "score": 0, "creation_date": 1553008119, "post_id": 55243071, "comment_id": 97221334, "body": "No, I made sure that all I did was in a completely separate method for those reasons, so that the variables I did create, would get collected once I exited."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 11226696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6826e365be13c6ac6dbf45cfbb3ac6bf?s=128&d=identicon&r=PG&f=1", "display_name": "JackR", "link": "https://stackoverflow.com/users/11226696/jackr"}, "edited": false, "score": 0, "creation_date": 1553008699, "post_id": 55243605, "comment_id": 97221725, "body": "Thank you for all the resources, will go ahead and try pprof!"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 3, "last_activity_date": 1553006448, "creation_date": 1553006448, "answer_id": 55243605, "question_id": 55243071, "link": "https://stackoverflow.com/questions/55243071/does-ticker-c-leak-memory-if-run-forever/55243605#55243605", "title": "Does ticker.C leak memory, if run forever?", "body": "<p>As @Cerise Limon pointed out it is most likely your application leaking memory in the logic its doing.  In order to pinpoint exactly what is leaking memory you can use <code>pprof</code> to show the total memory in use by statement.  This is a method for answering any question like: </p>\n\n<ul>\n<li>\"Which part of the application is using the most memory at a point in time?\" </li>\n<li>\"Which part of the application is responsible for the most memory allocations? (in byte size)\"</li>\n<li>\"which part of the application (if any) is growing in size over time\"</li>\n<li>\"how much memory is a given statement/line using at a point in time?\"</li>\n</ul>\n\n<p>Once pprof is enabled you can take memory profiles by using:</p>\n\n<pre><code>$ curl http://localhost:8080/debug/pprof/heap &gt; heap.0.pprof\n</code></pre>\n\n<p>You can then interact with the profile using the cli:</p>\n\n<pre><code>$ go tool pprof pprof/heap.3.pprof\nLocal symbolization failed for main: open /tmp/go-build598947513/b001/exe/main: no such file or directory\nSome binary filenames not available. Symbolization may be incomplete.\nTry setting PPROF_BINARY_PATH to the search path for local binaries.\nFile: main\nType: inuse_space\nTime: Jul 30, 2018 at 6:11pm (UTC)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) svg\nGenerating report in profile002.svg\n(pprof) top20\nShowing nodes accounting for 410.75MB, 99.03% of 414.77MB total\nDropped 10 nodes (cum &lt;= 2.07MB)\n      flat  flat%   sum%        cum   cum%\n  408.97MB 98.60% 98.60%   408.97MB 98.60%  bytes.Repeat\n    1.28MB  0.31% 98.91%   410.25MB 98.91%  main.(*RequestTracker).Track\n    0.50MB  0.12% 99.03%   414.26MB 99.88%  net/http.(*conn).serve\n         0     0% 99.03%   410.25MB 98.91%  main.main.func1\n         0     0% 99.03%   410.25MB 98.91%  net/http.(*ServeMux).ServeHTTP\n         0     0% 99.03%   410.25MB 98.91%  net/http.HandlerFunc.ServeHTTP\n</code></pre>\n\n<p>Which will show you how much memory is inuse in your application and which statements/lines are responsible.</p>\n\n<p>What's also cool is that you can generate graphviz charts of your program in order to visualize and trace current memory usage (or memory allocations):</p>\n\n<p><a href=\"https://i.stack.imgur.com/s9fVD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/s9fVD.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>There are quite a few blog posts about pprof online (including standard documentation).  </p>\n\n<p>I wrote a bit about it:</p>\n\n<ul>\n<li><a href=\"https://medium.com/dm03514-tech-blog/sre-debugging-simple-memory-leaks-in-go-e0a9e6d63d4d\" rel=\"nofollow noreferrer\">Debugging Memory Leaks in Go</a></li>\n<li><a href=\"https://medium.com/dm03514-tech-blog/sre-performance-analysis-tuning-methodology-using-a-simple-http-webserver-in-go-d475460f27ca\" rel=\"nofollow noreferrer\">Go Performance Tuning Using pprof</a></li>\n</ul>\n\n<p>And then there are many amazing resources, two of which are:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/pprof/</a></li>\n<li><a href=\"https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/\" rel=\"nofollow noreferrer\">https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/</a></li>\n</ul>\n"}], "owner": {"reputation": 95, "user_id": 11226696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6826e365be13c6ac6dbf45cfbb3ac6bf?s=128&d=identicon&r=PG&f=1", "display_name": "JackR", "link": "https://stackoverflow.com/users/11226696/jackr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 1, "accepted_answer_id": 55243605, "answer_count": 1, "score": 0, "last_activity_date": 1553006448, "creation_date": 1553004941, "question_id": 55243071, "link": "https://stackoverflow.com/questions/55243071/does-ticker-c-leak-memory-if-run-forever", "title": "Does ticker.C leak memory, if run forever?", "body": "<p>I've searched stack overflow for something similar to this, and couldn't find exactly what I was looking for. I apologize if this is an obvious mistake as I just recently started writing in Go, but I appreciate any explanation in advance.\nI currently have a go routine that ranges over the values of <code>*Ticker</code>.\nNow this go routine runs the entire time my program is alive, as it checks for necessary updates. I started recognizing that my program leaks memory slowly overtime. It starts to become very noticeable after 20 to 30 hours of running.</p>\n\n<pre><code>func (s *Server) checkForUpdates() { // go routine\n    ticker := time.NewTicker(time.Minute * time.Duration(s.checkTime)) //x.checkTime = 2 minutes\n    defer ticker.Stop()\n    for t := range ticker.C { // will loop every 2 minutes\n         fmt.Println(\"the update check happened at %d\\n\", t)\n         // do the updates\n    }\n}\n</code></pre>\n\n<p>I narrowed the leak down to the go routine, and read up on all the way's Time can leak memory. Making sure that you close the <code>*Ticker</code> you created once your done with the go routine. However my program runs forever until I kill it. So this go routine will forever run, until I decide to stop the program. \nI know this might be silly to think, but I thought it might be the <code>t := range ticker.C</code> part that could be the problem. Because that loop never stops until I kill. So <code>t</code> never get's released. So I thought the <code>:=</code> re-declares the variable every time I loop? I then made the loop to :</p>\n\n<pre><code>for _ = range ticker.C { // completely got rid of declaration of time.Time\n   // do updates ...\n}\n</code></pre>\n\n<p>And so far it seems to be working... but I really don't understand why, or maybe it should have not helped, and there's something else I'm doing wrong. </p>\n\n<p>I appreciate any help/explanation for this. Thank you.</p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 5236295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LPJUP5i-fIA/AAAAAAAAAAI/AAAAAAAAADk/ojCwuKH8fvc/photo.jpg?sz=128", "display_name": "Jonas D", "link": "https://stackoverflow.com/users/5236295/jonas-d"}, "is_accepted": true, "score": 2, "last_activity_date": 1553005334, "creation_date": 1553005334, "answer_id": 55243213, "question_id": 55242866, "link": "https://stackoverflow.com/questions/55242866/check-existence-of-docker-image-in-private-registry-in-go/55243213#55243213", "title": "check existence of docker image in private registry in Go", "body": "<p>Just realised the lib I've been using has an unhelpfully named client method <code>DistributionInspect</code> (<a href=\"https://godoc.org/github.com/docker/docker/client#Client.DistributionInspect\" rel=\"nofollow noreferrer\">link</a>), which will just return the image digest and manifest, if it's found. so the image doesn't get pulled down.</p>\n"}], "owner": {"reputation": 169, "user_id": 5236295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LPJUP5i-fIA/AAAAAAAAAAI/AAAAAAAAADk/ojCwuKH8fvc/photo.jpg?sz=128", "display_name": "Jonas D", "link": "https://stackoverflow.com/users/5236295/jonas-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 55243213, "answer_count": 1, "score": 1, "last_activity_date": 1553005334, "creation_date": 1553004225, "question_id": 55242866, "link": "https://stackoverflow.com/questions/55242866/check-existence-of-docker-image-in-private-registry-in-go", "title": "check existence of docker image in private registry in Go", "body": "<p>I'm wondering how I can check that a docker image exists in a private registry (in <code>eu.gcr.io</code>), without pulling it.</p>\n\n<p>I have a service, written in golang, which needs to check for the existence of a docker image in order to validate a config file passed to it by a user.</p>\n\n<p>Pulling the image using the go docker client, as shown <a href=\"https://stackoverflow.com/questions/44869498/google-container-registry-golang-moby-authentication\">here</a>, works. However, I don't want to pull down images just to check they exist, as they can be large.</p>\n\n<p>I've tried using <a href=\"https://godoc.org/github.com/docker/docker/client#Client.ImageSearch\" rel=\"nofollow noreferrer\">Client.ImageSearch</a>, but his just searches for public images. the <a href=\"https://godoc.org/cloud.google.com/go\" rel=\"nofollow noreferrer\">cloud.google.com/go</a> package also doesn't seem to have anything for dealing with the container registry.</p>\n\n<p>There's possibly <a href=\"https://godoc.org/github.com/google/go-containerregistry\" rel=\"nofollow noreferrer\">this</a> and the crane tool it contains, but I'm really struggling to figure out how it works. The documentation is... not great.</p>\n\n<p>I'd like the solution to be host agnostic, and the only option I have found is to simply make a http request and use the logic from <a href=\"https://stackoverflow.com/a/52206527/5236295\">this</a> answer.</p>\n\n<p>Are there any docker or other packages able to do this in a cleaner way?</p>\n"}, {"tags": ["java", "go", "java-native-interface"], "comments": [{"owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "edited": false, "score": 0, "creation_date": 1552999131, "post_id": 55239558, "comment_id": 97215263, "body": "Provide your code ! It is very difficult to say the output from the exception trace"}, {"owner": {"reputation": 928, "user_id": 4202134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2a47a155c89dc9a10effdb65f85b777?s=128&d=identicon&r=PG&f=1", "display_name": "srikanth", "link": "https://stackoverflow.com/users/4202134/srikanth"}, "reply_to_user": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "edited": false, "score": 0, "creation_date": 1553001205, "post_id": 55239558, "comment_id": 97216686, "body": "@MaruthiAdithya Done."}, {"owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "edited": false, "score": 0, "creation_date": 1553009539, "post_id": 55239558, "comment_id": 97222275, "body": "Your expected output and present output?"}], "owner": {"reputation": 928, "user_id": 4202134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2a47a155c89dc9a10effdb65f85b777?s=128&d=identicon&r=PG&f=1", "display_name": "srikanth", "link": "https://stackoverflow.com/users/4202134/srikanth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1587836777, "creation_date": 1552993662, "last_edit_date": 1553060725, "question_id": 55239558, "link": "https://stackoverflow.com/questions/55239558/return-a-map-from-golang-to-java-using-native-library-by-passing-string-as-an-i", "title": "Return a map from Golang to Java using Native Library, by passing string as an input from Java", "body": "<p>I'm trying to call a Golang function from a Java program. <a href=\"https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf\" rel=\"nofollow noreferrer\">Reference</a> being used. And thats working perfectly fine.</p>\n\n<p>With that, I'm trying to return a map from golang to java. With the return type in Java being Object/Map nothing worked. In fact the exception(maybe compile time) is: </p>\n\n<pre><code>Exception in thread \"main\" java.lang.IllegalArgumentException: Unsupported return type interface java.util.Map in function GetGeoLoc\n        at com.sun.jna.Function.invoke(Function.java:490)\n        at com.sun.jna.Function.invoke(Function.java:360)\n        at com.sun.jna.Library$Handler.invoke(Library.java:244)\n        at com.sun.proxy.$Proxy0.GetGeoLoc(Unknown Source)\n        at com.java.readers.GetGeoLoc2Tests.getGeoLoc2(GetGeoLoc2Tests.java:39)\n        at com.java.readers.GetGeoLoc2Tests.main(GetGeoLoc2Tests.java:52)\n</code></pre>\n\n<p>Well someone help me with the wayout. I believe I'm missing something here. </p>\n\n<p>Here's the code</p>\n\n<p>Java:</p>\n\n<pre><code>public class GetGeoLoc2Tests {\n\n    static GoCaller GO_CQM_TRANSFORMER;\n\n    public interface GoCaller extends Library {\n        public Map&lt;String, String&gt; GetGeoLoc(GoString.ByValue ip);\n        public int Add(int i);\n        public String SString(GoString.ByValue s);\n\n        public class GoString extends Structure {\n            public static class ByValue extends GoString implements Structure.ByValue {\n            }\n\n            public String ip;\n            public long n;\n\n            protected List getFieldOrder() {\n                return Arrays.asList(new String[] { \"ip\", \"n\" });\n            }\n        }\n    }\n\n    public static void getGeoLoc2(String ip) {\n\n        if (ip == null) {\n            return;\n        }\n\n        GoCaller.GoString.ByValue str = new GoCaller.GoString.ByValue();\n        str.ip = ip;\n        str.n = str.ip.length();\n\n        System.out.println(\"JAVA-----&gt;\" + ip);\n        Map&lt;String, String&gt; map = GO_CQM_TRANSFORMER.GetGeoLoc(str);\n        System.out.println(map);\n    }\n\n    public static void main(String[] args) {\n        if(args.length == 0) {\n            System.out.println(\"Expecting an input&lt;IpAddress&gt;\");\n            System.exit(0);\n        }\n\n        String pwd = System.getProperty(\"user.home\");\n        String lib = pwd + \"/go/src/ip2loc/iploc.so\";\n        GO_CQM_TRANSFORMER = (GoCaller) Native.loadLibrary(lib, GoCaller.class);\n//      System.out.println(GO_CQM_TRANSFORMER.Add(10));\n        getGeoLoc2(args[0]);\n    }\n</code></pre>\n\n<p>Golang:</p>\n\n<pre><code>package main\n\nimport \"C\"\n\nimport (\n        \"fmt\"\n        \"github.com/ip2location/ip2location-go\"\n)\n\nfunc main(){}\n\n//export GetGeoLoc\nfunc GetGeoLoc(ip string) string {\n        ip2location.Open(\"/data/md0/ip2loc/ip6/IPV6-COUNTRY-REGION-CITY-LATITUDE-LONGITUDE-ZIPCODE-TIMEZONE-ISP-DOMAIN-NETSPEED-AREACODE-WEATHER-MOBILE-ELEVATION-USAGETYPE.BIN\")\n        //ip1 := \"8.8.8.8\"\n        fmt.Println(\"input:\" , ip)\n        results := ip2location.Get_all(ip)\n\n        m := make(map[string]string)\n        m[\"country_short\"] = results.Country_short\n        m[\"country_long\"] = results.Country_long\n        m[\"region\"] = results.Region\n        m[\"city\"] = results.City\n        m[\"isp\"] = results.Isp\n        m[\"latitude\"] = fmt.Sprintf(\"%f\", results.Latitude)\n        m[\"longitude\"] = fmt.Sprintf(\"%f\", results.Longitude)\n        m[\"domain\"] = results.Domain\n        m[\"zipcode\"] = results.Zipcode\n        m[\"timezone\"] = results.Timezone\n        m[\"netspeed\"] = results.Netspeed\n        m[\"iddcode\"] = results.Iddcode\n        m[\"areacode\"] = results.Areacode\n        m[\"weatherstationcode\"] = results.Weatherstationcode\n        m[\"weatherstationaname\"] = results.Weatherstationname\n        m[\"mcc\"] = results.Mcc\n        m[\"mnc\"] = results.Mnc\n        m[\"mobilebrand\"] = results.Mobilebrand\n        m[\"elevation\"] = fmt.Sprintf(\"%f\", results.Elevation)\n        m[\"usagetype\"] = results.Usagetype\n\n        fmt.Println(\"map:\", m)\n        ip2location.Close()\n        return m\n</code></pre>\n\n<p>On execution, is printing the output 'm', which is a map. Question is how do i return this <code>map m</code> to a Java method as a <code>HashMap</code>? Thanks</p>\n"}, {"tags": ["http", "go", "server", "fasthttp"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "edited": false, "score": 0, "creation_date": 1553002520, "post_id": 55239859, "comment_id": 97217581, "body": "So, basically I should stop using the fasthttprouter package and use the default fasthttp handlers. Am I right?"}, {"owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "reply_to_user": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "edited": false, "score": 0, "creation_date": 1553002748, "post_id": 55239859, "comment_id": 97217720, "body": "@antonof I don&#39;t think you need to change any packages to get this working. You only need to change the behaviour of <code>myHandler.customerAccountDetailHandler</code> to extract the <code>accountId</code> from the query param using the code snippet above and update the router to <code>router.GET(&quot;&#47;customer&#47;account&#47;detail&quot;, myHandler.customerAccountDetailHandler)</code>."}], "tags": [], "owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "is_accepted": false, "score": 0, "last_activity_date": 1552994565, "creation_date": 1552994565, "answer_id": 55239859, "question_id": 55239415, "link": "https://stackoverflow.com/questions/55239415/define-parameters-as-param-request-instad-of-endpoint-url-in-fasthttprouter/55239859#55239859", "title": "Define parameters as param request instad of endpoint url in fasthttprouter", "body": "<p>The query parameter should be accessible from the request context.\nYou should have a handler that takes a <code>*fasthttp.RequestCtx</code> argument. This <code>RequestCtx</code> can access the URI and the query params on that URI. That should look something like this:</p>\n\n<pre><code>ctx.URI().QueryArgs().Peek(\"accountId\")\n</code></pre>\n\n<p>You'll have to update your handler to use this query parameter instead of the route param you were previously using. The same would also apply for the <code>sort</code> param.</p>\n\n<p>Also, your router would have to be updated to route <code>/customer/account/detail</code> to your updated handler (i.e. you'll want to remove <code>/:accountId</code> from your route).</p>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1568481443, "last_edit_date": 1568481443, "creation_date": 1568465644, "answer_id": 57935683, "question_id": 55239415, "link": "https://stackoverflow.com/questions/55239415/define-parameters-as-param-request-instad-of-endpoint-url-in-fasthttprouter/57935683#57935683", "title": "Define parameters as param request instad of endpoint url in fasthttprouter", "body": "<p>Your questions is similar to this one:<br>\n<a href=\"https://stackoverflow.com/q/39265978/9361998\">Get a request parameter key-value in fasthttp</a></p>\n\n<p>You can retrieve the parameters of the request in this way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>token = string(ctx.FormValue(\"token\"))\n\n</code></pre>\n\n<p>Have a look at my complete response here</p>\n\n<p><a href=\"https://stackoverflow.com/a/57740178/9361998\">https://stackoverflow.com/a/57740178/9361998</a></p>\n\n<p>Documentation: <a href=\"https://godoc.org/github.com/valyala/fasthttp#RequestCtx.FormValue\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/valyala/fasthttp#RequestCtx.FormValue</a></p>\n"}], "owner": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 486, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568481443, "creation_date": 1552993229, "question_id": 55239415, "link": "https://stackoverflow.com/questions/55239415/define-parameters-as-param-request-instad-of-endpoint-url-in-fasthttprouter", "title": "Define parameters as param request instad of endpoint url in fasthttprouter", "body": "<p>I am using golang\u00b4s fasthttprouter and have followed the examples and defined a router like this:</p>\n\n<pre><code>router.GET(\"/customer/account/detail/:accountId\", myHandler.customerAccountDetailHandler)\n</code></pre>\n\n<p>Then I call to my service as <code>http://locahost:9296/customer/account/detail/2</code></p>\n\n<p>But I realised that I do not want to have the parameters as part of the endpoint , I rather prefer to use normal parameters by calling my service like this:</p>\n\n<pre><code>http://locahost:9296/customer/account/detail?accountId=2&amp;sort=1\n</code></pre>\n\n<p>Is it possible to be done with fasthttprouter? How?</p>\n\n<p>Thanks in advance\nJ</p>\n"}, {"tags": ["go", "paypal"], "comments": [{"owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "edited": false, "score": 0, "creation_date": 1553034271, "post_id": 55238536, "comment_id": 97234242, "body": "I don&#39;t understand what you mean by &quot;PayPal Go API&quot;, I don&#39;t see any official go sdk"}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "reply_to_user": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "edited": false, "score": 0, "creation_date": 1553053582, "post_id": 55238536, "comment_id": 97238751, "body": "@antham by paypal go api I mean third party sdk for paypal in golang. I am using <a href=\"https://github.com/logpacker/PayPal-Go-SDK\" rel=\"nofollow noreferrer\">github.com/logpacker/PayPal-Go-SDK</a> sdk"}, {"owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "edited": false, "score": 0, "creation_date": 1553200251, "post_id": 55238536, "comment_id": 97306929, "body": "I would say if you find nothing in api documentation, it means it&#39;s not possible"}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 1359658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ab0d38a001785f14556a9e1b98dcff?s=128&d=identicon&r=PG", "display_name": "Fyb3roptik", "link": "https://stackoverflow.com/users/1359658/fyb3roptik"}, "is_accepted": false, "score": -1, "last_activity_date": 1559860481, "creation_date": 1559860481, "answer_id": 56485874, "question_id": 55238536, "link": "https://stackoverflow.com/questions/55238536/create-customer-in-paypal/56485874#56485874", "title": "Create Customer In PayPal", "body": "<p>From what I can gather you:</p>\n\n<h2>Create the order with intent to CAPTURE</h2>\n\n<pre><code>POST /v2/checkout/orders\n{\n    \"intent\": \"CAPTURE\",\n    \"purchase_units\": [\n    {\n      \"amount\": {\n        \"currency_code\": \"USD\",\n        \"value\": \"1.00\"\n      }\n    }\n  ]\n}\n</code></pre>\n\n<h2>Then CAPTURE the order</h2>\n\n<pre><code>POST /v2/checkout/orders/&lt;OrderId&gt;/capture\n{\n    \"payment_source\": {\n     \"token\": {\n       \"id\": \"VAULT CARD ID HERE\",\n       \"type\": \"PAYMENT_METHOD_TOKEN\"\n     }\n   }\n}\n</code></pre>\n\n<p>This is as far as I have gotten because I am getting a 500 error currently</p>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559860481, "creation_date": 1552990640, "question_id": 55238536, "link": "https://stackoverflow.com/questions/55238536/create-customer-in-paypal", "title": "Create Customer In PayPal", "body": "<p>I was working on PayPal and wanted to know some things about PayPal that we can do in Stripe through Golang API:</p>\n\n<ol>\n<li>can we create a customer through PayPal Go API and then attach card to it? Now What I have integrated is saved a card directly into PayPal vault and start transactions from the saved card. I have gone through the documentation of Go API and found no docs there about customer creation through API. <a href=\"https://developer.paypal.com/docs/api/overview/\" rel=\"nofollow noreferrer\">PayPal API Docs</a></li>\n<li>When we fill card details, is it possible we return a card nonce/token from the PayPal api so that the token represents all the card info?</li>\n<li>Can I set a card to default card of the customer through PayPal Go API?</li>\n</ol>\n\n<p>I need to know all of the above points through Go API. Can anyone guide me upon how can I do all of the above if is possible ??</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "locking"], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": false, "score": 0, "last_activity_date": 1552987994, "creation_date": 1552987994, "answer_id": 55237638, "question_id": 55237513, "link": "https://stackoverflow.com/questions/55237513/should-we-synchronize-variable-assignment-in-goroutine/55237638#55237638", "title": "Should we synchronize variable assignment in goroutine?", "body": "<p>In this case, only one goroutine can access the map. I don't think you need a lock.</p>\n"}, {"comments": [{"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1553000042, "post_id": 55237764, "comment_id": 97215857, "body": "what was my doubts: we have 3 goroutines: parent and two in the error group. there is no guarantee that our parent goroutine shared memory gets last update after errgroup goroutines complete until we wrap access to shared memory with memory barriers"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 1, "creation_date": 1553000267, "post_id": 55237764, "comment_id": 97216017, "body": "@SergiiGetman If you use synchronization, you have your guarantee. <code>sync.Mutex</code> is one tool, so is <code>Group</code> or <code>WaitGroup</code>. Obviously 1 tool is enough, you don&#39;t have to use multiple of them. Read <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a> for details."}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1553426248, "post_id": 55237764, "comment_id": 97372562, "body": "I&#39;ve update question with adding lock/unlock on reading in code example and remark about: <code>reading and writing threads must synchronize on a common lock</code>. I understand that is java related remark, but I suggest it is applicable to golang as well. If it is doesn&#39;t related, correct me please"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 1, "creation_date": 1553434961, "post_id": 55237764, "comment_id": 97375017, "body": "@SergiiGetman This is not applicable directly to Go. In Go, you need to estabilish a <i>happens-before relationship</i>. In the code of the question there is such a relationship: the <code>g.Wait()</code> call will happen before the <code>performAction()</code> call (<code>g.Wait()</code> will not return until its goroutines run), so the writes in the goroutines are guaranteed to happen and made visible before <code>performAction()</code> is called, or more precisely its arguments are evaluated. This happens-before relationship gives you the guarantee, as described in The Go Memory Model (which I suggested to read before)."}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1553436045, "post_id": 55237764, "comment_id": 97375320, "body": "thank you very much for your explanation! unfortunately, it still looks complicated to me. In the links you have provided is the chapter Goroutine destruction:  If the effects of a goroutine must be observed by another goroutine, use a synchronization mechanism such as a lock or channel communication to establish a relative ordering. That\u2019s why I\u2019m still confused."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1553438162, "post_id": 55237764, "comment_id": 97375892, "body": "@SergiiGetman Error group is another synchronization tool. So you&#39;re already using a synchronization mechanism."}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1553517439, "post_id": 55237764, "comment_id": 97401043, "body": "thanks! looks I got it. I also find a similar question on stack <a href=\"https://stackoverflow.com/questions/45894997/does-waitgroup-wait-imply-memory-barrier-in-this-case\" title=\"does waitgroup wait imply memory barrier in this case\">stackoverflow.com/questions/45894997/&hellip;</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1552990149, "last_edit_date": 1552990149, "creation_date": 1552988365, "answer_id": 55237764, "question_id": 55237513, "link": "https://stackoverflow.com/questions/55237513/should-we-synchronize-variable-assignment-in-goroutine/55237764#55237764", "title": "Should we synchronize variable assignment in goroutine?", "body": "<p><a href=\"https://godoc.org/golang.org/x/sync/errgroup#Group.Wait\" rel=\"nofollow noreferrer\"><code>Group.Wait()</code></a> blocks until all function calls from the <a href=\"https://godoc.org/golang.org/x/sync/errgroup#Group.Go\" rel=\"nofollow noreferrer\"><code>Group.Go()</code></a> method have returned, so this is a synchronization point. This ensures <code>performAction(one, two)</code> will not start before any writes to <code>one</code> and <code>two</code> are done, so in your example the mutex is unnecessary.</p>\n\n<pre><code>g, gctx := errgroup.WithContext(ctx)\ng.Go(func() error {\n    // ...\n    one = resp.One\n    return nil\n})\n\ng.Go(func() error {\n    // ...\n    two = resp.Two\n    return nil\n})\n\nif err := g.Wait(); err != nil {\n    return err\n}\n// Here you can access one and two safely:\nperformAction(one, two)\n</code></pre>\n\n<p>If you would access <code>one</code> and <code>two</code> from other goroutines while the goroutines that write them run concurrently, then yes, you would need to lock them, e.g.:</p>\n\n<pre><code>// This goroutine runs concurrently, so all concurrent access must be synchronized:\ngo func() {\n    mu.Lock()\n    fmt.Println(one, two)\n    mu.Unlock()\n}()\n\ng, gctx := errgroup.WithContext(ctx)\ng.Go(func() error {\n    // ...\n    mu.Lock()\n    one = resp.One\n    mu.Unlock()\n    return nil\n})\n\ng.Go(func() error {\n    // ...\n    mu.Lock()\n    two = resp.Two\n    mu.Unlock()\n    return nil\n})\n\nif err := g.Wait(); err != nil {\n    return err\n}\n// Note that you don't need to lock here\n// if the first concurrent goroutine only reads one and two.\nperformAction(one, two)\n</code></pre>\n\n<p>Also note that in the above example you could use <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWMutex</code></a>, and in the goroutine that reads them, <a href=\"https://golang.org/pkg/sync/#RWMutex.RLock\" rel=\"nofollow noreferrer\"><code>RWMutex.RLock()</code></a> and <a href=\"https://golang.org/pkg/sync/#RWMutex.RUnlock\" rel=\"nofollow noreferrer\"><code>RWMutex.RUnlock()</code></a> would also be sufficient.</p>\n"}], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1553426016, "creation_date": 1552987585, "last_edit_date": 1553426016, "question_id": 55237513, "link": "https://stackoverflow.com/questions/55237513/should-we-synchronize-variable-assignment-in-goroutine", "title": "Should we synchronize variable assignment in goroutine?", "body": "<p>Let's assume I declared two maps and want to assign it in two different goroutines in error group. I don't perform any reads/write. \nShould I protect assign operation with <code>lock</code> or I can omit it?</p>\n\n<p>UPD3: In the <a href=\"https://www.oreilly.com/library/view/java-concurrency-in/0321349601/#toc-start\" rel=\"nofollow noreferrer\">Java Concurrency In Practice</a> <a href=\"https://twitter.com/briangoetz\" rel=\"nofollow noreferrer\">Brian Goetz's</a> Part I Chapter 3 <code>Shared Objects</code>, mentioned:</p>\n\n<blockquote>\n  <p>Locking is not just about mutual exclusion; it is also memory\n  visibility. To ensure that all threads see the most up-to-date values\n  of shared mutable variables, the reading and writing threads must\n  synchronize on a common lock.</p>\n</blockquote>\n\n<pre><code>var (\n    mu     sync.Mutex\n    one    map[string]struct{}\n    two    map[string]struct{}\n)\ng, gctx := errgroup.WithContext(ctx)\ng.Go(func() error {\n    resp, err := invokeFirstService(gctx, request)\n    if err != nil {\n        return err\n    }\n    mu.Lock()\n    one = resp.One\n    mu.Unlock()\n    return nil\n})\n\ng.Go(func() error {\n    resp, err := invokeSecondService(gctx, request)\n    if err != nil {\n        return err\n    }\n    mu.Lock()\n    two = resp.Two\n    mu.Unlock()\n    return nil\n})\nif err := g.Wait(); err != nil {\n    return err\n}\n// UPD3: added lock and unlock section\nm.Lock()\ndefer m.Unlock()\nperformAction(one, two)\n</code></pre>\n\n<p>UPD: added more context about variables</p>\n\n<p>UPD2: what were my doubts: we have 3 goroutines - parent and two in the error group. there is no guarantee that our parent goroutine shared memory gets the last update after errgroup goroutines complete until we wrap access to shared memory with memory barriers</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1552985409, "post_id": 55236767, "comment_id": 97206791, "body": "<code>tellDogToGrowOld</code> needs to be defined on a pointer just like you did with <code>growOld</code>. Or, alternatively, <code>Owner</code>&#39;s dog field needs to be pointer to <code>Dog</code>."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552985503, "post_id": 55236767, "comment_id": 97206835, "body": "@mkopriva Hey, it worked! Please add this as an answer so I can accept it. Thanks!"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552985817, "post_id": 55236767, "comment_id": 97207027, "body": "@mkopriva I went with the <code>Owner</code>&#39;s dog field should be a pointer to <code>Dog</code> approach because it&#39;s the closest to &quot;pass-by-reference&quot; in other languages."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 6, "last_activity_date": 1552985944, "creation_date": 1552985944, "answer_id": 55236983, "question_id": 55236767, "link": "https://stackoverflow.com/questions/55236767/struct-fields-not-updating-when-another-object-tells-struct-to-update/55236983#55236983", "title": "Struct Fields Not Updating When Another Object Tells Struct to Update", "body": "<p>The type of a method's receiver should be a pointer type if you want that method to modify the receiver's state.</p>\n\n<p>That is, the same way as you've declared the <code>growOld</code> method, the <code>tellDogToGrowOld</code> method should also have a pointer reciever:</p>\n\n<pre><code>func (owner *Owner) tellDogToGrowOld() {\n    owner.dog.growOld()\n}\n</code></pre>\n\n<p>Alternatively, you could make the field that you want to modify to be a pointer, e.g.:</p>\n\n<pre><code>type Owner struct {\n    dog *Dog\n}\n\nfunc newOwner(dog *Dog) Owner {\n    var owner Owner\n    owner.dog = dog\n\n    return owner\n}\n\nfunc (owner Owner) tellDogToGrowOld() {\n    owner.dog.growOld()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 3, "last_activity_date": 1552985981, "creation_date": 1552985981, "answer_id": 55236995, "question_id": 55236767, "link": "https://stackoverflow.com/questions/55236767/struct-fields-not-updating-when-another-object-tells-struct-to-update/55236995#55236995", "title": "Struct Fields Not Updating When Another Object Tells Struct to Update", "body": "<p>Set the field in the Owner to be a *Dog not a Dog</p>\n\n<pre><code>type Owner struct {\n    dog *Dog\n}\n\nfunc newOwner(dog *Dog) Owner {\n    var owner Owner\n    owner.dog = dog\n\n    return owner\n}\n</code></pre>\n\n<p>when calling from main use &amp;dog</p>\n\n<pre><code>var dog Dog\n    dog.name = \"dog\"\n\n    owner := newOwner(&amp;dog)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LpFqW09dOs4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LpFqW09dOs4</a></p>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 55236983, "answer_count": 2, "score": 1, "last_activity_date": 1552985981, "creation_date": 1552985295, "question_id": 55236767, "link": "https://stackoverflow.com/questions/55236767/struct-fields-not-updating-when-another-object-tells-struct-to-update", "title": "Struct Fields Not Updating When Another Object Tells Struct to Update", "body": "<p>I have the following <code>struct</code> that has a function that can update its fields:</p>\n\n<pre><code>type Dog struct {\n    name string\n    age  int\n}\n\nfunc (dog *Dog) growOld() {    \n    dog.name = \"old dog\"\n    dog.age++\n}\n</code></pre>\n\n<p>The above works fine on its own. However, when the <code>struct</code> belongs to another object and said object tells the <code>struct</code> to update its fields, the changes seem to occur but do not get applied:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Owner struct {\n    dog Dog\n}\n\nfunc newOwner(dog Dog) Owner {\n    var owner Owner\n    owner.dog = dog\n\n    return owner\n}\n\nfunc (owner Owner) tellDogToGrowOld() {\n    owner.dog.growOld()\n}\n\nfunc main() {\n    var dog Dog\n    dog.name = \"dog\"\n\n    owner := newOwner(dog)\n    owner.tellDogToGrowOld()       \n\n    fmt.Println(dog) // dog's name is still `dog` and age is 0.\n}\n</code></pre>\n\n<p>I assume I have to use <code>pointers</code> somehow but can't quite figure out how.</p>\n"}, {"tags": ["go", "signals"], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "edited": false, "score": 0, "creation_date": 1552982999, "post_id": 55236001, "comment_id": 97205542, "body": "in your example in case of Signal Abort nothing would happen even if you comment case syscall.SIGABRT: after Signal Abort program will exit with code 0 and without corde dump to stderr  the correct behavior is to exit with 2 code with core dump information into stderr..."}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "reply_to_user": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "edited": false, "score": 0, "creation_date": 1552985973, "post_id": 55236001, "comment_id": 97207115, "body": "i find <a href=\"https://golang.org/src/os/signal/doc.go\" rel=\"nofollow noreferrer\">golang.org/src/os/signal/doc.go</a>, line 62. <code>Notify disables the default behavior for a given set of asynchronous signals and instead delivers them over one or more registered channels. Specifically, it applies to the signals SIGHUP, SIGINT, SIGQUIT, SIGABRT, and SIGTERM.</code>"}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 0, "last_activity_date": 1553012122, "last_edit_date": 1553012122, "creation_date": 1552982350, "answer_id": 55236001, "question_id": 55235615, "link": "https://stackoverflow.com/questions/55235615/is-it-possible-to-just-log-every-signal-received-and-not-change-behavior/55236001#55236001", "title": "Is it possible to just log every signal received and not change behavior?", "body": "<p>i think you want below code. The code has only a skeleton.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc main() {\n    done := make(chan bool)\n    channel := make(chan os.Signal, 1)\n\n    signal.Notify(channel)\n\n    go func() {\n        for sig := range channel {\n\n            switch sig {\n            case syscall.SIGTERM:\n                fmt.Printf(\"SIGTERM Signal %s received!\\n\", sig)\n            case syscall.SIGHUP:\n                fmt.Printf(\"SIGHUP Signal %s received!\\n\", sig)\n            case syscall.SIGPIPE:\n                fmt.Printf(\"SIGPIPE Signal %s received!\\n\", sig)\n            case syscall.SIGABRT:\n                fmt.Printf(\"SIGABRT Signal %s received!\\n\", sig)\n            default:\n                fmt.Printf(\"Unhandled Signal %s received!\\n\", sig)\n                done &lt;- true\n            }\n        }\n    }()\n\n    &lt;-done\n}\n</code></pre>\n\n<p>code updated. </p>\n"}, {"comments": [{"owner": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "edited": false, "score": 0, "creation_date": 1552990788, "post_id": 55236912, "comment_id": 97210057, "body": "could you please explain for example how to emulate SIGABRT behaviour ?"}, {"owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "reply_to_user": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "edited": false, "score": 0, "creation_date": 1552991327, "post_id": 55236912, "comment_id": 97210390, "body": "SIGABRT causes the program to exit with a stack dump - perhaps a <code>panic</code> in your SIGABRT switch clause would be sufficient. It won&#39;t be exactly the same behaviour but might be good enough for your purposes."}], "tags": [], "owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "is_accepted": false, "score": 1, "last_activity_date": 1552985714, "creation_date": 1552985714, "answer_id": 55236912, "question_id": 55235615, "link": "https://stackoverflow.com/questions/55235615/is-it-possible-to-just-log-every-signal-received-and-not-change-behavior/55236912#55236912", "title": "Is it possible to just log every signal received and not change behavior?", "body": "<p><code>Notify</code> disables the default behaviour for a given set of asynchronous signals and instead delivers them over one or more registered channels. I think that means that you can't intercept the signal without changing its behaviour.</p>\n\n<p>The <a href=\"https://golang.org/pkg/os/signal/#hdr-Default_behavior_of_signals_in_Go_programs\" rel=\"nofollow noreferrer\">docs</a> describe default behaviour:</p>\n\n<blockquote>\n  <p>By default, a synchronous signal is converted into a run-time panic. A SIGHUP, SIGINT, or SIGTERM signal causes the program to exit. A SIGQUIT, SIGILL, SIGTRAP, SIGABRT, SIGSTKFLT, SIGEMT, or SIGSYS signal causes the program to exit with a stack dump</p>\n</blockquote>\n\n<p>It should be possible to capture the signal, handle it, then emulate default behaviour appropriate to that signal.</p>\n"}], "owner": {"reputation": 405, "user_id": 4514837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d7b33acdd2e103be6d04bd9e91d7d7?s=128&d=identicon&r=PG&f=1", "display_name": "David Mnatsakanyan", "link": "https://stackoverflow.com/users/4514837/david-mnatsakanyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1553012122, "creation_date": 1552980552, "last_edit_date": 1552982761, "question_id": 55235615, "link": "https://stackoverflow.com/questions/55235615/is-it-possible-to-just-log-every-signal-received-and-not-change-behavior", "title": "Is it possible to just log every signal received and not change behavior?", "body": "<p>I understand how to catch every signal</p>\n\n<pre><code>idleConnsClosed := make(chan bool)\nSignalChannel := make(chan os.Signal, 1)\n\n// Notify to SignalChannel any signal received\nsignal.Notify(SignalChannel)\n\ngo func() {\n    for {\n        sig := &lt;-SignalChannel\n        log.Notice(\"Signal %#v received\", sig)\n        switch sig {\n        case syscall.SIGTERM:\n            // ok sigterm, I know how to handle with it\n            log.Info(\"ShutDown HTTP server (SIGTERM)\")\n            if err := server.Shutdown(context.Background()); err != nil {\n                // Error from closing listeners, or context timeout:\n                log.Error(\"HTTP server Shutdown: %v\", err)\n            }\n        case syscall.SIGHUP:\n            //reinit configurations and do some stuff, I know how to handle this                 \n            continue\n        case syscall.SIGPIPE:\n            //Don't know what to do, just wanted to log it\n            continue\n        case syscall.SIGABRT:\n            //exit with core dump...how to do that ?\n            continue\n        default:\n            // unhandled signal?, ok how to not change it's behavior?\n            log.Warning(\"Unhandled Signal %s received!\", sig)\n        }\n        close(idleConnsClosed)\n    }\n}()\n</code></pre>\n\n<p>In general I just want to </p>\n\n<ol>\n<li>handle some understandable signals - X</li>\n<li>log every signal I get - Y</li>\n<li>do not change the behaviors of Y - X signals</li>\n</ol>\n"}, {"tags": ["git", "go", "github", "kubernetes", "app-secret"], "comments": [{"owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "edited": false, "score": 0, "creation_date": 1552978372, "post_id": 55234675, "comment_id": 97203594, "body": "Could you share the code where pull options are used ? When I try on my side it works fine."}], "answers": [{"comments": [{"owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "edited": false, "score": 0, "creation_date": 1553040058, "post_id": 55240469, "comment_id": 97235924, "body": "thank you @antham. This helped me nail down the issue but I am still not sure what&#39;s going on. I use kubernetes to deploy this service and if I specify credentials as secrets, then i get the error. However, if for testing I hard code creds, then it works fine."}, {"owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "reply_to_user": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "edited": false, "score": 0, "creation_date": 1553063629, "post_id": 55240469, "comment_id": 97241443, "body": "Did you try to dump credentials to see what you have in ?"}, {"owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "edited": false, "score": 0, "creation_date": 1553100145, "post_id": 55240469, "comment_id": 97263313, "body": "yeah I can see the credentials as they should be. I will now try your code and see if it has same behavior"}, {"owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "edited": false, "score": 0, "creation_date": 1553105312, "post_id": 55240469, "comment_id": 97266191, "body": "Updated question. Unless I am doing some really silly mistake, seems like we have some issue."}, {"owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "edited": false, "score": 0, "creation_date": 1553207318, "post_id": 55240469, "comment_id": 97309567, "body": "did not know this: <a href=\"https://github.com/kubernetes/kubernetes/issues/23404\" rel=\"nofollow noreferrer\">github.com/kubernetes/kubernetes/issues/23404</a>. Secret was having a new line and was causing this to fail. Holy ****"}], "tags": [], "owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "is_accepted": false, "score": 1, "last_activity_date": 1552996876, "last_edit_date": 1552996876, "creation_date": 1552996486, "answer_id": 55240469, "question_id": 55234675, "link": "https://stackoverflow.com/questions/55234675/go-git-basic-authentication-issues-when-getting-credentials-from-kubernetes-secr/55240469#55240469", "title": "go-git basic authentication issues when getting credentials from Kubernetes secrets", "body": "<p>A working example for people who would get into troubles :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/src-d/go-git.v4\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/transport/http\"\n)\n\nfunc main() {\n    r, err := git.PlainOpen(\"&lt;REPOSITORY_PATH&gt;\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    branch := fmt.Sprintf(\"refs/heads/%s\", \"master\")\n\n    w, err := r.Worktree()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := w.Pull(&amp;git.PullOptions{\n        ReferenceName: plumbing.ReferenceName(branch),\n        Auth: &amp;http.BasicAuth{\n            Username: \"&lt;GITHUB_USERNAME&gt;\",\n            Password: \"&lt;GITHUB_API_KEY&gt;\",\n        },\n    }); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553132904, "creation_date": 1552975964, "last_edit_date": 1553132904, "question_id": 55234675, "link": "https://stackoverflow.com/questions/55234675/go-git-basic-authentication-issues-when-getting-credentials-from-kubernetes-secr", "title": "go-git basic authentication issues when getting credentials from Kubernetes secrets", "body": "<p>Using go-git for a cloning a github repo. Trying to use personal token for authentication using something like this</p>\n\n<pre><code>func (g *Git) pullOptions() *gogit.PullOptions {\nbranch := fmt.Sprintf(\"refs/heads/%s\", g.BranchName)\n// Return options with token auth if enabled\nif g.GitToken != \"\" {\n    log.Debug(\"Prepare pull option using gittoken\")\n    return &amp;gogit.PullOptions{\n        ReferenceName: plumbing.ReferenceName(branch),\n        Auth: &amp;githttp.BasicAuth{\n            Username: g.GitUser,\n            Password: g.GitToken,\n        },\n    }\n}\n</code></pre>\n\n<p>Using <a href=\"https://github.com/davecgh/go-spew\" rel=\"nofollow noreferrer\">spew</a></p>\n\n<p>can also see the pull options and they seem to be valid</p>\n\n<pre><code>(*git.PullOptions)(0xc42008de60)({\nRemoteName: (string) (len=6) \"origin\",\nReferenceName: (plumbing.ReferenceName) (len=17) refs/heads/master,\nSingleBranch: (bool) false,\nDepth: (int) 0,\nAuth: (*http.BasicAuth)(0xc4203be300)(http-basic-auth - mygitid\n:*******),\nRecurseSubmodules: (git.SubmoduleRescursivity) 0,\nProgress: (sideband.Progress) &lt;nil&gt;,\nForce: (bool) false\n})\n</code></pre>\n\n<p>But keep getting this error:</p>\n\n<pre><code>time=\"2019-03-19T05:30:59Z\" level=debug msg=\"Prepare pull option using \ngittoken\"\ntime=\"2019-03-19T05:30:59Z\" level=error msg=\"Git clone error: \nauthentication required\"\n</code></pre>\n\n<p>If I switch to SSHKey auth, then this works fine. Any pointers?</p>\n\n<pre><code>EDIT-1:\n</code></pre>\n\n<p>It definitely seems to be an issue when pulling basic auth credentials from environment variables. For instance, this code does not work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n\n    log \"github.com/Sirupsen/logrus\"\n    gogit \"gopkg.in/src-d/go-git.v4\"\n    gitconfig \"gopkg.in/src-d/go-git.v4/config\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/transport/http\"\n)\n\nfunc main() {\n    var repository *gogit.Repository\n    var err error\n\n    // @TODO: Why not use clone?\n    if _, err = os.Stat(\"/tmp/repo\"); os.IsNotExist(err) {\n        repository, err = gogit.PlainInit(\"/tmp/repo\", false)\n        if err != nil {\n            log.Errorf(\"could not init local repository %s: %s\", \"/tmp\", err.Error())\n        }\n    } else {\n        repository, err = gogit.PlainOpen(\"/tmp/repo\")\n    }\n\n    //fmt.Println((repository))\n    if _, err = repository.Remote(\"origin\"); err == gogit.ErrRemoteNotFound {\n        _, err = repository.CreateRemote(&amp;gitconfig.RemoteConfig{\n            Name: \"origin\",\n            URLs: []string{\"https://xxxxx.git\"},\n        })\n        if err != nil {\n            log.Errorf(\"could not attach to origin %s: %s\", \"bb\", err.Error())\n        }\n    }\n\n    fmt.Println(\"Done with mapping\")\n\n\n    r, err := gogit.PlainOpen(\"/tmp/repo\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    //fmt.Println(r)\n    branch := fmt.Sprintf(\"refs/heads/%s\", \"master\")\n\n    fmt.Println(\"Setup wotktree\")\n    w, err := r.Worktree()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"pulling\")\n    fmt.Println(os.Getenv(\"GIT_USER\"))\n    fmt.Println(os.Getenv(\"GIT_TOKEN\"))\n    if err := w.Pull(&amp;gogit.PullOptions{\n        ReferenceName: plumbing.ReferenceName(branch),\n        Auth: &amp;http.BasicAuth{\n            // Username: \"xxxxxx\",\n            // Password: \"xxxxxxxxxx\",\n            Username: os.Getenv(\"GIT_USER\"),\n            Password: os.Getenv(\"GIT_TOKEN\"),\n        },\n    }); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"done\")\n    time.Sleep(120 * time.Second)\n}\n</code></pre>\n\n<p>However, If I hardcode credentials as below, then it works. </p>\n\n<pre><code>    Auth: &amp;http.BasicAuth{\n        Username: \"xxxxxx\",\n        Password: \"xxxxxxxxxx\",\n        // Username: os.Getenv(\"GIT_USER\"),\n        // Password: os.Getenv(\"GIT_TOKEN\"),\n    },\n</code></pre>\n\n<p>So the question now is really, how do we securely pass credentials to go-git for basic auth?  do we carve a credential helper for git but then the point of go-git not relying on native client may be defeated. </p>\n"}, {"tags": ["api", "go", "controller", "beego"], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1552979067, "post_id": 55235252, "comment_id": 97203840, "body": "<code>cannot use ptotal (type int64) as type []byte in argument to Appendgo cannot use tickets (type []interface {}) as type []byte in argument to Append</code>"}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1552979088, "post_id": 55235252, "comment_id": 97203849, "body": "total is int64, tickets is []interface{}"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "reply_to_user": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 1, "creation_date": 1552980902, "post_id": 55235252, "comment_id": 97204601, "body": "<code>append(tickets, map[string]int64{&quot;totalpage&quot;: ptotal})</code>"}], "tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 2, "last_activity_date": 1552978820, "creation_date": 1552978820, "answer_id": 55235252, "question_id": 55234195, "link": "https://stackoverflow.com/questions/55234195/how-to-append-or-combine-2-array-golang-beego/55235252#55235252", "title": "how to append or combine 2 []array golang beego", "body": "<pre><code>import \"encoding/json\"\n\nfunc Append(json1, json2 []byte) ([]byte, error) {\n    jsonArray1 := []json.RawMessage{}\n    err := json.Unmarshal(json1, &amp;jsonArray1)\n    if err != nil {\n        return nil, err\n    }\n    jsonArray2 := []json.RawMessage{}\n    err = json.Unmarshal(json2, &amp;jsonArray2)\n    if err != nil {\n        return nil, err\n    }\n    jsonArray := append(jsonArray1, jsonArray2...)\n    result, err := json.Marshal(jsonArray)\n    if err != nil {\n        return nil, err\n    }\n    return result, nil\n}\n</code></pre>\n\n<p>Hope it's you want</p>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 55235252, "answer_count": 1, "score": 0, "last_activity_date": 1552978820, "creation_date": 1552973301, "question_id": 55234195, "link": "https://stackoverflow.com/questions/55234195/how-to-append-or-combine-2-array-golang-beego", "title": "how to append or combine 2 []array golang beego", "body": "<p>I have an array like List of my data as JSON. //</p>\n\n<pre><code>[\n  {\n    \"ID\": 1,\n    ....\n    \"ClosedAt\": \"nine\"\n  },\n...\n]\n</code></pre>\n\n<p>I want to combine 2 arrays like and I tried to append them. -combine -append </p>\n\n<pre><code>[\n  {\n    \"ID\": 1,\n    ....\n    \"ClosedAt\": \"nine\"\n  },\n  {\n    \"ID\": 2,\n    ....\n    \"ClosedAt\": \"nine\"\n  },\n  {\n    \"ID\": 3,\n    ....\n    \"ClosedAt\": \"nine\"\n  },\n\n...\n\n  {\n     \"totalpage\": 10,\n  },\n]\n</code></pre>\n\n<p>Controller</p>\n\n<pre><code>tickets, ptotal, err := models.GetAllTicket(query, fields, sortby, order, offset, limit)\nif err != nil {\n    i.Data[\"json\"] = err.Error()\n} else {\n    i.Data[\"json\"] = ptotal\n    i.Data[\"json\"] = tickets\n\n}\ni.ServeJSON()\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/TeRAB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TeRAB.png\" alt=\"description of the JSON \"></a></p>\n\n<p>Beego(golang) API return JSON</p>\n"}, {"tags": ["arrays", "json", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 4497, "user_id": 2417812, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b93b8e30afdedfaae41d81f412b9085e?s=128&d=identicon&r=PG", "display_name": "Peter Souter", "link": "https://stackoverflow.com/users/2417812/peter-souter"}, "edited": false, "score": 0, "creation_date": 1553027725, "post_id": 55233800, "comment_id": 97231796, "body": "I just realised something, this will only work for the first array... can you help me add some recursive work to loop through and remove all arrays? eg. <code>{&quot;path&quot;:[{&quot;secret&#47;foo&quot;:[{&quot;capabilities&quot;:[&quot;read&quot;]}]}]}</code> becomes <code>{&quot;path&quot;:{&quot;secret&#47;foo&quot;:{&quot;capabilities&quot;:&quot;read&quot;}}}</code>"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1553061825, "last_edit_date": 1553061825, "creation_date": 1552970722, "answer_id": 55233800, "question_id": 55233520, "link": "https://stackoverflow.com/questions/55233520/recursively-changing-arrays-to-non-arrays-in-json-with-sjson-in-golang/55233800#55233800", "title": "Recursively changing arrays to non-arrays in JSON with sjson in Golang", "body": "<p>The type switch is your friend:</p>\n\n<pre><code>\n        switch t := v.(type) {\n        case []interface{}:\n            if len(t) == 1 {\n                data[k] = t[0]\n</code></pre>\n\n<p>And you may use recursion to remove inside elements, like so:</p>\n\n<pre><code>func removeOneElementSlice(data map[string]interface{}) {\n    for k, v := range data {\n        switch t := v.(type) {\n        case []interface{}:\n            if len(t) == 1 {\n                data[k] = t[0]\n                if v, ok := data[k].(map[string]interface{}); ok {\n                    removeOneElementSlice(v)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I would do <a href=\"https://play.golang.org/p/Ixp_EhCWkdU\" rel=\"nofollow noreferrer\">this</a> to convert<br>\n<code>{\"path\":[{\"secret/foo\":[{\"capabilities\":[\"read\"]}]}]}</code><br>\nto<br>\n <code>{\"path\":{\"secret/foo\":{\"capabilities\":\"read\"}}}</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    s := `{\"path\":[{\"secret/foo\":[{\"capabilities\":[\"read\"]}]}]}`\n    fmt.Println(s)\n    var data map[string]interface{}\n    if err := json.Unmarshal([]byte(s), &amp;data); err != nil {\n        panic(err)\n    }\n\n    removeOneElementSlice(data)\n\n    buf, err := json.Marshal(data)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(buf)) //{\"a\":\"a\",\"n\":7}\n}\nfunc removeOneElementSlice(data map[string]interface{}) {\n    for k, v := range data {\n        switch t := v.(type) {\n        case []interface{}:\n            if len(t) == 1 {\n                data[k] = t[0]\n                if v, ok := data[k].(map[string]interface{}); ok {\n                    removeOneElementSlice(v)\n                }\n            }\n        }\n    }\n}\n\n</code></pre>\n"}], "owner": {"reputation": 4497, "user_id": 2417812, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b93b8e30afdedfaae41d81f412b9085e?s=128&d=identicon&r=PG", "display_name": "Peter Souter", "link": "https://stackoverflow.com/users/2417812/peter-souter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 55233800, "answer_count": 1, "score": 1, "last_activity_date": 1553062340, "creation_date": 1552968583, "last_edit_date": 1553062340, "question_id": 55233520, "link": "https://stackoverflow.com/questions/55233520/recursively-changing-arrays-to-non-arrays-in-json-with-sjson-in-golang", "title": "Recursively changing arrays to non-arrays in JSON with sjson in Golang", "body": "<p>What I'm trying to do:</p>\n\n<p><strong>Transform all arrays of length 1 in a JSON file to non arrays.</strong></p>\n\n<p>e.g. </p>\n\n<p>Input: <code>{\"path\": [{\"secret/foo\": [{\"capabilities\": [\"read\"]}]}]}</code></p>\n\n<p>Output: <code>{\"path\": {\"secret/foo\": {\"capabilities\": \"read\"}}}</code></p>\n\n<p>I can't use Structs as the JSON format will vary...</p>\n\n<p>Right now I've managed to at least detect the 1 length slices:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc findSingletons(value interface{}) {\n    switch value.(type) {\n    case []interface{}:\n        if len(value.([]interface{})) == 1 {\n            fmt.Println(\"1 length array found!\", value)\n        }\n        for _, v := range value.([]interface{}) {\n            findSingletons(v)\n        }\n    case map[string]interface{}:\n        for _, v := range value.(map[string]interface{}) {\n            findSingletons(v)\n        }\n    }\n}\n\nfunc removeSingletonsFromJSON(input string) {\n    jsonFromInput := json.RawMessage(input)\n    jsonMap := make(map[string]interface{})\n    err := json.Unmarshal([]byte(jsonFromInput), &amp;jsonMap)\n\n    if err != nil {\n        panic(err)\n    }\n\n    findSingletons(jsonMap)\n\n    fmt.Printf(\"JSON value of without singletons:%s\\n\", jsonMap)\n}\n\nfunc main() {\n    jsonParsed := []byte(`{\"path\": [{\"secret/foo\": [{\"capabilities\": [\"read\"]}]}]}`)\n    removeSingletonsFromJSON(string(jsonParsed))\n    fmt.Println(`Should have output {\"path\": {\"secret/foo\": {\"capabilities\": \"read\"}}}`)\n}\n</code></pre>\n\n<p>Which outputs</p>\n\n<pre><code>1 length array found! [map[secret/foo:[map[capabilities:[read]]]]]\n1 length array found! [map[capabilities:[read]]]\n1 length array found! [read]\nJSON value of without singletons:map[path:[map[secret/foo:[map[capabilities:[read]]]]]]\nShould have output {\"path\": {\"secret/foo\": {\"capabilities\": \"read\"}}}\n</code></pre>\n\n<p>But I'm not sure how I can change them into non-arrays...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1552957843, "post_id": 55232261, "comment_id": 97198624, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17912893/missing-type-in-composite-literal\">Missing type in composite literal</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1552958636, "post_id": 55232261, "comment_id": 97198785, "body": "You can only elide types for map, slice or array elements.  The type is required for the <code>args</code> struct field and the <code>items</code> struct field."}, {"owner": {"reputation": 1042, "user_id": 4728007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc52f06839fc0abf6c6b812f2a1856f1?s=128&d=identicon&r=PG&f=1", "display_name": "DragonBobZ", "link": "https://stackoverflow.com/users/4728007/dragonbobz"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552961019, "post_id": 55232261, "comment_id": 97199294, "body": "@CeriseLim&#243;n I Was missing the type for <code>args</code>, which made adding the type for <code>[]map[string]int</code> not fix the problem. Thanks."}, {"owner": {"reputation": 1042, "user_id": 4728007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc52f06839fc0abf6c6b812f2a1856f1?s=128&d=identicon&r=PG&f=1", "display_name": "DragonBobZ", "link": "https://stackoverflow.com/users/4728007/dragonbobz"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1552961078, "post_id": 55232261, "comment_id": 97199307, "body": "@zerkms I saw several questions with a similar title to mine and was not able to figure out what was wrong with my program based on those answers."}], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": true, "score": 2, "last_activity_date": 1552962289, "creation_date": 1552962289, "answer_id": 55232761, "question_id": 55232261, "link": "https://stackoverflow.com/questions/55232261/missing-type-in-composite-literal-for-anonymous-list-of-maps-in-struct/55232761#55232761", "title": "&quot;Missing type in composite literal&quot; for anonymous list of maps in struct", "body": "<p>seems you miss the type of <code>args</code> and <code>[]map[string]int</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    tests := []struct {\n        name string\n        args args\n        want int\n    }{\n        {\n            \"Only test\", // name of test\n            args{\n                []map[string]int{   // items\n                    map[string]int{\n                        \"value\": 100,\n                        \"weight\": 5,\n                    },\n                    map[string]int{\n                        \"value\": 90,\n                        \"weight\": 2,\n                    },\n                    map[string]int{\n                        \"value\": 80,\n                        \"weight\": 2,\n                    },\n                },\n                0, // current_index\n                4, // remaining_weight\n            },\n            170, // want\n        },\n    }\n</code></pre>\n"}], "owner": {"reputation": 1042, "user_id": 4728007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc52f06839fc0abf6c6b812f2a1856f1?s=128&d=identicon&r=PG&f=1", "display_name": "DragonBobZ", "link": "https://stackoverflow.com/users/4728007/dragonbobz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 0, "accepted_answer_id": 55232761, "answer_count": 1, "score": 0, "last_activity_date": 1552962289, "creation_date": 1552957645, "last_edit_date": 1552961617, "question_id": 55232261, "link": "https://stackoverflow.com/questions/55232261/missing-type-in-composite-literal-for-anonymous-list-of-maps-in-struct", "title": "&quot;Missing type in composite literal&quot; for anonymous list of maps in struct", "body": "<p><strong>Edit</strong>: While the compilation error in <a href=\"https://stackoverflow.com/questions/17912893/missing-type-in-composite-literal\">Missing type in composite literal</a> is the same as that in my question, they were different enough in composition for me to not understand how I would apply the solution to my program, hence the creation of this question.</p>\n\n<p>I am new to go, and I am trying to write a test for a function which I have verified can successfully can be called like so:</p>\n\n<pre><code>func main() {\n\n    items := []map[string]int{\n        map[string]int{\n            \"value\": 100,\n            \"weight\": 5,\n        },\n        map[string]int{\n            \"value\": 90,\n            \"weight\": 2,\n        },\n        map[string]int{\n            \"value\": 80,\n            \"weight\": 2,\n        },\n    }\n    fmt.Println(KnapSack(items, 0, 6))\n}\n</code></pre>\n\n<p>Using this template (generated by my IDE) for convenience:</p>\n\n<pre><code>func TestKnapSack(t *testing.T) {\n    type args struct {\n        items            []map[string]int\n        current_index    int\n        remaining_weight int\n    }\n    tests := []struct {\n        name string\n        args args\n        want int\n    }{\n        {\n            \"Only test\", // name of test\n            {\n                {   // items\n                    map[string]int{\n                        \"value\": 100,\n                        \"weight\": 5,\n                    },\n                    map[string]int{\n                        \"value\": 90,\n                        \"weight\": 2,\n                    },\n                    map[string]int{\n                        \"value\": 80,\n                        \"weight\": 2,\n                    },\n                },\n                0, // current_index\n                4, // remaining_weight\n            },\n            170, // want\n        },\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            if got := KnapSack(tt.args.items, tt.args.current_index, tt.args.remaining_weight); got != tt.want {\n                t.Errorf(\"KnapSack() = %v, want %v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>The <code>args</code> struct does not like my array of maps. How can I fill this struct so that it will compile?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 5641831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/toPyd.jpg?s=128&g=1", "display_name": "Cory", "link": "https://stackoverflow.com/users/5641831/cory"}, "is_accepted": false, "score": 0, "last_activity_date": 1552947121, "last_edit_date": 1552947121, "creation_date": 1552946636, "answer_id": 55230712, "question_id": 55229214, "link": "https://stackoverflow.com/questions/55229214/how-to-row-scan-int32-into-golang-grpc-protobuf-enum-field/55230712#55230712", "title": "How to row.Scan() int32 into Golang gRPC protobuf Enum field?", "body": "<p>I usually work with Go types within the business domain, and use adapters to convert to/from the protobuf type.</p>\n\n<pre><code>// Role represents a set of permissions\ntype Role struct {\n    KILLNONE = iota\n    KILLALL\n    DANCE\n}\n\n// Permission represents a set of agent permissions\ntype Permission struct {\n    Role Role\n}\n\n// ToProto converts a Permission Go type to a protobuf Permission\nfunc (p Permission) ToProto() (proto.Permission) {\n    pb := proto.Permission{}\n    // assign p's properties to proto's respective properties\n    // with necessary type conversions.\n    ...\n    return pb\n}\n</code></pre>\n\n<p>The protobuf examples usually show working with the protobuf types directly, but it seems like adapters are more common in the field.</p>\n"}], "owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555271309, "creation_date": 1552939367, "last_edit_date": 1555271309, "question_id": 55229214, "link": "https://stackoverflow.com/questions/55229214/how-to-row-scan-int32-into-golang-grpc-protobuf-enum-field", "title": "How to row.Scan() int32 into Golang gRPC protobuf Enum field?", "body": "<pre><code>// agent.proto\n\nmessage Agent {\n    Permission permission = 1;\n    google.protobuf.Timestamp born_time = 2;\n\n    message Permission {\n        Type type = 1;\n\n        enum Type {\n            KILLNONE = 0;\n            KILLALL = 1;\n            DANCE = 2;\n        }\n   }\n}\n</code></pre>\n\n<p>Then scanning SQL row into agent protobuf struct:</p>\n\n<pre><code>// main.go\n\nvar a proto.Agent\n\n.....\n\n... row.Scan(&amp;a.Permission.Type,...)\n</code></pre>\n\n<p>That permission type is stored as simple MariaDB INT() <code>value = 0</code> for default type. So, i can't scan it directly. So i made temp struct where <code>Type int32</code> and scaned row into that temp struct after what tried to map temp struct fields to protobuf struct, but with no luck.\nSimilar issues i had when want to scan MariaDB string values into []byte type fields but i solved that with my temp struct <code>[]byte(tmp.UUID)</code>.</p>\n\n<p>What is common patterns to scan database ROW (single row) into protubuf message when non-standard protobuf field types are used?</p>\n\n<p>EDIT: Does there should be some additional <code>0</code> value handling?</p>\n"}, {"tags": ["go", "grpc", "envoyproxy", "grpc-go"], "comments": [{"owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "edited": false, "score": 0, "creation_date": 1552980072, "post_id": 55228706, "comment_id": 97204247, "body": "The gRPC library should handle delivering the status code appropriately (see <a href=\"https://godoc.org/google.golang.org/grpc/status\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/grpc/status</a>). Do you have a code example of what you believe should work and more about what you have tried?"}, {"owner": {"reputation": 96, "user_id": 6765741, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9k0yD80j89k/AAAAAAAAAAI/AAAAAAAAALk/x519PtDPm8U/photo.jpg?sz=128", "display_name": "Eric Fernandes", "link": "https://stackoverflow.com/users/6765741/eric-fernandes"}, "reply_to_user": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "edited": false, "score": 0, "creation_date": 1553009164, "post_id": 55228706, "comment_id": 97222031, "body": "@benjaminjosephw You are right that the error codes inside an error object are appropriately transmitted from gRPC Server to the Client. But Envoy Proxy requires the error codes to be sent inside a Response Header. I haven&#39;t been able to find a way to achieve this."}, {"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1553251474, "post_id": 55228706, "comment_id": 97324088, "body": "Just in case if you missed it, take a look at <a href=\"https://github.com/improbable-eng/grpc-web\" rel=\"nofollow noreferrer\">github.com/improbable-eng/grpc-web</a>. Perhaps you&#39;ll be able to drop Envoy  layer."}], "owner": {"reputation": 96, "user_id": 6765741, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9k0yD80j89k/AAAAAAAAAAI/AAAAAAAAALk/x519PtDPm8U/photo.jpg?sz=128", "display_name": "Eric Fernandes", "link": "https://stackoverflow.com/users/6765741/eric-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555271331, "creation_date": 1552937175, "last_edit_date": 1555271331, "question_id": 55228706, "link": "https://stackoverflow.com/questions/55228706/configuring-envoy-proxy-retry-mechanism-for-grpc-service", "title": "Configuring Envoy proxy &quot;retry&quot; mechanism for gRPC service", "body": "<p>I am trying to configure Envoy proxy \"retry\" mechanism for a gRPC service written in Go. gRPC retries are currently only supported for gRPC status codes in response headers. Is there a way to send status codes in the header so that Envoy can intercept?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 2, "creation_date": 1552935446, "post_id": 55228174, "comment_id": 97191144, "body": "Incomplete answer to your second question: if you have <a href=\"https://play.golang.org/p/xJdJHAqqZz_1\" rel=\"nofollow noreferrer\">some test code,</a> you can verify things like this empirically by just writing new information to one of the values; if it affects the other one, then you have a new reference instead of a copy of the original memory."}, {"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 2, "creation_date": 1552935526, "post_id": 55228174, "comment_id": 97191181, "body": "Where did you look for information on this topic? I&#39;m sure this exact topic is documented really well. You should at least read the introduction and the effective go documents, both available at <a href=\"https://golang.org\" rel=\"nofollow noreferrer\">golang.org</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1552935654, "post_id": 55228174, "comment_id": 97191249, "body": "Technical answer to the second question: <i>everything is a copy</i>, you just need to know <i>what</i> you are copying. In the case of slices, maps, pointers, and interfaces, it&#39;s a pointer that&#39;s being copied."}, {"owner": {"reputation": 981, "user_id": 4637358, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/sIfTB.jpg?s=128&g=1", "display_name": "1a1a11a", "link": "https://stackoverflow.com/users/4637358/1a1a11a"}, "edited": false, "score": 0, "creation_date": 1552948176, "post_id": 55228174, "comment_id": 97196272, "body": "Thank you all, the information is really helpful!"}], "answers": [{"comments": [{"owner": {"reputation": 981, "user_id": 4637358, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/sIfTB.jpg?s=128&g=1", "display_name": "1a1a11a", "link": "https://stackoverflow.com/users/4637358/1a1a11a"}, "edited": false, "score": 1, "creation_date": 1552948222, "post_id": 55228293, "comment_id": 97196300, "body": "Thank you! This is really helpful!"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 2, "last_activity_date": 1552936195, "last_edit_date": 1552936195, "creation_date": 1552935398, "answer_id": 55228293, "question_id": 55228174, "link": "https://stackoverflow.com/questions/55228174/does-slice-assignment-in-go-copy-memory/55228293#55228293", "title": "Does slice assignment in Go copy memory", "body": "<ol>\n<li>No</li>\n</ol>\n\n<p>Slice is just a pointer to memory + <code>len</code> and <code>cap</code><br>\nsee: <a href=\"https://stackoverflow.com/questions/30182538/why-can-not-i-duplicate-a-slice-with-copy-in-golang\">Why can not I duplicate a slice with `copy()` in Golang?</a></p>\n\n<hr>\n\n<ol start=\"2\">\n<li>Like so:</li>\n</ol>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    bigBuf := []byte{1, 2, 3, 4, 5}\n\n    datPtrs := make([][]byte, 2)\n    for i := 0; i &lt; 2; i++ {\n        datPtrs[i] = bigBuf[i : i+1]\n    }\n    fmt.Println(bigBuf) // [1 2 3 4 5]\n    datPtrs[0][0] = 10\n    fmt.Println(bigBuf) // [10 2 3 4 5]\n\n    datPtrs[1][0] = 20\n    fmt.Println(bigBuf) // [10 20 3 4 5]\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1552936536, "last_edit_date": 1552936536, "creation_date": 1552935416, "answer_id": 55228303, "question_id": 55228174, "link": "https://stackoverflow.com/questions/55228174/does-slice-assignment-in-go-copy-memory/55228303#55228303", "title": "Does slice assignment in Go copy memory", "body": "<p>Go slices are implemented as a struct:</p>\n\n<p><code>src/runtime/slice.go</code>:</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>You are assigning/copying the slice struct, which does not copy the underlying array, only its pointer.</p>\n\n<hr>\n\n<p>A simple illustration:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    buf := make([]byte, 8)\n    for i := range buf {\n        buf[i] = byte(i)\n    }\n    sub := buf[1:3]\n    fmt.Println(buf)\n    fmt.Println(sub)\n    for i := range sub {\n        sub[i] += 43\n    }\n    fmt.Println(buf)\n    fmt.Println(sub)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/4OzPwuNmUlY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4OzPwuNmUlY</a></p>\n\n<p>Output:</p>\n\n<pre><code>[0 1 2 3 4 5 6 7]\n[1 2]\n[0 44 45 3 4 5 6 7]\n[44 45]\n</code></pre>\n\n<hr>\n\n<p>See <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a>,</p>\n"}], "owner": {"reputation": 981, "user_id": 4637358, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/sIfTB.jpg?s=128&g=1", "display_name": "1a1a11a", "link": "https://stackoverflow.com/users/4637358/1a1a11a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1215, "favorite_count": 1, "accepted_answer_id": 55228303, "answer_count": 2, "score": 2, "last_activity_date": 1552948094, "creation_date": 1552934941, "last_edit_date": 1552948094, "question_id": 55228174, "link": "https://stackoverflow.com/questions/55228174/does-slice-assignment-in-go-copy-memory", "title": "Does slice assignment in Go copy memory", "body": "<p>Purpose: I have a big buffer, and I would like to have an array/slice of pointer pointing to different loc in the buffer. </p>\n\n<p>What I am doing: </p>\n\n<pre><code>datPtrs := make([][]byte, n)\nfor i:=0; i&lt;n; i++{\n    datPtrs[i] = bigBuf[i*m:(i+1)*m]\n}\n</code></pre>\n\n<p>My Question: </p>\n\n<ol>\n<li>Will this copy memory? My guess is not, but I cannot find anywhere to confirm this. </li>\n<li>What is the best way/tool to find out whether there is memory copy or not? </li>\n</ol>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 7116, "user_id": 518004, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/bc10c7edd7524e1a05de670a3f0399a4?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/518004/will"}, "edited": false, "score": 0, "creation_date": 1552930063, "post_id": 55226885, "comment_id": 97188481, "body": "would I need to change my original struct def?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7116, "user_id": 518004, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/bc10c7edd7524e1a05de670a3f0399a4?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/518004/will"}, "edited": false, "score": 1, "creation_date": 1552930081, "post_id": 55226885, "comment_id": 97188492, "body": "No.  Just call the function as shown in the answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1552929928, "creation_date": 1552929928, "answer_id": 55226885, "question_id": 55226811, "link": "https://stackoverflow.com/questions/55226811/func-rs-rows-scan-to-handle-a-column-type-of-array-string/55226885#55226885", "title": "func (rs *Rows) Scan to handle a column type of array string", "body": "<p>Use <a href=\"https://godoc.org/github.com/lib/pq#Array\" rel=\"nofollow noreferrer\">pq.Array</a> when scanning an array:</p>\n\n<pre><code>    err = rows.Scan(&amp;d.deviceID, &amp;d.name, pq.Array(&amp;d.tags), &amp;d.macAddress, &amp;d.agentID, &amp;d.groupType)\n    if err != nil {\n        return nil, err\n    }\n</code></pre>\n"}], "owner": {"reputation": 7116, "user_id": 518004, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/bc10c7edd7524e1a05de670a3f0399a4?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/518004/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 55226885, "answer_count": 1, "score": 0, "last_activity_date": 1552929928, "creation_date": 1552929669, "question_id": 55226811, "link": "https://stackoverflow.com/questions/55226811/func-rs-rows-scan-to-handle-a-column-type-of-array-string", "title": "func (rs *Rows) Scan to handle a column type of array string", "body": "<p>I have a column within my Postgres db for tags which is an array of strings.</p>\n\n<p>I have it defined within a struct in my golang as:</p>\n\n<pre><code>type device struct {\n    deviceID   string\n    macAddress sql.NullString\n    name       sql.NullString\n    agentID    sql.NullString\n    groupType  sql.NullString\n    tags       []string\n\n    normalized           bool\n    normalizedName       string\n    normalizedMacAddress string\n}\n</code></pre>\n\n<p>When I run the scan on the rows as such:</p>\n\n<pre><code>            err = rows.Scan(&amp;d.deviceID, &amp;d.name, &amp;d.tags, &amp;d.macAddress, &amp;d.agentID, &amp;d.groupType)\n        if err != nil {\n            return nil, err\n        }\n</code></pre>\n\n<p>It returns the following error:</p>\n\n<pre><code>\"sql: Scan error on column index 2, name \"tags\": unsupported Scan...+55 more\"\n</code></pre>\n\n<p>So what kinda of wrapper do I need for a string array in order to be an acceptable type?</p>\n"}, {"tags": ["go", "ssh"], "owner": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 181, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1552928708, "creation_date": 1552928105, "last_edit_date": 1552928708, "question_id": 55226383, "link": "https://stackoverflow.com/questions/55226383/reuse-connection-from-socket-created-by-the-openssh-client", "title": "Reuse connection from socket created by the OpenSSH client", "body": "<p>OpenSSH client has a feature called \"ControlMaster\" that allows to reuse connections between multiple ssh sessions over a single network connection.</p>\n\n<p>I was wondering if it was possible using <code>x/crypto/ssh</code> package of Golang to reuse a connection from a socket that has been created by the OpenSSH client with a command like:</p>\n\n<p><code>ssh -M -f -N -o ControlPath=$HOME/.ssh/shared.sock myUsername@targetServerName</code></p>\n\n<p>Is there any way to create a Golang Client from this <code>$HOME/.ssh/shared.sock</code> socket?</p>\n\n<p>We usually use the <code>Dial</code> function to create the Client.</p>\n\n<p><code>func Dial(network, addr string, config *ClientConfig) (*Client, error)</code></p>\n\n<p>But I see there is as well the <code>NewClient</code> function that seems to be for reusing an existing connection.</p>\n\n<p><code>func NewClient(c Conn, chans &lt;-chan NewChannel, reqs &lt;-chan *Request) *Client</code></p>\n\n<p>I struggle to understand how I can instantiate the <code>Conn</code> and the two channels in a proper way.</p>\n\n<p>Maybe it is not doable at all?</p>\n\n<p>The aim is to be able to implement a kind of wrapper of the OpenSSH client and trigger commands using Golang before/after calling the actual OpenSSH client process. It would as well avoid having to reimplement the target host/port logic and the authentication.</p>\n"}, {"tags": ["go", "testing", "goland"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1552922321, "post_id": 55224561, "comment_id": 97184058, "body": "<code>.&#47;...</code> doesn&#39;t include <code>.&#47;vendor</code>, so you don&#39;t need that grep. Otherwise, what&#39;s wrong with another grep?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552922365, "post_id": 55224561, "comment_id": 97184084, "body": "As of Go 1.9, or so, <code>.&#47;...</code> already excludes the vendor directory. Upgrade to a newer version of Go."}, {"owner": {"reputation": 177, "user_id": 2728356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e2c837e716365738c92ed8948553a97?s=128&d=identicon&r=PG&f=1", "display_name": "kishu", "link": "https://stackoverflow.com/users/2728356/kishu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552922548, "post_id": 55224561, "comment_id": 97184202, "body": "@Flimzy my version is already : go version go1.11.1 linux/amd64"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552922665, "post_id": 55224561, "comment_id": 97184277, "body": "Good. Then you don&#39;t need that <code>grep -v &#47;vendor&#47;</code> stuff."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 10, "last_activity_date": 1552922552, "creation_date": 1552922552, "answer_id": 55224660, "question_id": 55224561, "link": "https://stackoverflow.com/questions/55224561/how-to-exclude-or-skip-specific-directory-while-running-go-test/55224660#55224660", "title": "How to exclude or skip specific directory while running &#39;go test&#39;", "body": "<p>You're already doing it:</p>\n\n<pre><code>$(go list ./... | grep -v /vendor/)\n</code></pre>\n\n<p>The <code>grep -v /vendor/</code> part is to exclude the <code>/vendor/</code> directory.  So just do the same for your <code>Store</code> directory:</p>\n\n<pre><code>go test $(go list ./... | grep -v /Store/) -coverprofile .testCoverage.txt\n</code></pre>\n\n<p>Note that excluding <code>/vendor/</code> this way is not necessary (unless you're using a really old version of Go). If you are using an old version of Go, you can combine them:</p>\n\n<pre><code>go test $(go list ./... | grep -v /vendor/ | grep -v /Store/) -coverprofile .testCoverage.txt\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 2728356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e2c837e716365738c92ed8948553a97?s=128&d=identicon&r=PG&f=1", "display_name": "kishu", "link": "https://stackoverflow.com/users/2728356/kishu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7196, "favorite_count": 0, "closed_date": 1552922884, "accepted_answer_id": 55224660, "answer_count": 1, "score": 5, "last_activity_date": 1552922552, "creation_date": 1552922233, "last_edit_date": 1552922342, "question_id": 55224561, "link": "https://stackoverflow.com/questions/55224561/how-to-exclude-or-skip-specific-directory-while-running-go-test", "closed_reason": "Duplicate", "title": "How to exclude or skip specific directory while running &#39;go test&#39;", "body": "<pre><code>go test $(go list ./... | grep -v /vendor/) -coverprofile .testCoverage.txt\n</code></pre>\n\n<p>I am using the above command to test the files but there is 1 folder with the name \"Store\" that I want to exclude from tests. How it can be done? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1552918488, "post_id": 55222932, "comment_id": 97181580, "body": "What is the output?"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10967256, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WmoAclaLd1A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQN4T3K3MHcbtcjgIEJ2k5oGKGdS0Q/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/10967256/deniz-tohumcu"}, "edited": false, "score": 0, "creation_date": 1552919056, "post_id": 55223516, "comment_id": 97181931, "body": "I corrected the issue and now it is running but althought it executes the commands I can&#39;t see my can interface with ifconfig once the execution is finished @colminator"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1552939307, "last_edit_date": 1552939307, "creation_date": 1552918829, "answer_id": 55223516, "question_id": 55222932, "link": "https://stackoverflow.com/questions/55222932/how-to-execute-a-command-line/55223516#55223516", "title": "How to execute a command line", "body": "<p>Your go code looks correct. The problem lies with <code>sudo</code>, I believe. I replaced your commands with benign commands like <code>sudo touch /tmp/bringUp-executed</code> etc. The code did prompted for my sudo password - but once inputed - completed without issue.</p>\n\n<p>Are you running your go-executable in a headless fashion? And thus has no access to the console for password input? I would suggest creating wrapper scripts for your any root-level tasks and give them password-less <code>sudoer</code> privileges as outlined <a href=\"https://unix.stackexchange.com/a/13058\">here</a>.</p>\n"}], "owner": {"reputation": 51, "user_id": 10967256, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WmoAclaLd1A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQN4T3K3MHcbtcjgIEJ2k5oGKGdS0Q/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/10967256/deniz-tohumcu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 2, "accepted_answer_id": 55223516, "answer_count": 1, "score": 0, "last_activity_date": 1552939307, "creation_date": 1552917053, "last_edit_date": 1552917106, "question_id": 55222932, "link": "https://stackoverflow.com/questions/55222932/how-to-execute-a-command-line", "title": "How to execute a command line", "body": "<p>I am trying to execute two commands:</p>\n\n<ul>\n<li><code>sudo ip link set can0 type can bitrate 500000</code></li>\n<li><code>sudo ip link set can type can restart-ms 1000</code></li>\n</ul>\n\n<p>here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main(/*in string*/)/*(out bool)*/ {\n\n        in :=\"setup\"\n\n    switch in {\n\n    case \"setup\":\n        bringUp()\n        setRestart()\n        log.Println(\"can0 is brought up\")\n        //return true\n\n    case \"restart\":\n        setRestart()\n        log.Println(\"can0 is restarted\")\n        //return true\n\n    default:\n        log.Println(\"System cannot be brought up, contact administrator\")\n        //return false\n    }\n}\n\n\nfunc bringUp (){\n    cmd := exec.Command(\"sh\", \"-c\", \"sudo ip link set can0 type can bitrate 500000\")\n\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    err := cmd.Run()\n\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc setRestart(){\n    cmd:= exec.Command(\"sh\", \"-c\", \"sudo ip link set can type can restart-ms 10000\")\n\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    err := cmd.Run()\n\n    if err != nil{\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Whenever I execute it goes in to \"setup\" case and starts executing the bringUp function but it can never finish executing and I can't understand why. I am working on a raspberry pi.</p>\n"}, {"tags": ["api", "go", "kubernetes", "openshift"], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 9010321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97af90454bef9b2b50106888ee39af2b?s=128&d=identicon&r=PG&f=1", "display_name": "Iago Santos", "link": "https://stackoverflow.com/users/9010321/iago-santos"}, "is_accepted": false, "score": 2, "last_activity_date": 1553009684, "creation_date": 1553009684, "answer_id": 55244694, "question_id": 55222830, "link": "https://stackoverflow.com/questions/55222830/get-and-modify-yaml-file-from-openshift-api-of-the-persisten-volume-in-golang/55244694#55244694", "title": "Get and modify yaml file from OpenShift API of the persisten volume in golang", "body": "<p>Basically my error was constructing the <code>patch</code> <code>[]byte</code> value, the script should look like</p>\n\n<pre><code> pv, err := clientset.CoreV1().PersistentVolumes().List(metav1.ListOptions{})\n\n\n    for _, persV := range pv.Items {\n        // Check status persistent volume\n        pvStatus, err := clientset.CoreV1().PersistentVolumes().Get(persV.Name, metav1.GetOptions{})\n        if err != nil {\n            panic(err.Error())\n        }\n\n        patch := []byte(`{\"spec\": {\"persistentVolumeReclaimPolicy\": \"Delete\"}}`)\n        _, err = clientset.CoreV1().PersistentVolumes().Patch(persV.Name, types.StrategicMergePatchType, patch)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 9010321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97af90454bef9b2b50106888ee39af2b?s=128&d=identicon&r=PG&f=1", "display_name": "Iago Santos", "link": "https://stackoverflow.com/users/9010321/iago-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1553009684, "creation_date": 1552916740, "last_edit_date": 1552923941, "question_id": 55222830, "link": "https://stackoverflow.com/questions/55222830/get-and-modify-yaml-file-from-openshift-api-of-the-persisten-volume-in-golang", "title": "Get and modify yaml file from OpenShift API of the persisten volume in golang", "body": "<p>I am trying to modify the <code>yaml</code> file of a <code>persistent volume</code> in <code>OpenShift</code> through the API in <code>Go(lang)</code>, I have the following</p>\n\n<pre><code>    pv, err := clientset.CoreV1().PersistentVolumes().List(metav1.ListOptions{})\n\n\n    for _, persV := range pv.Items {\n        // Check status persistent volume\n        pvStatus, err := clientset.CoreV1().PersistentVolumes().Get(persV.Name, metav1.GetOptions{})\n        if err != nil {\n            panic(err.Error())\n        }\n\n        patch := []byte(`{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"persistentVolumeReclaimPolicy\":\"Retain\"}]}}}}`)\n        a := fmt.Sprintf(\"%s\", patch)\n        fmt.Println(a)\n        _, err = clientset.CoreV1().PersistentVolumes().Patch(persV.Name, types.StrategicMergePatchType, patch)\n}\n\n</code></pre>\n\n<p>my <code>persistent volume</code> <code>yaml</code></p>\n\n<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n...\n...\n...\npersistentVolumeReclaimPolicy: Retain\nstatus:\n  phase: Released\n</code></pre>\n\n<p>How could I get the <code>yaml</code> file and modify it from my actual <code>pvStatus</code>?\nI would like to change <code>persistentVolumeReclaimPolicy: Retain</code> to <code>persistentVolumeReclaimPolicy: Delete</code></p>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1552912758, "post_id": 55221261, "comment_id": 97177931, "body": "This is very hard to answer since it primarily depends on the functionality you try to test."}, {"owner": {"reputation": 659, "user_id": 6845084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253b377ee6c971f363de927136d30117?s=128&d=identicon&r=PG", "display_name": "Palash Nigam", "link": "https://stackoverflow.com/users/6845084/palash-nigam"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1552929565, "post_id": 55221261, "comment_id": 97188218, "body": "@RickyA I have added more details about the implementation and the codebase to the description"}], "owner": {"reputation": 659, "user_id": 6845084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253b377ee6c971f363de927136d30117?s=128&d=identicon&r=PG", "display_name": "Palash Nigam", "link": "https://stackoverflow.com/users/6845084/palash-nigam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 264, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552985763, "creation_date": 1552911559, "last_edit_date": 1552929519, "question_id": 55221261, "link": "https://stackoverflow.com/questions/55221261/is-it-a-good-practice-to-use-use-the-same-httptest-server-for-multiple-methods", "title": "Is it a good practice to use use the same httptest server for multiple methods", "body": "<p>I am trying to test some golang code and I have a method that calls several other methods from its body. All these methods perform some kind of operations using an elastic search client. I wanted to know whether  it will be a good practice if I used a test server for testing this method that will write different responses depending upon the request method and path it received from the request that is made when the methods inside the body execute and make calls to the elasticsearch client that sends the requests to my test server?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I am testing an elasticsearch middleware. It implements a reindex service like this</p>\n\n<pre><code>type reindexService interface {\n    reindex(ctx context.Context, index string, mappings, settings map[string]interface{}, includes, excludes, types []string) error\n    mappingsOf(ctx context.Context, index string) (map[string]interface{}, error)\n    settingsOf(ctx context.Context, index string) (map[string]interface{}, error)\n    aliasesOf(ctx context.Context, index string) ([]string, error)\n    createIndex(ctx context.Context, name string, body map[string]interface{}) error\n    deleteIndex(ctx context.Context, name string) error\n    setAlias(ctx context.Context, index string, aliases ...string) error\n    getIndicesByAlias(ctx context.Context, alias string) ([]string, error)\n}\n\n</code></pre>\n\n<p>I can easily test all the methods using this pattern. Creating a simple elastic search client using a httptest server url and making requests to that server</p>\n\n<pre><code>var createIndexTests = []struct {\n    setup *ServerSetup\n    index string\n    err   string\n}{\n    {\n        &amp;ServerSetup{\n            Method:   \"PUT\",\n            Path:     \"/test\",\n            Body:     `null`,\n            Response: `{\"acknowledged\": true, \"shards_acknowledged\": true, \"index\": \"test\"}`,\n        },\n        \"test\",\n        \"\",\n    },\n   // More test cases here\n}\n\nfunc TestCreateIndex(t *testing.T) {\n    for _, tt := range createIndexTests {\n        t.Run(\"Should successfully create index with a valid setup\", func(t *testing.T) {\n            ctx := context.Background()\n            ts := buildTestServer(t, tt.setup)\n            defer ts.Close()\n            es, _ := newTestClient(ts.URL)\n            err := es.createIndex(ctx, tt.index, nil)\n            if !compareErrs(tt.err, err) {\n                t.Fatalf(\"Index creation should have failed with error: %v got: %v instead\\n\", tt.err, err)\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>But in case of <code>reindex</code> method this approach poses a problem since reindex makes calls to all the other methods inside its body. reindex looks something like this:</p>\n\n<pre><code>func (es *elasticsearch) reindex(ctx context.Context, indexName string, mappings, settings map[string]interface{}, includes, excludes, types []string) error {\n    var err error\n\n    // Some preflight checks\n\n    // If mappings are not passed, we fetch the mappings of the old index.\n    if mappings == nil {\n        mappings, err = es.mappingsOf(ctx, indexName)\n        // handle err\n    }\n\n    // If settings are not passed, we fetch the settings of the old index.\n    if settings == nil {\n        settings, err = es.settingsOf(ctx, indexName)\n        // handle err\n    }\n\n    // Setup the destination index prior to running the _reindex action.\n    body := make(map[string]interface{})\n    body[\"mappings\"] = mappings\n    body[\"settings\"] = settings\n\n    newIndexName, err := reindexedName(indexName)\n    // handle err\n\n    err = es.createIndex(ctx, newIndexName, body)\n    // handle err\n\n    // Some additional operations\n\n    // Reindex action.\n    _, err = es.client.Reindex().\n        Body(reindexBody).\n        Do(ctx)\n    // handle err\n\n    // Fetch all the aliases of old index\n    aliases, err := es.aliasesOf(ctx, indexName)\n    // handle err\n    aliases = append(aliases, indexName)\n\n    // Delete old index\n    err = es.deleteIndex(ctx, indexName)\n    // handle err\n\n    // Set aliases of old index to the new index.\n    err = es.setAlias(ctx, newIndexName, aliases...)\n    // handle err\n\n    return nil\n}\n</code></pre>\n\n<p>For testing the reindex method I have tried mocking and DI but that turns out to be hard since the methods are defined on a struct instead of passing an interface as an argument to them. (So now I want to keep the implementation same since it would require making changes to all the plugin implementations and I want to avoid that)</p>\n\n<p>I wanted to know whether I can use a modified version of my build server funtion (the one I am using is given below) to return responses for different methods for the reindex service which will write the appropriate responses based on the HTTP method and the request path that is used by that method?</p>\n\n<pre><code>\ntype ServerSetup struct {\n    Method, Path, Body, Response string\n    HTTPStatus                   int\n}\n\n// This function is a modified version of: https://github.com/github/vulcanizer/blob/master/es_test.go\nfunc buildTestServer(t *testing.T, setup *ServerSetup) *httptest.Server {\n    handlerFunc := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        requestBytes, _ := ioutil.ReadAll(r.Body)\n        requestBody := string(requestBytes)\n\n        matched := false\n        if r.Method == setup.Method &amp;&amp; r.URL.EscapedPath() == setup.Path &amp;&amp; requestBody == setup.Body {\n            matched = true\n            if setup.HTTPStatus == 0 {\n                w.WriteHeader(http.StatusOK)\n            } else {\n                w.WriteHeader(setup.HTTPStatus)\n            }\n            _, err := w.Write([]byte(setup.Response))\n            if err != nil {\n                t.Fatalf(\"Unable to write test server response: %v\", err)\n            }\n        }\n\n        // TODO: remove before pushing\n        /*if !reflect.DeepEqual(r.URL.EscapedPath(), setup.Path) {\n            t.Fatalf(\"wanted: %s got: %s\\n\", setup.Path, r.URL.EscapedPath())\n        }*/\n        if !matched {\n            t.Fatalf(\"No requests matched setup. Got method %s, Path %s, body %s\\n\", r.Method, r.URL.EscapedPath(), requestBody)\n        }\n    })\n\n    return httptest.NewServer(handlerFunc)\n}\n</code></pre>\n\n<p>Something like this function but it takes a map of request methods and past mapped to appropriate responses and writes them to the writer?</p>\n"}, {"tags": ["go", "post"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552909572, "post_id": 55220469, "comment_id": 97176169, "body": "Is <code>LoggedUsername</code> talking to the db? If so, maybe call it just once, at the top, and not for every single line of the input. Same with inserting data, maybe first aggregate each CampaignTarget into a slice and then insert that slice, once, if your db supports it. Similarly <code>helper.DataDatabase()</code>..."}, {"owner": {"reputation": 31, "user_id": 11128102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/726155149bd26b06f93f4dd04a4d38b3?s=128&d=identicon&r=PG&f=1", "display_name": "Kafese Wub", "link": "https://stackoverflow.com/users/11128102/kafese-wub"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552909905, "post_id": 55220469, "comment_id": 97176380, "body": "i think the LoggedUsername is fine sir for receiving hundred of request at once, idk why maybe i forgot to close something"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 3, "creation_date": 1552912860, "post_id": 55220469, "comment_id": 97177992, "body": "what does profiling tell you? <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1552913250, "post_id": 55220469, "comment_id": 97178217, "body": "Please read up what r.ParseMultipartForm(0) does. Then think why you used 0. Then use something sensible."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1552918325, "post_id": 55220469, "comment_id": 97181484, "body": "What does &quot;my go server dies&quot; mean? The request times out? The server crashes/exits? If it crashes or exits, what is the output?"}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 1, "last_activity_date": 1552917114, "creation_date": 1552917114, "answer_id": 55222950, "question_id": 55220469, "link": "https://stackoverflow.com/questions/55220469/my-net-http-post-method-give-100-cpu-usage/55222950#55222950", "title": "my net/http post method give 100% cpu usage", "body": "<p>It's possible that splitting on newlines, where all of the contents of the string to split on is newlines is an expensive operation.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>target := strings.Split(Target[0], \"\\n\")\n</code></pre>\n\n<p>If you want to split newlines, consider using a <code>bufio.Scanner</code> instead</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>scanner := bufio.NewScanner(strings.NewReader(\"foo\\nbar\\nbaz\"))\nfor scanner.Scan() {\n    fmt.Println(scanner.Text())\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/gu77NYCwPkI\" rel=\"nofollow noreferrer\">Runnable example</a></p>\n\n<p>This is because scanner advances to the next token when you call scan, whereas <code>strings.Split</code> processes the whole payload at once.</p>\n"}], "owner": {"reputation": 31, "user_id": 11128102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/726155149bd26b06f93f4dd04a4d38b3?s=128&d=identicon&r=PG&f=1", "display_name": "Kafese Wub", "link": "https://stackoverflow.com/users/11128102/kafese-wub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1552917114, "creation_date": 1552908999, "last_edit_date": 1552909216, "question_id": 55220469, "link": "https://stackoverflow.com/questions/55220469/my-net-http-post-method-give-100-cpu-usage", "title": "my net/http post method give 100% cpu usage", "body": "<p>I have a web server with net/http and julienschmidt/httprouter. I don't know why, but if I post a \"big\" data, like hundred of newline from <code>&lt;textarea&gt;</code>, my go server dies.</p>\n\n<p>I already tried to use goroutine to make <code>for _, value := range target</code> exclude from main thread and try to increase ulimit, but it seems doesn't work\ncode: </p>\n\n<pre><code>func CreateRoute(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    r.ParseMultipartForm(0)\n\n    Title, Caption, Target := r.Form[\"title\"], r.Form[\"caption\"], r.Form[\"target\"]\n\n    if len(Title) &gt; 0 &amp;&amp; len(Caption) &gt; 0 &amp;&amp; len(Target) &gt; 0 {\n\n        CampaignId := helper.Md5Gen(time.Now().String())\n\n        target := strings.Split(Target[0], \"\\n\")\n\n        for _, value := range target {\n\n            value = strings.Replace(value, \"\\r\", \"\", -1)\n\n            if len(value) &gt; 6 {\n                data := structs.CampaignTarget{\n                    CampaignId: CampaignId,\n                    PhoneNumber: value,\n                    IsExecuted: false,\n                    ExecutedBy: \"\",\n                    IsSuccess: false,\n                    SendAt: int64(0),\n                    Username: LoggedUsername(w, r),\n                }\n                database, err := helper.DataDatabase()\n                if err == nil {\n                    database.C(\"xxx\").Insert(&amp;data)\n                }\n            }\n        }\n\n        SavedFileName := \"\"\n\n        file, handler, err := r.FormFile(\"media\")\n\n        if err == nil {\n\n            path := \"/xxx/path/\" + LoggedUsername(w, r)\n\n            err := os.MkdirAll(path, os.ModePerm)\n            if err != nil {\n                http.Error(w, \"Problem with folder creation\", 500)\n                return\n            }\n\n            defer file.Close()\n\n            SavedFileName = fmt.Sprintf(\"%v-%v\", helper.Md5Gen(time.Now().String()), handler.Filename)\n\n            f, err := os.OpenFile(path+\"/\"+SavedFileName, os.O_WRONLY|os.O_CREATE, 0666)\n            if err != nil {\n                http.Error(w, \"Failed to Write File\", 500)\n                return\n            }\n            defer f.Close()\n            io.Copy(f, file)\n\n        }\n\n        data := structs.Campaign{\n            ID: CampaignId,\n            Title: Title[0],\n            Caption: Caption[0],\n            TotalTarget: len(target),\n            Media: SavedFileName,\n            Username: LoggedUsername(w, r),\n            CreatedAt: time.Now().Unix(),\n        }\n        database, err := helper.DataDatabase()\n        if err == nil {\n            database.C(\"xx\").Insert(&amp;data)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1552906692, "post_id": 55219468, "comment_id": 97174485, "body": "You may want to look at <a href=\"https://github.com/dominikh/go-tools/tree/master/staticcheck\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 69, "user_id": 6426898, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fNrIO7HTN44/AAAAAAAAAAI/AAAAAAAAABQ/ruSipc9BQMQ/photo.jpg?sz=128", "display_name": "Iveronanomi", "link": "https://stackoverflow.com/users/6426898/iveronanomi"}, "edited": false, "score": 1, "creation_date": 1552906958, "post_id": 55219468, "comment_id": 97174649, "body": "And seems like <a href=\"https://stackoverflow.com/a/41630530/6426898\">that answer</a> will help you"}, {"owner": {"reputation": 15, "user_id": 8865572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/053f731dfe592ac27b3124ddaaee3c12?s=128&d=identicon&r=PG&f=1", "display_name": "lwp007", "link": "https://stackoverflow.com/users/8865572/lwp007"}, "edited": false, "score": 0, "creation_date": 1552914777, "post_id": 55219468, "comment_id": 97179184, "body": "Maybe I did not describe my question clearly, I just want to check the invoke relationship statically. I noticed that the discussion above focus mainly on runtime reflection."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1552918577, "post_id": 55219468, "comment_id": 97181639, "body": "It&#39;s not really relevant to the question but your sample code is invalid. <code>test1</code> cannot call <code>test2.func2</code> because it is not exported."}], "owner": {"reputation": 15, "user_id": 8865572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/053f731dfe592ac27b3124ddaaee3c12?s=128&d=identicon&r=PG&f=1", "display_name": "lwp007", "link": "https://stackoverflow.com/users/8865572/lwp007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552963909, "creation_date": 1552905753, "last_edit_date": 1552963909, "question_id": 55219468, "link": "https://stackoverflow.com/questions/55219468/how-to-inspect-two-golang-functions-invoke-relations", "title": "How to inspect two golang functions&#39; invoke relations?", "body": "<p>I am working on a code static analysis, and I have a challenge now. For example I have two go source file.</p>\n\n<p>a.go</p>\n\n<pre><code>package test1\nfunc Func1() {\n    test2.Func2()\n    fmt.println(\"func1\")\n}\n</code></pre>\n\n<p>b.go</p>\n\n<pre><code>package test2\nfunc Func2() {\n    fmt.println(\"func2\")\n}\n</code></pre>\n\n<p>How to check if func1 ast node has invoke relation with func2 ast node in Golang?</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552903886, "post_id": 55218561, "comment_id": 97172848, "body": "You should ask the author of fasthttp because that is what you are using."}, {"owner": {"reputation": 719, "user_id": 6159371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IkhNG.jpg?s=128&g=1", "display_name": "pingze", "link": "https://stackoverflow.com/users/6159371/pingze"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552906698, "post_id": 55218561, "comment_id": 97174489, "body": "@Volker Sorry I made a mistake of using third party package. Even with strandard library net/http, the problem is still there. I have edited."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552906993, "post_id": 55218561, "comment_id": 97174665, "body": "You are instantiating a new http.Client for each and every request which is not what the documentation of http.Client recommends. You are working deliberately against the documentation and are astonished to see strange results? You do nothing to control keep alive and did not provide information about how ab does it. This type of measurements are not very scientific."}, {"owner": {"reputation": 719, "user_id": 6159371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IkhNG.jpg?s=128&g=1", "display_name": "pingze", "link": "https://stackoverflow.com/users/6159371/pingze"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552907676, "post_id": 55218561, "comment_id": 97175058, "body": "@Volker I chage the code and instantiate a client for each workRoutine but not each request. I just want to know why a request create 2 counts in the results of <code>netstat -na|grep ESTABLISHED|wc -l</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552908840, "post_id": 55218561, "comment_id": 97175752, "body": "Then make a test without concurrency, establish one HTTP connection an monitor what netstat reports. If still unclear: Edit the question, remove the ab stuff and post the simplified code."}, {"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1552951462, "post_id": 55218561, "comment_id": 97197222, "body": "I get twice the number with <code>ab</code>, too. When I look at the output of <code>netstat</code>, I see two sockets for every connection: one <code>tcp</code>, another <code>tcp6</code> with the addresses swapped. Not sure what <code>tcp6</code> has to do with this, but the duplication itself seems correct, because netstat lists <i>sockets</i>, not <i>connections</i>."}, {"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1552951583, "post_id": 55218561, "comment_id": 97197247, "body": "Also note that your current code still doesn\u2019t reuse connections, because you never read the response body (e.g. with <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll</code></a>), you just close it."}], "owner": {"reputation": 719, "user_id": 6159371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IkhNG.jpg?s=128&g=1", "display_name": "pingze", "link": "https://stackoverflow.com/users/6159371/pingze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 17, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552907797, "creation_date": 1552902633, "last_edit_date": 1552907797, "question_id": 55218561, "link": "https://stackoverflow.com/questions/55218561/why-my-golang-pressure-measuring-tool-and-apache-batch-generate-different-number", "title": "Why my Golang pressure measuring tool and Apache Batch generate different number of ESTABLISHED links?", "body": "<p>Apache Batch is a popular pressure measuring tool.</p>\n\n<p>I write a tool with the same function in golang myself. Then I make some tests.\nI find it works well.</p>\n\n<p>But accidentally, I find a difference from my tool and Apache Batch:</p>\n\n<p>When checking ESTABLISHED link number by the cmd <code>netstat -na|grep ESTABLISHED|wc -l</code>:</p>\n\n<p>Use cmd <code>ab -n 128000 -c 128 http://127.0.0.1:8000/</code>, the cmd above returns a number near 128.</p>\n\n<p>But use my own tool, the cmd returns near 256 (when set concurrency 128).</p>\n\n<p><strong>Why my own tool have twice the expected number of concurrencies?</strong></p>\n\n<p>My code:</p>\n\n<pre><code>func request(cli *http.Client, uri string) {\n    resp, err := cli.Get(uri)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    if resp.StatusCode != 200 {\n        panic(\"return\" + strconv.Itoa(resp.StatusCode))\n    }\n}\n\nfunc workRoutine(ch chan string, wg *sync.WaitGroup) {\n    cli := &amp;http.Client{}\n    for uri := range ch {\n        request(cli, uri)\n    }\n    wg.Done()\n}\n\nfunc main() {\n    rnum := 128\n    tnum := 128000\n\n    url := \"http://127.0.0.1:8000/\"\n\n    ch := make(chan string)\n    var wg sync.WaitGroup\n\n    go func() {\n        for i := 0; i &lt; tnum; i++ {\n            ch &lt;- url\n        }\n        close(ch)\n    }()\n\n    wg.Add(rnum)\n    for i := 0; i &lt; rnum; i++ {\n        go workRoutine(ch, &amp;wg)\n    }\n\n    stime := time.Now()\n    wg.Wait()\n    dtime := time.Now().Sub(stime)\n    fmt.Println(\"Timecost\", dtime)\n    fmt.Println(\"Throughputs\", float64(tnum)/dtime.Seconds())\n}\n</code></pre>\n"}, {"tags": ["go", "web-applications"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 6, "creation_date": 1552903143, "post_id": 55218228, "comment_id": 97172395, "body": "Looking at your code, my best guess is, that your <code>fmt.Fprintf</code> calls with the <code>http.ResponseWrite</code> trigger calls to its <code>Write()</code> function which implicitly calls <code>WriteHeader(http.StatusOK)</code>. As only one header can be written, <code>http.Redirect</code> is unable to write the redirect header, resulting in a response with a 200 status. Removing the <code>fmt.Fprintf</code> calls should resolve this."}, {"owner": {"reputation": 71, "user_id": 7515649, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1193871330720478/picture?type=large", "display_name": "Himanshu Kriplani", "link": "https://stackoverflow.com/users/7515649/himanshu-kriplani"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1552910330, "post_id": 55218228, "comment_id": 97176652, "body": "@Leon Worked like a charm. Thanks. Any ideas, what should I use instead of <code>fmt.Fprintf</code> ?"}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1552915822, "post_id": 55218228, "comment_id": 97179843, "body": "Well, if you want to redirect, there is no point in writing content to the response, as it will not be displayed after the redirect has been followed. You can still use <code>fmt.Println</code> or <code>fmt.Printf</code> to write to the terminal like in any other application."}], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 0, "last_activity_date": 1552929940, "creation_date": 1552929940, "answer_id": 55226888, "question_id": 55218228, "link": "https://stackoverflow.com/questions/55218228/unable-to-redirect-in-a-golang-web-app-it-sticks-to-one-page/55226888#55226888", "title": "Unable to redirect in a golang web app. It sticks to one page", "body": "<p>Your code is writing to the <code>ResponseWriter</code> before trying to send a redirect.</p>\n\n<p>Upon the first <a href=\"https://golang.org/pkg/net/http/#Response.Write\" rel=\"nofollow noreferrer\">write</a> to the <code>ResponseWriter</code>, the status code (200 OK) and headers are sent, if they haven't already been sent, and then the data you passed to the writer.</p>\n\n<p>If you intend to send an HTTP redirect, you can't write any response body to the <code>ResponseWriter</code>. From reading your code, it doesn't make much sense why you are writing to it in the first place. They look like debugging print statements, which you probably ought to send to <code>os.Stderr</code> or a logger instead of the web page response body.</p>\n"}], "owner": {"reputation": 71, "user_id": 7515649, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1193871330720478/picture?type=large", "display_name": "Himanshu Kriplani", "link": "https://stackoverflow.com/users/7515649/himanshu-kriplani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552929940, "creation_date": 1552901481, "last_edit_date": 1552927756, "question_id": 55218228, "link": "https://stackoverflow.com/questions/55218228/unable-to-redirect-in-a-golang-web-app-it-sticks-to-one-page", "title": "Unable to redirect in a golang web app. It sticks to one page", "body": "<p>This is code snippet from a file called upload.go.\nI tried a lot of ways to redirect to another pages. I want to redirect to another page when the statements in  POST are completed running. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n    \"text/template\"\n)\n\nfunc upload(w http.ResponseWriter, r *http.Request) {\n\n    if r.Method == \"GET\" {\n        // GET\n        t, _ := template.ParseFiles(\"upload.gtpl\")\n\n        t.Execute(w, nil)\n\n    } else if r.Method == \"POST\" {\n        // Post\n        file, handler, err := r.FormFile(\"uploadfile\")\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer file.Close()\n\n        fmt.Fprintf(w, \"%v\", handler.Header)\n        f, err := os.OpenFile(\"./test/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer f.Close()\n\n        io.Copy(f, file)\n\n        img, err := imgio.Open(\"./test/\" + handler.Filename)\n        if err != nil {\n            panic(err)\n        }\n\n        inverted := effect.Invert(img)\n        if err := imgio.Save(\"filename.png\", inverted, imgio.PNGEncoder()); err != nil {\n            panic(err)\n        }\n\n        fmt.Fprintf(w, \"%v\", handler.Header)\n        http.Redirect(w, r, \"www.google.com\", http.StatusMovedPermanently)\n\n    } else {\n        fmt.Println(\"Unknown HTTP \" + r.Method + \"  Method\")\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/upload\", upload)\n    http.HandleFunc(\"/hi\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"Hi\")\n        http.Redirect(w, r, \"www.google.com\", http.StatusMovedPermanently)\n    })\n\n    http.ListenAndServe(\":9090\", nil) // setting listening port\n}\n</code></pre>\n\n<p>It stays on the upload page what ever I do. Can anyone help me debug this?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1552904189, "post_id": 55218089, "comment_id": 97173023, "body": "What a function returns is what it returns. And two things with different memory layout (e.g. I1 and *S1) are simply different things. The returned value is not subject to &quot;if assignable than it&#39;s okay&quot;, it must match on a memory layout level. Why? Just a guess: It makes everything much easier (e.g. modifying return values in a defer), especially a interface satisfaction on Go is implicit and thus might lead to hard to prevent errors if that would be allowed."}, {"owner": {"reputation": 1366, "user_id": 556085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bc1b6843ab9e5e9a6f83cdbcee90ed?s=128&d=identicon&r=PG", "display_name": "KillerX", "link": "https://stackoverflow.com/users/556085/killerx"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552909775, "post_id": 55218089, "comment_id": 97176311, "body": "@Volker that makes sense on some level, but I still can&#39;t reconcile the whole thing. As I understand the returned interface is a pointer anyways so we are not assigning the actual memory but rather a pointer which (afaik) is pretty much the same data layout for any type. Going further, does an interface even have a &quot;memory layout&quot;? It isn&#39;t it just a rule that needs to be matched and not anything that &quot;contains&quot; data? Also what about accepting Interfaces as args and passing in concrete types? Why can I then assign *S1 to I1 in <code>var i I1 = x.Bar()</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1552912752, "post_id": 55218089, "comment_id": 97177928, "body": "Interface are not pointers. Interfaces have a different memory layout than a pointer. This is not specified, so it is an implementation detail and can change but they are roughly two pointers, one pointing to the actual value and one to the type (better it&#39;s method itable)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1552912871, "post_id": 55218089, "comment_id": 97177994, "body": "&quot;does an interface even have a &quot;memory layout&quot;? It isn&#39;t it just a rule that needs to be matched and not anything that &quot;contains&quot; data?&quot; That is the difference between an interface and an interface value. The abstract notion of an interface is just a collection of methods, but in Go there are variables of interface types: E.g. a <code>var r io.Reader</code> is something laying around in memory."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1552913000, "post_id": 55218089, "comment_id": 97178054, "body": "&quot;Why can I then assign *S1 to I1 in var i I1 = x.Bar() ?&quot; Technically because the language specification allows it. Informal: without that you would not be able to use interfaces: To benefit from interfaces you need to have the ability to write generic code using an interface variable and assigning a non-interface value (implementing that interface). How this works (or worked, the article is outdated but informative nevertheless): Look it up in <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">research.swtch.com/interfaces</a>"}, {"owner": {"reputation": 1366, "user_id": 556085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bc1b6843ab9e5e9a6f83cdbcee90ed?s=128&d=identicon&r=PG", "display_name": "KillerX", "link": "https://stackoverflow.com/users/556085/killerx"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552983449, "post_id": 55218089, "comment_id": 97205785, "body": "@Volker Thank you so much for the clarifications, and for taking the time to answer all the sub-questions. Also thanks for the link, I was looking for some resource like that but didn&#39;t find anything. If you feel like packaging this into an answer I will be happy to accept it."}], "answers": [{"comments": [{"owner": {"reputation": 1366, "user_id": 556085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bc1b6843ab9e5e9a6f83cdbcee90ed?s=128&d=identicon&r=PG", "display_name": "KillerX", "link": "https://stackoverflow.com/users/556085/killerx"}, "edited": false, "score": 0, "creation_date": 1552909990, "post_id": 55219058, "comment_id": 97176448, "body": "The signature obviously does not mach on a &quot;string comparison&quot; level, but the <code>Bar() I1</code> signature is IMO satisfied by <code>Bar() *S1</code> since <code>*S1</code> satisfies the <code>I1</code> interface. So if you re-read the question I&#39;m asking why on a technical level this is considered &quot;not a match&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1552918978, "post_id": 55219058, "comment_id": 97181883, "body": "Because it does not match. Your opinion is something you can take up with the Go team, but the compiler&#39;s opinion (as documented in the spec) is what&#39;s relevant here, and it says the signature must be identical."}, {"owner": {"reputation": 1366, "user_id": 556085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bc1b6843ab9e5e9a6f83cdbcee90ed?s=128&d=identicon&r=PG", "display_name": "KillerX", "link": "https://stackoverflow.com/users/556085/killerx"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1552983630, "post_id": 55219058, "comment_id": 97205859, "body": "@Adrian I get that my opinion is for all intents and purposes irrelevant to the world at large, and especially the compiler (and wrong in this case), but by the end of the day everyone programs based on how they think the language works (in their opinion) and the only way to really change that wrong understanding is to dig deeper. That is how I attempted to formulate my question. &quot;That&#39;s just how it is&quot; is not an answer to &quot;What are the technical reasons for that&#39;s the way it is&quot;. Do you have any suggestions how the Q could be reformulated to better express that?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1553002217, "post_id": 55219058, "comment_id": 97217412, "body": "&quot;Why was X designed the way it was&quot; is, 99% of the time, a question for the designers of X, not the community at large; not only can the community not offer a definitive answer, but the question itself is opinion-based (as it is, at its core, about the opinions of the designers)."}], "tags": [], "owner": {"reputation": 62, "user_id": 8757788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a856b683d186f4bfd53d1c6b1f51a1f4?s=128&d=identicon&r=PG", "display_name": "beldin0", "link": "https://stackoverflow.com/users/8757788/beldin0"}, "is_accepted": false, "score": 1, "last_activity_date": 1552904289, "creation_date": 1552904289, "answer_id": 55219058, "question_id": 55218089, "link": "https://stackoverflow.com/questions/55218089/why-does-returning-a-concrete-type-not-satisfy-a-interface-requiring-a-interface/55219058#55219058", "title": "Why does returning a concrete type not satisfy a Interface requiring a Interface return", "body": "<p>The interface is not satisfied because the method signature does not match. The method signature specified in the interface is:\n    Bar() I1\nbut the method signature provided is:\n    Bar() *S1</p>\n\n<p>you can still return a pointer to an S1 instance but you need the method signatures to match. Change the return type of the method to <b>I1</b>.</p>\n"}], "owner": {"reputation": 1366, "user_id": 556085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14bc1b6843ab9e5e9a6f83cdbcee90ed?s=128&d=identicon&r=PG", "display_name": "KillerX", "link": "https://stackoverflow.com/users/556085/killerx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1552904289, "creation_date": 1552901055, "question_id": 55218089, "link": "https://stackoverflow.com/questions/55218089/why-does-returning-a-concrete-type-not-satisfy-a-interface-requiring-a-interface", "title": "Why does returning a concrete type not satisfy a Interface requiring a Interface return", "body": "<p>Suppose we have the following code</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\ntype I1 interface {\n    Foo() string\n}\n\ntype I2 interface {\n    Bar() I1\n}\n\ntype S1 struct{}\n\nfunc (s *S1) Foo() string {\n    return \"foo\"\n}\n\ntype S2 struct{}\n\nfunc (s *S2) Bar() *S1 {\n    return &amp;S1{}\n}\n\nfunc main() {\n    x := &amp;S2{}\n    var i I1 = x.Bar()\n    println(i.Foo())\n\n    var y I2\n    y = &amp;S2{}\n    println(y.Bar().Foo())\n}\n\n</code></pre>\n\n<p>Now, from my viewpoint <code>S2</code> satisfies <code>I2</code>, as the return of <code>Bar()</code> satisfies <code>I1</code>, as shown in the lines above, but the compiler disagrees with me:</p>\n\n<pre><code># command-line-arguments\n./main.go:28:4: cannot use S2 literal (type *S2) as type I2 in assignment:\n        *S2 does not implement I2 (wrong type for Bar method)\n                have Bar() *S1\n                want Bar() I1\n</code></pre>\n\n<p>Yes, I understand that they are different types<sup>\u2020</sup> , but is that not sort of the point of an interface to accept <em>any</em> type that satisfies its requirements?</p>\n\n<p>Can someone give more information as to what the technical reasons may be that the satisfaction of the interface is not taken into account at this stage?</p>\n\n<hr>\n\n<p><sup>\u2020</sup> <a href=\"https://stackoverflow.com/questions/53661851/concrete-type-does-not-match-interface-on-return-type\">Concrete type does not match interface on return type</a></p>\n"}, {"tags": ["api", "go", "model", "controller", "beego"], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1552960569, "post_id": 55229474, "comment_id": 97199190, "body": "But how did I misunderstand? Please explain my fault for never do this Thanks"}], "tags": [], "owner": {"reputation": 164, "user_id": 1957835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65d3b38093aa7662cbe0cce12e0d62c4?s=128&d=identicon&r=PG", "display_name": "ahmetlutfu", "link": "https://stackoverflow.com/users/1957835/ahmetlutfu"}, "is_accepted": true, "score": 1, "last_activity_date": 1552940508, "creation_date": 1552940508, "answer_id": 55229474, "question_id": 55218062, "link": "https://stackoverflow.com/questions/55218062/beego-update-get-1-by-id/55229474#55229474", "title": "Beego update &amp; get 1 by ID", "body": "<p>I think you are misunderstand many things. I fixed your code on this link.</p>\n\n<ol>\n<li>Assign as ID,err := i.GetInt64(\"ID\")</li>\n<li>Check error as if err == nil &amp;&amp; ID > 0 {}</li>\n</ol>\n\n<p><a href=\"https://play.golang.org/p/PY-lc3AfhPw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PY-lc3AfhPw</a></p>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 55229474, "answer_count": 1, "score": 1, "last_activity_date": 1552940508, "creation_date": 1552900940, "last_edit_date": 1552932136, "question_id": 55218062, "link": "https://stackoverflow.com/questions/55218062/beego-update-get-1-by-id", "title": "Beego update &amp; get 1 by ID", "body": "<p>I'm absolutely stuck at Beego, update &amp; get. I already done getall, delete, </p>\n\n<p>Problem is my ID is the primary key. I convert into a string to equal at the model. How to search from Ticket table by using ID and in model how to take as []array and return it.</p>\n\n<p>controller</p>\n\n<pre><code>func (i *TicketController) GetTicket() {\n    ID := i.GetInt(\"ID\")\n    stringID := strconv.Itoa(ID)\n    if ID != \"\" {\n        ticket := models.GetTicketById(stringID)\n        fmt.Println(ticket)\n        i.Data[\"json\"] = ticket\n    }\n    i.ServeJSON()\n}\n</code></pre>\n\n<p>model</p>\n\n<pre><code>func GetTicketById(id int64) Ticket {\n    t := Ticket{ID: id}\n    o := orm.NewOrm()\n    err := o.Read(&amp;t)\n    if err == orm.ErrNoRows {\n        fmt.Println(\"no result\")\n    } else if err == orm.ErrMissPK {\n        fmt.Println(\"can't find PK\")\n    }\n    return t\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "reflection", "go-gin"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1552900197, "post_id": 55217793, "comment_id": 97170766, "body": "It&#39;s unclear what you want. You want to omit fields from JSON output? <code>,omitempty</code> option already does that."}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1552900333, "post_id": 55217793, "comment_id": 97170841, "body": "@icza plz, check UPD"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552900667, "post_id": 55217793, "comment_id": 97171016, "body": "Are the fields you want to omit always the same? Say in your example do you always need to omit the two fields <code>&quot;FullName&quot;, &quot;ActualAddress&quot;</code> from the <code>Application</code>&#39;s json? Or do you need to keep them in some cases, and omit other fields in other cases?"}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552900909, "post_id": 55217793, "comment_id": 97171157, "body": "@mkopriva not the same, in one case omit one set of params in other another"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552905544, "post_id": 55217793, "comment_id": 97173830, "body": "If your goal is just to omit those values in JSON, set the json tag to <code>-</code> for those fields."}], "answers": [{"comments": [{"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 0, "creation_date": 1552901159, "post_id": 55218049, "comment_id": 97171295, "body": "Omitting FullName, ActualAddress was just an example, what if we have different combinations each time? Structure is big, and combinations can be thousands"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 0, "creation_date": 1552901192, "post_id": 55218049, "comment_id": 97171311, "body": "@mondayguy Please read the full answer. I proposed <code>zeroFields()</code> which takes pointers."}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 0, "creation_date": 1552901338, "post_id": 55218049, "comment_id": 97171380, "body": "the thing is that we have roles in our system and I need to omit some params for each role... omited params stored in DB and can be different...Is is more clear now? Sorry for bad english"}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 0, "creation_date": 1552901494, "post_id": 55218049, "comment_id": 97171483, "body": "I mean that we must call the zeroFilelds function with some string array with omitting field name, because it can be thousands of combinations"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 0, "creation_date": 1552901526, "post_id": 55218049, "comment_id": 97171503, "body": "Yes, and you can do that. You can pass slices to variadic functions."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1552901262, "last_edit_date": 1552901262, "creation_date": 1552900905, "answer_id": 55218049, "question_id": 55217793, "link": "https://stackoverflow.com/questions/55217793/how-to-omit-some-parameters-of-structure-gin-gonic/55218049#55218049", "title": "How to omit some parameters of structure Gin gonic", "body": "<p>The thing is, if you only want to zero a few fields, it's more readable to do it without a function, e.g.</p>\n\n<pre><code>app := Application{}\n\napp.FullName, app.ActualAddress = \"\", \"\"\n</code></pre>\n\n<p>If you want to create a function for it, at least use variadic parameter, so it's easier to call it:</p>\n\n<pre><code>func zeroFields(application *Application, fields ...string) {\n    // ...\n}\n</code></pre>\n\n<p>So then calling it:</p>\n\n<pre><code>zeroFields(&amp;app, \"FullName\", \"ActualAddress\")\n</code></pre>\n\n<p>Yes, this will have to use reflection, so it's slower than it could be, and error prone (mistyped names can only be detected at runtime). If you want to avoid using reflection, pass the address of the fields:</p>\n\n<pre><code>func zeroFields(ps ...*string) {\n    for _, p := range ps {\n        *p = \"\"\n    }\n}\n</code></pre>\n\n<p>This way you have compile-time guarantee that you type field names correctly, and that they have <code>string</code> type.</p>\n\n<p>Calling it:</p>\n\n<pre><code>zeroFields(&amp;application.FullName, &amp;application.ActualAddress)\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/HOehUM6Bf3b\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 10074206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbb49f90f5652070f922359c6ff3917?s=128&d=identicon&r=PG&f=1", "display_name": "LukeCC", "link": "https://stackoverflow.com/users/10074206/lukecc"}, "is_accepted": false, "score": 0, "last_activity_date": 1552901048, "creation_date": 1552901048, "answer_id": 55218087, "question_id": 55217793, "link": "https://stackoverflow.com/questions/55217793/how-to-omit-some-parameters-of-structure-gin-gonic/55218087#55218087", "title": "How to omit some parameters of structure Gin gonic", "body": "<p>If I understand correctly: you want to return some values from your struct but not all of them? Perhaps a nested struct? </p>\n\n<pre><code>type Application struct {\n  ID struct {\n    ID int64 `json:\"id\"`\n  } `json:\"id\"`\n  Person struct {\n    Fullname string `json:\"Fullname\"\n  } `json:\"person\"\n}\n</code></pre>\n\n<p>That should let you filter out the fields you want to use.</p>\n"}], "owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 773, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1597431398, "creation_date": 1552900013, "last_edit_date": 1597431398, "question_id": 55217793, "link": "https://stackoverflow.com/questions/55217793/how-to-omit-some-parameters-of-structure-gin-gonic", "title": "How to omit some parameters of structure Gin gonic", "body": "<p>I have big structure with more than 50 params</p>\n\n<pre><code>type Application struct {\n    Id                  int64   `json:\"id\"`\n    FullName            string  `json:\"fullName,omitempty\"`\n    ActualAddress       string  `json:\"actualAddress,omitempty\"`\n.....\n}\n</code></pre>\n\n<p>I use gin-gonic and when I return <code>application</code> I need to omit some params I've created a function which makes empty some params (<a href=\"https://play.golang.org/p/n_cyxa1WW7h\" rel=\"nofollow noreferrer\">playLink</a>) and then gin returns me correct json (without unnecessary values). I heard that reflection isn't fast operation so in our case we can use a lot of ugly if-else or switch-cases. Is there any other solutions faster than reflecting and more beautiful than if-elses?</p>\n\n<p>The thing is that structure params have non-empty values, so they wont by omitted by gin. That's why I've created function to make some params empty before return</p>\n"}, {"tags": ["go", "ffmpeg"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552898136, "post_id": 55216327, "comment_id": 97169784, "body": "What does &quot;will not work&quot; mean? What error do you see? Or what output do you get, and what do you expect instead?"}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552898457, "post_id": 55216327, "comment_id": 97169931, "body": "@Flimzy the second test output.wav is a 78 bytes file, it only have wav header,and output has likes &quot; /dev/stdin: Invalid data found when processing input&quot; error"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553021878, "post_id": 55216327, "comment_id": 97229106, "body": "I think ffmpeg is expecting a real file as the argument for <code>-i</code> (and it does some magic to figure out what&#39;s going on when you pass /dev/stdin when it&#39;s connected to a real file). Try using the &quot;pipe&quot; protocol with <code>-i pipe:</code>"}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553072166, "post_id": 55216327, "comment_id": 97245145, "body": "@JimB yes but I need a solution without save file to hard disk, I wand reduce io overhead"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1553088866, "post_id": 55216327, "comment_id": 97255317, "body": "Yes, but it seems ffmpeg needs to be told when it has a pipe vs a file, which is exactly why I suggested using the <code>-i pipe:</code> protocol, as described in the ffmpeg docs. I don&#39;t have a setup to test this with, but feel free to try it."}], "owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552903950, "creation_date": 1552893867, "last_edit_date": 1552903950, "question_id": 55216327, "link": "https://stackoverflow.com/questions/55216327/ffmepg-convert-m4a-to-wav-with-bytes-not-work", "title": "ffmepg convert m4a to wav with bytes not work", "body": "<p>some reason I need convert audio data with bytes ,for example data from http or grpc client</p>\n\n<p>so I want to use ffmpeg to convert audio by os/exec.Command</p>\n\n<p>the strange thing is when I convert audio bytes directly will failure, but convet with save file ,it work well</p>\n\n<p>two test below</p>\n\n<pre><code>// ffmpeg work well with file's io.Reader\nfunc TestMp4ToWav(t *testing.T) {\n    var f io.Reader\n    var err error\n    f, err = os.Open(\"test.m4a\")\n    require.NoError(t, err)\n    cmdStr := strings.Split(\"-f mp4 -i /dev/stdin -ar 16000 -ac 1 -f wav -\", \" \")\n    cmd := exec.Command(\"ffmpeg\", cmdStr...)\n    cmd.Stdin = f\n    var errBuff bytes.Buffer\n    cmd.Stderr = &amp;errBuff\n    d, err := cmd.Output()\n    t.Log(errBuff.String())\n    if err != nil {\n        t.Error(err)\n    }\n\n    err = ioutil.WriteFile(\"output.wav\", d, 0644)\n    assert.NoError(t, err)\n\n}\n\n// but not work with bytes.Buffer\nfunc TestMp4ToWavWithBuff(t *testing.T) {\n    var data []byte\n    var err error\n    data, err = ioutil.ReadFile(\"test.m4a\")\n    require.NoError(t, err)\n\n    cmdStr := strings.Split(\"-f mp4 -i /dev/stdin -ar 16000 -ac 1 -f wav -\", \" \")\n    cmd := exec.Command(\"ffmpeg\", cmdStr...)\n    cmd.Stdin = bytes.NewBuffer(data)\n    var errBuff bytes.Buffer\n    cmd.Stderr = &amp;errBuff\n    d, err := cmd.Output()\n    t.Log(errBuff.String())\n    require.NoError(t, err)\n    err = ioutil.WriteFile(\"output.wav\", d, 0644)\n    assert.NoError(t, err)\n}\n</code></pre>\n\n<p>first test output</p>\n\n<pre><code>ffmpeg_test.go:54: ffmpeg version 2.8.15-0ubuntu0.16.04.1 Copyright (c) 2000-2018 the FFmpeg developers\n      built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.10) 20160609\n      configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n      libavutil      54. 31.100 / 54. 31.100\n      libavcodec     56. 60.100 / 56. 60.100\n      libavformat    56. 40.101 / 56. 40.101\n      libavdevice    56.  4.100 / 56.  4.100\n      libavfilter     5. 40.101 /  5. 40.101\n      libavresample   2.  1.  0 /  2.  1.  0\n      libswscale      3.  1.101 /  3.  1.101\n      libswresample   1.  2.101 /  1.  2.101\n      libpostproc    53.  3.100 / 53.  3.100\n    Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/dev/stdin':\n      Metadata:\n        major_brand     : M4A \n        minor_version   : 512\n        compatible_brands: isomiso2\n        encoder         : Lavf56.40.101\n      Duration: 00:00:05.02, start: 0.023220, bitrate: 136 kb/s\n        Stream #0:0(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 134 kb/s (default)\n        Metadata:\n          handler_name    : SoundHandler\n    Output #0, wav, to 'pipe:':\n      Metadata:\n        major_brand     : M4A \n        minor_version   : 512\n        compatible_brands: isomiso2\n        ISFT            : Lavf56.40.101\n        Stream #0:0(und): Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, mono, s16, 256 kb/s (default)\n        Metadata:\n          handler_name    : SoundHandler\n          encoder         : Lavc56.60.100 pcm_s16le\n    Stream mapping:\n      Stream #0:0 -&gt; #0:0 (aac (native) -&gt; pcm_s16le (native))\n    size=     158kB time=00:00:05.03 bitrate= 256.1kbits/s    \n    video:0kB audio:157kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.048375%\n</code></pre>\n\n<p>second test output</p>\n\n<pre><code>ffmpeg_test.go:77: ffmpeg version 2.8.15-0ubuntu0.16.04.1 Copyright (c) 2000-2018 the FFmpeg developers\n      built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.10) 20160609\n      configuration: --prefix=/usr --extra-version=0ubuntu0.16.04.1 --build-suffix=-ffmpeg --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --cc=cc --cxx=g++ --enable-gpl --enable-shared --disable-stripping --disable-decoder=libopenjpeg --disable-decoder=libschroedinger --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmodplug --enable-libmp3lame --enable-libopenjpeg --enable-libopus --enable-libpulse --enable-librtmp --enable-libschroedinger --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxvid --enable-libzvbi --enable-openal --enable-opengl --enable-x11grab --enable-libdc1394 --enable-libiec61883 --enable-libzmq --enable-frei0r --enable-libx264 --enable-libopencv\n      libavutil      54. 31.100 / 54. 31.100\n      libavcodec     56. 60.100 / 56. 60.100\n      libavformat    56. 40.101 / 56. 40.101\n      libavdevice    56.  4.100 / 56.  4.100\n      libavfilter     5. 40.101 /  5. 40.101\n      libavresample   2.  1.  0 /  2.  1.  0\n      libswscale      3.  1.101 /  3.  1.101\n      libswresample   1.  2.101 /  1.  2.101\n      libpostproc    53.  3.100 / 53.  3.100\n    [mov,mp4,m4a,3gp,3g2,mj2 @ 0x17454c0] stream 0, offset 0x28: partial file\n    Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/dev/stdin':\n      Metadata:\n        major_brand     : M4A \n        minor_version   : 512\n        compatible_brands: isomiso2\n        encoder         : Lavf56.40.101\n      Duration: 00:00:05.02, bitrate: N/A\n        Stream #0:0(und): Audio: aac (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 134 kb/s (default)\n        Metadata:\n          handler_name    : SoundHandler\n    Output #0, wav, to 'pipe:':\n      Metadata:\n        major_brand     : M4A \n        minor_version   : 512\n        compatible_brands: isomiso2\n        ISFT            : Lavf56.40.101\n        Stream #0:0(und): Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, mono, s16, 256 kb/s (default)\n        Metadata:\n          handler_name    : SoundHandler\n          encoder         : Lavc56.60.100 pcm_s16le\n    Stream mapping:\n      Stream #0:0 -&gt; #0:0 (aac (native) -&gt; pcm_s16le (native))\n    [mov,mp4,m4a,3gp,3g2,mj2 @ 0x17454c0] stream 0, offset 0x28: partial file\n    /dev/stdin: Invalid data found when processing input\n    size=       0kB time=00:00:00.00 bitrate=N/A    \n    video:0kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: unknown\n    Output file is empty, nothing was encoded (check -ss / -t / -frames parameters if used)\n</code></pre>\n\n<p><a href=\"https://github.com/bigpigeon/Test/blob/master/go/ffmpeg/test.m4a?raw=true\" rel=\"nofollow noreferrer\">test.m4a audio download address</a></p>\n\n<p>PS I also try to fake os.File object still not work</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "edited": false, "score": 1, "creation_date": 1552886948, "post_id": 55214819, "comment_id": 97165314, "body": "How about seeing this? <a href=\"https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang\" title=\"how to use regexp get url pattern in golang\">stackoverflow.com/questions/30474313/&hellip;</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 6, "creation_date": 1552886950, "post_id": 55214819, "comment_id": 97165316, "body": "How <code>ServeMux</code> matches paths is described in its documentation: <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#ServeMux</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1552893141, "last_edit_date": 1592644375, "creation_date": 1552893141, "answer_id": 55216191, "question_id": 55214819, "link": "https://stackoverflow.com/questions/55214819/how-does-default-server-mux-match-url-pattern/55216191#55216191", "title": "How does default server mux match url pattern", "body": "<p>The best explanation is the official one, found in the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">documentation for the <code>http</code> package</a>. In part:</p>\n<blockquote>\n<p>Patterns name fixed, rooted paths, like &quot;/favicon.ico&quot;, or rooted subtrees, like &quot;/images/&quot; (note the trailing slash). Longer patterns take precedence over shorter ones, so that if there are handlers registered for both &quot;/images/&quot; and &quot;/images/thumbnails/&quot;, the latter handler will be called for paths beginning &quot;/images/thumbnails/&quot; and the former will receive requests for any other paths in the &quot;/images/&quot; subtree.</p>\n<p>Note that since a pattern ending in a slash names a rooted subtree, the pattern &quot;/&quot; matches all paths not matched by other registered patterns, not just the URL with Path == &quot;/&quot;.</p>\n</blockquote>\n<p>As always, if you need more details, read the docs.</p>\n"}], "owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 1, "accepted_answer_id": 55216191, "answer_count": 1, "score": 0, "last_activity_date": 1552893141, "creation_date": 1552885592, "last_edit_date": 1552892576, "question_id": 55214819, "link": "https://stackoverflow.com/questions/55214819/how-does-default-server-mux-match-url-pattern", "title": "How does default server mux match url pattern", "body": "<p>I have seen simple router implementation using the following code to extract url parameters from the request path.</p>\n\n<pre><code>handler := http.NewServerMux()\nhandler.HandleFunc('/user/', func(w http.ResponseWriter, r *http.Request) {\n     name := strings.Replace(r.URL.Path, '/user/', \"\", 1)// this code\n\n    io.WriteString(w, fmt.Sprintf(\"Hello %s\\n\",name)\n})\n</code></pre>\n\n<p>Then they will be another route like <code>/user</code> (notice lacking trailing slash).</p>\n\n<pre><code>handler.HandleFunc('/user', handleUser)\n</code></pre>\n\n<p>Lets say for example <code>r.URL.Path</code> is <code>/user/name</code>. The first route will match while there will be no match for second shorter path. Technically, the request path should not match any route as one is too long for a match and other one too short.</p>\n\n<p>This raises a question of what rules Golang <code>mux</code> follow when matching request to routes. It appears at first thought that it is taking the longest match of the path but what if the shortest path is defined first in the source of the program?</p>\n\n<p>Can someone please give a simple explanation on how the <code>ServerMux</code> behaves.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 124, "user_id": 4050771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5rniJ.jpg?s=128&g=1", "display_name": "Vijay", "link": "https://stackoverflow.com/users/4050771/vijay"}, "edited": false, "score": 0, "creation_date": 1552887697, "post_id": 55214595, "comment_id": 97165546, "body": "Check if there any separate mapping table created in your db."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552893005, "post_id": 55214595, "comment_id": 97167391, "body": "Slices cannot be natively stored in a database, so it makes sense that GORM skips them during table creation. I expect using a type that satisfies the <a href=\"https://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"nofollow noreferrer\"><code>driver.Valuer</code></a> interface would change GORM&#39;s behavior, but this is a guess (thus a comment, and not an answer)."}, {"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "edited": false, "score": 1, "creation_date": 1552899636, "post_id": 55214595, "comment_id": 97170496, "body": "If you can/want to use <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">pq</a>, it provides arrays for the most common types (<code>pq.StringArray</code>, <code>pq.ByteaArray</code> and more)."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "edited": false, "score": 0, "creation_date": 1552896057, "post_id": 55216176, "comment_id": 97168807, "body": "thank you for your answer @henry-woody wouldnt that just allow me to link the tables? i needed the indexes of the slices so i could tell the order. each location may have a different order of items and categories."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1552899180, "post_id": 55216176, "comment_id": 97170254, "body": "&quot;<i>arrays are not supported column types in SQL</i>&quot;: JSON comes close; many SQL engines support it (PostgreSQL, SQLite, MySQL, MariaDB, etc.)"}, {"owner": {"reputation": 1018, "user_id": 1315307, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7fdb7d70a65d42ecea4087f76b3f7b41?s=128&d=identicon&r=PG", "display_name": "Panshul", "link": "https://stackoverflow.com/users/1315307/panshul"}, "edited": false, "score": 0, "creation_date": 1552902339, "post_id": 55216176, "comment_id": 97171967, "body": "I think you can achieve that in two ways:  - either store all Items and Categories with index values as a column and then sort them on fetch  - If you have fixed items and categories.. maybe create a separate mapping table for Inventory - Items, Inventory - Categories and store each mapping with an index value, which u can use to sort or get the position."}], "tags": [], "owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "is_accepted": false, "score": 2, "last_activity_date": 1552893081, "creation_date": 1552893081, "answer_id": 55216176, "question_id": 55214595, "link": "https://stackoverflow.com/questions/55214595/how-to-create-a-table-with-slices-in-columns/55216176#55216176", "title": "How to create a table with slices in columns", "body": "<p>Since arrays are not supported column types in SQL\u2014most versions of SQL at least\u2014gorm will not create columns for fields of type slice.</p>\n\n<p>You can, however, create the relationship structure you are after using an association. In this case either the <a href=\"http://doc.gorm.io/associations.html#has-many\" rel=\"nofollow noreferrer\">has-many</a> or <a href=\"http://doc.gorm.io/associations.html#many-to-many\" rel=\"nofollow noreferrer\">many-to-many</a> would be appropriate (I can't tell from this example, though likely has-many).</p>\n\n<p>These work by creating separate tables for these nested objects. In the has-many relationship, a separate table for items and categories would be created, each with a foreign key reference to the inventory table. The many-to-many case is similar but uses a join table rather than a simple foreign key.</p>\n\n<p>For example (with has-many):</p>\n\n<pre><code>type Inventory struct {\n    gorm.Model\n    LocationID string\n    Items      []Item //this is a slice of structs\n    Categories []Category //this is a slice of structs\n}\n\ntype Item struct {\n    // ...\n    InventoryId uint\n}\n\ntype Category struct {\n    // ...\n    InventoryId uint\n}\n\ndb.Model(&amp;inventory).Related(&amp;items)\ndb.Model(&amp;inventory).Related(&amp;categories)\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 849, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1552893081, "creation_date": 1552881471, "last_edit_date": 1552892593, "question_id": 55214595, "link": "https://stackoverflow.com/questions/55214595/how-to-create-a-table-with-slices-in-columns", "title": "How to create a table with slices in columns", "body": "<p>I have a model that looks like this:</p>\n\n<pre><code>type Inventory struct {\n    gorm.Model\n    LocationID string\n    Items      []Item //this is a slice of structs\n    Categories []Category //this is a slice of structs\n}\n</code></pre>\n\n<p>When I create a table for it using gorm, I don't have the columns for Items or Categories. \n<a href=\"https://i.stack.imgur.com/ofhxD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ofhxD.png\" alt=\"enter image description here\"></a>\nWhat am i missing? </p>\n"}, {"tags": ["string", "go", "split", "substring", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552858818, "post_id": 55212090, "comment_id": 97160302, "body": "The simplest way would be to just &quot;prepend&quot; the separator to each but the first item in the returned slice. <a href=\"https://play.golang.com/p/sA33rVeJjRt\" rel=\"nofollow noreferrer\">play.golang.com/p/sA33rVeJjRt</a>"}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "edited": false, "score": 0, "creation_date": 1552858964, "post_id": 55212090, "comment_id": 97160332, "body": "What he did was basically what I did, but he gave you a nice function to use."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1552859193, "post_id": 55212131, "comment_id": 97160386, "body": "The code in this answer will panic if the string does not contain an @."}], "tags": [], "owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "is_accepted": false, "score": 0, "last_activity_date": 1552858685, "last_edit_date": 1552858685, "creation_date": 1552858317, "answer_id": 55212131, "question_id": 55212090, "link": "https://stackoverflow.com/questions/55212090/string-splitting-before-character/55212131#55212131", "title": "String splitting before character", "body": "<p>Could this work for you?</p>\n\n<pre><code>s := strings.Split(\"email@email.com\", \"@\")\naddress, domain := s[0], \"@\"+s[1]\nfmt.Println(address, domain)\n// email @email.com\n</code></pre>\n\n<p>Then combing and creating a string</p>\n\n<pre><code>var buffer bytes.Buffer\nbuffer.WriteString(address)\nbuffer.WriteString(domain)\nresult := buffer.String()\nfmt.Println(result)\n// email@email.com\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552861545, "post_id": 55212204, "comment_id": 97160943, "body": "Using your suggestion here&#39;s a more complete implementation: <a href=\"https://play.golang.org/p/P4rZvBAuSih\" rel=\"nofollow noreferrer\">play.golang.org/p/P4rZvBAuSih</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1552858916, "creation_date": 1552858916, "answer_id": 55212204, "question_id": 55212090, "link": "https://stackoverflow.com/questions/55212090/string-splitting-before-character/55212204#55212204", "title": "String splitting before character", "body": "<p>Use <a href=\"https://godoc.org/strings#Index\" rel=\"nofollow noreferrer\">strings.Index</a> to find the <code>@</code> and slice to get the two parts:</p>\n\n<pre><code>var part1, part2 string\nif i := strings.Index(s, \"@\"); i &gt;= 0 {\n    part1, part2 = s[:i], s[i:]\n} else {\n    // handle case with no @\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VwG4LXctv87\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 140, "user_id": 4784303, "user_type": "registered", "profile_image": "https://graph.facebook.com/667343653411344/picture?type=large", "display_name": "Preston Rodeniser", "link": "https://stackoverflow.com/users/4784303/preston-rodeniser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "accepted_answer_id": 55212204, "answer_count": 2, "score": 2, "last_activity_date": 1552858916, "creation_date": 1552858033, "question_id": 55212090, "link": "https://stackoverflow.com/questions/55212090/string-splitting-before-character", "title": "String splitting before character", "body": "<p>I'm new to go and have been using split to my advantage. Recently I came across a problem I wanted to split something, and keep the splitting char in my second slice rather than removing it, or leaving it in the first slice as with SplitAfter.</p>\n\n<p>For example the following code:</p>\n\n<pre><code>strings.Split(\"email@email.com\", \"@\")\n</code></pre>\n\n<p>returned: <code>[\"email\", \"email.com\"]</code></p>\n\n<pre><code>strings.SplitAfter(\"email@email.com\", \"@\")\n</code></pre>\n\n<p>returned: <code>[\"email@\", \"email.com\"]</code></p>\n\n<p>What's the best way to get <code>[\"email\", \"@email.com\"]</code>?</p>\n"}, {"tags": ["json", "go", "go-http"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1552856510, "post_id": 55211878, "comment_id": 97159682, "body": "You could make the <code>Value</code> field have a type of <code>interface{}</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552857007, "post_id": 55211878, "comment_id": 97159822, "body": "... <a href=\"https://play.golang.com/p/v_qioEBFEZT\" rel=\"nofollow noreferrer\">example</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "is_accepted": false, "score": -1, "last_activity_date": 1552859166, "creation_date": 1552859166, "answer_id": 55212247, "question_id": 55211878, "link": "https://stackoverflow.com/questions/55211878/how-to-unmarshal-with-different-types-of-the-same-variable/55212247#55212247", "title": "How to unmarshal with different types of the same variable", "body": "<pre><code>type Template []struct {\n    ContactID   int    `json:\"contactId\"`\n    Email       string `json:\"email\"`\n    MarkerName  string `json:\"markerName\"`\n    DataType    string `json:\"dataType\"`\n    Value       string `json:\"value\"`\n    DateEntered string `json:\"dateEntered\"`\n}\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>type Template []struct {\n    ContactID   int    `json:\"contactId\"`\n    Email       string `json:\"email\"`\n    MarkerName  string `json:\"markerName\"`\n    DataType    string `json:\"dataType\"`\n    Value       bool   `json:\"value\"`\n    DateEntered string `json:\"dateEntered\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "is_accepted": false, "score": 2, "last_activity_date": 1552891345, "creation_date": 1552891345, "answer_id": 55215841, "question_id": 55211878, "link": "https://stackoverflow.com/questions/55211878/how-to-unmarshal-with-different-types-of-the-same-variable/55215841#55215841", "title": "How to unmarshal with different types of the same variable", "body": "<p>Since it seems possible for the value of the \"value\" key to be of any type, you should use the type <code>interface{}</code> for this field. This is the empty interface, which matches any type that implements at least zero methods, which is any type.</p>\n\n<p>So you can use the type:</p>\n\n<pre><code>type Contact struct {\n    ContactId   int         `json:\"contactId\"`\n    Email       string      `json:\"email\"`\n    MarkerName  string      `json:\"markerName\"`\n    DataType    string      `json:\"dataType\"`\n    Value       interface{} `json:\"value\"`\n    DateEntered string      `json:\"dateEntered\"`\n}\n</code></pre>\n\n<p>See this <a href=\"https://play.golang.org/p/FpKdh3jA2He\" rel=\"nofollow noreferrer\">working example</a>.</p>\n"}], "owner": {"reputation": 91, "user_id": 8398928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5bcecc6c029a3ac81350153317adcec?s=128&d=identicon&r=PG&f=1", "display_name": "R.Slaby", "link": "https://stackoverflow.com/users/8398928/r-slaby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1552919278, "answer_count": 2, "score": 0, "last_activity_date": 1552892812, "creation_date": 1552856418, "last_edit_date": 1552892812, "question_id": 55211878, "link": "https://stackoverflow.com/questions/55211878/how-to-unmarshal-with-different-types-of-the-same-variable", "closed_reason": "Duplicate", "title": "How to unmarshal with different types of the same variable", "body": "<p>Im working with the API with possibile output:</p>\n\n<pre><code>[\n {\n  \"contactId\": 2,\n  \"email\": \"karina.plain@example.com\",\n  \"markerName\": \"JavascriptEngine\",\n  \"dataType\": \"String\",\n  \"value\": \"Carakan\",\n  \"dateEntered\": \"2013-01-03T14:52:00\"\n },\n{\n  \"contactId\": 2,\n  \"email\": \"karina.plain@example.com\",\n  \"markerName\": \"HasReadEntireMessage\",\n  \"dataType\": \"Boolean\",\n  \"value\": true,\n  \"dateEntered\": \"2013-01-03T18:02:00\"\n }]\n</code></pre>\n\n<p>I have a problem with \"value. \"What should a struct look like, that will allow this JSON to be unmarshal to its array?</p>\n"}, {"tags": ["go", "proxy", "reverse-proxy"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 1059849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55b688dfd8d4c90eb11dfd12feba5f86?s=128&d=identicon&r=PG", "display_name": "Erik Booij", "link": "https://stackoverflow.com/users/1059849/erik-booij"}, "edited": false, "score": 0, "creation_date": 1552851017, "post_id": 55210920, "comment_id": 97158008, "body": "Ah, amazing! Not even a fancy IDE could help me find out that there&#39;s even a <code>.Request</code> property on the <code>response</code> and that there&#39;s in fact a generic <code>context.Context</code> class that does exactly what I&#39;m looking for. That helps a lot, thanks!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1552850101, "creation_date": 1552850101, "answer_id": 55210920, "question_id": 55210593, "link": "https://stackoverflow.com/questions/55210593/share-context-between-handlefunc-and-modifyresponse-in-go-reverse-proxy/55210920#55210920", "title": "Share context between handleFunc and modifyResponse in Go reverse proxy", "body": "<p>Use a standard <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a>.  This is accessible in your handler via the <code>*http.Request</code>.  And the request is also accessible via the <code>*http.Response</code> argument to <code>modifyResponse</code>.</p>\n\n<p>In your handler:</p>\n\n<pre><code>ctx := req.Context()\n// Set values, deadlines, etc.\nreq = req.WithContext(ctx)\nreverseProxy.ServeHTTP(res, req)\n</code></pre>\n\n<p>Then in <code>modifyResponse</code>:</p>\n\n<pre><code>ctx := response.Request.Context()\n// fetch values, check for cancellation, etc\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 1059849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55b688dfd8d4c90eb11dfd12feba5f86?s=128&d=identicon&r=PG", "display_name": "Erik Booij", "link": "https://stackoverflow.com/users/1059849/erik-booij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 0, "accepted_answer_id": 55210920, "answer_count": 1, "score": 0, "last_activity_date": 1552850101, "creation_date": 1552847984, "question_id": 55210593, "link": "https://stackoverflow.com/questions/55210593/share-context-between-handlefunc-and-modifyresponse-in-go-reverse-proxy", "title": "Share context between handleFunc and modifyResponse in Go reverse proxy", "body": "<p>I'm trying to learn Go and figured a nice little project would be an A/B testing proxy to put in front of a web server. Little did I know Go essentially offers a reverse proxy out of the box, so the setup was easy. I've got it to the point where I'm proxying traffic, but here's the thing, I have trouble implementing the actual functionality because wherever I have access to the response, I don't have access to assigned A/B test variations:</p>\n\n<ul>\n<li>In the <code>handleFunc</code> I'm assigning variations of each test to the request, so the upstream server can also be aware of it and use if for implementations in it's backend.</li>\n<li>I'm setting a cookie with all tests and variations, both on the request that's being proxied to the upstream and on the response that's returned to the client.</li>\n<li>Tests that consist of a find/replace pair will do mutations on the response body after the response comes back from the upstream server.</li>\n<li>I'm trying to use the <code>modifyResponse</code> function of <code>httputil.ReverseProxy</code> to do the response mutation.</li>\n</ul>\n\n<p>The problem is that I can't figure out how to share the assigned variations between the <code>handleFunc</code> and <code>modifyResponse</code>, without changing the upstream server. I'd like to be able to share this context (basically a <code>map[string]string</code> somehow.</p>\n\n<h3>Code sample:</h3>\n\n<p>Here's a distilled version of my code, where my question basically is, how can <code>modifyRequest</code> know about random assignments that happened in <code>handleFunc</code>?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    config2 \"ab-proxy/config\"\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n    \"strconv\"\n    \"strings\"\n)\n\nvar config config2.ProxyConfig\nvar reverseProxy *httputil.ReverseProxy\nvar tests config2.Tests\n\nfunc overwriteCookie(req *http.Request, cookie *http.Cookie) {\n    // omitted for brevity, will replace a cookie header, instead of adding a second value\n}\n\nfunc parseRequestCookiesToAssignedTests(req *http.Request) map[string]string {\n    // omitted for brevity, builds a map where the key is the identifier of the test, the value the assigned variant\n}\n\nfunc renderCookieForAssignedTests(assignedTests map[string]string) string {\n    // omitted for brevity, builds a cookie string\n}\n\nfunc main () {\n    var err error\n\n    if  config, err = config2.LoadConfig(); err != nil {\n        fmt.Println(err)\n\n        return\n    }\n\n    if tests, err = config2.LoadTests(); err != nil {\n        fmt.Println(err)\n\n        return\n    }\n\n    upstreamUrl, _ := url.Parse(\"0.0.0.0:80\")\n\n    reverseProxy = httputil.NewSingleHostReverseProxy(upstreamUrl)\n    reverseProxy.ModifyResponse = modifyResponse\n\n    http.HandleFunc(\"/\", handleRequest)\n\n    if err := http.ListenAndServe(\"0.0.0.0:80\", nil); err != nil {\n        fmt.Println(\"Could not start proxy\")\n    }\n}\n\nfunc handleRequest(res http.ResponseWriter, req *http.Request) {\n    assigned := parseRequestCookiesToAssignedTests(req)\n\n    newCookies := make(map[string]string)\n\n    for _, test := range tests.Entries {\n        val, ok := assigned[test.Identifier]\n\n        if ok {\n            newCookies[test.Identifier] = val\n        } else {\n            newCookies[test.Identifier] = \"not-assigned-yet\" // this will be replaced by random variation assignment\n        }\n    }\n\n    testCookie := http.Cookie{Name: config.Cookie.Name, Value: renderCookieForAssignedTests(newCookies)}\n\n    // Add cookie to request to be sent to upstream\n    overwriteCookie(req, &amp;testCookie)\n\n    // Add cookie to response to be returned to client\n    http.SetCookie(res, &amp;testCookie)\n\n    reverseProxy.ServeHTTP(res, req)\n}\n\nfunc modifyResponse (response *http.Response) error {\n    body, err := ioutil.ReadAll(response.Body)\n\n    if err != nil {\n        return  err\n    }\n\n    err = response.Body.Close()\n\n    if err != nil {\n        return err\n    }\n\n    response.Body = ioutil.NopCloser(bytes.NewReader(body))\n    response.ContentLength = int64(len(body))\n    response.Header.Set(\"Content-Length\", strconv.Itoa(len(body)))\n\n    return nil\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 14, "last_activity_date": 1593762959, "last_edit_date": 1593762959, "creation_date": 1552846501, "answer_id": 55210335, "question_id": 55210301, "link": "https://stackoverflow.com/questions/55210301/error-handling-with-http-newrequest-in-go/55210335#55210335", "title": "Error handling with http.NewRequest in Go", "body": "<p>The HTTP call succeeds (the call went through to the server, and response came back), that's why <code>err</code> is <code>nil</code>. It's just that the HTTP status code is not <code>http.StatusOK</code> (but by judging the response document, it's <code>http.StatusNotFound</code>).</p>\n<p>You should check the HTTP status code like this:</p>\n<pre><code>response, err := client.Do(request)\nif err != nil {\n    fmt.Println(&quot;HTTP call failed:&quot;, err)\n    return\n}\n// Don't forget, you're expected to close response body even if you don't want to read it.\ndefer response.Body.Close()\n\nif response.StatusCode != http.StatusOK {\n    fmt.Println(&quot;Non-OK HTTP status:&quot;, response.StatusCode)\n    // You may read / inspect response body\n    return\n}\n\n// All is OK, server reported success.\n</code></pre>\n<p>Also note that certain API endpoints might return other than <code>http.StatusOK</code> for success, such as <code>HTTP 201 - Created</code>, or <code>HTTP 202 - Accepted</code> etc. If you want to check all success status codes, you can do it like this:</p>\n<pre><code>// Success is indicated with 2xx status codes:\nstatusOK := response.StatusCode &gt;= 200 &amp;&amp; response.StatusCode &lt; 300\nif !statusOK {\n    fmt.Println(&quot;Non-OK HTTP status:&quot;, response.StatusCode)\n    // You may read / inspect response body\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 11807758, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tYbk6v8HAKc/AAAAAAAAAAI/AAAAAAAAA0s/7GS_o8oRHl8/photo.jpg?sz=128", "display_name": "ben goodenough", "link": "https://stackoverflow.com/users/11807758/ben-goodenough"}, "edited": false, "score": 1, "creation_date": 1580377200, "post_id": 55210392, "comment_id": 106079940, "body": "I get the following error with this solution: panic: runtime error: invalid memory address or nil pointer dereference. When I ensure the request fails, the response object is not available??"}], "tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 1, "last_activity_date": 1552846809, "creation_date": 1552846809, "answer_id": 55210392, "question_id": 55210301, "link": "https://stackoverflow.com/questions/55210301/error-handling-with-http-newrequest-in-go/55210392#55210392", "title": "Error handling with http.NewRequest in Go", "body": "<p>you should user the status code, you can also write a small handler for every http request that you create. </p>\n\n<pre><code>response, err := client.Do(request)\n        switch response.StatusCode {\n        case 200:\n            fmt.Println(\"work!\")\n            break\n        case 404:\n            fmt.Println(\"not found!\")\n            break\n        default:\n            fmt.Println(\"http\", response.Status)\n        }\n</code></pre>\n"}], "owner": {"reputation": 763, "user_id": 1839005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/18Fhc.jpg?s=128&g=1", "display_name": "Balakumar Ezhilmaran", "link": "https://stackoverflow.com/users/1839005/balakumar-ezhilmaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7998, "favorite_count": 0, "accepted_answer_id": 55210335, "answer_count": 2, "score": 5, "last_activity_date": 1593762959, "creation_date": 1552846250, "last_edit_date": 1552868188, "question_id": 55210301, "link": "https://stackoverflow.com/questions/55210301/error-handling-with-http-newrequest-in-go", "title": "Error handling with http.NewRequest in Go", "body": "<p>I was using <code>http.NewRequest</code> to make a GET Request.  </p>\n\n<p>I deliberately tried to tamper the API url just to check if my err handling works. </p>\n\n<p>But its not working as expected . In err  value is returned and I am unable to compare it. </p>\n\n<pre><code>    jsonData := map[string]string{\"firstname\": \"Nic\", \"lastname\": \"Raboy\"}\n    jsonValue, _ := json.Marshal(jsonData)    \nrequest, err := http.NewRequest(\"POST\", \"http://httpbin.org/postsdf\", bytes.NewBuffer(jsonValue))\n\n\n        request.Header.Set(\"Content-Type\", \"application/json\")\n        client := &amp;http.Client{}\n        response, err := client.Do(request)\n\n        if err != nil {\n            fmt.Println(\"wrong\")\n\n        } else {\n            data, _ := ioutil.ReadAll(response.Body)\n            fmt.Println(string(data))\n        }\n</code></pre>\n\n<p>The output is as below: </p>\n\n<pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\"&gt;\n&lt;title&gt;404 Not Found&lt;/title&gt;\n&lt;h1&gt;Not Found&lt;/h1&gt;\n&lt;p&gt;The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.&lt;/p&gt;\n</code></pre>\n\n<p>But I am expecting to print \"Wrong\". </p>\n"}, {"tags": ["postgresql", "go", "refactoring", "bulkinsert", "pq"], "answers": [{"comments": [{"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 0, "creation_date": 1552855105, "post_id": 55210603, "comment_id": 97159273, "body": "Your code is amazing. What if I can&#39;t use tags on models&#39;s structs?"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 0, "creation_date": 1552855457, "post_id": 55210603, "comment_id": 97159401, "body": "And the other problem is the table name can be different (ex: &quot;TeamId&quot; can be &quot;team_id&quot; on DB) and without tags I think it&#39;s impossible and I need to pass also this information to the func. Am I wrong?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 1, "creation_date": 1552855800, "post_id": 55210603, "comment_id": 97159481, "body": "@FredHors in that case another option would be to create a map of <code>reflect.Type</code>s to table names and columns, but you would need to make sure that the columns are in the same order as the fields. So anytime the order of the fields changes or a field is added/removed you need to also adjust the slice of columns. <a href=\"https://play.golang.com/p/cohQ3rg3BvV\" rel=\"nofollow noreferrer\">play.golang.com/p/cohQ3rg3BvV</a>"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 0, "creation_date": 1552856629, "post_id": 55210603, "comment_id": 97159713, "body": "Amazing. I tried: it works. I&#39;m learning a lot thanks to you: THANKS! Just the last doubt is if I create an array without all fields: let&#39;s say just <code>DBBulkInsert([]User{{Username: &quot;Joe&quot;}, {Username: &quot;Jack&quot;}})</code> without <code>Age</code> field or without <code>Username</code>. What do you think about?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 1, "creation_date": 1552856795, "post_id": 55210603, "comment_id": 97159766, "body": "@FredHors In Go doing <code>User{Username:&quot;Joe&quot;}</code> is the same as <code>User{Username:&quot;Joe&quot;, Age: 0}</code> and <code>User{Age: 21}</code> is the same as <code>User{Username:&quot;&quot;, Age: 21}</code>. Fields not listed in the <i>composite literal</i> will be automatically initialized to their <i>zero value</i>."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 0, "creation_date": 1552857272, "post_id": 55210603, "comment_id": 97159901, "body": "The problem here is with <code>gorm.Model</code> in my model struct which holds 4 columns: <code>&quot;id&quot;, &quot;created_at&quot;, &quot;updated_at&quot;, &quot;deleted_at&quot;</code> and the problem is: <code>2019&#47;03&#47;17 22:12:41 [] sql: converting argument $1 type: unsupported type gorm.Model, a struct</code>. Maybe I can skip it in <code>vals</code> loop? What do you think about?"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 0, "creation_date": 1552857619, "post_id": 55210603, "comment_id": 97160008, "body": "Or maybe I can avoid the use of <code>gorm.Model</code> and simply declare all the fields by myself. Even because I&#39;m using Gorm just now for the MVP."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "edited": false, "score": 1, "creation_date": 1552857752, "post_id": 55210603, "comment_id": 97160041, "body": "@FredHors skipping a field is certainly an option and in the case of <code>gorm.Model</code> probably the right one."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1552856112, "last_edit_date": 1552856112, "creation_date": 1552848028, "answer_id": 55210603, "question_id": 55208819, "link": "https://stackoverflow.com/questions/55208819/create-a-general-func-from-particular-function-refactoring/55210603#55210603", "title": "Create a general func from particular function (refactoring)", "body": "<p>Your <code>rows</code> type needs to be <code>[][]interface{}</code>, i.e. a list of rows where each row is a list of column values. Then with that type each single <code>row</code> can be \"unpacked\" into the <code>Exec</code> call using <code>...</code>.</p>\n\n<p>That is:</p>\n\n<pre><code>for _, row := range rows {\n    _, err = stmt.Exec(row...)\n}\n</code></pre>\n\n<p>To get from <code>[]model.User</code> or <code>[]model.Whatever</code> to <code>[][]interface{}</code> you'll need to use reflection. And if you want, you can also use reflection to get the column names and the table name as well.</p>\n\n<p>Say you have a model type like:</p>\n\n<pre><code>type User struct {\n    _        struct{} `rel:\"users\"`\n    Username string   `col:\"username\"`\n    Age      int      `col:\"age\"`\n}\n</code></pre>\n\n<p>now you could use reflection to get table name and the list of columns from the fields' struct tags. (Note that use of the <code>_</code> (blank) field is just one option of how to specify the table name, it has its downsides and upsides so it's up to you to choose, here I'm just trying to demonstrate how the reflect package can be leveraged).</p>\n\n<p>The following is a more complete example of how to collect the \"meta\" data from tags and how to aggregate the column values from struct fields.</p>\n\n<pre><code>func DBBulkInsert(source interface{}) {\n    slice := reflect.ValueOf(source)\n    if slice.Kind() != reflect.Slice {\n        panic(\"not a slice\")\n    }\n\n    elem := slice.Type().Elem()\n    if elem.Kind() == reflect.Ptr {\n        elem = elem.Elem()\n    }\n    if elem.Kind() != reflect.Struct {\n        panic(\"slice elem not a struct, nor a pointer to a struct\")\n    }\n\n    // get table and column names\n    var tableName string\n    var cols []string\n    for i := 0; i &lt; elem.NumField(); i++ {\n        f := elem.Field(i)\n        if rel := f.Tag.Get(\"rel\"); len(rel) &gt; 0 {\n            tableName = rel\n        }\n        if col := f.Tag.Get(\"col\"); len(col) &gt; 0 {\n            cols = append(cols, col)\n        }\n    }\n\n    // aggregate rows\n    rows := [][]interface{}{}\n    for i := 0; i &lt; slice.Len(); i++ {\n        m := slice.Index(i)\n        if m.Kind() == reflect.Ptr {\n            m = m.Elem()\n        }\n\n        vals := []interface{}{}\n        for j := 0; j &lt; m.NumField(); j++ {\n            ft := m.Type().Field(j)\n            if col := ft.Tag.Get(\"col\"); len(col) &gt; 0 {\n                f := m.Field(j)\n                vals = append(vals, f.Interface())\n            }\n        }\n\n        rows = append(rows, vals)\n    }\n\n    // ...\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/Gi-P2_AYhBv\" rel=\"nofollow noreferrer\">Run it on playground</a></p>\n"}], "owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 55210603, "answer_count": 1, "score": 1, "last_activity_date": 1552856112, "creation_date": 1552837325, "last_edit_date": 1552841127, "question_id": 55208819, "link": "https://stackoverflow.com/questions/55208819/create-a-general-func-from-particular-function-refactoring", "title": "Create a general func from particular function (refactoring)", "body": "<p>I'm using the <code>createUsers</code> func to populate my fake DB, just for tests.</p>\n\n<p>I'm using the bulk imports feature of <code>pq</code> (<a href=\"https://godoc.org/github.com/lib/pq#hdr-Bulk_imports\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq#hdr-Bulk_imports</a>).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func createUsers() {\n\n    users := []models.User{}\n\n    for i := 0; i &lt; 10; i++ {\n        users = append(users, models.User{Username: \"username\"+i, Age: i})\n    }\n\n    connStr := \"user=postgres password=postgres dbname=dbname sslmode=disable\"\n    DB, err = sql.Open(\"postgres\", connStr)\n    checkErr(err)\n\n    txn, err := DB.Begin()\n    checkErr(err)\n\n    stmt, err := txn.Prepare(pq.CopyIn(\"users\", \"username\", \"age\"))\n    checkErr(err)\n\n    for _, user := range users {\n        _, err = stmt.Exec(user.Username, user.Age)\n        checkErr(err)\n    }\n\n    _, err = stmt.Exec()\n    checkErr(err)\n\n    err = stmt.Close()\n    checkErr(err)\n\n    err = txn.Commit()\n    checkErr(err)\n}\n</code></pre>\n\n<p>Everything in this code is working good.</p>\n\n<p><strong>THE NEED:</strong></p>\n\n<p>What I need now is to make it \"general\", not just for User model.</p>\n\n<p>I think I need something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>DBBulkInsert(users, \"users\", \"username\", \"age\")\n</code></pre>\n\n<p>with func <code>DBBulkInsert</code> like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func DBBulkInsert(rows []interface{}, tableName string, tableColumns ...string) {\n    // DB var from connection func\n\n    txn, err := DB.Begin()\n    checkErr(err)\n\n    stmt, err := txn.Prepare(pq.CopyIn(tableName, tableColumns...))\n    checkErr(err)\n\n    for _, row := range rows {\n        _, err = stmt.Exec(row[0], row[1]) //THIS IS TOTALLY WRONG! WHAT TO DO HERE?\n        checkErr(err)\n    }\n\n    _, err = stmt.Exec()\n    checkErr(err)\n\n    err = stmt.Close()\n    checkErr(err)\n\n    err = txn.Commit()\n    checkErr(err)\n}\n</code></pre>\n\n<p><strong>THE PROBLEM:</strong></p>\n\n<p>Obviously <code>_, err = stmt.Exec(row[0], row[1])</code> is totally wrong. I don't understand how to call <code>DBBulkInsert</code> with my users array.</p>\n\n<p><strong>STILL BETTER:</strong></p>\n\n<p>Maybe I can remove also the parameters <code>\"users\", \"username\", \"age\"</code> in <code>DBBulkInsert(users, \"users\", \"username\", \"age\")</code>, but how? Reflection?</p>\n"}, {"tags": ["google-app-engine", "go", "stackdriver", "google-cloud-stackdriver"], "comments": [{"owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "edited": false, "score": 1, "creation_date": 1552837392, "post_id": 55208085, "comment_id": 97153654, "body": "Don&#39;t use the parseXCloudTraceContext() function above for anything other than this single thread test example. In production the ;o=1 part of the x-cloud-trace-context is not always present causing it to panic."}], "answers": [{"tags": [], "owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "is_accepted": true, "score": 3, "last_activity_date": 1585925381, "last_edit_date": 1585925381, "creation_date": 1552835135, "answer_id": 55208484, "question_id": 55208085, "link": "https://stackoverflow.com/questions/55208085/how-to-log-stackdriver-log-messages-correlated-by-trace-id-using-stdout-go-1-11/55208484#55208484", "title": "How to log Stackdriver log messages correlated by trace id using stdout Go 1.11", "body": "<p>I have solved this by adjusting the program to use <code>logging.googleapis.com/trace</code> in place of <code>trace</code> and <code>logging.googleapis.com/spanId</code> in place of <code>spanId</code>.</p>\n\n<pre><code>    warning := fmt.Sprintf(`{\"logging.googleapis.com/trace\":\"%s\",\"logging.googleapis.com/spanId\":\"%s\", \"severity\":\"WARNING\",\"name\":\"Andy\",\"age\":45}`, trace, spanID)\n    fmt.Fprintf(os.Stdout, \"%s\\n\", warning)\n</code></pre>\n\n<p>It seems that GAE is using the logging agent <code>google-fluentd</code> (a modified version of the <code>fluentd</code> log data colletor.)</p>\n\n<p>See this link for a full explanation.\n<a href=\"https://cloud.google.com/logging/docs/agent/configuration#special-fields\" rel=\"nofollow noreferrer\">https://cloud.google.com/logging/docs/agent/configuration#special-fields</a></p>\n\n<p><strong>[update]</strong> June 25th, 2019: I've written a Logrus plugin that will help to thread log entries by HTTP request. It's available under on GitHub <a href=\"https://github.com/andyfusniak/stackdriver-gae-logrus-plugin\" rel=\"nofollow noreferrer\">https://github.com/andyfusniak/stackdriver-gae-logrus-plugin</a>.</p>\n\n<p><strong>[update]]</strong> April 3rd, 2020: I've since switched to using Cloud Run and the Logrus plugin appears to work fine with this platform also. </p>\n"}], "owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1196, "favorite_count": 4, "accepted_answer_id": 55208484, "answer_count": 1, "score": 6, "last_activity_date": 1585925381, "creation_date": 1552832585, "question_id": 55208085, "link": "https://stackoverflow.com/questions/55208085/how-to-log-stackdriver-log-messages-correlated-by-trace-id-using-stdout-go-1-11", "title": "How to log Stackdriver log messages correlated by trace id using stdout Go 1.11", "body": "<p>I'm using Google App Engine Standard Environment with the Go 1.11 runtime. The documentation for Go 1.11 says \"Write your application logs using stdout for output and stderr for errors\". The migration from Go 1.9 guide also suggests not calling the Google Cloud Logging library directly but instead logging via stdout.\n<a href=\"https://cloud.google.com/appengine/docs/standard/go111/writing-application-logs\" rel=\"noreferrer\">https://cloud.google.com/appengine/docs/standard/go111/writing-application-logs</a></p>\n\n<p>With this in mind, I've written a small HTTP Service (code below) to experiment logging to Stackdriver using JSON output to stdout. </p>\n\n<p>When I print plain text messages they appear as expected in the Logs Viewer panel under <code>textPayload</code>. When I pass a JSON string they appear under <code>jsonPayload</code>. So far, so good.</p>\n\n<p>So, I added a <code>severity</code> field to the output string and Stackdriver Log Viewer successfully categorizes the message according to the levelled logging NOTICE, WARNING etc.\n<a href=\"https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry\" rel=\"noreferrer\">https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry</a></p>\n\n<p>The docs say to set the <code>trace</code> identifier to correlate log entries with the originating request log. The trace ID is extracted from the <code>X-Cloud-Trace-Context</code> header set by the container.</p>\n\n<p>Simulate it locally using <code>curl -v -H 'X-Cloud-Trace-Context: 1ad1e4f50427b51eadc9b36064d40cc2/8196282844182683029;o=1' http://localhost:8080/</code></p>\n\n<p>However, this does not cause the messages to be threaded by request, but instead the <code>trace</code> property appears in the <code>jsonPayload</code> object in the logs. (See below).</p>\n\n<p>Notice that <code>severity</code> has been interpreted as expected and does not appear in the <code>jsonPayload</code>. I had expected the same to happen for <code>trace</code>, but instead it appears to be unprocessed.</p>\n\n<p>How can I achieve nested messages within the original request log message? (This must be done using stdout on Go 1.11 as I do not wish to log directly with the Google Cloud logging package).</p>\n\n<p>What exactly is GAE doing to parse the stdout stream from my running process? (In the setup guide for VMs on GCE there is something about installing an agent program to act as a conduit to Stackdriver logging- is this what GAE has installed?)</p>\n\n<p>app.yaml file looks like this:</p>\n\n<pre><code>runtime: go111\n\nhandlers:\n- url: /.*\n  script: auto\n\n\n\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n)\n\nvar projectID = \"glowing-market-234808\"\n\nfunc parseXCloudTraceContext(t string) (traceID, spanID, traceTrue string) {\n    slash := strings.Index(t, \"/\")\n    semi := strings.Index(t, \";\")\n    equal := strings.Index(t, \"=\")\n    return t[0:slash], t[slash+1 : semi], t[equal+1:]\n}\n\nfunc sayHello(w http.ResponseWriter, r *http.Request) {\n    xTrace := r.Header.Get(\"X-Cloud-Trace-Context\")\n    traceID, spanID, _ := parseXCloudTraceContext(xTrace)\n    trace := fmt.Sprintf(\"projects/%s/traces/%s\", projectID, traceID)\n\n    warning := fmt.Sprintf(`{\"trace\":\"%s\",\"spanId\":\"%s\", \"severity\":\"WARNING\",\"name\":\"Andy\",\"age\":45}`, trace, spanID)\n    fmt.Fprintf(os.Stdout, \"%s\\n\", warning)\n\n    message := \"Hello\"\n    w.Write([]byte(message))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayHello)\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n        port = \"8080\"\n    }\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n}\n</code></pre>\n\n<p>Output shown in the Log viewer:</p>\n\n<pre><code>...,\njsonPayload: {\n  age:  45   \n  name:  \"Andy\"   \n  spanId:  \"13076979521824861986\"   \n  trace:  \"projects/glowing-market-234808/traces/e880a38fb5f726216f94548a76a6e474\"   \n},\nseverity:  \"WARNING\",\n...\n</code></pre>\n"}, {"tags": ["go", "websocket", "server-sent-events", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 132, "user_id": 8182174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iQlnR3_9N6M/AAAAAAAAAAI/AAAAAAAAQiQ/ZM0EfkRuhUo/photo.jpg?sz=128", "display_name": "Yuki Ito", "link": "https://stackoverflow.com/users/8182174/yuki-ito"}, "is_accepted": true, "score": 1, "last_activity_date": 1552834073, "creation_date": 1552834073, "answer_id": 55208320, "question_id": 55207853, "link": "https://stackoverflow.com/questions/55207853/how-to-send-message-to-all-connections-in-pool/55208320#55208320", "title": "How to send message to all connections in pool", "body": "<p>It's hard to do it with single channel. The simplest answer is create channel for each connection.</p>\n\n<p>Like:</p>\n\n<pre><code>mu := new(sync.Mutex)\nvar eventChans []sse.Event\n\nrouter.GET(\"/api/addUser/event\", func(c *gin.Context) {\n    c.Header(\"Content-Type\", \"text/event-stream\")\n    c.Header(\"Access-Control-Allow-Origin\", \"*\")\n    c.Header(\"Access-Control-Allow-Headers\", \"access-control-allow-origin, access-control-allow-headers\")\n\n    // Add own channel to the pool.\n    events := make(chan sse.Event)\n    mu.Lock()\n    eventChans = append(eventChans, events)\n    mu.Unlock()\n\n    // Listen for the events.\n    for(event := range events) {\n        sse.Encode(c.Writer, event)\n    }\n})\n\nrouter.POST(\"/api/addUser\", func(c *gin.Context) {\n    mu.Lock()\n    for(_, events := range eventChans) {\n        events &lt;- sse.Event{ ... }\n    }\n    mu.Unlock()\n\n    c.JSON(http.StatusOK, \"okay\")\n})\n</code></pre>\n\n<p>Or use sync.Cond.</p>\n\n<pre><code>cond := sync.NewCond(new(sync.Mutex))\nvar event *sse.Event\n\nrouter.GET(\"/api/addUser/event\", func(c *gin.Context) {\n    c.Header(\"Content-Type\", \"text/event-stream\")\n    c.Header(\"Access-Control-Allow-Origin\", \"*\")\n    c.Header(\"Access-Control-Allow-Headers\", \"access-control-allow-origin, access-control-allow-headers\")\n\n    for {\n        // Wait for event.\n        cond.L.Lock()\n        for(event == nil) {\n            cond.Wait()\n        }\n\n        sse.Encode(c.Writer, event)\n    }\n})\n\nrouter.POST(\"/api/addUser\", func(c *gin.Context) {\n    cond.L.Lock()\n    event = sse.Event{ ... }\n    cond.L.Unlock()\n\n    cond.Broadcast()\n\n    c.JSON(http.StatusOK, \"okay\")\n})\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 4394131, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b5foseZ955g/AAAAAAAAAAI/AAAAAAAAABQ/Wtmfl42AJrI/photo.jpg?sz=128", "display_name": "Tungamirai Mangombe", "link": "https://stackoverflow.com/users/4394131/tungamirai-mangombe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 55208320, "answer_count": 1, "score": 0, "last_activity_date": 1552834073, "creation_date": 1552831213, "last_edit_date": 1552831330, "question_id": 55207853, "link": "https://stackoverflow.com/questions/55207853/how-to-send-message-to-all-connections-in-pool", "title": "How to send message to all connections in pool", "body": "<p>When a server side event is added to a stream, how do I make sure all clients currently connected to that stream receive the event, i.e. how do I loop through all clients and send them the message before discarding the message , is this even possible with sse and Go?</p>\n\n<p>summarised pseudo code of what I want to achieve below</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-contrib/sse\"\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    router := gin.New()\n    router.Use(gin.Logger())\n\n    var events = make(chan sse.Event, 100)\n\n    router.GET(\"/api/addUser/event\", func(c *gin.Context) {\n\n        c.Header(\"Content-Type\", \"text/event-stream\")\n        c.Header(\"Access-Control-Allow-Origin\", \"*\")\n        c.Header(\"Access-Control-Allow-Headers\", \"access-control-allow-origin, access-control-allow-headers\")\n\n        // if events chan has an event\n        // Send event to all connected clients\n\n        if( we have events then send them to all clients){\n\n            event := &lt;-events\n            _ = sse.Encode(c.Writer, event)\n        }\n\n    })\n\n    router.POST(\"/api/addUser\", func(c *gin.Context) {\n\n        //On user add\n        //Add event to events chan\n        events &lt;- sse.Event{\n            Event: \"newChiitiko\",\n            Id:    \"1\",\n            Data:  \"New Chiitiko Event\",\n        }\n\n        c.JSON(http.StatusOK, \"okay\")\n    })\n\n    _ = router.Run(\":5000\")\n}\n</code></pre>\n"}, {"tags": ["go", "mime", "email-parsing"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552828421, "post_id": 55207370, "comment_id": 97150841, "body": "What have you tried? Include your code. What specific problems did you encounter? Show error messages, or actual output, and what you expected to see instead."}, {"owner": {"reputation": 497, "user_id": 4652307, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/2bad08d616c0b8b70938526f5e4c47fe?s=128&d=identicon&r=PG&f=1", "display_name": "Wee Hong", "link": "https://stackoverflow.com/users/4652307/wee-hong"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552829037, "post_id": 55207370, "comment_id": 97150990, "body": "@Flimzy, thank you for correcting my subject and teaching me how to ask a question on SO."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552830017, "post_id": 55207370, "comment_id": 97151272, "body": "Your error is most likely the result of one of your methods returning an error that you&#39;re ignoring. Never ever ever ignore errors!"}, {"owner": {"reputation": 497, "user_id": 4652307, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/2bad08d616c0b8b70938526f5e4c47fe?s=128&d=identicon&r=PG&f=1", "display_name": "Wee Hong", "link": "https://stackoverflow.com/users/4652307/wee-hong"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552830809, "post_id": 55207370, "comment_id": 97151532, "body": "When I <code>log.Println(data)</code>, there is data inside the variable."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552831105, "post_id": 55207370, "comment_id": 97151621, "body": "The error says you&#39;re using an undefined value. You haven&#39;t shown enough of your code, or the error message, to point you to the exact failure."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1552899371, "post_id": 55208817, "comment_id": 97170360, "body": "@WeeHong, vastly extended re. multi-part processing etc"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 6, "last_activity_date": 1555922007, "last_edit_date": 1555922007, "creation_date": 1552837303, "answer_id": 55208817, "question_id": 55207370, "link": "https://stackoverflow.com/questions/55207370/how-to-extract-information-from-raw-email/55208817#55208817", "title": "How to extract Information from Raw Email", "body": "<h2>The theory</h2>\n\n<p>E-mail messages are formatted using basically one of the following two formats.</p>\n\n<p>The oldest one is defined by <a href=\"https://tools.ietf.org/html/rfc5322\" rel=\"nofollow noreferrer\">RFC 5322</a>\n(originally it was RFC 822 but it has been updated since then).</p>\n\n<p>This format  does not support messages using non-ASCII character encodings and neither does it support what general public calls \"attachments\".</p>\n\n<p>To rectify the situation, the <em>set</em> of standards commonly\nknown as <a href=\"https://en.wikipedia.org/wiki/MIME\" rel=\"nofollow noreferrer\">MIME</a> was invented.\nThe standards in this set define:</p>\n\n<ul>\n<li>Ways to use non-ASCII character encodings.</li>\n<li>Ways to compose <em>multi-part</em> messages.</li>\n</ul>\n\n<p>The two most interesting MIME standards are\n<a href=\"https://tools.ietf.org/html/rfc2045\" rel=\"nofollow noreferrer\">RFC 2045</a>\nand <a href=\"https://tools.ietf.org/html/rfc2046\" rel=\"nofollow noreferrer\">RFC 2046</a>.</p>\n\n<p>The standards incorporated by MIME were specifically devised\nin a way to make MIME-encoded stuff still compatible with\nRFC 822\u2014this, among other things, allowed not to change\n<a href=\"https://en.wikipedia.org/wiki/Message_transfer_agent\" rel=\"nofollow noreferrer\">MTAs</a>\nto support the new message format.</p>\n\n<h2>The practice</h2>\n\n<p>Libraries implemented in various programming lanugages\nto deal with various bits defined by MIME usually follow\nthe trend of the MIME itself and are able to transparently\nhandle \"plain\" RFC 822-formatted mails and MIME-formatted.</p>\n\n<p>To handle MIME-formatted messages, Go offers in its standard\nlibrary the three packages:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/mime/\" rel=\"nofollow noreferrer\"><code>mime</code></a></li>\n<li><a href=\"https://golang.org/pkg/mime/multipart/\" rel=\"nofollow noreferrer\"><code>mime/multipart</code></a></li>\n<li><a href=\"https://golang.org/pkg/mime/quotedprintable/\" rel=\"nofollow noreferrer\"><code>mime/quotedprintable</code></a></li>\n</ul>\n\n<p>and another one,\n<a href=\"https://golang.org/pkg/net/textproto/\" rel=\"nofollow noreferrer\"><code>net/textproto</code></a>,\nto deal with MIME-style headers (also used in HTTP,\nIMAP/POP3 etc).</p>\n\n<p>Together, these packages cover most (or all) of what you need to read and write MIME-formatted e-mail messages.</p>\n\n<h3>The basic approach to parsing</h3>\n\n<p>The basic approach to parsing an e-mail message\nis as follows:</p>\n\n<ol>\n<li><p>Create an instance of <a href=\"https://golang.org/pkg/bufio/#Reader\" rel=\"nofollow noreferrer\"><code>bufio.Reader</code></a>\nfrom an <code>io.Reader</code> supplying the data of the e-mail\nmessage to be parsed.</p></li>\n<li><p>Create an instance of <a href=\"https://golang.org/pkg/net/textproto/#Reader\" rel=\"nofollow noreferrer\"><code>net/textproto.Reader</code></a>\nfrom the <code>bufio.Reader</code> made on the previous step.</p></li>\n<li><p>Use its <code>ReadMIMEHeader()</code> method to read\nand parse the message's header block.</p></li>\n<li><p>Check to see whether it contains the <code>MIME-Version</code>\nfield mandated by RFC 2045 to indicate a MIME-formatted\ncontent.</p>\n\n<ol>\n<li>If it contains one, verify its value is literally\n\"1.0\". If it isn't, this is some MIME format from the\nfuture you won't be able to cope with. Barf accordingly;\notherwise proceed to the next step.</li>\n<li>If there is no such field, the message is a plain old e-mail consisting of a single part.\nConsider its whole contents as if it were a single MIME-message part (this is oversimplified but would mostly work).</li>\n</ol></li>\n<li><p>If you have verified you're dealing with a MIME 1.0 message, then</p>\n\n<ol>\n<li>Read the <code>Content-Type</code> header field then use\n<a href=\"https://golang.org/pkg/mime/#ParseMediaType\" rel=\"nofollow noreferrer\"><code>mime.ParseMediaType()</code></a> to parse it.\n\n<ul>\n<li>If the resulting <code>mediatype</code> value will start with the \"multipart/\" prefix, literally, then be prepared to deal with multiple parts, which require recursive processing as each part is formatted almost like the top-level message\u2014that is, contains the header and the body (see below).</li>\n<li>Otherwise the content type will indicate some kind of \"direct\" payload (such as \"text/plain\" or \"text/html\" or whatever).\nIn this case, a special \"parameter\" of such media type (see below) indicates the character encoding used for the part's content, if it's textual.\n(Also note that it may be \"message/rfc822\" which actually indicates the payload is another e-mail message which might need to be parsed according to the same rules as the encloding one.)</li>\n</ul></li>\n</ol></li>\n</ol>\n\n<h3>Dealing with a \"leaf\" part or non-multi-part message payloads</h3>\n\n<p>An importand header field to read next is <code>Content-Transfer-Encoding</code> which defines how the part is physically encoded to be transferred over the wire.</p>\n\n<p>Most of the time it will be \"base64\" but it also may be \"quoted-printable\".</p>\n\n<h3>Dealing with multi-part messages</h3>\n\n<p>First, be prepared to properly deal with the different aspects of what \"multi part\" is: the parts might be either <em>alternatives</em> to each other\u2014that is, the program which is to render a message to the user might pick <em>any</em> of them\u2014whatever suits the user's preference best, or ask them or something else,\u2014or they may be entities sort-of equal to each other.\nThe former scheme is indicated by the \"multipart/alternative\" media type and is typically used by MUAs which allow the user to compose a mail message using markup and then encode the result so that it contains two alternative parts\u2014one marked as \"text/html\" and another one marked as \"text/plain\" and containing the source content stripped of that markup nonsense.\nThe latter is indicated by \"multipart/mixed\" and is typically used for attachments: with this scheme the first part is typically (but it's not required to be that) is the message's text in whatever format and the rest of the parts are attachments.</p>\n\n<p>To be able to pick out the individual parts from the message's encoding, the \"multipart/whatever\" media type most of the time contains a so-called \"parameter\" named \"boundary\" and containing a unique string which is used to delimit the parts.\nThe <code>mime.ParseMediaType()</code> function returns the media type's parameters in the form of a map as its second result value.</p>\n\n<p>After extracting that \"boundary\" media type's parameter,\nyou can use it to create an instance of <a href=\"https://golang.org/pkg/mime/multipart/#Reader\" rel=\"nofollow noreferrer\"><code>mime/multipart.Reader</code></a> from the <code>bufio.Reader</code> instance made on the very first step.\nYou can then read the message parts one-by one and act on them.</p>\n\n<p>Note that, as already indicated, a message part might have the content type \"message/rfc822\" which means it contains another complete mail message (and it itself might be multi-part and contain other mail messages, and so on).</p>\n"}], "owner": {"reputation": 497, "user_id": 4652307, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/2bad08d616c0b8b70938526f5e4c47fe?s=128&d=identicon&r=PG&f=1", "display_name": "Wee Hong", "link": "https://stackoverflow.com/users/4652307/wee-hong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1708, "favorite_count": 0, "accepted_answer_id": 55208817, "answer_count": 1, "score": -2, "last_activity_date": 1555922007, "creation_date": 1552827889, "last_edit_date": 1552837375, "question_id": 55207370, "link": "https://stackoverflow.com/questions/55207370/how-to-extract-information-from-raw-email", "title": "How to extract Information from Raw Email", "body": "<h2>What I have done so far</h2>\n\n<p>I use <a href=\"https://godoc.org/github.com/bytbox/go-pop3\" rel=\"nofollow noreferrer\">POP3</a> package to read all my emails from my mailbox.</p>\n\n<p>I received a raw email from the <code>POP3</code> function which shown at the example below. (I omitted some information)</p>\n\n<h2>Issue</h2>\n\n<p>I'm facing the issue to extract the information from it.</p>\n\n<p>I used the <a href=\"https://godoc.org/net/mail\" rel=\"nofollow noreferrer\">mail</a> to extract the information, but unfortunately, this package cannot extract information from the raw email.</p>\n\n<h2>Seeking for help</h2>\n\n<p>Is there any method or package there which can help me to extract the information from the raw email?</p>\n\n<hr>\n\n<h3>Methods I had tried</h3>\n\n<pre><code>// Retrieve all the email from your mailbox\nmsgs, _, error := connection.ListAll()\n\n// Convert a chunk of integer to raw email\ndata, _ := connection.Retr(msgs[0])\n\n// Extract Email Address\nto, _ := mail.ParseAddress(data)\n</code></pre>\n\n<h3>Error I am facing</h3>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x0 pc=0x5819ed]\n</code></pre>\n\n<h3>Raw Email Example</h3>\n\n<pre><code>From: \nTo: \nSubject: \nThread-Topic: \nThread-Index: AdPgWzcFT3FjbSbUT1ycoU2ioB1bKAAAAHuA\nX-MS-Exchange-MessageSentRepresentingType: 1\nDate: \nMessage-ID: \nAccept-Language: en-SG, en-US\nContent-Language: en-US\nX-MS-Exchange-Organization-AuthAs: Internal\nX-MS-Exchange-Organization-AuthMechanism: 04\nX-MS-Exchange-Organization-AuthSource: \nX-MS-Has-Attach:\nX-MS-Exchange-Organization-Network-Message-Id:\n    8c1e141b-c3ba-4471-0526-08d5b3b59967\nX-MS-TNEF-Correlator:\nContent-Type: multipart/alternative;\n    boundary=\"_002_b1a01aa36e1c4b3d9969a7bbb856bd3b\"\nMIME-Version: 1.0\n\n--_002_b1a01aa36e1c4b3d9969a7bbb856bd3b\nContent-Type: text/html; charset=\"utf-8\"\nContent-Transfer-Encoding: base64\n\nPGh0bWwgeG1sbnM6dj0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwiIHhtbG5zOm89InVy\nbjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZSIgeG1sbnM6dz0idXJuOnNjaGVt\nYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6d29yZCIgeG1sbnM6bT0iaHR0cDovL3NjaGVtYXMubWlj\ncm9zb2Z0LmNvbS9vZmZpY2UvMjAwNC8xMi9vbW1sIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv\nVFIvUkVDLWh0bWw0MCI+DQo8aGVhZD4NCjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIg\nY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4NCjxtZXRhIG5hbWU9IkdlbmVyYXRv\nciIgY29udGVudD0iTWljcm9zb2Z0IFdvcmQgMTUgKGZpbHRlcmVkIG1lZGl1bSkiPg0KPHN0eWxl\nPjwhLS0NCi8qIEZvbnQgRGVmaW5pdGlvbnMgKi8NCkBmb250LWZhY2UNCgl7Zm9udC1mYW1pbHk6\nIkNhbWJyaWEgTWF0aCI7DQoJcGFub3NlLTE6MiA0IDUgMyA1IDQgNiAzIDIgNDt9DQpAZm9udC1m\nYWNlDQoJe2ZvbnQtZmFtaWx5OkRlbmdYaWFuOw0KCXBhbm9zZS0xOjIgMSA2IDAgMyAxIDEgMSAx\nIDE7fQ0KQGZvbnQtZmFjZQ0KCXtmb250LWZhbWlseTpDYWxpYnJpOw0KCXBhbm9zZS0xOjIgMTUg\nNSAyIDIgMiA0IDMgMiA0O30NCkBmb250LWZhY2UNCgl7Zm9udC1mYW1pbHk6IlxARGVuZ1hpYW4i\nOw0KCXBhbm9zZS0xOjIgMSA2IDAgMyAxIDEgMSAxIDE7fQ0KLyogU3R5bGUgRGVmaW5pdGlvbnMg\nKi8NCnAuTXNvTm9ybWFsLCBsaS5Nc29Ob3JtYWwsIGRpdi5Nc29Ob3JtYWwNCgl7bWFyZ2luOjBj\nbTsNCgltYXJnaW4tYm90dG9tOi4wMDAxcHQ7DQoJZm9udC1zaXplOjExLjBwdDsNCglmb250LWZh\nbWlseToiQ2FsaWJyaSIsc2Fucy1zZXJpZjt9DQphOmxpbmssIHNwYW4uTXNvSHlwZXJsaW5rDQoJ\ne21zby1zdHlsZS1wcmlvcml0eTo5OTsNCgljb2xvcjojMDU2M0MxOw0KCXRleHQtZGVjb3JhdGlv\nbjp1bmRlcmxpbmU7fQ0KYTp2aXNpdGVkLCBzcGFuLk1zb0h5cGVybGlua0ZvbGxvd2VkDQoJe21z\nby1zdHlsZS1wcmlvcml0eTo5OTsNCgljb2xvcjojOTU0RjcyOw0KCXRleHQtZGVjb3JhdGlvbjp1\nbmRlcmxpbmU7fQ0KcC5tc29ub3JtYWwwLCBsaS5tc29ub3JtYWwwLCBkaXYubXNvbm9ybWFsMA0K\nCXttc28tc3R5bGUtbmFtZTptc29ub3JtYWw7DQoJbXNvLW1hcmdpbi10b3AtYWx0OmF1dG87DQoJ\nbWFyZ2luLXJpZ2h0OjBjbTsNCgltc28tbWFyZ2luLWJvdHRvbS1hbHQ6YXV0bzsNCgltYXJnaW4t\nbGVmdDowY207DQoJZm9udC1zaXplOjEyLjBwdDsNCglmb250LWZhbWlseToiVGltZXMgTmV3IFJv\nbWFuIixzZXJpZjt9DQpzcGFuLkVtYWlsU3R5bGUxOA0KCXttc28tc3R5bGUtdHlwZTpwZXJzb25h\nbC1jb21wb3NlOw0KCWZvbnQtZmFtaWx5OiJDYWxpYnJpIixzYW5zLXNlcmlmOw0KCWNvbG9yOndp\nbmRvd3RleHQ7fQ0KLk1zb0NocERlZmF1bHQNCgl7bXNvLXN0eWxlLXR5cGU6ZXhwb3J0LW9ubHk7\nDQoJZm9udC1zaXplOjEwLjBwdDsNCglmb250LWZhbWlseToiQ2FsaWJyaSIsc2Fucy1zZXJpZjt9\nDQpAcGFnZSBXb3JkU2VjdGlvbjENCgl7c2l6ZTo2MTIuMHB0IDc5Mi4wcHQ7DQoJbWFyZ2luOjcy\nLjBwdCA3Mi4wcHQgNzIuMHB0IDcyLjBwdDt9DQpkaXYuV29yZFNlY3Rpb24xDQoJe3BhZ2U6V29y\nZFNlY3Rpb24xO30NCi0tPjwvc3R5bGU+PCEtLVtpZiBndGUgbXNvIDldPjx4bWw+DQo8bzpzaGFw\nZWRlZmF1bHRzIHY6ZXh0PSJlZGl0IiBzcGlkbWF4PSIxMDI2IiAvPg0KPC94bWw+PCFbZW5kaWZd\nLS0+PCEtLVtpZiBndGUgbXNvIDldPjx4bWw+DQo8bzpzaGFwZWxheW91dCB2OmV4dD0iZWRpdCI+\nDQo8bzppZG1hcCB2OmV4dD0iZWRpdCIgZGF0YT0iMSIgLz4NCjwvbzpzaGFwZWxheW91dD48L3ht\nbD48IVtlbmRpZl0tLT4NCjwvaGVhZD4NCjxib2R5IGxhbmc9IkVOLVNHIiBsaW5rPSIjMDU2M0Mx\nIiB2bGluaz0iIzk1NEY3MiI+DQo8ZGl2IGNsYXNzPSJXb3JkU2VjdGlvbjEiPg0KPHAgY2xhc3M9\nIk1zb05vcm1hbCI+PG86cD4mbmJzcDs8L286cD48L3A+DQo8L2Rpdj4NCjxicj4NCjxociBhbGln\nbj0ibGVmdCIgc3R5bGU9Im1hcmdpbi1sZWZ0OjA7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjUwJTto\nZWlnaHQ6MXB4O2JhY2tncm91bmQtY29sb3I6Z3JheTtib3JkZXI6MHB4OyI+DQo8Zm9udCBzdHls\nZT0iY29sb3I6Z3JheTsiIHNpemU9Ii0xIj5UaGlzIGVtYWlsIHdhcyBzY2FubmVkIGJ5IEJpdGRl\nZmVuZGVyPC9mb250Pg0KPC9ib2R5Pg0KPC9odG1sPg0K\n\n--_002_b1a01aa36e1c4b3d9969a7bbb856bd3b\nContent-Type: text/calendar; charset=\"utf-8\"; method=REQUEST\nContent-Transfer-Encoding: base64\n\nQkVHSU46VkNBTEVOREFSDQpNRVRIT0Q6UkVRVUVTVA0KUFJPRElEOk1pY3Jvc29mdCBFeGNoYW5n\nZSBTZXJ2ZXIgMjAxMA0KVkVSU0lPTjoyLjANCkJFR0lOOlZUSU1FWk9ORQ0KVFpJRDpTaW5nYXBv\ncmUgU3RhbmRhcmQgVGltZQ0KQkVHSU46U1RBTkRBUkQNCkRUU1RBUlQ6MTYwMTAxMDFUMDAwMDAw\nDQpUWk9GRlNFVEZST006KzA4MDANClRaT0ZGU0VUVE86KzA4MDANCkVORDpTVEFOREFSRA0KQkVH\nSU46REFZTElHSFQNCkRUU1RBUlQ6MTYwMTAxMDFUMDAwMDAwDQpUWk9GRlNFVEZST006KzA4MDAN\nClRaT0ZGU0VUVE86KzA4MDANCkVORDpEQVlMSUdIVA0KRU5EOlZUSU1FWk9ORQ0KQkVHSU46VkVW\nRU5UDQpPUkdBTklaRVI7Q049SG8gU2lldyBLZWU6TUFJTFRPOkhPX1NpZXdfS2VlQGlwaS1zaW5n\nYXBvcmUub3JnDQpBVFRFTkRFRTtST0xFPVJFUS1QQVJUSUNJUEFOVDtQQVJUU1RBVD1ORUVEUy1B\nQ1RJT047UlNWUD1UUlVFO0NOPUtvaCBXZWUgSG8NCiBuZzpNQUlMVE86S09IX1dlZV9Ib25nQGlw\naS1zaW5nYXBvcmUub3JnDQpERVNDUklQVElPTjtMQU5HVUFHRT1lbi1VUzpcblxuX19fX19fX19f\nX19fX19fX19fX19fX19fX19fX19fX19cblRoaXMgZW1haWwNCiAgd2FzIHNjYW5uZWQgYnkgQml0\nZGVmZW5kZXJcbg0KVUlEOjA0MDAwMDAwODIwMEUwMDA3NEM1QjcxMDFBODJFMDA4MDAwMDAwMDA0\nMDEzMTY0NzlFRTBEMzAxMDAwMDAwMDAwMDAwMDAwDQogMDEwMDAwMDAwMzQ5NDcwQUMzMzQ0NzM0\nMDk5QzM0OEE0M0E0M0ZCREMNClNVTU1BUlk7TEFOR1VBR0U9ZW4tVVM6SFIgT3JpZW50YXRpb246\nIEtvaCBXZWUgSG9uZyAoQU0gLSBEaWdpdGFsIFBsYXRmb3Jtcw0KICkNCkRUU1RBUlQ7VFpJRD1T\naW5nYXBvcmUgU3RhbmRhcmQgVGltZToyMDE4MDUwN1QxNDAwMDANCkRURU5EO1RaSUQ9U2luZ2Fw\nb3JlIFN0YW5kYXJkIFRpbWU6MjAxODA1MDdUMTUzMDAwDQpDTEFTUzpQVUJMSUMNClBSSU9SSVRZ\nOjUNCkRUU1RBTVA6MjAxODA1MDdUMDA1ODA2Wg0KVFJBTlNQOk9QQVFVRQ0KU1RBVFVTOkNPTkZJ\nUk1FRA0KU0VRVUVOQ0U6Mw0KTE9DQVRJT047TEFOR1VBR0U9ZW4tVVM6Q29ubmVjdGlvbg0KWC1N\nSUNST1NPRlQtQ0RPLUFQUFQtU0VRVUVOQ0U6Mw0KWC1NSUNST1NPRlQtQ0RPLU9XTkVSQVBQVElE\nOjEzMDY0MTMwMjYNClgtTUlDUk9TT0ZULUNETy1CVVNZU1RBVFVTOlRFTlRBVElWRQ0KWC1NSUNS\nT1NPRlQtQ0RPLUlOVEVOREVEU1RBVFVTOkJVU1kNClgtTUlDUk9TT0ZULUNETy1BTExEQVlFVkVO\nVDpGQUxTRQ0KWC1NSUNST1NPRlQtQ0RPLUlNUE9SVEFOQ0U6MQ0KWC1NSUNST1NPRlQtQ0RPLUlO\nU1RUWVBFOjANClgtTUlDUk9TT0ZULURJU0FMTE9XLUNPVU5URVI6RkFMU0UNCkJFR0lOOlZBTEFS\nTQ0KREVTQ1JJUFRJT046UkVNSU5ERVINClRSSUdHRVI7UkVMQVRFRD1TVEFSVDotUFQxNU0NCkFD\nVElPTjpESVNQTEFZDQpFTkQ6VkFMQVJNDQpFTkQ6VkVWRU5UDQpFTkQ6VkNBTEVOREFSDQo=\n\n--_002_b1a01aa36e1c4b3d9969a7bbb856bd3b\n</code></pre>\n"}, {"tags": ["go", "compilation"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1552827260, "creation_date": 1552827260, "answer_id": 55207272, "question_id": 55207127, "link": "https://stackoverflow.com/questions/55207127/how-to-run-go-compiler-from-another-go-application/55207272#55207272", "title": "How to run Go compiler from another Go application", "body": "<blockquote>\n  <p>Does Go toolchain provides any API for that?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 55207272, "answer_count": 1, "score": 0, "last_activity_date": 1552827260, "creation_date": 1552826286, "question_id": 55207127, "link": "https://stackoverflow.com/questions/55207127/how-to-run-go-compiler-from-another-go-application", "title": "How to run Go compiler from another Go application", "body": "<p>Are there any options to run Go compiler and build some package from another Go application without resorting to <code>os/exec</code> interfaces? Does Go toolchain provides any API for that?</p>\n"}, {"tags": ["docker", "go", "kubernetes", "yaml", "amazon-eks"], "comments": [{"owner": {"reputation": 3531, "user_id": 1626280, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qx3zw.jpg?s=128&g=1", "display_name": "Amityo", "link": "https://stackoverflow.com/users/1626280/amityo"}, "edited": false, "score": 0, "creation_date": 1552822126, "post_id": 55206520, "comment_id": 97149215, "body": "can you add the logs of the failing container?"}, {"owner": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "reply_to_user": {"reputation": 3531, "user_id": 1626280, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qx3zw.jpg?s=128&g=1", "display_name": "Amityo", "link": "https://stackoverflow.com/users/1626280/amityo"}, "edited": false, "score": 0, "creation_date": 1552822634, "post_id": 55206520, "comment_id": 97149337, "body": "Have amended the original post. Thanks"}, {"owner": {"reputation": 3531, "user_id": 1626280, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qx3zw.jpg?s=128&g=1", "display_name": "Amityo", "link": "https://stackoverflow.com/users/1626280/amityo"}, "edited": false, "score": 0, "creation_date": 1552823469, "post_id": 55206520, "comment_id": 97149545, "body": "this looks like kubectl describe, can you try - kubectl logs &lt;pod-name&gt;"}, {"owner": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "reply_to_user": {"reputation": 3531, "user_id": 1626280, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qx3zw.jpg?s=128&g=1", "display_name": "Amityo", "link": "https://stackoverflow.com/users/1626280/amityo"}, "edited": false, "score": 0, "creation_date": 1552825160, "post_id": 55206520, "comment_id": 97149951, "body": "I&#39;m getting this error whilst tying, any ideas: 2019/03/17 12:14:02 listen tcp :80: bind: permission denied"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1552825357, "post_id": 55206520, "comment_id": 97149997, "body": "Did you try to add to your Dockerfile <code>EXPOSE 3001</code>?"}, {"owner": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "edited": false, "score": 0, "creation_date": 1552826019, "post_id": 55206520, "comment_id": 97150165, "body": "Tried that with no success unfortunately"}], "answers": [{"comments": [{"owner": {"reputation": 214, "user_id": 4514193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HI6fJTFkrPg/AAAAAAAAAAI/AAAAAAAAAIs/6RX23Vdk5zU/photo.jpg?sz=128", "display_name": "Akash Srivastava", "link": "https://stackoverflow.com/users/4514193/akash-srivastava"}, "reply_to_user": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "edited": false, "score": 0, "creation_date": 1552843869, "post_id": 55209683, "comment_id": 97155814, "body": "I tried this on minikube and faced no issue, can you check the details of the events using <code>kubectl describe pod</code> command, it might give some insights as to why its going in CrashLoopBackOff"}, {"owner": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "edited": false, "score": 0, "creation_date": 1552850048, "post_id": 55209683, "comment_id": 97157726, "body": "I just realized I made a mistake when deploying your change! Everything works now. Thank you so much."}], "tags": [], "owner": {"reputation": 214, "user_id": 4514193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HI6fJTFkrPg/AAAAAAAAAAI/AAAAAAAAAIs/6RX23Vdk5zU/photo.jpg?sz=128", "display_name": "Akash Srivastava", "link": "https://stackoverflow.com/users/4514193/akash-srivastava"}, "is_accepted": true, "score": 2, "last_activity_date": 1552845559, "last_edit_date": 1552845559, "creation_date": 1552842487, "answer_id": 55209683, "question_id": 55206520, "link": "https://stackoverflow.com/questions/55206520/go-microservices-with-ambassador-api-gateway/55209683#55209683", "title": "Go Microservices with Ambassador API Gateway", "body": "<p>In your kubernetes deployment file you have exposed a readiness probe on port 5000 while your application is exposed on port 3001, also while running the container a few times I got OOMKilled so increased the memory limit. Anyways below deployment file should work fine.</p>\n\n<pre><code>apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: qotm\nspec:\n  replicas: 1\n  strategy:\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        app: qotm\n    spec:\n      containers:\n        - name: qotm\n          image: &lt;YOUR_IMAGE&gt;\n          imagePullPolicy: Always\n          ports:\n            - name: http-api\n              containerPort: 3001\n          readinessProbe:\n            httpGet:\n              path: /health\n              port: 3001\n            initialDelaySeconds: 30\n            periodSeconds: 3\n          resources:\n            limits:\n              cpu: \"0.1\"\n              memory: 200Mi\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 9499097, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EcYHTJH1P1I/AAAAAAAAAAI/AAAAAAAAAGU/wv3yEAJ1JvY/photo.jpg?sz=128", "display_name": "Lewis", "link": "https://stackoverflow.com/users/9499097/lewis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 1, "accepted_answer_id": 55209683, "answer_count": 1, "score": 3, "last_activity_date": 1553117359, "creation_date": 1552821988, "last_edit_date": 1553117359, "question_id": 55206520, "link": "https://stackoverflow.com/questions/55206520/go-microservices-with-ambassador-api-gateway", "title": "Go Microservices with Ambassador API Gateway", "body": "<p>I'm having a few issues getting Ambassador to work correctly. I'm new to Kubernetes and just teaching myself.</p>\n\n<p>I have successfully managed to work through the demo material Ambassador provide - e.g /httpbin/ endpoint is working correctly, but when I try to deploy a Go service it is falling over.</p>\n\n<p>When hitting the 'qotm' endpoint, the page this is the response: </p>\n\n<pre><code>upstream request timeout\n</code></pre>\n\n<p>Pod status:</p>\n\n<pre><code>CrashLoopBackOff\n</code></pre>\n\n<p>From my research, it seems to be related to the yaml file not being configured correctly but I'm struggling to find any documentation relating to this use case.</p>\n\n<p>My cluster is running on AWS EKS and the images are being pushed to AWS ECR.</p>\n\n<p>main.go: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    var PORT string\n    if PORT = os.Getenv(\"PORT\"); PORT == \"\" {\n        PORT = \"3001\"\n    }\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"Hello World from path: %s\\n\", r.URL.Path)\n    })\n    http.ListenAndServe(\":\" + PORT, nil)\n}\n</code></pre>\n\n<p>Dockerfile:</p>\n\n<pre><code>FROM golang:alpine\nADD ./src /go/src/app\nWORKDIR /go/src/app\nEXPOSE 3001\nENV PORT=3001\nCMD [\"go\", \"run\", \"main.go\"]\n</code></pre>\n\n<p>test.yaml: </p>\n\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: qotm\n  annotations:\n    getambassador.io/config: |\n      ---\n      apiVersion: ambassador/v1\n      kind:  Mapping\n      name:  qotm_mapping\n      prefix: /qotm/\n      service: qotm\nspec:\n  selector:\n    app: qotm\n  ports:\n    - port: 80\n      name: http-qotm\n      targetPort: http-api\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: qotm\nspec:\n  replicas: 1\n  strategy:\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        app: qotm\n    spec:\n      containers:\n        - name: qotm\n          image: ||REMOVED||\n          ports:\n            - name: http-api\n              containerPort: 3001\n          readinessProbe:\n            httpGet:\n              path: /health\n              port: 5000\n            initialDelaySeconds: 30\n            periodSeconds: 3\n          resources:\n            limits:\n              cpu: \"0.1\"\n              memory: 100Mi\n</code></pre>\n\n<p>Pod description:</p>\n\n<pre><code>Name:               qotm-7b9bf4d499-v9nxq\nNamespace:          default\nPriority:           0\nPriorityClassName:  &lt;none&gt;\nNode:               ip-192-168-89-69.eu-west-1.compute.internal/192.168.89.69\nStart Time:         Sun, 17 Mar 2019 17:19:50 +0000\nLabels:             app=qotm\n                    pod-template-hash=3656908055\nAnnotations:        &lt;none&gt;\nStatus:             Running\nIP:                 192.168.113.23\nControlled By:      ReplicaSet/qotm-7b9bf4d499\nContainers:\n  qotm:\n    Container ID:   docker://5839996e48b252ac61f604d348a98c47c53225712efd503b7c3d7e4c736920c4\n    Image:          IMGURL\n    Image ID:       docker-pullable://IMGURL\n    Port:           3001/TCP\n    Host Port:      0/TCP\n    State:          Waiting\n      Reason:       CrashLoopBackOff\n    Last State:     Terminated\n      Reason:       Error\n      Exit Code:    1\n      Started:      Sun, 17 Mar 2019 17:30:49 +0000\n      Finished:     Sun, 17 Mar 2019 17:30:49 +0000\n    Ready:          False\n    Restart Count:  7\n    Limits:\n      cpu:     100m\n      memory:  200Mi\n    Requests:\n      cpu:        100m\n      memory:     200Mi\n    Readiness:    http-get http://:3001/health delay=30s timeout=1s period=3s #success=1 #failure=3\n    Environment:  &lt;none&gt;\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-5bbxw (ro)\nConditions:\n  Type              Status\n  Initialized       True \n  Ready             False \n  ContainersReady   False \n  PodScheduled      True \nVolumes:\n  default-token-5bbxw:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-5bbxw\n    Optional:    false\nQoS Class:       Guaranteed\nNode-Selectors:  &lt;none&gt;\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type     Reason     Age                  From                                                  Message\n  ----     ------     ----                 ----                                                  -------\n  Normal   Scheduled  12m                  default-scheduler                                     Successfully assigned default/qotm-7b9bf4d499-v9nxq to ip-192-168-89-69.eu-west-1.compute.internal\n  Normal   Pulled     10m (x5 over 12m)    kubelet, ip-192-168-89-69.eu-west-1.compute.internal  Container image \"IMGURL\" already present on machine\n  Normal   Created    10m (x5 over 12m)    kubelet, ip-192-168-89-69.eu-west-1.compute.internal  Created container\n  Normal   Started    10m (x5 over 11m)    kubelet, ip-192-168-89-69.eu-west-1.compute.internal  Started container\n  Warning  BackOff    115s (x47 over 11m)  kubelet, ip-192-168-89-69.eu-west-1.compute.internal  Back-off restarting failed container\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7336228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fxdIXBMYloc/AAAAAAAAAAI/AAAAAAAAEy0/yrkBzd0E_gE/photo.jpg?sz=128", "display_name": "abdullah mohamed", "link": "https://stackoverflow.com/users/7336228/abdullah-mohamed"}, "edited": false, "score": 0, "creation_date": 1552816896, "post_id": 55205840, "comment_id": 97147937, "body": "actually i did that but still same problem nothing uses git so he process continued to run it&#39;s another problem i thing ,and as a mention i deleted the Users/fly/go/pkg/mod/cache/vcs/cb1953cbdfd14fc2ffce4dfd06487&zwnj;&#8203;e8d5a0c96da00d00bdef&zwnj;&#8203;65874ff644eaa26/shal&zwnj;&#8203;low.lock&#39;  but still same problem"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 13, "user_id": 7336228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fxdIXBMYloc/AAAAAAAAAAI/AAAAAAAAEy0/yrkBzd0E_gE/photo.jpg?sz=128", "display_name": "abdullah mohamed", "link": "https://stackoverflow.com/users/7336228/abdullah-mohamed"}, "edited": false, "score": 0, "creation_date": 1552817233, "post_id": 55205840, "comment_id": 97148016, "body": "When you use modules you normaly should just run <code>go build</code>. If you want to update a package you should just change the version inside your import path."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 2, "last_activity_date": 1552816558, "creation_date": 1552816558, "answer_id": 55205840, "question_id": 55205554, "link": "https://stackoverflow.com/questions/55205554/cant-update-packages-go-error-loading-module-requirements/55205840#55205840", "title": "Can&#39;t update Packages (go: error loading module requirements)", "body": "<p>The error message is pretty clear here:</p>\n\n<blockquote>\n  <p>Another git process seems to be running in this repository, e.g.    an\n  editor opened by 'git commit'. Please make sure all processes     are\n  terminated then try again. </p>\n</blockquote>\n\n<p>When you run <code>go get</code> the <code>git</code> command is used to load everything. So there is another process using git.</p>\n\n<p>Just end the other git command and it will work. </p>\n"}], "owner": {"reputation": 13, "user_id": 7336228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fxdIXBMYloc/AAAAAAAAAAI/AAAAAAAAEy0/yrkBzd0E_gE/photo.jpg?sz=128", "display_name": "abdullah mohamed", "link": "https://stackoverflow.com/users/7336228/abdullah-mohamed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5103, "favorite_count": 0, "accepted_answer_id": 55205840, "answer_count": 1, "score": 0, "last_activity_date": 1552817886, "creation_date": 1552814339, "last_edit_date": 1552817886, "question_id": 55205554, "link": "https://stackoverflow.com/questions/55205554/cant-update-packages-go-error-loading-module-requirements", "title": "Can&#39;t update Packages (go: error loading module requirements)", "body": "<p>I want to update my package but when i run -v command to get latest updates the command line hit an err</p>\n\n<pre><code>go get -v ./...\n</code></pre>\n\n<p>what happens?</p>\n\n<pre><code>&gt; go: finding github.com/aws/aws-sdk-go v1.17.11 go: finding\n&gt; github.com/aws/aws-sdk-go v1.17.7 go: finding\n&gt; github.com/aws/aws-sdk-go v1.16.32 go:\n&gt; github.com/aws/aws-sdk-go@v1.17.7: git -c protocol.version=0 fetch\n&gt; --unshallow -f https://github.com/aws/aws-sdk-go refs/heads/*:refs/heads/* refs/tags/*:refs/tags/* in\n&gt; /Users/fly/go/pkg/mod/cache/vcs/cb1953cbdfd14fc2ffce4dfd06487e8d5a0c96da00d00bdef65874ff644eaa26:\n&gt; exit status 128:  warning: redirecting to\n&gt; https://github.com/aws/aws-sdk-go/    fatal: Unable to create\n&gt; '/Users/fly/go/pkg/mod/cache/vcs/cb1953cbdfd14fc2ffce4dfd06487e8d5a0c96da00d00bdef65874ff644eaa26/shallow.lock':\n&gt; File exists.\n&gt; \n&gt;   Another git process seems to be running in this repository, e.g.    an\n&gt; editor opened by 'git commit'. Please make sure all processes     are\n&gt; terminated then try again. If it still fails, a git process   may have\n&gt; crashed in this repository earlier:   remove the file manually to\n&gt; continue. go: github.com/aws/aws-sdk-go@v1.16.32: unknown revision\n&gt; v1.16.32 go: github.com/aws/aws-sdk-go@v1.17.11: unknown revision\n&gt; v1.17.11 go: error loading module requirements\n</code></pre>\n"}, {"tags": ["function", "go", "methods", "overriding"], "comments": [{"owner": {"reputation": 389, "user_id": 6321432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CpTh0.jpg?s=128&g=1", "display_name": "HolaYang", "link": "https://stackoverflow.com/users/6321432/holayang"}, "edited": false, "score": 0, "creation_date": 1552806541, "post_id": 55204013, "comment_id": 97145745, "body": "Override is an action in compiling phase, so you cloud find it out in your code. Why you should determine it at runtime?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1552844955, "last_edit_date": 1552844955, "creation_date": 1552814321, "answer_id": 55205550, "question_id": 55204013, "link": "https://stackoverflow.com/questions/55204013/how-to-tell-if-an-types-base-function-has-been-overridden-in-go-without-callin/55205550#55205550", "title": "How to tell if an type&#39;s base function has been overridden in Go, without calling the function?", "body": "<p>As noted by others, which method to call is a compile-time decision. So you can check this at compile time, most IDE's will navigate you to the method that is bound to the actual call.</p>\n\n<p>If you want to check this at runtime, you may compare the function pointers. You can't compare function values, they are not comparable (only to the <code>nil</code> value). <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators</a>:</p>\n\n<blockquote>\n  <p>Slice, map, and function values are not comparable. However, as a special case, a slice, map, or function value may be compared to the predeclared identifier <code>nil</code>.</p>\n</blockquote>\n\n<p>This is how you can do that:</p>\n\n<pre><code>myEndpointInstance := myEndpoint{URI: \"/myEndpoint\"}\n\nv1 := reflect.ValueOf(myEndpointInstance.Post).Pointer()\nv2 := reflect.ValueOf(myEndpointInstance.BaseRoute.Post).Pointer()\nfmt.Println(v1, v2, v1 == v2)\n\nv1 = reflect.ValueOf(myEndpointInstance.Get).Pointer()\nv2 = reflect.ValueOf(myEndpointInstance.BaseRoute.Get).Pointer()\nfmt.Println(v1, v2, v1 == v2)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/TfDP_eoMdVc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>882848 882848 true\n882880 882912 false\n</code></pre>\n\n<p>Output tells <code>Post()</code> is not \"overridden\" (<code>myEndpointInstance.Post</code> is the same as <code>myEndpointInstance.BaseRoute.Post</code>), while <code>Get()</code> is (<code>myEndpointInstance.Get</code> is not the same as <code>myEndpointInstance.BaseRoute.Get</code>).</p>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/34901307/how-to-compare-2-functions-in-go/34901677#34901677\">How to compare 2 functions in Go?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/42140758/collection-of-unique-functions-in-go/42147285#42147285\">Collection of Unique Functions in Go</a></p>\n"}], "owner": {"reputation": 75, "user_id": 1119632, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/70708ef60d66371010bc965b0c1bc6ec?s=128&d=identicon&r=PG", "display_name": "WorkForPizza", "link": "https://stackoverflow.com/users/1119632/workforpizza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 55205550, "answer_count": 1, "score": 4, "last_activity_date": 1552844955, "creation_date": 1552799078, "last_edit_date": 1552814378, "question_id": 55204013, "link": "https://stackoverflow.com/questions/55204013/how-to-tell-if-an-types-base-function-has-been-overridden-in-go-without-callin", "title": "How to tell if an type&#39;s base function has been overridden in Go, without calling the function?", "body": "<p>I'm implementing a simple router in Go. I used to have a lot of redundant code for each endpoint returning an error when the method called wasn't implemented for that endpoint. I refactored and made a \"base\" type which provides default functions for each request type that simply return the unimplemented error. Now all I have to do is override the specific method functions for a given endpoint I wish to implement. This was all fun and games until I wanted to figure out, given an endpoint variable, which of the methods have been overridden? </p>\n\n<p>Omitting extraneous details, here's as simple of an example as I can think of right now:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n// Route defines the HTTP method handlers.\ntype Route interface {\n    Get() string\n    Post() string\n}\n\n// BaseRoute is the \"fallback\" handlers,\n// if those handlers aren't defined later.\ntype BaseRoute struct{}\n\nfunc (BaseRoute) Get() string {\n    return \"base get\"\n}\n\nfunc (BaseRoute) Post() string {\n    return \"base post\"\n}\n\n// Endpoint holds a route for handling the HTTP request,\n// and some other metadata related to that request.\ntype Endpoint struct {\n    BaseRoute\n    URI string\n}\n\n// myEndpoint is an example endpoint implementation\n// which only implements a GET request.\ntype myEndpoint Endpoint\n\nfunc (myEndpoint) Get() string {\n    return \"myEndpoint get\"\n}\n\nfunc main() {\n    myEndpointInstance := myEndpoint{URI: \"/myEndpoint\"}\n    fmt.Println(myEndpointInstance.URI)\n    fmt.Println(myEndpointInstance.Get())\n    fmt.Println(myEndpointInstance.Post())\n}\n</code></pre>\n\n<p>This snippet will print out the following:</p>\n\n<pre><code>/myEndpoint\nmyEndpoint get\nbase post\n</code></pre>\n\n<p>So my overriding of the functions works as intended. Now I'm wondering that in my main function, after I declare the myEndpointInstance, can I tell somehow that the Post function has not been overridden and is still implemented by the underlying BaseRoute without actually calling the function? Ideally, I want something like this:</p>\n\n<pre><code>func main() {\n    myEndpointInstance := myEndpoint{URI: \"/myEndpoint\"}\n    if myEndpointInstace.Post != BaseRoute.Post {\n        // do something\n    }\n}\n</code></pre>\n\n<p>I've played around with the reflect package a bit, but haven't found anything helpful.</p>\n"}, {"tags": ["go", "imap"], "answers": [{"tags": [], "owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "is_accepted": true, "score": 2, "last_activity_date": 1552858719, "creation_date": 1552858719, "answer_id": 55212184, "question_id": 55203878, "link": "https://stackoverflow.com/questions/55203878/how-to-find-attachments-and-download-them-with-mxk-go-imap/55212184#55212184", "title": "How to find attachments and download them with mxk/go-imap?", "body": "<p>You should pick a library more up-to-date, the one you choose didn't have any contributions for 4 years. Here an example with <a href=\"https://github.com/emersion/go-imap\" rel=\"nofollow noreferrer\">https://github.com/emersion/go-imap</a> library for png and gif.</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n\n    \"github.com/emersion/go-imap\"\n    \"github.com/emersion/go-imap/client\"\n    \"github.com/emersion/go-message\"\n)\n\nfunc main() {\n    log.Println(\"Connecting to server...\")\n\n    c, err := client.DialTLS(\"xxxxxxxxx\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(\"Connected\")\n\n    defer c.Logout()\n\n    if err := c.Login(\"xxxxxxxxxxxxx\", \"xxxxxxxxxx\"); err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"Logged in\")\n\n    mbox, err := c.Select(\"INBOX\", false)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    seqset := new(imap.SeqSet)\n    seqset.AddRange(1, mbox.Messages)\n\n    messages := make(chan *imap.Message, 10)\n    done := make(chan error, 1)\n    go func() {\n        done &lt;- c.Fetch(seqset, []imap.FetchItem{imap.FetchRFC822}, messages)\n    }()\n\n    for msg := range messages {\n        for _, r := range msg.Body {\n            entity, err := message.Read(r)\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            multiPartReader := entity.MultipartReader()\n\n            for e, err := multiPartReader.NextPart(); err != io.EOF; e, err = multiPartReader.NextPart() {\n                kind, params, cErr := e.Header.ContentType()\n                if cErr != nil {\n                    log.Fatal(cErr)\n                }\n\n                if kind != \"image/png\" &amp;&amp; kind != \"image/gif\" {\n                    continue\n                }\n\n                c, rErr := ioutil.ReadAll(e.Body)\n                if rErr != nil {\n                    log.Fatal(rErr)\n                }\n\n                log.Printf(\"Dump file %s\", params[\"name\"])\n\n                if fErr := ioutil.WriteFile(\"/tmp/\"+params[\"name\"], c, 0777); ferr != nil {\n                    log.Fatal(fErr)\n                }\n            }\n        }\n    }\n\n    if err := &lt;-done; err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(\"Done\")\n}\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 970, "favorite_count": 0, "accepted_answer_id": 55212184, "answer_count": 1, "score": 3, "last_activity_date": 1552858719, "creation_date": 1552797304, "question_id": 55203878, "link": "https://stackoverflow.com/questions/55203878/how-to-find-attachments-and-download-them-with-mxk-go-imap", "title": "How to find attachments and download them with mxk/go-imap?", "body": "<p>Been trying to figure this one out for a couple of days. I'm trying to download the image attachment of all emails in a mailbox.</p>\n\n<p>Investigating here and there found this <a href=\"https://github.com/mxk/go-imap/issues/17\" rel=\"nofollow noreferrer\">mxk/go-imap/issues/17 BODYSTRUCTURE</a> where the author of the library gives some hints, but honestly I cannot wrap my mind around the RFC 3501 neither how I am supposed to use the <code>As*</code> functions of his library, as I see it, navigation wouldn't be any different from iterating the fields as if they were arrays and doing some recursion when embedded \"arrays\" are found.</p>\n\n<p>I've been able to put this code together that connects to a IMAP server using TLS and fetch all the emails printing the fields of each, excuse the Spanish embedded in the code.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"log\"\n    \"time\"\n\n    \"github.com/mxk/go-imap/imap\"\n)\n\nfunc main() {\n    client, err := imap.DialTLS(\"imapserver.com:993\", &amp;tls.Config{\n        ServerName:         \"imapserver.com\",\n        InsecureSkipVerify: false,\n    })\n\n    if client.State() == imap.Login {\n        _, err = client.Login(\"myemail@imapserver.com\", \"mypassword:)\")\n        if err != nil {\n            log.Fatalf(\"no se pudo iniciar sesion: %s\", err)\n        }\n    }\n    defer client.Logout(30 * time.Second)\n    log.Printf(\"Conectado\")\n    // lista correo en la bandeja de entrada\n    client.Select(\"INBOX\", true)\n    log.Printf(\"Seleccionado: %s\", client.Mailbox)\n    set, _ := imap.NewSeqSet(\"\")\n    set.Add(\"1:*\")\n\n    cmd, err := client.Fetch(set, \"FLAGS\", \"INTERNALDATE\", \"RFC822.SIZE\", \"ENVELOPE\", \"BODYSTRUCTURE\")\n    if err != nil {\n        log.Fatalf(\"no se pudo hacer FETCH: %s\", err)\n    }\n    log.Println(\"Mensajes mas recientes:\")\n    for cmd.InProgress() {\n        // espera por la siguiente respuesta\n        client.Recv(-1)\n\n        for _, respuesta := range cmd.Data {\n            message := respuesta.MessageInfo()\n            log.Printf(\"= %d\\n\", message.Seq)\n            for _, k := range imap.AsList(message.Attrs[\"BODYSTRUCTURE\"]) {\n                log.Printf(\"== %#v\\n\", k)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>this beauty will print the following:</p>\n\n<pre><code>2019/03/16 22:30:45 Conectado\n2019/03/16 22:30:45 Seleccionado: --- \"INBOX\" ---\nReadOnly:     true\nFlags:        (\\Answered \\Deleted \\Draft \\Flagged \\Seen)\nPermFlags:    ()\nMessages:     2\nRecent:       0\nUnseen:       1\nUIDNext:      85\nUIDValidity:  1542111171\nUIDNotSticky: false\n2019/03/16 22:30:45 Mensajes mas recientes:\n2019/03/16 22:30:45 = 1\n2019/03/16 22:30:45 == \"\\\"text\\\"\"\n2019/03/16 22:30:45 == \"\\\"plain\\\"\"\n2019/03/16 22:30:45 == []imap.Field{\"\\\"charset\\\"\", \"\\\"utf-8\\\"\"}\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == \"\\\"base64\\\"\"\n2019/03/16 22:30:45 == 0x6a\n2019/03/16 22:30:45 == 0x3\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 = 1\n2019/03/16 22:30:45 == \"\\\"text\\\"\"\n2019/03/16 22:30:45 == \"\\\"plain\\\"\"\n2019/03/16 22:30:45 == []imap.Field{\"\\\"charset\\\"\", \"\\\"utf-8\\\"\"}\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == \"\\\"base64\\\"\"\n2019/03/16 22:30:45 == 0x6a\n2019/03/16 22:30:45 == 0x3\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 = 2\n2019/03/16 22:30:45 == []imap.Field{\"\\\"text\\\"\", \"\\\"plain\\\"\", []imap.Field{\"\\\"charset\\\"\", \"\\\"utf-8\\\"\"}, imap.Field(nil), imap.Field(nil), \"\\\"base64\\\"\", 0x66, 0x1, imap.Field(nil), imap.Field(nil), imap.Field(nil), imap.Field(nil)}\n2019/03/16 22:30:45 == []imap.Field{\"\\\"image\\\"\", \"\\\"jpeg\\\"\", []imap.Field{\"\\\"name\\\"\", \"\\\"Screenshot_20190315-090210.jpg\\\"\"}, imap.Field(nil), imap.Field(nil), \"\\\"base64\\\"\", 0xfd0b2, imap.Field(nil), []imap.Field{\"\\\"attachment\\\"\", []imap.Field{\"\\\"filename\\\"\", \"\\\"Screenshot_20190315-090210.jpg\\\"\", \"\\\"size\\\"\", \"\\\"757415\\\"\"}}, imap.Field(nil), imap.Field(nil)}\n2019/03/16 22:30:45 == \"\\\"mixed\\\"\"\n2019/03/16 22:30:45 == []imap.Field{\"\\\"boundary\\\"\", \"\\\"--_com.android.email_70037410718460\\\"\"}\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 = 1\n2019/03/16 22:30:45 == \"\\\"text\\\"\"\n2019/03/16 22:30:45 == \"\\\"plain\\\"\"\n2019/03/16 22:30:45 == []imap.Field{\"\\\"charset\\\"\", \"\\\"utf-8\\\"\"}\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == \"\\\"base64\\\"\"\n2019/03/16 22:30:45 == 0x6a\n2019/03/16 22:30:45 == 0x3\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 = 2\n2019/03/16 22:30:45 == []imap.Field{\"\\\"text\\\"\", \"\\\"plain\\\"\", []imap.Field{\"\\\"charset\\\"\", \"\\\"utf-8\\\"\"}, imap.Field(nil), imap.Field(nil), \"\\\"base64\\\"\", 0x66, 0x1, imap.Field(nil), imap.Field(nil), imap.Field(nil), imap.Field(nil)}\n2019/03/16 22:30:45 == []imap.Field{\"\\\"image\\\"\", \"\\\"jpeg\\\"\", []imap.Field{\"\\\"name\\\"\", \"\\\"Screenshot_20190315-090210.jpg\\\"\"}, imap.Field(nil), imap.Field(nil), \"\\\"base64\\\"\", 0xfd0b2, imap.Field(nil), []imap.Field{\"\\\"attachment\\\"\", []imap.Field{\"\\\"filename\\\"\", \"\\\"Screenshot_20190315-090210.jpg\\\"\", \"\\\"size\\\"\", \"\\\"757415\\\"\"}}, imap.Field(nil), imap.Field(nil)}\n2019/03/16 22:30:45 == \"\\\"mixed\\\"\"\n2019/03/16 22:30:45 == []imap.Field{\"\\\"boundary\\\"\", \"\\\"--_com.android.email_70037410718460\\\"\"}\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n2019/03/16 22:30:45 == &lt;nil&gt;\n</code></pre>\n"}, {"tags": ["go", "ubuntu-18.04"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 1, "creation_date": 1552792870, "post_id": 55203458, "comment_id": 97143994, "body": "The context package is just <code>&quot;context&quot;</code>"}, {"owner": {"reputation": 31, "user_id": 11214895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6575ca42a7ddad3ca53bd17b682d91?s=128&d=identicon&r=PG&f=1", "display_name": "Yoe", "link": "https://stackoverflow.com/users/11214895/yoe"}, "edited": false, "score": 0, "creation_date": 1552793157, "post_id": 55203458, "comment_id": 97144032, "body": "when I do pip install context I&#39;m getting this: <code>Could not find a version that satisfies the requirement context.viewer (from context) (from versions: ) No matching distribution found for context.viewer (from context)</code>"}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 1, "creation_date": 1552793173, "post_id": 55203458, "comment_id": 97144037, "body": "And, as is mentioned above, you need <code>$GOPATH</code> defined. Commonly, in your working directory <code>mkdir -p go&#47;src&#47;&lt;your-sources&gt;; export GOPATH=$PWD&#47;go; go get .&#47;...</code>. Once you&#39;ve defined imports in your code, you need to pull the imports packages from github and <code>$GOPATH</code> (unless you&#39;re using modules) is required."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 2, "creation_date": 1552793383, "post_id": 55203458, "comment_id": 97144061, "body": "<code>pip</code> is for Python but the code you&#39;ve included is Go(lang) and it uses a different set of tools."}, {"owner": {"reputation": 9968, "user_id": 114900, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZGjf9.jpg?s=128&g=1", "display_name": "msanford", "link": "https://stackoverflow.com/users/114900/msanford"}, "edited": false, "score": 0, "creation_date": 1552796113, "post_id": 55203458, "comment_id": 97144353, "body": "You also claim to be using go 1.7, but your error message reads <code>&#47;usr&#47;lib&#47;go-1.10&#47;</code>? There&#39;s a lot of confusion in this question."}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "edited": false, "score": 0, "creation_date": 1552809417, "post_id": 55203458, "comment_id": 97146308, "body": "Have you ever done &quot;go get -u golang.org/x/net/context&quot;"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1552815745, "post_id": 55203458, "comment_id": 97147663, "body": "If you want to use your programm in production you should NEVER use an not supported version. After Version 1.7 there are many security fixes. So if even if you would able to compile you would have security issues."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 3, "last_activity_date": 1552816374, "last_edit_date": 1552816374, "creation_date": 1552816060, "answer_id": 55205768, "question_id": 55203458, "link": "https://stackoverflow.com/questions/55203458/cannot-find-package-golang-org-x-net-context-in-any-of/55205768#55205768", "title": "Cannot find package &quot;golang.org/x/net/context&quot; in any of:", "body": "<p>First your Go version is outdated. It is not a good idea to use an old version, because there were a lot of security fixes until the 1.7 release.</p>\n\n<p>Your go code is also outdated, because the context package moved from the experimental part (the x inside the path) into the standard library. So the import path for the context pacakge changed. To fix that you should run <code>go fix</code> on your project. </p>\n\n<p>More information you can find at: <a href=\"https://golang.org/cmd/fix/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/fix/</a></p>\n\n<p>There are also some other packages missing. Just read the errors and they tell you. For all missing packages you should run <code>go get</code>.</p>\n\n<p>So you have following things to do:</p>\n\n<ul>\n<li>update your Go installation</li>\n<li>run <code>go fix</code></li>\n<li>install the missing packages with running <code>go get</code></li>\n</ul>\n"}], "owner": {"reputation": 31, "user_id": 11214895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6575ca42a7ddad3ca53bd17b682d91?s=128&d=identicon&r=PG&f=1", "display_name": "Yoe", "link": "https://stackoverflow.com/users/11214895/yoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3566, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1552816374, "creation_date": 1552791545, "last_edit_date": 1552792963, "question_id": 55203458, "link": "https://stackoverflow.com/questions/55203458/cannot-find-package-golang-org-x-net-context-in-any-of", "title": "Cannot find package &quot;golang.org/x/net/context&quot; in any of:", "body": "<p>So I'm trying to run my code and I'm receiving the below errors. So then I open another terminal and try installing the dependencies and it's saying it is unable to locate the package on all of them I've searched and searched for answers for like 2 hours now and tried everything I can with no luck at all.\nI am using Golang version 1.7 and I'm running it on Ubuntu 18.04.</p>\n\n<p>GOPATH = /home/baller/go</p>\n\n<p>Heres the imports: </p>\n\n<pre><code>import ( \n    \"bufio\" \n    \"encoding/json\" \n    \"errors\" \n    \"flag\" \n    \"fmt\" \n    \"log\" \n    \"io/ioutil\" \n    \"net\" \n    \"net/http\" \n    \"os\" \n    \"os/exec\" \n    \"path/filepath\" \n    \"runtime\" \n    \"strconv\" \n    \"strings\" \n    \"golang.org/x/net/context\" \n    \"golang.org/x/oauth2\" \n    \"google.golang.org/api/youtube/v3\"\n)\n</code></pre>\n\n<p>Errors:</p>\n\n<pre><code>like_video.go:22:9: cannot find package \"golang.org/x/net/context\" in any of:\n    /usr/lib/go-1.10/src/golang.org/x/net/context (from $GOROOT)\n    /home/baller/go/src/golang.org/x/net/context (from $GOPATH)\nlike_video.go:23:9: cannot find package \"golang.org/x/oauth2\" in any of:\n    /usr/lib/go-1.10/src/golang.org/x/oauth2 (from $GOROOT)\n    /home/baller/go/src/golang.org/x/oauth2 (from $GOPATH)\nlike_video.go:24:9: cannot find package \"google.golang.org/api/youtube/v3\" in any of:\n    /usr/lib/go-1.10/src/google.golang.org/api/youtube/v3 (from $GOROOT)\n    /home/baller/go/src/google.golang.org/api/youtube/v3 (from $GOPATH)\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1552788783, "post_id": 55203251, "comment_id": 97143462, "body": "<a href=\"https://medium.com/@deckarep/gos-extended-concurrency-semaphores-part-1-5eeabfa351ce\" rel=\"nofollow noreferrer\">medium.com/@deckarep/&hellip;</a>"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 2, "creation_date": 1552828011, "post_id": 55203251, "comment_id": 97150714, "body": "There is a standard technique for implementing this, named &quot;worker pool&quot; which helps with limiting/controlling number of workers. This technique is used in different programming languages including Go, Elixir and Erlang. I wrote one such worker pool here: <a href=\"https://github.com/dc0d/workerpool\" rel=\"nofollow noreferrer\">github.com/dc0d/workerpool</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 11, "last_activity_date": 1552789821, "last_edit_date": 1552789821, "creation_date": 1552789497, "answer_id": 55203322, "question_id": 55203251, "link": "https://stackoverflow.com/questions/55203251/limiting-number-of-go-routines-running/55203322#55203322", "title": "Limiting number of go routines running", "body": "<p>Create the desired number of workers instead of one worker per url:</p>\n\n<pre><code>parallel := flag.Int(\"parallel\", 10, \"max parallel requests allowed\")\nflag.Parse()\n\n// Workers get URLs from this channel\nurls := make(chan string) \n\n// Feed the workers with URLs\ngo func() {\n    for _, u := range flag.Args() {\n        urls &lt;- u\n    }\n    // Workers will exit from range loop when channel is closed\n    close(urls)\n}()\n\nvar wg sync.WaitGroup\nclient := rest.Client{}\n\nresults := make(chan string)\n\n// Start the specified number of workers.\nfor i := 0; i &lt; *parallel; i++ {\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for url := range urls {\n            worker(url, client, results)\n        }\n    }()\n}\n\n// When workers are done, close results so that main will exit.\ngo func() {\n    wg.Wait()\n    close(results)\n}()\n\nfor res := range results {\n    fmt.Println(res)\n}\n</code></pre>\n"}], "owner": {"reputation": 217, "user_id": 3531263, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9f88a5e80ece29301278dc328446cfd9?s=128&d=identicon&r=PG&f=1", "display_name": "Roosh", "link": "https://stackoverflow.com/users/3531263/roosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3008, "favorite_count": 1, "accepted_answer_id": 55203322, "answer_count": 1, "score": 7, "last_activity_date": 1552790471, "creation_date": 1552788486, "last_edit_date": 1552790471, "question_id": 55203251, "link": "https://stackoverflow.com/questions/55203251/limiting-number-of-go-routines-running", "title": "Limiting number of go routines running", "body": "<p>I have a list of urls to process, but I want to run a maximum number of goroutines at a time. For example, if I have 30 urls, I only want 10 goroutines working in parallel.</p>\n\n<p>My attempt at this is the following:</p>\n\n<pre><code>parallel := flag.Int(\"parallel\", 10, \"max parallel requests allowed\")\nflag.Parse()\nurls := flag.Args()\n\nvar wg sync.WaitGroup\nclient := rest.Client{}\n\nresults := make(chan string, *parallel)\n\nfor _, url := range urls {\n    wg.Add(1)\n    go worker(url, client, results, &amp;wg)\n}\n\nfor res := range results {\n    fmt.Println(res)\n}\n\nwg.Wait()\nclose(results)\n</code></pre>\n\n<p>My understanding is that if I create a buffered channel of size parallel, then the code will block until I read off the results channel, which will unblock my code and allow another goroutine to be spawned.\nHowever, this code doesn't seems to block after processing all the urls. Can someone explain to me how I can use channels to limit the number of goroutines running?</p>\n"}, {"tags": ["mysql", "rest", "go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 5, "last_activity_date": 1552826294, "creation_date": 1552826294, "answer_id": 55207128, "question_id": 55203149, "link": "https://stackoverflow.com/questions/55203149/convert-sql-rows-to-json-format-in-go/55207128#55207128", "title": "Convert SQL rows to JSON format in Go", "body": "<p>An instance of the <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"noreferrer\"><code>*sql.Rows</code></a> type is not something that can be marshaled into json <em>directly</em>. It does not implement the <code>json.Marshaler</code> interface and all of its fields are unexported and therefore inaccessible to the <code>encoding/json</code> package.</p>\n\n<p>What you need to do is to <em>scan</em> the contents of the rows into an intermediary object, one that can be marshaled, and then marshal that object into json.</p>\n\n<p>So first, start by declaring a type that will represent this \"intermediary\" object, for example:</p>\n\n<pre><code>type Course struct {\n    Name  string\n    Price int\n}\n</code></pre>\n\n<p>Then, since you're selecting multiple records, you'll need to iterate over the rows object using its <code>Next</code> method and on each iteration scan the contents of the record into an instance of the <code>Course</code> type.</p>\n\n<pre><code>var courses []*Course // declare a slice of courses that will hold all of the Course instances scanned from the rows object\nfor rows.Next() { // this stops when there are no more rows\n    c := new(Course) // initialize a new instance\n    err := rows.Scan(&amp;c.Name, &amp;c.Price) // scan contents of the current row into the instance\n    if err != nil {\n        return err\n    }\n\n    courses = append(courses, c) // add each instance to the slice\n}\nif err := rows.Err(); err != nil { // make sure that there was no issue during the process\n    return err\n}\n</code></pre>\n\n<p>And finally you can turn the <code>courses</code> slice into json by passing it to the encoder.</p>\n\n<pre><code>if err := json.NewEncoder(w).Encode(courses); err != nil {\n    log.Println(err)\n}\n</code></pre>\n\n<hr>\n\n<p>If you apply the above suggestions to your handler you should start seeing the result that you expect, or something similar to it... However your handler has a couple other issues that you need to resolve if you don't want your application to crash.</p>\n\n<p>First:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"root:@/academy\")\n</code></pre>\n\n<p>It is unnecessary to open a connection every time the handler is executed and so it would be much better if you move the open-db-connection code outside of the handler and just make the <code>db</code> variable accessible to the handler. If, however, you want to keep openning the connection every time you need to make sure to also close it every time, otherwise you'll run out of available connections.</p>\n\n<p>Second:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT course_name,price FROM course;\")\n</code></pre>\n\n<p>The returned <code>rows</code> object needs to be closed for the same reasons that you need to close the <code>db</code> handle if you keep opening it every time, i.e. you'll run out of available connections and your app will crash.</p>\n\n<p>So a more complete version of the code that should work correctly would look like this:</p>\n\n<pre><code>var db *sql.DB // declare a global variable that will be used by all handlers\n\nfunc init() {\n    var err error\n    db, err = sql.Open(\"mysql\", \"root:@/academy\") // initialize the global connection\n    if err != nil {\n        panic(err)\n    }\n}\n\ntype Course struct {\n    Name  string\n    Price int\n}\n\nfunc GetCoursesEndpoint(w http.ResponseWriter, req *http.Request) {\n    rows, err := db.Query(\"SELECT course_name,price FROM course;\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer rows.Close() // make sure rows is closed when the handler exits\n\n    var courses []*Course\n    for rows.Next() {\n        c := new(Course)\n        err := rows.Scan(&amp;c.Name, &amp;c.Price)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n\n        courses = append(courses, c)\n    }\n    if err := rows.Err(); err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    if err := json.NewEncoder(w).Encode(courses); err != nil {\n        fmt.Println(err)\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 1391, "user_id": 8810941, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zIKlt.jpg?s=128&g=1", "display_name": "Pavindu", "link": "https://stackoverflow.com/users/8810941/pavindu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1649, "favorite_count": 0, "accepted_answer_id": 55207128, "answer_count": 1, "score": 4, "last_activity_date": 1552826294, "creation_date": 1552787048, "question_id": 55203149, "link": "https://stackoverflow.com/questions/55203149/convert-sql-rows-to-json-format-in-go", "title": "Convert SQL rows to JSON format in Go", "body": "<p>In the REST API that I'm developing, there is a <code>/courses</code> endpoint which returns some data queried from a SQL table in JSON format.However, I couldn't find a way to convert queried data (Rows) to JSON.  </p>\n\n<pre><code>func GetCoursesEndpoint(w http.ResponseWriter, req *http.Request) {\n  db, err := sql.Open(\"mysql\", \"root:@/academy\")\n  checkErr(err)\n\n  rows, err := db.Query(\"SELECT course_name,price FROM course;\")\n  checkErr(err)\n\n  //how to convert returned rows to JSON?\n  msg, err := json.Marshal(rows)\n  checkErr(err)\n\n  json.NewEncoder(w).Encode(msg)\n  return  \n}\n</code></pre>\n"}, {"tags": ["postgresql", "google-app-engine", "go", "google-cloud-sql"], "comments": [{"owner": {"reputation": 2990, "user_id": 5980143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fdbff7c428b18463a5fdada110ad31cb?s=128&d=identicon&r=PG&f=1", "display_name": "dina", "link": "https://stackoverflow.com/users/5980143/dina"}, "edited": false, "score": 0, "creation_date": 1552839452, "post_id": 55203147, "comment_id": 97154337, "body": "is this related? <a href=\"https://stackoverflow.com/questions/55201556/failed-to-connect-to-database-setting-up-gcp-app-engine\" title=\"failed to connect to database setting up gcp app engine\">stackoverflow.com/questions/55201556/&hellip;</a>"}, {"owner": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "reply_to_user": {"reputation": 2990, "user_id": 5980143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fdbff7c428b18463a5fdada110ad31cb?s=128&d=identicon&r=PG&f=1", "display_name": "dina", "link": "https://stackoverflow.com/users/5980143/dina"}, "edited": false, "score": 0, "creation_date": 1552940774, "post_id": 55203147, "comment_id": 97193513, "body": "thank you for the response, the error is really related..i have tried to follow through the documentation with the standard environment but still no avail..been stuck in this error for days now.."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 0, "creation_date": 1552940543, "post_id": 55227309, "comment_id": 97193406, "body": "thank you for your response, i have specified in the app.yaml the standard environment already..the code above runs in the cloud shell code editor but i can now access the database locally using proxy.. however, if i copy that code to the editor, same error appears even if i changed the connection strings.."}, {"owner": {"reputation": 2130, "user_id": 9414803, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tpMvGegwVlc/AAAAAAAAAAI/AAAAAAAAAEk/u8IX_UFhnO4/photo.jpg?sz=128", "display_name": "kurtisvg", "link": "https://stackoverflow.com/users/9414803/kurtisvg"}, "reply_to_user": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 0, "creation_date": 1552941984, "post_id": 55227309, "comment_id": 97193997, "body": "The cloud shell is a different environment than running locally. You need to be running the proxy in your cloud shell to have access. It&#39;s worthing noting the cloud shell doesn&#39;t persist beyond the session - once you disconnect (or timeout) the proxy will by stopped and your <code>&#47;cloudsql</code> folder will be removed.   When I mentioned you hadn&#39;t specified Standard or Flex, I meant in your original post."}, {"owner": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 0, "creation_date": 1552964715, "post_id": 55227309, "comment_id": 97200015, "body": "I do agree that cloud shell is different than running locally. I really thought I don&#39;t need to run the proxy in the cloud shell anymore since I have read the docs saying that apps in the same project are already authorized to access cloud sql instances. In case of deploying the app using go and cloud sql postgres, do you have suggestions regarding the connections strings?i have tried a lot of it but none seems to work and it gives me server error. thanks"}, {"owner": {"reputation": 2130, "user_id": 9414803, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tpMvGegwVlc/AAAAAAAAAAI/AAAAAAAAAEk/u8IX_UFhnO4/photo.jpg?sz=128", "display_name": "kurtisvg", "link": "https://stackoverflow.com/users/9414803/kurtisvg"}, "reply_to_user": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 0, "creation_date": 1552998696, "post_id": 55227309, "comment_id": 97215003, "body": "Cloud Shell is provisioned VM in the cloud, which means that it&#39;s a different machine. Even if you start the proxy on your local machine, you&#39;ll have to start it up again in your cloud shell to connect from there.  For connection string your current example is missing dbname. What is included in the sample does work."}, {"owner": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 0, "creation_date": 1553236298, "post_id": 55227309, "comment_id": 97316590, "body": "thank you so much for your inputs..it really helped me a lot..right now, my app is running in flexible environment..what i did is to start again from scratch then follow every step of the tutorial in the website specifically the flexible environment and viola..it works..thank you so much @kurtisvg"}, {"owner": {"reputation": 2130, "user_id": 9414803, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tpMvGegwVlc/AAAAAAAAAAI/AAAAAAAAAEk/u8IX_UFhnO4/photo.jpg?sz=128", "display_name": "kurtisvg", "link": "https://stackoverflow.com/users/9414803/kurtisvg"}, "reply_to_user": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "edited": false, "score": 1, "creation_date": 1553283656, "post_id": 55227309, "comment_id": 97341764, "body": "Don&#39;t forget to upvote or accept answers you found useful, as it helps other users more quickly determine if information is useful or not."}], "tags": [], "owner": {"reputation": 2130, "user_id": 9414803, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tpMvGegwVlc/AAAAAAAAAAI/AAAAAAAAAEk/u8IX_UFhnO4/photo.jpg?sz=128", "display_name": "kurtisvg", "link": "https://stackoverflow.com/users/9414803/kurtisvg"}, "is_accepted": false, "score": 0, "last_activity_date": 1552931421, "creation_date": 1552931421, "answer_id": 55227309, "question_id": 55203147, "link": "https://stackoverflow.com/questions/55203147/google-app-engine-golang-connect-to-cloud-sql-postgres-unix-dial-no-such-file-or/55227309#55227309", "title": "Google App Engine Golang connect to Cloud SQL Postgres unix dial no such file or directory", "body": "<p>It looks like you are connecting with App Engine (but you don't specify Standard or Flexible environments). </p>\n\n<p>If you are on Standard, the unix socket is automatically available at <code>/cloudsql/&lt;INSTANCE_CONNECTION_NAME&gt;</code>. </p>\n\n<p>If you are on Flexible, you need to specify the instance you want to connect to in the app.yaml, which will need create the unix socket at <code>/cloudsql/&lt;INSTANCE_CONNECTION_NAME&gt;</code>. </p>\n\n<p>These unix sockets are only provided <em>in the runtimes themselves</em>. If you are running locally and want to connect, you will need to use the <a href=\"https://cloud.google.com/sql/docs/mysql/sql-proxy\" rel=\"nofollow noreferrer\">Cloud SQL proxy</a> to create the unix socket at <code>/cloudsql/&lt;INSTANCE_CONNECTION_NAME&gt;</code> (or update your connection string to use Public IP and authenticate a different way).</p>\n"}, {"tags": [], "owner": {"reputation": 335, "user_id": 372704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53c6915158bea6c84266d4d14d6c30be?s=128&d=identicon&r=PG", "display_name": "Jorge Omar V&#225;zquez", "link": "https://stackoverflow.com/users/372704/jorge-omar-v%c3%a1zquez"}, "is_accepted": false, "score": 0, "last_activity_date": 1610378932, "last_edit_date": 1610378932, "creation_date": 1610377301, "answer_id": 65669285, "question_id": 55203147, "link": "https://stackoverflow.com/questions/55203147/google-app-engine-golang-connect-to-cloud-sql-postgres-unix-dial-no-such-file-or/65669285#65669285", "title": "Google App Engine Golang connect to Cloud SQL Postgres unix dial no such file or directory", "body": "<p>Anyone that is using this setup.\nI've got a similar layout.</p>\n<ul>\n<li>GCR using Docker.</li>\n<li>Golang version 1.15</li>\n<li>ORM sqlboiler</li>\n<li>golang dbapi</li>\n<li>CloudSQL using postgresql with a public IP that you can only reach using the cloudsql proxy, but the connection between GCR -&gt; CloudSQL was being rejected with\nmodels: unable to insert into user: dial tcp cloudsql-ip:5432: connect: connection timed out</li>\n</ul>\n<h1>First step</h1>\n<p>When you deploy the instance</p>\n<pre><code>gcloud run deploy foo --add-cloudsql-instances the-literal-instance-connection-name --update-env-vars INSTANCE_CONNECTION_NAME=&quot;the-literal-instance-connection-name&quot; --image your-image-name --region $REGION --project your-project-id --service-account=the-service-account-you-run-your-things --platform managed --no-allow-unauthenticated\n</code></pre>\n<p>The service account that is running that container has the IAM role Cloud SQL Client</p>\n<h2>Toml format for sqlboiler</h2>\n<ul>\n<li>host   = &quot;/cloudsql/the-literal-instance-connection-name/&quot;</li>\n</ul>\n<h2>Golang lib/pq + golang db API connection using named unix sock</h2>\n<ul>\n<li>host=/cloudsql/the-literal-instance-connection-name/</li>\n</ul>\n<h3>What is the-literal-instance-connection-name ?</h3>\n<p>Go to your CloudSQL instance and see the column Instance connection name and use that as a value.</p>\n<h3>Sources</h3>\n<ul>\n<li><a href=\"https://cloud.google.com/sql/docs/postgres/tutorial-connect-run#prepare_the_code\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/postgres/tutorial-connect-run#prepare_the_code</a></li>\n</ul>\n<p>The python example in the google cloud documentation</p>\n<pre><code>query_string = dict({&quot;unix_sock&quot;: &quot;/cloudsql/{}/.s.PGSQL.5432&quot;.format(connection_name)})\n</code></pre>\n<p>if you use a similar format in Golang, it won't work, after several trials and errors, I got the proper version working.</p>\n<p>For example, adding .s.PGSQL.5432 in both connections ended up with an error like this</p>\n<pre><code> unable to insert into user: dial unix /cloudsql/the-literal-instance-connection-name/.s.PGSQL.5432/.s.PGSQL.5432: connect: not a directory\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11214767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBjljVcmMpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdflaJXJfsMVbijeRjQ_LGzZjptiA/mo/photo.jpg?sz=128", "display_name": "Elijah Garcia", "link": "https://stackoverflow.com/users/11214767/elijah-garcia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1495, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1610378932, "creation_date": 1552787034, "question_id": 55203147, "link": "https://stackoverflow.com/questions/55203147/google-app-engine-golang-connect-to-cloud-sql-postgres-unix-dial-no-such-file-or", "title": "Google App Engine Golang connect to Cloud SQL Postgres unix dial no such file or directory", "body": "<p>Good day everyone, I am having trouble in connecting my golang application to a cloud sql postgres instance. I have just followed through their tutorial in Google Cloud Platform and sample code but it seems to be not working. I have just two files the app.yaml and main.go just to test the connection:</p>\n\n<p>app.yaml</p>\n\n<pre><code>runtime: go api_version: go1 env: standard\n\nenv_variables:   CLOUDSQL_CONNECTION_NAME: bxustl2019proj:asia-east1:sqlstlbxu   CLOUDSQL_USER: ustldbbxu   CLOUDSQL_PASSWORD: bxuuserstldb   CLOUDSQL_DB: stlbxudbs\n\nbeta_settings:\n      cloud_sql_instances: bxustl2019proj:asia-east1:sqlstlbxu\n\nhandlers:\n\n- url: /(.*\\.(gif|png|jpg))$   static_files: static/\\1   upload: static/.*\\.(gif|png|jpg)\n\n- url: /.*   script: _go_app\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package dptest\n\nimport (\n    _\"bytes\"\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n     _ \"github.com/lib/pq\"\n)\n\nvar db *sql.DB\n\nfunc init() {\n    db = DB()\n\n    http.HandleFunc(\"/\", indexHandler)\n}\n\n// DB gets a connection to the database.\n// This can panic for malformed database connection strings, invalid credentials, or non-existance database instance.\nfunc DB() *sql.DB {\n    /*\n    var (\n        connectionName = mustGetenv(\"CLOUDSQL_CONNECTION_NAME\")\n        user           = mustGetenv(\"CLOUDSQL_USER\")\n        dbname           = mustGetenv(\"CLOUDSQL_DB\")\n        password       = os.Getenv(\"CLOUDSQL_PASSWORD\") // NOTE: password may be empty\n        socket         = os.Getenv(\"CLOUDSQL_SOCKET_PREFIX\")\n    )\n\n    //cloudsql is used on App Engine.\n    if socket == \"\" {\n        socket = \"/cloudsql\"\n    }\n    */\n    // PostgreSQL Connection, uncomment to use.\n    // connection string format: user=USER password=PASSWORD host=/cloudsql/PROJECT_ID:REGION_ID:INSTANCE_ID/[ dbname=DB_NAME]\n    //dbURI := fmt.Sprintf(\"user=%s password=%s host=/cloudsql/%s database=%s\", user, password, connectionName, dbname)\n    dbURI := fmt.Sprintf(\"user=ustldbbxu password=bxuuserstldb host=/cloudsql/bxustl2019proj:asia-east1:sqlstlbxu/stlbxudbs\")\n\n    conn, err := sql.Open(\"postgres\", dbURI)\n    log.Printf(\"CONNECTION: %v\", conn)\n    if err != nil {\n        panic(fmt.Sprintf(\"DB: %v\", err))\n    }\n\n    rows, err := conn.Query(\"SELECT * FROM GAMES\")\n    log.Printf(\"ROW: %v\", rows)\n    if err != nil {\n        log.Printf(\"Could not query db: %v\", err)\n    }\n    defer rows.Close()\n\n    return conn\n}\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n        http.NotFound(w, r)\n        return\n    }\n\n    w.Header().Set(\"Content-Type\", \"text/plain\")\n\n    log.Printf(\"CONNECTION: %v\", db)\n    rows, err := db.Query(\"SELECT * FROM GAMES\")\n    log.Printf(\"ROW: %v\", rows)\n    if err != nil {\n        log.Printf(\"Could not query db: %v\", err)\n        http.Error(w, \"Internal Error\", 500)\n        return\n    }\n    defer rows.Close()\n}\n\nfunc mustGetenv(k string) string {\n    v := os.Getenv(k)\n    if v == \"\" {\n        log.Panicf(\"%s environment variable not set.\", k)\n    }\n    return v\n}\n</code></pre>\n\n<p>I tried using go run . and goapp serve. I have tried adding appengine imports also but none seems to be working and it keeps on giving me the error: </p>\n\n<blockquote>\n  <p>Could not query db: dial unix\n  /cloudsql/bxustl2019proj:asia-east1:sqlstlbxu/stlbxudbs/.s.PGSQL.5432:\n  connect: no such file or directory</p>\n</blockquote>\n\n<p>Cloud SQL Admin is also enabled. I just commented out the env for easier run the error seems to be the same regardless of hardcoding the query path or importing from yaml.</p>\n\n<p>I am hoping someone could help me on this.Thank you.</p>\n"}, {"tags": ["validation", "go"], "owner": {"reputation": 256, "user_id": 4348492, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/05ee3ce16246736e2df2d6e622253f25?s=128&d=identicon&r=PG&f=1", "display_name": "Naresh Kumar", "link": "https://stackoverflow.com/users/4348492/naresh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1463, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1552783718, "creation_date": 1552783718, "question_id": 55202913, "link": "https://stackoverflow.com/questions/55202913/go-lang-errorfield-validation-for-failed-on-the-required-tag", "title": "go lang Error:Field validation for &#39;&#39; failed on the &#39;required&#39; tag", "body": "<p>My request is failing from other service even I am passing required query string parameters.\nHere is validation code:</p>\n\n<pre><code>type ActionByRuleRequest struct {\n    Code  string `json:\"code\" form:\"code\" query:\"code\" validate:\"required,oneof=gde cse scc\"`\n    Name string `json:\"name\" form:\"name\" query:\"name\" validate:\"required\"` // Monitoring rule name\n}\n</code></pre>\n\n<p>Here is validating query string with validation</p>\n\n<pre><code>func GetActionByRule(c echo.Context) error {\n    // Get parameters from the query string\n    req := new(model.ActionByRuleRequest)\n    err := c.Bind(req);\n    if  err != nil {\n        log.Println(err)\n        error := model.Error{\n            Message: err.Error(),\n        }\n        responseError := &amp;model.ResponseError{\n            Status: http.StatusBadRequest,\n            Code:   \"INVALID_INPUT\",\n        }\n        responseError.Errors = append(responseError.Errors, error)\n        return echo.NewHTTPError(http.StatusBadRequest, responseError)\n    }\n    // Validate input\n    log.Printf(\"[/action_by_rule] 00000000000 get req = %#v\\n\", req)\n\n    v := validator.New()\n\n    err = v.Struct(req); \n\n    if err == nil {\n        log.Println(\"Input valid\")\n    } else {\n        log.Println(\"Input validation failed:\", err)\n     }\n}\n</code></pre>\n\n<p>Request URL:'<a href=\"http://127.0.0.1:3015/action?code=csf&amp;name=tbiubi-csf-rule\" rel=\"nofollow noreferrer\">http://127.0.0.1:3015/action?code=csf&amp;name=tbiubi-csf-rule</a>'</p>\n\n<p>Error:</p>\n\n<pre><code> Key: 'ActionByRuleRequest.Code' Error:Field validation for 'Code' failed on the 'required' tag\nKey: 'ActionByRuleRequest.Name' Error:Field validation for 'Name' failed on the 'required' tag\n</code></pre>\n"}, {"tags": ["go", "concurrency", "buffer", "gob"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552779006, "post_id": 55202269, "comment_id": 97142058, "body": "There&#39;s no guarantee that <code>channel.Read(buf)</code> reads an entire gob.  Is there a reason why you are not decoding directly from <code>channel</code>?"}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552779803, "post_id": 55202269, "comment_id": 97142187, "body": "The channel on an SSH connection only works with a byte array, so there is no streaming wrapper for it.  The gob needs an io stream of some kind so that&#39;s essentially what I&#39;m doing with this, creating one.  Your thought is the same as mine, but I&#39;m not sure how to work around it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552783390, "post_id": 55202269, "comment_id": 97142719, "body": "SSH connections directly satisfy the interface required by the gob decoder."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552817777, "post_id": 55202269, "comment_id": 97148152, "body": "Go doesn&#39;t throw errors (or anything else). It returns them. This might sound like pedantry, but it&#39;s a vital difference."}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "edited": false, "score": 0, "creation_date": 1552784117, "post_id": 55202751, "comment_id": 97142829, "body": "Hah, you&#39;re right I totally spaced on that.  Corrected the code and now it works flawlessly, thank you."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1552782161, "last_edit_date": 1552782161, "creation_date": 1552781693, "answer_id": 55202751, "question_id": 55202269, "link": "https://stackoverflow.com/questions/55202269/gob-decoder-throws-eof-error-for-a-time-then-stops/55202751#55202751", "title": "Gob decoder throws EOF error for a time then stops", "body": "<p>The call to <code>channel.Read(buf)</code> can read a partial gob. The decoder will return an error when attempting to decode the partial gob.</p>\n\n<p>Because the <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Channel\" rel=\"nofollow noreferrer\">channel</a> satisfies the <a href=\"https://godoc.org/io#Reader\" rel=\"nofollow noreferrer\">io.Reader</a> interface, the application can create the decoder directly on the channel:</p>\n\n<pre><code>gob.Register(datums.Message{})\ndec := gob.NewDecoder(channel)\nfor {\n  var message datums.Message\n  err := dec.Decode(&amp;message)\n  if err != nil {\n     log.Println(\"Error in decoder\", err)\n     break\n  }\n  log.Println(&amp;message)\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 0, "accepted_answer_id": 55202751, "answer_count": 1, "score": 1, "last_activity_date": 1552782161, "creation_date": 1552776542, "question_id": 55202269, "link": "https://stackoverflow.com/questions/55202269/gob-decoder-throws-eof-error-for-a-time-then-stops", "title": "Gob decoder throws EOF error for a time then stops", "body": "<p>I'm trying to feed []byte over a chan to a gob decoder.  It works, but at first the decoder throws a whole bunch of EOF errors then stops.  When it stops throwing errors the program behaves exactly like I would expect with it decoding gobs and processing the structs it produces correctly.</p>\n\n<p>This is the calling function, the channel that is being read from is an SSH channel.</p>\n\n<pre><code>log.Println(\"Reading channel\")\ndchan := make(chan []byte, 200)\ngo decoder(dchan)\nfor {\n    buf := make([]byte, 1024)\n    //log.Println(\"Waiting for data\")\n    numBytes, err := channel.Read(buf)\n    if err != nil {\n        log.Println(err)\n        continue\n    }\n    dchan &lt;- buf[:numBytes]\n}\n</code></pre>\n\n<p>The decoder function looks like this:</p>\n\n<pre><code>func decoder(dchan chan []byte) error {\n  gob.Register(datums.Message{})\n  var message datums.Message\n  bbuf := bytes.NewBuffer(make([]byte, 512))\n  dec := gob.NewDecoder(bbuf)\n  for data := range dchan {\n    //log.Println(\"Decoding data\")\n    bbuf.Write(data)\n    err := dec.Decode(&amp;message)\n    if err != nil {\n        log.Println(\"Error in decoder\")\n        log.Println(err)\n        continue\n    }\n    //log.Println(&amp;message)\n  }\n  return nil\n}\n</code></pre>\n\n<p>I'm not sure if this is even a real issue, does the gob decoder remove the data from the buffer or does it leave it there until sufficient data shows up to generate a value?</p>\n"}, {"tags": ["arrays", "algorithm", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1552785414, "post_id": 55201821, "comment_id": 97143004, "body": "It&#39;s not a coding but algorithm problem. First make the algorithm on a piece of paper. When you have the algorithm - coding it is a mechanical task. When you have an algorithm and the corresponding implementation - take a debugger."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1552801244, "post_id": 55201881, "comment_id": 97144970, "body": "This is indeed the right reason of why the <b>code</b> is wrong."}], "tags": [], "owner": {"reputation": 74, "user_id": 4891009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80b5dbd50d0e10827f18ee12bc7f33de?s=128&d=identicon&r=PG&f=1", "display_name": "j0j0j0", "link": "https://stackoverflow.com/users/4891009/j0j0j0"}, "is_accepted": false, "score": 0, "last_activity_date": 1552774152, "last_edit_date": 1552774152, "creation_date": 1552773438, "answer_id": 55201881, "question_id": 55201821, "link": "https://stackoverflow.com/questions/55201821/merging-overlapping-intervals-using-double-for-loop/55201881#55201881", "title": "Merging overlapping intervals using double for loop", "body": "<p>the only \"appending\" happens during your following code snippet.</p>\n\n<pre><code>if first.endTime &gt;= second.startTime {\n                mergedMeetings = append(mergedMeetings, Meeting{first.startTime, second.endTime})\n}\n</code></pre>\n\n<p>So looking at {0,1} and the others:</p>\n\n<ul>\n<li>1 &lt; [3,4,10,9]</li>\n<li>Thus there is no overlapping and it is ignored.</li>\n<li>Apart from your question you may try to test a tuple which is fully included within another tuple like {6,7} ;)</li>\n<li>Also you might execute your algorithm again and again on your solution set till it does not differ from the previous run. Maybe an additional {3,4} could provoke this?</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1552786135, "last_edit_date": 1552786135, "creation_date": 1552784086, "answer_id": 55202946, "question_id": 55201821, "link": "https://stackoverflow.com/questions/55201821/merging-overlapping-intervals-using-double-for-loop/55202946#55202946", "title": "Merging overlapping intervals using double for loop", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype Interval struct {\n    Lo, Hi int\n}\n\nfunc merge(ivs []Interval) []Interval {\n    m := append([]Interval(nil), ivs...)\n    if len(m) &lt;= 1 {\n        return m\n    }\n\n    sort.Slice(m,\n        func(i, j int) bool {\n            if m[i].Lo &lt; m[j].Lo {\n                return true\n            }\n            if m[i].Lo == m[j].Lo &amp;&amp; m[i].Hi &lt; m[j].Hi {\n                return true\n            }\n            return false\n        },\n    )\n\n    j := 0\n    for i := 1; i &lt; len(m); i++ {\n        if m[j].Hi &gt;= m[i].Lo {\n            if m[j].Hi &lt; m[i].Hi {\n                m[j].Hi = m[i].Hi\n            }\n        } else {\n            j++\n            m[j] = m[i]\n        }\n\n    }\n    return append([]Interval(nil), m[:j+1]...)\n}\n\nfunc main() {\n    intervals := []Interval{{0, 1}, {3, 5}, {4, 8}, {10, 12}, {9, 10}}\n    merged := merge(intervals)\n    fmt.Println(intervals)\n    fmt.Println(merged)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/13uwiQtlxPJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/13uwiQtlxPJ</a></p>\n\n<p>Output:</p>\n\n<pre><code>[{0 1} {3 5} {4 8} {10 12} {9 10}]\n[{0 1} {3 8} {9 12}]\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 11214345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e4938b334ab9d0776f6bde5f5ab42d1?s=128&d=identicon&r=PG&f=1", "display_name": "Kyates", "link": "https://stackoverflow.com/users/11214345/kyates"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 3, "accepted_answer_id": 55202946, "answer_count": 2, "score": 4, "last_activity_date": 1553006706, "creation_date": 1552772953, "last_edit_date": 1553006706, "question_id": 55201821, "link": "https://stackoverflow.com/questions/55201821/merging-overlapping-intervals-using-double-for-loop", "title": "Merging overlapping intervals using double for loop", "body": "<p>I am trying to merge some overlapping \"meeting\" intervals.</p>\n\n<h3>Given intervals:</h3>\n\n<pre><code>  [{0, 1}, {3, 5}, {4, 8}, {10, 12}, {9, 10}]\n</code></pre>\n\n<h3>Merged intervals:</h3>\n\n<pre><code>  [{0, 1}, {3, 8}, {9, 12}]\n</code></pre>\n\n<p>My first approach is a double for loop. However, my output comes out to be:</p>\n\n<pre><code>  [{3, 8}, {9, 12}]\n</code></pre>\n\n<p>Which is omitting {0, 1} in my final result.</p>\n\n<h3>Code:</h3>\n\n<pre><code>type Meeting struct {\n    startTime int\n    endTime   int\n}\n\nfunc MergeIntervals(meetings []Meeting) []Meeting {\n\n    var mergedMeetings []Meeting\n\n    for i := 0; i &lt; len(meetings); i++ {\n        for j := i + 1; j &lt; len(meetings); j++ {\n            var first Meeting\n            var second Meeting\n\n            // the meeting with the earlier start time is the \"first\" meeting\n            if meetings[i].startTime &lt; meetings[j].startTime {\n                first = meetings[i]\n                second = meetings[j]\n            } else {\n                first = meetings[j]\n                second = meetings[i]\n            }\n\n            if first.endTime &gt;= second.startTime {\n                mergedMeetings = append(mergedMeetings, Meeting{first.startTime, second.endTime})\n            }\n        }\n    }\n\n    return mergedMeetings\n}\n</code></pre>\n"}, {"tags": ["go", "windows-firewall"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 7, "creation_date": 1552773779, "post_id": 55201561, "comment_id": 97140936, "body": "If by any chance the action we&#39;re talking about is starting an HTTP(s) server, then while you develop, use localhost, e.g. instead of <code>&quot;:8080&quot;</code>, use <code>&quot;localhost:8080&quot;</code>. That is not a restricted action."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 12, "last_activity_date": 1552817099, "creation_date": 1552817099, "answer_id": 55205903, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/55205903#55205903", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>If you are calling <code>go run main.go</code> following is happening:</p>\n\n<ul>\n<li>your programm is compiled inside a temporary folder</li>\n<li>the compiled binary is executed</li>\n</ul>\n\n<p>But the temporary folder is just for one execution. So the next time when you run your programm via <code>go run</code> another folder is used.</p>\n\n<p>The windows firewall does give you always the information which path your server has and if you remember the paths after each time you will see that there is always a different path.</p>\n\n<p>The windows firewall is so configuread that it remembers the path of each programm. So when the path is changing you will always need to comfirm that the <em>new</em> path is allowed to run on that port.</p>\n\n<p>To fix this you should compile your server. Just run <code>go build</code> and exeute the binaries then inside you project folder. Then you will just have to accept just one time.</p>\n"}, {"tags": [], "owner": {"reputation": 1509, "user_id": 2093371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hNNb8.jpg?s=128&g=1", "display_name": "hestellezg", "link": "https://stackoverflow.com/users/2093371/hestellezg"}, "is_accepted": false, "score": 0, "last_activity_date": 1581960743, "creation_date": 1581960743, "answer_id": 60267702, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/60267702#60267702", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>I think @apxp's answer is the complete explanation of the situation; some time after ask this question I found a way to run my application with:</p>\n\n<pre><code>go build -o ejecutable.exe ; if($?)  { .\\ejecutable.exe }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1164, "user_id": 1183178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/742ecab7460bae556315cf870be86caa?s=128&d=identicon&r=PG", "display_name": "Emre", "link": "https://stackoverflow.com/users/1183178/emre"}, "is_accepted": false, "score": 0, "last_activity_date": 1607658068, "creation_date": 1607658068, "answer_id": 65245480, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/65245480#65245480", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>Just go to your Windows Firewall notification settings:</p>\n<p><code>Control Panel -&gt; Windows Defender Firewall -&gt; Change notification settings</code></p>\n<p>Uncheck the option for <strong>Notify me when Windows Defender Firewall blocks a new app</strong> to prevent it from showing the popup.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 8885099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pru90.jpg?s=128&g=1", "display_name": "Ismayil Ismayilov", "link": "https://stackoverflow.com/users/8885099/ismayil-ismayilov"}, "is_accepted": false, "score": 3, "last_activity_date": 1608556324, "creation_date": 1608556324, "answer_id": 65393403, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/65393403#65393403", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>Hi I had the same problem:\nTry that:</p>\n<ol>\n<li>Go to <strong>Windows Defender Firewall</strong>, in Left side menu you saw <strong>Inbound Rules</strong> click there, then Right Side menu you will see <strong>New Rule...</strong> click.</li>\n<li><em>Choose Port</em> opened from window -&gt; <strong>Next</strong>\n<em>Select TCP</em>, then <em>define which ports you want</em> I choose 8080 click <strong>Next</strong> again, Choose <em>Allow the connection</em> <strong>Next</strong>, Check All <strong>Next</strong>, <em>Give any Name</em> Goland or anything you want and press <strong>Finish</strong>. Thats it</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 2416688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5c6890dab29f073a3254db25894c0d2?s=128&d=identicon&r=PG", "display_name": "Subramanya Rao", "link": "https://stackoverflow.com/users/2416688/subramanya-rao"}, "is_accepted": false, "score": 1, "last_activity_date": 1608866158, "creation_date": 1608866158, "answer_id": 65444970, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/65444970#65444970", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>based on @<strong>apxp</strong> answer</p>\n<p>in <strong>windows cli</strong> this works for me</p>\n<p><strong>go build main.go &amp;&amp; main.exe</strong></p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 8365229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec1c568a277e50463f6cc257dfc3dfa6?s=128&d=identicon&r=PG", "display_name": "barungerti441", "link": "https://stackoverflow.com/users/8365229/barungerti441"}, "is_accepted": false, "score": 1, "last_activity_date": 1610726788, "creation_date": 1610726788, "answer_id": 65739463, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/65739463#65739463", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>this work for me</p>\n<pre><code>go build main.go &amp;&amp; .\\main.exe\n</code></pre>\n<p>and run using makefile</p>\n"}, {"tags": [], "owner": {"reputation": 436, "user_id": 6727740, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lKIM5ESjTc8/AAAAAAAAAAI/AAAAAAAAABE/8SQ8wvNVzAQ/photo.jpg?sz=128", "display_name": "Tom Mertz", "link": "https://stackoverflow.com/users/6727740/tom-mertz"}, "is_accepted": false, "score": 0, "last_activity_date": 1612515532, "creation_date": 1612515532, "answer_id": 66060322, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/66060322#66060322", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>You can use <a href=\"https://github.com/githubnemo/CompileDaemon\" rel=\"nofollow noreferrer\">CompileDaemon</a> to auto re-build your project on file changes, because it runs a build anyway, you'll only have to accept once. Plus, your project will re-build automatically!</p>\n<p>Install:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>go get https://github.com/githubnemo/CompileDaemon\n</code></pre>\n<p>Example usage:</p>\n<pre class=\"lang-sh prettyprint-override\"><code># Assuming your project looks like and you're in your project working dir\n# hello/\n#   hello.go\n\n# Rebuild on .go file edits and run the hello command after\nCompileDaemon -command=&quot;./hello&quot;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 13482983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128e45982f49bec2c257ca1010ab779e?s=128&d=identicon&r=PG&f=1", "display_name": "the Mage", "link": "https://stackoverflow.com/users/13482983/the-mage"}, "is_accepted": false, "score": 3, "last_activity_date": 1614925109, "last_edit_date": 1614925109, "creation_date": 1614916624, "answer_id": 66486551, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall/66486551#66486551", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>Change</p>\n<pre class=\"lang-golang prettyprint-override\"><code>http.ListenAndServe(&quot;:3000&quot;, r)\n</code></pre>\n<p>to</p>\n<pre class=\"lang-golang prettyprint-override\"><code>http.ListenAndServe(&quot;127.0.0.1:3000&quot;, r)\n</code></pre>\n<p>Note: am using gorilla mux</p>\n"}], "owner": {"reputation": 1509, "user_id": 2093371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hNNb8.jpg?s=128&g=1", "display_name": "hestellezg", "link": "https://stackoverflow.com/users/2093371/hestellezg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4514, "favorite_count": 0, "answer_count": 8, "score": 9, "last_activity_date": 1614925109, "creation_date": 1552770983, "question_id": 55201561, "link": "https://stackoverflow.com/questions/55201561/golang-run-on-windows-without-deal-with-the-firewall", "title": "Golang run on Windows without deal with the Firewall", "body": "<p>I'm working on a Rest API with Go, but everytime I try to run my application with</p>\n\n<pre><code>go run main.go\n</code></pre>\n\n<p>the Windows Firewall tells me that has blocked some features of my app. I would like to know if there's some way to make my executions without have to <em>Accept</em> everytime.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 508, "user_id": 288381, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c78038b7b3611b2bda700ad5e0c35e19?s=128&d=identicon&r=PG", "display_name": "gedO", "link": "https://stackoverflow.com/users/288381/gedo"}, "edited": false, "score": 0, "creation_date": 1552770615, "post_id": 55201392, "comment_id": 97140168, "body": "That really helped, but there is an issue. Fields are in mixed positions. Is it possible to change the order of how fields are placed into memory?   AS 16 bits should be first, but now AS bits are in the back. Situation looks like this:  Community/AS instead AS/Community"}, {"owner": {"reputation": 191, "user_id": 8398189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d37abcdaec57a9964ad1ad12fe9999a?s=128&d=identicon&r=PG", "display_name": "Igor Tulmentyev", "link": "https://stackoverflow.com/users/8398189/igor-tulmentyev"}, "reply_to_user": {"reputation": 508, "user_id": 288381, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c78038b7b3611b2bda700ad5e0c35e19?s=128&d=identicon&r=PG", "display_name": "gedO", "link": "https://stackoverflow.com/users/288381/gedo"}, "edited": false, "score": 0, "creation_date": 1552771269, "post_id": 55201392, "comment_id": 97140332, "body": "@gedO I&#39;ve updated my answer. Please, check it out."}], "tags": [], "owner": {"reputation": 191, "user_id": 8398189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d37abcdaec57a9964ad1ad12fe9999a?s=128&d=identicon&r=PG", "display_name": "Igor Tulmentyev", "link": "https://stackoverflow.com/users/8398189/igor-tulmentyev"}, "is_accepted": true, "score": 2, "last_activity_date": 1552770743, "last_edit_date": 1552770743, "creation_date": 1552769651, "answer_id": 55201392, "question_id": 55201320, "link": "https://stackoverflow.com/questions/55201320/laying-out-structure-to-bytes/55201392#55201392", "title": "Laying out structure to bytes", "body": "<p>You can pass your structure to a uint32 variable using \"unsafe\" package:</p>\n\n<pre><code>func (rc *routeCommunity) bits() uint32 {\n    return *(*uint32)(unsafe.Pointer(rc))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AQeeoYUn7o0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AQeeoYUn7o0</a></p>\n\n<p><strong>UPD:</strong></p>\n\n<p>Keep in mind the bits position depends on an order of the structure fields.\nLow two bytes of the variable contain the first field value and high two bytes contain the second one.</p>\n"}], "owner": {"reputation": 508, "user_id": 288381, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c78038b7b3611b2bda700ad5e0c35e19?s=128&d=identicon&r=PG", "display_name": "gedO", "link": "https://stackoverflow.com/users/288381/gedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 55201392, "answer_count": 1, "score": 1, "last_activity_date": 1552771669, "creation_date": 1552769001, "last_edit_date": 1552771669, "question_id": 55201320, "link": "https://stackoverflow.com/questions/55201320/laying-out-structure-to-bytes", "title": "Laying out structure to bytes", "body": "<p>I can't find a way to layout structure to a byte array programming by GO.\nI'm programming extension for GoBGP service. I want to set community for the route via GoBGP API. <a href=\"https://www.juniper.net/documentation/en_US/junos/topics/concept/policy-bgp-communities-extended-communities-match-conditions-overview.html\" rel=\"nofollow noreferrer\">More about BGP and communities</a>.</p>\n\n<p>My situation:</p>\n\n<p>I'm trying to send the 32bit number. First, 16bits are interpreted as AS number, other 16bits- communities. API has an interface for uint32 to set all this data. I want to have a simple structure like: </p>\n\n<pre><code>type routeCommunity struct {\n   AS        uint16\n   Community uint16\n}\n</code></pre>\n\n<p>I'm struggling to pass this structure data to a uint32 variable. I would like to layout it to a byte array and then I could just make uint32 from it. </p>\n\n<p>In C++ I would have a pointer of structure pointing to a char array and continued to work with that structure and in the end, I would send char array.</p>\n\n<p>How to make it happen in Golang??</p>\n"}, {"tags": ["go", "websocket", "rfc", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1552769673, "last_edit_date": 1552769673, "creation_date": 1552768724, "answer_id": 55201285, "question_id": 55201222, "link": "https://stackoverflow.com/questions/55201222/how-to-specify-the-frequency-of-ws-pings-with-gorilla/55201285#55201285", "title": "How to specify the frequency of WS pings with Gorilla", "body": "<p>Because the application is responsible for sending pings with the Gorilla WebSocket package, the application has complete control over the frequency that pings are sent. </p>\n\n<p>See the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">chat example</a> for an example of how to send pings and use them to detect dead or stuck connections.</p>\n"}], "owner": {"reputation": 1092, "user_id": 5715599, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/10208320270154576/picture?type=large", "display_name": "Aidan Rosswood", "link": "https://stackoverflow.com/users/5715599/aidan-rosswood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552769673, "creation_date": 1552768247, "question_id": 55201222, "link": "https://stackoverflow.com/questions/55201222/how-to-specify-the-frequency-of-ws-pings-with-gorilla", "title": "How to specify the frequency of WS pings with Gorilla", "body": "<p>The <a href=\"https://tools.ietf.org/html/rfc6455#section-5.5.2\" rel=\"nofollow noreferrer\">WebSocket RFC</a> states that there are control frames for pings/pongs. In order to avoid writing application code as a keepalive mechanism, is it possible to specify the frequency of pings using Gorilla WebSockets?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552771712, "post_id": 55200883, "comment_id": 97140446, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37464156/get-coverage-stats-when-tests-are-in-another-package\">Get Coverage stats when tests are in another package</a>"}], "answers": [{"comments": [{"owner": {"reputation": 12091, "user_id": 1391717, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/oSSdx.jpg?s=128&g=1", "display_name": "Matthew Moisen", "link": "https://stackoverflow.com/users/1391717/matthew-moisen"}, "edited": false, "score": 0, "creation_date": 1552801443, "post_id": 55201460, "comment_id": 97144994, "body": "When I ran this, it said my <code>bar.go</code> file had 0% coverage in the command line. However when I opened the HTML, the bar.go&#39;s coverage was greater than 0%."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 12091, "user_id": 1391717, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/oSSdx.jpg?s=128&g=1", "display_name": "Matthew Moisen", "link": "https://stackoverflow.com/users/1391717/matthew-moisen"}, "edited": false, "score": 0, "creation_date": 1552805111, "post_id": 55201460, "comment_id": 97145511, "body": "Yeah, it does that! What the command line prints is when running the API test what is the coverage for all packages then when running the db test (ie no tests) what is the coverage for all packages. The html file then contains total coverage from all tests run"}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 2, "last_activity_date": 1552770158, "creation_date": 1552770158, "answer_id": 55201460, "question_id": 55200883, "link": "https://stackoverflow.com/questions/55200883/go-coverage-not-including-functions-in-other-package/55201460#55201460", "title": "Go Coverage not including functions in other package", "body": "<p>You need to include the <code>coverpkg</code> flag so:</p>\n\n<pre><code> go test -coverpkg=./... coverprofile=coverage.out ./...\n</code></pre>\n\n<p>Would calculate the coverage on all of your packages.</p>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Testing_flags</a></p>\n"}], "owner": {"reputation": 12091, "user_id": 1391717, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/oSSdx.jpg?s=128&g=1", "display_name": "Matthew Moisen", "link": "https://stackoverflow.com/users/1391717/matthew-moisen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 0, "accepted_answer_id": 55201460, "answer_count": 1, "score": 5, "last_activity_date": 1552770158, "creation_date": 1552766049, "question_id": 55200883, "link": "https://stackoverflow.com/questions/55200883/go-coverage-not-including-functions-in-other-package", "title": "Go Coverage not including functions in other package", "body": "<p>I have a project like this:</p>\n\n<pre><code>app/\n    api/\n        foo.go\n        test_foo.go\nsrc/\n    db/\n        bar.go\n</code></pre>\n\n<p>In <code>foo.go</code>, a call is made to a function in <code>bar.go</code>. However, when running the coverage report, it shows that 0 lines of bar.go are covered.</p>\n\n<p>Is there a way to get coverage to include function call to other packages?</p>\n\n<p>In my case, I do not want to make separate tests for <code>db</code> and for <code>api</code>, since all calls through <code>db</code> will always go through <code>api</code>, and it would be redundant to write two tests.</p>\n\n<p>I'm running the coverage like this:</p>\n\n<pre><code>go clean -testcache\ngo test -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-multi-stage-build"], "comments": [{"owner": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1552763451, "post_id": 55200508, "comment_id": 97138248, "body": "what is your host os ?"}, {"owner": {"reputation": 712, "user_id": 7563603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058710b9f6688ac6ee9a2f7c18dfdc6c?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas Sarade", "link": "https://stackoverflow.com/users/7563603/tejas-sarade"}, "edited": false, "score": 0, "creation_date": 1552764426, "post_id": 55200508, "comment_id": 97138500, "body": "Run Docker with -D option, see if it gives any useful error message."}, {"owner": {"reputation": 191, "user_id": 8398189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d37abcdaec57a9964ad1ad12fe9999a?s=128&d=identicon&r=PG", "display_name": "Igor Tulmentyev", "link": "https://stackoverflow.com/users/8398189/igor-tulmentyev"}, "edited": false, "score": 0, "creation_date": 1552774218, "post_id": 55200508, "comment_id": 97141043, "body": "Could you please do <code>RUN ls</code> before <code>CMD [&quot;.&#47;main&quot;]</code> and show an output?"}, {"owner": {"reputation": 335, "user_id": 1693363, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd4b5f916626e9a535ceb2a0008d6fcd?s=128&d=identicon&r=PG", "display_name": "Vishal", "link": "https://stackoverflow.com/users/1693363/vishal"}, "reply_to_user": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1552806013, "post_id": 55200508, "comment_id": 97145668, "body": "@MostafaHussein It&#39;s MacOS.  Also, I tried with <code>ls</code> and it did print a long machine code output."}], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 1, "last_activity_date": 1552827678, "creation_date": 1552827678, "answer_id": 55207340, "question_id": 55200508, "link": "https://stackoverflow.com/questions/55200508/docker-cant-run-a-go-output-file-that-already-exist/55207340#55207340", "title": "docker can&#39;t run a go output file that already exist", "body": "<p>The \"latest\" version of the golang image is debian based, which uses libc. Alpine uses musl. If you do not compile with <code>CGO_ENABLED=0</code>, networking libraries will link to libc and the no such file or directory error point to a missing library. You can check these shared library links with <code>ldd /app/main</code>. A few solutions I can think of:</p>\n\n<ul>\n<li>compile your program with <code>CGO_ENABLED=0</code></li>\n<li>switch your build image to <code>FROM golang:alpine</code></li>\n<li>change your second stage to be <code>FROM debian</code></li>\n</ul>\n"}], "owner": {"reputation": 335, "user_id": 1693363, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd4b5f916626e9a535ceb2a0008d6fcd?s=128&d=identicon&r=PG", "display_name": "Vishal", "link": "https://stackoverflow.com/users/1693363/vishal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "accepted_answer_id": 55207340, "answer_count": 1, "score": 0, "last_activity_date": 1552827678, "creation_date": 1552763093, "question_id": 55200508, "link": "https://stackoverflow.com/questions/55200508/docker-cant-run-a-go-output-file-that-already-exist", "title": "docker can&#39;t run a go output file that already exist", "body": "<p>I'm building a multi-stage Dockerfile for my go project.</p>\n\n<pre><code>FROM golang:latest as builder\n\nCOPY ./go.mod /app/go.mod\nCOPY ./go.sum /app/go.sum\n\n#exporting go1.11 module support variable\nENV GO111MODULE=on\n\nWORKDIR /app/\n\n#create vendor directory\nRUN go mod download\n\nCOPY . /app/\n\nRUN go mod vendor\n\n#building source code\nRUN go build -mod=vendor -o main -v ./src/\n\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nCOPY --from=builder /app/main /app/main\nWORKDIR /app/\n\nARG port=\"80\"\nENV PORT=$port\nEXPOSE $PORT\n\nCMD [\"./main\"]\n</code></pre>\n\n<p>When I'm running the image, it throws error:</p>\n\n<pre><code>standard_init_linux.go:207: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>I've verified that the 'main' file exist in /app/main.\nI also tried to give executable permission by adding</p>\n\n<pre><code>chmod +x /app/main\n</code></pre>\n\n<p>but still it doesn't work.\nWhat can possibly be wrong?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 5, "creation_date": 1552760076, "post_id": 55200003, "comment_id": 97137269, "body": "It&#39;s a type, not a function: <a href=\"https://golang.org/pkg/net/http/#Dir\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Dir</a>"}, {"owner": {"reputation": 215, "user_id": 8279368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce829f7874aea73b01b58c60b7a34eeb?s=128&d=identicon&r=PG&f=1", "display_name": "Johey", "link": "https://stackoverflow.com/users/8279368/johey"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1552760325, "post_id": 55200003, "comment_id": 97137356, "body": "Oh man, what a stupid mistake of me. Thank you."}], "owner": {"reputation": 215, "user_id": 8279368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce829f7874aea73b01b58c60b7a34eeb?s=128&d=identicon&r=PG&f=1", "display_name": "Johey", "link": "https://stackoverflow.com/users/8279368/johey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552760378, "creation_date": 1552759968, "last_edit_date": 1552760378, "question_id": 55200003, "link": "https://stackoverflow.com/questions/55200003/where-is-the-documentation-for-http-dir", "title": "Where is the documentation for http.Dir", "body": "<p>I'm trying to set up a go file server and came across the function <code>http.Dir(path string) http.FileSystem</code> when I looked into the documentation for FileSystem. </p>\n\n<p>In the source of net/http/fs.go line 705 it says:</p>\n\n<pre><code>//To use the operating system's file system implementation,\n//\n// use http.Dir:\n//\n//     http.Handle(\"/\", http.FileServer(http.Dir(\"/tmp\")))\n</code></pre>\n\n<p>But I can't find <strong>any</strong> Documentation of this function. Am I missing something?</p>\n\n<p>Edit:\nI missed that it's a type</p>\n"}, {"tags": ["go", "amazon-s3", "upload", "tus"], "answers": [{"tags": [], "owner": {"reputation": 68, "user_id": 9864681, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3Bbu0I8IAVg/AAAAAAAAAAI/AAAAAAAAAA8/4mbeQKB2o1o/photo.jpg?sz=128", "display_name": "Maxime La-x", "link": "https://stackoverflow.com/users/9864681/maxime-la-x"}, "is_accepted": false, "score": 4, "last_activity_date": 1579023513, "creation_date": 1579023513, "answer_id": 59739071, "question_id": 55199956, "link": "https://stackoverflow.com/questions/55199956/golang-http-uploading-file-to-s3-using-tusd-only-uploading-metadata/59739071#59739071", "title": "Golang HTTP uploading file to S3 using tusd only uploading metadata", "body": "<p>There are mutiple issues here.</p>\n\n<p>Your tus libary import paths are wrong they should be:</p>\n\n<pre><code>    \"github.com/tus/tusd/pkg/handler\"\n    \"github.com/tus/tusd/pkg/s3store\"\n</code></pre>\n\n<p>You dont use the S3 store propely, you setup a configuration to have storage directly on your server</p>\n\n<pre><code>fStore := filestore.FileStore{\n        Path: \"./uploads\",\n    }\n</code></pre>\n\n<p>Instead it should be something like this:</p>\n\n<pre><code>// S3 acces configuration\n s3Config := &amp;aws.Config{\n     Region:      aws.String(os.Getenv(\"AWS_REGION\")),\n     Credentials: credentials.NewStaticCredentials(os.Getenv(\"AWS_ACCESS_KEY_ID\"), os.Getenv(\"AWS_SECRET_ACCESS_KEY\"), \"\"),\n     DisableSSL:       aws.Bool(true),\n     S3ForcePathStyle: aws.Bool(true),\n }\n\n// Setting up the s3 storage\n s3Store := s3store.New(os.Getenv(\"AWS_BUCKET_NAME\"), s3.New(session.Must(session.NewSession()), s3Config))\n\n// Creates a new and empty store composer   \n composer := handler.NewStoreComposer()\n// UseIn sets this store as the core data store in the passed composer and adds all possible extension to it.\n s3Store.UseIn(composer)\n\n// Setting up handler\n handler, err := handler.NewHandler(handler.Config{\n     BasePath:                \"/files/\",\n     StoreComposer:           composer,\n })\n if err != nil {\n     panic(fmt.Errorf(\"Unable to create handler: %s\", err))\n }\n\n// Listen and serve\n http.Handle(\"/files/\", http.StripPrefix(\"/files/\", handler))\n err = http.ListenAndServe(\":8080\", nil)\n if err != nil {\n     panic(fmt.Errorf(\"Unable to listen: %s\", err))\n }\n</code></pre>\n\n<p>It is possible that your client isnt working proprely also (I didnt test it).</p>\n\n<p>I would recommend you use <a href=\"https://github.com/eventials/go-tus\" rel=\"nofollow noreferrer\">https://github.com/eventials/go-tus</a> instead of trying to implement the protocol by yourself.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1579023513, "creation_date": 1552759678, "question_id": 55199956, "link": "https://stackoverflow.com/questions/55199956/golang-http-uploading-file-to-s3-using-tusd-only-uploading-metadata", "title": "Golang HTTP uploading file to S3 using tusd only uploading metadata", "body": "<p>I am using the tusd library to upload a file directly to S3 in Go. It seems to be functioning however tusd uploads two files a .info metadata file and a .bin actual content file. For some reason my code is only uploading the info file.\nThe documentation is quite tricky to navigate so perhaps I have missed a setting somewhere</p>\n\n<p><a href=\"https://gist.github.com/amlwwalker/8424b849b65f0c098b9174725b90d315\" rel=\"nofollow noreferrer\">Code as gist to show both the server and the client code.</a> </p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 0, "last_activity_date": 1552765813, "creation_date": 1552765813, "answer_id": 55200861, "question_id": 55199826, "link": "https://stackoverflow.com/questions/55199826/transform-array-of-struct-into-array-of-strings-to-display-as-a-table/55200861#55200861", "title": "Transform array of struct into array of strings to display as a table", "body": "<p>There are a few issues with your code.  Firstly, the <code>append</code> function doesn't append in place so where you do <code>append(data, []string(b))</code> the result is thrown away so I think you want to do <code>data = append(data, []string(b))</code> instead.</p>\n\n<p>Also, doing a <code>json.Marshal</code> on the struct will not make a slice of strings which you try to use it as.  Instead, it will produce a single string that has all of the values in such as <code>{\"googlemapref\":\"something\",\"depth\":10}</code>.  The tablewriter you want to use expects to take a slice of values to put in the table that match the headings (where you appear to using the example headings of <code>\"Name\", \"Sign\", \"Rating\"</code>.</p>\n\n<p>You <em>could</em> use the <code>reflect</code> package like <code>json</code> does to populate the fields in each row but I think this would be more complexity than it is worth and you are better just filling in each row by calling the relevant fields:</p>\n\n<pre><code>func print(quakes []Quake) {\n    var data [][]string\n\n    for _, quake := range quakes {\n        row := []string{quake.Googlemapref, quake.Segree, strconv.Itoa(quake.Depth),...}\n        data = append(data, row)\n    }\n\n    table := tablewriter.NewWriter(os.Stdout)\n    table.SetHeader([]string{\"googlemapref\", \"degree\", \"depth\",...})\n\n    for _, v := range newData {\n        table.Append(v)\n    }\n    table.Render() // Send output\n}\n</code></pre>\n\n<p>(I've left the <code>...</code> for you to fill in the other fields yourself but included depth to show how to convert it to a string).</p>\n"}], "owner": {"reputation": 23, "user_id": 11213769, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w2dtCc8Xyb0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reXDoBJJrlCr-W5R76BTHmKC-G7Ew/mo/photo.jpg?sz=128", "display_name": "Filipe Costa", "link": "https://stackoverflow.com/users/11213769/filipe-costa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1552765813, "creation_date": 1552758766, "question_id": 55199826, "link": "https://stackoverflow.com/questions/55199826/transform-array-of-struct-into-array-of-strings-to-display-as-a-table", "title": "Transform array of struct into array of strings to display as a table", "body": "<p>I was watching the following package: <a href=\"https://github.com/olekukonko/tablewriter\" rel=\"nofollow noreferrer\">https://github.com/olekukonko/tablewriter</a></p>\n\n<p>And I want to try to print my struct as something like that, but I couldn't covert my array of structs into the array of strings that the package needs.</p>\n\n<p>So I tried something like that:</p>\n\n<pre><code>func print(quakes []Quake) {\n    var data [][]string\n\n    for _, quake := range quakes {\n        b, err := json.Marshal(quake)\n        append(data, []string(b))\n    }\n\n    table := tablewriter.NewWriter(os.Stdout)\n    table.SetHeader([]string{\"Name\", \"Sign\", \"Rating\"})\n\n    for _, v := range newData {\n        table.Append(v)\n    }\n    table.Render() // Send output\n}\n</code></pre>\n\n<p><strong>My Quake Struct:</strong></p>\n\n<pre><code>type Quake struct {\n    Googlemapref string `json:\"googlemapref\"`\n    Segree       string `json: \"degree\"`\n    DataUpdate   string `json: \"dataUpdate\"`\n    MagType      string `json:\"magType\"`\n    ObsRegion    string `json: \"obsRegion\"`\n    Lon          string `json:\"lon\"`\n    Source       string `json: \"source\"`\n    Depth        int    `json:\"depth\"`\n    TensorRef    string `json:\"tensorRef\"`\n    Sensed       string `json:\"sensed\"`\n    Shakemapid   string `json:\"shakemapid\"`\n    Time         string `json:\"time\"`\n    Lat          string `json:\"lat\"`\n    Shakemapref  string `json:\"shakemapref\"`\n    Local        string `json:\"local\"`\n    Magnitud     string `json: \"magnitud\"`\n}\n</code></pre>\n\n<p>Would appreciate some help since I am new in the laguage, thanks a lot</p>\n"}, {"tags": ["go", "concurrency", "writer", "buffered"], "comments": [{"owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552752292, "post_id": 55198712, "comment_id": 97134893, "body": "@Flimzy That makes sense, i figured it was related to concurrency. I found this - <a href=\"https://github.com/free/concurrent-writer\" rel=\"nofollow noreferrer\">github.com/free/concurrent-writer</a>. Gonna try it out"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552752328, "post_id": 55198712, "comment_id": 97134903, "body": "Because bufio.Writer flushes when the buffer is full, data is written in an unpredictable order to <code>f</code>.   There are ways to fix this.  Give some details on what the application is writing (is the app writing delimited records of some sort, how large are the records, ...)"}, {"owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552752498, "post_id": 55198712, "comment_id": 97134960, "body": "@Flimzy I have multiple writers because the data that needs to be parsed is fairly large, it&#39;s actually a large number of dns names, that are being scraped from an online resource so i wanted multiple writer in order to gain speed. I guess single writer isn&#39;t that bad either."}, {"owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552752563, "post_id": 55198712, "comment_id": 97134984, "body": "@ThunderCat app is writing host names newline separated to the file, and yeah the file is unprotected. I think a global mutex on the file would be sufficient."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1552752614, "post_id": 55198712, "comment_id": 97134993, "body": "The size of the data shouldn&#39;t matter. Channels are very light weight--sending the data to a single goroutine should add practically no overhead (other than any possible I/O delay which comes from waiting for the previous write to complete--but that&#39;s what you need)"}, {"owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1552752681, "post_id": 55198712, "comment_id": 97135015, "body": "@Flimzy It actually makes sense, i&#39;ll go with a single writer. Thanks for your help."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1552753906, "post_id": 55198712, "comment_id": 97135416, "body": "You can write directly to the file with correct results, but you probably want to buffer given the small record size.  Create one buffered writer and protect with a mutex or create a writing goroutine as suggested in the answer."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1552752987, "creation_date": 1552752987, "answer_id": 55198857, "question_id": 55198712, "link": "https://stackoverflow.com/questions/55198712/bufferedwriter-doesnt-works-when-used-concurrently/55198857#55198857", "title": "BufferedWriter doesn&#39;t works when used concurrently", "body": "<p>The problem is that you have multiple goroutines trying to write to a file at once, without any synchronization. This will lead to an unpredicatable output order, and possibly lost writes. Using buffered I/O on top of that just helps to obscure the behavior.</p>\n\n<p>The best solution is to kick off a single goroutine that writes to your output (with or without buffered I/O, depending on your needs), and have all of your workers send the data to be written to the writing goroutine over a channel.</p>\n"}], "owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 55198857, "answer_count": 1, "score": 0, "last_activity_date": 1552752987, "creation_date": 1552752023, "last_edit_date": 1552752124, "question_id": 55198712, "link": "https://stackoverflow.com/questions/55198712/bufferedwriter-doesnt-works-when-used-concurrently", "title": "BufferedWriter doesn&#39;t works when used concurrently", "body": "<p>I need to write large amount of data to text file from a number of goroutines (say 30) concurrently. What I do is this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>workers.Add(core.Concurrency)\n    for i := 0; i &lt; core.Concurrency; i++ {\n        go func() {\n            defer workers.Done()\n            writer := bufio.NewWriter(f)\n            defer writer.Flush()\n            a.Worker(workChan, writer)\n        }()\n    }\n</code></pre>\n\n<p>But this doesn't seems to work for some cases. Here <code>f</code> is the <code>*os.File</code> object. This doesn't writes to the file in some cases at all, and in some cases it writes some data but doesn't do future writes. The behaviour is very inconsistent and there are no errors too. </p>\n\n<p>Any ideas why this might be happening?</p>\n"}, {"tags": ["go", "go-http"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1552745259, "post_id": 55197133, "comment_id": 97132577, "body": "<i>&quot;Does that have anything to do with the global endopintParams i&#39;m creating?&quot;</i> Yes, since you&#39;re passing the address of <code>endpointParams</code>, <code>p</code> will always point to the same place in memory. That means that each time the handler+middleware is executed they are dealing with the <i>same</i> instance, unmarshaling json into the same block of memory, etc."}, {"owner": {"reputation": 781, "user_id": 5538805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qcmGCwGjWbU/AAAAAAAAAAI/AAAAAAAAABs/9AJejHA-JP8/photo.jpg?sz=128", "display_name": "Ahmed Dhanani", "link": "https://stackoverflow.com/users/5538805/ahmed-dhanani"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1552752558, "post_id": 55197133, "comment_id": 97134983, "body": "@mkopriva what would be the best way to reinitialize the <code>endpointParams</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1552754461, "post_id": 55197133, "comment_id": 97135572, "body": "Well, the best advise is to start in a <i>non</i> <i>generic</i> way."}], "owner": {"reputation": 781, "user_id": 5538805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qcmGCwGjWbU/AAAAAAAAAAI/AAAAAAAAABs/9AJejHA-JP8/photo.jpg?sz=128", "display_name": "Ahmed Dhanani", "link": "https://stackoverflow.com/users/5538805/ahmed-dhanani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 208, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552746604, "creation_date": 1552741509, "last_edit_date": 1552746604, "question_id": 55197133, "link": "https://stackoverflow.com/questions/55197133/how-to-create-a-generic-request-validation-middleware", "title": "How to create a generic request validation middleware", "body": "<p>What I want to achieve here is to create a very generic middleware called, <code>Expects</code> that actually validates the current request according to the parameters provided. It will raise a <code>Bad Request</code> if the required params are not present or are empty. In Python (Flask) this would be very simple like:</p>\n\n<pre><code>@app.route('/endpoint', methods=['POST'])\n@expects(['param1', 'param2'])\ndef endpoint_handler():\n    return 'Hello World'\n</code></pre>\n\n<p>The definition of <code>expects</code> would look like this (a very minimal example):</p>\n\n<pre><code>def expects(fields):\n    def decorator(view_function):\n\n        @wraps(view_function)\n        def wrapper(*args, **kwargs):\n            # get current request data\n            data = request.get_json(silent=True) or {}          \n\n            for f in fields:\n                if f not in data.keys():\n                    raise Exception(\"Bad Request\")\n\n            return view_function(*args, **kwargs)\n\n        return wrapper\n    return decorator\n</code></pre>\n\n<p>I am just confused a little about how would I achieve that in Go. What I tried so far is:</p>\n\n<pre><code>type RequestParam interface {\n    Validate() (bool, error)\n}\n\ntype EndpointParamsRequired struct {\n    SomeParam string `json:\"some_param\"`\n}\n\nfunc (p *EndpointParamsRequired) Validate() {\n    // My validation logic goes here\n    if len(p.SomeParam) == 0 {\n        return false, \"Missing field\"\n    }\n}\n\nfunc Expects(p RequestParam, h http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        // Check if present in JSON request\n\n        // Unmarshall JSON\n        ...\n\n        if _, err := p.Validate(); err != nil {\n            w.WriteHeader(http.StatusBadRequest)\n            fmt.Fprintf(w, \"Bad request: %s\", err)\n\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>and from <code>main.go</code> file:</p>\n\n<pre><code>func main() {\n    var (\n        endopintParams EndpointParamsRequired\n    )\n\n    r.HandleFunc(\"/endpoint\", Expects(&amp;endopintParams, EndpointHandler)).Methods(\"POST\")\n\n}\n</code></pre>\n\n<p>It actually works for the first time and validates the request, but after one valid request all the consecutive requests are successful even if the json does not contain the required param. Does that have anything to do with the global <code>endopintParams</code> I'm creating? </p>\n"}, {"tags": ["amazon-web-services", "go", "exception", "amazon-cloudwatch"], "answers": [{"tags": [], "owner": {"reputation": 112, "user_id": 1643842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d7d6e9e48678df415d2e9d88af60040?s=128&d=identicon&r=PG", "display_name": "Manan", "link": "https://stackoverflow.com/users/1643842/manan"}, "is_accepted": true, "score": 1, "last_activity_date": 1552871279, "creation_date": 1552871279, "answer_id": 55213528, "question_id": 55196976, "link": "https://stackoverflow.com/questions/55196976/getting-serializationexception-while-trying-to-putlogevents-on-cloudwatch-using/55213528#55213528", "title": "Getting SerializationException while trying to PutLogEvents on cloudwatch using golang", "body": "<p>Reason for SerializationException was:<code>logevents := make([]*cloudwatchlogs.InputLogEvent, 1)</code>\nfollowed by append which created first empty entry in slice. I replaced code with \n<code>logevents := make([]*cloudwatchlogs.InputLogEvent, 0)</code> and it got resolved.</p>\n\n<p>Additionally while debugging to find why logs were not getting populated I figured out that timestamp value used is not valid one. According to aws documentation timestamp for each event can't be older than 14 days and can't be more than 2hr in future.\nHere is link: <a href=\"https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_PutLogEvents.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_PutLogEvents.html</a></p>\n\n<p>Hope it will be helpful to someone facing similar issue in future.</p>\n"}], "owner": {"reputation": 112, "user_id": 1643842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d7d6e9e48678df415d2e9d88af60040?s=128&d=identicon&r=PG", "display_name": "Manan", "link": "https://stackoverflow.com/users/1643842/manan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 55213528, "answer_count": 1, "score": 0, "last_activity_date": 1552871279, "creation_date": 1552740555, "question_id": 55196976, "link": "https://stackoverflow.com/questions/55196976/getting-serializationexception-while-trying-to-putlogevents-on-cloudwatch-using", "title": "Getting SerializationException while trying to PutLogEvents on cloudwatch using golang", "body": "<p>I am trying to achieve following using my program:\nCreate log-group on aws cloudwatch\nCreate log-stream under above log-group\nPut log-events under above log-stream</p>\n\n<p>All this using go lang</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n    \"github.com/jcxplorer/cwlogger\"\n    \"github.com/aws/aws-sdk-go/service/cloudwatchlogs\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/aws\"\n)\n\nfunc main() {\n    sess := session.Must(session.NewSessionWithOptions(session.Options{\n        SharedConfigState: session.SharedConfigEnable,\n    }))\n\n    svc := cloudwatchlogs.New(sess)\n    logGroupName := \"my-log-group\";\n    logStreamName := \"my-log-stream\";\n    logGroupInput := cloudwatchlogs.CreateLogGroupInput{LogGroupName: &amp;logGroupName}\n    svc.CreateLogGroup(&amp;logGroupInput);\n    logStreamInput := cloudwatchlogs.CreateLogStreamInput{LogGroupName: &amp;logGroupName, LogStreamName: &amp;logStreamName}\n    svc.CreateLogStream(&amp;logStreamInput)\n\n    logevents := make([]*cloudwatchlogs.InputLogEvent, 1)\n\n    logevents = append(logevents, &amp;cloudwatchlogs.InputLogEvent{\n        Message:   aws.String(\"Simple log message\"),\n        Timestamp: aws.Int64(111),\n    })\n\n    p := cloudwatchlogs.PutLogEventsInput{LogEvents: logevents, LogGroupName: &amp;logGroupName, LogStreamName: &amp;logStreamName}\n    resp, err := svc.PutLogEvents(&amp;p)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Print(\"Next Token: {}\", resp.NextSequenceToken)\n}\n</code></pre>\n\n<p>Now when I run above code, it successfully creates log-group and log-stream and I can verify that in aws cloudwatch. But for some reason PutLogEvents fails with following error:</p>\n\n<pre><code>panic: SerializationException: \n    status code: 400, request id: 0685efcc-47e3-11e9-b528-81f33ec2f468\n</code></pre>\n\n<p>I am not sure what may be wrong here. Any suggestion or direction will be really helpful.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "timezone"], "comments": [{"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1552786127, "post_id": 55196704, "comment_id": 97143090, "body": "If you are doing things correctly, you should not care what location your server is in.   UTC applies everywhere.  Just get the UTC time, not the server&#39;s local time.  The server&#39;s local time should be irrelevant to your application.  Also, keep in mind that an offset only applies for a single point in time, where a time zone represents <i>all</i> offsets that might be applicable.  <code>America&#47;New_York</code>  is UTC-5 during standard time, and UTC-4 for during daylight saving time.  See also &quot;time zone != offset&quot; in <a href=\"https://stackoverflow.com/tags/timezone/info\">the timezone tag wiki</a>."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1553047363, "post_id": 55196704, "comment_id": 97237503, "body": "@MattJohnson I want to display time in local time. just consider the use case that you want to buy a film ticket in Shanghai two days later, which you are now in London and is flying there tonight. You want the time to be local time."}], "answers": [{"tags": [], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "is_accepted": true, "score": 3, "last_activity_date": 1552747171, "last_edit_date": 1552747171, "creation_date": 1552739107, "answer_id": 55196750, "question_id": 55196704, "link": "https://stackoverflow.com/questions/55196704/how-to-load-location-by-utc-offset/55196750#55196750", "title": "How to load location by utc offset", "body": "<p>I found it: </p>\n\n<pre><code>time.FixedZone(name string, offset int)\n</code></pre>\n\n<p>This will create a Location with given name (which is not important) and the offset.</p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "closed_date": 1574154668, "accepted_answer_id": 55196750, "answer_count": 1, "score": 2, "last_activity_date": 1552747171, "creation_date": 1552738806, "last_edit_date": 1552746847, "question_id": 55196704, "link": "https://stackoverflow.com/questions/55196704/how-to-load-location-by-utc-offset", "closed_reason": "Duplicate", "title": "How to load location by utc offset", "body": "<p>I want to load location via UTC offset, e.g.</p>\n\n<pre><code>func main() {\n    L, err := time.LoadLocation(\"UTC+8\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(L)\n}\n</code></pre>\n\n<p>The code panics: <code>panic: unknown time zone UTC+8</code></p>\n\n<p>How can I get the location object by UTC offset (NOT local nor UTC, but another location), without having to specify it in IANA Time Zone format, such as \"America/New_York\"</p>\n\n<p>My purpose is simple: I have a web server running in a fixed location, which I can get the local time easily.  Now I want to do time calculation based on the location of visitor (which is sent over by a url parameter, e.g. <code>http://myserver.com/do_something?timezone=-8</code>).</p>\n"}]