[{"tags": ["json", "go", "kubernetes"], "comments": [{"owner": {"reputation": 6902, "user_id": 11148139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bf8b5899e0796a9f52f95e706e6fc1a?s=128&d=identicon&r=PG&f=1", "display_name": "PjoterS", "link": "https://stackoverflow.com/users/11148139/pjoters"}, "edited": false, "score": 0, "creation_date": 1571895648, "post_id": 58531590, "comment_id": 103392499, "body": "Here: <a href=\"https://kubernetes.io/docs/reference/kubectl/cheatsheet/#patching-resources\" rel=\"nofollow noreferrer\">kubernetes.io/docs/reference/kubectl/cheatsheet/&hellip;</a> you have docs about patching resources. Could you post what exactly command are you using to patch your object? Also did you considered edit your deployment/pod to add this container?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 2099769, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b22V6.png?s=128&g=1", "display_name": "ipushmycar", "link": "https://stackoverflow.com/users/2099769/ipushmycar"}, "is_accepted": false, "score": 0, "last_activity_date": 1571925547, "creation_date": 1571925547, "answer_id": 58543022, "question_id": 58531590, "link": "https://stackoverflow.com/questions/58531590/how-do-i-use-a-mutatingwebhook-to-inject-a-container-into-a-kubernetes-pod-on-cr/58543022#58543022", "title": "How do I use a MutatingWebhook to inject a container into a Kubernetes pod on creation?", "body": "<p>I would've added this as a comment but my rep is too low.</p>\n\n<p><a href=\"https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/</a></p>\n\n<p>Shows examples of using kubectl to patch a deployment. The same JSON could be used in your MWH to also patch the deployment. </p>\n\n<p>Kubernetes has extensive go libraries that encapsulate all their Kubernetes objects as go structs. Here is an example of someone injecting a container using a MWH.</p>\n\n<p><a href=\"https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/main.go#L26\" rel=\"nofollow noreferrer\">https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/main.go#L26</a> &lt;- They load the YAML they will patch from a file (populated by a config map)</p>\n\n<p><a href=\"https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/deployment/configmap.yaml\" rel=\"nofollow noreferrer\">https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/deployment/configmap.yaml</a> &lt;- Is the YAML content they are injecting(populated by the config map)</p>\n\n<p><a href=\"https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/webhook.go#L132\" rel=\"nofollow noreferrer\">https://github.com/morvencao/kube-mutating-webhook-tutorial/blob/master/webhook.go#L132</a> &lt;- Where they loop over the containers in the deployment and add the container (via a JSON patch)</p>\n"}], "owner": {"reputation": 21, "user_id": 3400407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8856f0ced477182564bee1ec966522bc?s=128&d=identicon&r=PG&f=1", "display_name": "bosquito", "link": "https://stackoverflow.com/users/3400407/bosquito"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1571925547, "creation_date": 1571868624, "last_edit_date": 1571873595, "question_id": 58531590, "link": "https://stackoverflow.com/questions/58531590/how-do-i-use-a-mutatingwebhook-to-inject-a-container-into-a-kubernetes-pod-on-cr", "title": "How do I use a MutatingWebhook to inject a container into a Kubernetes pod on creation?", "body": "<p>Using a MutatingWebhook/sidecar injection, I'm trying to add a container to my Kubernetes deployment when it is created. I understand that I have to make a JSON patch, but I'm unclear on the syntax that I need to use to add a container. (I've successfully added labels to the deployment, FWIW.)</p>\n\n<p>I know that JSON patch object looks something like this, but I'm unclear about what to put in the \"value\" field.</p>\n\n<pre><code>}\n  \"op\":    \"add\",\n  \"path\":  \"/spec/containers\",\n  \"value\": \"containerName\",\n}\n</code></pre>\n\n<p>Here's an example of one of the error messages I get that indicates that something with my syntax is incorrect.</p>\n\n<pre><code>Error creating: Internal error occurred: Internal error occurred: v1.Pod.Spec: v1.PodSpec.Containers: []v1.Container: readObjectStart: expect { or n, but found \", error found in #10 byte of ...|160000}},\"{\\\"name\\\":|..., bigger context ...|OD\",\"SETGID\",\"SETUID\"]},\"runAsUser\":1000160000}},\"{\\\"name\\\":\\\"fluentd\\\"}\"],\"dnsPolicy\":\"ClusterFirst|...\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "testing", "integration-testing"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571867485, "post_id": 58531215, "comment_id": 103386642, "body": "_test.go files from packages other than the package being tested are not compiled, so no, you can&#39;t make this work. Define normal types and methods instead, possibly in an <a href=\"https://golang.org/cmd/go/#hdr-Internal_Directories\" rel=\"nofollow noreferrer\">internal package</a>."}, {"owner": {"reputation": 2661, "user_id": 1768245, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/blrNX.jpg?s=128&g=1", "display_name": "nikoo28", "link": "https://stackoverflow.com/users/1768245/nikoo28"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571867698, "post_id": 58531215, "comment_id": 103386719, "body": "i did try that, but I have some unexported structs being used in <code>x_test.go</code>. That was the entire reason to keep it in the root level. Moving it to an internal package causes errorss"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571897389, "post_id": 58531215, "comment_id": 103393035, "body": "@nikoo28 you want to share code between packages? Test code or not, the rules are simple, the code must be defined in a non-test file and it must be exported."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1571866126, "creation_date": 1571866126, "answer_id": 58531229, "question_id": 58531215, "link": "https://stackoverflow.com/questions/58531215/how-can-i-access-test-methods-from-sub-directories/58531229#58531229", "title": "How can I access test methods from sub-directories", "body": "<blockquote>\n  <p>Is there a way I can make the methods and struct defined in x_test.go visible to y_test.go?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 2661, "user_id": 1768245, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/blrNX.jpg?s=128&g=1", "display_name": "nikoo28", "link": "https://stackoverflow.com/users/1768245/nikoo28"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "closed_date": 1571901064, "answer_count": 1, "score": -1, "last_activity_date": 1572290414, "creation_date": 1571866045, "last_edit_date": 1572290414, "question_id": 58531215, "link": "https://stackoverflow.com/questions/58531215/how-can-i-access-test-methods-from-sub-directories", "closed_reason": "Duplicate", "title": "How can I access test methods from sub-directories", "body": "<p>My Go project code structure looks something like this.</p>\n\n<pre><code>project\n |\n +-- x_test.go\n |    \n +-- sub-directory\n |  |  \n |  +-- y_test.go\n</code></pre>\n\n<p><code>x_test.go</code> has some <code>struct</code> and methods that are used only for test purposes.</p>\n\n<p>These <code>struct</code> and methods are un-accessible in <code>y_test.go</code>.\nIs there a way test files can be imported in sub-directories? I cannot move the file <code>x_test.go</code> to the sub-directory as it makes use of some interfaces defined in the root level directory.</p>\n\n<p>The file <code>y_test.go</code> cannot be put at the root level as it is using some instances defined in <code>sub-directory</code>, and this would cause a cyclic dependency.</p>\n\n<p>Is there a way I can make the methods and struct defined in <code>x_test.go</code> visible to <code>y_test.go</code>?</p>\n\n<p>Everything works fine if I don't treat <code>x_test.go</code> as a test file. i.e, I rename it to just <code>x.go</code></p>\n"}, {"tags": ["xml", "go", "c-cda"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "edited": false, "score": 0, "creation_date": 1571932840, "post_id": 58532612, "comment_id": 103411498, "body": "I would like to use a package to return all the different sections of CCDA XML document."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1571877310, "creation_date": 1571877310, "answer_id": 58532612, "question_id": 58530671, "link": "https://stackoverflow.com/questions/58530671/is-it-possible-to-parsing-a-complete-ccda-xml-file-using-go/58532612#58532612", "title": "Is it Possible to Parsing a complete CCDA xml file Using Go?", "body": "<p>One thing you can try is to use a DOM library to parse the CCDA, and work on the resulting DOM model. There are several of them, one being <a href=\"https://github.com/lestrrat-go/libxml2\" rel=\"nofollow noreferrer\">https://github.com/lestrrat-go/libxml2</a>, which uses the libxml2 library.</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "edited": false, "score": 0, "creation_date": 1572458856, "post_id": 58579197, "comment_id": 103569787, "body": "@zhenghun: I would like to use a package to return all the different sections of CCDA XML document."}, {"owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "reply_to_user": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "edited": false, "score": 0, "creation_date": 1572495545, "post_id": 58579197, "comment_id": 103580236, "body": "If CCDA XML is a valid XML document, you can parse and extract some specified XML node from XML file using <code>xmlquery</code>."}, {"owner": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "edited": false, "score": 0, "creation_date": 1572534971, "post_id": 58579197, "comment_id": 103597862, "body": "Currenly I&#39;m doing parsing using <a href=\"https://godoc.org/github.com/clbanning/mxj\" rel=\"nofollow noreferrer\">godoc.org/github.com/clbanning/mxj</a> this package. By using this I can go to specific path and extract. If the path change in future it will not parse the elements right So I&#39;m checking is there any specific package for CCDA files in golang."}], "tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 0, "last_activity_date": 1572177418, "creation_date": 1572177418, "answer_id": 58579197, "question_id": 58530671, "link": "https://stackoverflow.com/questions/58530671/is-it-possible-to-parsing-a-complete-ccda-xml-file-using-go/58579197#58579197", "title": "Is it Possible to Parsing a complete CCDA xml file Using Go?", "body": "<p><a href=\"https://github.com/antchfx/xmlquery\" rel=\"nofollow noreferrer\">xmlquery</a> to parse any XML document and extract any you want to data by XPath.</p>\n"}, {"tags": [], "owner": {"reputation": 444, "user_id": 2261733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/780c16930d0e47274e198c7a1a7e6f76?s=128&d=identicon&r=PG", "display_name": "Bryn Lewis", "link": "https://stackoverflow.com/users/2261733/bryn-lewis"}, "is_accepted": false, "score": 0, "last_activity_date": 1593651024, "creation_date": 1593651024, "answer_id": 62687346, "question_id": 58530671, "link": "https://stackoverflow.com/questions/58530671/is-it-possible-to-parsing-a-complete-ccda-xml-file-using-go/62687346#62687346", "title": "Is it Possible to Parsing a complete CCDA xml file Using Go?", "body": "<p>I don't know Go, but CCDA is XML, so you can transform it using XSLT. I would assume Go has a way of allowing you to do that.</p>\n<p>There are many CCDA xsl examples - it depends what you want the result to be.</p>\n<p>eg <a href=\"https://github.com/hl7/cda-core-xsl\" rel=\"nofollow noreferrer\">https://github.com/hl7/cda-core-xsl</a></p>\n"}], "owner": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 432, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1593651024, "creation_date": 1571863043, "question_id": 58530671, "link": "https://stackoverflow.com/questions/58530671/is-it-possible-to-parsing-a-complete-ccda-xml-file-using-go", "title": "Is it Possible to Parsing a complete CCDA xml file Using Go?", "body": "<p>I would like to Parse an complete CCDA XML file by using any library available in Go. I tried to parse the CCDA XML file by using the <a href=\"https://godoc.org/github.com/clbanning/mxj\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/clbanning/mxj</a> library. In this one we need to go to specific path and parse the data but I want to parse the different scetions at a time by using the package or a library. I googled and ended up with no answers. It would be great if you guys help me.</p>\n"}, {"tags": ["variables", "go", "scopes"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571922914, "post_id": 58530115, "comment_id": 103405927, "body": "To be more precise, it&#39;s not that they&#39;re unexported - &quot;exporting&quot; a local variable in a function has no meaning (how would you even reference it from outside the function?). This has nothing to do with exporting, but rather with <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">scoping</a>. Only identifiers with package scope can be referenced from outside their scope, and then only if they are exported."}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": true, "score": 5, "last_activity_date": 1571860529, "creation_date": 1571860529, "answer_id": 58530115, "question_id": 58529963, "link": "https://stackoverflow.com/questions/58529963/does-capitalization-affect-variables-within-a-function-block-in-golang/58530115#58530115", "title": "Does capitalization affect variables within a function block in golang?", "body": "<p>Variables declared inside a function block are always private, or unexported.\nCapitalization has no effects in this case.</p>\n"}], "owner": {"reputation": 153, "user_id": 8704430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e348ef7b41694b6635199391d860889e?s=128&d=identicon&r=PG&f=1", "display_name": "user40176", "link": "https://stackoverflow.com/users/8704430/user40176"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 58530115, "answer_count": 1, "score": 0, "last_activity_date": 1571860529, "creation_date": 1571859722, "question_id": 58529963, "link": "https://stackoverflow.com/questions/58529963/does-capitalization-affect-variables-within-a-function-block-in-golang", "title": "Does capitalization affect variables within a function block in golang?", "body": "<p>If I declare a variable or parameter in a function, does capitalization have any affect or meaning?</p>\n\n<p>Obviously for methods and variables outside of functions it exports them, but what about the above? </p>\n"}, {"tags": ["go", "kubernetes", "prometheus"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571858494, "post_id": 58529231, "comment_id": 103383286, "body": "If you add your custom metrics to your program, give them names you can recognize, and then expose them via an http handler like it is done in that example, it should be enough. Your program does not push data to Prometheus, it will scrape data from your http metrics endpoint, and if you publish your metrics there, they should show up in Prometheus next time it scrapes your application."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571859369, "post_id": 58529231, "comment_id": 103383637, "body": "@bserdar - just for verification, so I can deploy the program to k8s as-is and I be able to query it by prom ui ? thanks!"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571859486, "post_id": 58529231, "comment_id": 103383679, "body": "If your Prometheus instance is scraping pods, yes. You can verify if you&#39;re publishing your metrics by simply looking at your app&#39;s metrics endpoint. It is text, and you should see your metrics there."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571859869, "post_id": 58529231, "comment_id": 103383826, "body": "@bserdar - Ok i&#39;ll deploy my app to k8s and check it, thank you!"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571862982, "post_id": 58529231, "comment_id": 103385117, "body": "To allow prometheus to collect (scrap) your pods, you might want to look at k8s<code>ClusterRoles</code> see here: <a href=\"https://supergiant.io/blog/monitoring-your-kubernetes-deployments-with-prometheus/\" rel=\"nofollow noreferrer\">supergiant.io/blog/&hellip;</a>"}, {"owner": {"reputation": 6902, "user_id": 11148139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bf8b5899e0796a9f52f95e706e6fc1a?s=128&d=identicon&r=PG&f=1", "display_name": "PjoterS", "link": "https://stackoverflow.com/users/11148139/pjoters"}, "edited": false, "score": 0, "creation_date": 1572017147, "post_id": 58529231, "comment_id": 103441872, "body": "@JhonD were you able to check Burak Serdar advised?"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 9545439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3hR0.png?s=128&g=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/9545439/phil"}, "is_accepted": false, "score": 1, "last_activity_date": 1571871895, "creation_date": 1571871895, "answer_id": 58532031, "question_id": 58529231, "link": "https://stackoverflow.com/questions/58529231/prometheus-add-custom-metrics/58532031#58532031", "title": "Prometheus add custom metrics", "body": "<p>You probably want Prometheus to discover the targets to scrape from automatically, if so you should configure <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config\" rel=\"nofollow noreferrer\">K8s service discovery</a> in Prometheus to discover pods, nodes and services from your cluster (maybe you already did something like this since you are already monitoring k8s metrics).</p>\n\n<p>To get your go application monitored you can for example add annotations to your pods or to your services to enable scraping from this targets and define where the metrics are available (path, port). However this depends on your scrape configuration and relabeling. Good example can be found <a href=\"https://linuxacademy.com/blog/kubernetes/running-prometheus-on-kubernetes/\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>If you are using <a href=\"https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md\" rel=\"nofollow noreferrer\">Prometheus Operator</a> you need to define a servicemonitor resource instead.</p>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2444, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1571871895, "creation_date": 1571856199, "question_id": 58529231, "link": "https://stackoverflow.com/questions/58529231/prometheus-add-custom-metrics", "title": "Prometheus add custom metrics", "body": "<p>We have a Prometheus running in our cluster and we are able to use grafana to watch our cluster / pods metrics, now I want to add some custom metrics , is there a way to do it ? if so how should I connect the code to Prometheus , I mean if i write golang program using Prometheus API , and deploy it as docker to k8s , now does the program know to connect with Prometheus ?\ne.g. this program is exposing data to the /metrics endpoint but what else should I do to make prom to be able to read this data ? </p>\n\n<p><a href=\"https://gist.github.com/sysdig-blog/3640f39a7bb1172f986d0e2080c64a75#file-prometheus-metrics-golang-go\" rel=\"nofollow noreferrer\">https://gist.github.com/sysdig-blog/3640f39a7bb1172f986d0e2080c64a75#file-prometheus-metrics-golang-go</a></p>\n"}, {"tags": ["firebase", "go", "firebase-realtime-database", "concurrency", "firebase-cloud-messaging"], "answers": [{"tags": [], "owner": {"reputation": 411025, "user_id": 209103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/12d378e6a9788ab9c94bbafe242b82b4?s=128&d=identicon&r=PG", "display_name": "Frank van Puffelen", "link": "https://stackoverflow.com/users/209103/frank-van-puffelen"}, "is_accepted": true, "score": 0, "last_activity_date": 1571857813, "creation_date": 1571857813, "answer_id": 58529556, "question_id": 58529163, "link": "https://stackoverflow.com/questions/58529163/how-can-i-increase-firebase-database-read-time-and-prevent-timeout-from-nginx/58529556#58529556", "title": "How can I increase firebase database read time and prevent timeout from Nginx", "body": "<p>Don't perform huge read or write operations on your real database please. While the server is processing that huge read/write, it is not servicing requests from your clients.</p>\n\n<p>For this type of processing, I'd highly recommend setting up automatic backups in the Firebase console, and then performing the operation on the raw data from that backup. That way you can optimize how you process the data, to not be dependent on the response time of the Firebase Database servers.</p>\n\n<p>Of course you'll still depend on the Firebase servers for the write operations. I'd consider doing that in reasonably sized multi-location updates, where you ensure that each multi-location update takes no more than a few seconds at most.</p>\n"}], "owner": {"reputation": 5, "user_id": 7004648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/711f9c04151f1108aec3d6f466c64824?s=128&d=identicon&r=PG&f=1", "display_name": "Idoncare", "link": "https://stackoverflow.com/users/7004648/idoncare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 58529556, "answer_count": 1, "score": 0, "last_activity_date": 1571857813, "creation_date": 1571855895, "question_id": 58529163, "link": "https://stackoverflow.com/questions/58529163/how-can-i-increase-firebase-database-read-time-and-prevent-timeout-from-nginx", "title": "How can I increase firebase database read time and prevent timeout from Nginx", "body": "<p>Context: I try to build a chat service. In chat service, I have (Say: 50000+) chat rooms. \nI have 20 admins who can access some specific chat rooms (Say: can access around 5000 chat rooms). So, I want to create features, so that I can add new admin and get the chat room list based on my query (Say: I got 5000 chat room from my query),  add that new admin to on those 5000 chat room using a single endpoint. I am using Golang and Firebase.</p>\n\n<pre><code>//GetAdmin user take a userID and it's return a user.\nfunc GetAdminUser(userID int) (user *User, err error) {\n    // It will query on the database \n    // then return the a user\n    return user, nil\n}\n</code></pre>\n\n<p>The problem is when I pass the patient's list and try to read the patient's topic from the firebase database It took around 20 minutes to read. So, it will give time out on Nginx. </p>\n\n<p>Is there any way I can improve firebase read time using go concurrency or any other way I can improve the reading from firebase and adding them without cazing any timeout error. </p>\n\n<pre><code>func AddNewAdminToPatientTopics(ctx context.Context, user User, patients []User) error {\n    for _, patient := range patients {\n        oldTopics := firebase.database.NewRef(fmt.Sprintf(\"USER_TOPICS/%d\", patient.ID))\n        for topicID, t := range topics {\n            newUserTopics := firebase.database.NewRef(fmt.Sprintf(\"USER_TOPICS/%d/%s\", user.ID, topicID))\n\n            // Add this new admin as a participant in this topic\n            topic := firebase.database.NewRef(fmt.Sprintf(\"TOPICS/%s/Participants/%d\", topicID, user.ID))\n            participant := &amp;Participant{\n                UserID: strconv.Itoa(user.ID),\n                LastTimeSeenOnline: time.Now().Unix(),\n                .......\n            }\n            err = topic.Set(ctx, participant)\n            if err != nil {\n                return err\n            }\n        }\n    }\n\n    return nil\n}\n\n\nfunc AddManager(w http.ResponseWriter, r *http.Request) {\n    // Don't worry about error, I handle them gracefully\n\n    // Get User\n    user, err := GetAdminUser(UserID)\n\n    // get patients list\n    // Say, In this case you we have 5000+ patients\n    patients, err := GetPatients(user.CustomerID)\n\n\n    // Join this user to all chat rooms that the first admin has\n    err = AddNewAdminToTopics(context.Background(), *user, patients)\n}\n\nRouters: \n\nhttp.HandleFunc(\"chat/managers/new/add\", Post).Then(clinic.AddManager))\n</code></pre>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571849641, "post_id": 58527585, "comment_id": 103379610, "body": "Are you using v0.10.0 of logrus? That&#39;s really old, and probably does not have the <code>Buffer</code> field. If you update to a newer version it should work."}], "answers": [{"tags": [], "owner": {"reputation": 1161, "user_id": 6013663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7b2e785ad782e5103fd679b9ec849?s=128&d=identicon&r=PG", "display_name": "Masudur Rahman", "link": "https://stackoverflow.com/users/6013663/masudur-rahman"}, "is_accepted": false, "score": 0, "last_activity_date": 1571861768, "creation_date": 1571861768, "answer_id": 58530399, "question_id": 58527585, "link": "https://stackoverflow.com/questions/58527585/logrus-entry-does-not-have-buffer-field/58530399#58530399", "title": "Logrus Entry does not have Buffer field", "body": "<p><a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> introduced <code>Buffer</code> in <code>v0.11.0</code>. You could use any version after <code>v0.10.0</code>.</p>\n\n<p>But I would suggest to use the latest version [<code>v1.4.2</code>]. They must have added many functionalities and fixed issues in the later versions. </p>\n\n<p>So, you should just use the latest version.</p>\n"}], "owner": {"reputation": 327, "user_id": 4748456, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/823949724357641/picture?type=large", "display_name": "Rodrigo Rocha", "link": "https://stackoverflow.com/users/4748456/rodrigo-rocha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571861768, "creation_date": 1571849212, "question_id": 58527585, "link": "https://stackoverflow.com/questions/58527585/logrus-entry-does-not-have-buffer-field", "title": "Logrus Entry does not have Buffer field", "body": "<p>I need to build a logrus custom formatter and Logrus Entry seems not have a field called Buffer.</p>\n\n<p>I am using:</p>\n\n<p>go version go1.13.1 linux/amd64\n<a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus</a> v0.10.0\nLinux Cent OS 7</p>\n\n<pre><code>package util\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"strings\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\ntype LogFormat struct {\n    TimestampFormat string\n}\n\nfunc (f *LogFormat) Format(entry *logrus.Entry) ([]byte, error) {\n    var b *bytes.Buffer\n\n    if entry.Buffer != nil {\n        b = entry.Buffer\n    } else {\n        b = &amp;bytes.Buffer{}\n    }\n\n    b.WriteByte('[')\n    b.WriteString(strings.ToUpper(entry.Level.String()))\n    b.WriteString(\"]:\")\n    b.WriteString(entry.Time.Format(f.TimestampFormat))\n\n    if entry.Message != \"\" {\n        b.WriteString(\" - \")\n        b.WriteString(entry.Message)\n    }\n\n    if len(entry.Data) &gt; 0 {\n        b.WriteString(\" || \")\n    }\n\n    for key, value := range entry.Data {\n        b.WriteString(key)\n\n        b.WriteByte('=')\n        b.WriteByte('{')\n\n        strValue, _ := json.Marshal(value)\n        var genericObject interface{}\n        json.Unmarshal(strValue, &amp;genericObject)\n\n        b.WriteString(string(strValue))\n        b.WriteString(\"}, \")\n    }\n\n    b.WriteByte('\\n')\n    return b.Bytes(), nil\n}\n</code></pre>\n\n<p>Main Function</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"os\"\n    \"time\"\n\n    \"git-devops.totvs.com.br/rodrigo.henrique/logrusPeopleExample/data\"\n    \"git-devops.totvs.com.br/rodrigo.henrique/logrusPeopleExample/util\"\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n\n    carlos := &amp;data.People{\n        Name:     \"Carlos\",\n        Age:      18,\n        LastSeen: time.Now(),\n    }\n\n    pedro := &amp;data.People{\n        Name:     \"Pedro\",\n        Age:      22,\n        Email:    \"pedro@email.com.br\",\n        LastSeen: time.Now(),\n    }\n\n    json.NewEncoder(os.Stdout).Encode(\n        &amp;carlos,\n    )\n\n    formatter := util.LogFormat{}\n    formatter.TimestampFormat = \"2006-01-02 15:04:05\"\n    logrus.SetFormatter(&amp;formatter)\n\n    logrus.WithFields(logrus.Fields{\n        \"people\": &amp;carlos,\n    }).Info(\"Logging \", carlos.Name)\n\n    logrus.WithFields(logrus.Fields{\n        \"people\": &amp;pedro,\n    }).Info(\"Logging \", pedro.Name)\n\n    logrus.WithFields(logrus.Fields{\n        \"people1\": &amp;pedro,\n        \"people2\": &amp;carlos,\n    }).Info(\"Logging two people\")\n\n}\n\n</code></pre>\n\n<p>In the second line of the Format function I've got an error because Entry does not have Buffer field.</p>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 783, "user_id": 1182658, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e49c58e5bd4e6d903e6df296d51ff74e?s=128&d=identicon&r=PG", "display_name": "Anup", "link": "https://stackoverflow.com/users/1182658/anup"}, "edited": false, "score": 0, "creation_date": 1571960551, "post_id": 58526662, "comment_id": 103421668, "body": "&quot;Still not working.&quot;  Do you have an error you can produce?  And I see the problem now."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 1, "last_activity_date": 1571960789, "last_edit_date": 1571960789, "creation_date": 1571845672, "answer_id": 58526662, "question_id": 58525268, "link": "https://stackoverflow.com/questions/58525268/how-to-set-where-clause-dynamically-in-gorm/58526662#58526662", "title": "How to set where clause dynamically in GORM", "body": "<p>I see the problem now.  The <code>?</code> is for values, not column names.  If you can 100% trust the source of the inputs then a simple string replacement will work.  If you are are allowing data from users then you should be <em>very</em> careful and validated / sanitize the column names.</p>\n\n<p>This should work.</p>\n\n<pre><code>inFilter := map[string][]string{\"product_id\": []string{\"3\", \"69\"}}\nfor key, value := range inFilter {\n   filterQuerable = filterQuerable.Where(key + \" IN (?)\", value)\n}\n</code></pre>\n"}], "owner": {"reputation": 783, "user_id": 1182658, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e49c58e5bd4e6d903e6df296d51ff74e?s=128&d=identicon&r=PG", "display_name": "Anup", "link": "https://stackoverflow.com/users/1182658/anup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 58526662, "answer_count": 1, "score": 1, "last_activity_date": 1572570879, "creation_date": 1571841298, "last_edit_date": 1572570879, "question_id": 58525268, "link": "https://stackoverflow.com/questions/58525268/how-to-set-where-clause-dynamically-in-gorm", "title": "How to set where clause dynamically in GORM", "body": "<p>I will receive a <code>map[string][]string</code>. For each key in the map i want to add where clause like bellow.</p>\n\n<pre><code>inFilter := map[string][]string{\"product_id\": []string{\"3\", \"69\"}}\nfor key, value := range inFilter {\n        filterQuerable = filterQuerable.Where(\"(?) IN (?)\", key, value)\n    }\n</code></pre>\n\n<p>it does not work. I tried bellow which also not works</p>\n\n<pre><code>filterQuerable = filterQuerable.Where(\"(?) IN (?)\", \"product_id\", []string{\"3\", \"69\"})\n</code></pre>\n\n<p>Only bellow code works</p>\n\n<pre><code>filterQuerable = filterQuerable.Where(\"product_id IN (?)\",  []string{\"3\", \"69\"})\n</code></pre>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1571841147, "post_id": 58525071, "comment_id": 103375285, "body": "A) No. B) Write a normal function. If you insist on delivering the value via a channel then your approach is fine because of A. If you do not range over a channel there is no real need to close it."}], "answers": [{"comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1571845430, "post_id": 58525233, "comment_id": 103377589, "body": "I would not call these approaches &quot;idiomatic&quot;. From Effective Go (<a href=\"https://golang.org/doc/effective_go.html#concurrency\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#concurrency</a>): <code>Go encourages a different approach in which shared values are passed around on channels and, in fact, never actively shared by separate threads of execution.</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1571847201, "post_id": 58525233, "comment_id": 103378481, "body": "@EmilePels fair point. Noted that in the answer."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1571847166, "last_edit_date": 1571847166, "creation_date": 1571841203, "answer_id": 58525233, "question_id": 58525071, "link": "https://stackoverflow.com/questions/58525071/idiomatic-way-of-handling-a-goroutine-with-one-return-value/58525233#58525233", "title": "Idiomatic way of handling a goroutine with one &quot;return&quot; value?", "body": "<p>You do not need to close channels. Once it goes out of scope, it will be garbage collected. Closing a channel is usually used to send a <code>done</code> notification to the listener. So it is not even possible in your case.</p>\n\n<p>Yours is an idiomatic approach for what you're trying to achieve, but not the only one. Some others (not necessarily idiomatic) that I can think of are:</p>\n\n<ul>\n<li>You can use a shared data structure and populate that from multiple goroutines with explicit synchronization,</li>\n<li>You can keep a separate result for each goroutine, and pass in a pointer to it. Each goroutine sets its result without a need for synchronization, and when everything is done, the caller works with the results.</li>\n</ul>\n"}], "owner": {"reputation": 775, "user_id": 816182, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a912c0fab7489da071314182f67901ea?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/816182/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1571865325, "accepted_answer_id": 58525233, "answer_count": 1, "score": -3, "last_activity_date": 1571847166, "creation_date": 1571840685, "question_id": 58525071, "link": "https://stackoverflow.com/questions/58525071/idiomatic-way-of-handling-a-goroutine-with-one-return-value", "closed_reason": "Opinion-based", "title": "Idiomatic way of handling a goroutine with one &quot;return&quot; value?", "body": "<p>Imagine I want to write a function that returns a random number divided by 2:</p>\n\n<pre><code>func randomIntInHalf() int {\n    return rand.Int() / 2\n}\n</code></pre>\n\n<p>But then I decide I want to build this function for concurrency so I end up with:</p>\n\n<pre><code>func randomIntInHalf(c chan&lt;- int) {\n    c &lt;- rand.Int() / 2\n}\n\nfunc main() {\n    // Generate 10 random ints in parallel\n    amount := 10\n    c := make(chan int, amount)\n\n    for i := 0; i &lt; amount; i++ {\n        go randomIntInHalf(c)\n    }\n\n    for i := 0; i &lt; amount; i++ {\n        fmt.Println(&lt;-c)\n    }\n\n    close(c)\n}\n</code></pre>\n\n<p>I see some issues with this approach. For example, I require the caller to close the channel when it's done generating, making it possible that someone might call the function and leave the channel open indefinitely. It was sort of my understanding that you always want the sender to close the channel. A) is that true and b) is it even possible in this case? Is there a better way to write this code or approach this problem?</p>\n\n<p>And, generally, is there a better, idiomatic approach for running a function in a parallel that only ever writes 1 (or a known N) value to the channel?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "kubernetes", "certificate"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "edited": false, "score": 0, "creation_date": 1571843151, "post_id": 58525672, "comment_id": 103376376, "body": "good idea,we have started to  work with prom :) can ou please provide a referance how it can be done? thanks"}, {"owner": {"reputation": 96298, "user_id": 213269, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/894e4c1f3bc33e5f9a5008d355287830?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/213269/jonas"}, "reply_to_user": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "edited": false, "score": 0, "creation_date": 1572289562, "post_id": 58525672, "comment_id": 103506575, "body": "@Jonlib I think there is much variation in implementation, e.g. <a href=\"https://github.com/ribbybibby/ssl_exporter\" rel=\"nofollow noreferrer\">github.com/ribbybibby/ssl_exporter</a> and <a href=\"https://www.robustperception.io/get-alerted-before-your-ssl-certificates-expire\" rel=\"nofollow noreferrer\">robustperception.io/&hellip;</a>"}], "tags": [], "owner": {"reputation": 96298, "user_id": 213269, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/894e4c1f3bc33e5f9a5008d355287830?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/213269/jonas"}, "is_accepted": true, "score": 0, "last_activity_date": 1571842482, "creation_date": 1571842482, "answer_id": 58525672, "question_id": 58524283, "link": "https://stackoverflow.com/questions/58524283/check-certificate-experation-date/58525672#58525672", "title": "Check certificate experation date", "body": "<p>I would recommend to expose the cert expiration date or days until expiration as a metric. It is common to have a service e.g. Prometheus to scrape metrics from all apps and you can visualize or setup alerts when a certificate is about to expire.</p>\n"}], "owner": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 2, "accepted_answer_id": 58525672, "answer_count": 1, "score": 0, "last_activity_date": 1575208838, "creation_date": 1571838212, "last_edit_date": 1575208838, "question_id": 58524283, "link": "https://stackoverflow.com/questions/58524283/check-certificate-experation-date", "title": "Check certificate experation date", "body": "<p>I need via API to monitor if certificate is invalid and I found this</p>\n\n<p><a href=\"https://github.com/kubernetes/client-go/blob/611184f7c43ae2d520727f01d49620c7ed33412d/util/certificate/certificate_manager_test.go#L176\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/blob/611184f7c43ae2d520727f01d49620c7ed33412d/util/certificate/certificate_manager_test.go#L176</a></p>\n\n<p>But not sure how to use it as it\u2019s too complicated, I just need init a api call like get etc and get\nthe time which the cert should be expired.</p>\n\n<p>Any idea ? </p>\n\n<p>any example will be much appreciated  </p>\n"}, {"tags": ["go", "methods"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1571832697, "post_id": 58522534, "comment_id": 103370254, "body": "&quot;When I run my server I have this error&quot; but this is a compile time error not a runtime error. How are you building your software? Use <code>go build</code> only and keep away from <code>go run</code>."}, {"owner": {"reputation": 11, "user_id": 12070337, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_AfkPrRs7zo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reoI-Ixmt_ICfrbkA6P0waQ-K5KoA/photo.jpg?sz=128", "display_name": "mgalazka", "link": "https://stackoverflow.com/users/12070337/mgalazka"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571833103, "post_id": 58522534, "comment_id": 103370494, "body": "@Volker Well I am still at beginner level and was always trying to run, not to build. Building solved my problem. Thanks!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1571833431, "post_id": 58522534, "comment_id": 103370660, "body": "@mgalazka <code>go run</code> will compile only those files that you pass to it, so if you want to execute a quick test run you need to feed all of the package&#39;s files to <code>go run</code>, e.g. <code>go run main.go file_with_method.go</code>, alternatively you can also do <code>go run .</code>, using a &quot;pattern&quot; to match all files in the current directory, etc. more info here: <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Compile_and_run_Go_program</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1571833535, "post_id": 58522534, "comment_id": 103370730, "body": "No problem. <code>go run</code> is a <i>helper</i> and is <i>unsuitable</i> to properly compile an application as it is too easy to use it wrongly. <code>go run</code> is the perfect tool to run a single-file application, often some helper or code generator which is often even excluded from the actual build. And <code>go build</code> is used to build go programs and go packages."}], "owner": {"reputation": 11, "user_id": 12070337, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_AfkPrRs7zo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reoI-Ixmt_ICfrbkA6P0waQ-K5KoA/photo.jpg?sz=128", "display_name": "mgalazka", "link": "https://stackoverflow.com/users/12070337/mgalazka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 835, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571838065, "creation_date": 1571832518, "last_edit_date": 1571838065, "question_id": 58522534, "link": "https://stackoverflow.com/questions/58522534/type-has-no-field-or-method", "title": "Type has no field or method", "body": "<p>I have a problem with a struct's method.\nIn one file (same package) I a struct:</p>\n\n<pre><code>type Task struct {\n    ID       int    `json:\"id\"`\n    Priority string `json:\"priority\"`\n    Content  string `json:\"content\"`\n}\n</code></pre>\n\n<p>The Task comes as a body in POST. Parsing the JSON to this struct works well.\nIn other file I have a method:</p>\n\n<pre><code>func (task *Task) createTask() (err error) {\n    data, err := bson.Marshal(&amp;task)\n    if err != nil {\n        return errors.New(\"error in parsing incoming task\")\n    }\n    rslt, err := collection.InsertOne(context.Background(), data)\n    if err != nil {\n        return errors.New(\"error in saving task to database\")\n    }\n    fmt.Println(rslt.InsertedID)\n    return nil\n}\n</code></pre>\n\n<p>The Task structure is in the same file with my server. createTask() method is in the file which handles communication to mongoDB.\nWhen I run my server I have this error:</p>\n\n<pre><code>./server.go:53:12: task.createTask undefined (type Task has no field or method createTask)\n</code></pre>\n\n<p>Here is how I am calling the method:</p>\n\n<pre><code>var task Task\njson.Unmarshal(body, &amp;task)\nerr = task.createTask()\n</code></pre>\n\n<p>Do you have any ideas what am I doing wrong?</p>\n"}, {"tags": ["performance", "unit-testing", "go", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 1383, "user_id": 4443417, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh5.googleusercontent.com/-hpEfQ1JOeZU/AAAAAAAAAAI/AAAAAAAAFac/HV2C73JnwJM/photo.jpg?sz=128", "display_name": "alvery", "link": "https://stackoverflow.com/users/4443417/alvery"}, "edited": false, "score": 0, "creation_date": 1571912911, "post_id": 58521839, "comment_id": 103400631, "body": "You have a client that makes unary calls to some grpc servers. When you invoke your client constructor it shouldn&#39;t instantiate any connections - only when you call updateUser method. So the best and the only right option here is to pass you client to constructor and mock your dependency."}, {"owner": {"reputation": 236, "user_id": 1341576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb28c0b424f30eb5cfecfebb69439840?s=128&d=identicon&r=PG", "display_name": "Utnapishtim", "link": "https://stackoverflow.com/users/1341576/utnapishtim"}, "reply_to_user": {"reputation": 1383, "user_id": 4443417, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh5.googleusercontent.com/-hpEfQ1JOeZU/AAAAAAAAAAI/AAAAAAAAFac/HV2C73JnwJM/photo.jpg?sz=128", "display_name": "alvery", "link": "https://stackoverflow.com/users/4443417/alvery"}, "edited": false, "score": 0, "creation_date": 1571990751, "post_id": 58521839, "comment_id": 103428699, "body": "@alvery so when I&#39;m doing client := api.NewUserServiceClient(conn) I&#39;m not starting a connection. If I understand correctly write an answer and I&#39;ll accept it (after some test). I&#39;ll test in the following days. Thank you"}, {"owner": {"reputation": 93, "user_id": 3722202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35bfed79ed50b9a63cd8ed6323a66ff?s=128&d=identicon&r=PG&f=1", "display_name": "nukul", "link": "https://stackoverflow.com/users/3722202/nukul"}, "edited": false, "score": 0, "creation_date": 1592853328, "post_id": 58521839, "comment_id": 110568499, "body": "did we get solution to it? i am facing similar issue, where client mock can be unit testedl &quot;howver i am unable to set constructor for client mock, return an error&gt;  Unexpected call to *mock... xyz_mock.go:65 because: there are no expected calls of the method &quot;xyz&quot; for that receiver"}], "owner": {"reputation": 236, "user_id": 1341576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb28c0b424f30eb5cfecfebb69439840?s=128&d=identicon&r=PG", "display_name": "Utnapishtim", "link": "https://stackoverflow.com/users/1341576/utnapishtim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 808, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571837792, "creation_date": 1571830100, "last_edit_date": 1571837792, "question_id": 58521839, "link": "https://stackoverflow.com/questions/58521839/how-to-mock-grpc-clients-inside-grpc-server-implementation", "title": "How to mock Grpc Clients inside GRPC server implementation", "body": "<p>I have a GRPC server that is talking to many other GRPC servers.\nSo, my server is client for many other GRPC servers\nI would like to test my server implementation but I'm stuck on how to mock the GRPC clients.</p>\n\n<p>I have a method from my GRPC server like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s UserBackendServer) UpdateUser(ctx context.Context, req *api.UpdateUserRequest) (*api.User, error) {\n    conn, err := grpc.DialContext(ctx, s.userSvcAddr,\n        grpc.WithInsecure(),\n        grpc.WithStatsHandler(&amp;ocgrpc.ClientHandler{}))\n    if err != nil {\n        return nil, fmt.Errorf(\"could not connect shipping service: %+v\", err)\n    }\n    defer conn.Close()\n\n    user, err := api.NewUserServiceClient(conn).\n        UpdateUser(ctx, &amp;api.UpdateUserRequest{\n        User:                 nil,\n        UserId:               \"\",\n    })\n    return user, nil\n}\n</code></pre>\n\n<p>In this type of implementation, I cannot mock the UserServiceClient because I create one inside the method :(</p>\n\n<p>I have thought about two ways to solve this issue</p>\n\n<ol>\n<li>Have the client reference inside the <code>UserBackendServer</code> struct</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UserBackendServer struct {\n    projectID string\n    userSvcClient api.UserServiceClient\n}\n\nfunc (s UserBackendServer) UpdateUser(ctx context.Context, req *api.UpdateUserRequest) (*api.User, error) {\n    conn, err := grpc.DialContext(ctx, s.userSvcAddr,\n        grpc.WithInsecure(),\n        grpc.WithStatsHandler(&amp;ocgrpc.ClientHandler{}))\n    if err != nil {\n        return nil, fmt.Errorf(\"could not connect shipping service: %+v\", err)\n    }\n    defer conn.Close()\n\n    user, err := s.userSvcClient.UpdateUser(ctx, &amp;api.UpdateUserRequest{\n        User:                 nil,\n        UserId:               \"\",\n    })\n    return user, nil\n}\n</code></pre>\n\n<p>With this implementation, I have the side effect of having a continuously active connection to the clients (I have like 10 clients to communicate with). Is it fine in production? Having always-connected clients can it lead to a memory leak or too much concurrents connections?</p>\n\n<ol start=\"2\">\n<li>Using methods that get the client as an argument</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s UserBackendServer) UpdateUser(ctx context.Context, req *api.UpdateUserRequest) (*api.User, error) {\n    conn, err := grpc.DialContext(ctx, s.userSvcAddr,\n        grpc.WithInsecure(),\n        grpc.WithStatsHandler(&amp;ocgrpc.ClientHandler{}))\n    if err != nil {\n        return nil, fmt.Errorf(\"could not connect shipping service: %+v\", err)\n    }\n    defer conn.Close()\n\n    client := api.NewUserServiceClient(conn)\n    updateUser(ctx, req.UserId, req.User, client)\n\n\n    user, err := s.userSvcClient.UpdateUser(ctx, &amp;api.UpdateUserRequest{\n        User:                 nil,\n        UserId:               \"\",\n    })\n    return user, nil\n}\n\nfunc updateUser(ctx context.Context, userId string, user *api.User, client api.UserServiceClient) (*api.User, error){\n    userUpdated, err := client.UpdateUser(ctx, &amp;api.UpdateUserRequest{\n        User:                 nil,\n        UserId:               \"\",\n    })\n\n    return userUpdated, err\n}\n</code></pre>\n\n<p>This seems a little bit cumbersome to write all these little functions and I can't make a unit test of the server function.</p>\n\n<p>The strategy number one is it feasible? do you have experience about limitations or how to retry a failed connections if the connections are maintained in the server struct</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 3894109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f97d9613cb73207dcc1b07d546350423?s=128&d=identicon&r=PG&f=1", "display_name": "himg90", "link": "https://stackoverflow.com/users/3894109/himg90"}, "is_accepted": true, "score": 1, "last_activity_date": 1571835136, "creation_date": 1571835136, "answer_id": 58523305, "question_id": 58520756, "link": "https://stackoverflow.com/questions/58520756/does-gorm-support-single-insert-with-has-many-relationship/58523305#58523305", "title": "Does GORM support single insert with has many relationship?", "body": "<p>Since you are using <code>MasterJobID</code> as your primary key instead of following the conventions in gorm (<code>ID</code>), you need to mention the <a href=\"https://gorm.io/docs/has_many.html#Association-ForeignKey\" rel=\"nofollow noreferrer\">Association ForeignKey</a></p>\n\n<p>In code it will look like:</p>\n\n<pre><code>type MasterJob struct {\n    MasterJobID int       `gorm:\"column:master_job_id;not null;AUTO_INCREMENT\"`\n    StartedAt   time.Time `gorm:\"column:started_at;not null\"`\n    CompletedAt time.Time `gorm:\"column:completed_at;\"`\n    Status      Status    `gorm:\"column:status;\"`\n    Subjobs     []Subjob  `gorm:\"foreignkey:MasterJobID;association_foreignkey:MasterJobID\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1261, "user_id": 5405093, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-w8jn4kVX0To/AAAAAAAAAAI/AAAAAAAAMwc/8j2h2xb8ncw/photo.jpg?sz=128", "display_name": "Manoj Suthar", "link": "https://stackoverflow.com/users/5405093/manoj-suthar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 58523305, "answer_count": 1, "score": 0, "last_activity_date": 1571835136, "creation_date": 1571826338, "question_id": 58520756, "link": "https://stackoverflow.com/questions/58520756/does-gorm-support-single-insert-with-has-many-relationship", "title": "Does GORM support single insert with has many relationship?", "body": "<p>I have two structs having HasMany relationship like shown below:</p>\n\n<pre><code>type MasterJob struct {\n    MasterJobID int       `gorm:\"column:master_job_id;not null;AUTO_INCREMENT\"`\n    StartedAt   time.Time `gorm:\"column:started_at;not null\"`\n    CompletedAt time.Time `gorm:\"column:completed_at;\"`\n    Status      Status    `gorm:\"column:status;\"`\n    Subjobs     []Subjob  `gorm:\"foreignkey:MasterJobID\"`\n}\n\ntype Subjob struct {\n    SubjobID     int       `gorm:\"type:serial;primary_key:yes;column:subjob_id;AUTO_INCREMENT\"`\n    StartedAt    time.Time `gorm:\"column:started_at;not null\"`\n    CompletedAt  time.Time `gorm:\"column:completed_at;DEFAULT:nil\"`\n    Status       Status    `gorm:\"column:status;\"`\n    MasterJobID  int       `gorm:\"column:master_job_id;\"`\n}\n</code></pre>\n\n<p>I have a MasterJob object with multiple Subjobs and I am trying to save it like shown below:</p>\n\n<pre><code>func (r *repo) CreateJob() (int, []error) {\n    subJobs := make([]models.Subjob, 0)\n    job := models.Subjob{\n        Status:       models.StatusInprogress,\n        StartedAt:    time.Now(),\n        SurveyUUID:   uuid.New(),\n        FlightlineID: 1,\n    }\n    subJobs = append(subJobs, job)\n    masterJob := &amp;models.MasterJob{\n        Status:    models.StatusInprogress,\n        StartedAt: time.Now(),\n        Subjobs:   subJobs,\n    }\n    errors := r.DB.Create(masterJob).GetErrors()\n    if len(errors) &gt; 0 {\n        fmt.Println(errors)\n        return -1, errors\n    }\n    return masterJob.MasterJobID, nil\n}\n</code></pre>\n\n<p>When I try to save this object, only MasterJob data is getting saved. Am I doing this wrong or Insert like this is not supported in GORM?  </p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1571826050, "post_id": 58520499, "comment_id": 103366686, "body": "<a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 4296172, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HMIrjjn-Y-E/AAAAAAAAAAI/AAAAAAAAAAA/lgfneVz-QTs/photo.jpg?sz=128", "display_name": "Algel Us", "link": "https://stackoverflow.com/users/4296172/algel-us"}, "edited": false, "score": 0, "creation_date": 1571826139, "post_id": 58520568, "comment_id": 103366720, "body": "Thanks for the quick answer. Now I see they are pointers :).  <code>As for the a = append(a,6)</code>  I understand what you are saying, but testing seems like the first append breaks the link between the pointers; so &#39;a&#39; only points to the first array before the first append, then there are not connected, am I right?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571826246, "post_id": 58520568, "comment_id": 103366775, "body": "&quot;Now I see they are pointers&quot; --- slices are not pointers though."}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571826331, "post_id": 58520568, "comment_id": 103366809, "body": "@zerkms <code>&quot;Now I see they are pointers&quot;</code> - where did you find it? I didn&#39;t say that slices are pointers. I have said: <code>Slice is a structure with three element, one of them is a pointer to array with data</code>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571826354, "post_id": 58520568, "comment_id": 103366819, "body": "@demas it&#39;s from the OP&#39;s comment right above mine comment. (which they now have heavily modified)"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571826396, "post_id": 58520568, "comment_id": 103366838, "body": "@zerkms, ohhh.... sorry. I see it now. Of course slice is not a pointer, but they contain a pointer to the data as part of its structure."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 9, "user_id": 4296172, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HMIrjjn-Y-E/AAAAAAAAAAI/AAAAAAAAAAA/lgfneVz-QTs/photo.jpg?sz=128", "display_name": "Algel Us", "link": "https://stackoverflow.com/users/4296172/algel-us"}, "edited": false, "score": 0, "creation_date": 1571826459, "post_id": 58520568, "comment_id": 103366872, "body": "@AlgelUs a new underlying array is allocated as long as the current one cannot hold the appended data."}, {"owner": {"reputation": 9, "user_id": 4296172, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HMIrjjn-Y-E/AAAAAAAAAAI/AAAAAAAAAAA/lgfneVz-QTs/photo.jpg?sz=128", "display_name": "Algel Us", "link": "https://stackoverflow.com/users/4296172/algel-us"}, "edited": false, "score": 0, "creation_date": 1571826568, "post_id": 58520568, "comment_id": 103366923, "body": "Ohh, thanks, I see now. Sorry for the changes of the response. It was adding the comment before finishing it"}], "tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": true, "score": 3, "last_activity_date": 1571826222, "last_edit_date": 1571826222, "creation_date": 1571825682, "answer_id": 58520568, "question_id": 58520499, "link": "https://stackoverflow.com/questions/58520499/can-someone-explain-this-behaviour-to-me/58520568#58520568", "title": "Can someone explain this behaviour to me?", "body": "<p>You use a slice. Slice is a structure with three element, one of them is a pointer to array with data (second - capacity, third - length).</p>\n\n<pre><code>s -&gt; array | 1 | 2 | 3 | \n</code></pre>\n\n<p>Next</p>\n\n<pre><code>a := s[0:2]\n</code></pre>\n\n<p>Now you have two slices, but both of them points to the same array and slices share their data.</p>\n\n<pre><code>s -&gt; array | 1 | 2 | 3 | &lt;- a\n</code></pre>\n\n<p>Next:</p>\n\n<pre><code>a = append(a, 5)\n</code></pre>\n\n<p>Here you have added element to the second slice, but this slice share the same array with first slice, so you have rewritten last last element of the first slice (and array).</p>\n\n<pre><code>s -&gt; array | 1 | 2 | 5 | &lt;- a\n</code></pre>\n\n<p>Next: </p>\n\n<pre><code>a = append(a, 6)\n</code></pre>\n\n<p>Here you have added another one element to the second slice. But the array which is used for this slice cannot contain more elements, so the array for the second slice was recreated. Go have created new array, copy all elements from the first array to it and use this new array for the second slice. First slice still use its own array.</p>\n\n<pre><code>s -&gt; array | 1 | 2 | 5 | \na -&gt; array | 1 | 2 | 5 | 6 |\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 4296172, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HMIrjjn-Y-E/AAAAAAAAAAI/AAAAAAAAAAA/lgfneVz-QTs/photo.jpg?sz=128", "display_name": "Algel Us", "link": "https://stackoverflow.com/users/4296172/algel-us"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 58520568, "answer_count": 1, "score": -2, "last_activity_date": 1571831267, "creation_date": 1571825457, "last_edit_date": 1571831267, "question_id": 58520499, "link": "https://stackoverflow.com/questions/58520499/can-someone-explain-this-behaviour-to-me", "title": "Can someone explain this behaviour to me?", "body": "<p>I was just trying some simple stuff with golang and got this behavior</p>\n\n<p>Can someone explain to me why? I feel I have a wrong understanding of it... </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := []int{1, 2, 3}\n    fmt.Println(s)\n    fmt.Println(\"----\")\n    a := s[0:2]\n    fmt.Println(s)\n    fmt.Println(a)\n    a = append(a, 5)\n    fmt.Println(\"----\")\n    fmt.Println(s)\n    fmt.Println(a)\n    a = append(a, 6)\n    fmt.Println(\"----\")\n    fmt.Println(s)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/sbqDBYWMECw\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>Response:</p>\n\n<pre><code>[1 2 3]\n----\n[1 2 3]\n[1 2]\n----\n[1 2 5]\n[1 2 5]\n----\n[1 2 5]\n[1 2 5 6]\n</code></pre>\n\n<p>I was expecting:</p>\n\n<pre><code>[1 2 3]\n----\n[1 2 3]\n[1 2]\n----\n[1 2 3]\n[1 2 5]\n----\n[1 2 3]\n[1 2 5 6]\n</code></pre>\n\n<p>Thanks in advance, :)</p>\n"}, {"tags": ["go", "stack-overflow", "cgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571836931, "post_id": 58520295, "comment_id": 103372725, "body": "This function cannot cause a stack overflow - not only is it not recursive, it doesn&#39;t even call any other function."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1571826317, "creation_date": 1571826317, "answer_id": 58520747, "question_id": 58520295, "link": "https://stackoverflow.com/questions/58520295/how-to-avoid-stack-overflow-in-golang/58520747#58520747", "title": "How to avoid stack overflow in golang?", "body": "<blockquote>\n  <p>Calling it e.g 80 000 times cause stack overflow. Is there any way to avoid it?</p>\n</blockquote>\n\n<p>Yes, e.g. call it just 10'000 times. Or do not use an recursive algorithm or transform the recursion to normal loop (tail call optimisation).</p>\n\n<p>P.S. Your code does not show any relevant details.</p>\n"}], "owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "closed_date": 1571840486, "answer_count": 1, "score": -5, "last_activity_date": 1571826317, "creation_date": 1571824861, "question_id": 58520295, "link": "https://stackoverflow.com/questions/58520295/how-to-avoid-stack-overflow-in-golang", "closed_reason": "Needs more focus", "title": "How to avoid stack overflow in golang?", "body": "<p>I have problem with calling function multiple times in go exported to dll. Calling it e.g 80 000 times cause stack overflow. Is there any way to avoid it? Can  i clear stack or heap after function call?</p>\n\n<pre><code>//export GetNum\nfunc GetNum(DeviceType uint32, DeviceInd uint32, CANInd uint32) int {\nreturn 0\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "thread-safety"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1571824642, "post_id": 58519059, "comment_id": 103365965, "body": "See <a href=\"https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39289246?r=SearchResults#39289246\">How to recover from concurrent map writes?</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1571825622, "post_id": 58519059, "comment_id": 103366468, "body": "Don&#39;t do it, even if it happens to work with the current compiler. The runtime is free to re-arrange maps in memory on any update, independent of whether a new key is inserted or an existing key updated, so what works today may break tomorrow. Maps are not safe for concurrent read-write access, period."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571836992, "post_id": 58519059, "comment_id": 103372761, "body": "&quot;can we just update it but not write new keys?&quot; No. Updating an existing key is still a write."}], "answers": [{"comments": [{"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 1, "creation_date": 1571824343, "post_id": 58519517, "comment_id": 103365807, "body": "OP uses closures incorrectly though. If you pass the index to the goroutine as a parameter, it does not crash: <a href=\"https://play.golang.org/p/2PKUlzAZFod\" rel=\"nofollow noreferrer\">play.golang.org/p/2PKUlzAZFod</a>"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 1, "creation_date": 1571825078, "post_id": 58519517, "comment_id": 103366196, "body": "But then, both ways described by OP work, so not sure if that proves anything: <a href=\"https://play.golang.org/p/6oPO8a5TOl5\" rel=\"nofollow noreferrer\">play.golang.org/p/6oPO8a5TOl5</a>"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 4, "last_activity_date": 1571822365, "creation_date": 1571822365, "answer_id": 58519517, "question_id": 58519059, "link": "https://stackoverflow.com/questions/58519059/can-i-update-golang-map-concurrently/58519517#58519517", "title": "Can I Update Golang map Concurrently?", "body": "<blockquote>\n  <p>Can we do that?</p>\n</blockquote>\n\n<p>No, of course not. It just produces a runtime error \"fatal error: concurrent map writes\" (with literally your code, so you could have tried it yourself).</p>\n\n<p>Just stop fighting the language and trying to be clever: <strong>No</strong> <strong>concurrent</strong> <strong>writes</strong> (not even \"clever\" ones)!</p>\n"}], "owner": {"reputation": 3, "user_id": 7452709, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_rPxaRQJp-g/AAAAAAAAAAI/AAAAAAAAABM/w_fQyAYgWxs/photo.jpg?sz=128", "display_name": "xiang eagle", "link": "https://stackoverflow.com/users/7452709/xiang-eagle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 58519517, "answer_count": 1, "score": -4, "last_activity_date": 1571822365, "creation_date": 1571820923, "question_id": 58519059, "link": "https://stackoverflow.com/questions/58519059/can-i-update-golang-map-concurrently", "title": "Can I Update Golang map Concurrently?", "body": "<p>Everyone is saying <strong>write/read golang map concurrently is not safe</strong>, but can we just update it but not write new keys?</p>\n\n<p>We know code below would cause <code>fatal error: concurrent map read and map write</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var m = make(map[int]int)\n\nfor i := 0; i &lt; 1000; i++ {\n    go func() {\n        m[i] = i\n    }()\n}\n</code></pre>\n\n<p>Now I'm wondering if we can update map concurrently as below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var m = make(map[int]int)\n\n// init memory structure of map\nfor i := 0; i &lt; 1000; i++ {\n    m[i] = 0\n}\n\n// just update values for old keys concurrently\nfor i := 0; i &lt; 1000; i++ {\n    go func() {\n        m[i] = i\n    }()\n}\n</code></pre>\n\n<p>Can we do that?</p>\n"}, {"tags": ["go", "visual-studio-code", "go-packages"], "answers": [{"comments": [{"owner": {"reputation": 954, "user_id": 2695796, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-B9ZcX7SBtSA/AAAAAAAAAAI/AAAAAAAAAAc/3ib3iBa1O_w/photo.jpg?sz=128", "display_name": "Jimi", "link": "https://stackoverflow.com/users/2695796/jimi"}, "edited": false, "score": 3, "creation_date": 1571901848, "post_id": 58524450, "comment_id": 103395014, "body": "Looks like updating has solved the issue. I did the go get command before, and the editor was open in the root project folder. I&#39;ll try to update the go tools more frequently i guess :P"}, {"owner": {"reputation": 1719, "user_id": 4130114, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YxSDJ.jpg?s=128&g=1", "display_name": "Hom Bahrani", "link": "https://stackoverflow.com/users/4130114/hom-bahrani"}, "edited": false, "score": 3, "creation_date": 1604914177, "post_id": 58524450, "comment_id": 114482061, "body": "this issue has been bugging me for over a year, I&#39;ve tried everything and your second point about opening the editor in root was the solution I least expected to work, but it did - many thanks"}, {"owner": {"reputation": 97, "user_id": 13089133, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-j86-GiV_RhQ/AAAAAAAAAAI/AAAAAAAAAAA/AKF05nALMQjwjaGD27FWum2crp15asC66Q/photo.jpg?sz=128", "display_name": "Saurabh Arora", "link": "https://stackoverflow.com/users/13089133/saurabh-arora"}, "edited": false, "score": 1, "creation_date": 1612262594, "post_id": 58524450, "comment_id": 116705776, "body": "second part of opening the editor one folder above did the trick for me as well"}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": true, "score": 51, "last_activity_date": 1587396696, "last_edit_date": 1587396696, "creation_date": 1571838720, "answer_id": 58524450, "question_id": 58518588, "link": "https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package/58524450#58524450", "title": "VSCode: Could not import Golang package", "body": "<p>This happens to me in a few specific situations. This is my troubleshooting process :</p>\n\n<ol>\n<li><p>Did you run <code>go get github.com/gomodule/redigo/redis</code>? </p></li>\n<li><p>Sometimes I have a similar issue when I open my editor in a root different than my project. </p></li>\n</ol>\n\n<pre><code>.  &lt;- editor open here\n| \n|_Folder\n  | main.go\n</code></pre>\n\n<ol start=\"3\">\n<li><p>Make sure your tools are up to date: run <code>ctrl</code> + <code>shift</code> + <code>p</code>, type <code>Go</code> and chose <code>Install/Update tools</code>.</p></li>\n<li><p>Try moving your project out of the GOPATH, and setting up go.mod for it.</p></li>\n<li><p>Restart the editor</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 3775212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dedf0ddaa96ff5e0fe5c400608508036?s=128&d=identicon&r=PG&f=1", "display_name": "zhushihao", "link": "https://stackoverflow.com/users/3775212/zhushihao"}, "is_accepted": false, "score": 5, "last_activity_date": 1595399499, "creation_date": 1595399499, "answer_id": 63028234, "question_id": 58518588, "link": "https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package/63028234#63028234", "title": "VSCode: Could not import Golang package", "body": "<p>I encountered a similar problem, but the situation is slightly different.\nI encountered this problem in VSCode remote, and even the basic library like <code>net/http</code> cannot be imported.\nI found that it was because of some syntax errors in other files under the same package, such as <code>undefined variables</code>.\nWhen I solved these syntax errors and restarted VSCode, I found that the problem was solved.</p>\n"}, {"tags": [], "owner": {"reputation": 2679, "user_id": 3081480, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UVerL.jpg?s=128&g=1", "display_name": "Kyle Chadha", "link": "https://stackoverflow.com/users/3081480/kyle-chadha"}, "is_accepted": false, "score": 2, "last_activity_date": 1601930256, "creation_date": 1601930256, "answer_id": 64215858, "question_id": 58518588, "link": "https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package/64215858#64215858", "title": "VSCode: Could not import Golang package", "body": "<p>I ran into this issue when I had two files in one package that had different package names. Eg: one file had <code>package main</code> while the other had <code>package app</code>.</p>\n<p>Ensuring all files have the same package name will result in imports across the package to start working again.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 13816119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bab810fb5a9f2445d97be7ed3088f?s=128&d=identicon&r=PG", "display_name": "Krishan Thisera", "link": "https://stackoverflow.com/users/13816119/krishan-thisera"}, "is_accepted": false, "score": 5, "last_activity_date": 1605829210, "creation_date": 1605829210, "answer_id": 64921674, "question_id": 58518588, "link": "https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package/64921674#64921674", "title": "VSCode: Could not import Golang package", "body": "<p>I had a same sort of issue with a different package (on mac),</p>\n<ol>\n<li>Update the go tools -\n<code>ctrl</code> + <code>shift</code> + <code>p</code> or <code>cmd</code> + <code>shift</code> + <code>p</code> and update/install go tools</li>\n<li>Restart VScode</li>\n</ol>\n<p>Issue solved</p>\n"}], "owner": {"reputation": 954, "user_id": 2695796, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-B9ZcX7SBtSA/AAAAAAAAAAI/AAAAAAAAAAc/3ib3iBa1O_w/photo.jpg?sz=128", "display_name": "Jimi", "link": "https://stackoverflow.com/users/2695796/jimi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34032, "favorite_count": 7, "accepted_answer_id": 58524450, "answer_count": 4, "score": 23, "last_activity_date": 1605829210, "creation_date": 1571819144, "last_edit_date": 1596759749, "question_id": 58518588, "link": "https://stackoverflow.com/questions/58518588/vscode-could-not-import-golang-package", "title": "VSCode: Could not import Golang package", "body": "<p>I'm writing a Go project inside my GoPath, and i'm using the Redigo package for connecting to a Redis Server. The application runs fine, however in VSCode there is this annoying error on package import, which is preventing VSCode from giving intellisense suggestions</p>\n<blockquote>\n<p>Could not import github.com/gomodule/redigo/redis (no package data for import path github.com/gomodule/redigo/redis)</p>\n</blockquote>\n<p>This is my VSCode settings.json</p>\n<pre><code>{\n    &quot;editor.fontSize&quot;: 14,\n    &quot;editor.formatOnPaste&quot;: true,\n    &quot;editor.multiCursorModifier&quot;: &quot;ctrlCmd&quot;,\n    &quot;editor.snippetSuggestions&quot;: &quot;top&quot;,\n    &quot;extensions.ignoreRecommendations&quot;: false,\n    &quot;workbench.statusBar.visible&quot;: true,\n    &quot;workbench.iconTheme&quot;: &quot;vscode-great-icons&quot;,\n    &quot;files.autoSave&quot;: &quot;afterDelay&quot;,\n    &quot;go.useLanguageServer&quot;: true,\n    &quot;go.alternateTools&quot;: {\n        &quot;go-langserver&quot;: &quot;bingo&quot;\n    },\n    &quot;go.toolsEnvVars&quot;: {\n        &quot;GO111MODULE&quot;: &quot;on&quot;\n    },\n    &quot;go.languageServerExperimentalFeatures&quot;: {\n        &quot;autoComplete&quot;: true,\n        &quot;documentSymbols&quot;: true,\n        &quot;findReferences&quot;: true,\n        &quot;format&quot;: true,\n        &quot;goToDefinition&quot;: true,\n        &quot;goToTypeDefinition&quot;: true,\n        &quot;hover&quot;: true,\n        &quot;signatureHelp&quot;: true,\n        &quot;rename&quot;: true,\n        &quot;workspaceSymbols&quot;: true,\n    },\n    &quot;go.lintTool&quot;: &quot;golangci-lint&quot;,\n    &quot;go.lintFlags&quot;: [\n        &quot;--fast&quot;,\n        &quot;-E&quot;, &quot;goimports&quot;,\n        &quot;-E&quot;, &quot;gocritic&quot;,\n        &quot;-E&quot;, &quot;gocyclo&quot;,\n        &quot;-E&quot;, &quot;gosec&quot;,\n        &quot;-E&quot;, &quot;maligned&quot;,\n        &quot;-E&quot;, &quot;scopelint&quot;,\n        &quot;-E&quot;, &quot;interfacer&quot;,\n        &quot;-E&quot;, &quot;goconst&quot;,\n        &quot;-E&quot;, &quot;unconvert&quot;,\n        &quot;-E&quot;, &quot;unparam&quot;,\n        &quot;-E&quot;, &quot;prealloc&quot;,\n        &quot;-E&quot;, &quot;varcheck&quot;,\n    ],\n    &quot;go.formatTool&quot;: &quot;goimports&quot;,\n    &quot;editor.minimap.enabled&quot;: false,\n    &quot;breadcrumbs.enabled&quot;: false,\n    &quot;git.autofetch&quot;: true,\n    &quot;workbench.startupEditor&quot;: &quot;newUntitledFile&quot;,\n    &quot;explorer.confirmDelete&quot;: false,\n    &quot;git.enableSmartCommit&quot;: true,\n    &quot;git.confirmSync&quot;: false,\n    &quot;window.zoomLevel&quot;: 0,\n    &quot;explorer.confirmDragAndDrop&quot;: false\n}\n</code></pre>\n<p>I already have the GO111MODULE env var set to on, this is the output of <code>go env</code></p>\n<pre><code>set GOARCH=amd64\nset GOBIN=C:\\Users\\Francesco\\Go\\bin\nset GOCACHE=C:\\Users\\Francesco\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\Francesco\\Go\nset GOPROXY=\nset GORACE=\nset GOROOT=c:\\go\nset GOTMPDIR=\nset GOTOOLDIR=c:\\go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=C:\\Users\\Francesco\\Go\\src\\test\\go.mod\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\FRANCE~1\\AppData\\Local\\Temp\\go-build928398422=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n<p>What should I change to make this work?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "acl"], "comments": [{"owner": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571820192, "post_id": 58518260, "comment_id": 103363588, "body": "take a look <a href=\"https://stackoverflow.com/a/58504030/9931092\">stackoverflow.com/a/58504030/9931092</a>"}, {"owner": {"reputation": 3961, "user_id": 2337243, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eccc4abd3234bfab082413d35cae7b4d?s=128&d=identicon&r=PG&f=1", "display_name": "Souad", "link": "https://stackoverflow.com/users/2337243/souad"}, "reply_to_user": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571820678, "post_id": 58518260, "comment_id": 103363813, "body": "Yes  I have used the python script mentioned in there but it is not very efficient"}, {"owner": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571820706, "post_id": 58518260, "comment_id": 103363832, "body": "this is not python its aws cli."}, {"owner": {"reputation": 3961, "user_id": 2337243, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eccc4abd3234bfab082413d35cae7b4d?s=128&d=identicon&r=PG&f=1", "display_name": "Souad", "link": "https://stackoverflow.com/users/2337243/souad"}, "reply_to_user": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571820907, "post_id": 58518260, "comment_id": 103363931, "body": "the awscli command is for one single file only. I have thousands of files"}, {"owner": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571821002, "post_id": 58518260, "comment_id": 103363985, "body": "in my answer, I point to other thread which explains how to use other aws CLI commands in order to run the ACL command recursively."}, {"owner": {"reputation": 3961, "user_id": 2337243, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eccc4abd3234bfab082413d35cae7b4d?s=128&d=identicon&r=PG&f=1", "display_name": "Souad", "link": "https://stackoverflow.com/users/2337243/souad"}, "reply_to_user": {"reputation": 4725, "user_id": 9931092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dDivw.jpg?s=128&g=1", "display_name": "Amit Baranes", "link": "https://stackoverflow.com/users/9931092/amit-baranes"}, "edited": false, "score": 0, "creation_date": 1571821406, "post_id": 58518260, "comment_id": 103364196, "body": "yeah the problem of using aws cp is that it copies a new version of the file it doesn&#39;t just change the object acl"}, {"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 0, "creation_date": 1571889205, "post_id": 58518260, "comment_id": 103390843, "body": "@Souad It is not possible to change the ACL on an object. However, if the object is copied to itself, the ACL can be changed during the copy. This an be done as a <a href=\"https://stackoverflow.com/a/46577516/174777\">bulk update</a>."}], "owner": {"reputation": 3961, "user_id": 2337243, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eccc4abd3234bfab082413d35cae7b4d?s=128&d=identicon&r=PG&f=1", "display_name": "Souad", "link": "https://stackoverflow.com/users/2337243/souad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571889148, "creation_date": 1571817920, "last_edit_date": 1571889148, "question_id": 58518260, "link": "https://stackoverflow.com/questions/58518260/fix-acl-of-all-objects-in-one-s3-bucket", "title": "Fix ACL of all objects in one S3 bucket", "body": "<p>I have 15,000 files in S3 and they have wrong ACL permissions. The owner of the objects is an external AWS account. I'm looking for a way to change this as quickly as possible. I ran <a href=\"https://github.com/antoligy/s3-recursive-acl\" rel=\"nofollow noreferrer\">antoligy/s3-recursive-acl: A tool for bulk-updating ACL in Amazon S3</a> but when I run it I get this:</p>\n\n<blockquote>\n  <p>s3-recursive-acl.go: command not found </p>\n</blockquote>\n\n<p>When I use sudo:</p>\n\n<blockquote>\n  <p>sudo: ./s3-recursive-acl.go: command not found</p>\n</blockquote>\n\n<p>when I do install <code>go</code>:</p>\n\n<pre><code>go install s3-recursive-acl.go\ns3-recursive-acl.go:9:2: cannot find package \"github.com/aws/aws-sdk-go/aws\" in any of:\n        /usr/local/go/src/github.com/aws/aws-sdk-go/aws (from $GOROOT)\n        /home/souad/go/src/github.com/aws/aws-sdk-go/aws (from $GOPATH)\ns3-recursive-acl.go:10:2: cannot find package \"github.com/aws/aws-sdk-go/aws/session\" in any of:\n        /usr/local/go/src/github.com/aws/aws-sdk-go/aws/session (from $GOROOT)\n        /home/souad/go/src/github.com/aws/aws-sdk-go/aws/session (from $GOPATH)\ns3-recursive-acl.go:11:2: cannot find package \"github.com/aws/aws-sdk-go/service/s3\" in any of:\n        /usr/local/go/src/github.com/aws/aws-sdk-go/service/s3 (from $GOROOT)\n        /home/souad/go/src/github.com/aws/aws-sdk-go/service/s3 (from $GOPATH)\n</code></pre>\n\n<p>Please any ideas because I've pretty much tried everything.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1571810730, "post_id": 58516240, "comment_id": 103359125, "body": "Your function should return a new slice"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1571811090, "post_id": 58516240, "comment_id": 103359252, "body": "See <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a> (and <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 1, "creation_date": 1571810773, "post_id": 58516383, "comment_id": 103359140, "body": "<code>The slice is passed by value</code> is not correct. Slices are passed by reference. It&#39;s just that <code>b[:len(b)-1]</code> creates a new slice,"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 2, "creation_date": 1571810829, "post_id": 58516383, "comment_id": 103359159, "body": "@AyushGupta there&#39;s no &quot;pass by reference&quot; in Go."}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571810887, "post_id": 58516383, "comment_id": 103359181, "body": "@mkopriva not exactly. I have found that all data structures built using <code>make</code> are kind-of passed by reference. Playground example: <a href=\"https://play.golang.org/p/r5tqggXYZdV\" rel=\"nofollow noreferrer\">play.golang.org/p/r5tqggXYZdV</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 3, "creation_date": 1571810937, "post_id": 58516383, "comment_id": 103359197, "body": "@AyushGupta there is no such thing as &quot;pass by reference&quot; in Go <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">golang.org/ref/spec</a> Your example passes slice header <b>by value</b>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 3, "creation_date": 1571810981, "post_id": 58516383, "comment_id": 103359210, "body": "@AyushGupta What is passed by value here is the slice header, so the function gets a copy of the header, that&#39;s why changing a copy of the header, like its length for example, isn&#39;t reflected outside of the function."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 3, "creation_date": 1571810986, "post_id": 58516383, "comment_id": 103359216, "body": "@AyushGupta you are wrong; mkopriva is right. You <i>must</i> understand that nothing on Go is ever &quot;passed by reference&quot;. Some types have reference like <i>semantics</i> but still are passed by value."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1571811060, "post_id": 58516383, "comment_id": 103359244, "body": "@AyushGupta In your example, you modify the array (using the slice), which is why the change is reflected in your main function."}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571811089, "post_id": 58516383, "comment_id": 103359251, "body": "@Volker Well, I learnt something today, thanks! I&#39;ll read up on this. (Also meant to tag zerkms and mkopriva but SO won&#39;t allow that)"}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 2, "last_activity_date": 1571811780, "last_edit_date": 1571811780, "creation_date": 1571810610, "answer_id": 58516383, "question_id": 58516240, "link": "https://stackoverflow.com/questions/58516240/change-golang-slice-in-another-function/58516383#58516383", "title": "Change golang slice in another function", "body": "<p>The slice is passed by value, so changing it in your function <code>f</code> won't change it in function <code>main</code>. You can pass by pointer, like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := []int{1, 2, 3, 4}\n    i := 0\n\n    f(&amp;a, i)\n    fmt.Println(a)    //outputs: [2 3 4], correct\n}\n\nfunc f(a *[]int, i int) {\n    b := *a\n    copy(b[i:], b[i+1:])\n    // The following line seems pointless, but ok...\n    b[len(b)-1] = 0\n    b = b[:len(b)-1]\n    fmt.Println(b)    //outputs: [2 3 4], here still correct\n    *a = b\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YOQoT1QObhe\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>As suggested by @zerkms in the comments, you could also return the new slice, avoiding the use of pointers:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := []int{1, 2, 3, 4}\n    i := 0\n\n    a = f(a, i)\n    fmt.Println(a)\n}\n\nfunc f(a []int, i int) []int {\n    copy(a[i:], a[i+1:])\n    // The following line seems pointless, but ok...\n    a[len(a)-1] = 0\n    a = a[:len(a)-1]\n    fmt.Println(a)     //outputs: [2 3 4], here still correct\n    return a\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 7926288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KX66y.jpg?s=128&g=1", "display_name": "Guobin", "link": "https://stackoverflow.com/users/7926288/guobin"}, "edited": false, "score": 0, "creation_date": 1571970218, "post_id": 58518850, "comment_id": 103423354, "body": "Thanks for not providing new solution. I know the copy will finally output [2,3,4,4], so I did <code>a = a[:len(a)-1]</code> to shorten the length of slice. I think the key point is not about the copy method. I agree they are passed by value, as i&#39;m new to golang so I don&#39;t know how it works in low level"}], "tags": [], "owner": {"reputation": 55, "user_id": 6260556, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sLEO7i4_14g/AAAAAAAAAAI/AAAAAAAAEVU/hbKIZlpWD_M/photo.jpg?sz=128", "display_name": "Nitish Yadav", "link": "https://stackoverflow.com/users/6260556/nitish-yadav"}, "is_accepted": false, "score": 0, "last_activity_date": 1571820180, "creation_date": 1571820180, "answer_id": 58518850, "question_id": 58516240, "link": "https://stackoverflow.com/questions/58516240/change-golang-slice-in-another-function/58518850#58518850", "title": "Change golang slice in another function", "body": "<p>Not providing new solution, just trying to explain why your program is behaving the way you asked:</p>\n\n<p>Let us try to understand first how the built in function \u2018copy\u2019 works\u2028\u2028Ref: [<a href=\"https://golang.org/pkg/builtin/#copy]\" rel=\"nofollow noreferrer\">https://golang.org/pkg/builtin/#copy]</a></p>\n\n<pre><code>func copy(dst, src []Type) int\n</code></pre>\n\n<p>The copy built-in function copies elements from a source slice into a destination slice. (As a special case, it also will copy bytes from a string to a slice of bytes.) The source and destination may overlap. Copy returns the number of elements copied, which will be the minimum of len(src) and len(dst).</p>\n\n<p>Two things:\n 1. \u2028First comment the line : //a[len(a)-1] = 0\u2028</p>\n\n<ol start=\"2\">\n<li>Second: As you are using the same array i.e as source and destination you are getting [2,3,4,4] as output as the destination array is {1,2,3,4} which got overwritten to {2,3,4,4(which is already present)}\u2028\u2028you can try with different array\u2019s to make it more clear to you</li>\n</ol>\n"}], "owner": {"reputation": 29, "user_id": 7926288, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KX66y.jpg?s=128&g=1", "display_name": "Guobin", "link": "https://stackoverflow.com/users/7926288/guobin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 628, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1571821326, "creation_date": 1571809800, "last_edit_date": 1571821326, "question_id": 58516240, "link": "https://stackoverflow.com/questions/58516240/change-golang-slice-in-another-function", "title": "Change golang slice in another function", "body": "<p>I have a slice, if i remove one element from it directly in a main function the length of slice would be cut by one. But do the remove in another function and called it in main, the length of the slice is still keep origin. Who can explain it for me? Thanks!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := []int{1, 2, 3, 4}\n    i := 0\n\n    //copy(a[i:], a[i+1:])\n    //a[len(a)-1] = 0\n    //a = a[:len(a)-1]\n    //fmt.Println(a)    //outputs: [2 3 4], this is correct\n\n    f(a, i)\n    fmt.Println(a) //outputs: [2 3 4 0], this is wrong!\n}\n\nfunc f(a []int, i int) {\n    copy(a[i:], a[i+1:])\n    a[len(a)-1] = 0\n    a = a[:len(a)-1]\n    fmt.Println(a) //outputs: [2 3 4], here still correct\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/okTAe8k6b_0\" rel=\"nofollow noreferrer\">Go Playground Link</a></p>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1571807138, "creation_date": 1571807138, "answer_id": 58515810, "question_id": 58515773, "link": "https://stackoverflow.com/questions/58515773/redigo-how-can-i-get-a-key-value-map-from-redis-using-golang/58515810#58515810", "title": "Redigo: How can I get a key-value map from Redis using Golang?", "body": "<p>MGET preserves the order. So if you send in a list of keys, you should expect the results in the same order, with missing keys containing nil.</p>\n"}], "owner": {"reputation": 13, "user_id": 1177534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd1206cf8cced4cde9d7cfc9ba2256a?s=128&d=identicon&r=PG", "display_name": "ef0ntan", "link": "https://stackoverflow.com/users/1177534/ef0ntan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571807138, "creation_date": 1571806927, "question_id": 58515773, "link": "https://stackoverflow.com/questions/58515773/redigo-how-can-i-get-a-key-value-map-from-redis-using-golang", "title": "Redigo: How can I get a key-value map from Redis using Golang?", "body": "<p>Let's say I have this set of keys in my Redis:</p>\n\n<pre><code>KEY           VALUE\n\"agent_100\"   \"{name: Agent1, status:online}\"\n\"agent_200\"   \"{name: Agent2, status:offline}\"\n\"agent_300\"   \"{name: Agent3, status:online}\"\n\"agent_400\"   \"{name: Agent4, status:offline}\"\n</code></pre>\n\n<p>I need to return a map with all those keys and values in Golang using Redigo. The output would be something like a <code>map[uint64]string</code> with this key-values:</p>\n\n<pre><code>100 -&gt; \"{name: Agent1, status:online}\"\n200 -&gt; \"{name: Agent2, status:offline}\"\n300 -&gt; \"{name: Agent3, status:online}\"\n400 -&gt; \"{name: Agent4, status:offline}\"\n</code></pre>\n\n<p>If I do a <code>Scan</code> I can get all the keys matching a pattern like <code>agent_*</code> and maybe then I can do a <code>MGET</code> with all those keys to get the values, but how I can link those keys and values in a simple way?</p>\n\n<p>There's no a library function to get not only the keys that match a pattern but also the values so I can return a map with that?</p>\n\n<p>I'm using <a href=\"https://github.com/gomodule/redigo\" rel=\"nofollow noreferrer\">redigo</a> now but I was also looking into <code>go-redis</code> to see if there is a simpler way to achieve this, I'm open to consider other options.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 170, "user_id": 8177592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EipfI.png?s=128&g=1", "display_name": "Lukas Herman", "link": "https://stackoverflow.com/users/8177592/lukas-herman"}, "edited": false, "score": 0, "creation_date": 1571808011, "post_id": 58515143, "comment_id": 103358293, "body": "I guess you&#39;re referring to this one right, <a href=\"https://godoc.org/golang.org/x/xerrors#Formatter\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/xerrors#Formatter</a>? If this is the case, what&#39;s your current approach rather than doing it in a hacky way, striping the unwrapped error string from the original. Should I just use xerrors then?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 170, "user_id": 8177592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EipfI.png?s=128&g=1", "display_name": "Lukas Herman", "link": "https://stackoverflow.com/users/8177592/lukas-herman"}, "edited": false, "score": 0, "creation_date": 1571809891, "post_id": 58515143, "comment_id": 103358810, "body": "@LukasHerman I do not have any approach as we do not see the need for a fancy custom formatting of our errors: We decorate them where needed only and they read fine."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1571802147, "creation_date": 1571802147, "answer_id": 58515143, "question_id": 58514964, "link": "https://stackoverflow.com/questions/58514964/how-to-create-a-custom-formatter-with-go-1-13-error/58515143#58515143", "title": "How to create a custom formatter with go 1.13 error?", "body": "<blockquote>\n  <p>[T]here seems to be no way to create a custom formatter</p>\n</blockquote>\n\n<p>Exactly. That part of the original proposal did not make it into Go 1.13.\nSo you cannot do what you would like to do, at least not in an easy way.\nYou could try and strip of the unwrapped error string from the original\nbut this relies on string manipulation.</p>\n"}], "owner": {"reputation": 170, "user_id": 8177592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EipfI.png?s=128&g=1", "display_name": "Lukas Herman", "link": "https://stackoverflow.com/users/8177592/lukas-herman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571802147, "creation_date": 1571800664, "question_id": 58514964, "link": "https://stackoverflow.com/questions/58514964/how-to-create-a-custom-formatter-with-go-1-13-error", "title": "How to create a custom formatter with go 1.13 error?", "body": "<p>With go 1.13, we can now wrap our error this way, <code>fmt.Errorf(\"... %w ...\", ..., err, ...)</code> (<a href=\"https://golang.org/pkg/errors\" rel=\"nofollow noreferrer\">https://golang.org/pkg/errors</a>). </p>\n\n<p>While this is great, there seems to be no way to create a custom formatter. Let say I want to have different spaces depending on the depth of the error, I'll get all of the errors in the tree if I just get the string representation of the error, <code>err.Error()</code>.</p>\n\n<p>Please see below for an example.</p>\n\n<p>I've tried using <code>fmt.Sprintf</code> with <code>%s</code> and <code>%v</code> verbs, get the string representation from <code>Error()</code>, and <code>fmt.Sprint</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// sprintError prints err in top-down order\nfunc sprintError(err error) string {\n    var stack []string\n    level := 0\n    spacesPerLevel := 2\n\n    for err != nil {\n        space := strings.Repeat(\" \", level*spacesPerLevel)\n        msg := fmt.Sprintf(\"%s%s\", space, err)\n        stack = append(stack, msg)\n        err = errors.Unwrap(err)\n        level++\n    }\n\n    msg := strings.Join(stack, \"\\n\")\n    return msg\n}\n\n</code></pre>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>err := fmt.Errorf(\"level 1\")\nerr = fmt.Errorf(\"level 2: %w\", err)\nfmt.Print(sprintError(err))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>level 2: level 1\n  level 1\n</code></pre>\n\n<p>Expected:</p>\n\n<pre><code>level 2:\n  level 1\n</code></pre>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1571801715, "post_id": 58514776, "comment_id": 103356996, "body": "Consider the scenario where the context times out before the command completes.  ExecCommand can execute the deferred call to close the channel before the Run goroutine sends to the channel. Consider using <a href=\"https://godoc.org/os/exec#CommandContext\" rel=\"nofollow noreferrer\">exec.CommandContext</a>."}, {"owner": {"reputation": 13, "user_id": 9482854, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lonenso", "link": "https://stackoverflow.com/users/9482854/lonenso"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571912759, "post_id": 58514776, "comment_id": 103400527, "body": "@CeriseLim&#243;n thanks, I knew that, I chose to cancel process because the issue <a href=\"https://github.com/golang/go/issues/23019\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/23019</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571927874, "post_id": 58514776, "comment_id": 103408815, "body": "Because <code>close(waitDone)</code> is called after any goroutine receives on the channel, the call is not needed. To prevent the goroutine from hanging after context completion, the application should close the channel after <code>err = cmd.Run()</code> returns or create the channel with capacity 1."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9482854, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lonenso", "link": "https://stackoverflow.com/users/9482854/lonenso"}, "edited": false, "score": 0, "creation_date": 1571912892, "post_id": 58515111, "comment_id": 103400620, "body": "add comment, please check. And I still have question, imho, i use select cases, It should be block right?"}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 3, "last_activity_date": 1571803251, "last_edit_date": 1571803251, "creation_date": 1571801882, "answer_id": 58515111, "question_id": 58514776, "link": "https://stackoverflow.com/questions/58514776/different-call-using-the-same-channel/58515111#58515111", "title": "different call using the same channel", "body": "<p>You are closing the channel when your <code>ExecCommand</code> function exits.\nSince you are sending a message in a goroutine, there is no guarantee it will be sent before the function exits. In fact, all times I ran, it happened after.\nYour test will work fine without the first deferable.</p>\n\n<pre><code>    defer func() {\n        log.Printf(\"waitDone addr:%v\\n\", &amp;waitDone)\n        log.Printf(\"close waitdone channel\\n\")\n        close(waitDone) // &lt;- here \n    }()\n\n    go func() {\n        err = cmd.Run()\n        log.Printf(\"waitDone addr:%v\\n\", &amp;waitDone)\n        waitDone &lt;- struct{}{}  // &lt;- and here\n    }()\n\n</code></pre>\n\n<p>Update: \n@Cerise-Lim\u00f3n pointed out you could use the context in the <code>cmd</code> call. \nSince you are already using a timeout context, this will fit perfeclty</p>\n\n<pre><code>cmd = exec.CommandContext(ctx, \"bash\", \"-c\", \"--\", command)\n// cmd = exec.Command(\"bash\", \"-c\", \"--\", command)\n</code></pre>\n\n<p>This could save you from using this complicated logic to check for a timeout.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 9482854, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lonenso", "link": "https://stackoverflow.com/users/9482854/lonenso"}, "edited": false, "score": 0, "creation_date": 1571968634, "post_id": 58545162, "comment_id": 103423087, "body": "edit, please check, I want to know why write waitDone here, It seems <code>waitDone </code> useless."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 13, "user_id": 9482854, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lonenso", "link": "https://stackoverflow.com/users/9482854/lonenso"}, "edited": false, "score": 0, "creation_date": 1571969267, "post_id": 58545162, "comment_id": 103423183, "body": "See the edit to the answer. The waitDone channel is not needed because the context is guaranteed to complete within the scope of the function. If the timeout is specified through a context argument (as it should be), then waitDone is needed to ensure that the goroutine exits."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1571969025, "last_edit_date": 1571969025, "creation_date": 1571933050, "answer_id": 58545162, "question_id": 58514776, "link": "https://stackoverflow.com/questions/58514776/different-call-using-the-same-channel/58545162#58545162", "title": "different call using the same channel", "body": "<p>Consider using <a href=\"https://godoc.org/os/exec#CommandContext\" rel=\"nofollow noreferrer\">exec.CommandContext</a> instead of writing this code on your own.</p>\n\n<p>In the scenario where the context times out before the command completes, the <code>ExecCommand</code> function can close the channel before the Run goroutine sends to the channel. This causes the panic.</p>\n\n<p>Because the application does not receive on <code>waitDone</code> after <code>close(waitDone)</code> is executed, there's no point in closing the channel. </p>\n\n<p>Another issue is exposed if the code to close the channel is removed. Because <code>waitDone</code> is an unbuffered channel, the Run goroutine will block forever on send to <code>waitDone</code> in the timeout scenario.</p>\n\n<p>The call to <code>cmd.Run()</code> starts a goroutine to copy data to <code>stdout</code> and <code>stderr</code>. There's no guarantee that these goroutines are done executing before <code>ExecCommand</code> calls <code>convertStr(stdout)</code> or <code>convertStr(stderr)</code>.</p>\n\n<p>Here's one fix for all of this:</p>\n\n<pre><code>func ExecCommand(command string, timeout time.Duration) (string, error) {\n    log.Printf(\"command:%v, timeout:%v\", command, timeout)\n    ctx, cancelFn := context.WithTimeout(context.Background(), timeout)\n    defer cancelFn()\n\n    var stdout, stderr bytes.Buffer\n\n    cmd := exec.Command(\"bash\", \"-c\", \"--\", command)\n    cmd.Stdout = &amp;stdout\n    cmd.Stderr = &amp;stderr\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{Setpgid: true}\n\n    err := cmd.Start()\n    if err != nil {\n        return \"\", err\n    }\n\n    go func() {\n        &lt;-ctx.Done()\n        if ctx.Err() == context.DeadlineExceeded {\n            log.Printf(\"timeout to kill process, %v\", cmd.Process.Pid)\n            syscall.Kill(-cmd.Process.Pid, syscall.SIGKILL)\n        }\n    }()\n\n    err = cmd.Wait()\n    var result string\n    if err != nil {\n        result = stderr.String()\n    } else {\n        result = stdout.String()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9482854, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lonenso", "link": "https://stackoverflow.com/users/9482854/lonenso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "accepted_answer_id": 58545162, "answer_count": 2, "score": 0, "last_activity_date": 1571969025, "creation_date": 1571799051, "last_edit_date": 1571968328, "question_id": 58514776, "link": "https://stackoverflow.com/questions/58514776/different-call-using-the-same-channel", "title": "different call using the same channel", "body": "\n\n<h3>What version of Go are you using (<code>go version</code>)?</h3>\n\n<pre>\n$ go version 1.13.1\n\n</pre>\n\n<h3>Does this issue reproduce with the latest release?</h3>\n\n<p>I'm not sure.</p>\n\n<h3>What operating system and processor architecture are you using (<code>go env</code>)?</h3>\n\n<pre><code>$ go env\nGO111MODULE=\"auto\"\nGOARCH=\"amd64\"\nGOBIN=\"/usr/local/go/bin\"\nGOCACHE=\"/data/xieyixin/.cache/go-build\"\nGOENV=\"/data/xieyixin/.config/go/env\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGONOPROXY=\"\"\nGONOSUMDB=\"\"\nGOOS=\"linux\"\nGOPATH=\"/data/xieyixin/go\"\nGOPRIVATE=\"\"\nGOPROXY=\"http://10.0.12.201:8989/\"\nGOROOT=\"/usr/local/go\"\nGOSUMDB=\"sum.golang.org\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nAR=\"ar\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/data/xieyixin/hxagent/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build474907248=/tmp/go-build\"\n</code></pre>\n\n<h3>What did you do?</h3>\n\n<p><strong>I write a function to do exec command, and control timeout cases on my own.</strong>\n<strong>And I test it like this</strong></p>\n\n<pre><code>package utils\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"log\"\n    \"os/exec\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc ExecCommand(command string, timeout time.Duration) (string, error) {\n    log.Printf(\"command:%v, timeout:%v\", command, timeout)\n    var (\n        cmd    *exec.Cmd\n        stdout bytes.Buffer\n        stderr bytes.Buffer\n        result string\n        err    error\n        //timeouterr error\n    )\n    ctx, cancelFn := context.WithTimeout(context.Background(), timeout)\n    defer cancelFn()\n\n    cmd = exec.Command(\"bash\", \"-c\", \"--\", command)\n    cmd.Stdout = &amp;stdout\n    cmd.Stderr = &amp;stderr\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{Setpgid: true}\n\n    var waitDone = make(chan struct{})\n    defer func() {\n        log.Printf(\"waitDone addr:%v\\n\", &amp;waitDone)\n        log.Printf(\"close waitdone channel\\n\")\n        close(waitDone)\n    }()\n    go func() {\n        err = cmd.Run()\n        log.Printf(\"waitDone addr:%v\\n\", &amp;waitDone)\n        waitDone &lt;- struct{}{}\n    }()\n\n    select {\n    case &lt;-ctx.Done():\n        log.Printf(\"timeout to kill process, %v\", cmd.Process.Pid)\n        syscall.Kill(-cmd.Process.Pid, syscall.SIGKILL)\n        result = convertStr(stdout)\n        err = ctx.Err()\n    case &lt;-waitDone:\n        if err != nil {\n            result = convertStr(stderr)\n        } else {\n            result = convertStr(stdout)\n        }\n    }\n\n    log.Printf(\"result:%v,err:%v\", result, err)\n\n    return result, err\n}\n\nfunc convertStr(buffer bytes.Buffer) string {\n    data := buffer.String()\n    return data\n}\n</code></pre>\n\n<pre><code>package utils\n\nimport (\n    \"context\"\n    \"testing\"\n    \"time\"\n)\n\nfunc TestExecCommand(t *testing.T) {\n    tests := []struct {\n        command string\n        timeout time.Duration\n        wantErr string\n        want    string\n    }{\n        {\n            command: \"sleep 10\",\n            timeout: time.Second * 5,\n            wantErr: context.DeadlineExceeded.Error(),\n        },\n        {\n            command: \"watch -n 1 date +%s\",\n            timeout: time.Second * 10,\n            wantErr: context.DeadlineExceeded.Error(),\n            want:    \"timeout, but still have result.\",\n        },\n        {\n            command: \"hostname\",\n            timeout: time.Second * 5,\n            wantErr: \"\",\n            want:    \"anything result would be fine.\",\n        },\n    }\n\n    for _, tt := range tests {\n        // got panic here. \n        // send on closed channel.\n        got, gotErr := ExecCommand(tt.command, tt.timeout)\n        if gotErr == nil {\n            if tt.wantErr == \"\" {\n                t.Logf(\"succeed\")\n            } else {\n                t.Errorf(\"failed case: %+v, got:%v, gotErr:%v\\n\", tt, got, gotErr)\n            }\n        } else if gotErr.Error() == tt.wantErr {\n            t.Logf(\"succeed\")\n        } else {\n            t.Errorf(\"failed case: %+v, got:%v, gotErr:%v\\n\", tt, got, gotErr)\n        }\n\n    }\n}\n\n</code></pre>\n\n<h3>What did you expect to see?</h3>\n\n<p>test ok.</p>\n\n<h3>What did you see instead?</h3>\n\n<p>panic: send on closed channel. </p>\n\n<p>edit1 : the reason why I controls context on my own\n[<a href=\"https://medium.com/@felixge/killing-a-child-process-and-all-of-its-children-in-go-54079af94773]\" rel=\"nofollow noreferrer\">https://medium.com/@felixge/killing-a-child-process-and-all-of-its-children-in-go-54079af94773]</a></p>\n\n<p>edit2 : More confusion here. </p>\n\n<p>it seems a little bit clear to me. but i still got some question.\n[<a href=\"https://golang.org/src/os/exec/exec.go?s=11462:11489#L440]\" rel=\"nofollow noreferrer\">https://golang.org/src/os/exec/exec.go?s=11462:11489#L440]</a>,</p>\n\n<pre><code>if c.ctx != nil {\n        c.waitDone = make(chan struct{}) // here\n        go func() {\n            select {\n            case &lt;-c.ctx.Done():\n                c.Process.Kill()\n            case &lt;-c.waitDone: // and here\n            }\n        }()\n    }\n</code></pre>\n\n<p>as you can see, it's similar to @Cerise Lim\u00f3n 's code. why should we write this channel. is it neccessary?</p>\n"}, {"tags": ["go", "fish", "gopath"], "comments": [{"owner": {"reputation": 110, "user_id": 3508426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/513ec8e6762ef0e4e8833b7e2b320f20?s=128&d=identicon&r=PG&f=1", "display_name": "Sebasti&#225;n Rodriguez", "link": "https://stackoverflow.com/users/3508426/sebasti%c3%a1n-rodriguez"}, "edited": false, "score": 1, "creation_date": 1571798026, "post_id": 58514516, "comment_id": 103356369, "body": "What about your path? It includes the $GOPATH/bin directory? Maybe you can&#39;t execute <code>(go env GOPATH)</code> in the config.fish file... In my config I have the full path: <code>set -x GOPATH &#47;home&#47;myuser&#47;go</code>"}, {"owner": {"reputation": 5119, "user_id": 4276647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a929f6537e73d7cc1ec7b533032350?s=128&d=identicon&r=PG&f=1", "display_name": "Kurtis Rader", "link": "https://stackoverflow.com/users/4276647/kurtis-rader"}, "edited": false, "score": 1, "creation_date": 1571803439, "post_id": 58514516, "comment_id": 103357307, "body": "Works for me (I use both fish and go) and have the same <code>set -x GOPATH (go env GOPATH)</code> in my <i>~/.config/fish/config.fish</i>. I suspect your actual situation is different from what you have reported here. One possibility is you haven&#39;t set <code>$PATH</code> appropriately."}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1571810835, "creation_date": 1571796782, "last_edit_date": 1571810835, "question_id": 58514516, "link": "https://stackoverflow.com/questions/58514516/gopath-environment-variable-not-getting-set-in-the-fish-shell", "title": "GOPATH environment variable not getting set in the Fish shell?", "body": "<p>I have a <code>~/.config/fish/config.fish</code> which contains the following lines:</p>\n\n<pre><code>set PATH $PATH (go env GOPATH)/bin\nset -x GOPATH (go env GOPATH)\n</code></pre>\n\n<p>If I simply run <code>go env GOPATH</code> at the command line, I get the default location (<code>~/go</code>):</p>\n\n<pre><code>&gt; go env GOPATH\n/Users/kurt/go\n</code></pre>\n\n<p>However, the <code>$GOPATH</code> environment variable is not defined:</p>\n\n<pre><code>&gt; echo $GOPATH\n</code></pre>\n\n<p>Why is the <code>$GOPATH</code> environment variable not getting set?</p>\n"}, {"tags": ["http", "go", "post", "broken-pipe", "go-gin"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571805614, "post_id": 58514439, "comment_id": 103357738, "body": "Can you try that with a client using standard http library? There were bugs in fasthttp that makes it racy."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1571810941, "post_id": 58514439, "comment_id": 103359199, "body": "Broken pipe is the result of the server closing the connection before the client has sent all data. Check your server for why it is closing the connection. This might be for example if the request requires proper authentication which the client does not have and thus the server closes the connection immediately after it realizes this. It might also that the server sends a response based on the  unfinished request and then closes but the client does not read the response but continues to write."}], "owner": {"reputation": 61, "user_id": 5146108, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e10twNpa-3U/AAAAAAAAAAI/AAAAAAAAACc/kX4b50qTn24/photo.jpg?sz=128", "display_name": "jianfyun", "link": "https://stackoverflow.com/users/5146108/jianfyun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1042, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1571796105, "creation_date": 1571796105, "question_id": 58514439, "link": "https://stackoverflow.com/questions/58514439/go-http-post-request-with-big-json-sometimes-write-broken-pipe", "title": "Go HTTP POST request with big JSON, sometimes &quot;write: broken pipe&quot;", "body": "<p>I have a HTTP client(fasthttp) and a HTTP server(gin). When sending big POST request(Content-Length 70K-100K, Content-Type: application/json), sometimes the client encounters error \"write: broken pipe\". </p>\n\n<p>With ngrep, I found the server returns TCP RST to the client. There is not any error log on the server side. And sometimes it works well with no error. </p>\n\n<p>What is the problem? \nWhat can I do to prevent this?</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571795063, "post_id": 58514271, "comment_id": 103355760, "body": "But the problem with using the above method is that my file location varies depending on the parameter value in the url. How do i incorporate that ?"}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571795191, "post_id": 58514271, "comment_id": 103355786, "body": "I see. I&#39;m updating my response"}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571795412, "post_id": 58514271, "comment_id": 103355835, "body": "I went through the blog post, it was mentioned that <code>http.ServeFile</code> is used to serve files within handler function. Tried incorporating that, but still did&#39;nt work"}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571795525, "post_id": 58514271, "comment_id": 103355859, "body": "I updated my response. Can you try it out ?  I&#39;ll create a simple project here to test it as well."}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571795738, "post_id": 58514271, "comment_id": 103355903, "body": "i did, but the image is still not shown as output. It&#39;s still showing the same output in postman as mentioned in the question"}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571796018, "post_id": 58514271, "comment_id": 103355960, "body": "I&#39;m not sure postman can render images. You can try the same url in your browser window.  It worked here."}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571796052, "post_id": 58514271, "comment_id": 103355970, "body": "The other possible issue could be your program not having access to the folder you pointed it to. Test it with a image inside your project&#39;s folder !"}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571796550, "post_id": 58514271, "comment_id": 103356061, "body": "Postman can render images, and i also tried testing it on browser with different image locations, but still didn&#39;t work. I&#39;m baffled"}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571796806, "post_id": 58514271, "comment_id": 103356107, "body": "I have it like this <code>var url = &quot;.&#47;&quot; + key + &quot;.png&quot;</code>. It worked fine with an image in the same folder as the main file. Are you sure the image you requested exists ?"}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "edited": false, "score": 0, "creation_date": 1571798325, "post_id": 58514271, "comment_id": 103356423, "body": "tried everything, still doesn&#39;t work. I&#39;ve updated my entire code above, kindly help debug this error"}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": true, "score": 1, "last_activity_date": 1571799090, "last_edit_date": 1571799090, "creation_date": 1571794550, "answer_id": 58514271, "question_id": 58514228, "link": "https://stackoverflow.com/questions/58514228/golang-mux-http-fileserver-not-returning-image/58514271#58514271", "title": "Golang mux http.FileServer not returning image", "body": "<p><code>http.FileServer()</code> should not be called in a function like that. It returns a <code>Handler function</code> (a function similar to the <code>posterfunc</code> you created).</p>\n\n<p>It should be used as the handler function in the route configuration like this: </p>\n\n<pre><code>myRouter.HandleFunc(\"/poster_path/\",http.FileServer(http.Dir(\"./your_dir\")))\n</code></pre>\n\n<p>Here you can find the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">documentation for <code>http.FileServer</code></a>, with some more detailed examples.</p>\n\n<p><a href=\"https://lets-go.alexedwards.net/sample/02.09-serving-static-files.html\" rel=\"nofollow noreferrer\">This blog post</a> does a fine step-by-step explanation on how to set it up.</p>\n\n<p>UPDATE:</p>\n\n<p>If you want to use it inside your handler, you should use <code>http.ServeFile</code>. It will respond to the request with the contents of the named file or directory.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#ServeFile\" rel=\"nofollow noreferrer\">Docs here</a></p>\n\n<pre><code>func posterfunc(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n    vars := mux.Vars(r)\n    key := vars[\"id\"]\n    var url = \"/home/rakshithjk/Desktop/poster/\"+key+\".jpg\"\n    http.ServeFile(w, r, url)\n}\n</code></pre>\n\n<p>UPDATE 2:</p>\n\n<p>The issue in the new snippet is that you are printing to the interface just before serving the file.\nRemove this line:</p>\n\n<pre><code>fmt.Fprintf(w, \"Hello, %q\\n\", url)\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 58514271, "answer_count": 1, "score": 0, "last_activity_date": 1571799090, "creation_date": 1571794112, "last_edit_date": 1571798369, "question_id": 58514228, "link": "https://stackoverflow.com/questions/58514228/golang-mux-http-fileserver-not-returning-image", "title": "Golang mux http.FileServer not returning image", "body": "<p>I am new to go and am trying to setup a go server. My intention is to return an image when the url is hit.</p>\n\n<p>this is what i have done </p>\n\n<pre><code>myRouter := mux.NewRouter()\nmyRouter.HandleFunc(\"/poster_path/{id}\",posterfunc)\n</code></pre>\n\n<p>This is my posterfunc</p>\n\n<pre><code>func posterfunc(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n    vars := mux.Vars(r)\n    key := vars[\"id\"]\n    var url = \"/home/rakshithjk/Desktop/poster/\"+key+\".jpg\"\n    http.FileServer(http.Dir(url))\n}\n</code></pre>\n\n<p>This is the output in Postman -\n<a href=\"https://i.stack.imgur.com/jbpmV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jbpmV.png\" alt=\"enter image description here\"></a></p>\n\n<p>Any help would be appreciated.</p>\n\n<p>UPDATE - \ntried changing <code>http.FileServer</code> to <code>http.ServeFile</code>, but the output remains the same\nModified handler function </p>\n\n<pre><code>func posterfunc(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n    vars := mux.Vars(r)\n    key := vars[\"id\"]\n    var url = \"/home/rakshithjk/Desktop/poster/\"+key+\".jpg\"\n    http.ServeFile(w, r,url)\n</code></pre>\n\n<p>This is my entire file contents(for reference)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"encoding/json\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/gorilla/mux\"\n    //\"github.com/davecgh/go-spew/spew\"\n)\n\n\nfunc handleRequests() {\n    myRouter := mux.NewRouter()\n    myRouter.HandleFunc(\"/\", homePage)\n    myRouter.HandleFunc(\"/movie/top_rated\", returnSingleArticle)\n    myRouter.HandleFunc(\"/poster_path\",posterfunc)\n\n    log.Fatal(http.ListenAndServe(\":10000\", myRouter))\n}\n\nfunc enableCors(w *http.ResponseWriter) {\n    (*w).Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\n}\ntype movie_list struct {\n    Page int `json:\"page\"`\n    Results []movie `json:\"results\"`\n}\ntype movie struct {\n    Id      int `json:\"id\"`\n    Title   string `json:\"title\"`\n    Language    string `json:\"language\"`\n    Release_date string `json:\"release_date\"`\n    Poster_path string `json:\"poster_path\"`\n    Background_path string `json:\"background_path\"`\n    Overview string `json:\"overview\"`\n    Genre_ids string `json:\"genre_ids\"`\n}\n\nfunc posterfunc(w http.ResponseWriter, r *http.Request){\n     w.Header().Set(\"Content-Type\", \"image/jpeg\")\n    //vars := mux.Vars(r)\n    //key := vars[\"id\"]\n    enableCors(&amp;w)\n\n    var url = \"/home/rakshithjk/go/src/clumio/112.png\"\n    fmt.Fprintf(w, \"Hello, %q\\n\", url)\n    http.ServeFile(w, r,url)\n}\n\nfunc homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Welcome to the HomePage!\")\n    fmt.Println(\"Endpoint Hit: homePage\")\n}\n\nfunc returnSingleArticle(w http.ResponseWriter, r *http.Request) {\n    //vars := mux.Vars(r)\n    //key := vars[\"id\"]\n    enableCors(&amp;w)\n    db, err := sql.Open(\"mysql\", \"root:72574484@tcp(127.0.0.1:3306)/PicturePerfect\")\n             if err != nil {\n                 fmt.Println(err)\n                 }else{\n                 fmt.Println(\"Connection Established\")\n             }\n    rows,err:=db.Query(\"select * from movies limit 10\")\n\n         if err!=nil{\n            fmt.Println(err)\n         }\n\n         var list movie_list\n         var tag movie\n\n         for rows.Next(){\n\n             err:=rows.Scan(&amp;tag.Id,&amp;tag.Title,&amp;tag.Language,&amp;tag.Release_date,&amp;tag.Poster_path,&amp;tag.Background_path,&amp;tag.Overview,&amp;tag.Genre_ids)\n             if err != nil {\n             fmt.Println(err)\n            }\n            fmt.Println(tag.Id)\n            list.Results = append(list.Results,tag)\n         }\n\n        err = rows.Err()\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        defer db.Close()\n\n\n            //fmt.Fprintf(w, \"Hello, %q\\n\", list.Results[3])\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            json.NewEncoder(w).Encode(list) \n            //spew.Dump(list)\n            //fmt.Fprintf(w, \"given lamguage, %q\\n\", tag.Poster_path)\n\n\n\n}\n\nfunc main() {\n    handleRequests()\n\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571794115, "post_id": 58514191, "comment_id": 103355586, "body": "Run it in the playground: <a href=\"https://play.golang.org/p/9PysFzRyUjs\" rel=\"nofollow noreferrer\">play.golang.org/p/9PysFzRyUjs</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1571793851, "last_edit_date": 1571793851, "creation_date": 1571793654, "answer_id": 58514191, "question_id": 58514157, "link": "https://stackoverflow.com/questions/58514157/call-pointer-receiver-method-using-address-of-variable/58514191#58514191", "title": "Call pointer receiver method using address of variable", "body": "<p>The statement</p>\n\n<pre><code>&amp;v.Scale(10) \n</code></pre>\n\n<p>is the equivalent of </p>\n\n<pre><code>&amp;(v.Scale(10))\n</code></pre>\n\n<p>The compiler complains because <code>v.Scale(10)</code> is used as a value. </p>\n\n<p>Use this instead:</p>\n\n<pre><code>(&amp;v).Scale(10) \n</code></pre>\n"}], "owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 58514191, "answer_count": 1, "score": -1, "last_activity_date": 1571793851, "creation_date": 1571793346, "question_id": 58514157, "link": "https://stackoverflow.com/questions/58514157/call-pointer-receiver-method-using-address-of-variable", "title": "Call pointer receiver method using address of variable", "body": "<p>I am learning pointer receiver and notice that when I call the method using address of the variable I get error<code>./prog.go:21:10: v.Scale(10) used as value</code></p>\n\n<p>I can call the method using just the variable name or using the pointer. I am trying to understand why does Go complain when I call using the address of the variable <code>&amp;v.Scale(10)</code> while the method is expecting pointer of <code>Vertex</code> type</p>\n\n<pre><code>\nimport (\n    \"fmt\"\n)\n\ntype Vertex struct {\n    X, Y float64\n}\n\nfunc (v *Vertex) Scale(f float64) {\n    v.X = v.X * f\n    v.Y = v.Y * f\n}\n\nfunc main() {\n    v := Vertex{3, 4}\n    var p *Vertex\n    p=&amp;v\n    v.Scale(10)        //This works\n    p.Scale(10)        //This works\n    &amp;v.Scale(10)       // This does not work\n    fmt.Println(v)\n}\n</code></pre>\n"}, {"tags": ["php", "go", "encryption", "openssl", "aes"], "comments": [{"owner": {"reputation": 3791, "user_id": 1820553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NZb6uZzo4Gg/AAAAAAAAAAI/AAAAAAAAAo0/xTr6RvgMTRw/photo.jpg?sz=128", "display_name": "kelalaka", "link": "https://stackoverflow.com/users/1820553/kelalaka"}, "edited": false, "score": 0, "creation_date": 1571789344, "post_id": 58513733, "comment_id": 103354739, "body": "You say <code>OpenSSL salt is always this string + 8 bytes of actual salt</code>, however, PHP using <code>openssl_random_pseudo_bytes</code> this means that it is random for each encryption."}, {"owner": {"reputation": 25177, "user_id": 1064767, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/af97e0b5fa21ad9414e7c2c383d4cc81?s=128&d=identicon&r=PG", "display_name": "Sammitch", "link": "https://stackoverflow.com/users/1064767/sammitch"}, "edited": false, "score": 0, "creation_date": 1571792633, "post_id": 58513733, "comment_id": 103355294, "body": "Your Go lib seems to implement a bunch of extra fluff that your PHP does not. Notice that the Go code is a <i>lot</i> longer? You&#39;ll either need to implement the fluff in PHP, or trim the fluff out of the Go code."}, {"owner": {"reputation": 61, "user_id": 12007123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/607c67c0bf6a386c0a3f416076a5652e?s=128&d=identicon&r=PG&f=1", "display_name": "Adryan", "link": "https://stackoverflow.com/users/12007123/adryan"}, "reply_to_user": {"reputation": 25177, "user_id": 1064767, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/af97e0b5fa21ad9414e7c2c383d4cc81?s=128&d=identicon&r=PG", "display_name": "Sammitch", "link": "https://stackoverflow.com/users/1064767/sammitch"}, "edited": false, "score": 0, "creation_date": 1571826491, "post_id": 58513733, "comment_id": 103366885, "body": "Thanks @Sammitch i have reduced GO code to basics."}, {"owner": {"reputation": 14233, "user_id": 916000, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/eumU0.png?s=128&g=1", "display_name": "Taha Paksu", "link": "https://stackoverflow.com/users/916000/taha-paksu"}, "edited": false, "score": 0, "creation_date": 1571827134, "post_id": 58513733, "comment_id": 103367222, "body": "I have experienced a LSB MSB difference with C and C# packages before when I was writing a Diffie-Hellman key exchange algorithm. Maybe it&#39;s something like that?"}, {"owner": {"reputation": 188, "user_id": 1619419, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/12029d94faa0c11ef1bce35bb6fab559?s=128&d=identicon&r=PG", "display_name": "nitin jain", "link": "https://stackoverflow.com/users/1619419/nitin-jain"}, "edited": false, "score": 0, "creation_date": 1593920738, "post_id": 58513733, "comment_id": 110943132, "body": "@Adryan this is resolved . I  am facing same problem.. but not able to find out solution"}], "owner": {"reputation": 61, "user_id": 12007123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/607c67c0bf6a386c0a3f416076a5652e?s=128&d=identicon&r=PG&f=1", "display_name": "Adryan", "link": "https://stackoverflow.com/users/12007123/adryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 370, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571826452, "creation_date": 1571788843, "last_edit_date": 1571826452, "question_id": 58513733, "link": "https://stackoverflow.com/questions/58513733/aes-encryption-in-php-aes-decryption-in-go", "title": "AES encryption in PHP - AES decryption in GO", "body": "<p>I am working on a legacy code written in PHP that I have to migrate to GO. We are required to store encrypted data, and decrypt on demand. </p>\n\n<p>Because the legacy code will still have to run until everything is migrated to GO, I need to use the same encrypt / decrypt methods in GO too.</p>\n\n<p>I have been strugling with this issue for the last 10 hours. I have tried (I think) all the Stackoverflow suggestions + many others.</p>\n\n<p>The servers are running OpenSSL 1.1.1a. I have found and tested something helpful, but without success:</p>\n\n<p><a href=\"https://dequeue.blogspot.com/2014/11/decrypting-something-encrypted-with.html\" rel=\"nofollow noreferrer\">https://dequeue.blogspot.com/2014/11/decrypting-something-encrypted-with.html</a> </p>\n\n<p>I do not have to much knowledge about encryption in general, but I can understand it's basics.</p>\n\n<p>So, if there is anyone kind enough to give me some suggestions ... please. </p>\n\n<p><strong>PHP legacy code</strong></p>\n\n<pre class=\"lang-php prettyprint-override\"><code>    var $encryption_key = 'XXX';\n    var $cipher = 'aes-256-cbc';\n\n    function encrypt($text) {\n        global $encryption_key, $cipher;\n\n        $iv = openssl_random_pseudo_bytes(openssl_cipher_iv_length($cipher));\n        $data = openssl_encrypt($text, $cipher, $encryption_key, OPENSSL_RAW_DATA, $iv);\n\n        return base64_encode($iv . $data);\n    }\n\n    function decrypt($text) {\n        global $encryption_key, $cipher;\n\n        $data = base64_decode($text);\n        $iv_len = openssl_cipher_iv_length($cipher);\n        $iv = substr($data, 0, $iv_len);\n        $data = substr($data, $iv_len);\n\n        return openssl_decrypt($data, $cipher, $encryption_key, OPENSSL_RAW_DATA, $iv);\n    }\n</code></pre>\n\n<p><strong>Last code tested in GO for decrypting data (ignore the block below and scroll for updated code)</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n    package main\n\n    import (\n        \"crypto/aes\"\n        \"crypto/cipher\"\n        \"crypto/md5\"\n        \"encoding/base64\"\n        \"fmt\"\n    )\n\n    func main(){\n        result, _ := DecryptString(`password`, `U2FsdGVkX1+ywYxveBnekSnx6ZP25nyPsWHS3oqcuTo=`)\n        fmt.Printf(\"Decrypted string is: %s\", result)\n    }\n\n    var openSSLSaltHeader string = \"Salted_\" // OpenSSL salt is always this string + 8 bytes of actual salt\n\n    type OpenSSLCreds struct {\n        key []byte\n        iv  []byte\n    }\n\n    // Decrypt string that was encrypted using OpenSSL and AES-256-CBC\n    func DecryptString(passphrase, encryptedBase64String string) ([]byte, error) {\n        data, err := base64.StdEncoding.DecodeString(encryptedBase64String)\n        if err != nil {\n            return nil, err\n        }\n        saltHeader := data[:aes.BlockSize]\n        if string(saltHeader[:7]) != openSSLSaltHeader {\n            return nil, fmt.Errorf(\"Does not appear to have been encrypted with OpenSSL, salt header missing.\")\n        }\n        salt := saltHeader[8:]\n        creds, err := extractOpenSSLCreds([]byte(passphrase), salt)\n        if err != nil {\n            return nil, err\n        }\n        return decrypt(creds.key, creds.iv, data)\n    }\n\n    func decrypt(key, iv, data []byte) ([]byte, error) {\n        if len(data) == 0 || len(data)%aes.BlockSize != 0 {\n            return nil, fmt.Errorf(\"bad blocksize(%v), aes.BlockSize = %v\\n\", len(data), aes.BlockSize)\n        }\n        c, err := aes.NewCipher(key)\n        if err != nil {\n            return nil, err\n        }\n        cbc := cipher.NewCBCDecrypter(c, iv)\n        cbc.CryptBlocks(data[aes.BlockSize:], data[aes.BlockSize:])\n        out, err := pkcs7Unpad(data[aes.BlockSize:], aes.BlockSize)\n        if out == nil {\n            return nil, err\n        }\n        return out, nil\n    }\n\n    // openSSLEvpBytesToKey follows the OpenSSL (undocumented?) convention for extracting the key and IV from passphrase.\n    // It uses the EVP_BytesToKey() method which is basically:\n    // D_i = HASH^count(D_(i-1) || password || salt) where || denotes concatentaion, until there are sufficient bytes available\n    // 48 bytes since we're expecting to handle AES-256, 32bytes for a key and 16bytes for the IV\n    func extractOpenSSLCreds(password, salt []byte) (OpenSSLCreds, error) {\n        m := make([]byte, 48)\n        prev := []byte{}\n        for i := 0; i &lt; 3; i++ {\n            prev = hash(prev, password, salt)\n            copy(m[i*16:], prev)\n        }\n        return OpenSSLCreds{key: m[:32], iv: m[32:]}, nil\n    }\n\n    func hash(prev, password, salt []byte) []byte {\n        a := make([]byte, len(prev)+len(password)+len(salt))\n        copy(a, prev)\n        copy(a[len(prev):], password)\n        copy(a[len(prev)+len(password):], salt)\n        return md5sum(a)\n    }\n\n    func md5sum(data []byte) []byte {\n        h := md5.New()\n        h.Write(data)\n        return h.Sum(nil)\n    }\n\n    // pkcs7Unpad returns slice of the original data without padding.\n    func pkcs7Unpad(data []byte, blocklen int) ([]byte, error) {\n        if blocklen &lt;= 0 {\n            return nil, fmt.Errorf(\"invalid blocklen %d\", blocklen)\n        }\n        if len(data)%blocklen != 0 || len(data) == 0 {\n            return nil, fmt.Errorf(\"invalid data len %d\", len(data))\n        }\n        padlen := int(data[len(data)-1])\n        if padlen &gt; blocklen || padlen == 0 {\n            return nil, fmt.Errorf(\"invalid padding\")\n        }\n        pad := data[len(data)-padlen:]\n        for i := 0; i &lt; padlen; i++ {\n            if pad[i] != byte(padlen) {\n                return nil, fmt.Errorf(\"invalid padding\")\n            }\n        }\n        return data[:len(data)-padlen], nil\n    }\n\n</code></pre>\n\n<p>The code written in GO should be able to decrypt data encrypted in PHP. The only result that I get is an error: <strong>Error: Does not appear to have been encrypted with OpenSSL, salt header missing.</strong></p>\n\n<p><strong>UPDATE: Go code updated</strong></p>\n\n<p>The code below <em>almost</em> works. IV, key, cipher binary text are all the same as in PHP, but the final result is still encrypted (or wrongly decrypted)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n    package main\n\n    import (\n        \"crypto/aes\"\n        \"crypto/cipher\"\n        \"encoding/base64\"\n        \"fmt\"\n    )\n\n    func main() {\n\n        var stringToDecode string = \"base64_encode(SOME_PHP_ENCRYPTED_USING_THE_PHP_CODE_ABOVE)\"\n        var cipherKey = []byte(\"myprivatekey\")\n\n        content, err := base64.StdEncoding.DecodeString(stringToDecode)\n        if err != nil {\n            fmt.Printf(\"Error: %s\", err)\n        }\n\n        fmt.Println(\"Cipher key: \", string(cipherKey))\n        fmt.Println(\"Cipher key length: \", len(cipherKey))\n\n        cipherText := content\n\n        cipherBlock, err := aes.NewCipher(cipherKey)\n        if err != nil {\n            panic(err)\n        }\n\n        iv := cipherText[:aes.BlockSize]\n        fmt.Println(\"iv:\", base64.StdEncoding.EncodeToString(iv))\n        fmt.Println(\"Cipher text:\", string(cipherText[aes.BlockSize:]))\n\n        cipherText = cipherText[aes.BlockSize:]\n\n        fmt.Println(\"Cipher text binary: \", string(cipherText))\n\n        if len(cipherText)%aes.BlockSize != 0 {\n            panic(fmt.Sprintf(\"Cipher text (len=%d) is not a multiple of the block size (%d)\", len(cipherText), aes.BlockSize))\n        }\n\n        mode := cipher.NewCBCDecrypter(cipherBlock, iv)\n        mode.CryptBlocks(cipherText, cipherText)\n\n        // The output is not decrypted as expected\n        fmt.Printf(\"The result: %s\\n\", string(cipherText))\n    }\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571793168, "post_id": 58513640, "comment_id": 103355406, "body": "Are you sure they were not considered in the total percentage ?  You have 4 files with 100% and 2 with 0%."}, {"owner": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "reply_to_user": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571823010, "post_id": 58513640, "comment_id": 103365051, "body": "Yes, the project as a whole has over 20 files.  Only those with corresponding test files show in the above output."}], "answers": [{"comments": [{"owner": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "edited": false, "score": 0, "creation_date": 1571823201, "post_id": 58515174, "comment_id": 103365163, "body": "Unless there is something I have setup incorrectly, I am not seeing that being the case.  Only those source files with corresponding test files are reported and included in the overall project coverage."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "edited": false, "score": 0, "creation_date": 1571823924, "post_id": 58515174, "comment_id": 103365589, "body": "@Steve Are you taking about the &quot;total (statements)&quot; metric? If so that is already printed by <code>go test -cover</code> you do not need to analyse the coverprofile for that."}, {"owner": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "edited": false, "score": 0, "creation_date": 1571824102, "post_id": 58515174, "comment_id": 103365687, "body": "So I&#39;ve found that including &quot;-coverpkg&quot; gives me the results I expect, and includes all source files regardless of whether corresponding test files exist or not.  This is the command that provides a total statement coverage percentage:  &quot;go test -coverpkg=./... ./...&quot;."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1571802370, "creation_date": 1571802370, "answer_id": 58515174, "question_id": 58513640, "link": "https://stackoverflow.com/questions/58513640/how-to-include-all-files-in-go-code-coverage-calculations/58515174#58515174", "title": "How to include all files in Go code coverage calculations?", "body": "<blockquote>\n  <p>Is there a way to specify that files without test files be included when calculating the coverage percentage?</p>\n</blockquote>\n\n<p>Yes. Actually there is no way to <em>exclude</em> them: They are included always.</p>\n"}], "owner": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571802370, "creation_date": 1571787911, "question_id": 58513640, "link": "https://stackoverflow.com/questions/58513640/how-to-include-all-files-in-go-code-coverage-calculations", "title": "How to include all files in Go code coverage calculations?", "body": "<p>When testing the code coverage using the following command - <code>go tool cover -func=func.out</code>,the output provides a statement total code coverage percentage (shown below).  However, I find this a bit misleading as those files without any test file are excluded from the overall percentage.  </p>\n\n<p>Is there a way to specify that files without test files be included when calculating the coverage percentage?</p>\n\n<pre><code>client-functions/cmd/hello-world/main.go:14:    httpHandler     0.0%\nclient-functions/cmd/hello-world/main.go:20:    main            0.0%\nclient-functions/pkg/middleware/info.go:16:     infoHandler     100.0%\nclient-functions/pkg/middleware/info.go:22:     InfoMiddleware  100.0%\nclient-functions/pkg/middleware/middleware.go:7:Middleware      100.0%\nclient-functions/pkg/middleware/panic.go:10:    PanicMiddleware 100.0%\ntotal:                          (statements)    84.0%\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571786456, "post_id": 58513435, "comment_id": 103354178, "body": "Show the code for the request handler.   What is the desired output and how does it differ from what you got?"}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571786661, "post_id": 58513435, "comment_id": 103354225, "body": "The issue is that the output string is not converting to json, even though i use json.NewEncoder().Encode()."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1571787028, "post_id": 58513435, "comment_id": 103354306, "body": "The statement <code>json.NewEncoder(w).Encode(list)</code> encodes <code>list</code> to the response as JSON.  The output in postman looks like JSON.   Show an example of the output that is not JSON."}, {"owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571787235, "post_id": 58513435, "comment_id": 103354338, "body": "The output in postman looks like JSON, but it&#39;s not. It&#39;s of type text/plain; charset=utf-8. the <code>json.NewEncoder(w).Encode(list)</code> isn&#39;t doing anything but merely printing back the string without modifing it to JSON and i&#39;m unable to figure out why"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571837450, "post_id": 58513435, "comment_id": 103373036, "body": "The output is JSON. It&#39;s only your header that&#39;s wrong. <code>json.NewEncoder</code> just writes JSON to the writer you give it. It doesn&#39;t know anything about HTTP headers."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1571787714, "last_edit_date": 1571787714, "creation_date": 1571787436, "answer_id": 58513587, "question_id": 58513435, "link": "https://stackoverflow.com/questions/58513435/converting-string-to-json-in-go/58513587#58513587", "title": "Converting string to json in Go", "body": "<p>The problem is that the response content-type header is not application/json.  Fix by setting the header before writing the body.</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"application/json\")\njson.NewEncoder(w).Encode(list) \n</code></pre>\n\n<p>If the content type is not specified by the application, then the  net/http server calls  <a href=\"https://godoc.org/net/http#DetectContentType\" rel=\"nofollow noreferrer\">http.DetectConentType</a> to set the content type in the response header. The function does not detect JSON and defaults to text/plain. </p>\n"}], "owner": {"reputation": 91, "user_id": 7196097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g5SPt.jpg?s=128&g=1", "display_name": "Rakshith Jk", "link": "https://stackoverflow.com/users/7196097/rakshith-jk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 58513587, "answer_count": 1, "score": -2, "last_activity_date": 1571787714, "creation_date": 1571786139, "last_edit_date": 1571786720, "question_id": 58513435, "link": "https://stackoverflow.com/questions/58513435/converting-string-to-json-in-go", "title": "Converting string to json in Go", "body": "<p>I am new to Go, and was learning to setup a http server. \nWhat i am trying to do is return a json output of 10 movies in my sql database. But the resulting output isn't in json. \nI checked the output with online json formatters, and the output was in json format.</p>\n\n<p>I tried json.Marshall as well as json.Encode, but both are not giving the desired results.</p>\n\n<pre><code>type movie_list struct {\n    Page int `json:\"Page\"`\n    Results []movie `json:\"Results\"`\n}\ntype movie struct {\n    Id      int `json:\"Id\"`\n    Title   string `json:\"Title\"`\n    Language    string `json:\"Language\"`\n    Release_date string `json:\"Release_date\"`\n    Poster_path string `json:\"Poster_path\"`\n    Background_path string `json:\"Background_path\"`\n    Overview string `json:\"Overview\"`\n    Genre_ids string `json:\"Genre_ids\"`\n}\n</code></pre>\n\n<pre><code>rows,err:=db.Query(\"select * from movies limit 10\")\n\n         if err!=nil{\n            fmt.Println(err)\n         }\n\n         var list movie_list\n         var tag movie\n\n         for rows.Next(){\n\n             err:=rows.Scan(&amp;tag.Id,&amp;tag.Title,&amp;tag.Language,&amp;tag.Release_date,&amp;tag.Poster_path,&amp;tag.Background_path,&amp;tag.Overview,&amp;tag.Genre_ids)\n             if err != nil {\n             fmt.Println(err)\n            }\n\n            list.Results = append(list.Results,tag)\n         }\n\njson.NewEncoder(w).Encode(list) \n</code></pre>\n\n<p>The ouput in postman - \n<a href=\"https://i.stack.imgur.com/xIC93.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xIC93.png\" alt=\"enter image description here\"></a></p>\n\n<p>The formatted output - \n<a href=\"https://i.stack.imgur.com/GpOb1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GpOb1.png\" alt=\"enter image description here\"></a></p>\n\n<p>my entire code is as follows (for reference)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"encoding/json\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/gorilla/mux\"\n    \"github.com/davecgh/go-spew/spew\"\n)\n\n\nfunc handleRequests() {\n    myRouter := mux.NewRouter().StrictSlash(true)\n    myRouter.HandleFunc(\"/\", homePage)\n    myRouter.HandleFunc(\"/movie/top_rated\", returnSingleArticle)\n    log.Fatal(http.ListenAndServe(\":10000\", myRouter))\n}\ntype movie_list struct {\n    Page int `json:\"Page\"`\n    Results []movie `json:\"Results\"`\n}\ntype movie struct {\n    Id      int `json:\"Id\"`\n    Title   string `json:\"Title\"`\n    Language    string `json:\"Language\"`\n    Release_date string `json:\"Release_date\"`\n    Poster_path string `json:\"Poster_path\"`\n    Background_path string `json:\"Background_path\"`\n    Overview string `json:\"Overview\"`\n    Genre_ids string `json:\"Genre_ids\"`\n}\n\n\nfunc homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Welcome to the HomePage!\")\n    fmt.Println(\"Endpoint Hit: homePage\")\n}\n\nfunc returnSingleArticle(w http.ResponseWriter, r *http.Request) {\n    //vars := mux.Vars(r)\n    //key := vars[\"id\"]\n\n    db, err := sql.Open(\"mysql\", \"root:72574484@tcp(127.0.0.1:3306)/PicturePerfect\")\n             if err != nil {\n                 fmt.Println(err)\n                 }else{\n                 fmt.Println(\"Connection Established\")\n             }\n    rows,err:=db.Query(\"select * from movies limit 10\")\n\n         if err!=nil{\n            fmt.Println(err)\n         }\n\n         var list movie_list\n         var tag movie\n\n         for rows.Next(){\n\n             err:=rows.Scan(&amp;tag.Id,&amp;tag.Title,&amp;tag.Language,&amp;tag.Release_date,&amp;tag.Poster_path,&amp;tag.Background_path,&amp;tag.Overview,&amp;tag.Genre_ids)\n             if err != nil {\n             fmt.Println(err)\n            }\n            fmt.Println(tag.Id)\n            s2, _ := json.Marshal(tag)\n            list.Results = append(list.Results,tag)\n         }\n\n        err = rows.Err()\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        defer db.Close()\n\n\n            //fmt.Fprintf(w, \"Hello, %q\\n\", list.Results[3])\n            json.NewEncoder(w).Encode(list) \n            spew.Dump(list)\n            //fmt.Fprintf(w, \"given lamguage, %q\\n\", tag.Poster_path)\n\n\n\n}\n\nfunc main() {\n    handleRequests()\n\n}\n</code></pre>\n"}, {"tags": ["api", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571777505, "post_id": 58511754, "comment_id": 103351700, "body": "If you&#39;re creating this API, just define that it always accepts an array, even if that array only has one element."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571781215, "post_id": 58511754, "comment_id": 103352883, "body": "Downvotes are anonymous by design. Asking people to explain their downvotes is not appropriate."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 4, "last_activity_date": 1571776145, "creation_date": 1571776145, "answer_id": 58511839, "question_id": 58511754, "link": "https://stackoverflow.com/questions/58511754/how-can-i-discover-if-a-byte-is-an-array-or-a-single-object/58511839#58511839", "title": "How can I discover if a []byte is an array or a single object", "body": "<p>This is what I would consider doing in this situation, in this order:</p>\n\n<ul>\n<li>You can read the body, and check the first non-space character to see if it is '[' or '{', and unmarshal based on that.</li>\n<li>You can first unmarshal as an array, then if that fails, as a single object.</li>\n<li>You can unmarshal to an interface{}, do a type assertion, and parse the contents yourself.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1571786248, "last_edit_date": 1571786248, "creation_date": 1571776152, "answer_id": 58511842, "question_id": 58511754, "link": "https://stackoverflow.com/questions/58511754/how-can-i-discover-if-a-byte-is-an-array-or-a-single-object/58511842#58511842", "title": "How can I discover if a []byte is an array or a single object", "body": "<p>Check the first non-whitespace byte to determine if the JSON document is an array or object. Decode accordingly.</p>\n\n<pre><code>func decode(body []byte) ([]Foo, error) {\n    b = bytes.TrimLeft(body, \" \\t\\n\\r\")\n    if len(b) &gt; 0 &amp;&amp; b[0] == '[' {\n        var v []Foo\n        err := json.Unmarshal(body, &amp;v)\n        return v, err\n    }\n    var v [1]Foo\n    err := json.Unmarshal(body, &amp;v[0])\n    return v[:], err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1571784600, "last_edit_date": 1571784600, "creation_date": 1571784281, "answer_id": 58513211, "question_id": 58511754, "link": "https://stackoverflow.com/questions/58511754/how-can-i-discover-if-a-byte-is-an-array-or-a-single-object/58513211#58513211", "title": "How can I discover if a []byte is an array or a single object", "body": "<p>Why not just add the <code>[</code> the and <code>]</code> if it's not their, and then always treat it as an array?</p>\n\n<pre><code>body := []byte(`{\"foo\":\"bar\"}`)\nbody = bytes.TrimSpace(body)\nif len(body) &gt; 0 &amp;&amp; body[0] != '[' {\n    tmp := make([]byte, len(body)+2, len(body)+2)\n    tmp[0] = '['\n    tmp[len(tmp)-1] = ']'\n    copy(tmp[1:len(tmp)-1], body)\n    body = tmp\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YfnLgN9q64F\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YfnLgN9q64F</a></p>\n\n<p>Or, create the array first, and then based on the first character either marshal into the array or the first item:</p>\n\n<pre><code>f := make([]Foo, 1)\nbody := []byte(`{\"foo\":\"bar\"}`)\nif len(body) &gt; 0 &amp;&amp; body[0] != '[' {\n    json.Unmarshal(body, &amp;f[0])\n} else {\n    json.Unmarshal(body, &amp;f)\n}\nfmt.Println(f)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1fxBKH3ZJyH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1fxBKH3ZJyH</a></p>\n"}], "owner": {"reputation": 189, "user_id": 5013644, "user_type": "registered", "profile_image": "https://graph.facebook.com/852470824827684/picture?type=large", "display_name": "Matheus Vin&#237;cius de Andrade", "link": "https://stackoverflow.com/users/5013644/matheus-vin%c3%adcius-de-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 3, "score": -3, "last_activity_date": 1571786248, "creation_date": 1571775727, "last_edit_date": 1571778727, "question_id": 58511754, "link": "https://stackoverflow.com/questions/58511754/how-can-i-discover-if-a-byte-is-an-array-or-a-single-object", "title": "How can I discover if a []byte is an array or a single object", "body": "<p>I'm creating an API that will receive an object in a specific route.  In this route I can receive a single object or a bulk of it.</p>\n\n<p>Example:</p>\n\n<pre><code>  [{\"foo\":\"bar\"}]\n  {\"foo\":\"bar\"}\n</code></pre>\n\n<p>How can I know if the body request is a slice or a single object before de <code>json.Unmarshal</code>.  Moreover, if this is not possible, what is the best way to accept this two types of body requests and convert them to a list of objects?</p>\n\n<p>I expect something like this:</p>\n\n<pre><code>  type Foo struct {\n    Foo string `json:\"foo\"`\n  }\n\n  func Bla() []Foo {\n\n    fakeBody := []byte(`[{\"foo\":\"bar\"}]`)\n    fakeBody2 := []byte(`{\"foo\":\"bar\"}`)     \n\n    var foo []Foo\n\n    // If fakeBody contains a array of objects\n    // then parse it to the foo slice variable normally\n\n    // So, if the fakeBody2 is a single object then \n    // parse this single object to the foo slice that will contain only\n    // one element.\n\n    return foo\n  }\n</code></pre>\n"}, {"tags": ["go", "web-applications"], "comments": [{"owner": {"reputation": 2543, "user_id": 973447, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/13f74255a2f8ed0d363daa13bfb6643e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/973447/daniel"}, "edited": false, "score": 0, "creation_date": 1571775322, "post_id": 58511588, "comment_id": 103350862, "body": "Take a look at this Github issue: <a href=\"https://github.com/golang/go/issues/34657\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/34657</a>"}], "answers": [{"tags": [], "owner": {"reputation": 297, "user_id": 7856112, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDxis.jpg?s=128&g=1", "display_name": "Amit Basuri", "link": "https://stackoverflow.com/users/7856112/amit-basuri"}, "is_accepted": false, "score": 11, "last_activity_date": 1571779472, "creation_date": 1571779472, "answer_id": 58512507, "question_id": 58511588, "link": "https://stackoverflow.com/questions/58511588/fixing-go-inconsistent-vendoring-in-c-go-src/58512507#58512507", "title": "Fixing go: inconsistent vendoring in C:\\Go\\src", "body": "<p>Run the following before go build</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go mod tidy\ngo mod vendor\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6041, "user_id": 5138921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5f202e6926526d8b4ad819de30504e1f?s=128&d=identicon&r=PG&f=1", "display_name": "Alf Moh", "link": "https://stackoverflow.com/users/5138921/alf-moh"}, "is_accepted": false, "score": 1, "last_activity_date": 1596018742, "creation_date": 1596018742, "answer_id": 63151628, "question_id": 58511588, "link": "https://stackoverflow.com/questions/58511588/fixing-go-inconsistent-vendoring-in-c-go-src/63151628#63151628", "title": "Fixing go: inconsistent vendoring in C:\\Go\\src", "body": "<p>On windows:</p>\n<p>Initially, I had my packages in <code>C\\:Go\\src</code>. It turns out that, go creates other directories in <code>C:\\Users\\USERNAME\\go\\src\\</code>. I therefore moved my (personal) packages into the <code>C:\\Users\\USERNAME\\go\\src\\</code> folder and those from github into the <code>C:\\Users\\USERNAME\\go\\src\\github.com</code> folder.\nEverything started working again.</p>\n"}], "owner": {"reputation": 81, "user_id": 12259474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b18fc707eea216d5d9078d01023c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "bushbuckwhale", "link": "https://stackoverflow.com/users/12259474/bushbuckwhale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6959, "favorite_count": 0, "answer_count": 2, "score": 8, "last_activity_date": 1596018742, "creation_date": 1571774855, "question_id": 58511588, "link": "https://stackoverflow.com/questions/58511588/fixing-go-inconsistent-vendoring-in-c-go-src", "title": "Fixing go: inconsistent vendoring in C:\\Go\\src", "body": "<p>I recently started learning Go programming language for Web and now I can't build my project. I'm getting \"inconsistent vendoring\". I checked github and the library is missing i.e. (Actually the library is still there but with no v0.1.0)\n<a href=\"https://i.stack.imgur.com/YPGxS.png\" rel=\"noreferrer\">vscode error type on build</a></p>\n"}, {"tags": ["django", "go", "plotly", "python-3.6"], "comments": [{"owner": {"reputation": 736, "user_id": 11486181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCMLh.jpg?s=128&g=1", "display_name": "Pavel Antspovich", "link": "https://stackoverflow.com/users/11486181/pavel-antspovich"}, "edited": false, "score": 1, "creation_date": 1571772586, "post_id": 58511050, "comment_id": 103349748, "body": "Please, ask your question in English"}, {"owner": {"reputation": 246762, "user_id": 4124317, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/wsHAV.png?s=128&g=1", "display_name": "ImportanceOfBeingErnest", "link": "https://stackoverflow.com/users/4124317/importanceofbeingernest"}, "edited": false, "score": 0, "creation_date": 1571772899, "post_id": 58511050, "comment_id": 103349872, "body": "I removed the matplotlib tag, because the code is unrelated to matplotlib. Use the tag for the language/library you&#39;re working with instead."}, {"owner": {"reputation": 28403, "user_id": 3437787, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8tmU.jpg?s=128&g=1", "display_name": "vestland", "link": "https://stackoverflow.com/users/3437787/vestland"}, "edited": false, "score": 0, "creation_date": 1579452233, "post_id": 58511050, "comment_id": 105762821, "body": "@josericardo How did my suggestion work out for you?"}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 12508495, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCc_geZxVm5orgL5qfu0gBrZWADg3Ph7_eyAgVb=k-s128", "display_name": "Philip Dang", "link": "https://stackoverflow.com/users/12508495/philip-dang"}, "is_accepted": true, "score": 3, "last_activity_date": 1575943169, "last_edit_date": 1575943169, "creation_date": 1575940828, "answer_id": 59258881, "question_id": 58511050, "link": "https://stackoverflow.com/questions/58511050/spider-graphic-line-in-plotly-graph-objects/59258881#59258881", "title": "spider graphic line in plotly.graph_objects", "body": "<p>You can close the line using <code>go.Scatterpolar()</code> by repeating the first element in both the list for r and theta at the end of the list.</p>\n\n<p>Say you declared:</p>\n\n<pre><code>r_list=[ ideal_Funciones_Responsabilidades, ideal_etapas_propias, ideal_Aspectos_Legales, ideal_Gestion_Ambiental, ideal_Gestion_de_Seguridad, \nideal_manejo_Informacion, hallado_Tecnicos, ideal_Humanos , ideal_transversales]\nr_list.append(r_list[0])\n</code></pre>\n\n<p>Then use</p>\n\n<pre><code>r=r_list\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10957927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lv6TX.jpg?s=128&g=1", "display_name": "jose ricardo", "link": "https://stackoverflow.com/users/10957927/jose-ricardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 842, "favorite_count": 1, "accepted_answer_id": 59258881, "answer_count": 1, "score": 3, "last_activity_date": 1575943169, "creation_date": 1571772324, "last_edit_date": 1571830814, "question_id": 58511050, "link": "https://stackoverflow.com/questions/58511050/spider-graphic-line-in-plotly-graph-objects", "title": "spider graphic line in plotly.graph_objects", "body": "<p>When I generate my chart, the line does not end, however, and I tried in many ways, but nothing worked for me.</p>\n\n<p>what is in r, are some variables that I have declared with already defined values</p>\n\n<pre><code>fig = go.Figure()\n\n\nfig.add_trace(go.Scatterpolar(\n    name = \"Ideal\",\n    r=[ ideal_Funciones_Responsabilidades, ideal_etapas_propias, ideal_Aspectos_Legales, ideal_Gestion_Ambiental, ideal_Gestion_de_Seguridad, \n    ideal_manejo_Informacion, hallado_Tecnicos, ideal_Humanos , ideal_transversales],\n    theta=categories,\n\n    #connectgaps=True,\n    #line_color = 'darkviolet'   \n\n    type= 'scatterpolar',\n    mode = 'lines',\n\n\n))\n\nfig.add_trace(go.Scatterpolar(\n    name = \"Hallado\",\n    r=[ hallado_Funciones_Responsabilidades, hallado_etapas_propias, hallado_Aspectos_Legales, hallado_Gestion_Ambiental, hallado_Gestion_de_Seguridad, \n    hallado_manejo_Informacion, hallado_Tecnicos, hallado_Humanos, hallado_transversales],\n    theta=categories,\n    #mode = \"markers\",\n\n\n    type= 'scatterpolar',\n    mode = 'lines',\n    #line_color = 'peru'\n\n\n\n\n))\n\n\n\n\nfig.update_layout(\n\n    polar=dict(\n\n\n        radialaxis=dict(\n\n            #visible=True,\n            range=[0, maximo_valor + 1]\n        )\n\n        ),\n    #line_close=True,\n    # showlegend=False\n)\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/3btRt.png\" rel=\"nofollow noreferrer\">Image:</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/lBH2f.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lBH2f.png\" alt=\"enter image description here\"></a></p>\n\n<p>I will be attentive to your help with this topic.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 11900571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3127066989e308d523b778000254c7cb?s=128&d=identicon&r=PG", "display_name": "Dat Ngo", "link": "https://stackoverflow.com/users/11900571/dat-ngo"}, "is_accepted": false, "score": 1, "last_activity_date": 1574585624, "creation_date": 1574585624, "answer_id": 59016050, "question_id": 58510735, "link": "https://stackoverflow.com/questions/58510735/is-there-a-way-with-gorm-nested-preloading-to-preload-structs-of-an-array-on-an/59016050#59016050", "title": "Is there a way with GORM nested preloading to preload structs of an array on an item you are preloading?", "body": "<p>The gorm tag on your <code>OptionItem</code> is invalid, it should be <code>gorm:\"preload:true\"</code>.</p>\n\n<p>Alternatively, you can always preload nested association by <code>db.Preload(\"OptionItems.OptionItem\")</code>.</p>\n\n<p>p/s: It's hurt my eyes looking at those struct's names :D</p>\n"}], "owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1574585624, "creation_date": 1571770802, "last_edit_date": 1572590926, "question_id": 58510735, "link": "https://stackoverflow.com/questions/58510735/is-there-a-way-with-gorm-nested-preloading-to-preload-structs-of-an-array-on-an", "title": "Is there a way with GORM nested preloading to preload structs of an array on an item you are preloading?", "body": "<p>My question is best described with a simple/relevant example. Given the structs below, is there a way that I can use nested preloading in GORM to populate models of an array on a preloaded model?</p>\n\n<pre><code>type OptionItem struct {\n    gorm.Model\n    blah    string\n}\n\ntype OrderItem struct {\n    gorm.Model\n\n    OptionItems  []OrderOptionItem\n\n    OrderID       uint                 `gorm:\"column:order_id\"`\n    Order         Order\n}\n\ntype OrderOptionItem struct {\n    gorm.Model\n\n    OrderItemID  uint                  `gorm:\"column:order_item_id\"\"`\n\n    OptionItemID uint                  `gorm:\"column:option_item_id\"`\n    OptionItem   OptionItem            `gorm:\"auto_preload\"`\n}\n\n\nfunc getOrderItemsByOrderID(orderID string) {\n\n    var orderItems []OrderItem\n    a.db.DB.\n        Preload(\"Order\", \"id = (?)\", orderID).\n        Preload(\"OptionItems\").\n        Find(&amp;orderItems)\n\n\n    for _, oi := range orderItems {\n        for _, ooi := range oi.OptionItems {\n            // OptionItem on OrderOptionItem is not populated\n            log.Println(ooi.OptionItem.ID)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571927195, "post_id": 58510526, "comment_id": 103408428, "body": "Did the answer below address what you wanted to achieve?"}, {"owner": {"reputation": 405, "user_id": 7107926, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/319ba2b714bf8d35ae7bef8404c51d31?s=128&d=identicon&r=PG&f=1", "display_name": "Joy", "link": "https://stackoverflow.com/users/7107926/joy"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571953763, "post_id": 58510526, "comment_id": 103420020, "body": "I preferred to follow Method 1. But I am having difficulties to build the tree. In my example, I have over simplified the struct. My actual struct is little complex with nested struct within. ``` type Config struct { Ec2 Ec2 yaml:&quot;ec2&quot; Vpc Vpc yaml:&quot;vpc&quot; } type Ec2 struct { Class string yaml:&quot;class&quot; IP string yaml:&quot;ip&quot; } type vpc struct { Subnet string yaml:&quot;subnet&quot; .... } ``` and I wanted to comment all of those filed. Can I do that using Node type?"}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 7107926, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/319ba2b714bf8d35ae7bef8404c51d31?s=128&d=identicon&r=PG&f=1", "display_name": "Joy", "link": "https://stackoverflow.com/users/7107926/joy"}, "edited": false, "score": 0, "creation_date": 1571949925, "post_id": 58512487, "comment_id": 103418726, "body": "I preferred to follow Method 1. But I am having difficulties to build the tree. In my example, I have over simplified the <code>struct</code>. My actual struct is little complex with nested struct within.   ``` type Config struct {     Ec2 Ec2 <code>yaml:&quot;ec2&quot;</code>     Vpc Vpc <code>yaml:&quot;vpc&quot;</code> } type Ec2 struct { Class string <code>yaml:&quot;class&quot;</code> IP string <code>yaml:&quot;ip&quot;</code> }  type vpc struct { Subnet string <code>yaml:&quot;subnet&quot;</code> .... } ``` and I wanted to comment all of those filed. Can I do that using Node type?"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1571792733, "last_edit_date": 1571792733, "creation_date": 1571779365, "answer_id": 58512487, "question_id": 58510526, "link": "https://stackoverflow.com/questions/58510526/how-to-encode-comments-while-generating-a-config-file-in-go-and-api-v3-of-the-ya/58512487#58512487", "title": "How to encode comments while generating a config file in Go and API v3 of the yaml package", "body": "<p>There are two methods to leverage <code>yaml.v3</code> and its comments feature:</p>\n\n<ul>\n<li>build a <code>yaml.Node</code> tree by hand (tedious maintenance; precise value updates)</li>\n<li>parse a template into a <code>yaml.Node</code> tree (easy maintenance; harder to value update)</li>\n</ul>\n\n<hr>\n\n<p><strong>Method 1:</strong></p>\n\n<p>Craft a YAML Node tree by hand:</p>\n\n<pre><code>config = &amp;yaml.Node{\n    Kind: yaml.DocumentNode,\n    Content: []*yaml.Node{\n        &amp;yaml.Node{\n            Kind: yaml.MappingNode,\n            Content: []*yaml.Node{\n                &amp;yaml.Node{\n                    Kind:        yaml.ScalarNode,\n                    Value:       \"ec2\",\n                    HeadComment: \"# This section is for EC2\",\n                },\n                &amp;yaml.Node{\n                    Kind:  yaml.ScalarNode,\n                    Style: yaml.DoubleQuotedStyle,\n                    Value: \"\", // &lt;- field value goes here\n                },\n\n                &amp;yaml.Node{\n                    Kind:        yaml.ScalarNode,\n                    Value:       \"vpc\",\n                    HeadComment: \"# This section is for VPC\",\n                },\n                &amp;yaml.Node{\n                    Kind:  yaml.ScalarNode,\n                    Style: yaml.DoubleQuotedStyle,\n                    Value: \"\", // &lt;- field value goes here\n                },\n            },\n        },\n    },\n}\n</code></pre>\n\n<p>Working Playground example: <a href=\"https://play.golang.org/p/Z6iw29rHZXk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Z6iw29rHZXk</a></p>\n\n<p>Output:</p>\n\n<pre><code># This section is for EC2\nec2: \"\"\n# This section is for VPC\nvpc: \"\"\n</code></pre>\n\n<hr>\n\n<p><strong>Method 2:</strong></p>\n\n<p>Read a template of your YAML schema e.g.</p>\n\n<pre><code>var yamlSchema = []byte(`\n\n# EC2 header-comment\nec2: \"\"\n\n# This section is for VPC\nvpc: \"\"\n\n`)\n</code></pre>\n\n<p>And then parse it at runtime into a <code>yaml.Node</code> tree like so:</p>\n\n<pre><code>var c yaml.Node\nerr := yaml.Unmarshal(yamlSchema, &amp;c)\n</code></pre>\n\n<p>But as a <code>yaml.Node</code> tree - which has nested slice of <code>yaml.Node</code>s - you'd need to programmatically find your field values so when you Marshal the config for writing, the values are paired with the correct fields.</p>\n\n<p>For example, this <em>may</em> work today:</p>\n\n<pre><code>c.Content[0].Content[1].Value = ec2Value // dangerous\n</code></pre>\n\n<p>but not tomorrow, when the schema changes.</p>\n\n<p>Traversing the map and looking for the field value <code>ec2</code> and then placing its value in the adjacent node would be the proper way.</p>\n\n<p><a href=\"https://play.golang.org/p/qiIrsaDkyfw\" rel=\"nofollow noreferrer\">Playground example</a> shows how header/footer/inline comments can be added to the schema e.g.</p>\n\n<pre><code># This section is for EC2\nec2: \"\"          # &lt;-- place user input here\n# footer EC2\n\n# This section is for VPC\nvpc: \"\"\n</code></pre>\n"}], "owner": {"reputation": 405, "user_id": 7107926, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/319ba2b714bf8d35ae7bef8404c51d31?s=128&d=identicon&r=PG&f=1", "display_name": "Joy", "link": "https://stackoverflow.com/users/7107926/joy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 392, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1572035833, "creation_date": 1571769763, "last_edit_date": 1572035833, "question_id": 58510526, "link": "https://stackoverflow.com/questions/58510526/how-to-encode-comments-while-generating-a-config-file-in-go-and-api-v3-of-the-ya", "title": "How to encode comments while generating a config file in Go and API v3 of the yaml package", "body": "<p>I'm trying to learn to use YAML v3 while marshaling a struct to config yaml.</p>\n\n<p>Note: Update: My original example was little over simplified. My actual requirements is below:</p>\n\n<p>For example, I have:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n\n    \"gopkg.in/yaml.v3\"\n)\n\ntype Ec2 struct {\n    Class string `yaml:\"class\"`\n    Ip    string `yaml:\"ip\"`\n}\n\ntype Vpc struct {\n    Subnet string `yaml:\"subnet\"`\n    Igw    interface{} `yaml:\"igw\"`\n\n}\n\ntype Config struct {\n    Ec2 Ec2 `yaml:\"ec2\"`\n    Vpc Vpc `yaml:\"vpc\"`\n}\n\nfunc main() {\n    c := Config{}\n    bytes, err := yaml.Marshal(c)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    ioutil.WriteFile(\"config.yaml\", bytes, 0644)\n}\n</code></pre>\n\n<p>Which create a file named <code>config.yaml</code> file in <code>pwd</code> like:</p>\n\n<pre><code>  ec2:\n    class: \"\"\n    ip: \"\"\n  vpc:\n    subnet: \"\"\n    igw: null\n</code></pre>\n\n<p>But I am trying to generate config file (in this case config.yaml) like:</p>\n\n<pre><code>\n    ec2:\n    # This section is for EC2\n      class: \"\"\n      ip: \"\"\n    vpc:\n    # This section is for VPC\n      subnet: \"\"\n      igw: null\n</code></pre>\n\n<p>Can this be achievable using <code>V.3</code>?</p>\n"}, {"tags": ["go", "programming-languages"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1571768362, "post_id": 58510041, "comment_id": 103348054, "body": "What do you mean by &quot;goroutines within each other&quot;? All goroutines run independent from each other, there is no nesting. Also, jumping to a new goroutine involves switching the stack. Each goroutine has its own stack."}, {"owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571768680, "post_id": 58510041, "comment_id": 103348197, "body": "You&#39;re right, the &quot;within each other&quot; part doesn&#39;t make sense, they run independently. However, when a goroutine completes, the &quot;schedule&quot; function is called again, which will run another goroutine (which may be completely unrelated to the previous one), so the process is recursive."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571769108, "post_id": 58510041, "comment_id": 103348367, "body": "The process is not recursive, because the stack is different between invocations of <code>schedule</code>. The stack on entry to <code>schedule</code> is different from the stack after it jumps to the new goroutine."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1571816566, "post_id": 58510041, "comment_id": 103361809, "body": "While it might be an interesting academic exercise to understand the scheduler, it is <i>not</i> helpful to new developers to think they can second-guess it. The language specification and memory model should be sufficient documentation. Provided the behaviour of programs that use goroutines isn&#39;t affected,  this allows the Go developers to rewrite details of the scheduler as often as they like,"}, {"owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "reply_to_user": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1571856340, "post_id": 58510041, "comment_id": 103382420, "body": "@Rick-777 sure, I understand that. I&#39;m only doing it as an exercise and out of curiosity."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1571952055, "post_id": 58510041, "comment_id": 103419531, "body": "Cool, just need to avoid suggesting to newbies that they ought to attempt something inadvisable. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "is_accepted": true, "score": 2, "last_activity_date": 1571856887, "last_edit_date": 1571856887, "creation_date": 1571856271, "answer_id": 58529253, "question_id": 58510041, "link": "https://stackoverflow.com/questions/58510041/how-and-why-does-golang-scheduler-recursively-run-goroutines-in-runtime-proc-go/58529253#58529253", "title": "How and why does golang scheduler recursively run goroutines in runtime/proc.go:execute?", "body": "<p>So I spent some time researching the subject and can now try to answer my own question. The whole goroutine lifecycle turned out to be a bit more complex:</p>\n\n<ol>\n<li>New goroutines are created in a special goroutine called <code>g0</code>, which is kind of a main goroutine of a thread. Any call to <code>go func</code> changes the stack from whatever current goroutine it was called from to <code>g0</code> (this is done in <code>proc.go:newproc</code>).</li>\n<li>When the goroutine is created (in <code>proc.go:newproc1</code>), its stack (and/or program counter, PC) is constructed in a way that it <em>looks</em> like it was called by <code>goexit</code> function. This is done to guarantee that when goroutine completes and returns, it is  returned to <code>goexit</code>.</li>\n<li>When <code>schedule</code> is called and a goroutine is chosen to run, the <code>execute</code> function executes it (== jumps to its address via the <code>gogo</code> assembly function).</li>\n<li>After the goroutine has completed, it <em>returns</em> to <code>goexit</code> function, implemented in assembly.</li>\n<li>That assembly function calls <code>proc.go:goexit1</code> (not sure why this extra step in assembly is needed).</li>\n<li>The <code>goexit1</code> function changes current stack to <code>g0</code>. This is done with a call to <code>mcall</code> (\"Machine thread call\"), which executes whatever function is received in an argument. In this case the function supplied to <code>mcall</code> is <code>goexit0</code>.</li>\n<li>The <code>mcall</code>, implemented in assembly, jumps to the address of <code>g0</code>'s stack frame (SP) and performs a <code>CALL</code> to <code>goexit0</code>.</li>\n<li>The <code>goexit0</code> function is executed in the context of <code>g0</code>. It puts a completed goroutine on a list of free goroutines, and frees its stack if it was previously increased.</li>\n<li>Then <code>goexit0</code> calls <code>schedule</code> again, which chooses a goroutine to run, so we get back to step 3.</li>\n</ol>\n\n<p>So indeed there seems to be no recursion here. The scheduled goroutine itself never calls <code>schedule</code>: this is done by a special goroutine <code>g0</code>.\nI'm still not sure if I captured all the details though, so comments and additional answers are appreciated.</p>\n"}], "owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 58529253, "answer_count": 1, "score": 1, "last_activity_date": 1571856887, "creation_date": 1571767622, "last_edit_date": 1571768799, "question_id": 58510041, "link": "https://stackoverflow.com/questions/58510041/how-and-why-does-golang-scheduler-recursively-run-goroutines-in-runtime-proc-go", "title": "How and why does golang scheduler recursively run goroutines in runtime/proc.go:execute?", "body": "<p>I'm trying to break down how the Go scheduler works, and what I'm seeing in <a href=\"https://github.com/golang/go/blob/6b3bb4ba3bcc190200af4f1eedf454658094097f/src/runtime/proc.go#L2177\" rel=\"nofollow noreferrer\">runtime/proc.go</a> is:</p>\n\n<ol>\n<li>The <code>schedule</code> function calls <code>execute</code> to run a goroutine</li>\n<li>The comment for <code>execute</code> explicitly says this function never returns. It calls <code>gogo</code> function defined in one of the assembly files.</li>\n<li>The <code>gogo</code> function performs a jump to the address of the first instruction of a new goroutine.</li>\n<li>After this goroutine is completed, the <code>schedule</code> function is called again, so we're back to step 1.</li>\n</ol>\n\n<p>If my understanding is correct, then how does this scheme avoid stack overflow? \nDoes it have something to do with \"infinite\" stacks that automatically increase their size, or am I missing something here?</p>\n"}, {"tags": ["go", "grpc"], "owner": {"reputation": 757, "user_id": 2011862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ffa79e19021dcbe22b9d5a47ad78e61?s=128&d=identicon&r=PG", "display_name": "svakili", "link": "https://stackoverflow.com/users/2011862/svakili"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571766681, "creation_date": 1571766681, "question_id": 58509830, "link": "https://stackoverflow.com/questions/58509830/debug-connectivity-issue-in-grpc-dial", "title": "Debug Connectivity Issue in gRPC Dial", "body": "<p>I'm trying to make a gRPC connection to a server. In my client code (go version: go1.13 darwin/amd64), I have</p>\n\n<pre><code>conn, err = grpc.DialContext(ctx, c.tiProxyURL, grpc.WithInsecure(), grpc.WithBlock(), grpc.WithBackoffMaxDelay(10*time.Second))\n</code></pre>\n\n<p>This blocks the code as the connection is for some reason not established. Is there any way to debug this further and figure out what is the issue with the connection?</p>\n\n<p>The connection is established when I'm running the server code on my local machine, but is blocked when trying to connect to a service deployed in the cloud through the ingress URL.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1571757995, "post_id": 58507554, "comment_id": 103343160, "body": "Is it possible that you are pointing to a version of the sdkTransforms package that doesn&#39;t have that field for MqttConfig?"}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571758333, "post_id": 58507554, "comment_id": 103343344, "body": "@bserdar Actually the MqttConfig changed recently and a new field was added, but Qos is an old field, should be already there. Is there any check I can make to see what version I am picking? The makefile looks ok."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571758590, "post_id": 58507554, "comment_id": 103343487, "body": "check go.mod, see which version it is looking at."}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571759457, "post_id": 58507554, "comment_id": 103343990, "body": "@bserdar I have cloned the repo and it contains the correct struct, but in the go cache I have the old version. I don&#39;t know how to clean the environment but your answer is right. If you answer, I will vote"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1571759862, "post_id": 58507554, "comment_id": 103344215, "body": "In your <code>AWSMQTTConfig</code> struct, <code>MqttConfig</code> and <code>KeyCertPair</code> are NOT embedded. But the error you shared in your question concerns <code>transforms.MqttConfig</code>, a different struct. Can you share the structure the error references ?"}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "reply_to_user": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1571760702, "post_id": 58507554, "comment_id": 103344622, "body": "@yazgazan sorry for using the wrong term. The problem is that in my environment I have the wrong version, even if I had cloned the correct one"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1571759811, "creation_date": 1571759811, "answer_id": 58508120, "question_id": 58507554, "link": "https://stackoverflow.com/questions/58507554/go-compile-error-unknown-field-in-struct-literal/58508120#58508120", "title": "go compile error: unknown field in struct literal", "body": "<p>It is possible that you are pointing to a version of the sdkTransforms package that doesn't have that field for MqttConfig. You can do a <code>go get &lt;module&gt;</code> to get the latest version and try again.</p>\n"}], "owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 921, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571760733, "creation_date": 1571757791, "last_edit_date": 1571760733, "question_id": 58507554, "link": "https://stackoverflow.com/questions/58507554/go-compile-error-unknown-field-in-struct-literal", "title": "go compile error: unknown field in struct literal", "body": "<p>I have a go package that has the following struct:</p>\n\n<pre><code>package transforms\ntype MqttConfig struct {\n    Qos            byte  \n}\n\ntype KeyCertPair struct { \n    KeyFile      string \n}    \n</code></pre>\n\n<p>In my main.go, I import the package and use both of them liek this:</p>\n\n<pre><code>    import ( sdkTransforms \"github.com/edgexfoundry/app-functions-sdk-go/pkg/transforms\")\n\n    type AWSMQTTConfig struct {\n        MQTTConfig  *sdkTransforms.MqttConfig\n        KeyCertPair *sdkTransforms.KeyCertPair\n    }\n\n    config := AWSMQTTConfig{}\n\n    //FIRST\n    pair := &amp;sdkTransforms.KeyCertPair{\n            KeyFile:  mqttKey,\n    }\n\n    //SECOND\n    mqttcfg := &amp;sdkTransforms.MqttConfig{\n            Qos:            2,    \n    }\n</code></pre>\n\n<p>But only the second usage gives me this compile error:</p>\n\n<pre><code>unknown field 'Qos' in struct literal of type transforms.MqttConfig\n</code></pre>\n\n<p>I don't understand what's wrong.                                                                                                                        </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1571758118, "post_id": 58507527, "comment_id": 103343236, "body": "With curl, you have to first exec curl, which is another program, that does the equivalent of http.Get. So in general, http.Get is what you should do."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1571759240, "post_id": 58507527, "comment_id": 103343856, "body": "It&#39;s not as if curl gets to skip any of that; it&#39;s just a program, same as your Go program. Calling curl to make a web request should be slower than making a web request directly. Calling bash to call curl (as you&#39;re doing in your example) should be even slower still."}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 1, "creation_date": 1571760347, "post_id": 58507527, "comment_id": 103344456, "body": "Ideally you would use <code>io.Copy</code> on <code>exec.Cmd.Stdin</code> and <code>exec.Cmd.Stdout</code>, executing <code>some command 1</code> and <code>some command 2</code> separately so you don&#39;t have to get a shell (i.e <code>bash</code>) involved, and get more visibility on each command."}, {"owner": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "edited": false, "score": 0, "creation_date": 1571763304, "post_id": 58507527, "comment_id": 103345851, "body": "Hmm, if you&#39;re just calling some external programs you might as well just write a shell script..."}], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 1, "last_activity_date": 1571765240, "creation_date": 1571765240, "answer_id": 58509498, "question_id": 58507527, "link": "https://stackoverflow.com/questions/58507527/would-using-http-get-be-slower-than-using-curl-in-the-exec-command/58509498#58509498", "title": "would using http.Get be slower than using curl in the exec.Command?", "body": "<p>Exactly!</p>\n\n<p>In addition to the socket send system calls, there is additional overhead from creating <a href=\"https://golang.org/pkg/os/#StartProcess\" rel=\"nofollow noreferrer\">an external process</a> and communicating between it:</p>\n\n<p><a href=\"https://golang.org/src/os/exec/exec.go?s=6250:6295#L416\" rel=\"nofollow noreferrer\">https://golang.org/src/os/exec/exec.go?s=6250:6295#L416</a></p>\n\n<p>This would significantly change the performance and resource usage of your application because your application requires os level processes.  Consider the case where a client executed the <code>exec.Command</code> based implementation 100 times, 100 os level processes would be required in order to allow this.  </p>\n\n<p>But on the other hand consider the case where you use the http library directly, the system calls all stay within gos process space.</p>\n\n<p>It should be pretty easy to create a benchmark with a local API to show the overhead of these <code>exec.Command</code> calls, and also go provides <code>pprof</code> which would allow you to profile at a much lower level to show you the overhead involved with the <code>exec.Command</code> calls.</p>\n"}], "owner": {"reputation": 1, "user_id": 12258199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da1223058958c25565ec12c83e5e246e?s=128&d=identicon&r=PG&f=1", "display_name": "fyjydim", "link": "https://stackoverflow.com/users/12258199/fyjydim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1571765240, "creation_date": 1571757718, "question_id": 58507527, "link": "https://stackoverflow.com/questions/58507527/would-using-http-get-be-slower-than-using-curl-in-the-exec-command", "title": "would using http.Get be slower than using curl in the exec.Command?", "body": "<p>I have a program where I curl a web page, and then run a few commands on the output using exec.Command. Here is the code :</p>\n\n<pre><code>        cmd := `curl -s https://example.com | &lt;some command 1&gt; | &lt;some command 2&gt;`\n        out, err := exec.Command(\"bash\", \"-c\", cmd).Output()```\n</code></pre>\n\n<p>Would using <code>resp, err := http.Get(\"https://example.com\")</code> in Go, instead of using curl, and then sending the response body to exec.Command be any slower?</p>\n\n<p>I ask this because, by using http.Get, the output is sent from the Go program, to the OS, which then performs operations on the output, and then sends it back to the Go program. There is supposed to be a performance hit, right?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1571756869, "post_id": 58507153, "comment_id": 103342571, "body": "What is the error?"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571756913, "post_id": 58507153, "comment_id": 103342595, "body": "@Adrian - the code doesnt compile ... I just want use arbitrary logs msgs..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1571757387, "post_id": 58507153, "comment_id": 103342849, "body": "OK. And what is the error?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1571757504, "post_id": 58507153, "comment_id": 103342905, "body": "You must add fields like zap.Int or zap.String (a Field) and these are key-value. The whole raison d&#39;etre of zap is being key value and you cannot log arbitrary Go strings you <i>need</i> to wrap them in zap Fields. Or use a different logging library."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1571756929, "creation_date": 1571756929, "answer_id": 58507284, "question_id": 58507153, "link": "https://stackoverflow.com/questions/58507153/logging-one-message-using-zap-library-in-go/58507284#58507284", "title": "Logging one message using zap library in Go", "body": "<blockquote>\n  <p>[I]s there a way to use zap without key and val ?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 1, "closed_date": 1571796074, "accepted_answer_id": 58507284, "answer_count": 1, "score": -2, "last_activity_date": 1571756929, "creation_date": 1571756550, "last_edit_date": 1592644375, "question_id": 58507153, "link": "https://stackoverflow.com/questions/58507153/logging-one-message-using-zap-library-in-go", "closed_reason": "Not suitable for this site", "title": "Logging one message using zap library in Go", "body": "<p>I am using zap library for logging and I try some simple scenario in which I want to log several entries. Unfortunately it doesn't work.</p>\n<h1>Code</h1>\n<pre><code>cfg := zap.Config{\n   Encoding:         &quot;json&quot;,\n   Level:            zap.NewAtomicLevelAt(zapcore.DebugLevel),\n   OutputPaths:      []string{&quot;stderr&quot;},\n   ErrorOutputPaths: []string{&quot;stderr&quot;},\n   EncoderConfig: zapcore.EncoderConfig{\n      MessageKey: &quot;message&quot;,\n\n      LevelKey:    &quot;level&quot;,\n      EncodeLevel: zapcore.CapitalLevelEncoder,\n\n      TimeKey:    &quot;time&quot;,\n      EncodeTime: zapcore.ISO8601TimeEncoder,\n\n      CallerKey:    &quot;caller&quot;,\n      EncodeCaller: zapcore.ShortCallerEncoder,\n   },\n}\n\nlogger,_ := cfg.Build()\n\nlogger.Debug(&quot;This is a DEBUG message\u201d) //works\nlogger.Info(&quot;This is an INFO message\u201d,\u201daaa\u201d ) //Error\n\n\n</code></pre>\n<p><strong>Is there a way to use zap without key and val?</strong></p>\n<p>I try to remove the <code>message</code> entry in the config without success (it omits all the message ...)</p>\n"}, {"tags": ["c", "go", "visual-studio-code", "cgo"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571768954, "post_id": 58505317, "comment_id": 103348302, "body": "Is this a compile error or just the IDE not knowing about CGo?"}, {"owner": {"reputation": 413, "user_id": 1907802, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5793082c513ee9190269f2beaefe94be?s=128&d=identicon&r=PG", "display_name": "Ace", "link": "https://stackoverflow.com/users/1907802/ace"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571818490, "post_id": 58505317, "comment_id": 103362733, "body": "@gonutz there is no compile error, i will clarify the question with that detail."}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1571833700, "last_edit_date": 1571833700, "creation_date": 1571760223, "answer_id": 58508243, "question_id": 58505317, "link": "https://stackoverflow.com/questions/58505317/vscode-import-c-fails-on-modules/58508243#58508243", "title": "VSCode import &quot;C&quot; fails on modules", "body": "<p>The problem is the extra new line between the import, you can try with the following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// #cgo CFLAGS: -g -Wall\n// #include &lt;stdio.h&gt;\n// #include &lt;stdlib.h&gt;\n// #include &lt;string.h&gt;\n// #include \"cutils.h\"\nimport \"C\"\nimport (\n    \"bufio\"\n    \"encoding/json\"\n// ...\n)\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/yqAsQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yqAsQ.png\" alt=\"CGO import example \"></a>\nHave a look here for other example related to CGO:<br>\n<a href=\"https://github.com/alessiosavi/GoUtils/blob/master/GoUtils.go\" rel=\"nofollow noreferrer\">https://github.com/alessiosavi/GoUtils/blob/master/GoUtils.go</a></p>\n"}, {"comments": [{"owner": {"reputation": 413, "user_id": 1907802, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5793082c513ee9190269f2beaefe94be?s=128&d=identicon&r=PG", "display_name": "Ace", "link": "https://stackoverflow.com/users/1907802/ace"}, "edited": false, "score": 0, "creation_date": 1572351612, "post_id": 58596380, "comment_id": 103525463, "body": "i have filed an issue on the vscode github repository"}], "tags": [], "owner": {"reputation": 151, "user_id": 7522482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4162a2e5bcba0ff6a7558a6a54abc252?s=128&d=identicon&r=PG&f=1", "display_name": "mourya venkat", "link": "https://stackoverflow.com/users/7522482/mourya-venkat"}, "is_accepted": false, "score": 1, "last_activity_date": 1572286881, "creation_date": 1572286881, "answer_id": 58596380, "question_id": 58505317, "link": "https://stackoverflow.com/questions/58505317/vscode-import-c-fails-on-modules/58596380#58596380", "title": "VSCode import &quot;C&quot; fails on modules", "body": "<p>That's a bug with VSCode and I've written a medium article for this issue. </p>\n\n<p><a href=\"https://medium.com/@mourya.g9/setting-up-confluent-kafka-client-for-golang-with-vscode-7a27bb94220b\" rel=\"nofollow noreferrer\">https://medium.com/@mourya.g9/setting-up-confluent-kafka-client-for-golang-with-vscode-7a27bb94220b</a>. Hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 413, "user_id": 1907802, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5793082c513ee9190269f2beaefe94be?s=128&d=identicon&r=PG", "display_name": "Ace", "link": "https://stackoverflow.com/users/1907802/ace"}, "is_accepted": true, "score": 4, "last_activity_date": 1572530041, "creation_date": 1572530041, "answer_id": 58644863, "question_id": 58505317, "link": "https://stackoverflow.com/questions/58505317/vscode-import-c-fails-on-modules/58644863#58644863", "title": "VSCode import &quot;C&quot; fails on modules", "body": "<p>This is a bug in <code>gopls</code> tool distributed in the official golang packages.</p>\n\n<p>Here are the issue links:</p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/32898\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/32898</a></li>\n<li><a href=\"https://go-review.googlesource.com/c/tools/+/202238/\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/tools/+/202238/</a></li>\n</ul>\n\n<hr>\n\n<p>info from issue report:</p>\n\n<pre><code>internal/lsp: use Go/cgo source files instead of generated files\n\nUsing CompiledGoFiles was causing metadata lookups to fail for cgo\npackages because it includes generated files in the Go build cache\nwhen the built-in 'go list' driver is used.  GoFiles includes both\nGo and cgo original file names, allowing metadata lookups to\nsucceed.\n</code></pre>\n\n<hr>\n"}], "owner": {"reputation": 413, "user_id": 1907802, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5793082c513ee9190269f2beaefe94be?s=128&d=identicon&r=PG", "display_name": "Ace", "link": "https://stackoverflow.com/users/1907802/ace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3308, "favorite_count": 1, "accepted_answer_id": 58644863, "answer_count": 3, "score": 6, "last_activity_date": 1572530041, "creation_date": 1571750570, "last_edit_date": 1572351586, "question_id": 58505317, "link": "https://stackoverflow.com/questions/58505317/vscode-import-c-fails-on-modules", "title": "VSCode import &quot;C&quot; fails on modules", "body": "<p>Please see the following screenshot:</p>\n\n<p><a href=\"https://i.stack.imgur.com/qipkI.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/qipkI.png\" alt=\"vscode with golang import &quot;C&quot; error\"></a></p>\n\n<p>It says:</p>\n\n<blockquote>\n  <p>could not import C (no package data for import path C)</p>\n</blockquote>\n\n<p>I have attached an example project that reproduces the failure, here: <a href=\"https://github.com/microsoft/vscode/files/3783446/example-project.zip\" rel=\"noreferrer\">https://github.com/microsoft/vscode/files/3783446/example-project.zip</a></p>\n\n<p>I am using Go 1.13 with the latest versions of each extension for Go and C/C++.\nThere is no compiler error, and this is specifically seemingly isolated as a \"vscode problem\".</p>\n\n<p>Is there a way to fix this vscode problem? </p>\n"}, {"tags": ["unit-testing", "go", "testing"], "comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 1, "creation_date": 1571750145, "post_id": 58504979, "comment_id": 103338614, "body": "Interfaces are your friend in go for testing."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1571751718, "post_id": 58504979, "comment_id": 103339467, "body": "@Volker: Generally good advice, but not always possible."}], "answers": [{"comments": [{"owner": {"reputation": 359, "user_id": 2126218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/600beb8d18f926727bec4e9b37e6cda3?s=128&d=identicon&r=PG", "display_name": "jsm1th", "link": "https://stackoverflow.com/users/2126218/jsm1th"}, "edited": false, "score": 0, "creation_date": 1571750268, "post_id": 58505124, "comment_id": 103338702, "body": "This is great, thank you. I was able to use this approach in my actual application I am working on and everything seems to be working as I wanted."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1571753863, "post_id": 58505124, "comment_id": 103340830, "body": "FYI if dealing with console output, you need to take into account the newline i.e. <code>expected := &quot;Hello world\\n&quot;</code>"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 3, "last_activity_date": 1571750002, "creation_date": 1571750002, "answer_id": 58505124, "question_id": 58504979, "link": "https://stackoverflow.com/questions/58504979/how-to-unit-test-cli-output/58505124#58505124", "title": "How to unit test CLI output", "body": "<p>you got to inject, somehow, the destination writer.</p>\n\n<p>Your API is insufficient because it does not allow injection.</p>\n\n<p>In this modified code, the destination writer is given as an argument, but other API implementation decision are possible.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n)\n\nfunc print(dst io.Writer) {\n    fmt.Fprintln(dst, \"Hello world\")\n}\n\nfunc main() {\n    print(os.Stdout)\n}\n</code></pre>\n\n<p>you can test doing so</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestPrint(t *testing.T) {\n    expected := \"Hello world\"\n    var b bytes.Buffer    \n    print(&amp;b) // somehow capture the output\n    // if b.String() != expected {\n    //  t.Errorf(\"Does not match\")\n    // }\n}\n</code></pre>\n\n<p><code>bytes.Buffer</code> implements <code>io.Writer</code> and can be used as a stub to capture execution results.</p>\n\n<p><a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/bytes/#Buffer</a></p>\n"}], "owner": {"reputation": 359, "user_id": 2126218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/600beb8d18f926727bec4e9b37e6cda3?s=128&d=identicon&r=PG", "display_name": "jsm1th", "link": "https://stackoverflow.com/users/2126218/jsm1th"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "closed_date": 1571750148, "accepted_answer_id": 58505124, "answer_count": 1, "score": 0, "last_activity_date": 1571750125, "creation_date": 1571749471, "last_edit_date": 1571750125, "question_id": 58504979, "link": "https://stackoverflow.com/questions/58504979/how-to-unit-test-cli-output", "closed_reason": "Duplicate", "title": "How to unit test CLI output", "body": "<p>I work on a small CLI application. I am trying to write unit tests. I have a function that renders some output as a table to the command line using <code>fmt.Println</code>/<code>fmt.Printf</code>. I am wondering how I can capture that output in a unit test to make sure I am getting what is expected? Below is just a barebone skeleton that somewhat represents what I am trying to achieve.</p>\n\n<p><code>main.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n)\n\nfunc print() {\n    fmt.Println(\"Hello world\")\n}\n\nfunc main() {\n    print()\n}\n</code></pre>\n\n<p><code>main_test.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"testing\"\n\nfunc TestPrint(t *testing.T) {\n    expected := \"Hello world\"\n    print() // somehow capture the output\n    // if got != expected {\n    //  t.Errorf(\"Does not match\")\n    // }\n}\n\n</code></pre>\n\n<p>I have tried a few approaches such as <a href=\"https://stackoverflow.com/questions/44119951/how-to-check-a-log-output-in-go-test\">How to check a log/output in go test?</a> but with minimal luck but, that could be due to misunderstanding on my end.</p>\n"}, {"tags": ["postgresql", "go", "struct", "uuid", "pgx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571744737, "post_id": 58503343, "comment_id": 103335501, "body": "And <code>uuid.UUID</code> is from ... ?"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1571744956, "post_id": 58503343, "comment_id": 103335607, "body": "From gofrs package <a href=\"https://github.com/gofrs/uuid\" rel=\"nofollow noreferrer\">github.com/gofrs/uuid</a> (i wrote it in the title)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571745057, "post_id": 58503343, "comment_id": 103335667, "body": "You might be able to do it by changing the <code>Book</code>&#39;s field to <code>AuthorIds []uuid.UUID</code> (i.e. slice of non-pointers). If not you&#39;ll have to first assign to something that pgx understands and then manually set the <code>Book</code>&#39;s field."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571745510, "post_id": 58503343, "comment_id": 103335920, "body": "... i.e. declare a variable of type <code>[][16]byte</code>, pass a pointer to it to <code>AssignTo</code>, after that returns loop over that variable and convert each element into a <code>uuid.UUID</code> and append that to the destination slice."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571745540, "post_id": 58503343, "comment_id": 103335938, "body": "I have tried []uuid.UUID bit it does not work too. But the strange part is that AssignTo works well with pgtype.UUID (p.s. I have uuid field in db), but not pgtype.UUIDArray"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571745674, "post_id": 58503343, "comment_id": 103336013, "body": "I have thought that I did mistake. If not (it is pgx error) I will do it manually"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 620, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1571747020, "creation_date": 1571744029, "last_edit_date": 1571747020, "question_id": 58503343, "link": "https://stackoverflow.com/questions/58503343/how-to-assign-pgtype-uuidarray-to-uuid-uuid", "title": "How to assign pgtype.UUIDArray to []uuid.UUID?", "body": "<p>I use Go + Postgres. To work with Postgres I use <a href=\"https://github.com/JackC/pgx\" rel=\"nofollow noreferrer\">pgx</a>.\nI have an array of UUID in my Postgres table and a Struct with []*uuid.UUID (from <a href=\"https://github.com/gofrs/uuid\" rel=\"nofollow noreferrer\">github.com/gofrs/uuid</a>) in Go (see code below).</p>\n\n<p>The problem is that I always get error when I try to use AssignTo function </p>\n\n<blockquote>\n  <p>cannot: decode &amp;pgtype.UUIDArray{Elements:[]pgtype.UUID(nil),\n  Dimensions:[]pgtype.ArrayDimension(nil), Status:0x2} into *[]*uuid.UUID</p>\n</blockquote>\n\n<p>(I have tried to use all combinations with pointers and it doesn't work)</p>\n\n<p>My struct (for API):</p>\n\n<pre><code>type Book struct {\n    AuthorIds []*uuid.UUID `json:\"author_ids\"`\n}\n</code></pre>\n\n<p>My struct (for working with Postgres):</p>\n\n<pre><code>type PgBook struct {\n    AuthorIds pgtype.UUIDArray `db:\"author_ids\"`\n}\n</code></pre>\n\n<p>And I use <code>AssignTo</code> function from <code>pgx</code></p>\n\n<pre><code>err := pgBook.AuthorIds.AssignTo(&amp;book.AuthorIds)\n</code></pre>\n\n<p>How to solve this problem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 798, "user_id": 7639056, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yx6Ry1jBzOA/AAAAAAAAAAI/AAAAAAAAB8I/pPIeg_XgGsA/photo.jpg?sz=128", "display_name": "Kaushik Burkule", "link": "https://stackoverflow.com/users/7639056/kaushik-burkule"}, "edited": false, "score": 0, "creation_date": 1571739978, "post_id": 58501935, "comment_id": 103333007, "body": "Hey srini, it is going difficult for me to uderstand what are you trying to ask. Can you be more specific?"}, {"owner": {"reputation": 1, "user_id": 12256626, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mC8jCpo_bOPdkdyeRA8bzbcDyRBAZQ-8CSc4HDfsw=k-s128", "display_name": "srini vasan", "link": "https://stackoverflow.com/users/12256626/srini-vasan"}, "reply_to_user": {"reputation": 798, "user_id": 7639056, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yx6Ry1jBzOA/AAAAAAAAAAI/AAAAAAAAB8I/pPIeg_XgGsA/photo.jpg?sz=128", "display_name": "Kaushik Burkule", "link": "https://stackoverflow.com/users/7639056/kaushik-burkule"}, "edited": false, "score": 0, "creation_date": 1571759723, "post_id": 58501935, "comment_id": 103344147, "body": "Hi Kaushik thanks for the response. Basically i am trying to rewrite some of cpp code to go lang.In that cpp code the following openssl api&#39;s used EVP_DigestVerifyInit, EVP_DigestVerifyUpdate, EVP_DigestVerifyFinal. I need an equalent API in go lang. Is it makes sense to you ?"}], "owner": {"reputation": 1, "user_id": 12256626, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mC8jCpo_bOPdkdyeRA8bzbcDyRBAZQ-8CSc4HDfsw=k-s128", "display_name": "srini vasan", "link": "https://stackoverflow.com/users/12256626/srini-vasan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571743306, "creation_date": 1571739111, "last_edit_date": 1571743306, "question_id": 58501935, "link": "https://stackoverflow.com/questions/58501935/is-there-equivalent-api-in-golang-for-evp-digestverify-openssl-api", "title": "Is there equivalent API in golang for EVP_DigestVerify openssl api?", "body": "<p>I am trying to find equivalent API in golang for below openssl api's.</p>\n\n<p>EVP_DigestVerifyInit <br>\nEVP_DigestVerifyUpdate <br>\nEVP_DigestVerifyFinal <br></p>\n\n<p>Please provide links or docs if equivalent API available and i am using go version go1.11.4 linux/amd64</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1571734349, "post_id": 58500310, "comment_id": 103329738, "body": "@Filmzy , this is not duplicate as I did exactly what written in the answer and I add the replace entry which doesnt solve the issue ...any idea how to overcome this?"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571734499, "post_id": 58500310, "comment_id": 103329821, "body": "@Flimzy , both answer doesnt helps and I already try it..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571734818, "post_id": 58500310, "comment_id": 103330013, "body": "I don&#39;t see how you could have followed those instructions, and still have the problem, but I can&#39;t test it myself right now, so I&#39;ll re-open for now."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571735197, "post_id": 58500310, "comment_id": 103330249, "body": "@Flimzy - I&#39;ve added the replace section which should help in this case ,i.e. changing from upper-case to lower case and still it doesnt work when I run go build , I tried also to clean the go-mod cache without success"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571735290, "post_id": 58500310, "comment_id": 103330305, "body": "The proper import path is <code>github.com&#47;sirupsen&#47;logrus</code>. Try <code>go mod why github.com&#47;Sirupsen&#47;logrus</code> to find the offending package which still uses a more than two years outdated import path and remove it from your dependency list."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571735388, "post_id": 58500310, "comment_id": 103330369, "body": "@Volker - thanks, the command <code>go mod why github.com&#47;Sirupsen&#47;logrus</code> return the same error <code>go: github.com&#47;sirupsen&#47;logrus@v1.4.2 used for two different module paths (github.com&#47;Sirupsen&#47;logrus and github.com&#47;sirupsen&#47;logrus)</code> , any other idea/hint ?"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571735477, "post_id": 58500310, "comment_id": 103330421, "body": "@Volker - this is the output <code>go: github.com&#47;sirupsen&#47;logrus@v1.4.2 used for two different module paths (github.com&#47;Sirupsen&#47;logrus and github.com&#47;sirupsen&#47;logrus) </code>"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571735504, "post_id": 58500310, "comment_id": 103330441, "body": "@Volker - I use go 1.13"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1571735537, "post_id": 58500310, "comment_id": 103330451, "body": "Then grep your code and all its dependencies for &quot;github.com/Sirupsen/logrus&quot;. Or start by removing it from the go.mod."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1571735617, "post_id": 58500310, "comment_id": 103330497, "body": "Somewhere in your code (direct or probably indirect) you our one of your dependencies uses the wrong import path. Find that wrong import path. Then get rid of that package or have it fixed."}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": true, "score": 3, "last_activity_date": 1571737984, "creation_date": 1571737984, "answer_id": 58501593, "question_id": 58500310, "link": "https://stackoverflow.com/questions/58500310/error-when-running-go-build-with-log-repo/58501593#58501593", "title": "Error when running go build . with log repo", "body": "<p>Try to remove the <code>//indirect</code> line, then run </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go mod tidy # prune any extraneous requirements + other stuff\ngo clean # remove object files and cached files\ngo get -v -u all # update everything related to the dependencies\ngo build # finger crossed!\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "is_accepted": false, "score": 0, "last_activity_date": 1571964433, "creation_date": 1571964433, "answer_id": 58550807, "question_id": 58500310, "link": "https://stackoverflow.com/questions/58500310/error-when-running-go-build-with-log-repo/58550807#58550807", "title": "Error when running go build . with log repo", "body": "<p><code>github.com/sirupsen/logrus</code> is the correct module name as indicated in the go.mod file in v1.4.2 - \n<a href=\"https://search.gocenter.io/github.com~2Fsirupsen~2Flogrus/info?version=v1.4.2\" rel=\"nofollow noreferrer\">https://search.gocenter.io/github.com~2Fsirupsen~2Flogrus/info?version=v1.4.2</a></p>\n\n<p>Hence as suggested above, remove the reference of <code>github.com/Sirupsen/logrus v1.4.2</code> from your <code>go.mod</code> file and run <code>go mod tidy</code>. This command will add missing versioned dependencies to your <code>go.mod</code> file.</p>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1307, "favorite_count": 1, "accepted_answer_id": 58501593, "answer_count": 2, "score": 2, "last_activity_date": 1571964433, "creation_date": 1571733793, "last_edit_date": 1571743235, "question_id": 58500310, "link": "https://stackoverflow.com/questions/58500310/error-when-running-go-build-with-log-repo", "title": "Error when running go build . with log repo", "body": "<p>I have a Go program with gomod and when I run <code>go build .</code> I got the following error:</p>\n\n<blockquote>\n  <p>go: github.com/sirupsen/logrus@v1.4.2 used for two different module paths (github.com/Sirupsen/logrus and github.com/sirupsen/logrus)</p>\n</blockquote>\n\n<p>my go mod looks like </p>\n\n<pre><code>require (\n\ngithub.com/Sirupsen/logrus v1.4.2 // indirect\ngithub.com/sirupsen/logrus v1.4.2\n\n\u2026\n\n) \n</code></pre>\n\n<p>and I\u2019ve added the following which doesnt help , any idea ? </p>\n\n<pre><code>replace (\n   github.com/Sirupsen/logrus v1.4.2 =&gt; github.com/sirupsen/logrus v1.4.2\n)\n</code></pre>\n\n<p>in my <strong>project code</strong> I use the <code>import</code> path with the lower case only <code>github.com/sirupsen/logrus</code> </p>\n"}, {"tags": ["macos", "go", "installation", "gopath"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571729478, "post_id": 58498553, "comment_id": 103327219, "body": "Do not set GOROOT. Das /usr/local/go to PATH"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1571731168, "post_id": 58498553, "comment_id": 103327967, "body": "s/Das/Set/ sorry Autokorrekturen in mobile"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571752256, "post_id": 58501652, "comment_id": 103339807, "body": "Don&#39;t assign variables like this in an rc file. For bash use <code>.bash_profile</code>. Do not set GOROOT."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571759989, "post_id": 58501652, "comment_id": 103344283, "body": "wget <a href=\"https://dl.google.com/go/go1.13.3.src.tar.gz\" rel=\"nofollow noreferrer\">dl.google.com/go/go1.13.3.src.tar.gz</a> ; tar xf go1.13.3.src.tar.gz and then set the path. Why you haven&#39;t to set the GOROOT? I think that is better download and set the GOROOT instead that install with the package manager (yum/apt)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571804228, "post_id": 58501652, "comment_id": 103357466, "body": "Where are you reading that you <i>should</i> set GOROOT? Neither installing from the tarball nor from source should have that set, and it can only cause problems."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571830160, "post_id": 58501652, "comment_id": 103368771, "body": "Please check &quot;Installing extra Go versions&quot; section on the official installation documentation: <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571834475, "post_id": 58501652, "comment_id": 103371223, "body": "Nowhere in that text does it say to set GOROOT, it is determined by the <code>go</code> tool itself. In fact this is one of the situations that causes users problems, because sloppy variable handling can lead to the wrong GOROOT being set and breaking the installation."}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": -1, "last_activity_date": 1571738175, "creation_date": 1571738175, "answer_id": 58501652, "question_id": 58498553, "link": "https://stackoverflow.com/questions/58498553/installed-go1-13-3-darwin-amd64-pkg-on-mac-os-set-gopath-path-goroot-env-va/58501652#58501652", "title": "installed &#39;go1.13.3.darwin-amd64.pkg&#39; on mac os. Set GOPATH, PATH, GOROOT env variables. But Go doestn&#39;t seem to be installed", "body": "<p>You can try with the following configuration in <code>.bashrc</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># Golang\nexport GOPATH=\"/opt/DEVOPS/SDK/golang/go_projects\"\nexport GOROOT=\"/opt/DEVOPS/SDK/golang/go\"\nexport GOBIN=\"$GOPATH/bin\"\nexport PATH=\"$PATH:$GOROOT/bin:$GOBIN\"\n</code></pre>\n\n<p>The first two lines have to reflect your GO path.<br>\nThe first (<code>GOPATH</code>) is where the packages will be stored (<code>go get</code>).<br>\nThe second is related to your go installation.</p>\n\n<p>Than load the new env:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>source /home/$(whoami)/.bashrc\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 1003174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/237dcd02714dc44f93810d014f20ac26?s=128&d=identicon&r=PG", "display_name": "rams time", "link": "https://stackoverflow.com/users/1003174/rams-time"}, "is_accepted": false, "score": 1, "last_activity_date": 1571763217, "creation_date": 1571763217, "answer_id": 58509006, "question_id": 58498553, "link": "https://stackoverflow.com/questions/58498553/installed-go1-13-3-darwin-amd64-pkg-on-mac-os-set-gopath-path-goroot-env-va/58509006#58509006", "title": "installed &#39;go1.13.3.darwin-amd64.pkg&#39; on mac os. Set GOPATH, PATH, GOROOT env variables. But Go doestn&#39;t seem to be installed", "body": "<p>You can check the env required for go using fallowing command.</p>\n\n<pre><code>$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/home/user/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/user/golang\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/golang\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/lib/golang/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build484316132=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>and if the go command itself is not working then set the PATH correctly which points to go binary, in my case its /usr/bin/go</p>\n\n<pre><code>$ which go\n/usr/bin/go\n\n$ go version\ngo version go1.11.5 linux/amd64\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 9738307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1f05380da6300ef30e5e3206f712105?s=128&d=identicon&r=PG&f=1", "display_name": "pretty08", "link": "https://stackoverflow.com/users/9738307/pretty08"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1571763217, "creation_date": 1571727026, "question_id": 58498553, "link": "https://stackoverflow.com/questions/58498553/installed-go1-13-3-darwin-amd64-pkg-on-mac-os-set-gopath-path-goroot-env-va", "title": "installed &#39;go1.13.3.darwin-amd64.pkg&#39; on mac os. Set GOPATH, PATH, GOROOT env variables. But Go doestn&#39;t seem to be installed", "body": "<p>I installed <code>go1.13.3.darwin-amd64.pkg</code> on Mac. I set env variables in <code>~/.bash_profile</code> </p>\n\n<p><code>GOPATH = $HOME/gocode</code></p>\n\n<p><code>GOROOT = /usr/local/go</code></p>\n\n<p><code>PATH = $PATH:$GOPATH/bin</code></p>\n\n<p>saved the edits with <code>source /.bash_profile</code>.</p>\n\n<p>Checked <code>go version</code> on terminal. But i don't see a go version installed.</p>\n\n<p>Is there anything I've missed.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571724200, "post_id": 58497882, "comment_id": 103324844, "body": "Is there a question? Guessing from the title, it looks like it is not finding anything to update. What is the type of person.ID?"}, {"owner": {"reputation": 16244, "user_id": 162070, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fda09c54de7bb03f0d77127cec09fd12?s=128&d=identicon&r=PG", "display_name": "Zlatko", "link": "https://stackoverflow.com/users/162070/zlatko"}, "edited": false, "score": 0, "creation_date": 1571724262, "post_id": 58497882, "comment_id": 103324866, "body": "Please provide more details? The title is not meant to be the question, add the details, what is the error message you are seeing, or if not,what happens, what do you see in the db, etc."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1571725077, "post_id": 58497882, "comment_id": 103325197, "body": "Hello and welcome to SO! You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>\u2019s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite its harsh title."}], "owner": {"reputation": 1, "user_id": 12218631, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-r65yjc0xX4A/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfLiYpcdZlysmHu7ETmgk9q_OgLAA/photo.jpg?sz=128", "display_name": "Arpita Sharma", "link": "https://stackoverflow.com/users/12218631/arpita-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571724128, "creation_date": 1571723916, "last_edit_date": 1571724128, "question_id": 58497882, "link": "https://stackoverflow.com/questions/58497882/not-able-to-update-data-using-golang-mongodb", "title": "Not able to update data using golang mongodb", "body": "<pre><code>func (s *MongoClient) UpdateProduct(person models.Person)(*mongo.SingleResult) {\n    filter := bson.M{\"_id\": bson.M{\"$eq\": person.ID}}\n\n    update := bson.M{\n        \"$set\":bson.M{\n            \"firstname\": person.Firstname,\n            \"lastname\": person.Lastname,\n        },\n    }\n    collection := s.client.Database(\"thepolyglotdeveloper\").Collection(\"group\")\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n\n    result:= collection.FindOneAndUpdate(ctx, filter,update)\n    return result\n}\n</code></pre>\n"}, {"tags": ["go", "chromedp"], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 10949215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15d8162f22e0674a0766e6cc1fcf0983?s=128&d=identicon&r=PG&f=1", "display_name": "sam smith", "link": "https://stackoverflow.com/users/10949215/sam-smith"}, "edited": false, "score": 0, "creation_date": 1571742270, "post_id": 58498967, "comment_id": 103334153, "body": "Probably it is but what is the reason for that? While program executes in browser all things done as expected."}, {"owner": {"reputation": 11, "user_id": 4500979, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Qvi9WdFZzP8/AAAAAAAAAAI/AAAAAAAAABM/T2BolTDNkew/photo.jpg?sz=128", "display_name": "Flvff", "link": "https://stackoverflow.com/users/4500979/flvff"}, "reply_to_user": {"reputation": 169, "user_id": 10949215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15d8162f22e0674a0766e6cc1fcf0983?s=128&d=identicon&r=PG&f=1", "display_name": "sam smith", "link": "https://stackoverflow.com/users/10949215/sam-smith"}, "edited": false, "score": 0, "creation_date": 1571750050, "post_id": 58498967, "comment_id": 103338566, "body": "Maybe chromedp timeout while while waiting for the body to be visible ? If so, the Title action won&#39;t be executed, but it doesn&#39;t prevent chrome to continue loading the page"}], "tags": [], "owner": {"reputation": 11, "user_id": 4500979, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Qvi9WdFZzP8/AAAAAAAAAAI/AAAAAAAAABM/T2BolTDNkew/photo.jpg?sz=128", "display_name": "Flvff", "link": "https://stackoverflow.com/users/4500979/flvff"}, "is_accepted": false, "score": 1, "last_activity_date": 1571728700, "creation_date": 1571728700, "answer_id": 58498967, "question_id": 58497769, "link": "https://stackoverflow.com/questions/58497769/cannot-get-current-window-title/58498967#58498967", "title": "Cannot get current window title", "body": "<p>The Title function is probably not executed due to the error printed in the output. You should fix this before focusing on the title</p>\n"}], "owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571731413, "creation_date": 1571723230, "last_edit_date": 1592644375, "question_id": 58497769, "link": "https://stackoverflow.com/questions/58497769/cannot-get-current-window-title", "title": "Cannot get current window title", "body": "<p>I try to get windows title on gmail inbox page after it was opened.\nFor some reason the title is empty.\nWhat am I doing wrong?\nChromedp is used for browser automation.</p>\n<pre><code>...\nvar title string\n\nerr := chromedp.Run(taskCtx,\n    chromedp.Navigate(`https://mail.google.com/mail/u/0/h/`),\n    ...\n    chromedp.WaitVisible(`body`), // gmail inbox page was opened in browser\n    chromedp.Title(&amp;title),\n)\nif err != nil {\n    if err.Error() == &quot;context deadline exceeded&quot; {\n        log.Println(err) // this line executed\n    } else {\n        log.Fatal(err)\n    }\n}\n\nlog.Printf(&quot;success.\\ntitle: %s\\n&quot;, title) // title is empty!\n</code></pre>\n<p>The output in console:</p>\n<blockquote>\n<p>2019/10/22 08:01:49 context deadline exceeded</p>\n<p>2019/10/22 08:01:49 success.</p>\n<p>title:</p>\n</blockquote>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 1040, "user_id": 11767140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Tbfr3YlhoOs/AAAAAAAAAAI/AAAAAAAAAWo/4_25j9xubwc/photo.jpg?sz=128", "display_name": "David Garc&#237;a Bodego", "link": "https://stackoverflow.com/users/11767140/david-garc%c3%ada-bodego"}, "edited": false, "score": 0, "creation_date": 1571716133, "post_id": 58496567, "comment_id": 103322928, "body": "Welcome to SO! When you place a question try to add a minimum content: input sample, expected output sample, what did you try, research and where are you stacked.. What did you try? Any research?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571724363, "post_id": 58496567, "comment_id": 103324902, "body": "<code>GOFLAGS= go get -u github.com&#47;swaggo&#47;swag&#47;cmd&#47;swag</code>"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 8131462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e385af019314794bddf77cdf5201c9e?s=128&d=identicon&r=PG", "display_name": "skipmaple", "link": "https://stackoverflow.com/users/8131462/skipmaple"}, "is_accepted": false, "score": -1, "last_activity_date": 1571715839, "creation_date": 1571715839, "answer_id": 58496785, "question_id": 58496567, "link": "https://stackoverflow.com/questions/58496567/how-can-i-fix-go-get-disabled-by-mod-vendor/58496785#58496785", "title": "How can I fix go get: disabled by -mod=vendor", "body": "<p><code>export GOFLAGS=\" -mod=readonly\"</code> this command can fix it , i found from <a href=\"https://go-review.googlesource.com/c/go/+/198438/\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/go/+/198438/</a></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 1732579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2f667108ef6dbf7d1979dab5c141be?s=128&d=identicon&r=PG", "display_name": "dotmnd", "link": "https://stackoverflow.com/users/1732579/dotmnd"}, "is_accepted": false, "score": 4, "last_activity_date": 1571731570, "creation_date": 1571731570, "answer_id": 58499687, "question_id": 58496567, "link": "https://stackoverflow.com/questions/58496567/how-can-i-fix-go-get-disabled-by-mod-vendor/58499687#58499687", "title": "How can I fix go get: disabled by -mod=vendor", "body": "<p>Based on my personal setup, until this gets fixed/cleaned up upstream, you can simply unset this flag in your variable, i.e:</p>\n\n<pre><code>$ export GOFLAGS=\"\"\n</code></pre>\n\n<p>This because you don't have any other flags but -mod currently set.</p>\n"}, {"tags": [], "owner": {"reputation": 339, "user_id": 4245914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15e9cd3b27cc42c4c2f5c5b75644c6bf?s=128&d=identicon&r=PG&f=1", "display_name": "Sanil Sinai Borkar", "link": "https://stackoverflow.com/users/4245914/sanil-sinai-borkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1608660124, "creation_date": 1608660124, "answer_id": 65413613, "question_id": 58496567, "link": "https://stackoverflow.com/questions/58496567/how-can-i-fix-go-get-disabled-by-mod-vendor/65413613#65413613", "title": "How can I fix go get: disabled by -mod=vendor", "body": "<p>As per <a href=\"https://golang.org/ref/mod#build-commands\" rel=\"nofollow noreferrer\">Golang documentation</a>, this setting tells <code>go</code> to not automatically update <code>go.mod</code> if an imported module is not found. To disable the read-only mode, you can run</p>\n<pre><code>go env -w GOFLAGS=''\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8131462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e385af019314794bddf77cdf5201c9e?s=128&d=identicon&r=PG", "display_name": "skipmaple", "link": "https://stackoverflow.com/users/8131462/skipmaple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2629, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1608660124, "creation_date": 1571713539, "last_edit_date": 1571714319, "question_id": 58496567, "link": "https://stackoverflow.com/questions/58496567/how-can-i-fix-go-get-disabled-by-mod-vendor", "title": "How can I fix go get: disabled by -mod=vendor", "body": "<p>I used <code>export GO111MODULE=on</code></p>\n\n<p>when i type <code>go get -u github.com/swaggo/swag/cmd/swag</code></p>\n\n<p>I got <strong><code>go get: disabled by -mod=vendor</code></strong></p>\n\n<p>so i can't use the go get any more, anyone who can help me?</p>\n\n<p>and my <code>go env</code> like this:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/maple/Library/Caches/go-build\"\nGOEXE=\"\"\nGOFLAGS=\" -mod=vendor\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/maple/go\"\nGOPROXY=\"https://goproxy.io\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/dev/null\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/b0/gjtsl1sn61977y7xldkg5f540000gn/T/go-build663727012=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>i found there has a <code>GOFLAGS=\" -mod=vendor\"</code>, how can i change it?</p>\n"}, {"tags": ["html", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 0, "creation_date": 1571710330, "post_id": 58496083, "comment_id": 103322018, "body": "Hi, thanks, I don&#39;t understand this line: {{range $index,$sound := .Sounds }}  What is happening there? Is $index built in?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 1, "creation_date": 1571710544, "post_id": 58496083, "comment_id": 103322053, "body": "<code>{{range $index, $sound := .Sounds }}</code> is the same as <code>for index, sound := range Sounds</code>. The <code>:=</code> defines variables <code>$index</code> and <code>$sound</code>. When you define variables in a template, you use the <code>$</code> prefix, otherwise they are interpreted as functions. Read the templates doc <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a>"}, {"owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 0, "creation_date": 1571711189, "post_id": 58496083, "comment_id": 103322151, "body": "Ok, I thought that might be what it was.  Freakin hard to work all this out from the documentation mate.  Hence all the queries here on StackOverflow.  Didn&#39;t know you could structure the for loop like that."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1571708596, "creation_date": 1571708596, "answer_id": 58496083, "question_id": 58496024, "link": "https://stackoverflow.com/questions/58496024/go-templates-iterate-over-multiple-arrays-together/58496083#58496083", "title": "Go templates iterate over multiple arrays together", "body": "<p>If you are <em>sure</em> that those three arrays have the same number of elements, then you can do this:</p>\n\n<pre><code>{{ $volumes := .Volumes }}\n{{ $waits := .Waits }}\n{{range $index,$sound := .Sounds }}\n\nPrint Sounds[i] like this: {{$sound}}\n\nPrint volumes[i] like this: {{index $volumes $index}}\n\nPrint waits[i] like this: {{index $waits $index}}\n\n{{end}}\n</code></pre>\n\n<p>This should give you the idea.</p>\n"}], "owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 58496083, "answer_count": 1, "score": -1, "last_activity_date": 1571708596, "creation_date": 1571707903, "last_edit_date": 1571708561, "question_id": 58496024, "link": "https://stackoverflow.com/questions/58496024/go-templates-iterate-over-multiple-arrays-together", "title": "Go templates iterate over multiple arrays together", "body": "<p>I've read through a lot of posts here related to Go templates but I can't find what I'm looking for.</p>\n\n<p>I have these 2 structs, which I cannot change as they are used elsewhere in this project I am helping with:</p>\n\n<pre><code>type Schedule struct {\n    Description   string\n    ControlNights int\n    PlayNights    int\n    StartDay      int\n    Combos        []Combo\n}\n\ntype Combo struct {\n    From    time.Time\n    Every   int\n    Until   time.Time\n    Sounds  []string\n    Volumes []int\n    Waits   []int\n}\n</code></pre>\n\n<p>And I need to display this data on an html page.  So I need to iterate over each Combo. Which I can do, but I need to have the Sounds, Volumes and Waits on rows together i.e. Sound x volume y wait z.  Where x,y and z are the values in the Sounds, Volumes and Waits arrays.  These arrays can be of any length >= 1 but they will all have the same length.</p>\n\n<p>I want it to look like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/G7nIb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/G7nIb.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have tried this:</p>\n\n<pre><code>            {{range .Schedule.Combos}}\n            &lt;div class=\"container\"&gt;\n                &lt;div class=\"row\"&gt;\n                    &lt;div class=\"col\"&gt;\n                        &lt;div class=\"card mt-2 ml-2\"&gt;\n                            &lt;div class=\"card-body\"&gt;\n                                &lt;h5 class=\"card-title\"&gt;\n                                    &lt;strong&gt;Timing&lt;/strong&gt;\n                                &lt;/h5&gt;\n                                &lt;h5 class=\"card-text\"&gt;\n                                    Play every {{.Every}} mins\n                                &lt;/h5&gt;\n                                &lt;h5 class=\"card-text\"&gt;\n                                    From time {{TimeOfDayToString .From}}\n                                &lt;/h5&gt;\n                                &lt;h5 class=\"card-text\"&gt;\n                                    Until {{TimeOfDayToString .Until}}\n                                &lt;/h5&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                    &lt;div class=\"col\"&gt;\n                        &lt;div class=\"card mt-2\"&gt;\n                            &lt;div class=\"card-body\"&gt;\n                                &lt;h5 class=\"card-title\"&gt;\n                                    &lt;strong&gt;Sounds&lt;/strong&gt;\n                                &lt;/h5&gt;\n                                {{range .Sounds}}\n                                    &lt;h5 class=\"card-text\"&gt;\n                                        Sound {{.}}\n                                    &lt;/h5&gt;\n                                {{end}}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n</code></pre>\n\n<p>And that allows me to range over the sounds, but I need to range over the volumes and waits (times to wait until playing next sound) as well, at the same time somehow...</p>\n\n<p>I guess what I could do is make a different Combo struct and pass that to my html template, but I was hoping to avoid that if there's a way to do it with the structs as they are.</p>\n"}, {"tags": ["go", "struct", "go-reflect", "go-interface"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571732416, "post_id": 58495137, "comment_id": 103328616, "body": "Using reflection will make your code much harder to read. The reflect package is for rare use cases, mostly to implement things like the csv library that you pointed to. Struct tags are read with the reflect package in that case. You do not want to use it in reality though, why would you complicate things like that? As I said, your code is easy to understand, break up the lines, split at <code>~</code> and parse the thing. Straight forward, easy to understand, easy to change, it has no dependencies. The problem with the csv library is that it does not make the code shorter or better to read. ..."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571732484, "post_id": 58495137, "comment_id": 103328647, "body": "... Looking at the csv library I see a zillion .go files, adding this complexity for such an easy problem will not benefit you."}, {"owner": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571741436, "post_id": 58495137, "comment_id": 103333708, "body": "Thanks for your comments, @gonutz. I&#39;m not sure what style you recommend (you seem to use single char variable names yourself!). Also you haven&#39;t qualified why you believe reflection is a bad idea. As previously mentioned in my edited comment, it would be good to know whether decoding (eg using github.com/jszwec/csvutil) is a better route? It&#39;s also not clear why you are proscribing complexity per se -- or perhaps that is just a &quot;note to self&quot;? In which case, thanks for sharing. Otherwise, I think you just hit a &quot;nul points&quot; for your comment -- on the Wogan scale!"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571750862, "post_id": 58495137, "comment_id": 103339024, "body": "I don&#39;t know what that means. Please read my other comments for the qualification of why reflection is not the way to go."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571751939, "post_id": 58495137, "comment_id": 103339589, "body": "Trying to rewrite your code into an answer I realize that I do not understand what the code is supposed to do. What is the purpose of having these structs in the same interface{} form? Do you want to put them into an array? Why not treat them separately anyway? You seem to have a header and a body type. Why would you even want to treat them as the same thing anyway?"}], "answers": [{"comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1571727216, "post_id": 58495550, "comment_id": 103326163, "body": "Do NOT use the reflect package! Program it in a readable manner and you will be thankful for it in the future."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571732848, "post_id": 58495550, "comment_id": 103328835, "body": "This is a terrible approach to take. It is way complicated. I program in Go and the original question had a solution in Go. Why do I want to program in this strange reflection style which I have no idea about how to use. All this boiler plate code is completely unnecessary to solve the problem. I do not know if this is covering all cases, Int8, Int16 etc. Then what about the Uints? This is craziness."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571733291, "post_id": 58495550, "comment_id": 103329092, "body": "Your code is longer, harder to read and uses a very uncommon package. I have to know a lot of details that are irrelevant to the actual problem."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 4, "creation_date": 1571734395, "post_id": 58495550, "comment_id": 103329765, "body": "@gonutz SO is not the right venue to push you personal opinions. The question was about how to fill structs programmatically and this answer answers that. It uses the same approach as many other packages in the standard library, most notably <code>encoding&#47;json</code> which is used by many without complaining about &quot;strange relfection style&quot;. Whether this approach is the correct one for OPs problem is for them to decide."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571737900, "post_id": 58495550, "comment_id": 103331830, "body": "@mkopriva SO is for aiding programmers. I am helping make code better by giving advice based on my experience. Even though my comments might seem ranty, they are justified by solid arguments."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571738006, "post_id": 58495550, "comment_id": 103331891, "body": "@mkopriva Concerning your comment about the json package, yes this is a package widely used. USED, not implemented. It is in the standard library and was written and tested very thoroughly by people with intricate knowledge about the reflect package. One of Rob Pike&#39;s proverbs is &quot;Reflection is never clear.&quot; See <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">go-proverbs.github.io</a> ..."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1571738063, "post_id": 58495550, "comment_id": 103331926, "body": "... and it is really not. Using the json package is good, it makes code nicer. Writing reflection-based code is not, it makes things harder to read."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 2, "creation_date": 1571746965, "post_id": 58495550, "comment_id": 103336797, "body": "@gonutz please share with us your answer to the question without using reflection."}, {"owner": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "edited": false, "score": 0, "creation_date": 1571752502, "post_id": 58495550, "comment_id": 103339965, "body": "Cerise: Thanks for the very clear answer and elegant code. Do you believe this type of solution is worth turning into a custom decoder package? Am I right in thinking that deriving the source of decoding errors can be quite tricky through reflection, so putting it into a specific decoder package with lots of tests might be worthwhile?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "edited": false, "score": 0, "creation_date": 1571757691, "post_id": 58495550, "comment_id": 103343009, "body": "@rorycl do you know all the types up front? Because if you do not then your solution simply won&#39;t work and reflection is probably the only thing that can help you here (unless you favour code generation which is also an option). If, however, you know all the possible types up front and there isn&#39;t too many of them and they are easy to maintain then using your approach is probably the wiser choice here. Keep in mind that <i>how many</i> is &quot;too many&quot; and <i>what is and is not</i> &quot;easy to maintain&quot; will depend on the individual who has to work with that code."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "edited": false, "score": 0, "creation_date": 1571757883, "post_id": 58495550, "comment_id": 103343099, "body": "@rorycl If you have a small number of types with a small number of fields, then the complexity of the reflection approach does not carry its weight. If reflection is warranted, then the decoding logic should be moved to a separate function and tests should be written for that function. The decision to create a package for that function and tests depends on context that you have not shared here and may be opinion based."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "edited": false, "score": 2, "creation_date": 1571758189, "post_id": 58495550, "comment_id": 103343276, "body": "@rorycl If you have control over the data format, then you should at least consider using <a href=\"https://en.wikipedia.org/wiki/Comma-separated_values\" rel=\"nofollow noreferrer\">CSV</a>.  The standard <a href=\"https://godoc.org/encoding/csv\" rel=\"nofollow noreferrer\">encoding/csv</a> parses CSV and there are third party packages built around the encoding/csv package."}, {"owner": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "edited": false, "score": 0, "creation_date": 1571777418, "post_id": 58495550, "comment_id": 103351665, "body": "@CeriseLim&#243;n: thanks for the great advice. I&#39;ll have a play with some of the encoding/csv packages such as <a href=\"https://github.com/jszwec/csvutil\" rel=\"nofollow noreferrer\">github.com/jszwec/csvutil</a>. As I have many different structs and many fields of many types in each, I&#39;ll certainly move the structs and &quot;filler&quot; logic to a well-tested package. Thanks again."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1571708376, "last_edit_date": 1571708376, "creation_date": 1571703017, "answer_id": 58495550, "question_id": 58495137, "link": "https://stackoverflow.com/questions/58495137/programmatically-fill-golang-struct/58495550#58495550", "title": "Programmatically fill golang struct", "body": "<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package to programmatically set fields. </p>\n\n<p>A field must be <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a> to be set by the reflect package. Export the names by uppercasing the first rune in the name:</p>\n\n<pre><code>type HDR struct {\n    Typer, A string\n    B        int\n}\n\ntype BDY struct {\n    Typer, C string\n    D        int\n    E        string\n}\n</code></pre>\n\n<p>Create a map of names to the type associated with the name:</p>\n\n<pre><code>var types = map[string]reflect.Type{\n    \"HDR\": reflect.TypeOf((*HDR)(nil)).Elem(),\n    \"BDY\": reflect.TypeOf((*BDY)(nil)).Elem(),\n}\n</code></pre>\n\n<p>For each line, create a value of the type using the <code>types</code> map:</p>\n\n<pre><code>for _, l := range strings.Split(lines, \"\\n\") {\n    fields := strings.Split(l, \"~\")\n    t := types[fields[0]]\n    v := reflect.New(t).Elem()\n    ...\n}\n</code></pre>\n\n<p>Loop over the fields in the line.  Get the field value, convert the string to the kind of the field value and set the field value:</p>\n\n<pre><code>    for i, f := range fields {\n        fv := v.Field(i)\n        switch fv.Type().Kind() {\n        case reflect.String:\n            fv.SetString(f)\n        case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:\n            n, _ := strconv.ParseInt(f, 10, fv.Type().Bits())\n            fv.SetInt(n)\n        }\n    }\n</code></pre>\n\n<p>This is a basic outline of the approach. Error handling is notabling missing: the application will panic if the type name is not one of the types mentioned in <code>types</code>; the application ignores the error returned from parsing the integer; the application will panic if there are more fields in the data than the struct; the application does not report an error when it encounters an unsupported field kind; and more.</p>\n\n<p><a href=\"https://play.golang.org/p/f2gaHc2sCKb\" rel=\"nofollow noreferrer\">Run it on the Go Playground</a>.</p>\n"}], "owner": {"reputation": 1256, "user_id": 299031, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/52d49160455da12f0c381952cab0095f?s=128&d=identicon&r=PG&f=1", "display_name": "rorycl", "link": "https://stackoverflow.com/users/299031/rorycl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 58495550, "answer_count": 1, "score": 0, "last_activity_date": 1573527498, "creation_date": 1571698719, "last_edit_date": 1573527498, "question_id": 58495137, "link": "https://stackoverflow.com/questions/58495137/programmatically-fill-golang-struct", "title": "Programmatically fill golang struct", "body": "<p>I have a file with many types of data record which I need to parse into structs.</p>\n\n<p>I'd be grateful to learn of a idiomatic way -- if it exists -- of filling structs by record type. Something like python's <code>namedtuple(*fields)</code> constructor.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype X interface{}\n\ntype HDR struct {\n    typer, a string\n    b        int\n}\n\ntype BDY struct {\n    typer, c string\n    d        int\n    e        string\n}\n\nvar lines string = `HDR~two~5\nBDY~four~6~five`\n\nfunc sn(s string) int {\n    i, _ := strconv.Atoi(s)\n    return i\n}\n\nfunc main() {\n    sl := strings.Split(lines, \"\\n\")\n    for _, l := range sl {\n        fields := strings.Split(l, \"~\")\n        var r X\n        switch fields[0] {\n        case \"HDR\":\n            r = HDR{fields[0], fields[1], sn(fields[2])} // 1\n        case \"BDY\":\n            r = BDY{fields[0], fields[1], sn(fields[2]), fields[3]} // 2\n        }\n        fmt.Printf(\"%T : %v\\n\", r, r)\n    }\n}\n</code></pre>\n\n<p>I'm specifically interested to learn if lines marked <code>// 1</code> and <code>// 2</code> can be conveniently replaced by code, perhaps some sort of generic decoder which allows the struct itself to handle type conversion.</p>\n"}, {"tags": ["azure", "go", "azure-active-directory", "azure-storage-blobs", "azure-blob-storage"], "answers": [{"comments": [{"owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571770712, "post_id": 58495715, "comment_id": 103348980, "body": "that is my initial guess too, but I did use the Service Principal and tried it with <code>az cli</code> and az cli can do the operation on that container with this same service principal."}, {"owner": {"reputation": 1323, "user_id": 12247391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3424c5a99fa489cc68cc401f311583?s=128&d=identicon&r=PG&f=1", "display_name": "Architect Jamie", "link": "https://stackoverflow.com/users/12247391/architect-jamie"}, "reply_to_user": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571770979, "post_id": 58495715, "comment_id": 103349088, "body": "Doesn&#39;t your az cli ask you to login through a browser? If so then the cli will impersonate whichever identity you logged in with not the service account identity so you may be able to perform the operation in cli but the service account may not."}, {"owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571773341, "post_id": 58495715, "comment_id": 103350028, "body": "you can use service account to login via az cli <code>az login --service-principal -u  &lt;appid&gt; -p &lt;secret&gt;  -t &lt;tenant_id&gt;</code> using this, you will not need to login via browser, it will assume role using your service principal."}, {"owner": {"reputation": 1323, "user_id": 12247391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3424c5a99fa489cc68cc401f311583?s=128&d=identicon&r=PG&f=1", "display_name": "Architect Jamie", "link": "https://stackoverflow.com/users/12247391/architect-jamie"}, "reply_to_user": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571774377, "post_id": 58495715, "comment_id": 103350431, "body": "I believe I saw earlier in your ADAL implementation you were using &quot;<a href=\"http://storage.azure.net\" rel=\"nofollow noreferrer\">storage.azure.net</a>&quot; or something in one of your calls.  Could you check and ensure this is set to the base URI of your actual storage account URI?"}, {"owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571776223, "post_id": 58495715, "comment_id": 103351194, "body": "I replace &quot;storage.azure.net&quot; with my storage account uri like this: &quot;<a href=\"https://ruidev.blob.core.windows.net\" rel=\"nofollow noreferrer\">ruidev.blob.core.windows.net</a>&quot; and still got the same error."}, {"owner": {"reputation": 1323, "user_id": 12247391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3424c5a99fa489cc68cc401f311583?s=128&d=identicon&r=PG&f=1", "display_name": "Architect Jamie", "link": "https://stackoverflow.com/users/12247391/architect-jamie"}, "reply_to_user": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571783123, "post_id": 58495715, "comment_id": 103353367, "body": "Can you view the token you&#39;ve got back in spt.OAuthToken() ? It should be a string or byte array 1159 characters long."}, {"owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1571958612, "post_id": 58495715, "comment_id": 103421250, "body": "the auth token I am getting is only 1154 bytes."}], "tags": [], "owner": {"reputation": 1323, "user_id": 12247391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3424c5a99fa489cc68cc401f311583?s=128&d=identicon&r=PG&f=1", "display_name": "Architect Jamie", "link": "https://stackoverflow.com/users/12247391/architect-jamie"}, "is_accepted": true, "score": 0, "last_activity_date": 1571704707, "creation_date": 1571704707, "answer_id": 58495715, "question_id": 58495087, "link": "https://stackoverflow.com/questions/58495087/azure-blob-go-lib-using-the-tokencredential-to-access-the-blob-api-always-return/58495715#58495715", "title": "Azure Blob Go lib using the TokenCredential to access the blob api always return error", "body": "<p>The good news is it seems as though Authentication has taken place successfully so your use of the ADAL library seems fine.</p>\n\n<p>The most likely cause of this is that the principal that you're using to authenticate to Azure Active Directory with does not have the necessary permissions to access the blobs in the storage account.</p>\n\n<p>You'll need to sign in to the Azure Portal, find and select the storage account in question, then:</p>\n\n<ol>\n<li>Select <strong>Access Control (IAM)</strong></li>\n<li>Go to <strong>Role assignments</strong></li>\n<li>Click on the <strong>Add</strong> button</li>\n<li>From the <strong>Role</strong> scroll down to <strong>Storage Blob...</strong> and select one of the storage blob roles to suite your requirements</li>\n<li>In the <strong>Select</strong> textbox type part of the principal's name for which you are obtaining a token for via ADAL</li>\n<li>Click the <strong>Save</strong> button</li>\n</ol>\n\n<p>Once completed, try running your app again.  The token may need to be refreshed so ensure your authentication and token retrieval code is rerun.</p>\n"}, {"tags": [], "owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "is_accepted": false, "score": 0, "last_activity_date": 1572305457, "creation_date": 1572305457, "answer_id": 58599672, "question_id": 58495087, "link": "https://stackoverflow.com/questions/58495087/azure-blob-go-lib-using-the-tokencredential-to-access-the-blob-api-always-return/58599672#58599672", "title": "Azure Blob Go lib using the TokenCredential to access the blob api always return error", "body": "<p>I ended up create a service request ticket for Azure, and they responded with a sample code here for auth with Azure using golang:\n<a href=\"https://github.com/google/go-cloud/blob/master/blob/azureblob/example_test.go#L111\" rel=\"nofollow noreferrer\">https://github.com/google/go-cloud/blob/master/blob/azureblob/example_test.go#L111</a></p>\n"}], "owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 0, "accepted_answer_id": 58495715, "answer_count": 2, "score": 0, "last_activity_date": 1589183421, "creation_date": 1571698336, "last_edit_date": 1571775659, "question_id": 58495087, "link": "https://stackoverflow.com/questions/58495087/azure-blob-go-lib-using-the-tokencredential-to-access-the-blob-api-always-return", "title": "Azure Blob Go lib using the TokenCredential to access the blob api always return error", "body": "<p>I am trying to use the azblob go libary to access the blob storage using the service principal, I found one one API:\n<a href=\"https://godoc.org/github.com/Azure/azure-storage-blob-go/azblob#NewTokenCredential\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/Azure/azure-storage-blob-go/azblob#NewTokenCredential</a>\nIt seems that it can take the OAuthToken from Adal lib, but I always get this error: AuthorizationPermissionMismatch</p>\n\n<pre><code>oauthConfig, err := adal.NewOAuthConfig(env.ActiveDirectoryEndpoint, tenantID)\nspt, err := adal.NewServicePrincipalToken(*oauthConfig, clientID, clientSecret, \"https://storage.azure.com/\")    \ncreds := azblob.NewTokenCredential(spt.OAuthToken(), nil)\nblobPipeline := azblob.NewPipeline(creds, azblob.PipelineOptions{})\nurl := azblob.NewContainerURL(*URL, blobPipeline)\n_, err := url.ListBlobsHierarchySegment(...)\n</code></pre>\n\n<p>If I swith the NewTokenCredential with the SharedKeyToken, then the code can run properly, but we can not use SharedKeyToken in our env.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 4, "creation_date": 1571686684, "post_id": 58493025, "comment_id": 103316063, "body": "What&#39;s the error you&#39;re getting?"}, {"owner": {"reputation": 332, "user_id": 4564469, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/258831880953729/picture?type=large", "display_name": "Anubhav Singh", "link": "https://stackoverflow.com/users/4564469/anubhav-singh"}, "reply_to_user": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1571687180, "post_id": 58493025, "comment_id": 103316245, "body": "json: cannot unmarshal array into Go value of type service.App"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571751906, "post_id": 58493025, "comment_id": 103339574, "body": "The JSON you pasted isn&#39;t valid. Can you double-check that it&#39;s <i>exactly</i> what you&#39;re receiving?"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1571688749, "last_edit_date": 1571688749, "creation_date": 1571687040, "answer_id": 58493134, "question_id": 58493025, "link": "https://stackoverflow.com/questions/58493025/convert-string-having-json-to-json-or-struct/58493134#58493134", "title": "Convert string having json to json or struct", "body": "<p>Your <code>App</code> structure is not even closely related to the json document you're trying to unmarshal. To unmarshal a json document, you have to have a Go structure that somewhat matches the structure of the underlying document.</p>\n\n<pre><code>type ResponseValue struct {\n    StartTime int64 `json:\"startTimeMillis\"`\n    // other elements of Values here, if you're interested in them\n}\n\ntype Response struct {\n  Id int `json:\"Id\"`\n  Name string `json:\"Name\"`\n  Path string `json:\"Path\"`\n  Frequency string `json:\"frequency\"`\n  Values []ResponseValue `json:\"Values\"`\n}\n\ntype Body struct {\n  Response []Response `json:\"response\"`\n}\n\nvar data Body\njson.Unmarshal([]byte(ame.Response),&amp;data)\n</code></pre>\n\n<p>Then, you can extract the time series from <code>data</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 87, "user_id": 6575937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02be9ef714436367018c1a7edda58c84?s=128&d=identicon&r=PG&f=1", "display_name": "Erez.L", "link": "https://stackoverflow.com/users/6575937/erez-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1590476406, "last_edit_date": 1590476406, "creation_date": 1571731518, "answer_id": 58499675, "question_id": 58493025, "link": "https://stackoverflow.com/questions/58493025/convert-string-having-json-to-json-or-struct/58499675#58499675", "title": "Convert string having json to json or struct", "body": "<p>As the one above me just said your mapping from your json to the struct is wrong.\nAn easy way to find the write mapping is to use this tool <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>\nIt enables you to map json to an auto generated struct.</p>\n\n<p>here is your response struct</p>\n\n<pre><code>type Response struct {\n    ID        int    `json:\"Id\"`\n    Name      string `json:\"Name\"`\n    Path      string `json:\"Path\"`\n    Frequency string `json:\"frequency\"`\n    Values    []struct {\n        StartTimeInMillis int64 `json:\"startTimeInMillis\"`\n        Occurrences       int   `json:\"occurrences\"`\n        Current           int   `json:\"current\"`\n        Min               int   `json:\"min\"`\n        Max               int   `json:\"max\"`\n        UseRange          bool  `json:\"useRange\"`\n        Count             int   `json:\"count\"`\n        Sum               int   `json:\"sum\"`\n        Value             int   `json:\"value\"`\n        StandardDeviation int   `json:\"standardDeviation\"`\n    } `json:\"Values\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 332, "user_id": 4564469, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/258831880953729/picture?type=large", "display_name": "Anubhav Singh", "link": "https://stackoverflow.com/users/4564469/anubhav-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 58493134, "answer_count": 2, "score": -3, "last_activity_date": 1590476406, "creation_date": 1571686426, "last_edit_date": 1571690420, "question_id": 58493025, "link": "https://stackoverflow.com/questions/58493025/convert-string-having-json-to-json-or-struct", "title": "Convert string having json to json or struct", "body": "<p>I am getting this type of response from an API:</p>\n\n<pre><code>{\n    \"ok\": true,\n    \"response\": \"[\n    {\n        \"Id\": 163,\n        \"Name\": \"Availability\",\n        \"Path\": \"Performance|Tier1\",\n        \"frequency\": \"ONE_MIN\",\n        \"Values\": [\n            {\n                \"startTimeInMillis\": 1571314200000,\n                \"occurrences\": 1,\n                \"current\": 1,\n                \"min\": 0,\n                \"max\": 0,\n                \"useRange\": false,\n                \"count\": 1,\n                \"sum\": 1,\n                \"value\": 1,\n                \"standardDeviation\": 0\n            },\n            {\n                \"startTimeInMillis\": 1571314260000,\n                \"occurrences\": 1,\n                \"current\": 1,\n                \"min\": 0,\n                \"max\": 0,\n                \"useRange\": false,\n                \"count\": 1,\n                \"sum\": 1,\n                \"value\": 1,\n                \"standardDeviation\": 0\n            },\n            }\n       ]\n    }\n]\n}\n</code></pre>\n\n<p>I want to convert this into time series format. To do so first I am trying to unmarshal the response to this struct: </p>\n\n<pre><code>type App struct{\n    ID     string   `json:\"metric_id\"`\n    Name   string   `json:\"metric_name\"`\n    Path   string   `json:\"metric_path\"`\n    Frequency    string   `json:\"frequency\"`\n    Values []string `json:\"metric_values\"`\n} \n</code></pre>\n\n<p>I am doing this:</p>\n\n<pre><code>apprsp := App{}\nfmt.Println(json.Unmarshal([]byte(ame.Response), &amp;apprsp))\n</code></pre>\n\n<p>But I am getting error while <code>json.Unmarshal</code>. \nWhat I am trying to do is to generate a json of format: </p>\n\n<pre><code>{'time':'value','time1':'value2'}\n</code></pre>\n\n<p>Where <code>time</code>/<code>time1</code> and <code>value</code>/<code>value2</code> is <code>startTimeInMillis</code> and value from values array. \nWhat I am doing wrong while json unmarshal? What should be done to unmarshal the above data?</p>\n"}, {"tags": ["ios", "go"], "owner": {"reputation": 2537, "user_id": 1720829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e2DBe.png?s=128&g=1", "display_name": "Nathan F.", "link": "https://stackoverflow.com/users/1720829/nathan-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571683252, "creation_date": 1571683252, "question_id": 58492342, "link": "https://stackoverflow.com/questions/58492342/compile-for-armv7s-with-buildmode-c-archive", "title": "compile for armv7s with buildmode=c-archive", "body": "<p>I'm trying to compile my go library for <code>armv7s</code> with <code>buildmode=c-archive</code></p>\n\n<p>It doesn't seem to fail, however the resulting archive is both <code>armv7</code> and <code>armv7s</code>. </p>\n\n<p>I use the following set up:</p>\n\n<pre><code>export CGO_ENABLED=1\nexport GOOS=\"darwin\"\nexport GOARCH=\"arm\"\nexport GOARM=\"7\"\nexport CGO_CFLAGS=\"-arch armv7s -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.4.sdk -miphoneos-version-min=10.0\"\nexport CGO_LDFLAGS=\"-arch armv7s -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.4.sdk -miphoneos-version-min=10.0\"\n</code></pre>\n\n<p>And the resulting archive ends up looking like this:</p>\n\n<pre><code>$ nm libtest.a | grep armv7\nlibtest.a(go.o) (for architecture armv7):\nlibtest.a(000000.o) (for architecture armv7s):\nlibtest.a(000001.o) (for architecture armv7s):\nlibtest.a(000002.o) (for architecture armv7s):\nlibtest.a(000003.o) (for architecture armv7s):\nlibtest.a(000004.o) (for architecture armv7s):\nlibtest.a(000005.o) (for architecture armv7s):\nlibtest.a(000006.o) (for architecture armv7s):\nlibtest.a(000007.o) (for architecture armv7s):\nlibtest.a(000008.o) (for architecture armv7s):\nlibtest.a(000009.o) (for architecture armv7s):\nlibtest.a(000010.o) (for architecture armv7s):\nlibtest.a(000011.o) (for architecture armv7s):\nlibtest.a(000012.o) (for architecture armv7s):\nlibtest.a(000013.o) (for architecture armv7s):\nlibtest.a(000014.o) (for architecture armv7s):\nlibtest.a(000015.o) (for architecture armv7s):\nlibtest.a(000016.o) (for architecture armv7s):\nlibtest.a(000017.o) (for architecture armv7s):\nlibtest.a(000018.o) (for architecture armv7s):\nlibtest.a(000019.o) (for architecture armv7s):\nlibtest.a(000020.o) (for architecture armv7s):\nlibtest.a(000021.o) (for architecture armv7s):\nlibtest.a(000022.o) (for architecture armv7s):\nlibtest.a(000023.o) (for architecture armv7s):\nlibtest.a(000024.o) (for architecture armv7s):\n</code></pre>\n\n<p>Notice how the \"go.o\" object file is <code>armv7</code> instead of <code>armv7s</code>. </p>\n\n<p>I can't find a <code>7s</code> option for the <code>GOARM</code> environment variable, so i'm not quire sure what to do here.</p>\n"}, {"tags": ["json", "loops", "go", "struct"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571679206, "post_id": 58491397, "comment_id": 103312892, "body": "Does C1 have an array of B1, or do you want to have one C1 for each unique pair of A1-B1?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1571679752, "post_id": 58491397, "comment_id": 103313142, "body": "Show the code that you tried so far. It&#39;s unclear from the written description what the problem is. For example, it says that B1 is huge with more than 2k entries, but B1 is a type with a handful of fields."}, {"owner": {"reputation": 57, "user_id": 11864483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed4921c64cb23557e2bd2540bbc6e829?s=128&d=identicon&r=PG&f=1", "display_name": "happygopher", "link": "https://stackoverflow.com/users/11864483/happygopher"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571683094, "post_id": 58491397, "comment_id": 103314573, "body": "@CeriseLim&#243;n it works..but..it took a lot to process"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571683217, "post_id": 58491397, "comment_id": 103314626, "body": "@happygopher you&#39;re looping over <code>ports</code> as many times as there are <code>devices</code>, why? why not loop just once?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571683488, "post_id": 58491397, "comment_id": 103314730, "body": "@happygopher it seems to me that all you need is two loops, one over devices and one over ports. You could even avoid the having to loop over the ports yourself by implementing the Unmarshaler interface on the port type however that&#39;s hacky and unneeded in my opinion."}, {"owner": {"reputation": 57, "user_id": 11864483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed4921c64cb23557e2bd2540bbc6e829?s=128&d=identicon&r=PG&f=1", "display_name": "happygopher", "link": "https://stackoverflow.com/users/11864483/happygopher"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571683588, "post_id": 58491397, "comment_id": 103314778, "body": "@mkopriva could you show me how would you do it in this case?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571684304, "post_id": 58491397, "comment_id": 103315103, "body": "@happygopher something like this <a href=\"https://play.golang.com/p/y_gqdhrvDqp\" rel=\"nofollow noreferrer\">play.golang.com/p/y_gqdhrvDqp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 11864483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed4921c64cb23557e2bd2540bbc6e829?s=128&d=identicon&r=PG&f=1", "display_name": "happygopher", "link": "https://stackoverflow.com/users/11864483/happygopher"}, "edited": false, "score": 0, "creation_date": 1571705594, "post_id": 58495273, "comment_id": 103321297, "body": "that&#39;s it, thanks a lot @sberry, I really appreciate it"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 0, "last_activity_date": 1571699912, "creation_date": 1571699912, "answer_id": 58495273, "question_id": 58491397, "link": "https://stackoverflow.com/questions/58491397/best-way-to-group-two-structs-into-a-third-one-on-go/58495273#58495273", "title": "Best way to group two structs into a third one on Go", "body": "<p>Is this what you are looking to do?  <a href=\"https://play.golang.org/p/AZNzQAwRhN0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AZNzQAwRhN0</a></p>\n\n<p>What this does is build a map grouping all of the ports by pool.  Then it loops through what I labeled <code>clusters</code> and assigns the slice of <code>Port</code> to the matching <code>Cluster</code> by grabbing the matching slice by <code>Pool</code> value.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Cluster struct {\n    ID    string `json:\"id\"`\n    Name  string `json:\"name\"`\n    Pool  string `json:\"pool\"`\n    Ports []Port `json:\"ports\"`\n}\n\ntype Port struct {\n    Name   string `json:\"name\"`\n    Size   int    `json:\"size\"`\n    Pool   string `json:\"pool\"`\n    Status string `json:\"status\"`\n}\n\nfunc main() {\n    var resources []Port\n    err := json.Unmarshal([]byte(resourceJSON), &amp;resources)\n    if err != nil {\n        panic(err)\n    }\n    resourcesByPool := make(map[string][]Port)\n    for _, resource := range resources {\n        if _, ok := resourcesByPool[resource.Pool]; !ok {\n            resourcesByPool[resource.Pool] = []Port{}\n        }\n        resourcesByPool[resource.Pool] = append(resourcesByPool[resource.Pool], resource)\n    }\n\n    var clusters []Cluster\n    err = json.Unmarshal([]byte(clusterJSON), &amp;clusters)\n    if err != nil {\n        panic(err)\n    }\n    for i := 0; i &lt; len(clusters); i++ {\n        clusters[i].Ports = resourcesByPool[clusters[i].Pool]\n    }\n\n    out, err := json.MarshalIndent(clusters, \"\", \"    \")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(out))\n\n}\n\nvar (\n    clusterJSON = `[\n  {\n    \"id\": \"device1\",\n    \"name\": \"dev1\",\n    \"pool\": \"pool1\"\n  },\n  {\n    \"id\": \"device2\",\n    \"name\": \"dev2\",\n    \"pool\": \"pool2\"\n  }\n]`\n\n    resourceJSON = `[\n  {\n    \"name\": \"port1\",\n    \"size\": 10,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port2\",\n    \"size\": 60,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port3\",\n    \"size\": 20,\n    \"pool\": \"pool2\",\n    \"status\": \"down\"\n  },\n  {\n    \"name\": \"port8\",\n    \"size\": 100,\n    \"pool\": \"pool2\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port10\",\n    \"size\": 8000,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  }]`\n)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 11864483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed4921c64cb23557e2bd2540bbc6e829?s=128&d=identicon&r=PG&f=1", "display_name": "happygopher", "link": "https://stackoverflow.com/users/11864483/happygopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 58495273, "answer_count": 1, "score": -1, "last_activity_date": 1571718407, "creation_date": 1571678954, "last_edit_date": 1571718407, "question_id": 58491397, "link": "https://stackoverflow.com/questions/58491397/best-way-to-group-two-structs-into-a-third-one-on-go", "title": "Best way to group two structs into a third one on Go", "body": "<p>I have the following structs:</p>\n\n<pre><code>type A1 struct {\n   IdA1 string\n   NameA1 string\n   key string\n}\n\ntype B1 struct {\n   IdB1 string\n   NameB1 string\n   Size string\n   key string\n}\n\ntype C1 struct {\n   IdA1 string\n   Name string\n   B1Set B1\n}\n</code></pre>\n\n<p>and I need to create a []struct of type C1, that holds a B1Set of B1, B1 is huge more than 2K entries and A1 is just 10 entries, a really slow and inefficient implementation would be to loop over A1, and ask if B1-key is equal to A1-key and store in a map the result, but.. is there any better way to implement this?</p>\n\n<p>thanks in advance,</p>\n\n<p>Add more info:</p>\n\n<p>They are two different JSON files:</p>\n\n<pre><code>Json1:\n[\n  {\n    \"id\": \"device1\",\n    \"name\": \"dev1\",\n    \"pool\": \"pool1\"\n  },\n  {\n    \"id\": \"device2\",\n    \"name\": \"dev2\",\n    \"pool\": \"pool2\"\n  }\n  ...\n]\n</code></pre>\n\n<p>And the other Json:</p>\n\n<pre><code>[\n  {\n    \"name\": \"port1\",\n    \"size\": 10,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port2\",\n    \"size\": 60,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port3\",\n    \"size\": 20,\n    \"pool\": \"pool2\",\n    \"status\": \"down\"\n  },\n  {\n    \"name\": \"port8\",\n    \"size\": 100,\n    \"pool\": \"pool2\",\n    \"status\": \"active\"\n  },\n  {\n    \"name\": \"port10\",\n    \"size\": 8000,\n    \"pool\": \"pool1\",\n    \"status\": \"active\"\n  },\n  ...\n]\n</code></pre>\n\n<p>So I need to create a new JSON file from those two with the following:</p>\n\n<pre><code>[\n  {\n    \"id\": \"device1\",\n    \"name\": \"dev1\",\n    \"pool\": \"pool1\",\n    \"ports\": [\n         {\n           \"name\": \"port1\",\n           \"size\": 10,\n           \"pool\": \"pool1\",\n           \"status\": \"active\"\n         },\n         {\n           \"name\": \"port2\",\n           \"size\": 60,\n           \"pool\": \"pool1\",\n           \"status\": \"active\"\n         },\n         {\n           \"name\": \"port10\",\n           \"size\": 8000,\n           \"pool\": \"pool1\",\n           \"status\": \"active\"\n         }\n     ]\n  },\n  {\n    \"id\": \"device2\",\n    \"name\": \"dev2\",\n    \"pool\": \"pool2\",\n    \"ports\": [\n         {\n           \"name\": \"port3\",\n           \"size\": 20,\n           \"pool\": \"pool2\",\n           \"status\": \"active\"\n         },\n         {\n           \"name\": \"port8\",\n           \"size\": 100,\n           \"pool\": \"pool2\",\n           \"status\": \"active\"\n         }\n     ]\n  }\n]\n</code></pre>\n\n<p>taking into account that Json1 is not more than 10-12 entries and Json2 has more than 800-1000 entries.</p>\n\n<p>So far:</p>\n\n<p>read Json1 (devices), and Json2 (ports) and pass them into two []structs. Then:</p>\n\n<pre><code>results := make(map[string]*models.PortDevices}\nportDevs := []models.PortDevices{}\n\nfor i := range devices {\n   results[devices[i].Pool] = &amp;models.PortDevices{}\n   m := results[devices[i].Pool]\n   m.Id = devices[i].Id\n   m.Name = devices[i].Name\n   m.Pool = devices[i].Pool\n   m.Status = devices[i].Status\n   for p := range ports {\n      if val, ok := results[ports[p].Pool]; ok {\n         m := val\n         m.Ports = ports\n      }\n   }\n\n   portDevs = append(portDevs, *m)\n}\n\ndevports := []models.PortDevices{}\n\nfor _, value := range results {\n   devports = append(devports, *value)\n}\n</code></pre>\n"}, {"tags": ["google-chrome", "go", "automation"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571680438, "post_id": 58491394, "comment_id": 103313432, "body": "I don&#39;t think you can, for security reasons (in the event someone tries to take over Chrome for malicious reasons)."}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571682411, "post_id": 58491394, "comment_id": 103314271, "body": "@Adrian but that is possible, as I know, for Selenium Web Driver - there are a lot of threads with this issue"}], "owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571678920, "creation_date": 1571678920, "question_id": 58491394, "link": "https://stackoverflow.com/questions/58491394/how-to-hide-chrome-is-being-controlled-by-automated-software-infobar-within-ch", "title": "How to hide \u201cChrome is being controlled by automated software\u201d infobar within Chrome v77?", "body": "<p>How to hide \u201cChrome is being controlled by automated software\u201d infobar within Chrome v77?\nI used with <code>chromedp</code> a <code>disable-infobars</code> but that does not work.</p>\n\n<pre><code>opts := append(chromedp.DefaultExecAllocatorOptions[:],\n        chromedp.DisableGPU,\n        chromedp.Flag(\"headless\", false),\n        chromedp.Flag(\"disable-infobars\", true),\n    )\n</code></pre>\n"}, {"tags": ["go", "encoding", "byte", "decoding"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "edited": false, "score": 0, "creation_date": 1571678690, "post_id": 58491060, "comment_id": 103312654, "body": "yes you&#39;r right and now the problem is that I need to produce .zip file from that int-array again, what&#39;s your thoughts about this?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "edited": false, "score": 1, "creation_date": 1571678922, "post_id": 58491060, "comment_id": 103312749, "body": "Make decoded a []byte, and use decoded=append(decoded,byte(i)). You can write that []byte as a zip file. BTW, what you&#39;re doing can be done with encoding.base64."}, {"owner": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "edited": false, "score": 0, "creation_date": 1571681212, "post_id": 58491060, "comment_id": 103313773, "body": "as you know there could be multiple files in .zip file while encoding but when I write []byte into .zip file while decoding, it generates only one file in .zip file while I want exactly the same files"}, {"owner": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "edited": false, "score": 0, "creation_date": 1571681508, "post_id": 58491060, "comment_id": 103313888, "body": "BTW, it would be very helpful if you could share the encoding.base64 method"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "edited": false, "score": 0, "creation_date": 1571684356, "post_id": 58491060, "comment_id": 103315124, "body": "You are decoding all files into a single byte array. There is no delineation between files. You have to fix your decoder to figure out file boundaries. For base64 encoding look at the encoding/base64 package, it is a standart library package. It is a common and standard way of encoding binary data as text."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1571677551, "creation_date": 1571677551, "answer_id": 58491060, "question_id": 58490798, "link": "https://stackoverflow.com/questions/58490798/binary-to-text-encoding-that-replace-a-byte-into-a-predefined-unique-string-in-g/58491060#58491060", "title": "binary-to-text encoding that replace a byte into a predefined unique string in golang", "body": "<p>Two things:</p>\n\n<ul>\n<li>You are dealing with spaces correctly, but not with newlines.</li>\n<li>Your decoder loop is wrong. As far as I can tell, it should look like the following:</li>\n</ul>\n\n<pre><code>for i, key := range keys {\n   if string(current)==key {\n     decoded=append(decoded,i)\n     break\n   }\n}\n</code></pre>\n\n<p>Also, your <code>decoded</code> is an int-array, not a byte-array.</p>\n"}], "owner": {"reputation": 11, "user_id": 11514970, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5X7yhcCvh7c/AAAAAAAAAAI/AAAAAAAAAAc/T3K6kNFM-3A/photo.jpg?sz=128", "display_name": "Atif Zia", "link": "https://stackoverflow.com/users/11514970/atif-zia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571765093, "creation_date": 1571676482, "last_edit_date": 1571765093, "question_id": 58490798, "link": "https://stackoverflow.com/questions/58490798/binary-to-text-encoding-that-replace-a-byte-into-a-predefined-unique-string-in-g", "title": "binary-to-text encoding that replace a byte into a predefined unique string in golang", "body": "<p>I am trying to build a binary-to-text encoder with the ability to replace every byte into a predefined unique string and then use the same string set to decode back into binary.</p>\n\n<p>I am able to make the encoder and decoder for simple .txt files but I want to make this workable for .zip files too.</p>\n\n<p>Encoder :</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"bufio\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    // keys.json is a 256 words dictionary for every byte\n    keysFile, err := os.Open(\"keys.json\")\n    if err != nil {\n        log.Printf(\"unable to read keys.json file , error : %v\", err)\n        return\n    }\n\n    var keys []string\n\n    byteValue, _ := ioutil.ReadAll(keysFile)\n    if err := json.Unmarshal(byteValue, &amp;keys); err != nil {\n        log.Printf(\"unable to unmarshal array , error : %v\", err)\n        return\n    }\n\n    Encoder(keys)\n\n}\n\nfunc listFiles(file *zip.File) ([]byte, error) {\n    fileToRead, err := file.Open()\n    if err != nil {\n        msg := \"Failed to open zip %s for reading: %s\"\n        return nil, fmt.Errorf(msg, file.Name, err)\n    }\n    b := make([]byte, file.FileInfo().Size())\n    fileToRead.Read(b)\n\n    defer fileToRead.Close()\n\n    if err != nil {\n        return nil, fmt.Errorf(\"failed to read zip file : %s for reading , error : %s\", file.Name, err)\n    }\n\n    return b, nil\n}\n\nfunc Encoder(keys []string) {\n    read, err := zip.OpenReader(\"some.zip\")\n    if err != nil {\n        msg := \"Failed to open: %s\"\n        log.Fatalf(msg, err)\n    }\n    defer read.Close()\n\n    var encodedBytes []byte\n    f, err := os.Create(\"result.txt\")\n    w := bufio.NewWriter(f)\n\n    defer f.Close()\n    for _, file := range read.File {\n        readBytes, err := listFiles(file)\n        if err != nil {\n            log.Fatalf(\"Failed to read %s from zip: %s\", file.Name, err)\n            continue\n        }\n\n        for i, b := range readBytes {\n\n            for _, eb := range []byte(keys[b] + \" \") {\n                encodedBytes = append(encodedBytes, eb)\n            }\n\n        }\n\n    }\n    _, err = w.Write(encodedBytes)\n    if err != nil {\n        log.Printf(\"error :%v\", err)\n        return\n    }\n}\n</code></pre>\n\n<p>Decoder : </p>\n\n<pre><code>    func Decoder(keys []string) {\n    inputFile, err := os.Open(\"result.txt\")\n    if err != nil {\n        log.Printf(\"unable to read file , error : %v\", err)\n        return\n    }\n\n    inputBytes, _ := ioutil.ReadAll(inputFile)\n\n    var (\n        current []byte\n        decoded []byte\n    )\n\n    for _, c := range inputBytes {\n        if c != 32 {\n            current = append(current, c)\n        } else {\n\n            for i, key := range keys {\n                if string(current) == key {\n                    decoded = append(decoded, byte(i))\n                    break\n                }\n            }\n            current = []byte{}\n        }\n    }\n\n    // here i want the decoded back into zip file\n}\n</code></pre>\n\n<p><a href=\"https://github.com/44kia244/lorem-encode\" rel=\"nofollow noreferrer\">here</a> is a similar one in nodejs.</p>\n"}, {"tags": ["go", "connection"], "comments": [{"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571679652, "post_id": 58490552, "comment_id": 103313096, "body": "Can you check if the database connections are being opened in go-routines ?  Look for key <code>go</code> keyword in your code."}, {"owner": {"reputation": 1430, "user_id": 2079726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyHrO.jpg?s=128&g=1", "display_name": "Dmytro", "link": "https://stackoverflow.com/users/2079726/dmytro"}, "edited": false, "score": 1, "creation_date": 1571680177, "post_id": 58490552, "comment_id": 103313319, "body": "Make sure connection pooling is properly configured.  Take a look here: <a href=\"https://beego.me/docs/mvc/model/orm.md\" rel=\"nofollow noreferrer\">beego.me/docs/mvc/model/orm.md</a>     orm.RegisterDataBase has  2 additional parameters, except standard 1-3 for connection configuraiton, it has also maxIdle connections and maxConn (parameter 4 and 5, respectively). Make sure it&#39;s properly set. Also each RDBMS has possibility to check active connections. For instance, postgresql: select * from pg_stat_activity where datname = &#39;YOURDB&#39;; this way you can check if you&#39;re hitting connections limit for your backend, if you have access there."}, {"owner": {"reputation": 71, "user_id": 3168703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bae5ebdee158aab9f0bed5b24ff9ded?s=128&d=identicon&r=PG", "display_name": "Pedro Piter", "link": "https://stackoverflow.com/users/3168703/pedro-piter"}, "reply_to_user": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571697314, "post_id": 58490552, "comment_id": 103319554, "body": "@Auyer yes, there are go routines like this: <code>go visitor.TrackEvent(eventPayload, eventPayload.Event)</code>that open database connections in this way: \to := orm.NewOrm() \tvisitor := Visitor{TrackingCode: eventPayload.TrackingCode, Key: eventPayload.VisitorKey} \terr := o.Read(&amp;visitor, &quot;tracking_code&quot;, &quot;visitor_key&quot;)"}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 1430, "user_id": 2079726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyHrO.jpg?s=128&g=1", "display_name": "Dmytro", "link": "https://stackoverflow.com/users/2079726/dmytro"}, "edited": false, "score": 0, "creation_date": 1571697433, "post_id": 58490552, "comment_id": 103319583, "body": "@Dmytro Check my answer below. Hope it helps!"}], "answers": [{"tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 0, "last_activity_date": 1571680190, "creation_date": 1571680190, "answer_id": 58491681, "question_id": 58490552, "link": "https://stackoverflow.com/questions/58490552/check-open-connections-in-golang-legacy-code/58491681#58491681", "title": "Check open connections in golang legacy code", "body": "<p>This could be caused by too many connections being opened in various go-routines.\nIf this is the case, configure a worker pool to limit the amount of open files possible : <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">gobyexample worker pools</a></p>\n\n<p>Check this question <a href=\"https://stackoverflow.com/questions/32325343/go-tcp-too-many-open-files-debug\">\"Go, tcp too many open files debug\"</a>. The accepted answer may give you a fast solution, but it does not fix the main issue.</p>\n"}], "owner": {"reputation": 71, "user_id": 3168703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bae5ebdee158aab9f0bed5b24ff9ded?s=128&d=identicon&r=PG", "display_name": "Pedro Piter", "link": "https://stackoverflow.com/users/3168703/pedro-piter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 234, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571696681, "creation_date": 1571675552, "last_edit_date": 1571696681, "question_id": 58490552, "link": "https://stackoverflow.com/questions/58490552/check-open-connections-in-golang-legacy-code", "title": "Check open connections in golang legacy code", "body": "<p>We've recently gotten an app written in golang that stores information about visits in a database.</p>\n\n<p>We are facing the following error in this legacy code that is already in production:</p>\n\n<blockquote>\n  <p>http: Accept error: accept tcp [::]:8080: accept4: too many open\n  files; retrying in 1s</p>\n</blockquote>\n\n<p>We believe that this errors are caused by calls to the database that are getting opened, but can't find the point where this calls get stacked.</p>\n\n<p>Is there a way to check if there are database calls opened and where in the code are? </p>\n\n<p>We've seen that the code uses the <code>github.com/astaxie/beego/orm</code> library\nand the calls are made using <code>o := orm.NewOrm()</code> but we don't know where else to look for.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>The too many open files error appears when the total amount of open files for that process (<code>lsof -u myuser | grep \"10930\" | wc -l</code>) reaches 2048</p>\n\n<p>Also, the output of <code>lsof -u myuser | grep \"protocol: TCPv6\"</code> throws something like this:</p>\n\n<pre><code>ana     10930 myuser 3405u     sock       0,8      0t0 307230406 protocol: TCPv6\nana     10930 myuser 3407u     sock       0,8      0t0 307230465 protocol: TCPv6\nana     10930 myuser 3408u     sock       0,8      0t0 307231438 protocol: TCPv6\nana     10930 myuser 3427u     sock       0,8      0t0 307234900 protocol: TCPv6\nana     10930 myuser 3441u     sock       0,8      0t0 307236431 protocol: TCPv6\nana     10930 myuser 3446u     sock       0,8      0t0 307237446 protocol: TCPv6\nana     10930 myuser 3457u     sock       0,8      0t0 307239557 protocol: TCPv6\n</code></pre>\n\n<p>And the number of this sock connections is getting higher and higher.</p>\n\n<p>Does someone know what these connections are and why are they getting opened?</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571680545, "post_id": 58489777, "comment_id": 103313482, "body": "Is <code>settings-management-service</code> one of your deps ?"}, {"owner": {"reputation": 5, "user_id": 5310913, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206990369945156/picture?type=large", "display_name": "Anurag Beeram Naga", "link": "https://stackoverflow.com/users/5310913/anurag-beeram-naga"}, "reply_to_user": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1571769243, "post_id": 58489777, "comment_id": 103348415, "body": "No its not one if deps"}], "answers": [{"tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": true, "score": 1, "last_activity_date": 1571680941, "creation_date": 1571680941, "answer_id": 58491857, "question_id": 58489777, "link": "https://stackoverflow.com/questions/58489777/go-modules-management/58491857#58491857", "title": "Go Modules management", "body": "<p>First, try deleting your <code>vendor</code> folder, and then running <code>go mod vendor</code> again.</p>\n\n<p>If <code>settings-management-service</code> is a local dependency, check if you are importing it correctly.\nThe first line of your <code>go.mod</code> file should show the name of your module. Considering the name is <code>app</code>, and <code>settings-management-service</code> is a internal module, it should be imported as :</p>\n\n<pre><code>import \"app/settings-management-service\"\n</code></pre>\n\n<p>Do check if all deps are being downloaded correctly, and run <code>go mod download</code>.</p>\n"}], "owner": {"reputation": 5, "user_id": 5310913, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206990369945156/picture?type=large", "display_name": "Anurag Beeram Naga", "link": "https://stackoverflow.com/users/5310913/anurag-beeram-naga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "accepted_answer_id": 58491857, "answer_count": 1, "score": -1, "last_activity_date": 1571694625, "creation_date": 1571672737, "last_edit_date": 1571694625, "question_id": 58489777, "link": "https://stackoverflow.com/questions/58489777/go-modules-management", "title": "Go Modules management", "body": "<p>While I try to build I am getting the following error:</p>\n\n<pre><code>go.mod requires settings-management-service  but vendor/modules.txt does not include it.\nrun 'go mod tidy; go mod vendor' to sync\n</code></pre>\n\n<p>I tried running go mod tidy; go mod vendor, but didn't help.</p>\n"}, {"tags": ["go", "timezone", "dst"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1571671743, "post_id": 58489477, "comment_id": 103309314, "body": "Unfortunately all those details are held in unexported fields in the <code>time</code> package: <a href=\"https://golang.org/src/time/zoneinfo.go\" rel=\"nofollow noreferrer\">golang.org/src/time/zoneinfo.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 1, "creation_date": 1571693751, "post_id": 58491279, "comment_id": 103318654, "body": "The problem I have is not about loading (or switching between) time-zones. It&#39;s not even about re-implementing time-zones. It&#39;s about struggling to programmatically find the future day when a Daylight Saving Time (DST, the BST part of <code>Europe&#47;London</code>, the CEST part of <code>Europe&#47;Copenhagen</code>) will activate/deactivate. The Go standard library provides some functionality via the links you and I posted, but it does not seem to be rich enough to assist on DST, so I was wondering if either I was missing something from the docs or I really had to implement that functionality myself (like I did)."}, {"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "reply_to_user": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 1, "creation_date": 1571694429, "post_id": 58491279, "comment_id": 103318843, "body": "I see.  I guess I misunderstood your question.  You&#39;re really after the array of <code>zoneTrans</code> objects in the unexported <code>Location.tx</code> field.  (See the link Adrian referenced in your question).  Not sure how you would get at it.  Seems like missing functionality."}], "tags": [], "owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "is_accepted": false, "score": 1, "last_activity_date": 1571678435, "creation_date": 1571678435, "answer_id": 58491279, "question_id": 58489477, "link": "https://stackoverflow.com/questions/58489477/find-next-daylight-savings-dates-by-time-zone-bst-gmt-cet-cest-etc/58491279#58491279", "title": "Find next daylight savings dates by time-zone (BST/GMT, CET/CEST, etc.)", "body": "<p>Go already has full <a href=\"https://en.wikipedia.org/wiki/Tz_database\" rel=\"nofollow noreferrer\">IANA TZDB</a> support via <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\"><code>time.LoadLocation</code></a>.  Use <code>Europe/London</code> for the UK, <code>Europe/Copenhagen</code> for CET/CEST in Denmark, etc.  See <a href=\"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\" rel=\"nofollow noreferrer\">the list here</a>.</p>\n\n<p>You should not re-implement time zone logic yourself.  As Tom Scott aptly quips in <a href=\"https://youtu.be/-5wpm-gesOY\" rel=\"nofollow noreferrer\">The Problem with Time &amp; Timezones</a> - <em>\"That way lies madness.\"</em></p>\n"}, {"comments": [{"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1571738321, "post_id": 58495596, "comment_id": 103332098, "body": "This <code>zdump</code> commands seems quite useful (e.g. for <code>zdump &quot;Europe&#47;London&quot; -c 2020,2021 -V</code> or <code>zdump &quot;Europe&#47;Copenhagen&quot; -c 2020,2021 -V</code>). It seems to be working only on Linux, is there an equivalent version for Windows?"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1571703576, "creation_date": 1571703576, "answer_id": 58495596, "question_id": 58489477, "link": "https://stackoverflow.com/questions/58489477/find-next-daylight-savings-dates-by-time-zone-bst-gmt-cet-cest-etc/58495596#58495596", "title": "Find next daylight savings dates by time-zone (BST/GMT, CET/CEST, etc.)", "body": "<p>Depending on your situation, it may be practical to call out to <a href=\"https://linux.die.net/man/8/zdump\" rel=\"nofollow noreferrer\">zdump</a> instead, and parse the response.</p>\n\n<p>For example, to list daylight saving transitions for Pacific/Auckland timezone:</p>\n\n<pre><code>zdump \"Pacific/Auckland\" -c 2020,2022 -V\n</code></pre>\n\n<p>Results show NZDT (daylight time) or NZST (standard time), and 'isdst' flag:</p>\n\n<pre><code>Pacific/Auckland  Sat Apr  4 13:59:59 2020 UT = Sun Apr  5 02:59:59 2020 NZDT isdst=1 gmtoff=46800\nPacific/Auckland  Sat Apr  4 14:00:00 2020 UT = Sun Apr  5 02:00:00 2020 NZST isdst=0 gmtoff=43200\nPacific/Auckland  Sat Sep 26 13:59:59 2020 UT = Sun Sep 27 01:59:59 2020 NZST isdst=0 gmtoff=43200\nPacific/Auckland  Sat Sep 26 14:00:00 2020 UT = Sun Sep 27 03:00:00 2020 NZDT isdst=1 gmtoff=46800\nPacific/Auckland  Sat Apr  3 13:59:59 2021 UT = Sun Apr  4 02:59:59 2021 NZDT isdst=1 gmtoff=46800\n</code></pre>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1571703576, "creation_date": 1571671572, "question_id": 58489477, "link": "https://stackoverflow.com/questions/58489477/find-next-daylight-savings-dates-by-time-zone-bst-gmt-cet-cest-etc", "title": "Find next daylight savings dates by time-zone (BST/GMT, CET/CEST, etc.)", "body": "<p>According to the rules of British Summer Time (BST) / daylight saving time (DST) (<a href=\"https://www.gov.uk/when-do-the-clocks-change\" rel=\"nofollow noreferrer\">https://www.gov.uk/when-do-the-clocks-change</a>) the clocks:</p>\n\n<ul>\n<li>go forward 1 hour at 1am on the last Sunday in March (beginning of BST),</li>\n<li>go back 1 hour at 2am on the last Sunday in October (beginning of Greenwich Mean Time GMT = Universal Time Coordinated UTC).</li>\n</ul>\n\n<p>In 2019 this civil local time change happens on March 31st and October 27th, but the days slightly change every year.</p>\n\n<p>A similar DST rule applies to Central European Time CET (Winter) > CEST (Summer) checking the last Sunday of March/October (<a href=\"https://www.timeanddate.com/time/change/denmark/copenhagen\" rel=\"nofollow noreferrer\">https://www.timeanddate.com/time/change/denmark/copenhagen</a>). The combination of these BST/GMT and CET/CEST rules affect e.g. all the countries around the North Sea. Regardless BST/GMT, or CET/CEST, the UTC timestamp underneath should be the same.</p>\n\n<p>I've written the following code based on <code>time.UTC</code> providing the dates for BST/GMT, but I am wondering if there is a simpler / more general way to use an arbitrary <code>time.Location</code> that could be applicable to CET/CEST and (ideally) any DST rule. </p>\n\n<ul>\n<li>Checking the docs (here <a href=\"https://golang.org/pkg/time/#FixedZone\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#FixedZone</a>) it seems that <code>time.FixedZone</code> should deal with invariant time-zones, but what's the <code>offset</code> in there? How can I make the following functions invariant from the time-zone?</li>\n<li>Is there a way to avoid that <code>for</code> loop on the Sunday(s) of the month?</li>\n<li>Is there a way to avoid an hard-coded <code>map</code> based on BST/GMT or CET/CEST and the month, to find out the next clock change?</li>\n</ul>\n\n<p>The code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func beginOfMonth(year, month int, loc *time.Location) time.Time {\n    return time.Date(year, time.Month(month), 1, 0, 0, 0, 0, loc)\n}\n\n// https://www.gov.uk/when-do-the-clocks-change\nfunc lastUTCSunday(year, month int) time.Time {\n    beginOfMonth := beginOfMonth(year, month, time.UTC)\n    // we can find max 5 sundays in a month\n    sundays := make([]time.Time, 5)\n    for d := 1; d &lt;= 31; d++ {\n        currDay := beginOfMonth.Add(time.Duration(24*d) * time.Hour)\n        if currDay.Weekday().String() == \"Sunday\" {\n            sundays = append(sundays, currDay)\n        }\n        if currDay.Month() != beginOfMonth.Month() {\n            break\n        }\n    }\n    // check if last date is same month\n    if sundays[len(sundays)-1].Month() == beginOfMonth.Month() {\n        // the 5th sunday\n        return sundays[len(sundays)-1]\n    }\n    // if not like before, then we only have 4 Sundays\n    return sundays[len(sundays)-2]\n}\n\n// https://www.gov.uk/when-do-the-clocks-change\nfunc MarchClockSwitchTime(year int) time.Time {\n    lastSunday := lastUTCSunday(year, int(time.March)) // month: 3\n    return time.Date(\n        year, lastSunday.Month(), lastSunday.Day(),\n        1, 0, 0, 0, // 1:00 AM\n        lastSunday.Location(),\n    )\n}\n\n// https://www.gov.uk/when-do-the-clocks-change\nfunc OctoberClockSwitchTime(year int) time.Time {\n    lastSunday := lastUTCSunday(year, int(time.October)) // month: 10\n    return time.Date(\n        year, lastSunday.Month(), lastSunday.Day(),\n        2, 0, 0, 0, // 2:00 AM\n        lastSunday.Location(),\n    )\n}\n\n</code></pre>\n\n<p>I've also written some tests using GoConvey that should validate these weird Daylight saving (DST) rules based Sundays, but they work just for 2019, 2020. It would be good to find a way to make this code more general.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestLastSunday(t *testing.T) {\n    Convey(\"Should find the last UTC Sunday of each month\\n\\n\", t, func() {\n        for year := 2019; year &lt;= 2020; year++ {\n            for month := 1; month &lt;= 12; month++ {\n                lastUtcSunday := lastUTCSunday(year, month)\n\n                So(lastUtcSunday.Month(), ShouldEqual, time.Month(month))\n                So(lastUtcSunday.Weekday().String(), ShouldEqual, \"Sunday\")\n                So(lastUtcSunday.Year(), ShouldEqual, year)\n                So(lastUtcSunday.Day(), ShouldBeGreaterThanOrEqualTo, 28-7)\n            }\n        }\n    })\n}\n\n// https://www.gov.uk/when-do-the-clocks-change\nfunc TestClockChange(t *testing.T) {\n    Convey(\"Should find the last UTC Sunday for the March switch\\n\\n\", t, func() {\n        switch2019 := MarchClockSwitchTime(2019)\n        So(switch2019.Month(), ShouldEqual, time.March)\n        So(switch2019.Weekday().String(), ShouldEqual, \"Sunday\")\n        So(switch2019.Day(), ShouldEqual, 31)\n        So(switch2019.Location().String(), ShouldEqual, \"UTC\")\n        So(switch2019.Location().String(), ShouldEqual, time.UTC.String())\n\n        switch2020 := MarchClockSwitchTime(2020)\n        So(switch2020.Month(), ShouldEqual, time.March)\n        So(switch2020.Weekday().String(), ShouldEqual, \"Sunday\")\n        So(switch2020.Day(), ShouldEqual, 29)\n        So(switch2020.Location().String(), ShouldEqual, \"UTC\")\n        So(switch2020.Location().String(), ShouldEqual, time.UTC.String())\n    })\n    Convey(\"Should find the last UTC Sunday for the October switch\\n\\n\", t, func() {\n        switch2019 := OctoberClockSwitchTime(2019)\n        So(switch2019.Month(), ShouldEqual, time.October)\n        So(switch2019.Weekday().String(), ShouldEqual, \"Sunday\")\n        So(switch2019.Day(), ShouldEqual, 27)\n        So(switch2019.Location().String(), ShouldEqual, \"UTC\")\n        So(switch2019.Location().String(), ShouldEqual, time.UTC.String())\n\n        switch2020 := OctoberClockSwitchTime(2020)\n        So(switch2020.Month(), ShouldEqual, time.October)\n        So(switch2020.Weekday().String(), ShouldEqual, \"Sunday\")\n        So(switch2020.Day(), ShouldEqual, 25)\n        So(switch2020.Location().String(), ShouldEqual, \"UTC\")\n        So(switch2020.Location().String(), ShouldEqual, time.UTC.String())\n    })\n}\n</code></pre>\n"}, {"tags": ["go", "cryptography"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 5, "creation_date": 1571671197, "post_id": 58489304, "comment_id": 103309023, "body": "the question is: to do what ?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 3, "creation_date": 1571672511, "post_id": 58489304, "comment_id": 103309745, "body": "In other words: Do you want to combine the hashes just because you want to combine these or is there a specific use case where you need this combination. What you should do depends on your specific (and unknown) use case. And especially if you ask how to handle it in a cryptographic proper way details about the use case are essential."}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 4072545, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mZ1sl4dt2o0/AAAAAAAAAAI/AAAAAAAAAOQ/tFZIab6RjR4/photo.jpg?sz=128", "display_name": "william butler", "link": "https://stackoverflow.com/users/4072545/william-butler"}, "is_accepted": false, "score": 3, "last_activity_date": 1571671775, "creation_date": 1571671775, "answer_id": 58489523, "question_id": 58489304, "link": "https://stackoverflow.com/questions/58489304/how-to-combine-sha-hashes/58489523#58489523", "title": "How to combine sha hashes?", "body": "<p>Try taking your SHA256 hashes that you have already and put them in a string.  Then hash that string using SHA256 or the Algorithm of your choice.  Alternatively, you could string together your original chucks of data and then hash that.  But I think its quicker and cleaner to just \"hash the hashes\".  </p>\n"}, {"comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1571673444, "post_id": 58489887, "comment_id": 103310215, "body": "Keep in mind that many hashing libraries do not support capturing or restoring intermediate state, so you&#39;ll probably have to modify an existing piece of code or implement the hashing algorithm by hand. (Great answer, readers may just assume that this is easy.)"}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 0, "creation_date": 1571673641, "post_id": 58489887, "comment_id": 103310311, "body": "I think this may be what I&#39;m looking for. Do you know how large the hash state is for sha256?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1571673753, "post_id": 58489887, "comment_id": 103310384, "body": "32 bytes (for SHA-256 this happens to be the same size as the final hash, but that isn&#39;t universal)"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1571673821, "post_id": 58489887, "comment_id": 103310422, "body": "I&#39;ll update the answer with on how to resume hash summing, after lunch...."}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 0, "creation_date": 1571689673, "post_id": 58489887, "comment_id": 103317222, "body": "Looks like this can be done in Go since it implements <code>encoding.BinaryMarshaler</code> and <code>encoding.BinaryUnmarshaler</code> to marshal and unmarshal the internal state of the hash: <a href=\"https://golang.org/src/crypto/sha256/sha256.go#L161\" rel=\"nofollow noreferrer\">golang.org/src/crypto/sha256/sha256.go#L161</a>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 0, "creation_date": 1571690025, "post_id": 58489887, "comment_id": 103317363, "body": "@Eloff yes... but there&#39;s a catch. Unfortunately the <code>digest</code> struct is not public (lowercase <code>d</code>). And <code>sha256.New()</code> returns the <i>interface</i> <code>hash.Hash</code> - and <i>not</i> the <code>digest</code> value directly. So one would need to copy the digest source into their own project to be able to invoke the binary marshalers. Doable, but more involved than I had anticipated."}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 1, "creation_date": 1571690284, "post_id": 58489887, "comment_id": 103317473, "body": "Actually it looks easier than that, I had a second look, what you would need to do is cast the returned hash.Hash interface to <code>encoding.BinaryMarshaler</code> and <code>encoding.BinaryUnmarshaler</code>, this is allowed for stdlib hashers according to: <a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\">golang.org/pkg/hash/#Hash</a>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 1, "creation_date": 1571694541, "post_id": 58489887, "comment_id": 103318865, "body": "@Eloff interesting! I&#39;ve update the answer with a working example including this discovery."}, {"owner": {"reputation": 10928, "user_id": 1358308, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d9448dee25fd2278def77cb7f0353574?s=128&d=identicon&r=PG", "display_name": "Sam Mason", "link": "https://stackoverflow.com/users/1358308/sam-mason"}, "edited": false, "score": 0, "creation_date": 1573646982, "post_id": 58489887, "comment_id": 103948109, "body": "this construction seems unnecessarily weak (from a crypto PoV), I&#39;d recommend using something like a merkle tree.  exposing internal state like this will &quot;break&quot; various hash schemes.  the finalisation/output function of SHA2 just concatenates the internal state variables so is probably safe, but this would break SHA3.  I&#39;d also recommend looking at HMACs and their attacks if you care about integrity/authenticity"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 5, "last_activity_date": 1571695648, "last_edit_date": 1571695648, "creation_date": 1571673094, "answer_id": 58489887, "question_id": 58489304, "link": "https://stackoverflow.com/questions/58489304/how-to-combine-sha-hashes/58489887#58489887", "title": "How to combine sha hashes?", "body": "<p>If you are trying to recreate the hash of a large payload (e.g. 1GB file) that has been split into chunks (e.g. 10MBs in size), the hash (MD5, SHA-256 etc.) needs to be computed on the entire collection. So using this example, you cannot <em>add</em> the 100 chunked hashes to recreate the hash of the original file. However...</p>\n\n<p>You could send 2 values with each chunk:</p>\n\n<ul>\n<li>the individual chunk's hash (like you are doing now)</li>\n<li>the intermediate hash <em>state</em>, as your service sweeps through the file to create each chunk payload: at the beginning and end of the chunk</li>\n</ul>\n\n<p>As the chunks are streamed in, one can verify the seams of the hash state at the end of chunk <code>N</code> matches that of the hash state at the beginning of chunk <code>N+1</code>.</p>\n\n<p>The final hash state of the final chunk will be the hash for the entire payload.</p>\n\n<p>Why do it like this? Because the hash can be computed in realtime as the file chunks are received - rather as a separate time-consuming process - after all the file chunks have been received.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> based on comments:</p>\n\n<p>Here's a crude state hash state solution:</p>\n\n<p>Create a large random file (100MB):</p>\n\n<pre><code>dd if=/dev/urandom of=large.bin bs=1048576 count=100\n</code></pre>\n\n<p>Using an external tool to verify hash:</p>\n\n<pre><code>$ shasum -a 256 large.bin \n4cc76e41bbd82a05f97fc03c7eb3d1f5d98f4e7e24248d7944f8caaf8dc55c5c  large.bin\n</code></pre>\n\n<p>Running this <a href=\"https://play.golang.org/p/C1DrwdJX3wK\" rel=\"nofollow noreferrer\">playground code</a> on the above file.</p>\n\n<pre><code>...\n...\n...\noffset: 102760448   hash: 8ae7928735716a60ae0c4e923b8f0db8f33a5b89f6b697093ea97f003c85bb56  state: 736861032a24f8927fc4aa17527e1919aba8ea40c0407d5452c752a82a99c06149fd8d35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006200000\noffset: 103809024   hash: fbbfd2794cd944b276a04a89b49a5e2c8006ced9ff710cc044bed949fee5899f  state: 73686103bdde167db6a5b09ebc69a5abce51176e635add81e190aa64edceb280f82d6c08000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006300000\noffset: 104857600   hash: 4cc76e41bbd82a05f97fc03c7eb3d1f5d98f4e7e24248d7944f8caaf8dc55c5c  state: 73686103c29dbc4aaaa7aa1ce65b9dfccbf0e3a18a89c95fd50c1e02ac1c73271cfdc3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006400000\n</code></pre>\n\n<p>the final hash matches.</p>\n\n<p>Trying with an offset and intermediate hash-state. The file will be <code>seeked</code> to this offset, resuming the hash calculation from that point:</p>\n\n<pre><code>$ ./hash -o 102760448 -s \"736861032a24f8927fc4aa17527e1919aba8ea40c0407d5452c752a82a99c06149fd8d35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006200000\"\noffset:  103809024  hash: fbbfd2794cd944b276a04a89b49a5e2c8006ced9ff710cc044bed949fee5899f  state: 73686103bdde167db6a5b09ebc69a5abce51176e635add81e190aa64edceb280f82d6c08000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006300000\noffset:  104857600  hash: 4cc76e41bbd82a05f97fc03c7eb3d1f5d98f4e7e24248d7944f8caaf8dc55c5c  state: 73686103c29dbc4aaaa7aa1ce65b9dfccbf0e3a18a89c95fd50c1e02ac1c73271cfdc3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006400000\n</code></pre>\n\n<p>we get the same final hash as before.</p>\n\n<p>Note: this does expose the hash internal state, so be mindful of the <a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\">security implications</a> this may entail. With a large chunk-size, this should not be an issue.</p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 4, "last_activity_date": 1571676144, "creation_date": 1571676144, "answer_id": 58490706, "question_id": 58489304, "link": "https://stackoverflow.com/questions/58489304/how-to-combine-sha-hashes/58490706#58490706", "title": "How to combine sha hashes?", "body": "<blockquote>\n  <p>edit: The purpose of this is to form a sort of a blockchain although\n  that term is pretty overloaded these days. It's for integrity\n  purposes, not proof of work. The idea is hash the blocks at the\n  follower nodes, combine the hashes into one on the cluster leader to\n  have a hash representing the chain as a whole, and then prepend that\n  to the new blocks to be hashed.</p>\n</blockquote>\n\n<p>this look like a <code>merkle tree</code></p>\n\n<p><a href=\"https://brilliant.org/wiki/merkle-tree/\" rel=\"nofollow noreferrer\">https://brilliant.org/wiki/merkle-tree/</a></p>\n\n<blockquote>\n  <p>A Merkle tree is a hash-based data structure that is a generalization\n  of the hash list. It is a tree structure in which each leaf node is a\n  hash of a block of data, and each non-leaf node is a hash of its\n  children. Typically, Merkle trees have a branching factor of 2,\n  meaning that each node has up to 2 children.</p>\n  \n  <p>Merkle trees are used in distributed systems for efficient data\n  verification. They are efficient because they use hashes instead of\n  full files. Hashes are ways of encoding files that are much smaller\n  than the actual file itself. Currently, their main uses are in\n  peer-to-peer networks such as Tor, Bitcoin, and Git.</p>\n</blockquote>\n\n<p>Have a look to that implementation <a href=\"https://github.com/cbergoon/merkletree\" rel=\"nofollow noreferrer\">https://github.com/cbergoon/merkletree</a></p>\n"}], "owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "accepted_answer_id": 58489887, "answer_count": 3, "score": 2, "last_activity_date": 1571695648, "creation_date": 1571670952, "last_edit_date": 1571673543, "question_id": 58489304, "link": "https://stackoverflow.com/questions/58489304/how-to-combine-sha-hashes", "title": "How to combine sha hashes?", "body": "<p>I have ordered chunks of data, each hashed individually with sha256. I want to combine those hashes into one sha256 hash. Should I just feed the hashes into sha256 as data, or is there another way that's better from a math/crypto standpoint? It might seem like a trivial question, but intuitions are often wrong when it comes to crypto.</p>\n\n<p><em>edit</em>: The purpose of this is to form a sort of a blockchain although that term is pretty overloaded these days. It's for integrity purposes, not proof of work. The idea is hash the blocks at the follower nodes, combine the hashes into one on the cluster leader to have a hash representing the chain as a whole, and then prepend that to the new blocks to be hashed.</p>\n\n<p>It's a little odd in that it's a distributed system so \"whole chain hash\" is usually a little stale so I know what the hash representing the chain, as known to that node, when the block was created at that node, but there could be several blocks that \"hook onto the chain\" at that particular hash, and then those are ordered and combined into the system hash which gets prepended to new blocks eventually.</p>\n\n<p>I'm using Go, if that matters.</p>\n"}, {"tags": ["go", "elasticsearch"], "answers": [{"tags": [], "owner": {"reputation": 7973, "user_id": 290460, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XsEDl.jpg?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/290460/rob"}, "is_accepted": true, "score": 2, "last_activity_date": 1571674757, "creation_date": 1571674757, "answer_id": 58490334, "question_id": 58489249, "link": "https://stackoverflow.com/questions/58489249/elasticsearch-in-golang-returns-no-results-using-olivere-elastic-package/58490334#58490334", "title": "Elasticsearch in golang returns no results using olivere/elastic package", "body": "<p>I think you should go with <code>NewMatchQuery</code> in your case, as said in docs for <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html\" rel=\"nofollow noreferrer\">term query</a></p>\n\n<blockquote>\n  <p>Avoid using the term query for text fields.</p>\n  \n  <p>By default, Elasticsearch changes the values of text fields as part of\n  analysis. This can make finding exact matches for text field values\n  difficult.</p>\n  \n  <p>To search text field values, use the match query instead.</p>\n</blockquote>\n\n<p>You didn't share sample documents you indexed and what are you trying to find, but something like below should help in your case</p>\n\n<pre><code>query := NewMatchQuery(\"title\", \"Hello there\")\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 247, "user_id": 8928435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39ae19f029b39d6cf105485ebdb8bf5a?s=128&d=identicon&r=PG", "display_name": "ahmetovicajdin", "link": "https://stackoverflow.com/users/8928435/ahmetovicajdin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 1, "accepted_answer_id": 58490334, "answer_count": 1, "score": 0, "last_activity_date": 1571674757, "creation_date": 1571670737, "question_id": 58489249, "link": "https://stackoverflow.com/questions/58489249/elasticsearch-in-golang-returns-no-results-using-olivere-elastic-package", "title": "Elasticsearch in golang returns no results using olivere/elastic package", "body": "<p>I am trying to implement elasticsearch in my go application. I am using <a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic</a> library for go and elasticsearch is running in docker container.</p>\n\n<p>I successfully connected to elasticsearch and create index, after that I tried to save data to elasticsearch that was also successful. I started getting problems when I was running queries </p>\n\n<p>My mapping looks like this </p>\n\n<pre><code>    \"mappings\":{\n        \"item\":{\n            \"properties\":{\n                \"id\":{\n                    \"type\":\"integer\"\n                },\n                \"title\":{\n                    \"type\":\"text\"\n                },\n                \"description\":{\n                    \"type\":\"text\"\n                },\n                \"userid\":{\n                    \"type\":\"integer\"\n                }\n            }\n        }\n    }\n\n</code></pre>\n\n<p>I am trying to query es by title like this and I get empty response.\nIf I Remove query from my Search() es lists all items saved.\nI tried also combining with newBoolQuery and newMatchPhrase it was also returning empty response.</p>\n\n<pre><code>query := elastic.NewTermQuery(\"title\", \"Hello there\")\nsearchResult, err := elasticClient.Search().\n    Index(\"items\").\n    Query(query).\n    Pretty(true).\n    Do(ctx)\nif err != nil {\n    return nil, err\n}\nreturn searchResult, nil\n</code></pre>\n\n<p>Response :</p>\n\n<pre><code> {\n    \"id\": 81,\n    \"message\": \"Search successfull\",\n    \"data\": {\n        \"took\": 1,\n        \"_scroll_id\": \"\",\n        \"hits\": {\n            \"total\": 0,\n            \"max_score\": null,\n            \"hits\": []\n        },\n        \"suggest\": null,\n        \"aggregations\": null,\n        \"timed_out\": false,\n        \"_shards\": {\n            \"total\": 1,\n            \"successful\": 1,\n            \"failed\": 0\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["java", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571669015, "post_id": 58488710, "comment_id": 103307820, "body": "It could be any number of factors, from the implementation, to the runtime, to the context of the benchmark (for example, cold boot performance is often a problem for Java applications). &quot;Why is program A faster than program B&quot; is going to be far too broad a question to answer here."}, {"owner": {"reputation": 37983, "user_id": 1843331, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aVX5R.jpg?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/1843331/tim"}, "edited": false, "score": 0, "creation_date": 1571669140, "post_id": 58488710, "comment_id": 103307898, "body": "it probably does not matter here, but consider that java 8 is years older than go 1.9.3"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10299367, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--pCxlDr_uG8/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaM2fV1wylemOxxqiCrF5SqysKYCYg/mo/photo.jpg?sz=128", "display_name": "xu py", "link": "https://stackoverflow.com/users/10299367/xu-py"}, "edited": false, "score": 0, "creation_date": 1571669362, "post_id": 58488789, "comment_id": 103308023, "body": "So the answer is close to the JAVA framework doing too much in this case"}, {"owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "reply_to_user": {"reputation": 23, "user_id": 10299367, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--pCxlDr_uG8/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaM2fV1wylemOxxqiCrF5SqysKYCYg/mo/photo.jpg?sz=128", "display_name": "xu py", "link": "https://stackoverflow.com/users/10299367/xu-py"}, "edited": false, "score": 1, "creation_date": 1571670063, "post_id": 58488789, "comment_id": 103308403, "body": "@xupy Frameworks do what they are designed for. When <i>you</i> decide to compare a pickup truck against a sportscar, then <i>you</i> shouldn&#39;t be surprised that the sportscar is faster. But that one  can transport 20 or 30 times more &quot;stuff&quot; using the pickup truck."}, {"owner": {"reputation": 33440, "user_id": 1831987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=128&d=identicon&r=PG", "display_name": "VGR", "link": "https://stackoverflow.com/users/1831987/vgr"}, "edited": false, "score": 0, "creation_date": 1571672471, "post_id": 58488789, "comment_id": 103309721, "body": "<a href=\"https://docs.oracle.com/javaee/7/api/javax/xml/ws/Endpoint.html\" rel=\"nofollow noreferrer\">Endpoint</a> and <a href=\"https://docs.oracle.com/javaee/7/api/javax/xml/ws/Provider.html\" rel=\"nofollow noreferrer\">Provider</a> are probably the simplest way to implement a barebones web service."}], "tags": [], "owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "is_accepted": true, "score": 5, "last_activity_date": 1571670117, "last_edit_date": 1571670117, "creation_date": 1571669160, "answer_id": 58488789, "question_id": 58488710, "link": "https://stackoverflow.com/questions/58488710/java-and-golang-http-performance-compare/58488789#58488789", "title": "Java and Golang http performance compare", "body": "<p>Here, you are comparing: </p>\n\n<blockquote>\n  <p>Springboot2.1.7.RELEASE</p>\n</blockquote>\n\n<p>against:</p>\n\n<blockquote>\n  <p>Golang environment: go1.9.3</p>\n</blockquote>\n\n<p>And your Go code puts up a minimalistic HTTP service. Whereas your Java solution seems to go with a \"full fledged\" Spring boot instance.</p>\n\n<p>Which is like: comparing a single apple against a <em>truckload</em> of melons. </p>\n\n<p>In other words: in order to get to meaningful numbers, you should compare \"about equal\" context. Spring boot is \"much\" more than a simple HTTP server (well, unless you strip it down to just be that).</p>\n\n<p>Meaning: I would suggest to not go with Spring boot, but the most \"minimalistic\" http server/framework you can find for java. </p>\n"}], "owner": {"reputation": 23, "user_id": 10299367, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--pCxlDr_uG8/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaM2fV1wylemOxxqiCrF5SqysKYCYg/mo/photo.jpg?sz=128", "display_name": "xu py", "link": "https://stackoverflow.com/users/10299367/xu-py"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "closed_date": 1571669625, "accepted_answer_id": 58488789, "answer_count": 1, "score": -4, "last_activity_date": 1571670117, "creation_date": 1571668884, "question_id": 58488710, "link": "https://stackoverflow.com/questions/58488710/java-and-golang-http-performance-compare", "closed_reason": "Needs more focus", "title": "Java and Golang http performance compare", "body": "<p>I recently started using golang, and I did a test to compare the performance of java and golang http calls; I was surprised to find that golang is much faster than java, and sometimes it takes almost no time to call another service from one service. I am curious that this is due to the nature of the language or is the java framework doing too much to make it slower?</p>\n\n<p>JAVA environment:</p>\n\n<p>JDK1.8</p>\n\n<p>Springboot2.1.7.RELEASE</p>\n\n<p>Golang environment:</p>\n\n<p>go1.9.3</p>\n\n<h1>JAVA service1(LISTEN 10006 PORT):</h1>\n\n<pre><code>        @GetMapping(\"/hello\")\n    public String hello(String name) {\n        log.info(\"in\");\n        String result = restTemplate.getForObject(\"http://localhost:10007/hello?name=\" + name, String.class);\n        log.info(\"out\");\n        return result;\n    }\n</code></pre>\n\n<h1>JAVA service2(LISTEN 10007 PORT):</h1>\n\n<pre><code>    @GetMapping(\"/hello\")\n    public String hello(String name) {\n        log.info(\"in\");\n        return \"Hello \" + name;\n    }\n</code></pre>\n\n<h1>Golang service1(LISTEN 10008 PORT):</h1>\n\n<pre><code>        func main() {\n           fmt.Println(\"start\")\n           http.HandleFunc(\"/hello\", DefaultHandler)\n           err := http.ListenAndServe(\":10008\", nil)\n           if err != nil {\n            fmt.Errorf(\"error: %s\", err)\n           }\n        }\n        func DefaultHandler(w http.ResponseWriter, r *http.Request) {\n           name := r.FormValue(\"name\")\n           fmt.Printf(\"%s, %s\\r\\n\", time.Now(), \"in\")\n           resp, _ := http.Get(\"http://localhost:10009/hello?name=\" + name)\n           body, _ := ioutil.ReadAll(resp.Body)\n           defer resp.Body.Close()\n           fmt.Printf(\"%s, %s\\r\\n\", time.Now(), \"out\")\n           w.Write(body)\n}\n</code></pre>\n\n<h1>Golang service2(LISTEN 10009 PORT):</h1>\n\n<pre><code>        func main() {\n           fmt.Println(\"start\")\n           http.HandleFunc(\"/hello\", DefaultHandler)\n           err := http.ListenAndServe(\":10009\", nil)\n           if err != nil {\n             fmt.Errorf(\"error: %s\", err)\n           }\n        }\n        func DefaultHandler(w http.ResponseWriter, r *http.Request) {\n           fmt.Printf(\"%s, %s\\r\\n\", time.Now(), \"in\")\n           name := r.FormValue(\"name\")\n           w.Write([]byte(\"Hello \" + name))\n        }\n</code></pre>\n\n<p>I used browser to send request like this:</p>\n\n<p><a href=\"http://localhost:10006/hello?name=tom\" rel=\"nofollow noreferrer\">http://localhost:10006/hello?name=tom</a></p>\n\n<p><a href=\"http://localhost:10008/hello?name=tom\" rel=\"nofollow noreferrer\">http://localhost:10008/hello?name=tom</a></p>\n\n<p>The result is mostly like the following</p>\n\n<p>JAVA service1\uff1a</p>\n\n<p>2019-10-21 22:04:46.406  INFO 16936 --- [ XNIO-1 task-12] com.web.test6.controller.TestCtrl        : in</p>\n\n<p>2019-10-21 22:04:46.412  INFO 16936 --- [ XNIO-1 task-12] com.web.test6.controller.TestCtrl        : out</p>\n\n<p>JAVA service2\uff1a</p>\n\n<p>2019-10-21 22:04:46.410  INFO 16200 --- [  XNIO-1 task-6] com.web.test7.controller.TestCtrl        : in</p>\n\n<p>Golang service1:</p>\n\n<p>2019-10-21 22:06:36.1888823 +0800 CST m=+1438.272728801, in</p>\n\n<p>2019-10-21 22:06:36.1888823 +0800 CST m=+1438.272728801, out</p>\n\n<p>Golang service2:</p>\n\n<p>2019-10-21 22:06:36.1888823 +0800 CST m=+1436.497480201, in</p>\n"}, {"tags": ["c++", "sockets", "go", "tcp", "base64"], "comments": [{"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 2, "creation_date": 1571668932, "post_id": 58488574, "comment_id": 103307780, "body": "<code>recv</code> does not necessarily give back as many bytes as will fit in the buffer - the function returns the number of bytes actually returned as its result. You should account for that where you currently do <code>output+=buffer;</code>."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1571669564, "post_id": 58488574, "comment_id": 103308128, "body": "<code>char buffer[bufferSize];</code> -- This is not valid C++.  Use <code>std::vector&lt;char&gt; buffer(bufferSize);</code>"}, {"owner": {"reputation": 366, "user_id": 5473004, "user_type": "registered", "profile_image": "https://graph.facebook.com/923112464409335/picture?type=large", "display_name": "Philippe Thomassigny", "link": "https://stackoverflow.com/users/5473004/philippe-thomassigny"}, "edited": false, "score": 0, "creation_date": 1571670014, "post_id": 58488574, "comment_id": 103308374, "body": "see <a href=\"https://stackoverflow.com/questions/4840535/c-recv-problem\">stackoverflow.com/questions/4840535/c-recv-problem</a>  you may have the same problem because you write the information on the same buffer. (you are never sure to have 100% of the message into the buffer when the function returns, so you have to add it to a &quot;full message buffer&quot;)"}, {"owner": {"reputation": 366, "user_id": 5473004, "user_type": "registered", "profile_image": "https://graph.facebook.com/923112464409335/picture?type=large", "display_name": "Philippe Thomassigny", "link": "https://stackoverflow.com/users/5473004/philippe-thomassigny"}, "edited": false, "score": 1, "creation_date": 1571670157, "post_id": 58488574, "comment_id": 103308445, "body": "You may also have another problem: since the message is never totally into the buffer, you may have a truncated &quot;&lt;EOF&gt;&quot; into the buffer so you will never find it (C++  is faster that network so you may hay a function return every 2-3 characters ;)"}, {"owner": {"reputation": 10901, "user_id": 1076479, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/eLQUX.jpg?s=128&g=1", "display_name": "Gil Hamilton", "link": "https://stackoverflow.com/users/1076479/gil-hamilton"}, "edited": false, "score": 0, "creation_date": 1571672808, "post_id": 58488574, "comment_id": 103309890, "body": "Another issue: following the <code>recv</code> call, <code>if (iResult == 0) { continue; }</code> is wrong. The <i>only</i> time you will get a return value of zero is if/when your peer has disconnected. By using <code>continue</code>, you&#39;ll then just repeat the <code>recv</code>, which will simply return 0 again, resulting in an infinite loop."}, {"owner": {"reputation": 13, "user_id": 12251951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a863238240d33a04fdef39dd17650e2?s=128&d=identicon&r=PG&f=1", "display_name": "GeekyCoder", "link": "https://stackoverflow.com/users/12251951/geekycoder"}, "edited": false, "score": 0, "creation_date": 1571674202, "post_id": 58488574, "comment_id": 103310613, "body": "Thank you for your help.@GilHamilton, how do i wait on the same connection?"}], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": true, "score": 2, "last_activity_date": 1571672318, "creation_date": 1571672318, "answer_id": 58489673, "question_id": 58488574, "link": "https://stackoverflow.com/questions/58488574/sending-large-base64-string-over-tcp-socket/58489673#58489673", "title": "Sending Large Base64 String over TCP Socket", "body": "<p>You are treating the received data as a C string - a sequence of bytes ending with a 0 byte - which is not correct.</p>\n\n<p><code>recv</code> receives some bytes and puts them in <code>buffer</code>. Let's say it received 200 bytes.</p>\n\n<p>You then do <code>strstr(buffer,eom_flag);</code>. <code>strstr</code> doesn't know that 200 bytes were received. <code>strstr</code> starts from the beginning of the buffer, and keeps looking until it finds either , or a 0 byte. There is a chance that it might find a  in the other 824 bytes of the buffer, even though you didn't receive one.</p>\n\n<p>Then you do <code>output += buffer;</code>. This also treats the buffer as if it ends with a 0 byte. This will look through the whole buffer (not just the first 200 bytes) to find a 0 byte. It will then add everything up to that point into <code>output</code>. Again, it might find a 0 byte in the last 824 bytes of the buffer, and add too much data. It might not find a 0 byte in the buffer at all, and then it will keep on adding extra data from other variables that are stored next to <code>buffer</code> in memory. Or it might find a 0 byte in the first 200 bytes, and stop there (but only if you sent a 0 byte).</p>\n\n<hr>\n\n<p>What you should do is pay attention to the number of bytes received (which is <code>iResult</code>) and add that many bytes to the output. You could use:</p>\n\n<pre><code>output.insert(output.end(), buffer, buffer+iResult);\n</code></pre>\n\n<hr>\n\n<p>Also (as Phillipe Thomassigny has pointed out in a comment), the \"\" might not be received all at once. You might receive \"\" separately. You should check whether <code>output</code> has an \"\" instead of checking whether <code>buffer</code> has an \"\". (The performance implications of this are left as an exercise to the reader)</p>\n\n<hr>\n\n<p>By the way, this line doesn't do anything at the moment:</p>\n\n<pre><code>output.erase(std::find(output.begin(), output.end(), '\\0'), output.end());\n</code></pre>\n\n<p>because '\\0' never gets added to <code>output</code>, because with <code>output += buffer;</code>, a '\\0' tells it where to stop adding.</p>\n"}], "owner": {"reputation": 13, "user_id": 12251951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a863238240d33a04fdef39dd17650e2?s=128&d=identicon&r=PG&f=1", "display_name": "GeekyCoder", "link": "https://stackoverflow.com/users/12251951/geekycoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 58489673, "answer_count": 1, "score": 1, "last_activity_date": 1571672318, "creation_date": 1571668459, "last_edit_date": 1571671777, "question_id": 58488574, "link": "https://stackoverflow.com/questions/58488574/sending-large-base64-string-over-tcp-socket", "title": "Sending Large Base64 String over TCP Socket", "body": "<p>I am trying to send a Base64 encoded image from TCP client using GO and TCP server in C++.</p>\n\n<p>Here is the code snippet for C++ Receiver</p>\n\n<pre><code>std::string recieve(int bufferSize=1024,const char *eom_flag = \"&lt;EOF&gt;\"){\nchar buffer[bufferSize];\nstd::string output;\nint iResult;\nchar *eom;\ndo{\n    iResult = recv(client, buffer, sizeof(buffer), 0);\n    //If End OF MESSAGE flag is found.\n    eom = strstr(buffer,eom_flag);\n    //If socket is waiting , do dot append the json, keep on waiting.\n    if(iResult == 0){\n        continue;\n    }\n    output+=buffer;\n    //Erase null character, if exist.\n    output.erase(std::find(output.begin(), output.end(), '\\0'), output.end());\n        //is socket connection is broken or end of message is reached.\n}while(iResult &gt; -1 and eom == NULL);\n//Trim &lt;EOF&gt;\nstd::size_t eom_pos = output.rfind(eom_flag);\nreturn output.substr(0,eom_pos);}\n</code></pre>\n\n<p>Idea is to receive the message until End of Message is found, thereafter continue to listen for another message on the same TCP connection.</p>\n\n<p>Golang TCP client code snippet.</p>\n\n<pre><code>//Making connection\nconnection, _ := net.Dial(\"tcp\", \"localhost\"+\":\"+PortNumber)\nif _, err := fmt.Fprintf(connection, B64img+\"&lt;EOF&gt;\"); err != nil {\n            log.Println(err)\n            panic(err)\n        }\n</code></pre>\n\n<p>Tried approaches:</p>\n\n<ul>\n<li>Increasing the buffer size in the C++ receiver.</li>\n<li>Removing the null character from the end of the string in the C++ receiver.</li>\n</ul>\n\n<p>Observations:</p>\n\n<ul>\n<li><p>Length of string sent by the client is fixed, while the length of the string after receive function is larger and \nrandom. Example: Go client string length is 25243. For the same string, length after receive when i \nrun send and receive in the loop is 25243, 26743, 53092, 41389, 42849.</p></li>\n<li><p>On Saving the received string in a file, I see &lt;0x7f> &lt;0x02> character in the string.</p></li>\n</ul>\n\n<p>I am using winsock2.h for c++ socket.</p>\n"}, {"tags": ["c", "linux", "go", "compilation", "libxml2"], "comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1571664427, "post_id": 58487213, "comment_id": 103305335, "body": "Since you are using <code>PKG_CONFIG_PATH</code> (and assuming it is correct), that is just about all you should need for compile and link. You should probably use a <code>RUNPATH</code> to ensure the libs are on-path at runtime.  This looks a tad bit unusual: <code>&#47;usr&#47;local&#47;opt&#47;libxml2&#47;lib</code>. You should probably just use <code>--prefix=&#47;usr&#47;local</code>. Headers will be located at <code>&#47;usr&#47;local&#47;include</code>, libs at <code>&#47;usr&#47;local&#47;lib</code>, and pkg-config files at <code>&#47;usr&#47;local&#47;lib&#47;pkgconfig</code>."}], "owner": {"reputation": 494, "user_id": 7012762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ae4693854ec746ca19740d9f2cc74b?s=128&d=identicon&r=PG&f=1", "display_name": "lewtur", "link": "https://stackoverflow.com/users/7012762/lewtur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571664168, "creation_date": 1571664037, "last_edit_date": 1571664168, "question_id": 58487213, "link": "https://stackoverflow.com/questions/58487213/how-do-you-include-a-c-library-libxml2-when-building-a-go-project-for-linux", "title": "How do you include a C library (libxml2) when building a Go project for Linux?", "body": "<p>I have a Go project which I want to build as a binary so that I can deploy it as an AWS Lambda. It uses a <a href=\"https://github.com/lestrrat-go/libxml2\" rel=\"nofollow noreferrer\">Go wrapper for libxml2</a> (lestrrat-go) which requires you to have libxml2 installed locally, which I have done via <code>brew install libxml2</code>. The wrapper is installed as a git submodule in the project.</p>\n\n<p>I can run unit tests fine with the following bash script:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>export LDFLAGS=\"-L/usr/local/opt/libxml2/lib\"\nexport CPPFLAGS=\"-I/usr/local/opt/libxml2/include\"\nexport PKG_CONFIG_PATH=\"/usr/local/opt/libxml2/lib/pkgconfig\"\n\ngo test ./...\n</code></pre>\n\n<p>However I cannot work out how to build my project as a binary so it can be deployed.</p>\n\n<p>I am working on a Mac and have installed the <a href=\"https://github.com/FiloSottile/homebrew-musl-cross\" rel=\"nofollow noreferrer\">musl-cross cross compiler</a> to try and compile the project for linux, which is the OS used on AWS Lambda.</p>\n\n<p>My current build script is as follows:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>export LDFLAGS=\"-L/usr/local/opt/libxml2/lib\"\nexport CPPFLAGS=\"-I/usr/local/opt/libxml2/include\"\nexport PKG_CONFIG_PATH=\"/usr/local/opt/libxml2/lib/pkgconfig\"\nexport CGO_ENABLED=1\nexport CC=x86_64-linux-musl-gcc\n\nGOOS=linux GOARCH=amd64 go build -ldflags=\"-w -L /usr/local/opt/libxml2/lib\" -o bin/main\n</code></pre>\n\n<p>The command fails with the following output:</p>\n\n<pre><code>/var/folders/_j/dtvtwt3902x_z20282yqmwy00000gp/T/go-build660707780/b125/_x002.o: In function `MY_setXmlIndentTreeOutput':\nvendor/github.com/lestrrat-go/libxml2/clib/clib.go:73: undefined reference to `__xmlIndentTreeOutput'\nvendor/github.com/lestrrat-go/libxml2/clib/clib.go:74: undefined reference to `__xmlIndentTreeOutput'\n/var/folders/_j/dtvtwt3902x_z20282yqmwy00000gp/T/go-build660707780/b125/_x002.o: In function `MY_test_node_name':\nvendor/github.com/lestrrat-go/libxml2/clib/clib.go:163: undefined reference to `xmlIsCombiningGroup'\nvendor/github.com/lestrrat-go/libxml2/clib/clib.go:163: undefined reference to `xmlCharInRange'\nvendor/github.com/lestrrat-go/libxml2/clib/clib.go:163: undefined reference to `xmlIsExtenderGroup'\n...  many more of these\n</code></pre>\n"}, {"tags": ["mysql", "sql", "go", "dependency-injection"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 2, "creation_date": 1571664263, "post_id": 58487096, "comment_id": 103305231, "body": "You want <code>defer db.Close()</code> in <code>main</code>. Otherwise, you&#39;d be attempting to close the &quot;connection&quot; after each request that uses the database. Something to note is that when you&#39;re opening a new database &quot;connection&quot;, you are actually getting a pool of several connections."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1571664494, "post_id": 58487096, "comment_id": 103305372, "body": "You can&#39;t scan rows after you closed them. Have whatever code is scanning the rows close them instead. The comment reading &quot;same problem will occure here&quot; can&#39;t be correct, because you&#39;re not returning rows from that function."}, {"owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1571664600, "post_id": 58487096, "comment_id": 103305434, "body": "@Gavin Thanks for advice!!. So You mean I need to set <code>defer db.Close()</code> at the end of line before <code>router.Router.Run(&quot;:8080&quot;)</code>?  Is it enough to prevent connection limit and crash for <code>insert</code> and <code>select</code> sql execution in <code>dao,go</code>?"}, {"owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571664735, "post_id": 58487096, "comment_id": 103305505, "body": "@Peter Thanks for advice!! &quot;You can&#39;t scan rows after you closed them&quot; I got it! Thanks! So I need to close db connection at the end of main method, is it correct?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1571666380, "post_id": 58487096, "comment_id": 103306368, "body": "You&#39;re returning <code>*sql.Rows</code> from a function that contains a <code>defer .Close()</code> call on the return value... how do you expect that to work?"}, {"owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "edited": false, "score": 0, "creation_date": 1571666665, "post_id": 58487096, "comment_id": 103306505, "body": "I got it. After taking sql values, I&#39;m gonna close it."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571667359, "post_id": 58487096, "comment_id": 103306884, "body": "To limit the number of connections use <a href=\"https://golang.org/pkg/database/sql/#DB.SetMaxOpenConns\" rel=\"nofollow noreferrer\">DB.SetMaxOpenConns</a> and <a href=\"https://golang.org/pkg/database/sql/#DB.SetMaxIdleConns\" rel=\"nofollow noreferrer\">DB.SetMaxIdleConns</a>. Closing the DB at the end of main is pointless, because the program exits anyway when main ends."}, {"owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571667724, "post_id": 58487096, "comment_id": 103307079, "body": "@Peter Thanks for advice, I&#39;m gonna use use <code>DB.SetMaxOpenConns</code> and <code>DB.SetMaxIdleConns</code> instead of <code>defer .Close()</code>."}, {"owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "edited": false, "score": 0, "creation_date": 1571668223, "post_id": 58487096, "comment_id": 103307378, "body": "Bye the way, is it meaningless to set <code>defer .Close()</code> after *sql.Rows values are taken in service.dao and after <code>ins.Exec</code> in dao.go?"}], "answers": [{"tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": false, "score": 0, "last_activity_date": 1571687594, "creation_date": 1571687594, "answer_id": 58493240, "question_id": 58487096, "link": "https://stackoverflow.com/questions/58487096/how-to-set-defer-close-correctly-in-golang-with-dependency-injection/58493240#58493240", "title": "How to set defer .close correctly in golang with dependency injection", "body": "<p>I think what you're expecting is for the result set to be returned immediately as an array or something like that. This doesn't happen because the client is <em>lazy</em> - it doesn't give you results until you explicitly try to read a row using <code>Next()</code>. This is with good reason - if a result set has millions of rows in it, it'd be very slow to transmit the data over a network connection, and could even potentially exhaust the memory of the machine running the query. To avoid this, the result set is actually more of a \"handle\" that allows you to fetch more rows from the DB when you need them, rather than the results themselves.</p>\n\n<p>When you call <code>Close()</code> on a result set, it signals that you no longer need any more data.</p>\n\n<p>There might also be some confusion about <code>defer</code> here. <code>defer</code> triggers at the end of the function, so it will trigger when you return:</p>\n\n<pre><code>defer results.Close()\nreturn results  // defer is triggered here, which will close the result set\n</code></pre>\n\n<p>Then when you try to read from it, it is a closed result set and so you can't actually read anything from it.</p>\n\n<p>For reference, <a href=\"https://golang.org/pkg/database/sql/#Rows.Close\" rel=\"nofollow noreferrer\">here</a> are the docs for what exactly happens when you call <code>Close()</code> on a result set.</p>\n"}], "owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1469, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571687594, "creation_date": 1571663641, "last_edit_date": 1571668069, "question_id": 58487096, "link": "https://stackoverflow.com/questions/58487096/how-to-set-defer-close-correctly-in-golang-with-dependency-injection", "title": "How to set defer .close correctly in golang with dependency injection", "body": "<p>I want to set <code>defer xxx.Close()</code> to close connection in golang.<br>\nBut if I set <code>defer xxx.Close()</code> after <code>INSERT</code> SQL method, its result is null.<br>\nIf I remove <code>defer xxx.Close()</code> after <code>INSERT</code> SQL method, its result returns proper value.<br>\nI set <code>defer xxx.Close()</code> to avoid connection limit and crash. But now this is not avoided if I remove <code>defer xxx.Close()</code>.<br></p>\n\n<ul>\n<li>I set dependency injection in golang.<br></li>\n</ul>\n\n<p>dao.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\nimport (\n    \"database/sql\"\n    \"log\"\n)\n\ntype Dao struct {\n    database *sql.DB\n}\n\nfunc NewDao(database *sql.DB) *Dao {\n    objs := &amp;Dao{database: database}\n    return objs\n}\n\ntype DaoInterface interface {\n    GetEmployeeListDao() *sql.Rows\n    RegisterEmployeeDao(employee model.RegisterEmployee, uu string, encrypted string)\n}\n\nfunc (d *Dao) GetEmployeeListDao() *sql.Rows {\n\n    results, err := d.database.Query(\"SELECT id, name, email, isDisplay FROM employee\")\n    if err != nil {\n        panic(err.Error())\n    }\n    //it returns nothing.\n    //If removing defer results.Close(), results returns correct value\n    defer results.Close()\n    return results\n}\n\nfunc (d *Dao) RegisterEmployeeDao(employee model.RegisterEmployee, uu string, encrypted string) {\n    ins, err := d.database.Prepare(\"INSERT INTO employee(name, email, password, isDisplay) VALUES(?,?,?,?)\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    //same problem will occure here.\n    defer ins.Close()\n    _, err = ins.Exec(uu, employee.NAME, employee.EMAIL, encrypted, employee.ISDISPLAY)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\n</code></pre>\n\n<p>service.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package service\n\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"crypto/rand\"\n    \"encoding/base64\"\n    \"io\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\ntype Service struct {\n    dao dao.DaoInterface\n}\n\nfunc NewService(dao dao.DaoInterface) *Service {\n    return &amp;Service{dao: dao}\n}\n\ntype ServiceInterface interface {\n    GetEmployeeListService() []model.Employee\n    RegisterEmployeeService(c *gin.Context)\n}\n\nfunc (s Service) GetEmployeeListService() []model.Employee {\n    var employee []model.Employee\n\n    results := s.dao.GetEmployeeListDao()\n\n    singleEmployee := model.Employee{}\n    for results.Next() {\n        err := results.Scan(&amp;singleEmployee.ID, &amp;singleEmployee.NAME, &amp;singleEmployee.EMAIL, &amp;singleEmployee.ISDISPLAY)\n        if err != nil {\n            panic(err.Error())\n        } else {\n            employee = append(employee, singleEmployee)\n        }\n    }\n\n    defer results.Close()\n\n    var displayEmployee []model.Employee\n\n    for _, e := range employee {\n        if e.ISDISPLAY == true {\n            displayEmployee = append(displayEmployee, e)\n        }\n    }\n\n    return displayEmployee\n}\n\nfunc (s Service) RegisterEmployeeService(c *gin.Context) {\n    var employee model.RegisterEmployee\n    c.BindJSON(&amp;employee)\n\n    block, err := aes.NewCipher([]byte(\"aes-secret-key-1\"))\n    if err != nil {\n        panic(err)\n    }\n    b := base64.StdEncoding.EncodeToString([]byte(employee.PASSWORD))\n    cipt := make([]byte, aes.BlockSize+len(b))\n    iv := cipt[:aes.BlockSize]\n    if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n        panic(err)\n    }\n    cfb := cipher.NewCFBEncrypter(block, iv)\n    cfb.XORKeyStream(cipt[aes.BlockSize:], []byte(b))\n    encrypted := base64.StdEncoding.EncodeToString(cipt)\n\n    s.dao.RegisterEmployeeDao(employee, encrypted)\n}\n\n</code></pre>\n\n<p>I set dependency injection style in api.\nmain.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"os\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    db := db.NewDatabase(os.Getenv(\"MYSQL_USER\"), os.Getenv(\"MYSQL_PASSWORD\"), os.Getenv(\"MYSQL_HOST\"))\n    dao := dao.NewDao(db.DATABASE)\n    service := service.NewService(dao)\n    cntlr := controller.NewController(service)\n    router := handler.NewHandler(cntlr)\n\n    router.Router.Run(\":8080\")\n}\n</code></pre>\n\n<p>I expect <code>defer xxx.Close()</code> to has no problem and insert and select sql returns correct value.<br>\nBut the problem is because of <code>defer xxx.Close()</code> insert and select sql does not return correct value.<br>\nI want to know how to avoid connection limit and crash without this problem.<br></p>\n"}, {"tags": ["json", "go", "confluence-rest-api"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1571663817, "creation_date": 1571663817, "answer_id": 58487141, "question_id": 58487054, "link": "https://stackoverflow.com/questions/58487054/grabbing-value-from-confluence-json-response/58487141#58487141", "title": "Grabbing value from Confluence JSON response", "body": "<p><code>id</code> is in an array of objects, inside <code>results</code>. To unmarshal a json document, your structure must match the document, that is:</p>\n\n<pre><code>type body struct {\n  Results []dataResponse `json:\"results\"`\n}\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>var doc body\njson.Unmarshal(data, &amp;doc)\n</code></pre>\n\n<p>You can get the <code>id</code> from:</p>\n\n<pre><code>doc.Results[i].Id\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12251554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04638794b960a52bb4362af31d49db90?s=128&d=identicon&r=PG&f=1", "display_name": "ANewGoUser1", "link": "https://stackoverflow.com/users/12251554/anewgouser1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 58487141, "answer_count": 1, "score": -1, "last_activity_date": 1571664047, "creation_date": 1571663513, "last_edit_date": 1571664047, "question_id": 58487054, "link": "https://stackoverflow.com/questions/58487054/grabbing-value-from-confluence-json-response", "title": "Grabbing value from Confluence JSON response", "body": "<p>I'm trying to grab the ID field from the JSON response of a confluence page, that data looks like this: </p>\n\n<pre><code>`{\"results\":[{\"id\":\"89425836\",\"type\":\"page\",\"status\":\"current\",\"title\":\"string\",\"extensions\":{\"position\":\"none\"},\"_links\":{\"webui\":\"/web/url\",\"edit\":\"/pages/resumedraft.action?draftId=89425836\",\"tinyui\":\"/x/rIdUBQ\",\"self\":\"https://confluence.domain.org/rest/api/content/89425836\"},\"_expandable\":{\"container\":\"/rest/api/space/spaceName\",\"metadata\":\"\",\"operations\":\"\",\"children\":\"/rest/api/content/89425836/child\",\"restrictions\":\"/rest/api/content/89425836/restriction/byOperation\",\"history\":\"/rest/api/content/89425836/history\",\"ancestors\":\"\",\"body\":\"\",\"version\":\"\",\"descendants\":\"/rest/api/content/89425836/descendant\",\"space\":\"/rest/api/space/spaceName\"}}],\"start\":0,\"limit\":25,\"size\":1,\"_links\":{\"self\":\"https://confluence.domain.org/rest/api/content?spaceKey=spaceName&amp;type=page&amp;title=title\",\"base\":\"https://confluence.domain.org\",\"context\":\"\"}}`\n</code></pre>\n\n<p>I've been looking online and my code should be working but it's not and I'm at a loss. </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\ntype dataResponse struct {\n    Id string `json:\"id\"`\n}\n\nfunc main() {\n\n    var p dataResponse\n\n    response, err := http.Get(\"https://confluence.domain.org/url/to/page/with/params\"\n\n    if err != nil {\n       panic(err)\n    } else {\n      data, _ := ioutil.ReadAll(response.Body)\n      json.Unmarshal(data, &amp;p)\n      fmt.Println(p.Id)\n    }\n\n   defer response.Body.Close()\n}\n</code></pre>\n\n<p>But this isn't returning anything. I think it has something to do with the id field being after the \"results\" but haven't found a way to work with that. Edit: updated url, copied the debugging one by accident. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1571663768, "post_id": 58487033, "comment_id": 103304937, "body": "You have 4 CPUs and 4 is 4."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1571663668, "creation_date": 1571663668, "answer_id": 58487103, "question_id": 58487033, "link": "https://stackoverflow.com/questions/58487033/i-have-a-single-processor-with-4-physical-cores-and-each-core-has-2-threads-bu/58487103#58487103", "title": "I have a single processor with 4 physical cores, and each core has 2 threads. But why runtime.NumCPU() returns 4 rather than 8?", "body": "<p>Your CPU has two physical cores, not 4. From Intel's product info sheet for the <a href=\"https://ark.intel.com/content/www/us/en/ark/products/88193/intel-core-i5-6200u-processor-3m-cache-up-to-2-80-ghz.html\" rel=\"nofollow noreferrer\">Intel\u00ae Core\u2122 i5-6200U Processor</a>:</p>\n\n<blockquote>\n  <p># of Cores 2</p>\n  \n  <p># of Threads 4</p>\n</blockquote>\n\n<p>So the <code>NumCPU()</code> value of 4 is correct.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1571664601, "last_edit_date": 1571664601, "creation_date": 1571664268, "answer_id": 58487299, "question_id": 58487033, "link": "https://stackoverflow.com/questions/58487033/i-have-a-single-processor-with-4-physical-cores-and-each-core-has-2-threads-bu/58487299#58487299", "title": "I have a single processor with 4 physical cores, and each core has 2 threads. But why runtime.NumCPU() returns 4 rather than 8?", "body": "<p>Your CPU details: <code>CPU(s): 4</code>. That's pretty self explanatory.</p>\n\n<p>But to add the math:</p>\n\n<pre><code>Thread(s) per core:  2\nCore(s) per socket:  2\nSocket(s):           1\n\n\nNum CPU(s) = Num Socket(s) * Core(s) per socket * Thread(s) per core\n           = 1             * 2                  * 2\n           = 4\n</code></pre>\n\n<p>You have 4 logical CPUs, and <a href=\"https://golang.org/pkg/runtime/#NumCPU\" rel=\"nofollow noreferrer\"><code>runtime.NumCPU()</code></a> <em>returns the number of logical CPUs usable by the current process.</em> All 4 logical CPUs are available to your app (by default), so that's why <code>runtime.NumCPU()</code> reports 4.</p>\n"}], "owner": {"reputation": 9, "user_id": 10627894, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ft9LykTkPYU/AAAAAAAAAAI/AAAAAAAAAAg/7N4aO30ERWw/photo.jpg?sz=128", "display_name": "avid", "link": "https://stackoverflow.com/users/10627894/avid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 58487103, "answer_count": 2, "score": -4, "last_activity_date": 1571664601, "creation_date": 1571663431, "last_edit_date": 1571663880, "question_id": 58487033, "link": "https://stackoverflow.com/questions/58487033/i-have-a-single-processor-with-4-physical-cores-and-each-core-has-2-threads-bu", "title": "I have a single processor with 4 physical cores, and each core has 2 threads. But why runtime.NumCPU() returns 4 rather than 8?", "body": "<p>I have a single processor with 4 physical cores, and each core has 2 threads. But why runtime.NumCPU() returns 4 rather than 8?</p>\n\n<p>My CPU details:</p>\n\n<pre><code>Architecture:        x86_64\nCPU op-mode(s):      32-bit, 64-bit\nByte Order:          Little Endian\nAddress sizes:       39 bits physical, 48 bits virtual\nCPU(s):              4\nOn-line CPU(s) list: 0-3\nThread(s) per core:  2\nCore(s) per socket:  2\nSocket(s):           1\nNUMA node(s):        1\nVendor ID:           GenuineIntel\nCPU family:          6\nModel:               78\nModel name:          Intel(R) Core(TM) i5-6200U CPU @ 2.30GHz\n</code></pre>\n\n<p>When I run the following code:\n<code>fmt.Println(runtime.NumCPU())</code></p>\n\n<p>it outputs 4.</p>\n\n<p>Each hardware thread will be presented to the Go program as a virtual core, so the output should be 8, isn't it?</p>\n\n<p>But why the output is 4?</p>\n"}, {"tags": ["go", "google-cloud-platform", "stackdriver", "google-cloud-stackdriver", "google-cloud-debugger"], "comments": [{"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 2, "creation_date": 1571665810, "post_id": 58486509, "comment_id": 103306078, "body": "I have not seen this error, but the debugger is complaining about the program. This error is related to the executable file format (ELF) of the program <code>main</code> that you are debugging. Try running your container locally in Docker. Try using version 1.11 to be compatible with the debug agent (the versions must match) but I am not sure."}, {"owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1571750238, "post_id": 58486509, "comment_id": 103338680, "body": "Thank you @JohnHanley you were right, changing golang to 1.11 resolved the problem, the app is starting using go-cloud-debug-agent."}, {"owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1571758894, "post_id": 58486509, "comment_id": 103343654, "body": "Ok it seems go-cloud-debug-agent works but now when I set up the snapshot at any point of app the cloud run is not responding and in Stackdriver Debug I&#39;m waiting forever for snapshot seeing only Waiting for snapshot to hit... Any ideas?"}, {"owner": {"reputation": 631, "user_id": 2088345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aedf93d50cff7ccdcac37dec2950f4b?s=128&d=identicon&r=PG", "display_name": "ahong", "link": "https://stackoverflow.com/users/2088345/ahong"}, "edited": false, "score": 0, "creation_date": 1592365923, "post_id": 58486509, "comment_id": 110396906, "body": "@MaciejPerli\u0144ski did you ever fix your &quot;responsiveness&quot; problem?"}, {"owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "reply_to_user": {"reputation": 631, "user_id": 2088345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aedf93d50cff7ccdcac37dec2950f4b?s=128&d=identicon&r=PG", "display_name": "ahong", "link": "https://stackoverflow.com/users/2088345/ahong"}, "edited": false, "score": 0, "creation_date": 1610978225, "post_id": 58486509, "comment_id": 116295772, "body": "@ahong nope i dropped the idea to use this approach but it might be worth revisiting the status now"}], "answers": [{"tags": [], "owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "is_accepted": false, "score": 0, "last_activity_date": 1571750572, "creation_date": 1571750572, "answer_id": 58505320, "question_id": 58486509, "link": "https://stackoverflow.com/questions/58486509/how-to-run-go-cloud-debug-agent-in-google-cloud-run-so-that-i-can-debug-my-go-ap/58505320#58505320", "title": "How to run go-cloud-debug-agent in Google Cloud Run so that I can debug my go app in Stackdriver Debug", "body": "<p>As @JohnHanley pointed I had to change the golang version to 1.11 to be compatibile with debug agent. \nTo conclude the following Dockerfile should run in Cloud Run any golang code and let you use Stackdriver Debug with it.</p>\n\n<pre><code>FROM golang:1.11\nRUN go get -u cloud.google.com/go/cmd/go-cloud-debug-agent\nRUN mkdir -p /go/src/xyz\nWORKDIR /go/src/xyz\nCOPY . .\n\nRUN go build -gcflags=all='-N -l' -o main .\n\n\nEXPOSE 8080\nENTRYPOINT [\"go-cloud-debug-agent\",\"-projectid=someproject-12313423\",\"-appmodule=main\",\"-appversion=1.0\",\"--\",\"/go/src/xyz/main\"]\n</code></pre>\n\n<p>GCP should post some examples as from their current documentation I can deduct there is no way to run go-cloud-debug-agent on Cloud Run and that Cloud Run is not supported.</p>\n"}, {"comments": [{"owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1573740650, "post_id": 58546214, "comment_id": 103988587, "body": "As official documentation states there is no official support but having &quot;VMs and Containers running elsewhere&quot; listed in the chart implies we should be able to run the app using Cloud Run (this is docker container) as we would do in VM and still use the debugger agent. Not seeing really a difference between containerized app with debug agent and regular VM. If you are aware what&#39;s the difference and why it would not work in Cloud Run please share your thoughts."}, {"owner": {"reputation": 21, "user_id": 4055964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C58VT.jpg?s=128&g=1", "display_name": "wjg", "link": "https://stackoverflow.com/users/4055964/wjg"}, "reply_to_user": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1574260323, "post_id": 58546214, "comment_id": 104169019, "body": "Cloud Run is a Google managed service. VMs and containers running elsewhere are not Google managed services."}], "tags": [], "owner": {"reputation": 21, "user_id": 4055964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C58VT.jpg?s=128&g=1", "display_name": "wjg", "link": "https://stackoverflow.com/users/4055964/wjg"}, "is_accepted": false, "score": 1, "last_activity_date": 1571937261, "creation_date": 1571937261, "answer_id": 58546214, "question_id": 58486509, "link": "https://stackoverflow.com/questions/58486509/how-to-run-go-cloud-debug-agent-in-google-cloud-run-so-that-i-can-debug-my-go-ap/58546214#58546214", "title": "How to run go-cloud-debug-agent in Google Cloud Run so that I can debug my go app in Stackdriver Debug", "body": "<p>Go is not supported for Cloud Run at the moment. Here is a list of the supported languages and platforms for Debugger: <a href=\"https://cloud.google.com/debugger/docs/setup/\" rel=\"nofollow noreferrer\">https://cloud.google.com/debugger/docs/setup/</a></p>\n"}], "owner": {"reputation": 219, "user_id": 4329071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aec3b9f3884299079475933337121e3d?s=128&d=identicon&r=PG", "display_name": "Maciej Perli\u0144ski", "link": "https://stackoverflow.com/users/4329071/maciej-perli%c5%84ski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1571937261, "creation_date": 1571661580, "question_id": 58486509, "link": "https://stackoverflow.com/questions/58486509/how-to-run-go-cloud-debug-agent-in-google-cloud-run-so-that-i-can-debug-my-go-ap", "title": "How to run go-cloud-debug-agent in Google Cloud Run so that I can debug my go app in Stackdriver Debug", "body": "<p>I'm trying to run go-cloud-debug-agent within Cloud Run </p>\n\n<pre><code>FROM golang:1.13.1 \nRUN go get -u cloud.google.com/go/cmd/go-cloud-debug-agent\nRUN mkdir -p /go/src/xyz\nWORKDIR /go/src/xyz\nCOPY . .\n\nRUN go build -gcflags=all='-N -l' -o main .\n\n\nEXPOSE 8080\nENTRYPOINT [\"go-cloud-debug-agent\",\"-projectid=someproject-12313423\",\"-appmodule=main\",\"-appversion=1.0\",\"--\",\"/go/src/xyz/main\"]\n</code></pre>\n\n<p>Unfortunately when trying to deploy it to Cloud Run I see following error in the Stackdriver Logging </p>\n\n<pre><code>Error loading program: AttrStmtList not present or not int64 for unit 98\n</code></pre>\n\n<p>Anyone has any clue how to use go-cloud-debug-agent with Cloud Run?</p>\n"}, {"tags": ["google-app-engine", "go", "golang-migrate"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571662196, "post_id": 58486461, "comment_id": 103304002, "body": "So Go 112 isn&#39;t supported. What is your question?"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1571687757, "post_id": 58486461, "comment_id": 103316483, "body": "You may need to update your local App Engine library, 1.12 is supported on the latest App Engine: <a href=\"https://cloud.google.com/appengine/docs/standard/go112/\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go112</a>"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1571687862, "post_id": 58486461, "comment_id": 103316519, "body": "For people downvoting: please explain why you&#39;re downvoting."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571697092, "post_id": 58493525, "comment_id": 103319495, "body": "Hmm...it seems the way I installed the SDK doesn&#39;t have the latest version. I used apt-get."}, {"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571700141, "post_id": 58493525, "comment_id": 103320282, "body": "Hi Jorge, doesn&#39;t seem the SDK actually support runtime 1.12. Could you confirm after updating you could run app engine locally with runtime 1.12?"}, {"owner": {"reputation": 3199, "user_id": 11529321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kqa9p.jpg?s=128&g=1", "display_name": "Jan Hernandez", "link": "https://stackoverflow.com/users/11529321/jan-hernandez"}, "reply_to_user": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571756238, "post_id": 58493525, "comment_id": 103342255, "body": "@ Chaoming Li this is the official documentation for go 1.12 over app engine, check if your environment is in compliance with this guide.  <a href=\"https://cloud.google.com/appengine/docs/standard/go112/quickstart\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go112/quickstart</a>  In this official repository for app engine is using go 1.12  <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine/go11x/helloworld\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/golang-samples/tree/master/&hellip;</a>"}, {"owner": {"reputation": 3199, "user_id": 11529321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kqa9p.jpg?s=128&g=1", "display_name": "Jan Hernandez", "link": "https://stackoverflow.com/users/11529321/jan-hernandez"}, "reply_to_user": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571756695, "post_id": 58493525, "comment_id": 103342493, "body": "I check your update on your question i think that you need run this command &quot;gcloud components install app-engine-go&quot; as is mentioned in de official documentation"}], "tags": [], "owner": {"reputation": 3199, "user_id": 11529321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kqa9p.jpg?s=128&g=1", "display_name": "Jan Hernandez", "link": "https://stackoverflow.com/users/11529321/jan-hernandez"}, "is_accepted": false, "score": 0, "last_activity_date": 1571689010, "creation_date": 1571689010, "answer_id": 58493525, "question_id": 58486461, "link": "https://stackoverflow.com/questions/58486461/go-app-engine-dev-appserver-py-doesnt-support-runtime-go112/58493525#58493525", "title": "Go app engine dev_appserver.py doesn&#39;t support runtime go112", "body": "<p>It sounds like you gcloud SDK is an old version and not recognize \"runtime: go112\", please run this command in order to update your SDK.</p>\n\n<p>gcloud components update</p>\n\n<p>After the update you can be able to deploy an app engine service using GO 1.12 runtime, check the changes that you need to perform in you App.yaml in this <a href=\"https://cloud.google.com/appengine/docs/standard/go112/go-differences#app-yaml\" rel=\"nofollow noreferrer\">link</a></p>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571870163, "post_id": 58513276, "comment_id": 103387352, "body": "Thanks, this answers the question. There are some problems with this approach and I hope Google would have a better solution for upgrading to 1.12"}, {"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1571873323, "post_id": 58513276, "comment_id": 103388023, "body": "I am able to run 1.12 locally, but not really an app engine simulation. That&#39;s quite a poor solution as dispatch, queue, and other features are not able to be tested locally."}], "tags": [], "owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "is_accepted": true, "score": 1, "last_activity_date": 1571784839, "creation_date": 1571784839, "answer_id": 58513276, "question_id": 58486461, "link": "https://stackoverflow.com/questions/58486461/go-app-engine-dev-appserver-py-doesnt-support-runtime-go112/58513276#58513276", "title": "Go app engine dev_appserver.py doesn&#39;t support runtime go112", "body": "<p>go112 runtime is not available on local dev_appserver.py. This has been discussed on the App Engine Go forum at</p>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/kHxZ9zIb_QE\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/google-appengine-go/kHxZ9zIb_QE</a></p>\n\n<p>The expectation is that starting from go112 runtime, there is no \"appengine\" way of running the go server and works normally like any go server outside GAE. There are a few open issues like dispatching urls though.</p>\n"}], "owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "accepted_answer_id": 58513276, "answer_count": 2, "score": 1, "last_activity_date": 1571784839, "creation_date": 1571661401, "last_edit_date": 1571700030, "question_id": 58486461, "link": "https://stackoverflow.com/questions/58486461/go-app-engine-dev-appserver-py-doesnt-support-runtime-go112", "title": "Go app engine dev_appserver.py doesn&#39;t support runtime go112", "body": "<p>I am trying to migrate my Go app to runtime go112, but dev_appserver.py throw the following error:</p>\n\n<pre><code>RuntimeError: Unknown runtime 'go112'; supported runtimes are 'custom', 'go', 'go111', 'java', 'java7', 'java8', 'php55', 'php72', 'python', 'python-compat', 'python27', 'python37'.\n</code></pre>\n\n<p>Current Go version is 1.12.11</p>\n\n<p><strong>Edit:</strong> I used apt-get to install the SDK.</p>\n\n<pre><code>apt-get update &amp;&amp; apt-get install google-cloud-sdk google-cloud-sdk-app-engine-python\\\n    google-cloud-sdk-app-engine-python-extras\\\n    google-cloud-sdk-app-engine-java\\\n    google-cloud-sdk-app-engine-go\\\n    google-cloud-sdk-datalab\\\n    google-cloud-sdk-datastore-emulator\\\n    google-cloud-sdk-pubsub-emulator\\\n    google-cloud-sdk-cbt\\\n    google-cloud-sdk-cloud-build-local\\\n    google-cloud-sdk-bigtable-emulator\\\n    kubectl -y\n</code></pre>\n\n<p>That way it seems I can't use <code>gcloud components update</code> and the packages are not up-to-date in the repos.</p>\n\n<p><strong>Now my questions is: Does google-cloud-sdk-app-engine-go support go runtime 1.12? If not, when will it support runtime 1.12?</strong></p>\n\n<p><strong>Update:</strong> I installed cloud SDK and run <code>gcloud components update</code> successfully on another computer, dev_server.py still throw the same error. <strong>Does the local SDK actually support rumtime 1.12?</strong></p>\n"}, {"tags": ["go", "google-cloud-pubsub"], "comments": [{"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1571691270, "post_id": 58484386, "comment_id": 103317832, "body": "I deleted my answer, I didn&#39;t well understood you issue, I didn&#39;t well see the log time entry."}], "answers": [{"tags": [], "owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "is_accepted": false, "score": 0, "last_activity_date": 1571759956, "creation_date": 1571759956, "answer_id": 58508164, "question_id": 58484386, "link": "https://stackoverflow.com/questions/58484386/pubsub-pull-request-does-not-working-properly-go/58508164#58508164", "title": "Pubsub.pull request does not working properly - go", "body": "<p>Trying to pull a single message at a time in this way is an anti-pattern for Cloud Pub/Sub. In your case, your subscribers probably end up communicating with different servers that have messages allocated to be sent to the subscribers that connect to them. Cloud Pub/Sub expects to receive several pull requests simultaneously from clients that use this method to receive messages. Therefore you should either have several pull requests outstanding at once or you should use the <a href=\"https://cloud.google.com/pubsub/docs/pull\" rel=\"nofollow noreferrer\">asynchronous pull via the Receive method</a>.</p>\n"}], "owner": {"reputation": 19, "user_id": 12186103, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBPHmTPBfkLVTVGF4YtDRJJh9UNhkd2Fe4jtN8G7g=k-s128", "display_name": "Pradnya Shinde", "link": "https://stackoverflow.com/users/12186103/pradnya-shinde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571759956, "creation_date": 1571653691, "question_id": 58484386, "link": "https://stackoverflow.com/questions/58484386/pubsub-pull-request-does-not-working-properly-go", "title": "Pubsub.pull request does not working properly - go", "body": "<p>I am trying to pull 1 message at a time from pub-sub subscription using go client libraries. But message are not pulling on pull request even messages are present on subscription. Subscriber is waiting for all messages to be processed.</p>\n\n<p>I am trying basic code in go in which I am pulling one message at a time. I have used two instances, and ran the script(to create subscriber) 4 times at background on both. I have set ack_deadline 10 sec.\nI am expecting the result like each subscriber should take next message from subscription after one message acknowledged. But message is not pulling on instance until last messages processing is done. \nWhy messages are not pulling after one message processing done? In my knowledge there should not be any dependency on the instances or subscriber.\nLet mi know any other changes or parameter need to be set. \nThanks in advance.</p>\n\n<p>Here is the log of one instance:</p>\n\n<pre><code>2019/10/21 05:22:07 Got message: Message 0 at 2019-10-21 05:22:07.022772532 \n2019/10/21 05:22:11 Got message: Message 1 at 2019-10-21 05:22:11.330566981 \n2019/10/21 05:22:14 Got message: Message 2 at 2019-10-21 05:22:14.803031569 \n2019/10/21 05:22:18 Got message: Message 3 at 2019-10-21 05:22:18.452912271 \n2019/10/21 05:38:39 Acking message: Message 3 at 2019-10-21 05:38:39.471739478 \n2019/10/21 05:39:10 Acking message: Message 0 at 2019-10-21 05:39:10.039336794 \n2019/10/21 05:41:22 Acking message: Message 1 at 2019-10-21 05:41:22.351124342 \n2019/10/21 05:50:31 Acking message: Message 2 at 2019-10-21 05:50:31.829087762 \n2019/10/21 05:50:39 Got message: Message 13 at 2019-10-21 05:50:39.005916608\n2019/10/21 05:50:39 Got message: Message 11 at 2019-10-21 05:50:39.00623238 \n2019/10/21 05:50:39 Got message: Message 15 at 2019-10-21 05:50:39.007216256\n2019/10/21 05:50:39 Got message: Message 12 at 2019-10-21 05:50:39.008066257 \n</code></pre>\n\n<p>log of 2nd instance:</p>\n\n<pre><code>2019/10/21 05:22:29 Got message: Message 4 at 2019-10-21 05:22:29.331569077 \n2019/10/21 05:22:33 Got message: Message 5 at 2019-10-21 05:22:33.018801275 \n2019/10/21 05:22:36 Got message: Message 6 at 2019-10-21 05:22:36.803434547 \n2019/10/21 05:22:40 Got message: Message 7 at 2019-10-21 05:22:40.409314927 \n2019/10/21 05:39:38 Acking message: Message 4 at 2019-10-21 05:39:38.349619635 \n2019/10/21 05:42:42 Acking message: Message 6 at 2019-10-21 05:42:42.819874065 \n2019/10/21 05:47:40 Acking message: Message 5 at 2019-10-21 05:47:40.049128075 \n2019/10/21 05:50:38 Acking message: Message 7 at 2019-10-21 05:50:38.42874031 \n2019/10/21 05:50:39 Got message: Message 8 at 2019-10-21 05:50:39.005090906 \n2019/10/21 05:50:39 Got message: Message 9 at 2019-10-21 05:50:39.005334146 \n2019/10/21 05:50:39 Got message: Message 16 at 2019-10-21 05:50:39.006427796 \n2019/10/21 05:50:39 Got message: Message 14 at 2019-10-21 05:50:39.007231713 \n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n// [START pubsub_publish_with_error_handling_that_scales]\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n    \"log\"\n    \"time\"\n    \"math/rand\"\n    pubsub \"cloud.google.com/go/pubsub/apiv1\"\n    pubsubpb \"google.golang.org/genproto/googleapis/pubsub/v1\"\n)\n\n\nfunc main(){\n    f, _:= os.OpenFile(\"testlogfile\", os.O_RDWR | os.O_CREATE | os.O_APPEND, 0666)\n    defer f.Close()\n    log.SetOutput(f)\n    rand.Seed(time.Now().UTC().UnixNano())\n    pullMsgs(\"sureline-dev-1264\", \"sub7\")\n}\n\nfunc random(min, max int) int {\n    return rand.Intn(max - min) + min\n}\n\nfunc pullMsgs(projectID, subscriptionID string) error {\n    ctx := context.Background()\n    client, err := pubsub.NewSubscriberClient(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer client.Close()\n    sub := fmt.Sprintf(\"projects/%s/subscriptions/%s\", projectID, subscriptionID)\n// Be sure to tune the MaxMessages parameter per your project's needs, and accordingly\n// adjust the ack behavior below to batch acknowledgements.\n    req := pubsubpb.PullRequest{\n        Subscription: sub,\n        MaxMessages:  1,\n    }\n\n    fmt.Println(\"Listening..\")\n\n    for {\n        res, err := client.Pull(ctx, &amp;req)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n    // client.Pull returns an empty list if there are no messages available in the\n    // backlog. We should skip processing steps when that happens.\n        if len(res.ReceivedMessages) == 0 {\n            continue\n        }\n\n        var recvdAckIDs []string\n        for _, m := range res.ReceivedMessages {\n            recvdAckIDs = append(recvdAckIDs, m.AckId)\n        }\n\n        var done = make(chan struct{})\n        var delay = 0 * time.Second // Tick immediately upon reception\n        var ackDeadline = 10 * time.Second\n\n    // Continuously notify the server that processing is still happening on this batch.\n        go func() {\n            for {\n                select {\n                case &lt;-ctx.Done():\n                    return\n                case &lt;-done:\n                    return\n                case &lt;-time.After(delay):\n                    err := client.ModifyAckDeadline(ctx, &amp;pubsubpb.ModifyAckDeadlineRequest{\n                        Subscription:       sub,\n                        AckIds:             recvdAckIDs,\n                        AckDeadlineSeconds: int32(ackDeadline.Seconds()),\n                    })\n                    if err != nil {\n                        log.Fatal(err)\n                    }\n                    delay = ackDeadline - 5*time.Second // 5 seconds grace period.\n                }\n            }\n        }()\n\n        for _, m := range res.ReceivedMessages {\n            // Process the message here, possibly in a goroutine.\n            log.Printf(\"Got message: %s at %v\", string(m.Message.Data), time.Now())\n            fmt.Printf(\"Got message: %s at %v\", string(m.Message.Data), time.Now())\n            myrand := random(240, 420)\n            log.Printf(\"Sleeping %d seconds...\\n\", myrand)\n            time.Sleep(time.Duration(myrand)*time.Second)\n            err := client.Acknowledge(ctx, &amp;pubsubpb.AcknowledgeRequest{\n                Subscription: sub,\n                AckIds:       []string{m.AckId},\n            })\n            log.Printf(\"Acking message: %s at %v\", string(m.Message.Data), time.Now())\n            fmt.Printf(\"Acking message: %s at %v\", string(m.Message.Data), time.Now())\n            if err != nil {\n                log.Fatal(err)\n            }\n        }\n\n        close(done)\n    }\n}\n</code></pre>\n\n<p>I am expecting the output is like take next message from the subscription after first message processing done. It should not be dependable on any other instances.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 31, "user_id": 12250065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-r1lNFWIK4DY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5uInAHJlRnQ4j3XakWMVag-3vdQ/photo.jpg?sz=128", "display_name": "Charles Chan", "link": "https://stackoverflow.com/users/12250065/charles-chan"}, "edited": false, "score": 0, "creation_date": 1571643760, "post_id": 58481800, "comment_id": 103295254, "body": "my MacOS upgraded to Catalina and then caused this problem"}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1571670110, "post_id": 58481800, "comment_id": 103308424, "body": "Seems like page has read-only flag."}, {"owner": {"reputation": 400, "user_id": 9527593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Np0L.png?s=128&g=1", "display_name": "z11i", "link": "https://stackoverflow.com/users/9527593/z11i"}, "edited": false, "score": 2, "creation_date": 1573030720, "post_id": 58481800, "comment_id": 103744047, "body": "Are you using the monkey package? I&#39;m having the same issue. Perhaps you can edit the question to include the package name for people to find this question easier."}, {"owner": {"reputation": 1133, "user_id": 976724, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4d635950efd7a9ab471357375b3c0792?s=128&d=identicon&r=PG", "display_name": "Elliott Darfink", "link": "https://stackoverflow.com/users/976724/elliott-darfink"}, "edited": false, "score": 0, "creation_date": 1590793037, "post_id": 58481800, "comment_id": 109825503, "body": "Check here for an explanation: <a href=\"https://stackoverflow.com/a/61924409/976724\">stackoverflow.com/a/61924409/976724</a>"}], "owner": {"reputation": 31, "user_id": 12250065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-r1lNFWIK4DY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5uInAHJlRnQ4j3XakWMVag-3vdQ/photo.jpg?sz=128", "display_name": "Charles Chan", "link": "https://stackoverflow.com/users/12250065/charles-chan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 673, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1571643620, "creation_date": 1571643620, "question_id": 58481800, "link": "https://stackoverflow.com/questions/58481800/cause-permission-denied-while-execute-golang-syscall-mprotect", "title": "cause permission denied while execute golang syscall.MProtect", "body": "<p>When I use package syscall like this:</p>\n\n<pre><code> err := syscall.Mprotect(page, syscall.PROT_READ|syscall.PROT_WRITE|syscall.PROT_EXEC)\n</code></pre>\n\n<p>error occurs as below</p>\n\n<pre><code>permission denied\n</code></pre>\n\n<p>It seems EACCES error in C. What should I do?</p>\n"}, {"tags": ["go", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571647165, "post_id": 58480775, "comment_id": 103296665, "body": "can you reproduce and share a minimal example please ?"}, {"owner": {"reputation": 51, "user_id": 12249594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/689f7af0f4ee832a3e716244d791e9d7?s=128&d=identicon&r=PG&f=1", "display_name": "rezam", "link": "https://stackoverflow.com/users/12249594/rezam"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571655429, "post_id": 58480775, "comment_id": 103300578, "body": "@mh-cbon I&#39;ve updated my code"}], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1571676369, "post_id": 58489004, "comment_id": 103311602, "body": "FWIW the check of s.gctx at the top of the service handler isn&#39;t necessary.  <code>GracefulStop</code> will cause the server to stop accepting new requests entirely."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1571681891, "post_id": 58489004, "comment_id": 103314042, "body": "@DougFawley good point. Updated answer. Also fixed a potential context leak in <code>mergeContext</code>."}, {"owner": {"reputation": 51, "user_id": 12249594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/689f7af0f4ee832a3e716244d791e9d7?s=128&d=identicon&r=PG&f=1", "display_name": "rezam", "link": "https://stackoverflow.com/users/12249594/rezam"}, "edited": false, "score": 0, "creation_date": 1571725509, "post_id": 58489004, "comment_id": 103325376, "body": "@colminator what if I don&#39;t merge contexts and have a <code>case</code> for each? does that cause a context leak?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571738114, "post_id": 58489004, "comment_id": 103331955, "body": "The reason to merge them into a single context, is so you can pass a single context to any other potentially blocking call like a HTTP request or SQL query. Those types of call can only take a single context value. And you want those calls to detect any cancellations that your RPC may receive - client or server."}, {"owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 1, "creation_date": 1571774176, "post_id": 58489004, "comment_id": 103350346, "body": "@colminator I think your select inside the goroutine in <code>mergeContext</code> also needs a case for <code>mctx.Done()</code>.  Otherwise that goroutine will leak even when <code>mcancel</code> is called."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1571775903, "post_id": 58489004, "comment_id": 103351074, "body": "@DougFawley I think the client context will be reclaimed on calls which would trigger the <code>mctx</code> to clean-up. But just in case I update to your suggestion.  I also condensed it some more - as I noticed I could make <code>a</code> the parent context of <code>mctx</code> - and then only have to monitor <code>b</code> (and mctx of course)."}, {"owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1571865775, "post_id": 58489004, "comment_id": 103386118, "body": "@colminator - you are right about the service handler&#39;s context being canceled, but if <code>mergeContext</code> is intended to be a generic function (for use outside gRPC) then it&#39;s possible the children will never be canceled.  The update looks good and nice idea making <code>mctx</code> a child of <code>a</code>.  With that change, you could then update the service handler to do: <code>ctx, cancel := mergeContext(ctx, s.gctx)</code>, to avoid mistakenly blocking on the un-merged <code>ctx</code> directly.  (Any values in <code>ctx</code> will also be available via <code>mctx</code>.)"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 4, "last_activity_date": 1571775666, "last_edit_date": 1571775666, "creation_date": 1571669944, "answer_id": 58489004, "question_id": 58480775, "link": "https://stackoverflow.com/questions/58480775/how-to-close-all-grpc-server-streams-using-gracefulstop/58489004#58489004", "title": "How to close all grpc server streams using gracefulStop?", "body": "<p>Create a <em>global</em> <code>context</code> for your gRPC service. So walking through the various pieces:</p>\n\n<ul>\n<li>Each gRPC service request would use this context (along with the client context) to fulfill that request</li>\n<li><code>os.Interrupt</code> handler would cancel the global context; thus canceling any currently running requests</li>\n<li>finally issue <code>server.GracefulStop()</code> - which should wait for all the active gRPC calls to finish up (if they haven't see the cancelation immediately)</li>\n</ul>\n\n<p>So for example, when setting up the gRPC service:</p>\n\n<pre><code>pctx := context.Background()\nglobalCtx, globalCancel := context.WithCancel(pctx)\n\nmysrv := MyService{\n    gctx: globalCtx\n}\n\ns := grpc.NewServer()\npb.RegisterMyService(s, mysrv)\n</code></pre>\n\n<p><code>os.Interrupt</code> handler initiates and waits for shutdown:</p>\n\n<pre><code>globalCancel()\nserver.GracefulStop()\n</code></pre>\n\n<p>gRPC methods:</p>\n\n<pre><code>func(s *MyService) SomeRpcMethod(ctx context.Context, req *pb.Request) error {\n\n    // merge client and server contexts into one `mctx`\n    // (client context will cancel if client disconnects)\n    // (server context will cancel if service Ctrl-C'ed)\n\n    mctx, mcancel := mergeContext(ctx, s.gctx)\n\n    defer mcancel() // so we don't leak, if neither client or server context cancels\n\n    // RPC WORK GOES HERE\n    // RPC WORK GOES HERE\n    // RPC WORK GOES HERE\n\n    // pass mctx to any blocking calls:\n    // - http REST calls\n    // - SQL queries etc.\n    // - or if running a long loop; status check the context occasionally like so:\n\n    // Example long request (10s)\n    for i:=0; i&lt;10*1000; i++ {\n        time.Sleep(1*time.Milliscond)\n\n        // poll merged context\n        select {\n            case &lt;-mctx.Done():\n                return fmt.Errorf(\"request canceled: %s\", mctx.Err())\n            default:\n        }\n    }\n}\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>func mergeContext(a, b context.Context) (context.Context, context.CancelFunc) {\n    mctx, mcancel := context.WithCancel(a) // will cancel if `a` cancels\n\n    go func() {\n        select {\n        case &lt;-mctx.Done(): // don't leak go-routine on clean gRPC run\n        case &lt;-b.Done():\n            mcancel() // b canceled, so cancel mctx \n        }\n    }()\n\n    return mctx, mcancel\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": false, "score": 1, "last_activity_date": 1571866151, "creation_date": 1571866151, "answer_id": 58531234, "question_id": 58480775, "link": "https://stackoverflow.com/questions/58480775/how-to-close-all-grpc-server-streams-using-gracefulstop/58531234#58531234", "title": "How to close all grpc server streams using gracefulStop?", "body": "<p>Typically clients need to assume that RPCs can terminate (e.g. due to connection errors or server power failure) at any moment.  So what we do is <code>GracefulStop</code>, sleep for a short time period to allow in-flight RPCs an opportunity to complete naturally, then hard-<code>Stop</code> the server.  If you do need to use this termination signal to end your RPCs, then the answer by @colminator is probably the best choice.  But this situation should be unusual, and you may want to spend some time analyzing your design if you do find it is necessary to manually end streaming RPCs at server shutdown.</p>\n"}], "owner": {"reputation": 51, "user_id": 12249594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/689f7af0f4ee832a3e716244d791e9d7?s=128&d=identicon&r=PG&f=1", "display_name": "rezam", "link": "https://stackoverflow.com/users/12249594/rezam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4662, "favorite_count": 1, "accepted_answer_id": 58489004, "answer_count": 2, "score": 3, "last_activity_date": 1583523473, "creation_date": 1571639038, "last_edit_date": 1583523473, "question_id": 58480775, "link": "https://stackoverflow.com/questions/58480775/how-to-close-all-grpc-server-streams-using-gracefulstop", "title": "How to close all grpc server streams using gracefulStop?", "body": "<p>I'm trying to stop all clients connected to a stream server from server side.\nActually I'm using <code>GracefulStop</code> method to handle it gracefully.</p>\n\n<p>I am waiting for <code>os.Interrupt</code> signal on a channel to perform a graceful stop for gRPC. but it gets stuck on <code>server.GracefulStop()</code> when the client is connected.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s *Service) Subscribe(_ *empty.Empty, srv clientapi.ClientApi_SubscribeServer) error {\n    ctx := srv.Context()\n\n    updateCh := make(chan *clientapi.Update, 100)\n    stopCh := make(chan bool)\n    defer func() {\n        stopCh&lt;-true\n        close(updateCh)\n    }\n\n    go func() {\n        ticker := time.NewTicker(1 * time.Second)\n        defer func() {\n            ticker.Stop()\n            close(stopCh)\n        }\n        for {\n            select {\n            case &lt;-stopCh:\n                return\n            case &lt;-ticker.C:\n                updateCh&lt;- &amp;clientapi.Update{Name: \"notification\": Payload: \"sample notification every 1 second\"}\n            }\n        }\n    }()\n\n    for {\n        select {\n        case &lt;-ctx.Done():\n            return ctx.Err()\n\n        case notif := &lt;-updateCh:\n            err := srv.Send(notif)\n            if err == io.EOF {\n                return nil\n            }\n\n            if err != nil {\n                s.logger.Named(\"Subscribe\").Error(\"error\", zap.Error(err))\n                continue\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I expected the <code>context</code> in method <code>ctx.Done()</code> could handle it and break the for loop.\nHow to close all response streams like this one?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1571616259, "post_id": 58478296, "comment_id": 103288985, "body": "If you <code>go build</code> - then it looks like you have multiple files with <code>main()</code> function declared in the current directory. Apparently both <code>dup2.go</code> and <code>helloworld.go</code> both have <code>main</code>"}, {"owner": {"reputation": 728, "user_id": 271621, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/494cb6d45903bb7b70b0dcfb5d1c245d?s=128&d=identicon&r=PG", "display_name": "Hara Chaitanya", "link": "https://stackoverflow.com/users/271621/hara-chaitanya"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571617513, "post_id": 58478296, "comment_id": 103289166, "body": "@zerkms, yes both have main and are in same directory. So the only way of reading another go file is to define them in separate package?. But why would go would try to build the file when I am trying to open it for read only."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1571617876, "post_id": 58478296, "comment_id": 103289231, "body": "&quot;when I am trying to open it&quot; --- it tries to build it when you run <code>go build</code> command."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1571648403, "post_id": 58478296, "comment_id": 103297241, "body": "The error happens at <b>compile</b> <b>time</b> and is totally unrelated to what you try to do. Opening files, multiplying numbers, whatever, all would have triggered that error as your program itself is malformed."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571654863, "post_id": 58478296, "comment_id": 103300327, "body": "The error has absolutely nothing to do with opening a file. The problem, as stated clearly, is that &quot;main&quot; is re-declared."}], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 271621, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/494cb6d45903bb7b70b0dcfb5d1c245d?s=128&d=identicon&r=PG", "display_name": "Hara Chaitanya", "link": "https://stackoverflow.com/users/271621/hara-chaitanya"}, "edited": false, "score": 0, "creation_date": 1571663512, "post_id": 58479024, "comment_id": 103304780, "body": "Thank you for your answer. I will read more about go build to understand it&#39;s workings."}], "tags": [], "owner": {"reputation": 112, "user_id": 8245053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wWDm.png?s=128&g=1", "display_name": "FuXiang Shu", "link": "https://stackoverflow.com/users/8245053/fuxiang-shu"}, "is_accepted": false, "score": 6, "last_activity_date": 1571624185, "creation_date": 1571624185, "answer_id": 58479024, "question_id": 58478296, "link": "https://stackoverflow.com/questions/58478296/opening-a-go-file-inside-another-go-program/58479024#58479024", "title": "Opening a go file inside another go program", "body": "<p>The error you got indicate that you have 2 <code>main()</code> function in the same package.<br>\nA package can have many files. When you have multiple <code>.go</code> files in the same directory that you run <code>go build</code> command in, the compiler will build the <code>main</code> package. In this case, it detected duplicated <code>main()</code> function hence the build failed.  </p>\n\n<p>What you want to do is specify which file you want to build:  </p>\n\n<pre><code>go build helloworld.go\n</code></pre>\n\n<p>With the file specified, <code>go build</code> will only build with the file(s) you have listed.  </p>\n\n<p>For more information on <code>go build</code> you can refer to <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"noreferrer\">Golang Documentation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "is_accepted": false, "score": 0, "last_activity_date": 1571762910, "creation_date": 1571762910, "answer_id": 58508943, "question_id": 58478296, "link": "https://stackoverflow.com/questions/58478296/opening-a-go-file-inside-another-go-program/58508943#58508943", "title": "Opening a go file inside another go program", "body": "<p>Though you shouldn't do it but <strong>technically</strong> you <strong>can</strong> read a '.go' file with main() from another .go file. Your case is failing as you are building a package having multiple files defining main.</p>\n\n<p>Again clarifying, it is discouraged to have multiple files with main in the same package,  and it will fail when you build the package. This is so, as there should be just one entry point (main() function) in the package.</p>\n\n<p>Coming to technicality , you can read a go file from another in same package, but in this case you need to build just the file (not the whole package). Alternately you can issue go run </p>\n\n<pre><code>$ cat main1.go \npackage main\n\nimport \"fmt\"\n\nfunc main() {\n        fmt.Println(\"Hello\")\n}\n$\n$ cat readinfolder.go \npackage main\n\nimport (\n        \"bufio\"\n        \"fmt\"\n        \"os\"\n)\n\nfunc main() {\n        filehandle, err := os.Open(\"main1.go\")\n        if err != nil {\n                panic(err)\n        }\n        defer filehandle.Close()\n        scanner := bufio.NewScanner(filehandle)\n        for scanner.Scan() {\n                fmt.Println(scanner.Text())\n        }\n}\n$\n$\n$ go build readinfolder.go \n$ ./readinfolder \npackage main\n\nimport \"fmt\"\n\nfunc main() {\n        fmt.Println(\"Hello\")\n}\n$ \n\n\n</code></pre>\n"}], "owner": {"reputation": 728, "user_id": 271621, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/494cb6d45903bb7b70b0dcfb5d1c245d?s=128&d=identicon&r=PG", "display_name": "Hara Chaitanya", "link": "https://stackoverflow.com/users/271621/hara-chaitanya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1571762910, "creation_date": 1571616079, "last_edit_date": 1571654829, "question_id": 58478296, "link": "https://stackoverflow.com/questions/58478296/opening-a-go-file-inside-another-go-program", "title": "Opening a go file inside another go program", "body": "<p>I am learning Go using \"The Go Programming Language\" book. First chapter introduced <code>os.Open</code> module for reading files. I tried opening a go file like below.</p>\n\n<pre><code>  f, err = os.Open(\"helloworld.go\")\n</code></pre>\n\n<p>I got following error:</p>\n\n<pre><code>   # command-line-arguments\n.\\helloworld.go:6:6: main redeclared in this block\n        previous declaration at .\\dup2.go:10:6\n</code></pre>\n\n<p>I want to understand why go behaved as if it's trying to compile the file instead of reading like other languages ( Python, Java or C) do. </p>\n\n<p>What is the correct way of opening a file?</p>\n"}, {"tags": ["go", "path"], "comments": [{"owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "edited": false, "score": 0, "creation_date": 1571625131, "post_id": 58477762, "comment_id": 103290441, "body": "Could you point the use case for this requirement?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571649974, "post_id": 58477762, "comment_id": 103298033, "body": "Probably not, but what do you mean? What do you think &quot;the full path of a module&quot; would look like?"}, {"owner": {"reputation": 5, "user_id": 9257958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67fb6a81669898f1346b3c4d6d2f2e93?s=128&d=identicon&r=PG&f=1", "display_name": "Amitosle", "link": "https://stackoverflow.com/users/9257958/amitosle"}, "reply_to_user": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "edited": false, "score": 0, "creation_date": 1571653612, "post_id": 58477762, "comment_id": 103299768, "body": "I imported a pkg that I need to compile while running my code. @DevendraMukharaiya"}, {"owner": {"reputation": 5, "user_id": 9257958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67fb6a81669898f1346b3c4d6d2f2e93?s=128&d=identicon&r=PG&f=1", "display_name": "Amitosle", "link": "https://stackoverflow.com/users/9257958/amitosle"}, "edited": false, "score": 0, "creation_date": 1571654872, "post_id": 58477762, "comment_id": 103300334, "body": "This is the full path &quot;~/workspace/pkg/mod/github.com/spacemeshos/go-spacemesh-moc&zwnj;&#8203;k@v0.0.0-20191020144&zwnj;&#8203;922-ca780c919bc3&quot; just another folder on my PC."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571654972, "post_id": 58477762, "comment_id": 103300374, "body": "Okay, then the answer is no; you cannot retrieve that from inside Go."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571655099, "post_id": 58477762, "comment_id": 103300430, "body": "Why do you want this? This seems a lot like an XY Problem."}, {"owner": {"reputation": 5, "user_id": 9257958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67fb6a81669898f1346b3c4d6d2f2e93?s=128&d=identicon&r=PG&f=1", "display_name": "Amitosle", "link": "https://stackoverflow.com/users/9257958/amitosle"}, "edited": false, "score": 0, "creation_date": 1571655532, "post_id": 58477762, "comment_id": 103300633, "body": "Like I mentioned before, I&#39;m trying to compile an imported package. I need the full path in order to go build it."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 9257958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67fb6a81669898f1346b3c4d6d2f2e93?s=128&d=identicon&r=PG&f=1", "display_name": "Amitosle", "link": "https://stackoverflow.com/users/9257958/amitosle"}, "edited": false, "score": 0, "creation_date": 1571655034, "post_id": 58477874, "comment_id": 103300405, "body": "Thanks for the quick reply, I am using go mod and I do see the code on my laptop.         I guess I would have to read from the mod file though I wanted not to have to do this, it&#39;s less elegant."}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 2, "last_activity_date": 1571649951, "last_edit_date": 1571649951, "creation_date": 1571610854, "answer_id": 58477874, "question_id": 58477762, "link": "https://stackoverflow.com/questions/58477762/is-there-a-way-to-get-go-modules-full-path-inside-go-code/58477874#58477874", "title": "Is there a way to get Go module&#39;s full path inside Go code", "body": "<p>Go is a compiled language, and most external libraries (modules) will be statically linked into the same binary. This means all Go libraries you are using are inside the same binary, and not in your PC.</p>\n\n<p>If you are using <code>go mod</code>, <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">this post</a> will help you understand where the modules are located during build time.\nIf you are using GOPATH alone, the libraries will be downloaded into your <code>$GOPATH/src</code> followed by the address used fot the import.</p>\n\n<p>If this is not what you are looking for, one way to analyze the libraries you used would be to check you <code>go.mod</code> file.</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1571622876, "creation_date": 1571622876, "answer_id": 58478893, "question_id": 58477762, "link": "https://stackoverflow.com/questions/58477762/is-there-a-way-to-get-go-modules-full-path-inside-go-code/58478893#58478893", "title": "Is there a way to get Go module&#39;s full path inside Go code", "body": "<blockquote>\n  <p>Is there a way to get go modules full path inside go code</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 5, "user_id": 9257958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67fb6a81669898f1346b3c4d6d2f2e93?s=128&d=identicon&r=PG&f=1", "display_name": "Amitosle", "link": "https://stackoverflow.com/users/9257958/amitosle"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "closed_date": 1571656791, "answer_count": 2, "score": -5, "last_activity_date": 1571649951, "creation_date": 1571609490, "last_edit_date": 1571643576, "question_id": 58477762, "link": "https://stackoverflow.com/questions/58477762/is-there-a-way-to-get-go-modules-full-path-inside-go-code", "closed_reason": "Needs details or clarity", "title": "Is there a way to get Go module&#39;s full path inside Go code", "body": "<p>Is there a way that I can get the full path of a module, under external libraries, that my project is using?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1571635773, "post_id": 58477419, "comment_id": 103292422, "body": "I&#39;d use <code>outputWriter.Close</code> to make things clearer (to me anyway), but I&#39;d also ditch the local variables named <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> so then I&#39;d <i>have</i> to do that. :-)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1571774413, "last_edit_date": 1571774413, "creation_date": 1571606315, "answer_id": 58477419, "question_id": 58477293, "link": "https://stackoverflow.com/questions/58477293/golang-io-copy-blocks-in-internal-readfrom/58477419#58477419", "title": "Golang io.Copy blocks in internal ReadFrom", "body": "<p>The call <code>io.Copy(&amp;output, outputReader)</code> blocks until read on <code>outputReader</code> returns EOF or some other error.  Read on <code>outputReader</code> does not return EOF because the write side of the pipe is still open in the parent process.  Fix by closing the writer in the parent process.</p>\n\n<pre><code>...\n\nif releaseProcessErr := process.Release(); releaseProcessErr != nil {\n    panic(releaseProcessErr)\n}\n\noutputWriter.Close() // &lt;-- add this line\n\nvar output bytes.Buffer\nio.Copy(&amp;output, outputReader)\nfmt.Println(output)\n\n...\n</code></pre>\n\n<p>Use the <a href=\"https://godoc.org/os/exec\" rel=\"nofollow noreferrer\">os/exec</a> package to simplify the code:</p>\n\n<pre><code>cmd := exec.Command(\"/usr/bin/ls\")\ncmd.Dir = \"/tmp\"\noutput, err := cmd.CombinedOutput()\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(string(output))\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 12081788, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-v5jUwbfZK6E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3retZLDERmM7v5pYKsGyOCU_nSYe6A/photo.jpg?sz=128", "display_name": "iamalsaher", "link": "https://stackoverflow.com/users/12081788/iamalsaher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 1, "accepted_answer_id": 58477419, "answer_count": 1, "score": 0, "last_activity_date": 1571774413, "creation_date": 1571605292, "last_edit_date": 1571696066, "question_id": 58477293, "link": "https://stackoverflow.com/questions/58477293/golang-io-copy-blocks-in-internal-readfrom", "title": "Golang io.Copy blocks in internal ReadFrom", "body": "<p>I am building a terminal emulator in golang and I was trying to run detached processes from which I can copy output and display it to the user but the io.Copy function blocks and hence I cannot continue to the output part</p>\n\n<p>I looked in the source code and it blocks in the internal ReadFrom method, I cannot understand why this is happening</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    inputReader, inputWriter, _ := os.Pipe()\n    outputReader, outputWriter, _ := os.Pipe()\n\n    io.Copy(inputWriter, bytes.NewReader([]byte(\"\\n\")))\n\n    stdin := inputReader\n    stdout := outputWriter\n    stderr := outputWriter\n\n    var attr = os.ProcAttr{\n        Dir: \"/tmp\",\n        Env: nil,\n        Files: []*os.File{\n            stdin,\n            stdout,\n            stderr,\n        },\n        Sys: nil,\n    }\n\n    process, startProcessErr := os.StartProcess(\"/usr/bin/ls\", []string{\"ls\"}, &amp;attr)\n    if startProcessErr != nil {\n        panic(startProcessErr)\n    }\n\n    if releaseProcessErr := process.Release(); releaseProcessErr != nil {\n        panic(releaseProcessErr)\n    }\n\n    var output bytes.Buffer\n    io.Copy(&amp;output, outputReader)\n    fmt.Println(output)\n}\n</code></pre>\n\n<p>Maybe it is because I release the process but I dont think it should happen</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1571602665, "post_id": 58476932, "comment_id": 103286463, "body": "This is go, not JS. Go is statically typed. So at that point, b cannot be undefined, and it can either be nil (which means it is a pointer or one of the reference types), or false, which means it is a bool. So what you&#39;re trying to do is not possible."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1571602964, "post_id": 58476932, "comment_id": 103286538, "body": "it does not make much sense in go. Mostly because values are type invariant. Meaning, if <code>b</code> is a string, then it can not be nil, false, undefined or nan or another defined type, it got to be a string. As for smart declarations and syntactic sugar, Go will not please you much. Don&#39;t fight with it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1571605808, "post_id": 58476932, "comment_id": 103287158, "body": "Given that your goal <a href=\"https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or-in-golang#comment103286843_58477058\">is to default an env var</a>, see <a href=\"https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty\">How to assign default value if env var is empty?</a>"}, {"owner": {"reputation": 175, "user_id": 11671774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97a7a564dab9b6fa5fb4b479c810dae7?s=128&d=identicon&r=PG&f=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/11671774/maxim"}, "edited": false, "score": 0, "creation_date": 1571635558, "post_id": 58476932, "comment_id": 103292363, "body": "Cerise Lim&#243;n, well, in this particular case, yes, but generally, I&#39;ve been searching for needed syntax(but as many said, it is not possible in the language)"}], "answers": [{"tags": [], "owner": {"reputation": 159, "user_id": 12248095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd47f331c591376188771ffd5722c9e4?s=128&d=identicon&r=PG", "display_name": "MonteDude", "link": "https://stackoverflow.com/users/12248095/montedude"}, "is_accepted": true, "score": 5, "last_activity_date": 1571604856, "last_edit_date": 1571604856, "creation_date": 1571602973, "answer_id": 58476985, "question_id": 58476932, "link": "https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or/58476985#58476985", "title": "How to make variable assignment with &quot;or&quot;", "body": "<p>There is no Go syntax like this. Use an if statement.</p>\n\n<p>The operands of <code>|</code> must be integers. The operands of <code>||</code> must be booleans.</p>\n\n<p>What's more, a <code>string</code> cannot be <code>false</code> or <code>nil</code>.</p>\n\n<p>Given that <a href=\"https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or-in-golang/58476985#comment103286843_58477058\">OP's actual goal</a> is to supply a default for an environment variable, the test should be on the boolean return value from <a href=\"https://godoc.org/os#LookupEnv\" rel=\"noreferrer\">os.LookupEnv</a>, not the string value.  Use a function like this:</p>\n\n<pre><code>func getenv(key string, def string) string {\n     val, ok := os.LookupEnv(key)\n     if !ok {\n         val = def\n     }\n     return val\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 175, "user_id": 11671774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97a7a564dab9b6fa5fb4b479c810dae7?s=128&d=identicon&r=PG&f=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/11671774/maxim"}, "edited": false, "score": 1, "creation_date": 1571604366, "post_id": 58477058, "comment_id": 103286843, "body": "Oh yes, thank you, I need it exactly for definig default values to Env vars"}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 2, "last_activity_date": 1571603542, "creation_date": 1571603542, "answer_id": 58477058, "question_id": 58476932, "link": "https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or/58477058#58477058", "title": "How to make variable assignment with &quot;or&quot;", "body": "<p>I had a similar desire when defining default values to Env variables.</p>\n\n<p>The way I solved it was to define a function to do it, like this:</p>\n\n<pre><code>func getenv(key, fallback string) string {\n    value := os.Getenv(key)\n    if len(value) == 0 {\n        return fallback\n    }\n    return value\n}\n</code></pre>\n\n<p>When I call this function, it looks just as concise as a \"or\" would be:</p>\n\n<pre><code>port := getenv(\"PORT\", \"8000\")\n</code></pre>\n\n<p>You could define your own functions to your use cases.</p>\n"}, {"tags": [], "owner": {"reputation": 2024, "user_id": 4113638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef898b2e31f790674840927909d0996c?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio De La Quintana", "link": "https://stackoverflow.com/users/4113638/mauricio-de-la-quintana"}, "is_accepted": false, "score": 0, "last_activity_date": 1571669268, "creation_date": 1571669268, "answer_id": 58488816, "question_id": 58476932, "link": "https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or/58488816#58488816", "title": "How to make variable assignment with &quot;or&quot;", "body": "<p>I think doing your own function is great but golang has its own way for managing flags here is an example</p>\n\n<pre><code>import (\n    \"flag\"\n)\n\nfunc main() {    \n    env := flag.String(\"env\", \"dev\", \"description\")\n}\n</code></pre>\n\n<p>so here the default value for env is <code>dev</code> and you run and change it by</p>\n\n<pre><code>go run main.go -env=prod\n</code></pre>\n\n<p>regards</p>\n"}], "owner": {"reputation": 175, "user_id": 11671774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97a7a564dab9b6fa5fb4b479c810dae7?s=128&d=identicon&r=PG&f=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/11671774/maxim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 58476985, "answer_count": 3, "score": -1, "last_activity_date": 1571669268, "creation_date": 1571602537, "last_edit_date": 1571665454, "question_id": 58476932, "link": "https://stackoverflow.com/questions/58476932/how-to-make-variable-assignment-with-or", "title": "How to make variable assignment with &quot;or&quot;", "body": "<p>Is it possible, and how to make one-line (or just short) var assignment with such logic:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>a := b (or if b is false, nil or undifined, then a equals to) \"hello\"  \n</code></pre>\n\n<p>I try to make:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>a := b | \"hello\"\n</code></pre>\n\n<p>but getting an error: \"operator | not defined on string\".</p>\n\n<p>so I am from JS, and trying to implement:</p>\n\n<pre><code>const a = b || \"hello\";\n</code></pre>\n\n<p>but in a \"Go-way\"</p>\n\n<p>As it is statically typed Lang, I meant that if b == \"\" (empty string)</p>\n"}, {"tags": ["go", "namespaces", "package", "shared-libraries", "idioms"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1571603799, "post_id": 58476795, "comment_id": 103286723, "body": "don&#39;t overthink until you know the api you are reasoning about. There is not an universal answer to your question, it depends the API and the decisions taken by its writers. though, your example, if does not fit into the main of my cli program, then it belongs to package located in <code>org&#47;whatever&#47;os</code> which contains an <code>import &quot;os&quot; .</code> and the additions."}, {"owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571656742, "post_id": 58476795, "comment_id": 103301211, "body": "@mh-cbon And what package name would you use for this extension - in your project?  I&#39;ve got a grab-bag of small additions for a dozen different stdlib or common packages out there..."}], "answers": [{"comments": [{"owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "edited": false, "score": 0, "creation_date": 1571624059, "post_id": 58476886, "comment_id": 103290233, "body": "Cool - I wasn&#39;t aware of that. I am still confused by the long term story here - how they&#39;re thinking hundreds of dev teams all wanting to make utilities to extend http - for example - are intended to do so w/o a parent namespace to distinguish them all?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571655704, "post_id": 58476886, "comment_id": 103300714, "body": "Namespaces needn&#39;t ever conflict, because you can use an alias on import, to import multiple packages with the same default name."}], "tags": [], "owner": {"reputation": 159, "user_id": 12248095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd47f331c591376188771ffd5722c9e4?s=128&d=identicon&r=PG", "display_name": "MonteDude", "link": "https://stackoverflow.com/users/12248095/montedude"}, "is_accepted": false, "score": 2, "last_activity_date": 1571602182, "creation_date": 1571602182, "answer_id": 58476886, "question_id": 58476795, "link": "https://stackoverflow.com/questions/58476795/how-to-build-extensions-to-existing-packages-idiomatically/58476886#58476886", "title": "How to build extensions to existing packages idiomatically", "body": "<p>The standard library uses \"util\" suffix. Examples:</p>\n\n<ul>\n<li><a href=\"https://godoc.org/net/http/httputil\" rel=\"nofollow noreferrer\">net/http/httputil</a></li>\n<li><a href=\"https://godoc.org/io/ioutil\" rel=\"nofollow noreferrer\">io/ioutil</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1571602389, "creation_date": 1571602389, "answer_id": 58476909, "question_id": 58476795, "link": "https://stackoverflow.com/questions/58476795/how-to-build-extensions-to-existing-packages-idiomatically/58476909#58476909", "title": "How to build extensions to existing packages idiomatically", "body": "<p>There are several ways to deal with this.</p>\n\n<p>First, even though it is discoureged, <code>misc</code>, <code>helpers</code>, <code>api</code> packages exist in many projects.</p>\n\n<p>If you are writing extensions to an existing package <code>something</code>, you can name the new package <code>somethingext</code>. </p>\n\n<p>You can use multi-level naming by relying on your users to alias is properly:</p>\n\n<pre><code>import (\n   \"os\"\n   osutils \"github.com/someproject/os\"\n)\n</code></pre>\n\n<p>If you are writing a replacement for an existing package <code>something</code>, you can name your package <code>something</code>, similar to <code>github.com/sirupsen/logrus</code>, which is a replacement for stdlib <code>log</code> package. </p>\n"}, {"comments": [{"owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "edited": false, "score": 0, "creation_date": 1571624140, "post_id": 58476919, "comment_id": 103290252, "body": "Yeah, for any given project the alias function is cool and useful. I am still confused by the long term story here - how they&#39;re thinking hundreds of dev teams all wanting to make utilities to extend http - for example - are intended to do so w/o a parent namespace to distinguish them all? I can use &#39;environment&#39; as you suggest - but then my &#39;environment&#39; package will conflict with all others who want that name..."}, {"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "reply_to_user": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "edited": false, "score": 1, "creation_date": 1571629321, "post_id": 58476919, "comment_id": 103291111, "body": "Well, if there are two <code>environment</code> packages, if they have different import paths, alias can help there. But if its in the same company, why not unite all functions in the same package ? Its always possible to have multiple packages doing the same thing. But its not like they cant be renamed to be slightly different."}, {"owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "edited": false, "score": 0, "creation_date": 1571658210, "post_id": 58476919, "comment_id": 103301946, "body": "For my own projects - I completely agree that utils.Max32(a, b) is trivially easy to read and understand - or utils.GetEnvOrDefault(), or etc.  I get the push back about publishing publicly under utils - but for a small to mid sized group, I don&#39;t see the advice to avoid such names as compelling.  I still don&#39;t see a good &quot;story&quot; for Go as a whole with only 1-level package names - name-collision is going to be rampant..."}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 1, "last_activity_date": 1571602443, "creation_date": 1571602443, "answer_id": 58476919, "question_id": 58476795, "link": "https://stackoverflow.com/questions/58476795/how-to-build-extensions-to-existing-packages-idiomatically/58476919#58476919", "title": "How to build extensions to existing packages idiomatically", "body": "<p>In very simple cases, I don't mind having <code>utils</code> packages in my projects. If the function calls are explicit, like for instance <code>utils.GetEnvOrDefault</code>, I find that it is still easy to read and understand.</p>\n\n<p>But lets consider a more complex case. You mention using the company name in the package like <code>organization_os</code>. That indeed makes the code harder to read.</p>\n\n<p>The package name can also be self-documenting. <code>enviroment.GetEnvOrDefault</code> could be an option. If the name gets too big, you can always alias the import to something more concise.</p>\n"}], "owner": {"reputation": 8647, "user_id": 112755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/653e9876709910096ccdde524a306bf8?s=128&d=identicon&r=PG", "display_name": "Mordachai", "link": "https://stackoverflow.com/users/112755/mordachai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 58476909, "answer_count": 3, "score": 0, "last_activity_date": 1571658275, "creation_date": 1571601588, "last_edit_date": 1571658275, "question_id": 58476795, "link": "https://stackoverflow.com/questions/58476795/how-to-build-extensions-to-existing-packages-idiomatically", "title": "How to build extensions to existing packages idiomatically", "body": "<p>Effective Go, and a number of other wikis and sites, exhort the Go programmer to use simple names for packages, and avoid something too general as 'misc' or 'utils'.</p>\n\n<p>Additionally, Go eschews multilevel namespaces--it has one level--the package name.</p>\n\n<p>So, package names are simple, one or two words combined at most, and specific to the topic.</p>\n\n<p>And then there's no way to inject new code into an existing package, so what's in 'os' for example is essentially sealed by the author of whatever version of package 'os' I happen to choose to use (very likely the Go <code>os</code> package).</p>\n\n<p>But this is where I'm left scratching my head.</p>\n\n<p>How do I write a good library of my own that extends existing concepts/packages such as <code>os</code> or <code>fmt</code> or something as generic as \"extends map types\" into a package or set of packages to share amongst my own projects (or my organization, or maybe publicly in time)?</p>\n\n<p>As one arbitrary example, let's say I commonly need a function such as <code>GetEnvOrDefault(key, def string) string</code></p>\n\n<p>This is useful. It could be written long-hand as set of if statements, but is self-documenting and a little shorter to write once, and allows client code to consume and be a little shorter and more concise in their meaning (less visual parsing for 'GetEnvOrDefault' vs. the spelled out code over and over and over again - in this case:</p>\n\n<pre><code>// GetEnvOrDefault returns the specified environment variable's contents, or the specified default value if that env var is not present\nfunc GetEnvOrDefault(key, defvalue string) string {\n    value := os.Getenv(key)\n    if len(value) == 0 {\n        value = defvalue\n    }\n    return value\n}\n</code></pre>\n\n<p>This is just one example. It's short so as to fit here and be easy to discuss.  I am going to go out on a limb and assume you can think of an arbitrary, more complex example where there is no question that you'd want to put it in a library so as to write and debug it once, then have multiple projects use and consume such functionality.</p>\n\n<p>What to name this package?</p>\n\n<p>Not 'utils' nor 'misc' as that's too gosh in Go.\nCan't be 'os' as that's effectively sealed.\nCan't be 'organization/os' as we can't do multi-level namespaces.\nShouldn't be 'organization_os' as that isn't idiomatic for Go.</p>\n\n<p>So where does that leave us?</p>\n\n<p>'osx' - erm... \n'osex' - fun but...\n'osmisc' - seems ugly / bad...\n'env' - okay, sure, but that's super generic - how much do I want to bet there are already packages more deserving of this name which would be in conflict in the future...</p>\n\n<p>do you feel me?</p>\n\n<p>This is one example.  But I've got useful extensions to JSON, to uuid, to maps, to 32bit math, to http servers, to http clients, ...</p>\n\n<p>What does a programmer do?</p>\n\n<p>Copy such little misc. utility functions and types around to every project?</p>\n\n<p>Come up with very non-idiomatic names for packages?</p>\n\n<p>What suggestions might you have to offer?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 6, "creation_date": 1571599588, "post_id": 58476518, "comment_id": 103285754, "body": "for range x { }"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571655379, "post_id": 58476518, "comment_id": 103300550, "body": "You can easily use multiple blank identifiers.. you just can&#39;t use <code>:=</code> when all the identifiers on the left are blank, because then <code>no new variables on left side of :=</code>."}], "answers": [{"tags": [], "owner": {"reputation": 159, "user_id": 12248095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd47f331c591376188771ffd5722c9e4?s=128&d=identicon&r=PG", "display_name": "MonteDude", "link": "https://stackoverflow.com/users/12248095/montedude"}, "is_accepted": true, "score": 5, "last_activity_date": 1571600153, "creation_date": 1571600153, "answer_id": 58476606, "question_id": 58476518, "link": "https://stackoverflow.com/questions/58476518/how-to-use-multiple-blank-identifiers-in-go/58476606#58476606", "title": "How to use multiple blank identifiers in go?", "body": "<p>The code uses short variable declaration, but no new variables are declared because the <a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"noreferrer\">blank identifier</a> <code>_</code> does not represent a variable name.</p>\n\n<p>Use the following code:</p>\n\n<pre><code>for _, _ = range x {\n    //Do some work\n}\n</code></pre>\n\n<p>Note use of <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assignment</a> instead of <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable declaration</a>.</p>\n\n<p>Better yet, don't assign any variables as shown in comment by mh-cbon:</p>\n\n<pre><code>for range {\n   //Do some work\n}\n</code></pre>\n\n<p>The variable-free form was added in <a href=\"https://golang.org/doc/go1.4#forrange\" rel=\"noreferrer\">Go 1.4</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 0, "last_activity_date": 1571600174, "creation_date": 1571600174, "answer_id": 58476607, "question_id": 58476518, "link": "https://stackoverflow.com/questions/58476518/how-to-use-multiple-blank-identifiers-in-go/58476607#58476607", "title": "How to use multiple blank identifiers in go?", "body": "<p>When none of the variables are being used, you can ignore the blank identifiers.</p>\n\n<pre><code>x := [5]float64{1, 2, 3, 4, 5}\nfor range x {\n    //Do some work\n}\n</code></pre>\n\n<p>As noted by @MonteDude , the <code>_</code> variable is already defined. This is why you get a <code>no new variables on left side of :=</code> error.</p>\n"}], "owner": {"reputation": 132, "user_id": 8314979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddfc77cfcef5a02c35a83e236e4425a3?s=128&d=identicon&r=PG", "display_name": "Shikhar Saxena", "link": "https://stackoverflow.com/users/8314979/shikhar-saxena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 58476606, "answer_count": 2, "score": -2, "last_activity_date": 1571600174, "creation_date": 1571599486, "question_id": 58476518, "link": "https://stackoverflow.com/questions/58476518/how-to-use-multiple-blank-identifiers-in-go", "title": "How to use multiple blank identifiers in go?", "body": "<p>I am trying to use more than one blank identifiers in a loop because I am not interested in the values but I am not able to use it.</p>\n\n<p>Here's my code</p>\n\n<pre><code>x := [5]float64{1, 2, 3, 4, 5}\nfor _, _ := range x {\n    //Do some work\n}   \n</code></pre>\n\n<p>I am wondering how can one blank identifiers more than once in a statement?</p>\n\n<p>The error I am getting is\n<code>no new variables on left side of :=</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 2, "creation_date": 1571591903, "post_id": 58475288, "comment_id": 103283852, "body": "To use an interface in this case looks idiomatic to me.  But the interface itself is not perfect. I do not understand why <code>Lhs</code> and <code>Rhs</code> are not a <code>Node</code> type. Later you can use a type assertion or type switch to get the types back."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571666142, "post_id": 58475288, "comment_id": 103306261, "body": "I would be looking for some real functionality common to leaf nodes; if there is none, there seems to be minimal benefit in trying to establish a dedicated type/interface for them."}, {"owner": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571690132, "post_id": 58475288, "comment_id": 103317405, "body": "@Adrian Think of this way: dedicated type not for sharing same traits (functions) but for sharing similar attributes (fields). Like a type that can be generic among group of types."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1571594600, "creation_date": 1571594600, "answer_id": 58475774, "question_id": 58475288, "link": "https://stackoverflow.com/questions/58475288/idiomatic-way-of-representing-generic-data-type-in-golang/58475774#58475774", "title": "Idiomatic way of representing generic data type in golang", "body": "<p>Use the following types to ensure that only leaf types can be assigned to ExprNode.Lhs and Exprnode.Rhs:</p>\n\n<pre><code>type Node interface{\n  Pos() int64\n  Typ() NodeType \n}\n\ntype LeafNode interface {\n  Node\n  Leaf() // sentinel function to distinguish leaf types from other types\n}\n\nfunc (*NumberNode) Leaf() {}\nfunc (*StringNode) Leaf() {}\n\ntype ExprNode struct {\n  Lhs  LeafNode \n  Op   Operation\n  Rhs  LeafNode \n  Node\n}\n</code></pre>\n"}], "owner": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 58475774, "answer_count": 1, "score": 1, "last_activity_date": 1571594600, "creation_date": 1571590904, "question_id": 58475288, "link": "https://stackoverflow.com/questions/58475288/idiomatic-way-of-representing-generic-data-type-in-golang", "title": "Idiomatic way of representing generic data type in golang", "body": "<p>In a particular implementation of AST, I have a <code>node</code> which is an interface and <code>ExprNode</code>, <code>EvalNode</code> and some leaf nodes. Now leaf nodes can be string node or number node or function node\nEach expression node can have only two leaf nodes. One on left and One on right.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Node interface{\n  Pos() int64\n  Typ() NodeType \n}\n\ntype StringNode struct{\n  Pos int64\n  Val string\n  Node\n}\n\ntype NumberNode struct {\n  Pos int64\n  Val float64\n  Node\n}\n\ntype ExprNode struct {\n  Lhs  ???  //should accept either StringNode or NumberNode \n  Op   Operation\n  Rhs  ???  //should accept either StringNode or NumberNode \n  Node\n}\n\ntype EvalNode struct{\n  Lhs     *ExprNode\n  AllFlag bool\n  Rhs     *ExprNode\n  Node\n}\n</code></pre>\n\n<p>I've come up with a workaround which may not be idiomatic. I'm looking if there's any better way of doing this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type LeafNode interface{\n  IsLeaf() bool\n}\n\nfunc (n *StringNode) IsLeaf() bool{\n  return true\n}\n\nfunc (n *NumberNode) IsLeaf() bool{\n  return true\n}\n\ntype ExprNode struct {\n  Lhs  LeafNode   //workaround\n  Op   Operation\n  Rhs  LeafNode   //workaround\n  Node\n}\n\n</code></pre>\n\n<p>Now in the above workaround, IsLeaf() function is of no significance for me, but I had to use it to limit the node types accepted on ExprNode.</p>\n\n<p>Sincere apologies if the title looked too broad. </p>\n\n<p>Question: Is there a better way of programming the above scenario.</p>\n\n<p>Note: I'm only looking for idiomatic ways of handling above scenario and not for alternate implementations of the algorithm.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571666310, "post_id": 58475257, "comment_id": 103306331, "body": "&quot;looping over the test map (which contains 1 entry) takes 3.5ms&quot; which tells you absolutely nothing. A microbenchmark so tiny should not be taken as representative of anything at all. A one-entry map might take 3.5ms and a million-entry map might take 4ms - who knows? With a benchmark so small, initializing the iterator takes a non-negligible part of the execution time. Also don&#39;t write your own benchmarks, use the ones in the <code>testing</code> package, they actually have a change at being accurate."}], "answers": [{"tags": [], "owner": {"reputation": 106, "user_id": 3600236, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m8CcM.png?s=128&g=1", "display_name": "Seebs", "link": "https://stackoverflow.com/users/3600236/seebs"}, "is_accepted": true, "score": 2, "last_activity_date": 1571591585, "creation_date": 1571591585, "answer_id": 58475364, "question_id": 58475257, "link": "https://stackoverflow.com/questions/58475257/map-delete-doesnt-actually-delete-entries/58475364#58475364", "title": "Map delete() doesn&#39;t actually delete entries", "body": "<p>I'd expect performance to be roughly scaling based on the maximum size the map has ever had, but I wouldn't expect it to get worse with additional writes-and-deletes over time. There's two components; there's the time to check all the buckets, which will scale with the size the map has ever had, and the time to yield the results, which will scale with the number of entries currently present.</p>\n\n<p>But adding and deleting things shouldn't further change it.</p>\n\n<p><a href=\"https://play.golang.org/p/Ouj-3MuZvVt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ouj-3MuZvVt</a></p>\n\n<p>See also <a href=\"https://github.com/golang/go/issues/20135\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/20135</a>, the issue tracking \"maps don't shrink after delete\".</p>\n\n<p>If you really need to iterate over a very small portion of a map, you might want to make a new map containing only the items you're keeping, but it's not insertions/deletions costing you time, it's the maximum size the map has had; note how much smaller the time consumption is if you add-and-delete 1000 items, 1000 times, rather than adding a million items and then deleting them.</p>\n"}], "owner": {"reputation": 50, "user_id": 5392757, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vU2TA.png?s=128&g=1", "display_name": "Vlad", "link": "https://stackoverflow.com/users/5392757/vlad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "accepted_answer_id": 58475364, "answer_count": 1, "score": 1, "last_activity_date": 1571591585, "creation_date": 1571590630, "question_id": 58475257, "link": "https://stackoverflow.com/questions/58475257/map-delete-doesnt-actually-delete-entries", "title": "Map delete() doesn&#39;t actually delete entries", "body": "<p>After many additions/deletions in a map, ranging over the map is slower than expected.</p>\n\n<p>Consider the following code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    test := make(map[int]bool)\n    for i := 0; i &lt; 1000000; i++ {\n        test[i] = true\n    }\n    for k := range test {\n        delete(test, k)\n    }\n    test[0] = true\n    fmt.Printf(\"test len(): %d\\n\", len(test))\n    now := time.Now()\n    for range test {\n    }\n    fmt.Printf(\"range took %v\\n\", time.Since(now))\n}\n</code></pre>\n\n<p>On my system, looping over the test map (which contains 1 entry) takes 3.5ms. This is an issue because we're running similar code in production, and after a while we have many millions of deleted entries per map. </p>\n\n<p>The GC doesn't seem to help, and the only solution I can think of is to set the entire map to nil and then remake it. Are there any other ways?</p>\n"}, {"tags": ["go", "google-cloud-platform", "airflow", "google-cloud-composer"], "comments": [{"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 1, "creation_date": 1571589423, "post_id": 58474944, "comment_id": 103283163, "body": "Just to clarify, do you want to write DAGs using Go? Or create a DAG from your Go application? Or run Go code as a task in your DAG?"}, {"owner": {"reputation": 356, "user_id": 1008290, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hBYEQ.jpg?s=128&g=1", "display_name": "Deepak Garg", "link": "https://stackoverflow.com/users/1008290/deepak-garg"}, "reply_to_user": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 0, "creation_date": 1571608816, "post_id": 58474944, "comment_id": 103287816, "body": "@norbjd I need to do all the three"}], "answers": [{"comments": [{"owner": {"reputation": 340, "user_id": 3034160, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/82e0b86cfa2fcf2f3a78dc555c35cf89?s=128&d=identicon&r=PG&f=1", "display_name": "Xao", "link": "https://stackoverflow.com/users/3034160/xao"}, "edited": false, "score": 0, "creation_date": 1597845638, "post_id": 58479862, "comment_id": 112266685, "body": "How did you pushed go binaries to airflow? Did you gsutil&#39;ed it to {bucket_path}/data/ ?"}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 340, "user_id": 3034160, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/82e0b86cfa2fcf2f3a78dc555c35cf89?s=128&d=identicon&r=PG&f=1", "display_name": "Xao", "link": "https://stackoverflow.com/users/3034160/xao"}, "edited": false, "score": 0, "creation_date": 1597861768, "post_id": 58479862, "comment_id": 112274455, "body": "@Xao, yes it&#39;s the easiest. But create a folder with  your binary and another one with your data to not mix both!"}], "tags": [], "owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "is_accepted": true, "score": 2, "last_activity_date": 1571632499, "creation_date": 1571632499, "answer_id": 58479862, "question_id": 58474944, "link": "https://stackoverflow.com/questions/58474944/golang-client-library-support-for-apache-airflow/58479862#58479862", "title": "Golang client library support for Apache Airflow", "body": "<p>Thanks to your clarification, you can't! Indeed, Composer is a managed version of <a href=\"https://airflow.apache.org/\" rel=\"nofollow noreferrer\">Apache Airflow</a>, where dags are described in Python and in Python only.</p>\n\n<p>You can reach the Composer/Airflow API with Go, you can generate Python code with Go and Go template. You can also define a <a href=\"https://airflow.apache.org/plugins.html\" rel=\"nofollow noreferrer\">custom Operator in Airflow</a> which run a Go binary with the right parameters. However, the custom operator itself must be wrote in Python.</p>\n"}], "owner": {"reputation": 356, "user_id": 1008290, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hBYEQ.jpg?s=128&g=1", "display_name": "Deepak Garg", "link": "https://stackoverflow.com/users/1008290/deepak-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1811, "favorite_count": 0, "accepted_answer_id": 58479862, "answer_count": 1, "score": -1, "last_activity_date": 1597845627, "creation_date": 1571588649, "question_id": 58474944, "link": "https://stackoverflow.com/questions/58474944/golang-client-library-support-for-apache-airflow", "title": "Golang client library support for Apache Airflow", "body": "<p>I'm using Google cloud composer which essentially gives you an Apache Airflow environment. Since my application is written in Golang, I was looking for a golang client library to create and execute DAGs in the Cloud Composer Airflow environment. Please let me know if there's any.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1571584794, "post_id": 58474309, "comment_id": 103281927, "body": "Show the code that you tried so far.  Describe the logic for finding the &quot;last object&quot;.  Is it the last object in lexicographic key order, most deeply nested object or something else?"}, {"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571586763, "post_id": 58474309, "comment_id": 103282406, "body": "I added the code"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571587873, "post_id": 58474309, "comment_id": 103282722, "body": "Describe the logic for finding the &quot;last object&quot;.  Your intent is not clear from the code and prose.  The code attempts to add a value to a map containing a value that is not a map[string]interface{} or []interface{}.  The prose says to add the value to a map that does not have complex values."}, {"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571588045, "post_id": 58474309, "comment_id": 103282764, "body": "ok the above code just checks the type of each attribute. all i am interested in is adding a new attribute to the last nested map. and that seems not to be possible when you dont know the names of your attributes ahead of time."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571588224, "post_id": 58474309, "comment_id": 103282805, "body": "Describe &quot;last&quot;.  Is it last in breadth first order, depth first order, most deeply nested or ????.   How are keys ordered?"}, {"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571588247, "post_id": 58474309, "comment_id": 103282812, "body": "most deeply nested. the data is a mongo response. there is not structure."}], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571588378, "post_id": 58474900, "comment_id": 103282846, "body": "I can&#39;t really apply structs here because the data is a mongo document and i don&#39;t know ahead of time what attributes it has."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 1, "last_activity_date": 1571588275, "creation_date": 1571588275, "answer_id": 58474900, "question_id": 58474309, "link": "https://stackoverflow.com/questions/58474309/adding-an-attribute-to-a-nested-mapstringinterface-in-golang/58474900#58474900", "title": "Adding an attribute to a nested map[string]interface{} in Golang", "body": "<p>Try to avoid working with the raw <code>map[string]interface{}</code> type as much as you can.  The Go <code>encoding/json</code> file can deal with string-keyed maps just fine, and hopefully the remote API has <em>some</em> sort of specification for what you're dealing with.  (You know that you're expecting a <code>person</code> top-level key and <code>scores</code> in a specific point in the hierarchy, for example.)</p>\n\n<p>I'm assuming the remote API is JSON-over-HTTP.  You might model its structure as</p>\n\n<pre><code>type Input struct {\n    Person map[string]Person `json:\"person\"`\n}\n\ntype Person struct {\n    Scores map[string]int `json:\"scores\"`\n}\n</code></pre>\n\n<p>Once you've <code>json.Unmarshal()</code>ed data into this structure, you can directly set</p>\n\n<pre><code>data.Person[\"peter\"].Scores[\"physics\"] = 95\n</code></pre>\n\n<p>and then <code>json.Marshal()</code> the result again.  <a href=\"https://play.golang.org/p/qoAVFodSvK2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qoAVFodSvK2</a> has a complete example.</p>\n\n<p>If you really wanted to directly manipulate the <code>map[string]interface{}</code> structure, I'd suggest splitting each \"level\" into a separate function call</p>\n\n<pre><code>func ParseTopLevel(data map[string]interface{}) {\n    switch peter := data[\"peter\"].(type) {\n    case map[string]interface{}:\n        ParsePeter(peter)\n    }\n}\n</code></pre>\n\n<p><code>map</code> types are <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">passed by reference</a>, so when you get to the bottom of the stack you can directly set <code>scores[\"physics\"] = 95</code>.  (In your original code, I'd be surprised if you can't directly set <code>aMap[\"physics\"]</code> as you propose, though it's rather imprecise on what gets set; compare <a href=\"https://play.golang.org/p/VuTjcjezwwU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VuTjcjezwwU</a>.)</p>\n"}, {"comments": [{"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571589883, "post_id": 58475050, "comment_id": 103283306, "body": "Thanks Cerise Limon!"}, {"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571599136, "post_id": 58475050, "comment_id": 103285629, "body": "Why do you need the <code>depth</code> variable though? It seems to work fine without it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571599891, "post_id": 58475050, "comment_id": 103285822, "body": "The depth variable is used to select the deepest map contained in any child map. This variable is not needed with the sample data because there&#39;s at most one nested map at each level."}, {"owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571601086, "post_id": 58475050, "comment_id": 103286071, "body": "ok, i get it. thanks. wondering, what happens when there are sibling objects at same level."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "edited": false, "score": 0, "creation_date": 1571601797, "post_id": 58475050, "comment_id": 103286263, "body": "@pro  If there is more than one map at the greatest nesting level, this function returns arbitrary one of those maps."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1571603766, "last_edit_date": 1571603766, "creation_date": 1571589324, "answer_id": 58475050, "question_id": 58474309, "link": "https://stackoverflow.com/questions/58474309/adding-an-attribute-to-a-nested-mapstringinterface-in-golang/58475050#58475050", "title": "Adding an attribute to a nested map[string]interface{} in Golang", "body": "<p>According the comments on the question, the goal is to set a value in the most deeply nested map.</p>\n\n<p>Use the following function to find a map at the greatest nesting level. If there is more than one map at the greatest nesting level, this function returns an arbitrary one of those maps.  </p>\n\n<pre><code>func findDeepest(m map[string]interface{}) (int, map[string]interface{}) {\n    depth := 0\n    candidate := m\n    for _, v := range m {\n        if v, ok := v.(map[string]interface{}); ok {\n            d, c := findDeepest(v)\n            if d+1 &gt; depth {\n                depth = d + 1\n                candidate = c\n            }\n        }\n    }\n    return depth, candidate\n}\n</code></pre>\n\n<p>Use it like this to set a value in the deeply nested map:</p>\n\n<pre><code>_, m := findDeepest(data)\nm[\"physics\"] = 95\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XiEz-XktwyP\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 0, "accepted_answer_id": 58475050, "answer_count": 2, "score": -2, "last_activity_date": 1571603766, "creation_date": 1571584049, "last_edit_date": 1571588533, "question_id": 58474309, "link": "https://stackoverflow.com/questions/58474309/adding-an-attribute-to-a-nested-mapstringinterface-in-golang", "title": "Adding an attribute to a nested map[string]interface{} in Golang", "body": "<p>I am dealing with data that is of the type <code>map[string]interface{}</code>. it can have unlimited number of nested objects inside (map[string]interface{}) types. </p>\n\n<p><strong>EDIT:</strong> <em>This data comes from mongodb. I can't really apply golang's struct here because the attributes vary from document to document. All I want to do is get the most deeply nested object, add a new attribute to it and make sure the entire data object is updated after.</em></p>\n\n<pre><code>data[\"person\"] = map[string]interface{}{\n    \"peter\": map[string]interface{}{\n        \"scores\": map[string]interface{}{\n            \"calculus\": 88,\n            \"algebra\":  99,\n            \"golang\":   89,\n        },\n    },\n}\n</code></pre>\n\n<p>This data is coming from a remote API and I have no idea of the properties inside. All I want to add is add new attribute inside the last object (in this case \"scores\"), and lets say with this new attribute (\"physics\") the data would look like this</p>\n\n<pre><code>data[\"person\"] = map[string]interface{}{\n    \"peter\": map[string]interface{}{\n        \"scores\": map[string]interface{}{\n            \"calculus\": 88,\n            \"algebra\":  99,\n            \"golang\":   89,\n            \"physics\":  95,\n        },\n    },\n}\n</code></pre>\n\n<p>I am not sure how I could get that attribute added to the very last object.</p>\n\n<p>I did recursive type checking and was able to get each field and print its value. But because maps are not referential I cannot add a value to the original map when I reach the map with the values that are not complex types.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    data := make(map[string]interface{})\n    data[\"person\"] = map[string]interface{}{\n        \"peter\": map[string]interface{}{\n            \"scores\": map[string]interface{}{\n                \"calculus\": 88,\n                \"algebra\":  99,\n                \"golang\":   89,\n            },\n        },\n    }\n\n    parseMap(data)\n}\n\n\nfunc parseMap(aMap map[string]interface{}) interface{} {\n    var retVal interface{}\n\n    for _, val := range aMap {\n        switch val.(type) {\n        case map[string]interface{}:\n            retVal = parseMap(val.(map[string]interface{}))\n        //case []interface{}:\n        //  retVal = parseArray(val.([]interface{}))\n        default:\n            //here i would have done aMap[\"physics\"] = 95 if I could access the original map by reference, but that is not possible\n\n            retVal = aMap\n\n        }\n    }\n\n    return retVal\n}\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 374, "user_id": 2922325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9899c6076db8f952438be96c18819024?s=128&d=identicon&r=PG&f=1", "display_name": "jazz", "link": "https://stackoverflow.com/users/2922325/jazz"}, "is_accepted": false, "score": 0, "last_activity_date": 1571591311, "creation_date": 1571591311, "answer_id": 58475332, "question_id": 58473828, "link": "https://stackoverflow.com/questions/58473828/how-to-nest-one-go-module-inside-multiple-go-modules-as-local-dependency/58475332#58475332", "title": "How to nest one go module inside multiple Go modules as local dependency", "body": "<p>A clean way to do achieve this is to have utils a standalone module outside of all projects and then import wherever you want. Since its evident you want it to be a module itself.</p>\n\n<p>Like</p>\n\n<pre><code>GOPATH\n+---src\n     +--- my-api-server\n           +--- my-auth-server\n                 +--- main.go\n                 +--- go.mod\n                 +--- go.sum\n     +--- my-utils\n          +--- go.mod\n          +--- go.sum\n          +--- uuid\n               +--- uuid.go\n</code></pre>\n\n<p>But if you still need to have utils also maintained as part of your API server then have your API server as module and import it wherever you need utils package. This is discouraged but will not do any harm since GO optimizes as part of compilation required context.</p>\n\n<p>Like this </p>\n\n<pre><code>GOPATH\n+---src\n     +--- my-api-server\n           +--- my-auth-server\n                 +--- main.go\n                 +--- go.mod\n                 +--- go.sum\n                 +--- my-utils\n                      +--- uuid\n                           +--- uuid.go\n</code></pre>\n\n<p>What i understand is you need to maintain multi modules in single repo and cross refer. As far as I understand this is not how its supposed to work since you can always cross refer nested package by module relative path.</p>\n\n<p>Also maybe you know this, but since you are using modules, you need to sit in GOPATH/GOROOT for resolution.</p>\n"}], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571591311, "creation_date": 1571580568, "question_id": 58473828, "link": "https://stackoverflow.com/questions/58473828/how-to-nest-one-go-module-inside-multiple-go-modules-as-local-dependency", "title": "How to nest one go module inside multiple Go modules as local dependency", "body": "<pre><code>$ go version\n1.13.3\n</code></pre>\n\n<p>I have a folder structure as follows:</p>\n\n<pre><code>GOPATH\n+---src\n     +--- my-api-server\n           +--- my-auth-server\n                 +--- main.go\n                 +--- go.mod\n                 +--- go.sum\n           +--- my-utils\n                 +--- go.mod\n                 +--- go.sum\n                 +--- uuid\n                       +--- uuid.go\n</code></pre>\n\n<p><code>my-auth-server</code> uses <code>my-api-server/my-utils/uuid</code> as a dependency</p>\n\n<p>I tried moving <code>my-utils</code> inside <code>my-auth-server</code>, but as a library, <code>my-utils</code> will be used in multiple places.</p>\n\n<p>Now, <code>my-utils</code> also has a <code>go.mod</code>, but that contains a <code>module</code> declaration.\nIf I place it in <code>my-auth-server</code>, the module path becomes <code>my-api-server/my-auth-server/my-utils</code></p>\n\n<p>If I have 2 servers,</p>\n\n<ul>\n<li><code>my-auth-server</code></li>\n<li><code>my-session-server</code></li>\n</ul>\n\n<p>I cannot place <code>my-utils</code> inside both because there can only be one <code>module</code> declaration per <code>go.mod</code>.</p>\n\n<p>So, how I use this in two different projects as submodule?</p>\n\n<p>Any help in solving this would also be appreciated.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1573131595, "post_id": 58473656, "comment_id": 103787028, "body": "See this answer: <a href=\"https://stackoverflow.com/a/55347424/1218512\">stackoverflow.com/a/55347424/1218512</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 12, "last_activity_date": 1572028165, "creation_date": 1572028165, "answer_id": 58563894, "question_id": 58473656, "link": "https://stackoverflow.com/questions/58473656/malformed-module-path-xxxx-xxxx-uuid-missing-dot-in-first-path-element-when-mi/58563894#58563894", "title": "malformed module path &quot;xxxx/xxxx/uuid&quot; missing dot in first path element when migrating from GOPATH based dep to go mod", "body": "<p>The <code>go.mod</code> file should be at the root of your project (in this case, <code>my-api-server/go.mod</code>).</p>\n\n<p>The first part of the module path should be a domain/path. For example, the full path might be <code>github.com/your-github-username/my-api-server</code>. The error you're seeing is because the first part is not a domain (with a period). You don't have to publish the module to develop it, but you need to use a proper domain name.</p>\n\n<p>Once you have a module path, you can import packages contained in that module using the full module path + \"/\" + the relative path of the package. For example,</p>\n\n<pre><code>import \"github.com/your-github-username/my-api-server/my-utils/uuid\"\n</code></pre>\n\n<p>Since <code>main.go</code> and <code>uuid</code> are contained in the same module, you don't need a <code>require</code> statement in the <code>go.mod</code> file to use the <code>uuid</code> package. You can import it like any other package and it will work.</p>\n\n<p>I recommend using <code>go build</code> and running the resulting executable rather than using <code>go run</code> to make sure you include all of the files you need in the build process.</p>\n\n<p>See <a href=\"https://blog.golang.org/using-go-modules\" rel=\"noreferrer\">https://blog.golang.org/using-go-modules</a> for a walkthrough of how to use Go modules, including the <a href=\"https://blog.golang.org/migrating-to-go-modules\" rel=\"noreferrer\">second post</a> in that series about how to convert a project to use modules.</p>\n"}, {"tags": [], "owner": {"reputation": 379, "user_id": 6567055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-54co2AZ0T6Q/AAAAAAAAAAI/AAAAAAAASWI/ArbHxGqzEeo/photo.jpg?sz=128", "display_name": "Nathaniel Rand", "link": "https://stackoverflow.com/users/6567055/nathaniel-rand"}, "is_accepted": false, "score": 2, "last_activity_date": 1592328543, "last_edit_date": 1592328543, "creation_date": 1575903947, "answer_id": 59251587, "question_id": 58473656, "link": "https://stackoverflow.com/questions/58473656/malformed-module-path-xxxx-xxxx-uuid-missing-dot-in-first-path-element-when-mi/59251587#59251587", "title": "malformed module path &quot;xxxx/xxxx/uuid&quot; missing dot in first path element when migrating from GOPATH based dep to go mod", "body": "<p>Check your import paths on your main.go file. </p>\n\n<p>I had to call the entire import path: </p>\n\n<pre><code>github.com/[username]/[project-name]/views\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>[project-name]/views \n</code></pre>\n\n<p>to make it work on my end.</p>\n"}, {"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1584604295, "post_id": 60752857, "comment_id": 107488423, "body": "<code>Do not put your project inside GOPATH... that is so confusing</code> - That is a convention, which I particularly prefer."}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1584604311, "post_id": 60752857, "comment_id": 107488427, "body": "Also, the error is <code>missing dot in first path element</code> not <code>cannot resolve module</code>"}, {"owner": {"reputation": 450, "user_id": 2965665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc4f155dbe24567ff73e58704359028f?s=128&d=identicon&r=PG&f=1", "display_name": "Russo", "link": "https://stackoverflow.com/users/2965665/russo"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1584604830, "post_id": 60752857, "comment_id": 107488590, "body": "Ayush Gupta, the error is caused by incorrect module usage"}, {"owner": {"reputation": 450, "user_id": 2965665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc4f155dbe24567ff73e58704359028f?s=128&d=identicon&r=PG&f=1", "display_name": "Russo", "link": "https://stackoverflow.com/users/2965665/russo"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1584605099, "post_id": 60752857, "comment_id": 107488685, "body": "incorrect package versions have incorrect file path =&gt; cause Golang not able to find the correct file to run or build"}], "tags": [], "owner": {"reputation": 450, "user_id": 2965665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc4f155dbe24567ff73e58704359028f?s=128&d=identicon&r=PG&f=1", "display_name": "Russo", "link": "https://stackoverflow.com/users/2965665/russo"}, "is_accepted": false, "score": -4, "last_activity_date": 1584604526, "last_edit_date": 1584604526, "creation_date": 1584604078, "answer_id": 60752857, "question_id": 58473656, "link": "https://stackoverflow.com/questions/58473656/malformed-module-path-xxxx-xxxx-uuid-missing-dot-in-first-path-element-when-mi/60752857#60752857", "title": "malformed module path &quot;xxxx/xxxx/uuid&quot; missing dot in first path element when migrating from GOPATH based dep to go mod", "body": "<p>BECAUSE GO CANNOT FIND THE MODULE!!!</p>\n\n<p>Do not put your project inside GOPATH... that is so confusing</p>\n\n<p>Instead...</p>\n\n<p>set in .bashrc:  export GO111MODULE=on</p>\n\n<p>close all command line terminals, then re-open terminals</p>\n\n<p>go to the project root folder</p>\n\n<p>$ go mod init project_module_name</p>\n\n<p>This will generate go.mod file </p>\n\n<p>Install your packages with the version you want:\n<code>go get -v github.com/golang/protobuf@v1.3.4</code></p>\n\n<p>Then run $ <code>go run main.go</code></p>\n\n<p>Now the go.mod file should record the package versions Golang will use to run and build... </p>\n\n<p>Make sure your are using the correct package versions by checking the go.mod file! It should look like: github.com/golang/protobuf v1.3.4</p>\n"}, {"tags": [], "owner": {"reputation": 130, "user_id": 2049642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a6a6c62f87df9c462ead7381be98218?s=128&d=identicon&r=PG", "display_name": "abhijeet104", "link": "https://stackoverflow.com/users/2049642/abhijeet104"}, "is_accepted": false, "score": 0, "last_activity_date": 1603730205, "last_edit_date": 1603730205, "creation_date": 1603728366, "answer_id": 64540814, "question_id": 58473656, "link": "https://stackoverflow.com/questions/58473656/malformed-module-path-xxxx-xxxx-uuid-missing-dot-in-first-path-element-when-mi/64540814#64540814", "title": "malformed module path &quot;xxxx/xxxx/uuid&quot; missing dot in first path element when migrating from GOPATH based dep to go mod", "body": "<p>if you are trying to use a global package(non standard), there should be a dot('.') in the first part of package name. Probably expects dot('.') as it does in any URL, in this case github.com....which marks that as remote package.</p>\n<p>If you want to use local package, then you need to use go module, then first part would be the name of you go module(name which you have used during initilization of your go module).</p>\n<p>Example (as per the question):\nGo to project root folder (in this case <code>../src$</code>) &amp; run following command</p>\n<pre><code>go mod init myapiserver\n</code></pre>\n<p>This will create a <em><strong>go.mod</strong></em> &amp; <em><strong>go.sum</strong></em> file.</p>\n<p>Then to import uuid, you can simply use <code>myapiserver/my-utils/uuid</code> in import</p>\n<pre><code>import &quot;myapiserver/my-utils/uuid&quot;\n</code></pre>\n<p>then all the public functions(which starts with Capital letters) from <code>uuid.go</code> will be accessible in the current file</p>\n"}], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17815, "favorite_count": 1, "accepted_answer_id": 58563894, "answer_count": 4, "score": 16, "last_activity_date": 1603730205, "creation_date": 1571579350, "question_id": 58473656, "link": "https://stackoverflow.com/questions/58473656/malformed-module-path-xxxx-xxxx-uuid-missing-dot-in-first-path-element-when-mi", "title": "malformed module path &quot;xxxx/xxxx/uuid&quot; missing dot in first path element when migrating from GOPATH based dep to go mod", "body": "<pre>\n$ go version\n1.13.3\n</pre>\n\n<p>I have a folder structure as follows:</p>\n\n<pre><code>GOPATH\n+---src\n     +--- my-api-server\n           +--- my-auth-server\n                 +--- main.go\n           +--- my-utils\n                 +--- uuid\n                       +--- uuid.go\n</code></pre>\n\n<p><code>my-auth-server</code> uses <code>my-api-server/my-utils/uuid</code> as a depenency</p>\n\n<p>Now, when I used the GOPATH based module system, this worked fine. But when using go modules, when I run <code>go run main.go</code> in <code>my-auth-server</code> it returned error:</p>\n\n<pre><code>build command-line-arguments: cannot load my-api-server/my-utils/uuid: malformed module path \"my-api-server/my-utils/uuid\": missing dot in first path element\n</code></pre>\n\n<p>Any idea how to solve this?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 9, "user_id": 11807001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a94ce0d571f2899c979aca9ce6506aaf?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/11807001/swati"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571581188, "post_id": 58473562, "comment_id": 103280956, "body": "@mkopriva already checked this. We are closing the files."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1571597520, "post_id": 58473562, "comment_id": 103285189, "body": "How should we know without your code?"}], "owner": {"reputation": 9, "user_id": 11807001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a94ce0d571f2899c979aca9ce6506aaf?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/11807001/swati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571578635, "creation_date": 1571578635, "question_id": 58473562, "link": "https://stackoverflow.com/questions/58473562/got-too-many-opened-files-error-in-db-console", "title": "Got too many opened files error in db console", "body": "<p>I am working on a Golang project and for db server I am using MongoDB. It was working fine but today morning I got the issue \"Too many opened files...\" and MongoDB server shut down automatically. Now MongoDB server crashed after every 15-20 min with the same message. I have searched for the solution and set the opened files limit as</p>\n\n<pre><code>* hard nofile 990000\n* soft nofile 990000\nroot hard nofile 990000\nroot soft nofile 990000\n</code></pre>\n\n<p>But I am still getting the same issue \"Too many opened files\" after restart the service.\nPlease let me know how I can fix this.</p>\n"}, {"tags": ["go", "memory", "memory-leaks"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1571577955, "post_id": 58473334, "comment_id": 103280041, "body": "total allocations are not a memory leaks per se. memory leaks are chunks of memory that are useless to your program but kept in memory by the gc because something is keeping a pointer to it (dangling routine). however, it is a sign of bad memory management and that can degrade your performance. At first you can check <a href=\"https://golang.org/pkg/runtime/#MemStats\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/#MemStats</a> to get definitions of the numbers. then you can use this <a href=\"https://github.com/divan/expvarmon\" rel=\"nofollow noreferrer\">github.com/divan/expvarmon</a> to see numbers in real time. finally, run pprof to get a code source listing of your program allocations and identify the faulty statements."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571663158, "post_id": 58473334, "comment_id": 103304529, "body": "@mh-cbon Thanks for your reply. Ill . give it a shot"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571666375, "post_id": 58473334, "comment_id": 103306367, "body": "There is nothing in this output that would tell you whether or not you have a memory leak."}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571577151, "creation_date": 1571577151, "question_id": 58473334, "link": "https://stackoverflow.com/questions/58473334/interpreting-memory-usage-of-game-in-go", "title": "Interpreting memory usage of game in Go", "body": "<p>I have added memory profiling to my game and when taking a look to the stats I can see something like this :</p>\n\n<pre><code># runtime.MemStats\n# Alloc = 1022232\n# TotalAlloc = 14369528\n# Sys = 72286456\n# Lookups = 0\n# Mallocs = 192759\n# Frees = 184964\n# HeapAlloc = 1022232\n# HeapSys = 66519040\n# HeapIdle = 64667648\n# HeapInuse = 1851392\n# HeapReleased = 61906944\n# HeapObjects = 7795\n# Stack = 589824 / 589824\n# MSpan = 29920 / 65536\n# MCache = 6944 / 16384\n# BuckHashSys = 1444778\n# GCSys = 2377728\n# OtherSys = 1273166\n# NextGC = 4194304\n# LastGC = 1571576758413809106\n# PauseNs = [136190 27071 23449 40823 35342 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n# PauseEnd = [1571576480170696886 1571576526952274688 1571576646967831188 1571576688475083354 1571576758413809106 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n# NumGC = 5\n# NumForcedGC = 0\n# GCCPUFraction = 2.6422038270754447e-06\n# DebugGC = false\n</code></pre>\n\n<p>I believe I am having memory leaks but I am having a hard time pinpointing the exact code doing it. I believe I have leaks because I can \"pause\" the game and when I do I basically just continue in the game loop but I dont do anything ( I dont draw on the screen or create new objects ) but I can see the field <strong>TotalAlloc</strong> keeps growing and growing forever, so I assume something definitely must be wrong right?</p>\n\n<p>Here is my code : <a href=\"https://github.com/Matias-Barrios/SDL_Universe/blob/master/main.go\" rel=\"nofollow noreferrer\">https://github.com/Matias-Barrios/SDL_Universe/blob/master/main.go</a></p>\n"}, {"tags": ["go", "out-of-memory", "proto"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1571640547, "post_id": 58472816, "comment_id": 103293941, "body": "No, and it is pretty hard to help you understand what is going on without your code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571666487, "post_id": 58472816, "comment_id": 103306423, "body": "Could be a memory leak anywhere in your program, or could be memory use by another process on the same system, or could be an oversized pb payload, or any number of other things. There&#39;s no context provided to offer any insight."}], "owner": {"reputation": 9, "user_id": 7522410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d48e09aac158a580ae66eeae104f1897?s=128&d=identicon&r=PG&f=1", "display_name": "shenyajun", "link": "https://stackoverflow.com/users/7522410/shenyajun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571573021, "creation_date": 1571573021, "question_id": 58472816, "link": "https://stackoverflow.com/questions/58472816/proto-marshal-out-of-memory", "title": "proto.Marshal out of memory", "body": "<p>we use github.com/gogo/protobuf, I get service crash at <code>proto.Marshal()</code>, this happens almost once a day,But I did not receive a memory alarm\uff0cThis looks like a memory leak\uff0chas anyone encountered this situation?</p>\n\n<pre><code>fatal error: runtime: out of memory\n\nruntime stack:\nruntime.throw(0xe25648, 0x16)\n    /usr/local/go/src/runtime/panic.go:617 +0x72\nruntime.sysMap(0xc5cc000000, 0xc490000000, 0x18671b8)\n    /usr/local/go/src/runtime/mem_linux.go:170 +0xc7\nruntime.(*mheap).sysAlloc(0x184e180, 0xc48d3d8000, 0x184e190, 0x62469ec)\n    /usr/local/go/src/runtime/malloc.go:633 +0x1cd\nruntime.(*mheap).grow(0x184e180, 0x62469ec, 0x0)\n    /usr/local/go/src/runtime/mheap.go:1222 +0x42\nruntime.(*mheap).allocSpanLocked(0x184e180, 0x62469ec, 0x18671c8, 0x7f213328e6d8)\n    /usr/local/go/src/runtime/mheap.go:1150 +0x37f\nruntime.(*mheap).alloc_m(0x184e180, 0x62469ec, 0x7f21bed20101, 0x184e190)\n    /usr/local/go/src/runtime/mheap.go:977 +0xc2\nruntime.(*mheap).alloc.func1()\n    /usr/local/go/src/runtime/mheap.go:1048 +0x4c\nruntime.(*mheap).alloc(0x184e180, 0x62469ec, 0xc000000101, 0x7f21bed2a0e0)\n    /usr/local/go/src/runtime/mheap.go:1047 +0x8a\nruntime.largeAlloc(0xc48d3d8000, 0xffffffffffff0100, 0x7f21bed2a0e0)\n    /usr/local/go/src/runtime/malloc.go:1055 +0x99\nruntime.mallocgc.func1()\n    /usr/local/go/src/runtime/malloc.go:950 +0x46\nruntime.systemstack(0x0)\n    /usr/local/go/src/runtime/asm_amd64.s:351 +0x66\nruntime.mstart()\n    /usr/local/go/src/runtime/proc.go:1153\n\ngoroutine 521107 [running]:\nruntime.systemstack_switch()\n    /usr/local/go/src/runtime/asm_amd64.s:311 fp=0xc0982eae30 sp=0xc0982eae28 pc=0x45cdf0\nruntime.mallocgc(0xc48d3d8000, 0x0, 0x1700, 0xc492070000)\n    /usr/local/go/src/runtime/malloc.go:949 +0x872 fp=0xc0982eaed0 sp=0xc0982eae30 pc=0x40e6d2\nruntime.growslice(0xca6f00, 0xc492070000, 0x1c43, 0x2000, 0xc48d3d6e73, 0x0, 0x0, 0x0)\n    /usr/local/go/src/runtime/slice.go:175 +0x151 fp=0xc0982eaf38 sp=0xc0982eaed0 pc=0x4462a1\nxxxx/vendor/github.com/gogo/protobuf/proto.(*Buffer).EncodeStringBytes(...)\n\nxxxx/vendor/github.com/gogo/protobuf/proto.Marshal(0xf58840, 0xc45eda2a00, 0x2d, 0x1, 0xc1e72e7801, 0x1, 0xc4860713e0)\n    /opt/go/src/xxxx/vendor/github.com/gogo/protobuf/proto/encode.go:236 +0x92 fp=0xc0982eb9a8 sp=0xc0982eb960 pc=0x79dd12\nxxxx/feature_server_user/get_feature.(*GetUserFeatureAction).Handler(0x1864ca8, 0xc46a746a00, 0x17, 0x200, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n</code></pre>\n"}, {"tags": ["go", "data-structures", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 12205919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9497fa285ccf388ef980ebf4edf51f26?s=128&d=identicon&r=PG&f=1", "display_name": "Aviv", "link": "https://stackoverflow.com/users/12205919/aviv"}, "edited": false, "score": 0, "creation_date": 1571574785, "post_id": 58472829, "comment_id": 103279222, "body": "thanks for the answer. in my case both of this conditions are not exists"}], "tags": [], "owner": {"reputation": 7130, "user_id": 3311799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPfSH.png?s=128&g=1", "display_name": "Johnny", "link": "https://stackoverflow.com/users/3311799/johnny"}, "is_accepted": false, "score": 0, "last_activity_date": 1571573426, "last_edit_date": 1571573426, "creation_date": 1571573122, "answer_id": 58472829, "question_id": 58472781, "link": "https://stackoverflow.com/questions/58472781/golang-hash-table-with-concurrency-support/58472829#58472829", "title": "golang hash-table with concurrency support", "body": "<p>Package <code>sync</code> provides the concurrent safe <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">map</a>.</p>\n\n<blockquote>\n  <p>Map is like a Go map[interface{}]interface{} but is safe for\n  concurrent use by multiple goroutines without additional locking or\n  coordination. Loads, stores, and deletes run in amortized constant\n  time.</p>\n</blockquote>\n\n<hr>\n\n<p>Although the spec itself point out these two specific cases when it should be used(otherwise they suggest using the normal map with locking mechanism):</p>\n\n<ol>\n<li>when the entry for a given key is only ever written once but read many times, as in caches that only grow</li>\n<li>when multiple goroutines read, write and overwrite entries for disjoint sets of keys</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "is_accepted": true, "score": 2, "last_activity_date": 1571625328, "last_edit_date": 1571625328, "creation_date": 1571601132, "answer_id": 58476724, "question_id": 58472781, "link": "https://stackoverflow.com/questions/58472781/golang-hash-table-with-concurrency-support/58476724#58476724", "title": "golang hash-table with concurrency support", "body": "<p>Since you asked for a map</p>\n\n<blockquote>\n  <p>without locking the whole structure each access</p>\n</blockquote>\n\n<p>I direct you to the following implementation:</p>\n\n<p><a href=\"https://github.com/cornelk/hashmap\" rel=\"nofollow noreferrer\">https://github.com/cornelk/hashmap</a></p>\n\n<p>This project implements a pure lock free hash map data structure using atomic instructions common in many CPU architectures</p>\n\n<p>The regular go <code>sync.Map</code> still uses an underlying Mutex which locks the corresponding map datastructure.</p>\n"}], "owner": {"reputation": 17, "user_id": 12205919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9497fa285ccf388ef980ebf4edf51f26?s=128&d=identicon&r=PG&f=1", "display_name": "Aviv", "link": "https://stackoverflow.com/users/12205919/aviv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 58476724, "answer_count": 2, "score": -1, "last_activity_date": 1571625328, "creation_date": 1571572764, "last_edit_date": 1571573173, "question_id": 58472781, "link": "https://stackoverflow.com/questions/58472781/golang-hash-table-with-concurrency-support", "title": "golang hash-table with concurrency support", "body": "<p>I need to use a very big hash-table, and access it from many readers and many writers in parallel. is there data structure like map, that support many reads and writes in parallel, without locking the whole structure each access?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "owner": {"reputation": 492, "user_id": 8035443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rOKW6.jpg?s=128&g=1", "display_name": "Jerlam", "link": "https://stackoverflow.com/users/8035443/jerlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571608310, "creation_date": 1571572316, "last_edit_date": 1571608310, "question_id": 58472727, "link": "https://stackoverflow.com/questions/58472727/update-a-model-and-its-relations-with-already-existing-primary-keys", "title": "Update a model and its relations with already existing primary keys", "body": "<p>I have the following struct, with <code>LinguisticMetadata</code> being a relation:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>metadataDB := &amp;dbm.VideoMetadata{\n        ID:               *imdbid,\n        ImdbID:           *imdbid,\n        TmdbID:           tmdbID,\n        IsSeries:         input.Episode != nil,\n        ImdbRating:       imdbRating,\n        Adult:            extendedMetadata.Adult,\n\n        LinguisticMetadata: linguisticListDB, // LinguisticMetadata []*LinguisticMetadata `gorm:\"not null\"`\n        Subtitles:          subtitlesDB,      // Subtitles  []*Subtitle\n    }\n</code></pre>\n\n<p>I want to create a new metadata, or update the existing one if it already exists. This is not an issue and can be achieved easily like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>newMetadata := dbm.VideoMetadata{}\ndb.Where(dbm.VideoMetadata{ID: *imdbid}).Assign(metadataDB).FirstOrCreate(&amp;newMetadata)\n</code></pre>\n\n<p>However, I also need to have the same behavior for its relations. The primary keys for <code>LinguisticMetadata</code> is the prefix of a country, eg: \"en\", \"fr\", \"it\"... So it is very likely that it already exists for the given metadata. Hence, if the primary keys of the relations already exist, the model should be updated (or replaced). </p>\n\n<p>With the code shown above, I get the following error if the LinguisticMetadata primary key already exists:</p>\n\n<blockquote>\n  <p>pq: duplicate key value violates unique constraint \"linguistic_metadata_pkey\" </p>\n</blockquote>\n\n<p>This does not make sense to me, because as stated <a href=\"http://gorm.io/docs/associations.html\" rel=\"nofollow noreferrer\">here</a>: </p>\n\n<blockquote>\n  <p>GORM will auto save associations and its reference when creating/updating a record. <strong>if association has a primary key, GORM will call Update to save it, otherwise it will be created.</strong></p>\n</blockquote>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571561344, "post_id": 58471321, "comment_id": 103276217, "body": "see this answer <a href=\"https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content/58172839#58172839\" title=\"how to implement parallel processing of line based file content\">stackoverflow.com/questions/58166490/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "edited": false, "score": 0, "creation_date": 1571575938, "post_id": 58472393, "comment_id": 103279493, "body": "@BBS : let me know if that is what you were looking for"}], "tags": [], "owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "is_accepted": true, "score": 1, "last_activity_date": 1571569864, "creation_date": 1571569864, "answer_id": 58472393, "question_id": 58471321, "link": "https://stackoverflow.com/questions/58471321/scan-a-file-from-multiple-points/58472393#58472393", "title": "Scan a file from multiple points", "body": "<p>The issue seems to be because of 2 scanner for the file moving the head concurrently.</p>\n\n<p>The desired results can be achieved by creating 2 file handle, each having their own scanner. The following works for me</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"text/scanner\"\n    \"time\"\n)\n\nfunc main(){\n    var file [2]*os.File\n    var err error\n    file[0], err = os.Open(\"./abc.txt\")\n    file[1], err = os.Open(\"./abc.txt\")\n    if err != nil {\n        log.Panic(err)\n    }\n    defer file[0].Close()\n    defer file[1].Close()\n    var scanner [2]scanner.Scanner\n    inChan := make(chan string)\n\n\n    for i := 0; i &lt; 2; i++ {\n        var n int64 = (int64)(i) * 26\n        file[i].Seek(n, 0)\n\n        scanner[i].Init(file[i])\n        fmt.Println(scanner[0].Pos)\n        go parseLine(fmt.Sprintf(\"Scanner %v:\", i), &amp;scanner[i], inChan)\n    }\n\n    for msg := range inChan {\n        fmt.Println(msg)\n    }\n}\n\nfunc parseLine(name string, scanner *scanner.Scanner, out chan string) {\n    for i := 0; i &lt; 26; i++ {\n        out &lt;- fmt.Sprintf(\"%s %c\", name, scanner.Next())\n    }\n    time.Sleep(time.Second * 10)\n    close(out)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 0, "last_activity_date": 1571570064, "creation_date": 1571570064, "answer_id": 58472421, "question_id": 58471321, "link": "https://stackoverflow.com/questions/58471321/scan-a-file-from-multiple-points/58472421#58472421", "title": "Scan a file from multiple points", "body": "<p>Among the properties a file has is a <em>single</em> read position, not one per scanner, per thread, or per goroutine.  When you share a single <code>os.File</code> between multiple scanner objects (or anything else), the first one that reads from the file will advance the read pointer for every other scanner.  In your example the first goroutine that runs will read the line from the file, and the second one tries to read but is already at end-of-file.</p>\n\n<p>To make this work you need only one thing reading the file, and you need to ensure that the data you're sending off to goroutines isn't shared (you're not repeatedly reading into a single buffer and sending that same buffer off everywhere, where the next read will overwrite it).</p>\n\n<p><strong>This is a good time to think about concurrency and if this is actually worth the effort.</strong>  The slowest part of this program, by far, will be actually reading the file from disk, and no amount of goroutines will make that faster.  The extra buffer copy isn't necessary in an optimal single-threaded program, and goroutine synchronization comes with a cost too.  My intuition is that using goroutines here makes the program much more complex and potentially slower.</p>\n\n<p>The core change I'd make to your program is having there only be one thing that reads the file; for instance, a main loop in your program.  The <a href=\"https://godoc.org/bufio\" rel=\"nofollow noreferrer\"><code>bufio</code></a> package includes a <a href=\"https://godoc.org/bufio#Scanner\" rel=\"nofollow noreferrer\"><code>Scanner</code></a> object that can read a file a line at a time, and produce the copied string.  I would launch a pool of worker goroutines once, and then feed them lines:</p>\n\n<pre><code>lines := make(chan string)\nfile, err := os.Open(\"./strangeness/abc.txt\")\nif err != nil { ... }\n\nscan := bufio.NewScanner(file)\nfor scan.Scan() {\n    lines &lt;- scan.Text()\n}\nclose(lines)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/o7UwZrgfVy7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/o7UwZrgfVy7</a> has a more complete example that compiles.  Note that the goroutine structure takes some reasoning about: I've launched a separate goroutine to process the results, and have a separate channel to signal its completion.</p>\n"}], "owner": {"reputation": 1171, "user_id": 2430915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa2d09b09a5eaf435ffdf18206a3a6b4?s=128&d=identicon&r=PG", "display_name": "BBS", "link": "https://stackoverflow.com/users/2430915/bbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 58472393, "answer_count": 2, "score": 1, "last_activity_date": 1571570064, "creation_date": 1571560984, "question_id": 58471321, "link": "https://stackoverflow.com/questions/58471321/scan-a-file-from-multiple-points", "title": "Scan a file from multiple points", "body": "<p>I have a file <code>abc.txt</code> which contains the alphabet printed twice separated by a newline character</p>\n\n<pre><code>abcdefghijklmopqrstuvwxyz\nabcdefghijklmopqrstuvwxyz\n</code></pre>\n\n<p>I would like to create a parser that can parse the lines concurrently. For example one goroutine per line. My current process for trying to do this is:</p>\n\n<ul>\n<li>Create a channel to receive lines of text</li>\n<li>Create a new scanner for each line</li>\n<li>Pass that scanner and channel to a goroutine</li>\n<li>Process results in the main process</li>\n</ul>\n\n<p>However, only one of the scanners is returning useful output. The code for what I am trying to do is this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    file, err := os.Open(\"./strangeness/abc.txt\")\n    if err != nil {\n        log.Panic(err)\n    }\n    defer file.Close()\n\n    inChan := make(chan string)\n\n    for i := 0; i &lt; 2; i++ {\n        var scanner scanner.Scanner\n        file.Seek(27, 0)\n\n        scanner.Init(file)\n\n        go parseLine(fmt.Sprintf(\"Scanner %v:\", i), &amp;scanner, inChan)\n    }\n\n    for msg := range inChan {\n        fmt.Println(msg)\n    }\n}\n\nfunc parseLine(name string, scanner *scanner.Scanner, out chan string) {\n    for i := 0; i &lt; 26; i++ {\n        out &lt;- fmt.Sprintf(\"%s %c\", name, scanner.Next())\n    }\n}\n</code></pre>\n\n<p>I think I may have some misconceptions either about how the go <code>text/scanner</code> works or how about files work in general, but I can't track down the actual source of the bug. </p>\n"}, {"tags": ["docker", "go", "routing"], "answers": [{"comments": [{"owner": {"reputation": 80, "user_id": 8196427, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hu0K4.jpg?s=128&g=1", "display_name": "nwagu", "link": "https://stackoverflow.com/users/8196427/nwagu"}, "edited": false, "score": 0, "creation_date": 1571564591, "post_id": 58471128, "comment_id": 103276906, "body": "<code>ENTRYPOINT .&#47;web-app --port 80</code> worked. With the public folder at the same level."}], "tags": [], "owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "is_accepted": true, "score": 1, "last_activity_date": 1571562369, "last_edit_date": 1571562369, "creation_date": 1571559043, "answer_id": 58471128, "question_id": 58470816, "link": "https://stackoverflow.com/questions/58470816/why-am-i-getting-404-with-go-in-docker/58471128#58471128", "title": "Why am I getting 404 with Go in docker", "body": "<p>I think you need to create the folder in your <code>alpine</code> container:</p>\n\n<pre><code>RUN mkdir -p /go/bin/public\n</code></pre>\n\n<p>and make sure to have something in that folder.</p>\n\n<p>or you need to copy the folder and files from the first go container.</p>\n\n<p>and edit your dokcerfile :</p>\n\n<pre><code>WORKDIR /go/bin\nENTRYPOINT web-app --port 80\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 10418733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2948a1cd45f7f6553a526e34de8cfe2?s=128&d=identicon&r=PG&f=1", "display_name": "3mard", "link": "https://stackoverflow.com/users/10418733/3mard"}, "is_accepted": false, "score": 1, "last_activity_date": 1571562732, "creation_date": 1571562732, "answer_id": 58471522, "question_id": 58470816, "link": "https://stackoverflow.com/questions/58470816/why-am-i-getting-404-with-go-in-docker/58471522#58471522", "title": "Why am I getting 404 with Go in docker", "body": "<p>As LinPy has mentioned you should copy the public folder from build to alpine</p>\n\n<p>And you have to set the WORKDIR to /go in order for the relative path to work </p>\n\n<p>eg. </p>\n\n<pre><code>FROM golang:alpine AS build\nRUN apk --no-cache add gcc g++ make git\nWORKDIR /go/src/app\nCOPY . .\nRUN go get ./...\nRUN GOOS=linux go build -ldflags=\"-s -w\" -o ./bin/web-app ./main.go\n\nFROM alpine:3.9\nRUN apk --no-cache add ca-certificates\nWORKDIR /go\nCOPY --from=build /go/src/app/bin /go/bin\nCOPY --from=build /go/src/app/public /go/public\nEXPOSE 80\nENTRYPOINT /go/bin/web-app --port 80\n</code></pre>\n"}], "owner": {"reputation": 80, "user_id": 8196427, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hu0K4.jpg?s=128&g=1", "display_name": "nwagu", "link": "https://stackoverflow.com/users/8196427/nwagu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 58471128, "answer_count": 2, "score": 1, "last_activity_date": 1571562732, "creation_date": 1571555627, "question_id": 58470816, "link": "https://stackoverflow.com/questions/58470816/why-am-i-getting-404-with-go-in-docker", "title": "Why am I getting 404 with Go in docker", "body": "<p>This is my Dockerfile</p>\n\n<pre><code>FROM golang:alpine AS build\nRUN apk --no-cache add gcc g++ make git\nWORKDIR /go/src/app\nCOPY . .\nRUN go get ./...\nRUN GOOS=linux go build -ldflags=\"-s -w\" -o ./bin/web-app ./main.go\n\nFROM alpine:3.9\nRUN apk --no-cache add ca-certificates\nWORKDIR /usr/bin\nCOPY --from=build /go/src/app/bin /go/bin\nEXPOSE 80\nENTRYPOINT /go/bin/web-app --port 80\n</code></pre>\n\n<p>And this is a simple main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./public\")))\n    log.Fatal(http.ListenAndServe(\":80\", nil))\n}\n\n</code></pre>\n\n<p>The public directory is in the same folder with the main.go file. There is an index.html in the public directory.\nWhen I run <code>go run main.go</code> my website is served properly. But with Docker, I get the 404 page. I suspect it has to do with the placement of the files inside the docker container. Any help is appreciated.</p>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571554872, "post_id": 58470714, "comment_id": 103275183, "body": "&quot;Is .splice() is equivalent to slices?&quot; --- no."}, {"owner": {"reputation": 13, "user_id": 12078679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecde8cd8466ddb25c7230fb52d4a853f?s=128&d=identicon&r=PG&f=1", "display_name": "mrsimone010101", "link": "https://stackoverflow.com/users/12078679/mrsimone010101"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571554919, "post_id": 58470714, "comment_id": 103275191, "body": "then how to convert it? i have no idea"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1571554962, "post_id": 58470714, "comment_id": 103275201, "body": "Unfortunately, you need to understand it enough to be able to convert it. Or simply hire somebody. There is no 3rd way."}, {"owner": {"reputation": 7130, "user_id": 3311799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPfSH.png?s=128&g=1", "display_name": "Johnny", "link": "https://stackoverflow.com/users/3311799/johnny"}, "edited": false, "score": 2, "creation_date": 1571555061, "post_id": 58470714, "comment_id": 103275212, "body": "Provide at least a code example to clarify the problem you are facing..."}, {"owner": {"reputation": 13, "user_id": 12078679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecde8cd8466ddb25c7230fb52d4a853f?s=128&d=identicon&r=PG&f=1", "display_name": "mrsimone010101", "link": "https://stackoverflow.com/users/12078679/mrsimone010101"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571555389, "post_id": 58470714, "comment_id": 103275265, "body": "@zerkms I DID NOT HOW IT WORKS. i just wanted to know how it is done."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1571555447, "post_id": 58470714, "comment_id": 103275276, "body": "How <i>what</i> is done? You provided nothing in your question."}, {"owner": {"reputation": 13, "user_id": 12078679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecde8cd8466ddb25c7230fb52d4a853f?s=128&d=identicon&r=PG&f=1", "display_name": "mrsimone010101", "link": "https://stackoverflow.com/users/12078679/mrsimone010101"}, "reply_to_user": {"reputation": 7130, "user_id": 3311799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPfSH.png?s=128&g=1", "display_name": "Johnny", "link": "https://stackoverflow.com/users/3311799/johnny"}, "edited": false, "score": 0, "creation_date": 1571555515, "post_id": 58470714, "comment_id": 103275291, "body": "@Johnny some go users are not forgiving. my quetion has always been downvoted. SO i just ask some basic question. you can refer to bserdar&#39;s answer. it is what i am looking for."}, {"owner": {"reputation": 13, "user_id": 12078679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecde8cd8466ddb25c7230fb52d4a853f?s=128&d=identicon&r=PG&f=1", "display_name": "mrsimone010101", "link": "https://stackoverflow.com/users/12078679/mrsimone010101"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571555609, "post_id": 58470714, "comment_id": 103275308, "body": "@zerkms just look at bserdar&#39;s answer. seriously."}, {"owner": {"reputation": 7130, "user_id": 3311799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPfSH.png?s=128&g=1", "display_name": "Johnny", "link": "https://stackoverflow.com/users/3311799/johnny"}, "edited": false, "score": 0, "creation_date": 1571555750, "post_id": 58470714, "comment_id": 103275331, "body": "@newguyinstuckoverflow Then you should be more clear with the question... How to remove an item from a slice...otherwise people could only guess. Good luck."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1571555114, "creation_date": 1571555114, "answer_id": 58470765, "question_id": 58470714, "link": "https://stackoverflow.com/questions/58470714/convert-from-javascript-v-splicevi-1-to-go/58470765#58470765", "title": "Convert from JavaScript v.splice(vi, 1) to Go", "body": "<p><code>v.splice(vi, 1)</code> removes 1 element from <code>vi</code>. To do the same in go, you can do:</p>\n\n<pre><code>append(v[:vi],v[vi+1:]...)\n</code></pre>\n\n<p>That is, first get the slice up to <code>vi</code>, then add all the elements after <code>vi</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "is_accepted": false, "score": 0, "last_activity_date": 1571555506, "creation_date": 1571555506, "answer_id": 58470807, "question_id": 58470714, "link": "https://stackoverflow.com/questions/58470714/convert-from-javascript-v-splicevi-1-to-go/58470807#58470807", "title": "Convert from JavaScript v.splice(vi, 1) to Go", "body": "<p>From : <a href=\"https://www.w3schools.com/jsref/jsref_splice.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/jsref/jsref_splice.asp</a></p>\n\n<p><strong>Syntax</strong><br>\narray.splice(index, howmany, item1, ....., itemX)</p>\n\n<p>Parameter: index<br>\nDescription. An integer that specifies at what position to add/remove items, Use negative values to specify the position from the end of the array.</p>\n\n<p>Parameter :howmany(Optional)<br>\nDescription: The number of items to be removed. If set to 0, no items will be removed</p>\n\n<p>Parameter:item1, ..., itemX (Optional)<br>\nDescription: The new item(s) to be added to the array</p>\n\n<p>You may visit <a href=\"https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_splice\" rel=\"nofollow noreferrer\">https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_splice</a> for trying it yourself</p>\n"}], "owner": {"reputation": 13, "user_id": 12078679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecde8cd8466ddb25c7230fb52d4a853f?s=128&d=identicon&r=PG&f=1", "display_name": "mrsimone010101", "link": "https://stackoverflow.com/users/12078679/mrsimone010101"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 1, "closed_date": 1571580065, "accepted_answer_id": 58470765, "answer_count": 2, "score": -4, "last_activity_date": 1615753055, "creation_date": 1571554678, "last_edit_date": 1615753055, "question_id": 58470714, "link": "https://stackoverflow.com/questions/58470714/convert-from-javascript-v-splicevi-1-to-go", "closed_reason": "Not suitable for this site", "title": "Convert from JavaScript v.splice(vi, 1) to Go", "body": "<p>I know nothing about JavaScript.</p>\n\n<p>Assume that v contains a list of positive integers, vi is an index value, say current vi = 0.</p>\n\n<p>I would like to know how to convert v.splice(vi, 1) to Golang</p>\n\n<p>Is .splice() is equivalent to slices?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 3, "creation_date": 1571557802, "post_id": 58470674, "comment_id": 103275637, "body": "The TL;DR for the multiple answers below is: once data gets <i>into</i> the channel, it&#39;s ordered, but you&#39;re doing the put-data-into-channel in goroutine execution order, which is not controlled, possibly parallel, and in any case not very predictable."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1571554882, "creation_date": 1571554882, "answer_id": 58470741, "question_id": 58470674, "link": "https://stackoverflow.com/questions/58470674/order-while-using-channels/58470741#58470741", "title": "Order while using channels", "body": "<p>There are no guarantees in the execution ordering of goroutines. When you start multiple goroutines, they may or may not execute in the order you expect them unless there are explicit synchronizations between them, such as channels or other synchronization primitives.</p>\n\n<p>In your case, the second goroutine writes the channel before the first can, because there is no mechanism to enforce ordering between the two goroutines.</p>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 12034040, "user_type": "registered", "profile_image": "https://graph.facebook.com/2694086327309833/picture?type=large", "display_name": "Devendra Mukharaiya", "link": "https://stackoverflow.com/users/12034040/devendra-mukharaiya"}, "is_accepted": true, "score": 5, "last_activity_date": 1571585925, "last_edit_date": 1571585925, "creation_date": 1571556456, "answer_id": 58470899, "question_id": 58470674, "link": "https://stackoverflow.com/questions/58470674/order-while-using-channels/58470899#58470899", "title": "Order while using channels", "body": "<p>Similar to <a href=\"https://stackoverflow.com/questions/39818254/goroutines-order-of-execution\">goroutines order of execution</a> </p>\n\n<p>If you run it multiple times, it may give different result. When I run this I get:</p>\n\n<pre><code>Sending 103 to chan\nSending 1 to chan\n103 1 104\n</code></pre>\n\n<p>If you want result to be deterministic. You may use two channels:</p>\n\n<pre><code>func main() {\n    s := []int{2, 8, -9, 4, 0, 99}\n\n    c1 := make(chan int)\n    c2 := make(chan int)\n    go sum(s[len(s)/2:], c1)\n    go sum(s[:len(s)/2], c2)\n\n    x, y := &lt;-c1, &lt;-c2 // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7130, "user_id": 3311799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPfSH.png?s=128&g=1", "display_name": "Johnny", "link": "https://stackoverflow.com/users/3311799/johnny"}, "is_accepted": false, "score": 2, "last_activity_date": 1571557136, "last_edit_date": 1571557136, "creation_date": 1571556472, "answer_id": 58470900, "question_id": 58470674, "link": "https://stackoverflow.com/questions/58470674/order-while-using-channels/58470900#58470900", "title": "Order while using channels", "body": "<p>The <a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">golang spec</a> says about the channels:</p>\n\n<blockquote>\n  <p>Channels act as first-in-first-out queues. For example, if one\n  goroutine sends values on a channel and a second goroutine receives\n  them, the values are received in the order sent.</p>\n</blockquote>\n\n<p>If you combine the above statement with the arbitrary order of the goroutines execution it could lead to arbitrary order of enqueuing items to channel.</p>\n\n<hr>\n\n<p><strong>NB:</strong> A channel is an abstraction of the <a href=\"https://en.wikipedia.org/wiki/Communicating_sequential_processes\" rel=\"nofollow noreferrer\">CSP</a>.</p>\n"}], "owner": {"reputation": 28476, "user_id": 6862601, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ppP5k.jpg?s=128&g=1", "display_name": "codeforester", "link": "https://stackoverflow.com/users/6862601/codeforester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 58470899, "answer_count": 3, "score": 2, "last_activity_date": 1571585925, "creation_date": 1571554303, "last_edit_date": 1571585729, "question_id": 58470674, "link": "https://stackoverflow.com/questions/58470674/order-while-using-channels", "title": "Order while using channels", "body": "<p>I have this code from Go tour:</p>\n\n<pre><code>func sum(s []int, c chan int) {\n    sum := 0\n    for _, v := range s {\n        sum += v\n    }\n    fmt.Printf(\"Sending %d to chan\\n\", sum)\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    s := []int{2, 8, -9, 4, 0, 99}\n    c := make(chan int)\n    go sum(s[len(s)/2:], c)\n    go sum(s[:len(s)/2], c)\n\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p>Produces this output:</p>\n\n<pre><code>Sending 1 to chan\nSending 103 to chan\n1 103 104\n</code></pre>\n\n<p>In this, x gets the second sum and y gets the first sum. Why is the order reversed?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform", "runtime"], "comments": [{"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 1, "creation_date": 1571549912, "post_id": 58469950, "comment_id": 103274486, "body": "Most likely your code crashed. Add the error messages from Stackdriver plus your code."}, {"owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1571557211, "post_id": 58469950, "comment_id": 103275547, "body": "@JohnHanley Added the log, plus the basic code. Main function doesn&#39;t appear to crash, no errors pointing to anything going wrong..."}, {"owner": {"reputation": 4919, "user_id": 3399890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/171944b3f88fd2fa4bc824b4b298de4e?s=128&d=identicon&r=PG&f=1", "display_name": "robsiemb", "link": "https://stackoverflow.com/users/3399890/robsiemb"}, "edited": false, "score": 1, "creation_date": 1571581617, "post_id": 58469950, "comment_id": 103281059, "body": "@ThePiachu you appear to be missing a call to http.ListenAndServe.  Take a look at the helloworld.go example in the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/building-app/\" rel=\"nofollow noreferrer\">go111 getting started page</a>.  Without that, your app is going to exit without ever listening for any requests (alternatively, it appears you can call appengine.Main per the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences#package-main\" rel=\"nofollow noreferrer\">migration guide</a>)."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1571585948, "post_id": 58469950, "comment_id": 103282203, "body": "The code that you posted could not have worked before in App Engine. Your code starts, processes templates, and exits. No web server process is started."}, {"owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1571599754, "post_id": 58469950, "comment_id": 103285798, "body": "@JohnHanley yeah, that function used to be <code>init()</code>, but then appengine nagged me about not having a <code>main</code> package and a <code>main()</code> function, so I just switched init to main. I guess my mind glossed over the ListenAndServe from the example, since it was nested inside of a log... <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/appengine/go11x/helloworld/helloworld.go\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/golang-samples/blob/master/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "edited": false, "score": 0, "creation_date": 1571614085, "post_id": 58477519, "comment_id": 103288674, "body": "Close, but that apparently doesn&#39;t let you use the <code>Context</code> properly for <code>datastore</code> and what have you. So it&#39;s good enough to display a web page, but not good enough for a full appengine app..."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "edited": false, "score": 0, "creation_date": 1571619458, "post_id": 58477519, "comment_id": 103289464, "body": "@ThePiachu - Where is Datastore in your question?"}, {"owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "edited": false, "score": 0, "creation_date": 1571621806, "post_id": 58477519, "comment_id": 103289841, "body": "It wasn&#39;t, I use it a few layers deeper, didn&#39;t know it was an issue until the first layer of issues was fixed."}], "tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": false, "score": 0, "last_activity_date": 1571607234, "creation_date": 1571607234, "answer_id": 58477519, "question_id": 58469950, "link": "https://stackoverflow.com/questions/58469950/gae-go-the-request-failed-because-the-instance-could-not-start-successfully/58477519#58477519", "title": "GAE Go &quot;The request failed because the instance could not start successfully&quot;", "body": "<p>Your code is missing the part to start a listener. Add this to your code:</p>\n\n<pre><code>    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n            port = \"8080\"\n            log.Printf(\"Defaulting to port %s\", port)\n    }\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "is_accepted": true, "score": 2, "last_activity_date": 1571621954, "last_edit_date": 1571621954, "creation_date": 1571613993, "answer_id": 58478111, "question_id": 58469950, "link": "https://stackoverflow.com/questions/58469950/gae-go-the-request-failed-because-the-instance-could-not-start-successfully/58478111#58478111", "title": "GAE Go &quot;The request failed because the instance could not start successfully&quot;", "body": "<p>Okay, after some help from a few comments, here are a few issues that I had to fix to get my code to work:</p>\n\n<ol>\n<li>I converted my <code>init()</code> function into <code>main()</code> without adding a way to listen to requests. The code just ran through the <code>main()</code> function and exited without an error, hence the problems with debugging.</li>\n<li><code>appengine.NewContext(r)</code> is deprecated apparently, so I had to switch those statements to <code>r.Context()</code>. MEANWHILE, <code>Appengine Datastore</code> is still using <code>golang.org/x/net/context</code> and not just <code>context</code>, so if you want to use things like <code>RunInTransaction()</code>, DON'T update your imports, <code>context</code> casts into <code>golang.org/x/net/context</code> just fine</li>\n<li>If you <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/appengine/go11x/helloworld/helloworld.go\" rel=\"nofollow noreferrer\">follow the official examples</a> provided by Google, you will most likely run into errors like <code>textPayload: \"2019/10/20 22:32:46 http: panic serving 127.0.0.1:16051: not an App Engine context</code>. Instead, your code needs to look like the below example.</li>\n<li>Since the former <code>app</code> package is now the <code>main</code> package, make sure that any files that are referenced in <code>app.yaml</code> (<code>favicon.ico</code> for example) are in a proper position in relation to the <code>main</code> package (I had to move mine to a different folder to avoid errors popping up every request...).</li>\n</ol>\n\n<pre><code>package main\n\nimport (\n    \"google.golang.org/appengine\"\n    \"html/template\"\n    \"net/http\"\n)\n\nvar MainTemplate *template.Template\n\nfunc init() {\n    http.HandleFunc(\"/\", hello)\n    MainTemplate, _= template.ParseFiles(\"html/main.html\")\n}\n\nfunc main() {\n    appengine.Main()\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    c := r.Context()\n    //................................//\n    MainTemplate.Execute(w, nil)\n}\n</code></pre>\n\n<p>This ought to work. <code>appengine.Main()</code> apparently connects you to all the <code>appengine</code> functionality needed to use the context for datastore / memcache / whatever operations.</p>\n\n<p>Thank you to the commenters that helped me get over the first hump!</p>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 914, "favorite_count": 0, "accepted_answer_id": 58478111, "answer_count": 2, "score": 1, "last_activity_date": 1571621954, "creation_date": 1571544383, "last_edit_date": 1571557236, "question_id": 58469950, "link": "https://stackoverflow.com/questions/58469950/gae-go-the-request-failed-because-the-instance-could-not-start-successfully", "title": "GAE Go &quot;The request failed because the instance could not start successfully&quot;", "body": "<p>I've been developing with Google App Engine Go for awhile, but I haven't touched it in a year. I tried updating my application from \"go1\" (1.9?) to \"go111\", and I'm currently getting some weird errors without any explanation as to what's going on.</p>\n\n<p>The errors include:</p>\n\n<ul>\n<li><code>The request failed because the instance could not start successfully</code></li>\n<li><code>Container called exit(1).</code></li>\n<li><code>500 Internal server error</code></li>\n<li>etc.</li>\n</ul>\n\n<p>None of these point me to any specific line in my code where something would go wrong, nor explain anything more meaningful...</p>\n\n<p>I'm guessing the error is stemming from me upgrading between the golang versions. I had to change the <code>app</code> package into <code>main</code>, add a <code>main</code> function to the application, update the appengine package to a newer version, update the gsuite app, add a cloud compilation widget thingy, change app.yaml script from go to auto, etc.</p>\n\n<p>All in all, I'm lost. <a href=\"https://stackoverflow.com/questions/48409767/cloud-endpoints-request-failed-http-status-500\">A Similar SE question yielded no good answers</a>. <a href=\"https://stackoverflow.com/questions/53459385/handling-ah-start-route-nodejs-at-google-app-engine\">Someone else suggested <code>app.yaml</code> might be at fault, so here is mine:</a></p>\n\n<pre><code>runtime:     go111\n\nhandlers:\n- url: /static\n  static_dir: static\n- url: /res\n  static_dir: res\n- url: /update\n  script: auto\n  secure: always\n  login: admin\n- url: /.*\n  script: auto\n  secure: always\n  login: optional\n</code></pre>\n\n<p>Debug console log is very unhelpful:</p>\n\n<p><a href=\"https://i.stack.imgur.com/tZLmZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tZLmZ.png\" alt=\"\"></a></p>\n\n<p>And the main file looks essentially like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"google.golang.org/appengine\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n)\n\nvar MainTemplate *template.Template\n\nfunc main() {\n    http.HandleFunc(\"/\", hello)\n\n    var err error\n    MainTemplate, err = template.ParseFiles(\"html/main.html\")\n    if err != nil {\n        log.Printf(\"ERROR! %v\\n\", err.Error())\n        panic(err)\n    }\n    log.Printf(\"Hello world!\\n\")\n}\n\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    //................................//\n    MainTemplate.Execute(w, nil)\n}\n</code></pre>\n\n<p>Anything else it could be?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571526900, "post_id": 58468490, "comment_id": 103271832, "body": "Where does <code>v1</code> come from? Did you import it?"}, {"owner": {"reputation": 1238, "user_id": 5667189, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/XLjac.jpg?s=128&g=1", "display_name": "Dandy", "link": "https://stackoverflow.com/users/5667189/dandy"}, "edited": false, "score": 0, "creation_date": 1571531054, "post_id": 58468490, "comment_id": 103272364, "body": "You&#39;re not importing the module as v1."}, {"owner": {"reputation": 69, "user_id": 1855481, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1f09beb962d032572d7e3f0798e7cbd?s=128&d=identicon&r=PG", "display_name": "user1855481", "link": "https://stackoverflow.com/users/1855481/user1855481"}, "edited": false, "score": 0, "creation_date": 1571532254, "post_id": 58468490, "comment_id": 103272506, "body": "If i change the type to <code>*metav1.Deployment</code> i get the error <code>cmd&#47;list.go:141:38: undefined: &quot;k8s.io&#47;apimachinery&#47;pkg&#47;apis&#47;meta&#47;v1&quot;.Deployment</code>"}], "answers": [{"tags": [], "owner": {"reputation": 18855, "user_id": 404264, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/6ff3f136c340de6931974e710bf30f89?s=128&d=identicon&r=PG", "display_name": "Dagang", "link": "https://stackoverflow.com/users/404264/dagang"}, "is_accepted": true, "score": 2, "last_activity_date": 1571532412, "creation_date": 1571532412, "answer_id": 58469182, "question_id": 58468490, "link": "https://stackoverflow.com/questions/58468490/k8s-go-client-how-to-pass-a-v1-deployment-type-to-a-function/58469182#58469182", "title": "k8s go client: how to pass a v1.Deployment type to a function", "body": "<p>You need to import \"k8s.io/api/apps/v1\", Deployment is defined in the package. See <a href=\"https://godoc.org/k8s.io/api/apps/v1\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/api/apps/v1</a>.</p>\n"}], "owner": {"reputation": 69, "user_id": 1855481, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1f09beb962d032572d7e3f0798e7cbd?s=128&d=identicon&r=PG", "display_name": "user1855481", "link": "https://stackoverflow.com/users/1855481/user1855481"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 58469182, "answer_count": 1, "score": 2, "last_activity_date": 1571532412, "creation_date": 1571523692, "last_edit_date": 1571527998, "question_id": 58468490, "link": "https://stackoverflow.com/questions/58468490/k8s-go-client-how-to-pass-a-v1-deployment-type-to-a-function", "title": "k8s go client: how to pass a v1.Deployment type to a function", "body": "<p>I'm new to go and playing with k8s go-client. I'd like to pass items from <code>deploymentsClient.List(metav1.ListOptions{})</code> to a funcion. <code>fmt.Printf(\"%T\\n\", deploy)</code> says it's type <code>v1.Deployment</code>. So I write a function that takes <code>(deploy *v1.Deployment)</code> and pass it <code>&amp;deploy</code> where deploy is an item in the <code>deploymentsClient.List</code>. This errors with <code>cmd/list.go:136:38: undefined: v1</code> however. What am I doing wrong?</p>\n\n<p>Here are my imports</p>\n\n<pre><code>import (\n    //  \"encoding/json\"\n    \"flag\"\n    \"fmt\"\n    //yaml \"github.com/ghodss/yaml\"\n    \"github.com/spf13/cobra\"\n    // \"k8s.io/apimachinery/pkg/api/errors\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"os\"\n    \"path/filepath\"\n)\n</code></pre>\n\n<p>Then I get the list of deployments:</p>\n\n<pre><code>    deploymentsClient := clientset.AppsV1().Deployments(ns)\n    deployments, err := deploymentsClient.List(metav1.ListOptions{})\n    if err != nil {\n        panic(err.Error())\n    }\n    for _, deploy := range deployments.Items {\n        fmt.Println(deploy.ObjectMeta.SelfLink)\n        //      printDeploymentSpecJson(deploy)\n        //      printDeploymentSpecYaml(deploy)\n\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 0, "creation_date": 1571521521, "post_id": 58468134, "comment_id": 103270908, "body": "Can you provide the signature for <code>a</code>, <code>b</code>, or <code>c</code>?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1571521565, "post_id": 58468134, "comment_id": 103270916, "body": "they must be <code>func(*Handle) *Handle</code> otherwise it is not valid go code."}, {"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 0, "creation_date": 1571521649, "post_id": 58468134, "comment_id": 103270932, "body": "Ahh yeah you&#39;re right thanks didn&#39;t think that through.."}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 5474221, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-DhllUtPCe88/AAAAAAAAAAI/AAAAAAAAAA8/oWjW4E8-KNE/photo.jpg?sz=128", "display_name": "Shubhang b", "link": "https://stackoverflow.com/users/5474221/shubhang-b"}, "edited": false, "score": 0, "creation_date": 1591586548, "post_id": 58468271, "comment_id": 110102211, "body": "I guess this is actually piping and not composing. The code remains the same except that the order of evaluation is right-to-left. The innermost function is executed first and then the outer ones follow. Correct me if I am wrong."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 307, "user_id": 5474221, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-DhllUtPCe88/AAAAAAAAAAI/AAAAAAAAAA8/oWjW4E8-KNE/photo.jpg?sz=128", "display_name": "Shubhang b", "link": "https://stackoverflow.com/users/5474221/shubhang-b"}, "edited": false, "score": 0, "creation_date": 1591610029, "post_id": 58468271, "comment_id": 110110858, "body": "no this is commonly accepted as function composition. Piping is when you connect a data flow producer to a data flow consumer."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 4, "last_activity_date": 1571521579, "creation_date": 1571521579, "answer_id": 58468271, "question_id": 58468134, "link": "https://stackoverflow.com/questions/58468134/how-to-compose-functions-in-go/58468271#58468271", "title": "How to compose functions in go?", "body": "<p>use a slice</p>\n\n<p><a href=\"https://play.golang.org/p/DrEnGkIEbU3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DrEnGkIEbU3</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(v(v(v(0))))\n    fmt.Println(compose(v, v, v)(0))\n}\nfunc v(i int) int {\n    return i + 1\n}\nfunc compose(manyv ...func(int) int) func(int) int {\n    return func(i int) int {\n        for _, v := range manyv {\n            i = v(i)\n        }\n        return i\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 58468271, "answer_count": 1, "score": 1, "last_activity_date": 1571521579, "creation_date": 1571520242, "question_id": 58468134, "link": "https://stackoverflow.com/questions/58468134/how-to-compose-functions-in-go", "title": "How to compose functions in go?", "body": "<p>I'm trying to figure out how to set up middlewares, and right now I've got something like:</p>\n\n<pre><code>func applyMiddleware(h *Handle) *Handle {\n   return a(b(c(h)))\n}\n</code></pre>\n\n<p>Is there a way to \"compose\" these functions so I can just pass a list of Handle(s) and it will return the composed function?</p>\n"}, {"tags": ["docker", "go", "ethereum", "solidity"], "comments": [{"owner": {"reputation": 530, "user_id": 11363397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cce147ac9e935039ef6b38c4ee0c40a?s=128&d=identicon&r=PG&f=1", "display_name": "elembie", "link": "https://stackoverflow.com/users/11363397/elembie"}, "edited": false, "score": 1, "creation_date": 1571696835, "post_id": 58466856, "comment_id": 103319435, "body": "My first thought might be that you have multiple docker containers running - try <code>docker ps</code> on the command line and see if you have multiple instances of the same images running. You can stop them with <code>docker stop [container_id]</code>."}, {"owner": {"reputation": 319, "user_id": 7996402, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-akiZsqnhMMk/AAAAAAAAAAI/AAAAAAAAABM/7oKLN0alwSE/photo.jpg?sz=128", "display_name": "Alex", "link": "https://stackoverflow.com/users/7996402/alex"}, "reply_to_user": {"reputation": 530, "user_id": 11363397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cce147ac9e935039ef6b38c4ee0c40a?s=128&d=identicon&r=PG&f=1", "display_name": "elembie", "link": "https://stackoverflow.com/users/11363397/elembie"}, "edited": false, "score": 0, "creation_date": 1571726457, "post_id": 58466856, "comment_id": 103325787, "body": "$ docker ps command shows this result CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES"}, {"owner": {"reputation": 319, "user_id": 7996402, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-akiZsqnhMMk/AAAAAAAAAAI/AAAAAAAAABM/7oKLN0alwSE/photo.jpg?sz=128", "display_name": "Alex", "link": "https://stackoverflow.com/users/7996402/alex"}, "reply_to_user": {"reputation": 530, "user_id": 11363397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cce147ac9e935039ef6b38c4ee0c40a?s=128&d=identicon&r=PG&f=1", "display_name": "elembie", "link": "https://stackoverflow.com/users/11363397/elembie"}, "edited": false, "score": 0, "creation_date": 1571727053, "post_id": 58466856, "comment_id": 103326093, "body": "check this .. all containers which are running currently                                   docker container ls -a   result in this image.. image link is given                                                                                                <a href=\"https://ibb.co/GW63VNy\" rel=\"nofollow noreferrer\">ibb.co/GW63VNy</a>"}, {"owner": {"reputation": 578, "user_id": 565229, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d3110961c54afee6e0421f6b2489ce65?s=128&d=identicon&r=PG", "display_name": "XedinUnknown", "link": "https://stackoverflow.com/users/565229/xedinunknown"}, "edited": false, "score": 0, "creation_date": 1596704865, "post_id": 58466856, "comment_id": 111898533, "body": "I&#39;m also interested in having this answered."}], "owner": {"reputation": 319, "user_id": 7996402, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-akiZsqnhMMk/AAAAAAAAAAI/AAAAAAAAABM/7oKLN0alwSE/photo.jpg?sz=128", "display_name": "Alex", "link": "https://stackoverflow.com/users/7996402/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1408, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571923259, "creation_date": 1571510164, "last_edit_date": 1571923259, "question_id": 58466856, "link": "https://stackoverflow.com/questions/58466856/runtimeerror-can-not-reuse-socket-after-connection-was-closed-using-docker", "title": "RuntimeError: Can not reuse socket after connection was closed using docker", "body": "<p>I am following <a href=\"https://github.com/getamis/eth-indexer/blob/master/README.md?fbclid=IwAR3g3SAjJ9ik_hHCFkol2k8YXo0GvBL15oSNC-hIU38_OZcKOT79x-RuiZg#usage\" rel=\"nofollow noreferrer\">this tutorial</a> to run Ethereum crawler using Docker on window 10 using docker</p>\n\n<p>after executing </p>\n\n<pre><code>$ MYSQL_DATA_PATH=\"$HOME/indexer-data/mysql\" GETH_DATA_PATH=\"$HOME/indexer-data/geth\"docker-compose up \n</code></pre>\n\n<p>in this line i got error </p>\n\n<blockquote>\n  <p>409 Client Error: Conflict for url:\n  http+docker://localnpipe/v1.25/containers/ee2b46142bae704d4963853e22a77ba896a8f841120ecf5ac97befca91847672/attach?logs=0&amp;stdout=1&amp;stderr=1&amp;stream=1</p>\n  \n  <p>During handling of the above exception, another exception occurred:</p>\n  \n  <p>Traceback (most recent call last):   File \"threading.py\", line 916, in\n  _bootstrap_inner   File \"threading.py\", line 864, in run   File \"compose\\cli\\log_printer.py\", line 233, in watch_events   File\n  \"compose\\container.py\", line 215, in attach_log_stream   File\n  \"compose\\container.py\", line 307, in attach   File\n  \"site-packages\\docker\\utils\\decorators.py\", line 19, in wrapped   File\n  \"site-packages\\docker\\api\\container.py\", line 61, in attach   File\n  \"site-packages\\docker\\api\\client.py\", line 400, in _read_from_socket<br>\n  File \"site-packages\\docker\\api\\client.py\", line 311, in\n  _get_raw_response_socket   File \"site-packages\\docker\\api\\client.py\", line 263, in _raise_for_status   File\n  \"site-packages\\docker\\errors.py\", line 19, in\n  create_api_error_from_http_exception   File\n  \"site-packages\\requests\\models.py\", line 880, in json   File\n  \"site-packages\\requests\\models.py\", line 828, in content   File\n  \"site-packages\\requests\\models.py\", line 750, in generate   File\n  \"site-packages\\urllib3\\response.py\", line 496, in stream   File\n  \"site-packages\\urllib3\\response.py\", line 444, in read   File\n  \"http\\client.py\", line 449, in read   File \"http\\client.py\", line 493,\n  in readinto   File \"site-packages\\docker\\transport\\npipesocket.py\",\n  line 209, in readinto   File\n  \"site-packages\\docker\\transport\\npipesocket.py\", line 20, in wrapped<br>\n  RuntimeError: Can not reuse socket after connection was closed.</p>\n</blockquote>\n\n<pre><code>git config --global user.name \"usrname\"\ngit config --global user.password \"paswd\"\ngit clone https://github.com/usrame/eth-indexer.git\ncd eth-indexer\ntouch .env\necho \"MYSQL_DATA_PATH=~/indexer-data/mysql\" &gt; .env\necho \"GETH_DATA_PATH=~/indexer-data/geth\" &gt; .env\ngit add -f .env\ndocker-compose build\nmkdir -p ~/indexer-data/mysql ~/indexer-data/geth\n# Create database sechema\nMYSQL_DATA_PATH=\"$HOME/indexer-data/mysql\" docker-compose up idx-database idx-migration\nMYSQL_DATA_PATH=\"$HOME/indexer-data/mysql\" GETH_DATA_PATH=\"$HOME/indexer-data/geth\" docker-compose up\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571523253, "post_id": 58466511, "comment_id": 103271237, "body": "Most likely, because fields in <code>model.Driver</code> are unexported. And I somehow doubt that a DBMS made the concious choice to ridicule you..."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571523391, "post_id": 58466511, "comment_id": 103271270, "body": "@MarkusWMahlberg all fields have first letter capital."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571524273, "post_id": 58466511, "comment_id": 103271439, "body": "Have you read the link I sent you? <code>GetStudentCollection()</code>? <code>Vehicle</code>? I am not sure how you feel, but if I have to reverse-engineer the code to be able to answer the question, I feel less inclined to put time and effort into it..."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571525103, "post_id": 58466511, "comment_id": 103271558, "body": "@MarkusWMahlberg I have posted the remaining things.  I think I posted enough things so you can reproduce the error."}], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1571526158, "post_id": 58468674, "comment_id": 103271722, "body": "What <code>Inline</code> does? And yes I&#39;m aware of the I&#39;m decoding into a driver I thought I don&#39;t need to decode into student because I&#39;m getting only driver part."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1571526483, "post_id": 58468674, "comment_id": 103271765, "body": "`@VarunRaj <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson/bsoncodec#StructTags\" rel=\"nofollow noreferrer\">godoc.org/go.mongodb.org/mongo-driver/bson/bsoncodec#StructT&zwnj;&#8203;ags</a>"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 2, "last_activity_date": 1571525712, "creation_date": 1571525712, "answer_id": 58468674, "question_id": 58466511, "link": "https://stackoverflow.com/questions/58466511/projections-in-mongodb-not-working-properly/58468674#58468674", "title": "Projections in Mongodb not working properly", "body": "<p>You are doing a find in the students collection, but you decode into a driver.\nThis needs to be changed.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var drivers []Driver\n    var student Student\n\n    // Get the next result from the cursor\n    for cur.Next(context.TODO()) {\n        err := cur.Decode(&amp;student)\n        if err != nil {\n            fmt.Println(err)\n        }\n        drivers = append(drivers, student.Driver)\n    }\n</code></pre>\n\n<p>Furthermore , you are lacking an <code>Inline</code> struct tag for the <code>Driver</code> field of <code>Student</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Student struct {\n    ID       primitive.ObjectID `bson:\"_id,omitempty\"`\n    IsDriver bool               `json:\"isdriver,omitempty\"`\n    // Note that Inline is uppercase.\n    Driver   Driver             `json:\"driver,omitempty\" bson:\"driver,Inline\"`\n}\n</code></pre>\n\n<p>Same, of course, goes for all referenced structs. Working sample code: <a href=\"https://gist.github.com/mwmahlberg/c46ec3ad3ccee028f0666ff7d5d8d98b\" rel=\"nofollow noreferrer\">https://gist.github.com/mwmahlberg/c46ec3ad3ccee028f0666ff7d5d8d98b</a></p>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 58468674, "answer_count": 1, "score": 1, "last_activity_date": 1571577383, "creation_date": 1571507803, "last_edit_date": 1571577383, "question_id": 58466511, "link": "https://stackoverflow.com/questions/58466511/projections-in-mongodb-not-working-properly", "title": "Projections in Mongodb not working properly", "body": "<p>I have this data in my mongoDB database.</p>\n\n<pre><code>{ \n   \"_id\":\"5d9ce9fd270eae22adb95d70\",\n   ...\n   \"isdriver\":true,\n   \"driver\":{ \n      \"walletmoney\":0,\n      \"license\":\"6eef8271-62d7-4a1c-972a-2c40a773b35a\",\n      \"vehicle\":{ \n         \"image\":\"b6c3619b-86e6-49d0-8734-e2c48815dfc1\",\n         \"insurance\":\"5f8229c4-4700-4059-8b72-9344a2bc6092\",\n         \"manufacturer\":\"Tesla\",\n         \"model\":\"Model 3\",\n         \"vin\":\"12345678912345678\",\n         \"year\":2018\n      },\n      \"verified\":false\n      ...\n   }\n}\n</code></pre>\n\n<p>Here is my driver struct</p>\n\n<pre><code>type Driver struct {\n    ...\n    Verified         bool    `json:\"verified,omitempty\"`\n    License          string  `json:\"licenseimage,omitempty\"`\n    ...\n    Vehicle          Vehicle `json:\"vehicle,omitempty\"`\n}\n</code></pre>\n\n<p>Here is my Student Struct</p>\n\n<pre><code>type Student struct {\n    ID                primitive.ObjectID `bson:\"_id,omitempty\"`\n    ...\n    IsDriver          bool               `json:\"isdriver,omitempty\"`\n    Driver            Driver             `json:\"driver,omitempty\"`\n}\n</code></pre>\n\n<p>Vehicle struct</p>\n\n<pre><code>type Vehicle struct {\n    Image        string `json:\"vehicleimage,omitempty\"`\n    Insurance    string `json:\"insuranceimage,omitempty\"`\n    VIN          string `json:\"vin,omitempty\"`\n    Manufacturer string `json:\"manufacturer,omitemptyr\"` &lt;-----(Edit) Find out this is also wrong\n    Model        string `json:\"model,omitempty\"`\n    Year         uint16 `json:\"year,omitempty\"`\n}\n</code></pre>\n\n<p>And I'm using this function to get all the drivers from the database</p>\n\n<pre><code>func GetAllDrivers() []model.Driver {\n\n    // Options\n    projections := bson.D{\n        {\"driver\", 1},\n        /* {\"driver.verified\", 1},\n        {\"driver.license\", 1}, */\n    }\n\n    // Filter for search\n    filter := bson.M{\"isdriver\": true}\n\n    // Return student collection (*mongo.Collection)\n    studentCollection := GetStudentCollection()\n    cur, err := studentCollection.Find(context.TODO(), filter, options.Find().SetProjection(projections))\n\n    // Error while finding documents\n    if err != nil {\n        fmt.Print(err)\n        return []model.Driver{}\n    }\n\n    var drivers []model.Driver\n    var driver model.Driver\n\n    // Get the next result from the cursor\n    for cur.Next(context.TODO()) {\n        err := cur.Decode(&amp;driver)\n        if err != nil {\n            fmt.Print(err)\n        }\n        drivers = append(drivers, driver)\n    }\n    if err := cur.Err(); err != nil {\n        fmt.Print(err)\n    }\n    cur.Close(context.TODO())\n    return drivers\n}\n</code></pre>\n\n<p>But the response I'm getting in the postman is ridiculous</p>\n\n<pre><code>[\n    {\n        \"vehicle\": {\n            \"manufacturer\": \"\"\n        }\n    },\n    {\n        \"vehicle\": {\n            \"manufacturer\": \"\"\n        }\n    }\n]\n</code></pre>\n\n<p>One thing is okay that is in response I'm getting two objects which are fine because as my <code>filter</code> suggestest <code>isdriver: true</code> I have total three documents in the database in which two of those have <code>isdriver: true</code>.</p>\n\n<p>Can anybody help me with this? Why I'm getting this response?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571512213, "post_id": 58466444, "comment_id": 103268741, "body": "Canceling a context doesn\u2019t release any resources by itself. Stdout and stderr are thread safe, but it makes no sense to write to a stream concurrently. Contexts and channels are safe to use from multiple goroutines, as that is their primary purpose. Show an actual example with the locations of the race if you need assistance."}, {"owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571538857, "post_id": 58466444, "comment_id": 103273214, "body": "Am I reading this wrong (<a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">golang.org/pkg/context</a>): Canceling this context releases resources associated with it, so code should call cancel as soon as the operations running in this Context complete."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571576318, "post_id": 58466444, "comment_id": 103279603, "body": "That\u2019s uncharacteristically imprecise for the docs. The context itself isn\u2019t releasing anything, however it\u2019s often associated with some resources, which is usually why you\u2019re using it. Yes, you should logically cancel the context as soon as possible, and no it will not cancel contexts not derived from the one you\u2019re cancelling. Without a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> it\u2019s hard to know what you\u2019re actually doing. You haven\u2019t even shown what the data race is."}, {"owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571623327, "post_id": 58466444, "comment_id": 103290116, "body": "I rewrote my libraries and am no longer getting the race condition. I also started several goroutines that just logged and that had no issues. I haven&#39;t spotted the problem, but have a better way of doing what I wanted to accomplish, without getting the race condition."}], "owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576843670, "creation_date": 1571507427, "question_id": 58466444, "link": "https://stackoverflow.com/questions/58466444/getting-data-race-condition-with-zerolog", "title": "Getting data race condition with zerolog", "body": "<p>I am using zerolog configured with diodes to prevent a race condition when writing to stdout.  This is my log setup:</p>\n\n<pre><code>consoleWriter := zerolog.ConsoleWriter{Out: os.Stdout, NoColor: *logNoColor, TimeFormat: *logDateTimeFormat}\nreturn diode.NewWriter(consoleWriter, 1000, 10*time.Millisecond, onMissedMessages)\n</code></pre>\n\n<p>I am following the example from here:\n<a href=\"https://github.com/rs/zerolog\" rel=\"nofollow noreferrer\">zerolog documentation</a></p>\n\n<p>Finally, I set the global logger with the writer returned from above (f):</p>\n\n<pre><code>log.Logger = zerolog.New(f).With().Timestamp().Logger()\n</code></pre>\n\n<p>I have a shutdown hook (listens for CTRL+C) which basically just writes a log message when it is called and cancels the root context.  I am also writing a log message after 1 second has elapsed using the time.After function.</p>\n\n<p>When I don't press CTRL+C, the application runs as expected; however, when I press CTRL+C prior to the 1 second delayed execution of a method, I get a data race condition.  When I remove the log statements, the problem goes away leading me to believe that the diode setup from above isn't helping prevent a race condition.</p>\n\n<p>Just to make sure I'm understanding how golang works:</p>\n\n<ol>\n<li>Canceling a context releases resources tied to that context.  Ie. if you have a child context with a channel and close the child context, only that channel would be closed / released</li>\n<li>os.Stdout, os.Stderr, etc. are not thread-safe and operations on them must be controlled by the developer.</li>\n<li>I can check if a context is Done() from numerous goroutines without a synchronization problem.  However, I can and should only read from a channel from a single thread</li>\n</ol>\n"}, {"tags": ["regex", "go", "pcre"], "comments": [{"owner": {"reputation": 11918, "user_id": 5527985, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CfG3C.png?s=128&g=1", "display_name": "bobble bubble", "link": "https://stackoverflow.com/users/5527985/bobble-bubble"}, "edited": false, "score": 0, "creation_date": 1571505513, "post_id": 58465949, "comment_id": 103266978, "body": "Using something with a <a href=\"https://www.regular-expressions.info/wordboundaries.html\" rel=\"nofollow noreferrer\"><code>\\b</code></a> word boundary <a href=\"https://regex101.com/r/3blhbg/1\" rel=\"nofollow noreferrer\">like this</a> is not an option?"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571519110, "post_id": 58466387, "comment_id": 103270390, "body": "your solution returns unexpected results for the input you added in regards to OP original pcre pattern (<code>(?&lt;![a-zA-Z0-9&#39;])([a-zA-Z0-9&#39;])</code>)."}, {"owner": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571577415, "post_id": 58466387, "comment_id": 103279900, "body": "I can&#39;t use this regex to match all strings I need, what function I can use to get all submatches"}, {"owner": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "reply_to_user": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571584898, "post_id": 58466387, "comment_id": 103281955, "body": "@LoicRoux: I you want more submatches, add capture groups where you want, but give a description (with examples) of your problem(s), without this information I can&#39;t help you more."}, {"owner": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571602946, "post_id": 58466387, "comment_id": 103286536, "body": "Thanks but I&#39;ve checked the doc and found different solutions working with functions like <code>FindSubmatch()</code>. Your code is working good just mine was using <code>findAllStrings</code> to get an array of all matches so your regex didn&#39;t deal with it."}], "tags": [], "owner": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "is_accepted": true, "score": 2, "last_activity_date": 1571591781, "last_edit_date": 1571591781, "creation_date": 1571507142, "answer_id": 58466387, "question_id": 58465949, "link": "https://stackoverflow.com/questions/58465949/how-to-select-first-chars-with-a-custom-word-boundary/58466387#58466387", "title": "How to select first chars with a custom word boundary?", "body": "<p>Something that plays with character classes and word boundaries should suffice:</p>\n\n<pre><code>\\b_*([a-z])[a-z]*(?:'s)?_*\\b\\W*\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/ONAYuS/1\" rel=\"nofollow noreferrer\">demo</a></p>\n\n<p>Usage:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`(?i)\\b_*([a-z])[a-z]*(?:'s)?_*\\b\\W*`)\n    fmt.Println(re.ReplaceAllString(\"O'Brian's dog\", \"$1\"))\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571577186, "post_id": 58468102, "comment_id": 103279842, "body": "should be, though, always write a benchmark to verify that. some things i can say upfront, if you are about to use that repetitively within a loop, adjust the signatures to take out as an input parameter and prevent further useless allocations. Allocations are the bottlenecks in those functions to get the best of this programming language. Allocations has to be considered within the scope of the overall pipeline you are writing."}, {"owner": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571602663, "post_id": 58468102, "comment_id": 103286460, "body": "Thanks a lot, precious tip for my beginner&#39;s head. I use Vs code test cases and it gives me the total execution time of a test. is it enough?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571602720, "post_id": 58468102, "comment_id": 103286480, "body": "please check that answer that demonstrates how you could proceed to optimize the code <a href=\"https://codereview.stackexchange.com/questions/231000/boyer-moore-horspool-search-algorithm-in-go\" title=\"boyer moore horspool search algorithm in go\">codereview.stackexchange.com/questions/231000/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "edited": false, "score": 0, "creation_date": 1571688759, "post_id": 58468102, "comment_id": 103316841, "body": "Ok nice, I&#39;m still playing with your code, good to understand..."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1571520026, "creation_date": 1571520026, "answer_id": 58468102, "question_id": 58465949, "link": "https://stackoverflow.com/questions/58465949/how-to-select-first-chars-with-a-custom-word-boundary/58468102#58468102", "title": "How to select first chars with a custom word boundary?", "body": "<p>ftr, regexp less solution</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    inputs := []string{\"Hall\u0645\u0631\u062d\u0628\u0627ey's Comet\", \"First In, First Out\", \"The Road _Not_ Taken\", \"O'Brian's Dog\"}\n    c := [][]string{}\n    w := [][]string{}\n    for _, input := range inputs {\n        c = append(c, firstLet(input))\n        w = append(w, words(input))\n    }\n    fmt.Printf(\"%#v\\n\", w)\n    fmt.Printf(\"%#v\\n\", c)\n}\n\nfunc firstLet(in string) (out []string) {\n    var inword bool\n    for _, r := range in {\n        if !inword {\n            if isChar(r) {\n                inword = true\n                out = append(out, string(r))\n            }\n        } else if r == ' ' {\n            inword = false\n        }\n    }\n    return out\n}\n\nfunc words(in string) (out []string) {\n    var inword bool\n    var w []rune\n    for _, r := range in {\n        if !inword {\n            if isChar(r) {\n                w = append(w, r)\n                inword = true\n            }\n        } else if r == ' ' {\n            if len(w) &gt; 0 {\n                out = append(out, string(w))\n                w = w[:0]\n            }\n            inword = false\n        } else if r != '_' {\n            w = append(w, r)\n        }\n    }\n    if len(w) &gt; 0 {\n        out = append(out, string(w))\n    }\n    return out\n}\n\nfunc isChar(r rune) bool {\n    return (r &gt;= 'a' &amp;&amp; r &lt;= 'z') || (r &gt;= 'A' &amp;&amp; r &lt;= 'Z')\n}\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>[][]string{[]string{\"Hall\u0645\u0631\u062d\u0628\u0627ey's\", \"Comet\"}, []string{\"First\", \"In,\", \"First\", \"Out\"}, []string{\"The\", \"Road\", \"Not\", \"Taken\"}, []string{\"O'Brian's\", \"Dog\"}}\n[][]string{[]string{\"H\", \"C\"}, []string{\"F\", \"I\", \"F\", \"O\"}, []string{\"T\", \"R\", \"N\", \"T\"}, []string{\"O\", \"D\"}}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11132253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cLjV68LqX0c/AAAAAAAAAAI/AAAAAAAALag/JQixOaxWig4/photo.jpg?sz=128", "display_name": "Loic Roux", "link": "https://stackoverflow.com/users/11132253/loic-roux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 58466387, "answer_count": 2, "score": 0, "last_activity_date": 1571591781, "creation_date": 1571504147, "last_edit_date": 1571574469, "question_id": 58465949, "link": "https://stackoverflow.com/questions/58465949/how-to-select-first-chars-with-a-custom-word-boundary", "title": "How to select first chars with a custom word boundary?", "body": "<p>I've test cases with a series of words like this :</p>\n\n<pre><code>    {\n        input:    \"Halley's Comet\",\n        expected: \"HC\",\n    },\n    {\n        input:    \"First In, First Out\",\n        expected: \"FIFO\",\n    },\n    {\n        input:    \"The Road _Not_ Taken\",\n        expected: \"TRNT\",\n    },\n</code></pre>\n\n<p>I want with one regex to match all first letters of these words, avoid char: \"_\" to be matched as a first letter and count single quote in the word.<br>\nCurrently, I have this regex working on pcre syntax but not with Go regexp package : <code>(?&lt;![a-zA-Z0-9'])([a-zA-Z0-9'])</code> <br>\nI know lookarounds aren't supported by Go but I'm looking for a good way to do that.</p>\n\n<p>I also use this func to get an array of all strings : <code>re.FindAllString(s, -1)</code></p>\n\n<p>Thanks for helping.</p>\n"}]