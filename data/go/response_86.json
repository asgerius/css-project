[{"tags": ["design-patterns", "go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1472688821, "post_id": 39260658, "comment_id": 65857611, "body": "In the top example, you are doing a busy wait if you get an error until the retry time is ready. The loop will execute as fast as it can until the AfterFunc runs."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1472709398, "post_id": 39260658, "comment_id": 65862625, "body": "What <b>expected results</b> is it not achieving?  Not waiting 3 seconds, panic&#39;ing?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1472718818, "post_id": 39260658, "comment_id": 65867729, "body": "@sberry yes, basically I want to wait X amount of time before re-trying again."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1472737036, "post_id": 39260658, "comment_id": 65880675, "body": "What is it doing that is not expected?  I mean, describe what bahavior you observe.  Does it run more often than 3s?  Does it act differently (timing) as you change the executable bit?  Describe what happens."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1472741536, "post_id": 39260658, "comment_id": 65884170, "body": "@sberry after creating an error, panics <code>fatal error: all goroutines are asleep - deadlock!</code> but for been available to reproduce probably you could copy &amp; paste the code and, runit and then just remove the <code>sleep</code> file or change permissions"}], "answers": [{"comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472719116, "post_id": 39260928, "comment_id": 65867907, "body": "Hi, I need the channels because I need to know when the command exited mainly because the <code>cmd.Wait()</code>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472840566, "post_id": 39260928, "comment_id": 65931225, "body": "The command is done when <code>cmd.Wait()</code> returns. If you want to do a timeout then a channel based approach may be appropriate, but right now you are just doing retries."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 1, "last_activity_date": 1472689183, "creation_date": 1472689183, "answer_id": 39260928, "question_id": 39260658, "link": "https://stackoverflow.com/questions/39260658/circuit-breaker-design-pattern-sleep-vs-time-afterfunc/39260928#39260928", "title": "Circuit breaker design pattern sleep vs time.AfterFunc", "body": "<p>Any time you hit the default case, the select ends immediately. In the top example, after you execute <code>AfterFunc</code> the for loop runs continually until <code>run</code> has items (after 3 seconds). Busy waits are usually bad. With the <code>sleep</code> solution, you never have a busy wait, which is good. I'm not sure I fully follow what you are trying to accomplish with the nested selects in the second example though.</p>\n\n<p>Why do you need channels and asynchrony at all? Why not just:</p>\n\n<pre><code>retryCount := 0\nfor retryCount &lt; 3 {\n   err := doSomethingScary()\n   if err == nil{\n     //success! return results!\n   } else{\n     //failure! wait and retry\n     time.Sleep(time.Second) //time.sleep is a good non-busy wait\n   }\n}\n// max tries exceeded. Return error.\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 39260928, "answer_count": 1, "score": 0, "last_activity_date": 1472689183, "creation_date": 1472687108, "question_id": 39260658, "link": "https://stackoverflow.com/questions/39260658/circuit-breaker-design-pattern-sleep-vs-time-afterfunc", "title": "Circuit breaker design pattern sleep vs time.AfterFunc", "body": "<p>I am trying to create a <a href=\"https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern\" rel=\"nofollow\">Circuit breaker pattern</a>, I want to execute a command <a href=\"https://golang.org/pkg/os/exec/#Cmd.Run\" rel=\"nofollow\">exec.Command</a> and if it fails, retry in X defined amount of time, for testing purposes, I am doing something like this for testing <code>time.AfterFunc</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc myFunc() error {\n    for i := 1; i &lt; 10; i++ {\n        fmt.Printf(\"i = %+v\\n\", i)\n        if i%3 == 0 {\n            return fmt.Errorf(\"error\")\n        }\n    }\n    return nil\n}\n\nfunc main() {\n\n    run := make(chan struct{}, 1)\n\n    run &lt;- struct{}{}\n\n    for {\n        select {\n        case &lt;-run:\n            err := myFunc()\n            if err != nil {\n                time.AfterFunc(3*time.Second, func() {\n                    run &lt;- struct{}{}\n                })\n            }\n        default:\n        }\n    }\n}\n</code></pre>\n\n<p><code>time.AfterFunc</code> works  for the above code, but not for the example below, I had to replace it with a <code>sleep</code> in order to achieve the expected results:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc Exec(done chan&lt;- error) error {\n    cmd := exec.Command(\"./start\")\n    if err := cmd.Start(); err != nil {\n        return err\n    }\n    go func() {\n        done &lt;- cmd.Wait()\n    }()\n    return nil\n}\n\nfunc main() {\n    var (\n        run  = make(chan struct{}, 1)\n        done = make(chan error, 1)\n    )\n\n    Exec(done)\n\n    for {\n        select {\n        case &lt;-run:\n            err := Exec(done)\n            if err != nil {\n                fmt.Println(err)\n                // time.AfterFunc(3*time.Second, func() {\n                time.Sleep(3 * time.Second)\n                run &lt;- struct{}{}\n            }\n        default:\n            select {\n            case err := &lt;-done:\n                fmt.Println(err)\n                run &lt;- struct{}{}\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The content of <code>./sleep</code>:</p>\n\n<pre><code>#!/bin/sh\n\nsleep 3\n</code></pre>\n\n<p>And for testing, creating an error, I toggle perms:</p>\n\n<pre><code>chmod -x sleep\nchmod +x sleep\n</code></pre>\n\n<p>Therefore wondering what are the differences between using <code>time.AfterFunc</code> and <code>time.Sleep</code> and what could be the best way of implementing this pattern.</p>\n"}, {"tags": ["date", "parsing", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1472687280, "creation_date": 1472687280, "answer_id": 39260680, "question_id": 39260647, "link": "https://stackoverflow.com/questions/39260647/how-do-you-parse-date-in-the-format/39260680#39260680", "title": "How do you parse date in the format:", "body": "<p>Go's reference layout uses -7 hours as the timezone offset, but you used +7 hours:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    date := \"2016-07-08T08:34:24+00:00\"\n    d, err := time.Parse(\"2006-01-02T15:04:05-07:00\", date)\n    if err == nil {\n        fmt.Println(d)\n    } else {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FNzx57R2jy\" rel=\"nofollow\">https://play.golang.org/p/FNzx57R2jy</a></p>\n"}], "owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39260680, "answer_count": 1, "score": 0, "last_activity_date": 1472687440, "creation_date": 1472687031, "question_id": 39260647, "link": "https://stackoverflow.com/questions/39260647/how-do-you-parse-date-in-the-format", "title": "How do you parse date in the format:", "body": "<p>It's not clear to me from the documentation how I would parse a date in this somewhat strange format. It seems like it might not be possible.</p>\n\n<pre><code>2016-07-08T08:34:24+00:00\n</code></pre>\n\n<p>The following does not work (<a href=\"https://play.golang.org/p/y32_lewh-F\" rel=\"nofollow\">go play link</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    date := \"2016-07-08T08:34:24+00:00\"\n    d, err := time.Parse(\"2006-01-02T15:04:05+07:00\", date)\n    if err == nil {\n        fmt.Println(d)\n    } else {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>Obviously a regexp could first check for this format and transform the <code>+</code> to a <code>-</code>, but that implies the standard library <em>cant</em> parse this date.</p>\n"}, {"tags": ["http", "go", "https", "server", "httpserver"], "comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1472687820, "post_id": 39260308, "comment_id": 65857346, "body": "Why don&#39;t you use some framework for this, martini or revel. I am using revel all the time. It supports oauth2 and similar. I played with revel. Here is repo if you are starting from scratch for revel api and oauth2: <a href=\"https://murphy.rs/nikola/revel-oauth2-restful\" rel=\"nofollow noreferrer\">murphy.rs/nikola/revel-oauth2-restful</a>. One more thing, I am always using nginx in front of any app instead running app on 80 and 443 port."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1472860827, "post_id": 39260308, "comment_id": 65938064, "body": "Well I am not using a big framework since I am trying to learn Go, and want something lightweight, so I settled for <code>go-restful</code> after looking at both martini and revel first."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1472690334, "last_edit_date": 1472690334, "creation_date": 1472689798, "answer_id": 39261005, "question_id": 39260308, "link": "https://stackoverflow.com/questions/39260308/building-urls-in-go-including-server-scheme/39261005#39261005", "title": "Building URLs in Go including server scheme", "body": "<p>My preferred solution when running http and https is just to run a simple listener on <code>:80</code> that redirects all traffic to https. Then any real traffic can be assumed to be https. </p>\n\n<p>Alternately I believe you can access a request's URL at <code>req.URL.Scheme</code> to see the protocol.</p>\n\n<p>Or do you mean for the entire application? If you accept configuration to switch between http and https, then can't you look at that and see which they chose? I guess I'm missing some context maybe.</p>\n\n<p>It is also common practice for apps to take a <code>baseURL</code> via flag or config to generate external urls with. </p>\n"}], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1472690334, "creation_date": 1472684481, "question_id": 39260308, "link": "https://stackoverflow.com/questions/39260308/building-urls-in-go-including-server-scheme", "title": "Building URLs in Go including server scheme", "body": "<p>I am creating a REST API in Go, and I want to build URLs to other resources in my replies.</p>\n\n<p>Based on the <code>http.Response</code> I can get the <code>Host</code> and <code>URL</code>. </p>\n\n<p><strong>However, how would I go about getting the transport scheme used by the server? <code>http</code> or <code>https</code>?</strong></p>\n\n<p>I attemped to check if <code>server.TLSConfig</code> is <code>nil</code> and then assuming it is using <code>http</code> since it says this in the documentation for <code>http.Server</code>:</p>\n\n<pre><code>TLSConfig    *tls.Config   // optional TLS config, used by ListenAndServeTLS\n</code></pre>\n\n<p>But it turns out this exists even when I do not run the server with <code>ListenAndServeTLS</code>.</p>\n\n<hr>\n\n<p>Or is this way of building my URLs the wrong way of doing things? Is there some other normal way of doing this?</p>\n"}, {"tags": ["http", "go", "chunked-encoding"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1472727548, "last_edit_date": 1472727548, "creation_date": 1472690389, "answer_id": 39261064, "question_id": 39260202, "link": "https://stackoverflow.com/questions/39260202/reading-and-streaming-responses-from-http-servers-that-are-using-chunk-transport/39261064#39261064", "title": "Reading and streaming responses from http servers that are using chunk transport in go", "body": "<p><code>io.Copy</code> has to copy the entire contents before you call <code>Flush</code>. If you want the contents sent before the buffer has filled, you need to call flush after each write yourself.</p>\n\n<p>A complete version of <code>io.Copy</code> that flushes an <code>http.ResponseWriter</code> after each write would look like:</p>\n\n<pre><code>func flushCopy(dst io.Writer, src io.Reader) (written int64, err error) {\n    buf := make([]byte, 1024 * 8)\n    flusher, canFlush := dst.(http.Flusher)\n    for {\n        nr, er := src.Read(buf)\n        if nr &gt; 0 {\n            nw, ew := dst.Write(buf[0:nr])\n            if nw &gt; 0 {\n                if canFlush {\n                    flusher.Flush()\n                }\n                written += int64(nw)\n            }\n            if ew != nil {\n                err = ew\n                break\n            }\n            if nr != nw {\n                err = io.ErrShortWrite\n                break\n            }\n        }\n        if er == io.EOF {\n            break\n        }\n        if er != nil {\n            err = er\n            break\n        }\n    }\n    return written, err\n}\n</code></pre>\n"}], "owner": {"reputation": 3584, "user_id": 743761, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/abe8647a64a9d4220d601a4a32499493?s=128&d=identicon&r=PG&f=1", "display_name": "Keeto", "link": "https://stackoverflow.com/users/743761/keeto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472752601, "creation_date": 1472683786, "last_edit_date": 1472752601, "question_id": 39260202, "link": "https://stackoverflow.com/questions/39260202/reading-and-streaming-responses-from-http-servers-that-are-using-chunk-transport", "title": "Reading and streaming responses from http servers that are using chunk transport in go", "body": "<p>I have an http server that responds to requests via the chunk protocol. In this simple example, it responds with the time every second. I have another server that forwards requests to this time server and respond with the same chunk protocol.</p>\n\n<p>curl -i localhost:8000 returns the right thing</p>\n\n<p>however curl -i localhost:9000 returns a chunked response but only after three seconds (not every second). This means that somehow io.copy does not really flush the output as soon as it comes</p>\n"}, {"tags": ["go", "liteide"], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 4100624, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1035444390/picture?type=large", "display_name": "Geoffrey Hendrey", "link": "https://stackoverflow.com/users/4100624/geoffrey-hendrey"}, "is_accepted": false, "score": 1, "last_activity_date": 1472683250, "creation_date": 1472683250, "answer_id": 39260108, "question_id": 39260088, "link": "https://stackoverflow.com/questions/39260088/why-doesnt-liteide-build-the-go-file-that-is-selected-highlighted/39260108#39260108", "title": "Why doesn&#39;t LiteIDE build the go file that is selected/highlighted?", "body": "<p>Oddly enough, you have to double-click the selected file, so that the go code is visible in the code editor. Only after doing this do commands such as \"build\" and \"install\" operate on the expected file. So although the file may be appear to be selected on the left hand navigation, unless it is actually loaded in the code editor it is not selected.</p>\n"}], "owner": {"reputation": 69, "user_id": 4100624, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1035444390/picture?type=large", "display_name": "Geoffrey Hendrey", "link": "https://stackoverflow.com/users/4100624/geoffrey-hendrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472683250, "creation_date": 1472683135, "question_id": 39260088, "link": "https://stackoverflow.com/questions/39260088/why-doesnt-liteide-build-the-go-file-that-is-selected-highlighted", "title": "Why doesn&#39;t LiteIDE build the go file that is selected/highlighted?", "body": "<p>In LiteIDE, when I select a file, then choose \"install\" from the \"build\" menu, a different file is built than the one selected. Why?</p>\n"}, {"tags": ["go", "scope"], "answers": [{"comments": [{"owner": {"reputation": 3358, "user_id": 852385, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c0eac51aaa99541fb966854b5dcb131?s=128&d=identicon&r=PG", "display_name": "Helin Wang", "link": "https://stackoverflow.com/users/852385/helin-wang"}, "edited": false, "score": 0, "creation_date": 1472690574, "post_id": 39260476, "comment_id": 65858007, "body": "Thanks, that explains my question. The implicit block of <code>each &quot;if&quot;, &quot;for&quot; and &quot;switch&quot; statement</code> is the parent block of the for execution block, right?"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 2, "last_activity_date": 1472685630, "creation_date": 1472685630, "answer_id": 39260476, "question_id": 39259996, "link": "https://stackoverflow.com/questions/39259996/does-a-new-run-of-for-loop-ends-the-scope-of-last-run-of-for-loop/39260476#39260476", "title": "Does a new run of for loop ends the scope of last run of for loop?", "body": "<p>From spec <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow\">https://golang.org/ref/spec#For_statements</a> </p>\n\n<blockquote>\n  <p>A \"for\" statement specifies repeated execution of a block.</p>\n</blockquote>\n\n<p>each of those blocks has its own scope and they are not nested or shared. But </p>\n\n<blockquote>\n  <p>Each \"if\", \"for\", and \"switch\" statement is considered to be in its\n  own implicit block.</p>\n</blockquote>\n\n<p>so variable i in your snippet is shared and</p>\n\n<pre><code>for i := 0; i &lt; 3; i++ {\n        funcs = append(funcs, func() { fmt.Println(i) })\n}\n\nfor _, f := range funcs {\n        f()\n}\n</code></pre>\n\n<p>will print 3 3 3 as expected.</p>\n"}], "owner": {"reputation": 3358, "user_id": 852385, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c0eac51aaa99541fb966854b5dcb131?s=128&d=identicon&r=PG", "display_name": "Helin Wang", "link": "https://stackoverflow.com/users/852385/helin-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 39260476, "answer_count": 1, "score": 1, "last_activity_date": 1472685630, "creation_date": 1472682611, "last_edit_date": 1472683267, "question_id": 39259996, "link": "https://stackoverflow.com/questions/39259996/does-a-new-run-of-for-loop-ends-the-scope-of-last-run-of-for-loop", "title": "Does a new run of for loop ends the scope of last run of for loop?", "body": "<p>I do not understand why following program prints <code>0 1 2</code>. I thought it will print <code>2 2 2</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var funcs []func()\n    for i := 0; i &lt; 3; i++ {\n        idx := i\n        funcs = append(funcs, func() { fmt.Println(idx) })\n    }\n\n    for _, f := range funcs {\n        f()\n    }\n}\n</code></pre>\n\n<p>My reasoning of it should print <code>2 2 2</code> is that each run of the for loop shared the same scope(e.g., 2nd run of for loop does not terminate the scope of 1st run, the scope are shared). Thus idx's reference is shared by the anonymous function created with in each run of for loop. Thus when the loop ends, all 3 functions created shared the same reference of idx, whose value is 2.</p>\n\n<p>So I think the question boils down to: Does a new run (e.g., i == 2) of for loop ends the scope of last run (e.g., i == 1) of for loop? Would appreciate if answer would point me to golang spec. (I could not find the spec mentioning this).</p>\n"}, {"tags": ["go", "cryptography", "aes"], "answers": [{"comments": [{"owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 2, "creation_date": 1472681051, "post_id": 39259635, "comment_id": 65855378, "body": "Are you saying I should add the bytes to the file myself? Why does NewOFB take IV as a parameter if it doesn&#39;t do anything with it?"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 2, "creation_date": 1472681105, "post_id": 39259635, "comment_id": 65855403, "body": "Yes, that is usually what is done when you are using encryption at this low level."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 0, "creation_date": 1472681327, "post_id": 39259635, "comment_id": 65855487, "body": "Note, is keystring is a human readable string it should not be used directly as a key, instead the encryption key should be derived from it with a derivation function such as PBKDF2. That will mea even more data needs to be bundled with the encrypted data: the salt and iteration count."}, {"owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 0, "creation_date": 1472681349, "post_id": 39259635, "comment_id": 65855497, "body": "Thanks zaph, I&#39;ll give it a shot!"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 0, "creation_date": 1472681760, "post_id": 39259635, "comment_id": 65855673, "body": "One more point, when using a stream cipher (OFB) the IV and key combination can never be reused, in this case  <code>rand.Reader</code> is a cryptographically secure random number generator so you should be safe."}, {"owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 0, "creation_date": 1472822470, "post_id": 39259635, "comment_id": 65920588, "body": "This makes a lot of sense now: IV is passed to cipher.NewOFB because the encryption method will use it during the encryption process. The actually IV is not stored in the file, this must be done manually."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "edited": false, "score": 0, "creation_date": 1472822700, "post_id": 39259635, "comment_id": 65920751, "body": "By prefixing the encrypted data the IV does not need to be saved anywhere, it will be available for decryption, this is common practice. The IV is not secret and should be a random bytes."}], "tags": [], "owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "is_accepted": true, "score": 2, "last_activity_date": 1472680638, "creation_date": 1472680638, "answer_id": 39259635, "question_id": 39259363, "link": "https://stackoverflow.com/questions/39259363/golang-crypto-encrypted-file-not-prefixed-with-iv/39259635#39259635", "title": "Golang crypto: encrypted file not prefixed with IV", "body": "<p>Add the IV prefix yourself or pre-share the IV. If you prefix it you will have the remove it and apply it on decryption.</p>\n\n<p>How an IV is shared is not part of the encryption standard, it is a developer choice. Prefixing the IV is common but not required or the only way, it is however a good choice.</p>\n"}], "owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 39259635, "answer_count": 1, "score": 1, "last_activity_date": 1472680638, "creation_date": 1472679244, "question_id": 39259363, "link": "https://stackoverflow.com/questions/39259363/golang-crypto-encrypted-file-not-prefixed-with-iv", "title": "Golang crypto: encrypted file not prefixed with IV", "body": "<p>I am using an IV in cipher.NewOFB, but my encrypted file never gets prefixed with it. I followed the golang examples at <a href=\"https://golang.org/pkg/crypto/cipher/\" rel=\"nofollow\">https://golang.org/pkg/crypto/cipher/</a>, but can't seem to figure out why the prefix isn't being considered. </p>\n\n<p>Does anyone see what the problem is?</p>\n\n<pre><code>func generateRandomIV(length int) []byte {\n    iv := make([]byte, aes.BlockSize)\n\n    if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n        panic(err)\n    }\n\n    return iv\n}\n\n\nfunc encryptFile(filename, keystring string) error {\n    readFile, err := os.Open(filename)\n    iv := generateRandomIV(aes.BlockSize)\n\n    outFile, err := os.OpenFile(filename+\".enc\", os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0600)\n    if err != nil {\n        panic(err)\n    }\n\n    defer readFile.Close()\n    defer outFile.Close()\n\n    key := []byte(keystring)\n\n    block, err := aes.NewCipher(key)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"IV:\", iv)\n    writer := &amp;cipher.StreamWriter{S: cipher.NewOFB(block, iv), W: outFile}\n\n    if _, err := io.Copy(writer, readFile); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472671599, "post_id": 39257448, "comment_id": 65851030, "body": "No Go values are safe for concurrent read and write."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472677221, "post_id": 39257448, "comment_id": 65853847, "body": "Start a goroutine with set(i, &amp;j) and check with -race flag.  It should confirm no race condition."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1472680378, "post_id": 39257448, "comment_id": 65855160, "body": "A good rule of thumb in Go is if you&#39;re concerned about concurrent modification, you should take a long, hard look at your design and find a way to eliminate the concurrent access altogether - &quot;Do not communicate by sharing memory; instead, share memory by communicating.&quot; See <a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow noreferrer\">blog.golang.org/share-memory-by-communicating</a>  Sometimes unavoidable, but worth considering."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472690755, "post_id": 39257448, "comment_id": 65858046, "body": "@Sridhar: there is a data race. The race detector is not infallible, but in this case there was a loophole through reflect and it will be fixed in go1.8."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1472704048, "post_id": 39257448, "comment_id": 65860980, "body": "Does that mean <code>encoding&#47;json</code> and other similar packages that depend on reflection are also unsafe for concurrent use?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472712045, "post_id": 39257448, "comment_id": 65863806, "body": "@JimB, can you please provide a <a href=\"https://github.com/golang/go/issues\" rel=\"nofollow noreferrer\">link to the issue</a> to which you refer ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1472734712, "post_id": 39257448, "comment_id": 65878866, "body": "@Sridhar: <a href=\"https://golang.org/issue/16281\" rel=\"nofollow noreferrer\">golang.org/issue/16281</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472734925, "post_id": 39257448, "comment_id": 65879020, "body": "@abhink: Nothing In Go is safe to use concurrently unless it&#39;s specifically documented as such, the use of reflection doesn&#39;t change anything. It would not be safe to encode/decode a value while it&#39;s being used concurrently, but that&#39;s no different than any other use in the language."}], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472671199, "creation_date": 1472671199, "question_id": 39257448, "link": "https://stackoverflow.com/questions/39257448/concurrent-access-to-reflect-value", "title": "Concurrent access to reflect.Value", "body": "<p>If I am writing a function to modify a variable's value dynamically, how would I go about making that function safe for concurrent use. For example, consider the following snippet:</p>\n\n<pre><code>func set(v, d interface{}) error {\n    val := reflect.ValueOf(v)\n    dst := reflect.ValueOf(d).Elem()\n\n    if dst.Type() != val.Type() {\n        return fmt.Errorf(\"incompatible types - %s %s\", dst.Type(), val.Type())\n    }\n    dst.Set(val)\n    return nil\n}\n</code></pre>\n\n<p>This function will be called in the following manner:</p>\n\n<pre><code>i := 1\nvar j int\n_ = set(i, &amp;j)\n</code></pre>\n\n<p>Working code: <a href=\"https://play.golang.org/p/XjlHrDLFqd\" rel=\"nofollow\">https://play.golang.org/p/XjlHrDLFqd</a></p>\n\n<p>How safe would it be to change <code>i</code> concurrently? <code>reflect.Value</code> <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow\">docs</a> say the following:</p>\n\n<blockquote>\n  <p>A Value can be used concurrently by multiple goroutines provided that\n  the underlying Go value can be used concurrently for the equivalent\n  direct operations.</p>\n</blockquote>\n\n<p>Which leads me to believe that locking would be required. If so, where would the locking part go? Is it required to be maintained until the value (concrete) completely makes it through the reflection section? For example, in the above example, is it OK to keep a lock through out <code>set</code>'s execution?</p>\n\n<p>Also, what are some underlying Go values that cannot be used concurrently (as mentioned in the docs bit above)?</p>\n"}, {"tags": ["go", "go-iris"], "answers": [{"tags": [], "owner": {"reputation": 92, "user_id": 2131647, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/HcC92.jpg?s=128&g=1", "display_name": "TheROX", "link": "https://stackoverflow.com/users/2131647/therox"}, "is_accepted": true, "score": 0, "last_activity_date": 1472675843, "creation_date": 1472675843, "answer_id": 39258590, "question_id": 39256975, "link": "https://stackoverflow.com/questions/39256975/handle-body-post-using-iris-go/39258590#39258590", "title": "Handle body post using Iris-go", "body": "<p>You should try to export fields with json tags in your structure \ni.e.</p>\n\n<pre><code> type Lead struct {\n  FbId string `json:\"fbId\"`\n  Email string `json:\"email\"`\n  Telefono string `json:\"telefono\"`\n  Version string `json:\"version\"`\n  Mac string `json:\"mac\"`\n  Os string `json:\"os\"`\n }\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 4705071, "user_type": "registered", "profile_image": "https://graph.facebook.com/958980510799357/picture?type=large", "display_name": "Eduardo Rodr&#237;guez", "link": "https://stackoverflow.com/users/4705071/eduardo-rodr%c3%adguez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2833, "favorite_count": 0, "accepted_answer_id": 39258590, "answer_count": 1, "score": 1, "last_activity_date": 1527045290, "creation_date": 1472669495, "last_edit_date": 1527045290, "question_id": 39256975, "link": "https://stackoverflow.com/questions/39256975/handle-body-post-using-iris-go", "title": "Handle body post using Iris-go", "body": "<p>I'm new in Golang, I've been doing some code tests to build an REST API using Iris framework, I'm trying to get the body data from a Post to my API but I cannot make it works, I did read the <strong>Body binder</strong> <a href=\"http://iris-go.com/body_binder/\" rel=\"nofollow\">http://iris-go.com/body_binder/</a> and followed the examples. The result I get is an empty structure:</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/kataras/iris\"\n  \"fmt\"\n)\n\ntype PostAPI struct {\n *iris.Context\n}\n\ntype Lead struct {\n fbId string\n email string\n telefono string\n version string\n mac string\n os string\n}\n\nfunc (p PostAPI)  Post(){\n\n  lead := Lead{}\n  err := p.ReadJSON(&amp;lead)\n\n  if (err != nil) {\n\n    fmt.Println(\"Error on reading form: \" + err.Error())\n    return\n  }\n  fmt.Printf(\"Post! %v\", lead)\n}\n\nfunc main() {\n\n  iris.API(\"/\", PostAPI{})\n  iris.Listen(\":8080\")\n}\n</code></pre>\n\n<p>The post:</p>\n\n<pre><code>curl -H \"Content-Type: application/json\" -X POST -d '{\"fbId\": \"werwer\",\"email\": \"werwer@gmail.com\",\"telefono\": \"5555555555\",\"version\": \"123\",\"mac\": \"3j:3j:3j:3j\",\"os\": \"uno bien chido\"}' http://0.0.0.0:8080/\n</code></pre>\n\n<p>The result:</p>\n\n<pre><code>Post! {     }\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 4107796, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04f749980bc28bc2f23547d739b38d85?s=128&d=identicon&r=PG&f=1", "display_name": "jack sexton", "link": "https://stackoverflow.com/users/4107796/jack-sexton"}, "edited": false, "score": 0, "creation_date": 1472672964, "post_id": 39257258, "comment_id": 65851691, "body": "do you know what the caller of those modules are. I would like to also see how it handles those functions."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 987, "user_id": 4107796, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04f749980bc28bc2f23547d739b38d85?s=128&d=identicon&r=PG&f=1", "display_name": "jack sexton", "link": "https://stackoverflow.com/users/4107796/jack-sexton"}, "edited": false, "score": 0, "creation_date": 1472673530, "post_id": 39257258, "comment_id": 65851992, "body": "I would grep around in the runtime package and look closely at proc.go. Is there something in particular you are looking for?"}, {"owner": {"reputation": 987, "user_id": 4107796, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04f749980bc28bc2f23547d739b38d85?s=128&d=identicon&r=PG&f=1", "display_name": "jack sexton", "link": "https://stackoverflow.com/users/4107796/jack-sexton"}, "edited": false, "score": 0, "creation_date": 1472677545, "post_id": 39257258, "comment_id": 65853978, "body": "my main concern was to check if it was using pthreads, but it doesn&#39;t look like it now I&#39;m looking to see how it manages the different apis for each system."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 0, "last_activity_date": 1472670477, "creation_date": 1472670477, "answer_id": 39257258, "question_id": 39256491, "link": "https://stackoverflow.com/questions/39256491/how-does-golang-implement-os-threads-for-goroutines/39257258#39257258", "title": "how does Golang implement OS threads for goroutines?", "body": "<p>The strategy is different for each os.<br>\nSome examples are in <a href=\"https://golang.org/src/runtime/os_windows.go\" rel=\"nofollow\">the windows os portion for the Go runtime</a> and \n<a href=\"https://golang.org/src/runtime/os_linux.go\" rel=\"nofollow\">the linux os portion for the Go runtime</a></p>\n"}], "owner": {"reputation": 987, "user_id": 4107796, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04f749980bc28bc2f23547d739b38d85?s=128&d=identicon&r=PG&f=1", "display_name": "jack sexton", "link": "https://stackoverflow.com/users/4107796/jack-sexton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 2, "accepted_answer_id": 39257258, "answer_count": 1, "score": 2, "last_activity_date": 1472670477, "creation_date": 1472667668, "question_id": 39256491, "link": "https://stackoverflow.com/questions/39256491/how-does-golang-implement-os-threads-for-goroutines", "title": "how does Golang implement OS threads for goroutines?", "body": "<p>I'm trying to figure out how golang multiplexes goroutines onto OS threads but I couldn't find the implementation for this in the golang source. I've looked in proc.go and runtime.go. I want to know how threads are initialized and managed and if it uses pthreads.</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 4, "creation_date": 1472662778, "post_id": 39254898, "comment_id": 65846065, "body": "<a href=\"http://stackoverflow.com/questions/18276173/calling-a-template-with-several-pipeline-parameters#18276968\" title=\"calling a template with several pipeline parameters%2318276968\">stackoverflow.com/questions/18276173/&hellip;</a> might be the best answer available."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 2, "last_activity_date": 1593709188, "creation_date": 1593709188, "answer_id": 62701480, "question_id": 39254898, "link": "https://stackoverflow.com/questions/39254898/variables-in-nested-golang-templates/62701480#62701480", "title": "Variables in nested golang templates", "body": "<p>You can indeed! You just need to pass in variables into the nested template.</p>\n<p>The documentation you cited is about how the template can't read variables in from the go process, unless you explicitly pass them in.</p>\n<p>Similarly, nested templates will take whatever you pass them and nothing more.</p>\n<p>From <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\">https://golang.org/pkg/text/template/#hdr-Actions</a></p>\n<pre><code>{{template &quot;name&quot;}}\n    The template with the specified name is executed with nil data.\n\n{{template &quot;name&quot; pipeline}}\n    The template with the specified name is executed with dot set\n    to the value of the pipeline.\n</code></pre>\n<p>Here's a quick example lightly based on your prompt:</p>\n<pre><code>package main\n\nimport (\n    &quot;os&quot;\n    &quot;text/template&quot;\n)\n\nfunc main() {\n    var animals = map[string]string{\n        &quot;spirit_animal&quot;:   &quot;cat&quot;,\n        &quot;spirit_predator&quot;: &quot;dog&quot;,\n    }\n\n    const letter = `\n{{define &quot;echo&quot;}}Inside a template, I echo what you say: {{.}}{{end}}\n{{define &quot;predator&quot;}}Inside a template, I know that your predator is: {{.spirit_predator}}{{end}}\n\nYour spirit animal is: {{.spirit_animal}}\n\n{{template &quot;predator&quot; . }}\n\n{{template &quot;echo&quot; .spirit_animal }}`\n\n    t := template.Must(template.New(&quot;letter&quot;).Parse(letter))\n    _ = t.Execute(os.Stdout, animals)\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/3X7IQasWlsR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3X7IQasWlsR</a></p>\n"}], "owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4129, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1593709188, "creation_date": 1472661719, "last_edit_date": 1472662390, "question_id": 39254898, "link": "https://stackoverflow.com/questions/39254898/variables-in-nested-golang-templates", "title": "Variables in nested golang templates", "body": "<p>I want to define variables inside of a golang template, instead of in a binary so that there is no need to recompile.  </p>\n\n<p>In Go, I set some vars:</p>\n\n<pre><code>var animals = map[string]string{\n    \"spirit_animal\":    \"cat\",\n    \"spirit_predator\":  \"dog\",\n}\n</code></pre>\n\n<p>I execute the template with this: <code>t.ExecuteTemplate(w, \"main\", variables)</code> which passes these vars to the template.  </p>\n\n<p>Now I would like to take these vars from go and into the \"main\" template.</p>\n\n<pre><code>{{$spirit_animal:=\"cat\"}} {{$spirit_animal}}\n</code></pre>\n\n<p>And I call sub-templates like this:</p>\n\n<pre><code>{{ template \"navbar\" . }}\n</code></pre>\n\n<p>The problem is that nested templates (sub templates) do not appear to have access to any variables.  </p>\n\n<p>From the <a href=\"https://golang.org/pkg/text/template/#pkg-overview\" rel=\"noreferrer\">documentation</a>, \"A template invocation does not inherit variables from the point of its invocation.\" Reading the Documentation for \"text/template\", it sounds like variables may not be able to be used in nested templates.  </p>\n\n<p>Any suggestions on how to get these vars out of a binary and into a single text location accessible by nested templates that doesn't need to be recompiled on change?</p>\n"}, {"tags": ["nginx", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472658850, "post_id": 39253990, "comment_id": 65843971, "body": "It&#39;s probably the backend that&#39;s closing the connection. What is the proxy config, and what is the Go server doing with the connection?"}, {"owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472659681, "post_id": 39253990, "comment_id": 65844490, "body": "@JimB I have added more information included function that&#39;s responsible for writing the response in go and the complete nginx config."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472662151, "post_id": 39253990, "comment_id": 65845736, "body": "Not sure what&#39;s going on from the info provided here. You may need to log what&#39;s happening between nginx and the backend. Also, are you certain that it&#39;s the server closing the connection? Have you tested with an http/1.1 client making multiple requests with same connection?"}, {"owner": {"reputation": 441, "user_id": 1730482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8390436ac549ea4b6e9703566c097cc7?s=128&d=identicon&r=PG", "display_name": "marklap", "link": "https://stackoverflow.com/users/1730482/marklap"}, "edited": false, "score": 0, "creation_date": 1472670764, "post_id": 39253990, "comment_id": 65850574, "body": "How long is it taking for the client to deliver the POST body? How long is it taking for the server (either your Go http handler or NGINX) to deliver the reply to the client. You&#39;ve got some timeouts in your NGINX config that may be impacting the keepalive. I wonder if you&#39;re trying to keep a long lived connection for something like &quot;streaming&quot; data back to the client. If that&#39;s the case, then the send_timeout setting is suspect to me. A tcpdump between client and server should at least tell you which end is initiating the close."}, {"owner": {"reputation": 198, "user_id": 9150059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe52d12532ac42f4e3e92fcb701b2d7f?s=128&d=identicon&r=PG&f=1", "display_name": "Nitb", "link": "https://stackoverflow.com/users/9150059/nitb"}, "edited": false, "score": 1, "creation_date": 1575899107, "post_id": 39253990, "comment_id": 104710018, "body": "Is the issue resolved? If yes, would help the community if you can post the answer."}], "owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3059, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472659633, "creation_date": 1472658557, "last_edit_date": 1472659633, "question_id": 39253990, "link": "https://stackoverflow.com/questions/39253990/nginx-closes-connection-even-with-keep-alive", "title": "Nginx closes connection even with keep alive", "body": "<p>So I have an issues which I'm not sure if it's a GO problem or issues with nginx configuration. Basically when trying to test a curl request to our servers, the connection unexpectedly gets closed, even though keep-alive is set to true. \nBelow is the log I get back from nginx: </p>\n\n<pre><code>* About to connect() to sub.domain.com port 80 (#0)\n* Trying W.X.Y.Z... connected\n&gt; POST /br HTTP/1.1\n&gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3\n&gt; Host: sub.domain.com\n&gt; Accept: */*\n&gt; Connection: keep-alive\n&gt; Content-Length: 1635\n&gt; Content-Type: application/x-www-form-urlencoded\n&gt; Expect: 100-continue\n&gt;\n&lt; HTTP/1.1 100 Continue\n&lt; HTTP/1.1 200 OK\n&lt; Content-Type: application/json; charset=utf-8\n&lt; Date: Wed, 31 Aug 2016 15:31:21 GMT\n&lt; Server: nginx/1.6.1\n&lt; Content-Length: 3158\n&lt; Connection: keep-alive\n&lt;\n{\"data1\": \"some data\", \"data2\": \"some data2\" ....\n* Connection #0 to host sub.domain.com left intact\n* Closing connection #0\n... \"dataX\": \"some dataX\", \"dataY\": \"some dataY}\n</code></pre>\n\n<p>Our nginx keep-alive configuration:</p>\n\n<pre><code>keepalive_timeout 150;\nkeepalive_requests 5000;\n</code></pre>\n\n<p>The nginx is sitting in front of a Go server, although it shouldn't impact it. Any tips on how to go about trying to figure out why the keep-alive is closing the connection?</p>\n\n<p>Edit: \ncomplete nginx config:</p>\n\n<pre><code>user  nginx;\nworker_processes  auto;\nworker_rlimit_nofile 200000;\n\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections 60000;\n    multi_accept on;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    error_log   /dev/null;\n    access_log   /dev/null;\n\n    sendfile        on;\n    tcp_nopush     on;\n\n    keepalive_timeout 150;\n    keepalive_requests 5000;\n    client_header_timeout 2;\n    client_body_timeout 2;\n\n    reset_timedout_connection on;\n    send_timeout 2;\n    gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n\n    upstream go_app {\n    server 127.0.0.1:3000 weight=1;\n    keepalive 2000;\n    }\n\n    server {\n        listen 80;\n        server_name 1.domain.com 2.domain.com 3.domain.com 4.domain.com 5.domain.com;\n        location / {\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header HOST $http_host;\n                proxy_set_header X-NginX-Proxy true;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_pass http://go_app;\n                proxy_redirect off;\n                proxy_http_version 1.1;\n                proxy_set_header Upgrade $http_upgrade;\n                proxy_set_header Connection \"upgrade\";\n        }\n    }\n\n\n    server {\n        listen       80;\n        server_name  localhost;\n        root         /usr/share/nginx/html;\n\n        location / {\n        }\n\n        error_page  404              /404.html;\n        location = /40x.html {\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n        }\n    }\n}\n</code></pre>\n\n<p>And the go-code responsible for writing the response:</p>\n\n<pre><code>func Success(response http.ResponseWriter, value string) {\n    response.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\n    fmt.Fprint(response, value)\n    response.Write(nil)\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "concurrency", "worker", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472656265, "post_id": 39253204, "comment_id": 65842272, "body": "Would <a href=\"https://golang.org/pkg/sync/#Cond\" rel=\"nofollow noreferrer\"><code>sync.Condition</code></a> be what you&#39;re looking for?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472658939, "post_id": 39253204, "comment_id": 65844024, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/29488010/property-change-notification-in-go\">Property change notification in go</a>"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472659869, "post_id": 39253204, "comment_id": 65844577, "body": "Maybe a buffered channel will help if the only concern is blocking writes to the channel. Admittedly not a good solution because you&#39;ll need to make some pre-estimate about size of buffer. Edit - ignore that - just noticed they&#39;re bool channels."}], "answers": [{"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 3, "last_activity_date": 1472676071, "last_edit_date": 1472676071, "creation_date": 1472664214, "answer_id": 39255547, "question_id": 39253204, "link": "https://stackoverflow.com/questions/39253204/implementing-the-concept-of-events-with-notifiers-receivers-in-golang/39255547#39255547", "title": "Implementing the concept of &quot;events&quot; (with notifiers/receivers) in Golang?", "body": "<p>Use a non-blocking write to the channel. This way if anyone is listening they receive it. If there is no one listening it doesn't block the sender, although the event is lost.</p>\n\n<p>You could use a buffered channel so that at least some events are buffered if you need that.</p>\n\n<p>You implement a non-blocking send by using the <code>select</code> keyword with a default case. The default makes it non-blocking. Without the default case a select will block until one of its channels becomes usable.</p>\n\n<p>Code snippit:</p>\n\n<pre><code>select {\n    case ch &lt;- event:\n        sent = true\n    default:\n        sent = false\n}\n</code></pre>\n"}], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 39255547, "answer_count": 1, "score": 0, "last_activity_date": 1472676071, "creation_date": 1472656104, "question_id": 39253204, "link": "https://stackoverflow.com/questions/39253204/implementing-the-concept-of-events-with-notifiers-receivers-in-golang", "title": "Implementing the concept of &quot;events&quot; (with notifiers/receivers) in Golang?", "body": "<p>I'm wondering what is the proper way to handle the concept of \"events\" (with notifiers/receivers) in Golang. I suppose I need to use channels but not sure about the best way.</p>\n\n<p>Specifically, I have the program below with two workers. Under certain conditions, \"worker1\" goes in and out of a \"fast mode\" and notify this via channels. \"worker2\" can then receive this event. This works fine, but then the two workers are tightly coupled. In particular, if worker2 is not running, worker1 gets stuck waiting when writing to the channel.</p>\n\n<p>What would be the best way in Golang to implement this logic? Basically, one worker does something and notify any other worker that it has done so. Whether other workers listen to this event or not must not block worker1. Ideally, there could be any number of workers that could listen to this event.</p>\n\n<p>Any suggestion?</p>\n\n<pre><code>var fastModeEnabled = make(chan bool)\nvar fastModeDisabled = make(chan bool)\n\nfunc worker1() {\n    mode := \"normal\"\n    for {\n        // under some conditions:\n        mode := \"fast\"\n        fastModeEnabled &lt;- true\n\n        // later, under different conditions:\n        mode := \"normal\"\n        fastModeDisabled &lt;- true\n    }\n}\n\nfunc worker2() {\n    for {\n        select {\n\n        case &lt;-fastModeEnabled:\n\n            fmt.Println(\"Fast mode started\")\n\n        case &lt;-fastModeDisabled:\n\n            fmt.Println(\"Fast mode ended\")\n\n        }\n    }\n}\n\nfunc main() {\n    go worker2()\n    go worker1()\n\n    for {}\n}\n</code></pre>\n"}, {"tags": ["go", "rethinkdb"], "answers": [{"tags": [], "owner": {"reputation": 5046, "user_id": 3200554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a018f6e3757b55a3df0a735acc199b4?s=128&d=identicon&r=PG&f=1", "display_name": "mlucy", "link": "https://stackoverflow.com/users/3200554/mlucy"}, "is_accepted": true, "score": 0, "last_activity_date": 1472714191, "creation_date": 1472714191, "answer_id": 39265018, "question_id": 39252553, "link": "https://stackoverflow.com/questions/39252553/rethinkdb-go-ensure-table-and-index-in-one-reql-statement/39265018#39265018", "title": "Rethinkdb, Go: Ensure Table and Index in one ReQL statement", "body": "<p>Yeah, <code>do</code> is the normal way you sequence operations in ReQL.  The <code>r.Do</code> as the third argument to <code>branch</code> is superfluous, though; you can just put the <code>tableCreate</code> call there directly.</p>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 39265018, "answer_count": 1, "score": 0, "last_activity_date": 1472714191, "creation_date": 1472654254, "question_id": 39252553, "link": "https://stackoverflow.com/questions/39252553/rethinkdb-go-ensure-table-and-index-in-one-reql-statement", "title": "Rethinkdb, Go: Ensure Table and Index in one ReQL statement", "body": "<p>I need to ensure existence of table(s) upon application startup.</p>\n\n<p>I also want to create secondary index on the table if table does not exist and needs to be created.</p>\n\n<p>It is easily done in Go but I would like to do it in ReQL in one statement. So I came up with this:</p>\n\n<pre><code>func ensureTableIndex(ses *r.Session, name string, index string) (err error) {\n    err = r.TableList().Contains(name).Do(r.Branch(r.Row, r.Expr(nil), r.Do(func() r.Term {\n        return r.TableCreate(name).Do(func() r.Term {\n            return r.Table(name).IndexCreate(index)\n        })\n    }))).Exec(ses)\n    return\n}\n</code></pre>\n\n<p>Seems to pass the test.</p>\n\n<p>My question is whether this is a correct/efficient way to do table and index creation in one go? Is using ReQL Do() function the correct way to sequence multiple write commands?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "go", "shared-libraries", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472650308, "post_id": 39251045, "comment_id": 65837798, "body": "Yes you can link to C libraries (that what cgo is mainly for). What problem are you having?"}, {"owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472650441, "post_id": 39251045, "comment_id": 65837905, "body": "I want to call a client library but am unsure where to place the library so that I can reference it in go? And then how to tell go where the library is?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472651249, "post_id": 39251045, "comment_id": 65838510, "body": "There&#39;s a cgo directive specifically for pkg-config, <code>#cgo pkg-config</code>, and there&#39;s also <code>#cgo LDFLAGS</code>: <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>. You can use either of those to tell the linker how to find the libraries."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472653347, "post_id": 39251045, "comment_id": 65840064, "body": "see this: <a href=\"http://stackoverflow.com/questions/37987643/how-to-link-golang-package-to-an-existing-c-project-using-go-from-c-on-windows\" title=\"how to link golang package to an existing c project using go from c on windows\">stackoverflow.com/questions/37987643/&hellip;</a>"}, {"owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "edited": false, "score": 0, "creation_date": 1472655332, "post_id": 39251045, "comment_id": 65841611, "body": "Thanks. Do you have an example? So if I have a library hello.a and put it in my go src in a folder called lib how do i set this up?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472656435, "post_id": 39251045, "comment_id": 65842391, "body": "@Westy10101: if you want to package the C library with your source, look for <code>{SRCDIR}</code> in the cgo documentation I linked."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472657142, "post_id": 39253330, "comment_id": 65842861, "body": "you can&#39;t use relative paths in LDFLAGS, because the build happens in a different directory than the source. That&#39;s why I mentioned <code>{SRCDIR}</code> above`"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472657974, "post_id": 39253330, "comment_id": 65843428, "body": "@JimB both  <code>-L${SRCDIR}&#47;libs</code>  and <code>-L.&#47;libs</code>  works here for me, so edited to general case: <code>-L${SRCDIR}&#47;libs</code>.  Thanks."}, {"owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "edited": false, "score": 1, "creation_date": 1472657979, "post_id": 39253330, "comment_id": 65843431, "body": "Thanks, literally you have just made my day! Sorry for being dim its been a fair few years since I have done any C."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472658189, "post_id": 39253330, "comment_id": 65843565, "body": "@Amd: it&#39;s probably because you&#39;re using <code>go build</code> with an assumed package of the current directory. You can&#39;t <code>go get</code> or <code>go install</code> with a relative path."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1472658156, "last_edit_date": 1472658156, "creation_date": 1472656519, "answer_id": 39253330, "question_id": 39251045, "link": "https://stackoverflow.com/questions/39251045/cannot-use-already-compiled-c-library-using-cgo-in-golang-application/39253330#39253330", "title": "Cannot use already compiled C library using cgo in Golang application?", "body": "<p>I'll explain it with this sample:</p>\n\n<p>First build <code>libhello.a</code> using <code>./libs/m.c</code>:</p>\n\n<pre><code>#include &lt;stdint.h&gt; \n\nextern uint64_t Add(uint64_t a, uint64_t b) {\n    return a + b;\n}\n</code></pre>\n\n<p>For this test sample <code>libhello.a</code> is inside <code>./libs/</code> :</p>\n\n<pre><code>m.go\n\u2514\u2500\u2500\u2500libs\n    m.c\n    libhello.a\n</code></pre>\n\n<hr>\n\n<p>Then <code>go build</code> this <code>m.go</code> working sample:</p>\n\n<pre><code>package main\n\n//#cgo LDFLAGS: -L${SRCDIR}/libs -lhello\n//#include &lt;stdint.h&gt;\n//extern uint64_t Add(uint64_t a, uint64_t b);\nimport \"C\"\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(C.Add(C.uint64_t(10), C.uint64_t(20))) // 30\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>30\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>When the cgo directives are parsed, any occurrence of the string\n  ${SRCDIR} will be replaced by the absolute path to the directory\n  containing the source file. This allows pre-compiled static libraries\n  to be included in the package directory and linked properly. For\n  example if package foo is in the directory /go/src/foo:</p>\n\n<pre><code>// #cgo LDFLAGS: -L${SRCDIR}/libs -lfoo\n</code></pre>\n  \n  <p>Will be expanded to:</p>\n\n<pre><code>// #cgo LDFLAGS: -L/go/src/foo/libs -lfoo\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1484, "favorite_count": 0, "accepted_answer_id": 39253330, "answer_count": 1, "score": 0, "last_activity_date": 1472658156, "creation_date": 1472650240, "last_edit_date": 1472658056, "question_id": 39251045, "link": "https://stackoverflow.com/questions/39251045/cannot-use-already-compiled-c-library-using-cgo-in-golang-application", "title": "Cannot use already compiled C library using cgo in Golang application?", "body": "<p>I am trying to wrap a C library in Golang. I am trying to call a C function in an already compiled library. I have both a <code>.a</code> file and a <code>.so</code> library file. </p>\n\n<p>Where do I need to place the library files and how do i tell <code>cgo</code> that I am using these libraries?</p>\n\n<p>I am rather a novice when it comes to C. Any help would be greatly appreciated.</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "edited": false, "score": 0, "creation_date": 1472648972, "post_id": 39250365, "comment_id": 65836840, "body": "Exactly. Thank you for pointing out the reasons. Who is around to benchmarking, performance returned to normal. Thank you."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472649206, "post_id": 39250365, "comment_id": 65837010, "body": "If no <code>default</code> in <code>select</code> just one <code>case</code>, then there isn&#39;t a need for <code>select</code>. Worth pointing out."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1472649643, "last_edit_date": 1472649643, "creation_date": 1472648374, "answer_id": 39250365, "question_id": 39250051, "link": "https://stackoverflow.com/questions/39250051/http-concurrent-delays-with-goroutines-in-background/39250365#39250365", "title": "http concurrent delays with goroutines in background", "body": "<p>your goroutines use <code>default</code>, causing them to spin immediately if there is nothing in the channel (and there is nothing in your example). This probably makes Go's scheduler do way more context switching than needed, and probably consume a lot of CPU for nothing.</p>\n\n<p>Is there a reason to <code>default</code> in a loop? If not try one of the following: </p>\n\n<p>Either no default, the goroutines would simply \"sleep\" until there's work. </p>\n\n<pre><code> for {\n        select {\n        case work := &lt;-t.Work:\n            log.Printf(\"[testerGo][Worker] %v\\n\", work)\n        }\n    }\n</code></pre>\n\n<p>This BTW makes the select completely redundant, so just get rid of it:</p>\n\n<pre><code> for { //you can also use a range on the channel\n     work := &lt;- t.Work \n     log.Printf(\"[testerGo][Worker] %v\\n\", work)\n }\n</code></pre>\n\n<p>Second option - a timeout that will make them wait before continuing in the loop:</p>\n\n<pre><code> for {\n        select {\n        case work := &lt;-t.Work:\n            log.Printf(\"[testerGo][Worker] %v\\n\", work)\n\n        case &lt;- time.After(100*time.Millisecond): //or whatever you prefer\n\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "accepted_answer_id": 39250365, "answer_count": 1, "score": 2, "last_activity_date": 1472653041, "creation_date": 1472647504, "last_edit_date": 1472653041, "question_id": 39250051, "link": "https://stackoverflow.com/questions/39250051/http-concurrent-delays-with-goroutines-in-background", "title": "http concurrent delays with goroutines in background", "body": "<p>Why is there such a delay in processing of incoming requests by the main server goroutine and how can this delay be avoided ?</p>\n\n<p>Simple code with <strong>NO DELAYS</strong> </p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"net/http\"\n)\nfunc main() {\n    http.HandleFunc(\"/\", root)\n    http.ListenAndServe(\":8090\", nil)\n}\n//---------------------------------------------------------------------------\n//  http handlers\n//---------------------------------------------------------------------------\nfunc root(w http.ResponseWriter, r *http.Request) {\n    log.Printf(\"[root] `%v`\\n\", r.URL.Path)\n    w.Write([]byte(\"What the hell\"))\n}\n</code></pre>\n\n<p>Result testing the loading</p>\n\n<pre><code>    \u2570\u2500\u27a4  wrk -d20s -t5 -c100 http://localhost:8090\nRunning 20s test @ http://localhost:8090\n  5 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    17.07ms   46.63ms 368.77ms   91.73%\n    Req/Sec    10.99k     4.87k   24.48k    62.49%\n  1038912 requests in 20.10s, 128.80MB read\nRequests/sec:  51684.63\nTransfer/sec:      6.41MB\n</code></pre>\n\n<p>Adding goroutines </p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"net/http\"\n)\nfunc main() {\n    _ = NewTesterGo(100)\n\n    http.HandleFunc(\"/\", root)\n    http.ListenAndServe(\":8090\", nil)\n}\n//---------------------------------------------------------------------------\n//  http handlers\n//---------------------------------------------------------------------------\nfunc root(w http.ResponseWriter, r *http.Request) {\n    log.Printf(\"[root] `%v`\\n\", r.URL.Path)\n    w.Write([]byte(\"What the fuck\"))\n}\n\n//---------------------------------------------------------------------------\n//  tester segment\n//---------------------------------------------------------------------------\ntype (\n    TesterGo struct {\n        Work chan string\n    }\n)\n\nfunc NewTesterGo(count int) *TesterGo {\n    t:=&amp;TesterGo{\n        Work:make(chan string,100),\n    }\n    for ; count &gt; 0 ; count -- {\n        go t.Worker()\n    }\n    return t\n\n}\nfunc (t *TesterGo) Worker() {\n    log.Printf(\"[testergo][worker][work] \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u0430\u043b....\\n\")\n    for {\n        select {\n        case work := &lt;-t.Work:\n            log.Printf(\"[testerGo][Worker] %v\\n\", work)\n        default:\n        }\n    }\n}\n</code></pre>\n\n<p>Result  with loading </p>\n\n<pre><code>\u2570\u2500\u27a4  wrk -d20s -t5 -c100 http://localhost:8090\nRunning 20s test @ http://localhost:8090\n  5 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   464.71ms  305.44ms   1.90s    77.90%\n    Req/Sec    54.62     43.74   200.00     67.50%\n  3672 requests in 20.05s, 466.17KB read\n  Socket errors: connect 0, read 0, write 0, **timeout 97**\nRequests/sec:    **183.11**\nTransfer/sec:     23.25KB\n</code></pre>\n"}, {"tags": ["function", "go", "boolean", "logical-operators"], "comments": [{"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "edited": false, "score": 0, "creation_date": 1472647442, "post_id": 39250007, "comment_id": 65835740, "body": "I am getting this error: invalid operation: possiblemove || Move(x + 2, y + 1, m + 1) (mismatched types bool and int) which is obvious but I cant find a solution HELP!!!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1472649070, "post_id": 39250007, "comment_id": 65836913, "body": "Of course you cannot to OR between int and bool. The question is: What do you want to achieve? What do you think <code>possiblemove || Move( x+1, y-2, m+1)</code> should be?"}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1472650448, "post_id": 39250007, "comment_id": 65837912, "body": "Through this I&#39;m trying to find the knights tour solution in go lang through this <a href=\"https://play.golang.org/p/VUPD4Nv-If\" rel=\"nofollow noreferrer\">play.golang.org/p/VUPD4Nv-If</a> ,"}, {"owner": {"reputation": 1419, "user_id": 2137931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3d3ef09dfac1974cde73014c4e07e3f?s=128&d=identicon&r=PG", "display_name": "Daniel Wisehart", "link": "https://stackoverflow.com/users/2137931/daniel-wisehart"}, "edited": false, "score": 0, "creation_date": 1472650859, "post_id": 39250007, "comment_id": 65838198, "body": "Make function Move return a bool, not an int."}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "reply_to_user": {"reputation": 1419, "user_id": 2137931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3d3ef09dfac1974cde73014c4e07e3f?s=128&d=identicon&r=PG", "display_name": "Daniel Wisehart", "link": "https://stackoverflow.com/users/2137931/daniel-wisehart"}, "edited": false, "score": 0, "creation_date": 1472653354, "post_id": 39250007, "comment_id": 65840076, "body": "Im getting this,Index out of range error @Daniel Wisehart"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472653900, "post_id": 39250007, "comment_id": 65840499, "body": "@Manu: check the index values you&#39;re using. That&#39;s a separate problem entirely."}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472654629, "post_id": 39250007, "comment_id": 65841092, "body": "@JimB I didnt understand, what you meant."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472662912, "post_id": 39250007, "comment_id": 65846151, "body": "@Manu: what part don&#39;t you understand? Do you understand what the &quot;index out of range&quot; panic means? <a href=\"https://play.golang.org/p/mdoie-efG4\" rel=\"nofollow noreferrer\">play.golang.org/p/mdoie-efG4</a>? Check the values you&#39;re using to index your slices or arrays."}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472704385, "post_id": 39250007, "comment_id": 65861062, "body": "I understood from your example what index out of range is but I cant understand Why am I getting this error in my code,<a href=\"https://play.golang.org/p/lqAYUCKYq_\" rel=\"nofollow noreferrer\">play.golang.org/p/lqAYUCKYq_</a>  @JimB"}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "edited": false, "score": 0, "creation_date": 1472651787, "post_id": 39250790, "comment_id": 65838953, "body": "Im getting a index out of range error.<a href=\"https://play.golang.org/p/0CwZEFZ3xV\" rel=\"nofollow noreferrer\">play.golang.org/p/0CwZEFZ3xV</a>  @jussius"}], "tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": true, "score": 0, "last_activity_date": 1472649602, "creation_date": 1472649602, "answer_id": 39250790, "question_id": 39250007, "link": "https://stackoverflow.com/questions/39250007/how-to-do-a-logical-operation-between-a-boolean-variable-and-function-with-integ/39250790#39250790", "title": "How to do a Logical operation between a boolean variable and Function with integers as arguments in Golang", "body": "<p>Assuming you want to evaluate 0 as false and any other number as true you could do: </p>\n\n<pre><code>possiblemove = possiblemove || Move( x+2, y+1, m+1) != 0\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 885, "favorite_count": 0, "accepted_answer_id": 39250790, "answer_count": 1, "score": -2, "last_activity_date": 1472649602, "creation_date": 1472647371, "question_id": 39250007, "link": "https://stackoverflow.com/questions/39250007/how-to-do-a-logical-operation-between-a-boolean-variable-and-function-with-integ", "title": "How to do a Logical operation between a boolean variable and Function with integers as arguments in Golang", "body": "<p>I want to how to do the logical operation \"OR\" between a Boolean variable and Function call</p>\n\n<pre><code>func Move(x int, y int, m int) int{\n\nif IsvisitedNode(x,y){\nvar  possiblemove bool\n possiblemove = possiblemove || Move( x+2, y+1, m+1)\n possiblemove = possiblemove || Move( x+2, y-1, m+1)\n possiblemove = possiblemove || Move( x-2, y+1, m+1)\n possiblemove = possiblemove || Move( x-2, y-1, m+1)\n possiblemove = possiblemove || Move( x+1, y+2, m+1)\n possiblemove = possiblemove || Move( x+1, y-2, m+1)\n possiblemove = possiblemove || Move( x-1, y+2, m+1)\n possiblemove = possiblemove || Move( x-1, y-2, m+1)\n\nif possiblemove == true {\n fmt.Println(x,y)\n\nreturn true\n}else{\n\nvisithistory[p] &amp;&amp; visithistory[q] = false\n        return false\n\n        }\n        }\n        return 1\n        }\n</code></pre>\n\n<p>Can somebody help me out?</p>\n"}, {"tags": ["arrays", "go", "network-programming", "ip", "slice"], "answers": [{"comments": [{"owner": {"reputation": 3905, "user_id": 2837388, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f4ab5f9e97032818b0b580411b0a1d59?s=128&d=identicon&r=PG", "display_name": "hamidfzm", "link": "https://stackoverflow.com/users/2837388/hamidfzm"}, "edited": false, "score": 0, "creation_date": 1472643726, "post_id": 39248378, "comment_id": 65833082, "body": "It&#39;s a good answer but in my case i have a slice of <code>ip</code> which make me to use 2 for loops. I prefer a more linear way."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 2, "last_activity_date": 1473768681, "last_edit_date": 1473768681, "creation_date": 1472642815, "answer_id": 39248378, "question_id": 39248104, "link": "https://stackoverflow.com/questions/39248104/efficient-way-to-check-ip-in-slice-of-ip-addresses-in-golang/39248378#39248378", "title": "Efficient way to check IP in slice of IP addresses in Golang", "body": "<p>You may use <code>func (ip IP) Equal(x IP) bool</code> from <code>net</code> package:  </p>\n\n<blockquote>\n  <p>Equal reports whether ip and x are the same IP address. An IPv4\n  address and that same address in IPv6 form are considered to be equal.</p>\n</blockquote>\n\n<p>Like this working sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    ip := net.ParseIP(\"127.0.0.1\")\n    ips, err := net.LookupIP(\"localhost\")\n    if err != nil {\n        panic(err)\n    }\n    for _, v := range ips {\n        if v.Equal(ip) {\n            fmt.Println(v)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1472651557, "last_edit_date": 1495539952, "creation_date": 1472644707, "answer_id": 39249045, "question_id": 39248104, "link": "https://stackoverflow.com/questions/39248104/efficient-way-to-check-ip-in-slice-of-ip-addresses-in-golang/39249045#39249045", "title": "Efficient way to check IP in slice of IP addresses in Golang", "body": "<h2>With a \"set\"</h2>\n\n<h3>Building our set</h3>\n\n<p>There is no builtin <code>Set</code> type in Go, but you can elegantly use a <code>map[Type]bool</code> as a set, e.g.:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Create a set with 2 values in it: [1, 2]\nm := map[int]bool{1: true, 2: true}\n\n// Test an element:\nfmt.Println(m[1]) // true\nfmt.Println(m[3]) // false\n\n// Set an element:\nm[3] = true\nfmt.Println(m[3]) // true\n\n// Delete an element:\ndelete(m, 1)\nfmt.Println(m[1]) // false\n</code></pre>\n\n<p>Note: we exploited the fact that if a key is not in the map, indexing the map results in the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> for the value type, which is <code>false</code> in case of <code>bool</code>, properly telling that the element is not in the map (set).</p>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/KN8W4192v_\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><sup><strong>Note #2</strong>: there are a few tricks to make the code to handle a map as a set shorter, you can check them in this answer: <a href=\"https://stackoverflow.com/a/30452518/1705598\">Check if a value is in a list</a>.</sup></p>\n\n<h3>Using <code>net.IP</code> in the set</h3>\n\n<p>Now we only need a type representing a <a href=\"https://golang.org/pkg/net/#IP\" rel=\"nofollow noreferrer\"><code>net.IP</code></a> which can be used as the key type in a map (see this question about what constitutes a map key type: <a href=\"https://stackoverflow.com/questions/37916647/how-can-i-prevent-a-type-being-used-as-a-map-key\">How can I prevent a type being used as a map key?</a>).</p>\n\n<p>Unfortunately <code>net.IP</code> itself does not qualify, because it is a slice:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type IP []byte\n</code></pre>\n\n<p>And slices are not comparable. See this question for details: <a href=\"https://stackoverflow.com/questions/29175247/hash-with-key-as-an-array-type\">Hash with key as an array type</a> and this: <a href=\"https://stackoverflow.com/questions/38645175/why-have-arrays-in-go\">Why have arrays in Go?</a></p>\n\n<p>An easy way is to convert it to a canonical <code>string</code> value and we're done. For this we may simply convert the bytes of the IP to a hex <code>string</code>. But an IPv4 address may be presented as IPv6, so we should first convert it to IPv6:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Key(ip net.IP) string {\n    return hex.EncodeToString(ip.To16())\n}\n</code></pre>\n\n<p>Note: bytes of an IP address may not be a valid UTF-8 encoded <code>string</code> (which is how Go stores <code>string</code>s in memory), but <code>string</code> values in Go represent arbitrary byte sequences, so the following also works, is much simpler and is much more efficient:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Key(ip net.IP) string {\n    return string(ip.To16())  // Simple []byte =&gt; string conversion\n}\n</code></pre>\n\n<p>We can use such IP strings as the keys. Populate your map with IPs to check against:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Populate forbidden IPs:\nforbIPs := map[string]bool{\n    Key(ip1): true,\n    Key(ip2): true,\n}\n\n// Now check a single IP:\nipToCheck := ...\nif forbIPs[Key(ipToCheck)] {\n    fmt.Println(\"Forbidden!\")\n} else {\n    fmt.Println(\"Allowed.\")\n}\n</code></pre>\n\n<p>If you have multiple IPs to check (as returned by <a href=\"https://golang.org/pkg/net/#LookupIP\" rel=\"nofollow noreferrer\"><code>net.LookupIP()</code></a>), it's a single <code>for</code> loop:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ips, err := net.LookupIP(host)\n// Check err\nfor _, ip := range ips {\n    if forbIPs[Key(ip)] {\n        // FORBIDDEN!\n    }\n}\n</code></pre>\n\n<h3>Alternative Key type</h3>\n\n<p>Note that \u2013as mentioned above\u2013 slices are not comparable but arrays are. So we could also use an array as the key. This is how it could look like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Key(ip net.IP) (a [16]byte) {\n    copy(a[:], ip)\n    return\n}\n\n// And the IP set:\nforbIPs := map[[16]byte]bool{\n    // ...\n}\n</code></pre>\n\n<h2>Alternatives</h2>\n\n<h3>Sorted slice</h3>\n\n<p>Alternatively we could just simply store the forbidden IPs in a slice <code>[]net.IP</code>, and <em>keep it sorted</em>. If it is sorted, we can use binary search to find an IP in it (standard library <a href=\"https://golang.org/pkg/sort/#Search\" rel=\"nofollow noreferrer\"><code>sort.Search()</code></a>).</p>\n\n<p>Yes, binary search has <code>O(log2(n))</code> complexity compared to the <code>O(1)</code> complexity of the (hash)map solution above. But this alternative has another pro:</p>\n\n<p>Enumerating individual IPs is not always practical. Sometimes (often) it is easier to list IP ranges. The first solution is not feasible to handle IP ranges, but this solution may be: you can find ranges that cover an IP address also in <code>O(log2(n))</code> time.</p>\n"}], "owner": {"reputation": 3905, "user_id": 2837388, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f4ab5f9e97032818b0b580411b0a1d59?s=128&d=identicon&r=PG", "display_name": "hamidfzm", "link": "https://stackoverflow.com/users/2837388/hamidfzm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2823, "favorite_count": 0, "accepted_answer_id": 39249045, "answer_count": 2, "score": 1, "last_activity_date": 1473768681, "creation_date": 1472642030, "last_edit_date": 1472651820, "question_id": 39248104, "link": "https://stackoverflow.com/questions/39248104/efficient-way-to-check-ip-in-slice-of-ip-addresses-in-golang", "title": "Efficient way to check IP in slice of IP addresses in Golang", "body": "<p>I'm developing a network application in Golang. I have a slice of IP addresses. Each time a request comes I use <code>net.LookupIP(host)</code> to find out IP address of host which returns a slice of <code>net.IP</code>. What is the best approach to compare these?</p>\n\n<p>By the way in Python we have a <code>set</code> data structure which makes above question so easy to resolve but what about Go?</p>\n"}, {"tags": ["multithreading", "go", "docker", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1472637924, "post_id": 39245660, "comment_id": 65829009, "body": "I think the answer is: None. Because e.g. the GC does not run on a thread but on a goroutine. There will be 10 non-blocked threads at most, and all goroutines are scheduled on these 10 (non-blocked) threads. Your user-code goroutines as well as e.g. goroutines created by the garbage collector."}], "answers": [{"comments": [{"owner": {"reputation": 5026, "user_id": 815742, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c155243169db74a7787bab9d57a1c3d6?s=128&d=identicon&r=PG", "display_name": "fumoboy007", "link": "https://stackoverflow.com/users/815742/fumoboy007"}, "edited": false, "score": 0, "creation_date": 1472668236, "post_id": 39246575, "comment_id": 65849080, "body": "Thanks for your answer! I made an edit to my question."}, {"owner": {"reputation": 373, "user_id": 7120232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6158ba64c300f1c9822ff5a08c2dbfae?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Arya", "link": "https://stackoverflow.com/users/7120232/abhishek-arya"}, "edited": false, "score": 0, "creation_date": 1606142473, "post_id": 39246575, "comment_id": 114863737, "body": "<code>If your app starts many goroutines where many (&gt;10) are blocked in system calls, more than 10 OS threads will be spawned (but only at most 10 will be executing user-level Go code).</code>  Does it mean if my code is performing lots of IOs(say 1000s), I may have 1000s of threads? In this scenario, can my code suffer from problems like outOfMemory where no more threads can be spawned as we have in other languages?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 373, "user_id": 7120232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6158ba64c300f1c9822ff5a08c2dbfae?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Arya", "link": "https://stackoverflow.com/users/7120232/abhishek-arya"}, "edited": false, "score": 1, "creation_date": 1606142846, "post_id": 39246575, "comment_id": 114863955, "body": "@AbhishekArya Yes, but performing thousands of concurrent IO operation is a bad design. Use a worker pool to efficiently perform concurrent operations."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1472734050, "last_edit_date": 1495542302, "creation_date": 1472637796, "answer_id": 39246575, "question_id": 39245660, "link": "https://stackoverflow.com/questions/39245660/number-of-threads-used-by-go-runtime/39246575#39246575", "title": "Number of threads used by Go runtime", "body": "<p>There is no direct correlation. Threads used by your app may be less than, equal to or more than 10.</p>\n\n<p>Quoting from the package doc of <a href=\"https://golang.org/pkg/runtime/\" rel=\"noreferrer\"><code>runtime</code></a>:</p>\n\n<blockquote>\n  <p><strong>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously.</strong> There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit. This package's GOMAXPROCS function queries and changes the limit.</p>\n</blockquote>\n\n<p>So if your application does not start any new goroutines, threads count will be less than 10.</p>\n\n<p>If your app starts many goroutines (>10) where none is blocking (e.g. in system calls), 10 operating system threads will execute your goroutines simultaneously.</p>\n\n<p>If your app starts many goroutines where many (>10) are blocked in system calls, more than 10 OS threads will be spawned (but only at most 10 will be executing user-level Go code).</p>\n\n<p>See this question for an example and details: <a href=\"https://stackoverflow.com/questions/28186361/why-does-it-not-create-many-threads-when-many-goroutines-are-blocked-in-writing\">Why does it not create many threads when many goroutines are blocked in writing file in golang?</a></p>\n\n<p><strong>Edit (in response to your edit):</strong></p>\n\n<p>I believe the default value of <code>GOMAXPROCS</code> is the number of logical CPUs for a reason: because in general that provides the highest performance. You may leave it at that. In general if you only have 1 goroutine and you're sure your code doesn't spawn more, <code>GOMAXPROCS=1</code> is sufficient, but you should test and don't take any word for it.</p>\n"}], "owner": {"reputation": 5026, "user_id": 815742, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c155243169db74a7787bab9d57a1c3d6?s=128&d=identicon&r=PG", "display_name": "fumoboy007", "link": "https://stackoverflow.com/users/815742/fumoboy007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14979, "favorite_count": 5, "accepted_answer_id": 39246575, "answer_count": 1, "score": 14, "last_activity_date": 1614119159, "creation_date": 1472635479, "last_edit_date": 1614119159, "question_id": 39245660, "link": "https://stackoverflow.com/questions/39245660/number-of-threads-used-by-go-runtime", "title": "Number of threads used by Go runtime", "body": "<p>How many threads can the Go runtime (scheduler, garbage collector, etc.) use? For example, if <code>GOMAXPROCS</code> is <code>10</code>, how many of those kernel threads would be used by the runtime?</p>\n<h3>Edit:</h3>\n<p>I was reading <a href=\"https://docs.google.com/document/d/1At2Ls5_fhJQ59kDK2DFVhFu3g5mATSXqqV5QrxinasI/\" rel=\"nofollow noreferrer\">the rationale</a> for changing <code>GOMAXPROCS</code> to <code>runtime.NumCPU()</code> in Go 1.5. There was a sentence that claimed that \u201cthe performance of single-goroutine programs can improve by raising <code>GOMAXPROCS</code> due to parallelism of the runtime, especially the garbage collector.\u201d</p>\n<p>My real question is: If I have a single-goroutine program running in a Docker container that has a CPU quota, what is the minimum number of logical processors that I need in order to have maximum performance?</p>\n"}, {"tags": ["string", "parsing", "go", "unicode", "rune"], "comments": [{"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 1, "creation_date": 1472640021, "post_id": 39245610, "comment_id": 65830529, "body": "Any reason that force you to use scanner? I mean you trying to figure out how &quot;text/scanner&quot; work or you just simple want to convert rune to string?"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594339254, "post_id": 39245610, "comment_id": 111099409, "body": "<code>string(r)</code> to set a rune to a string. See <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>. <code>[]rune(&quot;abc&quot;) </code> to set a string to a rune. See <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 40, "last_activity_date": 1472639025, "last_edit_date": 1472639025, "creation_date": 1472635870, "answer_id": 39245813, "question_id": 39245610, "link": "https://stackoverflow.com/questions/39245610/golang-converting-from-rune-to-string/39245813#39245813", "title": "Golang converting from rune to string", "body": "<p>That's because you used <a href=\"https://golang.org/pkg/text/scanner/#Scanner.Scan\" rel=\"noreferrer\"><code>Scanner.Scan()</code></a> to read a <code>rune</code> but it does something else. <code>Scanner.Scan()</code> can be used to read <em>tokens</em> or <code>rune</code>s of special tokens controlled by the <code>Scanner.Mode</code> bitmask, and it returns special constants form the <a href=\"https://golang.org/pkg/text/scanner/\" rel=\"noreferrer\"><code>text/scanner</code></a> package, not the read rune itself.</p>\n\n<p>To read a single <code>rune</code> use <a href=\"https://golang.org/pkg/text/scanner/#Scanner.Next\" rel=\"noreferrer\"><code>Scanner.Next()</code></a> instead:</p>\n\n<pre><code>c := b.Next()\nfmt.Println(c, string(c), strconv.QuoteRune(c))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>97 a 'a'\n</code></pre>\n\n<p>If you just want to convert a single <code>rune</code> to <code>string</code>, use a simple type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">conversion</a>. <code>rune</code> is alias for <code>int32</code>, and converting integer numbers to <code>string</code>:</p>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer.</p>\n</blockquote>\n\n<p>So:</p>\n\n<pre><code>r := rune('a')\nfmt.Println(r, string(r))\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>97 a\n</code></pre>\n\n<p>Also to loop over the runes of a <code>string</code> value, you can simply use the <code>for ... range</code> construct:</p>\n\n<pre><code>for i, r := range \"abc\" {\n    fmt.Printf(\"%d - %c (%v)\\n\", i, r, r)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0 - a (97)\n1 - b (98)\n2 - c (99)\n</code></pre>\n\n<p>Or you can simply convert a <code>string</code> value to <code>[]rune</code>:</p>\n\n<pre><code>fmt.Println([]rune(\"abc\")) // Output: [97 98 99]\n</code></pre>\n\n<p>There is also <a href=\"https://golang.org/pkg/unicode/utf8/#DecodeRuneInString\" rel=\"noreferrer\"><code>utf8.DecodeRuneInString()</code></a>.</p>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/y6_yDVtoQJ\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Note:</strong></p>\n\n<p>Your original code (using <code>Scanner.Scan()</code>) works like this:</p>\n\n<ol>\n<li>You called <a href=\"https://golang.org/pkg/text/scanner/#Scanner.Init\" rel=\"noreferrer\"><code>Scanner.Init()</code></a> which sets the Mode (<code>b.Mode</code>) to <code>scanner.GoTokens</code>.</li>\n<li><p>Calling <code>Scanner.Scan()</code> on the input (from <code>\"a\"</code>) returns <code>scanner.Ident</code> because <code>\"a\"</code> is a valid Go identifier:</p>\n\n<pre><code>c := b.Scan()\nif c == scanner.Ident {\n    fmt.Println(\"Identifier:\", b.TokenText())\n}\n\n// Output: \"Identifier: a\"\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 16, "creation_date": 1507796723, "post_id": 46021588, "comment_id": 80356368, "body": "<code>[]rune</code> to <code>string</code> conversion is supported natively by the spec, this is completely unnecessary and slow. Instead use a simple conversion: <code>outString := string(runes)</code>"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1594111855, "post_id": 46021588, "comment_id": 111004287, "body": "@icza enlightening comment. I quoted you here <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>."}], "tags": [], "owner": {"reputation": 430, "user_id": 1010873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4a13b3f54c622f4e7577eccf245f2578?s=128&d=identicon&r=PG", "display_name": "MarkJL", "link": "https://stackoverflow.com/users/1010873/markjl"}, "is_accepted": false, "score": 3, "last_activity_date": 1504427214, "creation_date": 1504427214, "answer_id": 46021588, "question_id": 39245610, "link": "https://stackoverflow.com/questions/39245610/golang-converting-from-rune-to-string/46021588#46021588", "title": "Golang converting from rune to string", "body": "<p>I know I'm a bit late to the party but here's a []rune to string function:</p>\n\n<pre><code>func runesToString(runes []rune) (outString string) {\n    // don't need index so _\n    for _, v := range runes {\n        outString += string(v)\n    }\n    return\n}\n</code></pre>\n\n<p>yes, there is a named return but I think it's ok in this case as it reduces the number of lines and the function is only short</p>\n"}, {"tags": [], "owner": {"reputation": 3280, "user_id": 429476, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/V3SVL.jpg?s=128&g=1", "display_name": "Alex Punnen", "link": "https://stackoverflow.com/users/429476/alex-punnen"}, "is_accepted": false, "score": 1, "last_activity_date": 1615136578, "last_edit_date": 1615136578, "creation_date": 1615129107, "answer_id": 66517852, "question_id": 39245610, "link": "https://stackoverflow.com/questions/39245610/golang-converting-from-rune-to-string/66517852#66517852", "title": "Golang converting from rune to string", "body": "<p>Since I came to this question searching for rune and string and char, thought this may help newbies like me</p>\n<pre><code>// str := &quot;a\u0d10bc&quot;\n// testString(str)\nfunc testString(oneString string){\n\n    //string to byte slice - No sweat -just type cast it\n    // As string  IS A byte slice\n    var twoByteArr []byte = []byte(oneString)\n\n    // string to rune Slices - No sweat \n    // string IS A slice of runes \n    var threeRuneSlice []rune = []rune(oneString)\n\n   // Hmm! String seems to have a dual personality it is both a slice of bytes and\n   // a slice of runes - yeah - read on\n    \n    // A rune slice can be convered to string -\n    // No sweat - as string == rune slice\n    var thrirdString string = string(threeRuneSlice)\n    \n    // There is a catch here and that is in printing &quot;characters&quot;, using for loop and range \n    \n    fmt.Println(&quot;Chars in oneString&quot;)\n    for i,r := range oneString {\n        fmt.Printf(&quot; %d  %v  %c &quot;,i,r,r) //you may not get index 0,1,2,3 here  \n        // since the range runs specially over strings  https://blog.golang.org/strings\n    }\n    \n    fmt.Println(&quot;\\nChars in threeRuneSlice&quot;)\n    for i,r := range threeRuneSlice {\n        fmt.Printf(&quot; %d  %v  %c &quot;,i,r,r) // i = 0,1,2,4 , perfect!!\n        // as runes are made up of 4 bytes (rune is int32 and byte in unint8\n        // and a set of bytes is used to represent a rune which is used to \n       // represent  UTF characters == the REAL CHARECTER \n    }\n\n    fmt.Println(&quot;\\nValues in oneString &quot;)\n    for j := 0; j &lt; len(oneString); j++ {\n        fmt.Printf(&quot; %d %v &quot;,j,oneString[j]) // No you cannot get charecters if you iterate through string in this way\n        // as you are going over bytes here - not runes\n    }\n    fmt.Println(&quot;\\nValues in twoByteArr&quot;)\n    for j := 0; j &lt; len(twoByteArr); j++ {\n        fmt.Printf(&quot; %d=%v &quot;,j,twoByteArr[j]) // == same as above\n    }\n    \n    fmt.Printf(&quot;\\none - %s, two %s, three %s\\n&quot;,oneString,twoByteArr,thrirdString)\n}\n</code></pre>\n<p>And some more pointless demo <a href=\"https://play.golang.org/p/tagRBVG8k7V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tagRBVG8k7V</a>\nadapted from <a href=\"https://groups.google.com/g/golang-nuts/c/84GCvDBhpbg/m/Tt6089MPFQAJ\" rel=\"nofollow noreferrer\">https://groups.google.com/g/golang-nuts/c/84GCvDBhpbg/m/Tt6089MPFQAJ</a></p>\n<p>to show that the 'characters' are encoded with one to up to 4 bytes depending on the unicode code point</p>\n"}], "owner": {"reputation": 553, "user_id": 3551708, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/077ec64fb39a80e6bf84872bcc9f096e?s=128&d=identicon&r=PG&f=1", "display_name": "user3551708", "link": "https://stackoverflow.com/users/3551708/user3551708"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61097, "favorite_count": 8, "accepted_answer_id": 39245813, "answer_count": 3, "score": 44, "last_activity_date": 1615136578, "creation_date": 1472635326, "last_edit_date": 1475354545, "question_id": 39245610, "link": "https://stackoverflow.com/questions/39245610/golang-converting-from-rune-to-string", "title": "Golang converting from rune to string", "body": "<p>I have the following code, it is supposed to cast a <code>rune</code> into a <code>string</code> and print it. However, I am getting undefined characters when it is printed. I am unable to figure out where the bug is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"text/scanner\"\n)\n\nfunc main() {\n    var b scanner.Scanner\n    const a = `a`\n    b.Init(strings.NewReader(a))\n    c := b.Scan()\n    fmt.Println(strconv.QuoteRune(c))\n}\n</code></pre>\n"}, {"tags": ["go", "benchmarking", "redigo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472637967, "post_id": 39244845, "comment_id": 65829046, "body": "That&#39;s not and error you&#39;re showing, it&#39;s just a part of the stack trace. Please show the error output, or the entire stack trace."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472639369, "post_id": 39244845, "comment_id": 65830062, "body": "@JimB I have updated the question. Also the stack trace is too large. I have added the last lines."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472639691, "post_id": 39244845, "comment_id": 65830301, "body": "Those are just goroutine stacks, and have nothing to do with the error. The cause of the stack trace it printed first, along with the panicking goroutine."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472640095, "post_id": 39244845, "comment_id": 65830578, "body": "I got it now. The error is <code>panic: dial tcp :6379: too many open files</code>. How to solve this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472640535, "post_id": 39244845, "comment_id": 65830897, "body": "Seems self explanatory, you either increase the ulimit to allow more open files, or don&#39;t run so many requests concurrently."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472640651, "post_id": 39244845, "comment_id": 65830975, "body": "Also, that error isn&#39;t fatal to your program, dont panic on regular errors."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472642263, "post_id": 39244845, "comment_id": 65832116, "body": "yes, I should have framed the question correctly!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472656918, "post_id": 39244845, "comment_id": 65842729, "body": "Use <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#hdr-Pipelining\" rel=\"nofollow noreferrer\">pipelines</a> instead of goroutines when optimizing calls to Redis."}], "answers": [{"comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472707144, "post_id": 39250819, "comment_id": 65861785, "body": "ids which I am receiving through post request are about 80-100. Should I still connect to redis serially? I think that will decrease the performance. Also you said about using pipeline, Will you please give an example of how can i use it in my code?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472734655, "post_id": 39250819, "comment_id": 65878826, "body": "@Jagrati: yes, query all the ids over 1 connection, opening 1500 concurrent connections only increases contention on the database and will degrade performance significantly."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1472829500, "last_edit_date": 1472829500, "creation_date": 1472649662, "answer_id": 39250819, "question_id": 39244845, "link": "https://stackoverflow.com/questions/39244845/redigo-getting-errors-on-apache-load-testing/39250819#39250819", "title": "Redigo: getting errors on apache load testing", "body": "<p>To fix the issue immediately, set <code>MaxActive</code> on your <code>redis.Pool</code>, which you mention in the comments but don't set yourself. </p>\n\n<p>Fundamentally though, you should not be dispatching goroutines for every <code>id</code> lookup. Your maximum possible concurrency would then be <code>(number of client connections) x (number of ids in the request)</code>, each of which can open a new redis connection. It would be far faster and more efficient to have a single redis connection read each of the <code>ids</code> serially. There's no need for any of the extra concurrency you have here, do it all serially from the handler, and don't convert the strings to ints when redis only operates on string keys to begin with. </p>\n\n<pre><code>func getReq(w http.ResponseWriter, req *http.Request) {\n    err := req.ParseForm()\n    checkError(err)\n\n    c := pool.Get()\n    defer c.Close()\n\n    for _, id := range req.Form[\"ids[]\"] {\n        m, err := redis.String(c.Do(\"HGET\", \"key\", id))\n        checkError(err)\n        fmt.Println(id)\n    }\n}\n</code></pre>\n\n<p>If you want to optimize this further, you can use <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#hdr-Pipelining\" rel=\"nofollow\">pipelines</a> to reduce the round trips to the redis server.</p>\n\n<pre><code>for _, id := range req.Form[\"ids[]\"] {\n    c.Send(\"HGET\", \"key\", id))\n}\nc.Flush()\nvalues, err := redis.Strings(c.Receive())\ncheckError(err)\n...\n</code></pre>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 39250819, "answer_count": 1, "score": -1, "last_activity_date": 1472829500, "creation_date": 1472633174, "last_edit_date": 1472650126, "question_id": 39244845, "link": "https://stackoverflow.com/questions/39244845/redigo-getting-errors-on-apache-load-testing", "title": "Redigo: getting errors on apache load testing", "body": "<p>I am connecting my <code>go</code> program to <code>redis</code> using library <code>redigo</code>. When i run one request I get correct results. But on load testing, using apache benchmark tool, It works when:</p>\n\n<pre><code>ab -n 1000 -k -c 10 -p post.txt -T application/x-www-form-urlencoded http://localhost:8084/abcd\n</code></pre>\n\n<p>However when request is:</p>\n\n<pre><code>ab -n 1000 -k -c 15 -p post.txt -T application/x-www-form-urlencoded http://localhost:8084/abcd\n</code></pre>\n\n<p>I am getting error: </p>\n\n<pre><code>panic: dial tcp :6379: too many open files\n</code></pre>\n\n<p>This is my code:</p>\n\n<pre><code>func newPool() *redis.Pool {\n    return &amp;redis.Pool{\n        MaxIdle: 80, // max number of connections\n        Dial: func() (redis.Conn, error) {\n            c, err := redis.Dial(\"tcp\", \":6379\")\n            if err != nil {\n                panic(err.Error())\n            }\n            return c, err\n        },\n        // If Wait is true and the pool is at the MaxActive limit, then Get() waits\n        // for a connection to be returned to the pool before returning\n        Wait: true,\n    }\n}\n\nvar pool = newPool()\n\nfunc checkError(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc func1(pool *redis.Pool, id int) string {\n    c := pool.Get()\n    defer c.Close()\n    m, err := redis.String(c.Do(\"HGET\", \"key\", id))\n    checkError(err)\n    return m\n}\n\nfunc func2(pool *redis.Pool, string_ids []string) chan string {\n    c := make(chan string)\n    var ids []int\n    var temp int\n    for _, v := range string_ids {\n        temp, _ = strconv.Atoi(v)\n        ids = append(ids, temp)\n    }\n    go func() {\n        var wg sync.WaitGroup\n        wg.Add(len(ids))\n        for _, v := range ids {\n            go func(id int) {\n                defer wg.Done()\n                c &lt;- func1(pool, id)\n            }(v)\n        }\n        wg.Wait()\n        close(c)\n    }()\n    return c\n}\nfunc getReq(w http.ResponseWriter, req *http.Request) {\n    err := req.ParseForm()\n    checkError(err)\n    ids := req.Form[\"ids[]\"]\n    for v := range func2(pool, ids) {\n        fmt.Println(v)\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/abcd\", getReq)\n\n    log.Fatal(http.ListenAndServe(\":8084\", nil))\n}\n</code></pre>\n\n<p>How to handle atleast 40 concurrent request using apache benchmark tool.</p>\n\n<p><strong>Note</strong>: I haven't changed anything in my redis conf file</p>\n\n<p>I am getting following response when running apache benchmark tool. Only 15 request are completed.</p>\n\n<pre><code>$ ab -n 1000 -k -c 15 -p post.txt -T application/x-www-form-urlencoded http://localhost:8084/abcd\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1528965 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking localhost (be patient)\napr_socket_recv: Connection refused (111)\nTotal of 15 requests completed\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1472633224, "last_edit_date": 1495540896, "creation_date": 1472627802, "answer_id": 39243090, "question_id": 39242970, "link": "https://stackoverflow.com/questions/39242970/how-do-you-share-your-gopath-via-dropbox-or-similar-across-multiple-platforms/39243090#39243090", "title": "How do you share your GOPATH via Dropbox (or similar) across multiple platforms", "body": "<p>1- set <code>GOBIN</code> to separate path (just e.g. for <code>OS X</code>) and use</p>\n\n<p><code>go install</code></p>\n\n<p><a href=\"https://golang.org/cmd/go/\" rel=\"nofollow noreferrer\">Command go</a> :</p>\n\n<blockquote>\n  <p>If the GOBIN environment variable is set, commands are installed to the\n  directory it names instead of DIR/bin. GOBIN must be an absolute path.</p>\n</blockquote>\n\n<hr>\n\n<p>2- Also you may rename the output file:</p>\n\n<pre><code>go build [-o output] [-i] [build flags] [packages]\n</code></pre>\n\n<p>Like this:</p>\n\n<pre><code>go build -o newname\n</code></pre>\n\n<blockquote>\n  <p>The -o flag, only allowed when compiling a single package, forces\n  build to write the resulting executable or object to the named output\n  file.</p>\n</blockquote>\n\n<hr>\n\n<p>Also see: <a href=\"https://stackoverflow.com/questions/38679294/how-do-i-use-a-samba-server-location-for-gopath\">How do I use a Samba server location for GOPATH?</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1472638802, "last_edit_date": 1472638802, "creation_date": 1472629293, "answer_id": 39243543, "question_id": 39242970, "link": "https://stackoverflow.com/questions/39242970/how-do-you-share-your-gopath-via-dropbox-or-similar-across-multiple-platforms/39243543#39243543", "title": "How do you share your GOPATH via Dropbox (or similar) across multiple platforms", "body": "<p>The solution is simple: only share the <code>$GOPATH/src</code> folder across your computers, there is really no need to share the complete <code>$GOPATH</code> as package objects (<code>$GOPATH/pkg</code>) and binaries (<code>$GOPATH/bin</code>) compiled to one platform have no real use on other platforms, and they are reproducible by a simple compilation.</p>\n\n<p>This will also reduce the storage and bandwidth. If for some reason you would still need the compiled binaries for other platforms, the <code>go</code> tool has built-in support for cross compilation, e.g. <code>GOOS=windows go build</code> will simply produce you the Windows executable binary of the package whose folder you're in in any OS, placed in the current folder (you can also change the architecture with <code>GOARCH</code>).</p>\n\n<p>Another option would be to put your code under a source control e.g. <a href=\"https://git-scm.com/\" rel=\"nofollow\">git</a> (<a href=\"https://github.com/\" rel=\"nofollow\">github.com</a>), which also preserves history. The <code>go</code> tool also has support to easily get the source code from a git repository, e.g. <code>go get -u github.com/youruser/yourpackage</code>.</p>\n"}], "owner": {"reputation": 846, "user_id": 973721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d078a247b132e0de7bda5e2bff17346d?s=128&d=identicon&r=PG", "display_name": "tophatsteve", "link": "https://stackoverflow.com/users/973721/tophatsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 39243090, "answer_count": 2, "score": 2, "last_activity_date": 1472638802, "creation_date": 1472627449, "last_edit_date": 1472630453, "question_id": 39242970, "link": "https://stackoverflow.com/questions/39242970/how-do-you-share-your-gopath-via-dropbox-or-similar-across-multiple-platforms", "title": "How do you share your GOPATH via Dropbox (or similar) across multiple platforms", "body": "<p>I develop across 3 different platforms, Windows, OS X and Ubuntu Linux.<br>\nI use Dropbox to synchronize my code between all 3 platforms.<br>\nThe problem I have is compiled binaries on OS X and Linux get the same name, so binaries in my <code>GOPATH</code> are always overwriting each other. I don't have this problem with Windows because binaries always compile with a <code>.exe</code> extension.</p>\n\n<p>Has anyone else experienced this problem, and if so, how did you get around it?</p>\n"}, {"tags": ["http", "go", "encoding"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472625640, "post_id": 39241563, "comment_id": 65821227, "body": "Perhaps <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/VudK_05B62k/1tWuGCw1FgAJ;context-place=forum/golang-nuts\" rel=\"nofollow noreferrer\">this</a> is relevant."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1472630577, "post_id": 39241563, "comment_id": 65824080, "body": "Or set your terminal to iso-8859-1 :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1438, "user_id": 3628276, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46f9ea9666fc2139f4178b8eadf0a64?s=128&d=identicon&r=PG&f=1", "display_name": "zarathustra", "link": "https://stackoverflow.com/users/3628276/zarathustra"}, "edited": false, "score": 0, "creation_date": 1472675326, "post_id": 39243925, "comment_id": 65852939, "body": "Works like a charm! Thanks for the detailed code snippet!"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 2, "last_activity_date": 1472630461, "creation_date": 1472630461, "answer_id": 39243925, "question_id": 39241563, "link": "https://stackoverflow.com/questions/39241563/umlauts-in-iso-8859-1-encoded-website/39243925#39243925", "title": "Umlauts in ISO-8859-1 encoded website", "body": "<p>You can use the package <a href=\"https://godoc.org/golang.org/x/net/html/charset\" rel=\"nofollow\">golang.org/x/net/html/charset</a> to determine the encoding of the website, and also create a reader that converts the content to UTF-8.</p>\n\n<p>Below is a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"net/http\"\n    \"os\"\n\n    \"golang.org/x/net/html/charset\"\n)\n\nfunc main() {\n    resp, err := http.Get(\"http://example.com\")\n    if err != nil {\n        os.Exit(1)\n    }\n\n    r, err := charset.NewReader(resp.Body, resp.Header.Get(\"Content-Type\"))\n    if err != nil {\n        os.Exit(1)\n    }\n\n    io.Copy(os.Stdout, r)\n}\n</code></pre>\n"}], "owner": {"reputation": 1438, "user_id": 3628276, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46f9ea9666fc2139f4178b8eadf0a64?s=128&d=identicon&r=PG&f=1", "display_name": "zarathustra", "link": "https://stackoverflow.com/users/3628276/zarathustra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 39243925, "answer_count": 1, "score": 0, "last_activity_date": 1472630461, "creation_date": 1472622159, "question_id": 39241563, "link": "https://stackoverflow.com/questions/39241563/umlauts-in-iso-8859-1-encoded-website", "title": "Umlauts in ISO-8859-1 encoded website", "body": "<p>My very simple code snippet:</p>\n\n<pre><code>import \"net/http\"\nimport \"io\"\nimport \"os\"\n\nfunc main() {\n  resp, err := http.Get(\"http://example.com\")\n  if err == nil {\n    io.Copy(os.Stdout, resp.Body)\n  }\n}\n</code></pre>\n\n<p>When <code>example.com</code> is <code>charset=iso-8859-1</code> encoded my output is faulty. Umlauts for example are not displayed correctly: </p>\n\n<p><code>H\u00e4llo W\u00f6rld  --&gt; H?llo W?rld</code></p>\n\n<p>Whats a good solution to display umlauts correctly??</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1473013040, "post_id": 39241365, "comment_id": 65972149, "body": "Can you post the error?"}], "owner": {"reputation": 81, "user_id": 5331377, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9768fa41831188c90ac59f2dc44ec549?s=128&d=identicon&r=PG&f=1", "display_name": "TheDeadMays", "link": "https://stackoverflow.com/users/5331377/thedeadmays"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472655118, "creation_date": 1472621047, "last_edit_date": 1472655118, "question_id": 39241365, "link": "https://stackoverflow.com/questions/39241365/how-to-map-database-in-http-handler", "title": "How to map database in http handler?", "body": "<p>I have a problem with mapping DB to HTTP Handler. So in Martini framework you can do like this:</p>\n\n<pre><code>// main.go\npackage main\n\nfunc main() {\n    db, err := gorm.Open(\"mysql\", \"&lt;user&gt;:&lt;pass&gt;@/mvc_demo\")  \n    m := martini.Classic()\n    m.Map(&amp;db)\n    m.Run(\":3000\")\n}\n\n// controllers/index.go\npackage controllers\n\nfunc IndexGET(w http.ResponseWriter, r *http.Request, *gorm.DB) { ... }\n</code></pre>\n\n<p>How to do the same with HttpRouter package, because when i parse the variable *gorm.DB, I get an error.</p>\n"}, {"tags": ["go", "websocket", "redis", "publish-subscribe"], "answers": [{"tags": [], "owner": {"reputation": 7750, "user_id": 2244411, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Y4bul.jpg?s=128&g=1", "display_name": "Dibish", "link": "https://stackoverflow.com/users/2244411/dibish"}, "is_accepted": false, "score": 0, "last_activity_date": 1473512153, "creation_date": 1473512153, "answer_id": 39426281, "question_id": 39241077, "link": "https://stackoverflow.com/questions/39241077/go-lang-redis-pubsub-in-different-go-routes-for-publish-and-subscribe/39426281#39426281", "title": "Go lang Redis PubSub in different go routes for publish and subscribe", "body": "<p>Done following way, I dont know is it the proper way to do this </p>\n\n<pre><code>http.HandleFunc(\"/publish\", publishHandler)\n\n\nfunc publishHandler(conn http.ResponseWriter, req *http.Request) {\n     log.Println(\"PUBLISH HANDLER\")\n     wsHandler := websocket.Handler(func(ws *websocket.Conn) {\n            handleWSConnection(ws)\n        })\n     wsHandler.ServeHTTP(conn, req)\n}\n</code></pre>\n"}], "owner": {"reputation": 7750, "user_id": 2244411, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Y4bul.jpg?s=128&g=1", "display_name": "Dibish", "link": "https://stackoverflow.com/users/2244411/dibish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1101, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473512153, "creation_date": 1472619604, "last_edit_date": 1472619988, "question_id": 39241077, "link": "https://stackoverflow.com/questions/39241077/go-lang-redis-pubsub-in-different-go-routes-for-publish-and-subscribe", "title": "Go lang Redis PubSub in different go routes for publish and subscribe", "body": "<p>Am new to go programming language, and I have a requirement to create Redis PubSub with websocket.</p>\n\n<p><strong>My reference code is here</strong> \n<a href=\"https://github.com/vortec/orchestrate\" rel=\"nofollow\">https://github.com/vortec/orchestrate</a></p>\n\n<p><strong>Am using following libraries</strong></p>\n\n<p>\"golang.org/x/net/websocket\"</p>\n\n<p>\"github.com/garyburd/redigo/redis\"</p>\n\n<p>Everything is working for me like this way, but I don't understand what is \"websocket.Handler(handleWSConnection)\" here. \nI need 2 different go routes for /ws-subscribe and /ws-publish. I don't know anything wrong in this concept? </p>\n\n<p><strong>Doubts</strong> </p>\n\n<ol>\n<li><p>Can I do this way, http.HandleFunc(\"/ws\", handleWSConnection) // Tried this way but am getting \"not enough arguments in call to handleWSConnection\"\nIs there any way to call \"handleWSConnection()\" as a normal function. </p></li>\n<li><p>Any suggestions how to write /ws-publish as a different go route  </p></li>\n</ol>\n\n<p><strong>Following is my code</strong></p>\n\n<pre><code>main function \nfunc (wsc *WSConnection) ReadWebSocket() {\n    for {\n        var json_data []byte\n        var message WSMessage\n\n        // Receive data from WebSocket\n        err := websocket.Message.Receive(wsc.socket, &amp;json_data)\n        if err != nil {\n            return\n        }\n\n        // Parse JSON data\n        err = json.Unmarshal(json_data, &amp;message)\n        if err != nil {\n            return\n        }\n        switch message.Action {\n        case \"SUBSCRIBE\":\n            wsc.subscribe.Subscribe(message.Channel)\n        case \"UNSUBSCRIBE\":\n            wsc.subscribe.Unsubscribe(message.Channel)\n        case \"PUBLISH\":\n            wsc.publish.Conn.Do(\"PUBLISH\", message.Channel, message.Data)\n        }\n    }\n}\nfunc handleWSConnection(socket *websocket.Conn) {\n    wsc := &amp;WSConnection {socket: socket}\n    defer wsc.Uninitialize()\n    wsc.Initialize()\n    go wsc.ProxyRedisSubscribe()\n    wsc.ReadWebSocket()\n}\nfunc serveWeb() {\n    http.Handle(\"/ws\", websocket.Handler(handleWSConnection)) // I need to call this route as funciton \n    if err := http.ListenAndServe(\":9000\", nil); err != nil {\n        log.Fatal(\"ListenAndServe:\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 6211801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ODZ83.jpg?s=128&g=1", "display_name": "fishu", "link": "https://stackoverflow.com/users/6211801/fishu"}, "edited": false, "score": 0, "creation_date": 1472612808, "post_id": 39240034, "comment_id": 65817089, "body": "And the reason I do it is because I need  a global variable <code>v</code>, then I can do this like <code>v.name v.token</code>@Mellow Marmot"}, {"owner": {"reputation": 147, "user_id": 6211801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ODZ83.jpg?s=128&g=1", "display_name": "fishu", "link": "https://stackoverflow.com/users/6211801/fishu"}, "edited": false, "score": 0, "creation_date": 1472612886, "post_id": 39240034, "comment_id": 65817108, "body": "account.CreateAccountRequest  {name string, token string, passwd string } and account.PostAccountRequest {name string, token string}, They have two same field"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 147, "user_id": 6211801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ODZ83.jpg?s=128&g=1", "display_name": "fishu", "link": "https://stackoverflow.com/users/6211801/fishu"}, "edited": false, "score": 0, "creation_date": 1472614838, "post_id": 39240034, "comment_id": 65817530, "body": "Although two of fields are identical, not all fields are identical. They are different types."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1472614935, "last_edit_date": 1472614935, "creation_date": 1472612043, "answer_id": 39240034, "question_id": 39239977, "link": "https://stackoverflow.com/questions/39239977/why-do-i-get-a-cannot-assign-error-when-do-assertion/39240034#39240034", "title": "Why do I get a \u201ccannot assign\u201d error when do assertion?", "body": "<p>The snippet of code defines one variable <code>v</code> with type <code>*account.CreateAccountRequest</code>.   The second type assertion attempts to assign a <code>*account.PostAccountRequest</code> to the variable <code>v</code>.  This is an error.</p>\n\n<p>The code will compile if you create a second variable <code>v</code>:</p>\n\n<pre><code>v, ok := req.(*account.CreateAccountRequest)                                                         \nif ok {\n    if v, ok := req.(*account.PostAccountRequest); ok { // note \":\"\n      panic(ok)\n  }\n}\n</code></pre>\n\n<p>... but does not make sense because <code>v</code> can only be one of the struct types.</p>\n\n<p>Perhaps you are looking for something like this:</p>\n\n<pre><code>var name, token string\nswitch v := v.(type) {\ncase *account.CreateAccountRequest:\n // v is a *account.CreateAccountRequest in this branch of the switch\n name = v.Name\n token = v.Token\ncase *account.PostAccountRequest:\n // v is a *account.PostAccountRequest in this branch of the switch\n name = v.Name\n token = v.Token\ndefault:\n // panic?\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 6211801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ODZ83.jpg?s=128&g=1", "display_name": "fishu", "link": "https://stackoverflow.com/users/6211801/fishu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 772, "favorite_count": 0, "accepted_answer_id": 39240034, "answer_count": 1, "score": -2, "last_activity_date": 1472614935, "creation_date": 1472611651, "question_id": 39239977, "link": "https://stackoverflow.com/questions/39239977/why-do-i-get-a-cannot-assign-error-when-do-assertion", "title": "Why do I get a \u201ccannot assign\u201d error when do assertion?", "body": "<p>req is a interface{} and PostAccountRequest,CreateAccountRequest is struct, when I do this, I get <code>cannot assign *account.PostAccountRequest to v (type *account.CreateAccountRequest) in multiple assignment</code></p>\n\n<pre><code>v, ok := req.(*account.CreateAccountRequest)                                                         \nif ok {\n    if v, ok = req.(*account.PostAccountRequest); ok {\n        panic(ok)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "distributed", "distributed-computing", "consensus", "raft"], "comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1472632065, "post_id": 39239759, "comment_id": 65824997, "body": "You want a callback for when a node is lost?"}, {"owner": {"reputation": 632, "user_id": 4068848, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/FD7nX.png?s=128&g=1", "display_name": "huron", "link": "https://stackoverflow.com/users/4068848/huron"}, "reply_to_user": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1472696455, "post_id": 39239759, "comment_id": 65859307, "body": "Yes. I want to do something when a node is lost."}], "owner": {"reputation": 632, "user_id": 4068848, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/FD7nX.png?s=128&g=1", "display_name": "huron", "link": "https://stackoverflow.com/users/4068848/huron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472610084, "creation_date": 1472610084, "question_id": 39239759, "link": "https://stackoverflow.com/questions/39239759/raft-how-can-i-do-some-recover-work-when-a-node-broke-down", "title": "Raft: how can I do some recover work when a node broke down?", "body": "<p>Recently I'm writing a distributed system using hashicorp/raft package, each node of the system will do a part of the whole work. When a node broke down, its working results will be lost,then I need to let other nodes rerun its work. But hashicorp/raft doesn't provide any API to add a callback, how can I do ? </p>\n"}, {"tags": ["go", "generic-programming"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1472610157, "creation_date": 1472610157, "answer_id": 39239769, "question_id": 39239561, "link": "https://stackoverflow.com/questions/39239561/how-to-get-a-slice-of-keys-from-map-in-golang-uniformly/39239769#39239769", "title": "How to get a slice of keys from map in golang uniformly?", "body": "<p>Use the <a href=\"http://godoc.org/reflect\" rel=\"noreferrer\">reflect</a> package to get the string keys from a map with arbitrary value type:</p>\n\n<pre><code>func Keys(v interface{}) ([]string, error) {\n  rv := reflect.ValueOf(v)\n  if rv.Kind() != reflect.Map {\n    return nil, errors.New(\"not a map\")\n  }\n  t := rv.Type()\n  if t.Key().Kind() != reflect.String {\n    return nil, errors.New(\"not string key\")\n  }\n  var result []string\n  for _, kv := range rv.MapKeys() {\n    result = append(result, kv.String())\n  }\n  return result, nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CcmF6Ze3Pk\" rel=\"noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1748, "user_id": 1077158, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1062d55a6ee0f0f6c71398be71fc86bd?s=128&d=identicon&r=PG", "display_name": "can.", "link": "https://stackoverflow.com/users/1077158/can"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2976, "favorite_count": 0, "accepted_answer_id": 39239769, "answer_count": 1, "score": 0, "last_activity_date": 1472610157, "creation_date": 1472608468, "question_id": 39239561, "link": "https://stackoverflow.com/questions/39239561/how-to-get-a-slice-of-keys-from-map-in-golang-uniformly", "title": "How to get a slice of keys from map in golang uniformly?", "body": "<p>I tried</p>\n\n<pre><code>func Keys(m map[string]interface{}) []string {\n    keys := make([]string, 0, len(m))\n    for k := range m {\n        keys = append(keys, k)\n    }\n    return keys\n}\n</code></pre>\n\n<p>but</p>\n\n<blockquote>\n  <p>cannot use m (type map[string]int) as type map[string]interface {} in argument to Keys</p>\n</blockquote>\n\n<p>I know that golang doesn't support generics, so is it possible to get keys slice uniformly?</p>\n"}, {"tags": ["go", "google-cloud-sql", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 3620240, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6ff38e08e365dc0fbd1220e22c1952ce?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep Midha", "link": "https://stackoverflow.com/users/3620240/amandeep-midha"}, "edited": false, "score": 0, "creation_date": 1472662017, "post_id": 39242830, "comment_id": 65845662, "body": "Thanks! It worked ... Maybe Raw SQL execution has such limitation in go-gorm"}, {"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "reply_to_user": {"reputation": 78, "user_id": 3620240, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6ff38e08e365dc0fbd1220e22c1952ce?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep Midha", "link": "https://stackoverflow.com/users/3620240/amandeep-midha"}, "edited": false, "score": 1, "creation_date": 1472669982, "post_id": 39242830, "comment_id": 65850126, "body": "I had a brief look at the code, Raw() does not immediately execute anything. You have to call other methods on the returned handle."}, {"owner": {"reputation": 280, "user_id": 9017639, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNUUC.jpg?s=128&g=1", "display_name": "Tim F.", "link": "https://stackoverflow.com/users/9017639/tim-f"}, "reply_to_user": {"reputation": 78, "user_id": 3620240, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6ff38e08e365dc0fbd1220e22c1952ce?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep Midha", "link": "https://stackoverflow.com/users/3620240/amandeep-midha"}, "edited": false, "score": 1, "creation_date": 1533801403, "post_id": 39242830, "comment_id": 90482179, "body": "Since this answered your question, would you mind marking this as the accepted answer @AmandeepMidha?  I also found it as a solution to a similar issue."}], "tags": [], "owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "is_accepted": true, "score": 2, "last_activity_date": 1472626970, "creation_date": 1472626970, "answer_id": 39242830, "question_id": 39239543, "link": "https://stackoverflow.com/questions/39239543/golang-gorm-db-raw-with-cloudsql-for-update-sql-query-not-working/39242830#39242830", "title": "Golang Gorm db.raw with CloudSQL for Update SQL query not working?", "body": "<p>Try <code>h.db.Exec</code> instead of <code>h.db.Raw</code>.</p>\n"}], "owner": {"reputation": 78, "user_id": 3620240, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6ff38e08e365dc0fbd1220e22c1952ce?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep Midha", "link": "https://stackoverflow.com/users/3620240/amandeep-midha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2082, "favorite_count": 0, "accepted_answer_id": 39242830, "answer_count": 1, "score": 1, "last_activity_date": 1472626970, "creation_date": 1472608311, "question_id": 39239543, "link": "https://stackoverflow.com/questions/39239543/golang-gorm-db-raw-with-cloudsql-for-update-sql-query-not-working", "title": "Golang Gorm db.raw with CloudSQL for Update SQL query not working?", "body": "<p>I have this SQL query, which in isolation works fine with 2 rows affected absolutely fine</p>\n\n<pre><code>update chores set life_status ='Processing' where life_status = 'Active' and chore_type ='Shared' and money_assigned &gt; 0\n</code></pre>\n\n<p>But when I try gorm's execution variant statements in golang i.e.</p>\n\n<pre><code>err := h.db.Raw(\"update chores set life_status ='Processing' where life_status = 'Active' and chore_type ='Shared' and money_assigned &gt; ? \", 0).Error\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>numRecsToProcess := h.db.Raw(\"update chores set life_status ='Processing' where life_status = 'Active' and chore_type ='Shared' and money_assigned &gt; ? \", 0).RowsAffected\n</code></pre>\n\n<p>None of these update statements are affecting any change in underlying DB. Is there something I am missing from Gorm usage functionality ?</p>\n"}, {"tags": ["go", "exec", "system-calls"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 5, "last_activity_date": 1472620643, "last_edit_date": 1492086159, "creation_date": 1472616094, "answer_id": 39240532, "question_id": 39239499, "link": "https://stackoverflow.com/questions/39239499/go-os-exec-command-start-twice-in-a-row/39240532#39240532", "title": "Go os/exec Command.Start() twice in a row", "body": "<p>As the <code>type Cmd struct {</code> Docs said:</p>\n\n<blockquote>\n  <p>A Cmd cannot be reused after calling its Run, Output or CombinedOutput\n  methods.</p>\n</blockquote>\n\n<hr>\n\n<p>1- Use two separate <code>exec.Command</code> like this,<br>\nAlso you may need some delay between runs (simulating two separate keystrokes):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc main() {\n    Pause()\n    fmt.Println(\"Once\")\n    time.Sleep(100 * time.Millisecond)\n    Pause()\n    fmt.Println(\"Twice\")\n}\nfunc Pause() {\n    cmd := exec.Command(\"xte\", \"key XF86AudioPlay\")\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    err := cmd.Run()\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>2- You may run it once:</p>\n\n<p>You may use something like this (not tested):</p>\n\n<pre><code>xte 'key XF86AudioPlay' 'key XF86AudioPlay'\n</code></pre>\n\n<p>and consider adding a short delay to the xte command (simulating two separate keystrokes):</p>\n\n<pre><code>xte 'key XF86AudioPlay' 'usleep 100000' 'key XF86AudioPlay'\n</code></pre>\n\n<p>Like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    Pause()\n    fmt.Println(\"Once\")\n}\nfunc Pause() {\n    cmd := exec.Command(\"xte\", `key XF86AudioPlay`, `usleep 100000`, `key XF86AudioPlay`)\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    err := cmd.Run()\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>See:</p>\n\n<p><a href=\"https://askubuntu.com/questions/499926/why-do-these-xte-commands-work-in-terminal-but-not-when-bound-with-xbindkeys\">https://askubuntu.com/questions/499926/why-do-these-xte-commands-work-in-terminal-but-not-when-bound-with-xbindkeys</a></p>\n\n<p><a href=\"http://manpages.ubuntu.com/manpages/wily/man1/xte.1.html\" rel=\"nofollow noreferrer\">http://manpages.ubuntu.com/manpages/wily/man1/xte.1.html</a></p>\n\n<p><a href=\"http://wiki.robotz.com/index.php/Linux_Tools_to_Remap_Keys_and_Mouse_Buttons\" rel=\"nofollow noreferrer\">http://wiki.robotz.com/index.php/Linux_Tools_to_Remap_Keys_and_Mouse_Buttons</a></p>\n\n<hr>\n\n<p>I hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": 1, "last_activity_date": 1472618141, "creation_date": 1472618141, "answer_id": 39240819, "question_id": 39239499, "link": "https://stackoverflow.com/questions/39239499/go-os-exec-command-start-twice-in-a-row/39240819#39240819", "title": "Go os/exec Command.Start() twice in a row", "body": "<p>See from source code:</p>\n\n<p>cmd struct: (<a href=\"https://golang.org/src/os/exec/exec.go\" rel=\"nofollow\">https://golang.org/src/os/exec/exec.go</a> line 99)</p>\n\n<pre><code>// Process is the underlying process, once started.\nProcess *os.Process\n</code></pre>\n\n<p>And in <code>Start</code> function (<a href=\"https://golang.org/src/os/exec/exec.go\" rel=\"nofollow\">https://golang.org/src/os/exec/exec.go</a> line 327)\n:</p>\n\n<pre><code>if c.Process != nil {\n    return errors.New(\"exec: already started\")\n}\n</code></pre>\n\n<p>So you can only use cmd.Start once time. If you want to use multiple time, you can create new Cmd OR run multiple command in once, ex: </p>\n\n<pre><code>cmd := exec.Command(\"/bin/sh\", \"-c\", \"command1; command2; command3; ...\")\n</code></pre>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5617, "favorite_count": 0, "accepted_answer_id": 39240532, "answer_count": 2, "score": 3, "last_activity_date": 1472691752, "creation_date": 1472607884, "last_edit_date": 1495541848, "question_id": 39239499, "link": "https://stackoverflow.com/questions/39239499/go-os-exec-command-start-twice-in-a-row", "title": "Go os/exec Command.Start() twice in a row", "body": "<p>I'm trying to use Go's <strong>os/exec</strong> <code>Command()</code> to <strong>simulate a keypress</strong>, and sometimes I'll want to use this keypress multiple times in <em>quick succession</em>. I'm using <code>exec.Command</code> to call <a href=\"http://manpages.ubuntu.com/manpages/wily/man1/xte.1.html\" rel=\"nofollow noreferrer\">\"xte\"</a>, \"key XF86AudioPlay\", which pauses music on a Linux OS. While the <code>Command</code> can <code>Start()</code> <em>or</em> <code>Run()</code> no problem, if I try to execute again, I get an error:</p>\n\n<pre><code>exec: already started\n</code></pre>\n\n<p>I've tried using <code>Process.Kill()</code> immediately after the execution, in order to free it up, but this will make the execution not work in the first place. I got this idea from here: <a href=\"https://stackoverflow.com/questions/11886531/terminating-a-process-started-with-os-exec-in-golang\">Terminating a Process Started with os/exec in Golang</a></p>\n\n<p>My code uses a <code>switch</code> and calls this pause function accordingly, but I'll simply share the basis of the code I wrote, with the <code>case</code> as an example function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd := exec.Command(\"xte\", \"key XF86AudioPlay\")\n//...\nfunc Pause() {\n        err := cmd.Start() // or cmd.Run()\n        if err != nil {\n            fmt.Println(err)\n        }\n        err = cmd.Process.Kill()\n        if err != nil {\n            fmt.Printf(\"Failed to kill: %s\", err)\n        }\n}\n</code></pre>\n\n<p>So, to recap, I'm successful at calling it one time, but upon success calls to <code>Pause()</code>, I get the error from <code>cmd.Start()</code>/<code>Run()</code> which read: <code>exec: already started</code>.</p>\n\n<p>I also tried going <em>lower</em>, that is, using <code>syscall</code>, but I ran into some trouble. I tried:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>args[0] = \"xte\"\nargs[1] = \"key\"\nargs[2] = \"XF86AudioPlay\"\n//... Pause():\n            err := syscall.Exec(\"/bin\", args, os.Environ())\n        if err != nil {\n            fmt.Println(err)\n        }\n</code></pre>\n\n<p>And here I got a <code>permission denied</code> error, even running as super user (sudo).</p>\n\n<p>How should I proceed call this <code>Command()</code> and then free it up for immediate <em>recall</em>? Or am I on the right track with <code>syscall</code>?</p>\n\n<p><strong>Edit</strong>\nSo the solution as both Amd and Son Bui state, was to <em>create</em> the <code>Command</code> everytime I intend to call it, basically putting the assignment <code>cmd := exec.Command()</code><em>inside</em> my <code>Pause()</code> method.</p>\n"}, {"tags": ["go", "ascii"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1472585537, "post_id": 39235626, "comment_id": 65808443, "body": "<code>strconv.Itoa</code> changes <code>72</code> to <code>&quot;72&quot;</code>. Runes are already integers, so <code>string(72)</code> gives you the rune associated with it (<code>&#39;H&#39;</code>)"}, {"owner": {"reputation": 1901, "user_id": 2002471, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/222d816f24fcb2d01e92937b6af01d34?s=128&d=identicon&r=PG", "display_name": "chicks", "link": "https://stackoverflow.com/users/2002471/chicks"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1472588445, "post_id": 39235626, "comment_id": 65809971, "body": "Thanks for the downvotes.  I read the docs and googled this for an hour."}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 4, "creation_date": 1472591234, "post_id": 39235626, "comment_id": 65811343, "body": "Go&#39;s <code>strconv.Itoa</code> function is based on <code>itoa</code> in the <a href=\"http://www.cplusplus.com/reference/cstdlib/itoa/\" rel=\"nofollow noreferrer\">C standard library</a>. The behavior is well-documented for both Go and C. I did not vote, but since your question title is phrased as a statement and you end by asking whether a <i>standard library function</i> has an obvious bug, I am not surprised by the downvotes."}, {"owner": {"reputation": 2945, "user_id": 5403618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/23dd52d5b8a74b7b8c741c04265432a3?s=128&d=identicon&r=PG&f=1", "display_name": "Anand Undavia", "link": "https://stackoverflow.com/users/5403618/anand-undavia"}, "edited": false, "score": 1, "creation_date": 1547710677, "post_id": 39235626, "comment_id": 95286959, "body": "I find this question useful. For a beginner, without strong background in <code>C</code>, it is not very intuitive that <code>Itoa()</code> functions parses the integer to string. It is very tempting to use <code>string()</code> which is analogous to <code>toString()</code> method in other languages and get confused about the results. +1"}, {"owner": {"reputation": 1901, "user_id": 2002471, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/222d816f24fcb2d01e92937b6af01d34?s=128&d=identicon&r=PG", "display_name": "chicks", "link": "https://stackoverflow.com/users/2002471/chicks"}, "edited": false, "score": 0, "creation_date": 1547735898, "post_id": 39235626, "comment_id": 95300979, "body": "Even with C/C++ experience this was a detail that I had forgotten with the passage of time.  Thanks for your vote."}, {"owner": {"reputation": 1597, "user_id": 2161072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ba143872804741abb61bf862ac4bd75?s=128&d=identicon&r=PG", "display_name": "Desty", "link": "https://stackoverflow.com/users/2161072/desty"}, "edited": false, "score": 1, "creation_date": 1587257657, "post_id": 39235626, "comment_id": 108440434, "body": "Upvoted because the question draws attention to the behaviour of <code>string(intValue)</code> which is likely to be surprising to people with experience in other programming languages. I presumed <code>string(123)</code> would yield the result <code>&quot;123&quot;</code>, but it actually returns <code>&quot;{&quot;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1597458418, "last_edit_date": 1597458418, "creation_date": 1472586015, "answer_id": 39235833, "question_id": 39235626, "link": "https://stackoverflow.com/questions/39235626/string-does-what-i-hoped-strconv-itoa-would-do/39235833#39235833", "title": "string() does what I hoped strconv.Itoa() would do", "body": "<p><a href=\"https://godoc.org/strconv#Itoa\" rel=\"nofollow noreferrer\"><code>strconv.Itoa</code></a> formats an integer as a decimal string. Example: <code>strconv.Itoa(65)</code> and <code>strconv.Itoa('A')</code> return the string <code>&quot;65&quot;</code>.</p>\n<p><a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\"><code>string(intValue)</code></a> yields a string containing the UTF-8 representation of the integer.  Example: <code>string('A')</code> and <code>string(65)</code> evaluate to the string <code>&quot;A&quot;</code>.</p>\n<p>Experience has shown that many people erroneously expect <code>string(intValue)</code> to return the decimal representation of the integer value. Because this expectation is so common, the Go 1.15 version of <code>go vet</code>  warns about <code>string(intValue)</code> conversions when the type of the integer value is not <code>rune</code> or <code>byte</code> (read details <a href=\"https://golang.org/doc/go1.15#vet\" rel=\"nofollow noreferrer\">here</a>).</p>\n"}], "owner": {"reputation": 1901, "user_id": 2002471, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/222d816f24fcb2d01e92937b6af01d34?s=128&d=identicon&r=PG", "display_name": "chicks", "link": "https://stackoverflow.com/users/2002471/chicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 39235833, "answer_count": 1, "score": 2, "last_activity_date": 1597458418, "creation_date": 1472585297, "question_id": 39235626, "link": "https://stackoverflow.com/questions/39235626/string-does-what-i-hoped-strconv-itoa-would-do", "title": "string() does what I hoped strconv.Itoa() would do", "body": "<p>I have a short program that converts a few binary numbers into their ASCII equivalents.  I tried translating this into <a href=\"/questions/tagged/go\" class=\"post-tag\" title=\"show questions tagged &#39;go&#39;\" rel=\"tag\"><img src=\"//i.stack.imgur.com/sawHl.png\" height=\"16\" width=\"18\" alt=\"\" class=\"sponsor-tag-img\">go</a> today and found that <code>strconv.Itoa()</code> doesn't work as I expected.</p>\n\n<pre><code>// translate Computer History Museum t-shirt\n// http://i.ebayimg.com/images/g/qksAAOSwaB5XjsI1/s-l300.jpg\n\npackage main\n\nimport (\n        \"fmt\"\n        \"strconv\"\n)\n\nfunc main() {\n        var binaryStrings [3]string\n        binaryStrings = [3]string{\"01000011\",\"01001000\",\"01001101\"}\n\n        for _,bin := range binaryStrings {\n                if decimal, err := strconv.ParseInt(bin, 2, 64); err != nil {\n                        fmt.Println(err)\n                } else {\n                        letter := strconv.Itoa(int(decimal))\n                        fmt.Println(bin, decimal, letter, string(decimal))\n                }\n        }\n}\n</code></pre>\n\n<p>which outputs</p>\n\n<pre><code>$ go run chm-tshirt.go \n01000011 67 67 C\n01001000 72 72 H\n01001101 77 77 M\n</code></pre>\n\n<p>So it seems like <code>string()</code> is doing what I thought <code>strconv.Itoa()</code> would do.  I was expecting the third column to show what I get in the fourth column.  Is this a bug or what am I missing?</p>\n"}, {"tags": ["variables", "go", "exec"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6775639, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mUK5OEDOQ4g/AAAAAAAAAAI/AAAAAAAAAOY/Tfxt2YIswpE/photo.jpg?sz=128", "display_name": "Tim Brammer", "link": "https://stackoverflow.com/users/6775639/tim-brammer"}, "edited": false, "score": 0, "creation_date": 1472588442, "post_id": 39234590, "comment_id": 65809968, "body": "Jim,  Thanks for the thorough list of options. I agree, filepath.Join seems to be the most appropriate solution."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1472581929, "last_edit_date": 1472581929, "creation_date": 1472581458, "answer_id": 39234590, "question_id": 39234526, "link": "https://stackoverflow.com/questions/39234526/exec-command-with-variable-arguments/39234590#39234590", "title": "exec.Command with variable arguments", "body": "<p>In Go strings are concatenated with <code>+</code>,</p>\n\n<pre><code>exec.Command(\"command\", \"/path/to/\" + a)\n</code></pre>\n\n<p>You could also using a formatting function</p>\n\n<pre><code>exec.Command(\"command\", fmt.Sprintf(\"/path/to/%s\", a))\n</code></pre>\n\n<p>But in this case it's probably more appropriate to use <a href=\"https://golang.org/pkg/path/filepath/#Join\" rel=\"nofollow\"><code>filepath.Join</code></a></p>\n\n<pre><code>dir := \"/path/to/\"\nexec.Command(\"command\", filepath.Join(dir, a))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": 0, "last_activity_date": 1472586470, "creation_date": 1472586470, "answer_id": 39235941, "question_id": 39234526, "link": "https://stackoverflow.com/questions/39234526/exec-command-with-variable-arguments/39235941#39235941", "title": "exec.Command with variable arguments", "body": "<p>I usually use this approach:</p>\n\n<pre><code>a := fileName\ncmdArgs := []string{\"/path/to/\" + a, \"morearg\"}\nout, err := exec.Command(\"command\", cmdArgs...).Output()\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6775639, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mUK5OEDOQ4g/AAAAAAAAAAI/AAAAAAAAAOY/Tfxt2YIswpE/photo.jpg?sz=128", "display_name": "Tim Brammer", "link": "https://stackoverflow.com/users/6775639/tim-brammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4324, "favorite_count": 0, "accepted_answer_id": 39234590, "answer_count": 2, "score": 0, "last_activity_date": 1558609680, "creation_date": 1472581209, "last_edit_date": 1558609680, "question_id": 39234526, "link": "https://stackoverflow.com/questions/39234526/exec-command-with-variable-arguments", "title": "exec.Command with variable arguments", "body": "<p>I'm trying to pass an argument to an exec.Command. <em>Part</em> of that argument is a variable.</p>\n\n<pre><code>a := fileName\nexec.Command(\"command\", \"/path/to/\"a).Output()\n</code></pre>\n\n<p>I'm not sure of how to approach this, I'm thinking I need to fully form the argument before I even pass it, but I'm also struggling with that option. I'm not sure how to do something like:</p>\n\n<pre><code>a := fileName\narg := \"/path/to/\"a\nexec.Command(\"command\", arg).Output()\n</code></pre>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472572349, "post_id": 39232012, "comment_id": 65801157, "body": "Please show an example. Your provided code works and wouldn&#39;t cause this error."}, {"owner": {"reputation": 439, "user_id": 4881990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/acd4be4abd5ba53fdb0c7f40629ef8e2?s=128&d=identicon&r=PG&f=1", "display_name": "Abbas Moazzami", "link": "https://stackoverflow.com/users/4881990/abbas-moazzami"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472572878, "post_id": 39232012, "comment_id": 65801537, "body": "I update my question @jimb"}], "answers": [{"comments": [{"owner": {"reputation": 439, "user_id": 4881990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/acd4be4abd5ba53fdb0c7f40629ef8e2?s=128&d=identicon&r=PG&f=1", "display_name": "Abbas Moazzami", "link": "https://stackoverflow.com/users/4881990/abbas-moazzami"}, "edited": false, "score": 0, "creation_date": 1472573838, "post_id": 39232283, "comment_id": 65802104, "body": "i have a dynamic config file and maybe involve array value"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472574547, "post_id": 39232283, "comment_id": 65802539, "body": "the default type for the &quot;&quot;gopkg.in/yaml.v2&quot; package is <code>map[interface{}]interface{}</code>"}], "tags": [], "owner": {"reputation": 26092, "user_id": 824377, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e600bd229c588891a7616f303e30efd9?s=128&d=identicon&r=PG", "display_name": "AJcodez", "link": "https://stackoverflow.com/users/824377/ajcodez"}, "is_accepted": false, "score": 2, "last_activity_date": 1472574699, "last_edit_date": 1472574699, "creation_date": 1472572996, "answer_id": 39232283, "question_id": 39232012, "link": "https://stackoverflow.com/questions/39232012/how-access-to-keys-in-mapinterface-interface/39232283#39232283", "title": "how access to keys in map[interface{}] interface{}", "body": "<p>YAML uses string keys. Have you tried:</p>\n\n<pre><code>config := make(map[string]interface{})\n</code></pre>\n\n<p>To access nested attributes, use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertions</a>.</p>\n\n<pre><code>mysql := config[\"mysql\"].(map[string][string])\nmysql[\"host\"]\n</code></pre>\n\n<p>A common pattern is to alias a generic map type. </p>\n\n<pre><code>type M map[string]interface{}\n\nconfig := make(M)\nyaml.Unmarshal(configFile, &amp;config)\nmysql := config[\"mysql\"].(M)\nhost := mysql[\"host\"].(string)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1472575244, "last_edit_date": 1472575244, "creation_date": 1472574710, "answer_id": 39232737, "question_id": 39232012, "link": "https://stackoverflow.com/questions/39232012/how-access-to-keys-in-mapinterface-interface/39232737#39232737", "title": "how access to keys in map[interface{}] interface{}", "body": "<p>If you don't define the types ahead of time, you need to <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">assert</a> the proper type from each <code>interface{}</code> you encounter:</p>\n\n<pre><code>if db, ok := config[\"db\"].(map[interface{}]interface{}); ok {\n    if mysql, ok := db[\"mysql\"].(map[interface{}]interface{}); ok {\n        username := mysql[\"username\"].(string)\n        // ...\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/koSugTzyV-\" rel=\"nofollow\">https://play.golang.org/p/koSugTzyV-</a></p>\n"}], "owner": {"reputation": 439, "user_id": 4881990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/acd4be4abd5ba53fdb0c7f40629ef8e2?s=128&d=identicon&r=PG&f=1", "display_name": "Abbas Moazzami", "link": "https://stackoverflow.com/users/4881990/abbas-moazzami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4248, "favorite_count": 5, "answer_count": 2, "score": 4, "last_activity_date": 1472575244, "creation_date": 1472572110, "last_edit_date": 1472573374, "question_id": 39232012, "link": "https://stackoverflow.com/questions/39232012/how-access-to-keys-in-mapinterface-interface", "title": "how access to keys in map[interface{}] interface{}", "body": "<p>this is my yaml file:</p>\n\n<pre><code>db:\n    # table prefix\n    tablePrefix: tbl\n\n    # mysql driver configuration\n    mysql:\n        host: localhost\n        username: root\n        password: mysql\n\n    # couchbase driver configuration\n    couchbase:\n        host: couchbase://localhost\n</code></pre>\n\n<p>and i use go-yaml library to unmarshall yaml file to variable:</p>\n\n<pre><code>config := make(map[interface{}]interface{})\nyaml.Unmarshal(configFile, &amp;config)\n</code></pre>\n\n<p>config value:</p>\n\n<pre><code>map[mysql:map[host:localhost username:root password:mysql]      couchbase:map[host:couchbase://localhost] tablePrefix:tbl]\n</code></pre>\n\n<p>how access to <strong>db -> mysql -> username</strong> value in config without predefined struct type</p>\n"}, {"tags": ["json", "serialization", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1472571542, "post_id": 39231766, "comment_id": 65800546, "body": "You can&#39;t unmarshal into empty interfaces, because the json package has no way to know what concrete type to use inside that interface."}, {"owner": {"reputation": 45, "user_id": 5576609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EZXEv.png?s=128&g=1", "display_name": "wallnutkraken", "link": "https://stackoverflow.com/users/5576609/wallnutkraken"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472571874, "post_id": 39231766, "comment_id": 65800787, "body": "Is there any way to tell it what type it is? Kind of like <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json:&quot;varName&quot;</code></a>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472572005, "post_id": 39231766, "comment_id": 65800895, "body": "No, since types can&#39;t be referenced by name (if you don&#39;t use the type directly, it may not even be in your compiled binary). It&#39;s better to try not to unmarshal into interfaces (other than using <code>interface{}</code> for json package default types)."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1472572004, "creation_date": 1472572004, "answer_id": 39231981, "question_id": 39231766, "link": "https://stackoverflow.com/questions/39231766/json-cannot-unmarshal-object-into-go-value-of-type-auction-item/39231981#39231981", "title": "json: cannot unmarshal object into Go value of type Auction.Item", "body": "<p>The unmarshaler does not know the concrete type to use for the nil <code>BidItem</code> field. You can fix this by setting the field to a value of the appropriate type:</p>\n\n<pre><code>func PimpFromJSON(content []byte) (Pimp, error) {\n    p := new(pimp)\n    p.BidItem = &amp;item{}\n    err := json.Unmarshal(content, p)\n    return p, err\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6HoyLPmjJm\" rel=\"noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 45, "user_id": 5576609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EZXEv.png?s=128&g=1", "display_name": "wallnutkraken", "link": "https://stackoverflow.com/users/5576609/wallnutkraken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4979, "favorite_count": 0, "accepted_answer_id": 39231981, "answer_count": 1, "score": 2, "last_activity_date": 1472572004, "creation_date": 1472571410, "question_id": 39231766, "link": "https://stackoverflow.com/questions/39231766/json-cannot-unmarshal-object-into-go-value-of-type-auction-item", "title": "json: cannot unmarshal object into Go value of type Auction.Item", "body": "<p>I have a problem deserializing my object. I use an interface to this object to call the Serialization, and from reading the output the serialization works perfectly. Here is the underlying struct of my object:</p>\n\n<pre><code>type pimp struct {\n    Price       int\n    ExpDate     int64\n    BidItem     Item\n    CurrentBid  int\n    PrevBidders []string\n}\n</code></pre>\n\n<p>And here's the interface it implements: </p>\n\n<pre><code>type Pimp interface {\n    GetStartingPrice() int\n    GetTimeLeft() int64\n    GetItem() Item\n    GetCurrentBid() int\n    SetCurrentBid(int)\n    GetPrevBidders() []string\n    AddBidder(string) error\n    Serialize() ([]byte, error)\n}\n</code></pre>\n\n<p>The Serialize() method:</p>\n\n<pre><code>func (p *pimp) Serialize() ([]byte, error) {\n    return json.Marshal(*p)\n}\n</code></pre>\n\n<p>As you may have noticed, pimp has a variable by the name of Item. This item is also, an interface:</p>\n\n<pre><code>type item struct {\n    Name string\n}\n\ntype Item interface {\n    GetName() string\n}\n</code></pre>\n\n<p>Now serializing a sample of such an object returns the following JSON:</p>\n\n<pre><code>{\"Price\":100,\"ExpDate\":1472571329,\"BidItem\":{\"Name\":\"ExampleItem\"},\"CurrentBid\":100,\"PrevBidders\":[]}\n</code></pre>\n\n<p>Here is my deserialization code:</p>\n\n<pre><code>func PimpFromJSON(content []byte) (Pimp, error) {\n    p := new(pimp)\n    err := json.Unmarshal(content, p)\n    return p, err\n}\n</code></pre>\n\n<p>Running it, however, gives me the following error:</p>\n\n<pre><code>json: cannot unmarshal object into Go value of type Auction.Item\n</code></pre>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472566129, "post_id": 39229698, "comment_id": 65796515, "body": "Why can&#39;t you alter the package code? You have the code if you can build the program."}, {"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472566601, "post_id": 39229698, "comment_id": 65796878, "body": "I will try, but I am asking for a more convenient way to get the trace from the main program :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472566857, "post_id": 39229698, "comment_id": 65797073, "body": "If the code recovers from a panic, you don&#39;t see the panic. You could try setting a breakpoint in a debugger, but given the state of debuggers it&#39;s probably just much faster to comment out the <code>recover</code> and get a stack trace."}], "answers": [{"tags": [], "owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "is_accepted": true, "score": 1, "last_activity_date": 1473691673, "last_edit_date": 1473691673, "creation_date": 1472567444, "answer_id": 39230307, "question_id": 39229698, "link": "https://stackoverflow.com/questions/39229698/stack-trace-of-go-routine-from-imported-package/39230307#39230307", "title": "Stack trace of go routine from imported package?", "body": "<p>The short answer is: <strong>Not possible</strong> but there are <strong>exceptions</strong>.</p>\n\n<p>Golang has a few stack control methods and types.</p>\n\n<p>You can control the stack levels with <a href=\"https://golang.org/pkg/runtime/debug/#SetTraceback\" rel=\"nofollow\">runtime/debug/SetTraceback</a></p>\n\n<p><code>func SetTraceback(level string)</code></p>\n\n<blockquote>\n  <p>SetTraceback sets the amount of detail printed by the runtime\n  inthe traceback it prints before exiting due to an\n  unrecovered panic or an internal runtime error.\n  The level argument takes the same values as the GOTRACEBACK\n  environment variable. For example, SetTraceback(\"all\") ensure \n  that the program prints all goroutines when it crashes.<br>\n  See the package runtime documentation for details. If\n  SetTraceback is called with a level lower than that of the\n  environment variable, the call is ignored.    </p>\n</blockquote>\n\n<p>You can also print the stack strace with <a href=\"https://golang.org/pkg/runtime/debug/#Stack\" rel=\"nofollow\">runtime/debug/Stack</a></p>\n\n<p><code>func Stack() []byte</code></p>\n\n<blockquote>\n  <p>Stack returns a formatted stack trace of the goroutine that calls it. It  calls runtime.Stack with a large enough buffer to capture the entire trace.</p>\n</blockquote>\n\n<p>Also you need to understand how the Built-in funct <code>recover</code> works.</p>\n\n<blockquote>\n  <p>The recover built-in function allows a program to manage behavior of a\n  panicking goroutine. Executing a call to recover inside a deferred\n  function (but not any function called by it) stops the panicking sequence\n  by restoring normal execution and retrieves the error value passed to the\n  call of panic. If recover is called outside the deferred function it will\n  not stop a panicking sequence. In this case, or when the goroutine is not\n  panicking, or if the argument supplied to panic was nil, recover returns\n  nil. Thus the return value from recover reports whether the goroutine is\n  panicking.</p>\n</blockquote>\n\n<p><code>func recover() interface{}</code></p>\n\n<h3>Working Example</h3>\n\n<p>This example assumes that the package does not call recover (detailed in another section).</p>\n\n<p><a href=\"https://play.golang.org/p/K1kS6WzsKf\" rel=\"nofollow\">Golang Playground Link</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"errors\"\n    \"runtime/debug\"\n    \"time\"\n)\n\nfunc f2() {\n    panic(errors.New(\"oops\")) // line 11\n}\n\nfunc f1() {\n    f2() // line 15\n}\n\nfunc main() {\n    defer func() {\n        if e := recover(); e != nil {\n            log.Printf(\"%s: %s\", e, debug.Stack()) // line 20\n        }\n    }()\n\n    go f1() // line 25\n\n    time.Sleep(time.Second * 1)\n}\n</code></pre>\n\n<h3>If package calls recover</h3>\n\n<p>If the code is recovering from the panic you need to use a debugger or remove the <code>recover</code> to understand what is going on as seen on the example below which demonstrate that recovered panics can not be \"recovered\" again.</p>\n\n<p><a href=\"https://play.golang.org/p/VjL4Tk7VwN\" rel=\"nofollow\">Golang Playground Link</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"errors\"\n    \"runtime/debug\"\n    \"time\"\n)\n\nfunc f2() {\n    panic(errors.New(\"oops\")) // line 11\n}\n\nfunc f1() {\n    defer func() {\n        if e := recover(); e != nil {\n            log.Printf(\"internal %s: %s\", e, debug.Stack()) // line 20\n        }\n    }()\n    f2() // line 15\n}\n\nfunc main() {\n    defer func() {\n        if e := recover(); e != nil {\n            log.Printf(\"external %s: %s\", e, debug.Stack()) // line 20\n        } else {\n            log.Println(\"Nothing to print\")\n        }\n    }()\n\n    go f1() // line 25\n\n    time.Sleep(time.Second * 1)\n}\n</code></pre>\n\n<h3>Lesser then two evils</h3>\n\n<p>Debug with <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow\">Delve</a> Or temporaly edit the package so it logs the full message (once understood you can revert the changes).</p>\n\n<p>Also if you find the problem let the package author know so it can be fixed.</p>\n"}], "owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 1, "accepted_answer_id": 39230307, "answer_count": 1, "score": 1, "last_activity_date": 1473691673, "creation_date": 1472565885, "last_edit_date": 1472566629, "question_id": 39229698, "link": "https://stackoverflow.com/questions/39229698/stack-trace-of-go-routine-from-imported-package", "title": "Stack trace of go routine from imported package?", "body": "<p>How to obtain the stack trace of the last (ideally of all) go routine (the app has multiple go routines) which panicked and recovered and logged only a not much descriptive error message? I don't know which routine recovered. Also, please keep in mind that I will not alter the code of any imported package. This panic happened in some of the imported packages which creates multiple go routines so I need a way to grab the stack trace of the last recovered routine in order to find where it panic.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 333, "user_id": 995368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hjdrh.png?s=128&g=1", "display_name": "Xavier Nicollet", "link": "https://stackoverflow.com/users/995368/xavier-nicollet"}, "edited": false, "score": 0, "creation_date": 1472566682, "post_id": 39226889, "comment_id": 65796937, "body": "what does netstat -antp look like?"}], "answers": [{"tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": true, "score": 1, "last_activity_date": 1472651072, "creation_date": 1472651072, "answer_id": 39251393, "question_id": 39226889, "link": "https://stackoverflow.com/questions/39226889/setmaxopenconns-not-solving-error-1040-too-many-connections/39251393#39251393", "title": "SetMaxOpenConns() not solving `Error 1040: Too many connections`", "body": "<p>First you should check how many open connections does your MySQL server allow with <code>SHOW VARIABLES LIKE 'max_connections'</code>. Default is 151 but if it's less than 100 then your program obviously tries to open too many connections.</p>\n\n<p>But even if it's more than 100 you could still easily get that error. MySQL's <code>max_connections</code> is a global variable that affects the whole server. If your program uses other databases on same server they will also count towards your <code>max_connections</code> limit. Or similarly if you have other programs using your database server you can also run out of connections. In that case you have to use smaller values for <code>SetMaxOpenConns()</code> or increase the <code>max_connections</code> variable.</p>\n\n<p>Also consider setting <code>db.SetMaxIdleConns()</code> To a value lower than <code>db.SetMaxOpenConns()</code>. Otherwise you might have 100 (or whatever value you gave to <code>SetMaxOpenConns</code>) idle connections to your database server using up your connection pool.</p>\n"}, {"tags": [], "owner": {"reputation": 152, "user_id": 2758145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2a6032fcaf4d1bc58ea4381d9b4da2d?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil Kumar", "link": "https://stackoverflow.com/users/2758145/sunil-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1585856044, "creation_date": 1585856044, "answer_id": 60999663, "question_id": 39226889, "link": "https://stackoverflow.com/questions/39226889/setmaxopenconns-not-solving-error-1040-too-many-connections/60999663#60999663", "title": "SetMaxOpenConns() not solving `Error 1040: Too many connections`", "body": "<p>To update the open conection limit and seeing that limit, you just need to login into the mysql and perform the following commands.</p>\n\n<pre><code>mysql&gt; SHOW VARIABLES LIKE 'max_connections';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| max_connections | 90  |\n+-----------------+-------+\n1 row in set (0.00 sec)\n</code></pre>\n\n<p>The below command will set the limit of open connections to 1000, that can be changed as per your need.</p>\n\n<pre><code>mysql&gt; SET GLOBAL max_connections = 1000;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; SHOW VARIABLES LIKE 'max_connections';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| max_connections | 90  |\n+-----------------+-------+\n1 row in set (0.00 sec)\n</code></pre>\n\n<p>For reference you can go to mysql official link from here <a href=\"https://dev.mysql.com/doc/refman/5.7/en/set-variable.html\" rel=\"nofollow noreferrer\">mysql link</a></p>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2667, "favorite_count": 1, "accepted_answer_id": 39251393, "answer_count": 2, "score": 2, "last_activity_date": 1585856044, "creation_date": 1472558300, "last_edit_date": 1495541309, "question_id": 39226889, "link": "https://stackoverflow.com/questions/39226889/setmaxopenconns-not-solving-error-1040-too-many-connections", "title": "SetMaxOpenConns() not solving `Error 1040: Too many connections`", "body": "<p>I am using golang with Mysql. I am testing load on server using <code>apache benchmark tool</code>. I am getting too many connections error. I read <a href=\"https://stackoverflow.com/questions/28135580/golang-mysql-error-1040-too-many-connections\">this post </a>. So, I added <code>SetMaxOpenConns(100)</code> in my code. Still I am getting this too many connections error.</p>\n\n<p>I am doing the following query</p>\n\n<p><code>ab -n 1000 -k -c 20 -p post.txt -T application/x-www-form-urlencoded http://localhost:8084/abcd\n</code></p>\n\n<p><strong>Note:</strong> post.txt file contains array of 35 ids(type integer). This is my main function:</p>\n\n<pre><code>db, err := models.NewDB(\"root:@/rules\")\n    if err != nil {\n        panic(err)\n    }\n\n    db.SetMaxOpenConns(100)\n    http.Handle(\"/abcd\", getReq(db))\n\n    log.Fatal(http.ListenAndServe(\":8084\", nil))\n</code></pre>\n\n<p>I am querying this function in go routine for all the ids.</p>\n\n<pre><code>func getRuleforProduct(db *sql.DB, id int) map[int]string {\n    m := make(map[int]string)\n    var res string\n    err := db.QueryRow(\"select rules from table where product_id = ?\", id).Scan(&amp;res)\n    checkError(err)\n    m[id] = res\n    return m\n}\n</code></pre>\n\n<p>How to solve this issue, even if request per second is less. I want the code to work for atleast 20 concurrent request. </p>\n"}, {"tags": ["git", "github", "go", "geometry", "godeps"], "answers": [{"comments": [{"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1472553322, "post_id": 39224916, "comment_id": 65787755, "body": "That is an option, but we prefer to only commit the godeps.json file and restore source to an environment.  Committing both vendor folder and json file provides scope for the two to become out of sync."}, {"owner": {"reputation": 66, "user_id": 6162139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83fb152b63fb2ee93f1a0f292c6be463?s=128&d=identicon&r=PG", "display_name": "Vasily Korytov", "link": "https://stackoverflow.com/users/6162139/vasily-korytov"}, "reply_to_user": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 1, "creation_date": 1472553478, "post_id": 39224916, "comment_id": 65787853, "body": "Nope, just use <code>godep update</code> to update <code>vendor</code> (and it will update both the json and the <code>vendor</code> folder) :-)"}, {"owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "reply_to_user": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1472559847, "post_id": 39224916, "comment_id": 65791949, "body": "vasily  is correct @MylesMcDonnell You should be commiting the vendor folder, you should not be relying on external git repos to build your code. I know it sounds weird specially if the repos are yours but it works better to and you avoid a lot of pain if you commit the actual versions you use and let govendor manage the updates etc."}, {"owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "reply_to_user": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1472559928, "post_id": 39224916, "comment_id": 65792005, "body": "@MylesMcDonnell the files should never go out of sync, as long as you use govendor."}, {"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1472560319, "post_id": 39224916, "comment_id": 65792283, "body": "cool..that&#39;s what I will do then. Might need to raise another question for this: now I have the vendor folder checked in but when I run go test on circle it can&#39;t resolve the packages? go build does resolve the packages. all works fine locally in a vanilla workspace so something to do with the circle env I suspect."}, {"owner": {"reputation": 66, "user_id": 6162139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83fb152b63fb2ee93f1a0f292c6be463?s=128&d=identicon&r=PG", "display_name": "Vasily Korytov", "link": "https://stackoverflow.com/users/6162139/vasily-korytov"}, "edited": false, "score": 0, "creation_date": 1472567780, "post_id": 39224916, "comment_id": 65797770, "body": "Try <code>godep go test</code> instead. :-)"}, {"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1472568630, "post_id": 39224916, "comment_id": 65798373, "body": "I don&#39;t need to use godep at all during CI build time because all of the deps are &#39;vendored&#39; and I&#39;m on Go1.6.x.  The problem I was having is that Go will not look for dependencies in the vendor folder if the code being built is not in the workspace.  By default circle does put your code in the workspace so I was able to fix by moving the code in the circle dependencies section."}], "tags": [], "owner": {"reputation": 66, "user_id": 6162139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83fb152b63fb2ee93f1a0f292c6be463?s=128&d=identicon&r=PG", "display_name": "Vasily Korytov", "link": "https://stackoverflow.com/users/6162139/vasily-korytov"}, "is_accepted": false, "score": 2, "last_activity_date": 1472552971, "last_edit_date": 1472552971, "creation_date": 1472552652, "answer_id": 39224916, "question_id": 39224568, "link": "https://stackoverflow.com/questions/39224568/force-godep-to-pull-packages-from-github-over-ssh-in-circle-build/39224916#39224916", "title": "Force godep to pull packages from github over SSH in circle build", "body": "<p>It seems like you're misusing the Godeps :-)</p>\n\n<p>According to <a href=\"https://github.com/tools/godep/blob/master/FAQ.md#should-i-use-godep-restore\" rel=\"nofollow\">their FAQ</a> you should consider checking in <code>vendor</code> directory to the repo, you're building (that is: all the external dependencies).</p>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472552971, "creation_date": 1472551656, "question_id": 39224568, "link": "https://stackoverflow.com/questions/39224568/force-godep-to-pull-packages-from-github-over-ssh-in-circle-build", "title": "Force godep to pull packages from github over SSH in circle build", "body": "<p>We have go packages in separate repos to the package being built in circle.  We have setup the build with a github user key (<a href=\"https://circleci.com/docs/github-security-ssh-keys/\" rel=\"nofollow\">https://circleci.com/docs/github-security-ssh-keys/</a>) so that it can access the private repos that contain the dependencies.  However, calling godep restore results in a git clone https://... call.</p>\n\n<p>Is it possible to force godep restore packages using SSH type urls? Alternatively, is it possible to somehow use the user key to enable auth over HTTPS?</p>\n\n<p>I have tried everything suggested here but so far no joy: <a href=\"https://gist.github.com/shurcooL/6927554\" rel=\"nofollow\">https://gist.github.com/shurcooL/6927554</a></p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2094540"}, "edited": false, "score": 0, "creation_date": 1472550987, "post_id": 39223999, "comment_id": 65786171, "body": "Thanks for this clear answer ! It&#39;s already working but I&#39;m gonna check prebuild queries."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1472551002, "last_edit_date": 1495540897, "creation_date": 1472550095, "answer_id": 39223999, "question_id": 39223856, "link": "https://stackoverflow.com/questions/39223856/golang-mysql-querying-undefined-amount-of-args-using-in-operator/39223999#39223999", "title": "Golang MySQL querying undefined amount of args using IN operator", "body": "<p><a href=\"https://golang.org/pkg/database/sql/#Stmt.Query\" rel=\"nofollow noreferrer\"><code>Stmt.Query()</code></a> has a variadic parameter:</p>\n\n<pre><code>func (s *Stmt) Query(args ...interface{}) (*Rows, error)\n</code></pre>\n\n<p>This means you can use the ellipsis <code>...</code> to pass a slice value as the value of the variadic parameter, but that slice must be of type <code>[]interface{}</code>, e.g.:</p>\n\n<pre><code>var args []interface{}\nfor _, v := range r.Form[\"type\"] {\n    t, _ := strconv.Atoi(v)\n    args = append(args, t)\n}\n\n// ...\n\nrows, err := stmt.Query(args...)\n</code></pre>\n\n<p>As an alternative, you could pre-build the SQL query and execute without passing query arguments, for an example see <a href=\"https://stackoverflow.com/a/38037586/1705598\">Go and IN clause in Postgres</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2094540"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2428, "favorite_count": 1, "accepted_answer_id": 39223999, "answer_count": 1, "score": 3, "last_activity_date": 1472551002, "creation_date": 1472549690, "last_edit_date": 1495540849, "question_id": 39223856, "link": "https://stackoverflow.com/questions/39223856/golang-mysql-querying-undefined-amount-of-args-using-in-operator", "title": "Golang MySQL querying undefined amount of args using IN operator", "body": "<p>I'm trying to use a MySQL query using the IN operator with undefined amount of arguments into my Golang project.</p>\n\n<p>I'm using the package <code>github.com/go-sql-driver/mysql</code> and tried to build my solution on this Stackoverflow answer : <a href=\"https://stackoverflow.com/questions/20271123/how-to-execute-an-in-lookup-in-sql-using-golang?answertab=votes#tab-top\">How to execute an IN lookup in SQL using Golang?</a></p>\n\n<p>I've read some similar posts giving me some advices about the way to go, but I'm stuck on the execution part of the query, because it does not allow the direct use of a slice as argument.</p>\n\n<pre><code>//converting my form args []string into []int\nvar args []int\nfor _, v := range r.Form[\"type\"] {\n    t, _ := strconv.Atoi(v)\n    args = append(args, t)\n}\n\nsql := \"SELECT id, name FROM resources WHERE id IN (SELECT resource_id FROM resources_types WHERE type_id IN (?\" + strings.Repeat(\",?\", len(args)-1) + \"))\"\nfmt.Println(\"Query : \", sql)\nstmt, _ := db.Prepare(sql)\nrows, err := stmt.Query(args)\ndefer stmt.Close()\n</code></pre>\n\n<p>Golang returns me an error at execution :</p>\n\n<blockquote>\n  <p>Query : SELECT id, name FROM resources WHERE id IN (SELECT resource_id\n  FROM resources_types WHERE type_id IN (?,?)) \n  \"sql: statement expects 2 inputs; got 1\"</p>\n</blockquote>\n\n<p>It works when I try with </p>\n\n<pre><code>rows, err := stmt.Query(args[0], args[1])\n</code></pre>\n\n<p>But as I need an undefined number of arguments, it isn't a solution. Is it at least possible to get it working with MySQL ?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472550709, "post_id": 39223754, "comment_id": 65785953, "body": "You can set Contact Type of type <code>interface</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "is_accepted": true, "score": 3, "last_activity_date": 1472551021, "creation_date": 1472551021, "answer_id": 39224363, "question_id": 39223754, "link": "https://stackoverflow.com/questions/39223754/unmarshalling-json-to-structure-using-json-rawmessage/39224363#39224363", "title": "Unmarshalling json to structure using json.RawMessage", "body": "<p>You will need to do the unmarshalling yourself. There is a very good article that shows how to use the json.RawMessage right and a number of other solutions to this very problem, Like using interfaces, RawMessage, implemention your own unmarshal and decode functions etc.</p>\n\n<p>You will find the article here: <a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\" rel=\"nofollow\" title=\"JSON decoding In GO\">JSON decoding in GO by Attila Ol\u00e1h</a>\n<em>Note: Attila has made a few errors on his code examples.</em></p>\n\n<p>I taken the liberty to put together (using some of the code from Attila) a working example using RawMessage to delay the unmarshaling so we can do it on our own version of the Decode func.</p>\n\n<p><a href=\"https://play.golang.org/p/6Iuoyzu2c1\" rel=\"nofollow\">Link to GOLANG Playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"io\"\n)\n\ntype Record struct {\n    AuthorRaw json.RawMessage `json:\"author\"`\n    Title     string          `json:\"title\"`\n    URL       string          `json:\"url\"`\n\n    Author Author\n}\n\ntype Author struct {\n    ID    uint64 `json:\"id\"`\n    Email string `json:\"email\"`\n}\n\nfunc Decode(r io.Reader) (x *Record, err error) {\n    x = new(Record)\n    if err = json.NewDecoder(r).Decode(x); err != nil {\n        return\n    }\n    if err = json.Unmarshal(x.AuthorRaw, &amp;x.Author); err == nil {\n        return\n    }\n    var s string\n    if err = json.Unmarshal(x.AuthorRaw, &amp;s); err == nil {\n        x.Author.Email = s\n        return\n    }\n    var n uint64\n    if err = json.Unmarshal(x.AuthorRaw, &amp;n); err == nil {\n        x.Author.ID = n\n    }\n    return\n}\n\nfunc main() {\n\n    byt_1 := []byte(`{\"author\": 2,\"title\": \"some things\",\"url\": \"https://stackoverflow.com\"}`)\n\n    byt_2 := []byte(`{\"author\": \"Mad Scientist\",\"title\": \"some things\",\"url\": \"https://stackoverflow.com\"}`)\n\n    var dat Record\n\n    if err := json.Unmarshal(byt_1, &amp;dat); err != nil {\n            panic(err)\n    }\n    fmt.Printf(\"%#s\\r\\n\", dat)\n\n    if err := json.Unmarshal(byt_2, &amp;dat); err != nil {\n            panic(err)\n    }\n    fmt.Printf(\"%#s\\r\\n\", dat)\n}\n</code></pre>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 33, "user_id": 2323984, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c4898353dcad18cab82397dd0149a8f1?s=128&d=identicon&r=PG", "display_name": "Rupali Bhatnagar", "link": "https://stackoverflow.com/users/2323984/rupali-bhatnagar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3824, "favorite_count": 1, "accepted_answer_id": 39224363, "answer_count": 1, "score": 2, "last_activity_date": 1472551021, "creation_date": 1472549417, "question_id": 39223754, "link": "https://stackoverflow.com/questions/39223754/unmarshalling-json-to-structure-using-json-rawmessage", "title": "Unmarshalling json to structure using json.RawMessage", "body": "<p>I need to unmarshal json object which may have the following formats:-</p>\n\n<pre><code>Format1:\n\n    {\n    \"contactType\": 2,\n    \"value\": \"0123456789\"\n    }\n\nFormat2:\n\n    {\n    \"contactType\": \"MobileNumber\",\n    \"value\": \"0123456789\"\n    }\n</code></pre>\n\n<p>The structure I'm using for unmarshalling is:-</p>\n\n<pre><code>    type Contact struct {\n    ContactType int    `json:\"contactType\"` \n    Value       string `json:\"value\"`\n    }\n</code></pre>\n\n<p>But this works only for format 1. I dont want to change the datatype of ContactType but I want to accomodate the 2nd format as well. I heard about json.RawMarshal and tried using it. </p>\n\n<pre><code>    type Contact struct {\n        ContactType        int\n        Value       string          `json:\"value\"`\n        Type json.RawMessage `json:\"contactType\"\n    }\n\n    type StringContact struct {\n    Type string `json:\"contactType\"`\n    }\n\n    type IntContact struct {\n    Type int `json:\"contactType\"`\n    } \n</code></pre>\n\n<p>This gets the unmarshaling done, but I'm unable to set the ContactType variable which depends on the type of json.RawMessage. How do I model my structure so that this problem gets solved?</p>\n"}, {"tags": ["go", "ibm-cloud", "blockchain", "hyperledger"], "answers": [{"comments": [{"owner": {"reputation": 1856, "user_id": 321959, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/043bab1fc4575bce3a75aa90f7ffd040?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/321959/dinesh"}, "edited": false, "score": 0, "creation_date": 1472553819, "post_id": 39219530, "comment_id": 65788055, "body": "i have tried from the same path as mentioned in the instructions page. still got the same error"}], "tags": [], "owner": {"reputation": 11022, "user_id": 317916, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21dda5ab7f19b2cf21502358eb0410e1?s=128&d=identicon&r=PG", "display_name": "cbednarski", "link": "https://stackoverflow.com/users/317916/cbednarski"}, "is_accepted": false, "score": 0, "last_activity_date": 1472535801, "creation_date": 1472535801, "answer_id": 39219530, "question_id": 39219196, "link": "https://stackoverflow.com/questions/39219196/no-buildable-go-source-files-error-in-chain-code-examples/39219530#39219530", "title": "no buildable Go source files error in Chain Code Examples", "body": "<p>You are running <code>go build</code> from the wrong directory. You are in <code>$GOPATH/src/github.com/hyperledger/fabric/core/crypto/attributes/proto</code> but you should be in <code>$GOPATH/src/github.com/&lt;yourgithubid&gt;/learn-chaincode/start</code>. Check out <a href=\"https://github.com/IBM-Blockchain/learn-chaincode#deploying-chaincode-to-ibm-bluemix\" rel=\"nofollow\">the instructions</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5933044, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208740524736182/picture?type=large", "display_name": "JFS", "link": "https://stackoverflow.com/users/5933044/jfs"}, "is_accepted": false, "score": 1, "last_activity_date": 1472587667, "creation_date": 1472587667, "answer_id": 39236241, "question_id": 39219196, "link": "https://stackoverflow.com/questions/39219196/no-buildable-go-source-files-error-in-chain-code-examples/39236241#39236241", "title": "no buildable Go source files error in Chain Code Examples", "body": "<p>@Dinesh, you need to <code>make protos</code> in order for the file to be created in that folder (core/crypto/attributes/proto)</p>\n"}, {"tags": [], "owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "is_accepted": true, "score": 3, "last_activity_date": 1472632826, "creation_date": 1472632826, "answer_id": 39244725, "question_id": 39219196, "link": "https://stackoverflow.com/questions/39219196/no-buildable-go-source-files-error-in-chain-code-examples/39244725#39244725", "title": "no buildable Go source files error in Chain Code Examples", "body": "<p>Actually it was a bug after the update and it has already been addressed. \nAs per the following,\n<a href=\"https://github.com/hyperledger/fabric/commit/af5f75d3fb52ee5cd607abfef4324fc049153268\" rel=\"nofollow\">https://github.com/hyperledger/fabric/commit/af5f75d3fb52ee5cd607abfef4324fc049153268</a>. </p>\n\n<blockquote>\n  <p>Revert \"Upgrade go protobuff from 3-beta to 3\" This reverts commit\n  a98c59a.</p>\n  \n  <p>We are experiencing several failures related to this merge, so lets\n  revert it for now and re-group</p>\n</blockquote>\n\n<p>Please pull the latest version and it will work smoothly</p>\n"}], "owner": {"reputation": 1856, "user_id": 321959, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/043bab1fc4575bce3a75aa90f7ffd040?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/321959/dinesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "accepted_answer_id": 39244725, "answer_count": 3, "score": 1, "last_activity_date": 1475348098, "creation_date": 1472534062, "question_id": 39219196, "link": "https://stackoverflow.com/questions/39219196/no-buildable-go-source-files-error-in-chain-code-examples", "title": "no buildable Go source files error in Chain Code Examples", "body": "<p>I have just started learning GO and ChainCode. I have followed the instructions mentioned in the following URL to learn programming chain code</p>\n\n<p><a href=\"https://github.com/IBM-Blockchain/learn-chaincode\" rel=\"nofollow\">https://github.com/IBM-Blockchain/learn-chaincode</a></p>\n\n<p>i have setup the code and ran the  command <code>$ go build ./</code></p>\n\n<p>but i am getting the following error </p>\n\n<blockquote>\n  <p>../../../hyperledger/fabric/core/crypto/attributes/attributes.go:28:2:\n  no buildable Go source files in\n  /home/serveradmin/gowork/src/github.com/hyperledger/fabric/core/crypto/attributes/proto</p>\n</blockquote>\n\n<p>let me know, if anyone come across this error and fixed it </p>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 4, "creation_date": 1472532343, "post_id": 39218899, "comment_id": 65775925, "body": "<code>sort.Ints</code> takes a slice, not an array."}], "answers": [{"comments": [{"owner": {"reputation": 312, "user_id": 5190474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8roC.jpg?s=128&g=1", "display_name": "Jose Thomas", "link": "https://stackoverflow.com/users/5190474/jose-thomas"}, "edited": false, "score": 1, "creation_date": 1472532941, "post_id": 39218942, "comment_id": 65776118, "body": "What change is arr[:] actually making?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 312, "user_id": 5190474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8roC.jpg?s=128&g=1", "display_name": "Jose Thomas", "link": "https://stackoverflow.com/users/5190474/jose-thomas"}, "edited": false, "score": 3, "creation_date": 1472533068, "post_id": 39218942, "comment_id": 65776160, "body": "@JoseThomas: read over this <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>."}, {"owner": {"reputation": 312, "user_id": 5190474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8roC.jpg?s=128&g=1", "display_name": "Jose Thomas", "link": "https://stackoverflow.com/users/5190474/jose-thomas"}, "edited": false, "score": 0, "creation_date": 1472533094, "post_id": 39218942, "comment_id": 65776167, "body": "What is the complexity of this default sort function?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 312, "user_id": 5190474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8roC.jpg?s=128&g=1", "display_name": "Jose Thomas", "link": "https://stackoverflow.com/users/5190474/jose-thomas"}, "edited": false, "score": 5, "creation_date": 1472533297, "post_id": 39218942, "comment_id": 65776225, "body": "There is no &quot;default sort function&quot; as far as sorting algorithm used.  Go uses different algorithms based on some criteria.  You can read through them in the comments or by following along the code here: <a href=\"https://golang.org/src/sort/sort.go\" rel=\"nofollow noreferrer\">golang.org/src/sort/sort.go</a>"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 16, "last_activity_date": 1472532497, "creation_date": 1472532497, "answer_id": 39218942, "question_id": 39218899, "link": "https://stackoverflow.com/questions/39218899/how-to-sort-integer-array-in-golang-using-default-sort-function/39218942#39218942", "title": "How to sort integer array in golang using default sort function", "body": "<p><code>sort.Ints</code> expects a slice of int, not an array.  Easiest fix is to change</p>\n\n<pre><code>sort.Ints(arr)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>sort.Ints(arr[:])\n</code></pre>\n"}], "owner": {"reputation": 312, "user_id": 5190474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8roC.jpg?s=128&g=1", "display_name": "Jose Thomas", "link": "https://stackoverflow.com/users/5190474/jose-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8950, "favorite_count": 0, "accepted_answer_id": 39218942, "answer_count": 1, "score": 9, "last_activity_date": 1472532497, "creation_date": 1472532200, "question_id": 39218899, "link": "https://stackoverflow.com/questions/39218899/how-to-sort-integer-array-in-golang-using-default-sort-function", "title": "How to sort integer array in golang using default sort function", "body": "<p>A stupid question. I can't sort using default sort function in go</p>\n\n<pre><code>    package main\n    import \"fmt\"\n    import \"sort\"\n    func main(){\n            var arr [5]int\n            fmt.Println(\"Enter 5 elements\")\n            for i:=0;i&lt;5;i++{\n                    fmt.Scanf(\"%d\",&amp;arr[i])\n            }\n            sort.Ints(arr)\n            fmt.Println(arr)\n    }\n</code></pre>\n\n<p>When executing the above program, It throws out</p>\n\n<pre><code>cannot use arr (type [5]int) as type []int in argument to sort.Ints\n</code></pre>\n\n<p>Need Help.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "edited": false, "score": 0, "creation_date": 1472542493, "post_id": 39221150, "comment_id": 65780637, "body": "Column(&quot;id&quot;, &quot;name&quot;) call every time no good practic. I have dozens tables with special fields. Maybe i can specify mapping between struct fields and table fields?"}], "tags": [], "owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "is_accepted": false, "score": 0, "last_activity_date": 1472541461, "creation_date": 1472541461, "answer_id": 39221150, "question_id": 39218841, "link": "https://stackoverflow.com/questions/39218841/go-pg-different-count-fields-in-struct-and-table/39221150#39221150", "title": "go-pg different count fields in struct and table", "body": "<p>Read <a href=\"https://github.com/go-pg/pg#select\" rel=\"nofollow\">go-pg manual</a>. There's an example, for your case is:</p>\n\n<pre><code>err := db.Model(&amp;unit).Column(\"id\", \"name\").Where(\"id = ?\", id).Select()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "is_accepted": false, "score": 0, "last_activity_date": 1472561494, "creation_date": 1472561494, "answer_id": 39228036, "question_id": 39218841, "link": "https://stackoverflow.com/questions/39218841/go-pg-different-count-fields-in-struct-and-table/39228036#39228036", "title": "go-pg different count fields in struct and table", "body": "<p>In version 4.8.10 go-pg this bug fixed. If db table contain fields which not exist in structure error will not occur. </p>\n"}], "owner": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 546, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1472561494, "creation_date": 1472531773, "question_id": 39218841, "link": "https://stackoverflow.com/questions/39218841/go-pg-different-count-fields-in-struct-and-table", "title": "go-pg different count fields in struct and table", "body": "<p>I use go-pg library and specify row in table \"unit\"</p>\n\n<pre><code>type UnitModel struct {\n    Id int\n    Name string\n\n    TableName struct{} `sql:\"unit\"`\n}\n</code></pre>\n\n<p>but table unit contains more then 2 fields and when i call</p>\n\n<pre><code>var unit UnitModel\nerr := db.Model(&amp;unit).Where(\"id = ?\", id).Select()\n</code></pre>\n\n<p>get error \"pg: can't find column alter_name in model\".\nHow specify ignore other fields in table \"unit\"?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 1823, "user_id": 5735460, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/R0BH2.png?s=128&g=1", "display_name": "Smita Ahinave", "link": "https://stackoverflow.com/users/5735460/smita-ahinave"}, "edited": false, "score": 0, "creation_date": 1472532428, "post_id": 39218354, "comment_id": 65775949, "body": "where is your non working code?"}, {"owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "reply_to_user": {"reputation": 1823, "user_id": 5735460, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/R0BH2.png?s=128&g=1", "display_name": "Smita Ahinave", "link": "https://stackoverflow.com/users/5735460/smita-ahinave"}, "edited": false, "score": 0, "creation_date": 1472536586, "post_id": 39218354, "comment_id": 65777407, "body": "@sss with the question, now."}], "owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472536562, "creation_date": 1472527817, "last_edit_date": 1472536562, "question_id": 39218354, "link": "https://stackoverflow.com/questions/39218354/get-an-array-for-a-date-range-from-an-embedded-document-in-a-collection", "title": "Get an array for a date range from an embedded document in a collection", "body": "<p>So, inside a collection I have many documents, each document have embedded an array of documents, each of these documents inside the embedded array have many fields, among them, a \"date time\" field.</p>\n\n<p>What I want to do is to get an array for a date range from such embedded array of documents, however I don't know how to do this. I'm using MongoDB 3.2.</p>\n\n<p>I'm using the mgo driver for the Go programming language, but a mongo-shell example can work for me, too.</p>\n\n<p>My non-working code:</p>\n\n<pre><code>documents := []Movement{}\nm := mongo.DB(config.DB.Name).C(\"users\")\n// Hacemos la busqueda en la base de datos\nm.Find(bson.M{\"tuid\": update.Message.From.ID, \"movements\": bson.M{\"$gt\": startdate, \"$lte\": enddate}}).All(&amp;documents)\n</code></pre>\n"}, {"tags": ["go", "emacs", "gofmt"], "answers": [{"comments": [{"owner": {"reputation": 1036, "user_id": 5523033, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/K5pxl.jpg?s=128&g=1", "display_name": "Andrei", "link": "https://stackoverflow.com/users/5523033/andrei"}, "edited": false, "score": 0, "creation_date": 1472559940, "post_id": 39219534, "comment_id": 65792019, "body": "Makes a lot more sense, as they are windows environments and it didn&#39;t work on another windows machine."}, {"owner": {"reputation": 1036, "user_id": 5523033, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/K5pxl.jpg?s=128&g=1", "display_name": "Andrei", "link": "https://stackoverflow.com/users/5523033/andrei"}, "edited": false, "score": 0, "creation_date": 1472564096, "post_id": 39219534, "comment_id": 65795005, "body": "worked like a charm! There was nothing on the net that was helping me figure out that issue. +1000 for you!"}], "tags": [], "owner": {"reputation": 81, "user_id": 6754825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8932c18d952aecc71d2afe09f74983?s=128&d=identicon&r=PG&f=1", "display_name": "cjdp", "link": "https://stackoverflow.com/users/6754825/cjdp"}, "is_accepted": true, "score": 2, "last_activity_date": 1472536308, "last_edit_date": 1472536308, "creation_date": 1472535833, "answer_id": 39219534, "question_id": 39217913, "link": "https://stackoverflow.com/questions/39217913/emacs-golang-gofmt-on-save-hook-not-formatting/39219534#39219534", "title": "Emacs Golang gofmt on save hook - not formatting", "body": "<p>diff is the name of a command to compare files line by line which is usually distributed with unix-derived operating systems.</p>\n\n<p>You could try to install these utilities on windows:</p>\n\n<p><a href=\"http://gnuwin32.sourceforge.net/packages/diffutils.htm\" rel=\"nofollow\">http://gnuwin32.sourceforge.net/packages/diffutils.htm</a></p>\n\n<p>to see if that helps.</p>\n"}], "owner": {"reputation": 1036, "user_id": 5523033, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/K5pxl.jpg?s=128&g=1", "display_name": "Andrei", "link": "https://stackoverflow.com/users/5523033/andrei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1516, "favorite_count": 0, "accepted_answer_id": 39219534, "answer_count": 1, "score": 5, "last_activity_date": 1472536308, "creation_date": 1472524181, "last_edit_date": 1472529069, "question_id": 39217913, "link": "https://stackoverflow.com/questions/39217913/emacs-golang-gofmt-on-save-hook-not-formatting", "title": "Emacs Golang gofmt on save hook - not formatting", "body": "<p>after checking path with M-: (eval \"<strong>PATH</strong>\") the location of <em>C:/Go/bin</em> shows up, so I know the <a href=\"/questions/tagged/gofmt\" class=\"post-tag\" title=\"show questions tagged &#39;gofmt&#39;\" rel=\"tag\">gofmt</a> binary is found. If i try to do M-x gofmt on other files it will give proper errors (not *.go files).</p>\n\n<p>however I noticed something weird in the <em>Messages</em> which is where the gofmt is trying to format..</p>\n\n<blockquote>\n  <p>Calling gofmt: gofmt (-w c:/Users/LunchBox/AppData/Local/Temp/gofmt5200q9o.go)<br>\n  Error: (file-error \"Searching for program\" \"no such file or directory\" \"diff\")</p>\n</blockquote>\n\n<p>why is it looking in the <em>-w /appdata/locals/temp/etc</em>..?<br>\nshouldn't it be the file I'm working on currently? which is just called ovRESTful.go in c:/work/users/ovRESTful/ovRESTful.go</p>\n\n<p>the line I have for my code..  </p>\n\n<pre><code>(add-hook 'before-save-hook 'gofmt-before-save)\n</code></pre>\n"}, {"tags": ["go", "lua", "eval"], "answers": [{"comments": [{"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1472682385, "post_id": 39218145, "comment_id": 65855877, "body": "I think this is an excellent solution in the case where the expressions required are rather simple. This may well be the answer for some problems. However, the template language doesn&#39;t support much more than simple comparison statements. (string manipulation and things like that are not possible)"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1472720846, "post_id": 39218145, "comment_id": 65869102, "body": "@Jacob You can inject custom function into the template context for more complicated stuff."}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1472792086, "post_id": 39218145, "comment_id": 65903276, "body": "True, but then you would have to create a whole suite of functions\u2014predicting which sort of things a user creating an expression might want to use.  (i.e. How much of the go &quot;strings&quot; package would you need to wrap up and expose?) Could work, but it won&#39;t in my case."}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 1, "last_activity_date": 1472526482, "last_edit_date": 1472526482, "creation_date": 1472526222, "answer_id": 39218145, "question_id": 39217590, "link": "https://stackoverflow.com/questions/39217590/passing-expressions-to-be-evaluated-within-a-go-application/39218145#39218145", "title": "Passing expressions to be evaluated within a go application?", "body": "<p>Maybe you can use the <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow\"><code>text.template</code></a> package for the evaluation of your input.<br>\nAnd later parse the output of it for the result of the entered expression.</p>\n\n<p>This is was a few Go build tools do. For example <code>docker inspect</code> uses this for formatting its output.</p>\n"}], "owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 39218145, "answer_count": 1, "score": 2, "last_activity_date": 1472526482, "creation_date": 1472521276, "last_edit_date": 1472522090, "question_id": 39217590, "link": "https://stackoverflow.com/questions/39217590/passing-expressions-to-be-evaluated-within-a-go-application", "title": "Passing expressions to be evaluated within a go application?", "body": "<p>I have a go command line application, that has a search function to scan a list of objects (structs). I want to be able to invoke that search function, i.e. instead of just</p>\n\n<pre><code>mycmd search bob\n</code></pre>\n\n<p>Perhaps I can do:</p>\n\n<pre><code>mycmd search 'o.Name() == \"bob\"'\nmycmd search 'len(o.PhoneNumbers()) &gt; 1'\nmycmd search 'strings.Index(o.Name(), \"bob\") &gt;= 0'\n</code></pre>\n\n<p>Is it possible to process an expression like this, within a loop in your <code>go</code> code? If this is not possible, what is the simplest and most standard way to approach this in GO, without creating my own expression language/evaluator?</p>\n\n<p>(I can see we have things like <code>go-v8</code> and <code>golua</code>, however I'm not sure if this is the right way to think about it?)</p>\n\n<p><strong>NOTE:</strong> its a personal script, security concerns are out of scope.</p>\n"}, {"tags": ["rest", "http", "url", "go", "go-restful"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 6300904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c9f70e6a80328ab862790b5e5b3830?s=128&d=identicon&r=PG&f=1", "display_name": "tct", "link": "https://stackoverflow.com/users/6300904/tct"}, "is_accepted": true, "score": 1, "last_activity_date": 1472534598, "last_edit_date": 1472534598, "creation_date": 1472517143, "answer_id": 39217161, "question_id": 39216053, "link": "https://stackoverflow.com/questions/39216053/how-to-get-the-full-host-and-url-in-go-restful/39217161#39217161", "title": "How to get the full host and url in go-restful", "body": "<p>After playing with this for a while, I ended up trying it both ways. It turns out that at least some of the information can be extracted from <code>Request</code> (note: I presume that if the route were defined with an absolute url then all of this information could be had from <code>Request.URL</code>)</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/emicklei/go-restful\"\n    \"io\"\n    \"net/http\"\n)\n\nfunc main() {\n    ws := new(restful.WebService)\n    ws.Route(ws.GET(\"/hello\").To(hello))\n    restful.Add(ws)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc hello(req *restful.Request, resp *restful.Response) {\n    io.WriteString(resp, \"Protocol: \" + req.Request.Proto + \"\\nHost: \" + req.Request.Host + \"\\nPath: \" + req.Request.URL.Path)\n}\n</code></pre>\n\n<p>The above prints the following to the browser. I suppose one could use this to construct urls to jsonify, although it's not clear how the base path would be parsed out without some prior knowledge of either the base path or the specific path, or some syntactic convention for distinguishing the two.</p>\n\n<pre><code>Protocol: HTTP/1.1\nHost: localhost:8080\nPath: /hello\n</code></pre>\n\n<p>The second thing I tried was to define a <code>URL</code> at package level and use that to build a custom parse function. <code>url.URL</code> maintains a struct representation of a URL; A relative (or absolute) path can be parsed and merged with an existing <code>URL</code> using <code>URL.parse(string)</code>. Conveniently, <code>URL</code> can output a string representation of itself via it's String() method. </p>\n\n<p>The custom parse function simply holds on to a copy of the package level <code>URL</code>, and each time it is called with some specific path it pastes the new path on to the end of the <code>URL.Path</code> and returns a new <code>URL</code> that's identical except for the new concatenated path (because that's what <code>URL.parse()</code> does when we hand it a relative path). <code>URL.String()</code> can then be called on the new URL to stringify the <code>URL</code> into the string that we want to marshal.  </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/emicklei/go-restful\"\n    \"io\"\n    \"net/http\"\n    \"net/url\"\n    \"fmt\"\n    \"encoding/json\"\n)\n\nvar myurl = url.URL{\nScheme:\"http\",\nHost: \"localhost:8080\",\nPath:\"basepath\",\n}\n\nvar parse = getParseFn(myurl)\n\nfunc main() {\n    ws := new(restful.WebService)\n    ws.Route(ws.GET(\"/jsonUrls\").To(jsonUrls))\n    restful.Add(ws)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc jsonUrls(req *restful.Request, resp *restful.Response) {\n    urls := []string{}\n    for _, s := range []string{\"get\", \"put\", \"whatever\"} {\n        u, err := parse(s)\n        if err != nil {\n            fmt.Println(err)\n        }\n        urls = append(urls, u.String())\n    }\n    json_urls, err := json.Marshal(urls)\n    if err != nil {\n        fmt.Println(err)\n    }\n    io.WriteString(resp, string(json_urls))\n}\n\nfunc getParseFn (myUrl url.URL) func (string) (*url.URL, error) {\n    parse := func (s string) (*url.URL, error) {\n        u, err := myUrl.Parse(myUrl.Path + \"/\" + s)\n        return u, err\n    }\n    return parse\n} \n</code></pre>\n\n<p>This prints the following in the browser: </p>\n\n<pre><code>[\"http://localhost:8080/basepath/get\",\"http://localhost:8080/basepath/put\",\"http://localhost:8080/basepath/whatever\"]\n</code></pre>\n"}], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "accepted_answer_id": 39217161, "answer_count": 1, "score": 1, "last_activity_date": 1490628820, "creation_date": 1472509181, "last_edit_date": 1490628820, "question_id": 39216053, "link": "https://stackoverflow.com/questions/39216053/how-to-get-the-full-host-and-url-in-go-restful", "title": "How to get the full host and url in go-restful", "body": "<p>I'm writing a REST API in Go using <a href=\"https://github.com/emicklei/go-restful\" rel=\"nofollow\">https://github.com/emicklei/go-restful</a></p>\n\n<p>In my JSON output I want to output absolute path to other REST resources, but I don't know how I can obtain all the relevant parts to build the Path, such as transport (http/https), host, port, root path. </p>\n\n<p>Do I need to keep track of this myself, do I fetch it from the <code>Request</code> somehow?</p>\n"}, {"tags": ["html", "json", "forms", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472507730, "post_id": 39215772, "comment_id": 65770197, "body": "Your not checking the error from <code>f.Write</code>, always check errors. Your file is read only."}, {"owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472508061, "post_id": 39215772, "comment_id": 65770312, "body": "Unfortunately that doesn&#39;t appear to be the case unless something is escaping me re: file permissions. The permissions for &quot;deck.json&quot; are currently set to allow for all users to read/write/execute."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472508377, "post_id": 39215772, "comment_id": 65770406, "body": "No, it is the case, check the error from <code>Write</code>. You&#39;re opening the file with O_RDONLY: <a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Open</a>"}, {"owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472509524, "post_id": 39215772, "comment_id": 65770738, "body": "Sorry, I&#39;m still misunderstanding, and I&#39;m at a loss as to how to error check Write after searching, but after reading the documentation more thoroughly, I see now that os.Open DOES default to O_RDONLY, but I&#39;m also wondering how or why that would matter if the permissions for the file itself are set to 0666? Is it the way that Go is opening the file that does this only at the moment the code is executed? At any rate, I&#39;ve amended the line to specify the following: f, err := os.OpenFile(&quot;deck.json&quot;, os.O_APPEND, 0666)"}, {"owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472511003, "post_id": 39215772, "comment_id": 65771186, "body": "@JimB implemented the error check from go by example for f.Write and didn&#39;t turn anything up: <a href=\"https://gobyexample.com/writing-files\" rel=\"nofollow noreferrer\">gobyexample.com/writing-files</a> Also tried re-specifying  <code>f, err := os.OpenFile(&quot;deck.json&quot;, os.O_RDWR, 0666)</code> to no avail. What am I not getting?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472522074, "post_id": 39215772, "comment_id": 65773705, "body": "You are also putting the <code>&#47;</code> handler first, so you can&#39;t access the <code>&#47;addcard</code> handler at all. That last comment will also fail to create a file without <code>O_CREATE</code>. The file permissions have nothing to do with the flags you use to open the file -- this isn&#39;t specific to Go, it&#39;s how POSIX OS&#39;s work. Check your errors, and add some logging to your code, and you&#39;ll see what&#39;s going on"}, {"owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472570126, "post_id": 39215772, "comment_id": 65799530, "body": "Thanks for the pointers. Much appreciated from someone brand new to systems programming!"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "is_accepted": true, "score": 1, "last_activity_date": 1472669158, "creation_date": 1472669158, "answer_id": 39256884, "question_id": 39215772, "link": "https://stackoverflow.com/questions/39215772/marshalling-html-form-input-to-json-and-writing-to-file-golang/39256884#39256884", "title": "Marshalling HTML form input to JSON and writing to file, golang", "body": "<p>Changed per recommendations made by @JimB. Fixed handler order, and program successfully concatenates each successive submission as valid JSON to the file in question.</p>\n\n<p>HTML:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;title&gt;Flashcards for Learning JS&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n   &lt;br&gt;\n&lt;form action=\"/addcard\" method=\"post\"&gt;\n   &lt;input type=\"text\" name=\"term\" placeholder=\"Term\"&gt;\n   &lt;br&gt;\n   &lt;br&gt;\n   &lt;input type=\"text\" name=\"definition\" placeholder=\"Definition\"&gt;\n   &lt;br&gt;\n   &lt;br&gt;\n   &lt;input type=\"submit\" value=\"Add Card\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>GO:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"html/template\"\n    \"net/http\"\n    \"os\"\n)\n\ntype Card struct { //defining the data structure for our virtual flashcards\n    Term       string `json:\"Term\"`\n    Definition string `json:\"Definition\"`\n}\n\nfunc open(w http.ResponseWriter, r *http.Request) {\n    t, _ := template.ParseFiles(\"addcard.html\")\n    t.Execute(w, nil)\n}\n\nfunc addcard(w http.ResponseWriter, r *http.Request) {\n    f, err := os.OpenFile(\"deck.json\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n    defer f.Close()\n\n    card := new(Card)\n    card.Term = r.FormValue(\"term\")\n    card.Definition = r.FormValue(\"definition\")\n\n    b, err := json.Marshal(card)\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    f.Write(b)\n    f.Close()\n}\n\nfunc main() {\n    http.HandleFunc(\"/addcard\", addcard)\n    http.HandleFunc(\"/\", open)\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6771971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_-dC9p6A7dg/AAAAAAAAAAI/AAAAAAAAAm4/MEC-6-4xi94/photo.jpg?sz=128", "display_name": "minauteur", "link": "https://stackoverflow.com/users/6771971/minauteur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2560, "favorite_count": 0, "accepted_answer_id": 39256884, "answer_count": 1, "score": 1, "last_activity_date": 1472669158, "creation_date": 1472507634, "last_edit_date": 1495535624, "question_id": 39215772, "link": "https://stackoverflow.com/questions/39215772/marshalling-html-form-input-to-json-and-writing-to-file-golang", "title": "Marshalling HTML form input to JSON and writing to file, golang", "body": "<p><a href=\"https://stackoverflow.com/questions/12513963/how-to-read-input-from-a-html-form-and-save-it-in-a-file-golang/39215607#39215607\">This</a> appeared as if it might answer my question, however I am not able to make the output write/save properly to \"somefile.json\" ( named \"deck.json\" in my code) no matter what I have tried. My guess is that the form input and the writer are missing each other due to the file being opened/closed at the wrong times, but I honestly do not know. I am attempting to shoehorn this example into a form that allows for a user to input terms and definitions that will save to a JSON file which will be referenced by a JavaScript-powered \"flash card\" app housed on another page. </p>\n\n<p>Here is the code I have at this moment:</p>\n\n<p>HTML:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;title&gt;Flashcards for Learning JS&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n   &lt;br&gt;\n&lt;form action=\"/addcard\" method=\"post\"&gt;\n   &lt;input type=\"text\" name=\"term\" placeholder=\"Term\"&gt;\n   &lt;br&gt;\n   &lt;br&gt;\n   &lt;input type=\"text\" name=\"definition\" placeholder=\"Definition\"&gt;\n   &lt;br&gt;\n   &lt;br&gt;\n   &lt;input type=\"submit\" value=\"Add Card\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>GO:</p>\n\n<pre><code> package main\n\nimport (\n    \"encoding/json\"\n    \"html/template\"\n    \"net/http\"\n    \"os\"\n)\n\ntype Card struct {\n    Term       string `json:\"term\"`\n    Definition string `json:\"definition\"`\n}\n\nfunc open(w http.ResponseWriter, r *http.Request) {\n    t, _ := template.ParseFiles(\"Form.html\")\n    t.Execute(w, nil)\n}\n\nfunc addcard(w http.ResponseWriter, r *http.Request) {\n    f, err := os.Open(\"deck.json\")\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    card := new(Card)\n    card.Term = r.FormValue(\"term\")\n    card.Definition = r.FormValue(\"definition\")\n\n    b, err := json.Marshal(card)\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    f.Write(b)\n    f.Close()\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", open)\n    http.ListenAndServe(\":8080\", nil)\n    http.HandleFunc(\"/addcard\", addcard)\n}\n</code></pre>\n"}, {"tags": ["go", "import", "package", "vendor"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1472506982, "post_id": 39215629, "comment_id": 65769945, "body": "You don&#39;t need to push or pull anything, they are just files in your GOPATH."}, {"owner": {"reputation": 812, "user_id": 1294921, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/378866033a7028eda9f30ae61c26b70f?s=128&d=identicon&r=PG", "display_name": "Imran Latif", "link": "https://stackoverflow.com/users/1294921/imran-latif"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472507213, "post_id": 39215629, "comment_id": 65770020, "body": "Then why does my local changes are not being updated? There might be some problems with my $GOPATH? I&#39; am using gvm."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1472507406, "post_id": 39215629, "comment_id": 65770087, "body": "If they&#39;re not being updated, then you&#39;re not editing the version in your GOPATH. It&#39;s probably easier to use the go tools directly (without gvm) to understand how they work first. Start here if you haven&#39;t yet: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 812, "user_id": 1294921, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/378866033a7028eda9f30ae61c26b70f?s=128&d=identicon&r=PG", "display_name": "Imran Latif", "link": "https://stackoverflow.com/users/1294921/imran-latif"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472507677, "post_id": 39215629, "comment_id": 65770183, "body": "Thanks for commenting. BTW, packages installed in the vendor folder is always getting precedence over my changes in packages. I&#39; am confused."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472507962, "post_id": 39215629, "comment_id": 65770282, "body": "Yes, <code>vendor&#47;</code> takes precedence of GOPATH. That&#39;s why I suggested starting with the basics using only the go tools, and adding other functionality when you find you need it. If you need to use a vendor directory, you need to update the code in there, usually using 3rd party tools to do so."}, {"owner": {"reputation": 812, "user_id": 1294921, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/378866033a7028eda9f30ae61c26b70f?s=128&d=identicon&r=PG", "display_name": "Imran Latif", "link": "https://stackoverflow.com/users/1294921/imran-latif"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472508303, "post_id": 39215629, "comment_id": 65770387, "body": "Thanks for explaining the <code>vendor&#47;</code> thing. Basically I&#39; am working on an already developed App which was using <code>vendor</code> folder. So just to clear, if the former developer might not have been using <code>vendor</code> then changing code in one of my local packages would have been reflected automatically? But since the former developer has been using <code>vendor</code> folder thing I need to use a tool which would update code in <code>vendor</code> folder whenever I update a package? Am I right?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472508592, "post_id": 39215629, "comment_id": 65770466, "body": "Yes. <a href=\"https://golang.org/cmd/go/#hdr-Vendor_Directories\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Vendor_Directories</a>. You can use the vendor directory without any tooling, it&#39;s just cumbersome to update the files and keep them in sync."}], "answers": [{"tags": [], "owner": {"reputation": 17090, "user_id": 433814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/f3DHU.jpg?s=128&g=1", "display_name": "Marcello de Sales", "link": "https://stackoverflow.com/users/433814/marcello-de-sales"}, "is_accepted": false, "score": 7, "last_activity_date": 1586780582, "last_edit_date": 1586780582, "creation_date": 1578817807, "answer_id": 59702172, "question_id": 39215629, "link": "https://stackoverflow.com/questions/39215629/importing-local-changes-of-a-package-without-pushing-code-in-golang/59702172#59702172", "title": "Importing local changes of a package without pushing code in Golang", "body": "<h1>Go Module Solution</h1>\n\n<p>I could successfully use Golang with modules by using replace in the file <code>go.mod</code>.</p>\n\n<p><a href=\"https://thewebivore.com/using-replace-in-go-mod-to-point-to-your-local-module/\" rel=\"noreferrer\">https://thewebivore.com/using-replace-in-go-mod-to-point-to-your-local-module/</a></p>\n\n<ul>\n<li>As soon as you save the <code>go.mod</code> file with the <code>replace</code> statement, Goland recognizes the updated module.</li>\n</ul>\n\n<h1>Example</h1>\n\n<ul>\n<li>Using <code>replace MODULE_URL =&gt; /PATH/TO/MODULE/DIR</code>\n\n<ul>\n<li>No need to specify the version</li>\n</ul></li>\n</ul>\n\n<pre><code>module github.x.com/services-x/x\n\ngo 1.13\n\nrequire (\n    github.com/briandowns/spinner v1.8.0\n    github.com/golang/protobuf v1.3.1\n    github.com/jinzhu/copier v0.0.0-20190625015134-976e0346caa8\n    github.com/marcellodesales/cloner v0.0.0-20191126082454-c952bef1e067\n    github.com/mitchellh/go-homedir v1.1.0\n    github.com/mitchellh/mapstructure v1.1.2\n    github.com/sirupsen/logrus v1.2.0\n    github.com/spf13/cobra v0.0.5\n    github.com/spf13/viper v1.4.0\n    github.com/thoas/go-funk v0.4.0\n    gopkg.in/src-d/go-git.v4 v4.13.1\n    gopkg.in/yaml.v2 v2.2.2\n)\n\nreplace github.com/marcellodesales/cloner =&gt; /Users/mdesales/dev/github.com/marcellodesales/cloner\n</code></pre>\n"}], "owner": {"reputation": 812, "user_id": 1294921, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/378866033a7028eda9f30ae61c26b70f?s=128&d=identicon&r=PG", "display_name": "Imran Latif", "link": "https://stackoverflow.com/users/1294921/imran-latif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2906, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1586780582, "creation_date": 1472506824, "last_edit_date": 1472508559, "question_id": 39215629, "link": "https://stackoverflow.com/questions/39215629/importing-local-changes-of-a-package-without-pushing-code-in-golang", "title": "Importing local changes of a package without pushing code in Golang", "body": "<p>I' am learning Golang now-a-days and a total newbie. I have a question regarding packages.</p>\n\n<p>Consider the following scenario:</p>\n\n<p>Imagine I have a package <code>github.com/ilatif/A</code> in which I' am importing another package <code>github.com/ilatif/B</code>, like:</p>\n\n<p><code>import \"github.com/ilatif/B\"</code></p>\n\n<p>Now since both <code>github.com/ilatif/A</code> and <code>github.com/ilatif/B</code> are my packages and I' am working locally on them, is there a way to pull changes from <code>github.com/ilatif/B</code> package without pushing code to GitHub? As per Golang's documentation, I need to push the code to its relevant repo but I was wondering if there is such a way to pull local changes of my own package without pushing it to upstream first.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["arrays", "go", "mmap"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1472505842, "creation_date": 1472505842, "answer_id": 39215454, "question_id": 39215392, "link": "https://stackoverflow.com/questions/39215392/go-how-to-convert-unsafe-pointer-into-pointer-to-array-with-unknown-length/39215454#39215454", "title": "Go: how to convert unsafe.Pointer into pointer to array with unknown length?", "body": "<p>You first convert to an array of a type with a static length that can fit your data, then slice that array to the correct length and capacity.</p>\n\n<pre><code>mapSlice := (*[1 &lt;&lt; 30]float32)(unsafe.Pointer(&amp;mmap[0]))[:n:n]\n</code></pre>\n"}], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 39215454, "answer_count": 1, "score": 2, "last_activity_date": 1472505842, "creation_date": 1472505559, "last_edit_date": 1495542800, "question_id": 39215392, "link": "https://stackoverflow.com/questions/39215392/go-how-to-convert-unsafe-pointer-into-pointer-to-array-with-unknown-length", "title": "Go: how to convert unsafe.Pointer into pointer to array with unknown length?", "body": "<p>I am trying to write a Go program which uses <code>mmap</code> to map a very large file containing <code>float32</code> values into memory.  Here is my attempt (inspired by a <a href=\"https://stackoverflow.com/questions/9203526/mapping-an-array-to-a-file-via-mmap-in-go\">previous answer</a>, error handling omitted for brevity):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    fileName := \"test.dat\"\n    info, _ := os.Stat(fileName)\n    fileSize := info.Size()\n    n := int(fileSize / 4)\n\n    mapFile, _ := os.Open(fileName)\n    defer mapFile.Close()\n    mmap, _ := syscall.Mmap(int(mapFile.Fd()), 0, int(fileSize),\n        syscall.PROT_READ, syscall.MAP_SHARED)\n    defer syscall.Munmap(mmap)\n    mapArray := (*[n]float32)(unsafe.Pointer(&amp;mmap[0]))\n\n    for i := 0; i &lt; n; i++ {\n        fmt.Println(mapArray[i])\n    }\n}\n</code></pre>\n\n<p>This fails with the following error message:</p>\n\n<pre><code>./main.go:21: non-constant array bound n\n</code></pre>\n\n<p>Since <code>n</code> is determined by the length of the file (not known at compile time), I cannot replace <code>n</code> with a constant value in the cast.  How do I convert <code>mmap</code> into an array (or slice) of <code>float32</code> values?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1472497030, "post_id": 39213230, "comment_id": 65765190, "body": "if you don&#39;t know whether a channel is closed or not and blindly write to it, then you have a badly designed program. Redesign it so that there is no way to write into it after it is closed."}, {"owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1472497144, "post_id": 39213230, "comment_id": 65765248, "body": "Yes @ain, I completely agree with you! I just want to know, technically, if there is a way to do that."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472542866, "post_id": 39213230, "comment_id": 65780879, "body": "Related / possible duplicate: <a href=\"http://stackoverflow.com/questions/34283255/closing-channel-of-unknown-length\">Closing channel of unknown length</a>"}, {"owner": {"reputation": 73, "user_id": 12246706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc53f211ea25c53c2ea40de1f1baee8?s=128&d=identicon&r=PG&f=1", "display_name": "Kaibo", "link": "https://stackoverflow.com/users/12246706/kaibo"}, "edited": false, "score": 0, "creation_date": 1572944060, "post_id": 39213230, "comment_id": 103709477, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/16105325/how-to-check-a-channel-is-closed-or-not-without-reading-it\">How to check a channel is closed or not without reading it?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "edited": false, "score": 9, "creation_date": 1472497427, "post_id": 39213319, "comment_id": 65765381, "body": "What if multiple goroutines write to the same channel? If one goroutine has done its work it can&#39;t simply close the channel. Other goroutines may still need to write to the channel."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "edited": false, "score": 6, "creation_date": 1472497587, "post_id": 39213319, "comment_id": 65765472, "body": "@OgrishMan: then you have an outside observer close the channel when all goroutines are done, or don&#39;t close it at all."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "edited": false, "score": 3, "creation_date": 1472542840, "post_id": 39213319, "comment_id": 65780862, "body": "@OgrishMan See a solution to this using <code>sync.WaitGroup</code> in this answer: <a href=\"http://stackoverflow.com/a/34283635/1705598\">Closing channel of unknown length</a>."}], "tags": [], "owner": {"reputation": 19808, "user_id": 1472049, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1qeQt.jpg?s=128&g=1", "display_name": "serejja", "link": "https://stackoverflow.com/users/1472049/serejja"}, "is_accepted": false, "score": 25, "last_activity_date": 1472497218, "creation_date": 1472497218, "answer_id": 39213319, "question_id": 39213230, "link": "https://stackoverflow.com/questions/39213230/how-to-test-if-a-channel-is-close-and-only-send-to-it-when-its-not-closed/39213319#39213319", "title": "How to test if a channel is close and only send to it when it&#39;s not closed", "body": "<p>You can't. The rule of thumb here is that only writers should close channels, this way you know that you shouldn't write to that channel anymore.</p>\n\n<p>Some simple code would look like this:</p>\n\n<pre><code>for i := 0; i &lt; 100; i++ {\n    value := calculateSomeValue()\n    channel &lt;- value\n}\n\nclose(channel) //indicate that we will no more send values\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 573, "user_id": 3060453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/423d15544ba61adc93c9d26bbf1639d2?s=128&d=identicon&r=PG", "display_name": "redpix_", "link": "https://stackoverflow.com/users/3060453/redpix"}, "edited": false, "score": 0, "creation_date": 1490980464, "post_id": 39237154, "comment_id": 73369840, "body": "Does default mean that there is no data currently or the channel is closed for further reading?"}, {"owner": {"reputation": 521, "user_id": 5540365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b49f638e088232c4328921fe85788ed?s=128&d=identicon&r=PG", "display_name": "SammyRNYCreal", "link": "https://stackoverflow.com/users/5540365/sammyrnycreal"}, "edited": false, "score": 0, "creation_date": 1496402702, "post_id": 39237154, "comment_id": 75659572, "body": "Here is some code to answer your question:  `\tclose(ch) \tselect { \tcase value, ok := &lt;-ch: \t\tfmt.Println(&quot;value - &quot;, value) \t\tfmt.Println(&quot;ok - &quot;, ok) \tdefault: \t\tfmt.Println(&quot;channel closed&quot;) \t}`"}, {"owner": {"reputation": 521, "user_id": 5540365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b49f638e088232c4328921fe85788ed?s=128&d=identicon&r=PG", "display_name": "SammyRNYCreal", "link": "https://stackoverflow.com/users/5540365/sammyrnycreal"}, "edited": false, "score": 0, "creation_date": 1496403834, "post_id": 39237154, "comment_id": 75660314, "body": "It will fall through to <code>default</code>, like a <code>switch</code> statement. I added the following code to test if the channel is closed. The ok var will be false if the channel is closed and value will be 0, which is default nil value for an int.  Here is some code to answer your question:  `\tclose(ch) \tselect { \tcase value, ok := &lt;-ch: \t\tfmt.Println(&quot;value - &quot;, value) \t\tfmt.Println(&quot;Channel Open - &quot;, ok) \tdefault: \t\tfmt.Println(&quot;oops&quot;) \t} `"}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 3, "creation_date": 1541370376, "post_id": 39237154, "comment_id": 93183479, "body": "There is a race condition doing this if you write to the channel from multiple go-routines. You need to protect access to the channel with a lock or use an atomic pointer."}, {"owner": {"reputation": 650, "user_id": 6095220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1ux3.jpg?s=128&g=1", "display_name": "Mobigital", "link": "https://stackoverflow.com/users/6095220/mobigital"}, "edited": false, "score": 0, "creation_date": 1554912230, "post_id": 39237154, "comment_id": 97927120, "body": "it panics when trying to write to a closed channel even with <code>select</code>, see this code <a href=\"https://play.golang.org/p/Q4m4_CJl-sJ\" rel=\"nofollow noreferrer\">play.golang.org/p/Q4m4_CJl-sJ</a>"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 9, "last_activity_date": 1472591479, "creation_date": 1472591479, "answer_id": 39237154, "question_id": 39213230, "link": "https://stackoverflow.com/questions/39213230/how-to-test-if-a-channel-is-close-and-only-send-to-it-when-its-not-closed/39237154#39237154", "title": "How to test if a channel is close and only send to it when it&#39;s not closed", "body": "<p>If few goroutins write to channel you can also <code>nil</code> it instead of <code>close</code> and use <code>select</code> to read and write. Something like this</p>\n\n<pre><code>ch := make(chan int, 1)\nvar value int\nch &lt;- 5\nselect {\ncase value = &lt;-ch:\n    fmt.Println(\"value\", value)\ndefault:\n    fmt.Println(\"oops\")\n}\nch = nil\nselect {\ncase ch &lt;- 5:\ndefault:\n    fmt.Println(\"don't panic\")\n}\nselect {\ncase value = &lt;-ch:\n    fmt.Println(\"value\", value)\ndefault:\n    fmt.Println(\"oops\")\n}\n</code></pre>\n\n<p>Try it works <a href=\"https://play.golang.org/p/sp8jk961TB\" rel=\"noreferrer\">https://play.golang.org/p/sp8jk961TB</a></p>\n"}, {"tags": [], "owner": {"reputation": 1362, "user_id": 18703, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/45b0ee94acfbcc06f333f2daf03d4c91?s=128&d=identicon&r=PG", "display_name": "Hace", "link": "https://stackoverflow.com/users/18703/hace"}, "is_accepted": false, "score": 0, "last_activity_date": 1586352578, "creation_date": 1586352578, "answer_id": 61101887, "question_id": 39213230, "link": "https://stackoverflow.com/questions/39213230/how-to-test-if-a-channel-is-close-and-only-send-to-it-when-its-not-closed/61101887#61101887", "title": "How to test if a channel is close and only send to it when it&#39;s not closed", "body": "<p>You can't. You could split up the work where messages are sent to a channel and another go routine that reads from a channel.</p>\n\n<p>You should could add a donechannel to signal when the reader is done. </p>\n\n<p>Example.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n  mychan := make(chan int)\n  donechannel := make(chan struct{})\n  go pushchannel(mychan)\n  go drainchan(mychan, donechannel)\n  _, ok := &lt;-donechannel; if !ok {\n     fmt.Println(\"can not read from donechannel this means donechannel is closed, means we are done :)\")\n  }\n  fmt.Println(\"Done\")\n}\n\nfunc pushchannel(ch chan int) {\n fmt.Println(\"pushing to chan\")\n for i:=0; i&lt;=10; i++ {\n     fmt.Printf(\"pushed %v\\n\",i)\n     ch&lt;-i\n }\n close(ch)\n}\n\nfunc drainchan(ch chan int, donechannel chan struct{}) {\n  fmt.Println(\"draining\")\n  for {\n    res, ok := &lt;- ch\n    if !ok {\n       fmt.Println(\"result channel is closed, we can signal the donechannel now.\")\n        close(donechannel)\n       break \n    } else {\n      fmt.Printf(\"got result %v\\n\", res)\n    }\n  }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BMyMkrqWF7s\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BMyMkrqWF7s</a></p>\n"}], "owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33222, "favorite_count": 1, "answer_count": 3, "score": 29, "last_activity_date": 1586352578, "creation_date": 1472496820, "last_edit_date": 1563740359, "question_id": 39213230, "link": "https://stackoverflow.com/questions/39213230/how-to-test-if-a-channel-is-close-and-only-send-to-it-when-its-not-closed", "title": "How to test if a channel is close and only send to it when it&#39;s not closed", "body": "<p>In Go, if a channel <code>channel</code> is closed, I can still read from it using the following syntax and I can test <code>ok</code> to see if it's closed. </p>\n\n<pre><code>value, ok := &lt;- channel\nif !ok {\n    // channel was closed and drained\n}\n</code></pre>\n\n<p>However, if I don't know whether a channel is closed and blindly write to it, I may got an error. I want to know if there is any way that I can test the channel and only write to it when it's not closed. I ask this question is because sometimes I don't know if a channel is closed or not in a goroutine.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472493592, "post_id": 39212333, "comment_id": 65763482, "body": "This is what <code>default</code> does. Can you explain what you were expecting to happen?"}, {"owner": {"reputation": 397, "user_id": 5164435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e3e28d4afcb775ceb74539e9b059db?s=128&d=identicon&r=PG", "display_name": "Jonathan Beber", "link": "https://stackoverflow.com/users/5164435/jonathan-beber"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472493698, "post_id": 39212333, "comment_id": 65763535, "body": "I expect that <code>default</code> does this while the <code>time.After</code>&#39;s time doesn&#39;t end."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472493839, "post_id": 39212333, "comment_id": 65763608, "body": "I don&#39;t understand, that is what it does. the <code>time.After</code> case doesn&#39;t execute, because the default case is taken."}, {"owner": {"reputation": 397, "user_id": 5164435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e3e28d4afcb775ceb74539e9b059db?s=128&d=identicon&r=PG", "display_name": "Jonathan Beber", "link": "https://stackoverflow.com/users/5164435/jonathan-beber"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472495439, "post_id": 39212333, "comment_id": 65764462, "body": "Why <code>default</code> is taken if there&#39;s the <code>time.After</code> case that can be taken before?"}], "answers": [{"comments": [{"owner": {"reputation": 397, "user_id": 5164435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e3e28d4afcb775ceb74539e9b059db?s=128&d=identicon&r=PG", "display_name": "Jonathan Beber", "link": "https://stackoverflow.com/users/5164435/jonathan-beber"}, "edited": false, "score": 0, "creation_date": 1472495548, "post_id": 39212626, "comment_id": 65764530, "body": "Thanks, I got it now"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 25, "last_activity_date": 1472495580, "last_edit_date": 1472495580, "creation_date": 1472494683, "answer_id": 39212626, "question_id": 39212333, "link": "https://stackoverflow.com/questions/39212333/how-can-i-use-time-after-and-default-in-golang/39212626#39212626", "title": "How can I use &#39;time.After&#39; and &#39;default&#39; in Golang?", "body": "<p>Each time you execute <code>time.After(4 * time.Second)</code> you create a new timer channel. There's no way the <code>select</code> statement can remember the channel it selected on in the previous iteration. You've also taken what was an asynchronous operation and turned it into a busy loop, defeating the purpose of the <code>select</code> statement.</p>\n\n<p>All you need is a a simple select around the two channels you're interested in. It doesn't need to loop at all.</p>\n\n<pre><code>select {\ncase &lt;-endSignal:\n    fmt.Println(\"The end!\")\ncase &lt;-time.After(4 * time.Second):\n    fmt.Println(\"There's no more time to this. Exiting!\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jb4EE8e6cw\" rel=\"noreferrer\">https://play.golang.org/p/jb4EE8e6cw</a></p>\n\n<p>If you really want to poll multiple times, make the timer outside of the for loop, so that the same one is checked each iteration</p>\n\n<pre><code>timeout := time.After(5 * time.Second)\npollInt := time.Second\n\nfor {\n    select {\n    case &lt;-endSignal:\n        fmt.Println(\"The end!\")\n        return\n    case &lt;-timeout:\n        fmt.Println(\"There's no more time to this. Exiting!\")\n        return\n    default:\n        fmt.Println(\"still waiting\")\n    }\n    time.Sleep(pollInt)\n}\n</code></pre>\n"}], "owner": {"reputation": 397, "user_id": 5164435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e3e28d4afcb775ceb74539e9b059db?s=128&d=identicon&r=PG", "display_name": "Jonathan Beber", "link": "https://stackoverflow.com/users/5164435/jonathan-beber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17006, "favorite_count": 4, "accepted_answer_id": 39212626, "answer_count": 1, "score": 10, "last_activity_date": 1472652171, "creation_date": 1472493468, "last_edit_date": 1472652171, "question_id": 39212333, "link": "https://stackoverflow.com/questions/39212333/how-can-i-use-time-after-and-default-in-golang", "title": "How can I use &#39;time.After&#39; and &#39;default&#39; in Golang?", "body": "<p>I'm trying to understand a simple code of Golang routines:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc sleep(seconds int, endSignal chan&lt;- bool) {\n    time.Sleep(time.Duration(seconds) * time.Second)\n    endSignal &lt;- true\n}\n\nfunc main() {\n    endSignal := make(chan bool, 1)\n    go sleep(3, endSignal)\n    var end bool\n\n    for !end {\n        select {\n        case end = &lt;-endSignal:\n            fmt.Println(\"The end!\")\n        case &lt;-time.After(5 * time.Second):\n            fmt.Println(\"There's no more time to this. Exiting!\")\n            end = true\n        }\n    }\n\n}\n</code></pre>\n\n<p>That's fine, but Why I cannot use a simple default in this \"select\" block? Something like this:</p>\n\n<pre><code>for !end {\n    select {\n    case end = &lt;-endSignal:\n        fmt.Println(\"The end.\")\n    case &lt;-time.After(4 * time.Second):\n        fmt.Println(\"There's no more time to this. Exiting!\")\n        end = true\n    default:\n        fmt.Println(\"No end signal received.\")\n    }\n}\n</code></pre>\n\n<p>It gets this output:</p>\n\n<pre><code>\u276f go run goroutines-timeout.go\nNo end signal received!\nNo end signal received!\nNo end signal received!\nNo end signal received!\n...\nThe end!\n</code></pre>\n\n<p>And I can't understand why.</p>\n"}, {"tags": ["variables", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1472479312, "post_id": 39208162, "comment_id": 65755254, "body": "In the spec: <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Declarations_and_scope</a>"}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 2, "creation_date": 1472479386, "post_id": 39208162, "comment_id": 65755305, "body": "This really isn&#39;t specific to Golang.  It will behave similar for any language."}], "answers": [{"comments": [{"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1525927388, "post_id": 39208419, "comment_id": 87549155, "body": "I&#39;m surprised the latter is allowed (e.g. set <code>a := 78</code> inside the inner scope, then check <code>a</code> before the function returns. I just spent hours tracking down a bug that was due to a variable being re-set in an inner-scope and being used later in an outer-scope without the modifications. Go&#39;s compiler is strict about other things, why not this? (It was hard to see because <code>:=</code> is not as immediately obvious as using the <code>var</code> keyword)."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 3, "last_activity_date": 1472481051, "last_edit_date": 1495539952, "creation_date": 1472480007, "answer_id": 39208419, "question_id": 39208162, "link": "https://stackoverflow.com/questions/39208162/why-i-can-redefine-the-same-variable-multiple-times-in-a-for-loop-but-cant-outs/39208419#39208419", "title": "Why I can redefine the same variable multiple times in a for loop but can&#39;t outside of a loop?", "body": "<p>No identifier may be declared twice in the same\n block, and no identifier may be declared in both the file and package\n block.</p>\n\n<p>And see: <a href=\"https://stackoverflow.com/questions/36512919/what-is-the-difference-between-and-in-go\">What is the difference between := and = in Go?</a></p>\n\n<hr>\n\n<p>You have new variable on each run of <code>for</code> here,<br>\nThis code shows it by printing the address of <code>x</code>\n(<a href=\"https://play.golang.org/p/HEIERlR4bR\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    for i := 0; i &lt; 2; i++ {\n        x := 77\n        fmt.Println(&amp;x)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>0x1040e0f8\n0x1040e0fc\n</code></pre>\n\n<hr>\n\n<p>And if you need new variable in your second example you may shadow it\n(<a href=\"https://play.golang.org/p/AtStQl-UC2\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := 77\n    fmt.Println(&amp;a)\n    {\n        a := 77\n        fmt.Println(&amp;a)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>0x1040e0f8\n0x1040e0fc\n</code></pre>\n\n<hr>\n\n<p>Also See: <a href=\"https://stackoverflow.com/questions/36553134/in-golang-where-can-we-use-variable-scoping-and-shadowing-and-how\">Where can we use Variable Scoping and Shadowing in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 13, "last_activity_date": 1472480227, "creation_date": 1472480227, "answer_id": 39208490, "question_id": 39208162, "link": "https://stackoverflow.com/questions/39208162/why-i-can-redefine-the-same-variable-multiple-times-in-a-for-loop-but-cant-outs/39208490#39208490", "title": "Why I can redefine the same variable multiple times in a for loop but can&#39;t outside of a loop?", "body": "<p>There are a couple of things here. First let's address the second half of your question.</p>\n\n<p>The default way to declare a variable is using the <code>var</code> keyword and then assign to it with the <code>=</code> operator.</p>\n\n<pre><code>var a int\na = 77\n</code></pre>\n\n<p>Go allows us a shortcut <code>:=</code> that both declares a variable and assigns a value</p>\n\n<pre><code>a := 77\n</code></pre>\n\n<p>In your example when you use <code>:=</code> a second time you're trying to redeclare a new variable named <code>a</code> in the same scope which is not allowed. The error <code>no new variables on left side of :=</code> is trying to tell you this.</p>\n\n<p>But now to your original question, why can you do this multiple times inside a for loop?</p>\n\n<p>The reason is each time you enter a block of curly braces <code>{}</code> you're creating a new nested scope. When you declare the variable <code>x</code> at the top of the loop it is a new variable and it goes out of scope at the end of the loop. When the program comes back around to the top of the loop again it's another new scope.</p>\n\n<p>For example look at this code</p>\n\n<pre><code>{\n    x := 77\n    fmt.Println(x)\n}\nfmt.Println(x) // Compile error\n</code></pre>\n\n<p>That second <code>Println</code> fails because <code>x</code> does not exist in that scope.</p>\n"}], "owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6726, "favorite_count": 3, "accepted_answer_id": 39208490, "answer_count": 2, "score": 8, "last_activity_date": 1570024806, "creation_date": 1472479206, "last_edit_date": 1570024806, "question_id": 39208162, "link": "https://stackoverflow.com/questions/39208162/why-i-can-redefine-the-same-variable-multiple-times-in-a-for-loop-but-cant-outs", "title": "Why I can redefine the same variable multiple times in a for loop but can&#39;t outside of a loop?", "body": "<p>I have the following program.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    for i := 0; i &lt; 2; i++ {\n        x := 77\n        fmt.Println(x)\n    }\n}\n</code></pre>\n\n<p>When executed I got:</p>\n\n<pre><code>77\n77\n</code></pre>\n\n<p>As we can see, the <code>x := 77</code> has been execute 2 times. However, If I modify it slightly like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := 77\n    fmt.Println(a)\n    a := 77\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>I will get the error \"no new variables on left side of <code>:=</code>\". Why this?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1472477686, "post_id": 39207608, "comment_id": 65754214, "body": "See the faq: <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1472477906, "post_id": 39207608, "comment_id": 65754352, "body": "Also see <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472478387, "post_id": 39207608, "comment_id": 65754668, "body": "Possible duplicates: <a href=\"https://stackoverflow.com/questions/24196200/closures-in-go-routines-have-incorrect-scope-unless-the-variables-are-copied\" title=\"closures in go routines have incorrect scope unless the variables are copied\">stackoverflow.com/questions/24196200/&hellip;</a>,  <a href=\"https://stackoverflow.com/questions/25919213/why-does-golang-handle-closures-differently-in-goroutines\" title=\"why does golang handle closures differently in goroutines\">stackoverflow.com/questions/25919213/&hellip;</a>"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1472479073, "post_id": 39207608, "comment_id": 65755121, "body": "See also the interactive <a href=\"http://go-traps.appspot.com/#rendezvous-iteration\" rel=\"nofollow noreferrer\">Go Traps</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 5, "last_activity_date": 1472478122, "creation_date": 1472478122, "answer_id": 39207787, "question_id": 39207608, "link": "https://stackoverflow.com/questions/39207608/how-does-golang-share-variables-between-goroutines/39207787#39207787", "title": "How does Golang share variables between goroutines?", "body": "<p>The general rule is, don't share data between goroutines. In the first example, you essentially give each goroutine their own copy of <code>x</code>, and they print it out in whatever order they get to the print statement. In the second example, they all reference the same loop variable, and it is incremented to 5 by the time any of them print it. I don't believe the output there is guaranteed, it just happens that the loop creating goroutines finished faster than the goroutines themselves got to the printing part.  </p>\n"}, {"comments": [{"owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "edited": false, "score": 1, "creation_date": 1472478517, "post_id": 39207857, "comment_id": 65754766, "body": "Thank you. This helped me a lot to understand the logical behind."}, {"owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1600031528, "post_id": 39207857, "comment_id": 112952878, "body": "Is the last example fine because there the variable <code>i</code> gets copied when the coroutine function is started/called?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 8, "last_activity_date": 1472479409, "last_edit_date": 1472479409, "creation_date": 1472478315, "answer_id": 39207857, "question_id": 39207608, "link": "https://stackoverflow.com/questions/39207608/how-does-golang-share-variables-between-goroutines/39207857#39207857", "title": "How does Golang share variables between goroutines?", "body": "<p>You have new variable on each run of <code>x := i</code>,<br>\nThis code shows difference well, by printing the address of <code>x</code> inside goroutine:<br>\n<a href=\"https://play.golang.org/p/1JYo6CWK5n\" rel=\"noreferrer\">The Go Playground</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        x := i\n        go func() {\n            defer wg.Done()\n            fmt.Println(&amp;x)\n        }()\n    }\n    wg.Wait()\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>0xc0420301e0\n0xc042030200\n0xc0420301e8\n0xc0420301f0\n0xc0420301f8\nDone\n</code></pre>\n\n<hr>\n\n<p>And build your second example with <code>go build -race</code> and run it:<br>\nYou will see: <code>WARNING: DATA RACE</code></p>\n\n<hr>\n\n<p>And this will be fine <a href=\"https://play.golang.org/p/k9jQzDcDYt\" rel=\"noreferrer\">The Go Playground</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>//go build -race\npackage main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go func(i int) {\n            defer wg.Done()\n            fmt.Println(i)\n        }(i)\n    }\n    wg.Wait()\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>0\n4\n1\n2\n3\nDone\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 421, "user_id": 13829401, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kMQEDLwwn88/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucn3phX4vYPDnKpp245B6wtwzrY2Fw/photo.jpg?sz=128", "display_name": "KMA Badshah", "link": "https://stackoverflow.com/users/13829401/kma-badshah"}, "is_accepted": false, "score": 0, "last_activity_date": 1617816198, "last_edit_date": 1617816198, "creation_date": 1617815197, "answer_id": 66990835, "question_id": 39207608, "link": "https://stackoverflow.com/questions/39207608/how-does-golang-share-variables-between-goroutines/66990835#66990835", "title": "How does Golang share variables between goroutines?", "body": "<p>It's a bit hard to explain in plain english, but I'll try my best.</p>\n<p>You see, every time you spawn a new goroutine, there is an initialization time, no matter how minuscule it might be, it's always there. So, in your second case, the entire loop has finished incrementing the variable 5 times before any of the goroutines even started. And when the goroutines finish initialization, all they see is the final variable value which is 5.</p>\n<p>In your first case though, the x variable keeps a copy of the i variable so that when the goroutines start, x get's passed to them. Remember, it is <code>i</code> that is being incremented here, not <code>x</code>. <code>x</code> is fixed. So, when the goroutines start, they get a fixed value.</p>\n"}], "owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9222, "favorite_count": 1, "accepted_answer_id": 39207857, "answer_count": 3, "score": 12, "last_activity_date": 1617816198, "creation_date": 1472477608, "last_edit_date": 1472479210, "question_id": 39207608, "link": "https://stackoverflow.com/questions/39207608/how-does-golang-share-variables-between-goroutines", "title": "How does Golang share variables between goroutines?", "body": "<p>I'm learning Go and trying to understand its concurrency features. </p>\n\n<p>I have the following program.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n\n        x := i\n\n        go func() {\n            defer wg.Done()\n            fmt.Println(x)\n        }()\n\n    }\n\n    wg.Wait()\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>When executed I got:</p>\n\n<pre><code>4\n0\n1\n3\n2\n</code></pre>\n\n<p>It's just what I want. However, if I make slight modification to it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n\n        go func() {\n            defer wg.Done()\n            fmt.Println(i)\n        }()\n\n    }\n\n    wg.Wait()\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>What I got will be:</p>\n\n<pre><code>5\n5\n5\n5\n5\n</code></pre>\n\n<p>I don't quite understand the difference. Can anyone help to explain what happened here and how Go runtime execute this code?</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1472464657, "last_edit_date": 1472464657, "creation_date": 1472464030, "answer_id": 39203192, "question_id": 39202768, "link": "https://stackoverflow.com/questions/39202768/how-to-properly-close-a-request-and-continue-processing-it-on-the-background/39203192#39203192", "title": "How to properly close a request and continue processing it on the background", "body": "<p>Returning from the handler is sufficient and is what should be done. Quoting from <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\"><code>http.Handler</code></a>:</p>\n\n<blockquote>\n  <p><strong>Returning signals that the request is finished</strong>; it is not valid to use the ResponseWriter or read from the Request.Body after or concurrently with the completion of the ServeHTTP call.</p>\n</blockquote>\n\n<p>Note that the final <code>return</code> statement is not necessary, you can simply omit it. Execution returns from the handler when its last statement is executed, execution does not wait for goroutines started from the function to complete. (Note that <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow\">deferred</a> statements would be executed prior, but you don't have any here.)</p>\n\n<p>Also when returning, if HTTP headers are not set, <code>200 OK</code> will be set automatically. So if you want <code>202 Accepted</code>, the following is the minimal required:</p>\n\n<pre><code>func index(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusAccepted)\n    go sleep()\n}\n</code></pre>\n\n<p>Just make sure you don't use the <code>http.ResponseWriter</code> and <code>httpRequest</code> values in the concurrent goroutine after you return from the handler as they may be reused, so you should not even attempt to read them.</p>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2592, "favorite_count": 0, "accepted_answer_id": 39203192, "answer_count": 1, "score": 4, "last_activity_date": 1472464657, "creation_date": 1472462839, "last_edit_date": 1472463496, "question_id": 39202768, "link": "https://stackoverflow.com/questions/39202768/how-to-properly-close-a-request-and-continue-processing-it-on-the-background", "title": "How to properly close a request and continue processing it on the background", "body": "<p>For an incoming HTTP request, I had to respond with a <a href=\"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#2xx_Success\" rel=\"nofollow\">202 Accepted</a> status code, while continue processing the payload in the background. for example purposes this is what I am currently doing:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/nbari/violetear\"\n)\n\nfunc sleep() {\n    time.Sleep(3 * time.Second)\n    fmt.Println(\"done...\")\n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusAccepted)\n    go sleep()\n}\n\nfunc main() {\n    router := violetear.New()\n    router.HandleFunc(\"*\", index)\n\n    http.Handle(\"/\", router)\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>Basically, on the handler  I just use <code>WriteHeader</code> and later a call the the <code>sleep</code> function within a goroutine:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func index(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusAccepted)\n    go sleep()\n}\n</code></pre>\n\n<p>In case I would like to respond with \"200 OK\", I notice that I can simple return, for example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func index(w http.ResponseWriter, r *http.Request) {\n    go sleep()\n    return\n}\n</code></pre>\n\n<p>Therefore wondering if I should return always I want to close:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func index(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusAccepted)\n    go sleep()\n    return\n}\n</code></pre>\n\n<p>Or by just writing the header and next calling the goroutine is enough. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1472461038, "post_id": 39202150, "comment_id": 65743763, "body": "Well, that depends solely on the format your file should have and has nothing to do with &quot;converting int to byte array&quot;. Probably you should fmt.Fprintf to your file."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1472462608, "post_id": 39202150, "comment_id": 65744617, "body": "But I am getting this error on line <code>f.Write(ids)</code> that <code>argument 1 has incompatible type</code>. I want to write the ids in a text file. If this is not the correct way. Please tell me the correct manner of doing this."}, {"owner": {"reputation": 7065, "user_id": 4275413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/diRiJ.png?s=128&g=1", "display_name": "Jakumi", "link": "https://stackoverflow.com/users/4275413/jakumi"}, "edited": false, "score": 0, "creation_date": 1472462721, "post_id": 39202150, "comment_id": 65744687, "body": "Yeah, but a byte array is essentially an array of characters (in byte representation), I think you don&#39;t want your ints interpreted as characters but instead want to write the digits that make up the numbers (those are two different things). You should probably use fmt.Fprintf as Volker suggested."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1473768698, "last_edit_date": 1473768698, "creation_date": 1472466125, "answer_id": 39203881, "question_id": 39202150, "link": "https://stackoverflow.com/questions/39202150/convert-int-array-to-byte-array-in-golang/39203881#39203881", "title": "convert int array to byte array in Golang", "body": "<p>You may use <code>fmt.Fprint</code>, as this simplified working sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"math/rand\"\n    \"os\"\n)\n\nfunc main() {\n    f, err := os.Create(\"xyz.txt\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n    w := bufio.NewWriter(f)\n    defer w.Flush()\n\n    for j := 0; j &lt; 5; j++ {\n        count := 4 //count := rand.Intn(100)\n        for i := 0; i &lt; count; i++ {\n            fmt.Fprint(w, rand.Intn(1000), \" \")\n        }\n        fmt.Fprintln(w)\n    }\n}\n</code></pre>\n\n<p><code>xyz.txt</code> output file:</p>\n\n<pre><code>81 887 847 59 \n81 318 425 540 \n456 300 694 511 \n162 89 728 274 \n211 445 237 106 \n</code></pre>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4213, "favorite_count": 0, "accepted_answer_id": 39203881, "answer_count": 1, "score": 1, "last_activity_date": 1473768698, "creation_date": 1472460847, "last_edit_date": 1472466312, "question_id": 39202150, "link": "https://stackoverflow.com/questions/39202150/convert-int-array-to-byte-array-in-golang", "title": "convert int array to byte array in Golang", "body": "<p>I'm trying to create some random int arrays and write it to a <code>xyz.txt</code> file in  Golang.<br>\nHow to convert <code>ids</code> which is an <code>int</code> array to <code>byte</code> array, as <code>file.Write</code> accepts <code>[]byte</code> as a parameter. What is the correct way to achieve writing random integer arrays to a text file.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    var id int\n    var ids []int\n    var count int\n\n    f, err := os.Create(\"xyz.txt\")\n    check(err)\n\n    defer f.Close()\n\n    for j := 0; j &lt; 5; j++ {\n        count = rand.Intn(100)\n        for i := 0; i &lt; product_count; i++ {\n            id = rand.Intn(1000)\n            ids = append(product_ids, product_id)\n        }\n        n2, err := f.Write(ids)\n        check(err)\n        fmt.Printf(\"wrote %d bytes\\n\", n2)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 5628, "user_id": 2067484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/93EtD.png?s=128&g=1", "display_name": "Suhail Mehta", "link": "https://stackoverflow.com/users/2067484/suhail-mehta"}, "is_accepted": false, "score": 0, "last_activity_date": 1472455179, "creation_date": 1472455179, "answer_id": 39200543, "question_id": 39196782, "link": "https://stackoverflow.com/questions/39196782/serve-a-file-when-no-route-is-matched-with-gorilla/39200543#39200543", "title": "Serve a file when no route is matched with Gorilla?", "body": "<pre><code>func NewRouter() *mux.Router {\n    router := mux.NewRouter().StrictSlash(true)\n    routes := client.GetRoutes()\n    for _, route := range routes {\n        var handler http.Handler\n        handler = route.HandlerFunc\n        handler = context.ClearHandler(handler)\n\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(handler)\n\n    }\n    r := OGRouter{router: router}\n    router = r.router\n    router.NotFoundHandler = http.HandlerFunc(r.NotFoundHandler)\n    return router\n}\n\n/* Handled mux router drawback of giving 404 in every case i.e if either URI or METHOD\n*  is not matched mux router will give 404. So, this case is handled her, if Method will\n*  not match we will through 405\n */\nfunc (router *OGRouter) NotFoundHandler(rw http.ResponseWriter, req *http.Request) {\n\n    r := *router.router\n    route := r.Get(req.RequestURI)\n\n    if route != nil {\n        if req.RequestURI == route.GetName() {\n\n            routeMatch := mux.RouteMatch{Route: route}\n\n            if !route.Match(req, &amp;routeMatch) {\n                rw.WriteHeader(http.StatusMethodNotAllowed)\n            }\n        } else {\n            rw.WriteHeader(http.StatusNotFound)\n        }\n    } else {\n        rw.WriteHeader(http.StatusNotFound)\n    }\n}\n\ntype OGRouter struct {\n    router *mux.Router\n}\n</code></pre>\n\n<p>Where you are getting 404 you can serve a new page</p>\n"}, {"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 2, "last_activity_date": 1472477930, "creation_date": 1472477930, "answer_id": 39207723, "question_id": 39196782, "link": "https://stackoverflow.com/questions/39196782/serve-a-file-when-no-route-is-matched-with-gorilla/39207723#39207723", "title": "Serve a file when no route is matched with Gorilla?", "body": "<p>You don't need to override the 404 behaviour. Use <code>PathPrefix</code> as a catch-all route, adding it after all other routes.</p>\n\n<pre><code>func main() {\n    var entry string\n    var static string\n    var port string\n\n    flag.StringVar(&amp;entry, \"entry\", \"./index.html\", \"the entrypoint to serve.\")\n    flag.StringVar(&amp;static, \"static\", \".\", \"the directory to serve static files from.\")\n    flag.StringVar(&amp;port, \"port\", \"8000\", \"the `port` to listen on.\")\n    flag.Parse()\n\n    r := mux.NewRouter()\n\n    // Note: In a larger application, we'd likely extract our route-building logic into our handlers\n    // package, given the coupling between them.\n\n    // It's important that this is before your catch-all route (\"/\")\n    api := r.PathPrefix(\"/api/v1/\").Subrouter()\n    api.HandleFunc(\"/users\", GetUsersHandler).Methods(\"GET\")\n\n    // Serve static assets directly.\n    r.PathPrefix(\"/dist\").Handler(http.FileServer(http.Dir(static)))\n\n    // Catch-all: Serve our JavaScript application's entry-point (index.html).\n    r.PathPrefix(\"/\").HandlerFunc(IndexHandler(entry))\n\n    srv := &amp;http.Server{\n        Handler: handlers.LoggingHandler(os.Stdout, r),\n        Addr:    \"127.0.0.1:\" + port,\n        // Good practice: enforce timeouts for servers you create!\n        WriteTimeout: 15 * time.Second,\n        ReadTimeout:  15 * time.Second,\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n\nfunc IndexHandler(entrypoint string) func(w http.ResponseWriter, r *http.Request) {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, entrypoint)\n    }\n\n    return http.HandlerFunc(fn)\n}\n</code></pre>\n\n<p>Shameless plug: I blogged on this here: <a href=\"http://elithrar.github.io/article/vue-react-ember-server-golang/\" rel=\"nofollow\">http://elithrar.github.io/article/vue-react-ember-server-golang/</a></p>\n"}], "owner": {"reputation": 49229, "user_id": 1001938, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ufPVV.jpg?s=128&g=1", "display_name": "Don P", "link": "https://stackoverflow.com/users/1001938/don-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 955, "favorite_count": 0, "accepted_answer_id": 39207723, "answer_count": 2, "score": 1, "last_activity_date": 1472477930, "creation_date": 1472427584, "question_id": 39196782, "link": "https://stackoverflow.com/questions/39196782/serve-a-file-when-no-route-is-matched-with-gorilla", "title": "Serve a file when no route is matched with Gorilla?", "body": "<p>I'm using Gorilla Mux as my web server.</p>\n\n<p>I define a bunch of routes, but if no route is matched, I want it to serve my index.html file.</p>\n\n<pre><code>func (mgr *ApiMgr) InstantiateRestRtr() *mux.Router {\n    mgr.pRestRtr = mux.NewRouter().StrictSlash(true)\n    mgr.pRestRtr.PathPrefix(\"/api/\").Handler(http.StripPrefix(\"/api/\",\n        http.FileServer(http.Dir(mgr.fullPath+\"/docsui\"))))\n\n    for _, route := range mgr.restRoutes {\n        var handler http.Handler\n        handler = Logger(route.HandlerFunc, route.Name)\n        mgr.pRestRtr.Methods(route.Method)\n          .Path(route.Pattern)\n          .Name(route.Name)\n          .Handler(handler)\n    }\n\n    // Here I want to catch any unmatched routes, and serve my '/site/index.html` file. \n    // How can I do this?\n\n    return mgr.pRestRtr\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 985, "user_id": 1167502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/07bce4e80ad0d40c6e6b169aa501337d?s=128&d=identicon&r=PG", "display_name": "sev3ryn", "link": "https://stackoverflow.com/users/1167502/sev3ryn"}, "edited": false, "score": 0, "creation_date": 1472464849, "post_id": 39195780, "comment_id": 65746042, "body": "thanks. But first loop cycle locks on line &quot;case &lt;-ctx.Done():&quot; until timing out - this is not what I&#39;m expecting. Changing it to     select {     case &lt;-ctx.Done():         return     default:     } fixes this mistake."}, {"owner": {"reputation": 985, "user_id": 1167502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/07bce4e80ad0d40c6e6b169aa501337d?s=128&d=identicon&r=PG", "display_name": "sev3ryn", "link": "https://stackoverflow.com/users/1167502/sev3ryn"}, "edited": false, "score": 0, "creation_date": 1472465153, "post_id": 39195780, "comment_id": 65746233, "body": "but how to cancel some long running processes to internals of which I don&#39;t have access - lets say in place of function doIt is some third party or stdlib function - that hangs for more time than timeout."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 985, "user_id": 1167502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/07bce4e80ad0d40c6e6b169aa501337d?s=128&d=identicon&r=PG", "display_name": "sev3ryn", "link": "https://stackoverflow.com/users/1167502/sev3ryn"}, "edited": false, "score": 1, "creation_date": 1472517530, "post_id": 39195780, "comment_id": 65772728, "body": "@sev3ryn It&#39;s not possible to to cancel a long running goroutine unless the code executing in the goroutine provides a mechanism to do so. There&#39;s no mechanism for killing a goroutine external to the code executing in the goroutine."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1472512630, "last_edit_date": 1472512630, "creation_date": 1472418414, "answer_id": 39195780, "question_id": 39195703, "link": "https://stackoverflow.com/questions/39195703/cancelling-of-execution-of-child-processes-using-context/39195780#39195780", "title": "Cancelling of execution of child processes using context", "body": "<p>The context does not stop child goroutines on its own. The application code running in the goroutines must check the context and return from the goroutine when the context is done. Here's an example of how to check the context:</p>\n\n<pre><code>func doIt(ctx context.Context, filename string) {\n  // simulate not ending file processing\n  for {\n    fmt.Printf(\"processing file %s\\n\", filename)\n    time.Sleep(50 * time.Millisecond)\n    select {\n    case &lt;-ctx.Done():\n        return\n    default:\n    }\n  }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/va0vygKQis\" rel=\"nofollow\">playground example</a></p>\n\n<p>It's not possible to to cancel a long running goroutine unless the code executing in the goroutine provides a mechanism to do so. There's no mechanism for killing a goroutine external to the code executing in the goroutine.</p>\n"}], "owner": {"reputation": 985, "user_id": 1167502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/07bce4e80ad0d40c6e6b169aa501337d?s=128&d=identicon&r=PG", "display_name": "sev3ryn", "link": "https://stackoverflow.com/users/1167502/sev3ryn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1498, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472512630, "creation_date": 1472417775, "last_edit_date": 1472500719, "question_id": 39195703, "link": "https://stackoverflow.com/questions/39195703/cancelling-of-execution-of-child-processes-using-context", "title": "Cancelling of execution of child processes using context", "body": "<p>I'm trying to figure out how to work with context pattern in Go.\nI'm simulating the case when multiple long running child goroutines need to be cancelled because of timeout of their execution. As I understood one of the main usages of context is to stop all child processes in case of I/O timeout or if user left page before end of processing.</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc doIt(ctx context.Context, filename string) {\n    // simulate not ending file processing - \n    // internals of this loop could not change \n    // e.g. it is call of some third party or stdlib function that hangs\n    for {\n        fmt.Printf(\"processing file %s\\n\", filename)\n        time.Sleep(50 * time.Millisecond)\n    }\n}\n\nfunc main() {\n    startFileProcessing()\n    fmt.Println(\"End of processing\")\n    time.Sleep(500 * time.Millisecond)\n    fmt.Println(\"Do something else\")\n\n}\n\nfunc startFileProcessing() {\n    // set file processing timeout\n    ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*100)\n    defer cancel()\n\n    // start two parallel processes\n    go doIt(ctx, \"file1\")\n    go doIt(ctx, \"file2\")\n\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"file processing timeout\")\n        return\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AbTlcMKYGh\" rel=\"nofollow\">Playground</a>.</p>\n\n<p>Which outputs:</p>\n\n<pre><code>processing file file2\nprocessing file file1\nprocessing file file1\nprocessing file file2\nprocessing file file1\nfile processing timeout\nEnd of processing\nprocessing file file2\nprocessing file file2\nprocessing file file1\nprocessing file file1\nprocessing file file2\nDo something else\n</code></pre>\n\n<p>I expect not to see \"processing file\" lines after \"file processing timeout\".</p>\n\n<p>How to fix it? </p>\n\n<p><strong>Edit:</strong> @Mellow Marmot pointed out that context does not stop child goroutines on its own and proposed solution for this. But his changes are within loop in doIt function what doesn't answer the question completely because instead of for loop in doIt function there could be some third party (or stdlib) function call that couldn't be changed. </p>\n\n<p>So let me rephrase question - </p>\n\n<blockquote>\n  <p>How to cancel some long running processes to internals of which I\n  don't have access - that hangs for more time than timeout?</p>\n</blockquote>\n"}, {"tags": ["mysql", "json", "go"], "comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1472473109, "post_id": 39195005, "comment_id": 65751069, "body": "use this for json encode/decode <a href=\"https://github.com/antonholmquist/jason\" rel=\"nofollow noreferrer\">github.com/antonholmquist/jason</a>. I had similar problems and I switch to that JASON and it works great."}, {"owner": {"reputation": 307, "user_id": 3341040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7c38048ec94e5fcf2f568da6c1d562?s=128&d=identicon&r=PG&f=1", "display_name": "Simopaa", "link": "https://stackoverflow.com/users/3341040/simopaa"}, "reply_to_user": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1472477371, "post_id": 39195005, "comment_id": 65754025, "body": "Well, what do you know. It works like a charm! Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 307, "user_id": 3341040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7c38048ec94e5fcf2f568da6c1d562?s=128&d=identicon&r=PG&f=1", "display_name": "Simopaa", "link": "https://stackoverflow.com/users/3341040/simopaa"}, "is_accepted": true, "score": 2, "last_activity_date": 1472477610, "creation_date": 1472477610, "answer_id": 39207609, "question_id": 39195005, "link": "https://stackoverflow.com/questions/39195005/transferring-mysql-json-data-type-in-go-rest-api/39207609#39207609", "title": "Transferring MySQL JSON data type in Go REST-API", "body": "<p>Ok, like pregmatch suggested in a comment, I tried using the <a href=\"http://github.com/antonholmquist/jason\" rel=\"nofollow\">JASON</a> module to handle the JSON parse. To my great surprise, it works:</p>\n\n<pre><code>func GetMap(id int) Map{\n  var mapId int\n  var data string\n  var userId int\n  var created time.Time\n  err := _getMap.QueryRow(id).Scan(&amp;mapId, &amp;data, &amp;userId, &amp;created)\n\n  if (err != nil){\n    log.Print(err)\n  }\n  dataJSON, _ := jason.NewObjectFromBytes([]byte(data))\n  mapObj := Map{Id:mapId, Data:dataJSON, UserId:userId, Created:created}\n  return mapObj\n\n}\n</code></pre>\n\n<p>In the REST-client is received in the proper format:</p>\n\n<pre><code>{\"field\":\"works!\"...}\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 3341040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7c38048ec94e5fcf2f568da6c1d562?s=128&d=identicon&r=PG&f=1", "display_name": "Simopaa", "link": "https://stackoverflow.com/users/3341040/simopaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 0, "accepted_answer_id": 39207609, "answer_count": 1, "score": 0, "last_activity_date": 1472477610, "creation_date": 1472412584, "last_edit_date": 1472468527, "question_id": 39195005, "link": "https://stackoverflow.com/questions/39195005/transferring-mysql-json-data-type-in-go-rest-api", "title": "Transferring MySQL JSON data type in Go REST-API", "body": "<p>I'm trying to set up a Go MySQL server that queries data from the database and sends it as a JSON. My database contains some columns that are in the new JSON type.</p>\n\n<p>The Map struct:</p>\n\n<pre><code>type Map struct{\n Id int `json:\"id\"`\n Data string `json:\"data\"` //This column is stored in the database as a JSON. Which type to use here?\n Created time.Time `json:\"created\"`\n UserId  int `json:userid`\n}\n</code></pre>\n\n<p>The function to fetch data from database</p>\n\n<pre><code>func GetMap(id int) Map{\n var mapId int\n var data string //which type should this be\n var userId int\n var created time.Time\n err := _getMap.QueryRow(id).Scan(&amp;mapId, &amp;data, &amp;userId, &amp;created) //getMap is a prepared query \n mapObj := Map{Id:mapId, Data:data, UserId:userId, Created:created}\n\n return mapObj\n\n}\n</code></pre>\n\n<p>When I send this data out like this</p>\n\n<pre><code>resp.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\nresp.WriteHeader(http.StatusOK)\ngmap := GetMap(id)\n\nerr := json.NewEncoder(resp).Encode(gmap); \n</code></pre>\n\n<p>The Data in the JSON that the client receives is formatted as a string:</p>\n\n<p><code>{\\\"field\\\":\\\"nowork\\\"...}</code></p>\n\n<p>I think the problem is caused by a wrong datatype in the struct definition, which means that the Data will be parsed in the wrong format. </p>\n\n<p>I have tried to change the datatype to []uint8, interface{} and some others that I thought could be relevant, but to no avail.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1503765657, "post_id": 39194816, "comment_id": 78754030, "body": "One year later, with Go 1.9, adding <code>t.Helper()</code> will make the line number to be the correct one. See <a href=\"https://stackoverflow.com/a/45897453/6309\">my answer below</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "is_accepted": true, "score": 2, "last_activity_date": 1472413030, "last_edit_date": 1472413030, "creation_date": 1472412639, "answer_id": 39195013, "question_id": 39194816, "link": "https://stackoverflow.com/questions/39194816/how-to-wrap-golang-test-functions/39195013#39195013", "title": "How to wrap golang test functions", "body": "<p>This is how the testing library does it:\n<a href=\"https://golang.org/src/testing/testing.go?h=Errorf#L285\" rel=\"nofollow\">https://golang.org/src/testing/testing.go?h=Errorf#L285</a></p>\n\n<p>By using <code>runtime.Caller</code>.</p>\n\n<p>You can borrow this code for your own error function that would look one deeper into the stack.  You can replace the entirety of <code>Errorf</code> (which is <code>log</code> + <code>fail</code>) or a bit less pretty but less code would be to just print the entire stack using something like <code>debug.PrintStack()</code> before calling <code>Errorf</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": 0, "last_activity_date": 1472413948, "last_edit_date": 1472413948, "creation_date": 1472413553, "answer_id": 39195141, "question_id": 39194816, "link": "https://stackoverflow.com/questions/39194816/how-to-wrap-golang-test-functions/39195141#39195141", "title": "How to wrap golang test functions", "body": "<p>You can see <code>Fail</code> function in <code>assert</code> package: <a href=\"https://github.com/stretchr/testify/blob/master/assert/assertions.go#L207\" rel=\"nofollow\">https://github.com/stretchr/testify/blob/master/assert/assertions.go#L207</a></p>\n\n<p>Example:</p>\n\n<pre><code>package main_test\n\nimport (\n        \"fmt\"\n        \"github.com/stretchr/testify/assert\"\n        \"strings\"\n        \"testing\"\n)\n\n// AssertEqual tests that the expected and actual values match\nfunc AssertEqual(t *testing.T, expected interface{}, actual interface{}) {\n        switch expected.(type) {\n        case string:\n                if expected != actual {\n                        callInfo := assert.CallerInfo()\n                        errorTrace := strings.Join(callInfo, \"\\n\\r\\t\\t\\t\")\n                        t.Errorf(\"\\r%s\\r\\tError Trace:\\t%s\\n\"+\n                                \"\\r\\tError:%s\\n\\r\",\n                                \"\",\n                                errorTrace,\n                                fmt.Sprintf(\"Error:\\nexpected: %s\\nactual: %s\", expected, actual),\n                        )\n                }\n        default:\n                t.Errorf(\"Unsupported type\")\n        }\n}                                                                                                                                                                                            \n\nfunc TestFoo(t *testing.T) {                                                                                                                                                                 \n        AssertEqual(t, \"hello\", 21)                                                                                                                                                          \n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>$ go test main_test.go \n--- FAIL: TestFoo (0.00s)\n        Error Trace::22:main_test.go:15\n                        main_test.go:30\n        Error:Error:\n                expected: hello\n                actual: %!s(int=21)\n\nFAIL\nFAIL    command-line-arguments  0.002s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1612859842, "post_id": 45897453, "comment_id": 116891322, "body": "Now also available in <code>TB</code> interface: <a href=\"https://golang.org/pkg/testing/#TB\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#TB</a>"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1612867640, "post_id": 45897453, "comment_id": 116894615, "body": "@xuiqzy Thank you. I have included your comment in the answer for more visibility."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 5, "last_activity_date": 1612868104, "last_edit_date": 1612868104, "creation_date": 1503764606, "answer_id": 45897453, "question_id": 39194816, "link": "https://stackoverflow.com/questions/39194816/how-to-wrap-golang-test-functions/45897453#45897453", "title": "How to wrap golang test functions", "body": "<p>With the recent Go 1.9 (August 2017), all you need to do is adding one line to your function:</p>\n<pre><code>t.Helper()\n</code></pre>\n<p>That will silence this function in error report, and your actual error line will be the one you expect (ie the one calling this function)</p>\n<p>See <a href=\"https://golang.org/pkg/testing/#T.Helper\" rel=\"nofollow noreferrer\"><code>pkg/testing/#T.Helper</code></a> (also available for <a href=\"https://golang.org/pkg/testing/#B.Helper\" rel=\"nofollow noreferrer\">Benchmark test</a>, but... not for the <a href=\"https://golang.org/pkg/testing/#TB\" rel=\"nofollow noreferrer\"><code>TB</code> interface</a>, where <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Atgo-EG1uN0\" rel=\"nofollow noreferrer\">it was forgotten</a>! Feb. 2021: this is available, see below)</p>\n<pre><code>// AssertEqual tests that the expected and actual values match\nfunc AssertEqual(t *testing.T, expected interface{}, actual interface{}) {\n    t.Helper()\n    switch expected.(type) {\n    case string:\n        if expected != actual {\n            t.Errorf(&quot;Error:\\nexpected: %s\\nactual: %s&quot;, expected, actual)\n        }\n    default:\n        t.Errorf(&quot;Unsupported type&quot;)\n    }\n}\n</code></pre>\n<p><a href=\"https://stackoverflow.com/users/4288004/xuiqzy\">xuiqzy</a> mentions <a href=\"https://stackoverflow.com/questions/39194816/how-to-wrap-golang-test-functions/45897453#comment116891322_45897453\">in the comments</a> in Feb. 2021 the interface <a href=\"https://golang.org/pkg/testing/#TB\" rel=\"nofollow noreferrer\"><code>testing.TB</code></a> which now has <code>Helper()</code>.<br />\nSee <a href=\"https://github.com/golang/go/commit/bc2931372243043842161c0a60bd2f86ef9696ee\" rel=\"nofollow noreferrer\">commit bc29313, Apr. 2017, go1.9beta1</a>, <a href=\"https://go-review.googlesource.com/c/go/+/38796/\" rel=\"nofollow noreferrer\">CL 38796</a> for implementing <a href=\"https://github.com/golang/proposal/blob/master/design/4899-testing-helper.md\" rel=\"nofollow noreferrer\">proposal 4899</a>.</p>\n<blockquote>\n<p>We propose to add a new <code>testing.TB</code> method, <code>Helper</code>, which marks the calling function as a test helper.</p>\n<p>When logging test messages, package testing ignores frames that are inside marked helper functions.<br />\nIt prints the first stack position inside a non-helper function.</p>\n</blockquote>\n"}], "owner": {"reputation": 2549, "user_id": 181509, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc38deaf59377e15ec390fa1c7903393?s=128&d=identicon&r=PG", "display_name": "EmpireJones", "link": "https://stackoverflow.com/users/181509/empirejones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1472, "favorite_count": 1, "accepted_answer_id": 39195013, "answer_count": 3, "score": 4, "last_activity_date": 1612868104, "creation_date": 1472411102, "last_edit_date": 1472415053, "question_id": 39194816, "link": "https://stackoverflow.com/questions/39194816/how-to-wrap-golang-test-functions", "title": "How to wrap golang test functions", "body": "<p>I'd like to wrap standard golang test functions, such as <code>t.Errorf</code> from the testing package.</p>\n\n<p>I tried this:</p>\n\n<pre><code>// AssertEqual tests that the expected and actual values match\nfunc AssertEqual(t *testing.T, expected interface{}, actual interface{}) {\n    switch expected.(type) {\n    case string:\n        if expected != actual {\n            t.Errorf(\"Error:\\nexpected: %s\\nactual: %s\", expected, actual)\n        }\n    default:\n        t.Errorf(\"Unsupported type\")\n    }\n}\n</code></pre>\n\n<p>However, when a test fails, I get the function and line number of my helper function:</p>\n\n<pre><code>test_asserts.go:12: Error:\n    expected: \n    actual: TestValue\n</code></pre>\n\n<p><strong>Is there a way to error at the line number of the caller?</strong></p>\n"}, {"tags": ["javascript", "go", "websocket", "network-programming", "localhost"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1472423937, "last_edit_date": 1472423937, "creation_date": 1472414793, "answer_id": 39195312, "question_id": 39194772, "link": "https://stackoverflow.com/questions/39194772/websockets-address-on-internal-network-needs-static-ip/39195312#39195312", "title": "Websockets Address on Internal Network need&#39;s static ip?", "body": "<p>If the web page and websocket endpoints are served by the same host, then create the websocket using the host used to fetch the web page:</p>\n\n<pre><code>conn = new WebSocket(\"ws://\" + window.location.host + \"/ws\");\n</code></pre>\n\n<p>This will just work in all network configurations.</p>\n\n<p>As far as the Go code is concerned, the easiest approach is to listen on all networks:</p>\n\n<pre><code>if err := http.ListenAndServe(\":8080\", nil); err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 995, "favorite_count": 0, "accepted_answer_id": 39195312, "answer_count": 1, "score": 1, "last_activity_date": 1472423937, "creation_date": 1472410816, "last_edit_date": 1495542648, "question_id": 39194772, "link": "https://stackoverflow.com/questions/39194772/websockets-address-on-internal-network-needs-static-ip", "title": "Websockets Address on Internal Network need&#39;s static ip?", "body": "<p>I'm running a Go webserver using <code>Gorilla/websocket</code> for a real-time chess/chat application. As far as I know, I define the <strong>address</strong> and <strong>port</strong> in two locations, the Go <code>http.ListenAndServer()</code> method and the Javascript <code>new Websocket();</code> function. This works great accross browsers on the same host machine, but it gets tricky when trying to extend the functionality over my internal network. So I use, for instance:</p>\n\n<p>Go:</p>\n\n<pre><code>PORT := \"0.0.0.0:8080\"\n// ...\nhttp.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n    h.serveWs(hub, w, r) // h is a chessboard Handler wrapper\n})\n//...\nhttp.ListenAndServe(PORT, nil)\n</code></pre>\n\n<p>Javascript:</p>\n\n<pre><code>conn = new WebSocket(\"ws://0.0.0.0:8080/ws\");\n</code></pre>\n\n<p>In my effort to get this working on different devices over the network I've tried using, instead of the <code>0.0.0.0</code> address, <code>localhost</code> or my <code>hostname</code> and my host's internal ip (e.g.) <code>10.232.44.20</code>; With the latter, the internal ip hardcoded in, it works, but the other attempts don't. I thought that using <code>0.0.0.0</code> would accept all connections from within the network, which I gathered from this answer:\n<a href=\"https://stackoverflow.com/questions/20778771/what-is-the-difference-between-0-0-0-0-127-0-0-1-and-localhost\">What is the difference between 0.0.0.0, 127.0.0.1 and localhost?</a></p>\n\n<p>How should I program <code>ListenAndServe</code> as well as <code>new Websocket</code> so that I can access the server within the internal network, without having to hardcode my internal ip address? Should I access that number programmatically from Js and Go? In the end, I want to be able to run this server on a variety of networks, without configuration, and have it <em>just work</em>. What am I missing?</p>\n"}, {"tags": ["go", "visual-studio-code", "delve"], "answers": [{"comments": [{"owner": {"reputation": 794, "user_id": 2665391, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/1468977014/picture?type=large", "display_name": "Amal Ts", "link": "https://stackoverflow.com/users/2665391/amal-ts"}, "edited": false, "score": 0, "creation_date": 1493542749, "post_id": 39229123, "comment_id": 74453923, "body": "Can you please help me with any documentation or helper guides on how to configure remote debugging on go?"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "reply_to_user": {"reputation": 794, "user_id": 2665391, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/1468977014/picture?type=large", "display_name": "Amal Ts", "link": "https://stackoverflow.com/users/2665391/amal-ts"}, "edited": false, "score": 0, "creation_date": 1493621160, "post_id": 39229123, "comment_id": 74474198, "body": "I eventually gave up, hoping it will be better/easier some day - that or rewrite my code. If you come by something good, please let me know."}], "tags": [], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1472564358, "creation_date": 1472564358, "answer_id": 39229123, "question_id": 39194562, "link": "https://stackoverflow.com/questions/39194562/how-to-remote-debug-with-delve-debugger-in-visual-studio-code/39229123#39229123", "title": "How to remote debug with Delve debugger in Visual Studio Code", "body": "<p>The following worked:</p>\n\n<ol>\n<li>Remove line 3 in launch.json \"debugServer\": 4711,\"</li>\n<li>Changed line 29 in launch.json \"\"host\": \"192.168.99.100\" // Docker IP \" to \"127.0.0.1\".</li>\n</ol>\n\n<p>I was sure I tried this before, but apparently not bout at the same time.\nAnyways happy go' lucky!</p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2909, "favorite_count": 0, "accepted_answer_id": 39229123, "answer_count": 1, "score": 3, "last_activity_date": 1543574281, "creation_date": 1472409421, "last_edit_date": 1472489457, "question_id": 39194562, "link": "https://stackoverflow.com/questions/39194562/how-to-remote-debug-with-delve-debugger-in-visual-studio-code", "title": "How to remote debug with Delve debugger in Visual Studio Code", "body": "<p>I have already asked, and got a very good <a href=\"https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code\">answer</a> for debugging locally with delve(golang debugger).</p>\n\n<p>Now I am trying to remote debug with Delve using VS Code.</p>\n\n<p>I have got a sample app mentioned <a href=\"https://github.com/Microsoft/vscode-go\" rel=\"nofollow\">here</a>, and further github linked to source code <a href=\"https://github.com/lukehoban/webapp-go/tree/debugging\" rel=\"nofollow\">here</a>. Note: The debug project is in a branch called debugging.</p>\n\n<p>Are you able to make it work?</p>\n\n<p>I have also created/opened an issue in the <a href=\"https://github.com/lukehoban/webapp-go/issues\" rel=\"nofollow\">repo</a>.</p>\n"}, {"tags": ["go", "gofmt"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 5, "last_activity_date": 1472409820, "last_edit_date": 1592644375, "creation_date": 1472408915, "answer_id": 39194490, "question_id": 39193767, "link": "https://stackoverflow.com/questions/39193767/inconsistent-formatting-of-go-code/39194490#39194490", "title": "Inconsistent formatting of Go code?", "body": "<p>See: <a href=\"https://github.com/golang/go/issues/12720\" rel=\"noreferrer\">https://github.com/golang/go/issues/12720</a></p>\n<blockquote>\n<p>gofmt uses spaces around binary expressions to express binding\nstrength. Depending on nesting level, spaces are removed.</p>\n<p>You could also find these easily by searching for &quot;gofmt inconsistent spaces&quot;.\nSee also issue <a href=\"https://github.com/golang/go/issues/1206\" rel=\"noreferrer\">#1206</a>, <a href=\"https://github.com/golang/go/issues/1848\" rel=\"noreferrer\">#1848</a>, <a href=\"https://github.com/golang/go/issues/1861\" rel=\"noreferrer\">#1861</a>, <a href=\"https://github.com/golang/go/issues/7880\" rel=\"noreferrer\">#7880</a>, and <a href=\"https://github.com/golang/go/issues/11497\" rel=\"noreferrer\">#11497</a>.</p>\n</blockquote>\n"}], "owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 39194490, "answer_count": 1, "score": 3, "last_activity_date": 1472409820, "creation_date": 1472403993, "last_edit_date": 1472409136, "question_id": 39193767, "link": "https://stackoverflow.com/questions/39193767/inconsistent-formatting-of-go-code", "title": "Inconsistent formatting of Go code?", "body": "<p>Here are some example code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    os.MkdirAll(outDir + id, 0755)\n    os.Create(outDir + id + \"/txt\")\n    os.OpenFile(outDir + id + \"/\" + \".tmp\", os.OWRONLY|os_APPEND)\n    os.Stat(outDir + id + \"/.tmp\")\n}\n</code></pre>\n\n<p>The following is the output after formatting with either <code>go fmt</code> or pressing <code>Format</code> on the <a href=\"https://play.golang.org/p/wX0wsWMLum\" rel=\"nofollow\">Go Playground</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    os.MkdirAll(outDir+id, 0755)\n    os.Create(outDir + id + \"/txt\")\n    os.OpenFile(outDir+id+\"/\"+\".tmp\", os.OWRONLY|os_APPEND)\n    os.Stat(outDir + id + \"/.tmp\")\n}\n</code></pre>\n\n<p>Spaces in <code>os.MkdirAll()</code> and <code>os.OpenFile()</code> are removed while they are untouched in <code>os.Create()</code> and <code>os.Stat()</code>. I would expect that formatting to be identical.</p>\n\n<p>Why is this happening?</p>\n"}, {"tags": ["go", "reflection", "go-reflect"], "comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1472403097, "post_id": 39192373, "comment_id": 65727742, "body": "Main idea is the []int cannot be converted to []interface{}. There is no implicit conversion, therefore you cannot append such slice neither without reflect nor with."}, {"owner": {"reputation": 413, "user_id": 4103059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a61baf6ee145a449f11bebdeda94ce1?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Wong", "link": "https://stackoverflow.com/users/4103059/chris-wong"}, "edited": false, "score": 0, "creation_date": 1603875331, "post_id": 39192373, "comment_id": 114171630, "body": "Thanks for your question, saving a lot time!"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1472400899, "last_edit_date": 1472400899, "creation_date": 1472400275, "answer_id": 39193188, "question_id": 39192373, "link": "https://stackoverflow.com/questions/39192373/how-to-reflect-new-a-slice-and-reflect-appendslice-it-to-a-source-slice/39193188#39193188", "title": "How to reflect.New a slice and reflect.AppendSlice it to a source slice", "body": "<p>The panic is on this line:</p>\n\n<pre><code>value = reflect.AppendSlice(value, reflect.ValueOf(s.Elem()))\n</code></pre>\n\n<p>The value <code>s.Elem()</code> is a <code>reflect.Value</code>. Use this value directly in the call to <code>AppendSlice</code>:</p>\n\n<pre><code>value = reflect.AppendSlice(value, s.Elem())\n</code></pre>\n\n<p>The expression <code>reflect.ValueOf(s.Elem())</code> returns the <code>reflect.Value</code> for a <code>reflect.Value</code>, not for the underlying <code>[]int</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/HurU6ehiec\" rel=\"nofollow\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": 0, "last_activity_date": 1472401327, "creation_date": 1472401327, "answer_id": 39193350, "question_id": 39192373, "link": "https://stackoverflow.com/questions/39192373/how-to-reflect-new-a-slice-and-reflect-appendslice-it-to-a-source-slice/39193350#39193350", "title": "How to reflect.New a slice and reflect.AppendSlice it to a source slice", "body": "<p>Error in line 21:</p>\n\n<pre><code>value = reflect.AppendSlice(value, reflect.ValueOf(s.Elem()))\n</code></pre>\n\n<p>See doc:</p>\n\n<pre><code>func AppendSlice(s, t Value) Value\nThe slices s and t must have the same element type.\n</code></pre>\n\n<p>When you dump values, you see:</p>\n\n<pre><code>Var dump s.Elem(): []int(nil) \nVar dump reflect.ValueOf(s.Elem()): {typ:0xfa840 ptr:0x1040e160 flag:407} \nVar dump value: []int(nil) \n</code></pre>\n\n<p>So you only need <code>s.Elem()</code> <br>\nSee: <a href=\"https://play.golang.org/p/KwXRxGyswg\" rel=\"nofollow\">https://play.golang.org/p/KwXRxGyswg</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1473768714, "last_edit_date": 1473768714, "creation_date": 1472407646, "answer_id": 39194309, "question_id": 39192373, "link": "https://stackoverflow.com/questions/39192373/how-to-reflect-new-a-slice-and-reflect-appendslice-it-to-a-source-slice/39194309#39194309", "title": "How to reflect.New a slice and reflect.AppendSlice it to a source slice", "body": "<p>Try this working sample ( <a href=\"https://play.golang.org/p/iwIFcnE0La\" rel=\"nofollow\">The Go Playground</a> ):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    s := reflect.New(reflect.TypeOf([]interface{}{})).Elem()\n    s = reflect.Append(s, reflect.ValueOf(1))\n    s = reflect.AppendSlice(s, reflect.ValueOf([]interface{}{2, 3, 4, 5, 6, 7, 8, 9}))\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[1 2 3 4 5 6 7 8 9]\n</code></pre>\n\n<p>And see: <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow\">https://github.com/golang/go/wiki/InterfaceSlice</a> :</p>\n\n<blockquote>\n  <p>The question then, \"Why can't I assign any slice to an []interface{},\n  when I can assign any type to an interface{}?\"</p>\n  \n  <p>Why?</p>\n  \n  <p>There are two main reasons for this.</p>\n  \n  <p>The first is that a variable with type []interface{} is not an\n  interface! It is a slice whose element type happens to be interface{}.\n  But even given this, one might say that the meaning is clear.</p>\n  \n  <p>Well, is it? A variable with type []interface{} has a specific memory\n  layout, known at compile time.</p>\n  \n  <p>Each interface{} takes up two words (one word for the type of what is\n  contained, the other word for either the contained data or a pointer\n  to it). As a consequence, a slice with length N and with type\n  []interface{} is backed by a chunk of data that is N*2 words long.</p>\n  \n  <p>This is different than the chunk of data backing a slice with type\n  []MyType and the same length. Its chunk of data will be\n  N*sizeof(MyType) words long.</p>\n  \n  <p>The result is that you cannot quickly assign something of type\n  []MyType to something of type []interface{}; the data behind them just\n  look different.</p>\n</blockquote>\n"}], "owner": {"reputation": 149, "user_id": 847562, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/c5664394318c9a31c690985c8d4d9d44?s=128&d=identicon&r=PG", "display_name": "weizhao", "link": "https://stackoverflow.com/users/847562/weizhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1783, "favorite_count": 0, "accepted_answer_id": 39193188, "answer_count": 3, "score": 2, "last_activity_date": 1473768714, "creation_date": 1472394950, "last_edit_date": 1472408047, "question_id": 39192373, "link": "https://stackoverflow.com/questions/39192373/how-to-reflect-new-a-slice-and-reflect-appendslice-it-to-a-source-slice", "title": "How to reflect.New a slice and reflect.AppendSlice it to a source slice", "body": "<p>I want to <code>reflect.New</code> an <code>[]interface{}</code> like <code>[]int</code> and append it into another slice.</p>\n\n<p>My code must have an error, but I don't know how to make it right and how to understand deeply the <code>reflect.New</code> and <code>reflect.AppendSlice</code> usage.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    var a []int\n    var value reflect.Value = reflect.ValueOf(&amp;a)\n\n\n    if !value.CanSet() {\n        fmt.Println(\"go here\", value.CanSet())\n        value = value.Elem() \n        fmt.Println(\"go here\", value.CanSet())  \n    }\n    fmt.Println(\"go here\", value.Type())    \n    s := reflect.New(value.Type())\n    fmt.Println(\"go here\", s.Elem())\n    value = reflect.AppendSlice(value, reflect.ValueOf(s.Elem()))\n    value = reflect.AppendSlice(value, reflect.ValueOf([]int{1, 2}))                \n    value = reflect.AppendSlice(value, reflect.ValueOf([]int{3, 4, 5, 6, 7, 8, 9})) \n\n    fmt.Println(value.Kind(), value.Slice(0, value.Len()).Interface())\n    //&gt;&gt;slice [1 2 3 4 5 6 7 8 9]\n}\n</code></pre>\n\n<p>But it gives an error:</p>\n\n<pre><code>panic: reflect: call of reflect.AppendSlice on struct Value\n\ngoroutine 1 [running]:\npanic(0x100a60, 0x1040e1a0)\n    /usr/local/go/src/runtime/panic.go:500 +0x720\nreflect.flag.mustBe(0x99, 0x17)\n    /usr/local/go/src/reflect/value.go:201 +0xe0\nreflect.AppendSlice(0xfa7e0, 0x1040e130, 0x197, 0x1116a0, 0x1040e190, 0x99, 0x0, 0x0, 0x0, 0x2)\n    /usr/local/go/src/reflect/value.go:1825 +0x60\nmain.main()\n    /tmp/sandbox476529744/main.go:21 +0x800\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/gG4_CyKFKo\" rel=\"nofollow\">golang playground</a></p>\n"}, {"tags": ["go", "docker", "alpine", "gogs"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1472392444, "post_id": 39191664, "comment_id": 65724555, "body": "gogs requires CGO for the SQLite package. You can&#39;t build it without CGO."}, {"owner": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "edited": false, "score": 0, "creation_date": 1472393945, "post_id": 39191664, "comment_id": 65725015, "body": "Just use the Debian image. It&#39;s not that huge (~150MB) and it contains libc (which allows you to use CGO)."}], "owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 678, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472390219, "creation_date": 1472390219, "question_id": 39191664, "link": "https://stackoverflow.com/questions/39191664/c-source-files-not-allowed-when-not-using-cgo-or-swig-sqlite3-binding-c", "title": "C source files not allowed when not using cgo or SWIG: sqlite3-binding.c", "body": "<p>I'm trying to compile gogs with the sqlite tag for alpine, I need to create a statically linked bin because otherwise I get a file not found if I try to run the ADD'ed bin from within an alpine container.</p>\n\n<p>Here's what I'm doing:</p>\n\n<ol>\n<li><p>Cloning the develop branch from the gogs repo\n<code>git clone --depth=1 -b develop https://github.com/gogits/gogs</code></p></li>\n<li><p>cd to run the build\n<code>cd gogs</code></p></li>\n<li><p>Trying a go get with CGO_ENABLED\n<code>CGO_ENABLED=0 go get -a -ldflags '-s' -tags \"sqlite\" -u ./...</code></p></li>\n</ol>\n\n<p>And I get:</p>\n\n<pre><code>error: pathspec 'master' did not match any file(s) known to git.\npackage github.com/gogits/gogs: exit status 1\npackage github.com/mattn/go-sqlite3: C source files not allowed when not using cgo or SWIG: sqlite3-binding.c\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 5800193, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c4e566babcca96e4c1c9509d94c34125?s=128&d=identicon&r=PG&f=1", "display_name": "Bread", "link": "https://stackoverflow.com/users/5800193/bread"}, "edited": false, "score": 0, "creation_date": 1472384883, "post_id": 39190721, "comment_id": 65722403, "body": "Thanks a lot, DisableKeepAlives was enough"}], "tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 2, "last_activity_date": 1472383173, "last_edit_date": 1592644375, "creation_date": 1472383173, "answer_id": 39190721, "question_id": 39190688, "link": "https://stackoverflow.com/questions/39190688/http-transport-proxy-function/39190721#39190721", "title": "http Transport Proxy function", "body": "<p>From the <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">net/http package documentation</a>:</p>\n<blockquote>\n<p>By default, Transport caches connections for future re-use. This may leave many open connections when accessing many hosts. This behavior can be managed using Transport's CloseIdleConnections method and the MaxIdleConnsPerHost and DisableKeepAlives fields.</p>\n<p>Transports should be reused instead of created as needed. Transports are safe for concurrent use by multiple goroutines.</p>\n</blockquote>\n"}], "owner": {"reputation": 353, "user_id": 5800193, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c4e566babcca96e4c1c9509d94c34125?s=128&d=identicon&r=PG&f=1", "display_name": "Bread", "link": "https://stackoverflow.com/users/5800193/bread"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 0, "accepted_answer_id": 39190721, "answer_count": 1, "score": 1, "last_activity_date": 1472383173, "creation_date": 1472382894, "last_edit_date": 1472383007, "question_id": 39190688, "link": "https://stackoverflow.com/questions/39190688/http-transport-proxy-function", "title": "http Transport Proxy function", "body": "<p>Given that I want to use a different proxy per request I did the following:</p>\n\n<pre><code>var proxies chan *url.URL\n\nvar anonymousClient = &amp;http.Client{Transport: &amp;http.Transport{Proxy: func(r *http.Request) (*url.URL, error) {\n    fmt.Println(\"Called\")\n    p := &lt;-proxies\n    proxies &lt;- p\n    return p, nil\n}}}\n</code></pre>\n\n<p>If I make 10 get requests using the above client <code>Called</code> gets printed once, shouldn't it be printed out with every request?</p>\n\n<p>It looks to me that the result of the first call to that function gets cached and its called only once but I can be wrong, any ideas?</p>\n"}, {"tags": ["go", "snappy"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472381323, "post_id": 39190328, "comment_id": 65721471, "body": "Catch the Read error - if not nil what is it ?"}, {"owner": {"reputation": 11, "user_id": 6766704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aff0685ddca1e53864f114ed1d20905a?s=128&d=identicon&r=PG&f=1", "display_name": "paidir", "link": "https://stackoverflow.com/users/6766704/paidir"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472384128, "post_id": 39190328, "comment_id": 65722215, "body": "readErr snappy: corrupt input"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 2, "creation_date": 1472400399, "post_id": 39190328, "comment_id": 65726870, "body": "This is not enough code to really give a meaningful answer; you should provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. It looks like you&#39;re not compressing it correct or doing something else wrong."}], "owner": {"reputation": 11, "user_id": 6766704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aff0685ddca1e53864f114ed1d20905a?s=128&d=identicon&r=PG&f=1", "display_name": "paidir", "link": "https://stackoverflow.com/users/6766704/paidir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 559, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472400328, "creation_date": 1472380090, "last_edit_date": 1472400328, "question_id": 39190328, "link": "https://stackoverflow.com/questions/39190328/snappy-go-cant-decompress-a-string", "title": "snappy-go can&#39;t decompress a string?", "body": "<p>Code:</p>\n\n<pre><code>    stringReader := strings.NewReader(pbMsg.GetBody().GetReqData().GetContent())\n    conBytes := make([]byte,1024)\n    snappyReader := snappy.NewReader(stringReader)\n    rNum, _ := snappyReader.Read(conBytes)\n    fmt.Println(\"rNum\", rNum)\n</code></pre>\n\n<p>I use the snappy-go in a <code>protobuf</code> project.The pb-string was compressed by snappy.</p>\n\n<p>Now I want to to de-compress the string and get the pb-string, but when I use the <code>*string.Reader</code> as a parameter the <code>rNum</code> is <code>0</code>. Where's the error? </p>\n\n<p>tips: <code>pbMsg.GetBody().GetReqData().GetContent()</code> returns a <code>string</code> (compressed by snappy).</p>\n\n<p>thank you very much!!</p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 2, "last_activity_date": 1472378238, "creation_date": 1472378238, "answer_id": 39190074, "question_id": 39189950, "link": "https://stackoverflow.com/questions/39189950/why-can-a-s-slice-be-initialed-by-literal-s/39190074#39190074", "title": "Why can a *S Slice be initialed by literal S?", "body": "<p>From the <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow\">ref spec</a></p>\n\n<blockquote>\n  <p>Within a composite literal of array, slice, or map type T, elements or map keys that are themselves composite literals may elide the respective literal type if it is identical to the element or key type of T. Similarly, elements or keys that are addresses of composite literals may elide the &amp;T when the element or key type is *T. </p>\n</blockquote>\n\n<pre><code>[...]*Point{{1.5, -3.5}, {0, 0}}    // same as [...]*Point{&amp;Point{1.5, -3.5}, &amp;Point{0, 0}}\n</code></pre>\n"}], "owner": {"reputation": 684, "user_id": 1705845, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6fc00f67567eac6c0f0cadbb9f49d3da?s=128&d=identicon&r=PG", "display_name": "xxx7xxxx", "link": "https://stackoverflow.com/users/1705845/xxx7xxxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 2, "accepted_answer_id": 39190074, "answer_count": 1, "score": 3, "last_activity_date": 1472378238, "creation_date": 1472377428, "question_id": 39189950, "link": "https://stackoverflow.com/questions/39189950/why-can-a-s-slice-be-initialed-by-literal-s", "title": "Why can a *S Slice be initialed by literal S?", "body": "<p>I saw this syntax in page187 of <a href=\"http://www.gopl.io/\" rel=\"nofollow\">the go programming language</a>.</p>\n\n<pre><code>var tracks = []*Track{\n    {\"Go\", \"Delilah\", \"From the Roots Up\", 2012, length(\"3m38s\")},\n    {\"Go\", \"Moby\", \"Moby\", 1992, length(\"3m37s\")},\n    {\"Go Ahead\", \"Alicia Keys\", \"As I Am\", 2007, length(\"4m36s\")},\n    {\"Ready 2 Go\", \"Martin Solveig\", \"Smash\", 2011, length(\"4m24s\")},\n}\n</code></pre>\n\n<p>Is it just a syntax sugar of </p>\n\n<pre><code>var tracks = []*Track{\n    &amp;Track{\"Go\", \"Delilah\", \"From the Roots Up\", 2012, length(\"3m38s\")},\n    &amp;Track{\"Go\", \"Moby\", \"Moby\", 1992, length(\"3m37s\")},\n    &amp;Track{\"Go Ahead\", \"Alicia Keys\", \"As I Am\", 2007, length(\"4m36s\")},\n    &amp;Track{\"Ready 2 Go\", \"Martin Solveig\", \"Smash\", 2011, length(\"4m24s\")},\n}\n</code></pre>\n\n<p>I haven't googled the specification of it, please give me the link if there is.</p>\n"}, {"tags": ["function", "design-patterns", "model-view-controller", "go"], "comments": [{"owner": {"reputation": 56002, "user_id": 727208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2bba3700fd3a3e8cc12888edd980525?s=128&d=identicon&r=PG", "display_name": "tere\u0161ko", "link": "https://stackoverflow.com/users/727208/tere%c5%a1ko"}, "edited": false, "score": 2, "creation_date": 1472376357, "post_id": 39189731, "comment_id": 65720199, "body": "No. You did not create MVC structure, You created a directory structure. Also, please not that &quot;Model&quot; should be singular, because it is the layer that contains the domain business logic."}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1472377710, "post_id": 39189731, "comment_id": 65720567, "body": "Please take a look at some exists ones! like Spring in JAVA, Laravel in PHP, Rails is Ruby, etc."}, {"owner": {"reputation": 163, "user_id": 5253536, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-1-_ML3iG1Yw/AAAAAAAAAAI/AAAAAAAAABI/G_t-YKqspMQ/photo.jpg?sz=128", "display_name": "Patryk Gtfo", "link": "https://stackoverflow.com/users/5253536/patryk-gtfo"}, "reply_to_user": {"reputation": 56002, "user_id": 727208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2bba3700fd3a3e8cc12888edd980525?s=128&d=identicon&r=PG", "display_name": "tere\u0161ko", "link": "https://stackoverflow.com/users/727208/tere%c5%a1ko"}, "edited": false, "score": 0, "creation_date": 1472389844, "post_id": 39189731, "comment_id": 65723804, "body": "@tere\u0161ko yes, maybe one file model would be fine, but when i have a lot of code on model ? each model have &quot;package models&quot; so it won&#39;t be right ?"}, {"owner": {"reputation": 56002, "user_id": 727208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2bba3700fd3a3e8cc12888edd980525?s=128&d=identicon&r=PG", "display_name": "tere\u0161ko", "link": "https://stackoverflow.com/users/727208/tere%c5%a1ko"}, "edited": false, "score": 0, "creation_date": 1472393783, "post_id": 39189731, "comment_id": 65724969, "body": "@PatrykGtfo I did not say that a model is a single file. <b>I said it is a single layer.</b> Do you know what application layers are?"}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 5253536, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-1-_ML3iG1Yw/AAAAAAAAAAI/AAAAAAAAABI/G_t-YKqspMQ/photo.jpg?sz=128", "display_name": "Patryk Gtfo", "link": "https://stackoverflow.com/users/5253536/patryk-gtfo"}, "edited": false, "score": 1, "creation_date": 1472396573, "post_id": 39192294, "comment_id": 65725759, "body": "Thanks for advice. I believe that the framework shortens job. Personally i want learn something because I will never learn using predefined rules... so at least I know how it works."}, {"owner": {"reputation": 375, "user_id": 6155813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CpWi2nVr_fQ/AAAAAAAAAAI/AAAAAAAAADY/VF9PXDitHuk/photo.jpg?sz=128", "display_name": "Ali Bedaer", "link": "https://stackoverflow.com/users/6155813/ali-bedaer"}, "edited": false, "score": 0, "creation_date": 1570907562, "post_id": 39192294, "comment_id": 103068120, "body": "hey @pregmatch what is this function called the function that doesn&#39;t have a name  what this doing <code>func (c Application) MyControllerFunc() returnTypeHere(http.Response for example)</code>"}], "tags": [], "owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "is_accepted": true, "score": 4, "last_activity_date": 1472394357, "creation_date": 1472394357, "answer_id": 39192294, "question_id": 39189731, "link": "https://stackoverflow.com/questions/39189731/golang-mvc-structure/39192294#39192294", "title": "Golang MVC structure", "body": "<p>You can have one file called for example MainController where you can make functions for accessing database, sessions, config files and so on. All  you have to do really from there is to say something like this for example (inherit stuff from some other controller):</p>\n\n<pre><code>//MyController.go\ntype App struct {\n    MainController\n}\n\nfunc (c Application) MyControllerFunc() returnTypeHere(http.Response for example) {\n\n    //c.getDatabaseName is function from MainController that reads information from some plain text file or json file or similar\n    someInfoFromConfigFile = c.getDatabaseName()\n    var str []string\n    str = append(str,  someInfoFromConfigFile)\n\n    //RenderJson is function that render http response as json (Content type plain/json)\n    return c.RenderJson(str)\n}\n</code></pre>\n\n<p>But if you need mvc I suggest that you use some framework (Revel for example). I am using it all the time. It gives you that basic mvc functionality if you like and all other stuff is really up to you.\nYou keep you business logic in some helpers, models in models file etc.</p>\n\n<p>You can check Revel main controller structure here:\n<a href=\"https://github.com/revel/revel/blob/master/controller.go\" rel=\"nofollow\">https://github.com/revel/revel/blob/master/controller.go</a></p>\n"}], "owner": {"reputation": 163, "user_id": 5253536, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-1-_ML3iG1Yw/AAAAAAAAAAI/AAAAAAAAABI/G_t-YKqspMQ/photo.jpg?sz=128", "display_name": "Patryk Gtfo", "link": "https://stackoverflow.com/users/5253536/patryk-gtfo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6588, "favorite_count": 2, "accepted_answer_id": 39192294, "answer_count": 1, "score": 6, "last_activity_date": 1545121535, "creation_date": 1472375897, "last_edit_date": 1545121535, "question_id": 39189731, "link": "https://stackoverflow.com/questions/39189731/golang-mvc-structure", "title": "Golang MVC structure", "body": "<p>I searched many sites and I saw a lot of sources in GitHub and I haven't found a solution.</p>\n\n<p>I created an MVC website pattern in Golang:</p>\n\n<ul>\n<li>app\n\n<ul>\n<li>controllers</li>\n<li>models</li>\n<li>lib (All the features class/functions)</li>\n<li>middleware</li>\n<li>router.go</li>\n</ul></li>\n<li>resources\n\n<ul>\n<li>views</li>\n</ul></li>\n<li>main.go</li>\n</ul>\n\n<p><strong>My question is:</strong> How to inject config to have everywhere settings and other implemented class that will always be needed (like load speed single page).</p>\n\n<p>One more thing(additionally): Can anyone recommend me a good material or transcribe MVC tricks idea works MVC with Golang (General useful information).</p>\n"}, {"tags": ["string", "go", "unicode", "substr"], "answers": [{"tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": false, "score": 4, "last_activity_date": 1472373487, "creation_date": 1472373487, "answer_id": 39189430, "question_id": 39189365, "link": "https://stackoverflow.com/questions/39189365/how-to-get-substring-index-based-on-runes-not-bytes-in-go/39189430#39189430", "title": "How to get substring index based on runes not bytes in Go?", "body": "<p>You can use the <a href=\"https://golang.org/pkg/unicode/utf8/#RuneCountInString\" rel=\"noreferrer\"><code>utf8.RuneCountInString()</code></a> method:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strings\"\n    \"unicode/utf8\"\n)\n\nfunc main() {\n    input_string := \"\u60a8\u597d\u4f60\u597d\"\n    byte_index := strings.Index(input_string, \"\u4f60\u597d\")\n    fmt.Println(utf8.RuneCountInString(input_string[:byte_index]))\n}\n</code></pre>\n"}], "owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496345592, "creation_date": 1472373020, "last_edit_date": 1496345592, "question_id": 39189365, "link": "https://stackoverflow.com/questions/39189365/how-to-get-substring-index-based-on-runes-not-bytes-in-go", "title": "How to get substring index based on runes not bytes in Go?", "body": "<p>I'm playing with Golang and found this problem. I can use the following code to get the index based on bytes:</p>\n\n<pre><code>strings.Index(\"\u60a8\u597d\u4f60\u597d\", \"\u4f60\u597d\")\n</code></pre>\n\n<p>What I got is 6 and it's based on bytes counting. </p>\n\n<p>If we count on runes (characters), we should get 2 which is what I want. How can I get what I want?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["for-loop", "go"], "answers": [{"comments": [{"owner": {"reputation": 3144, "user_id": 297824, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d1cf72408e13e38a3bf918413f762e94?s=128&d=identicon&r=PG", "display_name": "T3db0t", "link": "https://stackoverflow.com/users/297824/t3db0t"}, "edited": false, "score": 0, "creation_date": 1472846626, "post_id": 39188604, "comment_id": 65933882, "body": "I&#39;m not clear on why/how <code>i + 20</code> is &quot;not used&quot; in this case?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3144, "user_id": 297824, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d1cf72408e13e38a3bf918413f762e94?s=128&d=identicon&r=PG", "display_name": "T3db0t", "link": "https://stackoverflow.com/users/297824/t3db0t"}, "edited": false, "score": 2, "creation_date": 1472854724, "post_id": 39188604, "comment_id": 65936676, "body": "In the question, the result of the expression <code>i + 20</code> is not assigned to a variable, nor does it have any side effects.  Therefore, the expression is unused."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 17, "last_activity_date": 1472365947, "creation_date": 1472365947, "answer_id": 39188604, "question_id": 39188542, "link": "https://stackoverflow.com/questions/39188542/for-loop-increment-with-a-step-not-working/39188604#39188604", "title": "For loop Increment with a step not working", "body": "<p>The compiler is complaining that the result of the expression <code>i + 20</code> is not used. One fix is to assign result to <code>i</code>:</p>\n\n<pre><code>for i := 0; i &lt;= 300; i = i + 20 {\n</code></pre>\n\n<p>A shorter and more idiomatic approach is to use <code>+=</code>:</p>\n\n<pre><code>for i := 0; i &lt;= 300; i += 20 {\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 5465655, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e900ff0b9014f7b4bdb86fbb4c209521?s=128&d=identicon&r=PG&f=1", "display_name": "Cheral Irumborai", "link": "https://stackoverflow.com/users/5465655/cheral-irumborai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7939, "favorite_count": 0, "accepted_answer_id": 39188604, "answer_count": 1, "score": 1, "last_activity_date": 1577438477, "creation_date": 1472365274, "last_edit_date": 1577438477, "question_id": 39188542, "link": "https://stackoverflow.com/questions/39188542/for-loop-increment-with-a-step-not-working", "title": "For loop Increment with a step not working", "body": "<p>The following Go program fails  to compile </p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n)\n\nfunc main() {\nvar celcius int\nfor i := 0; i &lt;= 300; i + 20 {\n    celcius = 5 * (i - 32) / 9\n    fmt.Printf(\"%d \\t %d\\t \\n\", i, celcius)\n}\n}\n</code></pre>\n\n<p>The Error message is \"i + 20 evaluated but not used\" .  How to give a step increment in golang for loop</p>\n"}, {"tags": ["generics", "go"], "comments": [{"owner": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 0, "creation_date": 1472363582, "post_id": 39188364, "comment_id": 65717707, "body": "This seems like a use case for an interface. What is &quot;something&quot;?"}, {"owner": {"reputation": 11662, "user_id": 615780, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/459b3f1db3e274dd2ffc36710a99bb8b?s=128&d=identicon&r=PG", "display_name": "codereviewanskquestions", "link": "https://stackoverflow.com/users/615780/codereviewanskquestions"}, "reply_to_user": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 0, "creation_date": 1472364003, "post_id": 39188364, "comment_id": 65717763, "body": "I convert that into bytes and do some work.."}], "answers": [{"comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1472394704, "post_id": 39188401, "comment_id": 65725220, "body": "I had this problems on many projects. return intereface{} is way to do it (if you want to return different types with same function based os some switch case or if else). So @tkausl is checked and working of course!"}], "tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": false, "score": 3, "last_activity_date": 1472363708, "creation_date": 1472363708, "answer_id": 39188401, "question_id": 39188364, "link": "https://stackoverflow.com/questions/39188364/golang-generic-param/39188401#39188401", "title": "Golang generic param", "body": "<p>Unfortunately, Go has no generics and no overloading. You can use a parameter of type <code>interface{}</code> and switch over it's real type:</p>\n\n<pre><code>func (*Test) DoSomething(p interface{}) {\n    switch v := p.(type) {\n        case int64:\n            fmt.Println(\"Got an int:\", v)\n        case string:\n            fmt.Println(\"Got a string\", v)\n        default:\n            fmt.Println(\"Got something unexpected\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/M_LETzXXqN\" rel=\"nofollow\">Link on Playground</a></p>\n"}], "owner": {"reputation": 11662, "user_id": 615780, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/459b3f1db3e274dd2ffc36710a99bb8b?s=128&d=identicon&r=PG", "display_name": "codereviewanskquestions", "link": "https://stackoverflow.com/users/615780/codereviewanskquestions"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1472380441, "creation_date": 1472363158, "last_edit_date": 1472380441, "question_id": 39188364, "link": "https://stackoverflow.com/questions/39188364/golang-generic-param", "title": "Golang generic param", "body": "<p>Is there a way to use one function using a generic parameter instead of having two functions as shown below? I have Java background and looking for a way to have something like this </p>\n\n<pre><code>//Java\npublic Something doSomething(T val)\n\n//Go\nfunc (l *myclass) DoSomethingString(value string) error {\n    test := []byte[value]\n    // do something with test\n    return err\n}\nfunc (l *myclass) DoSomethingInt(value int64) error {\n    test := []byte[value]\n    // do something with test\n    return err\n}\n</code></pre>\n"}, {"tags": ["json", "go", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1472347303, "creation_date": 1472347303, "answer_id": 39187225, "question_id": 39186917, "link": "https://stackoverflow.com/questions/39186917/parsing-an-unfamiliar-yaml-json-file-in-go/39187225#39187225", "title": "Parsing an unfamiliar YAML/JSON file in Go", "body": "<p>For JSON, unmarshal the data to an <code>interface{}</code> value.  Use type assertions to determine what's in the value.</p>\n\n<pre><code>var v interface{}\nerr := json.Unmarshal(data, &amp;v)\nif err != nil {\n   // handle error\n}\nswitch v := v.(type) {\ncase string:\n    fmt.Println(\"string:\", v)\ncase float64: \n    fmt.Println(\"number:\", v)\ncase []interface{}:\n    fmt.Println(\"array:\", v)\ncase map[string]interface{}:\n    fmt.Println(\"object:\", v)\ncase nil:\n    fmt.Println(\"nil\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 1, "last_activity_date": 1472347520, "creation_date": 1472347520, "answer_id": 39187239, "question_id": 39186917, "link": "https://stackoverflow.com/questions/39186917/parsing-an-unfamiliar-yaml-json-file-in-go/39187239#39187239", "title": "Parsing an unfamiliar YAML/JSON file in Go", "body": "<p>In the case of JSON, the standard library <code>json.Unmarshal</code> function will unmarshal arbitrary JSON if you like, if you pass it a pointer to an uninitialized empty interface. (See <a href=\"https://play.golang.org/p/LF08ITTxlQ\" rel=\"nofollow\">this example.</a>)</p>\n\n<p>The <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\">official docs</a> even say as much:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n  \n  <blockquote>\n    <p>bool, for JSON booleans</p>\n    \n    <p>float64, for JSON numbers</p>\n    \n    <p>string, for JSON strings</p>\n    \n    <p>[]interface{}, for JSON arrays</p>\n    \n    <p>map[string]interface{}, for JSON objects</p>\n    \n    <p>nil for JSON null</p>\n  </blockquote>\n</blockquote>\n\n<hr>\n\n<p><strong>Edit:</strong> Though not documented, the same is true of the <a href=\"https://godoc.org/gopkg.in/yaml.v2#Unmarshal\" rel=\"nofollow\">yaml</a> package; I tested on my workstation, and passing in a pointer to an uninitialized empty interface results in the initialization of correct arrays, maps, and primitives.</p>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1472347675, "creation_date": 1472343356, "question_id": 39186917, "link": "https://stackoverflow.com/questions/39186917/parsing-an-unfamiliar-yaml-json-file-in-go", "title": "Parsing an unfamiliar YAML/JSON file in Go", "body": "<p>How do you parse YAML data, in Go, without knowing its structure in advance? All of the examples I've seen assume you want to decode a marshaled map whose keys you already know. What if you don't know the keys? What if it's not a map but a marshaled list, a scalar, or some other common type?</p>\n\n<p>Though I'm principally concerned with YAML, here, it seems like the technique might be generally useful for JSON, etc.. since there's a general pattern for parsing structured data (tagged structs, obviously).</p>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 2207, "user_id": 575828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QsUBR.jpg?s=128&g=1", "display_name": "jedifans", "link": "https://stackoverflow.com/users/575828/jedifans"}, "edited": false, "score": 4, "creation_date": 1472342694, "post_id": 39186854, "comment_id": 65714966, "body": "Is <code>go</code> in the $PATH ?"}, {"owner": {"reputation": 3465, "user_id": 1342445, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7ZNEn.jpg?s=128&g=1", "display_name": "pnovotnak", "link": "https://stackoverflow.com/users/1342445/pnovotnak"}, "edited": false, "score": 0, "creation_date": 1472342748, "post_id": 39186854, "comment_id": 65714973, "body": "Sounds like a path issue.. Try adding a <code>printenv | grep PATH</code> to your script and making sure the <code>go</code> binary is in one of the folders listed. If you just installed go, try starting a new terminal"}, {"owner": {"reputation": 33, "user_id": 2293305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc3b46ce52684fec9cfb62c7dbec66?s=128&d=identicon&r=PG", "display_name": "Graham", "link": "https://stackoverflow.com/users/2293305/graham"}, "edited": false, "score": 0, "creation_date": 1472343580, "post_id": 39186854, "comment_id": 65715110, "body": "I get the path as: <code>PATH=&#47;usr&#47;local&#47;sbin:&#47;usr&#47;local&#47;bin:&#47;usr&#47;sbin:&#47;usr&#47;bin:&#47;sbin&zwnj;&#8203;:&#47;bin</code> Which is different than if I run grep the path when I go to the file. So it probably is a path issue. How can I make the script get the correct path?"}, {"owner": {"reputation": 3465, "user_id": 1342445, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7ZNEn.jpg?s=128&g=1", "display_name": "pnovotnak", "link": "https://stackoverflow.com/users/1342445/pnovotnak"}, "edited": false, "score": 0, "creation_date": 1472345053, "post_id": 39186854, "comment_id": 65715317, "body": "Does <code>echo $SHELL</code> produce the same result when you run it in your interactive shell and your script? It might be that you are loading a different shell and that&#39;s not loading the .*rc file where your $PATH is getting properly set."}, {"owner": {"reputation": 33, "user_id": 2293305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc3b46ce52684fec9cfb62c7dbec66?s=128&d=identicon&r=PG", "display_name": "Graham", "link": "https://stackoverflow.com/users/2293305/graham"}, "edited": false, "score": 0, "creation_date": 1472345821, "post_id": 39186854, "comment_id": 65715398, "body": "Yes, both print bin/bash"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 2293305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc3b46ce52684fec9cfb62c7dbec66?s=128&d=identicon&r=PG", "display_name": "Graham", "link": "https://stackoverflow.com/users/2293305/graham"}, "edited": false, "score": 0, "creation_date": 1472349363, "post_id": 39187099, "comment_id": 65715870, "body": "I&#39;ve tried both of these. It recognizes the command now, but it won&#39;t download any of the third party libraries because GOPATH isn&#39;t set. I tried setting GOPATH in the script the same way it&#39;s set in the <code>~&#47;.profile</code> but it doesn&#39;t seem to work."}, {"owner": {"reputation": 2207, "user_id": 575828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QsUBR.jpg?s=128&g=1", "display_name": "jedifans", "link": "https://stackoverflow.com/users/575828/jedifans"}, "edited": false, "score": 0, "creation_date": 1472383361, "post_id": 39187099, "comment_id": 65722018, "body": "Try doing the printenv again but this time without the grep."}, {"owner": {"reputation": 33, "user_id": 2293305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc3b46ce52684fec9cfb62c7dbec66?s=128&d=identicon&r=PG", "display_name": "Graham", "link": "https://stackoverflow.com/users/2293305/graham"}, "edited": false, "score": 0, "creation_date": 1472429252, "post_id": 39187099, "comment_id": 65734178, "body": "Finally figured it out. After putting the paths in etc/bash.bashrc, it wasn&#39;t sourcing from there until I added:         <code>#!&#47;bin&#47;bash     chmod a+x &#47;etc&#47;bash.bashrc     PS1=&#39;$ &#39;     source &#47;etc&#47;bash.bashrc</code>"}], "tags": [], "owner": {"reputation": 3465, "user_id": 1342445, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7ZNEn.jpg?s=128&g=1", "display_name": "pnovotnak", "link": "https://stackoverflow.com/users/1342445/pnovotnak"}, "is_accepted": true, "score": 6, "last_activity_date": 1472346332, "last_edit_date": 1492086162, "creation_date": 1472345732, "answer_id": 39187099, "question_id": 39186854, "link": "https://stackoverflow.com/questions/39186854/bash-script-cant-execute-go-command/39187099#39187099", "title": "Bash script can&#39;t execute Go command", "body": "<p>I'm guessing you followed the installation instructions on the go installation page that tell you to add some lines to your <code>~/.profile</code> file. This file <a href=\"https://askubuntu.com/questions/247738/why-is-etc-profile-not-invoked-for-non-login-shells\">doesn't load for non-interactive sessions (eg; your script.)</a> So you either need to add it to your shell's rcfile, or reference the go binary by it's full path in your script.</p>\n\n<p>You can find out the full path of <code>go</code> by running in your shell:</p>\n\n<pre><code>$ which go\n/path/to/go\n</code></pre>\n\n<p>Then, in your script:</p>\n\n<pre><code>GO=/path/to/go\n$GO command\n</code></pre>\n\n<p>Or, you can extend your <code>PATH</code> inside the script:</p>\n\n<pre><code>PATH=$PATH:/path/to\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 2293305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc3b46ce52684fec9cfb62c7dbec66?s=128&d=identicon&r=PG", "display_name": "Graham", "link": "https://stackoverflow.com/users/2293305/graham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7772, "favorite_count": 2, "accepted_answer_id": 39187099, "answer_count": 1, "score": 2, "last_activity_date": 1472346332, "creation_date": 1472342588, "question_id": 39186854, "link": "https://stackoverflow.com/questions/39186854/bash-script-cant-execute-go-command", "title": "Bash script can&#39;t execute Go command", "body": "<p>I'm trying to write a bash script to automatically run a go get/install in different directories. The relevant part is here: </p>\n\n<pre><code>( cd ../web ; go get )\n( cd ../web ; go install )\n( cd ../services ; go get )\n( cd ../services ; go install )\n</code></pre>\n\n<p>When I execute the script, I get this though: </p>\n\n<ul>\n<li>cd ../web                                                                                                                                                                                 </li>\n<li>go get<br>\n./staging.sh: line 43: go: command not found                                                                                                                                                </li>\n<li>cd ../web                                                                                                                                                                                 </li>\n<li>go install<br>\n./staging.sh: line 44: go: command not found                                                                                                                                                </li>\n<li>cd ../services                                                                                                                                                                            </li>\n<li>go get<br>\n./staging.sh: line 45: go: command not found                                                                                                                                                </li>\n<li>cd ../services                                                                                                                                                                            </li>\n<li>go install<br>\n./staging.sh: line 46: go: command not found    </li>\n</ul>\n\n<p>If I just go to the directories manually and run the commands, they work fine. Why aren't they executing when running from the script?</p>\n"}, {"tags": ["go", "chdir"], "comments": [{"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 9, "creation_date": 1472329980, "post_id": 39185444, "comment_id": 65712213, "body": "Is <code>&#47;tmp</code> a symbolic link to <code>&#47;private&#47;tmp</code>? What does <code>ls -ld &#47;tmp</code> say?"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 1, "creation_date": 1472397588, "post_id": 39185444, "comment_id": 65726048, "body": "This does not answer your question, but if you&#39;re trying to switch to the default temporary directory use <code>os.TempDir()</code> instead of specifying the directory yourself. This will be more portable across different systems and configurations."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1472370555, "creation_date": 1472370555, "answer_id": 39189098, "question_id": 39185444, "link": "https://stackoverflow.com/questions/39185444/os-chdir-tmp-works-abnormally-in-go/39189098#39189098", "title": "os.Chdir(&quot;/tmp&quot;) works abnormally in Go", "body": "<p>As chown in this <a href=\"https://discussions.apple.com/thread/4903601?tstart=0\" rel=\"nofollow noreferrer\">Apple thread</a></p>\n\n<blockquote>\n  <p>On OS X, <code>/tmp</code> is an alias for <code>/private/tmp</code>. </p>\n</blockquote>\n\n<pre><code>$ ls -ale / | grep -i tmp\n\nlrwxr-xr-x@    1 root  wheel        11 Aug 30  2009 tmp -&gt; private/tmp\n\n$\n</code></pre>\n\n<p>And a <a href=\"https://github.com/golang/go/blob/a8c6c4837c17ab4ec3ba78e40b9a72dc70d9cf5a/src/os/file.go#L223-L226\" rel=\"nofollow noreferrer\">golang <code>syscall.Chdir()</code></a> would follow that symlink.<br>\nSo the final path is expected on a Mac OS platform.</p>\n"}], "owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1457, "favorite_count": 2, "accepted_answer_id": 39189098, "answer_count": 1, "score": 1, "last_activity_date": 1472370555, "creation_date": 1472329521, "question_id": 39185444, "link": "https://stackoverflow.com/questions/39185444/os-chdir-tmp-works-abnormally-in-go", "title": "os.Chdir(&quot;/tmp&quot;) works abnormally in Go", "body": "<p>I used Macbook.\nI tried to use <code>os.Chdir(\"/tmp\")</code> but the outcome was <code>/private/tmp</code>. Following is my code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os\"\n)\n\nfunc main() {\n  s, _ := os.Getwd()\n  fmt.Println(s)\n\n  if err := os.Chdir(\"/tmp\"); err != nil {\n    panic(err)\n  }\n  s, _ = os.Getwd()\n  fmt.Println(s)\n\n}\n</code></pre>\n\n<p>And the output is:</p>\n\n<pre><code>\u279c  test   go run main.go\n/Users/willy/test\n/private/tmp\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["go", "ibm-cloud", "cloud-foundry"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472321948, "post_id": 39184293, "comment_id": 65709978, "body": "I don&#39;t know bluemix and I don&#39;t know Godeps but my guess would be that Bluemix expects the Godeps-file (or directory) to be at the root-dir (so right next to your src-directory)."}], "answers": [{"comments": [{"owner": {"reputation": 3924, "user_id": 402149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2xTAq.jpg?s=128&g=1", "display_name": "Dan Higham", "link": "https://stackoverflow.com/users/402149/dan-higham"}, "edited": false, "score": 0, "creation_date": 1472368374, "post_id": 39188834, "comment_id": 65718484, "body": "Looking at the structure you posted, you should be pushing from goapp2016/src/myapp.."}, {"owner": {"reputation": 703, "user_id": 4403581, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5ba586df9282365f9a911501b30f602c?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/4403581/jack"}, "edited": false, "score": 0, "creation_date": 1472540281, "post_id": 39188834, "comment_id": 65779354, "body": "the problem is I was trying to push the app from goapp2016 folder which had the manifest/yml file (goapp is starter code from bluemix). Later I amended the the folder structure as in the question( which is not correct). The manifest.yml and Procfile should be inside myapp.  Now its working after pushing the app from myapp folder."}], "tags": [], "owner": {"reputation": 3924, "user_id": 402149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2xTAq.jpg?s=128&g=1", "display_name": "Dan Higham", "link": "https://stackoverflow.com/users/402149/dan-higham"}, "is_accepted": true, "score": 1, "last_activity_date": 1472368288, "creation_date": 1472368288, "answer_id": 39188834, "question_id": 39184293, "link": "https://stackoverflow.com/questions/39184293/go-application-deployment-in-bluemix-fails/39188834#39188834", "title": "Go application deployment in Bluemix fails", "body": "<p>The compile file for the buildpack can be seen here: <a href=\"https://github.com/cloudfoundry/go-buildpack/blob/master/bin/compile\" rel=\"nofollow\">https://github.com/cloudfoundry/go-buildpack/blob/master/bin/compile</a></p>\n\n<p>Dependency tool selection begins on <a href=\"https://github.com/cloudfoundry/go-buildpack/blob/master/bin/compile#L136\" rel=\"nofollow\">line 136</a>, as long as there is a Godeps/Godeps.json file, the buildpack should used godeps, not GB. Are you sure you are pushing from the folder than contains the Godeps folder, that in turn contains the Godeps.json file?</p>\n"}], "owner": {"reputation": 703, "user_id": 4403581, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5ba586df9282365f9a911501b30f602c?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/4403581/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 39188834, "answer_count": 1, "score": 0, "last_activity_date": 1472368288, "creation_date": 1472321667, "last_edit_date": 1472323648, "question_id": 39184293, "link": "https://stackoverflow.com/questions/39184293/go-application-deployment-in-bluemix-fails", "title": "Go application deployment in Bluemix fails", "body": "<p>I am facing issues with pushing the sample Go applicaiton in Bluemix.</p>\n\n<p>I will explain the steps I followed to push the applicaiton.</p>\n\n<ol>\n<li>Created D:/goapp2016 and set it to GOPATH.</li>\n<li>created src, pkg and bin folders in D:/goapp2016</li>\n<li>In src, created \"myapp\" folder and written a sample app.go file.</li>\n<li>Ran \"go get\" command inside GOPATH/src/myapp and that downloaded the libraries from Git in GOAPTH/src folder and mysql.a,native.a files in D:\\goapp2016\\pkg\\windows_amd64\\github.com\\ziutek\\mymysql. And myapp.exe is also created in GOPATH/bin after running go get command.</li>\n<li>Ran \"godep save\" command which created Godeps/Godeps.json and vendor/(dependent libraries) folder in GOPATH/src/myapp.</li>\n<li>To push the application to bluemix, I  executed cf push command from GOPATH directory.</li>\n</ol>\n\n<p>But, this is giving the below error. </p>\n\n<pre><code>-------&gt; Buildpack version 1.7.5\nfile:///var/vcap/data/dea_next/admin_buildpacks/e57c0cd5-3b42-424d-ad32-b0bee17b\nc1b0_a25a466217b64d5e4d47a6796be8ab23e7b7eeaf/dependencies/https___pivotal-build\npacks.s3.amazonaws.com_concourse-binaries_godep_godep-v62-linux-x64.tgz\n-----&gt; Installing go1.6... done\nDownloaded [file:///var/vcap/data/dea_next/admin_buildpacks/e57c0cd5-3b42-424d-a\nd32-b0bee17bc1b0_a25a466217b64d5e4d47a6796be8ab23e7b7eeaf/dependencies/https___s\ntorage.googleapis.com_golang_go1.6.linux-amd64.tar.gz]\n !\n !     Error: Cloud Foundry does not support the GB package manager\n !     We currently only support the 'Godep' package manager for go apps\n !     For support please file an issue: https://github.com/cloudfoundry/go-    buildpack/issues\n !\n Staging failed: Buildpack compilation step failed\n</code></pre>\n\n<p>Directory Structure:</p>\n\n<pre><code>goapp2016/\n    bin/\n        godep.exe\n        myapp.exe\n    pkg/\n        windows_amd64/\n            github.com/\n                tools/\n                    godep/\n                ziutek/\n                    mymysql\n\n    src/\n        github.com/\n            ziutek/\n\n        myapp/  \n            app.go\n            Godeps/\n                Godeps.json\n            vendor/\n                github.com/\n                    ziutek/\n\n    manifest.yml\n    Procfile\n</code></pre>\n\n<p>Am I missing anything here? </p>\n"}, {"tags": ["go", "path", "filepath"], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1472981109, "post_id": 39182128, "comment_id": 65963049, "body": "This is a trickier topic than filepath suggests. The Posix / separator is a special character in that scheme, but might not be so on a different OS, in general. It&#39;s not a completely general solution because the set of characters permitted in a segment is different between OSes, leading to tricky edge cases . Also, Windows accepts / too (i.e. it has posix compliance)."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 43, "last_activity_date": 1609421603, "last_edit_date": 1609421603, "creation_date": 1472307439, "answer_id": 39182128, "question_id": 39181790, "link": "https://stackoverflow.com/questions/39181790/whats-the-difference-between-path-path-filepath-packages-in-go/39182128#39182128", "title": "What&#39;s the difference between path &amp; path.filepath packages in Go", "body": "<h2>What is the difference?</h2>\n<p>While functionally similar, <strong><a href=\"https://golang.org/pkg/path/\" rel=\"nofollow noreferrer\">path</a></strong> and <strong><a href=\"https://golang.org/pkg/path/filepath\" rel=\"nofollow noreferrer\">path/filepath</a></strong> offer differing implementations. Filepath depends on the <a href=\"https://golang.org/pks/os\" rel=\"nofollow noreferrer\">os</a> package to choose the target runtime's file separators and other differing components when dealing with path strings.</p>\n<p>You can look as the <a href=\"https://golang.org/src/os/\" rel=\"nofollow noreferrer\">os source</a> to see that there are differing implementations for various utility functions. This allows operating system specific details to be abstracted away by the library and helps achieve portability. The <strong>path/filepath</strong> <a href=\"https://godoc.org/path/filepath?import-graph\" rel=\"nofollow noreferrer\">dependency graph</a> illustrates how the package depends upon the <strong>os</strong> package. You can compare this with the <strong>path</strong> <a href=\"https://godoc.org/path?import-graph\" rel=\"nofollow noreferrer\">dependency graph</a>. I would encourage you to go into the <a href=\"https://golang.org/src/path/filepath/\" rel=\"nofollow noreferrer\">filepath</a> and <a href=\"https://golang.org/src/path/filepath/\" rel=\"nofollow noreferrer\">path</a> source code to observe this relationship.</p>\n<h2>When do I use each?</h2>\n<p>You should use <strong>filepath</strong> when working with files. This ensures your paths will be matched with actual files regardless of the underlying runtime. The <strong>path</strong> library should be used within models or when paths may be serialized or communicated with other programs. This ensures that a single formatting scheme is used regardless of what platform the programming is running on. Having a consistent format makes reasoning about models more generic and easier to understand.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1608405335, "creation_date": 1608405335, "answer_id": 65373568, "question_id": 39181790, "link": "https://stackoverflow.com/questions/39181790/whats-the-difference-between-path-path-filepath-packages-in-go/65373568#65373568", "title": "What&#39;s the difference between path &amp; path.filepath packages in Go", "body": "<p>I find <code>path/filepath</code> useful with Windows, as it handles Slash or Backslash,\nwhile <code>path</code> only handles Slash:</p>\n<pre><code>package main\n\nimport (\n   &quot;path&quot;\n   &quot;path/filepath&quot;\n)\n\nfunc main() {\n   back_s := `C:\\go\\bin\\go.exe`\n   slash_s := &quot;C:/go/bin/go.exe&quot;\n   // example 1\n   s1 := path.Dir(back_s)\n   // example 2\n   s2 := path.Dir(slash_s)\n   // example 3\n   s3 := filepath.Dir(back_s)\n   // example 4\n   s4 := filepath.Dir(slash_s)\n   // print\n   println(s1 == &quot;.&quot;, s2 == &quot;C:/go/bin&quot;, s3 == `C:\\go\\bin`, s4 == `C:\\go\\bin`)\n}\n</code></pre>\n"}], "owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5079, "favorite_count": 1, "accepted_answer_id": 39182128, "answer_count": 2, "score": 28, "last_activity_date": 1609421603, "creation_date": 1472305300, "last_edit_date": 1472311809, "question_id": 39181790, "link": "https://stackoverflow.com/questions/39181790/whats-the-difference-between-path-path-filepath-packages-in-go", "title": "What&#39;s the difference between path &amp; path.filepath packages in Go", "body": "<p>I have found that there are lots of similar function in the package <a href=\"https://golang.org/pkg/path/\" rel=\"noreferrer\">path</a> and the package <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"noreferrer\">path/filepath</a>. I have tried several common paths like <code>/var/log/something</code> but did not find any differences. When should one use <code>path</code> directly and when should one use <code>filepath</code> instead?</p>\n"}, {"tags": ["json", "datetime", "go", "iso8601", "rfc3339"], "comments": [{"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1472315221, "post_id": 39179910, "comment_id": 65708030, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/25087960/json-unmarshal-time-that-isnt-in-rfc-3339-format\">json unmarshal time that isn&#39;t in RFC 3339 format</a>"}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": -2, "last_activity_date": 1472294468, "creation_date": 1472294468, "answer_id": 39180192, "question_id": 39179910, "link": "https://stackoverflow.com/questions/39179910/unmarshal-incorrectly-formatted-datetime/39180192#39180192", "title": "Unmarshal incorrectly formatted datetime", "body": "<p>You can try <a href=\"https://play.golang.org/p/IsUpuTKENg\" rel=\"nofollow\">https://play.golang.org/p/IsUpuTKENg</a></p>\n\n<pre>\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t, err := time.Parse(\"2006-01-02T15:04:05.999999999Z0700\", \"2016-08-08T21:35:14.052975-0200\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(t)\n}\n\n</pre>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 23, "last_activity_date": 1472300029, "last_edit_date": 1472300029, "creation_date": 1472294692, "answer_id": 39180230, "question_id": 39179910, "link": "https://stackoverflow.com/questions/39179910/unmarshal-incorrectly-formatted-datetime/39180230#39180230", "title": "Unmarshal incorrectly formatted datetime", "body": "<p>You can define your own <code>time</code> field type that supports both formats:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type MyTime struct {\n    time.Time\n}\n\nfunc (self *MyTime) UnmarshalJSON(b []byte) (err error) {\n    s := string(b)\n\n    // Get rid of the quotes \"\" around the value.\n    // A second option would be to include them\n    // in the date format string instead, like so below: \n    //   time.Parse(`\"`+time.RFC3339Nano+`\"`, s) \n    s = s[1:len(s)-1]\n\n    t, err := time.Parse(time.RFC3339Nano, s)\n    if err != nil {\n        t, err = time.Parse(\"2006-01-02T15:04:05.999999999Z0700\", s)\n    }\n    self.Time = t\n    return\n}\n\ntype Test struct {\n    Time MyTime `json:\"time\"`\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/nYESNHgJI8\" rel=\"noreferrer\">Try on Go Playground</a></kbd></p>\n\n<p>In the example above we take the predefined format <code>time.RFC3339Nano</code>, which is defined like this:</p>\n\n<pre><code>RFC3339Nano = \"2006-01-02T15:04:05.999999999Z07:00\"\n</code></pre>\n\n<p>and remove the <code>:</code></p>\n\n<pre><code>\"2006-01-02T15:04:05.999999999Z0700\"\n</code></pre>\n\n<p>This time format used by <code>time.Parse</code> is described here:\n<a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"noreferrer\">https://golang.org/pkg/time/#pkg-constants</a></p>\n\n<p>Also see the documentation for <code>time.Parse</code>\n<a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\">https://golang.org/pkg/time/#Parse</a></p>\n\n<p>P.S. The fact that the year <code>2006</code> is used in the time format strings is probably because the first version of Golang was released that year.</p>\n"}], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10244, "favorite_count": 8, "accepted_answer_id": 39180230, "answer_count": 2, "score": 15, "last_activity_date": 1582450134, "creation_date": 1472292593, "last_edit_date": 1582450134, "question_id": 39179910, "link": "https://stackoverflow.com/questions/39179910/unmarshal-incorrectly-formatted-datetime", "title": "Unmarshal incorrectly formatted datetime", "body": "<h1>Background</h1>\n\n<p>I am learning Go and I'm trying to do some JSON unmarshaling of a datetime.</p>\n\n<p>I have some JSON produced by a program I wrote in C, I am outputting what I thought was a valid <a href=\"https://www.wikiwand.com/en/ISO_8601\" rel=\"noreferrer\">ISO8601</a> / <a href=\"https://tools.ietf.org/html/rfc3339#section-4.2\" rel=\"noreferrer\">RFC3339</a> timezone offset. I'm using <a href=\"http://man7.org/linux/man-pages/man3/strftime.3.html\" rel=\"noreferrer\"><code>strftime</code></a> with the following format string: </p>\n\n<pre><code>%Y-%m-%dT%H:%M:%S.%f%z\n</code></pre>\n\n<p>(Note that <code>%f</code> is not supported by <a href=\"http://man7.org/linux/man-pages/man3/strftime.3.html\" rel=\"noreferrer\"><code>strftime</code></a> natively, I have a wrapper that replaces it with the nanoseconds).</p>\n\n<p>This will then produce the following result:</p>\n\n<pre><code>2016-08-08T21:35:14.052975+0200\n</code></pre>\n\n<p>Unmarshaling this in Go however will not work:\n<a href=\"https://play.golang.org/p/vzOXbzAwdW\" rel=\"noreferrer\">https://play.golang.org/p/vzOXbzAwdW</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t, err := time.Parse(time.RFC3339Nano, \"2016-08-08T21:35:14.052975+0200\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: parsing time \"2016-08-08T21:35:14.052975+0200\" as \"2006-01-02T15:04:05.999999999Z07:00\": cannot parse \"+0200\" as \"Z07:00\"\n</code></pre>\n\n<p>(Working example: <a href=\"https://play.golang.org/p/5xcM0aHsSw\" rel=\"noreferrer\">https://play.golang.org/p/5xcM0aHsSw</a>)</p>\n\n<p>This is because <a href=\"https://tools.ietf.org/html/rfc3339#section-4.2\" rel=\"noreferrer\">RFC3339 expects the timezone offset to be in the format <code>02:00</code></a> with a <code>:</code>, but <a href=\"http://man7.org/linux/man-pages/man3/strftime.3.html\" rel=\"noreferrer\"><code>strftime</code></a> outputs it as <code>0200</code>.</p>\n\n<p>So I need to fix this in my C program to output the correct format.</p>\n\n<pre><code> %z     The +hhmm or -hhmm numeric timezone (that is, the hour and\n              minute offset from UTC). (SU)\n</code></pre>\n\n<h1>Question</h1>\n\n<p>However, now I have a bunch of JSON files with this incorrect format:</p>\n\n<pre><code>2016-08-08T21:35:14.052975+0200\n</code></pre>\n\n<p>instead of the correct (with the <code>:</code> in the timezone offset):</p>\n\n<pre><code>2016-08-08T21:35:14.052975+02:00\n</code></pre>\n\n<p>but I still want to be able to unmarshal it correctly in my Go program. Preferably two different JSON files with only this difference should parse in the exact same way.</p>\n\n<p>Regarding marshaling back to JSON, the correct format should be used.</p>\n\n<p>This is how I have defined it in my <code>struct</code>:</p>\n\n<pre><code>Time            time.Time `json:\"time\"`\n</code></pre>\n\n<p>So the question is, what is the \"Go\" way of doing this?</p>\n\n<p>Also in my code example I am using <code>RFC3339Nano</code>. How would I specify that in the metadata for the struct as well? As I have it now with just <code>json:\"time\"</code> will that ignore the nano seconds?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "edited": false, "score": 0, "creation_date": 1472288865, "post_id": 39179083, "comment_id": 65700278, "body": "What does your config.Process looks like?"}, {"owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "reply_to_user": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "edited": false, "score": 0, "creation_date": 1472303035, "post_id": 39179083, "comment_id": 65704331, "body": "This is just a struct containing all config options. Config file is a JSON and it was parsed to the variable config (it is not a package )"}], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": false, "score": 0, "last_activity_date": 1472289453, "creation_date": 1472289453, "answer_id": 39179462, "question_id": 39179083, "link": "https://stackoverflow.com/questions/39179083/golang-help-to-optimize-piece-of-the-code/39179462#39179462", "title": "Golang. Help to optimize piece of the code", "body": "<p>Something like this could work (you might need to adjust the types of the function in the interface or drop the interface completely):</p>\n\n<pre><code>setLogIfNotEmpty(config.Process.TraceLog, Trace)\nsetLogIfNotEmpty(config.Process.InfoLog, Info)\nsetLogIfNotEmpty(config.Process.WarningLog, Warning)\nsetLogIfNotEmpty(config.Process.ErrorLog, Error)\n\ninterface SetOutputer {\n    SetOutput(*os.File)\n}\n\nfunc setLogIfNotEmpty(file string, log SetOutputer) {\n    if file != \"\" {\n        f, err := os.OpenFile(file, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n        if err != nil {\n            fmt.Println(\"error opening log file: %v\", err)\n            os.Exit(1)\n        }\n\n        log.SetOutput(f)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "edited": false, "score": 0, "creation_date": 1472306289, "post_id": 39181468, "comment_id": 65705311, "body": "Looks totally fine."}], "tags": [], "owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1472303097, "creation_date": 1472303097, "answer_id": 39181468, "question_id": 39179083, "link": "https://stackoverflow.com/questions/39179083/golang-help-to-optimize-piece-of-the-code/39181468#39181468", "title": "Golang. Help to optimize piece of the code", "body": "<p>This is how i finally did it</p>\n\n<pre><code>m := map[string]*log.Logger{\n    config.Process.TraceLog:   Trace,\n    config.Process.InfoLog:    Info,\n    config.Process.WarningLog: Warning,\n    config.Process.ErrorLog:   Error,\n}\nfor filepath, l := range m {\n    if filepath != \"\" {\n        f, err := os.OpenFile(filepath, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n        if err != nil {\n            fmt.Println(\"error opening log file: %v\", err)\n            os.Exit(1)\n        }\n        l.SetOutput(f)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1472303097, "creation_date": 1472286542, "last_edit_date": 1472293826, "question_id": 39179083, "link": "https://stackoverflow.com/questions/39179083/golang-help-to-optimize-piece-of-the-code", "title": "Golang. Help to optimize piece of the code", "body": "<p>I have the code </p>\n\n<pre><code>if config.Process.TraceLog != \"\" {\n    f, err := os.OpenFile(config.Process.TraceLog, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n    if err != nil {\n        fmt.Println(\"error opening log file: %v\", err)\n        os.Exit(1)\n    }\n\n    Trace.SetOutput(f)\n}\n\nif config.Process.InfoLog != \"\" {\n    f, err := os.OpenFile(config.Process.InfoLog, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n    if err != nil {\n        fmt.Println(\"error opening log file: %v\", err)\n        os.Exit(1)\n    }\n\n    Info.SetOutput(f)\n}\nif config.Process.WarningLog != \"\" {\n    f, err := os.OpenFile(config.Process.WarningLog, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n    if err != nil {\n        fmt.Println(\"error opening log file: %v\", err)\n        os.Exit(1)\n    }\n    Warning.SetOutput(f)\n}\n\nif config.Process.ErrorLog != \"\" {\n    f, err := os.OpenFile(config.Process.ErrorLog, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n\n    if err != nil {\n        fmt.Println(\"error opening log file: %v\", err)\n        os.Exit(1)\n    }\n\n    Error.SetOutput(f)\n}\n</code></pre>\n\n<ol>\n<li><p>What is good way to shorten it? I don't want to repeat same very similar block 4 times.</p></li>\n<li><p>How to make it in a loop? I tried to create a map with file name and logger object, but don't know how to post a reference correctly </p></li>\n</ol>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 5465535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c02516348dbe9779a0fa50bff30fcc99?s=128&d=identicon&r=PG&f=1", "display_name": "Daisy", "link": "https://stackoverflow.com/users/5465535/daisy"}, "edited": false, "score": 0, "creation_date": 1472287545, "post_id": 39179191, "comment_id": 65699924, "body": "But, it is not same as php strtotime(). Both output are different. And output of php function is correct."}, {"owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "reply_to_user": {"reputation": 63, "user_id": 5465535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c02516348dbe9779a0fa50bff30fcc99?s=128&d=identicon&r=PG&f=1", "display_name": "Daisy", "link": "https://stackoverflow.com/users/5465535/daisy"}, "edited": false, "score": 1, "creation_date": 1472287780, "post_id": 39179191, "comment_id": 65699984, "body": "Actually, your PHP is wrong, as it probably uses server locale. Plese see PHP code example above."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 63, "user_id": 5465535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c02516348dbe9779a0fa50bff30fcc99?s=128&d=identicon&r=PG&f=1", "display_name": "Daisy", "link": "https://stackoverflow.com/users/5465535/daisy"}, "edited": false, "score": 0, "creation_date": 1472310608, "post_id": 39179191, "comment_id": 65706621, "body": "@Daisy Indeed, from <a href=\"http://php.net/strtotime\" rel=\"nofollow noreferrer\">the documentation</a>: <code>Each parameter of this function uses the default time zone unless a time zone is specified in that parameter. Be careful not to use different time zones in each parameter unless that is intended</code>."}], "tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": false, "score": 3, "last_activity_date": 1472287650, "last_edit_date": 1472287650, "creation_date": 1472287271, "answer_id": 39179191, "question_id": 39179075, "link": "https://stackoverflow.com/questions/39179075/php-equivalent-to-strtotime-in-go/39179191#39179191", "title": "PHP Equivalent to strtotime() in GO", "body": "<p>In your last line do:</p>\n\n<pre><code>fmt.Println(t.Unix())\n</code></pre>\n\n<p>You can compare it with this PHP code: <a href=\"http://sandbox.onlinephpfunctions.com/code/b520953ea26e2d84ed85db6f5657ceeccade08d4\" rel=\"nofollow\">http://sandbox.onlinephpfunctions.com/code/b520953ea26e2d84ed85db6f5657ceeccade08d4</a></p>\n"}], "owner": {"reputation": 63, "user_id": 5465535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c02516348dbe9779a0fa50bff30fcc99?s=128&d=identicon&r=PG&f=1", "display_name": "Daisy", "link": "https://stackoverflow.com/users/5465535/daisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1239, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1472527178, "creation_date": 1472286508, "last_edit_date": 1472527178, "question_id": 39179075, "link": "https://stackoverflow.com/questions/39179075/php-equivalent-to-strtotime-in-go", "title": "PHP Equivalent to strtotime() in GO", "body": "<p>I am trying to convert date/time string to unix timestamp string:</p>\n\n<pre><code>&lt;?php\n    echo strtotime(\"20140921040000\");\n?&gt;\nOutput: 1411286400   //timestamp\n</code></pre>\n\n<p>Doing same in GO lang, but not getting desired result.\nGo code is below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    tm := time.Unix(1411286400, 0)\n    fmt.Println(tm) //output: 2014-09-21 08:00:00 +0000 UTC\n\n    //================\n    layout := \"20060102150405\"\n    str := \"20140921040000\"\n    t, err := time.Parse(layout, str)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(t) // output: 2014-09-21 04:00:00 +0000 UTC\n}\n</code></pre>\n"}, {"tags": ["javascript", "datetime", "go"], "comments": [{"owner": {"reputation": 30057, "user_id": 693275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OaP2u.jpg?s=128&g=1", "display_name": "Rob M.", "link": "https://stackoverflow.com/users/693275/rob-m"}, "edited": false, "score": 0, "creation_date": 1472282322, "post_id": 39178488, "comment_id": 65698727, "body": "Use <code>+new Date()</code> to get a timestamp and feed that into something like this: <a href=\"http://stackoverflow.com/questions/24987131/how-to-parse-unix-timestamp-in-golang\" title=\"how to parse unix timestamp in golang\">stackoverflow.com/questions/24987131/&hellip;</a>"}, {"owner": {"reputation": 307, "user_id": 5159429, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5b73e4d450e6eebe43c624f1a99b361f?s=128&d=identicon&r=PG", "display_name": "Alaister Young", "link": "https://stackoverflow.com/users/5159429/alaister-young"}, "reply_to_user": {"reputation": 30057, "user_id": 693275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OaP2u.jpg?s=128&g=1", "display_name": "Rob M.", "link": "https://stackoverflow.com/users/693275/rob-m"}, "edited": false, "score": 0, "creation_date": 1472283441, "post_id": 39178488, "comment_id": 65698973, "body": "Hi @RobM. This is a good idea but after inserting it into the db it looks like this: <code>48624-10-12 20:40:21+11</code>"}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 1, "creation_date": 1472285450, "post_id": 39178488, "comment_id": 65699427, "body": "Did you try to use the javascript date method <i>toISOString()</i>? Maybe it format the date in the way you need. If you work on timestamps, pay attention that javascript produce the time in milliseconds, the c standard is in seconds (in golang Unix) and go lang support even nanoseconds. So you have to check which type of conversion you&#39;re doing."}], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": true, "score": 4, "last_activity_date": 1472285461, "creation_date": 1472285461, "answer_id": 39178950, "question_id": 39178488, "link": "https://stackoverflow.com/questions/39178488/parsing-javascript-date-to-a-golang-date/39178950#39178950", "title": "Parsing javascript date to a golang date", "body": "<p>This should give you the correct date. Note how you specify the format:</p>\n\n<pre><code>jsTime, err := time.Parse(\"Mon Jan 02 2006 15:04:05 GMT-0700 (MST)\", \"Sat Aug 27 2016 17:07:43 GMT+1000 (AEST)\")\n\nif (err != nil) {\n    fmt.Printf(\"Error %v\\n\", err)\n    return\n}\n\nfmt.Println(jsTime.Format(\"2006-01-02 15:04:05.000000000 -0700 MST\"))\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 5159429, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5b73e4d450e6eebe43c624f1a99b361f?s=128&d=identicon&r=PG", "display_name": "Alaister Young", "link": "https://stackoverflow.com/users/5159429/alaister-young"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3610, "favorite_count": 0, "accepted_answer_id": 39178950, "answer_count": 1, "score": 3, "last_activity_date": 1472285461, "creation_date": 1472281896, "question_id": 39178488, "link": "https://stackoverflow.com/questions/39178488/parsing-javascript-date-to-a-golang-date", "title": "Parsing javascript date to a golang date", "body": "<p>I need to parse a JavaScript formatted date which I obtain from calling <code>new Date()</code> and looks like <code>Sat Aug 27 2016 17:07:43 GMT+1000 (AEST)</code>.</p>\n\n<p>I am then posting this as a string go my golang server where I need to parse it to be formatted the same as when calling <code>time.Now()</code> which looks like <code>2016-08-30 14:05:31.563336601 +1000 AEST</code>.\nThis date is then stored in my database via gorm which is why I believe it needs to be in this format.</p>\n\n<p>What is the best way of doing this?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 5, "creation_date": 1472268792, "post_id": 39177189, "comment_id": 65696322, "body": "Go is a compiled language, not a scripting language, so there are only so many things you can do to make it look &quot;dynamic&quot;."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472269115, "post_id": 39177189, "comment_id": 65696369, "body": "I&#39;m aware of that. That wasn&#39;t my question or a valid answer."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1472269610, "post_id": 39177189, "comment_id": 65696436, "body": "That&#39;s why I put it as a comment, not an answer."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1472272582, "post_id": 39177189, "comment_id": 65696839, "body": "You could pass your &quot;args&quot; by reference instead."}], "answers": [{"comments": [{"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1472309108, "post_id": 39178724, "comment_id": 65706157, "body": "Can you give me an example of what you are talking about?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1472493669, "post_id": 39178724, "comment_id": 65763520, "body": "@JonStevens, here it is; sorry for the delay."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473191130, "post_id": 39178724, "comment_id": 66043346, "body": "If one of the properties of the params struct was a bool and you wanted to default it to true if nothing was passed, how would you handle if someone actually passed a false? Wouldn&#39;t it treat it as a bool zero-value?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473241503, "post_id": 39178724, "comment_id": 66061310, "body": "@JonStevens, but how does that matter? I mean, if you need to record the fact the user <i>explicitly</i> set some value -- no matter whether it was the same as the zero-value for its underlying type or not -- you&#39;re rather dealing with the case where you need to deal with that &quot;a variable has no value&quot; case (like <code>NULL</code> in SQL databases or <code>undefined</code> in JavaScript or <code>null</code> of .NET&#39;s &quot;nullable types&quot; etc)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473241714, "post_id": 39178724, "comment_id": 66061444, "body": "@JonStevens, Go does not support such <code>NULL</code>/<code>undefined</code> values directly for its types, so you have to use one of available devices to provide something similar. One approach is to use a pointer to a value rather than the value directly: since the zero value for a pointer of any type is <code>nil</code>, and it&#39;s defined to not point to anything valid, this can be used to signify the absence of a value; say, if you define a field of your <code>struct</code> type to be <code>*bool</code> then if the user wants to actually provide a value, they assign a pointer to some vlue of type <code>bool</code> to that field..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473241938, "post_id": 39178724, "comment_id": 66061611, "body": "@JonStevens, ...and if they provide nothing the field has the value <code>nil</code>. The upside of this approach is that it&#39;s reasonably straightforward. The downsides are more pressure on the GC and <code>panic()s</code> in cases when you would blindly dereference that pointer w/o checking it for <code>!= nil</code> first. Another approach is using a separate (boolean) flag meaning &quot;that field was set&quot;. A refinement of this approach is using a custom type like <code>type BoolNull struct { Value bool; Valid bool }</code> with the same semantics: <code>Value</code>&#39;s value is only valid if <code>Valid == true</code>..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473242027, "post_id": 39178724, "comment_id": 66061672, "body": "@JonStevens, ... A nice property of <code>bool</code>&#39;s zero value makes sure such boolean flags start life being <code>false</code> thus making sure values not initialized explicitly are automatically &quot;invalid&quot;. Hope this helps. BTW you can see the latter approach implemented in the Go standard library: <a href=\"https://golang.org/pkg/database/sql/#NullBool\" rel=\"nofollow noreferrer\"><code>NullBool</code></a> et al."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473245024, "post_id": 39178724, "comment_id": 66063494, "body": "@JonStevens, oh, and in case I&#39;ve misinterpreted your comment on the first read, the &quot;pre-processing&quot; or &quot;constructor&quot; approach (the third in my example) deals with this case: you provide the user with a function constructing an instance of such &quot;params&quot; struct pre-filled with whatever data you wants to be the defaults. The user is then free to change whatever fields they want and pass the resulting value to the function."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 0, "creation_date": 1473245188, "post_id": 39178724, "comment_id": 66063593, "body": "@JonStevens, and particularly with booleans, there&#39;s another approach: just make the value have &quot;reversed&quot; semantics and treat it as such. To demonstrate, if you have a variable named <code>DoThat</code> and want it default to <code>true</code> so that the user is able to explicitly tell your function &quot;don&#39;t do that&quot;, then renaming the variable to <code>DontDoThat</code> and defaulting it to <code>false</code> solves the problem: if the user does not explicitly set it to <code>true</code> it defaults to <code>false</code> which is semantically the same as <code>!DoThat</code>."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 4, "last_activity_date": 1472493581, "last_edit_date": 1472493581, "creation_date": 1472283879, "answer_id": 39178724, "question_id": 39177189, "link": "https://stackoverflow.com/questions/39177189/allowing-for-a-variable-number-of-return-values-in-method-declaration/39178724#39178724", "title": "Allowing for a variable number of return values in method declaration", "body": "<p>Please don't write horrible (and ineffective due to <code>reflect</code>) code to solve nonexistent problem.\nAs was indicated in comments, turning a language into\none of your previous languages is indeed compelling\nafter a switch, but this is counterproductive.</p>\n\n<p>Instead, it's better to work with the idioms and approaches\nand best practices the language provides --\neven if you don't like them (yet, maybe).</p>\n\n<p>For this particular case you can roll like this:</p>\n\n<ul>\n<li><p>Make the function which wants to accept\na list of parameters with default values\naccept a single value of a custom <code>struct</code> type.</p></li>\n<li><p>For a start, any variable of such type, when allocated,\nhas all its fields initialized with the so-called \"zero values\"\nappropriate to their respective types.</p>\n\n<p>If that's enough, you can stop there: you will be able\nto pass values of your <code>struct</code> type to your functions\nby producing them via literals right at the call site --\ninitializing only the fields you need.</p>\n\n<p>Otherwise have pre-/post- processing code which\nwould provide your own \"zero values\" for the fields\nyou need.</p></li>\n</ul>\n\n<p><strong>Update on 2016-08-29:</strong></p>\n\n<p>Using a <code>struct</code> type to simulate optional parameters\nusing its fields being assigned default values which happen\nto be Go's native zero values for their respective data types:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype params struct {\n    foo string\n    bar int\n    baz float32\n}\n\nfunc myfun(params params) {\n    fmt.Printf(\"%#v\\n\", params)\n}\n\nfunc main() {\n    myfun(params{})\n    myfun(params{bar: 42})\n    myfun(params{foo: \"xyzzy\", baz: 0.3e-2})\n}\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>main.params{foo:\"\", bar:0, baz:0}\nmain.params{foo:\"\", bar:42, baz:0}\nmain.params{foo:\"xyzzy\", bar:0, baz:0.003}\n</code></pre>\n\n<p>As you can see, Go initializes the fields of our <code>params</code> type\nwith the zero values appropriate to their respective types\nunless we specify our own values when we define our literals.</p>\n\n<p><a href=\"https://play.golang.org/p/sbwOI3kucG\" rel=\"nofollow\">Playground link.</a></p>\n\n<p>Providing default values which are not Go-native zero values for\nthe fields of our custom type can be done by either pre-\nor post-processing the user-submitted value of a compound type.</p>\n\n<p>Post-processing:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype params struct {\n    foo string\n    bar int\n    baz float32\n}\n\nfunc (pp *params) setDefaults() {\n    if pp.foo == \"\" {\n        pp.foo = \"ahem\"\n    }\n    if pp.bar == 0 {\n        pp.bar = -3\n    }\n    if pp.baz == 0 { // Can't really do this to FP numbers; for demonstration purposes only\n        pp.baz = 0.5\n    }\n}\n\nfunc myfun(params params) {\n    params.setDefaults()\n    fmt.Printf(\"%#v\\n\", params)\n}\n\nfunc main() {\n    myfun(params{})\n    myfun(params{bar: 42})\n    myfun(params{foo: \"xyzzy\", baz: 0.3e-2})\n}\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>main.params{foo:\"ahem\", bar:-3, baz:0.5}\nmain.params{foo:\"ahem\", bar:42, baz:0.5}\nmain.params{foo:\"xyzzy\", bar:-3, baz:0.003}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RhliDk8sZP\" rel=\"nofollow\">Playground link.</a></p>\n\n<p>Pre-processing amounts to creating a \"constructor\" function\nwhich would return a value of the required type pre-filled\nwith the default values your choice for its fields\u2014something\nlike this:</p>\n\n<pre><code>func newParams() params {\n    return params{\n        foo: \"ahem\",\n        bar: -3,\n        baz: 0.5,\n    }\n}\n</code></pre>\n\n<p>so that the callers of your function could call <code>newParams()</code>,\ntweak its fields if they need and then pass the resulting value\nto your function:</p>\n\n<pre><code>myfunc(newParams())\n\nps := newParams()\nps.foo = \"xyzzy\"\nmyfunc(ps)\n</code></pre>\n\n<p>This approach is maybe a bit more robust than post-processing but\nit precludes using of literals to construct the values to pass to\nyour function right at the call site which is less \"neat\".</p>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 0, "last_activity_date": 1563795962, "creation_date": 1563795962, "answer_id": 57145380, "question_id": 39177189, "link": "https://stackoverflow.com/questions/39177189/allowing-for-a-variable-number-of-return-values-in-method-declaration/57145380#57145380", "title": "Allowing for a variable number of return values in method declaration", "body": "<p>Recently I was playing with anonymous functions in Go and implemented an example which accepts and returns undefined parameters:</p>\n\n<pre><code>func functions() (funcArray []func(args ... interface{}) (interface{}, error)) {\n\n    type ret struct{\n        first   int\n        second  string\n        third   bool\n    }\n\n    f1 := func(args ... interface{}) (interface{}, error){\n        a := args[0].(int)\n        b := args[1].(int)\n        return (a &lt; b), nil\n    }\n    funcArray = append(funcArray , f1)\n\n    f2 := func(args ... interface{}) (interface{}, error){\n        return (args[0].(string) + args[1].(string)), nil\n    }\n    funcArray = append(funcArray , f2)\n\n    f3 := func(args ... interface{}) (interface{}, error){\n        return []int{1,2,3}, nil\n    }\n    funcArray = append(funcArray , f3)\n\n    f4 := func(args ... interface{}) (interface{}, error){\n        return ret{first: 1, second: \"2\", third: true} , nil\n    }\n    funcArray = append(funcArray , f4)\n\n    return funcArray \n}\n\n\nfunc main() {\n\n    myFirst_Function := functions()[0]\n    mySecond_Function := functions()[1]\n    myThird_Function := functions()[2]\n    myFourth_Function := functions()[3]\n\n    fmt.Println(myFirst_Function(1,2))\n    fmt.Println(mySecond_Function(\"1\",\"2\"))\n    fmt.Println(myThird_Function())\n    fmt.Println(myFourth_Function ())\n\n}\n</code></pre>\n\n<p>I hope it helps you.</p>\n\n<p><a href=\"https://play.golang.org/p/d6dSYLwbUB9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d6dSYLwbUB9</a></p>\n"}], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5127, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1563795962, "creation_date": 1472268628, "last_edit_date": 1491663402, "question_id": 39177189, "link": "https://stackoverflow.com/questions/39177189/allowing-for-a-variable-number-of-return-values-in-method-declaration", "title": "Allowing for a variable number of return values in method declaration", "body": "<p>I have a function that solves the problem of Go not allowing for the setting of default values in method declarations. I want to make it just a little bit better by allowing for a variable number of return variables. I understand that I can allow for an array of interfaces as a return type and then create an interface array with all the variables to return, like this:</p>\n\n<pre><code>func SetParams(params []interface{}, args ...interface{}) (...[]interface{}) {\n    var values []interface{}\n    for i := range params {\n            var value interface{}\n            paramType := reflect.TypeOf(params[i])\n            if len(args) &lt; (i + 1) {\n                    value = params[i]\n            } else {\n                    argType := reflect.TypeOf(args[i])\n                    if paramType != argType {\n                            value = params[i]\n                    }\n                    value = args[i]\n            }\n            values = append(values, value)\n    }\n\n    return values\n}\n</code></pre>\n\n<p>This is an example of a method you want to define default values for. You build it as a variadic function (allowing a variable number of parameters) and then define the default values of the specific params you are looking for inside the function instead of in the declaration line.</p>\n\n<pre><code>func DoSomething(args ...interface{}) {\n    //setup default values\n    str := \"default string 1\"\n    num := 1\n    str2 := \"default string 2\"\n\n\n    //this is fine\n    values := SetParams([]interface{str, num, str2}, args)\n    str = values[0].(string)\n    num = values[1].(int)\n    str = values[2].(string)\n\n\n    //I'd rather support this\n    str, num, str2 = SetParams(params, args)\n}\n</code></pre>\n\n<p>I understand that </p>\n\n<blockquote>\n  <p>[]interface{str, num, str2}</p>\n</blockquote>\n\n<p>in the above example is not syntactically correct. I did it that way to simplify my post. But, it represents another function that builds the array of interfaces.</p>\n\n<p>I would like to support this:</p>\n\n<pre><code>str, num, str2 = SetParams(params, args)\n</code></pre>\n\n<p>instead of having to do this:</p>\n\n<pre><code>values := SetParams([]interface{str, num, str2}, args)\nstr = values[0].(string)\nnum = values[1].(int)\nstr = values[2].(string)\n</code></pre>\n\n<p>Any advice? Help?</p>\n"}, {"tags": ["go", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 6763500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4fa2a86ee261b60451b50a617e639a?s=128&d=identicon&r=PG&f=1", "display_name": "henrheid", "link": "https://stackoverflow.com/users/6763500/henrheid"}, "edited": false, "score": 0, "creation_date": 1472306850, "post_id": 39177058, "comment_id": 65705468, "body": "Thanks for the reply! I did attempt using slices as you&#39;ve suggested here, but i assume that did not work due to the lack of tags in the struct. Until i can come up with something better i guess i&#39;ll just turn them into maps after they&#39;re loaded in!"}], "tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 0, "last_activity_date": 1472267038, "creation_date": 1472267038, "answer_id": 39177058, "question_id": 39176968, "link": "https://stackoverflow.com/questions/39176968/go-unmarshal-yaml-into-struct-with-maps/39177058#39177058", "title": "Go Unmarshal YAML into struct with maps", "body": "<p>Through debugging I found multiple problems. First, <code>yaml</code> doesn't seem to care about the fields names. You <em>have</em> to annotate the fields with a</p>\n\n<pre><code>`yaml:\"NAME\"`\n</code></pre>\n\n<p>Second, in the YAML file, <code>Include</code> and <code>Exclude</code> both contain only a list of strings, not something similar to a map. So your struct becomes:</p>\n\n<pre><code>type Paths struct {\n    Include []string `yaml:\"Include\"`\n    Exclude []string `yaml:\"Exclude\"`\n}\n</code></pre>\n\n<p>And it works. Full code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n)\n\nvar str string = `\n'Include':\n    - 'string1'\n    - 'string2'\n\n'Exclude':\n    - 'string3'\n    - 'string4'\n`\n\ntype Paths struct {\n    Include []string `yaml:\"Include\"`\n    Exclude []string `yaml:\"Exclude\"`\n}\n\nfunc main() {\n    paths := Paths{}\n\n    err := yaml.Unmarshal([]byte(str), &amp;paths)\n\n    fmt.Printf(\"%v\\n\", err)\n    fmt.Printf(\"%+v\\n\", paths)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6763500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4fa2a86ee261b60451b50a617e639a?s=128&d=identicon&r=PG&f=1", "display_name": "henrheid", "link": "https://stackoverflow.com/users/6763500/henrheid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1446, "favorite_count": 0, "accepted_answer_id": 39177058, "answer_count": 1, "score": 0, "last_activity_date": 1472267038, "creation_date": 1472266068, "question_id": 39176968, "link": "https://stackoverflow.com/questions/39176968/go-unmarshal-yaml-into-struct-with-maps", "title": "Go Unmarshal YAML into struct with maps", "body": "<p>I'm attempting to unmarshal a YAML file into a struct containing two maps (using <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow\">go-yaml</a>).</p>\n\n<p>YAML-file:</p>\n\n<pre><code>'Include':\n    - 'string1'\n    - 'string2'\n\n'Exclude':\n    - 'string3'\n    - 'string4'\n</code></pre>\n\n<p>The struct:</p>\n\n<pre><code>type Paths struct {\n    Include map[string]struct{}\n    Exclude map[string]struct{}\n}\n</code></pre>\n\n<p>A simplified version (i.e. removed error handling etc.) of the function attempting to unmarshal:</p>\n\n<pre><code>import \"gopkg.in/yaml.v2\"\n\nfunc getYamlPaths(filename string) (Paths, error) {\n    loadedPaths := Paths{\n        Include: make(map[string]struct{}),\n        Exclude: make(map[string]struct{}),\n    }\n\n    filenameabs, _ := filepath.Abs(filename)\n    yamlFile, err := ioutil.ReadFile(filenameabs)\n\n    err = yaml.Unmarshal(yamlFile, &amp;loadedPaths)\n    return loadedPaths, nil\n}\n</code></pre>\n\n<p>Data is being read from the file, but the unmarshal-function is not putting anything into the struct, and is returning no errors.</p>\n\n<p>I suspect that the unmarshal-function cannot turn the YAML collections into <code>map[string]struct{}</code>, but as mentioned it is producing no errors, and I've looked around for similar issues and can't seem to find any.</p>\n\n<p>Any clues or insight would be much appreciated!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1472274142, "last_edit_date": 1495542816, "creation_date": 1472273503, "answer_id": 39177591, "question_id": 39175779, "link": "https://stackoverflow.com/questions/39175779/how-do-i-separate-the-control-sequence-from-input-string/39177591#39177591", "title": "How do I separate the control sequence from input string", "body": "<p>1- If you need to separate the control sequence from input string, You may use <code>unicode.IsControl(r)</code>:</p>\n\n<blockquote>\n  <p>IsControl reports whether the rune is a control character.  The C\n  (Other) Unicode category includes more code points  such as\n  surrogates; use Is(C, r) to test for them.</p>\n</blockquote>\n\n<p>2- Also See: <a href=\"https://stackoverflow.com/questions/2137357/getpasswd-functionality-in-go\">getpasswd functionality in Go?</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"github.com/howeyc/gopass\"\n\nfunc main() {\n    fmt.Printf(\"Password: \")\n    pass := gopass.GetPasswd()\n    // Do something with pass\n}\n</code></pre>\n\n<p>3- instead of <code>for _, c := range bytes.Runes(password) {</code> you may use: <code>for _, r := range password {</code>, as the following code: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>d := make([]rune, 0, utf8.RuneCount([]byte(password)))\nfor _, r := range password {\n    if !unicode.IsControl(r) {\n        d = append(d, r)\n    }\n}\nfmt.Println(string(d))\n</code></pre>\n\n<p>4- Also you may use <code>strings.Replace</code> for VT100 codes:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>password = strings.Replace(password, \"\\x1b[A\", \"\", -1)\n</code></pre>\n\n<p>And see: <a href=\"http://www.ccs.neu.edu/research/gpc/MSim/vona/terminal/VT100_Escape_Codes.html\" rel=\"nofollow noreferrer\">http://www.ccs.neu.edu/research/gpc/MSim/vona/terminal/VT100_Escape_Codes.html</a></p>\n"}], "owner": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472274142, "creation_date": 1472252980, "last_edit_date": 1472273752, "question_id": 39175779, "link": "https://stackoverflow.com/questions/39175779/how-do-i-separate-the-control-sequence-from-input-string", "title": "How do I separate the control sequence from input string", "body": "<p>I have a sample program to accept passwords on my terminal, and I'm using the terminal package for this. However, when I press any of the arrow keys by mistake while inputting my password I get some weird errors. </p>\n\n<p>I wanted to separate my input password and then only use that for authorization. The following is what I tried.</p>\n\n<p>My input string is </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Accept password using terminal.ReadPassword() which returns []byte\n// password entered is \"\\x1b[Aabcd\"\n// where \\x1b[A is the up arrow key and abcd is my input entry. \n\nfor _, c := range bytes.Runes(password) {\n                if !unicode.IsPrint(c) {\n                    fmt.Printf(\"\\nINVALID PWD \")\n                } else {\n                    d = append(d, c)\n                }\n            }\nfmt.Println(\"\\n\\n\", fmt.Sprintf(\"%c\", d))\n</code></pre>\n\n<p>Here it prints <code>[Aabcd</code> in the end. </p>\n\n<p>Is there anyway I can only capture/print the input characters without the [A here ? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "compilation"], "answers": [{"tags": [], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "is_accepted": false, "score": 0, "last_activity_date": 1472253418, "last_edit_date": 1472253418, "creation_date": 1472253043, "answer_id": 39175787, "question_id": 39175717, "link": "https://stackoverflow.com/questions/39175717/is-it-possible-to-precompile-a-go-project-and-run-on-different-linux-distros/39175787#39175787", "title": "Is it possible to precompile a Go project and run on different Linux distros", "body": "<p>If you build the go program on a Linux machine, it should just work elsewhere, if you mark it as executable <code>chmod +x /path/to/main.go</code>.</p>\n\n<p>You can specify the build using <code>env</code> and the <code>go build</code> cmd tool which architecture to build for (or which OS), for example:</p>\n\n<pre><code>env GOARCH=arm go build main.go\n</code></pre>\n\n<p>If you want, you can specify Linux with</p>\n\n<pre><code>env GOOS=linux go build main.go\n</code></pre>\n\n<p>Note, these are the <em>target</em> environments:</p>\n\n<blockquote>\n  <p>Note that $GOARCH and $GOOS identify the target environment, not the environment you are running on. In effect, you are always cross-compiling. By architecture, we mean the kind of binaries that the target environment can run: an x86-64 system running a 32-bit-only operating system must set GOARCH to 386, not amd64. </p>\n</blockquote>\n\n<p>see here for a full list of distros and architectures:\n<a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow\">https://golang.org/doc/install/source#environment</a></p>\n"}, {"tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": false, "score": 1, "last_activity_date": 1472260964, "last_edit_date": 1472260964, "creation_date": 1472253589, "answer_id": 39175855, "question_id": 39175717, "link": "https://stackoverflow.com/questions/39175717/is-it-possible-to-precompile-a-go-project-and-run-on-different-linux-distros/39175855#39175855", "title": "Is it possible to precompile a Go project and run on different Linux distros", "body": "<p>Note that Go binaries compiled on a Linux OS would work on other Linux distro.</p>\n\n<p>If Docker is an option, you can consider using one of the Go Docker images on <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow\">DockerHub</a>. You can either create a Dockerfile based on one of the <code>&lt;go-version&gt;-onbuild</code> images or build your application on your computer, then <code>COPY</code> the binary over to one the images that is based off the Linux distro of your choice.</p>\n\n<p>The <code>onbuild</code> images builds and runs your application. You can check out its Dockerfile <a href=\"https://github.com/docker-library/golang/blob/2372c8cafe9cc958bade33ad0b8b54de8869c21f/1.7/onbuild/Dockerfile\" rel=\"nofollow\">here</a>. I have seen team uses the second approach of building and running the application binary separately in golang-alpine Docker containers to reduce the size of production images.</p>\n\n<p>Otherwise, you can use Go built-in <a href=\"http://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5\" rel=\"nofollow\">cross-compilation support</a>, which boils down to:</p>\n\n<ol>\n<li>Setting the <code>GOOS</code> and <code>GOARCH</code> environmental variables to be the values for the target operating system and architecture.</li>\n<li>Run <code>go build -v YOURPACKAGE</code></li>\n</ol>\n\n<p>Refer <a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow\">here</a> for a list of supported <code>GOOS</code> and <code>GOARCH</code> values.</p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "closed_date": 1472326391, "answer_count": 2, "score": 0, "last_activity_date": 1472260964, "creation_date": 1472252388, "question_id": 39175717, "link": "https://stackoverflow.com/questions/39175717/is-it-possible-to-precompile-a-go-project-and-run-on-different-linux-distros", "closed_reason": "Duplicate", "title": "Is it possible to precompile a Go project and run on different Linux distros", "body": "<p>I'm new to Go, and wonder if I can build my application on my computer, then put on target machines with different Linux systems and run without having to compile it or its dependencies?</p>\n\n<p>How do I figure out on what target systems what binaries can run?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 70, "user_id": 5790890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY2Se.jpg?s=128&g=1", "display_name": "Red Skotina", "link": "https://stackoverflow.com/users/5790890/red-skotina"}, "edited": false, "score": 0, "creation_date": 1472286096, "post_id": 39178573, "comment_id": 65699570, "body": "thanks. i break cycle with      var gProxy grammar     func init() {        gProxy = g     }     func parseInclude(fileName string) (interface{}, error) {         got, _ := ParseReaderProxy(fileName)         return got, nil     }     func ParseReaderProxy(filename string) (interface{}, error) {         p := &amp;parser{filename: filename}         return p.parse(gProxy)     }  your answer is other way but seems better."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 70, "user_id": 5790890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY2Se.jpg?s=128&g=1", "display_name": "Red Skotina", "link": "https://stackoverflow.com/users/5790890/red-skotina"}, "edited": false, "score": 0, "creation_date": 1472314494, "post_id": 39178573, "comment_id": 65707813, "body": "@RedSkotina That would work too indeed. I have included your approach in the answer for more visibility (and proper formatting)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1472314463, "last_edit_date": 1592644375, "creation_date": 1472282633, "answer_id": 39178573, "question_id": 39174356, "link": "https://stackoverflow.com/questions/39174356/initialization-cycle-error/39178573#39178573", "title": "Initialization cycle error", "body": "<p>This is the result of the <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">package initialization</a> where:</p>\n<blockquote>\n<p>Dependency analysis does not rely on the actual values of the variables, only on lexical references to them in the source, analyzed transitively.</p>\n<p>For instance, if a variable <code>x</code>'s initialization expression refers to a function whose body refers to variable <code>y</code> then <code>x</code> depends on <code>y</code>.</p>\n<p>As in: &quot;A reference to a variable or function is an identifier denoting that variable or function.&quot;</p>\n</blockquote>\n<p>Your <a href=\"https://play.golang.org/p/ShVU2hVoLa\" rel=\"nofollow noreferrer\">example in a playground</a> returns something more direct:</p>\n<pre><code>tmp/sandbox395359317/main.go:21: initialization loop:\n    prog.go:21 g refers to\n    prog.go:28 (*parser).callonIncludeOp1 refers to\n    prog.go:21 g\n</code></pre>\n<p>There are <a href=\"https://8thlight.com/blog/javier-saldana/2015/02/06/loose-coupling-in-go-lang.html\" rel=\"nofollow noreferrer\">techniques in Go for loose coupling</a>, for instance <strong>interface</strong>.</p>\n<p>As an example (not optimal, but at least breaks the initialization cycle), you can in <code>//A</code> add:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type parseIncluder interface {\n    parseInclude(fileName string) (interface{}, error)\n}\n\nfunc (c *current) parseInclude(fileName string) (interface{}, error) {\n    return parseInclude(fileName)\n}\n</code></pre>\n<p>And in <code>//B</code>, the call to <code>parseInclude()</code> becomes:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>got, _ := c.cParseIncluder().parseInclude(&quot;x&quot;)\n</code></pre>\n<p>See <a href=\"https://play.golang.org/p/pc9G3u_Uyt\" rel=\"nofollow noreferrer\">Go plaground</a> and click on <code>Run</code>: no more <code>initialization loop</code>.</p>\n<hr />\n<p>The <a href=\"https://stackoverflow.com/users/5790890/red-skotina\">OP Red Skotina</a> used a different approach with an <a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"nofollow noreferrer\">package <code>init()</code> function</a>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>var gProxy grammar\n\nfunc init() { gProxy = g }\nfunc parseInclude(fileName string) (interface{}, error) {\n    got, _ := ParseReaderProxy(fileName)\n    return got, nil\n}\nfunc ParseReaderProxy(filename string) (interface{}, error) {\n    p := &amp;parser{filename: filename}\n    return p.parse(gProxy)\n}\n</code></pre>\n"}], "owner": {"reputation": 70, "user_id": 5790890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY2Se.jpg?s=128&g=1", "display_name": "Red Skotina", "link": "https://stackoverflow.com/users/5790890/red-skotina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 1, "accepted_answer_id": 39178573, "answer_count": 1, "score": 1, "last_activity_date": 1472314463, "creation_date": 1472244080, "last_edit_date": 1472284970, "question_id": 39174356, "link": "https://stackoverflow.com/questions/39174356/initialization-cycle-error", "title": "Initialization cycle error", "body": "<p>I have autogenerated code. Simplified version:</p>\n\n<pre><code>package main\n\n// begin of A\nfunc main(){\n    ParseReader(\"x\")\n}\nfunc parseInclude(fileName string) (interface{}, error) {\n    got, _ := ParseReader(fileName)\n    return got, nil\n}\n// end of A\ntype grammar struct {\n    pos   int\n    run  func(*parser) (interface{}, error)\n}\nvar g = &amp;grammar{\n    pos:  1,\n    run: (*parser).callonIncludeOp1,\n}\n\ntype parser struct {\n    filename string\n    cur      current\n}\nfunc (p *parser) callonIncludeOp1() (interface{}, error) {\n    return p.cur.onIncludeOp1(\"x\")\n}\nfunc (p *parser) parse(g *grammar) (val interface{}, err error) {\n    return g.pos, nil\n}\n\ntype current struct {\n    pos  int \n}\n// B\nfunc (c *current) onIncludeOp1(qfilename interface{}) (interface{}, error) {\n    got, _ := parseInclude(\"x\")\n    return got, nil\n}\n\nfunc ParseReader(filename string) (interface{}, error) {\n    p := &amp;parser{ filename: filename }\n    return p.parse(g)\n}\n</code></pre>\n\n<p>I have error after compiling</p>\n\n<pre><code>./prog.go:19: initialization loop:\n    /home/gCDfp4/prog.go:19 g refers to\n    /home/gCDfp4/prog.go:25 (*parser).callonIncludeOp1 refers to\n    /home/gCDfp4/prog.go:36 (*current).onIncludeOp1 refers to\n    /home/gCDfp4/prog.go:7 parseInclude refers to\n    /home/gCDfp4/prog.go:41 ParseReader refers to\n    /home/gCDfp4/prog.go:19 g\n</code></pre>\n\n<p>I need do recursive call at grammar because i have preprocessor operator \"#include\" for parsing other file.</p>\n\n<p>Because it is autogenerated code i can only modify code in block A or in function B.</p>\n\n<p>How can i break the initialization cycle ?</p>\n"}, {"tags": ["go", "parallel-processing", "channel"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 4, "last_activity_date": 1472244940, "last_edit_date": 1472244940, "creation_date": 1472243828, "answer_id": 39174308, "question_id": 39174174, "link": "https://stackoverflow.com/questions/39174174/reading-from-golang-channels-in-order/39174308#39174308", "title": "Reading from golang channels in order", "body": "<p>The trouble is in the very first <code>for</code> loop of <code>main</code>. When you use <code>for range</code> loop, the loop variable (<code>chunk</code> here) gets created once and is assigned a copy of each slice element per iteration.</p>\n\n<p>When you call <code>processChunk(&amp;chunk)</code>, you are passing the address of this loop variable, and the value of this variable changes with each iteration. Thus the function <code>processChunk</code> always ends up working on the last item in the <code>chunks</code> loop since that is what <code>*chunk</code> points to after the for loop finishes.</p>\n\n<p>To fix, use slice indexing:</p>\n\n<pre><code>for i := 0; i &lt; len(chunks); i++ {\n    // pass chunk objects by indexing chunks\n    outChannels = append(outChannels, processChunk(&amp;chunks[i]))\n}\n</code></pre>\n\n<p>Fixed code: <a href=\"https://play.golang.org/p/A1_DtkncY_\" rel=\"nofollow\">https://play.golang.org/p/A1_DtkncY_</a></p>\n\n<p>You can read more about <code>range</code> <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 8339, "user_id": 1581069, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/53f781d013b1bdba5b7356908a82d356?s=128&d=identicon&r=PG", "display_name": "Peter Butkovic", "link": "https://stackoverflow.com/users/1581069/peter-butkovic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 0, "accepted_answer_id": 39174308, "answer_count": 1, "score": 1, "last_activity_date": 1472244940, "creation_date": 1472243154, "question_id": 39174174, "link": "https://stackoverflow.com/questions/39174174/reading-from-golang-channels-in-order", "title": "Reading from golang channels in order", "body": "<p>I'm trying to achieve parallel processing and communication over the channels in go.</p>\n\n<p>What I basically try to solve is process a specifc data in parallel, and get results in order => introduced type <code>Chunk</code> for the purpose (see bellow).</p>\n\n<p>I just make new channel for each chunk processing and keep them in slice => expect to be ordered once I iterate over them afterwards.</p>\n\n<p>Simplified version of my program is (<a href=\"https://play.golang.org/p/RVtDGgUVCV\" rel=\"nofollow\">https://play.golang.org/p/RVtDGgUVCV</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Chunk struct {\n    from int\n    to   int\n}\n\nfunc main() {\n    chunks := []Chunk{\n        Chunk{\n            from: 0,\n            to:   2,\n        },\n        Chunk{\n            from: 2,\n            to:   4,\n        },\n    }\n\n    outChannels := [](&lt;-chan struct {\n        string\n        error\n    }){}\n\n    for _, chunk := range chunks {\n        outChannels = append(outChannels, processChunk(&amp;chunk))\n    }\n\n    for _, outChannel := range outChannels {\n        for out := range outChannel {\n            if out.error != nil {\n                fmt.Printf(\"[ERROR] %s\", out.error)\n                return\n            }\n\n            fmt.Printf(\"[STDOUT] %s\", out.string)\n        }\n    }\n}\n\nfunc processChunk(c *Chunk) &lt;-chan struct {\n    string\n    error\n} {\n\n    outChannel := make(chan struct {\n        string\n        error\n    })\n\n    go func() {\n        outChannel &lt;- struct {\n            string\n            error\n        }{fmt.Sprintf(\"from: %d to: %d\\n\", c.from, c.to), nil}\n\n        close(outChannel)\n    }()\n\n    return outChannel\n}\n</code></pre>\n\n<p>The output I see is:</p>\n\n<pre><code>[STDOUT] from: 2 to: 4\n[STDOUT] from: 2 to: 4\n</code></pre>\n\n<p>What I'd however expect to see would be:</p>\n\n<pre><code>[STDOUT] from: 0 to: 2\n[STDOUT] from: 2 to: 4\n</code></pre>\n\n<p>What am I doing wrong here? I don't see it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1472240236, "post_id": 39173430, "comment_id": 65689343, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/30725751/streaming-commands-output-progress\">Streaming commands output progress</a>."}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472241585, "post_id": 39173430, "comment_id": 65689942, "body": "@icza great pointer. I added P.S.2, where instead of waiting for the entire Cmd to finish, I want my function return the interesting output as soon as it&#39;s read without killing the running process."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472244528, "post_id": 39173430, "comment_id": 65691140, "body": "re P.S.4, yes, you need to call wait, so don&#39;t return before calling cmd.Wait()."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 1, "creation_date": 1472240108, "post_id": 39173520, "comment_id": 65689275, "body": "I actually want to sniff the output of the bash script and do some processing before print it out to <code>os.Stdout</code>."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 1, "creation_date": 1472240205, "post_id": 39173520, "comment_id": 65689328, "body": "Next time be sure to mention every thing you want to do in your question to avoid asking these: <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">xyproblem.info</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1472241566, "post_id": 39173520, "comment_id": 65689926, "body": "@cookieisaac: so why not use <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdoutPipe\" rel=\"nofollow noreferrer\">StdOutPipe</a>?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1472239845, "creation_date": 1472239845, "answer_id": 39173520, "question_id": 39173430, "link": "https://stackoverflow.com/questions/39173430/how-to-print-the-realtime-output-of-running-child-process-in-go/39173520#39173520", "title": "How to print the realtime output of running child process in go?", "body": "<p>Set the command output to stdout: </p>\n\n<pre><code>cmd.Stdout = os.Stdout\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1447, "favorite_count": 0, "accepted_answer_id": 39173520, "answer_count": 1, "score": 4, "last_activity_date": 1472481602, "creation_date": 1472239481, "last_edit_date": 1472481602, "question_id": 39173430, "link": "https://stackoverflow.com/questions/39173430/how-to-print-the-realtime-output-of-running-child-process-in-go", "title": "How to print the realtime output of running child process in go?", "body": "<p>I have the following bash script <code>bash_loop.sh</code>that prints 1 to 10 and sleep 3 s in between.</p>\n\n<pre><code>#!/bin/bash\n# Basic while loop\ncounter=1\nwhile [ $counter -le 10 ]\ndo\n    echo $counter\n    ((counter++))\n   sleep 3 \ndone\necho All done\n</code></pre>\n\n<p>Right now, I have my go code as follow:</p>\n\n<pre><code>burstingScript := \"bash_loop.sh\"\ncmd := exec.Command(\"/bin/sh\", burstingScript)\n\nvar out bytes.Buffer\ncmd.Stdout = &amp;out\nif err := cmd.Run(); err != nil {\n    fmt.Println(\"An error has occurred..\")\n    log.Fatal(err)\n}\nfmt.Println(out.String())\n</code></pre>\n\n<p>However, this only print out everything <strong>after</strong> the cmd finish running after 30s, instead of print things as they become available.</p>\n\n<p>So my question is that if I can print each number <strong>while</strong> the bash script is still running instead of printing everything all together after the bash script finishes execution.</p>\n\n<p>P.S.1: In the real use case, I have to process the output of bash script in realtime, instead of simply printing things out to <code>os.Stdout</code>, so I am wondering if there's any command <code>poll()</code> interface or equivalence in go.</p>\n\n<p>P.S.2\uff1aIn the real use case, I want to detach from the child process as soon as I find interesting message. For example, after I read 3, I want my function return 3 immediately and not wait for the rest of output anymore, though I still want the child process (the bash script) itself to be up and running.</p>\n\n<p>P.S.3: In python, I would do something like this</p>\n\n<pre><code>cmd = \"./bash_loop.sh\"\np = subprocess.Popen(cmd, shell=True, stderr=subprocess.PIPE, stdout=subprocess.PIPE)\n\nresult = {}\nwhile True:\n    out = p.stdout.readline()\n    if out == '' and p.poll() != None:\n        break\n    if out != '':\n        #process(out)\n        sys.stdout.write(out)\n        sys.stdout.flush()\n</code></pre>\n\n<p>P.S.4: Now I have evolved my go snippet to follow. Will the child become a zombie if I return before the command finishes running?</p>\n\n<pre><code>burstingScript := path.Join(rootDir, \"bash_loop.sh\")\ncmd := exec.Command(\"/bin/sh\", burstingScript)\n\nstdout, _ := cmd.StdoutPipe()\ncmd.Start()\nscanner := bufio.NewScanner(stdout)\nfor scanner.Scan() {\n    m := scanner.Text()\n    fmt.Println(m)\n    //if m==\"3\" {\n    //  return process(m)\n    //}\n}\ncmd.Wait()\n</code></pre>\n"}, {"tags": ["heroku", "go", "scheduler"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1472282219, "post_id": 39172378, "comment_id": 65698703, "body": "Why not a worker dyno, or a background goroutine in your web worker? <a href=\"https://devcenter.heroku.com/articles/background-jobs-queueing\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/background-jobs-queueing</a>"}, {"owner": {"reputation": 880, "user_id": 2296818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e827c2ecc53630d0e826115adb8b810b?s=128&d=identicon&r=PG", "display_name": "Bastien Beurier", "link": "https://stackoverflow.com/users/2296818/bastien-beurier"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1473725447, "post_id": 39172378, "comment_id": 66241891, "body": "I&#39;m interested in the Scheduler because it spins off a new Dyno every time with different IP address etc."}, {"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 0, "creation_date": 1474879478, "post_id": 39172378, "comment_id": 66695009, "body": "iam having a similar issue. added a golang .exe but it wont run on the scheduler according to heroku tech support due to the servers being linux os."}], "answers": [{"comments": [{"owner": {"reputation": 880, "user_id": 2296818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e827c2ecc53630d0e826115adb8b810b?s=128&d=identicon&r=PG", "display_name": "Bastien Beurier", "link": "https://stackoverflow.com/users/2296818/bastien-beurier"}, "edited": false, "score": 0, "creation_date": 1473725400, "post_id": 39178865, "comment_id": 66241882, "body": "That works well with a bash script, but I wanted to run a go script and go commands don&#39;t seem to work on the Heroku server."}, {"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 0, "creation_date": 1474687656, "post_id": 39178865, "comment_id": 66645532, "body": "getting status 127. booo"}, {"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 0, "creation_date": 1474879539, "post_id": 39178865, "comment_id": 66695037, "body": ".exe wont run on linux apparently"}], "tags": [], "owner": {"reputation": 27694, "user_id": 194175, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56badf521701d4f9b3a394d3ef6e90c4?s=128&d=identicon&r=PG", "display_name": "rdegges", "link": "https://stackoverflow.com/users/194175/rdegges"}, "is_accepted": false, "score": 0, "last_activity_date": 1472284891, "creation_date": 1472284891, "answer_id": 39178865, "question_id": 39172378, "link": "https://stackoverflow.com/questions/39172378/using-heroku-scheduler-add-on-with-golang-app/39178865#39178865", "title": "Using Heroku Scheduler add-on with Golang app", "body": "<p>The Heroku scheduler will run any terminal command basically. So, if you compile your script into an executable called <code>myscript</code>, for example, you could simply put:</p>\n\n<pre><code>myscript\n</code></pre>\n\n<p>In the scheduler and it will execute that command, thereby running your script =) No ruby is required.</p>\n"}, {"comments": [{"owner": {"reputation": 632, "user_id": 872227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ddef50299354758664f679265746cd?s=128&d=identicon&r=PG", "display_name": "freeformz", "link": "https://stackoverflow.com/users/872227/freeformz"}, "edited": false, "score": 1, "creation_date": 1491510689, "post_id": 39460447, "comment_id": 73598932, "body": "That works, but I suggest using multiple <code>cmd&#47;</code> directories instead. I posted an answer that explains that approach."}], "tags": [], "owner": {"reputation": 880, "user_id": 2296818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e827c2ecc53630d0e826115adb8b810b?s=128&d=identicon&r=PG", "display_name": "Bastien Beurier", "link": "https://stackoverflow.com/users/2296818/bastien-beurier"}, "is_accepted": true, "score": 7, "last_activity_date": 1473725308, "creation_date": 1473725308, "answer_id": 39460447, "question_id": 39172378, "link": "https://stackoverflow.com/questions/39172378/using-heroku-scheduler-add-on-with-golang-app/39460447#39460447", "title": "Using Heroku Scheduler add-on with Golang app", "body": "<p>I ended up forking the same <code>main</code> function used by my web dyno:</p>\n\n<pre><code>func main () {\n    if len(os.Args) &gt;= 2 &amp;&amp; os.Args[1] == \"my_job_param\" {\n       // Execute job.\n    } else {\n       // Set up my web server with port, router, etc.\n    }\n}\n</code></pre>\n\n<p>Then, in the Scheduler add-on, I just call: <code>my-app-name \"my_job_param\"</code>. It's pretty hacky, but I wanted to find a solution using the Scheduler add-on.</p>\n"}, {"comments": [{"owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "edited": false, "score": 0, "creation_date": 1506536074, "post_id": 43265218, "comment_id": 79864741, "body": "For those who are not using <code>govendor</code> or <code>glide</code>, this can also be set using an environment variable <code>GO_INSTALL_PACKAGE_SPEC</code>"}], "tags": [], "owner": {"reputation": 632, "user_id": 872227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ddef50299354758664f679265746cd?s=128&d=identicon&r=PG", "display_name": "freeformz", "link": "https://stackoverflow.com/users/872227/freeformz"}, "is_accepted": false, "score": 2, "last_activity_date": 1491510633, "creation_date": 1491510633, "answer_id": 43265218, "question_id": 39172378, "link": "https://stackoverflow.com/questions/39172378/using-heroku-scheduler-add-on-with-golang-app/43265218#43265218", "title": "Using Heroku Scheduler add-on with Golang app", "body": "<p>The typical pattern is to do something like:</p>\n\n<pre><code>.\n\u2514\u2500\u2500 cmd\n    \u251c\u2500\u2500 processX\n    \u2502   \u2514\u2500\u2500 main.go\n    \u2514\u2500\u2500 web\n        \u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>And you set <a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-govendor#build-configuration\" rel=\"nofollow noreferrer\">heroku.install</a> to <code>[\"./cmd/...\"]</code> and Heroku compiles and installs both commands into bin, so you get a <code>bin/web</code> and a <code>bin/processX</code> (<code>processX</code> is just a placeholder, whatever the name of the directory that contains a main package is the name of the resulting executable). In the above case your <code>Procfile</code> would say <code>web: web</code>, the first <code>web</code> being the process type, the second being the name of the executable. And the job you would tell scheduler to run would be <code>processX</code>.</p>\n\n<p>That cleanly separates responsibilities</p>\n"}], "owner": {"reputation": 880, "user_id": 2296818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e827c2ecc53630d0e826115adb8b810b?s=128&d=identicon&r=PG", "display_name": "Bastien Beurier", "link": "https://stackoverflow.com/users/2296818/bastien-beurier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1096, "favorite_count": 1, "accepted_answer_id": 39460447, "answer_count": 3, "score": 4, "last_activity_date": 1491510633, "creation_date": 1472235178, "question_id": 39172378, "link": "https://stackoverflow.com/questions/39172378/using-heroku-scheduler-add-on-with-golang-app", "title": "Using Heroku Scheduler add-on with Golang app", "body": "<p>I can't figure out how to use the Heroku Scheduler add-on with Go. </p>\n\n<p>I would like run a separate Go file periodically, but I can find the command to achieve that. </p>\n\n<p>From Heroku's doc (<a href=\"https://devcenter.heroku.com/articles/scheduler\" rel=\"nofollow\">https://devcenter.heroku.com/articles/scheduler</a>), if the app is not a Rails app, I should use a ruby script. But I don't know how to run a Go file from there.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2114, "user_id": 471949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d5c0d8a73426038b9d089be33dfe9ee?s=128&d=identicon&r=PG", "display_name": "C. Reed", "link": "https://stackoverflow.com/users/471949/c-reed"}, "edited": false, "score": 0, "creation_date": 1472234988, "post_id": 39172215, "comment_id": 65686944, "body": "Are you trying to execute compiled go binaries?"}, {"owner": {"reputation": 690, "user_id": 3144373, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17911da2f421426738ac8109965a7a62?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/3144373/evgeny"}, "reply_to_user": {"reputation": 2114, "user_id": 471949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d5c0d8a73426038b9d089be33dfe9ee?s=128&d=identicon&r=PG", "display_name": "C. Reed", "link": "https://stackoverflow.com/users/471949/c-reed"}, "edited": false, "score": 0, "creation_date": 1472235339, "post_id": 39172215, "comment_id": 65687104, "body": "Yes, I am! for instance $ minio server /somefolder"}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": -1, "last_activity_date": 1472235767, "creation_date": 1472235767, "answer_id": 39172546, "question_id": 39172215, "link": "https://stackoverflow.com/questions/39172215/go-lang-environment-and-paths/39172546#39172546", "title": "Go lang environment and paths", "body": "<p>You can run <code>go env</code> to see your <code>$GOPATH</code> and some environment variable</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472241977, "post_id": 39172672, "comment_id": 65690111, "body": "PATH should be exported from .profile or .bash_profile, not .bashrc."}], "tags": [], "owner": {"reputation": 2114, "user_id": 471949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d5c0d8a73426038b9d089be33dfe9ee?s=128&d=identicon&r=PG", "display_name": "C. Reed", "link": "https://stackoverflow.com/users/471949/c-reed"}, "is_accepted": true, "score": 1, "last_activity_date": 1472236170, "creation_date": 1472236170, "answer_id": 39172672, "question_id": 39172215, "link": "https://stackoverflow.com/questions/39172215/go-lang-environment-and-paths/39172672#39172672", "title": "Go lang environment and paths", "body": "<p>Verify that the binary you are trying to run is in your <code>$GOPATH/bin</code> directory, e.g. it should appear when you run <code>ls $GOPATH/bin</code></p>\n\n<p>Next, verify that <code>$GOPATH/bin</code> is in your <code>$PATH</code>, e.g. it should appear with <code>echo $PATH</code>. If this <code>$GOPATH/bin</code> is not in your <code>$PATH</code>, add it e.g. <code>export PATH=$GOPATH/bin:$PATH</code> (you may want to add this to your <code>.bashrc</code>). </p>\n"}, {"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 0, "last_activity_date": 1472251104, "last_edit_date": 1472251104, "creation_date": 1472247061, "answer_id": 39174884, "question_id": 39172215, "link": "https://stackoverflow.com/questions/39172215/go-lang-environment-and-paths/39174884#39174884", "title": "Go lang environment and paths", "body": "<p>In Mac OS X, open terminal</p>\n\n<p>create a .profile file</p>\n\n<p><code>touch .profile</code></p>\n\n<p>edit it</p>\n\n<p><code>vim .profile</code></p>\n\n<p>add this to your first line</p>\n\n<p><code>export GOPATH=$HOME/work/</code> or whatever directory your Go files are in</p>\n\n<p>save <code>:w</code> and quit <code>:q</code></p>\n\n<p>restart terminal</p>\n\n<p>change to your new GOPATH/bin directory to confirm </p>\n\n<p><code>cd $GOPATH/bin</code></p>\n"}], "owner": {"reputation": 690, "user_id": 3144373, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17911da2f421426738ac8109965a7a62?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/3144373/evgeny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1291, "favorite_count": 2, "accepted_answer_id": 39172672, "answer_count": 3, "score": -2, "last_activity_date": 1472251104, "creation_date": 1472234495, "last_edit_date": 1472235833, "question_id": 39172215, "link": "https://stackoverflow.com/questions/39172215/go-lang-environment-and-paths", "title": "Go lang environment and paths", "body": "<p>I have few apps cloned from github, but not sure if I do everything right. I recently installed go.</p>\n\n<pre><code>$ go\nGo is a tool for managing Go source code.\n\nUsage:\n\n        go command [arguments]\n\nThe commands are:\n\n        build       compile packages and dependencies\n        clean       remove object files\n        doc         show documentation for package or symbol\n        env         print Go environment information\n        fix         run go tool fix on packages\n        fmt         run gofmt on package sources\n        generate    generate Go files by processing source\n        get         download and install packages and dependencies\n        install     compile and install packages and dependencies\n        list        list packages\n        run         compile and run Go program\n        test        test packages\n        tool        run specified go tool\n        version     print Go version\n        vet         run go tool vet on packages\n\nUse \"go help [command]\" for more information about a command.\n\nAdditional help topics:\n\n        c           calling between Go and C\n        buildmode   description of build modes\n        filetype    file types\n        gopath      GOPATH environment variable\n        environment environment variables\n        importpath  import path syntax\n        packages    description of package lists\n        testflag    description of testing flags\n        testfunc    description of testing functions\n\nUse \"go help [topic]\" for more information about that topic.\n</code></pre>\n\n<p>And I have things configured accordingly (exported variables etc..) also added them into ~/.bashrc however I still need to change directory and go to my go/bin folder.. is this what all are doing or there is something I can change. Would be great if you can point me on some sort of docs (not go lang please!). </p>\n\n<p>I am on Mac OS X.</p>\n"}, {"tags": ["go", "enums"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1472232851, "post_id": 39171792, "comment_id": 65685965, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/23459224/golang-namespaced-enums\">GOLANG &quot;Namespaced&quot; enums?</a>"}, {"owner": {"reputation": 3546, "user_id": 6475535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DlHDL.jpg?s=128&g=1", "display_name": "G07cha", "link": "https://stackoverflow.com/users/6475535/g07cha"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1472232988, "post_id": 39171792, "comment_id": 65686020, "body": "I&#39;ve seen this question but in my case, I&#39;m writing all code in one namespace."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1472233745, "post_id": 39171792, "comment_id": 65686360, "body": "Only possible solutions I can think of are the answers in the question mentioned by Tim."}, {"owner": {"reputation": 3546, "user_id": 6475535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DlHDL.jpg?s=128&g=1", "display_name": "G07cha", "link": "https://stackoverflow.com/users/6475535/g07cha"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1472234215, "post_id": 39171792, "comment_id": 65686590, "body": "@AJPennster, according to answers there is only way is to store enums in another package, is there is no way of storing enumerable in same namespace as property of structure for example?"}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1472235251, "post_id": 39171792, "comment_id": 65687065, "body": "There is a second answer there with the use of types. The constants will still be globally available to the package but only if you use the type associated with it. That is the closest answer I can think of to what you&#39;re asking."}], "answers": [{"tags": [], "owner": {"reputation": 3546, "user_id": 6475535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DlHDL.jpg?s=128&g=1", "display_name": "G07cha", "link": "https://stackoverflow.com/users/6475535/g07cha"}, "is_accepted": true, "score": 0, "last_activity_date": 1472280283, "creation_date": 1472280283, "answer_id": 39178282, "question_id": 39171792, "link": "https://stackoverflow.com/questions/39171792/enum-as-variables-property-in-go/39178282#39178282", "title": "Enum as variable&#39;s property in go", "body": "<p>The only way to assign some sort of enumerable behind the property without creating the separate package that I found is to use anonymous structure.</p>\n\n<pre><code>type someType int\n\nvar ConstantsList = struct {\n   FOO, BAR, BAZ someType\n}{1, 2, 3}\n</code></pre>\n\n<p>There are few downsides of using it, it's not immutable, and doesn't have auto increment.</p>\n"}], "owner": {"reputation": 3546, "user_id": 6475535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DlHDL.jpg?s=128&g=1", "display_name": "G07cha", "link": "https://stackoverflow.com/users/6475535/g07cha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "accepted_answer_id": 39178282, "answer_count": 1, "score": 0, "last_activity_date": 1472280283, "creation_date": 1472232705, "last_edit_date": 1472233069, "question_id": 39171792, "link": "https://stackoverflow.com/questions/39171792/enum-as-variables-property-in-go", "title": "Enum as variable&#39;s property in go", "body": "<p>Let's say I have something like this:</p>\n\n<pre><code>const (\n    FOO int = iota\n    BAR\n    BAZ\n)\n</code></pre>\n\n<p>And I can access to variables by <code>FOO</code>, <code>BAR</code> and so on. But storing a big amount of constants in one namespace isn't good so I'm trying to hide this enum in structure or something like that so I can get value by typing <code>actions.FOO</code> in same namespace. I've tried many ways but didn't find anything like that. I would like to mention that easiest workaround, in this case, will be anonymous structure but I wanna keep auto indexing with <code>iota</code>.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 0, "creation_date": 1472233805, "post_id": 39171734, "comment_id": 65686384, "body": "Is there a way to abstract this? Is it possible to pass the &quot;type&quot; Like as function parameter? I&#39;d like to test it with several types, given several int inputs."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 0, "creation_date": 1472233977, "post_id": 39171734, "comment_id": 65686474, "body": "@bigdestroyer is there a reason you want to do this in this way? Not saying that type checking doesn&#39;t have its place, but it doesn&#39;t seem like what you really want to do here. It seems like what you want to do is have an unexported attribute on the struct that indicates its type that has an associated Getter in the interface."}, {"owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 0, "creation_date": 1472234245, "post_id": 39171734, "comment_id": 65686605, "body": "Well, I want to test that from value 0, an instance of <code>Like</code> is created; from value 1, an instance of <code>Following</code> is created, and so on. Each one is a different type implementing <code>Event</code> interface. I don&#39;t want any field indicating its type, just test the &quot;factory&quot; function. What do you think? You solved my original question so I accept BTW."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 44, "last_activity_date": 1516989560, "last_edit_date": 1516989560, "creation_date": 1472232456, "answer_id": 39171734, "question_id": 39171678, "link": "https://stackoverflow.com/questions/39171678/instanceof-equivalent-in-golang/39171734#39171734", "title": "&quot;instanceof&quot; equivalent in Golang", "body": "<p>You could just cast it and see if it fails:</p>\n\n<pre><code>event, err := New(0)\nif err != nil {\n    t.Error(err)\n}\n_, ok := event.(Like)\nif !ok {\n    t.Error(\"Assertion error\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 0, "creation_date": 1472233659, "post_id": 39171817, "comment_id": 65686315, "body": "Thanks for your answer. Is there a way to obtain the name (&quot;Like&quot;) from the type Like? I mean, without hardcoding..."}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 2, "creation_date": 1472235016, "post_id": 39171817, "comment_id": 65686959, "body": "I think it&#39;s simpler to use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertions</a> as in @dave&#39;s answer."}], "tags": [], "owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "is_accepted": false, "score": 8, "last_activity_date": 1472232766, "creation_date": 1472232766, "answer_id": 39171817, "question_id": 39171678, "link": "https://stackoverflow.com/questions/39171678/instanceof-equivalent-in-golang/39171817#39171817", "title": "&quot;instanceof&quot; equivalent in Golang", "body": "<p>the <code>TypeOf()</code> method returns an object of type <code>Type</code>, and you can get the name of that type as a string with the <code>Name()</code> method.</p>\n\n<p>I haven't tested this, but something like this may work:</p>\n\n<pre><code>if reflect.TypeOf(event).Name() != \"Like\" {\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3643, "user_id": 4206925, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PhlNi.png?s=128&g=1", "display_name": "MewX", "link": "https://stackoverflow.com/users/4206925/mewx"}, "edited": false, "score": 1, "creation_date": 1520670956, "post_id": 48145372, "comment_id": 85418912, "body": "If you want to compare an interface with a basic type like float32, you could use <code>if reflect.TypeOf(objectPtr).Kind() == reflect.Float32 {}</code>. An example: <a href=\"https://stackoverflow.com/a/49206944/4206925\">stackoverflow.com/a/49206944/4206925</a>"}], "tags": [], "owner": {"reputation": 2117, "user_id": 1290995, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1279e000be24ac05c1743783572b6be?s=128&d=identicon&r=PG", "display_name": "Behnam", "link": "https://stackoverflow.com/users/1290995/behnam"}, "is_accepted": false, "score": 6, "last_activity_date": 1515393458, "creation_date": 1515393458, "answer_id": 48145372, "question_id": 39171678, "link": "https://stackoverflow.com/questions/39171678/instanceof-equivalent-in-golang/48145372#48145372", "title": "&quot;instanceof&quot; equivalent in Golang", "body": "<p>Late answer but this works fine</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"reflect\"\n)\n\ntype SomeStruct1 struct{}\ntype SomeStruct2 struct{}\n\nfunc IsInstanceOf(objectPtr, typePtr interface{}) bool {\n  return reflect.TypeOf(objectPtr) == reflect.TypeOf(typePtr)\n}\n\nfunc main() {\n  //sample variables\n  someString := \"Some String\"\n  someFloat := float32(2.4)\n  someStruct1 := SomeStruct1{}\n  someStruct2 := SomeStruct2{}\n  someStruct1Ptr := &amp;SomeStruct1{}\n\n  // primitive string\n  fmt.Println(\"string &lt;-&gt; *string \\t\\t\", IsInstanceOf(someString, (*string)(nil)))   //false\n  fmt.Println(\"*string &lt;-&gt; *string \\t\\t\", IsInstanceOf(&amp;someString, (*string)(nil))) //true\n\n  // primitive float32\n  fmt.Println(\"float32 &lt;-&gt; *float32 \\t\\t\", IsInstanceOf(someFloat, (*float32)(nil)))   //false\n  fmt.Println(\"*float32 &lt;-&gt; *float32 \\t\\t\", IsInstanceOf(&amp;someFloat, (*float32)(nil))) //true\n\n  // structure\n  fmt.Println(\"SomeStruct1 &lt;-&gt; *SomeStruct1 \\t\", IsInstanceOf(someStruct1, (*SomeStruct1)(nil)))     //false\n  fmt.Println(\"*SomeStruct1 &lt;-&gt; *SomeStruct1 \\t\", IsInstanceOf(&amp;someStruct1, (*SomeStruct1)(nil)))   //true\n  fmt.Println(\"*SomeStruct2 &lt;-&gt; *SomeStruct1 \\t\", IsInstanceOf(&amp;someStruct2, (*SomeStruct1)(nil)))   //false\n  fmt.Println(\"*SomeStruct1 &lt;-&gt; *SomeStruct1 \\t\", IsInstanceOf(someStruct1Ptr, (*SomeStruct1)(nil))) //true\n}\n</code></pre>\n\n<p>Playground ( run it online ) : <a href=\"https://play.golang.org/p/tcQqdzUGMlL\" rel=\"noreferrer\">https://play.golang.org/p/tcQqdzUGMlL</a></p>\n"}], "owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18562, "favorite_count": 3, "accepted_answer_id": 39171734, "answer_count": 3, "score": 23, "last_activity_date": 1516989560, "creation_date": 1472232243, "question_id": 39171678, "link": "https://stackoverflow.com/questions/39171678/instanceof-equivalent-in-golang", "title": "&quot;instanceof&quot; equivalent in Golang", "body": "<p>I have this structs:</p>\n\n<pre><code>type Event interface {\n    Accept(EventVisitor)\n}\n\ntype Like struct {\n}\n\nfunc (l *Like) Accept(visitor EventVisitor) {\n    visitor.visitLike(l)\n}\n</code></pre>\n\n<p>How can I test that <code>event</code> is a <code>Like</code> instance?</p>\n\n<pre><code>func TestEventCreation(t *testing.T) {\n    event, err := New(0)\n    if err != nil {\n        t.Error(err)\n    }\n    if reflect.TypeOf(event) != Like {\n        t.Error(\"Assertion error\")\n    }\n}\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>Type Like is not an expression event Event</p>\n</blockquote>\n"}, {"tags": ["go", "settings", "environment"], "comments": [{"owner": {"reputation": 11496, "user_id": 300187, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o5Qmp.jpg?s=128&g=1", "display_name": "Artem Sokolov", "link": "https://stackoverflow.com/users/300187/artem-sokolov"}, "edited": false, "score": 0, "creation_date": 1472235071, "post_id": 39170859, "comment_id": 65686982, "body": "Seems like it&#39;s trying to open &quot;/usr/lib/go-1.6/pkg/linux_amd64/github.com/valyala/quicktem&zwnj;&#8203;plate.a: open /usr/lib/go-1.6/pkg/linux_amd64/github.com/valyala/quicktemp&zwnj;&#8203;late.a&quot;?"}, {"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1530218883, "post_id": 39170859, "comment_id": 89170257, "body": "cmd/compile: &quot;dot import&quot; causes confusing error"}], "answers": [{"tags": [], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1472229691, "creation_date": 1472229691, "answer_id": 39171022, "question_id": 39170859, "link": "https://stackoverflow.com/questions/39170859/missing-link-to-static-library/39171022#39171022", "title": "Missing link to static library", "body": "<p>Sorry, I solved. The <code>main.go</code> code was:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"./templates\"\n)\n\nfunc main() {\n    fmt.Printf(\"%s\\n\", templates.Hello(\"Foo\"))\n    fmt.Printf(\"%s\\n\", templates.Hello(\"Bar\"))\n}\n</code></pre>\n\n<p>so I missed to use absolute path in the import section:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"quick/templates\"\n)\n\nfunc main() {\n    fmt.Printf(\"%s\\n\", templates.Hello(\"Foo\"))\n    fmt.Printf(\"%s\\n\", templates.Hello(\"Bar\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572797684, "creation_date": 1472229024, "last_edit_date": 1572797684, "question_id": 39170859, "link": "https://stackoverflow.com/questions/39170859/missing-link-to-static-library", "title": "Missing link to static library", "body": "<p>Running a <code>go run main.go</code> I get a strange error message:</p>\n\n<pre><code>danilo@lm ~/godev/src/quick $ go run main.go \ncommand-line-arguments\n/usr/lib/go-1.6/pkg/tool/linux_amd64/link: cannot open file /usr/lib/go-1.6/pkg/linux_amd64/github.com/valyala/quicktemplate.a: open /usr/lib/go-1.6/pkg/linux_amd64/github.com/valyala/quicktemplate.a: no such file or directory`\n</code></pre>\n\n<p>Here is my environment:</p>\n\n<p>Linux Mint 18</p>\n\n<p>GOLANG ENV:</p>\n\n<pre><code>danilo@lm ~/godev/src/quick $ go env\nGOARCH=\"amd64\"\nGOBIN=\"/home/danilo/godev/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/danilo/godev\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go-1.6\"\nGOTOOLDIR=\"/usr/lib/go-1.6/pkg/tool/linux_amd64\"\nGO15VENDOREXPERIMENT=\"1\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>My $GOPATH tree:</p>\n\n<pre><code>.(godev)\n\u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 qtc\n\u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 linux_amd64\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 github.com\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 valyala\n\u2502\u00a0\u00a0             \u251c\u2500\u2500 bytebufferpool.a\n\u2502\u00a0\u00a0             \u2514\u2500\u2500 quicktemplate.a\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 github.com\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 valyala\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 bytebufferpool\n    \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 ...\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 quicktemplate\n    \u2502\u00a0\u00a0         \u251c\u2500\u2500 ...\n    \u2514\u2500\u2500 quick\n        \u251c\u2500\u2500 main.go\n        \u2514\u2500\u2500 templates\n            \u251c\u2500\u2500 hello.qtpl\n            \u2514\u2500\u2500 hello.qtpl.go\n</code></pre>\n\n<p>It seems like to miss the <code>pkg</code> folder in my workspace where the static libraries are stored!<br>\nAm I right?</p>\n"}, {"tags": ["go", "reflection", "struct", "generated-code"], "comments": [{"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 0, "creation_date": 1472226823, "post_id": 39169987, "comment_id": 65682883, "body": "I don&#39;t think there is anything wrong with a function taking an <code>A</code> as an argument and returning a <code>B</code>"}, {"owner": {"reputation": 620, "user_id": 1634855, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d6dca723f9a8fd87018449b529f9bdb7?s=128&d=identicon&r=PG", "display_name": "Sam G-H", "link": "https://stackoverflow.com/users/1634855/sam-g-h"}, "reply_to_user": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 0, "creation_date": 1472227481, "post_id": 39169987, "comment_id": 65683239, "body": "Thing is I don&#39;t want to do that because, while this example is very short and sweet, my actual structs are quite large and have multiple different types nested and nested within those. It just gets to be a ton of code"}, {"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 2, "creation_date": 1472228017, "post_id": 39169987, "comment_id": 65683542, "body": "Would it be possible for you to not convert them and use interfaces instead? (without seeing some code, I can&#39;t really be helpful here)"}, {"owner": {"reputation": 620, "user_id": 1634855, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d6dca723f9a8fd87018449b529f9bdb7?s=128&d=identicon&r=PG", "display_name": "Sam G-H", "link": "https://stackoverflow.com/users/1634855/sam-g-h"}, "reply_to_user": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 1, "creation_date": 1472229427, "post_id": 39169987, "comment_id": 65684303, "body": "You may be on to something with using interfaces"}], "owner": {"reputation": 620, "user_id": 1634855, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d6dca723f9a8fd87018449b529f9bdb7?s=128&d=identicon&r=PG", "display_name": "Sam G-H", "link": "https://stackoverflow.com/users/1634855/sam-g-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472226045, "creation_date": 1472226045, "question_id": 39169987, "link": "https://stackoverflow.com/questions/39169987/converting-between-struct-types-in-go", "title": "Converting between struct types in Go", "body": "<p>So I have a question that I've been trying to figure out for a while and hopefully someone has some insight. Basically, I have two similar, but different structs in Go and I would like to convert between them.</p>\n\n<p>Something like the following:</p>\n\n<pre><code>type A struct {\n    Name string\n}\n\ntype B struct {\n    Name NameStruct\n}\n\ntype NameStruct struct {\n    Firstname string\n    Lastname string\n}\n</code></pre>\n\n<p>In this example, </p>\n\n<pre><code>B.Name == NameStruct{\n              Firstname: strings.Split(A.Name, \" \")[0],\n              Lastname:  strings.Split(A.Name, \" \")[1],\n          }\n</code></pre>\n\n<p>Basically I would like to be able to define a mapping of fields from one struct to the other as well as a conversion function, so that I can do this without writing all of the code to do the conversion manually.</p>\n\n<p>What I'm imagining is that there might be some sort of Go generator out there that could do something like this. I don't think it is possible using reflection because of the nested structs (although I'm open to suggestions).</p>\n\n<p>Basically, does anyone know of a way to do this that is better than either writing conversion code manually or creating my own generator?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472221024, "post_id": 39166606, "comment_id": 65679201, "body": "Where do you see that <code>Buddies.Name</code> is indexed? I&#39;ve tried what you posted, and it works for me (<code>User</code> gets indexed by <code>Email</code> for example, but not by <code>Buddies.Age</code>)."}, {"owner": {"reputation": 4667, "user_id": 1836506, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/peCt5.jpg?s=128&g=1", "display_name": "Eric Simonton", "link": "https://stackoverflow.com/users/1836506/eric-simonton"}, "edited": false, "score": 0, "creation_date": 1472260465, "post_id": 39166606, "comment_id": 65695214, "body": "Just in case it&#39;s relevant: be aware that entities already in the datastore will remain indexed even if you change a field to <code>noindex</code>, until you save it again."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472311838, "post_id": 39166606, "comment_id": 65707032, "body": "@icza I see it in the datastore viewer."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "reply_to_user": {"reputation": 4667, "user_id": 1836506, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/peCt5.jpg?s=128&g=1", "display_name": "Eric Simonton", "link": "https://stackoverflow.com/users/1836506/eric-simonton"}, "edited": false, "score": 0, "creation_date": 1472311924, "post_id": 39166606, "comment_id": 65707057, "body": "@EricSimonton I completely wiped the entire datastore to be sure that there wasn&#39;t anything there already, and it still shows up as indexed in the datastore viewer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472311979, "post_id": 39166606, "comment_id": 65707076, "body": "But where? Because I don&#39;t even see stated that the <code>Email</code> property is indexed, even though it is."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472312272, "post_id": 39166606, "comment_id": 65707181, "body": "@icza the code shown is an almost exact copy of what I have, but I can&#39;t share the exact code I have due to a NDA.  In the cloud console, select &quot;datastore&quot;, then select &quot;User&quot; as the Kind, and open one of the User entities. There is a column listing &quot;Indexed&quot; next to every indexed value."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472314559, "post_id": 39166606, "comment_id": 65707836, "body": "I was checking it locally, will check in production. Btw testing it locally, filtering or sorting by <code>Buddies.Age</code> gives no result which means that property is not indexed. You can test that in your prod environment."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472332780, "post_id": 39166606, "comment_id": 65712922, "body": "@icza I can only filter by &quot;Email&quot;, which is the one field that I want indexed, so it may just be that the datastore viewer is giving incorrect information."}, {"owner": {"reputation": 2247, "user_id": 2271659, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xyfpS.png?s=128&g=1", "display_name": "DoiT International", "link": "https://stackoverflow.com/users/2271659/doit-international"}, "edited": false, "score": 0, "creation_date": 1517854197, "post_id": 39166606, "comment_id": 84254491, "body": "I am having exactly the same issue. Has anyone was able to get to the bottom of it?"}], "owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 185, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1472511314, "creation_date": 1472215254, "last_edit_date": 1472511314, "question_id": 39166606, "link": "https://stackoverflow.com/questions/39166606/app-engine-datastore-ignoring-noindex-tag-in-go", "title": "App Engine Datastore ignoring &quot;noindex&quot; tag in Go", "body": "<p>I'm using go version go1.6.2 (appengine-1.9.40) darwin/amd64</p>\n\n<p>When saving a struct to the datastore, slices of structs which have been tagged as \"noindex\", are showing up as indexed in the datastore viewer, while non struct fields are correctly showing as unindexed </p>\n\n<p>As an example, I have:</p>\n\n<pre><code>Type User struct{\n  Email string\n  Buddies []Buddy `datastore:\",noindex\"`\n  Language string `datastore:\",noindex\"`\n}\n\nType Buddy struct{\n  Name string `datastore:\",noindex\"`\n  Age int `datastore:\",noindex\"`\n}\n</code></pre>\n\n<p>When saving a new <code>User</code> to the datastore, the datastore viewer shows the properties <code>Buddies.Name</code> and <code>Buddies.Age</code> as \"Indexed\" despite the fact that I've tagged them as \"noindex\".</p>\n\n<p>How do I get the datastore to not index structs?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472211486, "post_id": 39164553, "comment_id": 65673117, "body": "Please insert example code that results in the error you posted. Aim for a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example (MCVE)</a>."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 1498625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4768ddf62b82840c5102a2a6da527b35?s=128&d=identicon&r=PG", "display_name": "void", "link": "https://stackoverflow.com/users/1498625/void"}, "is_accepted": true, "score": 3, "last_activity_date": 1472209203, "last_edit_date": 1472209203, "creation_date": 1472208840, "answer_id": 39164597, "question_id": 39164553, "link": "https://stackoverflow.com/questions/39164553/pq-invalid-input-syntax-for-integer-1/39164597#39164597", "title": "pq: invalid input syntax for integer: &quot;$1&quot;", "body": "<p>I have resolved this problem by removing single quotes from my <code>INSERT</code> statement.<br/><br/>\n<code>insert into kids (age,user_id) values ($1,$2);</code></p>\n\n<p>instead of</p> \n\n<p><code>insert into kids (age,user_id) values ('$1','$2');</code></p>\n"}], "owner": {"reputation": 51, "user_id": 1498625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4768ddf62b82840c5102a2a6da527b35?s=128&d=identicon&r=PG", "display_name": "void", "link": "https://stackoverflow.com/users/1498625/void"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1303, "favorite_count": 0, "accepted_answer_id": 39164597, "answer_count": 1, "score": 2, "last_activity_date": 1472211669, "creation_date": 1472208718, "last_edit_date": 1472211669, "question_id": 39164553, "link": "https://stackoverflow.com/questions/39164553/pq-invalid-input-syntax-for-integer-1", "title": "pq: invalid input syntax for integer: &quot;$1&quot;", "body": "<p>After I was trying to <code>INSERT</code> into a <code>postgresql</code> database simple statement from Go app this error was occurred. I've already made type assertions for <code>int(value)</code>, but without luck.</p>\n"}, {"tags": ["json", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1472210254, "post_id": 39164878, "comment_id": 65672391, "body": "Isn&#39;t <code>EditionsMap</code> of the type <code>map[string]datamodel.Edition</code>?"}, {"owner": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "edited": false, "score": 0, "creation_date": 1472214090, "post_id": 39164878, "comment_id": 65674607, "body": "hi icza, thank you for your answey, apparently i tried to change the map to contain pointers, but apparently with no luck, i also tried to change to declare the function without pointer, apparently with no luck! Ah and another question, can i change the type of an element during marshalJSON? The original Structure has for Vault and Online a type  of *struct{} (they are taken from an xml and they are empty nodes like: &lt;vault /&gt;)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "edited": false, "score": 1, "creation_date": 1472215818, "post_id": 39164878, "comment_id": 65675739, "body": "@Ivan See edited answer. I wrote a short, working example for both cases, you can view them on the Go playground (links in the answer). And yes, in your <code>MarshalJSON()</code> method you can change whatever you want to, it&#39;s really up to you what you return (how you marshal the value). You have complete freedom."}, {"owner": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "edited": false, "score": 0, "creation_date": 1472219386, "post_id": 39164878, "comment_id": 65678111, "body": "@icza thank you for you help, but i&#39;m still having problem wiht my code. Here you can find the source file with MarshalJSON and all structures i&#39;m using: <a href=\"https://github.com/inuyasha82/mtgrestservice/blob/marshaljson/datamodel/xmlmodel.go\" rel=\"nofollow noreferrer\">github.com/inuyasha82/mtgrestservice/blob/marshaljson/datamo&zwnj;&#8203;del/&hellip;</a>, i tried to make an example here <a href=\"https://play.golang.org/p/Z6JlpH0qjN\" rel=\"nofollow noreferrer\">play.golang.org/p/Z6JlpH0qjN</a> and apparently it works, so something should be wrong in my original code, but cannot figure out what :&#39;( The MarshalJson is never called."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "edited": false, "score": 1, "creation_date": 1472221729, "post_id": 39164878, "comment_id": 65679677, "body": "@Ivan Are you sure code execution reaches that point? Insert log messages. Also <a href=\"https://golang.org/pkg/encoding/json/#Encoder.Encode\" rel=\"nofollow noreferrer\"><code>Encoder.Encode()</code></a> returns an <code>error</code>, please make sure you check that (currently you don&#39;t, see my edited answer how to do that)."}, {"owner": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "edited": false, "score": 0, "creation_date": 1472223328, "post_id": 39164878, "comment_id": 65680763, "body": "@icza OMG, i found the issue, it was in the imports i didn&#39;t notice,but the import was updating an old version of that file in another package that i didn&#39;t delete, so any change that i made to it was not recognized by the application. Thank you for your help, you helped me understanding better the MarshalJSON feature! :)"}, {"owner": {"reputation": 465, "user_id": 437524, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A2F3k.jpg?s=128&g=1", "display_name": "dcrobbins", "link": "https://stackoverflow.com/users/437524/dcrobbins"}, "edited": false, "score": 0, "creation_date": 1509027432, "post_id": 39164878, "comment_id": 80860770, "body": "This is a great answer.  I can&#39;t imagine why golang does it this way- it seems error prone.  I had the same problem as the OP."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 465, "user_id": 437524, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/A2F3k.jpg?s=128&g=1", "display_name": "dcrobbins", "link": "https://stackoverflow.com/users/437524/dcrobbins"}, "edited": false, "score": 1, "creation_date": 1509027897, "post_id": 39164878, "comment_id": 80861156, "body": "@dcrobbins If you have a value (non-pointer), you would expect its methods not modify it (as it is &quot;just&quot; a value, not a pointer and passing it around creates copies). If pointer methods would be in its method set, they could modify it, which could be more confusing (than not including methods with pointer receivers in its method set)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 14, "last_activity_date": 1472221467, "last_edit_date": 1472221467, "creation_date": 1472209687, "answer_id": 39164878, "question_id": 39164471, "link": "https://stackoverflow.com/questions/39164471/marshaljson-not-called/39164878#39164878", "title": "MarshalJSON not called", "body": "<p>This is because you declared the <code>Edition.MarshalJSON()</code> method with <em>pointer</em> receiver:</p>\n\n<pre><code>func (u *Edition) MarshalJSON() ([]byte, error)\n</code></pre>\n\n<p>And you try to marshal non-pointer values (your map contains <code>datamodel.Edition</code> values):</p>\n\n<pre><code>var EditionsMap map[string]datamodel.Edition\n// ...\njson.NewEncoder(w).Encode(EditionsMap)\n</code></pre>\n\n<p>Methods with pointer receiver are not part of the method set of the corresponding non-pointer type. The method set of type <code>datamodel.Edition</code> <strong>does not contain</strong> the method <code>MarshalJSON()</code>.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"noreferrer\">Spec: Method sets:</a></p>\n\n<blockquote>\n  <p>A type may have a <em>method</em> set associated with it. The method set of an <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">interface type</a> is its interface. <strong>The method set of any other type <code>T</code> consists of all <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"noreferrer\">methods</a> declared with receiver type <code>T</code>.</strong> The method set of the corresponding <a href=\"https://golang.org/ref/spec#Pointer_types\" rel=\"noreferrer\">pointer type</a> <code>*T</code> is the set of all methods declared with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method set of <code>T</code>).</p>\n</blockquote>\n\n<p>Try to marshal pointer values, define your map to contain pointers:</p>\n\n<pre><code>var EditionsMap map[string]*datamodel.Edition\n// ...\nif err := json.NewEncoder(w).Encode(EditionsMap); err != nil {\n    panic(err) // HANDLE error somehow, do not omit it like in your example!\n}\n</code></pre>\n\n<p>Values of the pointer type <code>*Edition</code> <strong>does have</strong> a method <code>MarshalJSON()</code> which will be called properly by the <code>json</code> package. Try a working example of this on the <a href=\"https://play.golang.org/p/4LVWyCJ0Zb\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Another option would be to define the <code>Edition.MarshalJSON()</code> method with value receiver:</p>\n\n<pre><code>func (u Edition) MarshalJSON() ([]byte, error)\n</code></pre>\n\n<p>And this way it would work no matter if you marshal pointer or non-pointer values, as the methods with value receiver are part of the method set of both the <code>Edition</code> type and the corresponding <code>*Edition</code> pointer type. Try a working example of this variant on the <a href=\"https://play.golang.org/p/2y71tmceTQ\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 3974, "user_id": 907685, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/fe0614a9325272b0dbeea1751f3c8ebe?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/907685/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1497, "favorite_count": 1, "accepted_answer_id": 39164878, "answer_count": 1, "score": 6, "last_activity_date": 1472223433, "creation_date": 1472208445, "last_edit_date": 1472223433, "question_id": 39164471, "link": "https://stackoverflow.com/questions/39164471/marshaljson-not-called", "title": "MarshalJSON not called", "body": "<p>I'm trying to customize the output of <code>MarshalJSON</code>, using the interface:</p>\n\n<pre><code>func (m *RawMessage) MarshalJSON() ([]byte, error)\n</code></pre>\n\n<p>I followed that tutorial: <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow\">http://choly.ca/post/go-json-marshalling/</a> </p>\n\n<p>My purpose is removing replace one of the fields with true/false (if set or not), so I ended up writing that function: </p>\n\n<pre><code>func (u *Edition) MarshalJSON() ([]byte, error) {\n    var vaultValue bool\n    vaultValue = true\n    var onlineValue bool\n    vaultValue = false\n    fmt.Println(\"here\")\n    if u.Vault == nil {\n        vaultValue = false\n    }\n    if u.Online == nil {\n        onlineValue = false\n    }\n    type AliasEdition Edition\n    return json.Marshal(&amp;struct {\n        Vault  bool `json:\"vault,omitempty\"`\n        Online bool `json:\"online,omitempty\"`\n        *AliasEdition\n    }{\n        Vault:        vaultValue,\n        Online:       onlineValue,\n        AliasEdition: (*Alias)(u),\n    })\n}\n</code></pre>\n\n<p>The JSON is created from a map with the following instruction: </p>\n\n<pre><code>json.NewEncoder(w).Encode(EditionsMap)\n</code></pre>\n\n<p>Obviously <code>EditionsMap</code> is a Map of <code>Edition</code>s structures:</p>\n\n<pre><code>var EditionsMap map[string]datamodel.Edition\n</code></pre>\n\n<p>The problem is that the <code>MarshalJSON</code> function apparently is never called. </p>\n\n<p>Probably I'm doing something wrong, but I cannot understand what is the problem, my understanding is that I just need to implement that function in order to get it called.</p>\n"}, {"tags": ["windows", "dll", "go", "com"], "comments": [{"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1472505945, "post_id": 39162054, "comment_id": 65769584, "body": "Well, Direct3DCreate9() is most definitely a C function.  It is a factory function, required because DirectX doesn&#39;t actually use COM.  The rest of it is certainly resembles COM, this <a href=\"https://en.wikipedia.org/wiki/Interface-based_programming\" rel=\"nofollow noreferrer\">interface-based programming</a> style is very common at Microsoft.  It is also <i>not</i> the automation style that&#39;s underneath IDispatch and go-ole.  Doing this without the help of a library, well, not much point to it is there?"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 3, "last_activity_date": 1472225719, "last_edit_date": 1495542762, "creation_date": 1472225719, "answer_id": 39169895, "question_id": 39162054, "link": "https://stackoverflow.com/questions/39162054/call-com-object-method-from-go-without-cgo/39169895#39169895", "title": "Call COM object method from Go without CGo", "body": "<p>(Not a comprehensive answer as I have no time to actually test this, but still&hellip;)</p>\n\n<p>While MSDN most of the time assumes you work with COM objects using some platform which has built-in \"glue\" for them (such as Visual C++&trade; product or something like this), in fact it is possible to work with COM objects using plain C&mdash;look <a href=\"https://blogs.msdn.microsoft.com/oldnewthing/20040205-00/?p=40733\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://stackoverflow.com/a/946294/720999\">here</a> for starters.</p>\n\n<p>Studying those resources you can learn that calling methods on a \"COM interface\" amounts to properly working with its \"VTBL\" (<strong>V</strong>irtual function <strong>T</strong>a<strong>BL</strong>e) block which is always located in a well-known place relative to the pointer disguised by that \"interface\" \"thing\" returned by functions instantiating COM objects.</p>\n\n<p>The <code>go-ole</code> package implements in plain Go what you'd otherwise do in plain C, so armed with the knowledge of \"to call methods on a COM objects we need to operate on its VTBL\" we can find the implementation of <a href=\"https://github.com/go-ole/go-ole/blob/master/idispatch.go\" rel=\"nofollow noreferrer\"><code>IDispatch</code> support</a> in that package.  So I'd start there.</p>\n\n<hr>\n\n<p>I'd also go right into the <code>go-ole</code> issue tracker asking for implementing a piece of example code which would show how to call methods on a COM object's handler acquired by means other than calling functions from <code>go-ole</code> package.</p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 3, "last_activity_date": 1499115214, "last_edit_date": 1499115214, "creation_date": 1498938660, "answer_id": 44864836, "question_id": 39162054, "link": "https://stackoverflow.com/questions/39162054/call-com-object-method-from-go-without-cgo/44864836#44864836", "title": "Call COM object method from Go without CGo", "body": "<p>I asked the guys from go-ole, like @kostix suggested.</p>\n\n<p>Here is the solution:</p>\n\n<blockquote>\n  <p>d3d9 doesn't have generally COM vtbl. for example, it doesn't have\n  IDispatch interface. So you can't use go-ole for d3d9. But you can do\n  it with writing all interface in go.  </p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nconst (\n    D3D9_SDK_VERSION = 32\n)\n\nvar (\n    libd3d9             = syscall.NewLazyDLL(\"d3d9.dll\")\n    procDirect3DCreate9 = libd3d9.NewProc(\"Direct3DCreate9\")\n)\n\ntype IDirect3D struct {\n    lpVtbl *IDirect3DVtbl\n}\n\ntype IDirect3DVtbl struct {\n    QueryInterface uintptr\n    AddRef         uintptr\n    Release        uintptr\n\n    RegisterSoftwareDevice      uintptr\n    GetAdapterCount             uintptr\n    GetAdapterIdentifier        uintptr\n    GetAdapterModeCount         uintptr\n    EnumAdapterModes            uintptr\n    GetAdapterDisplayMode       uintptr\n    CheckDeviceType             uintptr\n    CheckDeviceFormat           uintptr\n    CheckDeviceMultiSampleType  uintptr\n    CheckDepthStencilMatch      uintptr\n    CheckDeviceFormatConversion uintptr\n    GetDeviceCaps               uintptr\n    GetAdapterMonitor           uintptr\n    CreateDevice                uintptr\n}\n\nfunc (v *IDirect3D) AddRef() int32 {\n    ret, _, _ := syscall.Syscall(\n        v.lpVtbl.AddRef,\n        1,\n        uintptr(unsafe.Pointer(v)),\n        0,\n        0)\n    return int32(ret)\n}\n\nfunc (v *IDirect3D) Release() int32 {\n    ret, _, _ := syscall.Syscall(\n        v.lpVtbl.Release,\n        1,\n        uintptr(unsafe.Pointer(v)),\n        0,\n        0)\n    return int32(ret)\n}\n\nfunc (v *IDirect3D) GetAdapterCount() uint32 {\n    ret, _, _ := syscall.Syscall(\n        v.lpVtbl.GetAdapterCount,\n        1,\n        uintptr(unsafe.Pointer(v)),\n        0,\n        0)\n    return uint32(ret)\n}\n\nfunc main() {\n    v, r, err := procDirect3DCreate9.Call(uintptr(D3D9_SDK_VERSION))\n    if r != 0 &amp;&amp; err != nil {\n        log.Fatal(err)\n    }\n    d3d := *((**IDirect3D)(unsafe.Pointer(&amp;v)))\n\n    d3d.AddRef()\n    defer d3d.Release()\n\n    fmt.Println(d3d.GetAdapterCount())\n}\n</code></pre>\n\n<p><a href=\"https://github.com/go-ole/go-ole/issues/140\" rel=\"nofollow noreferrer\">(c) mattn</a></p>\n"}], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1431, "favorite_count": 4, "accepted_answer_id": 44864836, "answer_count": 2, "score": 4, "last_activity_date": 1499115214, "creation_date": 1472201027, "question_id": 39162054, "link": "https://stackoverflow.com/questions/39162054/call-com-object-method-from-go-without-cgo", "title": "Call COM object method from Go without CGo", "body": "<p>I have created a <a href=\"https://github.com/gonutz/d3d9\" rel=\"nofollow\">Direct3D9 wrapper</a> in Go which uses CGo to interface with the COM objects in C.</p>\n\n<p>I would like to get rid of the dependency on a C-compiler under Windows so the user would not have to install MinGW or Cygwin to use DirectX from Go.</p>\n\n<p>The problem is that d3d9.dll does not expose C-functions but uses COM. The only function that can be called directly after loading the DLL (with <code>syscall.LoadLibrary(\"d3d9.dll\")</code>) is <code>Direct3DCreate9</code>. This returns a COM object which exposes all functionality as methods.</p>\n\n<p>How can I call COM object methods in a DLL from pure Go without CGo?</p>\n\n<p>I know of the <a href=\"https://github.com/go-ole/go-ole\" rel=\"nofollow\">Go-OLE</a> library which states it calls COM interfaces without CGo but I cannot, from the sources, see how I would go about doing the same thing for Direct3D9. A simple example with only the relevant parts would be of great help.</p>\n"}, {"tags": ["file", "go", "config"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5667735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab1d8bd4c16698e41b690766892fe14?s=128&d=identicon&r=PG&f=1", "display_name": "Wandy", "link": "https://stackoverflow.com/users/5667735/wandy"}, "edited": false, "score": 0, "creation_date": 1472433394, "post_id": 39161709, "comment_id": 65734973, "body": "Thsnks, I will try go-yaml."}], "tags": [], "owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "is_accepted": false, "score": 2, "last_activity_date": 1472199935, "creation_date": 1472199935, "answer_id": 39161709, "question_id": 39161420, "link": "https://stackoverflow.com/questions/39161420/how-to-write-back-to-cfg-file-when-i-load-the-file-and-change-the-myspan-variate/39161709#39161709", "title": "How to write back to cfg file when I load the file and change the MySpan variate?", "body": "<p>The library you choose don't do it for now, it has the task into the <a href=\"https://godoc.org/gopkg.in/gcfg.v1\" rel=\"nofollow\">todo list</a>, according to the documentation.</p>\n\n<p>For the time being you should contact the developer to be aware of when the feature is scheduled, find another library or do it yourself.</p>\n\n<p>You could use the <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow\">go-yaml</a> package to do it.</p>\n"}], "owner": {"reputation": 21, "user_id": 5667735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab1d8bd4c16698e41b690766892fe14?s=128&d=identicon&r=PG&f=1", "display_name": "Wandy", "link": "https://stackoverflow.com/users/5667735/wandy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1472199935, "creation_date": 1472198968, "last_edit_date": 1472199391, "question_id": 39161420, "link": "https://stackoverflow.com/questions/39161420/how-to-write-back-to-cfg-file-when-i-load-the-file-and-change-the-myspan-variate", "title": "How to write back to cfg file when I load the file and change the MySpan variate?", "body": "<p>I want to write the conf out to myconfig.gcfg, when I load the file and has change the Name string. How should I do? \nSample config:</p>\n\n<pre><code> [Span]\n    Name = \"DuraSpan\" \n    MySpan = 4\n    [Sys]\n    SerialName = \"/dev/ttyS0\"\n</code></pre>\n\n<p>Go code:</p>\n\n<pre><code>import \"gopkg.in/gcfg.v1\"\n        type Config struct {\n            Span struct {\n                Name string\n                MySpan int\n            }\n            Sys struct{\n                SerialName string\n            }\n        }\n        var conf Config\n        err := gcfg.ReadFileInto(&amp;conf, \"myconfig.gcfg\")\n        conf.Span.MySpan = 6\n</code></pre>\n\n<p>how to write back the change to file?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1475561654, "creation_date": 1475561654, "answer_id": 39845311, "question_id": 39161284, "link": "https://stackoverflow.com/questions/39161284/need-to-include-each-and-position-with-push-in-mongodb-and-golangmgo/39845311#39845311", "title": "Need to include $each and $position with $push in MongoDB and golang(mgo)", "body": "<blockquote>\n  <p>I m trying to find the last document inserted in the embedded array so i can retrieve the document in the last array index without knowing its index.Is is possible?</p>\n</blockquote>\n\n<p>You can find the last array index by derriving from the array length. Using your example: </p>\n\n\n\n<pre><code>type Employee struct {\n        EmpId string \n        AnnualLeave []AnnualLeaveInfo\n}\ntype AnnualLeaveInfo struct {\n        ATotal int64\n}\n\nresult := Employee{}\nerr = c.Find(bson.M{\"empid\": \"example employee ID\"}).One(&amp;result)\nif err != nil {\n        log.Fatal(err)\n}\nlastAnnualTotal:= result.AnnualLeave[len(result.AnnualLeave)-1].ATotal\n</code></pre>\n\n<blockquote>\n  <p>Please advice me as well how to decrement the <code>ATotal</code> of the previous document attached and keep it as the value of the atotal of the new document</p>\n</blockquote>\n\n<p>Depending on your use case, you could try performing two database operations: </p>\n\n<ul>\n<li>Fetch the last <code>ATotal</code> value from the collection.</li>\n<li>Push a new <code>AnnualLeaveInfo</code> document with the new <code>ATotal</code> value. </li>\n</ul>\n\n\n\n<pre><code>// Assuming that EmpId is unique\nerr = c.Update(bson.M{\"empid\": result.EmpId},\n      bson.M{\"$push\": bson.M{\"annualleave\": bson.M{\"atotal\": int(latestAnnualTotal-1)}}})\n</code></pre>\n\n<p>If you require atomic updates, see <a href=\"https://docs.mongodb.com/manual/core/write-operations-atomicity/\" rel=\"nofollow\">MongoDB Atomicity and Transactions</a> and <a href=\"https://docs.mongodb.com/manual/tutorial/model-data-for-atomic-operations/\" rel=\"nofollow\">Model Data for Atomic Operations</a>. </p>\n\n<p>On another note, it seems that you're trying to do something related to <a href=\"http://martinfowler.com/bliki/CQRS.html\" rel=\"nofollow\">CQRS design patterns</a>. This design pattern may help with calculating your annual leave use case. See also <a href=\"https://www.mongodb.com/blog/post/event-sourcing-with-mongodb\" rel=\"nofollow\">Even Sourcing with MongoDB</a></p>\n"}], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 39845311, "answer_count": 1, "score": 1, "last_activity_date": 1475561654, "creation_date": 1472198499, "last_edit_date": 1475221660, "question_id": 39161284, "link": "https://stackoverflow.com/questions/39161284/need-to-include-each-and-position-with-push-in-mongodb-and-golangmgo", "title": "Need to include $each and $position with $push in MongoDB and golang(mgo)", "body": "<p>1.In the back end i m using go lang and for database i use mongoDB. I m trying to find the last document inserted in the embedded array so i can retrieve  the document in the last array index without knowing its index.Is is possible??\nAfter researching on this i came to know that its not possible.So i m thinking of using $push,$each and $position.Here i can set the position to 0 so the newly added document will be in 0 so i can retreive it using the index 0.</p>\n\n<pre><code>  Here is bson format\n    {\n    empid:\"L12\"\n    AnnualLeave:[\n        {\n        \"atotal\" : 20,\n        }\n    ]\n    }\n\n\n\n Here is my schema\n\n\n type (\n            Employee struct {\n                EmpId          string\n                AnnualLeave    []*AnnualLeaveInfo\n            }\n             AnnualLeaveInfo struct {\n                ATotal          int64   \n            }\n\n\n        I use the mgo statement as follows`enter code here`\n\n c.Update(bson.M{\"empid\": \"string\"}, bson.M{\"$push\": bson.M{\"annualleave\":bson.M{\"$each\":\n         bson.M{\"atotal\": 4},\"$position\":0}}\n</code></pre>\n\n<p>2.Please advice me as well how to decrement the ATotal of the previous document attached and keep it as the value of the atotal of the  new document. \nPlease help me.Thanks </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "edited": false, "score": 0, "creation_date": 1472198259, "post_id": 39160807, "comment_id": 65665596, "body": "Array and slice values encode as JSON arrays, except that []byte encodes as a base64-encoded string, and a nil slice encodes as the null JSON value. check out the documentation here <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json</a>"}, {"owner": {"reputation": 7943, "user_id": 718180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4893dd9320890c66b9a633d93bf2ffd7?s=128&d=identicon&r=PG", "display_name": "vergenzt", "link": "https://stackoverflow.com/users/718180/vergenzt"}, "edited": false, "score": 0, "creation_date": 1511218887, "post_id": 39160807, "comment_id": 81758845, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30445479/how-to-specify-default-values-when-parsing-json-in-go\">How to specify default values when parsing JSON in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 5, "last_activity_date": 1472212335, "last_edit_date": 1472212335, "creation_date": 1472198352, "answer_id": 39161250, "question_id": 39160807, "link": "https://stackoverflow.com/questions/39160807/default-value-golang-struct-using-encoding-json/39161250#39161250", "title": "Default value golang struct using `encoding/json` ?", "body": "<p>You can't because in Go types do not have constructors.</p>\n\n<p>Instead, have either an explicit initializer function (or method on the pointer receiver) or a constructor/factory function (these are conventionally called <code>New&lt;TypeName&gt;</code> so yours would be <code>NewFileData</code>) which would return an initialized value of your type.</p>\n\n<p>All-in-all, I have a feeling this looks like an XY problem. From your question, it appears you want to have a default value on one of your fields if nothing was unmarshaled.\nIf so, just post-process the values of this type unmarshaled from JSON and if nothing was unmarshaled to <code>Encodning</code> set it to whatever default you want.</p>\n\n<p>Alternatively you might consider this approach:</p>\n\n<ol>\n<li><p>Have a custom type for your field.</p>\n\n<p>Something like <code>type EncodingMethod string</code> should do.</p></li>\n<li><p>Have a custom JSON unmarshaling method for this type which would do whatever handling it wants.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 10, "last_activity_date": 1472198423, "creation_date": 1472198423, "answer_id": 39161269, "question_id": 39160807, "link": "https://stackoverflow.com/questions/39160807/default-value-golang-struct-using-encoding-json/39161269#39161269", "title": "Default value golang struct using `encoding/json` ?", "body": "<p>Since your <code>FileData</code> isn't too complex, you can easily make use of <code>json.Unmarshaler</code> interface. Declare <code>Encoding</code> as a separate type and set the default value in the unmarshal method:</p>\n\n<pre><code>type FileData struct {\n    UID string `json:\"uid\"`                 \n    Size int `json:\"size\"`\n    Content string `json:content`\n    Encoding Encoding `json:encoding` // declared as a custom type\n    User string `json:\"user\"`\n}\n\ntype Encoding string\n\n// implement the Unmarshaler interface on Encoding\nfunc (e *Encoding) UnmarshalJSON(b []byte) error {\n    var s string\n    if err := json.Unmarshal(b, &amp;s); err != nil {\n        return err\n    }\n    if s == \"\" {\n        *e = Encoding(\"base64\")\n    } else {\n        *e = Encoding(s)\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now when you encode a json with empty <code>Encoding</code> value, it'll be set to <code>base64</code>:</p>\n\n<pre><code>var data1 = []byte(`{\"uid\": \"UID\", \"size\": 10, \"content\": \"CONTENT\", \"encoding\": \"ASCII\", \"user\": \"qwe\"}`)\nvar data2 = []byte(`{\"uid\": \"UID\", \"size\": 10, \"content\": \"CONTENT\", \"encoding\": \"\", \"user\": \"qwe\"}`)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    f := FileData{}\n    if e := json.Unmarshal(data1, &amp;f); e != nil {\n        fmt.Println(\"Error:\", e)\n    }\n    fmt.Println(f, f.Encoding)\n    if e := json.Unmarshal(data2, &amp;f); e != nil {\n        fmt.Println(\"Error:\", e)\n    }\n    fmt.Println(f, f.Encoding)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>{UID 10 CONTENT ASCII qwe} ASCII\n{UID 10 CONTENT base64 qwe} base64\n</code></pre>\n\n<p>Working code: <a href=\"https://play.golang.org/p/y5_wBgHGJk\" rel=\"noreferrer\">https://play.golang.org/p/y5_wBgHGJk</a></p>\n"}, {"comments": [{"owner": {"reputation": 2697, "user_id": 4650581, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmKpWSd9B4U/AAAAAAAAAAI/AAAAAAAAAK4/xL06IHBoIyo/photo.jpg?sz=128", "display_name": "Misagh", "link": "https://stackoverflow.com/users/4650581/misagh"}, "edited": false, "score": 0, "creation_date": 1600241181, "post_id": 39161308, "comment_id": 113021500, "body": "And what is the solution for jsons with unknown array sizes?"}], "tags": [], "owner": {"reputation": 181, "user_id": 4060259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7baf1eee4e7f82973b455f8a36bf15a1?s=128&d=identicon&r=PG", "display_name": "Son Bui", "link": "https://stackoverflow.com/users/4060259/son-bui"}, "is_accepted": false, "score": 16, "last_activity_date": 1472198601, "creation_date": 1472198601, "answer_id": 39161308, "question_id": 39160807, "link": "https://stackoverflow.com/questions/39160807/default-value-golang-struct-using-encoding-json/39161308#39161308", "title": "Default value golang struct using `encoding/json` ?", "body": "<p>You can set default value when you init your 'FileData'<br />\nSee my example: <a href=\"https://play.golang.org/p/QXwDG7_mul\" rel=\"noreferrer\">https://play.golang.org/p/QXwDG7_mul</a><br />\n<code>Page int</code> has default value 33<br /></p>\n\n<pre>\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Response2 struct {\n    Page   int      `json:\"page\"`\n    Fruits []string `json:\"fruits\"`\n}\n\nfunc main() {\n    str := `{\"fruits\": [\"apple\", \"peach\"]}`\n    res := Response2{Page: 33 /*Default value*/}\n    json.Unmarshal([]byte(str), &res)\n    fmt.Println(res)\n}\n</pre>\n"}, {"tags": [], "owner": {"reputation": 7, "user_id": 14715359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0652290a028734bb8d190e4889a4e5?s=128&d=identicon&r=PG&f=1", "display_name": "Pankaj Yadav", "link": "https://stackoverflow.com/users/14715359/pankaj-yadav"}, "is_accepted": false, "score": 0, "last_activity_date": 1614151243, "creation_date": 1614151243, "answer_id": 66346342, "question_id": 39160807, "link": "https://stackoverflow.com/questions/39160807/default-value-golang-struct-using-encoding-json/66346342#66346342", "title": "Default value golang struct using `encoding/json` ?", "body": "<p>If there is a need to read the struct values from environment variables, then &quot;github.com/kelseyhightower/envconfig&quot; library can be used and then you can declare your struct as below:</p>\n<pre><code>type FileData struct {\n    UID string `envconfig:&quot;uid&quot;`                 \n    Size int `envconfig:&quot;size&quot;`\n    Content string `envconfig:content`\n    Encoding string `envconfig:encoding default:&quot;base64&quot;` \n    User string `envconfig:&quot;user&quot;`\n}\n</code></pre>\n<p>You can finally unmarshal JSON to your struct.</p>\n<p>Note: I know this is not what you asked for, but this might help someone.</p>\n"}], "owner": {"reputation": 6254, "user_id": 2285490, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/wCW1F.jpg?s=128&g=1", "display_name": "Jagdish Idhate", "link": "https://stackoverflow.com/users/2285490/jagdish-idhate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30945, "favorite_count": 4, "accepted_answer_id": 39161250, "answer_count": 4, "score": 11, "last_activity_date": 1614151243, "creation_date": 1472196834, "question_id": 39160807, "link": "https://stackoverflow.com/questions/39160807/default-value-golang-struct-using-encoding-json", "title": "Default value golang struct using `encoding/json` ?", "body": "<p>How to set default value for <code>Encoding</code> as  \"base64\"?</p>\n\n<pre><code>type FileData struct {\n    UID string `json:\"uid\"`                 \n    Size int `json:\"size\"`\n    Content string `json:content`\n    Encoding string `json:encoding` \n    User string `json:\"user\"`\n}\n</code></pre>\n\n<p>I tried </p>\n\n<pre><code>Encoding string `json:encoding`= \"base64\" // Not working\n</code></pre>\n"}]