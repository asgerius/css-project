[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1439421188, "last_edit_date": 1439421188, "creation_date": 1439420823, "answer_id": 31976893, "question_id": 31976420, "link": "https://stackoverflow.com/questions/31976420/golang-gopher-way-to-manipulate-data-in-different-channels/31976893#31976893", "title": "Golang/Gopher way to manipulate data in different channels?", "body": "<p>Because the field <code>playlist</code> is accessed from two goroutines with no synchronization, there is a race. </p>\n\n<p>The race detector detects races at runtime, not build time. This race will not be detected until the 24 hour reset timer ticks.</p>\n\n<p>The race can be eliminated by combining the two goroutines using a select statement:</p>\n\n<pre><code>for {\n    select {\n    case newSong := &lt;-p.updateList:\n        p.playlist = append(p.playlist, newSong)\n    case &lt;-c:\n        p.playlist = make([]*Song, 0)\n        log.Println(\"Current playlist has reset\")\n    }\n }\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 1263186, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7a64aed7ba949d37afff2d0fca9d2377?s=128&d=identicon&r=PG&f=1", "display_name": "Derptacos", "link": "https://stackoverflow.com/users/1263186/derptacos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 31976893, "answer_count": 1, "score": 0, "last_activity_date": 1439421188, "creation_date": 1439418185, "last_edit_date": 1439420323, "question_id": 31976420, "link": "https://stackoverflow.com/questions/31976420/golang-gopher-way-to-manipulate-data-in-different-channels", "title": "Golang/Gopher way to manipulate data in different channels?", "body": "<p>New to go and to make sure Im on the right page with channels + concurrency I have a struct </p>\n\n<pre><code>type Playlist struct {\n  playList   []*Song\n  updateList chan *Song\n}\n</code></pre>\n\n<p>I have 2 functions that manipulate the data in separate go routines.</p>\n\n<p>First one is to append data to the playlist whenever a pointer to a song is sent on the channel:</p>\n\n<pre><code>  func (p *Playlist) continuousUpdate() {\n    go func (){\n      for newSong := range p.updateList {\n        p.playlist = append(p.playlist, newSong)\n      }\n    }()\n  }\n</code></pre>\n\n<p>And the second one, every 24 hours a timer will tick, thus resetting the playlist to an empty slice.</p>\n\n<pre><code>func (p *Playlist) controlCurrentPlayList(c &lt;-chan time.Time) {\n  go func(){\n    for {\n      &lt;-c\n      p.playlist = make([]*Song, 0)\n      log.Println(\"Current playlist has reset\")\n    }\n  }()\n}\n</code></pre>\n\n<p>Do two separate channels handle the synchronization of the data? Or could I very easily run into a race condition? </p>\n\n<p>Ran <code>go build -race</code> and no errors appeared.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1439418379, "post_id": 31976346, "comment_id": 51859345, "body": "Just use <code>FindAllStringIndex</code> and trivially use the indices to get the matches as well (which is what <code>FindAllString does</code>) with just a single invocation of your regexp: <a href=\"https://play.golang.org/p/7L4hpojsCL\" rel=\"nofollow noreferrer\">play.golang.org/p/7L4hpojsCL</a>"}, {"owner": {"reputation": 65435, "user_id": 2206004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCB1e.png?s=128&g=1", "display_name": "hwnd", "link": "https://stackoverflow.com/users/2206004/hwnd"}, "edited": false, "score": 0, "creation_date": 1439423963, "post_id": 31976346, "comment_id": 51860911, "body": "What exactly are you trying to match?"}, {"owner": {"reputation": 5238, "user_id": 1713216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5652386ca2b1ba0a7c45791cb580b19b?s=128&d=identicon&r=PG", "display_name": "neurosnap", "link": "https://stackoverflow.com/users/1713216/neurosnap"}, "edited": false, "score": 0, "creation_date": 1439475801, "post_id": 31976346, "comment_id": 51886108, "body": "I&#39;m working on a sentence tokenizer, this will find periods and the two words surrounding that period"}], "owner": {"reputation": 5238, "user_id": 1713216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5652386ca2b1ba0a7c45791cb580b19b?s=128&d=identicon&r=PG", "display_name": "neurosnap", "link": "https://stackoverflow.com/users/1713216/neurosnap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 794, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1439419964, "creation_date": 1439417843, "last_edit_date": 1439419964, "question_id": 31976346, "link": "https://stackoverflow.com/questions/31976346/golang-regular-expression-getting-index-position-of-variable", "title": "Golang Regular Expression: Getting index position of variable", "body": "<p>I have a regular expression that has variables <code>(?P&lt;next_tok&gt;)</code> how can I grab the index of that variable match?</p>\n\n<p>Here is the complete regexp:\n<code>\\S*[\\.\\?!](?P&lt;after_tok&gt;(?:[?!)\";}\\]\\*:@\\'\\({\\[])|\\s+(?P&lt;next_tok&gt;\\S+))</code></p>\n\n<p>Example:\n<a href=\"http://play.golang.org/p/7CYfK50W2Q\" rel=\"nofollow\">http://play.golang.org/p/7CYfK50W2Q</a></p>\n\n<p>I want to get the matches AND the index of any variable in the regexp match.  Is this possible in golang?</p>\n\n<p>EDIT:\nI couldn't figure out how to get <code>next_tok</code> by name, but I was able to get all the submatches via <a href=\"http://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatchIndex\" rel=\"nofollow\">FindAllStringSubmatchIndex</a></p>\n\n<p><a href=\"http://play.golang.org/p/SEaCLVKisr\" rel=\"nofollow\">http://play.golang.org/p/SEaCLVKisr</a></p>\n"}, {"tags": ["struct", "go", "interface"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1439412666, "post_id": 31975025, "comment_id": 51856942, "body": "There is <a href=\"http://stackoverflow.com/a/29397985/55504\">an answer</a> to another question that shows the differences between embedding (which by the way is what you probably should have done here instead of a non-exported named field) and non-embedding a custom <code>time.Time</code> type."}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439413302, "post_id": 31975025, "comment_id": 51857315, "body": "I updated the question, as to whether I can override time.Duration type&#39;s String() function only. Awesome, I now used embedded type and that works <a href=\"http://play.golang.org/p/tWyd48ajpl\" rel=\"nofollow noreferrer\">play.golang.org/p/tWyd48ajpl</a>"}], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 0, "last_activity_date": 1439433892, "creation_date": 1439433892, "answer_id": 31978665, "question_id": 31975025, "link": "https://stackoverflow.com/questions/31975025/how-to-override-inbuilt-type/31978665#31978665", "title": "How to override inbuilt type", "body": "<p>Following on from your question edit, yes you can achieve this effect without a struct.  The problem is that when you define your type with:</p>\n\n<pre><code>type TimeDurationStruct time.Duration\n</code></pre>\n\n<p>your new <code>TimeDurationStruct</code> type will not inherit any of the methods from <code>time.Duration</code> like you had when you used the type embedding option.  You can still access those methods, but you will need to perform a type cast.  So the start of your <code>String</code> method should be modified to read something like:</p>\n\n<pre><code>func (i TimeDurationStruct) String() string {\n    duration := time.Duration(i)\n    ...\n</code></pre>\n"}], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1439433892, "creation_date": 1439412207, "last_edit_date": 1439412835, "question_id": 31975025, "link": "https://stackoverflow.com/questions/31975025/how-to-override-inbuilt-type", "title": "How to override inbuilt type", "body": "<p>By default <code>time.Duration</code> prints it in the format <code>2h0m0s</code> etc.</p>\n\n<p>However, I want to print it as <code>2 Hours</code> or <code>2 Hours 1 Min</code></p>\n\n<p>One way, I can do that is to create a new <code>struct TimeDurationStruct</code> and create a <code>String()</code> function. I have done the same in <a href=\"http://play.golang.org/p/mB2JvfjoZe\" rel=\"nofollow\">golang playground</a></p>\n\n<h3>Working Code</h3>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"math\"\n)\n\ntype TimeDurationStruct struct {\n    t time.Duration\n}\n\nfunc (i *TimeDurationStruct) Set(t time.Duration) {\n    i.t = t\n}\n\nfunc (i TimeDurationStruct) String() string {\n    duration := i.t\n\n    var dayString, hourMinString string\n    var days, hours float64\n\n    totalHours := duration.Hours()\n    minutes := math.Mod(duration.Minutes(), 60.0)\n    if totalHours &lt; 24.0 {\n        hours = totalHours\n    } else {\n        hours = math.Mod(totalHours, 24.0)\n        days = totalHours / 24.0\n    }\n\n    if hours == 0 {\n\n    } else if hours &lt; 1 {\n        if minutes == 1 {\n            hourMinString = \"1 Min\"\n        } else {\n            hourMinString = fmt.Sprintf(\"%g Mins\", minutes)\n        }\n    } else if hours &gt;= 1 &amp;&amp; hours &lt; 2 {\n        if minutes == 0 {\n            hourMinString = \"1 Hour\"\n        } else if minutes == 1 {\n            hourMinString = \"1 Hour 1 Min\"\n        } else {\n            hourMinString = fmt.Sprintf(\"1 Hour %g Mins\", minutes)\n        }\n    } else {\n        if minutes == 0 {\n            hourMinString = fmt.Sprintf(\"%g Hours\", hours)\n        } else if minutes == 1 {\n            hourMinString = fmt.Sprintf(\"%g Hours 1 Min\", hours)\n        } else {\n            hourMinString = fmt.Sprintf(\"%g Hours %g Mins\", hours, minutes)\n        }\n    }\n\n    if days &gt; 0 {\n        if days == 1 {\n            dayString = \"1 Day\"\n        } else {\n            dayString = fmt.Sprintf(\"%g Days \", days)\n        }\n    }\n\n    return dayString + hourMinString\n}\n\nfunc main() {\n    t := time.Now()\n    d := t.Add(2 * time.Hour).Sub(t)\n    fmt.Println(d)\n    var i TimeDurationStruct\n    i.Set(d)\n    fmt.Println(i)\n}\n</code></pre>\n\n<h3>Questions</h3>\n\n<ol>\n<li><p>Instead of a structure type, is it possible to override <code>time.Duration</code> <code>type</code>. E.g </p>\n\n<pre><code>type TimeDurationStruct time.Duration\n</code></pre>\n\n<p>I tried it <a href=\"http://play.golang.org/p/2AKd2bTQvA\" rel=\"nofollow\">here</a>, but it does not work...</p></li>\n<li><p>Is there a better/easier way ?</p></li>\n</ol>\n"}, {"tags": ["go", "sync", "ping"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439406799, "post_id": 31973345, "comment_id": 51853886, "body": "You&#39;re creating a new <code>Ticker</code> each time you send a keepalive message, and you leave the old one running. You need to stop the old ticker to free up their resources. Also, it&#39;s much easier, and less error prone to replace your entire conn struct instead of stopping it and updating each individual field."}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439409167, "post_id": 31973345, "comment_id": 51855145, "body": "I can&#39;t really replace the conn struct because it&#39;s being used by other routines/methods. I&#39;m actually trying to abstract <code>net.Conn</code> in methods on <code>conn</code> that read/write  messages and heals itself (i.e. keep alive and dials a new connection when  keepAlive or a read/write fails).  If I free up <code>Ticker</code>, <code>keepAlive()</code> will try to write on a closed connection because <code>replace()</code> is called when the underlying connection must be replaced."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439411045, "post_id": 31973345, "comment_id": 51856055, "body": "You&#39;re still replacing the ticker after every message, which will leak memory and resources for running timers.  You&#39;re copying mutexes (which is very bad), you have pointers to interfaces (which you should never have), and you&#39;re not checking errors. I think you need to reevaluate how you&#39;re structuring this code."}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439411951, "post_id": 31973345, "comment_id": 51856548, "body": "I thought the ticker is garbage collected after it&#39;s drained (i.e. reaches the timeout). Stopping a ticker that doesn&#39;t tick anymore doesn&#39;t make much sense, does it? The errors are not checked to make the code easier to follow. Indeed I net.Conn shouldn&#39;t be a pointer. I fixed it now.  I&#39;m actually using a websocket connection in the real code which is a pointer and thus the silly mistake. Why do you say I&#39;m copying mutexes ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439412139, "post_id": 31973345, "comment_id": 51856645, "body": "A ticker will continue to run until you call <code>Stop()</code>, it&#39;s just blocked on it&#39;s channel. The docs say: &quot;Stop the ticker to release associated resources.&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "is_accepted": false, "score": -2, "last_activity_date": 1439411579, "last_edit_date": 1439411579, "creation_date": 1439410060, "answer_id": 31974422, "question_id": 31973345, "link": "https://stackoverflow.com/questions/31973345/how-to-extend-the-ticker-duration-without-a-race/31974422#31974422", "title": "How to extend the ticker duration without a race?", "body": "<p>I ended up with the code below. I'm not very happy how it looks like but it works. Basically I wrapped the mux in a channel so that I can do a select on it.</p>\n\n<pre><code>const interval = 10 * time.Second\n\ntype conn struct {\n    keepAlive time.Ticker\n    conn      *net.Conn\n    mux       sync.Mutex\n}\n\n// replace replaces the underlying connection\nfunc (cn conn) replace(newcn *net.Conn) {\n    cn.mux.Lock()\n    cn.conn = newcn\n    // reset the ticker\n    cn.keepAlive.Stop\n    cn.keepAlive = time.NewTicker(interval)\n    cn.mux.Unlock()\n}\n\nfunc (cn conn) keepAlive() {\n    lockerFn := func() &lt;-chan struct{} {\n        cn.mux.Lock()\n        ch = make(chan struct{})\n        go func() {\n            ch &lt;- struct{}{}\n        }()\n        return ch\n    }\n    for {\n        locker := lockerFn()\n        select {\n        case &lt;-cn.keepAlive.C:\n            // unlock the locker otherwise we\n            // get stuck\n            go func() {\n                &lt;-locker\n                cn.mux.Unlock()\n            }()\n        case &lt;-locker:\n            cn.conn.Write([]byte(\"ping\"))\n            var msg []byte\n            cn.conn.Read(msg)\n            cn.keepAlive = time.NewTicker(interval)\n            cn.mux.Unlock()\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1439416117, "post_id": 31975033, "comment_id": 51858570, "body": "not that it would make the answer incorrect but I think you forgot to stop/refresh the ticker too. :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1439418199, "post_id": 31975033, "comment_id": 51859270, "body": "@AnthonyHunt, there&#39;s no reason to, unless you want the ticket interval to precisely line up with th time you replaced the connection."}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1439418983, "post_id": 31975033, "comment_id": 51859562, "body": "I might be wrong but without any refresh(i.e. not even before the last <code>cn.Unlock()</code>,  the <code>interval</code> is ignored after the initial one is reached. Thus it locks the connection permanently (sending keepalive messages continuously)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1439419289, "post_id": 31975033, "comment_id": 51859653, "body": "@AnthonyHunt, the whole point of a Ticker is that it keeps &quot;ticking&quot;, sending a tick every interval."}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 1, "creation_date": 1439419673, "post_id": 31975033, "comment_id": 51859770, "body": "now I get it... sorry for my ignorance. For some reasons I confused it with <code>time.After</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1439412241, "creation_date": 1439412241, "answer_id": 31975033, "question_id": 31973345, "link": "https://stackoverflow.com/questions/31973345/how-to-extend-the-ticker-duration-without-a-race/31975033#31975033", "title": "How to extend the ticker duration without a race?", "body": "<p>One way to implement this much more succinctly, is by using a channel as the synchronization mechanism, instead of the mutex:</p>\n\n<pre><code>type conn struct {\n    sync.Mutex\n    conn        net.Conn\n    replaceConn chan net.Conn\n}\n\n// replace replaces the underlying connection\nfunc (cn *conn) replace(newcn net.Conn) {\n    cn.replaceConn &lt;- newcn\n}\n\nfunc (cn *conn) keepAlive() {\n    t := time.NewTicker(interval)\n    msg := make([]byte, 10)\n\n    for {\n        select {\n        case &lt;-t.C:\n        case newConn := &lt;-cn.replaceConn:\n            cn.Lock()\n            cn.conn = newConn\n            cn.Unlock()\n            continue\n        }\n\n        cn.Lock()\n        _ = msg\n        // do keepalive\n        cn.Unlock()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 31975033, "answer_count": 2, "score": 0, "last_activity_date": 1439412894, "creation_date": 1439406002, "last_edit_date": 1439412894, "question_id": 31973345, "link": "https://stackoverflow.com/questions/31973345/how-to-extend-the-ticker-duration-without-a-race", "title": "How to extend the ticker duration without a race?", "body": "<p>I'm trying to implement a keepAlive mechanism. The issue is that I don't know how to replace the keep alive ticker ( conn.keepAlive) without a race because <code>keepAlive()</code> method always reads from the ticker.</p>\n\n<pre><code>//errors not handled for brevity\nconst interval = 10 * time.Second\n\ntype conn struct {\n    keepAlive time.Ticker\n    conn      net.Conn\n    mux       sync.Mutex\n}\n\n// replace replaces the underlying connection\nfunc (cn conn) replace(newcn net.Conn) {\n    cn.mux.Lock()\n    cn.conn = newcn\n    // reset the ticker\n    cn.keepAlive.Stop\n    cn.keepAlive = time.NewTicker(interval)\n    cn.mux.Unlock()\n}\n\nfunc (cn conn) keepAlive() {\n    for {\n        &lt;-cn.keepAlive.C\n        cn.mux.Lock()\n        cn.conn.Write([]byte(\"ping\"))\n        var msg []byte\n        cn.conn.Read(msg)\n        if string(msg) != \"pong\" {\n            // do some mean stuff\n        }\n        cn.keepAlive = time.NewTicker(interval)\n        cn.mux.Unlock()\n    }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "encoding", "base64"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 14, "last_activity_date": 1439403871, "last_edit_date": 1439403871, "creation_date": 1439400571, "answer_id": 31971780, "question_id": 31971614, "link": "https://stackoverflow.com/questions/31971614/base64-encode-decode-without-padding-on-golang-appengine/31971780#31971780", "title": "Base64 encode/decode without padding on golang ( appengine )", "body": "<p>Go1.5 will have a <a href=\"http://tip.golang.org/pkg/encoding/base64/#Encoding.WithPadding\" rel=\"noreferrer\"><code>WithPadding</code></a> option on <code>Encoding</code>. </p>\n\n<p>This also will add 2 pre-defined encodings, <a href=\"http://tip.golang.org/pkg/encoding/base64/#pkg-variables\" rel=\"noreferrer\"><code>RawStdEncoding</code>, and <code>RawURLEncoding</code></a>, which will have no padding.</p>\n\n<p>Though since you're on app-engine, and won't have access to Go1.5 for a while, you can make some helper function to add and remove the padding as needed. </p>\n\n<p>Here is an example to encode and decode strings. If you need, it could easily be adapted to work more efficiently using <code>[]byte</code>.</p>\n\n<pre><code>func base64EncodeStripped(s string) string {\n    encoded := base64.StdEncoding.EncodeToString([]byte(s))\n    return strings.TrimRight(encoded, \"=\")\n}\n\nfunc base64DecodeStripped(s string) (string, error) {\n    if i := len(s) % 4; i != 0 {\n        s += strings.Repeat(\"=\", 4-i)\n    }\n    decoded, err := base64.StdEncoding.DecodeString(s)\n    return string(decoded), err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2574, "user_id": 2959469, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/202829eb1155051526ba1000c3f9bcf9?s=128&d=identicon&r=PG", "display_name": "Somo  S.", "link": "https://stackoverflow.com/users/2959469/somo-s"}, "is_accepted": false, "score": 3, "last_activity_date": 1575382949, "last_edit_date": 1575382949, "creation_date": 1575379892, "answer_id": 59158279, "question_id": 31971614, "link": "https://stackoverflow.com/questions/31971614/base64-encode-decode-without-padding-on-golang-appengine/59158279#59158279", "title": "Base64 encode/decode without padding on golang ( appengine )", "body": "<p>Simply,</p>\n\n<p>use <code>base64.RawStdEncoding.EncodeToString</code> instead of <code>base64.StdEncoding.EncodeToString</code> </p>\n\n<p>OR else</p>\n\n<p>use <code>base64.RawURLEncoding.EncodeToString</code> instead of <code>base64.URLEncoding.EncodeToString</code>.</p>\n\n<p><a href=\"https://golang.org/src/encoding/base64/base64.go?s=3207:3400#L93\" rel=\"nofollow noreferrer\">Reference: see source-code comments Line 94 to 110</a>:</p>\n\n<pre><code>// RawURLEncoding is the unpadded alternate base64 encoding defined in RFC 4648.\n// It is typically used in URLs and file names.\n// This is the same as URLEncoding but omits padding characters.\n</code></pre>\n"}], "owner": {"reputation": 753, "user_id": 1238432, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/71847ab58c5f79394e87bc9889b4dc88?s=128&d=identicon&r=PG", "display_name": "forlayo", "link": "https://stackoverflow.com/users/1238432/forlayo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6892, "favorite_count": 2, "accepted_answer_id": 31971780, "answer_count": 2, "score": 6, "last_activity_date": 1575382949, "creation_date": 1439399999, "last_edit_date": 1575381590, "question_id": 31971614, "link": "https://stackoverflow.com/questions/31971614/base64-encode-decode-without-padding-on-golang-appengine", "title": "Base64 encode/decode without padding on golang ( appengine )", "body": "<p>There's a way to encode/decode a string to/from Base64 without having the padding at the end? I mean the '==' ending.</p>\n\n<p>I'm using <code>base64.URLEncoding.EncodeToString</code> to encode and it works perfectly but I didn't see a way to decide to not use the padding at the end ( like on java ).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1439397654, "post_id": 31970689, "comment_id": 51848827, "body": "Could be a cut and paste from somewhere else into init."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1439397675, "post_id": 31970689, "comment_id": 51848840, "body": "@ZanLynx: That&#39;s as good as any guess I can come up with."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1439403122, "post_id": 31970763, "comment_id": 51851887, "body": "Thanks. I&#39;m glad to know my understanding of init() wasn&#39;t off."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1439397287, "last_edit_date": 1439397287, "creation_date": 1439396948, "answer_id": 31970763, "question_id": 31970689, "link": "https://stackoverflow.com/questions/31970689/why-check-for-nil-in-init/31970763#31970763", "title": "Why check for nil in init()", "body": "<p>There is no reason to check for nil in the code provided in the article. There are other ways to structure the code. </p>\n\n<p>Option 1:</p>\n\n<pre><code>var templates = map[string]*template.Template{}\n\nfunc init() {\n    // code following the if statement from the function in the article\n}\n</code></pre>\n\n<p>Option 2:</p>\n\n<pre><code>var templates = initTemplates()\n\nfunc initTemplates() map[string]*template.Template{} {\n    templates := map[string]*template.Template{}\n    // code following the if statement from the function in the article\n    return templates\n}\n</code></pre>\n\n<p>Option 3:</p>\n\n<pre><code>func init() {\n    templates = make(map[string]*template.Template)\n    // code following the if statement from the function in the article\n}\n</code></pre>\n\n<p>You will see all of these approaches in Go code. I prefer the second option because it makes it clear that <code>templates</code> is initialized in the function <code>initTemplates</code>.  The other options require some looking around to find out where <code>templates</code> is initialized. </p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1439467773, "creation_date": 1439467773, "answer_id": 31987842, "question_id": 31970689, "link": "https://stackoverflow.com/questions/31970689/why-check-for-nil-in-init/31987842#31987842", "title": "Why check for nil in init()", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"http://golang.org/ref/spec#Package_initialization\" rel=\"nofollow\">Package initialization</a></p>\n  \n  <p>Variables may also be initialized using functions named <code>init</code>\n  declared in the package block, with no arguments and no result\n  parameters.</p>\n\n<pre><code>func init() { \u2026 }\n</code></pre>\n  \n  <p>Multiple such functions may be defined, even within a single source\n  file.</p>\n</blockquote>\n\n<p>Now or in the future there may be multiple <code>init</code> functions in the package. For example,</p>\n\n<pre><code>package plates\n\nimport \"text/template\"\n\nvar templates map[string]*template.Template\n\n// Load project templates on program initialisation\nfunc init() {\n    if templates == nil {\n        templates = make(map[string]*template.Template)\n    }\n    // Load project templates\n}\n\n// Load program templates on program initialisation\nfunc init() {\n    if templates == nil {\n        templates = make(map[string]*template.Template)\n    }\n    // Load program templates\n}\n</code></pre>\n\n<p>Programs should have zero bugs. Program defensively.</p>\n"}], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 31970763, "answer_count": 2, "score": 2, "last_activity_date": 1439467773, "creation_date": 1439396700, "question_id": 31970689, "link": "https://stackoverflow.com/questions/31970689/why-check-for-nil-in-init", "title": "Why check for nil in init()", "body": "<p>I'm reading <a href=\"https://elithrar.github.io/article/approximating-html-template-inheritance/\" rel=\"nofollow\">this article</a> which offers this code in its example:</p>\n\n<pre><code>var templates map[string]*template.Template\n\n// Load templates on program initialisation\nfunc init() {\n    if templates == nil {\n        templates = make(map[string]*template.Template)\n    }\n</code></pre>\n\n<p>Why check for <code>if templates == nil</code> in <code>init()</code>? Won't it always be the same at this point in execution?</p>\n"}, {"tags": ["security", "go", "sql-injection", "couchbase", "nosql"], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 1778790, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/01069edf720360058c811015d8f3d851?s=128&d=identicon&r=PG", "display_name": "mr-ma", "link": "https://stackoverflow.com/users/1778790/mr-ma"}, "edited": false, "score": 0, "creation_date": 1439465594, "post_id": 31972938, "comment_id": 51878563, "body": "thanks for the response, but my question is more about how can someone inject? something like a cheat sheet? ultimately I wish to have an overview of injection possibilities in the couchbase?"}], "tags": [], "owner": {"reputation": 3182, "user_id": 3416135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Otei3.jpg?s=128&g=1", "display_name": "Kirk", "link": "https://stackoverflow.com/users/3416135/kirk"}, "is_accepted": false, "score": 1, "last_activity_date": 1439404691, "creation_date": 1439404691, "answer_id": 31972938, "question_id": 31970422, "link": "https://stackoverflow.com/questions/31970422/couchbase-injection/31972938#31972938", "title": "Couchbase injection?", "body": "<p>For access via key like you are doing, Couchbase does not parse or validate the value being written into the database. That is an application side function. As long as the value is in a form Couchbase Server understands, it is just written as the value for that object.</p>\n"}], "owner": {"reputation": 169, "user_id": 1778790, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/01069edf720360058c811015d8f3d851?s=128&d=identicon&r=PG", "display_name": "mr-ma", "link": "https://stackoverflow.com/users/1778790/mr-ma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1505435969, "creation_date": 1439395921, "last_edit_date": 1506103282, "question_id": 31970422, "link": "https://stackoverflow.com/questions/31970422/couchbase-injection", "title": "Couchbase injection?", "body": "<p>Couchbase is a relatively new NoSql database. Like any other new technology, it comes with some security concerns. I've spent quite a time to understand the risk of injection using go-couchbase client library. <a href=\"http://docs.couchbase.com/admin/admin/security/security-in-applications.html\" rel=\"nofollow\">According to their documentation</a>, I know that it is possible to form Schema and javascript injection attacks. However, I was not able to form any nasty attack. It seems like plain string values are not being parsed(eval) on the Couchbase side. Here is my sample:</p>\n\n<pre><code>cbbucket, err = cbpool.GetBucketWithAuth(bi.Name, bi.Name, bi.Password)\nif err != nil {\n    fmt.Printf(\"Failed to connect to bucket %s %v\", bi.Name, err)\n    return\n}\ninput := `{\"v1\":\"Malicous\"}`\nerr = cbbucket.Set(\"k1\", 0, input)\nif err != nil {\n    fmt.Printf(\"set failed error %v\", err)\n    return\n}\n</code></pre>\n\n<p>I assume, the input is the point where an attacker can manipulate data. Nevertheless what is stored in the Couchbase is harmless(escaped) version of the input. Here is the stored value in the DB:</p>\n\n<pre><code>\"{\\\"v1\\\":\\\"Malicous\\\"}\"\n</code></pre>\n\n<p>By looking at the encoding/json package, I came to know that go can parse generic JSON objects on the fly using interface{}. Therefore, I have modified my exploitation code as follows:</p>\n\n<pre><code>cbbucket, err = cbpool.GetBucketWithAuth(bi.Name, bi.Name, bi.Password)\nif err != nil {\n    fmt.Printf(\"Failed to connect to bucket %s %v\", bi.Name, err)\n    return\n}\ninput := `{\"v1\":\"Malicous\"}`\nb := []byte(input)\nvar f interface{}\nerr := json.Unmarshal(b, &amp;f)\nerr = cbbucket.Set(\"k1\", 0, &amp;f)\nif err != nil {\n    fmt.Printf(\"set failed error %v\", err)\n    return\n}\n</code></pre>\n\n<p>This time the exploitation is successfully done. Here is the malicious JSON object stored in the Couchbase: </p>\n\n<pre><code>{\n  \"v1\": \"Malicous\"\n}\n</code></pre>\n\n<p>Well, this exploitation is not so exciting... as it really requires the developer to blindly Unmarshal user input and store it in the the DB. I was wondering if there are other easier exploitation techniques, derived from string concatenation, which does not require such a huge carelessness.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1439392329, "post_id": 31969088, "comment_id": 51845326, "body": "AFAIK the best practice is considered not vendoring deps in libraries but only in applications, to avoid these situations. This is what I personally do."}, {"owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1439450920, "post_id": 31969088, "comment_id": 51869412, "body": "@Not_a_Golfer how should I manage the <code>go-nsq</code> dependency in the library?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1439450999, "post_id": 31969088, "comment_id": 51869463, "body": "just import the paths as-is (github.com/foo/bar), and let the application author vendor all the deps the way they want - with or without path rewriting for example."}], "answers": [{"comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "edited": false, "score": 0, "creation_date": 1439453482, "post_id": 31969373, "comment_id": 51870908, "body": "You should not vendor dependencies in your <code>messi</code> library. Vendor them in the project that uses the library."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1439392839, "creation_date": 1439392839, "answer_id": 31969373, "question_id": 31969088, "link": "https://stackoverflow.com/questions/31969088/using-an-external-dependency-in-a-library/31969373#31969373", "title": "Using an External Dependency in a Library", "body": "<p>Packages in Go are identified by full import path, not by name.</p>\n\n<p>For example in the standard library there are two different packages with the same name <code>template</code> but different import paths: <code>text/template</code> and <code>html/template</code>.</p>\n\n<p>You should make sure that <code>go-nsq</code> package is imported using the same path.</p>\n"}], "owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 0, "accepted_answer_id": 31969373, "answer_count": 1, "score": 0, "last_activity_date": 1439392839, "creation_date": 1439392159, "question_id": 31969088, "link": "https://stackoverflow.com/questions/31969088/using-an-external-dependency-in-a-library", "title": "Using an External Dependency in a Library", "body": "<p>I am using <a href=\"https://github.com/skelterjohn/wgo\" rel=\"nofollow\">wgo</a> for dependency management in Golang (although I think wgo has little to do with this), wgo has a folder structure like this</p>\n\n<pre><code>project/\n    .gocfg/\n        gopaths\n        vendor.json\n    vendor/\n        src/\n            github.com_or_whatever/\n</code></pre>\n\n<p>I have a library I coded myself which uses an <code>nsq-go</code> type in one of the exported methods:</p>\n\n<pre><code>func AddNsqSubscription(\n    topic, channel string, \n    handler nsq.Handler, \n    config *nsq.Config) error { }\n</code></pre>\n\n<p>The library is called <code>messi</code> and I import the <code>nsq-go</code> like so <code>\"messi/vendor/src/github.com/bitly/go-nsq\"</code></p>\n\n<p>The problem comes when I try to use this library in another project. For instance, in a project called <code>scribe</code> I have the following code (notice the imports):</p>\n\n<pre><code>import (\n    \"scribe/vendor/src/github.com/bitly/go-nsq\"\n    \"scribe/vendor/src/messi\"\n)\n\n//...\nnsqHandler := nsq.HandlerFunc(func(message *nsq.Message) error {\n    msgHandler(MessiMessage{message})\n    return nil\n})\n\nreturn messi.AddNsqSubscription(destination, subdestination, nsqHandler, nsq.NewConfig())\n</code></pre>\n\n<p>When I <code>go build</code> the following error is returned:</p>\n\n<blockquote>\n  <p><strong>cannot use</strong> nsqHandler (type \"<strong>scribe</strong>/vendor/src/github.com/bitly/go-nsq\".HandlerFunc) as type \"<strong>messi</strong>/vendor/src/github.com/bitly/go-nsq\".Handler in argument to messi.AddNsqSubscription: \n      \"scribe/vendor/src/github.com/bitly/go-nsq\".HandlerFunc does not implement \"messi/vendor/src/github.com/bitly/go-nsq\".Handler (wrong type for HandleMessage method) </p>\n  \n  <p><strong>have</strong> HandleMessage(<em>\"<strong>scribe</strong>/vendor/src/github.com/bitly/go-nsq\".Message) error<br>\n          <strong>want</strong> HandleMessage(</em>\"<strong>messi</strong>/vendor/src/github.com/bitly/go-nsq\".Message) error</p>\n</blockquote>\n\n<p><strong>Why?</strong> I do not really know what is going on. The code <code>go-nsq</code> imported is exactly the same, yet golang wants that this code comes from the same folder?</p>\n\n<p>What am I doing wrong? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1439391928, "post_id": 31968641, "comment_id": 51845077, "body": "can you give me a example please."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 3, "last_activity_date": 1439392676, "last_edit_date": 1439392676, "creation_date": 1439391035, "answer_id": 31968641, "question_id": 31968528, "link": "https://stackoverflow.com/questions/31968528/goworkers-how-to-store-logs-into-a-file/31968641#31968641", "title": "GoWorkers how to store logs into a file", "body": "<p>The <code>WorkerLogger</code> interface is just an interface for a struct that implements the <code>Println</code> and <code>Printf</code> methods.</p>\n\n<p>You can simply define a new <code>log.Logger</code>, give it an <code>os.File</code> as output (<a href=\"http://golang.org/pkg/log/#New\" rel=\"nofollow\">see the constructor</a>), and set the global var <code>workers.Logger</code> to this new logger.</p>\n\n<p>Example: </p>\n\n<pre><code>file, _ := os.Create(\"log.txt\")\nworkers.Logger = log.New(file, \"[worker] \", log.LstdFlags)\n</code></pre>\n"}], "owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 31968641, "answer_count": 1, "score": 1, "last_activity_date": 1439392676, "creation_date": 1439390758, "question_id": 31968528, "link": "https://stackoverflow.com/questions/31968528/goworkers-how-to-store-logs-into-a-file", "title": "GoWorkers how to store logs into a file", "body": "<p>How can I store the logs which are coming from GoWorkers (<a href=\"http://godoc.org/github.com/jrallison/go-workers#WorkersLogger\" rel=\"nofollow\">docs</a>) into a file. I show that there is a <code>WorkersLogger</code> interface but I don't understand how to use it.</p>\n\n<p>At the moment I have this:</p>\n\n<pre><code>func main() {\n  workers.Configure(map[string]string)\n  workers.Middleware.Append(&amp;midRetry{})\n  workers.Process(\"imp\", worker.InitJob, 30)\n  workers.Run()\n}\n\ntype midRetry struct{}\nfunc (r *midRetry) Call(queue string, message *workers.Msg, next func() bool) (acknowledge bool) {\n  acknowledge = next()\n  return\n}\n</code></pre>\n\n<p>I was thinking in creating a <code>chan string</code> in the midRetry struct, and inside Call send messages on the channel, and receive them in main, and then write them to file, but I feel that there is a better way.</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439390940, "post_id": 31968268, "comment_id": 51844319, "body": "EC2 returns the volume ID in the snapshot metadata. What is it you&#39;re trying to do?"}, {"owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "edited": false, "score": 0, "creation_date": 1439392305, "post_id": 31968268, "comment_id": 51845311, "body": "Please edit the question and provide details."}], "answers": [{"tags": [], "owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "is_accepted": false, "score": 1, "last_activity_date": 1439625492, "creation_date": 1439625492, "answer_id": 32022738, "question_id": 31968268, "link": "https://stackoverflow.com/questions/31968268/way-to-get-volume-id-from-snapshot-id/32022738#32022738", "title": "Way to get volume id from snapshot id?", "body": "<p>Use the <code>DescribeSnapshots</code> API call. Here's an example using the <a href=\"http://aws.amazon.com/cli/\" rel=\"nofollow\">AWS Command-Line Interface (CLI)</a>:</p>\n\n<pre><code>$ aws ec2 describe-snapshots --snapshot-ids snap-5caa7fb4 --query 'Snapshots[*].VolumeId' --output text\nvol-bd9b80c5\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1439625492, "creation_date": 1439390097, "question_id": 31968268, "link": "https://stackoverflow.com/questions/31968268/way-to-get-volume-id-from-snapshot-id", "title": "Way to get volume id from snapshot id?", "body": "<p>I have a snapshot id and wanted to know if there was any way to get he volume id the snapshot came from.</p>\n"}, {"tags": ["file", "go", "io"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439389258, "post_id": 31967717, "comment_id": 51842937, "body": "Do the <code>os.Open</code> method fail ? You don&#39;t check the error in you example..."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5208973, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rBBLJ0I249g/AAAAAAAAAAI/AAAAAAAAACY/1CR-UcD7_yE/photo.jpg?sz=128", "display_name": "David Thien", "link": "https://stackoverflow.com/users/5208973/david-thien"}, "edited": false, "score": 0, "creation_date": 1439389634, "post_id": 31967946, "comment_id": 51843248, "body": "Thanks for the info! That must be why I couldn&#39;t find the error, because I was always searching for os.Open."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1439392861, "last_edit_date": 1592644375, "creation_date": 1439389275, "answer_id": 31967946, "question_id": 31967717, "link": "https://stackoverflow.com/questions/31967717/golang-access-is-denied-error-on-trying-to-write-to-file-with-io-writestring/31967946#31967946", "title": "Golang &quot;Access is denied&quot; error on trying to write to file with io.WriteString", "body": "<p>From the documentation, you have a read-only file:</p>\n<blockquote>\n<p><code>Open</code> opens the named file for reading...</p>\n</blockquote>\n<p>You need to use <a href=\"http://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\"><code>os.OpenFile</code></a> with the appropriate flags</p>\n<h3>Some examples</h3>\n<p>The common method for writing a file (used by <code>ioutil.WriteFile</code>):</p>\n<pre><code>f, err := os.OpenFile(filename, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, perm)\n</code></pre>\n<p>To create or append to a file:</p>\n<pre><code>f, err := os.OpenFile(filename, os.O_WRONLY|os.O_CREATE|os.O_APPEND, perm)\n</code></pre>\n<p>To append only to an existing file:</p>\n<pre><code>f, err := os.OpenFile(filename, os.O_WRONLY|os.O_APPEND, perm)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 5208973, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rBBLJ0I249g/AAAAAAAAAAI/AAAAAAAAACY/1CR-UcD7_yE/photo.jpg?sz=128", "display_name": "David Thien", "link": "https://stackoverflow.com/users/5208973/david-thien"}, "edited": false, "score": 0, "creation_date": 1439389661, "post_id": 31968003, "comment_id": 51843273, "body": "Thanks for the help, I hadn&#39;t realized what sort of issue it was."}], "tags": [], "owner": {"reputation": 459, "user_id": 938362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12d991696619aa51421fc04ba19f9131?s=128&d=identicon&r=PG", "display_name": "Ryan E", "link": "https://stackoverflow.com/users/938362/ryan-e"}, "is_accepted": true, "score": 5, "last_activity_date": 1439389407, "last_edit_date": 1495541677, "creation_date": 1439389407, "answer_id": 31968003, "question_id": 31967717, "link": "https://stackoverflow.com/questions/31967717/golang-access-is-denied-error-on-trying-to-write-to-file-with-io-writestring/31968003#31968003", "title": "Golang &quot;Access is denied&quot; error on trying to write to file with io.WriteString", "body": "<p>I believe you are opening the file in read only mode. Instead of os.Open you might try os.OpenFile with the appropriate flags as shown at <a href=\"https://stackoverflow.com/questions/13513375/how-to-append-text-to-a-file-in-golang\">How to append text to a file in golang?</a> and <a href=\"https://stackoverflow.com/questions/7151261/append-to-a-file-in-go\">Append to a file in Go</a></p>\n"}], "owner": {"reputation": 23, "user_id": 5208973, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rBBLJ0I249g/AAAAAAAAAAI/AAAAAAAAACY/1CR-UcD7_yE/photo.jpg?sz=128", "display_name": "David Thien", "link": "https://stackoverflow.com/users/5208973/david-thien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8989, "favorite_count": 0, "accepted_answer_id": 31968003, "answer_count": 2, "score": 1, "last_activity_date": 1439392861, "creation_date": 1439388718, "question_id": 31967717, "link": "https://stackoverflow.com/questions/31967717/golang-access-is-denied-error-on-trying-to-write-to-file-with-io-writestring", "title": "Golang &quot;Access is denied&quot; error on trying to write to file with io.WriteString", "body": "<p>I am currently running Windows 8 64-bit and I am trying to create a logging file for use with a web server. The code in question is:</p>\n\n<pre><code>func LogWebPath(requestedURL string, accessedURL string, logFile string) error {\n\nfile, _ := os.Open(logFile)\n_, err = io.WriteString(file, requestedURL + \":\" + accessedURL)\nif(err != nil) {\n  fmt.Println(err)\n  return err\n}\nfile.Close()\nreturn errors.New(\"nil\")\n}\n</code></pre>\n\n<p>Whenever io.WriteString is called, the error returned is <code>write log/visit.log: Access is denied.</code> </p>\n\n<p>I have Go installed on my system and I am using <code>go run x.go</code> to run my Go source.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439387256, "post_id": 31967057, "comment_id": 51841299, "body": "You don&#39;t. Interfaces only define a method set. If you demonstrate what problem you&#39;re trying to solve with actual code, we may be better able to help."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1439388462, "post_id": 31967057, "comment_id": 51842245, "body": "why not just move model objects into their own package? sounds to me like it&#39;s a code structure problem and not interface/struct related. Just open a package called <code>model</code> and have everyone reference it."}], "answers": [{"tags": [], "owner": {"reputation": 849, "user_id": 267917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ee816ef6bb9f34e7f7eb5555e102992?s=128&d=identicon&r=PG", "display_name": "Etienne Membrives", "link": "https://stackoverflow.com/users/267917/etienne-membrives"}, "is_accepted": false, "score": -2, "last_activity_date": 1439388492, "creation_date": 1439388492, "answer_id": 31967618, "question_id": 31967057, "link": "https://stackoverflow.com/questions/31967057/golang-struct-inside-an-interface/31967618#31967618", "title": "Golang: struct inside an interface?", "body": "<p>Go is not Java; Go is even not C++. You should think of Go as \"C with interfaces\".</p>\n\n<p>In particular, you cannot do as you want, as you cannot nest struct definitions in interface definitions. Note that you can nest <a href=\"https://talks.golang.org/2012/10things.slide#4\" rel=\"nofollow\">structs inside structs</a>, but you cannot instantiate a nested struct directly.</p>\n\n<p>The closest you can do is to move each logical group of objects to its own package.</p>\n"}, {"comments": [{"owner": {"reputation": 12108, "user_id": 1459782, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3d4d623136668fb9edb252c6a23fb31e?s=128&d=identicon&r=PG", "display_name": "stewart99", "link": "https://stackoverflow.com/users/1459782/stewart99"}, "edited": false, "score": 0, "creation_date": 1439391283, "post_id": 31967977, "comment_id": 51844606, "body": "Yup, it dawned on me after asking the question that I should make a new folder (package) and put user related code in there. Now I have a user/data.go and user/service.go and it should work."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 5, "last_activity_date": 1439389356, "creation_date": 1439389356, "answer_id": 31967977, "question_id": 31967057, "link": "https://stackoverflow.com/questions/31967057/golang-struct-inside-an-interface/31967977#31967977", "title": "Golang: struct inside an interface?", "body": "<p>Here is a suggestion to organize your code in more \"idiomatic\" Go way:</p>\n\n<pre><code>package user\n\ntype Request struct {\n    ...\n}\n\ntype Response struct {\n    ...\n}\n\ntype Service interface {\n   GetUser(r Request) Response\n}\n</code></pre>\n\n<p>Outside of <code>user</code> package the code will look like:</p>\n\n<pre><code>s := user.NewService()\nvar req user.Request\nvar resp user.Response\nresp = s.GetUser(req)\n</code></pre>\n\n<p>As you can see the code uses much shorter names and still remains very readable.</p>\n\n<p>Package names like <code>service</code> shows that you organize the code in your app by layers instead of by features. I wouldn't recommend it. Here is interesting article about it: <a href=\"http://www.javapractices.com/topic/TopicAction.do?Id=205\" rel=\"noreferrer\">http://www.javapractices.com/topic/TopicAction.do?Id=205</a>. It uses Java but the principle applies to any programming language.</p>\n"}], "owner": {"reputation": 12108, "user_id": 1459782, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3d4d623136668fb9edb252c6a23fb31e?s=128&d=identicon&r=PG", "display_name": "stewart99", "link": "https://stackoverflow.com/users/1459782/stewart99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1174, "favorite_count": 0, "accepted_answer_id": 31967977, "answer_count": 2, "score": 1, "last_activity_date": 1439389356, "creation_date": 1439387076, "question_id": 31967057, "link": "https://stackoverflow.com/questions/31967057/golang-struct-inside-an-interface", "title": "Golang: struct inside an interface?", "body": "<p>So I have an interface, called <code>UserService</code> inside a package <code>service</code></p>\n\n<p>I have two simple structs representing the body and response of a HTTP call. I have another struct implementing the <code>UserService</code> interface.</p>\n\n<p>I want to put these structs, call them <code>UserResponse</code> and <code>UserRequest</code> inside the interface so other services can use them to make the HTTP call. Furthermore, the request and response should be available (<code>struct UserReponse</code>, not <code>struct userResponse</code>) so other parts of the code can use them.</p>\n\n<p>I define a function in the interface called <code>GetUser(request UserRequest) UserResponse</code></p>\n\n<p>However, whenever I reference <code>UserRequest</code> I have to use <code>service.UserRequest</code> and not <code>service.UserService.UserRequest</code>. This is bad because I don't want user-related objects to go into the service namespace. I want each service related data to organized under its own interface, file, etc. Unfortunately, I get an error if I put <code>UserResponse</code> inside the <code>UserService</code> interface. So I put it at the same level as <code>UserService</code>, which is why they are showing up as <code>service.UserResponse</code>. How do I go about accessing <code>UserResponse</code> as <code>service.UserService.UserResponse</code>?</p>\n"}, {"tags": ["linux", "windows", "go", "scp"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439386159, "post_id": 31965986, "comment_id": 51840442, "body": "That go-scp package doesn&#39;t appear to be particularly well vetted, and it uses an old and unmaintained version of the go ssh package which will be taken offline completely this month. Using the local <code>scp</code> binary does limit to hosts with openssh installed, but it isn&#39;t going to make your program any slower."}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439458431, "post_id": 31965986, "comment_id": 51873964, "body": "@JimB, Agreed with first point, I will edit the answer with better alternative. But about second point, using the local <code>scp</code> binary will technically slow down program a bit because you need to fork new process every time you want to use <code>scp</code> protocol, which is an expensive operation. Besides, if program wants to monitor the progress for a very large file, then it needs to monitor <code>stdout</code> of <code>scp</code>. This also requires parsing of the <code>stdout</code>, which is also time consuming task. So, using <code>scp</code> binary will somewhat slow down your program."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1439474034, "post_id": 31965986, "comment_id": 51884801, "body": "While it does add time, I highly doubt the extra &lt;4ms the fork and wait adds (still probably &lt;10ms if you have to page in the scp binary) has a real effect for most people. When you count in the ssh protocol, encryption and network overhead, forking the remote scp process, and not to mention <i>transferring files over the network</i>, the extra few milliseconds don&#39;t account for much."}, {"owner": {"reputation": 1222, "user_id": 220175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ctrdn.jpg?s=128&g=1", "display_name": "Bera", "link": "https://stackoverflow.com/users/220175/bera"}, "edited": false, "score": 0, "creation_date": 1439488300, "post_id": 31965986, "comment_id": 51894419, "body": "Hi guys, thanks a lot for the all information of your valuable comments. But there are in go robust alternatives for copy files or synchronize folder between distinct OS out there?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1222, "user_id": 220175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ctrdn.jpg?s=128&g=1", "display_name": "Bera", "link": "https://stackoverflow.com/users/220175/bera"}, "edited": false, "score": 1, "creation_date": 1439499869, "post_id": 31965986, "comment_id": 51900346, "body": "@Bera: you could use the sftp protocol with something like github.com/pkg/sftp, or you could just exec winscp like you suggested. If you want more recommendations, the mailing list or IRC are probably better choices, as that&#39;s off-topic here."}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439549457, "post_id": 31965986, "comment_id": 51918959, "body": "@JimB. Agreed. Edited the answer to reflect that."}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 0, "last_activity_date": 1439531017, "last_edit_date": 1439531017, "creation_date": 1439384366, "answer_id": 31965986, "question_id": 31965600, "link": "https://stackoverflow.com/questions/31965600/using-scp-in-golang-in-windows-to-copy-remote-files-in-remote-unix-host/31965986#31965986", "title": "Using SCP in Golang in Windows to copy remote files in remote unix host", "body": "<p>There are two ways to approach this problem:</p>\n\n<ul>\n<li><p>Use library to execute SCP protocol. There isn't any standard library in golang for SCP protocol. But you can use <a href=\"http://godoc.org/github.com/laher/scp-go/scp\" rel=\"nofollow\">this</a> library for SCP protocol.</p></li>\n<li><p>Use OS binary to execute SCP protocol. But please keep in mind that, in this case your program can only run on machine, which has this particular OS binary installed.</p></li>\n</ul>\n"}], "owner": {"reputation": 1222, "user_id": 220175, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ctrdn.jpg?s=128&g=1", "display_name": "Bera", "link": "https://stackoverflow.com/users/220175/bera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1520, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1439531017, "creation_date": 1439383419, "question_id": 31965600, "link": "https://stackoverflow.com/questions/31965600/using-scp-in-golang-in-windows-to-copy-remote-files-in-remote-unix-host", "title": "Using SCP in Golang in Windows to copy remote files in remote unix host", "body": "<p>Is needed to copy remote files in a linux server to a windows local server and I want to know if is possible to use golang (with standard lib or not and the process will be runnning on windows) to accomplish this task, or even the way could be to call another process like winscp.</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382140, "post_id": 31965056, "comment_id": 51837147, "body": "I don&#39;t think this is possible in Go without eventually using the reflect package."}, {"owner": {"reputation": 691, "user_id": 1948319, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f91e39ee3ef6d5f506417c3c2461a00a?s=128&d=identicon&r=PG", "display_name": "Adracus", "link": "https://stackoverflow.com/users/1948319/adracus"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382338, "post_id": 31965056, "comment_id": 51837301, "body": "That would also be ok if I could solve this problem using reflection"}], "answers": [{"comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1439382558, "post_id": 31965234, "comment_id": 51837436, "body": "Note, I strongly recommend you don&#39;t do that, in the end you will get more issues and hair-pulling bugs for a little syntactic sugar. And you probably can&#39;t do anything for return parameters... But that&#39;s a good catch (I was writing the same answer :P)."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382637, "post_id": 31965234, "comment_id": 51837502, "body": "@Elwinar I agree about not using any of this unless there is no other way, but you can actually get the returned values, since <code>reflect.Value.Call</code> does return them."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382705, "post_id": 31965234, "comment_id": 51837556, "body": "Yes, but you would have to do a cast on the return value of <code>Method.Call</code>, which is not that practical in the end."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382862, "post_id": 31965234, "comment_id": 51837678, "body": "@Elwinar the moment you use something like this in Go, practicality becomes a very loose concept :)"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1439382896, "post_id": 31965234, "comment_id": 51837701, "body": "@Grzegorz\u017bur reread the question. OP wants to do this &quot;without explicitly casting it to func(int, int) int&quot;."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1439382951, "post_id": 31965234, "comment_id": 51837749, "body": "@Ainar-G: the moment you start doing this in Go is probably the moment you should be using something else :P"}, {"owner": {"reputation": 691, "user_id": 1948319, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f91e39ee3ef6d5f506417c3c2461a00a?s=128&d=identicon&r=PG", "display_name": "Adracus", "link": "https://stackoverflow.com/users/1948319/adracus"}, "edited": false, "score": 0, "creation_date": 1439383121, "post_id": 31965234, "comment_id": 51837881, "body": "Thanks for the fast answer, exactly what I was looking for. I don&#39;t want to use this as a measure to reduce code size or somehow write shorter code. I&#39;m currently writing a small compiler (which does the type checking for me) and it generates go code which shall then invoke generated methods without the pain to cast everything accordingly (I&#39;m doing this only for research purpose, therefore I don&#39;t mind weak performance)."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1439383055, "last_edit_date": 1439383055, "creation_date": 1439382451, "answer_id": 31965234, "question_id": 31965056, "link": "https://stackoverflow.com/questions/31965056/invoke-functions-regardless-of-their-parameter-types/31965234#31965234", "title": "Invoke functions regardless of their parameter types", "body": "<p>The only way I know is by using <a href=\"http://golang.org/pkg/reflect/#Value.Call\" rel=\"nofollow\"><code>reflect.Value.Call</code></a>:</p>\n\n<pre><code>type Method struct {\n    fn interface{}\n}\n\nfunc (m Method) Call(args ...interface{}) {\n    vs := make([]reflect.Value, len(args))\n    for i := range args {\n        vs[i] = reflect.ValueOf(args[i])\n    }\n    v := reflect.ValueOf(m.fn)\n    v.Call(vs)\n}\n\nfunc main() {\n    f := func(a, b int) {\n        fmt.Println(a + b)\n    }\n    m := Method{f}\n    m.Call(2, 3)\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/JNtj2EMpu7\" rel=\"nofollow\">http://play.golang.org/p/JNtj2EMpu7</a>.</p>\n\n<p>Note: this will panic if fn is not a function or if the number or types of arguments are wrong. If you don't want that, you need to recheck all those conditions yourself.</p>\n"}], "owner": {"reputation": 691, "user_id": 1948319, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f91e39ee3ef6d5f506417c3c2461a00a?s=128&d=identicon&r=PG", "display_name": "Adracus", "link": "https://stackoverflow.com/users/1948319/adracus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 31965234, "answer_count": 1, "score": 1, "last_activity_date": 1439383055, "creation_date": 1439382030, "question_id": 31965056, "link": "https://stackoverflow.com/questions/31965056/invoke-functions-regardless-of-their-parameter-types", "title": "Invoke functions regardless of their parameter types", "body": "<p>Suppose I have a function which resides in the <code>fn</code> property of the following <code>Method</code> struct:</p>\n\n<pre><code>type Method struct {\n  fn interface{}\n}\n\nvar inst = &amp;Method{func(a, b int) int {\n  return a + b\n}}\n</code></pre>\n\n<p>Now, I want to invoke this function with two arguments\n<strong>without</strong> explicitly casting it to <code>func(int, int) int</code> like\nso</p>\n\n<pre><code>a := 5\nb := 6\nfmt.Println(inst.fn(a, b))\n</code></pre>\n\n<p>How can I achieve this? Is there some generic solution for this?</p>\n"}, {"tags": ["unit-testing", "struct", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439380066, "post_id": 31964309, "comment_id": 51835692, "body": "Do you want to check <i>all</i> fields, or only some of them?"}, {"owner": {"reputation": 912, "user_id": 1569782, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/83fjr.jpg?s=128&g=1", "display_name": "jbrulmans", "link": "https://stackoverflow.com/users/1569782/jbrulmans"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439380212, "post_id": 31964309, "comment_id": 51835784, "body": "All fields, if only have to check some of them I can just do them with a couple of if statements, but for all of them it just does not look like good practice."}], "answers": [{"comments": [{"owner": {"reputation": 912, "user_id": 1569782, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/83fjr.jpg?s=128&g=1", "display_name": "jbrulmans", "link": "https://stackoverflow.com/users/1569782/jbrulmans"}, "edited": false, "score": 0, "creation_date": 1439380836, "post_id": 31964509, "comment_id": 51836250, "body": "Thanks, especially for the <code>reflect.DeepEqual</code>. I think I&#39;ll know how to manage it now, because I was a little worried about my pointers. Cheers"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1439380538, "creation_date": 1439380538, "answer_id": 31964509, "question_id": 31964309, "link": "https://stackoverflow.com/questions/31964309/comparing-multiple-struct-fields-in-go/31964509#31964509", "title": "Comparing multiple struct fields in Go", "body": "<p>If you need to check all fields, just compare the structs:</p>\n\n<pre><code>type S struct {\n    A int\n    B float64\n}\n\nfunc main() {\n    fmt.Println(S{1, 3.14} == S{1, 3.14}) // Prints true.\n}\n</code></pre>\n\n<p>Notice though that if your structs contain pointers, that may get tricky because they may point to two different but equal values. In that case, you can use <a href=\"http://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow\"><code>reflect.DeepEqual</code></a>:</p>\n\n<pre><code>type S2 struct {\n    A int\n    B *float64\n}\n\nfunc main() {\n    var f1, f2 = 3.14, 3.14\n    // Prints false because the pointers differ.\n    fmt.Println(S2{1, &amp;f1} == S2{1, &amp;f2})\n    // Prints true.\n    fmt.Println(reflect.DeepEqual(S2{1, &amp;f1}, S2{1, &amp;f2}))\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/G24DbRDQE8\" rel=\"nofollow\">http://play.golang.org/p/G24DbRDQE8</a>.</p>\n\n<p>Anything fancier than that will most probably require you to define your own equality methods.</p>\n"}], "owner": {"reputation": 912, "user_id": 1569782, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/83fjr.jpg?s=128&g=1", "display_name": "jbrulmans", "link": "https://stackoverflow.com/users/1569782/jbrulmans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1356, "favorite_count": 0, "accepted_answer_id": 31964509, "answer_count": 1, "score": 6, "last_activity_date": 1439381607, "creation_date": 1439379948, "last_edit_date": 1439381607, "question_id": 31964309, "link": "https://stackoverflow.com/questions/31964309/comparing-multiple-struct-fields-in-go", "title": "Comparing multiple struct fields in Go", "body": "<p>I was wondering if there is a generic way of unit testing the values of a rather large struct without having to write many if statements below each other. I know in Go we can use table-driven unit tests, but I have not yet found how we can implement this table-driven approach with structs.</p>\n\n<p>My goal is to create a struct, do something with it, and unit test the new values of the struct. Does anybody know how I can achieve this with table-driven tests or if there's a better way to do it?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1439379807, "post_id": 31963334, "comment_id": 51835522, "body": "What about the fact that variables modified in one OS-thread may not be visible from another OS-thread unless access is wrapped into explicit synchronization like sync.Mutex. I know we&#39;re talking about goroutines but under the hood it goes down to OS-threads, though not always. How does it relate with the variable initialization before goroutine start, does golang perform implicit synchronization of captured variables somewhere inside before goroutine start?"}, {"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "reply_to_user": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 1, "creation_date": 1439384871, "post_id": 31963334, "comment_id": 51839368, "body": "We need to be precise about the term &quot;visible&quot; here: Of course a variable is visible (as in: visible at all) for every thread of a given process. The problem is: Is a <b>change</b> made by thread A visible to thread B <b>on time</b>. This may not be the case, if the two threads are accessing the variable <b>concurrently</b>. But as the first thread (I use this synonymously for go-routines: the two behave very much alike) has long finished it&#39;s modifications before the second one even existed, we are safe. There is no implicit synchronization by the go runtime, the implicit sync is done by your code."}], "tags": [], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "is_accepted": false, "score": 3, "last_activity_date": 1439377356, "creation_date": 1439377356, "answer_id": 31963334, "question_id": 31963075, "link": "https://stackoverflow.com/questions/31963075/is-synchronization-required/31963334#31963334", "title": "Is synchronization required?", "body": "<p>If there is no situation where an <strong>overlap</strong> of <strong>read and write</strong> operations by different go-routines may occur on this variable, then you are right: there is no need for any synchonization.</p>\n\n<p>As you have mentioned that the variable was initialized <strong>before</strong> your go-routine started, you are in fact safe.</p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1439382250, "creation_date": 1439382250, "answer_id": 31965142, "question_id": 31963075, "link": "https://stackoverflow.com/questions/31963075/is-synchronization-required/31965142#31965142", "title": "Is synchronization required?", "body": "<p>Yes, it is safe. According to <a href=\"http://golang.org/ref/mem\" rel=\"nofollow\">Go Memory Model</a>:</p>\n\n<ul>\n<li>the go statement that starts a new goroutine happens before the goroutine's execution begins</li>\n<li>within a single goroutine, the happens-before order is the order expressed by the program</li>\n</ul>\n\n<p>This means that all changes to variables that you made before starting a goroutine are visible inside this goroutine.</p>\n\n<p>Answer to your additional question: it depends. Generally if <code>r.goroutine()</code> modified <code>r.something</code> and you want to read it from another goroutine you need to use synchronisation.</p>\n"}, {"comments": [{"owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1439382995, "post_id": 31965303, "comment_id": 51837782, "body": "Totally makes sense! Thanks @tomasz"}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 5, "last_activity_date": 1439382631, "creation_date": 1439382631, "answer_id": 31965303, "question_id": 31963075, "link": "https://stackoverflow.com/questions/31963075/is-synchronization-required/31965303#31965303", "title": "Is synchronization required?", "body": "<p>Of course this is safe, otherwise programming in Go might be a nightmare (or at least much less pleasant). <a href=\"https://golang.org/ref/mem\">The Go Memory Model</a> is an interesting piece to read.</p>\n\n<p>The routine creation is a synchronisation point. There is an example very similar to yours:</p>\n\n<pre><code>var a string\n\nfunc f() {\n    print(a)\n}\n\nfunc hello() {\n    a = \"hello, world\"\n    go f()\n}\n</code></pre>\n\n<p>With the following comment:</p>\n\n<blockquote>\n  <p>calling hello will print \"hello, world\" at some point in the future (perhaps after hello has returned).</p>\n</blockquote>\n\n<p>This is because:</p>\n\n<blockquote>\n  <p>The go statement that starts a new goroutine happens <strong>before</strong> the goroutine's execution begins.</p>\n</blockquote>\n\n<p>The word <em>before</em> is crucial here as it implies routine creation (in one thread) must be synchronised with its start (possibly in other thread), so writes to <em>a</em> must be visible by the new routine.</p>\n"}], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 31965303, "answer_count": 3, "score": 5, "last_activity_date": 1439382631, "creation_date": 1439376678, "last_edit_date": 1439380119, "question_id": 31963075, "link": "https://stackoverflow.com/questions/31963075/is-synchronization-required", "title": "Is synchronization required?", "body": "<p>I defined a variable (r.something) inside an object</p>\n\n<pre><code>func (r *Runner) init() {\n  r.something = make(map[string]int)\n  r.something[\"a\"]=1\n\n  go r.goroutine()\n}\n</code></pre>\n\n<p>while r.goroutine uses value stored in r.something with no synchronization.\nNobody else is going to read/write this value except r.goroutine()</p>\n\n<p>Is it safe to do without synchronization?</p>\n\n<p>In other words: I want to reuse some variable from a goroutine initialized somewhere else <em>before</em> goroutine start. Is that safe?</p>\n\n<p>Additional question:\nAfter r.goroutine() finishes I want to be able to use r.something from somewhere else(without read/write overlap with other goroutines). Is it safe too?</p>\n"}, {"tags": ["string", "go", "special-characters"], "comments": [{"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 1, "creation_date": 1439374823, "post_id": 31961882, "comment_id": 51832241, "body": "Could you elaborate a bit more on what do you mean by special character in golang?"}, {"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "reply_to_user": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 0, "creation_date": 1439390051, "post_id": 31961882, "comment_id": 51843589, "body": "characters like these: &#39;/&#39;, &#39;-&#39;, &#39;|&#39; ,&#39;&amp;&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "edited": false, "score": 0, "creation_date": 1439375777, "post_id": 31962162, "comment_id": 51832854, "body": "<a href=\"http://play.golang.org/p/vTzxAs6EjT\" rel=\"nofollow noreferrer\">it prints &#39;NOK&#39; even without the special characters</a>  if i already have a string with the allowed characters, how can i convert it to runes?  Thanks!"}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "edited": false, "score": 0, "creation_date": 1439380383, "post_id": 31962162, "comment_id": 51835904, "body": "By bad, I botched the example. See the new corrected example."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 3, "last_activity_date": 1439380350, "last_edit_date": 1439380350, "creation_date": 1439374183, "answer_id": 31962162, "question_id": 31961882, "link": "https://stackoverflow.com/questions/31961882/how-to-check-if-there-is-a-special-character-in-string-or-if-a-character-is-a-sp/31962162#31962162", "title": "How to check if there is a special character in string or if a character is a special character in GoLang", "body": "<p>Depending on your definition of <em>special character</em>, the simplest solution would probably to do a <code>for range</code> loop on your string (which yield runes instead of bytes), and for each rune check if it is in your list of allowed/forbidden runes.</p>\n\n<p>See <a href=\"https://blog.golang.org/strings\" rel=\"nofollow\">Strings, bytes, runes and characters in Go</a> for more about the relations between string, bytes and runes.</p>\n\n<p><a href=\"http://play.golang.org/p/3OueP8kIEz\" rel=\"nofollow\">Playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "edited": false, "score": 0, "creation_date": 1439390451, "post_id": 31964846, "comment_id": 51843949, "body": "I ended up checking everything that wasn&#39;t ABC...Z  Thanks!"}], "tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 16, "last_activity_date": 1439391042, "last_edit_date": 1439391042, "creation_date": 1439381461, "answer_id": 31964846, "question_id": 31961882, "link": "https://stackoverflow.com/questions/31961882/how-to-check-if-there-is-a-special-character-in-string-or-if-a-character-is-a-sp/31964846#31964846", "title": "How to check if there is a special character in string or if a character is a special character in GoLang", "body": "<p>You can use strings.ContainsAny to see if a rune exists:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strings\"\n)\n\nfunc main() {\n  fmt.Println(strings.ContainsAny(\"Hello World\", \",|\"))\n  fmt.Println(strings.ContainsAny(\"Hello, World\", \",|\"))\n  fmt.Println(strings.ContainsAny(\"Hello|World\", \",|\"))\n}\n</code></pre>\n\n<p>Or if you want to check if there are only ASCII characters, you can use strings.IndexFunc:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    f := func(r rune) bool {\n        return r &lt; 'A' || r &gt; 'z'\n    }\n    if strings.IndexFunc(\"HelloWorld\", f) != -1 {\n        fmt.Println(\"Found special char\")\n    }\n    if strings.IndexFunc(\"Hello World\", f) != -1 {\n        fmt.Println(\"Found special char\")\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1455727739, "post_id": 31968387, "comment_id": 58621603, "body": "That&#39;s a lot of extra work to just iterate over a string."}, {"owner": {"reputation": 2552, "user_id": 610051, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c90269c460cc6593f56823abb0c9cf39?s=128&d=identicon&r=PG", "display_name": "Roshambo", "link": "https://stackoverflow.com/users/610051/roshambo"}, "edited": false, "score": 0, "creation_date": 1585771064, "post_id": 31968387, "comment_id": 107883883, "body": "That won&#39;t allow for uppercase characters, characters with diacritics like <code>&#233;</code>, <code>&#241;</code> and <code>&#231;</code>, non-Latin scripts. Basically anything that&#39;s not English won&#39;t pass."}], "tags": [], "owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "is_accepted": true, "score": -2, "last_activity_date": 1439390377, "creation_date": 1439390377, "answer_id": 31968387, "question_id": 31961882, "link": "https://stackoverflow.com/questions/31961882/how-to-check-if-there-is-a-special-character-in-string-or-if-a-character-is-a-sp/31968387#31968387", "title": "How to check if there is a special character in string or if a character is a special character in GoLang", "body": "<p>I ended up doing something like this</p>\n\n<pre><code>alphabet := \"abcdefghijklmnopqrstuvwxyz\"\nalphabetSplit := strings.Split(alphabet, \"\")\ninputLetters := strings.Split(input, \"\")\n\nfor index, value := range inputLetters {\n        special:=1\n        for _, char :=range alphabetSplit{\n            if char == value {\n                special = 0\n                break\n            }\n        }\n</code></pre>\n\n<p>It might have anything wrong because since I used it to something specific i had to edit to post it here</p>\n"}, {"comments": [{"owner": {"reputation": 2904, "user_id": 5832720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb8ed71cd77d9da995685ca872b303e7?s=128&d=identicon&r=PG", "display_name": "Nikhita Raghunath", "link": "https://stackoverflow.com/users/5832720/nikhita-raghunath"}, "edited": false, "score": 0, "creation_date": 1511180550, "post_id": 38022820, "comment_id": 81736736, "body": "This works for unicode characters like +, &lt;, etc but won&#39;t give the correct output for escape sequences like <code>\\n</code>, etc."}, {"owner": {"reputation": 11, "user_id": 2636241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZiaRr.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/2636241/andy"}, "reply_to_user": {"reputation": 2904, "user_id": 5832720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb8ed71cd77d9da995685ca872b303e7?s=128&d=identicon&r=PG", "display_name": "Nikhita Raghunath", "link": "https://stackoverflow.com/users/5832720/nikhita-raghunath"}, "edited": false, "score": 0, "creation_date": 1525819517, "post_id": 38022820, "comment_id": 87504093, "body": "@Nikhita Based on Kipz&#39; comment on the main question, he was not worried about escape characters. Nor were they mentioned in the question. This would likely have been the best solution for the problem."}], "tags": [], "owner": {"reputation": 11, "user_id": 2636241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZiaRr.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/2636241/andy"}, "is_accepted": false, "score": -1, "last_activity_date": 1466806241, "creation_date": 1466806241, "answer_id": 38022820, "question_id": 31961882, "link": "https://stackoverflow.com/questions/31961882/how-to-check-if-there-is-a-special-character-in-string-or-if-a-character-is-a-sp/38022820#38022820", "title": "How to check if there is a special character in string or if a character is a special character in GoLang", "body": "<p>You want to use the unicode package, which has a nice function to check for symbols.</p>\n\n<p><a href=\"https://golang.org/pkg/unicode/#IsSymbol\" rel=\"nofollow\">https://golang.org/pkg/unicode/#IsSymbol</a> </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode\"\n)\n\nfunc hasSymbol(str string) bool {\n    for _, letter := range str {\n        if unicode.IsSymbol(letter) {\n            return true\n        }\n    }\n    return false\n}\n\nfunc main() {   \n    var strs = []string {\n        \"A quick brown fox\",\n        \"A+quick_brown&lt;fox\",\n    }\n\n    for _, str := range strs {\n        if hasSymbol(str) { \n            fmt.Printf(\"String '%v' contains symbols.\\n\", str)\n        } else {\n            fmt.Printf(\"String '%v' did not contain symbols.\\n\", str)   \n        }\n    }\n}\n</code></pre>\n\n<p>This will provide the following output: </p>\n\n<pre><code>String 'A quick brown fox' did not contain symbols.\nString 'A+quick_brown&lt;fox' contains symbols.\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20035, "favorite_count": 1, "accepted_answer_id": 31968387, "answer_count": 4, "score": 11, "last_activity_date": 1466806241, "creation_date": 1439373423, "question_id": 31961882, "link": "https://stackoverflow.com/questions/31961882/how-to-check-if-there-is-a-special-character-in-string-or-if-a-character-is-a-sp", "title": "How to check if there is a special character in string or if a character is a special character in GoLang", "body": "<p>After reading a string from the input, I need to check if there is a special character in it</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "is_accepted": false, "score": 14, "last_activity_date": 1439374051, "last_edit_date": 1439374051, "creation_date": 1439372962, "answer_id": 31961701, "question_id": 31961536, "link": "https://stackoverflow.com/questions/31961536/function-types-vs-single-method-interfaces/31961701#31961701", "title": "Function types vs single method interfaces", "body": "<h2>In the general case</h2>\n\n<p>This is a question of design. Interfaces offer something that functions don't : dynamic dispatch. So if later on you want (possibly your own) client code to apply said function to an object, and envision that this object may possibly be of one of several different types at one given point in the program, go for an interface.</p>\n\n<p>The pro : you can get flexible.</p>\n\n<p>The cons : </p>\n\n<ul>\n<li>dynamic dispatch costs a minor overhead in execution time. You won't want that in the very middle of a critical loop for instance.</li>\n<li>interfaces, if available, will be used as the system grows, possibly in slightly unexpected ways. Which means that whereas most times you can define a function's scope of responsiblity light-heartedly enough, an interface's responsibility and type signature should be well thought-out, as a design decision.</li>\n<li>there are more intellectual indirections to go through for a reader who tries to understand the code.</li>\n</ul>\n\n<p>Go is designed as a simple and pragmatic language. I suppose that as willing users, we should carry forward its philosophy. Hence, I'd say : if you don't need something, don't use it. :)</p>\n\n<h2>In your particular case</h2>\n\n<p>Although a function pointer is indeed a form of developer-managed dynamic dispatch, it seems to me that the reasoning above remains applicable : go for the simplest solution that could satisfy the foreseeable needs. Otherwise Go will become Java. If you're certain that the delegate will never need to provide any other entry point (like providing meta information for example), I'd say stick to the function pointer.</p>\n"}, {"comments": [{"owner": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "edited": false, "score": 0, "creation_date": 1439380882, "post_id": 31963076, "comment_id": 51836286, "body": "Method can be passed as a function pointer, so that &quot;works on data&quot; point is not really valid. Actually it&#39;s not &quot;functions vs methods&quot;, it&#39;s &quot;function types vs interfaces&quot;."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "edited": false, "score": 0, "creation_date": 1439381762, "post_id": 31963076, "comment_id": 51836855, "body": "Can <code>io.Reader</code> interface be a function instead of single method interface? Technically it is possible but it will be less convenient to work with it. Could <code>bufio.SplitFunc</code> be a single method interface? Yes, but again the code to work with it will become more verbose. There is no single answer to your question."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 4, "last_activity_date": 1439376678, "creation_date": 1439376678, "answer_id": 31963076, "question_id": 31961536, "link": "https://stackoverflow.com/questions/31961536/function-types-vs-single-method-interfaces/31963076#31963076", "title": "Function types vs single method interfaces", "body": "<p>I think it is reasonable to use the following simple rule:</p>\n\n<ul>\n<li>if the most likely implementation works on data that is not passed in the arguments then use an interface. Example from the standard library: <code>io.Reader</code> interface with a single method <code>Read</code>.</li>\n<li>otherwise use a function. Examples from the standard library: <code>http.HandlerFunc</code>, <code>bufio.SplitFunc</code></li>\n</ul>\n\n<p>Also I find that good names help with design decisions. </p>\n"}], "owner": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3136, "favorite_count": 6, "answer_count": 2, "score": 22, "last_activity_date": 1616520301, "creation_date": 1439372541, "last_edit_date": 1439380916, "question_id": 31961536, "link": "https://stackoverflow.com/questions/31961536/function-types-vs-single-method-interfaces", "title": "Function types vs single method interfaces", "body": "<p>If an interface has only a single method, should I use a function type instead?</p>\n\n<p>Here are an examples of both approaches:</p>\n\n<pre><code>type Delegate interface {                 | type Delegate func(x int) int\n  Do(x int) int                           | \n}                                         | \n                                          | \ntype App struct {                         | type App struct {\n  delegate Delegate                       |   delegate Delegate\n}                                         | }\n                                          | \nfunc (this *App) foo() {                  | func (this *App) foo() {\n  ...                                     |   ...\n  y := this.delegate.Do(x)                |   y := this.delegate(x)\n  ...                                     |   ...\n}                                         | }\n                                          | \nfunc main() {                             | func main() {\n  delegate := &amp;DelegateImpl{}             |   delegate := &amp;DelegateImpl{}\n  app := &amp;App{delegate}                   |   app := &amp;App{delegate.Process}\n  ...                                     |   ...\n}                                         | }\n</code></pre>\n\n<p>Tests:</p>\n\n<pre><code>type FakeDelegate {                       | \n  t *testing.T                            | \n  expectedX int                           | \n  result int                              | \n}                                         | \n                                          | \nfunc (this *FakeDelegate) Do(x int) int { | \n  require.Equal(t, this.expectedX, x)     | \n  return this.result                      | \n}                                         | \n                                          | \nfunc TestAppFoo(t *testing.T) {           | func TestAppFoo(t *testing.T) {\n  app := &amp;App{}                           |   app := &amp;App{}\n  app.delegate = &amp;FakeDelegate{t, 1, 2}   |   app.delegate = func(x int) int {\n  app.foo()                               |     require.Equal(t, 1, x)\n}                                         |     return 2\n                                          |   }\n                                          |   app.foo()\n                                          | }\n</code></pre>\n\n<p>It looks like the code on the right (with function type) has less lines, especially when it comes to tests. But isn't there any pitfalls?</p>\n"}, {"tags": ["json", "reflection", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1439372383, "post_id": 31960996, "comment_id": 51830519, "body": "In your example you&#39;re using <code>reflect.Zero</code> and not <code>reflect.New</code> for destination3. changing to <code>New</code> solves the problem. But in your question it&#39;s <code>New</code>, so I&#39;m not sure what&#39;s up."}, {"owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1439373365, "post_id": 31960996, "comment_id": 51831288, "body": "I remade example with <code>New</code> but the result is just the same <a href=\"http://play.golang.org/p/Ts0jvApwtY\" rel=\"nofollow noreferrer\">play.golang.org/p/Ts0jvApwtY</a>"}, {"owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1439374260, "post_id": 31960996, "comment_id": 51831866, "body": "I didn&#39;t mentioned that  <code>val := reflection.New(type).Interface(); json.Unmarshal(data, val)</code> works, but i need not the pointer, but the value itself. And in this case i can&#39;t do conversion <code>return *val</code> - because of error <code>invalid indirect</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "is_accepted": false, "score": 0, "last_activity_date": 1439373824, "creation_date": 1439373824, "answer_id": 31962030, "question_id": 31960996, "link": "https://stackoverflow.com/questions/31960996/golang-fails-to-parse-json-for-reflection-created-object/31962030#31962030", "title": "golang fails to parse json for reflection created object", "body": "<p>I've found the way how to do what i need</p>\n\n<pre><code>val := reflect.New(reflect.TypeOf(Message{}))\njson.Unmarshal(data, val.Interface())\n\nreturn val.Elem().Interface()\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/8g9FSg3MSj\" rel=\"nofollow\">http://play.golang.org/p/8g9FSg3MSj</a></p>\n\n<p>But was was wrong wit the first version??? \nIt Looks like <code>reflect.Zero(type)</code> should be equivalent to <code>reflect.New(type).Elem()</code> - am i wrong?</p>\n"}, {"comments": [{"owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "edited": false, "score": 0, "creation_date": 1439375065, "post_id": 31962240, "comment_id": 51832389, "body": "Thanks a lot! Your comment explaines the problem heart and the article is very useful - unfortunately i didn&#39;t saw it before!"}, {"owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "edited": false, "score": 0, "creation_date": 1439375451, "post_id": 31962240, "comment_id": 51832654, "body": "\u0418 \u0441\u043f\u0430\u0441\u0438\u0431\u043e \u0432\u0430\u043c \u043f\u043e-\u0440\u0443\u0441\u0441\u043a\u0438 :) \u042f \u0434\u043e\u0433\u0430\u0434\u044b\u0432\u0430\u043b\u0441\u044f, \u0447\u0442\u043e \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0432 \u044d\u0442\u0443 \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \u0441\u0442\u043e\u0438\u0442 \u043a\u043e\u043f\u0430\u0442\u044c, \u043d\u043e \u0434\u043e \u043a\u043e\u043d\u0446\u0430 \u043d\u0435 \u0434\u043e\u0448\u0451\u043b. \u042f \u043d\u0430 \u0433\u043e \u043f\u0438\u0448\u0443 \u043d\u0435 \u0442\u0430\u043a \u0434\u0430\u0432\u043d\u043e \u0438 \u0441\u0442\u0430\u0440\u0430\u044e\u0441\u044c \u0432\u043a\u0430\u043f\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0432\u043e \u0432\u0441\u0435 \u0434\u0435\u0442\u0430\u043b\u0438, \u0430 \u043d\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u043b\u0438\u0448\u044c \u0431\u044b \u0437\u0430\u0440\u0430\u0431\u043e\u0442\u0430\u043b\u043e. \u0410 \u0441\u0442\u0430\u0442\u044c\u044f, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u044b \u0441\u043a\u0438\u043d\u0443\u043b\u0430 - \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0447\u0435\u043d\u044c \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u0430\u044f. \u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e \u0434\u0430\u043b\u0435\u043a\u043e \u043d\u0435 \u0432\u0441\u0435 \u043f\u043e\u0434\u043e\u0431\u043d\u044b\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u044b \u043f\u043e go \u043b\u0435\u0436\u0430\u0442 \u043d\u0430 \u043f\u043e\u0432\u0435\u0440\u0445\u043d\u043e\u0441\u0442\u0438 - \u0441\u0430\u043c \u0431\u044b \u044f \u0432\u0440\u044f\u0434 \u043b\u0438 \u043a\u043e\u0433\u0434\u0430 \u0435\u0451 \u043d\u0430\u0448\u0451\u043b..."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "edited": false, "score": 0, "creation_date": 1439375556, "post_id": 31962240, "comment_id": 51832728, "body": "\u0412\u0441\u0435\u0433\u0434\u0430 \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 :) \u0417\u0430\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b - \u0431\u0443\u0434\u0435\u043c \u043f\u043e\u043c\u043e\u0433\u0430\u0442\u044c, \u0447\u0435\u043c \u0441\u043c\u043e\u0436\u0435\u043c."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 2, "last_activity_date": 1439374396, "creation_date": 1439374396, "answer_id": 31962240, "question_id": 31960996, "link": "https://stackoverflow.com/questions/31960996/golang-fails-to-parse-json-for-reflection-created-object/31962240#31962240", "title": "golang fails to parse json for reflection created object", "body": "<p>Please read this article: <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow\">http://research.swtch.com/interfaces</a>, especially the \"Memory Optimizations\".</p>\n\n<p>The interface{} by definition consists of two pointers - to method table (e.g. type) and to data it holds. So for</p>\n\n<pre><code>var destination3 interface{} = reflect.Zero(reflect.TypeOf(Message{})).Interface()\n</code></pre>\n\n<p>it is empty method table (as <code>interface{}</code> has no methods) and reference to <code>Message{}</code>. Taking reference from it returns the reference to this struct so the unmarhal overwrites it with whatever matches <code>interface{}</code>.</p>\n\n<p>If the data <code>interface{}</code> variable holds is a pointer itself, then it is optimized in a way that this pointer is used instead creating <code>interface{}</code> structure. So getting reference to it gives the reference to original variable.</p>\n\n<p><a href=\"http://play.golang.org/p/KsIS29rUAX\" rel=\"nofollow\">http://play.golang.org/p/KsIS29rUAX</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var m1 struct{ Data string }\n    var m2 interface{}\n    var m3 interface{}\n\n    m2 = &amp;m1\n    m3 = m1\n\n    fmt.Printf(\"&amp;m1=%p m2=%p &amp;m3=%p\\n\", &amp;m1, m2, &amp;m3)\n}\n</code></pre>\n\n<p>In your case, using Zero is equivalent to m3 in the example above. Using New is equivalent to m2.</p>\n"}], "owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 0, "accepted_answer_id": 31962240, "answer_count": 2, "score": 2, "last_activity_date": 1439374396, "creation_date": 1439371235, "last_edit_date": 1439374153, "question_id": 31960996, "link": "https://stackoverflow.com/questions/31960996/golang-fails-to-parse-json-for-reflection-created-object", "title": "golang fails to parse json for reflection created object", "body": "<p>I try to write simple message protocol in go and i've encountered a problem. I have a lot of message types and i want to have a dictionary like this to manipulate with messages:</p>\n\n<pre><code>var dict map[reflect.Type]int = map[reflect.Type]int{\n    reflect.TypeOf(DataMessage{}):          1000,\n    reflect.TypeOf(TextMessage{}):          1001,\n    //....\n}\n\nfunc GetMessageTypeId(value interface{}) int {\n    if id, ok := dict[reflect.TypeOf(value)]; ok {\n        return id\n    } else {\n        return -1\n    }\n}\n\nfunc GetValueByTypeId(typeId int) interface{} {\n    for typeDec, id := range dict {\n        if id == typeId {\n            return reflect.Zero(typeDec).Interface()\n        }\n    }\n    fmt.Println(\"Unknown message type\", typeId)\n    return nil\n}\n</code></pre>\n\n<p>It works fine, but when i instantiate message with GetValueByTypeId and try to unmarshall json into it - i receive map[string]interface instead of my message.\nI've made simple example to reproduce the problem:</p>\n\n<p><a href=\"http://play.golang.org/p/QEyDN9vztr\" rel=\"nofollow\">http://play.golang.org/p/QEyDN9vztr</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 2, "creation_date": 1439345568, "post_id": 31954899, "comment_id": 51818880, "body": "Is there a reason you can&#39;t use <a href=\"http://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\"><code>io.Copy</code></a>?"}, {"owner": {"reputation": 4701, "user_id": 18228, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7071119714e1a32441aca0c336657d3e?s=128&d=identicon&r=PG", "display_name": "mbrevoort", "link": "https://stackoverflow.com/users/18228/mbrevoort"}, "reply_to_user": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1439778820, "post_id": 31954899, "comment_id": 51984353, "body": "I actually didn&#39;t find it at first. Interfaces in Go make it tricky to know you what types implement which interfaces. With <code>Copy(dst Writer, src Reader)</code>  it&#39;s not immediately clear that io.ReadCloser and File implement Reader and Writer."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 1, "creation_date": 1439779958, "post_id": 31954899, "comment_id": 51984561, "body": "You should read about some of the <a href=\"https://golang.org/doc/effective_go.html#interface-names\" rel=\"nofollow noreferrer\">naming conventions</a> in Go, it should be very clear that <code>io.ReadCloser</code> implements <code>Reader</code> (and <code>Closer</code>). I guess <code>File</code> takes a small amount of digging, but one would kinda expect you could read and write to Files."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1439386744, "post_id": 31955055, "comment_id": 51840901, "body": "Speaking of buffer size, go1.5 will have an <code>io.CopyBuffer</code>, which allows you to pass in the buffer to use for the Copy operation"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439404915, "post_id": 31955055, "comment_id": 51852874, "body": "@JimB ah very nice :)"}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 16, "last_activity_date": 1439346266, "creation_date": 1439346266, "answer_id": 31955055, "question_id": 31954899, "link": "https://stackoverflow.com/questions/31954899/most-efficient-way-in-go-to-stream-io-readcloser-to-a-file/31955055#31955055", "title": "Most efficient way in Go to stream io.ReadCloser to a file?", "body": "<p><a href=\"http://golang.org/pkg/io/#Copy\">io.Copy</a> is undoubtedly the most efficient in terms of code; you only need to</p>\n\n\n\n<pre><code>outFile, err := os.Create(filename)\n// handle err\ndefer outFile.Close()\n_, err = io.Copy(outFile, res.Body)\n// handle err\n</code></pre>\n\n<p>it's also likely to be pretty efficient in terms of CPU and memory as well. You can peek at the <a href=\"http://golang.org/src/io/io.go?s=12247:12307#L340\">implementation of io.Copy</a> if you want; assuming that the body doesn't implement <code>WriteTo</code> and the file doesn't implement <code>ReadFrom</code> (a quick glance says that they don't), <code>Copy</code> will copy chunks of up to 32kB at a time. A bigger chunk would probably use a bit less CPU but more memory; the value they picked seems like a good tradeoff.    </p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618957692, "creation_date": 1618957692, "answer_id": 67187061, "question_id": 31954899, "link": "https://stackoverflow.com/questions/31954899/most-efficient-way-in-go-to-stream-io-readcloser-to-a-file/67187061#67187061", "title": "Most efficient way in Go to stream io.ReadCloser to a file?", "body": "<p>Another option is <code>File.ReadFrom</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;net/http&quot;\n   &quot;os&quot;\n)\n\nfunc main() {\n   r, e := http.Get(&quot;https://stackoverflow.com&quot;)\n   if e != nil {\n      panic(e)\n   }\n   defer r.Body.Close()\n   f, e := os.Create(&quot;index.html&quot;)\n   if e != nil {\n      panic(e)\n   }\n   defer f.Close()\n   f.ReadFrom(r.Body)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/os#File.ReadFrom\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os#File.ReadFrom</a></p>\n"}], "owner": {"reputation": 4701, "user_id": 18228, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7071119714e1a32441aca0c336657d3e?s=128&d=identicon&r=PG", "display_name": "mbrevoort", "link": "https://stackoverflow.com/users/18228/mbrevoort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7221, "favorite_count": 1, "accepted_answer_id": 31955055, "answer_count": 2, "score": 9, "last_activity_date": 1618957692, "creation_date": 1439345194, "question_id": 31954899, "link": "https://stackoverflow.com/questions/31954899/most-efficient-way-in-go-to-stream-io-readcloser-to-a-file", "title": "Most efficient way in Go to stream io.ReadCloser to a file?", "body": "<p>Given an io.ReadCloser, from the response of an HTTP request for example, what is the most efficient way both in memory overhead and code readability to stream the response to a File? </p>\n"}, {"tags": ["c#", "go", "protocol-buffers", "protobuf-net"], "comments": [{"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1439351606, "post_id": 31954631, "comment_id": 51820274, "body": "Which version of protobuf-net are you using?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1439358510, "post_id": 31954631, "comment_id": 51822370, "body": "yes i guess the version problem."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1439365518, "post_id": 31954631, "comment_id": 51825975, "body": "protobuf doesn&#39;t support inheritance"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1439366296, "post_id": 31954631, "comment_id": 51826448, "body": "show us the code that you use to serialize the data using protobuf-net"}, {"owner": {"reputation": 387, "user_id": 2057180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979d377f108c1bf68e89f4357017e630?s=128&d=identicon&r=PG", "display_name": "Chris Tramel", "link": "https://stackoverflow.com/users/2057180/chris-tramel"}, "reply_to_user": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1439384249, "post_id": 31954631, "comment_id": 51838861, "body": "@isim The go code is using 2.6.1. I&#39;m not sure what version of protobuffers the latest nuget package of protobuf-net is using, I believe it&#39;s baked into the DLL you get down from nuget."}, {"owner": {"reputation": 387, "user_id": 2057180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979d377f108c1bf68e89f4357017e630?s=128&d=identicon&r=PG", "display_name": "Chris Tramel", "link": "https://stackoverflow.com/users/2057180/chris-tramel"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1439385005, "post_id": 31954631, "comment_id": 51839491, "body": "@kostya I mean, protobuf-net to protobuf-net understands inheritance, so there has to be some way for the golang version to serialize that information right? Unless protobuf-net is just using a custom protocol on top of protobuffers, which I suppose is possible. But when why, if I make my base class non-abstract, does everything work fine?  I added version numbers and code for protobuf-net serialization to the question."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1439388438, "post_id": 31954631, "comment_id": 51842224, "body": "So you are saying that everything works as expected if you make the base class non-abstract? Is it correct? It looks like protobuf-net doesn&#39;t support inheritance with abstract classes."}, {"owner": {"reputation": 387, "user_id": 2057180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979d377f108c1bf68e89f4357017e630?s=128&d=identicon&r=PG", "display_name": "Chris Tramel", "link": "https://stackoverflow.com/users/2057180/chris-tramel"}, "edited": false, "score": 0, "creation_date": 1439388845, "post_id": 31954631, "comment_id": 51842586, "body": "Yeah, everything works as expected if I make the base class non-abstract. However, I can use the abstract base class if I serialize with protobuf-net, and it deserializes it with no issues at all. It&#39;s when I serialize it with protoc in golang that it&#39;s failing. I feel like the issue might have to do with how protobuf-net is seeing the inheritance tree, it looks like with the protobuf-net serialized version it understands that I want an object of type SomeDerivedType... but if it&#39;s golang serialized, it&#39;s creating the BaseClass first, then marshaling it into SomeDerivedClass."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1439389791, "post_id": 31954631, "comment_id": 51843378, "body": "I still beleive it is protobuf-net limitation. Go implementation serializes data according to the spec. However protobuf-net treats the spec loosely. See this answer by protobuf-net creator (the last paragraph): <a href=\"http://stackoverflow.com/questions/8808290/order-of-deserialization-in-protobuf-net\" title=\"order of deserialization in protobuf net\">stackoverflow.com/questions/8808290/&hellip;</a>."}], "owner": {"reputation": 387, "user_id": 2057180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979d377f108c1bf68e89f4357017e630?s=128&d=identicon&r=PG", "display_name": "Chris Tramel", "link": "https://stackoverflow.com/users/2057180/chris-tramel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 328, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1439384888, "creation_date": 1439343158, "last_edit_date": 1439384888, "question_id": 31954631, "link": "https://stackoverflow.com/questions/31954631/cross-platform-protobuffers-deserializing-with-protobuf-net-and-inheritence", "title": "Cross-platform protobuffers, deserializing with Protobuf-net and inheritence", "body": "<p>Forgive, in advance, any ignorance regarding protobuffers or Go, as both of these technologies are relatively new to me. </p>\n\n<p>We've been using protobuffers and protobuf-net in production for a little while. We use Redis as a message queue between systems, and everything that reads or writes to Redis uses the exact same models (a shared library) and protobuf-net to serialize and deserialize. Now, however, we want to push things into Redis from a system written in Go. My problem is that the Go-written protobuffer data is not able to be deserialized in my .NET application with protobuf-net</p>\n\n<p>See the following small example for my problem. </p>\n\n<p>I am using protoc version 2.6.1 for the Golang approach and protobuf-net version 2.0.0.668 for .NET </p>\n\n<pre><code>[ProtoContract]\n[ProtoInclude(3, typeof(SomeDerivedClass))]\npublic abstract class BaseClass\n{\n    [ProtoMember(1)]\n    public Int32 Foo { get; set; }\n}\n\n[ProtoContract]\npublic class SomeDerivedClass : BaseClass\n{\n\n    [ProtoMember(2)]\n    public String Bar { get; set; }\n}\n</code></pre>\n\n<p>Using <code>Serializer.GetProto&lt;SomeDerivedClass&gt;();</code> yields the following .proto file:</p>\n\n<pre><code>message BaseClass {\n   optional int32 Foo = 1 [default = 0];\n   // the following represent sub-types; at most 1 should have a value\n   optional SomeDerivedClass SomeDerivedClass = 3;\n}\nmessage SomeDerivedClass {\n   optional string Bar = 2;\n}\n</code></pre>\n\n<p>Which, using protogen, yielded the following .go file:\n<a href=\"https://gist.github.com/cjqed/408dd9fd11e935239f36\" rel=\"nofollow\">https://gist.github.com/cjqed/408dd9fd11e935239f36</a></p>\n\n<p>Then,</p>\n\n<pre><code>derived := &amp;SomeDerivedClass{\n    Bar: proto.String(\"h\"),\n}\nbaseClass := &amp;BaseClass{\n    SomeDerivedClass: derived,\n    Foo: proto.Int32(13),\n} \ndata, err := proto.Marshal(baseClass)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>When deserialized with protobuf-net, results in</p>\n\n<p>Result: <code>ProtoException, No parameterless constructor found for BaseClass</code></p>\n\n<p>...Unless I make BaseClass non-abstract. Which, although possible, is not really a good solution.</p>\n\n<p>Finally, I made the exact same object in protobuf-net and in Go (both on the same machine, mind you), and these are the bytes for each:</p>\n\n<p>(Code in protobuf-net to serialize)</p>\n\n<pre><code>var obj = new SomeDerivedClass\n{\n    Bar = \"h\",\n    Foo = 13\n};\nbyte[] data;\n\nusing (var memoryStream = new MemoryStream())\n{\n    Serializer.Serialize(memoryStream, obj);\n    data = memoryStream.ToArray();\n}\n</code></pre>\n\n<p>Protobuf-net:<br>\n<code>26, 3, 18, 1, 104, 8, 13</code></p>\n\n<p>With github.com/golang/protobuf/proto:<br>\n<code>8, 13, 26, 3, 18, 1, 104</code></p>\n\n<p>Note the last two bytes in protobuf-net are the first two in golang. </p>\n\n<p>So, am I doing something wrong, or is there a bug in one of the two protobuffer libraries? Or maybe in the go protogen? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 71, "user_id": 4017042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d162c3f29d09071e5008ff5cf0a5de99?s=128&d=identicon&r=PG&f=1", "display_name": "user185578", "link": "https://stackoverflow.com/users/4017042/user185578"}, "edited": false, "score": 0, "creation_date": 1439337029, "post_id": 31953818, "comment_id": 51816855, "body": "This thread from a while back seems to be what you&#39;re looking for.   <a href=\"http://stackoverflow.com/questions/8307478/go-how-to-find-out-element-position-in-slice\" title=\"go how to find out element position in slice\">stackoverflow.com/questions/8307478/&hellip;</a>"}, {"owner": {"reputation": 707, "user_id": 597739, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6335f2042bbd5c17593272fdba2ef813?s=128&d=identicon&r=PG", "display_name": "onlinespending", "link": "https://stackoverflow.com/users/597739/onlinespending"}, "reply_to_user": {"reputation": 71, "user_id": 4017042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d162c3f29d09071e5008ff5cf0a5de99?s=128&d=identicon&r=PG&f=1", "display_name": "user185578", "link": "https://stackoverflow.com/users/4017042/user185578"}, "edited": false, "score": 0, "creation_date": 1439337084, "post_id": 31953818, "comment_id": 51816868, "body": "I figure I could actually go with the 3rd option of maintaining a map[string]int, and creating the mirrored []string array in runtime, so that I wouldn&#39;t be as prone to errors mirroring them manually, and it&#39;d be more performant than iterating over the array to determine the index."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 4, "last_activity_date": 1439337371, "creation_date": 1439337371, "answer_id": 31953900, "question_id": 31953818, "link": "https://stackoverflow.com/questions/31953818/get-index-of-element-from-array-slice-or-key-of-value-from-map-in-go/31953900#31953900", "title": "Get index of element from array / slice or key of value from map in Go?", "body": "<p>In both cases you should just use the built in range function.</p>\n\n<pre><code>for k, v := range MyData {\n}\n\n\nfor i, v := range ThisArray {\n}\n\n\nfor i, _ := range ThisArrayIndexOnly {\n    value := ThisArrayIndexOnly[i]\n}\n</code></pre>\n\n<p>You can build helper functions or whatever you like on top of this but <code>range</code> is fundamentally the mechanism available for accessing that data. If you want an \"indexof\" function it would be</p>\n\n<pre><code>for i, v := range ArrayPassedIntoFunction {\n     if v == ValuePassedIntoFunction {\n          return i\n     }\n}\nreturn -1\n</code></pre>\n\n<p>To get the value, you of course would just do <code>MyArray[i]</code> including a bounds check or whatever. Note the pseudo code above is written in a style that indicates it's an array but virtually the same code will work for a map, I would just typically use the var name <code>k</code> instead of <code>i</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 151, "user_id": 4956493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a90dbe17f160d757d4c7eae2cf68ccc3?s=128&d=identicon&r=PG", "display_name": "yosher lutski", "link": "https://stackoverflow.com/users/4956493/yosher-lutski"}, "edited": false, "score": 0, "creation_date": 1594229528, "post_id": 31954257, "comment_id": 111056036, "body": "This is an old question and I agree that the author didn&#39;t request such functionality, but once you start removing objects all the indexes scramble and you have to re-assign everything."}], "tags": [], "owner": {"reputation": 707, "user_id": 597739, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6335f2042bbd5c17593272fdba2ef813?s=128&d=identicon&r=PG", "display_name": "onlinespending", "link": "https://stackoverflow.com/users/597739/onlinespending"}, "is_accepted": true, "score": 1, "last_activity_date": 1439340088, "creation_date": 1439340088, "answer_id": 31954257, "question_id": 31953818, "link": "https://stackoverflow.com/questions/31953818/get-index-of-element-from-array-slice-or-key-of-value-from-map-in-go/31954257#31954257", "title": "Get index of element from array / slice or key of value from map in Go?", "body": "<p>Here's a solution that I mentioned earlier, which works well for static slices (which is my use case). Iterating over the slice every time I want the index of a value adds unnecessary delay, especially since my data is static during runtime. This just creates a struct which initializes the slice and creates the corresponding inverse map. And then I would use the GetKey and GetVal methods to get either the string 'key' by providing the int 'value', or get the int 'value' by providing the string 'key'. Perhaps there's already a way to get the key of a particular value of a map in Go.</p>\n\n<pre><code>type MyData struct {\n    dataslice []string\n    datamap map[string]int\n}\n\nfunc NewMyData() *MyData {\n    m := new(MyData)\n    m.dataslice= []string {\n        \"string1\",\n        \"string2\",\n        \"string3\",\n    }\n    m.datamap = make(map[string]int)\n    for x := range m.dataslice {\n        m.datamap[m.dataslice[x]] = x\n    }\n    return m\n}\n\nfunc (m *MyData) GetKey(x int) string {\n    return m.dataslice[x]\n}\n\nfunc (m *MyData) GetVal(x string) int {\n    return m.datamap[x]\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 841, "user_id": 1274890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36bb1f2b6bd55ffb4ec3524b0e00d23f?s=128&d=identicon&r=PG", "display_name": "R Sun", "link": "https://stackoverflow.com/users/1274890/r-sun"}, "edited": false, "score": 0, "creation_date": 1569089127, "post_id": 41072374, "comment_id": 102485935, "body": "<code>(int)</code> brackets are not necessary. Webstorm warns with &#39;Reduntant parentheses&#39;"}], "tags": [], "owner": {"reputation": 31, "user_id": 5060423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5e6a5cf9562fbc7e1c00b5ef992c8d6?s=128&d=identicon&r=PG&f=1", "display_name": "moehandi", "link": "https://stackoverflow.com/users/5060423/moehandi"}, "is_accepted": false, "score": 3, "last_activity_date": 1481346249, "creation_date": 1481346249, "answer_id": 41072374, "question_id": 31953818, "link": "https://stackoverflow.com/questions/31953818/get-index-of-element-from-array-slice-or-key-of-value-from-map-in-go/41072374#41072374", "title": "Get index of element from array / slice or key of value from map in Go?", "body": "<p>Assume you want getting index of word in the data of array</p>\n\n<pre><code>data := [...] {\"one\",\"two\",\"three\"}\n</code></pre>\n\n<p>or fixed length array</p>\n\n<pre><code>data := [3] {\"one\",\"two\",\"three\"}\n</code></pre>\n\n<p>create function </p>\n\n<pre><code>func indexOf(word string, data []string) (int) {\n    for k, v := range data {\n        if word == v {\n            return k\n        }\n    }\n    return -1\n}\n</code></pre>\n\n<p>to get value from function above, to match the type, pass the array with <code>array[:]</code> like below</p>\n\n<pre><code>fmt.Println(indexOf(\"two\", data[:]))\n</code></pre>\n"}], "owner": {"reputation": 707, "user_id": 597739, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6335f2042bbd5c17593272fdba2ef813?s=128&d=identicon&r=PG", "display_name": "onlinespending", "link": "https://stackoverflow.com/users/597739/onlinespending"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24721, "favorite_count": 0, "accepted_answer_id": 31954257, "answer_count": 3, "score": 3, "last_activity_date": 1481346249, "creation_date": 1439336828, "last_edit_date": 1439413672, "question_id": 31953818, "link": "https://stackoverflow.com/questions/31953818/get-index-of-element-from-array-slice-or-key-of-value-from-map-in-go", "title": "Get index of element from array / slice or key of value from map in Go?", "body": "<p>I have an enumerated list of strings (which are constant, e.g. a list of countries), that I'd like to be able to get the string when providing the enumerated int value, and vice-versa be able to get the enumerated int value when providing the string. This is in order to translate between the two for database transactions.</p>\n\n<pre><code>var MyData = [...]string {\n  \"string1\", // index 0\n  \"string2\", // index 1\n  \"string3\", // index 2  \n}\n</code></pre>\n\n<p>That's easy for a language like python, where one can just do something like MyData[1] to get \"string2\" and MyData.index(\"string2\") to get 1.</p>\n\n<p>A few possible solutions would be to</p>\n\n<ul>\n<li>write my own function to get the index by iterating over the array / slice</li>\n<li>sort the array / slice and use a search function to return index (though this doesn't allow for an unsorted sequence, which is what I'd prefer)</li>\n<li>maintain a map and an array that mirror each other, which is prone to errors.</li>\n</ul>\n\n<p><strong>Speaking of maps, can one access the key of a particular value?</strong> Then I could simply have a map like the following, and be able to get the string key when providing the int value.</p>\n\n<pre><code>var MyData = map[string]int {\n  \"string1\": 0,\n  \"string2\": 1,\n  \"string3\": 2,\n}\n</code></pre>\n\n<hr>\n\n<p><strong>UPDATE:</strong> Before I accept my answer, I want to explain the problem more thoroughly, which I know must be fairly common. I basically have a set of strings that are constant (such as a list of countries) each with an associated integer value. In my database I simply store the integer to conserve space, since there are millions of entries. But when I display an entry from the database I need to display the string value for it to be readable to a user. A simple array will do for that. However, I also need to add entries to the database (such as a new person and their country of residence) and in this scenario need to translate from the country string which is entered in a form to that integer value. Again, this is just an example use case, but <strong>the goal remains the same. I need a table that can translate in both directions between a string value and an enumerated int value.</strong> The most obvious thing to do is to maintain an array (for the int to string translation) and a map (for the string to int translation). I'd prefer not to manually maintain both variables, since this is prone to errors. So my solution below is to maintain just a single array, and have the constructor method automatically build the map at runtime when the program is first run. This has the advantage of not needing to iterate over the entire array when I fetch the integer value based on the string (which was the other proposed solution).</p>\n"}, {"tags": ["database", "go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1439332148, "post_id": 31952911, "comment_id": 51815363, "body": "The part where i didn&#39;t get it why isn&#39;t there something like <code>MaxConns</code> which is <code>MaxIdleConns + MaxOpenConns</code>. Why would a developer have to arrange how many open and idle there can be? Edited the question for more understability."}, {"owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1439333737, "post_id": 31952911, "comment_id": 51815868, "body": "Because you could desire to have <code>MaxIdleConns</code> be low, but your <code>MaxOpenConns</code> to be high. This means that your application can open as many connections as it needs, while it needs them, but consumes minimal resources when it doesn&#39;t: suitable for a bursty load."}, {"owner": {"reputation": 3071, "user_id": 2979435, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/c3fac4fcf2b4ae7f3f5a96164b34958e?s=128&d=identicon&r=PG", "display_name": "deFreitas", "link": "https://stackoverflow.com/users/2979435/defreitas"}, "edited": false, "score": 0, "creation_date": 1503786615, "post_id": 31952911, "comment_id": 78759335, "body": "What is considered a idle connection in this case?"}], "tags": [], "owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "is_accepted": true, "score": 12, "last_activity_date": 1439334362, "last_edit_date": 1439334362, "creation_date": 1439331293, "answer_id": 31952911, "question_id": 31952791, "link": "https://stackoverflow.com/questions/31952791/setmaxopenconns-and-setmaxidleconns/31952911#31952911", "title": "SetMaxOpenConns and SetMaxIdleConns", "body": "<p>The db pool may contain 0 or more idle connections to the database. These were connections that were made, used, and rather than closed, were kept around for future use. The number of these we can keep around is <code>MaxIdleConns</code>.</p>\n\n<p>When you request one of these idle connections, it becomes an Open connection, available for you to use. The number of these you can use is <code>MaxOpenConns</code>.</p>\n\n<p>Now, there is no point in ever having any more idle connections than the maximum allowed open connections, because if you <em>could</em> instantanously grab all the allowed open connections, the remain idle connections would always remain idle. It's like having a bridge with four lanes, but only ever allowing three vehicles to drive across it at once.</p>\n\n<p>Therefore, we would like to ensure that</p>\n\n<pre><code>MaxIdleConns &lt;= MaxOpenConns\n</code></pre>\n\n<p>The functions are written to preserve this invariant by reducing <code>MaxIdleConns</code> whenever it exceeds <code>MaxOpenConns</code>. Note that the documentation says, only <code>MaxIdleConns</code> is ever reduced to match <code>MaxOpenConns</code>, the latter is never true.</p>\n\n<p>To answer the question of why a developer might want to adjust these separately: consider the case of an application that is usually quiet, but occasionally needs to open a large number of connections. You may wish to specify a large <code>MaxOpenConns</code>, but a very small <code>MaxIdleConns</code>, to ensure that your application can open as many connections in requires whenever it needs to, but releases these resources quickly, freeing up memory both for itself <em>and</em> the database. Keeping an idle connection alive is not free, and it's usually done because you want to turn it into usable connection soon.</p>\n\n<p>So the reason there are two numbers here is that these are two parameters that you might have a good reason to vary individually. Of course, the semantics of the API mean that if you don't care about setting both these values, you can just set the one that you care about, which is probably <code>MaxOpenConns</code></p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7067, "favorite_count": 5, "accepted_answer_id": 31952911, "answer_count": 1, "score": 10, "last_activity_date": 1439334362, "creation_date": 1439330788, "last_edit_date": 1439332247, "question_id": 31952791, "link": "https://stackoverflow.com/questions/31952791/setmaxopenconns-and-setmaxidleconns", "title": "SetMaxOpenConns and SetMaxIdleConns", "body": "<p>Why are there <code>SetMaxOpenConns</code> and <code>SetMaxIdleConns</code>. In the <a href=\"http://golang.org/pkg/database/sql/#DB.SetMaxOpenConns\" rel=\"noreferrer\">doc</a></p>\n\n<p><strong>SetMaxIdleConns</strong></p>\n\n<blockquote>\n  <p>SetMaxIdleConns sets the maximum number of connections in the idle\n  connection pool.</p>\n  \n  <p>If MaxOpenConns is greater than 0 but less than the new MaxIdleConns\n  then the new MaxIdleConns will be reduced to match the MaxOpenConns\n  limit</p>\n  \n  <p>If n &lt;= 0, no idle connections are retained.</p>\n</blockquote>\n\n<p><strong>SetMaxOpenConns</strong></p>\n\n<blockquote>\n  <p>SetMaxOpenConns sets the maximum number of open connections to the\n  database.</p>\n  \n  <p>If MaxIdleConns is greater than 0 and the new MaxOpenConns is less\n  than MaxIdleConns, then MaxIdleConns will be reduced to match the new\n  MaxOpenConns limit</p>\n  \n  <p>If n &lt;= 0, then there is no limit on the number of open connections.\n  The default is 0 (unlimited).</p>\n</blockquote>\n\n<p>Why have both functions but not a single function to adjust both idle and open connections like <code>MaxConns</code> which is <code>MaxIdleConns + MaxOpenConns</code>. Why would a developer have to arrange how many open and idle conns there can be instead of defining the total pool?</p>\n"}, {"tags": ["session", "go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 6, "last_activity_date": 1439345358, "last_edit_date": 1439345358, "creation_date": 1439344925, "answer_id": 31954851, "question_id": 31952033, "link": "https://stackoverflow.com/questions/31952033/gorilla-session-package-confusion/31954851#31954851", "title": "Gorilla session package confusion", "body": "<p>It entirely depends on which storage back-end you use.</p>\n\n<p>The <a href=\"http://www.gorillatoolkit.org/pkg/sessions\" rel=\"noreferrer\">gorilla/sessions</a> package has built-in cookie &amp; filesystem based stores. There is no memory-based store, which is roughly what PHP's <code>$_SESSION</code> is.</p>\n\n<p>My recommendation:</p>\n\n<ul>\n<li>Use the built-in cookie store, which uses signed cookies. It is well suited for most purposes and is the easiest to implement.</li>\n<li>If you have a need for server-side sessions (i.e. storing large values in the session), <a href=\"https://github.com/gorilla/sessions#store-implementations\" rel=\"noreferrer\">pick from the available implementations</a> - Redis, BoltDB, mySQL, Postgres, etc.</li>\n</ul>\n\n<p>I have first-hand experience with the Redis backed store (<a href=\"https://github.com/boj/redistore\" rel=\"noreferrer\">redistore</a>), which has been great. The BoltDB (a file-based key store) and Postgres stores are also solid if you have a preference for those.</p>\n\n<blockquote>\n  <p>I want the users who didn't click on the \"remember me\" button on the login form to have their session erased after closing their browser, whereas everyone else will have a cookie associated with them. So would Gorilla sessions be able to handle both scenarios or should I use something else in this case?</p>\n</blockquote>\n\n<p>Note that all implementations require a \"cookie\" - it's just whether the cookie is the self-contained store, or whether it just holds an identifier referring to a row/value in the back-end store.</p>\n\n<p>You can set \"session cookies\" (i.e. last only as long as the tab/browser session) by setting <code>session.Options.MaxAge = 0</code> as per <a href=\"https://github.com/gorilla/sessions/blob/master/sessions.go#L24-L32\" rel=\"noreferrer\">this part of the gorilla/sessions docs</a>.</p>\n\n<p>e.g.</p>\n\n<pre><code>func MyHandler(w http.ResponseWriter, r *http.Request) {\n    session, err := store.Get(r, \"session-name\")\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    // Add your logic to check the r.FormValue for your remember_me checkbox.\n\n    // Temporary session\n    session.Options.MaxAge = 0\n\n    // Set some session values.\n    session.Values[\"user\"] = someUser\n    // Save it before we write to the response/return from the handler.\n    session.Save(r, w)\n}\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1147, "favorite_count": 0, "accepted_answer_id": 31954851, "answer_count": 1, "score": 0, "last_activity_date": 1495128306, "creation_date": 1439327541, "question_id": 31952033, "link": "https://stackoverflow.com/questions/31952033/gorilla-session-package-confusion", "title": "Gorilla session package confusion", "body": "<p>Coming from a PHP background I'm a little confuse about Gorilla sessions package.</p>\n\n<p>Does Gorilla act similar to <code>$_SESSION['name']</code> or does it act similar to <code>$_COOKIE['name']</code> from PHP? </p>\n\n<p>I'm trying to use both ways to create a user session for my Go web application, but I'm not sure if Gorilla sessions will be a good package to use. I want the users who didn't click on the \"remember me\" button on the login form to have their session erased after closing their browser, whereas everyone else will have a cookie associated with them. So would Gorilla sessions be able to handle both scenarios or should I use something else in this case?</p>\n"}, {"tags": ["go", "neo4j", "cypher", "neoism"], "comments": [{"owner": {"reputation": 35779, "user_id": 69684, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/0a455056ceebeeefc447d5ba29574e3b?s=128&d=identicon&r=PG", "display_name": "MicTech", "link": "https://stackoverflow.com/users/69684/mictech"}, "edited": false, "score": 0, "creation_date": 1439312097, "post_id": 31947316, "comment_id": 51804894, "body": "How do you create new nodes? Which version of Neo4j do you use?"}], "answers": [{"tags": [], "owner": {"reputation": 57206, "user_id": 974731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f54ba41697411b238379022f9a6df56?s=128&d=identicon&r=PG", "display_name": "cybersam", "link": "https://stackoverflow.com/users/974731/cybersam"}, "is_accepted": false, "score": 1, "last_activity_date": 1439316050, "creation_date": 1439316050, "answer_id": 31948823, "question_id": 31947316, "link": "https://stackoverflow.com/questions/31947316/uniqueness-constraint-does-not-prevent-from-adding-same-data-on-neo4j/31948823#31948823", "title": "Uniqueness constraint does not prevent from adding same data on Neo4j", "body": "<p>A uniqueness constraint is associated with a <strong>label</strong> and <strong>property</strong> pair. All of your uniqueness constraints involve the <code>User</code> label, so neo4j will just enforce uniqueness on <code>User</code> nodes.</p>\n\n<p>If you think it is appropriate, you can modify your uniqueness constraints so that they involve some other label (say, <code>Base</code>), and assign that label to <em>all</em> your nodes. neo4j allows a node to have multiple labels, so you can keep using the <code>User</code> label as well (but not as part of a constraint).</p>\n"}, {"tags": [], "owner": {"reputation": 3664, "user_id": 2670308, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/dbkc6.jpg?s=128&g=1", "display_name": "marc_aragones", "link": "https://stackoverflow.com/users/2670308/marc-aragones"}, "is_accepted": true, "score": 1, "last_activity_date": 1439393060, "creation_date": 1439393060, "answer_id": 31969468, "question_id": 31947316, "link": "https://stackoverflow.com/questions/31947316/uniqueness-constraint-does-not-prevent-from-adding-same-data-on-neo4j/31969468#31969468", "title": "Uniqueness constraint does not prevent from adding same data on Neo4j", "body": "<p>I finally solve it with a raw query with <code>neoism</code>. The original code created a node with no label and it was added later. At this moment, the constraint didn't allow the code to add the label but the node was already created.</p>\n\n<p>The solution is running a query that <strong>adds the label at the same</strong> time it creates the node:</p>\n\n<pre><code>cq := neoism.CypherQuery {\n    Statement: `CREATE (n:User {id:{id}, username:{username},\n        displayname:{displayname}, email:{email},\n        token:{token}}) RETURN n`,\n    Parameters: neoism.Props {\n        \"id\": user.Id,\n        \"username\" : user.Username,\n        \"displayname\" : user.Displayname,\n        \"email\" : user.Email,\n        \"token\" : user.Token,\n    },\n}\nerr := db.Cypher(&amp;cq)\n</code></pre>\n"}], "owner": {"reputation": 3664, "user_id": 2670308, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/dbkc6.jpg?s=128&g=1", "display_name": "marc_aragones", "link": "https://stackoverflow.com/users/2670308/marc-aragones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 31969468, "answer_count": 2, "score": 0, "last_activity_date": 1439393060, "creation_date": 1439310958, "last_edit_date": 1439318196, "question_id": 31947316, "link": "https://stackoverflow.com/questions/31947316/uniqueness-constraint-does-not-prevent-from-adding-same-data-on-neo4j", "title": "Uniqueness constraint does not prevent from adding same data on Neo4j", "body": "<p>I want to create a <code>neo4j</code> database with users. I want the following properties to be unique:</p>\n\n<ul>\n<li>username</li>\n<li>email</li>\n<li>token</li>\n</ul>\n\n<p>What I've tried:</p>\n\n<pre><code>CREATE CONSTRAINT ON (user:User) ASSERT user.username IS UNIQUE\nCREATE CONSTRAINT ON (user:User) ASSERT user.email IS UNIQUE\nCREATE CONSTRAINT ON (user:User) ASSERT user.token IS UNIQUE\n</code></pre>\n\n<p>However, this does not prevent me from creating new nodes with repeated email, username or token. The image shows 5 nodes, all with the same data but only the first one is a User. I don't want this, I want <code>neo4j</code> to return an error.</p>\n\n<p>Is it possible?</p>\n\n<p>Thanks</p>\n\n<p><a href=\"https://i.stack.imgur.com/E09Rn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/E09Rn.png\" alt=\"graph\"></a></p>\n\n<p><strong>EDIT:</strong></p>\n\n<p><code>Neo4j</code> version: 2.2.3</p>\n\n<p>And I use <code>neoism</code> for <code>Go</code> to insert data:</p>\n\n<pre><code>n, err := db.CreateNode(neoism.Props{\"id\": user.Id, \"username\" : user.Username,\n                                     \"displayname\" : user.Displayname,\n                                     \"email\" : user.Email, \"token\" : user.Token})\nif err != nil {\n    return ERROR_NEO4J\n}\n\nn.AddLabel(\"User\")\n</code></pre>\n"}, {"tags": ["postgresql", "go", "postgresql-9.4"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1439308488, "post_id": 31946344, "comment_id": 51802761, "body": "You don&#39;t have any byte slices... Your output says <code>[]uint8</code> which is a small unsigned integer. A byte slice would be <code>[]byte</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1439308651, "post_id": 31946344, "comment_id": 51802867, "body": "@evanmcdonnal...ahh, yes. Thx! I have updated the post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1439308946, "post_id": 31946344, "comment_id": 51803038, "body": "@evanmcdonnal: <a href=\"http://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">byte is just an alias for uint8</a>, example: <a href=\"http://play.golang.org/p/2_VGNX6DmV\" rel=\"nofollow noreferrer\">play.golang.org/p/2_VGNX6DmV</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439310138, "post_id": 31946344, "comment_id": 51803736, "body": "@JimB ah I see <code>[49 46 51 50 53 48] = &quot;1.3250&quot;</code>. Well that makes sense."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1439308786, "post_id": 31946568, "comment_id": 51802947, "body": "It just seems like a bad solution to turn it into a string b/c of a shortcoming in Go."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 5, "creation_date": 1439310134, "post_id": 31946568, "comment_id": 51803729, "body": "@kristen I wouldn&#39;t consider it a shortcoming of Go. None of those larger/higher precision numeric types are natives in any language. It&#39;s the Postgresql driver&#39;s author who made that decision. If they wanted to do something more sensible they could have provided a couple of types in Go to host their types that don&#39;t have compatible natives."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 7, "creation_date": 1439315211, "post_id": 31946568, "comment_id": 51806679, "body": "<code>big.Float</code> is a binary float and not a good fit to represent numbers with a fixed decimal precision."}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 7, "creation_date": 1439338022, "post_id": 31946568, "comment_id": 51817097, "body": "Actually, PostgreSQL sends <code>numeric</code> and <code>decimal</code> as text on the wire unless you use the binary protocol options.  So the Go driver just isn&#39;t converting what PostgreSQL sends into anything else, because there&#39;s no appropriate native type. It is doing the correct thing here and should only do something else if/when Go gets a native arbitrary-precision decimal floating point data type."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 13, "last_activity_date": 1439308649, "creation_date": 1439308649, "answer_id": 31946568, "question_id": 31946344, "link": "https://stackoverflow.com/questions/31946344/why-does-go-treat-a-postgresql-numeric-decimal-columns-as-uint8/31946568#31946568", "title": "Why does Go treat a Postgresql numeric &amp; decimal columns as []uint8?", "body": "<p>Because there is no better solution. (At least wasn't until <a href=\"http://tip.golang.org/pkg/math/big/#Float\">Go 1.5's <code>big.Float</code></a>). What other alternatives are there?</p>\n\n<ul>\n<li><p>Turn it into an integer. Obviously a bad solution since numerics can have a fractional part.</p></li>\n<li><p>Turn it into a <code>float64</code>. This is <em>evil</em>. Especially if you're working with money (where types like <code>numeric</code> and <code>decimal</code> have the most usage).</p></li>\n</ul>\n\n<p>This particular database driver chooses instead to return a string containing the number - to let <em>you</em> decide, whether to lose some precision (by converting it into a <code>float64</code> with <code>strconv</code>) or use a decimal/precise number library (like <code>gmp</code> or <code>math/big</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 841, "user_id": 5505164, "user_type": "registered", "profile_image": "https://graph.facebook.com/1483647971940832/picture?type=large", "display_name": "Roman Shishkin", "link": "https://stackoverflow.com/users/5505164/roman-shishkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1552866606, "creation_date": 1552866606, "answer_id": 55213096, "question_id": 31946344, "link": "https://stackoverflow.com/questions/31946344/why-does-go-treat-a-postgresql-numeric-decimal-columns-as-uint8/55213096#55213096", "title": "Why does Go treat a Postgresql numeric &amp; decimal columns as []uint8?", "body": "<p>Here is an issue with the answer to that questions from the developers: <a href=\"https://github.com/lib/pq/issues/648\" rel=\"nofollow noreferrer\">https://github.com/lib/pq/issues/648</a></p>\n\n<blockquote>\n  <p>It's not safe to use a float64 type for a decimal because floats can't represent all decimals. For example, decimals support exponents much larger than floats, and the coefficients of floats, when converted to their base-2 representation, will change. It is trivial in go to convert a string to a float, so we are going to keep this behavior.</p>\n</blockquote>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7405, "favorite_count": 1, "accepted_answer_id": 31946568, "answer_count": 2, "score": 8, "last_activity_date": 1552866606, "creation_date": 1439308000, "last_edit_date": 1439308621, "question_id": 31946344, "link": "https://stackoverflow.com/questions/31946344/why-does-go-treat-a-postgresql-numeric-decimal-columns-as-uint8", "title": "Why does Go treat a Postgresql numeric &amp; decimal columns as []uint8?", "body": "<p>I'm not sure if this is a bug in Go or just something I don't understand. I have the following:</p>\n\n<pre><code>package main\n\nimport (\n  \"database/sql\"\n  \"log\"\n  \"reflect\"\n\n  _ \"github.com/lib/pq\"\n)\n\nfunc main() {\n  Db, err := sql.Open(\"postgres\", \"user=yoitsme password=openupitsme host=x.x.x.x dbname=mydb\")\n  if err != nil {\n    log.Println(err)\n  }\n  rows, err := Db.Query(\"SELECT 1.3250::numeric, 8.548::decimal, 908.234::float, 1234::integer\")\n  defer rows.Close()\n  for rows.Next() {\n    var col1, col2, col3, col4 interface{}\n    if err := rows.Scan(&amp;col1, &amp;col2, &amp;col3, &amp;col4); err != nil {\n      log.Println(err)\n    }\n    log.Println(col1, reflect.TypeOf(col1))\n    log.Println(col2, reflect.TypeOf(col2))\n    log.Println(col3, reflect.TypeOf(col3))\n    log.Println(col4, reflect.TypeOf(col4))\n  }\n  if err = rows.Err(); err != nil {\n    log.Println(err)\n  }\n\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>2015/08/11 09:35:47 [49 46 51 50 53 48] []uint8\n2015/08/11 09:35:47 [56 46 53 52 56] []uint8\n2015/08/11 09:35:47 908.234 float64\n2015/08/11 09:35:47 1234 int64\n</code></pre>\n\n<p>So, I get []uint8 (e.g. a string) for the first two columns that are actually numbers. The last 2 columns are as expected. According to Postgresql <a href=\"http://www.postgresql.org/docs/9.3/static/datatype-numeric.html\" rel=\"noreferrer\">Numeric &amp; Decimal types are part of the SQL standard</a>. So, why doesn't Go follow the SQL standard in their database/sql package? Is it because Go doesn't have a builtin \"Decimal\" type? It seems wrong that the database/sql package turned a number into a string because of a shortcoming in the language....                                                                                          </p>\n"}, {"tags": ["regex", "http", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439307702, "post_id": 31945875, "comment_id": 51802283, "body": "What do you mean by &quot;handle regexes&quot;? Also, it seems like what you want is essentially <a href=\"http://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer</code></a> with a custom <a href=\"http://golang.org/pkg/net/http/#FileSystem\" rel=\"nofollow noreferrer\"><code>http.FileSystem</code></a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439308101, "post_id": 31945875, "comment_id": 51802524, "body": "It sounds like you&#39;re describing a <code>muxer</code> or a <code>router</code>, of which there are <i>many</i> already written."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1439307357, "creation_date": 1439307357, "answer_id": 31946118, "question_id": 31945875, "link": "https://stackoverflow.com/questions/31945875/go-http-server-handling-routes-with-map/31946118#31946118", "title": "Go HTTP Server: Handling Routes with Map", "body": "<p>Make your map an <a href=\"http://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\"><code>http.Handler</code></a>:</p>\n\n<pre><code>type httpFiles struct {\n    fileMap map[string][]byte\n}\n\nfunc (hf httpFiles) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    path := r.URL.Path\n    w.Write(hf.fileMap[path])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "is_accepted": false, "score": 2, "last_activity_date": 1439307800, "last_edit_date": 1439307800, "creation_date": 1439307461, "answer_id": 31946142, "question_id": 31945875, "link": "https://stackoverflow.com/questions/31945875/go-http-server-handling-routes-with-map/31946142#31946142", "title": "Go HTTP Server: Handling Routes with Map", "body": "<p>If you're open to not writing it yourself, something small quick and out of the box - look at gorilla mux. Their toolkit lets you choose the components you want, so just add their mux if all you want is routing with regex.</p>\n\n<p>I found it particularly helpful for obtaining variable from routes.</p>\n\n<pre><code>r.HandleFunc(\"/articles/{category}/{id:[0-9]+}\", ArticleHandler)\n...\n\nvars := mux.Vars(request)\ncategory := vars[\"category\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 1, "last_activity_date": 1439317007, "last_edit_date": 1439317007, "creation_date": 1439310407, "answer_id": 31947142, "question_id": 31945875, "link": "https://stackoverflow.com/questions/31945875/go-http-server-handling-routes-with-map/31947142#31947142", "title": "Go HTTP Server: Handling Routes with Map", "body": "<p>I recommend package <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow\">httprouter</a> being the fastest go router around. Go's built-in mux is incomplete and slow without an easy way to capture URL parameters.</p>\n\n<p>Also, you might consider making each route a struct so it's easier to handle when you have several routes.</p>\n\n<p>This code captures URL parameter, compare it to the keyword of the map and print the string of code chunk to the console.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    mux \"github.com/julienschmidt/httprouter\"\n)\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    Handle      mux.Handle\n\n}\n\nvar codeChunk = map[string]string{ \"someUrlPath\" : \"func printHello(){\\n\\tfmt.Println(\\\"Hello\\\")\\n}\" }\n\nvar route = Route{\n    \"MyHandler\",\n    \"GET\",\n    \"/:keywordUrl\",\n    MyHandler,\n}\n\nfunc MyHandler(w http.ResponseWriter, r *http.Request, ps mux.Params) {\n\n    // Handle route \"/:keywordUrl\"\n    w.WriteHeader(http.StatusOK)\n\n    // get the parameter from the URL\n    path := ps.ByName(\"keywordUrl\")\n\n    for key, value := range codeChunk {\n        // Compare the parameter to the key of the map\n        if key != \"\" &amp;&amp; path == key {\n            // do something\n            fmt.Println(value)\n        }\n    }\n}\n\nfunc main() {\n    router := mux.New()\n    router.Handle(route.Method, route.Pattern, route.Handle)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n\n    // browse to http://localhost:8080/someUrlPath to see \n    // the map's string value being printed.\n}\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 1810150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KYgBt.jpg?s=128&g=1", "display_name": "Noah Stebbins", "link": "https://stackoverflow.com/users/1810150/noah-stebbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 997, "favorite_count": 2, "answer_count": 3, "score": 2, "last_activity_date": 1439317007, "creation_date": 1439306674, "question_id": 31945875, "link": "https://stackoverflow.com/questions/31945875/go-http-server-handling-routes-with-map", "title": "Go HTTP Server: Handling Routes with Map", "body": "<p>I have a <code>map</code> in Go with routes (e.g. <code>/static/stylesheets/main.css</code>) as keys and the corresponding code as the value (effectively, a giant string). I was just wondering, is there an easy way in Go by which I can create an HTTP server, which always check an incoming request against the <code>map</code> and renders the value associated with the matched key, if the key exists?</p>\n\n<p>So far, I have...</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>func main() {\n    var m = generateMap()\n    http.handleFunc(\"/\", renderContent);\n}\n\nfunc renderContent(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, m[path]); \n}\n</code></pre>\n\n<p>I know this code is far from done, but hopefully it clarifies my objective. How would I pass in the <code>path</code> and <code>m</code> into <code>renderContent</code> as well as how do I have <code>handleFunc</code> actually handle regexes (essentially, any path)?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6577, "user_id": 424124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7a29d3d0553d3965a7b923b4fb42d7a9?s=128&d=identicon&r=PG", "display_name": "tidwall", "link": "https://stackoverflow.com/users/424124/tidwall"}, "edited": false, "score": 3, "creation_date": 1439306353, "post_id": 31945554, "comment_id": 51801348, "body": "I don&#39;t think that this issue occurs when the app is running on a single thread. go1.4 and earlier ran as GOMAXPROCS=1 by default. 1.5+ has been changed to GOMAXPROCS=NumCPU. This would explain the bug&#39;s sudden appearance."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6577, "user_id": 424124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7a29d3d0553d3965a7b923b4fb42d7a9?s=128&d=identicon&r=PG", "display_name": "tidwall", "link": "https://stackoverflow.com/users/424124/tidwall"}, "edited": false, "score": 4, "creation_date": 1439306562, "post_id": 31945554, "comment_id": 51801494, "body": "@tidwall: no, it was only by chance that the scheduler let the last print statement through. You can test this easily by running GOMAXPROCS=1 with go1.5, which shows the same broken output (at least on my system. The result is technically non-deterministic, since there&#39;s no defined order of goroutine execution)."}, {"owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "edited": false, "score": 2, "creation_date": 1439306860, "post_id": 31945554, "comment_id": 51801709, "body": "@JimB same for me, setting GOMAXPROCS to 1 will still output the same broken output."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "edited": false, "score": 3, "creation_date": 1439307035, "post_id": 31945554, "comment_id": 51801841, "body": "@alexsmn: yes, exactly. It&#39;s not necessarily a change in GOMAXPROCS, it&#39;s a change in the runtime that is causing the execution order of goroutines to differ slightly. The original code was never correct."}, {"owner": {"reputation": 6577, "user_id": 424124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7a29d3d0553d3965a7b923b4fb42d7a9?s=128&d=identicon&r=PG", "display_name": "tidwall", "link": "https://stackoverflow.com/users/424124/tidwall"}, "edited": false, "score": 3, "creation_date": 1439307470, "post_id": 31945554, "comment_id": 51802130, "body": "@JimB: indeed I&#39;m wrong. I&#39;m getting the same results as you are. There&#39;s a clear bug in the code; where the chan msg is being received and the WaitGroup is being released allowing main to return, prior to the final fmt.Println."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1439306228, "last_edit_date": 1439306228, "creation_date": 1439305803, "answer_id": 31945554, "question_id": 31945315, "link": "https://stackoverflow.com/questions/31945315/goroutines-channels-with-waitgroup-unexpected-output/31945554#31945554", "title": "GoRoutines, Channels with WaitGroup unexpected output", "body": "<p>Your code has always had this bug. It was only by chance that your program managed to print all messages before main exited.</p>\n\n<p>To make this work correctly, I would invert where you have the <code>wg.Wait()</code> and the channel receives, so you can asynchronously close the channel. This way the receive operations are what is blocking <code>main</code>, and the channel is closed as soon as all send operations are done.</p>\n\n<pre><code>func main() {\n    ch := make(chan string)\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go test(ch, &amp;wg)\n    go test1(ch, &amp;wg)\n\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n\n    for txt := range ch {\n        fmt.Println(txt)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 31945554, "answer_count": 1, "score": 3, "last_activity_date": 1439307426, "creation_date": 1439305167, "last_edit_date": 1439307426, "question_id": 31945315, "link": "https://stackoverflow.com/questions/31945315/goroutines-channels-with-waitgroup-unexpected-output", "title": "GoRoutines, Channels with WaitGroup unexpected output", "body": "<p>I looked at some code that I've wrote a long time ago, when go1.3 was released(I might be wrong). <a href=\"http://play.golang.org/p/t-hMZjTBqQ\" rel=\"nofollow\">CODE HERE</a></p>\n\n<p>The below code used to work as expected, but now since I've update <code>go</code> to the current master version(go version devel +bd1efd5 Fri Jul 31 16:11:21 2015 +0000 darwin/amd64), the last output message <code>c &lt;- \"FUNC 1 DONE\"</code> is not printed, the code works as it should on <code>play.golang.org</code>. Did I do something wrong, or this is a bug?</p>\n\n<pre><code>package main\n\nimport (\"fmt\";\"sync\";\"time\")\n\nfunc test(c chan string, wg *sync.WaitGroup) {\n  defer wg.Done()\n  fmt.Println(\"EXEC FUNC 1\")\n  time.Sleep(3 * time.Second)\n  c &lt;- \"FUNC 1 DONE\"\n}\n\nfunc test1(c chan string, wg *sync.WaitGroup) {\n  defer wg.Done()\n  fmt.Println(\"EXEC FUNC 2\")\n  time.Sleep(2 * time.Second)\n  c &lt;- \"FUNC 2 DONE\"\n}\n\nfunc main() {\n  ch := make(chan string)\n\n  var wg sync.WaitGroup\n  wg.Add(2)\n\n  go test(ch, &amp;wg)\n  go test1(ch, &amp;wg)\n\n  go func(c chan string) {\n    for txt := range c {\n      fmt.Println(txt)\n    }\n  }(ch)\n\n  wg.Wait()\n}\n</code></pre>\n\n<p>UPDATE:</p>\n\n<p>I'm not saying that, the above is the best way of doing those types of work, but I don't see anything wrong with it.</p>\n\n<p>Also running it in <code>go version go1.4.2 darwin/amd64</code> will return the expected output.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1439304075, "post_id": 31944825, "comment_id": 51799630, "body": "<code>lanids = append(lanids, lanids_loaded...)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 1844, "user_id": 238074, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3fed50cc653f3ea8c50eb4c227237840?s=128&d=identicon&r=PG", "display_name": "Kevin Buchs", "link": "https://stackoverflow.com/users/238074/kevin-buchs"}, "edited": false, "score": 0, "creation_date": 1439314468, "post_id": 31944880, "comment_id": 51806253, "body": "@KevinBuchs yep gofmt. I recommend GoSublime if you use sublimetext or go-plus for atom or vim-go for well, vim."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 4, "last_activity_date": 1439304071, "creation_date": 1439304071, "answer_id": 31944880, "question_id": 31944825, "link": "https://stackoverflow.com/questions/31944825/compiler-error-appending-slice-to-slice/31944880#31944880", "title": "Compiler error appending slice to slice", "body": "<p>You need to use <code>...</code>:</p>\n\n<pre><code>lanids = append(lanids, lanids_loaded...)\n</code></pre>\n\n<p>Also, also please format your code :)</p>\n\n<p>You should also read <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow\">Slice Tricks</a> on the Wiki.</p>\n"}], "owner": {"reputation": 1844, "user_id": 238074, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3fed50cc653f3ea8c50eb4c227237840?s=128&d=identicon&r=PG", "display_name": "Kevin Buchs", "link": "https://stackoverflow.com/users/238074/kevin-buchs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 31944880, "answer_count": 1, "score": 0, "last_activity_date": 1439315830, "creation_date": 1439303906, "last_edit_date": 1439315830, "question_id": 31944825, "link": "https://stackoverflow.com/questions/31944825/compiler-error-appending-slice-to-slice", "title": "Compiler error appending slice to slice", "body": "<p>The Go compiler is complaining about my code to append a slice to a slice. Here are relevant excerpts:</p>\n\n<pre><code>type LanidEntry struct {\n    lanid   string\n    group   string\n    contact string\n}\n\nvar lanids []LanidEntry\n\nfunc load_file() (lanids_loaded []LanidEntry, errormsgs string) {\n    // ...\n}\n\nfunc Load() (lanids []LanidEntry, errormessages string) {\n    lanids_loaded, errormsgs := load_file(filename1, contact1)\n    lanids = append(lanids, lanids_loaded)\n    // ...\n}\n</code></pre>\n\n<p>The <code>append</code> line generates this compiler message:</p>\n\n<pre><code> src\\load_lanids\\load_lanids.go:50: cannot use lanids_loaded (type []LanidEntry) as type LanidEntry in append\n</code></pre>\n\n<p>I know that appending slices to slices works fine, based on an example in <a href=\"https://blog.golang.org/slices#TOC_10.\" rel=\"nofollow\">a Go Blog post</a>\nunder the section headed <strong>Append: The built-in function</strong>.</p>\n"}, {"tags": ["memory-leaks", "go"], "answers": [{"comments": [{"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439299878, "post_id": 31943009, "comment_id": 51796307, "body": "I put the wg.Done() in this am after reading (a clearly wrong) blog... Ok, let me try your suggest - might need some code to demo. Thanks"}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439301040, "post_id": 31943009, "comment_id": 51797223, "body": "Does the edit I made look like a viable solution? @Not_a_Golfer"}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439303166, "post_id": 31943009, "comment_id": 51798882, "body": "Thanks, that was simple. Just testing live and my memory usage ain&#39;t growing. Thanks."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439304457, "post_id": 31943009, "comment_id": 51799952, "body": "@simonmorley it&#39;s more idiomatic to send on the channel rather than closing it. Another option is to use <code>range</code> based iteration on the first channel, and close it, which will also cause the range loop to exit."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439309087, "post_id": 31943009, "comment_id": 51803126, "body": "I see. I had actually been using range to start with but was sidetracked by something that said using the select loop would be faster and more efficient. Clearly not, if used incorrectly."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439309126, "post_id": 31943009, "comment_id": 51803151, "body": "If using range, can we therefore get away without the need for a second channel?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439316264, "post_id": 31943009, "comment_id": 51807248, "body": "@simonmorley yep. just close the original channel and the range loop will exit. same effect."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1439328349, "post_id": 31943009, "comment_id": 51813799, "body": "Thanks for the guidance."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1439299370, "creation_date": 1439299370, "answer_id": 31943009, "question_id": 31942770, "link": "https://stackoverflow.com/questions/31942770/golang-waitgroup-causing-memory-leak-what-can-i-do-to-improve-this-function/31943009#31943009", "title": "Golang WaitGroup causing memory leak, what can I do to improve this function", "body": "<p>The receive loop never breaks:</p>\n\n<pre><code>  for {\n            select {\n            case client := &lt;-c1:\n            ...\n   }\n</code></pre>\n\n<p>It has no stop condition, no timeout, nothing - so it will just hang there forever - even if your whole function exits. and it will leak both the goroutine and the channel. </p>\n\n<p>On top of that, you're deferring a <code>wg.Done</code> when this loop exits, but you're not doing <code>wg.Add</code> to match it. So if this loop ever exits, you will panic.</p>\n\n<p>What you need to do is find some way to stop the for/select loop. Simplest way IMO - add a second channel that receives data after <code>wg.Wait()</code>, but do not do <code>wg.Done()</code> in that goroutine.</p>\n"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 1, "accepted_answer_id": 31943009, "answer_count": 1, "score": 0, "last_activity_date": 1439301018, "creation_date": 1439298668, "last_edit_date": 1439301018, "question_id": 31942770, "link": "https://stackoverflow.com/questions/31942770/golang-waitgroup-causing-memory-leak-what-can-i-do-to-improve-this-function", "title": "Golang WaitGroup causing memory leak, what can I do to improve this function", "body": "<p>I've been struggling to find a memory leak in our application and have been using the pprof tool to understand what's going on.</p>\n\n<p>When I look at the heap, I constantly see the following function and I don't understand why (or if) it's actually a problem.</p>\n\n<pre><code>func CreateClients(raw []byte) bool {\n\n    macs := []string{}\n    conn := FormatConn(raw)\n\n    if conn.Ap_Mac != \"\" {\n\n        var wg sync.WaitGroup\n        var array []Client\n\n        c1 := make(chan Client)\n\n        clients := FormatClients(conn)\n\n        wg.Add(len(clients))\n\n        for _, c := range clients {\n            go func(d Client) {\n                defer wg.Done()\n                c1 &lt;- UpdateClients(d)\n            }(c)\n        }\n\n        go func() {\n            defer wg.Done()\n            for {\n                select {\n                case client := &lt;-c1:\n                    array = append(array, client)\n                    macs = append(macs, client.Client_Mac)\n                }\n            }\n        }()\n\n        wg.Wait()\n        // Do some other stuff\n    ...\n}\n</code></pre>\n\n<p>The UpdateClients function updates the client model in Mongo. When it returns, I need each client - so I can index it with ES plus I need an array of the macs to do some other stuff.</p>\n\n<p>I've gone through the online examples and thought this was the recommended way to loop through a channel.</p>\n\n<p>My pprof heap looks like this, and grows steadily over a few days:</p>\n\n<pre><code>7.53MB of 9.53MB total (79.00%)\nDropped 234 nodes (cum &lt;= 0.05MB)\nShowing top 5 nodes out of 28 (cum &gt;= 1MB)\n      flat  flat%   sum%        cum   cum%\n       2MB 21.00% 21.00%        2MB 21.00%  strings.Replace\n    1.51MB 15.89% 36.89%     1.51MB 15.89%  github.com/PolkaSpots/worker/worker.func\u00b7006\n    1.51MB 15.87% 52.76%     1.51MB 15.87%  github.com/PolkaSpots/worker/worker.func\u00b7008\n    1.50MB 15.75% 68.51%     1.50MB 15.75%  newproc_m\n       1MB 10.50% 79.00%        1MB 10.50%  gopkg.in/mgo.v2/bson.(*decoder).readStr\n</code></pre>\n\n<p>Is there a more efficient / recommended way to achieve this?</p>\n\n<p><strong>EDIT_</strong></p>\n\n<p>As suggested, I've altered the loop as so</p>\n\n<pre><code>    done := make(chan bool)\n\n    go func() {\n        for {\n            select {\n            case client := &lt;-c1:\n                array = append(array, client)\n                macs = append(macs, client.Client_Mac)\n            case &lt;-done:\n                return\n            }\n        }\n    }()\n\n    wg.Wait()\n    close(done)\n</code></pre>\n"}, {"tags": ["go", "wait", "system-calls"], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1439300397, "last_edit_date": 1439300397, "creation_date": 1439298874, "answer_id": 31942831, "question_id": 31942171, "link": "https://stackoverflow.com/questions/31942171/go-wait4-function/31942831#31942831", "title": "Go wait4 function", "body": "<p>wait4 is deprecated on Linux, the proper way is to use <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow\"><code>exec.Command</code></a> and call <code>.Wait()</code>.</p>\n\n<p>An example with signals:</p>\n\n<pre><code>func bgProcess(app string) (chan error, *os.Process, error) {\n    cmd := exec.Command(app)\n    ch := make(chan error, 1)\n    if err := cmd.Start(); err != nil {\n        return nil, nil, err\n    }\n    go func() {\n        ch &lt;- cmd.Wait()\n    }()\n    return ch, cmd.Process, nil\n}\nfunc main() {\n    ch, proc, err := bgProcess(\"/usr/bin/cat\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"Signal(os.Kill):\", proc.Signal(os.Kill))\n    log.Println(\"cat returned:\", &lt;-ch)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 5214991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076b72f17f453440b91266b2821af806?s=128&d=identicon&r=PG&f=1", "display_name": "Anastasiya ", "link": "https://stackoverflow.com/users/5214991/anastasiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1439300397, "creation_date": 1439297071, "question_id": 31942171, "link": "https://stackoverflow.com/questions/31942171/go-wait4-function", "title": "Go wait4 function", "body": "<p>I want to test wait4 function, but I'm not really familiar with child processes and so on, but I need to keep it working and during this time send it some signal and see reaction. Can you give me a little example of using wait4 in Go?</p>\n"}, {"tags": ["time", "go", "sleep", "channel"], "comments": [{"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 0, "creation_date": 1439297308, "post_id": 31942163, "comment_id": 51794299, "body": "take a look at <a href=\"http://stackoverflow.com/questions/23582143/golang-using-timeouts-with-channels\" title=\"golang using timeouts with channels\">stackoverflow.com/questions/23582143/&hellip;</a> as well as <a href=\"http://stackoverflow.com/questions/16466320/is-there-a-way-to-do-repetitive-tasks-at-intervals-in-golang\" title=\"is there a way to do repetitive tasks at intervals in golang\">stackoverflow.com/questions/16466320/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 0, "creation_date": 1439298809, "post_id": 31942303, "comment_id": 51795489, "body": "Thank you so much icza, you safe me again. I have so much questions on golang."}, {"owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 0, "creation_date": 1439298979, "post_id": 31942303, "comment_id": 51795604, "body": "I don&#39;t understand this part <b>&lt;-time.After(time.Second * time.Duration(x))</b> is it receiving ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 0, "creation_date": 1439299162, "post_id": 31942303, "comment_id": 51795751, "body": "@airsoftFreak <code>time.After()</code> returns a channel. And the <code>&lt;-</code> is the <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">receive operator</a> applied on the return value of <code>time.After()</code>."}, {"owner": {"reputation": 823, "user_id": 2694909, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bvE50.jpg?s=128&g=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/2694909/shawn"}, "edited": false, "score": 0, "creation_date": 1508530208, "post_id": 31942303, "comment_id": 80660764, "body": "Can someone explain how to use the Sleep(x int) function above?  <code>go Sleep(10)</code> with a print statement after executes immediately so I know this isn&#39;t working for me."}, {"owner": {"reputation": 487, "user_id": 8623347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QG7yn.jpg?s=128&g=1", "display_name": "user9123", "link": "https://stackoverflow.com/users/8623347/user9123"}, "reply_to_user": {"reputation": 823, "user_id": 2694909, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bvE50.jpg?s=128&g=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/2694909/shawn"}, "edited": false, "score": 0, "creation_date": 1607789635, "post_id": 31942303, "comment_id": 115385875, "body": "@Shawn 3 years later, here&#39;s your answer :P - because you used <code>go</code> in front of <code>Sleep</code>, it executed the sleep in a goroutine (in the background) and executed the print straight after. If you remove the <code>go</code> it should work just fine."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1439446468, "last_edit_date": 1439446468, "creation_date": 1439297397, "answer_id": 31942303, "question_id": 31942163, "link": "https://stackoverflow.com/questions/31942163/how-to-write-my-own-sleep-function-using-just-time-after/31942303#31942303", "title": "How to write my own Sleep function using just time.After?", "body": "<p><a href=\"https://golang.org/pkg/time/#After\" rel=\"nofollow\"><code>time.After()</code></a> returns you a channel. And a value will be send on the channel after the specified duration.</p>\n\n<p>So just receive a value from the returned channel, and the receive will block until the value is sent:</p>\n\n<pre><code>func Sleep(x int) {\n    &lt;-time.After(time.Second * time.Duration(x))\n}\n</code></pre>\n\n<p><strong>Your errors:</strong></p>\n\n<p>In your first example:</p>\n\n<pre><code>msg := &lt;- time.After(time.Second * x)\n</code></pre>\n\n<p><code>msg</code> is already declared, and so the <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow\">Short variable declaration</a> <code>:=</code> cannot be used. Also the recieved value will be of type <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow\"><code>time.Time</code></a>, so you can't even assign it to <code>msg</code>.</p>\n\n<p>In your second example you need a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow\">conversion</a> as <code>x</code> is of type <code>int</code> and <code>time.Second</code> is of type <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow\"><code>time.Duration</code></a>, and <code>time.After()</code> expects a value of type <code>time.Duration</code>.</p>\n"}], "owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "accepted_answer_id": 31942303, "answer_count": 1, "score": -1, "last_activity_date": 1439446468, "creation_date": 1439297048, "last_edit_date": 1439310113, "question_id": 31942163, "link": "https://stackoverflow.com/questions/31942163/how-to-write-my-own-sleep-function-using-just-time-after", "title": "How to write my own Sleep function using just time.After?", "body": "<p>I'm trying to write my own sleep function equivalent to <code>time.Sleep</code> using <code>time.After</code> in Go.</p>\n\n<p>Here's the code. First attempt:</p>\n\n<pre><code>func Sleep(x int) {\n  msg := make(chan int)\n  msg := &lt;- time.After(time.Second * x)\n}\n</code></pre>\n\n<p>Second attempt:</p>\n\n<pre><code>func Sleep(x int) {\n time.After(time.Second * x)\n}\n</code></pre>\n\n<p>Both return errors, can someone explain to me how to write a sleep function equivalent to <code>time.Sleep</code> using <code>time.After</code> and if possible when do I use channel?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1439371432, "post_id": 31938346, "comment_id": 51829848, "body": "@DaveC I did check the <code>go get -h</code>, somehow I missed the point to check the <code>go help packages</code>. I searched in Google/StackOverflow, but was not able to find anything on this. Having such questions in SO helps lot of other people who are also searching for such questions, and they would also get to know more about what this is. I agree that it would have been better if I have found it myself, but I wanted to clarify that I did not ask the question just because I did not want to search myself. I did it. I searched, and when I was not able to find, I landed up in SO"}], "answers": [{"tags": [], "owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "is_accepted": true, "score": 34, "last_activity_date": 1439286921, "last_edit_date": 1495541042, "creation_date": 1439286536, "answer_id": 31938511, "question_id": 31938346, "link": "https://stackoverflow.com/questions/31938346/what-does-the-mean-in-go-get/31938511#31938511", "title": "What does the `...` mean in go get", "body": "<p>The <code>...</code> (ellipsis) tells <code>go get</code> to also fetch the package's subpackages/dependencies.</p>\n\n<p>From <code>go help packages</code>:</p>\n\n<blockquote>\n  <p>An import path is a pattern if it includes one or more \"...\"\n  wildcards, each of which can match any string, including the empty\n  string and strings containing slashes.  Such a pattern expands to all\n  package directories found in the GOPATH trees with names matching the\n  patterns.  As a special case, x/... matches x as well as x's\n  subdirectories. For example, net/... expands to net and packages in\n  its subdirectories.</p>\n</blockquote>\n\n<p>For an example of how you'd use it, check out <a href=\"https://stackoverflow.com/a/14870666/182402\">this answer</a>.</p>\n"}], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5611, "favorite_count": 1, "accepted_answer_id": 31938511, "answer_count": 1, "score": 27, "last_activity_date": 1439286921, "creation_date": 1439286060, "question_id": 31938346, "link": "https://stackoverflow.com/questions/31938346/what-does-the-mean-in-go-get", "title": "What does the `...` mean in go get", "body": "<p>I wanted to install <a href=\"https://github.com/constabulary/gb\" rel=\"noreferrer\"><code>gb</code></a> </p>\n\n<p>The installation steps says to execute the command:</p>\n\n<p><code>go get github.com/constabulary/gb/...</code></p>\n\n<p>What does the <code>...</code> mean in this case?</p>\n"}, {"tags": ["mongodb", "go", "atomic", "findandmodify"], "answers": [{"comments": [{"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1439284613, "post_id": 31937521, "comment_id": 51786019, "body": "actually I have found this answer before I ask, but I just find one record, I should replace <code>One(obj)</code> with <code>limit(1)</code>?"}, {"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "reply_to_user": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1439284816, "post_id": 31937521, "comment_id": 51786152, "body": "@roger That is not a <code>.findAndModify()</code>. That is called retriving the object then saving it back. <code>.findAndModify()</code> or <code>.Change()</code> in this case makes the modification directly on the server and either returns the updated object or original object. Just as stated here already."}, {"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "reply_to_user": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1439285708, "post_id": 31937521, "comment_id": 51786717, "body": "@roger No the oposite. <code>.Apply()</code> with the <code>Change</code> set here <b>is atomic</b>, your code is not. That is the problem I am solving here. There is no <code>.One()</code> call. This &quot;only&quot; modifies one document at a time. This <b>is</b> the mgo version of <code>.findAndModify()</code>, which is the question you asked,"}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1439286004, "post_id": 31937521, "comment_id": 51786890, "body": "OK, now I just understand you meaning, you mean your code will <b>just find one and update exactly the one</b>, but I get another question, I want to <code>find and modify n records</code>, can I do this?"}, {"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "reply_to_user": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1439286336, "post_id": 31937521, "comment_id": 51787084, "body": "@roger That is what the <code>.findAndModify()</code> method &quot;your question asks for&quot; does. You cannot modify &quot;n&quot; records <b>and</b> return them  all at once. MongoDB has no method for this as it simply does not make sense. Either <code>.findAndModify()</code> one at a time, <b>or</b> <code>.update()</code> all at once. But with multiple, you <b>cannot</b> return the modified or orginal data. That is a seperate query."}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "edited": false, "score": 0, "creation_date": 1439286566, "post_id": 31937521, "comment_id": 51787231, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/86683/discussion-between-roger-and-blakes-seven\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1613, "user_id": 5013336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d627dbf935d8dcb71c8eff8a223e97cc?s=128&d=identicon&r=PG", "display_name": "Arka Mukherjee", "link": "https://stackoverflow.com/users/5013336/arka-mukherjee"}, "edited": false, "score": 1, "creation_date": 1555493317, "post_id": 31937521, "comment_id": 98127488, "body": "How do we do the same with Go&#39;s official MongoDB Driver?"}], "tags": [], "owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "is_accepted": true, "score": 16, "last_activity_date": 1439285584, "last_edit_date": 1439285584, "creation_date": 1439283873, "answer_id": 31937521, "question_id": 31937292, "link": "https://stackoverflow.com/questions/31937292/how-can-i-findandmodify-one-record-in-mongodb-with-golang/31937521#31937521", "title": "how can I findAndModify one record in mongodb with golang?", "body": "<p>The method here is <a href=\"http://godoc.org/labix.org/v2/mgo#Query.Apply\" rel=\"noreferrer\"><strong><code>.Apply()</code></strong></a> which takes a <a href=\"http://godoc.org/labix.org/v2/mgo#Change\" rel=\"noreferrer\">Change</a> type and returns <a href=\"http://godoc.org/labix.org/v2/mgo#ChangeInfo\" rel=\"noreferrer\">ChangeInfo</a>.</p>\n\n<p>Direct example in the documentation:</p>\n\n<pre><code>change := mgo.Change{\n        Update: bson.M{\"$inc\": bson.M{\"n\": 1}},\n        ReturnNew: false,\n}\ninfo, err = col.Find(M{\"_id\": id}).Apply(change, &amp;doc)\nfmt.Println(doc.N)\n</code></pre>\n\n<p>Where <code>doc</code> is document that is found, and it's state depending on the value of <code>ReturnNew</code> in the <code>Change</code> arguments, being <code>false</code> where you want the original document.</p>\n\n<p>Basically all arguments are in the same form as with <a href=\"http://docs.mongodb.org/manual/reference/method/db.collection.findAndModify/\" rel=\"noreferrer\"><code>.findAndModify()</code></a></p>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5911, "favorite_count": 6, "accepted_answer_id": 31937521, "answer_count": 1, "score": 6, "last_activity_date": 1439285584, "creation_date": 1439283143, "question_id": 31937292, "link": "https://stackoverflow.com/questions/31937292/how-can-i-findandmodify-one-record-in-mongodb-with-golang", "title": "how can I findAndModify one record in mongodb with golang?", "body": "<p>I want something like this:</p>\n\n<ol>\n<li>find one record in mongo db <code>old_record</code></li>\n<li>update this record to <code>new_record</code></li>\n<li>return <code>old_record</code></li>\n</ol>\n\n<p>I write code like this:</p>\n\n<pre><code>ret = nil\n// First, Find the obj\nobj := &amp;orm.QuerySetObj{}\nerr2 := this.querySetCollection.With(session).Find(objKey).One(obj)\nif nil != err2 {\n    this.logger.Println(\"Error find obj\")\n    return\n}\n\nret = obj\n\n// Then, update this obj\nobj.updateTime = time.Now().Unix()\nerr3 := this.querySetCollection.With(session).Upsert(objKey, obj)\nif nil != err3 {\n    this.logger.Println(\"Error update obj\")\n    return\n}\n\nreturn\n</code></pre>\n\n<p>but, I think <code>find</code> and <code>update</code> should be an <code>atomic</code> operation, so my code is not safe. </p>\n\n<p>how can I do this in an atomic operation</p>\n"}, {"tags": ["pointers", "go", "slice", "unsafe"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1439284884, "post_id": 31935915, "comment_id": 51786204, "body": "Do not use package unsafe."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1439304576, "post_id": 31935915, "comment_id": 51800047, "body": "@Volker there are a lot of uses for unsafe in performance-related apps, and while it is called &quot;unsafe&quot;, there&#39;s absolutely nothing wrong with it if you use it right."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439314565, "post_id": 31935915, "comment_id": 51806323, "body": "I&#39;d have phrased that &quot;Do not use package unsafe to randomly poke around in memory and expect anything good&quot;. I count mucking with the unsafe results of converting a pointer to a slice without understanding how a slice is represented in memory as &quot;randomly poking memory&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 5067859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/093dac404ead422a03641264ce1e6ed0?s=128&d=identicon&r=PG&f=1", "display_name": "xiaobao wei", "link": "https://stackoverflow.com/users/5067859/xiaobao-wei"}, "edited": false, "score": 0, "creation_date": 1439280753, "post_id": 31935984, "comment_id": 51783770, "body": "I thought &quot;make([]byte, 50)&quot; and &quot;[50]byte{}&quot; are same before. thank you very much."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 37, "user_id": 5067859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/093dac404ead422a03641264ce1e6ed0?s=128&d=identicon&r=PG&f=1", "display_name": "xiaobao wei", "link": "https://stackoverflow.com/users/5067859/xiaobao-wei"}, "edited": false, "score": 1, "creation_date": 1439280887, "post_id": 31935984, "comment_id": 51783856, "body": "@xiaobaowei <code>make([]byte, 50)</code> is a <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">built-in function</a> creating a slice, <code>[50]byte{}</code> is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> creating a value of array type <code>[50]byte</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1482146708, "last_edit_date": 1482146708, "creation_date": 1439279068, "answer_id": 31935984, "question_id": 31935915, "link": "https://stackoverflow.com/questions/31935915/panic-using-unsafe-pointer-in-go/31935984#31935984", "title": "Panic using unsafe.Pointer in Go", "body": "<p>Because <code>buf</code> is a slice (not an array), and slices are just descriptors.</p>\n\n<p>You most likely wanted to write to the memory space of the allocated bytes, so instead of using the address of the slice descriptor, use the address of the allocated bytes, which you can get by taking the address of the first element (a slice describes a <em>contiguous</em> section of an underlying array):</p>\n\n<pre><code>t := (*Point)(unsafe.Pointer(&amp;buf[0]))\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/0QQ-gR4C5h\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[10 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n</code></pre>\n\n<p>As you can see, data you set appears in the 2nd output (<code>10 0 0 0</code> are the 4 bytes of the <code>int</code> value <code>10</code>, <code>100 0 0 0</code> are the 4 bytes of the <code>int</code> value <code>100</code>).</p>\n\n<p>You see panic if you use the address of the slice descriptor because the descriptor contains things like the address of the first element, the element count and capacity. So by using the address of the descriptor you will modify these and when trying to print it again as a slice, the data you wrote to it will most likely be in invalid pointer. This is confirmed by you writing the value <code>10</code> which is <code>0xa</code> in hex and the error message contains: <code>addr=0xa</code></p>\n\n<p>Another option would be to use a \"real\" array instead of a slice because arrays are not descriptors:</p>\n\n<pre><code>buf := [50]byte{}\nt := (*Point)(unsafe.Pointer(&amp;buf))\n</code></pre>\n\n<p>And with this change the output will be the same.</p>\n"}], "owner": {"reputation": 37, "user_id": 5067859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/093dac404ead422a03641264ce1e6ed0?s=128&d=identicon&r=PG&f=1", "display_name": "xiaobao wei", "link": "https://stackoverflow.com/users/5067859/xiaobao-wei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 0, "accepted_answer_id": 31935984, "answer_count": 1, "score": -1, "last_activity_date": 1482146708, "creation_date": 1439278824, "last_edit_date": 1439279982, "question_id": 31935915, "link": "https://stackoverflow.com/questions/31935915/panic-using-unsafe-pointer-in-go", "title": "Panic using unsafe.Pointer in Go", "body": "<p>The code is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype Point struct {\n    x int \n    y int \n}\n\nfunc main() {\n\n    buf := make([]byte, 50) \n    fmt.Println(buf)\n    t := (*Point)(unsafe.Pointer(&amp;buf))\n    t.x = 10\n    t.y = 100 \n    fmt.Println(buf)\n}\n</code></pre>\n\n<p>When running it, a run-time panic occurs:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0xa pc=0x43dd4d]\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1473775724, "last_edit_date": 1473775724, "creation_date": 1439283354, "answer_id": 31937348, "question_id": 31935453, "link": "https://stackoverflow.com/questions/31935453/variable-xml-tag-in-golang/31937348#31937348", "title": "Variable xml tag in golang", "body": "<p>You can use an <a href=\"https://golang.org/pkg/encoding/xml/#Name\" rel=\"nofollow\"><code>xml.Name</code></a> field to specify the tag name you want it in the XML output. Note that with <code>xml.Name</code> you can also specify the namespace, so you don't even need <code>Command.Field</code> anymore which you only used to set the namespace attribute.</p>\n\n<p>So here is your modified code:</p>\n\n<pre><code>type Command struct {\n    XMLName xml.Name\n}\n\ntype XMLEnvelop struct {\n    XMLName      xml.Name `xml:\"s:Envelope\"`\n    Xmlns        string   `xml:\"xmlns:s,attr\"`\n    FunctionName Command  `xml:\"s:Body&gt;FunctionName\"`\n}\n\nv := &amp;XMLEnvelop{Xmlns: \"namespace1\",\n    FunctionName: Command{xml.Name{\"namespace2\", \"MyFuncName\"}}}\n\noutput, err := xml.MarshalIndent(v, \"\", \"    \")\nif err != nil {\n    fmt.Printf(\"error: %v\\n\", err)\n}\n\n// Write the output to check\nos.Stdout.Write(output)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/zrOQglEYn5\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>&lt;s:Envelope xmlns:s=\"namespace1\"&gt;\n    &lt;s:Body&gt;\n        &lt;MyFuncName xmlns=\"namespace2\"&gt;&lt;/MyFuncName&gt;\n    &lt;/s:Body&gt;\n&lt;/s:Envelope&gt;\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 3466729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76920232f54c864476c01e7454cdf522?s=128&d=identicon&r=PG&f=1", "display_name": "Gpack", "link": "https://stackoverflow.com/users/3466729/gpack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 1, "accepted_answer_id": 31937348, "answer_count": 1, "score": 1, "last_activity_date": 1473775724, "creation_date": 1439277374, "question_id": 31935453, "link": "https://stackoverflow.com/questions/31935453/variable-xml-tag-in-golang", "title": "Variable xml tag in golang", "body": "<p>I'm trying to communicate with a SOAP service from my go program but I'm having difficulties to use the <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow\">xml package</a>.</p>\n\n<p>Most of the requests I have to send have the following format:</p>\n\n<pre><code>&lt;s:Envelope xmlns=\"namespace1\"&gt;\n &lt;s:Body&gt;\n      &lt;FunctionName xmlns=\u201cnamespace2\u201d/&gt;\n &lt;/s:Body&gt;\n&lt;/s:Envelope&gt;\n</code></pre>\n\n<p>I feel I have to create one type for each request I want to make, as <code>FunctionName</code>changes... <a href=\"http://play.golang.org/p/Cuuv5ZDtQA\" rel=\"nofollow\">Here</a>'s the code I use so far.</p>\n\n<p>It would be nice if I could have a single type with the <code>FunctionName</code> as an attribute but I just can't figure out how... To make it clearer, I would like to put a variable instead of <code>FunctionName</code> inside <code>xml:\"s:Body&gt;FunctionName\"</code>.</p>\n\n<p>Thanks a lot for your help!</p>\n"}, {"tags": ["go", "goroutine", "thread-local-storage"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1439267051, "post_id": 31932945, "comment_id": 51777754, "body": "It doesn&#39;t have thread-local. One alternative is to pass a per-request context around; <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow noreferrer\">Gorilla</a> and <a href=\"https://cloud.google.com/appengine/docs/go/reference#Context\" rel=\"nofollow noreferrer\">Google App Engine</a> have it. And yes, you can end up needing to pass it through a lot of functions."}, {"owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "edited": false, "score": 0, "creation_date": 1522935703, "post_id": 31932945, "comment_id": 86358444, "body": "You can try this package which does allow for thread locals: <a href=\"https://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">github.com/jwells131313/goethe</a>"}], "answers": [{"comments": [{"owner": {"reputation": 929, "user_id": 5213437, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/07251e0d569f4e6ce31f87c453a458bf?s=128&d=identicon&r=PG&f=1", "display_name": "modkzs", "link": "https://stackoverflow.com/users/5213437/modkzs"}, "edited": false, "score": 0, "creation_date": 1439377792, "post_id": 31933609, "comment_id": 51834205, "body": "I find gls, but I still need to change code with it. It seems that there is no way to do it without change my function."}, {"owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "edited": false, "score": 0, "creation_date": 1522935676, "post_id": 31933609, "comment_id": 86358424, "body": "You can also try this package which does allow for thread local storage: <a href=\"https://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">github.com/jwells131313/goethe</a>"}, {"owner": {"reputation": 694, "user_id": 2823791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c342a53da99bd7e1b4fcb164a037d220?s=128&d=identicon&r=PG", "display_name": "VicX", "link": "https://stackoverflow.com/users/2823791/vicx"}, "edited": false, "score": 1, "creation_date": 1547697777, "post_id": 31933609, "comment_id": 95283077, "body": "Context is a brilliant idea! I came across with a situation that I was implementing a JobExecutor which had several workers to execute a bunch of Job functions and I needed to log which worker was running current job. Using goroutine-local vars was my first idea and I was led to this question. This answer pointed out that we should use context, so I thought again. Yes, context is more expressive and straight-forward. My worker can tell its job&#39;s running <b>context</b> and Job func can retrieve every information it needed from its <b>running context</b>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 28, "last_activity_date": 1477535802, "last_edit_date": 1477535802, "creation_date": 1439269450, "answer_id": 31933609, "question_id": 31932945, "link": "https://stackoverflow.com/questions/31932945/does-go-have-something-like-threadlocal-from-java/31933609#31933609", "title": "Does Go have something like ThreadLocal from Java?", "body": "<p>The Go runtime and standard libraries do not provide goroutine local storage or a goroutine identifier that can be used to implement goroutine local storage.</p>\n\n<p>The third party <a href=\"https://github.com/jtolds/gls\" rel=\"noreferrer\">gls</a> package implements goroutine local storage in an interesting way. Some find this package horrifying and others think it's clever.  </p>\n\n<p>The Go team recommends passing context explicitly as function argument instead of using goroutine local storage. See the <a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">context blog post</a> and <a href=\"http://godoc.org/context\" rel=\"noreferrer\">package documentation</a> for more information.</p>\n"}], "owner": {"reputation": 929, "user_id": 5213437, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/07251e0d569f4e6ce31f87c453a458bf?s=128&d=identicon&r=PG&f=1", "display_name": "modkzs", "link": "https://stackoverflow.com/users/5213437/modkzs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10673, "favorite_count": 5, "answer_count": 1, "score": 27, "last_activity_date": 1601397002, "creation_date": 1439265419, "last_edit_date": 1439274740, "question_id": 31932945, "link": "https://stackoverflow.com/questions/31932945/does-go-have-something-like-threadlocal-from-java", "title": "Does Go have something like ThreadLocal from Java?", "body": "<p>I use Go and Gin to setup my website and want to know the database access time. I use goroutine so if don't use something like thread-local, I must change almost every function to do it. Does Go have a good way to do it?</p>\n"}, {"tags": ["pointers", "go", "constructor"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 1, "creation_date": 1439265063, "post_id": 31932822, "comment_id": 51777238, "body": "The function returns a <code>File*</code>, so it is not possible to return <code>File</code> &quot;directly&quot;. In the previous case <code>new(File)</code> was used to start with a <code>File*</code>."}, {"owner": {"reputation": 1016, "user_id": 927687, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1be4ac81206ec06500f79d1b9972f25d?s=128&d=identicon&r=PG", "display_name": "Bhoomtawath Plinsut", "link": "https://stackoverflow.com/users/927687/bhoomtawath-plinsut"}, "reply_to_user": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1439265143, "post_id": 31932822, "comment_id": 51777257, "body": "So, I don&#39;t have to return address to the variable unless I&#39;m using File, right?"}, {"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1439265234, "post_id": 31932822, "comment_id": 51777278, "body": "Both examples use &#39;File&#39; .. I don&#39;t know how to interpret that question."}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 2, "creation_date": 1439265795, "post_id": 31932822, "comment_id": 51777430, "body": "In go, returning the address of a variable is the same as calling <code>malloc()</code> in C. If you don&#39;t need it you don&#39;t need to use it."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 2, "creation_date": 1439266492, "post_id": 31932822, "comment_id": 51777606, "body": "There&#39;s nothing about the language that <i>requires</i> the function to return a pointer, that was a choice the person defining the function made. Your question just generalizes to the question, &quot;when should I use pointers, and when should I use plain structs?&quot; The answer is, &quot;it depends.&quot; You can do some research on the Internet on when people typically choose to use pointers in Go."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 21, "last_activity_date": 1439288148, "last_edit_date": 1439288148, "creation_date": 1439272557, "answer_id": 31934189, "question_id": 31932822, "link": "https://stackoverflow.com/questions/31932822/why-should-constructor-of-go-return-address/31934189#31934189", "title": "Why should constructor of Go return address?", "body": "<p>As mentioned, yes, the spec allows you to return either values (as non-pointers) or pointers. It's just a decision you have to make.</p>\n\n<p><strong>When to return pointer?</strong></p>\n\n<p>Usually if the value you return is \"more useful\" as a pointer. When is it more useful?</p>\n\n<p>For example if it has <strong>many methods with pointer receiver</strong>. Yes, you could store the return value in a variable and so it will be addressable and you can still call its methods that have pointer receivers. But if a pointer is returned right away, you can \"chain\" method calls. See this example:</p>\n\n<pre><code>type My int\n\nfunc (m *My) Str() string { return strconv.Itoa(int(*m)) }\n\nfunc createMy(i int) My { return My(i) }\n</code></pre>\n\n<p>Now writing:</p>\n\n<pre><code>fmt.Println(createMy(12).Str())\n</code></pre>\n\n<p>Will result in error: <code>cannot call pointer method on createMy(12)</code></p>\n\n<p>But if works if you return a pointer:</p>\n\n<pre><code>func createMy(i int) *My { return (*My)(&amp;i) }\n</code></pre>\n\n<p>Also if you store the returned value in a data structure which is not addressable (<code>map</code> for example), you cannot call methods on values by indexing a map because values of a map are not addressable.</p>\n\n<p>See this example: <code>My.Str()</code> has pointer receiver. So if you try to do this:</p>\n\n<pre><code>m := map[int]My{0: My(12)}\nm[0].Str() // Error!\n</code></pre>\n\n<p>You can't because <em>\"cannot take the address of <code>m[0]</code>\"</em>. But the following works:</p>\n\n<pre><code>m := map[int]*My{}\nmy := My(12)\nm[0] = &amp;my // Store a pointer in the map\n\nm[0].Str() // You can call it, no need to take the address of m[0]\n           // as it is already a pointer\n</code></pre>\n\n<p>And another example for pointers being useful is if <strong>it is a \"big\" struct which will be passed around a lot</strong>. <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"noreferrer\"><code>http.Request</code></a> is a shining example. It is big, it is usually passed around a lot to other handlers, and it has methods with pointer receiver.</p>\n\n<p>If you return a pointer, that usually suggests that the returned value is better if stored and passed around as a pointer.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8952645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550277b17a77b8506cdc20c3792c7fdd?s=128&d=identicon&r=PG&f=1", "display_name": "Anish Mathew", "link": "https://stackoverflow.com/users/8952645/anish-mathew"}, "is_accepted": false, "score": 0, "last_activity_date": 1585089210, "creation_date": 1585089210, "answer_id": 60840366, "question_id": 31932822, "link": "https://stackoverflow.com/questions/31932822/why-should-constructor-of-go-return-address/60840366#60840366", "title": "Why should constructor of Go return address?", "body": "<p>Pointer receiver accepts both pointer and value types, as long as it matches the data type.</p>\n\n<pre><code>type User struct {\n    name  string\n    email string\n    age   int\n}\n\n// NewUserV returns value ... ideally for a User we should not be \n// returning value\nfunc NewUserV(name, email string, age int) User {\n    return User{name, email, age}\n}\n\n// NewUserP returns pointer ...\nfunc NewUserP(name, email string, age int) *User {\n    return &amp;User{name, email, age}\n}\n\n// ChangeEmail ...\nfunc (u *User) ChangeEmail(newEmail string) {\n    u.email = newEmail\n}\n\nfunc main() {\n    // with value type\n    usr1 := NewUserV(\"frank\", \"frank@camero.com\", 22)\n    fmt.Println(\"Before change: \", usr1)\n    usr1.ChangeEmail(\"frank@gmail.com\")\n    fmt.Println(\"After change: \", usr1)\n\n    // with pointer type\n    usr2 := NewUserP(\"john\", \"john@liliput.com\", 22)\n    fmt.Println(\"Before change: \", usr2)\n    usr2.ChangeEmail(\"john@macabre.com\")\n    fmt.Println(\"After change: \", usr2)\n\n}\n\n</code></pre>\n\n<p>In addition to what icza mentioned about the big struct being passed around. Pointer values are a way of saying that pointer semantics are at play and who ever uses the particular type should not make copy of the value which is being shared by the pointer.</p>\n\n<p>If you look at the struct of File or http type, it maintains channels or some other pointer types which is unique to that value. Make a copy of the value (given to you by the pointer) would lead to hard to find bugs since the copied value might end up writing or reading to the pointer types of the original value. </p>\n"}], "owner": {"reputation": 1016, "user_id": 927687, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1be4ac81206ec06500f79d1b9972f25d?s=128&d=identicon&r=PG", "display_name": "Bhoomtawath Plinsut", "link": "https://stackoverflow.com/users/927687/bhoomtawath-plinsut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2617, "favorite_count": 3, "accepted_answer_id": 31934189, "answer_count": 2, "score": 12, "last_activity_date": 1585089210, "creation_date": 1439264563, "last_edit_date": 1439310156, "question_id": 31932822, "link": "https://stackoverflow.com/questions/31932822/why-should-constructor-of-go-return-address", "title": "Why should constructor of Go return address?", "body": "<p>I understand that Go doesn't have any constructors and a <code>New func</code> is used in its place, but according to <a href=\"http://golang.org/doc/effective_go.html#composite_literals\" rel=\"noreferrer\">this example</a>.</p>\n\n<pre><code>func NewFile(fd int, name string) *File {\n  if fd &lt; 0 {\n    return nil\n  }\n  f := File{fd, name, nil, 0}\n  return &amp;f\n}\n</code></pre>\n\n<p>They always return <code>&amp;f</code>. Why just simply returning <code>File</code> isn't suffice?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've tried returning the created object for a simple struct and it's fine. So, I wonder if returning an address is a standard way of constructor or something.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "rabbitmq", "amqp"], "comments": [{"owner": {"reputation": 68895, "user_id": 93448, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e592bd1326b1e80188ed4c0bf26b9f75?s=128&d=identicon&r=PG", "display_name": "Derick Bailey", "link": "https://stackoverflow.com/users/93448/derick-bailey"}, "edited": false, "score": 0, "creation_date": 1439253958, "post_id": 31931215, "comment_id": 51774493, "body": "this is a feature request for a library, and should be posted on their issue list as such: <a href=\"https://github.com/streadway/amqp/issues\" rel=\"nofollow noreferrer\">github.com/streadway/amqp/issues</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5076297"}, "reply_to_user": {"reputation": 68895, "user_id": 93448, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e592bd1326b1e80188ed4c0bf26b9f75?s=128&d=identicon&r=PG", "display_name": "Derick Bailey", "link": "https://stackoverflow.com/users/93448/derick-bailey"}, "edited": false, "score": 0, "creation_date": 1439261539, "post_id": 31931215, "comment_id": 51776403, "body": "It actually turns out to be a limitation of the amqp spec. There&#39;s no way to do administrative functions like this in band, you have to do something backend specific (in my case calls to the rabbitmq management plugin api)"}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1589756406, "post_id": 31931215, "comment_id": 109412768, "body": "This is presented as a valid question -- not a feature request.  A good answer is provided as well."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5076297"}, "is_accepted": false, "score": 6, "last_activity_date": 1439261429, "last_edit_date": 1495542207, "creation_date": 1439254765, "answer_id": 31931543, "question_id": 31931215, "link": "https://stackoverflow.com/questions/31931215/go-amqp-method-to-list-all-currently-declared-queues/31931543#31931543", "title": "Go amqp method to list all currently declared queues?", "body": "<p>Answered my own question. There isn't a way! The amqp spec doesn't have a standard way of finding this out which seems like a glaring oversight to me. However, since my backend is rabbitmq with the management plugin, I can make a call to that to get this information.</p>\n\n<p>from <a href=\"https://stackoverflow.com/a/21286370/5076297\">https://stackoverflow.com/a/21286370/5076297</a> (in python, I'll just have to translate this and probably also figure out the call to get vhosts):</p>\n\n<pre><code>import requests\n\ndef rest_queue_list(user='guest', password='guest', host='localhost', port=15672, virtual_host=None):\n    url = 'http://%s:%s/api/queues/%s' % (host, port, virtual_host or '')\n    response = requests.get(url, auth=(user, password))\n    queues = [q['name'] for q in response.json()]\n    return queues\n</code></pre>\n\n<p>edit: In golang (this was a headache to figure out as I haven't done anything with structures in years)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"encoding/json\"\n)\n\nfunc main() {\n\n    type Queue struct {\n        Name string `json:name`\n        VHost string `json:vhost`\n    }\n\n    manager := \"http://127.0.0.1:15672/api/queues/\"\n    client := &amp;http.Client{}\n    req, _ := http.NewRequest(\"GET\", manager, nil)\n    req.SetBasicAuth(\"guest\", \"guest\")\n    resp, _ := client.Do(req)\n\n    value := make([]Queue, 0)\n    json.NewDecoder(resp.Body).Decode(&amp;value)\n    fmt.Println(value)\n}\n</code></pre>\n\n<p>Output looks like this (I have two queues named hello and test)</p>\n\n<pre><code>[{hello /} {test /}]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5076297"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1214, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1589769964, "creation_date": 1439252394, "last_edit_date": 1439254292, "question_id": 31931215, "link": "https://stackoverflow.com/questions/31931215/go-amqp-method-to-list-all-currently-declared-queues", "title": "Go amqp method to list all currently declared queues?", "body": "<p>I'm using streadway/amqp to do a tie in from rabbitmq to our alert system. I need a method that can return a list of all the currently declared queues (exchanges would be nice too!) so that I can go through and get all the message counts.</p>\n\n<p>I'm digging through the api documentation here...</p>\n\n<pre><code>http://godoc.org/github.com/streadway/amqp#Queue\n</code></pre>\n\n<p>...but I don't seem to be finding what I'm looking for. We're currently using a bash call to 'rabbitmqctl list_queues' but that's a kludge way to get this information, requires a custom sudo setting, and fires off hundreds of log entries a day to the secure log.</p>\n\n<p>edit: method meaning, 'a way to get this piece of information' as opposed to an actual call, though a call would be great I don't believe it exists.</p>\n"}, {"tags": ["go", "type-assertion"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1439249985, "post_id": 31930855, "comment_id": 51773500, "body": "<code>var i interface{} = MyType(12)</code>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1439252226, "post_id": 31930855, "comment_id": 51774068, "body": "related(?): <a href=\"http://stackoverflow.com/questions/20089670/how-to-understand-two-named-types-are-identical-in-golang\">How to understand two named types are identical in golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": true, "score": 3, "last_activity_date": 1439267966, "last_edit_date": 1439267966, "creation_date": 1439267350, "answer_id": 31933240, "question_id": 31930855, "link": "https://stackoverflow.com/questions/31930855/type-assertion-failed-when-using-two-different-but-identical-types/31933240#31933240", "title": "Type assertion failed when using two different (but identical) types", "body": "<p>They're not identical types. As the runtime tells you, one is <code>int</code> and one is <code>MyType</code>. Go has a very specific definition of identical.</p>\n\n<p>Straight from the spec:</p>\n\n<blockquote>\n  <p>A type declaration binds an identifier, the type name, to a new type\n  that has the same underlying type as an existing type, and operations\n  defined for the existing type are also defined for the new type. The\n  new type is different from the existing type.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow\">https://golang.org/ref/spec#Type_identity</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow\">https://golang.org/ref/spec#Type_declarations</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow\">https://golang.org/ref/spec#Types</a></p>\n\n<p>You can easily convert between the two, <code>MyType(12)</code> works just fine, but type assertion is different from converting: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">https://golang.org/ref/spec#Type_assertions</a></p>\n\n<p>If you'd like to do some reading about interfaces and types and all of that fun stuff, these are both super helpful:</p>\n\n<p><a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow\">http://blog.golang.org/laws-of-reflection</a></p>\n\n<p><a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow\">http://research.swtch.com/interfaces</a></p>\n"}], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "accepted_answer_id": 31933240, "answer_count": 1, "score": 1, "last_activity_date": 1439267966, "creation_date": 1439249683, "question_id": 31930855, "link": "https://stackoverflow.com/questions/31930855/type-assertion-failed-when-using-two-different-but-identical-types", "title": "Type assertion failed when using two different (but identical) types", "body": "<p>I have this code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyType int\n\nfunc main() {\n    var i interface{} = 12\n\n    f := i.(MyType)\n\n    fmt.Println(f)\n}\n</code></pre>\n\n<p>However, I get this error:</p>\n\n<pre><code>panic: interface conversion: interface is int, not main.MyType\n</code></pre>\n\n<p>However, int is, in this case, the same as MyType. Is there any way to do this without using the same type?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1439253818, "post_id": 31930782, "comment_id": 51774464, "body": "Note that the global mutex-protected map of gorilla/context has a pretty low performance hit: I benchmarked this last week and saw a &lt; 2k req/s difference with a lot of concurrency (GOMAXPROCS=8) - 40k req/s vs. 42k req/s for non-global map (for an artificial situation where I was only hitting the map, making results worse). The other solution is to satisfy <code>http.Handler</code> with a <code>func(context.Context, http.ResponseWriter, r *http.Request)</code> type that threads a <code>net&#47;context.Context</code> through the handlers that need it: <a href=\"https://joeshaw.org/net-context-and-http-handler/#custom-context-handler-types\" rel=\"nofollow noreferrer\">joeshaw.org/net-context-and-http-handler/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1439309928, "post_id": 31945494, "comment_id": 51803593, "body": "That&#39;s clever. I suppose the reason to wrap Request.Body rather than Request, is because .Body is an interface, right?  Any reason not to wrap, say, ResponseWriter instead? (I&#39;m just trying to understand the full implications of this design)"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1439310069, "post_id": 31945494, "comment_id": 51803675, "body": "exactly, Request is a struct so you can&#39;t really wrap that.  As for Request.Body vs ResponseWriter... No reason other than I personally think of a context object as being part of processing a request.  And not so much about the response itself.  just a personal preference"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1439310124, "post_id": 31945494, "comment_id": 51803718, "body": "Makes sense.  Thanks for the explanation."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1439305641, "creation_date": 1439305641, "answer_id": 31945494, "question_id": 31930782, "link": "https://stackoverflow.com/questions/31930782/how-to-handle-per-request-context-with-net-http/31945494#31945494", "title": "How to handle per-request context with net/http", "body": "<p>You can cheat and wrap the Request.Body (a ReaderCloser interface) with your context.</p>\n\n<p>Here's an example: <a href=\"https://github.com/dbudworth/webctx/blob/master/webctx.go\" rel=\"nofollow\">webctx.go</a></p>\n\n<p>when you want your context, just type assert request.Body to be your type.\nOnly trick is your type must hold the original body and implement the ReaderCloser methods... but that's a minimal amount of code.</p>\n"}], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1439305641, "creation_date": 1439249217, "last_edit_date": 1495540284, "question_id": 31930782, "link": "https://stackoverflow.com/questions/31930782/how-to-handle-per-request-context-with-net-http", "title": "How to handle per-request context with net/http", "body": "<p>The first half of <a href=\"https://stackoverflow.com/a/26754076/13860\">this answer</a> demonstrates a pattern for sharing some per-request context between two handler methods. Sort of.</p>\n\n<p>I'm looking for a way to do basically this, but with more than two handlers.</p>\n\n<p>Imagine I need to call three (or more) <code>http.HandlerFunc</code>s with the same per-request context:</p>\n\n<ul>\n<li>Auth()</li>\n<li>DoStuff()</li>\n<li>OutputHTML()</li>\n</ul>\n\n<p>Without resorting to a global map (e.g. gorilla/mux), is there any way, using the standard <code>http.Handler</code> interface, to pass per-request context between these functions?</p>\n"}, {"tags": ["networking", "go", "ip"], "answers": [{"tags": [], "owner": {"reputation": 1406, "user_id": 5114938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95d86da9d18d258110186a0cd8659b7f?s=128&d=identicon&r=PG&f=1", "display_name": "Sleafar", "link": "https://stackoverflow.com/users/5114938/sleafar"}, "is_accepted": true, "score": 2, "last_activity_date": 1439246617, "creation_date": 1439246617, "answer_id": 31930384, "question_id": 31930196, "link": "https://stackoverflow.com/questions/31930196/how-to-find-the-host-name-on-the-network-given-the-ip-address-using-go-programmi/31930384#31930384", "title": "how to find the host name on the network given the ip address using go programming language", "body": "<p><a href=\"http://golang.org/pkg/net/#LookupAddr\" rel=\"nofollow\">LookupAddr</a> should do what you are looking for:</p>\n\n<blockquote>\n  <p>LookupAddr performs a reverse lookup for the given address, returning a list of names mapping to that address.</p>\n</blockquote>\n"}], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 31930384, "answer_count": 1, "score": 0, "last_activity_date": 1439246617, "creation_date": 1439245563, "question_id": 31930196, "link": "https://stackoverflow.com/questions/31930196/how-to-find-the-host-name-on-the-network-given-the-ip-address-using-go-programmi", "title": "how to find the host name on the network given the ip address using go programming language", "body": "<p>Using go programming language, I'm able to find the IP address given the host name, but what I'm looking for is to find the host name given the ip address. I tried researching the \"net\" package, but no luck. </p>\n\n<p>Is this something possible in golang? please advice.</p>\n"}, {"tags": ["go", "raku"], "comments": [{"owner": {"reputation": 31843, "user_id": 1337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72de240484e389dbedb6a3e428b9f0c1?s=128&d=identicon&r=PG", "display_name": "Brad Gilbert", "link": "https://stackoverflow.com/users/1337/brad-gilbert"}, "edited": false, "score": 1, "creation_date": 1439245425, "post_id": 31927114, "comment_id": 51772220, "body": "ThreadPoolScheduler starts with 16 max threads, you will have to change that I believe."}], "answers": [{"comments": [{"owner": {"reputation": 48798, "user_id": 223226, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/iGqE4.png?s=128&g=1", "display_name": "mpapec", "link": "https://stackoverflow.com/users/223226/mpapec"}, "edited": false, "score": 0, "creation_date": 1439270832, "post_id": 31931950, "comment_id": 51778884, "body": "Coroutines (cooperative and concurrent routines) in perl5 can be compared to goroutines as they use non blocking IO, and execute on one (or more) threads. Main advantage over threads is low memory footprint for equal number of network connections and better server scalability."}], "tags": [], "owner": {"reputation": 31843, "user_id": 1337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72de240484e389dbedb6a3e428b9f0c1?s=128&d=identicon&r=PG", "display_name": "Brad Gilbert", "link": "https://stackoverflow.com/users/1337/brad-gilbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1459823734, "last_edit_date": 1459823734, "creation_date": 1439257879, "answer_id": 31931950, "question_id": 31927114, "link": "https://stackoverflow.com/questions/31927114/is-there-an-equivalent-to-go-goroutines-in-perl6/31931950#31931950", "title": "Is there an equivalent to Go goroutines in Perl6?", "body": "\n\n<p>From what I understand goroutines are a very low level construct.<br>\nMost things in Perl are not very low level.</p>\n\n<p>The closest to what you think you want is probably to directly use <a href=\"http://doc.perl6.org/type/Thread\" rel=\"nofollow\">Threads</a>.</p>\n\n<pre class=\"lang-perl6 prettyprint-override\"><code>my @r = do for ^100 { # currently aborts if it's much over 100\n  Thread.start: { .say; sleep 3 };\n}\n\n# The implementation may actually create several threads\n# for this construct\n@r&gt;&gt;.finish;\n</code></pre>\n\n<p>I highly recommend you not do that though as it is not very composable.</p>\n\n<hr>\n\n<p>If you instead wanted to print out the numbers after waiting 3 seconds I would have used the <code>.in</code> method of <a href=\"http://doc.perl6.org/type/Promise\" rel=\"nofollow\">Promise</a> which returns a <a href=\"http://doc.perl6.org/type/Promise\" rel=\"nofollow\">Promise</a> that will be kept in that many seconds.<br>\nThis example appears to create 500 threads nearly simultaneously, but may not actually start any additional threads.</p>\n\n<pre class=\"lang-perl6 prettyprint-override\"><code>my @r = (^500).map: {\n  Promise.in(3).then: -&gt; $ { .say }\n}\nawait @r;\n</code></pre>\n\n<hr>\n\n<p>Perl 6 also has <a href=\"http://doc.perl6.org/type/Supply\" rel=\"nofollow\">Supplies</a> and <a href=\"http://doc.perl6.org/type/Channel\" rel=\"nofollow\">Channels</a></p>\n\n<pre class=\"lang-perl6 prettyprint-override\"><code># get three events fired each second\nmy $supply = Supply.interval: 1/3;\n\nreact {\n  # not guaranteed to run in order.\n  whenever $supply.grep(* %% 3) { print 'Fizz' }\n  whenever $supply.grep(* %% 5) { print 'Buzz' }\n\n  whenever $supply {\n    sleep 1/10; # fudge the timing a little\n    .put\n  }\n\n  whenever Promise.in(10) {\n    say 'ten seconds have elapsed';\n    done\n  }\n}\n</code></pre>\n\n<hr>\n\n<p>In general the design of asynchronous constructs are there to hide some of the hairier things you have to handle with threads.</p>\n\n<p>In fact one of the easiest ways to use threads may well be to just add <a href=\"http://doc.perl6.org/routine/hyper\" rel=\"nofollow\"><code>hyper</code></a> or <a href=\"http://doc.perl6.org/routine/race\" rel=\"nofollow\"><code>race</code></a> before a <a href=\"http://doc.perl6.org/routine/map\" rel=\"nofollow\"><code>map</code></a> or <a href=\"http://doc.perl6.org/routine/grep\" rel=\"nofollow\"><code>grep</code></a> method call:</p>\n\n<pre class=\"lang-perl6 prettyprint-override\"><code>my @r = (^50).hyper( :batch(5), :degree(10) ).map: { .say; sleep 1 }\n# use `race` instead of `hyper` if you don't\n# care about the order of @r\n</code></pre>\n"}], "owner": {"reputation": 48798, "user_id": 223226, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/iGqE4.png?s=128&g=1", "display_name": "mpapec", "link": "https://stackoverflow.com/users/223226/mpapec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 2, "accepted_answer_id": 31931950, "answer_count": 1, "score": 3, "last_activity_date": 1575223194, "creation_date": 1439233149, "last_edit_date": 1575223194, "question_id": 31927114, "link": "https://stackoverflow.com/questions/31927114/is-there-an-equivalent-to-go-goroutines-in-perl6", "title": "Is there an equivalent to Go goroutines in Perl6?", "body": "<p>I can see that</p>\n\n<pre><code>perl6 -e '@r = do for ^500 {start { .say; sleep 3 }}; await @r'\n</code></pre>\n\n<p>makes about a dozen of <code>moar</code> threads on my system and use them as pool for promises, but I would like to start them all at once like in Go. Is that possible?</p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439235087, "post_id": 31926976, "comment_id": 51767512, "body": "Have you tested the go1.5 rc to see if it behaves any differently? Can you supply a complete, runnable example? I don&#39;t see anything else obvious, but this is more of a question for the mailing list if you want some debugging help (though things may be a little slow with the impending release)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439235746, "post_id": 31926976, "comment_id": 51767833, "body": "Tried the mailing list, no response (my msg didn&#39;t even post- maybe mods are busy or something).  I don&#39;t want debugging help - I want to know if the address of that value changing (a simple &quot;var x &lt;type&gt;&quot; on the Go stack) as demonstrated  is legitimate/intended behavior or not.   The question is &quot;is this a bug&quot;?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439235845, "post_id": 31926976, "comment_id": 51767879, "body": "Haven&#39;t tried development / bleeding edge Go.   If I could make a minimal test case, I would have used it here - as I said this thing happens randomly, on some builds yes and on some builds no - and involves a popular (large) C library...."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439236019, "post_id": 31926976, "comment_id": 51767978, "body": "(Happy to replicate my testing environment on a temporary cloud instance if anyone familiar with cgo internals wants to play with it in situ)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439242991, "post_id": 31926976, "comment_id": 51771304, "body": "If I move _outptr_7 to the global scope, there is no problem (the value does not change).   If I add a line that prints out the value of &amp;_outptr_7 /after/ the C call, there is no problem (the value does not change).... =/"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439243298, "post_id": 31926976, "comment_id": 51771416, "body": "Compiling with gccgo also eliminates the problem.   That&#39;s my workaround for now."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439245003, "post_id": 31926976, "comment_id": 51772063, "body": "As I suggested, have you tried go1.5 yet? It may be escape analysis related, which there are fixes in place. Go pointers need to be alive for the entire lifetime of a cgo call, but this didn&#39;t always happen for stack allocated values in go1.4 that were marked as non-escaping."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439264594, "post_id": 31926976, "comment_id": 51777146, "body": "Yeah, 1.5 also fixes it - and what you are saying makes sense with regard to what I&#39;m seeing.   Thanks for the suggestion.  Is there a specific related bug 1.5 addresses that you know of?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439301383, "post_id": 31926976, "comment_id": 51797487, "body": "It was probably <a href=\"https://golang.org/issue/10303\" rel=\"nofollow noreferrer\">golang.org/issue/10303</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439348159, "post_id": 31926976, "comment_id": 51819485, "body": "Awesome, make that an answer if you like.  TYVM."}], "answers": [{"tags": [], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "is_accepted": true, "score": 0, "last_activity_date": 1445964238, "creation_date": 1445964238, "answer_id": 33373720, "question_id": 31926976, "link": "https://stackoverflow.com/questions/31926976/how-to-resolve-changing-pointer-value-in-function-call-is-this-a-cgo-bug/33373720#33373720", "title": "How to resolve changing pointer value in function call? Is this a cgo bug?", "body": "<p>This is due to a bug in Go 1.4.  Fixed in 1.5.</p>\n\n<p><a href=\"https://golang.org/issue/10303\" rel=\"nofollow\">https://golang.org/issue/10303</a></p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 33373720, "answer_count": 1, "score": 1, "last_activity_date": 1445964238, "creation_date": 1439232589, "last_edit_date": 1439233562, "question_id": 31926976, "link": "https://stackoverflow.com/questions/31926976/how-to-resolve-changing-pointer-value-in-function-call-is-this-a-cgo-bug", "title": "How to resolve changing pointer value in function call? Is this a cgo bug?", "body": "<p>I'm calling a C function via cgo thusly:</p>\n\n<pre><code>var _outptr_7 C.double \nvar _outptr_8 C.double  \nvar kk uintptr = uintptr(unsafe.Pointer(&amp;_outptr_7))\ngogsl.InitializeGslFunction(f)\n_result := int32(C.gsl_integration_qags((*C.gsl_function)(unsafe.Pointer(f.CPtr())), C.double(a), C.double(b), C.double(epsabs), C.double(epsrel), C.size_t(limit), (*C.gsl_integration_workspace)(unsafe.Pointer(workspace.Ptr())), (*C.double)(&amp;_outptr_7), (*C.double)(&amp;_outptr_8)))\nfmt.Printf(\"%10.10X\\n\",kk)\nreturn _result, *(*float64)(unsafe.Pointer(&amp;_outptr_7)), *(*float64)(unsafe.Pointer(&amp;_outptr_8))\n</code></pre>\n\n<p>Now, the <code>kk</code> is here for debugging purposes.  I've modified the C function <code>gsl_integration_qags</code> to output the 8th argument it receives (that's <code>&amp;_outptr_7</code>, the <code>_&lt;n&gt;</code> count from 0!)  </p>\n\n<p>(The <code>InitializeGslFunction</code> can be ignored for the purpose here...)</p>\n\n<p>The two values - <code>kk</code> and the C function output - match exactly.</p>\n\n<p>However, I get a <em>different</em> number out than the C function returns - it sets the 8th argument via indirection.   I'm sure this is correct, I've watched it work in gdb.</p>\n\n<p>It looks like this: (omitting lines that just read <code>(gdb)</code> where I hit enter to repeat command)</p>\n\n<pre><code>Breakpoint 3, qags (f=0xc20800a260, a=0, b=1, epsabs=0, epsrel=9.9999999999999995e-08, limit=1000, workspace=0x782ec0, result=0xc208031e28, abserr=0xc208031e20, q=0x7ffff79ad12c &lt;gsl_integration_qk21&gt;)\n at qags.c:479\n479   *result = res_ext;\n(gdb) n\n480   *abserr = err_ext;\n(gdb) p *result\n$1 = -4.0000000000000853\n(gdb) p result\n$2 = (double *) 0xc208031e28\n(gdb) n\n482   if (err_ext == GSL_DBL_MAX)\n485   if (error_type || error_type2)\n513     double max_area = GSL_MAX_DBL (fabs (res_ext), fabs (area)); \n515     if (!positive_integrand &amp;&amp; max_area &lt; 0.01 * resabs0)\n520     double ratio = res_ext / area;\n522     if (ratio &lt; 0.01 || ratio &gt; 100.0 || errsum &gt; fabs (area))\n526   goto return_error;\n535   if (error_type &gt; 2) \n540   if (error_type == 0) \n542       return GSL_SUCCESS;\n573 }\ngsl_integration_qags (f=0xc20800a260, a=0, b=1, epsabs=0, epsrel=9.9999999999999995e-08, limit=1000, workspace=0x782ec0, result=0xc208031e28, abserr=0xc208031e20) at qags.c:53\n53    return status ;\n54  }\n</code></pre>\n\n<p>// Correct value (-4.0) is being returned from C function.</p>\n\n<pre><code>_cgo_3ce45c051e63_Cfunc_gsl_integration_qags (v=0xc208031db8) at /home/dtrombley/go/src/github.com/dtromb/gogsl/numint/numint.go:241\nasmcgocall () at /usr/lib/golang/src/runtime/asm_amd64.s:669\n669     MOVQ    48(SP), DI\n670     MOVQ    (g_stack+stack_hi)(DI), SI\n671     SUBQ    40(SP), SI\n672     MOVQ    DI, g(CX)\n673     MOVQ    SI, SP\nasmcgocall () at /usr/lib/golang/src/runtime/asm_amd64.s:674\n674     RET\nruntime.asmcgocall_errno () at /usr/lib/golang/src/runtime/asm_amd64.s:627\n627     MOVL    AX, ret+16(FP)\nruntime.asmcgocall_errno () at /usr/lib/golang/src/runtime/asm_amd64.s:628\n628     RET\nruntime.cgocall_errno (fn=0x405210 &lt;_cgo_3ce45c051e63_Cfunc_gsl_integration_qags&gt;, arg=0xc20805fdb8, ~r2=0) at /usr/lib/golang/src/runtime/cgocall.go:132\n132     exitsyscall()\n134     return errno\n</code></pre>\n\n<p>//  cgo C glue is about to return from call into Go caller</p>\n\n<pre><code>github.com/dtromb/gogsl/numint._Cfunc_gsl_integration_qags (p0=0xc20800a260, p1=0, p2=1, p3=0, p4=9.9999999999999995e-08, p5=1000, p6=0x782ec0, p7=0xc20805fe28, p8=0xc20805fe20, r1=0)\nat /home/dtrombley/go/src/github.com/dtromb/gogsl/numint/:92\n92  /home/dtrombley/go/src/github.com/dtromb/gogsl/numint/: No such file or directory.\n</code></pre>\n\n<p>// Bang, it's broken.  p7 value in return val struct is /different than the value that went in/... <strong>the location of _outptr_7 has changed</strong>.</p>\n\n<pre><code>(gdb) p p7\n$3 = (github.com/dtromb/gogsl/numint._Ctype_double *) 0xc20805fe28\n(gdb) p *p7\n$4 = 0\n(gdb) n\ngithub.com/dtromb/gogsl/numint.Qags (f=0xc20805ff58, a=0, b=1, epsabs=0, epsrel=9.9999999999999995e-08, limit=1000, workspace=0xc20800a1d0, ~r7=7753968, ~r8=0, ~r9=0)\nat /home/dtrombley/go/src/github.com/dtromb/gogsl/numint/numint.go:75\n75     fmt.Printf(\"%10.10X\\n\",kk)\nC208031E28\n76     return _result, *(*float64)(unsafe.Pointer(&amp;_outptr_7)), *(*float64)(unsafe.Pointer(&amp;_outptr_8))\n(gdb) p _outptr_7\n$5 = 0\n(gdb) p &amp;_outptr_7\n$6 = (float64 *) 0xc20805fe28\n</code></pre>\n\n<p>// But the correct value is still hanging out there.</p>\n\n<pre><code> (gdb) p $1\n $7 = -4.0000000000000853\n</code></pre>\n\n<p>So, what gives?   What is going on here?  How to fix/workaround?</p>\n\n<p>Here is the cgo binding showing the struct mapping, for completeness:</p>\n\n<pre><code>void\n_cgo_a9ebceabba03_Cfunc_gsl_integration_qags(void *v)\n{\n    struct {\n            gsl_function* p0;\n            double p1;\n            double p2;\n            double p3;\n            double p4;\n            size_t p5;\n            gsl_integration_workspace* p6;\n            double* p7;\n            double* p8;\n            int r;\n            char __pad76[4];\n    } __attribute__((__packed__, __gcc_struct__)) *a = v;\n    char *stktop = _cgo_topofstack();\n    __typeof__(a-&gt;r) r = gsl_integration_qags((void*)a-&gt;p0, a-&gt;p1, a-&gt;p2, a-&gt;p3, a-&gt;p4, a-&gt;p5, (void*)a-&gt;p6, (void*)a-&gt;p7, (void*)a-&gt;p8);\n    a = (void*)((char*)a + (_cgo_topofstack() - stktop));\n    a-&gt;r = r;\n}\n</code></pre>\n\n<p>The bug occurs or does not occur randomly depending on some details of the compilation which should not affect semantics - adding a line which prints out &amp;_outptr_7 before calling the C function causes it to return correctly, for example.   Making other changes to the code reverts it back, etc etc. </p>\n\n<p>Something I'm doing wrong?  Or bug in cgo?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1439233014, "post_id": 31926732, "comment_id": 51766435, "body": "You need to use <code>v</code>, not <code>number</code> to access the field values inside the type switch"}], "answers": [{"comments": [{"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1439232408, "post_id": 31926831, "comment_id": 51766107, "body": "That just returns <code>undefined: Float64</code> I didn&#39;t down vote BTW."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439232530, "post_id": 31926831, "comment_id": 51766180, "body": "This is incorrect syntax as well. <a href=\"https://play.golang.org/p/9bysKpaGAe\" rel=\"nofollow noreferrer\">This</a> will work but is a bad idea (e.g. when <code>Valid</code> is false)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1439232803, "post_id": 31926831, "comment_id": 51766320, "body": "@Arel yeah, sorry that should have been <code>float64</code> (since it&#39;s the type) but my diagnosis of your problem was just incorrect. I skimmed the code a little fast and thought you were trying to a type assert, you&#39;re actually just trying to access a property on a type. I&#39;ll update my answer when I have a minute."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439233312, "post_id": 31926831, "comment_id": 51766579, "body": "@DaveC yeah I didn&#39;t really read the code very closely and just thought those were type asserts with syntactical errors. Anyway, I&#39;ve edited with the correct solution and explanation for what it is that way."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1439233458, "post_id": 31926831, "comment_id": 51766651, "body": "@Arel apologies on the previous answer, didn&#39;t really read your question so much as put down my first thought as an answer. Updated answer should shore things up and will hopefully offer some understanding."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1439233148, "last_edit_date": 1439233148, "creation_date": 1439232124, "answer_id": 31926831, "question_id": 31926732, "link": "https://stackoverflow.com/questions/31926732/calling-methods-on-sql-nullfloat64-passed-in-through-interface-throws-error/31926831#31926831", "title": "Calling methods on sql.NullFloat64 passed in through interface{} throws error", "body": "<p>The actual value of number (whatever type it is) is assigned to <code>v</code> in the type switch. The problem is you're re-using <code>number</code> in the assignment to <code>newNumber</code>, that is still the same old <code>interface{}</code> when you go into the <code>case sql.NullFloat64</code> that is the type of <code>v</code> which has the value of <code>number</code> in it so you'll want to use it for assignment.</p>\n\n<pre><code>func convertToRealNum(number interface{}) interface{}{\n var newNumber interface{} \n switch v := number.(type) { \n  default:\n    log.Fatal(\"unexpected type %T\", v)\n  case sql.NullFloat64:\n    newNumber = v.Float64\n  case sql.NullInt64:\n    newNumber = v.Int64\n  }\n  return newNumber  \n}\n</code></pre>\n"}], "owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 31926831, "answer_count": 1, "score": -2, "last_activity_date": 1439233148, "creation_date": 1439231768, "question_id": 31926732, "link": "https://stackoverflow.com/questions/31926732/calling-methods-on-sql-nullfloat64-passed-in-through-interface-throws-error", "title": "Calling methods on sql.NullFloat64 passed in through interface{} throws error", "body": "<p>I have a simple function that looks like this:</p>\n\n<pre><code>func convertToRealNum(number interface{}) interface{}{\n  switch v := number.(type) { \n  default:\n    log.Fatal(\"unexpected type %T\", v)\n  case sql.NullFloat64:\n    newNumber := number.Float64\n  case sql.NullInt64:\n    newNumber := number.Int64\n  }\n  return newNumber \n}\n</code></pre>\n\n<p>number is either a <code>NullFloat64</code> or a <code>NullInt64</code>. If number is the type NullFloat64, I call number.Float64 on it and get back the value of the number as a Float64. If I try to call the same thing inside a function that takes number as an argument that is an interface{} I get the compile error:</p>\n\n<p><code>number.Float64 undefined (type interface {} has no field or method Float64)</code></p>\n\n<p>Inside the function, if I call reflect.TypeOf(number) it'll return NullFloat64, so it knows what type it is, but I can't call that types methods. </p>\n"}, {"tags": ["go", "multipartform-data"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1439228203, "post_id": 31925255, "comment_id": 51763932, "body": "Alternative #1 is correct.  What is the error return from r.ParseMulipartForm?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1439228380, "post_id": 31925255, "comment_id": 51764024, "body": "As noted your example looks fine. Have you confirmed that the request body has any data? I would recommend printing the POST body and comparing that output to what you&#39;re expecting to parse out of the form."}, {"owner": {"reputation": 1, "user_id": 4819762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f8e21bdd0aea0e244f8873cfe8880f?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/4819762/fredrik"}, "edited": false, "score": 0, "creation_date": 1439230630, "post_id": 31925255, "comment_id": 51765204, "body": "Yes, I&#39;ve already verified that I get the values when I print the POST body.  The error I get from .ParseMultipartForm: multipart: NextPart: EOF"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1439238565, "post_id": 31925255, "comment_id": 51769244, "body": "It looks like the form is incomplete.  What are you using to generate the form?"}, {"owner": {"reputation": 1, "user_id": 4819762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f8e21bdd0aea0e244f8873cfe8880f?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/4819762/fredrik"}, "edited": false, "score": 0, "creation_date": 1439271130, "post_id": 31925255, "comment_id": 51778993, "body": "Yes, you&#39;re correct. I had some error in the code that created the form (in Go). Thanks! Alternative #1 is correct."}], "owner": {"reputation": 1, "user_id": 4819762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f8e21bdd0aea0e244f8873cfe8880f?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/4819762/fredrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 864, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439227372, "creation_date": 1439226236, "last_edit_date": 1495540679, "question_id": 31925255, "link": "https://stackoverflow.com/questions/31925255/go-extract-form-values-from-multipart-post", "title": "Go, extract form values from multipart POST", "body": "<p>I've been struggle a lot with extracting form values from a multipart request form in Go. The form contains x number of key : values and also a file.</p>\n\n<p>The parts do exist in the BODY when I print the whole body.</p>\n\n<p><strong>Alternative 1:</strong></p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request) {\n    r.ParseMultipartForm(0)\n\n    fmt.Println(r.FormValue(\"key\"))\n}\n</code></pre>\n\n<p>This returns only empty values.</p>\n\n<p><strong>Alternative 2:</strong></p>\n\n<p>My second approach was to do something like this with MultipartReader():</p>\n\n<p><a href=\"https://stackoverflow.com/questions/25061784/read-request-payload-in-go\">Read request payload in Go?</a></p>\n\n<p>However, this give me \"unexpected EOF\" before getting the last value with FormValue(). It does however print 9/10 values.</p>\n\n<p>Can someone with more experience with Go give some hints how to fix this? And yes, I think I've searched the whole net for a solution now. Nothing seems to work.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "download", "installation", "command-line-interface", "cloud-foundry"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3711631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f859983cfbcc4acc0d4db7fef9d5d52?s=128&d=identicon&r=PG&f=1", "display_name": "Dil123", "link": "https://stackoverflow.com/users/3711631/dil123"}, "edited": false, "score": 0, "creation_date": 1439253502, "post_id": 31924576, "comment_id": 51774399, "body": "Yes..but if I need to access the CLI tool from anywhere in the system, I cannot be using the executable right? Because to run the executable I should be in the path of the executable."}, {"owner": {"reputation": 12066, "user_id": 96740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/cf8a610127d1108dfe67f673320b5fe5?s=128&d=identicon&r=PG", "display_name": "cpjolicoeur", "link": "https://stackoverflow.com/users/96740/cpjolicoeur"}, "edited": false, "score": 0, "creation_date": 1439253750, "post_id": 31924576, "comment_id": 51774452, "body": "Yes. You should put the binary somewhere that is in your PATH. Probably something like <code>&#47;usr&#47;local&#47;bin</code>"}, {"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "reply_to_user": {"reputation": 12066, "user_id": 96740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/cf8a610127d1108dfe67f673320b5fe5?s=128&d=identicon&r=PG", "display_name": "cpjolicoeur", "link": "https://stackoverflow.com/users/96740/cpjolicoeur"}, "edited": false, "score": 0, "creation_date": 1439256470, "post_id": 31924576, "comment_id": 51775134, "body": "Yeah what @cpjolicoeur said. If you&#39;re on windows just go to System Properties &gt; Advanced System Settings &gt; Environment Variables &gt; PATH and add &quot;;C:\\path\\to\\your\\file\\mycli.exe&quot; then just open up a command pompt and type mycli"}], "tags": [], "owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "is_accepted": false, "score": 1, "last_activity_date": 1439225990, "last_edit_date": 1439225990, "creation_date": 1439223792, "answer_id": 31924576, "question_id": 31924548, "link": "https://stackoverflow.com/questions/31924548/install-go-cli-application-without-having-go-installed/31924576#31924576", "title": "Install Go CLI application without having Go installed", "body": "<p>Go compiles to one executable, the end user does not need go installed.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 3711631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f859983cfbcc4acc0d4db7fef9d5d52?s=128&d=identicon&r=PG&f=1", "display_name": "Dil123", "link": "https://stackoverflow.com/users/3711631/dil123"}, "edited": false, "score": 0, "creation_date": 1439253624, "post_id": 31925746, "comment_id": 51774425, "body": "Looks like this tool can be useful. Thanks"}], "tags": [], "owner": {"reputation": 12066, "user_id": 96740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/cf8a610127d1108dfe67f673320b5fe5?s=128&d=identicon&r=PG", "display_name": "cpjolicoeur", "link": "https://stackoverflow.com/users/96740/cpjolicoeur"}, "is_accepted": false, "score": 0, "last_activity_date": 1439228006, "creation_date": 1439228006, "answer_id": 31925746, "question_id": 31924548, "link": "https://stackoverflow.com/questions/31924548/install-go-cli-application-without-having-go-installed/31925746#31925746", "title": "Install Go CLI application without having Go installed", "body": "<p>You could try a newly released tool like <a href=\"https://github.com/soheilhy/goget\" rel=\"nofollow\">goget.sh</a></p>\n"}], "owner": {"reputation": 1, "user_id": 3711631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f859983cfbcc4acc0d4db7fef9d5d52?s=128&d=identicon&r=PG&f=1", "display_name": "Dil123", "link": "https://stackoverflow.com/users/3711631/dil123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1439228006, "creation_date": 1439223692, "last_edit_date": 1439227961, "question_id": 31924548, "link": "https://stackoverflow.com/questions/31924548/install-go-cli-application-without-having-go-installed", "title": "Install Go CLI application without having Go installed", "body": "<p>If I already have Go installed on my computer, I can easily install a CLI application using this <a href=\"https://github.com/codegangsta/cli\" rel=\"nofollow\">github repository</a>.  I need to install a CLi application on a machine that does not have Go installed (like the CloudFoundry CLI) - how can I do that?</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 961786, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/c583f2c2db98cd0c19a9c6bc41b66bd4?s=128&d=identicon&r=PG", "display_name": "tommy_p1ckles", "link": "https://stackoverflow.com/users/961786/tommy-p1ckles"}, "edited": false, "score": 0, "creation_date": 1439223524, "post_id": 31924317, "comment_id": 51761483, "body": "Well I know that It&#39;s always going to be a slice, either empty or not. However I need to be able to get the fields of the slice elements type regardless."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 327, "user_id": 961786, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/c583f2c2db98cd0c19a9c6bc41b66bd4?s=128&d=identicon&r=PG", "display_name": "tommy_p1ckles", "link": "https://stackoverflow.com/users/961786/tommy-p1ckles"}, "edited": false, "score": 1, "creation_date": 1439223778, "post_id": 31924317, "comment_id": 51761627, "body": "@tommy_p1ckles: Your question was about a crash when the slice is empty, so you need to ensure that it isn&#39;t. What else do you mean?"}, {"owner": {"reputation": 327, "user_id": 961786, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/c583f2c2db98cd0c19a9c6bc41b66bd4?s=128&d=identicon&r=PG", "display_name": "tommy_p1ckles", "link": "https://stackoverflow.com/users/961786/tommy-p1ckles"}, "edited": false, "score": 0, "creation_date": 1439224001, "post_id": 31924317, "comment_id": 51761738, "body": "Sorry I guess I worded it poorly. My function takes a slice of structs and I need to be able to get the names of all the fields of the struct, this isn&#39;t a problem when the struct is nonempty as the code &quot;fields := structs.Fields(val.Index(0).Interface())&quot; does that, however if the slice is empty then this approach doesn&#39;t work since theres no first element to look at."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 327, "user_id": 961786, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/c583f2c2db98cd0c19a9c6bc41b66bd4?s=128&d=identicon&r=PG", "display_name": "tommy_p1ckles", "link": "https://stackoverflow.com/users/961786/tommy-p1ckles"}, "edited": false, "score": 1, "creation_date": 1439225183, "post_id": 31924317, "comment_id": 51762365, "body": "@tommy_p1ckles: OK, I see. I added how to get the type from within a slice."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1439225148, "last_edit_date": 1439225148, "creation_date": 1439223019, "answer_id": 31924317, "question_id": 31924199, "link": "https://stackoverflow.com/questions/31924199/get-fields-of-empty-struct-slice-in-go/31924317#31924317", "title": "Get fields of empty struct slice in Go", "body": "<p>You need to check first if you have a slice to begin with, then check if you have an empty slice, and you probably should check that you have a struct too while you're at it: (<a href=\"http://play.golang.org/p/r2PWqZoEbi\" rel=\"nofollow\">example</a>)</p>\n\n<pre><code>val := reflect.ValueOf(v)\nif val.Kind() != reflect.Slice {\n    fmt.Println(\"not a slice\")\n    return\n}\n\nif val.Len() == 0 {\n    fmt.Println(\"empty slice\")\n    return\n}\n\nif val.Index(0).Kind() != reflect.Struct {\n    fmt.Println(\"not a slice of structs\")\n    return\n}\n\nfields := structs.Fields(val.Index(0).Interface())\n...\n</code></pre>\n\n<p>If you only want the fields from a struct <em>type</em>, regardless of if the slice is empty, you can use the slice type's <code>Elem</code> method to extract it (<a href=\"http://play.golang.org/p/kp_7C4hEwP\" rel=\"nofollow\">example</a>)</p>\n\n<pre><code>// get the internal type of the slice\nt := val.Type().Elem()\nif t.Kind() != reflect.Struct {\n    fmt.Println(\"not a struct\")\n    return\n}\n\nfmt.Println(\"Type:\", t)\nfor i := 0; i &lt; t.NumField(); i++ {\n    fmt.Println(t.Field(i).Name)\n}\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 961786, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/c583f2c2db98cd0c19a9c6bc41b66bd4?s=128&d=identicon&r=PG", "display_name": "tommy_p1ckles", "link": "https://stackoverflow.com/users/961786/tommy-p1ckles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "accepted_answer_id": 31924317, "answer_count": 1, "score": -1, "last_activity_date": 1439225148, "creation_date": 1439222627, "question_id": 31924199, "link": "https://stackoverflow.com/questions/31924199/get-fields-of-empty-struct-slice-in-go", "title": "Get fields of empty struct slice in Go", "body": "<p>I have a function </p>\n\n<pre><code>func (r *render) foo(v interface{}) {\n    val := reflect.ValueOf(v)\n    fields := structs.Fields(val.Index(0).Interface())\n\n...\n</code></pre>\n\n<p>Which takes a slice of structs and tries to get the fields of v, \nhowever if v is empty then \"val.Index(0)\" crashes the program. Is there a better way to do this?</p>\n"}, {"tags": ["javascript", "android", "css", "html", "go"], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 5211697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feaa0a0fc85d2bc8e43f1f30bf21ec86?s=128&d=identicon&r=PG&f=1", "display_name": "fielfdjf", "link": "https://stackoverflow.com/users/5211697/fielfdjf"}, "is_accepted": false, "score": 0, "last_activity_date": 1439223597, "creation_date": 1439223597, "answer_id": 31924518, "question_id": 31924098, "link": "https://stackoverflow.com/questions/31924098/golang-and-html5-css-javascript-android-apps/31924518#31924518", "title": "Golang and HTML5 / CSS / JavaScript (ANDROID apps)", "body": "<p>gobind it possible to call Go functions from Java and Objective-C.\n<a href=\"https://godoc.org/golang.org/x/mobile/cmd/gobind\" rel=\"nofollow\">https://godoc.org/golang.org/x/mobile/cmd/gobind</a></p>\n\n<p>You can write a plugin for cordova. It can call Go functions.</p>\n\n<p>Cordova can help you to build hybrid app with HTML5/JavaScript.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9785248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bfb6ae4ae1c92446896b4857a8c9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "jaracil", "link": "https://stackoverflow.com/users/9785248/jaracil"}, "is_accepted": false, "score": 1, "last_activity_date": 1526243778, "creation_date": 1526243778, "answer_id": 50320437, "question_id": 31924098, "link": "https://stackoverflow.com/questions/31924098/golang-and-html5-css-javascript-android-apps/50320437#50320437", "title": "Golang and HTML5 / CSS / JavaScript (ANDROID apps)", "body": "<p>You can use <a href=\"https://github.com/gopherjs/gopherjs\" rel=\"nofollow noreferrer\">GopherJS</a> transpiler from Golang to JS and <a href=\"https://github.com/jaracil/goco\" rel=\"nofollow noreferrer\">goco</a>.</p>\n"}], "owner": {"reputation": 748, "user_id": 1617548, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/71837144a8831dea7319f5ff0650a62d?s=128&d=identicon&r=PG", "display_name": "vmandke", "link": "https://stackoverflow.com/users/1617548/vmandke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1526243778, "creation_date": 1439222277, "question_id": 31924098, "link": "https://stackoverflow.com/questions/31924098/golang-and-html5-css-javascript-android-apps", "title": "Golang and HTML5 / CSS / JavaScript (ANDROID apps)", "body": "<p>Is there a way to integrate golang and HTML5 / Javascript to create mobile apps? \nI was going through </p>\n\n<blockquote>\n  <p><a href=\"https://godoc.org/golang.org/x/mobile/app\" rel=\"nofollow\">https://godoc.org/golang.org/x/mobile/app</a> \n  <a href=\"https://godoc.org/golang.org/x/mobile/cmd/gomobile\" rel=\"nofollow\">https://godoc.org/golang.org/x/mobile/cmd/gomobile</a></p>\n</blockquote>\n\n<p>It seems that only OpenGL can be used currently for UI.<br>\nI am new to android app development, but for hybrid apps a chrome instance is launched using java, which renders the HTML pages and runs the JavaScript. \nIs there a similar way to achieve the same using Golang ?</p>\n"}, {"tags": ["reflection", "struct", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1439221979, "post_id": 31923818, "comment_id": 51760501, "body": "I don&#39;t understand what your mean by <code>use reflection to resolve the Struct</code>; can you show what you&#39;re trying to achieve?"}, {"owner": {"reputation": 1997, "user_id": 540771, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/lsQwN.jpg?s=128&g=1", "display_name": "Gayan Hewa", "link": "https://stackoverflow.com/users/540771/gayan-hewa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439229601, "post_id": 31923818, "comment_id": 51764730, "body": "@JimB Added a trivial example on what I am trying to achieve"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439232639, "post_id": 31923818, "comment_id": 51766228, "body": "If you just want to pass it into mgo, you don&#39;t need to do the reflection, just give the interface to <code>c.Insert</code>. Do you need to operate on these structs yourself too?"}, {"owner": {"reputation": 1997, "user_id": 540771, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/lsQwN.jpg?s=128&g=1", "display_name": "Gayan Hewa", "link": "https://stackoverflow.com/users/540771/gayan-hewa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439264061, "post_id": 31923818, "comment_id": 51777030, "body": "Well , I just wanted to have a interface between my persistent layer and the Repositories so that I can change the persistent layer by re-implementing the Interface to support a different Persistent layer without having to change a lot of my other code. Ideally I would have to operate on the structs as well"}], "answers": [{"tags": [], "owner": {"reputation": 901, "user_id": 4175099, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fM964.jpg?s=128&g=1", "display_name": "faisal_kk", "link": "https://stackoverflow.com/users/4175099/faisal-kk"}, "is_accepted": true, "score": 1, "last_activity_date": 1439289671, "creation_date": 1439289671, "answer_id": 31939565, "question_id": 31923818, "link": "https://stackoverflow.com/questions/31923818/resolve-the-struct-passed-to-a-function-in-runtime/31939565#31939565", "title": "Resolve the struct passed to a function in Runtime", "body": "<ol>\n<li><p>Declare your obj type as interface{}</p>\n\n<pre><code>     Update(collection []byte, obj interface{} ) map[string]string  \n</code></pre></li>\n<li><p>Now you can pass Person,Book,Car etc to this function as obj.</p></li>\n<li><p>Use a type switch inside Update function for each actual struct</p>\n\n<pre><code>    switch t := obj.(type){\n    case Car://Handle Car type\n    case Perosn:\n    case Book:\n                  }\n</code></pre>\n\n<p>Structs needs to be decided at compile time.No dynamic types in Go.Even interfaces are static types.</p></li>\n</ol>\n"}], "owner": {"reputation": 1997, "user_id": 540771, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/lsQwN.jpg?s=128&g=1", "display_name": "Gayan Hewa", "link": "https://stackoverflow.com/users/540771/gayan-hewa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 31939565, "answer_count": 1, "score": 0, "last_activity_date": 1439289671, "creation_date": 1439221422, "last_edit_date": 1439229562, "question_id": 31923818, "link": "https://stackoverflow.com/questions/31923818/resolve-the-struct-passed-to-a-function-in-runtime", "title": "Resolve the struct passed to a function in Runtime", "body": "<p>I have the below interface that implements a simpler Active Record Like implementation for my persistent layer.</p>\n\n<pre><code>type DBInterface interface {\n  FindAll(collection []byte) map[string]string\n  FindOne(collection []byte, id int) map[string]string\n  Destroy(collection []byte, id int) bool\n  Update(collection []byte, obj map[string]string ) map[string]string\n  Create(collection []byte, obj map[string]string) map[string]string\n}\n</code></pre>\n\n<p>The application has different collection's that it talks to and different corresponding models. I need to be able to pass in a dynamic Struct , instead of a map for the value obj ( ie. Update , Create Signatures )</p>\n\n<p>I can't seem to understand how to use reflection to resolve the Struct , any guidance would help.</p>\n\n<p>More details on what I am trying explain :</p>\n\n<p>Consider the below snippet from mgo example from <a href=\"https://labix.org/mgo\" rel=\"nofollow\">https://labix.org/mgo</a></p>\n\n<pre><code>    err = c.Insert(&amp;Person{\"Ale\", \"+55 53 8116 9639\"},\n               &amp;Person{\"Cla\", \"+55 53 8402 8510\"})\n</code></pre>\n\n<p>When we insert data to the collection , we do a &amp;Person I want to be able to pass in this bit &amp;Person{\"Ale\", \"+55 53 8116 9639\"} but the method receiving the would only know it in the Run time. Because it could be a Person , Car , Book etc Struct depending on the func calling the method</p>\n"}, {"tags": ["struct", "go"], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 4666524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tb7SI.jpg?s=128&g=1", "display_name": "hotzenplotz", "link": "https://stackoverflow.com/users/4666524/hotzenplotz"}, "is_accepted": false, "score": 2, "last_activity_date": 1439220749, "last_edit_date": 1592644375, "creation_date": 1439220749, "answer_id": 31923598, "question_id": 31923371, "link": "https://stackoverflow.com/questions/31923371/does-a-struct-implement-all-the-interfaces-that-one-of-their-embedded-type-imple/31923598#31923598", "title": "Does a struct implement all the interfaces that one of their embedded type implement?", "body": "<blockquote>\n<p>If S contains an anonymous field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S also includes promoted methods with receiver *T.</p>\n<p>If S contains an anonymous field *T, the method sets of S and *S both include\npromoted methods with receiver T or *T.</p>\n</blockquote>\n<p>B embedded A, so method sets of B include protomoted methods with receiver A, but does not include *A</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1439221749, "last_edit_date": 1439221749, "creation_date": 1439220889, "answer_id": 31923645, "question_id": 31923371, "link": "https://stackoverflow.com/questions/31923371/does-a-struct-implement-all-the-interfaces-that-one-of-their-embedded-type-imple/31923645#31923645", "title": "Does a struct implement all the interfaces that one of their embedded type implement?", "body": "<p>Yes, your struct implements the method set of the embedded type.</p>\n\n<p>However, when you change the signature of <code>Incr</code> to <code>func (a *A) Incr() int</code>, you need a pointer for the receiver of that method. <code>A</code> itself doesn't implement <code>Incr</code> when it has a pointer receiver.</p>\n\n<p>The reason the <code>s.Incr()</code> call works, is that the <code>s</code> value is addressable, and Go automatically references it for the method call. When you pass <code>s</code> to <code>Add</code>, you're attempting to convert it to a <code>C</code> interface, the value would no longer be addressable, and the <code>Incr</code> method isn't in the method set.</p>\n\n<p>In this case, you can either change the embedded type to <code>*A</code>,</p>\n\n<pre><code>type B struct {\n    *A\n    D int\n}\n</code></pre>\n\n<p>take the address of <code>s</code> at the call site</p>\n\n<pre><code>Add(&amp;s)\n</code></pre>\n\n<p>or make <code>s</code> a pointer (<code>*B</code>):</p>\n\n<pre><code>s := &amp;B{}\nAdd(s)\n</code></pre>\n\n<p>The <a href=\"http://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">relevent portion of the spec</a> </p>\n\n<blockquote>\n  <p>Given a struct type S and a type named T, promoted methods are\n  included in the method set of the struct as follows:</p>\n  \n  <ul>\n  <li>If S contains an anonymous field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S also\n  includes promoted methods with receiver *T.</li>\n  <li>If S contains an anonymous field *T, the method sets of S and *S both include promoted methods with receiver T or *T.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 1, "accepted_answer_id": 31923645, "answer_count": 2, "score": 2, "last_activity_date": 1439221749, "creation_date": 1439220037, "question_id": 31923371, "link": "https://stackoverflow.com/questions/31923371/does-a-struct-implement-all-the-interfaces-that-one-of-their-embedded-type-imple", "title": "Does a struct implement all the interfaces that one of their embedded type implement?", "body": "<p>I have this example</p>\n\n<pre><code>// embed project main.go\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    A1 int\n    A2 int\n}\n\nfunc (a A) Incr() int {\n    a.A1++\n    return a.A1\n}\n\ntype B struct {\n    A\n    D int\n}\n\ntype C interface {\n    Incr() int\n}\n\nfunc Add(c C) {\n    d := c.Incr()\n    fmt.Println(d)\n}\n\nfunc main() {\n    var s B\n    s.Incr() //B has Incr\n    Add(s)\n}\n</code></pre>\n\n<p>Using this example i wanted to check whether B implement interface C or not. In this example Add accept s (type B) as input. <strong>B implement C</strong>.</p>\n\n<p>But when i change Incr() method from original to </p>\n\n<pre><code>func (a *A) Incr() int {\n    a.A1++\n    return a.A1\n}\n</code></pre>\n\n<p>It compiler gives the error</p>\n\n<blockquote>\n  <p>./main.go:35: cannot use s (type B) as type C in argument to\n  AddContent:   B does not implement C (Incr method has pointer receiver)</p>\n</blockquote>\n\n<p>So i am still confused whether a struct implement all the interface that one of their embedded type implement.</p>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 5, "creation_date": 1439214343, "post_id": 31920454, "comment_id": 51755000, "body": "It&#39;s not only that &quot;users should never send otherwise bad things happen&quot;. AFAIK, trying to send will just make the compiler bluntly angry at you."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 13, "last_activity_date": 1439212116, "creation_date": 1439212116, "answer_id": 31920454, "question_id": 31920353, "link": "https://stackoverflow.com/questions/31920353/whats-the-difference-between-chan-and-chan-as-a-function-return-type/31920454#31920454", "title": "What&#39;s the difference between &quot;&lt;-chan&quot; and &quot;chan&quot; as a function return type?", "body": "<p>This is an example of a <a href=\"http://golang.org/ref/spec#Channel_types\">receive-only channel</a>.</p>\n\n<blockquote>\n  <p>The optional <code>&lt;-</code> operator specifies the channel direction, send or receive. If no direction is given, the channel is bidirectional. A channel may be constrained only to send or only to receive by conversion or assignment. </p>\n</blockquote>\n\n<p>It's useful to tell the users of your API that they should <em>only</em> receive from that channel and <em>never</em> send, otherwise bad things happen. It is considered a good practice to specify the direction of your channels in public APIs. See also: <a href=\"https://www.reddit.com/r/golang/comments/2acr79/principles_of_designing_go_apis_with_channels/\">Principles of designing Go APIs with channels</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "is_accepted": true, "score": 70, "last_activity_date": 1439242935, "last_edit_date": 1439242935, "creation_date": 1439212235, "answer_id": 31920503, "question_id": 31920353, "link": "https://stackoverflow.com/questions/31920353/whats-the-difference-between-chan-and-chan-as-a-function-return-type/31920503#31920503", "title": "What&#39;s the difference between &quot;&lt;-chan&quot; and &quot;chan&quot; as a function return type?", "body": "<p>Both will work indeed. But one will be more constraining. The form with the arrow pointing away from the <code>chan</code> keyword means that the returned channel will only be able to be pulled from by client code. No pushing allowed : the pushing will be done by the random number generator function. Conversely, there's a third form with the arrow pointing towards <code>chan</code>, that makes said channel write-only to clients.</p>\n\n<pre><code>chan   // read-write\n&lt;-chan // read only\nchan&lt;- // write only\n</code></pre>\n\n<p>These added constraints can improve the expression of intent and tighten the type system : attempts to force stuff into a read-only channel will leave you with a compilation error, and so will attempts to read from a write-only channel. These constraints can be expressed in the return type, but they can also be part of the parameter signature. Like in :</p>\n\n<pre><code>func log(&lt;-chan string) { ...\n</code></pre>\n\n<p>There you can know, just by the signature, that the <code>log</code> function will consume data from the channel, and not send any to it.</p>\n"}], "owner": {"reputation": 1788, "user_id": 1625487, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/92a851513e2283733ad969efae735863?s=128&d=identicon&r=PG", "display_name": "Abs", "link": "https://stackoverflow.com/users/1625487/abs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8150, "favorite_count": 10, "accepted_answer_id": 31920503, "answer_count": 2, "score": 50, "last_activity_date": 1439242935, "creation_date": 1439211856, "question_id": 31920353, "link": "https://stackoverflow.com/questions/31920353/whats-the-difference-between-chan-and-chan-as-a-function-return-type", "title": "What&#39;s the difference between &quot;&lt;-chan&quot; and &quot;chan&quot; as a function return type?", "body": "<p>Golang newbie here. </p>\n\n<p>Is there a functional difference between</p>\n\n<pre><code>func randomNumberGenerator() &lt;-chan int {\n</code></pre>\n\n<p>and </p>\n\n<pre><code>func randomNumberGenerator() chan int {\n</code></pre>\n\n<p>I've tried using both and they seem to work fine for me.</p>\n\n<p>I've seen the former used by Rob Pike (one of Go creators) in his Go Concurrency Patterns talk at Google IO 2012. I've also seen it used in Go's official website. Why add 2 extra characters (\"&lt;-\") when you can omit it? I've tried looking for the difference on the web, but couldn't find it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 4, "creation_date": 1439210028, "post_id": 31919038, "comment_id": 51751808, "body": "This seems like it might be more of session management issue than a go issue.  A common way to handle this is to set a secure session cookie after the user authenticates, then you can use that session is to fetch the user from anywhere in your application."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1439216994, "post_id": 31919803, "comment_id": 51757013, "body": "Note that is you use this verbatim, your ResponseWriter will no longer be a <code>http.Hijacker</code>, <code>http.Flusher</code> or <code>http.CloseNotifier</code>. It&#39;s preferable to use another method to store state, like the <code>golang.org&#47;x&#47;net&#47;context</code> package for example."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439242383, "post_id": 31919803, "comment_id": 51771081, "body": "In addition to @JimB&#39;s comment - <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/context</a> is a simple request context implementation as well."}, {"owner": {"reputation": 1542, "user_id": 3425760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b9413dc067582def6579ec3e7bb2b1a3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohsen Shakiba", "link": "https://stackoverflow.com/users/3425760/mohsen-shakiba"}, "edited": false, "score": 0, "creation_date": 1439353870, "post_id": 31919803, "comment_id": 51820851, "body": "thanks for everyone&#39;s answer, I eventually used a different method, but never the less your answer helped me a lot, I voted up all the answers and comments."}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 4, "last_activity_date": 1439211498, "last_edit_date": 1439211498, "creation_date": 1439210306, "answer_id": 31919803, "question_id": 31919038, "link": "https://stackoverflow.com/questions/31919038/golang-store-userid-in-http-struct/31919803#31919803", "title": "Golang - store userID in http struct", "body": "<p>You could embed http.ResponseWriter into your own struct and add extra fields</p>\n\n<pre><code>type ResponseWriter struct{\n    http.ResponseWriter\n    UserID int\n}\n</code></pre>\n\n<p>Now use your ResponseWriter instead of http.ResponseWriter.</p>\n\n<p>I hope this helps. <a href=\"http://www.goinggo.net/2014/05/methods-interfaces-and-embedded-types.html\" rel=\"nofollow\">Embeded Types</a></p>\n"}], "owner": {"reputation": 1542, "user_id": 3425760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b9413dc067582def6579ec3e7bb2b1a3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohsen Shakiba", "link": "https://stackoverflow.com/users/3425760/mohsen-shakiba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 31919803, "answer_count": 1, "score": -1, "last_activity_date": 1439211498, "creation_date": 1439208162, "question_id": 31919038, "link": "https://stackoverflow.com/questions/31919038/golang-store-userid-in-http-struct", "title": "Golang - store userID in http struct", "body": "<p>I need to store the userID somewhere in the w http.ResponseWriter or the req *http.Request, so that in my handlers I can access them.<br>\nhow can I do this?<br>\nthis is a small demo for what I need:</p>\n\n<pre><code>func test(w http.ResponseWriter, r *http.Request){\n    userID := w.UserID // or something like this\n}\n</code></pre>\n\n<p>again this value MUST be stored in either of these variables so that I can access it in all my http handlers.<br>\nThanks a lot for your time</p>\n"}, {"tags": ["go", "chunked-encoding", "http-chunked"], "comments": [{"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "reply_to_user": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "edited": false, "score": 0, "creation_date": 1439205070, "post_id": 31917142, "comment_id": 51748522, "body": "&quot;header line too long&quot;"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1439207960, "post_id": 31917142, "comment_id": 51750436, "body": "@PaulMooney <a href=\"http://golang.org/pkg/net/http/httputil/#pkg-variables\" rel=\"nofollow noreferrer\">ErrLineTooLong is returned when reading malformed chunked data with lines that are too long</a>. Are you sure your data is not malformed?"}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439210917, "post_id": 31917142, "comment_id": 51752436, "body": "@Ainar-G No, the payload is definitely not malformed. Both Postman and Fiddler display it without issue."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1439211081, "post_id": 31917142, "comment_id": 51752546, "body": "Where do you get <code>chunkedResponse</code> from?"}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1439211503, "post_id": 31917142, "comment_id": 51752861, "body": "A proprietary service \u2013 unfortunately I can\u2019t offer more than a code snippet:  <code>34f0{&quot;otherServiceInfoList&quot;:[],&quot;...0</code>"}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1439211834, "post_id": 31917142, "comment_id": 51753124, "body": "Yes, it&#39;s returned from the net/http package, without any special encoding, etc."}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1439212124, "post_id": 31917142, "comment_id": 51753331, "body": "When you say &quot;above the HTTP layer&quot; are you referring to some form of encoding applied before the payload is sent down the wire?"}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1439212739, "post_id": 31917142, "comment_id": 51753784, "body": "Yes, that&#39;s the code that I had originally implementated. I modified it to leverage <code>httputil</code> because Fiddler offered an encoded response warning. The object of the exercise was to understand the inner workings, more than anything else."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1439215188, "post_id": 31917142, "comment_id": 51755613, "body": "Do you have a sample of the chunked response? It sounds like it&#39;s not properly encoded. Otherwise, it works as advertised: <a href=\"http://play.golang.org/p/OBkZJRzIfd\" rel=\"nofollow noreferrer\">play.golang.org/p/OBkZJRzIfd</a>"}], "owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1156, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1439205229, "creation_date": 1439202274, "last_edit_date": 1439205229, "question_id": 31917142, "link": "https://stackoverflow.com/questions/31917142/golang-newchunkedreader-usage", "title": "Golang NewChunkedReader Usage", "body": "<p>I'm attempting to process a chunked response from a 3rd-party service by introducing it to <code>httputil.NewChunkedReader</code>:</p>\n\n<pre><code>chunkedReader := httputil.NewChunkedReader(chunkedResponse)\n\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(chunkedReader)\nreturn buf.Bytes()\n</code></pre>\n\n<p>This code returns zero bytes, as does manually invoking <code>reader.Read</code>.</p>\n\n<p>I'm looking for a practical example in terms of implementing <code>httputil.NewChunkedReader</code>.</p>\n"}, {"tags": ["json", "mongodb", "go", "tags", "mgo"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1439199373, "post_id": 31915888, "comment_id": 51745146, "body": "I haven&#39;t worked with mgo, but what if you add the key to the bson tag? E.g. <code>SplitLen int `bson:&quot;len,minsize&quot; json:&quot;len&quot;`</code>."}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439201822, "post_id": 31915888, "comment_id": 51746584, "body": "Thank you @aninar-G . After your suggested change it is working. Still i don&#39;t understand why all other attribute is being parsed except len."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439203948, "post_id": 31915888, "comment_id": 51747892, "body": "@MayankPatel I&#39;ve posted that as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 0, "creation_date": 1439201700, "post_id": 31916792, "comment_id": 51746505, "body": "Isn&#39;t it case sensitive. Would &quot;len&quot; and &quot;Len&quot; be considered same?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 2, "creation_date": 1439201857, "post_id": 31916792, "comment_id": 51746611, "body": "@MayankPatel Quoting <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a>: <i>&quot;To unmarshal JSON into a struct, Unmarshal matches incoming object keys to the keys used by Marshal (either the struct field name or its tag), preferring an exact match <b>but also accepting a case-insensitive match</b>.&quot;</i>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1439220343, "last_edit_date": 1439220343, "creation_date": 1439201165, "answer_id": 31916792, "question_id": 31915888, "link": "https://stackoverflow.com/questions/31915888/parsing-mongo-entries-into-struct/31916792#31916792", "title": "Parsing mongo entries into struct", "body": "<p>If a data element appears under a different name in the other representation (e.g. json text or database) than what the struct field name is, you have to tell what name to match to the struct field in the field tag.</p>\n\n<p>You told the <code>json</code> package to get/set the json value <code>\"len\"</code> into the field <code>SplitLen</code> which is named differently by including this in its tag: <code>json:\"len\"</code>.</p>\n\n<p>But you haven't told the mongo driver to also use this field which is most likely named <code>\"Len\"</code> (or <code>\"len\"</code>) in your mongodb. You explicitly excluded the field that could be \"auto-matched\" by name:</p>\n\n<pre><code>Len uint64 `bson:\"-\" json:\"-\"`\n</code></pre>\n\n<p>As Ainar-G suggested, you can designate the field by adding the <code>\"len\"</code> to the <code>bson</code> tag value which will force the mgo driver to also use the <code>SplitLen</code> field:</p>\n\n<pre><code>SplitLen int `bson:\"len,minsize\" json:\"len\"`\n</code></pre>\n\n<p>And now I don't see any purpose for the <code>Len</code> field, you should remove it to avoid confusion, or use the <code>Len</code> name instead of <code>SplitLen</code>:</p>\n\n<pre><code>Len int `bson:\"len,minsize\" json:\"len\"`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1439203910, "creation_date": 1439203910, "answer_id": 31917638, "question_id": 31915888, "link": "https://stackoverflow.com/questions/31915888/parsing-mongo-entries-into-struct/31917638#31917638", "title": "Parsing mongo entries into struct", "body": "<p>Add the field name to the BSON tag as well:</p>\n\n<pre><code>SplitLen int `bson:\"len,minsize\" json:\"len\"\n</code></pre>\n\n<p>Otherwise it seems that it will conflict with the <code>Len</code> field that is ignored.</p>\n"}], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 31917638, "answer_count": 2, "score": 3, "last_activity_date": 1439644027, "creation_date": 1439198464, "last_edit_date": 1439644027, "question_id": 31915888, "link": "https://stackoverflow.com/questions/31915888/parsing-mongo-entries-into-struct", "title": "Parsing mongo entries into struct", "body": "<p>I have mongo database with following schema</p>\n\n<pre><code>{ \n  \"_id\" : ObjectId(\"55c8526d8c16598efb5ee1e6\"), \n  \"guid\" : \"72811d52b48379e72c8fdd11aa09cb8b\", \n  \"blkid\" : 1, \n  \"vblkid\" : 0, \n  \"spltid\" : 0, \n  \"cmpr\" : false, \n  \"encr\" : false,\n  \"chksum\" : \"\",\n  \"dup\" : false,\n  \"cid\" : 1,\n  \"off\" : 524508,\n  \"len\" : 524408,\n  \"incr\" : 0,\n  \"fBackupID\" : 0,\n  \"vid\" : 0,\n  \"plugInType\" : 0, \n  \"blkType\" : 0, \n  \"alen\" : 0 \n}\n</code></pre>\n\n<p>and I am trying to parse these into a struct with following structure:</p>\n\n<pre><code>type VhfsBlockMD struct {\n    GUID       string `json:\"guid\"`\n    BlkID      int    `bson:\",minsize\" json:\"blkid\"`\n    VBlkID     int    `bson:\",minsize\" json:\"vblkid\"`\n    SpltID     int    `bson:\",minsize\" json:\"spltid\"`\n    Cmpr       bool   `json:\"cmpr\" `\n    Encr       bool   `json:\"encr\"`\n    Blksum     string `bson:\"blksum,omitempty\" json:\"blksum,omitempty\"`\n    Chksum     string `json:\"chksum\"`\n    Dup        bool   `json:\"dup\"`\n    Cid        int    `bson:\",minsize\" json:\"cid\"`\n    SplitLen   int    `bson:\",minsize\" json:\"len\"`\n    Off        int64  `bson:\",minsize\" json:\"off\"`\n    Incr       int    `bson:\",minsize\" json:\"incr\"`\n    CDup       bool   `bson:\"cdup,omitempty\" json:\"cdup,omitempty\"`\n    FBackupID  int    `bson:\"fBackupID\" json:\"fBackupID\"`\n    Vid        int    `bson:\"vid\" json:\"vid\"`\n    PlugInType int    `bson:\"plugInType\" json:\"plugInType\"`\n    BlkType    int    `bson:\"blkType\" json:\"blkType\"`\n    Alen       int    `bson:\"alen\" json:\"alen\"`\n    IsValid    int    `bson:\"-\" json:\"-\"`\n    Len        uint64 `bson:\"-\" json:\"-\"`\n}\n</code></pre>\n\n<p>I am using mgo driver.</p>\n\n<p>Now problem is that after parsing only attribute i am not able to parse correctly is \"len\" (SplitLen in go struct).</p>\n\n<p>len is defined as </p>\n\n<pre><code>SplitLen int `bson:\",minsize\" json:\"len\"`\n</code></pre>\n\n<p>I believe it has something to do with tags. Also i would lke to mention that same struct was used to insert value into mongodb.</p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 159902, "user_id": 3297613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/KHhzd.jpg?s=128&g=1", "display_name": "Avinash Raj", "link": "https://stackoverflow.com/users/3297613/avinash-raj"}, "edited": false, "score": 0, "creation_date": 1439197696, "post_id": 31915595, "comment_id": 51744132, "body": "<code>^(?!alex|merry|david).*\\&#47;.*</code>"}, {"owner": {"reputation": 100127, "user_id": 67392, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/95e28ac250c4604a6f9d7e34705c3259?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/67392/richard"}, "reply_to_user": {"reputation": 159902, "user_id": 3297613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/KHhzd.jpg?s=128&g=1", "display_name": "Avinash Raj", "link": "https://stackoverflow.com/users/3297613/avinash-raj"}, "edited": false, "score": 0, "creation_date": 1439197874, "post_id": 31915595, "comment_id": 51744243, "body": "Which regex engine/language: lookahead assertions (as @AvinashRaj used) are very dependent on the regex dialect."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1439198355, "post_id": 31915595, "comment_id": 51744512, "body": "It is written it is Go. No support for look-arounds :( What about reversing the conditions? If the string has no <code>&#47;</code> or starts with the unwanted words? Please check <a href=\"https://ideone.com/wZvvBk\" rel=\"nofollow noreferrer\">ideone.com/wZvvBk</a>"}, {"owner": {"reputation": 943, "user_id": 2321728, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/74fa106ad05a21a6006c99652c369eb5?s=128&d=identicon&r=PG", "display_name": "user2321728", "link": "https://stackoverflow.com/users/2321728/user2321728"}, "edited": false, "score": 0, "creation_date": 1439198623, "post_id": 31915595, "comment_id": 51744686, "body": "<code>match, _ := regexp.MatchString(&quot;^(alex|merry|david)|^[^&#47;]+$&quot;, &quot;publicfile&quot;)     fmt.Println(match)</code> here I still get match=true."}, {"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1439199055, "post_id": 31915595, "comment_id": 51744951, "body": "Erm, because it matches?"}], "answers": [{"tags": [], "owner": {"reputation": 62965, "user_id": 3679490, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70f98fb23b16862298ea208aedfd18ae?s=128&d=identicon&r=PG&f=1", "display_name": "vks", "link": "https://stackoverflow.com/users/3679490/vks"}, "is_accepted": false, "score": 0, "last_activity_date": 1439198678, "creation_date": 1439198678, "answer_id": 31915963, "question_id": 31915595, "link": "https://stackoverflow.com/questions/31915595/how-to-write-regex-pattern-for-the-following-string-to-be-matched/31915963#31915963", "title": "How to write regex pattern for the following string to be matched", "body": "<pre><code>^(?:(?:alex|merry|david).*|(.*\\/.*))$\n</code></pre>\n\n<p>You can try something like this.This will match all but you need to grab the <code>groups</code> only.See demo.</p>\n\n<p><a href=\"https://regex101.com/r/fM9lY3/27\" rel=\"nofollow\">https://regex101.com/r/fM9lY3/27</a></p>\n"}, {"comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1439200303, "post_id": 31916044, "comment_id": 51745655, "body": "If it does not work, please post the code you have, I will try to adjust it."}, {"owner": {"reputation": 943, "user_id": 2321728, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/74fa106ad05a21a6006c99652c369eb5?s=128&d=identicon&r=PG", "display_name": "user2321728", "link": "https://stackoverflow.com/users/2321728/user2321728"}, "edited": false, "score": 0, "creation_date": 1439201194, "post_id": 31916044, "comment_id": 51746179, "body": "It&#39;s working. A great way to go. But I wanted to try to avoid reverse operation. Only lookahead can do that?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 943, "user_id": 2321728, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/74fa106ad05a21a6006c99652c369eb5?s=128&d=identicon&r=PG", "display_name": "user2321728", "link": "https://stackoverflow.com/users/2321728/user2321728"}, "edited": false, "score": 0, "creation_date": 1439201448, "post_id": 31916044, "comment_id": 51746340, "body": "Unfortunately, there is no other means to negate something, only a negative look-around. Regex is meant to match something, not to <i>fail to match</i> something. In order to fail the match, there are other language-specific features, and one of them is surely <code>!Match(...)</code>."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1439198903, "creation_date": 1439198903, "answer_id": 31916044, "question_id": 31915595, "link": "https://stackoverflow.com/questions/31915595/how-to-write-regex-pattern-for-the-following-string-to-be-matched/31916044#31916044", "title": "How to write regex pattern for the following string to be matched", "body": "<p>Here is my approach: I reverse the requirements and obtain either <code>false</code> or <code>true</code>:</p>\n\n<pre><code>^(alex|merry|david)|^[^/]+$\n</code></pre>\n\n<p>The regex will match all strings starting with <code>alex</code>, <code>merry</code> or <code>david</code> OR all strings that do not contain <code>/</code>, and with <code>!</code> operator we reverse the <code>Match</code> result:</p>\n\n<pre><code>var mystr = \"alex/personalfile\"\nvar pattern = regexp.MustCompile(`^(alex|merry|david)|^[^/]+$`) \nvar matched = !pattern.Match([]byte(mystr))\nfmt.Println(matched)\n</code></pre>\n\n<p>Result: <code>false</code></p>\n\n<p>See <a href=\"https://ideone.com/LZiFOB\" rel=\"nofollow\">IDEONE demo</a></p>\n"}], "owner": {"reputation": 943, "user_id": 2321728, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/74fa106ad05a21a6006c99652c369eb5?s=128&d=identicon&r=PG", "display_name": "user2321728", "link": "https://stackoverflow.com/users/2321728/user2321728"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 31916044, "answer_count": 2, "score": 0, "last_activity_date": 1439199721, "creation_date": 1439197602, "last_edit_date": 1439199721, "question_id": 31915595, "link": "https://stackoverflow.com/questions/31915595/how-to-write-regex-pattern-for-the-following-string-to-be-matched", "title": "How to write regex pattern for the following string to be matched", "body": "<p>I user golang <code>func (*Regexp) Match</code> to check if a string matches some pattern. </p>\n\n<p><code>matched = regexp.Match(mystr, []byte(pattern))</code></p>\n\n<p>How can I write pattern to get <code>matched=true</code> when passing mystr fulfilling the following requirements:</p>\n\n<ul>\n<li>contain at least one \"/\"</li>\n<li>not start with \"alex/\", \"merry/\", \"david/\"</li>\n</ul>\n\n<p>so mystr=\"publicfile\", \"alex/personalfile\", \"merry/personalfile\", \"david/personalfile\" will get rejected, which means matched=false. </p>\n\n<p>How can I write one patter for this purpose? Thanks in advance.</p>\n"}, {"tags": ["input", "go", "scanf"], "answers": [{"comments": [{"owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 1, "creation_date": 1439197630, "post_id": 31914834, "comment_id": 51744089, "body": "Thank you! such a detailed explanation"}, {"owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 0, "creation_date": 1439197779, "post_id": 31914834, "comment_id": 51744185, "body": "One question, I tried to print the value of n variable, and it always show <b>1</b>?, why is that?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "edited": false, "score": 0, "creation_date": 1439198098, "post_id": 31914834, "comment_id": 51744379, "body": "@airsoftFreak Because <code>n</code> tells how many items were scanned successfully, and it is <code>1</code> in your case (the <code>distance</code>). It could be greater than <code>1</code> if you would scan multiple items with one <code>Scanf()</code> call. See edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1439198046, "last_edit_date": 1439198046, "creation_date": 1439194995, "answer_id": 31914834, "question_id": 31914711, "link": "https://stackoverflow.com/questions/31914711/why-the-input-of-scanf-is-always-0/31914834#31914834", "title": "Why the input of Scanf is always 0?", "body": "<p>You used a wrong format string. <code>%f</code> is used to scan floating point numbers, but your variable <code>distance</code> is of type <code>int</code>, so you should use <code>%d</code>:</p>\n\n<pre><code>fmt.Scanf(\"%d\", &amp;distance)\n</code></pre>\n\n<p>Or declare <code>distance</code> variable to be a floating point number and then you can use <code>%f</code>:</p>\n\n<pre><code>var distance float64\nfmt.Println(\"Enter the distance\")\nfmt.Scanf(\"%f\", &amp;distance)\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p><a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow\"><code>fmt.Scanf()</code></a> returns the number of items successfully scanned, and an optional error. You should get used to handle errors in Go which would save you a lot of time.</p>\n\n<p>As a minimal by storing and printing the return values of <code>Scanf()</code>:</p>\n\n<pre><code>var distance int\nfmt.Println(\"Enter the distance\")\nn, err := fmt.Scanf(\"%f\", &amp;distance)\nfmt.Println(n, err)\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>0 bad verb %f for integer\n</code></pre>\n\n<p>Which immediately tells you <code>0</code> items were scanned and there was an error: <code>bad verb %f for integer</code> which is pretty much self explanatory.</p>\n\n<p>This also explains why you always see <code>0</code> kilomenters printed: your <code>distance</code> variable is initialized to <code>0</code> (zero value of <code>int</code>) and it is never changed.</p>\n\n<p>If scanning would be successful, you would see an output of:</p>\n\n<pre><code>1 &lt;nil&gt;\n</code></pre>\n\n<p>Meaning that one item was scanned successfully (the <code>distance</code>) and there was no error.</p>\n\n<p>If you would scan multiple items with one <code>Scanf()</code> call, <code>n</code> could be greater than <code>1</code> of course (for example <code>fmt.Scanf(\"%f %d\", &amp;distance, &amp;temp)</code>).</p>\n"}], "owner": {"reputation": 1272, "user_id": 4494505, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/81f80fc76626664b412a89de511350b1?s=128&d=identicon&r=PG&f=1", "display_name": "airsoftFreak", "link": "https://stackoverflow.com/users/4494505/airsoftfreak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 1, "accepted_answer_id": 31914834, "answer_count": 1, "score": 0, "last_activity_date": 1439198046, "creation_date": 1439194604, "last_edit_date": 1439195786, "question_id": 31914711, "link": "https://stackoverflow.com/questions/31914711/why-the-input-of-scanf-is-always-0", "title": "Why the input of Scanf is always 0?", "body": "<p>I'm trying to get input from a user and print it out, but apparently the value of the distance is <code>0</code>, after I did some input.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>type Person struct {\n    name string\n    age int\n    ambition string\n}\n\nfunc (p *Person) walking() {\n    var distance int\n    fmt.Println(\"Enter the distance\")\n    fmt.Scanf(\"%f\", &amp;distance)\n\n    if distance &lt; 9 {\n        fmt.Println(p.name, \" is walking towards that direction in \", distance,\n            \"kilometer\")\n    } else {\n        fmt.Println(\"This is an error, ignore this\")\n    }\n}\n</code></pre>\n\n<p>As you can see whenever I try to run this command on my main function, it always prints <code>fmt.Println(p.name, \" is walking towards that direction in \", distance, \"kilometer\")</code> even though the value of distance is more than <code>9</code>.</p>\n\n<pre><code>func main() {\n    p := new(Person)\n    p.name = \"Joker\"\n\n    p.walking()\n}\n</code></pre>\n\n<p><code>p.walking()</code> will always print distance as <code>0</code>? Can anyone explain to me what is going on here?</p>\n"}, {"tags": ["json", "rest", "go"], "comments": [{"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "edited": false, "score": 1, "creation_date": 1439185908, "post_id": 31911961, "comment_id": 51738086, "body": "What is &quot;res&quot; in your code? I could not find corresponding variable."}, {"owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "reply_to_user": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "edited": false, "score": 0, "creation_date": 1439187507, "post_id": 31911961, "comment_id": 51738692, "body": "Sorry my bad. I should have removed it. &#39;res&#39; is basically another module that contains the json.NewEncoder(w).Encode(se) call."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1439195607, "post_id": 31911961, "comment_id": 51742936, "body": "Also: good Go style is to call it APIKey."}], "answers": [{"comments": [{"owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "edited": false, "score": 0, "creation_date": 1439186506, "post_id": 31912448, "comment_id": 51738288, "body": "Awesome! Thank you so much."}, {"owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "edited": false, "score": 0, "creation_date": 1439186547, "post_id": 31912448, "comment_id": 51738305, "body": "For newbies like me: <a href=\"http://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html\" rel=\"nofollow noreferrer\">goinggo.net/2014/03/exportedunexported-identifiers-in-go.htm&zwnj;&#8203;l</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1439186023, "creation_date": 1439186023, "answer_id": 31912448, "question_id": 31911961, "link": "https://stackoverflow.com/questions/31911961/go-lang-restful-api-not-working-json/31912448#31912448", "title": "Go Lang RESTful API not working JSON", "body": "<p><a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">Export</a> the fields in type <code>sessiond</code> by starting the field name with an uppercase letter.</p>\n\n<pre><code>type sessiond struct{\n   ApiKey string `json:\"apiKey\"`\n   Token string `json:\"token\"`\n}\n</code></pre>\n\n<p>The JSON encoder and decoder ignore unexported fields.</p>\n"}], "owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "closed_date": 1439186136, "accepted_answer_id": 31912448, "answer_count": 1, "score": 0, "last_activity_date": 1439188084, "creation_date": 1439183246, "last_edit_date": 1439188084, "question_id": 31911961, "link": "https://stackoverflow.com/questions/31911961/go-lang-restful-api-not-working-json", "closed_reason": "Duplicate", "title": "Go Lang RESTful API not working JSON", "body": "<p>I'm trying to make a RESTful API on Go Lang returning JSON value. I am not getting any value on the page when I load it. Could anyone help me out here.. ?</p>\n\n<pre><code>type sessiond struct{\n   apiKey string `json:\"apiKey\"`\n   token string `json:\"token\"`\n}\n\nfunc dummy(w http.ResponseWriter, r *http.Request) {\n   se:=sessiond{apiKey:key,token:\"erer\"}\n   log.Println(se);    // Iam getting the value here ! but nothing on the page.\n   w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n   w.WriteHeader(http.StatusOK)\n      if err := json.NewEncoder(w).Encode(se); err != nil {\n      panic(err)\n   }\n   //res.R200(w, se)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 1376084, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/700f29feba7af3229cd0fd2c7582d6bf?s=128&d=identicon&r=PG", "display_name": "Leon Hu", "link": "https://stackoverflow.com/users/1376084/leon-hu"}, "edited": false, "score": 0, "creation_date": 1439440611, "post_id": 31912227, "comment_id": 51864812, "body": "Thank you, Danver, that really helped and was educational."}, {"owner": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "edited": false, "score": 2, "creation_date": 1476388385, "post_id": 31912227, "comment_id": 67336740, "body": "What is there to do if the binding fails? Since the Reader is emptied, is that data simply lost?"}, {"owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "edited": false, "score": 0, "creation_date": 1480556748, "post_id": 31912227, "comment_id": 69016257, "body": "I too would like to know the answer to sean&#39;s question."}, {"owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "edited": false, "score": 0, "creation_date": 1480983393, "post_id": 31912227, "comment_id": 69180842, "body": "Gin does return an error to allow you to detect when a binding fails. However, as far as I can tell, at that point it&#39;s too late, and your improperly formatted data is lost.   If storing the improper data is a requirement, I think you can try to copy the Req.Body first, but then you will have to perform a call to parse the Json yourself instead of using gin.   This is probably worth making a ticket on the gin project."}], "tags": [], "owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "is_accepted": true, "score": 29, "last_activity_date": 1439184913, "creation_date": 1439184913, "answer_id": 31912227, "question_id": 31911579, "link": "https://stackoverflow.com/questions/31911579/gin-golang-empty-req-body/31912227#31912227", "title": "gin/golang - Empty Req Body", "body": "<p>The problem here is that you're printing out the string value of <code>c.Request.Body</code>, which is of interface type <code>ReadCloser</code>.</p>\n\n<p>What you can do to satisfy yourself that it does in fact contain the body you want is to read the value out of <code>c.Request.Body</code> to a string, and then print that out. <strong>This is for your learning process only!</strong></p>\n\n<p>Learning code:</p>\n\n<pre><code>func events(c *gin.Context) {\n        x, _ := ioutil.ReadAll(c.Request.Body)\n        fmt.Printf(\"%s\", string(x))\n        c.JSON(http.StatusOK, c)\n}\n</code></pre>\n\n<p>However, this is not the way you should access the body of the request. Let gin do the parsing of the body for you, by using a binding.</p>\n\n<p>More correct code:</p>\n\n<pre><code>type E struct {\n        Events string\n}\n\nfunc events(c *gin.Context) {\n        data := &amp;E{}\n        c.Bind(data)\n        fmt.Println(data)\n        c.JSON(http.StatusOK, c)\n}\n</code></pre>\n\n<p>This is a more correct way to access the data in the body, since it will be already parsed out for you. Note that if you read the body first, as we did above in the learning step, the <code>c.Request.Body</code> will have been emptied, and so there will be nothing left in the body for Gin to read.</p>\n\n<p>Broken code:</p>\n\n<pre><code>func events(c *gin.Context) {\n    x, _ := ioutil.ReadAll(c.Request.Body)\n    fmt.Printf(\"%s\", string(x))\n    data := &amp;E{}\n    c.Bind(data) // data is left unchanged because c.Request.Body has been used up.\n    fmt.Println(data)\n    c.JSON(http.StatusOK, c)\n}\n</code></pre>\n\n<p>You're probably also curious why the JSON returned from this endpoint shows and empty <code>Request.Body</code>. This is for the same reason. The JSON Marshalling method cannot serialize a <code>ReadCloser</code>, and so it shows up as empty.</p>\n"}], "owner": {"reputation": 137, "user_id": 1376084, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/700f29feba7af3229cd0fd2c7582d6bf?s=128&d=identicon&r=PG", "display_name": "Leon Hu", "link": "https://stackoverflow.com/users/1376084/leon-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12467, "favorite_count": 4, "accepted_answer_id": 31912227, "answer_count": 1, "score": 9, "last_activity_date": 1439184913, "creation_date": 1439180406, "question_id": 31911579, "link": "https://stackoverflow.com/questions/31911579/gin-golang-empty-req-body", "title": "gin/golang - Empty Req Body", "body": "<p>I'm new to Go and Gin, and am having trouble printing out the full request body.</p>\n\n<p>I want to be able to read the request body from third party POST, but I'm getting empty request body</p>\n\n<pre><code>curl -u dumbuser:dumbuserpassword -H \"Content-Type: application/json\" -X POST --data '{\"events\": \"3\"}' http://localhost:8080/events\n</code></pre>\n\n<p>My entire code is as below. Any pointer is appreciated!</p>\n\n<pre><code>package main\n\nimport (\n  \"net/http\"\n  \"fmt\"\n  \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n  router := gin.Default()\n  authorized := router.Group(\"/\", gin.BasicAuth(gin.Accounts{\n     \"dumbuser\": \"dumbuserpassword\",\n  }))\n  authorized.POST(\"/events\", events)\n  router.Run(\":8080\")\n}\n\nfunc events(c *gin.Context) {\n  fmt.Printf(\"%s\", c.Request.Body)\n  c.JSON(http.StatusOK, c)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "is_accepted": true, "score": 0, "last_activity_date": 1439173822, "creation_date": 1439173822, "answer_id": 31910872, "question_id": 31910787, "link": "https://stackoverflow.com/questions/31910787/sigcont-not-detected-by-channel/31910872#31910872", "title": "SIGCONT not detected by channel", "body": "<p>It's an known issue in Go. There is an issue for it on <a href=\"https://github.com/golang/go/issues/8953\" rel=\"nofollow\">GitHub</a>.</p>\n"}], "owner": {"reputation": 33, "user_id": 5209474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/415a6a09477a214d4b861dd909c53ba9?s=128&d=identicon&r=PG&f=1", "display_name": "mla", "link": "https://stackoverflow.com/users/5209474/mla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 31910872, "answer_count": 1, "score": 3, "last_activity_date": 1439173924, "creation_date": 1439173091, "last_edit_date": 1439173924, "question_id": 31910787, "link": "https://stackoverflow.com/questions/31910787/sigcont-not-detected-by-channel", "title": "SIGCONT not detected by channel", "body": "<p>I'm trying to replicate a shell environment. The following code runs within <code>os.StartProcess</code> and <code>p.Wait()</code>. It is able to receive <code>C-z</code> (SIGTSTP) and <code>C-c</code> (SIGINT) but not when I send <code>SIGCONT</code> from another shell with <code>kill -CONT [PID]</code>. </p>\n\n<pre><code>sigChild := make(chan os.Signal)\ndefer close(sigChild)\nsignal.Notify(sigChild, syscall.SIGTSTP, syscall.SIGINT, syscall.SIGCONT)\ndefer signal.Stop(sigChild)\n\nsigRcvd := &lt;- sigChild\nfmt.Println(sigRcvd)\n</code></pre>\n\n<p>I'm not sure if I missing something in my code.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "edited": false, "score": 0, "creation_date": 1439171430, "post_id": 31910482, "comment_id": 51734933, "body": "<a href=\"https://play.golang.org/p/3tuuv_ccTA\" rel=\"nofollow noreferrer\">Playground link</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1439215814, "last_edit_date": 1439215814, "creation_date": 1439172165, "answer_id": 31910684, "question_id": 31910482, "link": "https://stackoverflow.com/questions/31910482/golang-unmarshal-json-list/31910684#31910684", "title": "Golang unmarshal json list", "body": "<p>Decode to a slice of transactions:</p>\n\n<pre><code>body, err := http.Get(url)\nvar transactions []Transaction\nerr = json.Unmarshal(body, &amp;transactions)\n</code></pre>\n\n<p>Also, export all of the fields:</p>\n\n<pre><code>type Transaction struct {\n  Amount string `json:\"amount\"`\n  Date   string `json:\"date\"`\n  Price  string `json:\"price\"`\n  Tid    uint   `json:\"tid\"`\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/kaReDBMncy\" rel=\"noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "is_accepted": false, "score": 1, "last_activity_date": 1439172192, "creation_date": 1439172192, "answer_id": 31910687, "question_id": 31910482, "link": "https://stackoverflow.com/questions/31910482/golang-unmarshal-json-list/31910687#31910687", "title": "Golang unmarshal json list", "body": "<p>So yes, it took a while...</p>\n\n<p>The TransactionResponse is not a struct type. If I make it a Transaction array, it works as it should. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\nvar body = `[\n{\n\"amount\":\"6.40000000\",\n\"date\":\"1439165701\",\n\"price\":\"350.26\",\n\"tid\":104159\n},\n{\n\"amount\":\"0.10025000\",\n\"date\":\"1439162764\",\n\"price\":\"351.03\",\n\"tid\":104150\n}\n]\n`\n\ntype TransactionResponse []Transaction\n\ntype Transaction struct {\nAmount string `json:\"amount\"`\nDate   string `json:\"date\"`\nPrice  string `json:\"price\"`\ntid    uint   `json:\"tid\"`\n}\n\nfunc main() {\nvar transactions TransactionResponse\n\nerr := json.Unmarshal([]byte(body), &amp;transactions)\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(transactions)\n}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7415, "favorite_count": 1, "accepted_answer_id": 31910684, "answer_count": 2, "score": -4, "last_activity_date": 1439215814, "creation_date": 1439170174, "question_id": 31910482, "link": "https://stackoverflow.com/questions/31910482/golang-unmarshal-json-list", "title": "Golang unmarshal json list", "body": "<p>I've been struggling to parse a basic array response.</p>\n\n<p>My input JSON, has a list of consistent types of structures. </p>\n\n<pre><code>[\n{\n  \"amount\":\"6.40000000\",\n  \"date\":\"1439165701\",\n  \"price\":\"350.26\",\n  \"tid\":104159\n},\n{\n  \"amount\":\"0.10025000\",\n  \"date\":\"1439162764\",\n  \"price\":\"351.03\",\n  \"tid\":104150\n}\n]\n</code></pre>\n\n<p>My struct has a nested array struct. </p>\n\n<pre><code>type TransactionResponse struct {\n    Transaction []Transaction\n}\ntype Transaction struct {\n    Amount string `json:\"amount\"`\n    Date   string `json:\"date\"`\n    Price  string `json:\"price\"`\n    tid    uint   `json:\"tid\"`\n}\n</code></pre>\n\n<p>Function to parse the json:</p>\n\n<pre><code>func main() {\n    var transactions TransactionResponse\n\n    body, err := http.Get(url)\n    err = json.Unmarshal(body, &amp;transactions)\n}\n</code></pre>\n\n<p>Where am I going wrong? </p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 2, "creation_date": 1439159175, "post_id": 31909291, "comment_id": 51732709, "body": "Is <code>out</code> an unbuffered channel? If it is <code>out &lt;- item</code> will be blocked until the receiver ( <code>&lt;- out</code>) is available."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 0, "creation_date": 1439164006, "post_id": 31909291, "comment_id": 51733643, "body": "That was what I was missing. Put that in the form of an answer and credit is yours."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1530155261, "last_edit_date": 1530155261, "creation_date": 1439168370, "answer_id": 31910300, "question_id": 31909291, "link": "https://stackoverflow.com/questions/31909291/golang-stuck-in-waitgroup/31910300#31910300", "title": "Golang stuck in WaitGroup", "body": "<p>The goroutines are stuck sending to <code>out</code> at this line:</p>\n\n<pre><code>        out &lt;- item\n</code></pre>\n\n<p>The fix is to start a goroutine to receive on <code>out</code>.</p>\n\n<p>A good way to debug issues like this is to dump the goroutine stacks by sending the process a SIGQUIT. </p>\n"}], "owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1161, "favorite_count": 0, "accepted_answer_id": 31910300, "answer_count": 1, "score": 0, "last_activity_date": 1530155261, "creation_date": 1439157988, "question_id": 31909291, "link": "https://stackoverflow.com/questions/31909291/golang-stuck-in-waitgroup", "title": "Golang stuck in WaitGroup", "body": "<p>I'm stuck in my own wait loop and not really sure why. The function takes an input and output channel, then takes each item in the channel, executes an http.GET for the content and pulls the  tag from the html.  </p>\n\n<p>The process to GET and scrape is inside a go routine, and I've set up a wait group (innerWait) to be sure that I've processed everything before closing the output channel.   </p>\n\n<pre><code>   func (fp FeedProducer) getTitles(in &lt;-chan feeds.Item,\n    out chan&lt;- feeds.Item,\n    wg *sync.WaitGroup) {\n\n    defer wg.Done()\n\n    var innerWait sync.WaitGroup\n\n    for item := range in {\n        log.Infof(fp.c, \"Incrementing inner WaitGroup.\")\n        innerWait.Add(1)\n        go func(item feeds.Item) {\n            defer innerWait.Done()\n            defer log.Infof(fp.c, \"Decriment inner wait group by defer.\")\n            client := urlfetch.Client(fp.c)\n            resp, err := client.Get(item.Link.Href)\n            log.Infof(fp.c, \"Getting title for: %v\", item.Link.Href)\n            if err != nil {\n                log.Errorf(fp.c, \"Error retriving page. %v\", err.Error())\n                return\n            }\n            if strings.ToLower(resp.Header.Get(\"Content-Type\")) == \"text/html; charset=utf-8\" {\n                title := fp.scrapeTitle(resp)\n                item.Title = title\n            } else {\n                log.Errorf(fp.c, \"Wrong content type.  Received: %v from %v\", resp.Header.Get(\"Content-Type\"), item.Link.Href)\n            }\n            out &lt;- item\n        }(item)\n    }\n    log.Infof(fp.c, \"Waiting for title pull wait group.\")\n    innerWait.Wait()\n    log.Infof(fp.c, \"Done waiting for title pull.\")\n    close(out)\n}\n\nfunc (fp FeedProducer) scrapeTitle(request *http.Response) string {\n    defer request.Body.Close()\n    tokenizer := html.NewTokenizer(request.Body)\n    var titleIsNext bool\n    for {\n        token := tokenizer.Next()\n        switch {\n        case token == html.ErrorToken:\n            log.Infof(fp.c, \"Hit the end of the doc without finding title.\")\n            return \"\"\n        case token == html.StartTagToken:\n            tag := tokenizer.Token()\n            isTitle := tag.Data == \"title\"\n\n            if isTitle {\n                titleIsNext = true\n            }\n        case titleIsNext &amp;&amp; token == html.TextToken:\n            title := tokenizer.Token().Data\n            log.Infof(fp.c, \"Pulled title: %v\", title)\n            return title\n        }\n    }\n}\n</code></pre>\n\n<p>Log content looks like this:</p>\n\n<pre><code>2015/08/09 22:02:10 INFO: Revived query parameter: golang\n2015/08/09 22:02:10 INFO: Getting active tweets from the last 7 days.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Incrementing inner WaitGroup.\n2015/08/09 22:02:10 INFO: Waiting for title pull wait group.\n2015/08/09 22:02:10 INFO: Getting title for: http://devsisters.github.io/goquic/\n2015/08/09 22:02:10 INFO: Pulled title: GoQuic by devsisters\n2015/08/09 22:02:10 INFO: Getting title for: http://whizdumb.me/2015/03/03/matching-a-string-and-extracting-values-using-regex/\n2015/08/09 22:02:10 INFO: Pulled title: Matching a string and extracting values using regex | Whizdumb's blog\n2015/08/09 22:02:10 INFO: Getting title for: https://www.reddit.com/r/golang/comments/3g7tyv/dropboxs_infrastructure_is_go_at_a_huge_scale/\n2015/08/09 22:02:10 INFO: Pulled title: Dropbox's infrastructure is Go at a huge scale : golang\n2015/08/09 22:02:10 INFO: Getting title for: http://dave.cheney.net/2015/08/08/performance-without-the-event-loop\n2015/08/09 22:02:10 INFO: Pulled title: Performance without the event loop | Dave Cheney\n2015/08/09 22:02:11 INFO: Getting title for: https://github.com/ccirello/sublime-gosnippets\n2015/08/09 22:02:11 INFO: Pulled title: ccirello/sublime-gosnippets \u00b7 GitHub\n2015/08/09 22:02:11 INFO: Getting title for: https://medium.com/iron-io-blog/an-easier-way-to-create-tiny-golang-docker-images-7ba2893b160?mkt_tok=3RkMMJWWfF9wsRonuqTMZKXonjHpfsX57ewoWaexlMI/0ER3fOvrPUfGjI4ATsNrI%2BSLDwEYGJlv6SgFQ7LMMaZq1rgMXBk%3D&amp;utm_content=buffer45a1c&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer\n2015/08/09 22:02:11 INFO: Pulled title: An Easier Way to Create Tiny Golang Docker Images \u2014 Iron.io Blog \u2014 Medium\n</code></pre>\n\n<p>I can see that I'm getting to the innerWait.Wait() command based on the logs, which also tells me that the inbound channel has been closed on the other side of the pipe.  </p>\n\n<p>It would appear that the defer statements in the anonymous function are not being called, as I can't see the deferred log statement printed anywhere.  But I can't for the life of me tell why as all code in that block appears to execute.</p>\n\n<p>Help is appreciated.</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 924, "user_id": 4199833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9tBnh.png?s=128&g=1", "display_name": "rudolph1024", "link": "https://stackoverflow.com/users/4199833/rudolph1024"}, "edited": false, "score": 0, "creation_date": 1439138877, "post_id": 31906504, "comment_id": 51727004, "body": "Could you provide the code?"}], "answers": [{"tags": [], "owner": {"reputation": 771, "user_id": 4515252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--02zX_AQuqM/AAAAAAAAAAI/AAAAAAAAK64/PpH7Pn2gzSg/photo.jpg?sz=128", "display_name": "Adam Vincze", "link": "https://stackoverflow.com/users/4515252/adam-vincze"}, "is_accepted": true, "score": 6, "last_activity_date": 1439139468, "creation_date": 1439139468, "answer_id": 31906595, "question_id": 31906504, "link": "https://stackoverflow.com/questions/31906504/why-go-package-code-has-no-body/31906595#31906595", "title": "Why go package code has no body?", "body": "<p>those functions are implemented in Assembler (<a href=\"https://golang.org/doc/asm\" rel=\"noreferrer\">https://golang.org/doc/asm</a>) \nthere are platform specific implementations for them: take a look at e.g.:</p>\n\n<p><code>$GOROOT/src/math/abs_amd64.s</code> </p>\n\n<p>for </p>\n\n<p><code>func Abs(x float64) float64</code></p>\n"}], "owner": {"reputation": 142, "user_id": 3273299, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002556923586/picture?type=large", "display_name": "kangtaku", "link": "https://stackoverflow.com/users/3273299/kangtaku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "closed_date": 1439162452, "accepted_answer_id": 31906595, "answer_count": 1, "score": -1, "last_activity_date": 1439169776, "creation_date": 1439138801, "last_edit_date": 1439169776, "question_id": 31906504, "link": "https://stackoverflow.com/questions/31906504/why-go-package-code-has-no-body", "closed_reason": "Duplicate", "title": "Why go package code has no body?", "body": "<p>I wondered coding style of go package when studying exporting packaging.</p>\n\n<p>and found that the code of package in source(ex:\"math\", \"fmt\") has</p>\n\n<p>function begins with a capital letter but no body.</p>\n\n<p>I just follow this code but doesn't work.</p>\n\n<p>Anyone who explain why??</p>\n\n<pre><code>func Abs(x float64) float64\n\nfunc abs(x float64) float64 {\n    switch {\n    case x &lt; 0:\n        return -x\n    case x == 0:\n        return 0 // return correctly abs(-0)\n    }\n    return x\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1439137748, "post_id": 31906297, "comment_id": 51726609, "body": "Ah - I hadn&#39;t noticed that issue. So the <code>ErrorByField</code> function is already in the package?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1439137823, "post_id": 31906297, "comment_id": 51726638, "body": "@tommyd456 yes, commit <a href=\"https://github.com/asaskevich/govalidator/commit/9cae1e03cfb752a931e0429bedcc3ebb3a0aad24\" rel=\"nofollow noreferrer\">github.com/asaskevich/govalidator/commit/&hellip;</a>, that is tag v2."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1439137492, "creation_date": 1439137492, "answer_id": 31906297, "question_id": 31906246, "link": "https://stackoverflow.com/questions/31906246/detecting-failed-struct-field-govalidator/31906297#31906297", "title": "Detecting failed struct field - govalidator", "body": "<p>This seems to be similar to <a href=\"https://github.com/asaskevich/govalidator/issues/67\" rel=\"nofollow\">issue/67</a>:</p>\n\n<blockquote>\n  <p>At this moment it gives error like this: </p>\n</blockquote>\n\n<pre><code>Title: My123 does not validate as alpha;\nAuthorIP: 123 does not validate as ipv4;\n</code></pre>\n\n<blockquote>\n  <p>I create function <a href=\"https://github.com/asaskevich/govalidator/blob/088ee1700509921c0970999fc56bc4641676b3a0/validator.go#L769-L786\" rel=\"nofollow\"><code>ErroByField(e error, field string)</code></a> that will return error for specified field of struct or empty string otherwise, I hope that it will be helpful.</p>\n  \n  <p>For example:</p>\n</blockquote>\n\n<pre><code>type Post struct {\n    Title    string `valid:\"alpha,required\"`\n    Message  string `valid:\"ascii\"`\n    AuthorIP string `valid:\"ipv4\"`\n}\n\npost := &amp;Post{\"My123\", \"duck13126\", \"123\"}\nresult, err := govalidator.ValidateStruct(post)\n\ntitleError := govalidator.ErrorByField(err, \"Title\")\nif titleError != \"\" {\n    println(titleError) // -&gt; My123 does not validate as alpha\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1439137492, "creation_date": 1439137104, "question_id": 31906246, "link": "https://stackoverflow.com/questions/31906246/detecting-failed-struct-field-govalidator", "title": "Detecting failed struct field - govalidator", "body": "<p>I'm experimenting with govalidator - <a href=\"https://github.com/asaskevich/govalidator\" rel=\"nofollow\">https://github.com/asaskevich/govalidator</a></p>\n\n<p>I would like to know whether it's possible to detect which field in a struct has failed a validation check so that I can return an appropriate error message. So for example:</p>\n\n<pre><code>type Post struct {\n    Title    string `valid:\"alphanum,required\"`\n    Message  string `valid:\"required\"`\n}\n\nresult, err := govalidator.ValidateStruct(post)\nif err != nil {\n    //if title is missing then show error 1\n    //if message is missing then show error 2\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1439136303, "post_id": 31905734, "comment_id": 51726165, "body": "If using a simple counter just use <a href=\"https://golang.org/pkg/sync/atomic/#AddUint32\" rel=\"nofollow noreferrer\"><code>atomic.AddUint32</code></a> to increment and <a href=\"https://golang.org/pkg/sync/atomic/#SwapUint32\" rel=\"nofollow noreferrer\"><code>atomic.SwapUint32</code></a> (or the \u2026<code>Uint64</code> variants) to read and reset the counter safely. Alternatively you could use something like the <a href=\"https://golang.org/pkg/expvar/\" rel=\"nofollow noreferrer\"><code>expvar</code> package</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1439143137, "post_id": 31905734, "comment_id": 51728308, "body": "1. Why both about a mutex while accessing network? 2. This all depends on which number you want to measure at which accuracy."}, {"owner": {"reputation": 101, "user_id": 5208455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb74b9a3cd24fecee5479104aca534f6?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Opolony", "link": "https://stackoverflow.com/users/5208455/justin-opolony"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1439143884, "post_id": 31905734, "comment_id": 51728539, "body": "@Volker what do you mean, &#39;why both about a mutex&#39;?  I would use one because many thousands of goroutines will be accessing/updating this number frequently."}, {"owner": {"reputation": 391, "user_id": 1315205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/085893bc1adca303abdd3b9595bd00ca?s=128&d=identicon&r=PG", "display_name": "Piotr Kowalczuk", "link": "https://stackoverflow.com/users/1315205/piotr-kowalczuk"}, "edited": false, "score": 1, "creation_date": 1439144008, "post_id": 31905734, "comment_id": 51728573, "body": "<a href=\"http://prometheus.io\" rel=\"nofollow noreferrer\">prometheus.io</a> is a clean idiomatic way to solve this problem, and you dont have to reinvent the wheel."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1439148067, "post_id": 31905734, "comment_id": 51729747, "body": "@JustinOpolony, I shouldn&#39;t try and speak for @Volker, but I believe he was trying to say not to worry about or be bothered by the overhead of one extra mutex (or better, a single <a href=\"https://golang.org/pkg/sync/atomic/#AddUint32\" rel=\"nofollow noreferrer\">atomic</a> operation) compared to the synchronization and overhead required to read/write from/to a network connection (i.e. the call to <code>http.Get</code>). An extra mutex is negligible compared to that."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1439192145, "post_id": 31905734, "comment_id": 51740977, "body": "@JustinOpolony yes, exactly what Dave said. s/both/bother/. Sorry for the type. Latencys of register &lt;&lt; cache &lt;&lt; RAM &lt;&lt; disk &lt;&lt; network with the &quot;&lt;&lt;&quot; meaning really <i>much</i> faster."}, {"owner": {"reputation": 3949, "user_id": 1816872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1V08e.jpg?s=128&g=1", "display_name": "Ivan Black", "link": "https://stackoverflow.com/users/1816872/ivan-black"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511801233, "post_id": 31905734, "comment_id": 81987647, "body": "@Volker, disk can be slower than network."}], "owner": {"reputation": 101, "user_id": 5208455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb74b9a3cd24fecee5479104aca534f6?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Opolony", "link": "https://stackoverflow.com/users/5208455/justin-opolony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 929, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1439133536, "creation_date": 1439133536, "question_id": 31905734, "link": "https://stackoverflow.com/questions/31905734/how-can-i-calculate-number-of-outgoing-requests-per-second", "title": "How can I calculate number of outgoing requests per second?", "body": "<p>I'm writing a go program which will make thousands of <code>http.Get</code> requests, concurrently, using goroutines.  This will be a long running process and I am going to add an admin feature to it that will list certain stats about the process.</p>\n\n<p>I'm trying to figure out a clean way to calculate the number of requests per second I'm making.  I've come up with a few possible solutions:</p>\n\n<ol>\n<li><p>Store a counter and have a timer that executes every few seconds that calculates the requests/second, then resets the counter.  I'm worried about doing this in a thread safe way.  If I use a mutex before accessing this counter, will I kill my performance?  </p></li>\n<li><p>Keep a list of timestamps for every request successfully made, then I can walk backward in the list for all timestamps within the time period I care about.  I'm worried about this list growing but maybe I can use a circular buffer.</p></li>\n<li>Somehow keep a running moving average of my requests / sec?</li>\n</ol>\n\n<p>What would be the best way for me to calculate the number of <code>http.Get</code> requests I'm making per second in my Go program? </p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439151642, "post_id": 31905642, "comment_id": 51730772, "body": "These particular ones it looks like maybe you could turn into regular capturing groups, i.e., just remove the <code>?=</code>. Then you make the sentence-ender or word token you want to find a group, and use one of the <code>Submatch</code> functions to get its start and end. Since <code>All</code> functions find <i>non-overlapping</i> matches and your former lookahead is now part of the match, you have to work around it: find the first match, then search again starting from the end of the last sentence/token you found."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439152150, "post_id": 31905642, "comment_id": 51730932, "body": "(In other words, all I can think of are the language-independent workarounds for not having lookahead at all.)"}], "owner": {"reputation": 5238, "user_id": 1713216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5652386ca2b1ba0a7c45791cb580b19b?s=128&d=identicon&r=PG", "display_name": "neurosnap", "link": "https://stackoverflow.com/users/1713216/neurosnap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439141297, "creation_date": 1439132942, "last_edit_date": 1439141297, "question_id": 31905642, "link": "https://stackoverflow.com/questions/31905642/lookahead-assertions-in-go", "title": "Lookahead assertions in Go", "body": "<p>I'm trying to convert a couple of Python regular expressions into Go.  The issue I'm having is the lack of support for lookahead assertions in Go.</p>\n\n<p>How do I convert these two regular expressions into Go?</p>\n\n<pre><code>/*                                                                              \nFormat of a regular expression to find contexts including possible              \nsentence boundaries. Matches token which the possible sentence boundary         \nends, and matches the following token within a lookahead expression             \n*/                                                                              \nconst periodContextFmt string = `                                               \n\\S*                         # some word material                                \n{{.SentEndChars}}           # a potential sentence ending                       \n(?=(?P&lt;after_tok&gt;                                                               \n{{.NonWord}}                # either other punctuation                          \n|                                                                               \n\\s+(?P&lt;next_tok&gt;\\S+)        # or whitespace and some other token                \n))` \n\n// Format of a regular expression to split punctuation from words, excluding period.\nconst wordTokenFmt string = `(                                                  \n{{.MultiChar}}                                                                  \n|                                                                               \n(?={{.WordStart}})\\S+?        # Accept word characters until end is found\n(?=                                   # Sequences marking a word's end          \n\\s|                                   # White-space                             \n$|                                    # End-of-string                           \n{{.NonWord}}|{{.MultiChar}}|          # Punctuation                             \n,(?=$|\\s|{{.NonWord}}|{{.MultiChar}}) # Comma if at end of word                 \n)                                                                                                                                                                                                                                  \n|                                                                               \n\\S                                                                              \n)`\n</code></pre>\n"}, {"tags": ["arrays", "json", "dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "edited": false, "score": 0, "creation_date": 1439142856, "post_id": 31905687, "comment_id": 51728224, "body": "I chose the second. I changed the map[string]interface{} type into a struct {Id int Command string Names []string } and then used Decode() as I did before. Works fine."}], "tags": [], "owner": {"reputation": 771, "user_id": 4515252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--02zX_AQuqM/AAAAAAAAAAI/AAAAAAAAK64/PpH7Pn2gzSg/photo.jpg?sz=128", "display_name": "Adam Vincze", "link": "https://stackoverflow.com/users/4515252/adam-vincze"}, "is_accepted": true, "score": 2, "last_activity_date": 1439133187, "last_edit_date": 1495541263, "creation_date": 1439133187, "answer_id": 31905687, "question_id": 31905043, "link": "https://stackoverflow.com/questions/31905043/unmarshal-json-object-of-strings-ints-and-arrays-into-a-map/31905687#31905687", "title": "Unmarshal JSON object of strings, ints and arrays into a map", "body": "<p>this is not possible by conversion because a <a href=\"https://stackoverflow.com/questions/12994679/golang-slice-of-struct-slice-of-interface-it-implements\">slice of struct != slice of interface it implements</a>!<br>\neither you can get the elements one by one and put them into a <code>[]string</code> like this: <a href=\"http://play.golang.org/p/1yqScF9yVX\" rel=\"nofollow noreferrer\">http://play.golang.org/p/1yqScF9yVX</a></p>\n\n<p>or better, use the capabilities of the json package to unpack the data in your model format : <a href=\"http://golang.org/pkg/encoding/json/#example_Unmarshal\" rel=\"nofollow noreferrer\">http://golang.org/pkg/encoding/json/#example_Unmarshal</a></p>\n"}], "owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 31905687, "answer_count": 1, "score": 1, "last_activity_date": 1439133187, "creation_date": 1439128817, "question_id": 31905043, "link": "https://stackoverflow.com/questions/31905043/unmarshal-json-object-of-strings-ints-and-arrays-into-a-map", "title": "Unmarshal JSON object of strings, ints and arrays into a map", "body": "<p>I like to unmarshal a JSON string using Decode():</p>\n\n<pre><code>var message Message\ndecoder := json.NewDecoder(s)\nerr = decoder.Decode(&amp;message)\n</code></pre>\n\n<p>My data structure is </p>\n\n<pre><code>type Message map[string]interface{}\n</code></pre>\n\n<p>The test data is as follows:</p>\n\n<pre><code>{\n  \"names\": [\n    \"HINDERNIS\",\n    \"TROCKNET\",\n    \"UMGEBENDEN\"\n  ], \n  \"id\":1189,\n  \"command\":\"checkNames\"\n}\n</code></pre>\n\n<p>It's working fine for numbers and strings, but with the string array I get following panic:</p>\n\n<pre><code>panic: interface conversion: interface is []interface {}, not []string\n</code></pre>\n"}, {"tags": ["android", "go", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "is_accepted": true, "score": 1, "last_activity_date": 1439132438, "creation_date": 1439132438, "answer_id": 31905553, "question_id": 31904586, "link": "https://stackoverflow.com/questions/31904586/gomobile-build-and-gomobile-install-throws-gomobile-eof/31905553#31905553", "title": "`gomobile build` and `gomobile install` throws &quot;gomobile: EOF&quot;", "body": "<p>It failed because AndroidManifest.xml was empty.</p>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 31905553, "answer_count": 1, "score": 1, "last_activity_date": 1496126410, "creation_date": 1439125871, "last_edit_date": 1496126410, "question_id": 31904586, "link": "https://stackoverflow.com/questions/31904586/gomobile-build-and-gomobile-install-throws-gomobile-eof", "title": "`gomobile build` and `gomobile install` throws &quot;gomobile: EOF&quot;", "body": "<p>I'm trying to build an android application using gomobile but the commands <code>gomobile install</code> and <code>gomobile build</code> fail with <code>gomobile: EOF</code> . Before this error I was getting this error: </p>\n\n<p><code># golang.org/x/mobile/gl\nIn file included from /root/go/src/golang.org/x/mobile/gl/gl.go:17:0:\nwork.h:6:23: fatal error: GLES2/gl2.h: No such file or directory\ncompilation terminated.</code> but it was fixed with <code>yum install make gcc mesa-libGLES-devel mesa-libEGL-devel</code>.</p>\n\n<p>The application is mostly a networking application. Here are the imports. Do only certain packages work with gomobile or all of them?</p>\n\n<pre><code>\"golang.org/x/mobile/app\"\n\"golang.org/x/net/websocket\"\n\"os/exec\"\n\"flag\"\n\"fmt\"\nlog \"github.com/golang/glog\"\n\"io/ioutil\"\n\"net\"\n\"net/http\"\n\"net/url\"\n\"strconv\"\n</code></pre>\n\n<p>OS: Fedora 22.</p>\n\n<p>More info: I'm able to build <a href=\"https://github.com/golang/mobile/blob/master/example/network/main.go\" rel=\"nofollow\">https://github.com/golang/mobile/blob/master/example/network/main.go</a> so I can only assume the issue is specific to my application. </p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "edited": false, "score": 0, "creation_date": 1439120319, "post_id": 31903632, "comment_id": 51721901, "body": "In all honesty, it depends on what you really want to do here. An &quot;unique&quot; index on the properties would result in an error on an insertion attempt where the combination of those values exist, and then you can &quot;handle&quot; that. On the other hand, if you want to be able to address &quot;unique&quot; properties and maybe perform some action on match or otherwise &quot;insert&quot; the new data, then <a href=\"http://docs.mongodb.org/manual/reference/method/db.collection.update/#upsert-option\" rel=\"nofollow noreferrer\">&quot;upsert&quot;</a> behavior might be what you need. So it is all about how you intend to react to a &quot;duplicate&quot; when it occurs."}, {"owner": {"reputation": 45041, "user_id": 558021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24664dac7e1f5ef8bf7931d416f876cd?s=128&d=identicon&r=PG", "display_name": "Lix", "link": "https://stackoverflow.com/users/558021/lix"}, "edited": false, "score": 0, "creation_date": 1439120442, "post_id": 31903632, "comment_id": 51721943, "body": "Provided that the two attributes are indexed, I don&#39;t see <i>that</i> much difference between waiting for a duplication error vs. manual validating. One point to take into consideration here is the readability/logic of the code structure - why detect/expect an error when you can prevent it from occurring in the first place?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1439120505, "post_id": 31903632, "comment_id": 51721956, "body": "Part of my thinking was efficieny though it may be negligible - I&#39;m having to query twice to see if email exists then username."}, {"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "edited": false, "score": 0, "creation_date": 1439121367, "post_id": 31903632, "comment_id": 51722178, "body": "@tommyd456 Well there should be clear diver methods for creating an index, and the general principles are well documented. But &quot;spefically&quot; here I am also asking you to be &quot;specific&quot;, which you are presently not doing. &quot;Unique&quot; is either the &quot;combination&quot; of &quot;username&quot; and &quot;email&quot; properties <b>or</b> it is one or the other that needs to be identified as &quot;unique&quot;. So you could be a lot clearer in your intended purpose here and &quot;pick&quot; one of these options as you action statement for what it is you really want to do here."}], "answers": [{"tags": [], "owner": {"reputation": 60311, "user_id": 1620671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24231f169c1ed55850339ec5d62047c5?s=128&d=identicon&r=PG", "display_name": "Philipp", "link": "https://stackoverflow.com/users/1620671/philipp"}, "is_accepted": false, "score": 0, "last_activity_date": 1439123768, "last_edit_date": 1439123768, "creation_date": 1439123450, "answer_id": 31904243, "question_id": 31903632, "link": "https://stackoverflow.com/questions/31903632/recommended-approach-to-avoid-duplicating-username-in-mongodb/31904243#31904243", "title": "Recommended approach to avoid duplicating username in MongoDB", "body": "<p>You can avoid duplicates with an <a href=\"http://docs.mongodb.org/manual/core/index-unique/#index-type-unique\" rel=\"nofollow\">unique index</a>. To create such an index in the mongo shell, use:</p>\n\n<pre><code>db.collection.createIndex( { name: 1 }, { unique: true } );\ndb.collection.createIndex( { email: 1 }, { unique: true } );\n</code></pre>\n\n<p>When you then insert a document which violates the uniqueness constraint, you will receive an error result. Unfortunately you will have to parse the text of the error message to find out which one of your indexes was violated. <code>err.errmsg</code> will be a string in this format:</p>\n\n<p><code>insertDocument :: caused by :: 11000 E11000 duplicate key error index: [index]  dup key: [value]\"</code> </p>\n\n<p>Be aware of a strange quirk of unique indexes. Unique indexes consider \"field doesn't exist\" as a separate unique value. So it allows exactly one document in the collection where the field is missing. So make sure that all required fields are filled before sending the document to the database.</p>\n"}, {"tags": [], "owner": {"reputation": 138, "user_id": 2406664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcc234459c644f04ba499e7948d9efeb?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/2406664/alex"}, "is_accepted": false, "score": 1, "last_activity_date": 1461127620, "creation_date": 1461127620, "answer_id": 36734047, "question_id": 31903632, "link": "https://stackoverflow.com/questions/31903632/recommended-approach-to-avoid-duplicating-username-in-mongodb/36734047#36734047", "title": "Recommended approach to avoid duplicating username in MongoDB", "body": "<p>Guess the unique index should work for you (if the upinsert does not fit the need).\nSetting those indices in mongo command works fine, another way is to use mgo.EnsureIndex in your code, a quick example can be found at <a href=\"https://gist.github.com/border/3489566\" rel=\"nofollow\">https://gist.github.com/border/3489566</a>.\nAccording to the official document, once the index is successfully created, the EnsureIndex won't be contacting server unless the indices were dropped.</p>\n\n<blockquote>\n  <p>Once EnsureIndex returns successfully, following requests for the same >index will not contact the server unless Collection.DropIndex is used to >drop the same index, or Session.ResetIndexCache is called.</p>\n</blockquote>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1226, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1461127620, "creation_date": 1439119006, "question_id": 31903632, "link": "https://stackoverflow.com/questions/31903632/recommended-approach-to-avoid-duplicating-username-in-mongodb", "title": "Recommended approach to avoid duplicating username in MongoDB", "body": "<p>When a new user attempts to register on my application at present, part of the validation process is to check against the database (MongoDB) whether the username and email are already in use. This validation process is part of my application logic.</p>\n\n<p>I would like to know whether it's possible/better to attempt to save the user without these validation checks and let the DB detect an error (due to duplicated email address or username) which I could then handle.</p>\n\n<p>If so, how could I handle these errors so that I could handle each (username and email). Something in the fashion of...</p>\n\n<pre><code>err := c.Database.C(\"users\").Insert(&amp;user);\nif err != nil {\n    //check whether issue is with email or username or both\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 156, "user_id": 714257, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b2zBN.png?s=128&g=1", "display_name": "jens", "link": "https://stackoverflow.com/users/714257/jens"}, "edited": false, "score": 0, "creation_date": 1439221368, "post_id": 31903607, "comment_id": 51760085, "body": "Thanks for the detailed explanation. Can you also comment on datastore access efficiency? Should I expect a difference compared to batch accesses?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 156, "user_id": 714257, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b2zBN.png?s=128&g=1", "display_name": "jens", "link": "https://stackoverflow.com/users/714257/jens"}, "edited": false, "score": 0, "creation_date": 1439222967, "post_id": 31903607, "comment_id": 51761142, "body": "@jens Batch operations and queries are not alternatives to each other. See edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1439222829, "last_edit_date": 1439222829, "creation_date": 1439118818, "answer_id": 31903607, "question_id": 31902903, "link": "https://stackoverflow.com/questions/31902903/pagination-with-batch-queries-is-it-possible-to-batch-gets-from-the-datastore-a/31903607#31903607", "title": "Pagination with batch queries? Is it possible to batch gets from the datastore and get a cursor?", "body": "<p>Your approach is perfectly fine, in fact, it is the best way on AppEngine.</p>\n\n<p>Querying subsequent entities by setting a start cursor will not give you duplicate results if a new record is inserted which would be the first for example.</p>\n\n<p>Why? Because the cursor contains <em>the key of the last returned entity</em> encoded, and not the number of previously returned entities.</p>\n\n<p>So if you set a cursor, the datastore will start listing and returning entities that come after the key encoded in the cursor. If a new entity is saved that comes after the cursor, then that entity will be returned when reached.</p>\n\n<p>Also using the <code>for</code> and <code>append()</code> is the best way. You might optimize it a little by creating a big enough slice beforehand:</p>\n\n<pre><code>var is = make([]Item, 0, limit)\n</code></pre>\n\n<p>But note that I made it with <code>0</code> length and <code>limit</code> capacity on purpose: there is no guarantee that there will be enough entities to fill the full slice. </p>\n\n<p>Another optimization would be to allocate it to be <code>limit</code> length:</p>\n\n<pre><code>var is = make([]Item, limit)\n</code></pre>\n\n<p>and when <code>datastore.Done</code> is reached, reslice it if it is not filled fully, for example:</p>\n\n<pre><code>for idx := 0; ; idx++ {\n    var i Item\n    _, err := t.Next(&amp;i)\n    if err == datastore.Done {\n        if idx &lt; len(is) {\n            is = is[:idx] // Reslice as it is not filled fully\n        }\n        break\n    }\n\n    is[idx] = i\n}\n</code></pre>\n\n<h3>Batch operations</h3>\n\n<blockquote>\n  <p><code>GetMulti</code>, <code>PutMulti</code> and <code>DeleteMulti</code> are batch versions of the <code>Get</code>, <code>Put</code> and <code>Delete</code> functions. They take a <code>[]*Key</code> instead of a <code>*Key</code>, and may return an <code>appengine.MultiError</code> when encountering partial failure.</p>\n</blockquote>\n\n<p>Batch operations are not a replacement or alternative to queries. <code>GetMulti</code> for example requires you to already have all the keys prepared for which you want to get the complete entities. And as such, there is no sense of a cursor for these batch operations.</p>\n\n<p>Batch operations return you all the requested information (or do all the requested operation). There is no sequence of entities or operations which would/could be terminated and continued later on.</p>\n\n<p>Queries and batch operations are for different things. You shouldn't worry about query and cursor performance. They do quite good, and what's important, they (the Datastore) scale good. A cursor will not slow the execution of a query, a query with a cursor will run just as fast as a query without a cursor, and also previously returned entities do not affect query execution time: it doesn't matter if you run a query without a cursor or with a cursor which you acquired after getting a million entities (which is only possible with several iterations).</p>\n"}], "owner": {"reputation": 156, "user_id": 714257, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b2zBN.png?s=128&g=1", "display_name": "jens", "link": "https://stackoverflow.com/users/714257/jens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 1, "accepted_answer_id": 31903607, "answer_count": 1, "score": 1, "last_activity_date": 1475211653, "creation_date": 1439113614, "last_edit_date": 1475211653, "question_id": 31902903, "link": "https://stackoverflow.com/questions/31902903/pagination-with-batch-queries-is-it-possible-to-batch-gets-from-the-datastore-a", "title": "Pagination with batch queries? Is it possible to batch gets from the datastore and get a cursor?", "body": "<p>I am currently requesting 20 entries from the datastore, return these to the user with a cursor and in case the user is asking for more entries use the cursor as a new start and ask for the next 20 entries.</p>\n\n<p>The code looks something like</p>\n\n<pre><code>q := datastore.NewQuery(\"Item\").\n    Limit(limit)\n\nif cursor, err := datastore.DecodeCursor(cursor); err == nil {\n    q = q.Start(cursor)\n}\n\nvar is []Item\nt := q.Run(c)\nfor {\n    var i Item\n    _, err := t.Next(&amp;i)\n    if err == datastore.Done {\n        break\n    }\n\n    is = append(is, i)\n}\n</code></pre>\n\n<p>In case it is important here is the complete code: <a href=\"https://github.com/koffeinsource/kaffeeshare/blob/master/data/appengine.go#L23\" rel=\"nofollow\">https://github.com/koffeinsource/kaffeeshare/blob/master/data/appengine.go#L23</a></p>\n\n<p>It looks an anti-pattern to use a loop with an <code>append</code>, but I don't see a way to get a cursor when using <code>GetMulti</code>/<code>GetAll</code> or am I missing something?</p>\n\n<p>I do expect a data being added while users are querying the datastore, so an offset may produce duplicate results. Should I care about batching gets in this case?</p>\n"}, {"tags": ["sql", "database", "go"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 5134170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de754dd8279d58e1ce15d8a1c726b47?s=128&d=identicon&r=PG&f=1", "display_name": "rahele", "link": "https://stackoverflow.com/users/5134170/rahele"}, "edited": false, "score": 0, "creation_date": 1439101314, "post_id": 31901332, "comment_id": 51717803, "body": "tnx for your help :) I have another question, should we change this arguments? If we don&#39;t change them would something be wrong?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 89, "user_id": 5134170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de754dd8279d58e1ce15d8a1c726b47?s=128&d=identicon&r=PG&f=1", "display_name": "rahele", "link": "https://stackoverflow.com/users/5134170/rahele"}, "edited": false, "score": 1, "creation_date": 1439210292, "post_id": 31901332, "comment_id": 51751973, "body": "@rahele, each distinct question should be posted on SO independently from others.  This does not affect your reputation (those points) in any way -- in case you&#39;re worried."}], "tags": [], "owner": {"reputation": 9968, "user_id": 868941, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d9269818df2a058ad6bf9dbbaf1e8240?s=128&d=identicon&r=PG", "display_name": "rmuller", "link": "https://stackoverflow.com/users/868941/rmuller"}, "is_accepted": true, "score": 1, "last_activity_date": 1439099456, "creation_date": 1439099456, "answer_id": 31901332, "question_id": 31901235, "link": "https://stackoverflow.com/questions/31901235/how-to-use-sql-server-packages-in-go/31901332#31901332", "title": "how to use sql server packages in go", "body": "<p>\"mssql\" is the protocol/driver/database type you are connecting to. <code>\"user:password@/database\"</code> is the connection string. See <a href=\"https://github.com/denisenkom/go-mssqldb/blob/master/examples/simple.go\" rel=\"nofollow\">this example</a> for the components of this String.</p>\n\n<p>Your application typically knows the database it wants to connect. Or at last when the user logs in.</p>\n"}], "owner": {"reputation": 89, "user_id": 5134170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de754dd8279d58e1ce15d8a1c726b47?s=128&d=identicon&r=PG&f=1", "display_name": "rahele", "link": "https://stackoverflow.com/users/5134170/rahele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 31901332, "answer_count": 1, "score": 0, "last_activity_date": 1439099456, "creation_date": 1439098400, "last_edit_date": 1439099081, "question_id": 31901235, "link": "https://stackoverflow.com/questions/31901235/how-to-use-sql-server-packages-in-go", "title": "how to use sql server packages in go", "body": "<p>I use the denisenkom/go-mssqldb package for connecting to SQL server in go but I don't know how to write the connecting code,\nwhat are the arguments of this method : <code>sql.Open()</code> for example when we say :\n<code>db, err := sql.Open(\"mysql\", \"user:password@/database\")</code>\nwhat do <code>\"mysql\"</code> and <code>\"user:password@/database\"</code> refer to?</p>\n\n<p>and in which part of the program we should tell the name of the database which we want to use in the program? I mean in which part of the code we introduce the name of the database we want to use?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 1, "creation_date": 1439076294, "post_id": 31899490, "comment_id": 51714077, "body": "Try export the fields in <code>Class</code> by making the first letter of <code>id</code> and <code>name</code> uppercase."}, {"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1439157308, "post_id": 31899490, "comment_id": 51732266, "body": "Please consider marking the answer as accepted if it solved your problem. Thanks."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1439157679, "post_id": 31899490, "comment_id": 51732372, "body": "Duplicate of <a href=\"http://stackoverflow.com/questions/26327391/golang-json-marshalstruct-returns\" title=\"golang json marshalstruct returns\">stackoverflow.com/questions/26327391/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439077663, "post_id": 31899640, "comment_id": 51714311, "body": "Close: second one won&#39;t work, because <code>reflect</code> and therefore <code>encoding&#47;json</code> simply can&#39;t see fields with lowercase names. You want to use the field names from the first code snippet, but with struct tags saying they should be filled in from the lowercase key names in the input."}, {"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439078569, "post_id": 31899640, "comment_id": 51714452, "body": "@twotwotwo Fixed. Thanks!"}], "tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": true, "score": 4, "last_activity_date": 1439158006, "last_edit_date": 1439158006, "creation_date": 1439077413, "answer_id": 31899640, "question_id": 31899490, "link": "https://stackoverflow.com/questions/31899490/unmarshal-is-returning-empty-structs/31899640#31899640", "title": "Unmarshal() is returning empty structs", "body": "<p>You can export the fields in your <code>Class</code> struct by changing the first letter of the fields to upper case like this:</p>\n\n<pre><code>type Class struct{\n  Id string\n  Name string\n}\n</code></pre>\n\n<p>Optionally, you can also add tags to the fields like this:</p>\n\n<pre><code>type Class struct{\n  Id string `json: \"id\"`\n  Name string `json: \"name\"`\n}\n</code></pre>\n\n<p>More information on how the <code>json</code> package handles encoding and decoding can be found in the <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\"><code>json.Marshal</code></a> and <a href=\"http://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\"><code>json.Unmarshal</code></a> docs respectively. </p>\n"}], "owner": {"reputation": 143, "user_id": 1523899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83c88d19209b5428fdbd4dfc66f5cbe?s=128&d=identicon&r=PG", "display_name": "Leighner", "link": "https://stackoverflow.com/users/1523899/leighner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 824, "favorite_count": 1, "accepted_answer_id": 31899640, "answer_count": 1, "score": -1, "last_activity_date": 1439158006, "creation_date": 1439075680, "last_edit_date": 1439149513, "question_id": 31899490, "link": "https://stackoverflow.com/questions/31899490/unmarshal-is-returning-empty-structs", "title": "Unmarshal() is returning empty structs", "body": "<p>I'm trying to read from a file and load it into a struct slice. The lines that I read in are loaded correct as shown in the block comment. </p>\n\n<p>The issue I'm having is that the <code>class</code> variable keeps coming back with empty values. What am I doing wrong?</p>\n\n<pre><code>func loadClasses(path string) []Class {\n    var a []Class\n\n    inFile, _ := os.Open(path)\n    defer inFile.Close()\n    scanner := bufio.NewScanner(inFile)\n    scanner.Split(bufio.ScanLines)\n    var class Class\n    for scanner.Scan() {\n        var err = json.Unmarshal(scanner.Bytes(), &amp;class)\n\n        if err != nil {\n            fmt.Print(\"Error:\", err)\n        } else {\n            a = append(a, class)\n        }\n    }\n    return a\n}\n\ntype Class struct {\n    id   string\n    name string\n}\n\n/*\nSample contents\n\"{\"id\":124997,\"name\":\"Environmental Sciences\"}\n{\"id\":123905,\"name\":\"Physical Education\"}\n{\"id\":127834,\"name\":\"Mandarin\"}\n{\"id\":123507,\"name\":\"Biology\"}\n{\"id\":123883,\"name\":\"German\"}\n{\"id\":129148,\"name\":\"German\"}\n{\"id\":123545,\"name\":\"Spanish\"}\"\n\n*/\n</code></pre>\n\n<p>Thank you to isim for the help. My issue was two part, the struct members had to be capitalized and I was missing the <code>json: \"id\"</code> and <code>json: \"name\"</code></p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1439067237, "post_id": 31898196, "comment_id": 51712060, "body": "?Do you have: Users/Anders-air/Documents/go/src/github.com/astaxie/beego"}, {"owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "reply_to_user": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1439068147, "post_id": 31898196, "comment_id": 51712283, "body": "Yes. And inside that folder there is a bee folder."}], "answers": [{"tags": [], "owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "is_accepted": false, "score": 0, "last_activity_date": 1439140371, "creation_date": 1439140371, "answer_id": 31906744, "question_id": 31898196, "link": "https://stackoverflow.com/questions/31898196/bee-command-not-found/31906744#31906744", "title": "Bee command not found", "body": "<p>It seems like the bee has been removed or not installed the correct way. \nAfter running the get command again everything works. </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6338740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2951e84fa28dfff06a981cb2c0eec82?s=128&d=identicon&r=PG&f=1", "display_name": "little xian", "link": "https://stackoverflow.com/users/6338740/little-xian"}, "is_accepted": false, "score": 1, "last_activity_date": 1553624092, "last_edit_date": 1553624092, "creation_date": 1463362692, "answer_id": 37245549, "question_id": 31898196, "link": "https://stackoverflow.com/questions/31898196/bee-command-not-found/37245549#37245549", "title": "Bee command not found", "body": "<p>You should have a path variable named GOBIN, and its path is the bin of your go root path. Run: </p>\n\n<p><code>go install github.com/beego/bee</code></p>\n\n<p>then bee cmd can be used</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 4510593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37b467703c4e7ea7f905160d45054133?s=128&d=identicon&r=PG&f=1", "display_name": "\u90ed\u53cb\u8fdb", "link": "https://stackoverflow.com/users/4510593/%e9%83%ad%e5%8f%8b%e8%bf%9b"}, "is_accepted": false, "score": 3, "last_activity_date": 1481701355, "creation_date": 1481701355, "answer_id": 41137222, "question_id": 31898196, "link": "https://stackoverflow.com/questions/31898196/bee-command-not-found/41137222#41137222", "title": "Bee command not found", "body": "<p>vim .bashrc insert</p>\n\n<pre><code>export GOROOT=/usr/local/Cellar/go/1.7.4/libexec\nexport GOPATH=$HOME/GoLang\nexport PATH=$PATH:$GOPATH/bin\nexport PATH=$PATH:$GOROOT/bin\n</code></pre>\n"}], "owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4997, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1553624092, "creation_date": 1439065335, "question_id": 31898196, "link": "https://stackoverflow.com/questions/31898196/bee-command-not-found", "title": "Bee command not found", "body": "<p>I just started learning golang and beego. Yesterday I installed golang and bee. \nI had alot off trouble getting bee command in command line to work. At a point it started to work. </p>\n\n<p>Today I wanted to continue development. But again it cant find bee command. \nAs far as I know its something with the PATH variable. But everything seems to be right. </p>\n\n<p>Here comes the different informations you might need to help. </p>\n\n<p>Go is installed and works. Go is installed in:</p>\n\n<pre><code>/usr/local/go\n</code></pre>\n\n<p>My project folder for go development is placed in my documents folder:</p>\n\n<pre><code>/Users/Anders-air/Documents/go\n</code></pre>\n\n<p>in this folder i have both bin and src. Src contains my project and packages. And inside bin you will find bee (Unix Executable File)</p>\n\n<p>My bash_profile</p>\n\n<pre><code>export GOPATH=/Users/Anders-air/Documents/go\nexport PATH=$PATH:/Users/Anders-air/Documents/go/bin\n</code></pre>\n\n<p>Hopes someone can help. By the way I am use OSX. </p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1439096034, "post_id": 31898044, "comment_id": 51716930, "body": "Hi , I have the same issue"}, {"owner": {"reputation": 4552, "user_id": 2417948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a6ac877074faa3d602825e4b0b8c797?s=128&d=identicon&r=PG", "display_name": "Patrice", "link": "https://stackoverflow.com/users/2417948/patrice"}, "edited": false, "score": 0, "creation_date": 1439414209, "post_id": 31898044, "comment_id": 51857755, "body": "Hey Erik. If we are looking into rebundling everything under google.golang.org/appengine/* and the fact that aetest still isn&#39;t is causing you issue, maybe posting a defect report (or feature request) on our issue tracker at <a href=\"https://code.google.com/p/googleappengine/issues/list\" rel=\"nofollow noreferrer\">code.google.com/p/googleappengine/issues/list</a> would be a good thing to do? I know the golang team is very active and will look at your request. Obviously don&#39;t phrase it like you did here (here you&#39;re looking for a workaround, on the issue tracker you&#39;d be reporting an issue), but I think that might be the best way to get help :)"}, {"owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "edited": false, "score": 0, "creation_date": 1439472647, "post_id": 31898044, "comment_id": 51883767, "body": "Well, the GAE team is apparently aware that it hasn&#39;t been ported yet, so why poste it as an issue?"}], "answers": [{"comments": [{"owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "edited": false, "score": 1, "creation_date": 1455278815, "post_id": 33967890, "comment_id": 58430242, "body": "As I said <code>aetest</code> was not ported at the time. I put in a request that this should be implemented."}], "tags": [], "owner": {"reputation": 618, "user_id": 2240627, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/834d4b4d06d7e64e8c2343aa91a0e8b2?s=128&d=identicon&r=PG", "display_name": "Ian Rose", "link": "https://stackoverflow.com/users/2240627/ian-rose"}, "is_accepted": false, "score": 2, "last_activity_date": 1448687109, "creation_date": 1448687109, "answer_id": 33967890, "question_id": 31898044, "link": "https://stackoverflow.com/questions/31898044/aetest-and-google-golang-org-appengine/33967890#33967890", "title": "aetest and google.golang.org/appengine", "body": "<p>Something like this should work now:</p>\n\n<pre><code>import (\n  \"google.golang.org/appengine\"\n  \"google.golang.org/appengine/aetest\"\n)\n\nfunc MyTest(t *testing.T) {\n  inst, err := aetest.NewInstance(nil)\n  if err != nil {\n    tb.Fatal(err)\n  }\n  req, err := inst.NewRequest(\"GET\", \"http://www.whatever.com/\", nil)\n  if err != nil {\n    tb.Fatal(err)\n  }\n  ctx := appengine.NewContext(req)\n  ...\n}\n</code></pre>\n"}], "owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1448687109, "creation_date": 1439064281, "last_edit_date": 1439064721, "question_id": 31898044, "link": "https://stackoverflow.com/questions/31898044/aetest-and-google-golang-org-appengine", "title": "aetest and google.golang.org/appengine", "body": "<p>I moved a project from the bundled <code>appengine/*</code> imports to <code>google.golang.org/appengine/*</code>. My test cases still rely on <code>appengine/aetest</code>. Unfortunately the <code>aetest</code> package hasn't been ported yet to <code>google.golang.org/appengine/aetest</code>, which is why I get compile errors because it returns a different context type (<code>appengine.Context</code> instead of <code>x/net/context.Context</code>) as the bundled packages.</p>\n\n<p>I also can't create a new context, because I'd need a <code>http.Request</code> object for that.</p>\n\n<p>Is there a way to work around this?</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "is_accepted": false, "score": 0, "last_activity_date": 1439063179, "creation_date": 1439063179, "answer_id": 31897877, "question_id": 31897411, "link": "https://stackoverflow.com/questions/31897411/how-can-i-tell-if-net-https-responsewriter-write-has-been-called/31897877#31897877", "title": "How can I tell if net/http&#39;s ResponseWriter.Write() has been called?", "body": "<p>First: a lighter-weight solution may exist. </p>\n\n<p>However, if you cannot find one, consider using <a href=\"https://godoc.org/golang.org/x/net/context\" rel=\"nofollow\"><code>x/net/context</code></a> to allow you to implement timeouts, deadlines, and of course, early termination of middleware chains.</p>\n"}, {"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1439077478, "post_id": 31897893, "comment_id": 51714283, "body": "Not calling the next handler and returning early is the correct approach."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 6, "last_activity_date": 1439065119, "last_edit_date": 1439065119, "creation_date": 1439063273, "answer_id": 31897893, "question_id": 31897411, "link": "https://stackoverflow.com/questions/31897411/how-can-i-tell-if-net-https-responsewriter-write-has-been-called/31897893#31897893", "title": "How can I tell if net/http&#39;s ResponseWriter.Write() has been called?", "body": "<p><code>http.ResponseWriter</code> is an interface. So just compose a new instance of it:</p>\n\n<pre><code>type MyResponseWriter struct {\n    http.ResponseWriter\n    WroteHeader bool\n}\n\nfunc (w *MyResponseWriter) Write(b []byte) (int, error) {\n    w.WroteHeader = true\n    return w.ResponseWriter.Write(b)\n}\n\nfunc (w *MyResponseWriter) WriteHeader(code int) {\n    w.WroteHeader = true\n    w.ResponseWriter.WriteHeader(code)\n}\n</code></pre>\n\n<p>And in your handlers:</p>\n\n<pre><code>//...\nif w, ok := w.(*MyResponseWriter); ok &amp;&amp; w.WroteHeader {\n    log.Println(\"Already wrote, skipping\")\n    return\n}\n</code></pre>\n\n<hr>\n\n<p><strong>EDIT:</strong> Another thing to consider. Most of the time if you have a \"chain\" of handlers that means that a handler is called inside a handler. So if you have something like</p>\n\n<pre><code>type Handler1 struct { http.Handler }\ntype Handler2 struct { http.Handler }\ntype Handler3 struct { http.Handler }\nvar MyHandler http.Handler = Handler1{Handler2{Handler3{h}}}\n</code></pre>\n\n<p>as long as each of those call the inner handler <em>as the last thing they do with <code>w</code> and <code>r</code></em>, you should be fine because then <code>w</code> and <code>r</code> won't even reach the inner handler. E.g.</p>\n\n<pre><code>func (h Handler2) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    if somethingBadHappened() {\n        w.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n    h.ServeHTTP(w, r) // Not called if somethingBadHappened().\n}\n</code></pre>\n"}], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "accepted_answer_id": 31897893, "answer_count": 2, "score": 3, "last_activity_date": 1439065119, "creation_date": 1439060028, "question_id": 31897411, "link": "https://stackoverflow.com/questions/31897411/how-can-i-tell-if-net-https-responsewriter-write-has-been-called", "title": "How can I tell if net/http&#39;s ResponseWriter.Write() has been called?", "body": "<p>Suppose I have a chain of net/http Handlers, and an early one responds with an HTTP error (<code>http.StatusInternalServerError</code>, for instance).  How can I detect this in the following handlers, and avoid sending additional data to the client?</p>\n\n<p>Or is this entirely the wrong approach to the problem?</p>\n"}, {"tags": ["google-app-engine", "struct", "go"], "comments": [{"owner": {"reputation": 148, "user_id": 4559286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4622db3d761d3d1f5da503b9424f23a0?s=128&d=identicon&r=PG", "display_name": "szymek", "link": "https://stackoverflow.com/users/4559286/szymek"}, "edited": false, "score": 2, "creation_date": 1439052590, "post_id": 31896278, "comment_id": 51707932, "body": "maybe those fields have to be exported? Only capitalised struct fields are exported. <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported identifiers</a>"}, {"owner": {"reputation": 406, "user_id": 5183141, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gdNcl9Um2Ww/AAAAAAAAAAI/AAAAAAAAAWs/vbp7zvEX3Nc/photo.jpg?sz=128", "display_name": "AmsalK", "link": "https://stackoverflow.com/users/5183141/amsalk"}, "reply_to_user": {"reputation": 148, "user_id": 4559286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4622db3d761d3d1f5da503b9424f23a0?s=128&d=identicon&r=PG", "display_name": "szymek", "link": "https://stackoverflow.com/users/4559286/szymek"}, "edited": false, "score": 0, "creation_date": 1439053273, "post_id": 31896278, "comment_id": 51708142, "body": "I think that this only applies if you wish the identifiers to be exported, which I don&#39;t care much for in this case. I am only using them all internally in this package."}, {"owner": {"reputation": 148, "user_id": 4559286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4622db3d761d3d1f5da503b9424f23a0?s=128&d=identicon&r=PG", "display_name": "szymek", "link": "https://stackoverflow.com/users/4559286/szymek"}, "edited": false, "score": 4, "creation_date": 1439054357, "post_id": 31896278, "comment_id": 51708457, "body": "in <a href=\"https://cloud.google.com/appengine/docs/go/datastore/entities\" rel=\"nofollow noreferrer\">Datastore Entity Doc</a> in Creating an Entity section it is stated that only exported fields are saved to the datastore."}], "answers": [{"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 5, "last_activity_date": 1439055533, "last_edit_date": 1439055533, "creation_date": 1439054267, "answer_id": 31896568, "question_id": 31896278, "link": "https://stackoverflow.com/questions/31896278/golang-app-engine-struct-name/31896568#31896568", "title": "GoLang App Engine Struct Name", "body": "<p>It's related to how Go handles the \"public\" and \"private\" concept.</p>\n\n<p>To export you do need the field names in caps. <a href=\"https://eager.io/blog/go-and-json/\" rel=\"noreferrer\">This</a> can help explain that... it is related to JSON but it applies here as both cases require exporting the data from a struct.</p>\n\n<p>This is from the <a href=\"https://eager.io/blog/go-and-json/\" rel=\"noreferrer\">Eager blog post on Go and JSON</a>, which I found helpful:</p>\n\n<blockquote>\n  <p>The Field Name</p>\n  \n  <p>As you might know, Go requires all exported fields to start with a\n  capitalized letter. \n  It\u2019s not common to use that style in JSON however.\n  We use the tag to let the parser know where to actually look for the\n  value.</p>\n  \n  <p>You can see an example of that in the example above, but as a\n  refresher this is what it looks like:</p>\n\n<pre><code>type MyStruct struct {\n    SomeField string `json:\"some_field\"`\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 406, "user_id": 5183141, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gdNcl9Um2Ww/AAAAAAAAAAI/AAAAAAAAAWs/vbp7zvEX3Nc/photo.jpg?sz=128", "display_name": "AmsalK", "link": "https://stackoverflow.com/users/5183141/amsalk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 31896568, "answer_count": 1, "score": 2, "last_activity_date": 1439056627, "creation_date": 1439052362, "last_edit_date": 1439056627, "question_id": 31896278, "link": "https://stackoverflow.com/questions/31896278/golang-app-engine-struct-name", "title": "GoLang App Engine Struct Name", "body": "<p>I was playing around with the AppEngine recently and came across an issue with the following code, where the only value that seemed to be written to the datastore was the Date. I spent a while banging my head on this to find that by simply capitalizing the first characters in the structs fixed it!</p>\n\n<p>I was wondering if anyone else came across this and knows why I would be unable to use lowercase member names in the Golang struct for the datastore? I think that this may be a bug with the way the Google AppEngine handles struct writes.</p>\n\n<p>Here's the problem code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n\n    \"appengine\"\n    \"appengine/datastore\"\n)\n\n/* This is the problem struct */\ntype storeVal struct {\n    firstName    string  //FirstName works\n    lastName     string  //LastName works\n    email        string  //Email works\n    password     string  //Password works\n    Date         time.Time\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handle)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n\n    /* Write values to DataStore */\n    e1 := storeVal{\n        firstName:      \"Bob\",                 //FirstName works\n        lastName:       \"Smith\",               //lastName works\n        email:          \"bob.smith@test.com\",  //Email works\n        password:       \"password!\",           //Password works\n        Date:           time.Now(),\n    }\n\n    key := datastore.NewIncompleteKey(c, \"storeVal\", nil)\n    _, err := datastore.Put(c, key, &amp;e1)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    fmt.Fprintf(w, \"successfully added {firstName: '%s', lastName: '%s', email: '%s', password: '%s'}\", e1.firstName, e1.lastName, e1.email, e1.password)\n\n    /* Read values back in. */\n    q := datastore.NewQuery(\"storeVal\").\n            Filter(\"firstName =\", \"Bob\").\n            Filter(\"lastName =\", \"Smith\").\n            Order(\"-Date\")\n    var storeVals []storeVal\n    _, err2 := q.GetAll(c, &amp;storeVals)\n    if err2 != nil {\n        http.Error(w, err2.Error(), http.StatusInternalServerError)\n        return\n    }\n    if (len(storeVals) == 0) {\n        fmt.Printf(\"No results.\");\n        return\n    }\n    e2 := storeVals[0]\n    fmt.Fprintf(w, \"successfully grabbed {firstName: '%s', lastName: '%s', email: '%s', password: '%s', uaprem: '%s'}\", e2.firstName, e2.lastName, e2.email, e2.password)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "edited": false, "score": 4, "creation_date": 1439056521, "post_id": 31895910, "comment_id": 51709134, "body": "Can you clarify your question a bit? For example, what is <i>post raw data</i> you are talking about, and in which format you want to convert it back.  And from where it is parsing this data?"}, {"owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "edited": false, "score": 0, "creation_date": 1439081389, "post_id": 31895910, "comment_id": 51714902, "body": "I agree that this question needs more clarification. For one, from where are you getting those different representations? You&#39;ve printed out the original representation, and then the result parsed by golang: How did you arrive at those values? I&#39;m not aware of anything in Go that prints results the way you have."}, {"owner": {"reputation": 121, "user_id": 4609881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7a89befa0359c305f7fb91d4d3644?s=128&d=identicon&r=PG&f=1", "display_name": "benyu", "link": "https://stackoverflow.com/users/4609881/benyu"}, "edited": false, "score": 0, "creation_date": 1439096765, "post_id": 31895910, "comment_id": 51717015, "body": "thanks, how to convert the post data back to its original representation, in my sample is convert 2 back to 1"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439098731, "post_id": 31895910, "comment_id": 51717317, "body": "POST data often arrives URL-encoded, like <code>id=1&amp;direction=1&amp;x=1.0</code>, or JSON-encoded like <code>[{&quot;id&quot;:1,&quot;direction&quot;:1},{&quot;id&quot;:2,&quot;direction&quot;:0}]</code> (note the quotes, and <code>[]</code> for the list). Something like <code>Printf</code> will print data in yet another format that&#39;s designed more for human viewing than decoding, and the original isn&#39;t always recoverable from the <code>Printf</code>&#39;d output. It <i>may</i> be your &quot;1&quot; above is a <code>Printf</code> of some Go structs, and if so that&#39;s probably not really the original format of the POST data. For debugging, <code>r.Body.Read()</code> would get you the raw POST data, just to see what format it&#39;s in."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439099446, "post_id": 31895910, "comment_id": 51717461, "body": "I wonder if the original format is like <code>photo[1][tags][][x]=1.1&amp;photo[1][tags][][id]=2</code>, which would lead to a map like your #2 coming from <code>r.MultipartForm.Values</code>. That&#39;s a peculiar format, but I&#39;ve seen key names like <code>person[name]</code> from some frameworks. As an alternative to <code>r.Body.Read()</code>, you might be able to see information about posted data in the Network tab of your browser&#39;s development tools."}, {"owner": {"reputation": 121, "user_id": 4609881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7a89befa0359c305f7fb91d4d3644?s=128&d=identicon&r=PG&f=1", "display_name": "benyu", "link": "https://stackoverflow.com/users/4609881/benyu"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439134701, "post_id": 31895910, "comment_id": 51725661, "body": "@twotwotwo thanks, for example i post a map in ios like : <code>content =    [ {             id = 547;             sort = 1;             tags =  ( {                     x = &quot;0.35&quot;;                     y = &quot;0.678125&quot;;                 })         },         {name = value;             id = 0;             sort = 2;             type = text;         }]</code> and now how convert  it back to original representation in golang?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1439140909, "post_id": 31895910, "comment_id": 51727630, "body": "I&#39;d recommend using a common format like <a href=\"http://godoc.org/encoding/json\" rel=\"nofollow noreferrer\">JSON</a> to send the data to Go and to send it back. The format in your comment might be Swift source or you see when you print something out for debugging, but as far as I know isn&#39;t a well-known format for sending data over the Internet between servers in different languages."}], "owner": {"reputation": 121, "user_id": 4609881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7a89befa0359c305f7fb91d4d3644?s=128&d=identicon&r=PG&f=1", "display_name": "benyu", "link": "https://stackoverflow.com/users/4609881/benyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439097926, "creation_date": 1439049991, "last_edit_date": 1439097926, "question_id": 31895910, "link": "https://stackoverflow.com/questions/31895910/how-to-parse-post-data-back-into-original-format-in-golang", "title": "how to parse post data back into original format in golang?", "body": "<p>Ok, i think this question is NOT a question in others web programming language like php, python.</p>\n\n<p>but i met this question in golang and confused what is the best way to convert the post raw data back into it's original format.</p>\n\n<p>and here is a sample.</p>\n\n<p><strong>1</strong> original representation is an array consists of map:</p>\n\n<pre><code>photo[1][tags]{id: 1, direction:1, x: 1.0, y: 2, word: 'pull'}\nphoto[1][tags]{id: 2, direction:0, x: 2.0, y: 1.1, word: 'fi'}\n</code></pre>\n\n<blockquote>\n  <p>process handler</p>\n</blockquote>\n\n<pre><code>func testPostData(w http.ResponseWriter, r *http.Request) error{\n    r.ParseMultipartForm(10 &lt;&lt; 20)\n    data := r.ParseMultipartForm.Value\n    fmt.Println(data)\n}\n\n**2** outputs in console\nmap[photo[1][tags][][direction]:[0]\n    photo[1][tags][][word]:[fi]\n    photo[1][tags][][x]:[1.1]\n    photo[1][tags][][id]:[2]]\n</code></pre>\n\n<p>i'm a newbie to golang, so i think there is a way to help to convert <strong>data</strong> back to its original representation, here is convert 2 back to 1</p>\n"}, {"tags": ["windows", "go", "locking"], "comments": [{"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1439069795, "post_id": 31893803, "comment_id": 51712692, "body": "In Windows, you lock a file when you open it.  Look at the documentation for whichever Go function you are using to open the file, perhaps there will be an option to request exclusive access."}], "answers": [{"tags": [], "owner": {"reputation": 150, "user_id": 3976739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f79fed934ce0f544df6acb616fc6d63?s=128&d=identicon&r=PG&f=1", "display_name": "Tanzer", "link": "https://stackoverflow.com/users/3976739/tanzer"}, "is_accepted": true, "score": 1, "last_activity_date": 1439043057, "creation_date": 1439043057, "answer_id": 31893945, "question_id": 31893803, "link": "https://stackoverflow.com/questions/31893803/how-do-i-exclusively-lock-a-file-on-windows/31893945#31893945", "title": "How do I exclusively lock a file on Windows?", "body": "<p>Windows c++ api could help you. The <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa365202%28v=vs.85%29.aspx\" rel=\"nofollow\">LockFile</a> and <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa365203%28v=vs.85%29.aspx\" rel=\"nofollow\">LockFileEx</a> functions seem enough to help. </p>\n"}], "owner": {"reputation": 37, "user_id": 5205289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/672ee2598bea695496f11022a9a9c4c8?s=128&d=identicon&r=PG", "display_name": "moznion", "link": "https://stackoverflow.com/users/5205289/moznion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 31893945, "answer_count": 1, "score": 3, "last_activity_date": 1439061791, "creation_date": 1439041920, "last_edit_date": 1439061791, "question_id": 31893803, "link": "https://stackoverflow.com/questions/31893803/how-do-i-exclusively-lock-a-file-on-windows", "title": "How do I exclusively lock a file on Windows?", "body": "<p>I want to lock file exclusively on Windows environment, but <code>syscall.Flock</code> isn't supported by Windows.\nIs there any way to implement it?</p>\n\n<p>I tried <a href=\"http://ikarishinjieva.github.io/tachikoma-blog/post/2014-03-20-go-file-lock/\" rel=\"nofollow\">this article</a>'s method however it doesn't work (<code>syscall.Syscall6</code> raises \"Access is denied.\" error).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1439040730, "post_id": 31893044, "comment_id": 51703873, "body": "It makes no sense for a <code>go test</code> invocation to allow a test to read from stdin."}, {"owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439089746, "post_id": 31893044, "comment_id": 51715975, "body": "@DaveC, yes. for me it&#39;s just for easier interaction with code before really commit to repo. but I just wondering why it come out differently comparing to running in main."}], "answers": [{"tags": [], "owner": {"reputation": 6086, "user_id": 914967, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7500194166646eb28af858f0374bd744?s=128&d=identicon&r=PG", "display_name": "shawnzhu", "link": "https://stackoverflow.com/users/914967/shawnzhu"}, "is_accepted": true, "score": 0, "last_activity_date": 1439045865, "last_edit_date": 1495542612, "creation_date": 1439045865, "answer_id": 31895279, "question_id": 31893044, "link": "https://stackoverflow.com/questions/31893044/readline-failed-in-go-test-case/31895279#31895279", "title": "Readline Failed in Go Test Case", "body": "<p><strong>Firstly</strong>, your code should be corrected to:</p>\n\n<pre><code>import \"testing/iotest\"\n\nfunc (o *Player) consoleReadLn() string {\n    consoleReader := bufio.NewReader(os.Stdin)\n    s := \"\" \n    for {\n        s1, err := consoleReader.ReadString('\\n')\n        if err == io.EOF {\n            break\n        }\n        if err != nil &amp;&amp; err != iotest.ErrTimeout {\n            panic(\"GetLines: \" + err.Error())\n        }\n        s += s1\n    }\n    return s\n}\n</code></pre>\n\n<p>Because you expect using <code>\\n</code> as delimiter of a line of string, so it will return the data with <code>EOF</code> which is <code>\\n</code> in Unix OS, see godoc <a href=\"http://godoc.org/bufio#Reader.ReadString\" rel=\"nofollow noreferrer\">bufio#Reader.ReadString</a>:</p>\n\n<blockquote>\n  <p>ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter. If ReadString encounters an error before finding a delimiter, it returns the data read before the error and the error itself (often io.EOF). ReadString returns err != nil if and only if the returned data does not end in delim. For simple uses, a Scanner may be more convenient.</p>\n</blockquote>\n\n<p>However, I suggest reading this answer <a href=\"https://stackoverflow.com/questions/12363030/read-from-initial-stdin-in-go/12369689#12369689\">Read from initial stdin in GO?</a></p>\n\n<p><strong>Secondly</strong>, it is hard to test <code>STDIN</code> in unit test context like <code>go test</code>. I found <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/w6TTJpw9stA\" rel=\"nofollow noreferrer\">this mail</a> saying: </p>\n\n<blockquote>\n  <p>the new <code>go test</code> runs tests with standard input connected \n  to <code>/dev/null</code>.</p>\n</blockquote>\n\n<p>So I think it is hard to test <code>os.Stdin</code> via <code>go test</code> directly, for example, the following code confirmed it doesn't read <code>/dev/stdin</code> at all when running command <code>echo this is stdin | go test ./</code>: </p>\n\n<pre><code>import \"io/ioutil\"\nimport \"testing\"\nimport \"fmt\"\n\nfunc TestSTDIN(t *testing.T) {\n    bytes, err := ioutil.ReadAll(os.Stdin)\n\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    fmt.Println(string(bytes))\n}\n</code></pre>\n"}], "owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 1, "accepted_answer_id": 31895279, "answer_count": 1, "score": 0, "last_activity_date": 1439045865, "creation_date": 1439036244, "last_edit_date": 1439039350, "question_id": 31893044, "link": "https://stackoverflow.com/questions/31893044/readline-failed-in-go-test-case", "title": "Readline Failed in Go Test Case", "body": "<p>I'm experimenting getting keyboard input in a test case, basically I followed this example,</p>\n\n<p><a href=\"https://www.socketloop.com/tutorials/golang-read-input-from-console-line\" rel=\"nofollow\">https://www.socketloop.com/tutorials/golang-read-input-from-console-line</a></p>\n\n<p>and in my unit test case, it always result in error of \"EOF\" without giving me a chance to type in from keyboard.</p>\n\n<p>Is there any special in Go unit test environment? Or I should look into another better option?</p>\n\n<p>My code looks like,</p>\n\n<pre><code>func (o *Player) consoleReadLn() (line string) {\n    consoleReader := bufio.NewReader(os.Stdin)\n    line, err := consoleReader.ReadString('\\n')\n    if err != nil {\n        panic(err.Error())   // it just panic: EOF\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "type-conversion", "slice", "type-alias"], "comments": [{"owner": {"reputation": 64568, "user_id": 399317, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/28235d26ee007743c9d2150759d29139?s=128&d=identicon&r=PG", "display_name": "Kos", "link": "https://stackoverflow.com/users/399317/kos"}, "edited": false, "score": 0, "creation_date": 1439025854, "post_id": 31891493, "comment_id": 51700003, "body": "You&#39;re essentially asking how to work around the type system to optimise out a loop. I think the <a href=\"http://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\"><code>unsafe</code></a> package would allow you to do that"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1439025407, "last_edit_date": 1495539927, "creation_date": 1439025407, "answer_id": 31891561, "question_id": 31891493, "link": "https://stackoverflow.com/questions/31891493/why-are-you-unable-convert-slice-types/31891561#31891561", "title": "Why are you unable convert Slice types?", "body": "<p>As mentioned in \"<a href=\"https://stackoverflow.com/questions/19334542/why-can-i-type-alias-functions-and-use-them-without-casting\">Why can I type alias functions and use them without casting?</a>\"</p>\n\n<blockquote>\n  <p><strong>In Go, there is no such thing as a type alias</strong>.<br>\n  The <code>type</code> keyword introduces new <strong><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">named types</a></strong>. They are not aliases</p>\n  \n  <p>If you compare two named types, the names must match in order for them to be interchangeable</p>\n</blockquote>\n\n<p>This is what the <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">spec mentions</a>:</p>\n\n<blockquote>\n  <p>A type declaration binds an identifier, the type name, to a new type that has the same underlying type as an existing type, and operations defined for the existing type are also defined for the new type.<br>\n  <strong>The new type is different from the existing type</strong>. </p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "edited": false, "score": 0, "creation_date": 1439028372, "post_id": 31891863, "comment_id": 51700616, "body": "Thanks @icza, so the underlying representation is the same, it&#39;s just the spec which prevents the conversion - the unsafe conversion was what I was after!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "edited": false, "score": 0, "creation_date": 1439029033, "post_id": 31891863, "comment_id": 51700742, "body": "@jpillora Please see edited answer. Do not use <code>unsafe</code> just because it&#39;s easier. Please use proper design to avoid using <code>unsafe</code> if possible."}, {"owner": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "edited": false, "score": 0, "creation_date": 1439029471, "post_id": 31891863, "comment_id": 51700831, "body": "fair enough and agreed - I&#39;m currently looping through to convert each element and I&#39;ll only use unsafe if performance suffers which it most likely won&#39;t. Maybe it could be avoided completely I guess? The use case is: I&#39;m importing a package <code>foo</code> and I&#39;d like to expose its type <code>foo.Foo</code> in my package, so I&#39;ve re-typed it to prevent the need my users to import both my package <i>and</i> <code>foo</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1486932968, "last_edit_date": 1592644375, "creation_date": 1439027624, "answer_id": 31891863, "question_id": 31891493, "link": "https://stackoverflow.com/questions/31891493/why-are-you-unable-convert-slice-types/31891863#31891863", "title": "Why are you unable convert Slice types?", "body": "<p>This:</p>\n<pre><code>[]Bar(foos)\n</code></pre>\n<p>is a type <a href=\"http://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>. Conversions have specific rules according to the spec:</p>\n<blockquote>\n<p>A non-constant value <code>x</code> can be converted to type <code>T</code> in any of these cases:</p>\n<ul>\n<li><code>x</code> is <a href=\"http://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a> to <code>T</code>.</li>\n<li><code>x</code>'s type and <code>T</code> have identical underlying types.</li>\n<li><code>x</code>'s type and <code>T</code> are unnamed pointer types and their pointer base types have identical underlying types.</li>\n<li><code>x</code>'s type and <code>T</code> are both integer or floating point types.</li>\n<li><code>x</code>'s type and <code>T</code> are both complex types.</li>\n<li><code>x</code> is an integer or a slice of bytes or runes and <code>T</code> is a string type.</li>\n<li><code>x</code> is a string and <code>T</code> is a slice of bytes or runes.</li>\n</ul>\n</blockquote>\n<p>None applies here. Why?</p>\n<p><strong>Because the underlying type of <code>[]Foo</code> is not the same as the underlying type of <code>[]Bar</code>.</strong> And a value of type <code>[]Foo</code> is not assignable to a variable of type <code>[]Bar</code>, see <a href=\"http://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">Assignability rules here</a>.</p>\n<p>The underlying type of <code>Foo</code> is the same as the underlying type of <code>Bar</code>, but the same does not apply to slices where the element type is <code>Foo</code> and <code>Bar</code>.</p>\n<p>So the following works:</p>\n<pre><code>type Foo struct{ A int }\n\ntype Foos []Foo\ntype Bars Foos\n\nfunc main() {\n    foos := []Foo{Foo{1}, Foo{2}}\n    bars := Bars(foos)\n\n    fmt.Println(bars)\n}\n</code></pre>\n<p>Output (try it on the <a href=\"http://play.golang.org/p/qe6wtzkVCy\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>[{1} {2}]\n</code></pre>\n<p>Note that since the actual memory representation of <code>Foo</code> and <code>Bar</code> is the same (because the underlying type of <code>Bar</code> is <code>Foo</code>), in this case using the package <a href=\"http://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\"><code>unsafe</code></a> you can &quot;view&quot; a value of <code>[]Foo</code> as a value of <code>[]Bar</code>:</p>\n<pre><code>type Foo struct{ A int }\ntype Bar Foo\n\nfunc main() {\n    foos := []Foo{Foo{1}, Foo{2}}\n\n    bars := *(*[]Bar)(unsafe.Pointer(&amp;foos))\n\n    fmt.Println(bars)\n    fmt.Printf(&quot;%T&quot;, bars)\n}\n</code></pre>\n<p>This: <code>*(*[]Bar)(unsafe.Pointer(&amp;foos))</code> means that take the address of <code>foos</code>, convert it to <a href=\"http://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\"><code>unsafe.Pointer</code></a> (<a href=\"http://golang.org/ref/spec#Package_unsafe\" rel=\"nofollow noreferrer\">according to spec</a> all pointers can be converted to <code>unsafe.Pointer</code>), then this <code>Pointer</code> is converted to <code>*[]Bar</code> (again according to the spec <code>Pointer</code> can be converted to any other pointer type), and then this pointer is dereferenced (<code>*</code> operator), so the result is a value of type <code>[]Bar</code> as can be seen in the output.</p>\n<p>Output (try it on the <a href=\"http://play.golang.org/p/KuzClGFqUc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>[{1} {2}]\n[]main.Bar\n</code></pre>\n<p><strong>Notes:</strong></p>\n<p>Quoting the package doc of <code>unsafe</code>:</p>\n<blockquote>\n<p>Package unsafe contains operations that step around the type safety of Go programs.</p>\n<p>Packages that import unsafe may be non-portable and are not protected by the Go 1 compatibility guidelines.</p>\n</blockquote>\n<p>What does this mean? It means that you shouldn't revert to using package <code>usafe</code> every time it makes your life easier. You should only use it in exceptional cases, when not using it would make your program really slow and complicated.</p>\n<p>In your program this is not the case as I proposed a working example with just a little refactoring (<code>Foos</code> and <code>Bars</code> being slices).</p>\n<p><code>unsafe</code> steps around the type safety of Go. What does this mean? If you would change the type of <code>foos</code> (e.g. drastically like <code>foos := &quot;trap!&quot;</code>), your program would still compile and run, but most likely runtime panic would occur. Using <code>usafe</code> you lose type checks of the compiler.</p>\n<p>While if you use my other proposal (<code>Foos</code> and <code>Bars</code>), such changes/typos are detected at compile time.</p>\n"}], "owner": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 1, "accepted_answer_id": 31891863, "answer_count": 2, "score": 4, "last_activity_date": 1486932968, "creation_date": 1439024788, "last_edit_date": 1439028143, "question_id": 31891493, "link": "https://stackoverflow.com/questions/31891493/why-are-you-unable-convert-slice-types", "title": "Why are you unable convert Slice types?", "body": "<p>I was wondering why you can't do:</p>\n\n<pre><code>type Foo struct { A int }\ntype Bar Foo\n\nfoos := []Foo{Foo{1}, Foo{2}}\nbars := []Bar(foos)\n//cannot convert foos (type []Foo) to type []Bar\n</code></pre>\n\n<p>and I found out that this would require the runtime to perform a loop over the slice to convert each of the elements, which would be non-idiomatic Go. This makes sense.</p>\n\n<p>However, could this not be solved by the compiler just aliasing <code>Bar</code> as <code>Foo</code>, so internally they're the same and they use the same type header underneath? I'm guessing the answer is no though I'm curious as to why.</p>\n"}, {"tags": ["select", "go", "nullable", "gorp"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439018024, "post_id": 31889704, "comment_id": 51698347, "body": "What type is your <code>nullString</code>? Does it work with <code>sql.NullString</code>?"}, {"owner": {"reputation": 11, "user_id": 5204313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/420d1f00646fbd98b31eb69c945959fb?s=128&d=identicon&r=PG&f=1", "display_name": "renhui yang", "link": "https://stackoverflow.com/users/5204313/renhui-yang"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1439023154, "post_id": 31889704, "comment_id": 51699487, "body": "the nullString definition: type NullString struct { \tsql.NullString }"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1439025523, "post_id": 31889704, "comment_id": 51699933, "body": "Your <code>nullString</code> type isn&#39;t implicitly equivalent to <code>sql.NullString</code>: <a href=\"http://play.golang.org/p/r57VRNDxrw\" rel=\"nofollow noreferrer\">play.golang.org/p/r57VRNDxrw</a> - either type cast it or (better) just use <code>sql.NullString</code>, which makes it clearer for others."}, {"owner": {"reputation": 11, "user_id": 5204313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/420d1f00646fbd98b31eb69c945959fb?s=128&d=identicon&r=PG&f=1", "display_name": "renhui yang", "link": "https://stackoverflow.com/users/5204313/renhui-yang"}, "edited": false, "score": 0, "creation_date": 1439170654, "post_id": 31889704, "comment_id": 51734787, "body": "I use NullString, because I need this this struct can be transfer to Json. I define it like that: <code>type NullString struct { \tsql.NullString }  func (s *NullString) UnmarshalJSON(data []byte) error { \ts.String = strings.Trim(string(data), </code>&quot;<code>) \t&#47;&#47;fmt.Printf(&quot;JsonValue:%v&quot;,string(data)) \t&#47;&#47;s.String = string(data) \ts.Valid = true \treturn nil }  func (s NullString) MarshalJSON() ([]byte, error) {     return json.Marshal(s.String) }</code>"}], "owner": {"reputation": 11, "user_id": 5204313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/420d1f00646fbd98b31eb69c945959fb?s=128&d=identicon&r=PG&f=1", "display_name": "renhui yang", "link": "https://stackoverflow.com/users/5204313/renhui-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 272, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1439009967, "creation_date": 1439008806, "last_edit_date": 1439009967, "question_id": 31889704, "link": "https://stackoverflow.com/questions/31889704/golang-gorp-select-with-nullstring-fail", "title": "golang gorp select with nullString fail", "body": "<p>I define order struct like t</p>\n\n<pre><code>type Order struct {\n    Id      nullString `db:\"O_ID\"`\n    CusTel  int64      `db:\"O_CUS_TEL\"`\n}\n</code></pre>\n\n<p>And I installed a Order object as order, when I called: <code>dbmap.SelectInt(\"SELECT count(*) FROM ORDERS WHERE O_ID=?\",o.Id)</code>\ni got such error:</p>\n\n<pre><code>[gorp] SELECT count(*) FROM ORDERS WHERE O_ID=? []\nSearch order by id:{{00000001 true}} fail:Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?' at line 1\n</code></pre>\n\n<p>But if i use it like that:</p>\n\n<pre><code>dbmap.Db.Exec(\"SELECT count(*) FROM ORDERS WHERE O_ID=?\",o.Id)\n</code></pre>\n\n<p>It`s done.</p>\n\n<p>I don`t know why?</p>\n"}, {"tags": ["file", "go", "attributes", "hardlink"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1439000413, "post_id": 31888955, "comment_id": 51695463, "body": "<i>every</i> regular file is a hard link. There&#39;s no difference between two hard links that point to the same inode, other than their name."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1439001331, "post_id": 31888955, "comment_id": 51695587, "body": "There&#39;s a reason the syscall to delete a file is called &quot;unlink&quot;. (Also, The golang.org/x/sys package is just the syscall package plus updates, since the stdlib syscall is frozen)"}, {"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439001597, "post_id": 31888955, "comment_id": 51695619, "body": "I&#39;ve honestly never thought of it that way before. That clears up a lot. I&#39;m updating my answer to show the reason I want to check this."}], "answers": [{"tags": [], "owner": {"reputation": 339, "user_id": 935228, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a31cf7218b47438e2135da2d2a1f44a?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/935228/jordan"}, "is_accepted": false, "score": 1, "last_activity_date": 1439000719, "creation_date": 1439000719, "answer_id": 31889020, "question_id": 31888955, "link": "https://stackoverflow.com/questions/31888955/check-whether-a-file-is-a-hard-link/31889020#31889020", "title": "Check whether a file is a hard link", "body": "<p>Files are hard links to inodes, you can have multiple hard links to inodes and the file system will not distinguish between them. If you have two files that point to the same inode on disk and remove one the file will still exist. Space is only reclaimed by the file system once all links to the inode have been deleted. </p>\n\n<p>You can use <code>ls -i</code> to determine the index, and <code>stats &lt;path to file&gt;</code> to work out how many links to the inode there are in your file system.</p>\n"}, {"comments": [{"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "edited": false, "score": 0, "creation_date": 1439011606, "post_id": 31889094, "comment_id": 51697192, "body": "Thanks for explaining that! Yeah, the question&#39;s title should be more like &quot;<b>Check whether a file&#39;s inode has any other hardlinks</b>&quot;. Unless anyone thinks I should change the title, I&#39;ll leave it as it is because otherwise the answers won&#39;t make much sense."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "edited": false, "score": 0, "creation_date": 1439016981, "post_id": 31889094, "comment_id": 51698149, "body": "Ah, gotcha. That I don&#39;t know. I&#39;m not sure exactly how it&#39;s implemented under the hood, but I&#39;d guess there&#39;s some kind of &quot;points to me&quot; counter on the inode, in which case there&#39;d probably be some way to access it. But I&#39;m not sure if that&#39;s correct, and even if it is, how you&#39;d go about doing that."}, {"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "edited": false, "score": 0, "creation_date": 1439068763, "post_id": 31889094, "comment_id": 51712419, "body": "Yup you&#39;re right! It&#39;s under <code>syscall.Stat_t.Nlink</code> and <code>syscall.Stat_t.Ino</code>. I found an example within Docker&#39;s source code showing how to get it. I made a quick, condensed example of it in the answer I posted."}, {"owner": {"reputation": 1451, "user_id": 2930836, "user_type": "registered", "accept_rate": 39, "profile_image": "https://lh4.googleusercontent.com/-hOD6KYRyIY4/AAAAAAAAAAI/AAAAAAAAfv0/9V13VHORoHk/photo.jpg?sz=128", "display_name": "igonejack", "link": "https://stackoverflow.com/users/2930836/igonejack"}, "edited": false, "score": 0, "creation_date": 1531386655, "post_id": 31889094, "comment_id": 89579992, "body": "Can we say all files are hard link?"}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1532231163, "post_id": 31889094, "comment_id": 89892792, "body": "Usually, when people say &quot;hard link,&quot; they mean to imply two or more files that share the same inode. But you could certainly imagine defining the term &quot;hard link&quot; such that all files would be hard links. But then the term &quot;hard link&quot; wouldn&#39;t be very helpful, because it would basically mean the same thing as &quot;file&quot; :)"}], "tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": false, "score": 5, "last_activity_date": 1439001672, "creation_date": 1439001672, "answer_id": 31889094, "question_id": 31888955, "link": "https://stackoverflow.com/questions/31888955/check-whether-a-file-is-a-hard-link/31889094#31889094", "title": "Check whether a file is a hard link", "body": "<p>The term \"hard link\" is a bit of a misnomer. The way files work in most filesystems is that a given file (the thing identified by a path, like <code>/foo</code>) is actually just a pointer to a structure called an \"inode.\" Inodes are the structures on disk that actually represent the contents and metadata of the file. When a file is a \"hard link\" to another file, it just means that they both point to the same inode. The system will keep track of the number of files pointing to a given inode, and make sure not to delete the inode until all files pointing to it have been deleted.</p>\n\n<p>Thus, the question \"is this file a hard link\" doesn't really make sense. What <em>does</em> make sense is the question, \"are these two files hard links to each other,\" or, more accurately, \"are these two files pointers to the same inode.\" If you want to answer that question in Go, all you need is <a href=\"https://golang.org/pkg/os/#SameFile\" rel=\"noreferrer\">os.SameFile</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1439040249, "post_id": 31889712, "comment_id": 51703739, "body": "BTW, you usually shouldn&#39;t save/use/refer-to just a files inode number; it&#39;s meaningless without also referring to the device (e.g. save/use/refer-to <code>s.Dev</code>, <code>s.Ino</code> instead). In particular for something like an archive tool walking a file tree it may cross a device/filesystem boundary and would need to distinguish different inodes from different devices that have the same inode number (e.g. by using a struct of <code>s.Dev, s.Ino</code> as a map/set key)."}, {"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1439068500, "post_id": 31889712, "comment_id": 51712365, "body": "That&#39;s a really good point; forgetting to do that could be messy. I&#39;ll make sure to add that to my code. The link to the docker code has an example for that too, thankfully"}], "tags": [], "owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "is_accepted": true, "score": 6, "last_activity_date": 1439010701, "last_edit_date": 1439010701, "creation_date": 1439008849, "answer_id": 31889712, "question_id": 31888955, "link": "https://stackoverflow.com/questions/31888955/check-whether-a-file-is-a-hard-link/31889712#31889712", "title": "Check whether a file is a hard link", "body": "<p>Figured it out from an example in Docker's source code:<br>\n<a href=\"https://github.com/docker/docker/blob/master/pkg/archive/archive.go\" rel=\"noreferrer\">https://github.com/docker/docker/blob/master/pkg/archive/archive.go</a><br>\n<a href=\"https://github.com/docker/docker/blob/master/pkg/archive/archive_unix.go\" rel=\"noreferrer\">https://github.com/docker/docker/blob/master/pkg/archive/archive_unix.go</a></p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"syscall\"\n)\n\nfunc main() {\n    filename := os.Args[1]\n\n    // 'os.Lstat()' reads the link itself.\n    // 'os.Stat()' would read the link's target.\n    fi, err := os.Lstat(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // https://github.com/docker/docker/blob/master/pkg/archive/archive_unix.go\n    // in 'func setHeaderForSpecialDevice()'\n    s, ok := fi.Sys().(*syscall.Stat_t)\n    if !ok {\n        err = errors.New(\"cannot convert stat value to syscall.Stat_t\")\n        log.Fatal(err)\n    }\n\n    // The index number of this file's inode:\n    inode := uint64(s.Ino)\n    // Total number of files/hardlinks connected to this file's inode:\n    nlink := uint32(s.Nlink)\n\n    // True if the file is a symlink.\n    if fi.Mode()&amp;os.ModeSymlink != 0 {\n        link, err := os.Readlink(fi.Name())\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"%v is a symlink to %v on inode %v.\\n\", filename, link, inode)\n        os.Exit(0)\n    }\n\n    // Otherwise, for hardlinks:\n    fmt.Printf(\"The inode for %v, %v, has %v hardlinks.\\n\", filename, inode, nlink)\n    if nlink &gt; 1 {\n        fmt.Printf(\"Inode %v has %v other hardlinks besides %v.\\n\", inode, nlink, filename)\n    } else {\n        fmt.Printf(\"%v is the only hardlink to inode %v.\\n\", filename, inode)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4828, "favorite_count": 1, "accepted_answer_id": 31889712, "answer_count": 3, "score": 4, "last_activity_date": 1605526970, "creation_date": 1439000040, "last_edit_date": 1605526970, "question_id": 31888955, "link": "https://stackoverflow.com/questions/31888955/check-whether-a-file-is-a-hard-link", "title": "Check whether a file is a hard link", "body": "<p>How do you check whether a file is a <em><strong>hard</strong> link</em> in Go? <code>os.FileMode</code> only has a mode for symlinks, not hard links.</p>\n<p>I had an idea that unfortunately doesn't work:</p>\n<pre><code>package main\n\nfunc main() {\n    filename := os.Args[1]\n    var hardlink bool\n    link, _ := os.Readlink(filename)\n    fi, _ := os.Stat(filename)\n    mode := string(fi.Mode().String()[0])\n    if link != &quot;&quot; &amp;&amp; mode != &quot;L&quot; {\n        hardlink = true\n    }\n    fmt.Printf(&quot;%v is hard link? %v\\n&quot;, filename, hardlink)\n}\n</code></pre>\n<p>This^ doesn't work because <code>os.Readlink</code> reads only symlinks, not hard links.</p>\n<p>I found a <em>somewhat</em> related answer:<br />\n<a href=\"https://stackoverflow.com/questions/26854961/counting-hard-links-to-a-file-in-go\">Counting hard links to a file in Go</a><br />\nBut this answer shows how to find the <em>number</em> of hard links to a file, not <em>whether</em> a file itself is a hard link.</p>\n<p>I'm guessing that the <a href=\"https://golang.org/pkg/syscall/#Stat_t\" rel=\"nofollow noreferrer\">syscall</a> package used in that answer or, better yet, the <a href=\"https://godoc.org/golang.org/x/sys/unix#Stat_t\" rel=\"nofollow noreferrer\">sys</a> package has a way to test whether a file's a hard link. Does anyone know to do this? (I have trouble understanding those packages because they're so low-level.)</p>\n<h3>EDIT</h3>\n<p>I should add the reason why I'd like to check this. I'm trying to make a function to create a tar archive of a directory [using <code>filepath.Walk()</code>]. In this function, when I create the <code>*tar.Header</code> for a file, I set a value to <code>*tar.Header.Typeflag</code>.<br />\nFor example, if <code>fi</code> is a file's <code>*os.FileInfo</code> variable and <code>hdr</code> is the <code>*tar.Header</code> variable for that file's place in a new tar archive, it looks like this:</p>\n<pre><code>if fi.Mode().IsDir() {\n    hdr.Typeflag = tar.TypeDir\n}\n</code></pre>\n<p>In the <a href=\"https://golang.org/pkg/archive/tar/#pkg-constants\" rel=\"nofollow noreferrer\">tar</a> package, the modes for hard links and regular files are distinct, <code>TypeLink</code> and <code>TypeReg</code>, but this isn't the case in the <a href=\"https://golang.org/pkg/os/#FileMode\" rel=\"nofollow noreferrer\">os</a> package. So running this won't set the correct <code>Typeflag</code>:</p>\n<pre><code>hdr.Mode = int64(fi.Mode())\n</code></pre>\n"}, {"tags": ["unit-testing", "http", "go"], "answers": [{"tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": false, "score": 0, "last_activity_date": 1439001909, "creation_date": 1439001909, "answer_id": 31889110, "question_id": 31888744, "link": "https://stackoverflow.com/questions/31888744/testing-handler-function-that-relies-on-a-dynamic-url-in-go/31889110#31889110", "title": "Testing Handler Function that relies on a dynamic URL in Go", "body": "<p>The easiest thing I can think of to do would be to create a helper function which takes all of the arguments as the handler, and additionally takes the token as an argument. Then you can unit test that function instead. So something like:</p>\n\n<pre><code>func TokenProcessing(w http.ResponseWriter, r *http.Request) {\n    token := r.URL.Query().Get(\"token\")\n    tokenProcessingHelper(w, r, token)\n}\n\n// unit test me!\nfunc tokenProcessingHelper(w http.ResponseWriter, r *http.Request, token string) {\n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 2, "last_activity_date": 1439004647, "creation_date": 1439004647, "answer_id": 31889341, "question_id": 31888744, "link": "https://stackoverflow.com/questions/31888744/testing-handler-function-that-relies-on-a-dynamic-url-in-go/31889341#31889341", "title": "Testing Handler Function that relies on a dynamic URL in Go", "body": "<p>You can populate the query parameters of a <code>http.Request</code> and then test the handler with a <a href=\"http://golang.org/pkg/net/http/httptest/#NewRecorder\" rel=\"nofollow\"><code>httptest.ResponseRecorder</code></a></p>\n\n<p>e.g.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\n// In this test file to keep the SO example concise\nfunc TokenProcessing(w http.ResponseWriter, r *http.Request) {\n    token := r.URL.Query().Get(\"token\") // dynamically generated from parsed URL\n    // code to do something with said token\n    log.Println(token)\n}\n\nfunc TestTokenProcessing(t *testing.T) {\n    rr := httptest.NewRecorder()\n    r, err := http.NewRequest(\"GET\", \"http://golang.org/\", nil)\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    // Generate suitable values here - e.g. call your generateToken() func\n    r.URL.Query().Add(\"token\", \"someval\")\n\n    handler := http.HandlerFunc(TokenProcessing)\n    handler.ServeHTTP(rr, r)\n\n    if code := rr.Code; code != http.StatusOK {\n        t.Fatalf(\"handler did not return correct status: want %v got %v\",\n            http.StatusOK, code)\n    }\n\n    // Test the rest of the response - i.e. sets a header, etc.\n}\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 31889341, "answer_count": 2, "score": 1, "last_activity_date": 1439004647, "creation_date": 1438997450, "question_id": 31888744, "link": "https://stackoverflow.com/questions/31888744/testing-handler-function-that-relies-on-a-dynamic-url-in-go", "title": "Testing Handler Function that relies on a dynamic URL in Go", "body": "<p>I have been searching around for an answer, but I can't find it. My question is, is it possible to test a handler function that relies on a dynamic URL token?</p>\n\n<p>For example, lets say my handler function requires a token from the URL that is dynamically generated (I don't know how the token is generated nor do I have access to it aside from the URL parameter). My URL would always look something like this: www.example.com/?token=randomtokenhere</p>\n\n<pre><code>func TokenProcessing(w http.ResponseWriter, r *http.Request) {\n     token := r.URL.Query().Get(\"token\") // dynamically generated from parsed URL \n\n      // code to do something with said token\n\n}\n</code></pre>\n\n<p>Is possible to somehow unit test this handler function without access to how the token is created? </p>\n"}, {"tags": ["go", "comparison-operators"], "comments": [{"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438997330, "post_id": 31888438, "comment_id": 51694942, "body": "Check out <a href=\"http://stackoverflow.com/questions/9643205/how-do-i-compare-two-functions-for-pointer-equality-in-the-latest-go-weekly\" title=\"how do i compare two functions for pointer equality in the latest go weekly\">stackoverflow.com/questions/9643205/&hellip;</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438998957, "post_id": 31888438, "comment_id": 51695221, "body": "@DmitriGoldring: Perfect, thanks."}], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "closed_date": 1439001212, "answer_count": 0, "score": 0, "last_activity_date": 1438994123, "creation_date": 1438994123, "question_id": 31888438, "link": "https://stackoverflow.com/questions/31888438/function-identity-in-go", "closed_reason": "Duplicate", "title": "Function identity in Go", "body": "<p>How can I check the identify of a function in Go?</p>\n\n<p>Suppose some code like this:</p>\n\n<pre><code>myCallback := func() { /* Do something */ }\nsomeObject.Callback = myCallback;\n\n// Then sometime later..\n\n/* Has my callback been changed? */\n\nif someObject.Callback != myCallback {\n    log.Fatal(\"Someone changed my callback and didn't ask my permission!\\n\")\n}\n</code></pre>\n\n<p>Of course, this specific code doesn't work. It complains that <code>func can only be compared to nil</code>.</p>\n\n<p>So is there another way to do a function comparison to see if two functions (or function references--is that a thing in Go?) are the same?</p>\n"}, {"tags": ["database", "go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 4754875, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/67d66f6c978bf06265d56bcf4f19e9c1?s=128&d=identicon&r=PG&f=1", "display_name": "mersinvald", "link": "https://stackoverflow.com/users/4754875/mersinvald"}, "edited": false, "score": 0, "creation_date": 1438980852, "post_id": 31885803, "comment_id": 51690603, "body": "Thank you! But it still isn&#39;t clear how to handle this returns in caller function. Of cause, I know what type I wanna get with SQL request, but surely it&#39;s gonna be necessary to check what type was returned. How can I do this type of errorchecking?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 29, "user_id": 4754875, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/67d66f6c978bf06265d56bcf4f19e9c1?s=128&d=identicon&r=PG&f=1", "display_name": "mersinvald", "link": "https://stackoverflow.com/users/4754875/mersinvald"}, "edited": false, "score": 0, "creation_date": 1438981979, "post_id": 31885803, "comment_id": 51691054, "body": "@mersinvald in the calling code you would typically use a &#39;type assertion&#39; or &#39;type switch&#39; to unbox the data. I&#39;ll edit with an example of this (for a developer it works much like a cast though conceptually/internally it&#39;s a bit different). The concept is covered here in the language spec <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1438982223, "last_edit_date": 1438982223, "creation_date": 1438977925, "answer_id": 31885803, "question_id": 31885696, "link": "https://stackoverflow.com/questions/31885696/golang-implementing-database-funcs-using-interfaces/31885803#31885803", "title": "Golang implementing database funcs using interfaces", "body": "<p>Yes, flush can just have the signiture;</p>\n\n<pre><code>flush() interface{}, error\n</code></pre>\n\n<p>How do you implement? Something like this with reasonable method bodies should do it for you;</p>\n\n<pre><code>type MyDbDriver struct {\n     //fields\n}\n\nfunc (d *MyDbDriver) query(request string) error {\n     return nil\n}\n\nfunc (d *MyDbDriver) flush() interface{}, error {\n      return nil, nil\n}\n</code></pre>\n\n<p>In Go all interface implementations are implicit, meaning, if your type has methods that match the interfaces signature, then you've implemented it. No need for something like <code>public class MyType: IMyInterface, IThisIsntCSharp</code>. Note that in the example above <code>*MyDbDriver</code> has implemented your interface but <code>MyDbDriver</code> has not.</p>\n\n<p>Edit: below a some pseudo calling code;</p>\n\n<pre><code>e := driver.query(\"select * from thatTable where ThatProperty = 'ThatValue'\")\nif e != nil {\n    return nil, e\n}\n\ni, err := driver.flush()\nif err != nil {\n     return nil, err\n}\n\nMyConcreteInstance := i.(MyConcreteType)\n// note that this will panic if the type of i is not MyConcreteType\n// that can be avoided with the familiar object, err calling syntax\nMyConcreteIntance, ok := i.(MyConcreteType)\nif !ok {\n      // the type of i was not MyConcreteType :\\\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 4754875, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/67d66f6c978bf06265d56bcf4f19e9c1?s=128&d=identicon&r=PG&f=1", "display_name": "mersinvald", "link": "https://stackoverflow.com/users/4754875/mersinvald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "accepted_answer_id": 31885803, "answer_count": 1, "score": 0, "last_activity_date": 1438982223, "creation_date": 1438977538, "question_id": 31885696, "link": "https://stackoverflow.com/questions/31885696/golang-implementing-database-funcs-using-interfaces", "title": "Golang implementing database funcs using interfaces", "body": "<p>Sorry for a bit dummy questions, but I'm kinda stuck.</p>\n\n<p>So, I'm implementing wrapper above database driver for my application, and I need to keep it as portable as possible.\nI came to decision that interfaces are perfect match for this task. So, I have my database struct with some variables and app-specific methods, and two interface functions: </p>\n\n<pre><code>query(request string) error\nflush() int? string?? struct?? slice????, error\n</code></pre>\n\n<p>Now you probably got the main question. How do I do return data that type \"flush()\" doesn't know? Can I return it by interface, and if I can, how to work with that?</p>\n\n<p>Second question is pretty basic, but still it isn't clear to me.\nSo, I have this database struct with two methods designed to be implemented by package user to use db driver he want. <br>\nHo do I write it and how future implementation will look (there is an example on tour of go, but it's about interface for different structs with similar methods)<br>\nHope you'll help me find an understanding :) </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "edited": false, "score": 1, "creation_date": 1438971920, "post_id": 31884093, "comment_id": 51686249, "body": "Related: <a href=\"http://stackoverflow.com/questions/25671305/golang-io-copy-twice-on-the-request-body\" title=\"golang io copy twice on the request body\">stackoverflow.com/questions/25671305/&hellip;</a>, basically: use <a href=\"http://golang.org/pkg/io/#TeeReader\" rel=\"nofollow noreferrer\">io.TeeReader</a>."}, {"owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "reply_to_user": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "edited": false, "score": 1, "creation_date": 1438972761, "post_id": 31884093, "comment_id": 51686666, "body": "thanks, I&#39;ve add a sample code as answer, hoping this is useful for other users"}], "answers": [{"comments": [{"owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "edited": false, "score": 1, "creation_date": 1438974397, "post_id": 31884568, "comment_id": 51687476, "body": "Wonderful. I took the liberty to write a <a href=\"http://sscce.org/\" rel=\"nofollow noreferrer\">sscce</a>: <a href=\"https://gist.github.com/miku/293f253b706c4de1b75c\" rel=\"nofollow noreferrer\">gist.github.com/miku/293f253b706c4de1b75c</a>."}, {"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "edited": false, "score": 1, "creation_date": 1581495009, "post_id": 31884568, "comment_id": 106448841, "body": "Please note you need to close the Reader. This is usually done automatically by http server but of course you swapped it with a no-op closer."}], "tags": [], "owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "is_accepted": false, "score": 3, "last_activity_date": 1450111396, "last_edit_date": 1450111396, "creation_date": 1438972842, "answer_id": 31884568, "question_id": 31884093, "link": "https://stackoverflow.com/questions/31884093/read-multiple-time-a-reader/31884568#31884568", "title": "Read multiple time a Reader", "body": "<p>Actually, thanks to miku, I've found out that the best solution is using a TeeReader, changing Method1 in this way</p>\n\n<pre><code>func Method1 (w http.ResponseWriter, r *http.Request){\n    b := bytes.NewBuffer(make([]byte, 0))\n    reader := io.TeeReader(r.Body, b)\n\n    var postData MyStruct\n    if err := json.NewDecoder(reader).Decode(&amp;postData); err != nil {\n        //return an error\n    }\n\n    r.Body = ioutil.NopCloser(b)\n}\n</code></pre>\n"}], "owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2281, "favorite_count": 3, "answer_count": 1, "score": 2, "last_activity_date": 1450111396, "creation_date": 1438970856, "last_edit_date": 1438971739, "question_id": 31884093, "link": "https://stackoverflow.com/questions/31884093/read-multiple-time-a-reader", "title": "Read multiple time a Reader", "body": "<p>I have two http handlers that use the same http.ResponseWriter and *http.Request and read the request body like this:</p>\n\n<pre><code>func Method1 (w http.ResponseWriter, r *http.Request){\n    var postData database.User\n    if err := json.NewDecoder(r.Body).Decode(&amp;postData); err != nil {\n      //return error\n    }\n}\n\nfunc Method2 (w http.ResponseWriter, r *http.Request){\n    var postData database.User\n    //this read gives (of course) EOF error\n    if err := json.NewDecoder(r.Body).Decode(&amp;postData); err != nil {\n      //return error\n    }\n}\n</code></pre>\n\n<p>Because of I need to keep these 2 methods separated, and both of them need to read the request Body, which is the best way (if it's possible) to Seek the request body (which is a ReadCloser, not a Seeker?).</p>\n"}, {"tags": ["json", "go", "fiddler"], "comments": [{"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1438964027, "post_id": 31882254, "comment_id": 51682070, "body": "After restarting the programme the JSON object is prepended with <code>34f7</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1438965081, "post_id": 31882254, "comment_id": 51682691, "body": "Can you post a complete, minimal example that reproduces the behavior?"}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 2, "creation_date": 1438965749, "post_id": 31882254, "comment_id": 51683055, "body": "Looks like you&#39;re seeing an HTTP chunked response"}, {"owner": {"reputation": 784, "user_id": 3503018, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7e6d550031a8364c0f8035d173ddb236?s=128&d=identicon&r=PG&f=1", "display_name": "soufrk", "link": "https://stackoverflow.com/users/3503018/soufrk"}, "edited": false, "score": 0, "creation_date": 1525135041, "post_id": 31882254, "comment_id": 87237250, "body": "Any idea how to remove this in a Spring-Boot RESTful app ?"}], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 2, "last_activity_date": 1438979518, "creation_date": 1438979518, "answer_id": 31886173, "question_id": 31882254, "link": "https://stackoverflow.com/questions/31882254/fiddler-surrounds-json-response/31886173#31886173", "title": "Fiddler Surrounds JSON Response", "body": "<p>This is http 1.1 chunked response.  The protocol will send the format:</p>\n\n<pre><code>size-of-chunk-in-hex\nchunk\n...\n</code></pre>\n\n<p>The final chunk size of 0 signifies the end of the response.  Your example show the response is 13550 bytes, and is sent in one chunk.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1438982542, "creation_date": 1438982542, "answer_id": 31886838, "question_id": 31882254, "link": "https://stackoverflow.com/questions/31882254/fiddler-surrounds-json-response/31886838#31886838", "title": "Fiddler Surrounds JSON Response", "body": "<p>You're dealing with a chunked response. I'm not sure what your end goal is but there are a few different options. The source itself says;</p>\n\n<pre><code>    // Body represents the response body.\n    //\n    // The http Client and Transport guarantee that Body is always\n    // non-nil, even on responses without a body or responses with\n    // a zero-length body. It is the caller's responsibility to\n    // close Body.\n    //\n    // The Body is automatically dechunked if the server replied\n    // with a \"chunked\" Transfer-Encoding.\n    Body io.ReadCloser\n</code></pre>\n\n<p>So for example here; <code>response, err := ioutil.ReadAll(resp.Body)</code> where you're relaying the response from the other service, you could fix the problem by making the service that provided <code>resp</code> set a Transfer-Encoding header with the value chunked, assuming you have access to that api as well. If you're only working in this middle layer, then you'll have to dechunk the response yourself before writing it. If the request you're monitoring in Fiddler doesn't have <code>chunked</code> Transfer-Encoding, just adding that may cause Fiddler to display it the same as you see it in Postman.</p>\n"}], "owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "accepted_answer_id": 31886838, "answer_count": 2, "score": 4, "last_activity_date": 1438982542, "creation_date": 1438963867, "question_id": 31882254, "link": "https://stackoverflow.com/questions/31882254/fiddler-surrounds-json-response", "title": "Fiddler Surrounds JSON Response", "body": "<p>I have a web service implemented in Go that returns a JSON structure from an external service. Upon returning the object, it looks like this:</p>\n\n<pre><code>{\"otherServiceInfoList\":[],\"action...\n</code></pre>\n\n<p>My Go web service simply reads the JSON to a slice:</p>\n\n<pre><code>response, err := ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>and returns it to the client:</p>\n\n<pre><code>w.Write(response)\n</code></pre>\n\n<p>The response is displayed as-is in Postman, however Fiddler both prepends and appends the response as follows:</p>\n\n<pre><code>34ee\n{\"otherServiceInfoList\":[],\"...\n0\n</code></pre>\n\n<p>Note the leading <code>34ee</code> and trailing <code>0</code>.</p>\n\n<p>I am then promoted to transform the response:</p>\n\n<blockquote>\n  <p>\"Response is encoded and may require decoding before inspection.\"</p>\n</blockquote>\n\n<p>Accepting the prompt removes returns the original JSON. Is Go's <code>w.write</code> method applying the extra characters, or is this specific to Fiddler?</p>\n\n<p>Incidentally, I'm setting the following header before writing to the buffer:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n</code></pre>\n"}, {"tags": ["go", "synchronization", "queue"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438959035, "post_id": 31880252, "comment_id": 51678810, "body": "You need to close the <code>results</code> chan when all your workers are done. Are you asking <i>how</i> to do that?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438976554, "post_id": 31884466, "comment_id": 51688513, "body": "Your second example is essentially making a less efficient WaitGroup, that&#39;s harder to get right."}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438977554, "post_id": 31884466, "comment_id": 51689024, "body": "Right, but I am just trying to enumerate the options here. I have no idea about the actual program and in some cases the channel-based alternative works best."}, {"owner": {"reputation": 1, "user_id": 5202525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba741e6cb96af458c7af0e13a5551e64?s=128&d=identicon&r=PG&f=1", "display_name": "gogole", "link": "https://stackoverflow.com/users/5202525/gogole"}, "edited": false, "score": 0, "creation_date": 1439733331, "post_id": 31884466, "comment_id": 51972500, "body": "Thank you for your answers, I understand better now the operation.  Nonetheless, I tested two solutions, but none solves the problem.  In 2 cases, goroutines embark but there is no result returned, the print is ineffective and I did not see the tail will unstack results.  I do not understand why with your solutions, this does not solve the problem.  I am new golang but I&#39;m used to working with the queues, threads and coroutines in Python.  But, I do not understand why this is not working."}, {"owner": {"reputation": 1, "user_id": 5202525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba741e6cb96af458c7af0e13a5551e64?s=128&d=identicon&r=PG&f=1", "display_name": "gogole", "link": "https://stackoverflow.com/users/5202525/gogole"}, "edited": false, "score": 0, "creation_date": 1439734048, "post_id": 31884466, "comment_id": 51972749, "body": "If you want test, the flux.txt file is a flat text file with rss/atom."}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": false, "score": 2, "last_activity_date": 1438972342, "creation_date": 1438972342, "answer_id": 31884466, "question_id": 31880252, "link": "https://stackoverflow.com/questions/31880252/how-to-close-a-channel/31884466#31884466", "title": "How to close a channel", "body": "<p>The problem is that, in the example you are referring to, the worker pool reads from <code>results</code> 9 times:</p>\n\n\n\n<pre><code>for a := 1; a &lt;= 9; a++ {\n    &lt;-results\n}\n</code></pre>\n\n<p>Your program, on the other hand, does a range loop over the <code>results</code> which has a different semantics in go. The range operator does not stop until the channel is closed.</p>\n\n\n\n<pre><code>for msg := range results {\n    fmt.Println(msg)\n}\n</code></pre>\n\n<p>To fix your problem you'd need to close the <code>results</code> channel. However, if you just call <code>close(results)</code> before the for loop, you most probably will \nget a panic, because the workers might be writing on <code>results</code>.</p>\n\n<p>To fix this problem, you need to add another channel to be notified when all the workers are done. You can do this either using a <code>sync.WaitGroup</code> or : </p>\n\n\n\n<pre><code>const (\n    workers = 16\n)\n\nfunc main() {\n    jobs := make(chan string, 100)\n    results := make(chan string, 100)\n    var wg sync.WaitGroup\n\n    for w := 0; w &lt; workers; w++ {\n        go func() {\n            wg.Add(1)\n            defer wg.Done()\n            worker(w, jobs, results)\n        }()\n    }\n\n    urls, err := readLines(\"flux.txt\")\n    if err != nil {\n        log.Fatalf(\"readLines: %s\", err)\n    }\n\n    for _, url := range urls {\n        jobs &lt;- url\n    }\n\n    close(jobs)\n\n    wg.Wait()\n\n    close(results)\n\n    // it seems program runs over...\n    for msg := range results {\n        fmt.Println(msg)\n    }\n}\n</code></pre>\n\n<p>Or a <code>done</code> channel:</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"github.com/SlyMarbo/rss\"\n    \"log\"\n    \"os\"\n)\n\nfunc readLines(path string) ([]string, error) {\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    var lines []string\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n    return lines, scanner.Err()\n}\n\nfunc worker(id int, jobs &lt;-chan string, results chan&lt;- string, done chan struct{}) {\n    for url := range jobs {\n        fmt.Println(\"worker\", id, \"processing job\", url)\n        feed, err := rss.Fetch(url)\n        if err != nil {\n            fmt.Println(\"Error on: \", url)\n            continue\n        }\n        borne := 0\n        for _, value := range feed.Items {\n            if borne &lt; 5 {\n                results &lt;- value.Link\n                borne = borne + 1\n            } else {\n                continue\n            }\n        }\n    }\n    close(done)\n}\n\nconst (\n    workers = 16\n)\n\nfunc main() {\n    jobs := make(chan string, 100)\n    results := make(chan string, 100)\n    dones := make([]chan struct{}, workers)\n\n    for w := 0; w &lt; workers; w++ {\n        dones[w] = make(chan struct{})\n        go worker(w, jobs, results, dones[w])\n    }\n\n    urls, err := readLines(\"flux.txt\")\n    if err != nil {\n        log.Fatalf(\"readLines: %s\", err)\n    }\n\n    for _, url := range urls {\n        jobs &lt;- url\n    }\n\n\n    close(jobs)\n\n    for _, done := range dones {\n        &lt;-done\n    }\n\n    close(results)\n\n    // it seems program runs over...\n    for msg := range results {\n        fmt.Println(msg)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5202525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba741e6cb96af458c7af0e13a5551e64?s=128&d=identicon&r=PG&f=1", "display_name": "gogole", "link": "https://stackoverflow.com/users/5202525/gogole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1439734282, "creation_date": 1438957872, "last_edit_date": 1439734282, "question_id": 31880252, "link": "https://stackoverflow.com/questions/31880252/how-to-close-a-channel", "title": "How to close a channel", "body": "<p>I try to adapt this example:\n<a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow\">https://gobyexample.com/worker-pools</a></p>\n\n<p>But I don't know how to stop the channel because program don't exit at the end of the channel loop.</p>\n\n<p>Can you explain how to exit the program?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/SlyMarbo/rss\"\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc readLines(path string) ([]string, error) {\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    var lines []string\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n    return lines, scanner.Err()\n}\n\n\nfunc worker(id int, jobs &lt;-chan string, results chan&lt;- string) {\n    for url := range jobs {\n        fmt.Println(\"worker\", id, \"processing job\", url)\n        feed, err := rss.Fetch(url)\n        if err != nil {\n            fmt.Println(\"Error on: \", url)\n            continue\n        }\n        borne := 0\n        for _, value := range feed.Items {\n            if borne &lt; 5 {\n                results &lt;- value.Link\n                borne = borne +1\n            } else {\n                continue\n            }\n        }\n    }\n}\n\n\nfunc main() {\n    jobs := make(chan string)\n    results := make(chan string)\n\n    for w := 1; w &lt;= 16; w++ {\n        go worker(w, jobs, results)\n    }\n\n\n    urls, err := readLines(\"flux.txt\")\n    if err != nil { \n        log.Fatalf(\"readLines: %s\", err) \n    }\n\n    for _, url := range urls {\n        jobs &lt;- url\n    }\n\n    close(jobs)\n\n    // it seems program runs over...\n    for msg := range results {\n        fmt.Println(msg)\n    }\n}\n</code></pre>\n\n<p>The flux.txt is a flat text file like :</p>\n\n<ul>\n<li><a href=\"http://blog.case.edu/news/feed.atom\" rel=\"nofollow\">http://blog.case.edu/news/feed.atom</a></li>\n<li>...</li>\n</ul>\n"}, {"tags": ["linux", "memory", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438957361, "post_id": 31879817, "comment_id": 51677703, "body": "You have to look up the memory usage via the OS&#39;s facilities. You have the PID already, that&#39;s all you should need."}, {"owner": {"reputation": 1320, "user_id": 577133, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/a7fca2db6ff3f4583df98043bd5166f9?s=128&d=identicon&r=PG", "display_name": "atmosx", "link": "https://stackoverflow.com/users/577133/atmosx"}, "edited": false, "score": 0, "creation_date": 1438958054, "post_id": 31879817, "comment_id": 51678152, "body": "<a href=\"http://stackoverflow.com/questions/131303/how-to-measure-actual-memory-usage-of-an-application-or-process\">This answer</a> is very relevant. You could start by using <code>htop</code> or running a script which will monitor a single process. I would also consider this <a href=\"https://github.com/dtrace4linux/linux\" rel=\"nofollow noreferrer\">dtrace for linux</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1438965178, "post_id": 31879817, "comment_id": 51682735, "body": "Is there a reason not use ulimit or some other third-party process-limiting service?"}, {"owner": {"reputation": 1853, "user_id": 3186886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3336bbf9f0d7330e06dc19753106a322?s=128&d=identicon&r=PG", "display_name": "mraron", "link": "https://stackoverflow.com/users/3186886/mraron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438969037, "post_id": 31879817, "comment_id": 51684702, "body": "@JimB Ok, so there&#39;s no go-standard way. Thanks! :)"}, {"owner": {"reputation": 1853, "user_id": 3186886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3336bbf9f0d7330e06dc19753106a322?s=128&d=identicon&r=PG", "display_name": "mraron", "link": "https://stackoverflow.com/users/3186886/mraron"}, "reply_to_user": {"reputation": 1320, "user_id": 577133, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/a7fca2db6ff3f4583df98043bd5166f9?s=128&d=identicon&r=PG", "display_name": "atmosx", "link": "https://stackoverflow.com/users/577133/atmosx"}, "edited": false, "score": 0, "creation_date": 1438969265, "post_id": 31879817, "comment_id": 51684827, "body": "@atmosx Thanks for the answer link, it was very helpful! However the dtrace seems a bit overkill for me! :)"}, {"owner": {"reputation": 1853, "user_id": 3186886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3336bbf9f0d7330e06dc19753106a322?s=128&d=identicon&r=PG", "display_name": "mraron", "link": "https://stackoverflow.com/users/3186886/mraron"}, "edited": false, "score": 1, "creation_date": 1438969281, "post_id": 31879817, "comment_id": 51684835, "body": "@Filmzy Sorry for confusion, but I don&#39;t want to kill the process if it&#39;s memory usage is bigger than some bound, I just want to measure its memory usage. My bad, it was a bad example. I will edit it :)"}], "answers": [{"comments": [{"owner": {"reputation": 1853, "user_id": 3186886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3336bbf9f0d7330e06dc19753106a322?s=128&d=identicon&r=PG", "display_name": "mraron", "link": "https://stackoverflow.com/users/3186886/mraron"}, "edited": false, "score": 0, "creation_date": 1438969403, "post_id": 31881979, "comment_id": 51684905, "body": "Wow I tried it out, and that&#39;s what I need. Exactly. Thank you very much!"}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 6, "last_activity_date": 1476487766, "last_edit_date": 1476487766, "creation_date": 1438962935, "answer_id": 31881979, "question_id": 31879817, "link": "https://stackoverflow.com/questions/31879817/golang-os-exec-realtime-memory-usage/31881979#31881979", "title": "Golang os/exec, realtime memory usage", "body": "<p>Here is what I use on Linux:</p>\n\n<pre><code>func calculateMemory(pid int) (uint64, error) {\n\n    f, err := os.Open(fmt.Sprintf(\"/proc/%d/smaps\", pid))\n    if err != nil {\n        return 0, err\n    }\n    defer f.Close()\n\n    res := uint64(0)\n    pfx := []byte(\"Pss:\")\n    r := bufio.NewScanner(f)\n    for r.Scan() {\n        line := r.Bytes()\n        if bytes.HasPrefix(line, pfx) {\n            var size uint64\n            _, err := fmt.Sscanf(string(line[4:]), \"%d\", &amp;size)\n            if err != nil {\n                return 0, err\n            }\n            res += size\n        }\n    }\n    if err := r.Err(); err != nil {\n        return 0, err\n    }\n\n    return res, nil\n}\n</code></pre>\n\n<p>This function returns the <a href=\"https://en.wikipedia.org/wiki/Proportional_set_size\" rel=\"nofollow\">PSS (Proportional Set Size)</a> for a given PID, expressed in KB. If you have just started the process, you should have the rights to access the corresponding /proc file.</p>\n\n<p>Tested with kernel 3.0.13.</p>\n"}], "owner": {"reputation": 1853, "user_id": 3186886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3336bbf9f0d7330e06dc19753106a322?s=128&d=identicon&r=PG", "display_name": "mraron", "link": "https://stackoverflow.com/users/3186886/mraron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3740, "favorite_count": 3, "accepted_answer_id": 31881979, "answer_count": 1, "score": 6, "last_activity_date": 1476487766, "creation_date": 1438956743, "last_edit_date": 1495542868, "question_id": 31879817, "link": "https://stackoverflow.com/questions/31879817/golang-os-exec-realtime-memory-usage", "title": "Golang os/exec, realtime memory usage", "body": "<p>I'm using Linux, go, and os/exec to run some commands.\nI want to know a process' realtime memory usage. That means that I can ask for memory usage anytime after I start the process, not just after it ran.</p>\n\n<p>(That's why the answer in <a href=\"https://stackoverflow.com/questions/27625787/measuring-memory-usage-of-executable-run-using-golang\">Measuring memory usage of executable run using golang</a> is <em>not</em> an option for me)</p>\n\n<p>For example:</p>\n\n<pre><code>cmd := exec.Command(...)\ncmd.Start()\n//...\nif cmd.Memory()&gt;50 { \n    fmt.Println(\"Oh my god, this process is hungry for memory!\")\n}\n</code></pre>\n\n<p>I don't need very precise value, but it would be great if it's error range is lower than, say, 10 megabytes.</p>\n\n<p>Is there a go way to do that or I need some kind of command line trick?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1438956496, "post_id": 31879662, "comment_id": 51677128, "body": "After you install your package, there&#39;s no guarantee where the binary is in relation to the original source, or that the source will still be there at all."}, {"owner": {"reputation": 5238, "user_id": 1713216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5652386ca2b1ba0a7c45791cb580b19b?s=128&d=identicon&r=PG", "display_name": "neurosnap", "link": "https://stackoverflow.com/users/1713216/neurosnap"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438956730, "post_id": 31879662, "comment_id": 51677276, "body": "So how could I package the file into the binary?  Or is that a terrible idea?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1438957051, "post_id": 31879662, "comment_id": 51677481, "body": "Packing files into the binary: <a href=\"http://stackoverflow.com/questions/13904441/whats-the-best-way-to-bundle-static-resources-in-a-go-program\">What&#39;s the best way to bundle static resources in a Go program?</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438957055, "post_id": 31879662, "comment_id": 51677485, "body": "Put the version string in the source directly, or add it at build time with <code>go build -ldflags &quot;-X main.SemVer $(cat VERSION)&quot; my&#47;package&#47;</code> : (see <a href=\"http://stackoverflow.com/questions/11354518/golang-application-auto-build-versioning\" title=\"golang application auto build versioning\">stackoverflow.com/questions/11354518/&hellip;</a>)"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438959777, "post_id": 31879662, "comment_id": 51679308, "body": "@JimB It&#39;s worth reminding that the <a href=\"http://tip.golang.org/doc/go1.5#link\" rel=\"nofollow noreferrer\">recommended syntax in Go 1.5+</a> is <code>-X pkg.Var=value</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1438959947, "post_id": 31879662, "comment_id": 51679425, "body": "@Ainar-G: yes. I didn&#39;t mention it yet, because unfortunately that syntax <i>doesn&#39;t</i> work on the current release, while the old syntax will continue to work with a warning message ;)"}, {"owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "edited": false, "score": 0, "creation_date": 1439011735, "post_id": 31879662, "comment_id": 51697211, "body": "In my projects, I actually use git annotated tags.  Whenever I want to update my package, I call <code>git tag -a 0.5</code> then in my Makefile I do <code>go build -ldflags &quot;-x main.Version=</code>git rev-parse --abbrev-ref HEAD`&quot; it works okay for me.  The only issues, is that if your package is go get&#39;ed you the Version will be a blank string."}], "owner": {"reputation": 5238, "user_id": 1713216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5652386ca2b1ba0a7c45791cb580b19b?s=128&d=identicon&r=PG", "display_name": "neurosnap", "link": "https://stackoverflow.com/users/1713216/neurosnap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1155, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1438961299, "creation_date": 1438956248, "last_edit_date": 1495539828, "question_id": 31879662, "link": "https://stackoverflow.com/questions/31879662/golang-how-to-get-data-files-from-package-directory", "title": "Golang: How to get data files from package directory", "body": "<p>Is there a standard way to READ files within the package directory?</p>\n\n<p>Just as an example, I have a file \"VERSION\" that contains the semantic version of my package, how can I read that file within my go application once the application has been installed?</p>\n\n<p>I've tried all the suggestions on this SO: <a href=\"https://stackoverflow.com/questions/18537257/golang-how-to-get-the-directory-of-the-currently-running-file\">Golang: How to Get the Directory of the Currently running File?</a></p>\n\n<p>A third-party package \"osext\" was the only method that actually produced reliable results.</p>\n\n<p>EDIT: For my specific example, <code>go build -ldflags \"-X main.VERSION X.X.X\"</code> works perfectly.</p>\n"}, {"tags": ["http", "go", "server", "url-pattern"], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 4305917, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100001241510496/picture?type=large", "display_name": "Shailesh", "link": "https://stackoverflow.com/users/4305917/shailesh"}, "edited": false, "score": 0, "creation_date": 1438949922, "post_id": 31877486, "comment_id": 51672682, "body": "Thanks @icza, I appreciate it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1438959625, "last_edit_date": 1592644375, "creation_date": 1438949679, "answer_id": 31877486, "question_id": 31877296, "link": "https://stackoverflow.com/questions/31877296/how-to-restrict-web-server-written-in-golang-to-allow-a-particular-address-inste/31877486#31877486", "title": "How to restrict web server written in golang to allow a particular address instead of a pattern?", "body": "<p>The URL pattern to which you register your handlers is documented in the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\"><code>http.ServeMux</code></a> type:</p>\n<blockquote>\n<p>Patterns name fixed, rooted paths, like &quot;/favicon.ico&quot;, or rooted subtrees, like &quot;/images/&quot; (note the trailing slash). Longer patterns take precedence over shorter ones, so that if there are handlers registered for both &quot;/images/&quot; and &quot;/images/thumbnails/&quot;, the latter handler will be called for paths beginning &quot;/images/thumbnails/&quot; and the former will receive requests for any other paths in the &quot;/images/&quot; subtree.</p>\n<p>Note that since a pattern ending in a slash names a rooted subtree, the pattern &quot;/&quot; matches all paths not matched by other registered patterns, not just the URL with Path == &quot;/&quot;.</p>\n</blockquote>\n<p>So unfortunately there is no pattern which matches only the root (<code>&quot;/&quot;</code>).</p>\n<p>But you can easily check this in your handler, and do whatever you want to if the request path is not the root:</p>\n<pre><code>func serveRest(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != &quot;/&quot; {\n        w.Write([]byte(&quot;Not root!&quot;))\n        return\n    }\n    \n    w.Write([]byte(&quot;Hi, this is the root!&quot;))\n}\n</code></pre>\n<p>If you want to return <code>HTTP 404 Not found</code> error for non-roots:</p>\n<pre><code>func serveRest(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != &quot;/&quot; {\n        http.NotFound(w, r)\n        return\n    }\n\n    w.Write([]byte(&quot;Hi!&quot;))\n}\n</code></pre>\n<p>And Go tutorial: <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">https://tour.golang.org/</a></p>\n<p>Also check out the <kbd><a href=\"https://stackoverflow.com/tags/go/info\">Go</a></kbd> tag info here on SO, it has a section <strong>Go Tutorials</strong>.</p>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": 1, "last_activity_date": 1438953359, "creation_date": 1438953359, "answer_id": 31878714, "question_id": 31877296, "link": "https://stackoverflow.com/questions/31877296/how-to-restrict-web-server-written-in-golang-to-allow-a-particular-address-inste/31878714#31878714", "title": "How to restrict web server written in golang to allow a particular address instead of a pattern?", "body": "<p>You could check out \n<a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow\">https://github.com/julienschmidt/httprouter</a></p>\n\n<p>Per its readme:</p>\n\n<blockquote>\n  <p>Only explicit matches: With other routers, like http.ServeMux, a\n  requested URL path could match multiple patterns. Therefore they have\n  some awkward pattern priority rules, like longest match or first\n  registered, first matched. By design of this router, a request can\n  only match exactly one or no route. As a result, there are also no\n  unintended matches, which makes it great for SEO and improves the user\n  experience.</p>\n</blockquote>\n\n<p><a href=\"https://www.youtube.com/user/toddmcleod/playlists\" rel=\"nofollow\">Here</a> is some good video content to get started in Go.</p>\n"}], "owner": {"reputation": 187, "user_id": 4305917, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100001241510496/picture?type=large", "display_name": "Shailesh", "link": "https://stackoverflow.com/users/4305917/shailesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1355, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1438961635, "creation_date": 1438949032, "last_edit_date": 1438961635, "question_id": 31877296, "link": "https://stackoverflow.com/questions/31877296/how-to-restrict-web-server-written-in-golang-to-allow-a-particular-address-inste", "title": "How to restrict web server written in golang to allow a particular address instead of a pattern?", "body": "<p>When I use </p>\n\n<pre><code>http.HandleFunc(\"/\", serveRest)  //serveRest is the method to handle request\nhttp.ListenAndServe(\"localhost:4000\", nil)\n</code></pre>\n\n<p>It will accept all request starting with <code>\"/\"</code>. How do I restrict it to serve only <code>\"localhost:4000\"</code> instead of every address like <code>\"localhost:4000/*\"</code>?</p>\n\n<p>And can you guys suggest me a good tutorial for Go?</p>\n"}, {"tags": ["go", "concurrency", "channels"], "answers": [{"comments": [{"owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "edited": false, "score": 0, "creation_date": 1438948523, "post_id": 31876639, "comment_id": 51671815, "body": "<code>for r := range in {   s := r.Poll()     status &lt;- State{r.url, s}     out &lt;- r }</code> How does this code run infinitely? If it loops over &quot;in&quot; channel, and &quot;in&quot; gets its resources from pending queue, it should terminate after few iterations.  I think this is exactly the part that I don&#39;t understand. Especially the communication going on in this section. Thanks for your step by step explanation."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 0, "last_activity_date": 1438950398, "last_edit_date": 1438950398, "creation_date": 1438946958, "answer_id": 31876639, "question_id": 31876138, "link": "https://stackoverflow.com/questions/31876138/understanding-the-code-sharing-resources-by-communicating/31876639#31876639", "title": "Understanding the code : Sharing resources by communicating", "body": "<blockquote>\n  <p>How does the program execute Poller function infinitely when the \"in\" channel in poller function(that receives from main function) run only 3 poller go routines ?</p>\n</blockquote>\n\n<p>So, first the program creates two Pollers:</p>\n\n<pre><code>for i := 0; i &lt; numPollers; i++ {\n    go Poller(pending, complete, status)\n}\n</code></pre>\n\n<p>then it sends three resources to pending:</p>\n\n<pre><code>for _, url := range urls {\n    pending &lt;- &amp;Resource{url: url}\n}\n</code></pre>\n\n<p>Every Poller reads from pending and polls the resource:</p>\n\n<pre><code>for r := range in {\n    s := r.Poll()\n    status &lt;- State{r.url, s}\n    out &lt;- r\n}\n</code></pre>\n\n<p>This code seems to be executed infinitely, but it is blocking read from a queue, generally. So this loops wait for the next value to appear.</p>\n\n<p>Let's virtually step over it:</p>\n\n<ol>\n<li>There is two Pollers reading resources.</li>\n<li>Program sends first resource to the queue.</li>\n<li>One of the pollers gets the resource and start to pool. Another one waits.</li>\n<li>At some moment the program sends new resource to the queue.</li>\n<li>As the first poller is busy, the second one gets unblocked and start polling.</li>\n<li>Program sends third resource and blocks as two pollers are busy.</li>\n<li>When one of the pollers completes, it takes the last resource and continues.</li>\n<li>At the meantime, the main program reads values from the complete queue.</li>\n</ol>\n\n<blockquote>\n  <p><code>for r := range in { s := r.Poll() status &lt;- State{r.url, s} out &lt;- r }</code> How does this code run infinitely? If it loops over \"in\" channel, and \"in\" gets its resources from pending queue, it should terminate after few iterations. I think this is exactly the part that I don't understand.</p>\n</blockquote>\n\n<p>To be precise, <code>in</code> does not gets the resources from <code>pending</code> queue. <code>in</code> <strong>is</strong> <code>pending</code> queue. The queue (or channel, which I use interchangeably) can be closed by calling <a href=\"http://golang.org/pkg/builtin/#close\" rel=\"nofollow\">close</a> but until it is not closed explicitly it is considered alive. Any reading from it blocks the current goroutine until the next value will be given. Then gorotine resumes.</p>\n\n<p>I suppose that you keep thinking about channels like they are array with fixed number of elements. They are not. Consider they like array with infinite number of elements but with blocking read that may throw exception (that the rough approximation of closing the queue if you are not familiar with the concept).</p>\n"}, {"comments": [{"owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "edited": false, "score": 0, "creation_date": 1438948919, "post_id": 31876651, "comment_id": 51672084, "body": "Correct me if I&#39;m wrong. There is only one infinite loop in the program which is inside SateMonitor function.  It would totally make sense to me if I&#39;d be able to understand how StateMonitor function interacts with the Poller function."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1438946988, "creation_date": 1438946988, "answer_id": 31876651, "question_id": 31876138, "link": "https://stackoverflow.com/questions/31876138/understanding-the-code-sharing-resources-by-communicating/31876651#31876651", "title": "Understanding the code : Sharing resources by communicating", "body": "<p>A send operation on a channel blocks until a receiver is available for the same channel: if there\u2019s no recipient for the value on channel, no other value can be put in the channel. And the other way around: no new value can be sent in channel when the channel is not empty! So the send operation will wait until channel becomes available again.</p>\n\n<p>On the other hand a receive operation for a channel blocks until a sender is available for the same channel: if there is no value in the channel, the receiver blocks.</p>\n\n<p><strong>To unblock the channel we need to pull the data from the channel in an infinite loop.</strong></p>\n\n<p>This is the explanation why the program is sending and reading data in an infinite loop.</p>\n"}, {"tags": [], "owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "is_accepted": false, "score": -1, "last_activity_date": 1439553611, "last_edit_date": 1439553611, "creation_date": 1439294087, "answer_id": 31941101, "question_id": 31876138, "link": "https://stackoverflow.com/questions/31876138/understanding-the-code-sharing-resources-by-communicating/31941101#31941101", "title": "Understanding the code : Sharing resources by communicating", "body": "<p>This makes me clear. Sleep function actually causes the infinite loop.</p>\n\n<p><a href=\"https://groups.google.com/forum/#!searchin/golang-nuts/sunil/golang-nuts/FSx8GmoRaNM/Nz9CdSF_zh8J][1]\" rel=\"nofollow\">https://groups.google.com/forum/#!searchin/golang-nuts/sunil/golang-nuts/FSx8GmoRaNM/Nz9CdSF_zh8J][1]</a></p>\n"}], "owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 3, "accepted_answer_id": 31876639, "answer_count": 3, "score": 0, "last_activity_date": 1439553611, "creation_date": 1438945316, "last_edit_date": 1438946384, "question_id": 31876138, "link": "https://stackoverflow.com/questions/31876138/understanding-the-code-sharing-resources-by-communicating", "title": "Understanding the code : Sharing resources by communicating", "body": "<p>I've been trying to understand the code in \n<a href=\"https://golang.org/doc/codewalk/sharemem/\" rel=\"nofollow\">https://golang.org/doc/codewalk/sharemem/</a>\nThough I get most of the part about passing resources via channel, I'm unable to understand the infinite loop the program runs in. How does the program execute Poller function infinitely when the \"in\" channel in poller function(that receives from main function) run only 3 poller go routines ? </p>\n\n<p>I get the idea of StateMonitor having anonymous go function with infinite loop. But it can't update LogState without receiving from Poller function. I'm assuming the program performs Get request to the urls infinitely. </p>\n\n<p>To confirm that I'm not wrong about what I've understood, I tested the program by turning the wifi on and off to see if the log changes. To my surprise, it does, for few iterations but after that it stops responding to my change and keeps on showing the same log. So, does that mean program is buggy? Or is it that I haven't understood some fundamental concepts?</p>\n"}, {"tags": ["performance", "opengl", "graphics", "go", "game-engine"], "answers": [{"comments": [{"owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438948955, "post_id": 31875885, "comment_id": 51672102, "body": "how do I apply transformations to each object if everything is in one vbo?  Do i pass a uniform to the vertex shader that contains a matrix?  Or do i update each vertex using the client so the shader gets hold of the already transformed vertex?"}, {"owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949492, "post_id": 31875885, "comment_id": 51672422, "body": "I also feel like the amount of time to transfer a larger VBO to shader would offset smaller transfers to the shader, thus cancelling out any performance benefit?"}, {"owner": {"reputation": 1288, "user_id": 1876626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e81a0d90315dfb0b3f64c0936a34699e?s=128&d=identicon&r=PG", "display_name": "Joonazan", "link": "https://stackoverflow.com/users/1876626/joonazan"}, "edited": false, "score": 0, "creation_date": 1439253736, "post_id": 31875885, "comment_id": 51774449, "body": "If you do it carefully, the data transfer happens in the background while your program is already doing something else."}], "tags": [], "owner": {"reputation": 7060, "user_id": 105466, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/jMWs6.png?s=128&g=1", "display_name": "SurvivalMachine", "link": "https://stackoverflow.com/users/105466/survivalmachine"}, "is_accepted": true, "score": 2, "last_activity_date": 1438944506, "creation_date": 1438944506, "answer_id": 31875885, "question_id": 31875813, "link": "https://stackoverflow.com/questions/31875813/opengl3-20k-sprites-slow-framerate/31875885#31875885", "title": "opengl3 20k sprites slow framerate?", "body": "<p>Without looking at source code, you should use one VBO and combine geometry for all sprites that share a texture and draw them using one draw call.</p>\n"}, {"comments": [{"owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949131, "post_id": 31876869, "comment_id": 51672207, "body": "so for each of my vbos (uv, color, vertex) i should call glbuffersubdata and only call glbuffer one time before the loop starts? Am I correct?"}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949274, "post_id": 31876869, "comment_id": 51672293, "body": "yup :). You use glBufferData() to allocate the memory and then if you need to modify it just use glBufferSubData()"}, {"owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949407, "post_id": 31876869, "comment_id": 51672382, "body": "Thanks.  Would this really give me that much of an fps boost... I mean it is lagging only on 20k quads (4 vertices).. With my graphics card/cpu it should be doing hundreds of thousands of vertices each frame?"}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949512, "post_id": 31876869, "comment_id": 51672438, "body": "Cant say for sure. This is just one thing which adds overhead."}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438949619, "post_id": 31876869, "comment_id": 51672492, "body": "If you are modifying that vbo just to apply a transformation (translate, rotate, or scale) then you should really just pass a matrix to the shader. I think that will improve fps more than glBufferSubData()."}, {"owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438950658, "post_id": 31876869, "comment_id": 51673150, "body": "Can you elaborate on passing a matrix to shader.  Are you saying use one giant vbo or continue using a vbo for each object?  I&#39;m already passing an MVP matrix up to shader just not the transformation matrix itself."}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438955531, "post_id": 31876869, "comment_id": 51676536, "body": "Passing a transformation has the exact same procedure as passing a MVP matrix :). You add the uniform matrix in the shader, get its location, and simply use glUniformMatrix4fv() to pass it to the shader. This is an amazing tutorial for more information on opengl matrices: <a href=\"http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/\" rel=\"nofollow noreferrer\">opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices</a>"}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "edited": false, "score": 0, "creation_date": 1438955652, "post_id": 31876869, "comment_id": 51676613, "body": "If you were rendering each texture at a different spot, you would probably need a matrix for every texture or you  would need to generate a matrix for every texture per pass. In your case, you just need 1 matrix since you are rending 20,000 images at the same spot on top of each other."}], "tags": [], "owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "is_accepted": false, "score": 1, "last_activity_date": 1438947618, "creation_date": 1438947618, "answer_id": 31876869, "question_id": 31875813, "link": "https://stackoverflow.com/questions/31875813/opengl3-20k-sprites-slow-framerate/31876869#31876869", "title": "opengl3 20k sprites slow framerate?", "body": "<p>One problem which I see is that you are creaing a vbo per every frame. Im not sure what you are trying to do. If you are trying to update your vbo, use glBufferSubData() instead. glBufferData() creates a new buffer every time you call it so it will be more expensive than glBufferSubData() for sure. glBufferSubData() just modifies/updates your vbo. This should give your fps a boost.</p>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 1876626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e81a0d90315dfb0b3f64c0936a34699e?s=128&d=identicon&r=PG", "display_name": "Joonazan", "link": "https://stackoverflow.com/users/1876626/joonazan"}, "is_accepted": false, "score": 2, "last_activity_date": 1439068269, "creation_date": 1439068269, "answer_id": 31898634, "question_id": 31875813, "link": "https://stackoverflow.com/questions/31875813/opengl3-20k-sprites-slow-framerate/31898634#31898634", "title": "opengl3 20k sprites slow framerate?", "body": "<p>OpenGL calls are expensive. You're doing lots of them ten thousand times in every single frame. Instead you want to do one big draw call if possible. If not, one draw call per textures + program combination.</p>\n\n<p>Instead of passing a matrix as uniform, you can pass a matrix for each object you draw.</p>\n\n<p>This code is not as good as it could be, but it performs orders of magnitude better than yours.</p>\n\n<pre><code>func (drawer *SpriteDrawer) Draw(sprites []Sprite) {\n    if len(sprites) == 0 {\n        return\n    }\n\n    drawer.Use()\n    drawer.Texture.Bind(gl.TEXTURE_2D_ARRAY)\n\n    tmp := drawer.GetTransform().To32()\n    drawer.camera_uniform.UniformMatrix2x3f(false, &amp;tmp)\n\n    vertexbuffer := gl.GenBuffer()\n    defer vertexbuffer.Delete()\n    vertexbuffer.Bind(gl.ARRAY_BUFFER)\n\n    stride := int(unsafe.Sizeof(sprites[0]))\n\n    gl.BufferData(gl.ARRAY_BUFFER, stride*len(sprites), sprites, gl.STREAM_DRAW)\n\n    var transform1, transform2, texcoords, texlevel gl.AttribLocation\n    transform1 = 0\n    transform2 = 1\n    texcoords = 2\n    texlevel = 3\n\n    transform1.AttribPointer(3, gl.FLOAT, false, stride, unsafe.Offsetof(sprites[0].Transform))\n    transform2.AttribPointer(3, gl.FLOAT, false, stride, unsafe.Offsetof(sprites[0].Transform)+unsafe.Sizeof(sprites[0].Transform[0])*3)\n    texcoords.AttribPointer(4, gl.FLOAT, false, stride, unsafe.Offsetof(sprites[0].TextureLeft))\n    texlevel.AttribPointer(1, gl.FLOAT, false, stride, unsafe.Offsetof(sprites[0].Layer))\n\n    transform1.EnableArray()\n    transform2.EnableArray()\n    texcoords.EnableArray()\n    texlevel.EnableArray()\n\n    gl.DrawArrays(gl.POINTS, 0, len(sprites))\n\n    transform1.DisableArray()\n    transform2.DisableArray()\n    texcoords.DisableArray()\n    texlevel.DisableArray()\n}\n</code></pre>\n\n<p><a href=\"https://github.com/joonazan/sprite/blob/master/drawer.go\" rel=\"nofollow\">library this is from</a></p>\n"}], "owner": {"reputation": 876, "user_id": 2305723, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/23e6e73c52938ec01c706097cf4e8943?s=128&d=identicon&r=PG", "display_name": "efel", "link": "https://stackoverflow.com/users/2305723/efel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 31875885, "answer_count": 3, "score": 0, "last_activity_date": 1439068269, "creation_date": 1438944248, "last_edit_date": 1438956658, "question_id": 31875813, "link": "https://stackoverflow.com/questions/31875813/opengl3-20k-sprites-slow-framerate", "title": "opengl3 20k sprites slow framerate?", "body": "<p>I have successfully made an opengl 3.x animation in golang. However; the frame by frame update is noticeably slow only after 20k textures rendered.  All the sprites do is simply move from the left side of the screen to the right.  Keep in mind they are all on top of each other because i was too lazy to randomize location.</p>\n\n<p>I have an updated PC that can run GTA5 on high settings but cannot display 20k sprites (quads with textures) in opengl3 environment??</p>\n\n<p>I must be doing something wrong here.  Maybe I need to pack all vertices in one VBO instead of a new vbo for each object?  I bindbuffers every object as well.  I'm not really sure what is causing this bottleneck.  Can someone help as i'm not sure where to go from here?</p>\n\n<p>I have attached my code as reference for anyone that can give some tips on speeding up rendering of 20k sprites in opengl3:\n<a href=\"http://pastebin.com/SHQtRPn7\" rel=\"nofollow\">http://pastebin.com/SHQtRPn7</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438937704, "post_id": 31873396, "comment_id": 51665137, "body": "As far as I know, relative paths are interpreted relative to the <a href=\"http://golang.org/pkg/os/#Getwd\" rel=\"nofollow noreferrer\">current working directory</a>, not a particular package."}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438937833, "post_id": 31873396, "comment_id": 51665230, "body": "@thwd, You are correct, but when I&#39;m running <code>go test</code> on a another package, that package&#39;s directory is the current working directory. By empirical testing, this is true even if the actual current working directory is a different directory."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438938074, "post_id": 31873396, "comment_id": 51665407, "body": "oh, now I get it. One other idea: During <code>go test</code>, <code>$GOPATH</code> should be set to the root of the current workspace, so just use a path relative to <code>$GOPATH&#47;src</code>."}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438938161, "post_id": 31873396, "comment_id": 51665461, "body": "@thwd, Thanks for the suggestions. Unfortunately <code>$GOPATH</code> can contain multiple <code>:</code>-delimited paths, and it is not possible for the code to know which of them it belongs to. It seems very hacky to try them all until it finds a file with the name it wants."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438938434, "post_id": 31873396, "comment_id": 51665626, "body": "One last thought: <a href=\"https://golang.org/pkg/runtime/#GOROOT\" rel=\"nofollow noreferrer\"><code>runtime.GOROOT()</code></a> returns &quot;the root used during the Go build&quot;. As setting a <code>$GOROOT</code> is discouraged, this might be a solution."}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1438938677, "post_id": 31873396, "comment_id": 51665778, "body": "@thwd, That did look very promising although I&#39;m not sure if it is the root of the project or the root of the <code>go</code> executable. Unfortunately, <code>$GOROOT</code> is set in most of our dev environments at my workplace. I cannot help but think that this should be a problem more general than <code>go</code>, and that I&#39;m missing some obvious solution that doesn&#39;t require finding the root."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438943925, "post_id": 31873396, "comment_id": 51669035, "body": "Does something like mentioned in <a href=\"http://stackoverflow.com/a/31059125/1705598\">this answer</a> satisfies you? Also can&#39;t you just embed the file in the Go source?"}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1438944647, "post_id": 31873396, "comment_id": 51669467, "body": "@izca All three of your solutions essentially assume that the base path is the same on most machines or that all other developer users will need to specify a configuration manually just to run the unit test successfully. My question is exactly trying to avoid such manual effort by other developers."}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1438944811, "post_id": 31873396, "comment_id": 51669557, "body": "With respect to embedding that might be an option but is a bit messy because the file is rather large and is occasionally regenerated and checked into source."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438947267, "post_id": 31873396, "comment_id": 51671027, "body": "@merlin2011 If you want to avoid all manual configuration effort and avoid embedding, then I think your best option is iterating over and trying each path of <code>$GOPATH</code> until you find your file. The reason is because non-go sources are not processed by the compiler."}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 2977136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275c4df9289839b46d76540fedc621ad?s=128&d=identicon&r=PG&f=1", "display_name": "Abex", "link": "https://stackoverflow.com/users/2977136/abex"}, "is_accepted": false, "score": -3, "last_activity_date": 1439317970, "creation_date": 1439317970, "answer_id": 31949427, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan/31949427#31949427", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p>Yes, Finding package path is possible:</p>\n\n<p>pathfind.go:</p>\n\n<pre><code>package main\n\n/*\nconst char* GetMyPathFILE = __FILE__;\n*/\nimport \"C\"\nimport \"path/filepath\"\n\nvar basepath = \"\"\n\n//GetMyPath Returns the absolute directory of this(pathfind.go) file\nfunc GetMyPath() string {\n    if basepath == \"\" {\n        g := C.GoString(C.GetMyPathFILE)\n        basepath = filepath.Dir(g)\n    }\n    return basepath\n}\n</code></pre>\n\n<p>All you have to do is copy this file to your project. Keep in mind this comes up with the path for the file, not the caller so you have to copy the function/file to every project you need the function in. Additionally if you put this in a file with other code be sure to respect <code>CGO</code>'s import rules.</p>\n"}, {"comments": [{"owner": {"reputation": 1251, "user_id": 1456106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b1d9fe0de0b68dd5c6d484723af6cf?s=128&d=identicon&r=PG", "display_name": "Daniel Fernandes", "link": "https://stackoverflow.com/users/1456106/daniel-fernandes"}, "edited": false, "score": 3, "creation_date": 1506681104, "post_id": 38644571, "comment_id": 79928266, "body": "Best answer.  Works for both the root (main) and testing the packages within the application."}, {"owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "edited": false, "score": 0, "creation_date": 1547147732, "post_id": 38644571, "comment_id": 95102450, "body": "You need to replace &quot;=&quot; with &quot;:=&quot; for the code to work."}, {"owner": {"reputation": 858, "user_id": 3061962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40eae6978e593e2568f0ee35892c0d63?s=128&d=identicon&r=PG", "display_name": "Oleksiy Chechel", "link": "https://stackoverflow.com/users/3061962/oleksiy-chechel"}, "reply_to_user": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "edited": false, "score": 2, "creation_date": 1549024393, "post_id": 38644571, "comment_id": 95766044, "body": "@thebiggestlebowski, in var section)"}], "tags": [], "owner": {"reputation": 858, "user_id": 3061962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40eae6978e593e2568f0ee35892c0d63?s=128&d=identicon&r=PG", "display_name": "Oleksiy Chechel", "link": "https://stackoverflow.com/users/3061962/oleksiy-chechel"}, "is_accepted": false, "score": 61, "last_activity_date": 1549024305, "last_edit_date": 1549024305, "creation_date": 1469732032, "answer_id": 38644571, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan/38644571#38644571", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p>You can also use my method without C:</p>\n\n<pre><code>package mypackage\n\nimport (\n    \"path/filepath\"\n    \"runtime\"\n    \"fmt\"\n)\n\nvar (\n    _, b, _, _ = runtime.Caller(0)\n    basepath   = filepath.Dir(b)\n)\n\nfunc PrintMyPath() {\n    fmt.Println(basepath)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ifVRIq7Tx0\" rel=\"noreferrer\">https://play.golang.org/p/ifVRIq7Tx0</a></p>\n"}, {"tags": [], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "is_accepted": false, "score": 8, "last_activity_date": 1570572781, "creation_date": 1570572781, "answer_id": 58294680, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan/58294680#58294680", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p>Building on the <a href=\"https://stackoverflow.com/users/3061962/oleksiy-chechel\">answer by Oleksiy</a> you can create a sub-package in your project called <code>./internal/projectpath/projectpath.go</code> and paste in the following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package projectpath\n\nimport (\n    \"path/filepath\"\n    \"runtime\"\n)\n\nvar (\n    _, b, _, _ = runtime.Caller(0)\n\n    // Root folder of this project\n    Root = filepath.Join(filepath.Dir(b), \"../..\")\n)\n</code></pre>\n\n<p>Then you can use <code>projectpath.Root</code> in any other package to have the root folder of your project.</p>\n"}, {"tags": [], "owner": {"reputation": 575, "user_id": 2036994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa8d82a4f497cd62b14c2db5758d4e1f?s=128&d=identicon&r=PG", "display_name": "Dele", "link": "https://stackoverflow.com/users/2036994/dele"}, "is_accepted": false, "score": 14, "last_activity_date": 1577001843, "creation_date": 1577001843, "answer_id": 59442571, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan/59442571#59442571", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p>Returns the root of the application:</p>\n\n<pre><code>import (\n    \"path\"\n    \"path/filepath\"\n    \"runtime\"\n)  \n\nfunc RootDir() string {\n    _, b, _, _ := runtime.Caller(0)\n    d := path.Join(path.Dir(b))\n    return filepath.Dir(d)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1888, "user_id": 1893096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZrkQ.jpg?s=128&g=1", "display_name": "Petre Sosa", "link": "https://stackoverflow.com/users/1893096/petre-sosa"}, "is_accepted": false, "score": 4, "last_activity_date": 1588316332, "creation_date": 1588316332, "answer_id": 61538157, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan/61538157#61538157", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p><strong>Go directories:</strong></p>\n\n<pre><code>// from Executable Directory\nex, _ := os.Executable()\nfmt.Println(\"Executable DIR:\", filepath.Dir(ex))\n\n// Current working directory\ndir, _ := os.Getwd()\nfmt.Println(\"CWD:\", dir)\n\n// Relative on runtime DIR:\n_, b, _, _ := runtime.Caller(0)\nd1 := path.Join(path.Dir(b))\nfmt.Println(\"Relative\", d1)\n</code></pre>\n"}], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21974, "favorite_count": 11, "answer_count": 5, "score": 41, "last_activity_date": 1588316332, "creation_date": 1438937205, "last_edit_date": 1495540978, "question_id": 31873396, "link": "https://stackoverflow.com/questions/31873396/is-it-possible-to-get-the-current-root-of-package-structure-as-a-string-in-golan", "title": "Is it possible to get the current root of package structure as a string in golang test?", "body": "<p>I am writing a utility function for my unit tests which is used by unit tests in multiple packages. This utility function must read a particular file (always the same file). Here are three solutions which do not work, to explain what I am looking for and why.</p>\n\n<ol>\n<li><p>Hardcode the absolute path. This fails because another user who is trying to test the project might have a different prefix on the absolute path.</p></li>\n<li><p>Hardcode a relative path from the path of the file which defines the utility function. This fails because packages which import and use this function are not necessarily at the same level of the file hierarchy as the file that defines the utility function, and relative paths are interpreted relative to the importer, not the imported.</p></li>\n<li><p>Pass in the relative path to the file from every caller relative to the caller's package. This actually works but seems to be very verbose because now every caller must be changed to pass one file.</p></li>\n</ol>\n\n<p>I see a fourth solution, whereby I can hardcode a path in the utility function which is relative to the root directory of the top-level package. However, I have not been able to find a way to get the root directory in code, although I suspect there is one because imports can be resolved from the root.</p>\n\n<p><strong>Thus, how might I get the sought-after root directory?</strong></p>\n\n<p>I've looked over various Go documents but have so far failed to find a solution. I have also seen <a href=\"https://stackoverflow.com/questions/17071286/how-can-i-open-files-using-relative-paths-in-go\">this question</a> but the solution there is equivalent to #3 above.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 473249, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e40b77e8148e074c95c189d98f40022b?s=128&d=identicon&r=PG&f=1", "display_name": "fazy", "link": "https://stackoverflow.com/users/473249/fazy"}, "edited": false, "score": 9, "creation_date": 1438943054, "post_id": 31873508, "comment_id": 51668521, "body": "Thanks, this works. I&#39;m not sure why Go can&#39;t define positional arguments, as I thought these would also be common. If I could define an argument with no name then I wouldn&#39;t need to create a custom <code>Usage()</code> function, the built-in function could handle it along with the others. Still your solution works well without much extra code. :)"}], "tags": [], "owner": {"reputation": 6540, "user_id": 1298040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66d1c787d61afe97b92bf4d03d0bbba3?s=128&d=identicon&r=PG", "display_name": "dwalter", "link": "https://stackoverflow.com/users/1298040/dwalter"}, "is_accepted": true, "score": 20, "last_activity_date": 1438937517, "creation_date": 1438937517, "answer_id": 31873508, "question_id": 31873183, "link": "https://stackoverflow.com/questions/31873183/how-to-print-usage-for-positional-argument-with-gos-flag-package/31873508#31873508", "title": "How to print usage for positional argument with Go&#39;s flag package?", "body": "<p><code>flag.Usage()</code> will only give you useful information about the defined flags. So you either define your arguments as flags via <code>var foo = flag.Int(...)</code>.</p>\n\n<p>Another option would be to define your own usage handler. see below for a simple example which will print a custom message and the defaults for all defined flags. This way you custom <code>Usage</code> will be printed in case <code>flag.Parse()</code> fails.</p>\n\n<pre><code>package main\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc myUsage() {\n     fmt.Printf(\"Usage: %s [OPTIONS] argument ...\\n\", os.Args[0])\n     flag.PrintDefaults()\n}\n\nfunc main() {\n     flag.Usage = myUsage\n     /* ... */\n}\n</code></pre>\n"}], "owner": {"reputation": 1995, "user_id": 473249, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e40b77e8148e074c95c189d98f40022b?s=128&d=identicon&r=PG&f=1", "display_name": "fazy", "link": "https://stackoverflow.com/users/473249/fazy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6830, "favorite_count": 3, "accepted_answer_id": 31873508, "answer_count": 1, "score": 11, "last_activity_date": 1438937517, "creation_date": 1438936572, "question_id": 31873183, "link": "https://stackoverflow.com/questions/31873183/how-to-print-usage-for-positional-argument-with-gos-flag-package", "title": "How to print usage for positional argument with Go&#39;s flag package?", "body": "<p>Given this simple Go program, which requires exactly one command line argument, how can I improve it so that <code>flag.Usage()</code> gives useful output?</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    flag.Parse()\n    if len(flag.Args()) == 0 { \n        flag.Usage()\n        os.Exit(1)\n    }\n\n    args := flag.Args()\n    fmt.Println(args[0])\n}\n</code></pre>\n\n<p>Current output with no arguments given:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ./args\nUsage of ./args:\n</code></pre>\n\n<p>(i.e. usage is empty, as I can find no way to tell the usage() function which parameters are required).</p>\n\n<p>I can remove <code>flag.Usage()</code> and replace it with something like this:</p>\n\n<pre><code>fmt.Fprintln(os.Stderr, \"Usage:\", os.Args[0], \"&lt;argument&gt;\")\n</code></pre>\n\n<p>However, I don't want to reinvent the wheel if there's already a good way with <code>flag.Usage()</code>. Especially as it's already handling optional arguments:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ./args -foo\nflag provided but not defined: -foo\nUsage of ./args:\n</code></pre>\n"}, {"tags": ["go", "websocket"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1438953808, "creation_date": 1438953808, "answer_id": 31878856, "question_id": 31870743, "link": "https://stackoverflow.com/questions/31870743/go-routine-why-websocket-reports-the-connection-as-closed/31878856#31878856", "title": "go routine - why websocket reports the connection as closed?", "body": "<p>The websocket server <a href=\"https://github.com/golang/net/blob/1bc0720082d79ce7ffc6ef6e523d00d46b0dee45/websocket/server.go#L81\" rel=\"nofollow\">closes the connection</a> when the handler returns.</p>\n\n<p>Removing the Go routine is the correct fix.</p>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 977, "favorite_count": 0, "accepted_answer_id": 31878856, "answer_count": 1, "score": 1, "last_activity_date": 1438953808, "creation_date": 1438927404, "last_edit_date": 1438935860, "question_id": 31870743, "link": "https://stackoverflow.com/questions/31870743/go-routine-why-websocket-reports-the-connection-as-closed", "title": "go routine - why websocket reports the connection as closed?", "body": "<p>I'm trying to create a client and a server using Go but for some reason the server reports the connection as \"closed\". As the code is trivial I can't think of anything wrong with my code. Any help is appreciated.</p>\n\n<pre><code>package main\n\nimport (\n    log \"github.com/golang/glog\"\n    \"net/http\"\n    \"golang.org/x/net/websocket\"\n    \"time\"\n    \"flag\"\n)\n\ntype server struct {\n    payload chan string\n}\n\n// srv pushes the messages received via ws into srv.payload\nfunc (srv *server) serve(ws *websocket.Conn) {\n    go func() {\n        var msg string\n        if err := websocket.Message.Receive(ws, &amp;msg); err != nil {\n            log.Exit(err)\n        }\n        srv.payload &lt;- msg\n    }()\n    return\n}\n\n// This example demonstrates a trivial client/ server.\nfunc main() {\n    flag.Parse()\n    srv := server{payload: make(chan string, 10)}\n    http.Handle(\"/echo\", websocket.Handler(srv.serve))\n    go func() {\n        err := http.ListenAndServe(\":12345\", nil)\n        if err != nil {\n            log.Errorf(\"ListenAndServe: \" + err.Error())\n        }\n    }()\n    // give the server some time to start listening\n    time.Sleep(3 *time.Second)\n    //dial and test the response.\n    ws, err := websocket.Dial(\"ws://localhost:12345/echo\", \"\", \"http://localhost/?x=45\")\n    if err != nil {\n        log.Exit(err)\n    }\n    ms := \"test\"\n    if err := websocket.Message.Send(ws, ms); err != nil {\n        log.Exit(err)\n    }\n    msg := &lt;-srv.payload\n    if msg != ms{\n        log.Errorf(\"msg %v is not %v\", ms)\n    }\n\n}\n</code></pre>\n\n<p>Error</p>\n\n<pre><code> t.go:21] read tcp 127.0.0.1:12345-&gt;127.0.0.1:43135: \n</code></pre>\n\n<p><strong>Edit:</strong> \nAfter some try and error I've found that if I remove the go routine from the serve method it works but it doesn't make sense to me. Any idea why it doesn't work when websocket.Message.Receive is in a separate go routine?</p>\n\n<pre><code>package main\n\nimport (\n    log \"github.com/golang/glog\"\n    \"net/http\"\n    \"golang.org/x/net/websocket\"\n    \"time\"\n    \"flag\"\n)\n\ntype server struct {\n    payload chan string\n}\n\n// srv pushes the messages received via ws into srv.payload\nfunc (srv *server) serve(ws *websocket.Conn) {\n        var msg string\n        if err := websocket.Message.Receive(ws, &amp;msg); err != nil {\n            log.Exit(err)\n        }\n        srv.payload &lt;- msg \n    return\n}\n\n// This example demonstrates a trivial client/ server.\nfunc main() {\n    flag.Parse()\n    srv := server{payload: make(chan string, 10)}\n\n    go func() {\n        http.Handle(\"/echo\", websocket.Handler(srv.serve))\n        err := http.ListenAndServe(\":12345\", nil)\n        if err != nil {\n            log.Errorf(\"ListenAndServe: \" + err.Error())\n        }\n    }()\n    // give the server some time to start listening\n    time.Sleep(3 *time.Second)\n    //dial and test the response.\n    ws, err := websocket.Dial(\"ws://localhost:12345/echo\", \"\", \"http://localhost/?x=45\")\n    if err != nil {\n        log.Exit(err)\n    }\n    ms := \"test\"\n    if err := websocket.Message.Send(ws, ms); err != nil {\n        log.Exit(err)\n    }\n    msg := &lt;-srv.payload\n    if msg != ms{\n        log.Errorf(\"msg %v is not %v\", ms)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1624, "user_id": 296549, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/134cf24554b2115f4ed28d2ff43b378f?s=128&d=identicon&r=PG", "display_name": "Bacon", "link": "https://stackoverflow.com/users/296549/bacon"}, "edited": false, "score": 0, "creation_date": 1438913495, "post_id": 31868639, "comment_id": 51656173, "body": "check this <a href=\"https://gist.github.com/kenshinx/5796276\" rel=\"nofollow noreferrer\">gist.github.com/kenshinx/5796276</a>"}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 4, "creation_date": 1438913508, "post_id": 31868639, "comment_id": 51656176, "body": "<a href=\"https://godoc.org/golang.org/x/net/icmp\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/net/icmp</a>"}, {"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "reply_to_user": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1438913775, "post_id": 31868639, "comment_id": 51656229, "body": "@Jonathon-reinhart Thanks! I&#39;ll look into ICMP I wish I could mark comments as answers."}, {"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "reply_to_user": {"reputation": 1624, "user_id": 296549, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/134cf24554b2115f4ed28d2ff43b378f?s=128&d=identicon&r=PG", "display_name": "Bacon", "link": "https://stackoverflow.com/users/296549/bacon"}, "edited": false, "score": 0, "creation_date": 1438913800, "post_id": 31868639, "comment_id": 51656232, "body": "@Bacon Thanks for the gist, it looks interesting."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 5, "creation_date": 1438940581, "post_id": 31868639, "comment_id": 51667013, "body": "Why do you want to check if it is online? Depending on the reason the best way could simply be to try to open a connection"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438956826, "post_id": 31868639, "comment_id": 51677346, "body": "To add to user3591723&#39;s point, trying to ping a server that may or may not respond to a ping when you want to connect anyway only slows down the process. The best &quot;ping&quot; in this case is a SYN packet, i.e., <i>connect</i> to the server."}, {"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 1, "creation_date": 1439011910, "post_id": 31868639, "comment_id": 51697246, "body": "To monitor if some of our servers are online or not."}, {"owner": {"reputation": 1453, "user_id": 121546, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/fceead8d65324ead613a78416f5e257b?s=128&d=identicon&r=PG&f=1", "display_name": "jCuga", "link": "https://stackoverflow.com/users/121546/jcuga"}, "edited": false, "score": 0, "creation_date": 1471921529, "post_id": 31868639, "comment_id": 65530917, "body": "You can call ping on the native os.  Cross platform pings in golang aren&#39;t too bad.  For example: <a href=\"https://github.com/jcuga/goping\" rel=\"nofollow noreferrer\">github.com/jcuga/goping</a>"}, {"owner": {"reputation": 384, "user_id": 2598114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6361d79969a12ee703ec6b21e5e12d0?s=128&d=identicon&r=PG", "display_name": "Keith E. Truesdell", "link": "https://stackoverflow.com/users/2598114/keith-e-truesdell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1614264343, "post_id": 31868639, "comment_id": 117337535, "body": "I know this is late to this, but @JimB and user3591723 doing a ping is more of finding the pinchpoint.  I have an app where I am trying to connect to someone else&#39;s API.  The other company keeps telling me &quot;well the server is up so its all good&quot;.  Reality, I can &quot;ping&quot; the server, but I can&#39;t send GET or POST requests to it, or utilize the services on the server.  The company only sees that the server is up, not that the endpoints are functioning.  Having a PING would tell me and show the company &quot;yes, the server is up, but the services are down as it can get a ping but no packets&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 0, "creation_date": 1439011843, "post_id": 31869545, "comment_id": 51697231, "body": "What would you recommend?"}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 0, "creation_date": 1439015159, "post_id": 31869545, "comment_id": 51697842, "body": "@JustDevInc Is servers are under your (or company&#39;s) control? If yes, then ICMP echo is not the best way to go, as described in <a href=\"http://security.stackexchange.com/questions/4440/security-risk-of-ping\">this</a> answer. Better way is to have a http endpoint on server, that responds to your request."}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 4, "last_activity_date": 1438920382, "creation_date": 1438920382, "answer_id": 31869545, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/31869545#31869545", "title": "How to ping an IP Address in golang", "body": "<p><strong>No.</strong></p>\n\n<p>Go does not have any built-in way to ping a server in standard library.\nYou need to write code by yourself.</p>\n\n<p>For that, you can look into <a href=\"http://godoc.org/golang.org/x/net/icmp\" rel=\"nofollow\">icmp section of golang library</a>. And use <a href=\"https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Control_messages\" rel=\"nofollow\">this list of control messages</a>, to construct icmp message properly.</p>\n\n<p>But, keep in mind that some server administrator shuts down ping service on their server, for <em>security reason</em>. So, If your goal is to ultimately check if server is online or not, this is not 100% reliable method.</p>\n"}, {"comments": [{"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 0, "creation_date": 1454596854, "post_id": 35194144, "comment_id": 58123377, "body": "I&#39;ve actually found this later on after asking this question, but thank you for adding it!"}], "tags": [], "owner": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "is_accepted": true, "score": 18, "last_activity_date": 1454567964, "creation_date": 1454567964, "answer_id": 35194144, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/35194144#35194144", "title": "How to ping an IP Address in golang", "body": "<p>As @desaipath mentions, there is no way to do this in the standard library. However, you do not need to write the code for yourself - it has already been done:</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/tatsushid/go-fastping\" rel=\"noreferrer\">https://github.com/tatsushid/go-fastping</a></p>\n</blockquote>\n\n<p><em>Note, sending ICMP packets requires root privileges</em> </p>\n"}, {"tags": [], "owner": {"reputation": 627, "user_id": 4795747, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rKn0p.jpg?s=128&g=1", "display_name": "Kasmetski", "link": "https://stackoverflow.com/users/4795747/kasmetski"}, "is_accepted": false, "score": 7, "last_activity_date": 1493548158, "creation_date": 1493548158, "answer_id": 43705426, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/43705426#43705426", "title": "How to ping an IP Address in golang", "body": "<p>I needed the same thing as you and I've made a workaround (with <code>exec.Command</code>) for my Raspberry Pi to check if servers are online. Here is the experimental code</p>\n\n<pre><code>out, _ := exec.Command(\"ping\", \"192.168.0.111\", \"-c 5\", \"-i 3\", \"-w 10\").Output()\nif strings.Contains(string(out), \"Destination Host Unreachable\") {\n    fmt.Println(\"TANGO DOWN\")\n} else {\n    fmt.Println(\"IT'S ALIVEEE\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8527225, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/f0mgm.jpg?s=128&g=1", "display_name": "Gowtham MS", "link": "https://stackoverflow.com/users/8527225/gowtham-ms"}, "is_accepted": false, "score": 1, "last_activity_date": 1569351495, "creation_date": 1569351495, "answer_id": 58086631, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/58086631#58086631", "title": "How to ping an IP Address in golang", "body": "<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os/exec\"\n)\n\nfunc main() {\n  Command := fmt.Sprintf(\"ping -c 1 10.2.201.174 &gt; /dev/null &amp;&amp; echo true || echo false\")\n  output, err := exec.Command(\"/bin/sh\", \"-c\", Command).Output()\n  fmt.Print(string(output))\n  fmt.Print(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9063, "user_id": 3966682, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1ZMr.jpg?s=128&g=1", "display_name": "d4nyll", "link": "https://stackoverflow.com/users/3966682/d4nyll"}, "is_accepted": false, "score": 4, "last_activity_date": 1586794006, "creation_date": 1586794006, "answer_id": 61191890, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/61191890#61191890", "title": "How to ping an IP Address in golang", "body": "<p>@jpillora's <a href=\"https://stackoverflow.com/a/35194144/3966682\">answer</a> suggests using <a href=\"http://github.com/tatsushid/go-fastping\" rel=\"nofollow noreferrer\"><code>go-fastping</code></a>, but that library hasn't been updated since Jan 8, 2016. It may not be an issue as the logic of pinging is quite simple, but if you want a more recent package then there's <a href=\"https://pkg.go.dev/github.com/sparrc/go-ping\" rel=\"nofollow noreferrer\"><code>go-ping</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "is_accepted": false, "score": 4, "last_activity_date": 1592114690, "creation_date": 1592114690, "answer_id": 62368956, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang/62368956#62368956", "title": "How to ping an IP Address in golang", "body": "<p>Although not a real ICMP ping, this is what use to probe my servers using the TCP protocol:</p>\n\n<pre><code>    host := \"example.com\"\n    port := \"80\"\n    timeout := time.Duration(1 * time.Second)\n    _, err := net.DialTimeout(\"tcp\", host+\":\"+port, timeout)\n    if err != nil {\n        fmt.Printf(\"%s %s %s\\n\", host, \"not responding\", err.Error())\n    } else {\n        fmt.Printf(\"%s %s %s\\n\", host, \"responding on port:\", port)\n    }\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31115, "favorite_count": 2, "accepted_answer_id": 35194144, "answer_count": 6, "score": 17, "last_activity_date": 1592114690, "creation_date": 1438913358, "last_edit_date": 1513408055, "question_id": 31868639, "link": "https://stackoverflow.com/questions/31868639/how-to-ping-an-ip-address-in-golang", "title": "How to ping an IP Address in golang", "body": "<p>How can you ping an IP address from a golang application? The ultimate goal is to check if a server is online.</p>\n\n<p>Does go have a way in the standard library to implement a network ping?</p>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438916224, "post_id": 31868571, "comment_id": 51656732, "body": "You need to change your <code>PATH</code> - e.g. set -x <code>PATH $GOPATH&#47;bin:$PATH</code> - and then <code>source config.fish</code> (I assume) to update the current shell."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1438916561, "post_id": 31868571, "comment_id": 51656805, "body": "@elithrar <code>PATH</code> is assigned as <code>set -x PATH $PATH &#47;Library&#47;PostgreSQL&#47;9.4&#47;bin&#47;</code>. it would conflict I suppose"}], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1438917525, "post_id": 31869133, "comment_id": 51657024, "body": "Could you check my reply comment to elithrar"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1438917598, "post_id": 31869133, "comment_id": 51657040, "body": "@Entei it wouldn&#39;t conflict, notice how there&#39;s <code>$PATH</code> in the set line? you&#39;re appending to the variable."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1438918282, "post_id": 31869133, "comment_id": 51657184, "body": "Over your declarations I added <code>set -gx PATH $PATH $GOPATH&#47;bin</code> but it didn&#39;t work. So I wrote <code>set -gx PATH $PATH $GOPATH1&#47;bin</code> and <code>set -gx PATH $PATH $GOPATH2&#47;bin</code> and it started to work. Why didn&#39;t the first one work?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1438924060, "post_id": 31869133, "comment_id": 51658637, "body": "@Entei because you have 2 different paths in <code>$GOPATH</code>."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1438924073, "last_edit_date": 1438924073, "creation_date": 1438917362, "answer_id": 31869133, "question_id": 31868571, "link": "https://stackoverflow.com/questions/31868571/multiple-gopaths-in-fish-shell/31869133#31869133", "title": "Multiple GOPATH&#39;s in fish shell", "body": "<p><code>GOPATH</code> is only relevant to the Go toolkit, you have to set the <code>PATH</code> variable.</p>\n\n<p>Since you have more than 1 folder in your GOPATH you will have to do it like this:</p>\n\n<pre><code>set -gx PATH $PATH $HOME/Documents/Programming/go/3rdparty\nset -gx PATH $PATH $HOME/Documents/Programming/go/own\n</code></pre>\n\n<p>For the second problem, you simply can't do that, on solution is to have multiple variables for example:</p>\n\n<pre><code>set -gx GOPATH1 $HOME/Documents/Programming/go/3rdparty\nset -gx GOPATH2 $HOME/Documents/Programming/go/own\nset -gx GOPATH $GOPATH1:$GOPATH2\nset -gx PATH $PATH $GOPATH1/bin\nset -gx PATH $PATH $GOPATH2/bin\n</code></pre>\n\n<p>Then you will be able to cd <code>$GOPATH1</code> or <code>$GOPATH2</code></p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "accepted_answer_id": 31869133, "answer_count": 1, "score": -1, "last_activity_date": 1438924073, "creation_date": 1438912769, "last_edit_date": 1438918339, "question_id": 31868571, "link": "https://stackoverflow.com/questions/31868571/multiple-gopaths-in-fish-shell", "title": "Multiple GOPATH&#39;s in fish shell", "body": "<p>I'm using fish shell. <code>config.fish</code> has <code>GOPATH</code> environment as:</p>\n\n<pre><code>set -x GOPATH $HOME/Documents/Programming/go/3rdparty:$HOME/Documents/Programming/go/own\n</code></pre>\n\n<p>I have two problems.</p>\n\n<p><strong>1st</strong>: Can't call executables in <code>3rdparty/bin</code> directly such as <code>golocc</code> or <code>godep</code>. I must go in the directory and call it as <code>./godep</code> and so on. How can I make <code>godep</code> to be called globally.</p>\n\n<p><strong>2nd</strong>: I can't <code>cd</code> to <code>$GOPATH</code>. <code>cd $GOPATH</code> gives </p>\n\n<pre><code>cd: The directory '/Users/xxx/Documents/Programming/go/3rdparty:/Users/xxx/Documents/Programming/go/own' does not exist\n</code></pre>\n\n<hr>\n\n<p>I'm guessing both problems occurs because of my <code>GOPATH</code>. What is the problem?</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1438912336, "post_id": 31868482, "comment_id": 51655918, "body": "1.3.2 is too old, try with 1.4.2 or 1.5rc1."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1438927999, "post_id": 31868482, "comment_id": 51659967, "body": "Is the .c file in the same directory as your Go source files?"}, {"owner": {"reputation": 17052, "user_id": 802585, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7e795755fe8a817981c3a81620faf359?s=128&d=identicon&r=PG", "display_name": "WoooHaaaa", "link": "https://stackoverflow.com/users/802585/wooohaaaa"}, "edited": false, "score": 0, "creation_date": 1438937921, "post_id": 31868482, "comment_id": 51665295, "body": "No, it&#39;s not, the <code>.c</code> file is located at <code>libs&#47;facerec_lib.c</code>"}], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 7, "last_activity_date": 1438960413, "creation_date": 1438960413, "answer_id": 31881154, "question_id": 31868482, "link": "https://stackoverflow.com/questions/31868482/how-to-use-c-library-in-golangv1-3-2/31881154#31881154", "title": "How to use C library in Golang(v1.3.2)", "body": "<p>If you make use of a C function via cgo, you must make sure that the implementation of that function is linked into your Go package.  From the comments on your question, it seems this was not the case.</p>\n\n<p>Two ways you can go about this include:</p>\n\n<ol>\n<li><p>place a <code>.c</code> file in your package's directory that implements the function.  When you run <code>go build</code>, it will be compiled and linked into your package along with the Go code.</p></li>\n<li><p>If the function is implemented in a library, you can use <a href=\"https://golang.org/cmd/cgo/#hdr-Using_cgo_with_the_go_command\" rel=\"noreferrer\">the LDFLAGS directive</a> in the comment before an <code>import \"C\"</code> statement in a Go file.  For example:</p>\n\n<pre><code>// #cgo LDFLAGS: -lmylib\nimport \"C\"\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 17052, "user_id": 802585, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7e795755fe8a817981c3a81620faf359?s=128&d=identicon&r=PG", "display_name": "WoooHaaaa", "link": "https://stackoverflow.com/users/802585/wooohaaaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3490, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1438960413, "creation_date": 1438912061, "last_edit_date": 1438938263, "question_id": 31868482, "link": "https://stackoverflow.com/questions/31868482/how-to-use-c-library-in-golangv1-3-2", "title": "How to use C library in Golang(v1.3.2)", "body": "<p>This is my Go source :</p>\n\n<pre><code>package facerec\n\n/*\n#include \"libs/facerec_lib.h\"\n*/\nimport \"C\"\n\n// import \"unsafe\"\n\ntype FaceRecServiceImpl struct {\n}\n\nfunc (this *FaceRecServiceImpl) Compare(features1 []byte, features2 []byte) (r float64, err error) {\n    // TODO\n    result := C.sumUp(2, 3)\n    return float64(result), nil\n}\n</code></pre>\n\n<h3>facerec_lib.h</h3>\n\n<pre><code>int sumUp(int a, int b);\n</code></pre>\n\n<h3>facerec_lib.c</h3>\n\n<pre><code>/* File facerec.c */\n#include \"facerec_lib.h\"\n\nint sumUp(int a, int b)\n{\n  return a + b;\n}\n</code></pre>\n\n<h3><code>go build:</code></h3>\n\n<pre><code>Roy-MacBook-Air:facerec $ go build\n# xxx/facerec\nUndefined symbols for architecture x86_64:\n  \"_sumUp\", referenced from:\n      __cgo_35aa8b5c98e0_Cfunc_sumUp in face_rec.cgo2.o\n     (maybe you meant: __cgo_35aa8b5c98e0_Cfunc_sumUp)\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nRoy-MacBook-Air:facerec$\n</code></pre>\n\n<p>How can I deal with this issue ? Thanks a lot !</p>\n\n<h3>EDIT</h3>\n\n<p>I changed <code>facerec_lib.h</code> to <code>facerec_lib.c</code>, problem solved, I thinks I must miss some <code>FLAGS</code> in go file, any hints ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1438966986, "post_id": 31867347, "comment_id": 51683650, "body": "<code>go get golang.org&#47;x&#47;tools&#47;cmd&#47;goimports</code> works fine for me. What version of Go do you have? And what is your Go environment like? (<code>go version</code> and <code>go env</code> output). What does <code>go get -v -u golang.org&#47;x&#47;tools&#47;cmd&#47;goimports</code> say? If you&#39;re going to get source manually you should use git/hg commands to fetch the repository and make sure it ends up in the correct place under <code>GOPATH</code> (e.g. under <code>$GOPATH&#47;src&#47;golang.org&#47;x&#47;tools</code>). As for how to build, see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>; but you really should fix your <code>go get</code> problem."}, {"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "edited": false, "score": 0, "creation_date": 1439013526, "post_id": 31867347, "comment_id": 51697526, "body": "You&#39;re using Linux, right? Which distro? If you&#39;re using Ubuntu or any of the other Debian variants, you could try this: <a href=\"http://stackoverflow.com/a/23832292/4257217\">stackoverflow.com/a/23832292/4257217</a> If you do, make sure you add <code>&#47;usr&#47;local&#47;go</code> and <code>&#47;usr&#47;bin&#47;go</code> to the <code>sudo rm -rf</code> command."}, {"owner": {"reputation": 2903, "user_id": 4257217, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/i1EYW.png?s=128&g=1", "display_name": "GreenRaccoon23", "link": "https://stackoverflow.com/users/4257217/greenraccoon23"}, "edited": false, "score": 0, "creation_date": 1439013774, "post_id": 31867347, "comment_id": 51697575, "body": "If that doesn&#39;t help, I&#39;m guessing that your $GOROOT is set incorrectly. What does <code>echo $GOROOT</code> say? If it says nothing, check whether <code>&#47;usr&#47;local&#47;go</code> exists."}, {"owner": {"reputation": 157, "user_id": 2098847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37dfc544524612b4883fef7922cf0b8d?s=128&d=identicon&r=PG", "display_name": "JohnsonDiao", "link": "https://stackoverflow.com/users/2098847/johnsondiao"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1439283210, "post_id": 31867347, "comment_id": 51785221, "body": "@Dave C Sorry for the late reply. I can&#39;t fix the problem of &quot;go get&quot;, because the golang.org/x/tools is blocked by the gov.  I tried to run &quot;go build&quot; under each of the folder  golang/tools/  and then, run &quot;go build&quot; under goimports/ , it worked. I got goimport file. I don&#39;t know why.  Maybe goimports depend on some packets which need to be build bofore. I am confused how the golang.org/x/tools is organized. If I want to build all of the tools, how to set GOPATH, and where to run &quot;go build&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1580826952, "post_id": 31948228, "comment_id": 106220481, "body": "Note this is all pre-modules. If using <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">Go 1.11+ with modules</a> things work slightly differently and the best work around for issues fetching would probably be setting <code>GOPROXY</code> and perhaps using a custom proxy."}, {"owner": {"reputation": 8510, "user_id": 379348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a7850e000babe0a45e13e6c65912d04?s=128&d=identicon&r=PG", "display_name": "Harrison", "link": "https://stackoverflow.com/users/379348/harrison"}, "edited": false, "score": 0, "creation_date": 1616701454, "post_id": 31948228, "comment_id": 118093284, "body": "<code>export GOPROXY=https:&#47;&#47;gocenter.io</code> was the answer that worked for me, thanks @dave-c"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 14, "last_activity_date": 1439314039, "creation_date": 1439314039, "answer_id": 31948228, "question_id": 31867347, "link": "https://stackoverflow.com/questions/31867347/i-am-having-trouble-getting-golang-org-x-tools-cmd-goimports/31948228#31948228", "title": "I am having trouble getting golang.org/x/tools/cmd/goimports", "body": "<p>This answer will give an option to work around a failed <code>go get</code> <strong>due to network blocking</strong>.\nNote that if there is a configuration problem with your Go installation (such as an incorrect <code>GOPATH</code>), such failures should <strong>not</strong> be worked around but the underlying problem fixed; otherwise you'll just have later errors/failures. However, in this specific case apparently the root cause of the failure is unfixable due to no network access to the resource required. (Although I'd have expected a better, more specific error message from <code>go get</code> in that case; perhaps instead of just blocking an HTTP request has been replaced with a page that contains some data that confuses <code>go get</code>).</p>\n\n<p>First, what is <code>go get golang.org/x/tools/cmd/goimports</code> trying to do. <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"noreferrer\">The documentation</a> says it \"downloads and installs the packages named by the import paths, along with their dependencies.\"</p>\n\n<p>It's important to realize two things: one, it does this by fetching the package <em>sources</em> (usually by cloning a VCS repository) and then building the package(s)/program(s); and two, if the source directory appears to already exist it does <em>not fetch or update anything</em>.\nThe later can cause issues if something undetected went wrong with a previous <code>go get</code> as you'll be stuck with the \"corrupt\" sources. If this happens you can either use the <code>-u</code> flag to attempt an update or you can remove the old/corrupt/incomplete directory from your <code>GOPATH</code> and try a fresh <code>go get</code>.</p>\n\n<p>The documentation also describes how it interprets <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"noreferrer\">\"remote import paths\"</a>, basically trying to match it to a know code hosting service (GitHub, Bitbucket, etc) or to a remote version control system repository (git, mercurial, etc) or doing an HTTPS/HTTP request and looking for a <code>meta name=\"go-import\" \u2026</code> tag.</p>\n\n<p>You can see some of this by using <code>go get -v</code>:</p>\n\n<pre><code># go get -v golang.org/x/tools/cmd/goimports\nFetching https://golang.org/x/tools/cmd/goimports?go-get=1\nParsing meta tags from https://golang.org/x/tools/cmd/goimports?go-get=1 (status code 200)\nget \"golang.org/x/tools/cmd/goimports\": found meta tag main.metaImport{Prefix:\"golang.org/x/tools\", VCS:\"git\", RepoRoot:\"https://go.googlesource.com/tools\"} at https://golang.org/x/tools/cmd/goimports?go-get=1\nget \"golang.org/x/tools/cmd/goimports\": verifying non-authoritative meta tag\nFetching https://golang.org/x/tools?go-get=1\nParsing meta tags from https://golang.org/x/tools?go-get=1 (status code 200)\ngolang.org/x/tools (download)\ngolang.org/x/tools/go/ast/astutil\ngolang.org/x/tools/imports\ngolang.org/x/tools/cmd/goimports\n</code></pre>\n\n<p>In this case <code>go get</code> does an HTTPS request to <code>golang.org</code> to discover the location of the source and effectively does\u00b9:</p>\n\n<pre><code>mkdir -p $GOPATH/src/golang.org/x/tools\ngit clone https://go.googlesource.com/tools $GOPATH/src/golang.org/x/tools\ngo build golang.org/x/tools/cmd/goimports\n</code></pre>\n\n<p>It found that <code>golang.org/x/tools/cmd/goimports</code> is part of <code>golang.org/x/tools</code> and downloads that whole repository by doing a <code>git clone</code> and then building the <code>goimports</code> command and it's two dependant packages (which conveniently are within the same repository, otherwise there would be multiple clone/download steps). The results are put under <code>$GOPATH/bin</code> (and <code>$GOPATH/pkg/$GOOS_$GOARCH</code>).</p>\n\n<p>So if <code>go get</code> isn't working or is blocked from accessing <code>golang.org</code> the first thing to try would be the above commands.\nFailing that you could substitute a mirror (e.g. <code>git clone https://github.com/golang/tools.git $GOPATH/golang.org/x/tools</code>), or you could otherwise download the contents of the repository from somewhere and unpack them into the correct location within your <code>GOPATH</code>, e.g. perhaps something like:</p>\n\n<pre><code>curl https://github.com/golang/tools/archive/master.zip\nunzip -d $GOPATH/src/golang.org/x/tools master.zip\n</code></pre>\n\n<p>Once the source for all dependant packages is \"somehow\" put into <code>GOPATH/src</code> you should be able to <code>go build {path}</code>.\n<strong>The important part here is to make sure the sources are where the <code>go</code> tools expects them to be</strong>, that is, under <code>$GOPATH/src/{go/import/path}</code>.</p>\n\n<p>If only some domains (such as <code>golang.org</code>) are blocked you could do this for only the blocked repositories and then do <code>go get golang.org/x/tools/cmd/goimports</code>; since <code>go get</code> won't try to fetch existing directories this should only fetch any missing dependencies before building everything.</p>\n\n<p><sub>\u00b9 Note, these examples assume the common case of <code>GOPATH</code> being a single directory. If instead your <code>GOPATH</code> is multiple directories, e.g.\u00a0<code>GOPATH=$HOME/go.public:$HOME/go.private</code>, then you'd need to substitute the <em>first</em> path component of your <code>GOPATH</code>.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 52274, "user_id": 264052, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/8ccbe08a132ba61eae9ff8984ca44e81?s=128&d=identicon&r=PG", "display_name": "smwikipedia", "link": "https://stackoverflow.com/users/264052/smwikipedia"}, "is_accepted": false, "score": 0, "last_activity_date": 1480319580, "creation_date": 1480319580, "answer_id": 40839438, "question_id": 31867347, "link": "https://stackoverflow.com/questions/31867347/i-am-having-trouble-getting-golang-org-x-tools-cmd-goimports/40839438#40839438", "title": "I am having trouble getting golang.org/x/tools/cmd/goimports", "body": "<p>Try these 3 approaches:</p>\n\n<ol>\n<li>On Windows, set the proxies in Internet Explorer.</li>\n<li>Add <code>http_proxy</code> and <code>https_proxy</code> to your environment variables.</li>\n<li>If you are using git, edit the .gitconfig file like this:</li>\n</ol>\n\n<blockquote>\n<pre><code>[http]\n   proxy = \"your proxy\"\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 157, "user_id": 2098847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37dfc544524612b4883fef7922cf0b8d?s=128&d=identicon&r=PG", "display_name": "JohnsonDiao", "link": "https://stackoverflow.com/users/2098847/johnsondiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12883, "favorite_count": 5, "answer_count": 2, "score": 4, "last_activity_date": 1480319580, "creation_date": 1438903312, "last_edit_date": 1439282908, "question_id": 31867347, "link": "https://stackoverflow.com/questions/31867347/i-am-having-trouble-getting-golang-org-x-tools-cmd-goimports", "title": "I am having trouble getting golang.org/x/tools/cmd/goimports", "body": "<p>when I get golang.org/x/tools/cmd/goimports</p>\n\n<pre><code>go get golang.org/x/tools/cmd/goimports\n</code></pre>\n\n<p>...I get the following error:</p>\n\n<pre><code>package golang.org/x/tools/cmd/goimports: unrecognized import path \"golang.org/x/tools/cmd/goimports\"\n</code></pre>\n\n<p>and I tried to compile the goimports from source code, so I download it from </p>\n\n<p><a href=\"http://github.com/golang/tools.git\" rel=\"noreferrer\">http://github.com/golang/tools.git</a>\nand\n<a href=\"https://github.com/bradfitz/goimports\" rel=\"noreferrer\">https://github.com/bradfitz/goimports</a></p>\n\n<p>and how to compile it ?</p>\n"}]