[{"tags": ["go"], "comments": [{"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1555544518, "post_id": 55737015, "comment_id": 98152486, "body": "You could not passing anything at all and make <code>GetSettings</code> return all the values for <code>Settings</code> individually. Or you could use a map[string]interface{} as the return value, then convert it to a <code>Settings</code>."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1555548790, "post_id": 55737015, "comment_id": 98153244, "body": "<code>json.NewDecoder(file).Decode(settingsToPopulate)</code> ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555566565, "post_id": 55737015, "comment_id": 98156887, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26327391/json-marshalstruct-returns\">json.Marshal(struct) returns &quot;{}&quot;</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555566609, "post_id": 55737015, "comment_id": 98156903, "body": "Export the fields. Also, don&#39;t forget to Close() the file when you&#39;re done with it."}], "answers": [{"tags": [], "owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "is_accepted": true, "score": 4, "last_activity_date": 1555549910, "creation_date": 1555549910, "answer_id": 55737870, "question_id": 55737015, "link": "https://stackoverflow.com/questions/55737015/how-can-a-function-that-accepts-an-interface-parameter-update-the-value-it-is/55737870#55737870", "title": "How can a function that accepts an interface{} parameter update the value it is called with by reference?", "body": "<p>Here you don't need to use the intermediate variable <code>decodedSettings</code>. Instead, using the <code>readSettings</code> pointer you pass in directly will cause the JSON package to deserialise to that instead. </p>\n\n<p>Your code will become:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetSettings(settingsToPopulate interface{}) error {\n    file, _ := os.Open(\"/tmp/settings.json\")\n    return json.NewDecoder(file).Decode(settingsToPopulate)\n}\n</code></pre>\n"}], "owner": {"reputation": 764, "user_id": 3367128, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/100000468302976/picture?type=large", "display_name": "dylhunn", "link": "https://stackoverflow.com/users/3367128/dylhunn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 55737870, "answer_count": 1, "score": -1, "last_activity_date": 1555549910, "creation_date": 1555541721, "question_id": 55737015, "link": "https://stackoverflow.com/questions/55737015/how-can-a-function-that-accepts-an-interface-parameter-update-the-value-it-is", "title": "How can a function that accepts an interface{} parameter update the value it is called with by reference?", "body": "<p>I have a package called <code>server</code> that contains a <code>Settings</code> struct. It contains code like this:</p>\n\n<pre><code>type Settings struct {\n    foobar String\n}\n\nfunc example() {\n    readSettings := Settings{}\n    err := storage.GetSettings(&amp;readSettings)\n    // Problem: at this point, readSettings has not been changed!\n}\n</code></pre>\n\n<p>My problem is that readSettings is not being updated.</p>\n\n<p>In the <code>storage</code> package, there is a function <code>GetSettings</code>:</p>\n\n<pre><code>func GetSettings(settingsToPopulate interface{}) error {\n    file, _ := os.Open(\"/tmp/settings.json\")\n    var decodedSettings interface{}\n    json.NewDecoder(file).Decode(&amp;decodedSettings)\n    settingsToPopulate = decodedSettings\n    return nil\n}\n</code></pre>\n\n<p>My constraints are that the <code>Settings</code> struct must remain in <code>server</code>, and the IO method <code>GetSettings</code> much remain in <code>storage</code>.</p>\n\n<p>I can't make <code>GetSettings</code> just accept a <code>Settings</code> struct, because that would cause a circular dependency.</p>\n\n<p>How can I make the reference parameter of <code>GetSettings</code> be updated?</p>\n"}, {"tags": ["javascript", "go", "base64"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1555538215, "post_id": 55736273, "comment_id": 98151085, "body": "Your go code is correct. So the problem is on the JS side."}], "answers": [{"comments": [{"owner": {"reputation": 237, "user_id": 3018333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/52f10dd1e704848b5c32776fd2bfe033?s=128&d=identicon&r=PG&f=1", "display_name": "imran", "link": "https://stackoverflow.com/users/3018333/imran"}, "edited": false, "score": 2, "creation_date": 1555545164, "post_id": 55736719, "comment_id": 98152580, "body": "And what is the solution then?"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 2, "last_activity_date": 1555544578, "last_edit_date": 1555544578, "creation_date": 1555539598, "answer_id": 55736719, "question_id": 55736273, "link": "https://stackoverflow.com/questions/55736273/go-and-node-js-base64-encoding-decoding-problems/55736719#55736719", "title": "Go and Node.js base64 encoding, decoding problems", "body": "<p>From: <a href=\"https://github.com/ricmoo/aes-js/blob/master/README.md\" rel=\"nofollow noreferrer\">https://github.com/ricmoo/aes-js/blob/master/README.md</a></p>\n\n<p><code>UTF8 should NOT be used to store arbitrary binary data as it is a string encoding format, not a binary encoding format</code></p>\n\n<p>So don't used utf8 related functions to convert raw (non utf8) binary data.</p>\n"}, {"comments": [{"owner": {"reputation": 237, "user_id": 3018333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/52f10dd1e704848b5c32776fd2bfe033?s=128&d=identicon&r=PG&f=1", "display_name": "imran", "link": "https://stackoverflow.com/users/3018333/imran"}, "edited": false, "score": 0, "creation_date": 1555577136, "post_id": 55739143, "comment_id": 98161534, "body": "This works for proper UTF8 strings, so I will mark it as correct. Unfortunately, it does not solve my problem, which was not in scope here though: My data that gets encoded is binary (result of an encryption), and I think here the comment of @colminator might apply"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": true, "score": 0, "last_activity_date": 1555561606, "creation_date": 1555561606, "answer_id": 55739143, "question_id": 55736273, "link": "https://stackoverflow.com/questions/55736273/go-and-node-js-base64-encoding-decoding-problems/55739143#55739143", "title": "Go and Node.js base64 encoding, decoding problems", "body": "<p>In Go, strings are UTF8:</p>\n\n<pre><code>in := \"Good afternoon, or \u3053\u3093\u306b\u3061\u306f\"\nbuf := []byte(in)\nstr := base64.StdEncoding.EncodeToString(buf)\nfmt.Println(str)\n</code></pre>\n\n<p>That prints the base64 encoded (ASCII safe) representation:\n<code>R29vZCBhZnRlcm5vb24sIG9yIOOBk+OCk+OBq+OBoeOBrw==</code></p>\n\n<p>JS strings are UTF-16. So you need to both decode from base64 and convert from utf8 to utf-16. You could use a library, or a helper function, for example:</p>\n\n<pre><code>function b64DecodeUnicode(str) {\n    return decodeURIComponent(atob(str).split('').map(function(c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n}\n\nvar str = \"R29vZCBhZnRlcm5vb24sIG9yIOOBk+OCk+OBq+OBoeOBrw==\";\nvar result = b64DecodeUnicode(str);\n\"Good afternoon, or \u3053\u3093\u306b\u3061\u306f\"\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/30106551/3915\">The b64DecodeUnicode() function is copied from this answer, see also the link to MDN for detailed info</a>.</p>\n"}], "owner": {"reputation": 237, "user_id": 3018333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/52f10dd1e704848b5c32776fd2bfe033?s=128&d=identicon&r=PG&f=1", "display_name": "imran", "link": "https://stackoverflow.com/users/3018333/imran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 818, "favorite_count": 0, "accepted_answer_id": 55739143, "answer_count": 2, "score": 0, "last_activity_date": 1555561606, "creation_date": 1555536748, "last_edit_date": 1555545080, "question_id": 55736273, "link": "https://stackoverflow.com/questions/55736273/go-and-node-js-base64-encoding-decoding-problems", "title": "Go and Node.js base64 encoding, decoding problems", "body": "<p>I am base64 encoding a string in Go</p>\n\n<p>Then decoding in javascript (I have tried 3 different methods) </p>\n\n<p>I cannot get the javascript result to match the original Go string</p>\n\n<p><strong>Go (encode)</strong></p>\n\n<pre><code>a := []byte {138,143,163,224,178,73,161,15,240,121,53,192,198,182,52,245}\nfmt.Println(\"a\", string(a), a, len(a))\nb := base64.StdEncoding.EncodeToString(a)\nfmt.Println(\"b\", b, []byte(b), len([]byte(b)))\n</code></pre>\n\n<p><strong>js (decode)</strong></p>\n\n<pre><code> const b = [105,111,43,106,52,76,74,74,111,81,47,119,101,84,88,65,120,114,89,48,57,81,61,61];\n let bString = aesjs.utils.utf8.fromBytes(b);\n console.log(\"b\", bString, b, b.length);\n\n let a1String = atob(bString);\n let a2String = Base64.decode(bString);\n let a3String = Buffer.from(bString, 'base64').toString('utf8');\n let a1 = aesjs.utils.utf8.toBytes(a1String);\n let a2 = aesjs.utils.utf8.toBytes(a2String);\n let a3 = aesjs.utils.utf8.toBytes(a3String);\n console.log(\"a\", a1, a1.length, a2, a2.length, a3, a3.length);\n</code></pre>\n\n<p>All 3 methods fail, i.e. a1 != a, a2 != a, a3 != a</p>\n\n<p>I assumed base64 encoding/decoding would be simple</p>\n\n<p>What am I missing? Thanks</p>\n\n<p>EDIT: The js code had a 'typo' - but the problem remains, that ai != a, even a1 != a2 == a3</p>\n\n<p><strong>EDIT: If the original a is simple, then everything works.</strong> But when a contains non-printable chars, I cannot decode in js\nExample where it works:\na := []byte {65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65}\nHere it does not works:\na := []byte {138, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65}</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": false, "score": 2, "last_activity_date": 1555535732, "creation_date": 1555535732, "answer_id": 55736074, "question_id": 55735864, "link": "https://stackoverflow.com/questions/55735864/how-does-go-make-system-calls/55736074#55736074", "title": "How does Go make system calls?", "body": "<p>The <a href=\"https://godoc.org/golang.org/x/sys\" rel=\"nofollow noreferrer\">sys</a> package takes care of the syscalls to the underlying OS. Depending on the OS you're using different packages are used to generate the appropriate calls. Here is a link to the README for Go running on Unix systems: <a href=\"https://github.com/golang/sys/blob/master/unix/README.md\" rel=\"nofollow noreferrer\">https://github.com/golang/sys/blob/master/unix/README.md</a> the parts on <a href=\"https://github.com/golang/sys/blob/master/unix/README.md#mksyscallgo\" rel=\"nofollow noreferrer\">mksyscall.go</a>, which  are hand-written Go files which implement system calls that need special handling, and <a href=\"https://github.com/golang/sys/blob/master/unix/README.md#types-files\" rel=\"nofollow noreferrer\">type files</a>, should walk you through how it works. </p>\n"}, {"tags": [], "owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "is_accepted": false, "score": 6, "last_activity_date": 1555539620, "creation_date": 1555539620, "answer_id": 55736722, "question_id": 55735864, "link": "https://stackoverflow.com/questions/55735864/how-does-go-make-system-calls/55736722#55736722", "title": "How does Go make system calls?", "body": "<p>Yes go is now written in go. But, you don't need C to make syscalls.</p>\n\n<p>An important thing to call out is that syscalls aren't \"written in C.\" You can make syscalls from C on Unix because of <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/unistd.h.html\" rel=\"noreferrer\"><code>&lt;unistd.h&gt;</code></a>. In particular, how Linux defines this header is a little convoluted, but you can see from <a href=\"https://github.com/torvalds/linux/blob/e53f31bffe1d552f496b674cd1733658a268e177/include/uapi/asm-generic/unistd.h\" rel=\"noreferrer\">this file</a> the general idea. Syscalls are defined with a name and a number. When you call <code>read</code> for example, what really happens behind the scenes is the parameters are setup in the proper registers/memory (<a href=\"https://stackoverflow.com/a/2538212/568785\">linux expects the syscall number in <code>eax</code></a>) followed by the instruction <code>syscall</code> which fires interrupt <code>0x80</code>. The OS has already setup the proper interrupt handlers that will receive this interrupt and the OS goes about doing whatever is needed for that syscall. So, you don't need something written in C (or a standard library for that matter) to make syscalls. You just need to understand the call ABI and know the interrupt numbers.</p>\n\n<p>However, as @retgits points out golang's approach is to piggyback off the fact that libc already has all of the logic for handling syscalls. <a href=\"https://github.com/golang/sys/blob/12500544f89f9420afe9529ba8940bf72d294972/unix/mksyscall.go\" rel=\"noreferrer\"><code>mksyscall.go</code></a> is a CLI script that parses these libc files to extract the necessary information.</p>\n\n<p>You can actually trace the life of a syscall if you compile a go script like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"syscall\"\n)\n\nfunc main() {\n    var buf []byte\n    syscall.Read(9, buf)\n}\n</code></pre>\n\n<p>Run <code>objdump -D</code> on the resulting binary. The go runtime is rather large, so your best bet is to find the <code>main</code> function, see where it calls <code>syscall.Read</code> and then search for the offsets from there: <code>syscall.Read</code> calls <code>syscall.syscall</code>, <code>syscall.syscall</code> calls <code>runtime.libcCall</code> (which switches from the go ABI to C ABI compatibility so that arguments are located where the OS expects--you can see this <a href=\"https://github.com/golang/go/blob/e92853523d11d1e50d89a3c017c5d902aed0596a/src/runtime/sys_darwin.go#L62\" rel=\"noreferrer\">in <code>runtime</code></a>, for darwin for example), <code>runtime.libcCall</code> calls <code>runtime.asmcgocall</code>, etc.</p>\n\n<p>For extra fun, run that binary with gdb and continue stepping in until you hit the syscall.</p>\n"}, {"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 0, "last_activity_date": 1555539986, "creation_date": 1555539986, "answer_id": 55736771, "question_id": 55735864, "link": "https://stackoverflow.com/questions/55735864/how-does-go-make-system-calls/55736771#55736771", "title": "How does Go make system calls?", "body": "<p>The Go compiler (which translates the Go code to target CPU code) is written in Go but that is different to the run time support code which is what you are talking about.  The standard library is mainly written in Go and probably knows how to directly make system calls with no C code involved. However, there may be a bit of C support code, depending on the target platform.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 9, "last_activity_date": 1555569733, "last_edit_date": 1555569733, "creation_date": 1555540564, "answer_id": 55736863, "question_id": 55735864, "link": "https://stackoverflow.com/questions/55735864/how-does-go-make-system-calls/55736863#55736863", "title": "How does Go make system calls?", "body": "<p>The short answer is \"it depends\".</p>\n\n<p>Go compiles for multiple combinations of H/W and OS, and they all have different approaches to how syscalls are to be made when working with them.</p>\n\n<p>For instance, Solaris does not provide a stable supported set of syscalls, so they go through the systems libc \u2014 just as required by the vendor.</p>\n\n<p>Windows does support a rather stable set of syscalls but it is defined as a C API provided by a set of standard DLLs.\nThe functions exposed by those DLLs are mostly shims which use a single \"make a syscall by number\" function, but these numbers are not documented and are different between the kernel flavours and releases (perhaps, intentionally).</p>\n\n<p>Linux does provide a stable and documented set of <em>numbered</em> syscalls and hence there Go just calls the kernel directly.</p>\n\n<p>Now keep in mind that for Go to \"call the kernel directly\" means following the so-called <a href=\"https://en.m.wikipedia.org/wiki/Application_binary_interface\" rel=\"noreferrer\">ABI</a> of the H/W and OS combo. For instance, on modern Linux on amd64 making a syscall requires filling a set of CPU registers with certain values, doing some other arrangements and then issuing the <code>SYSENTER</code> CPU instruction.</p>\n\n<p>On Windows, you have to use its native calling convention (which is stdcall, not cdecl).</p>\n"}], "owner": {"reputation": 14034, "user_id": 230884, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a07907d1d5962d947d1a414362d4331c?s=128&d=identicon&r=PG", "display_name": "CppLearner", "link": "https://stackoverflow.com/users/230884/cpplearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2399, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1567857373, "creation_date": 1555534718, "last_edit_date": 1567857373, "question_id": 55735864, "link": "https://stackoverflow.com/questions/55735864/how-does-go-make-system-calls", "title": "How does Go make system calls?", "body": "<p>As far as I know, in CPython, <code>open()</code> and <code>read()</code> - the API to read a file is written in C code. The C code probably calls some C library which knows how to make system call.</p>\n\n<p>What about a language such as Go? Isn't Go itself now written in Go? Does Go call C libraries behind the scenes?</p>\n"}, {"tags": ["go", "exec"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1555532650, "post_id": 55735382, "comment_id": 98149143, "body": "Remember that <code>exec.Command</code> doesn&#39;t go through a shell. So, for example, the quotes around your parameters are likely needed only for the shell and are causing errors when they are actually passed to the command by <code>exec</code>."}, {"owner": {"reputation": 29, "user_id": 7169269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c29dac12dd2d8dabb2adcc5ee1e8bdf1?s=128&d=identicon&r=PG", "display_name": "thetall0ne", "link": "https://stackoverflow.com/users/7169269/thetall0ne"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555537169, "post_id": 55735382, "comment_id": 98150764, "body": "That&#39;s interesting - so you do you think I should just remove quotes around everything? I didn&#39;t try that."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555533439, "post_id": 55735474, "comment_id": 98149436, "body": "<code>end</code> is defined with the wrong value. It&#39;s the flag and the following two args all passed as one argument."}, {"owner": {"reputation": 29, "user_id": 7169269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c29dac12dd2d8dabb2adcc5ee1e8bdf1?s=128&d=identicon&r=PG", "display_name": "thetall0ne", "link": "https://stackoverflow.com/users/7169269/thetall0ne"}, "edited": false, "score": 0, "creation_date": 1555536206, "post_id": 55735474, "comment_id": 98150425, "body": "I copied and pasted your function above (thank you by the way) and I still get the same error. The output says <code>&#47;usr&#47;bin&#47;osascript -e &#39;on run {f, c}&#39; -e &#39;tell app &quot;Finder&quot; to set comment of (POSIX file f as alias) to c&#39; -e -e end &quot;&#47;Users&#47;aaronedell&#47;Desktop&#47;testfile.png&quot; Hello, World</code> which seems like it is missing quoted around the Hello, World?"}, {"owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555594986, "post_id": 55735474, "comment_id": 98171531, "body": "I updated the code (Thanks @Adrian) so hopefully it will work now."}], "tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": false, "score": 0, "last_activity_date": 1555594950, "last_edit_date": 1555594950, "creation_date": 1555532723, "answer_id": 55735474, "question_id": 55735382, "link": "https://stackoverflow.com/questions/55735382/how-to-fix-syntax-error-a-unknown-token-can-t-go-here-when-running-exec-comm/55735474#55735474", "title": "How to fix &#39;syntax error: A unknown token can\u2019t go here&#39; when running `exec.Command` in Go script", "body": "<p>You need to break out the <code>-e</code> on the end of <code>command</code> too and the comment, something like this.  This makes the same number of parameters as in the original command hopefully.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    filepath := \"/Users/computerman/Desktop/testfile.png\"\n    comment := \"Hello, World\"\n    onrun := \"'on run {f, c}'\"\n    command := fmt.Sprintf(`'tell app \"Finder\" to set comment of (POSIX file f as alias) to c'`)\n    end := fmt.Sprintf(`end \"%s\")`, filepath)\n    log.Println(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command, \"-e\", end, comment)\n    cmd := exec.Command(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command, \"-e\", end, comment)\n    cmd.Stderr = os.Stderr\n    cmd.Stdout = os.Stdout\n    cmd.Stdin = os.Stdin\n\n    err := cmd.Run()\n    if err != nil {\n        log.Println(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 7169269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c29dac12dd2d8dabb2adcc5ee1e8bdf1?s=128&d=identicon&r=PG", "display_name": "thetall0ne", "link": "https://stackoverflow.com/users/7169269/thetall0ne"}, "is_accepted": false, "score": 1, "last_activity_date": 1555537986, "creation_date": 1555537986, "answer_id": 55736490, "question_id": 55735382, "link": "https://stackoverflow.com/questions/55735382/how-to-fix-syntax-error-a-unknown-token-can-t-go-here-when-running-exec-comm/55736490#55736490", "title": "How to fix &#39;syntax error: A unknown token can\u2019t go here&#39; when running `exec.Command` in Go script", "body": "<p>Thanks to the previous comments, I discovered the answer. Here is the correct code that works. Thanks to Adrian for pointing out that you don't need the single quotes, so I removed them, and thanks to Nick for pointing out that the end flag needed to be separate from that string. </p>\n\n<pre><code>func main() {\n    filepath := \"/Users/computerman/Desktop/testfile.png\"\n    comment := \"Hello, World\"\n    onrun := \"on run {f, c}\"\n    command := fmt.Sprintf(`tell app \"Finder\" to set comment of (POSIX file f as alias) to c`)\n    //log.Println(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command)\n    cmd := exec.Command(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command, \"-e\", \"end\", filepath, comment)\n    cmd.Stderr = os.Stderr\n    cmd.Stdout = os.Stdout\n    cmd.Stdin = os.Stdin\n\n    err := cmd.Run()\n    if err != nil {\n        log.Println(err)\n    }\n}\n</code></pre>\n\n<p>It works!</p>\n"}], "owner": {"reputation": 29, "user_id": 7169269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c29dac12dd2d8dabb2adcc5ee1e8bdf1?s=128&d=identicon&r=PG", "display_name": "thetall0ne", "link": "https://stackoverflow.com/users/7169269/thetall0ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 877, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1555594950, "creation_date": 1555532290, "question_id": 55735382, "link": "https://stackoverflow.com/questions/55735382/how-to-fix-syntax-error-a-unknown-token-can-t-go-here-when-running-exec-comm", "title": "How to fix &#39;syntax error: A unknown token can\u2019t go here&#39; when running `exec.Command` in Go script", "body": "<p>I am trying to run this Apple Script command with <code>osascript</code> in my Go script and I'm getting the error <code>0:1: syntax error: A unknown token can\u2019t go here. (-2740)</code>. </p>\n\n<p>This is the command that, when run in Terminal, works great! </p>\n\n<p><code>/usr/bin/osascript -e 'on run {f, c}' -e 'tell app \"Finder\" to set comment of (POSIX file f as alias) to c' -e end \"/Users/computerman/Desktop/testfile.png\" \"Hello, World\"</code></p>\n\n<p>My Go script below actually outputs the above string, and I can literally cut and paste it in Terminal and it works. However, running the Go script itself I get the aforementioned error. </p>\n\n<p>Please help!</p>\n\n<p>This is on MacOS 10.14.4 (18E2034). I tried replacing the fmt.Sprintf with simpler string with \\\"Finder\"\\ and have the same exact issue. </p>\n\n<pre><code>\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    filepath := \"/Users/computerman/Desktop/testfile.png\"\n    comment := \"Hello, World\"\n    onrun := \"'on run {f, c}'\"\n    command := fmt.Sprintf(`'tell app \"Finder\" to set comment of (POSIX file f as alias) to c' -e end \"%s\" \"%s\"`, filepath, comment)\n    log.Println(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command)\n    cmd := exec.Command(\"/usr/bin/osascript\", \"-e\", onrun, \"-e\", command)\n    cmd.Stderr = os.Stderr\n    cmd.Stdout = os.Stdout\n    cmd.Stdin = os.Stdin\n\n    err := cmd.Run()\n    if err != nil {\n        log.Println(err)\n    }\n}\n</code></pre>\n\n<p>When I do <code>go run main.go</code> I get this in Terminal</p>\n\n<pre><code>2019/04/17 13:02:28 exit status 1\n</code></pre>\n\n<p>I expect the output of </p>\n\n<pre><code>Hello, World\n</code></pre>\n\n<p>And no errors. Plus, the comment field in the file to be updated with Hello, World.</p>\n"}, {"tags": ["sql", "postgresql", "go", "orm"], "answers": [{"tags": [], "owner": {"reputation": 817, "user_id": 4165295, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fziJ5.jpg?s=128&g=1", "display_name": "Kern", "link": "https://stackoverflow.com/users/4165295/kern"}, "is_accepted": false, "score": 1, "last_activity_date": 1572173910, "creation_date": 1572173910, "answer_id": 58578750, "question_id": 55735195, "link": "https://stackoverflow.com/questions/55735195/how-can-i-querying-a-subfield-in-nested-structures-in-go-pg-postgres-orm-with-g/58578750#58578750", "title": "How can I querying a subfield in nested structures in go-pg (Postgres ORM with Go)?", "body": "<p>You need to tell the ORM to make a JOIN statement on the PersonalInfo table using the <code>Relation</code> method (<code>Column</code> on older versions of go-pg).</p>\n\n<pre><code>func (u *DB_User) AnotherGetItemByName(db *pg.DB) error {\n    err := db.Model(u).Relation(\"PersonalInfo\").Where(\"PersonalInfo.name = ?\", u.PersonalInfo.Name).Select()\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11375318, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VyKmduMyTS0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdKlJU7aUPn6pJPNcBKYVjKJdVPog/mo/photo.jpg?sz=128", "display_name": "alvoff", "link": "https://stackoverflow.com/users/11375318/alvoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 783, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1572173910, "creation_date": 1555531444, "last_edit_date": 1555543706, "question_id": 55735195, "link": "https://stackoverflow.com/questions/55735195/how-can-i-querying-a-subfield-in-nested-structures-in-go-pg-postgres-orm-with-g", "title": "How can I querying a subfield in nested structures in go-pg (Postgres ORM with Go)?", "body": "<p>I am new to SQL ORM databases and I'm writing code in Golang which works with PostgresQL database. I have this nested structures:</p>\n\n<pre><code>type PersonalInfo struct {\n    Name      string `sql:\"name\"`\n    Telephone string `sql:\"telephone\"`\n    Email     string `sql:\"email\"`\n    Age       string `sql:\"age\"`\n    Gender    string `sql:\"gender\"`\n    City      string `sql:\"city\"`\n}\n\ntype DB_SessionInfo struct {\n    Coockie string\n}\n\ntype DB_User struct {\n    ID           int            `sql:\"id, pk\"`\n    Username     string         `sql:\"username,unique\"`\n    Password     string         `sql:\"password\"`\n    PersonalInfo PersonalInfo   `sql:\"personalinfo, type:jsonb\"`\n    SessionInfo  DB_SessionInfo `sql:\"session_info, type:jsonb\"`\n}\n</code></pre>\n\n<p>If I'm trying to select item by <code>username</code>, I use the code above and it works well:</p>\n\n<pre><code>func (u *DB_User) GetItemByName(db *pg.DB) error {\n    err := db.Model(u).Where(\"username = ?0\", u.Username).Select()\n    if err != nil {\n        fmt.Printf(\"Error while getting value by *username*. Reason: %v\\n\", err)\n        return err\n    }\n    fmt.Printf(\"Get by *username* successful for &lt;%v&gt;\\n\", u)\n    return nil\n}\n</code></pre>\n\n<p>Before every request to database i connect to this and create tables by code above:</p>\n\n<pre><code>func someFunction() {\n    database := ConnectToDB()\n    defer database.Close()\n\n    // some code\n    DB_Entry := new(db.DB_User)\n    DB_Entry.Username = \"Username\"\n\n    DB_Entry.GetItemByName(database)\n}\n\nfunc ConnectToDB() *pg.DB {\n    database := pg.Connect(&amp;pg.Options{\n        User:     \"postgres\",\n        Password: \"postgres\",\n        Database: \"postgres\",\n    })\n    fmt.Println(\"\\nSuccessful connection to DB\")\n\n    err := createSchema(database)\n    if err != nil {\n        panic(err)\n    } else {\n        fmt.Println(\"Schema created\")\n    }\n    return database\n}\n\nfunc createSchema(database *pg.DB) error {\n    for _, model := range []interface{}{(*db.DB_User)(nil), (*db.PersonalInfo)(nil)} {\n        err := database.CreateTable(model, &amp;orm.CreateTableOptions{\n            IfNotExists: true,\n        })\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>So, when I want to Select item where <code>personalinfo.name == \"some_name\"</code> by this code I have error.\nCode:</p>\n\n<pre><code>func (u *DB_User) AnotherGetItemByName(db *pg.DB) error {\n    err := db.Model(u).Where(\"personalinfo.name = ?0\", u.PersonalInfo.Name).Select()\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>ERROR #42P01 table \"personalinfo\" doesn`t exist\n</code></pre>\n\n<p>So my question is, what I am doing wrong? Wrong request in select function? Maybe the mistake in creating tables in function <code>createSchema</code>?</p>\n\n<p>I was trying to find an answer in stackoverflow and reading go-pg documentation, but can't find the solution. I'm sure that has very simple solution and it is basic point of using sql, but i'm new in it.\nI will be appreciated for help.</p>\n"}, {"tags": ["go", "artifactory"], "comments": [{"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 1, "creation_date": 1555534951, "post_id": 55735128, "comment_id": 98149974, "body": "Are you running the commands in a module aware Go project? In other words, does the folder you&#39;re running the commands in have a <code>go.mod</code> file? Comparing the results in my machine between running it in a Go project with a Go mod and an empty folder (not a Go project) I see the same results as you do (which is expected behavior by the Go client)"}, {"owner": {"reputation": 547, "user_id": 85581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87b6e061f678980e7e8bfdd44b1dbe0?s=128&d=identicon&r=PG", "display_name": "Fred Simon", "link": "https://stackoverflow.com/users/85581/fred-simon"}, "edited": false, "score": 1, "creation_date": 1555587614, "post_id": 55735128, "comment_id": 98167222, "body": "To use go mod you can do the following: <code>echo &quot;module test&quot; &gt; go.mod; go mod tidy</code> . If your proxy set correctly it should work."}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555594579, "post_id": 55735128, "comment_id": 98171255, "body": "I do not have a go.mod file. I could not tell if that was required or not. I will try that."}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555595004, "post_id": 55735128, "comment_id": 98171543, "body": "I got: &quot;go: modules disabled inside GOPATH/src by GO111MODULE=auto; see &#39;go help modules&#39;&quot;. I do not have an env var &quot;GO11MODULE&quot; set."}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555597688, "post_id": 55735128, "comment_id": 98173235, "body": "see update2 for creation of my go.mod file."}], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555615299, "post_id": 55750029, "comment_id": 98181544, "body": "This helped and showed that my GOPROXY is being used, however I got 404 from Artifactory. See update #5 above."}, {"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "reply_to_user": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 1, "creation_date": 1555616185, "post_id": 55750029, "comment_id": 98181879, "body": "@SamMorehouse, are you using a Virtual Repository or a Remote Repository as your GOPROXY? If you&#39;re using a remote repository, you&#39;ll also have to set up a virtual one, containing the remote repo pointing to GoCenter. I have a remote repository called <code>gocenter</code> and that repo is part of my virtual repo called <code>go2</code>. With that, I&#39;ve set my GOPROXY as <code>http:&#47;&#47;&lt;artifactoryserver&gt;&#47;artifactory&#47;api&#47;go&#47;go2</code>"}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555648249, "post_id": 55750029, "comment_id": 98188936, "body": "Ahhh! More undocumented features :) Reminds me of how helm doesn&#39;t work until you wrap everything in virtual repos."}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555684516, "post_id": 55750029, "comment_id": 98201435, "body": "I changed my remote repo to be called &quot;gocenter-remote&quot; and created a virtual repo called &quot;gocenter&quot; that includes only the remote repo. This still returns the &quot;404 Not Found&quot; when I try to &quot;go get&quot;"}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555684884, "post_id": 55750029, "comment_id": 98201587, "body": "The &quot;goc&quot; binary downloaded the dependencies (goc get ...) but from <a href=\"https://gocenter.io\" rel=\"nofollow noreferrer\">gocenter.io</a>, bypassing my virtual/remote repos. My gocenter-remote-cache repo is empty. The go.mod file was updated as you suggested @retgits with the indirect comment, which was removed once I built it. &quot;goc build&quot; built me a hello.exe"}, {"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "reply_to_user": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555686342, "post_id": 55750029, "comment_id": 98202211, "body": "@SamMorehouse, the <code>goc</code> utility automatically assigns GOPROXY to be pointed to GoCenter and bypass all your Artifactory all together. A nice feature of <code>goc</code> is that when the module isn&#39;t in GoCenter it will get the sources from GitHub (or where ever the module source is) instead of failing the build. It&#39;s awesome you were able to build your app, though I&#39;m still a little confused as to why your remote didn&#39;t work. I&#39;ll update my original answer to reflect both solution so others might benefit from it."}, {"owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "edited": false, "score": 0, "creation_date": 1555688423, "post_id": 55750029, "comment_id": 98203108, "body": "I finally got it to work by unsetting my office proxy. Local env was the issue after we got the module setup. To be clear, &quot;go get ....&quot; downloaded the files from my Artifactory instance, files are cached in Artifactory now."}, {"owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "edited": false, "score": 0, "creation_date": 1565304158, "post_id": 55750029, "comment_id": 101323166, "body": "Good to know that it&#39;s working. One update is that goc is not needed anymore. This change was made a few months back. go cli can be used to fetch go module versions from GoCenter and JFrog Artifactory. And JFrog CLI can be used to fetch module versions from JFrog Artifactory and also push module versions to JFrog Artifactory."}], "tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": true, "score": 1, "last_activity_date": 1555686829, "last_edit_date": 1555686829, "creation_date": 1555604029, "answer_id": 55750029, "question_id": 55735128, "link": "https://stackoverflow.com/questions/55735128/how-to-use-gocenter-remote-artifactory-repo-for-local-dependency-resolution/55750029#55750029", "title": "How to use gocenter remote Artifactory repo for local dependency resolution?", "body": "<p>You mentioned you're not a Go developer so let me walk you through all the steps. I realize it might be a little overkill to some of the devs here, but it might help you.</p>\n\n<p>Depending on where you've put your source code you will need to set the environment variable <code>GO111MODULE</code>. Since go 1.11 it's recommended to not put your source code in your $GOPATH anymore. If you put your code there and want to use Go modules you'll have to set the <code>GO111MODULE</code> to <code>true</code> (personally I keep all my Go code outside of the $GOPATH). On Windows you'll have to create the environment variable first and set it accordingly (and restart your terminal).</p>\n\n<p>To create a Go module you'll have to run the command <code>go mod init &lt;name of your module&gt;</code>. In my case, I've ran the command <code>go mod init github.com/retgits/bla</code> which created a <code>go.mod</code> file with</p>\n\n<pre><code>module github.com/retgits/bla\n\ngo 1.12\n</code></pre>\n\n<p>Adding modules will now be as simple as running <code>go get</code>. If you want to use GoCenter or Artifactory to help resolve your modules.</p>\n\n<p>To help resolve modules there are two options you might want to look at:</p>\n\n<ul>\n<li>Using a utility called <code>goc</code></li>\n<li>Setting up a remote and virtual proxy</li>\n</ul>\n\n<p><strong>Using goc</strong></p>\n\n<p>The <a href=\"https://github.com/jfrog/goc\" rel=\"nofollow noreferrer\">goc</a> utility automatically sets GOPROXY to GoCenter, bypassing other proxies like Artifactory. The current behavior of the Go client is to look at one single proxy and fail your build if not all modules are resolved from there. <code>goc</code> will look at GoCenter first and if the module isn't in GoCenter it will get the module from its original place (like GitHub)</p>\n\n<p><strong>Using Artifactory</strong></p>\n\n<p>If you want to use Artifactory to resolve, and cache, your Go modules you'll have to create a remote repository with the settings for GoCenter (which are in the documentation as you mentioned). You'll have to include that remote repository into a virtual one for it to work.</p>\n\n<p><strong>Setting GoCenter as GOPROXY</strong></p>\n\n<p>A third option would be to only use GoCenter (the public registry created by JFrog), but that might defeat your original question:</p>\n\n<pre><code>export GOPROXY=\"https://gocenter.io\"\ngo get -v github.com/naoina/go-stringutil\n</code></pre>\n\n<p>No matter which of the options you choose it will update the <code>go.mod</code> to</p>\n\n<pre><code>module github.com/retgits/bla\n\ngo 1.12\n\nrequire github.com/naoina/go-stringutil v0.1.0 // indirect\n</code></pre>\n\n<p>The <code>indirect</code> is because I've not yet created a <code>.go</code> file with the code that uses this import.</p>\n\n<p>If I now create a <code>main.go</code> sample with</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/naoina/go-stringutil\"\n)\n\nfunc main() {\n    str := stringutil.ToSnakeCase(\"HelloWorld\")\n    fmt.Println(str)\n}\n// Running go run main.go would result in\n// hello_world\n</code></pre>\n\n<p>it will remove the <code>indirect</code> from the go.mod file because I now have code that relies on my module.</p>\n"}], "owner": {"reputation": 329, "user_id": 9285755, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mJDVD.png?s=128&g=1", "display_name": "Sam Morehouse", "link": "https://stackoverflow.com/users/9285755/sam-morehouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "accepted_answer_id": 55750029, "answer_count": 1, "score": 1, "last_activity_date": 1565304158, "creation_date": 1555531132, "last_edit_date": 1555688492, "question_id": 55735128, "link": "https://stackoverflow.com/questions/55735128/how-to-use-gocenter-remote-artifactory-repo-for-local-dependency-resolution", "title": "How to use gocenter remote Artifactory repo for local dependency resolution?", "body": "<p>I am new to go and trying to use a gocenter remote repo (Artifactory 6.8) for dependency resolution. Despite setting GOPROXY env var my gocenter-cache repo remains empty.</p>\n\n<p>Here's my go code.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n        \"fmt\"\n        \"github.com/naoina/go-stringutil\"\n)\n\nfunc main() {\n        var str string = \"hello_world_go\"\n        fmt.Println(stringutil.ToUpperCamelCase(str)) //prints HelloWorldGo\n}\n\n</code></pre>\n\n<p>The dependency I am trying to resolve is here: <a href=\"https://search.gocenter.io/github.com~2Fnaoina~2Fgo-stringutil/versions\" rel=\"nofollow noreferrer\">https://search.gocenter.io/github.com~2Fnaoina~2Fgo-stringutil/versions</a></p>\n\n<p>Here's my GOPROXY env var:</p>\n\n<pre><code>$ echo $GOPROXY\nhttps://&lt;&lt;my Artifactory URL&gt;&gt;/api/go/gocenter\n</code></pre>\n\n<p>Here's a truncated version of the gocenter repo definition. I used the <a href=\"https://www.jfrog.com/confluence/display/RTF/Go+Registry#GoRegistry-ProxyingGoCenter\" rel=\"nofollow noreferrer\">jfrog docs</a> for setting this up:</p>\n\n<pre><code>{\n  \"key\" : \"gocenter\",\n  \"packageType\" : \"go\",\n  \"url\" : \"https://gocenter.io/\",\n  \"rclass\" : \"remote\"\n}\n</code></pre>\n\n<p>When I run \"go get\" the dependency resolves...</p>\n\n<pre><code>$ go get -v github.com/naoina/go-stringutil\ngithub.com/naoina/go-stringutil (download)\n</code></pre>\n\n<p>but gocenter-cache is empty, telling me it wasn't used. </p>\n\n<pre><code>{\n  \"repo\" : \"gocenter-cache\",\n  \"path\" : \"/\",\n  \"created\" : \"2019-04-17T16:35:37.586Z\",\n  \"lastModified\" : \"2019-04-17T16:35:37.586Z\",\n  \"lastUpdated\" : \"2019-04-17T16:35:37.586Z\",\n  \"children\" : [ ],\n  \"uri\" : \"https://&lt;&lt;REDACTED&gt;&gt;/api/storage/gocenter-cache\"\n}\n</code></pre>\n\n<p>Perhaps my \"go get\" should have a different target? I am just using what exists in gocenter: <a href=\"https://search.gocenter.io/github.com~2Fnaoina~2Fgo-stringutil/versions\" rel=\"nofollow noreferrer\">https://search.gocenter.io/github.com~2Fnaoina~2Fgo-stringutil/versions</a></p>\n\n<p>Any help in pointing out what I am doing wrong would be greatly appreciated. I haven't gone into modules yet or anything like that, as I am an artifactory admin and not a go developer. I am just trying to prototype this functionality so we can help advise our users with what to do.</p>\n\n<p>--UPDATE: I found <a href=\"https://golang.org/cmd/go/#hdr-Module_proxy_protocol\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Module_proxy_protocol</a> and then tried this: </p>\n\n<pre><code>$ echo $GOPROXY; go get $GOPROXY/github.com/naoina/go-stringutil\nhttps://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter\npackage https:/&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/go-stringutil: https:/&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/go-stringutil: invalid import path: malformed import path \"https:/&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/go-stringutil\": invalid char ':'\n</code></pre>\n\n<p>So the colon between my protocol and my url is an invalid character? Also why is it removing one of my forward slashes? </p>\n\n<p>--UPDATE2:\nI got \"go mod init\" to work, kind of:</p>\n\n<pre><code>$ go mod init\ngo: creating new go.mod: module example/hello\n$ ls\ngo.mod  hello.go\n$ go build\nbuild example/hello: cannot load github.com/naoina/go-stringutil: cannot find module providing package github.com/naoina/go-stringutil\n$ cat go.mod\nmodule example/hello\n\ngo 1.12\n$ echo $GOPROXY\nhttps://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter\n</code></pre>\n\n<p>--UPDATE 3:</p>\n\n<pre><code>$ cat go.mod\nmodule example/hello\n\ngo 1.12\n\nrequire github.com/naoina/go-stringutil v0.1.0\n\n$ go build\nhello.go:6:2: cannot find package \"github.com/naoina/go-stringutil\" in any of:\n        C:\\Go\\src\\github.com\\naoina\\go-stringutil (from $GOROOT)\n        C:\\Users\\samuelm\\go\\src\\github.com\\naoina\\go-stringutil (from $GOPATH)\n\n$ echo $GOPROXY\nhttps://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter\n</code></pre>\n\n<p>--UPDATE 4: it appears I'm still not using modules?</p>\n\n<pre><code>$ go list -m all\ngo list -m: not using modules\n</code></pre>\n\n<p>--UPDATE 5, re: retgits\nYour steps helped, but I'm still not all the way there. </p>\n\n<pre><code>$ find .\n.\n./bin\n./src\n./src/example.com\n./src/example.com/hello\n./src/example.com/hello/hello.go\n\n$ cd src/\n\n$ go mod init example.com/hello\ngo: creating new go.mod: module example.com/hello\n\n$ cat go.mod\nmodule example.com/hello\n\ngo 1.12\n\n$ go get -v github.com/naoina/go-stringutil\nFetching https://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/go-stringutil/@v/list\nFetching https://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/@v/list\nFetching https://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/@v/list\ngo get github.com/naoina/go-stringutil: unexpected status (https://&lt;&lt;REDACTED&gt;&gt;/api/go/gocenter/github.com/naoina/go-stringutil/@v/list): 404 Not Found\n\n$ go build example.com/hello\ncan't load package: package example.com/hello: unknown import path \"example.com/hello\": cannot find module providing package example.com/hello\n\n$ cd example.com/hello/\n\n$ go build\nbuild example.com/hello/example.com/hello: cannot load github.com/naoina/go-stringutil: cannot find module providing package github.com/naoina/go-stringutil\n</code></pre>\n\n<p>I am not providing credentials in my GOPROXY, because our end-users do not have accounts, we're inside a firewalled env and allow full anon read access. If we have to provide user accts then we cannot support Go. </p>\n\n<p>--FINAL UPDATE:\nRemoving my local proxy resolved the 404 issue, retgits solution works. </p>\n"}, {"tags": ["loops", "dictionary", "go", "go-templates", "consul-template"], "answers": [{"comments": [{"owner": {"reputation": 10512, "user_id": 2296997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PXClb.jpg?s=128&g=1", "display_name": "4m1r", "link": "https://stackoverflow.com/users/2296997/4m1r"}, "edited": false, "score": 0, "creation_date": 1555601447, "post_id": 55735305, "comment_id": 98175378, "body": "Thanks @icza this is pretty hard to understand as a Go newbie.  Any way we can simplify or use something native to the templating language?  I wonder if we could convert the map into an array and then get a range index?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10512, "user_id": 2296997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PXClb.jpg?s=128&g=1", "display_name": "4m1r", "link": "https://stackoverflow.com/users/2296997/4m1r"}, "edited": false, "score": 0, "creation_date": 1555624579, "post_id": 55735305, "comment_id": 98184702, "body": "@4m1r If you are allowed to convert your map to a slice, then there is no issue: ranging over a slice you have the index too."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1555532527, "last_edit_date": 1555532527, "creation_date": 1555531944, "answer_id": 55735305, "question_id": 55734461, "link": "https://stackoverflow.com/questions/55734461/get-iterator-index-in-go-template-consul-template/55735305#55735305", "title": "Get iterator index in go template (consul-template)", "body": "<p>There is no iteration number when ranging over maps (only a value and an optional key). You can achieve what you want with custom functions.</p>\n\n<p>One possible solution that uses an <code>inc()</code> function to increment an index variable in each iteration:</p>\n\n<pre><code>func main() {\n    t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n        \"inc\": func(i int) int { return i + 1 },\n    }).Parse(src))\n\n    m := map[string]string{\n        \"one\":   \"first\",\n        \"two\":   \"second\",\n        \"three\": \"third\",\n    }\n\n    fmt.Println(t.Execute(os.Stdout, m))\n}\n\nconst src = `{{$idx := 0}}\n{{range $key, $value := .}}\n    index: {{$idx}} key: {{ $key }} value: {{ $value }}\n    {{$idx = (inc $idx)}}\n{{end}}`\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/slVyyyFlOzs\" rel=\"nofollow noreferrer\">Go Payground</a>) (compacted output):</p>\n\n<pre><code>index: 0 key: one value: first\nindex: 1 key: three value: third\nindex: 2 key: two value: second\n</code></pre>\n\n<p>See similar / related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/42662525/go-template-remove-the-last-comma-in-range-loop\">Go template remove the last comma in range loop</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/51043433/join-range-block-in-go-template\">Join range block in go template</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/46112679/golang-code-to-repeat-an-html-code-n-times\">Golang code to repeat an html code n times</a></p>\n"}, {"tags": [], "owner": {"reputation": 1021, "user_id": 1826308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e348915a2adc35e5d5297fc2613fb04?s=128&d=identicon&r=PG", "display_name": "Wandering Zombie", "link": "https://stackoverflow.com/users/1826308/wandering-zombie"}, "is_accepted": false, "score": 0, "last_activity_date": 1592567948, "last_edit_date": 1592567948, "creation_date": 1566154086, "answer_id": 57547441, "question_id": 55734461, "link": "https://stackoverflow.com/questions/55734461/get-iterator-index-in-go-template-consul-template/57547441#57547441", "title": "Get iterator index in go template (consul-template)", "body": "<p>The example below looks for all servers providing the pmm service, but will only create the command to register with the first pmm server found (when $index == 0)</p>\n\n<pre><code>{{- range $index, $service := service \"pmm\" -}}\n    {{- if eq $index 0 -}}\nsudo pmm-admin config --server {{ $service.Address }}\n    {{- end -}}\n{{- end -}}\n</code></pre>\n"}], "owner": {"reputation": 10512, "user_id": 2296997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PXClb.jpg?s=128&g=1", "display_name": "4m1r", "link": "https://stackoverflow.com/users/2296997/4m1r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 833, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1592567948, "creation_date": 1555528205, "last_edit_date": 1555532003, "question_id": 55734461, "link": "https://stackoverflow.com/questions/55734461/get-iterator-index-in-go-template-consul-template", "title": "Get iterator index in go template (consul-template)", "body": "<p>I'm trying to get a simple index that I can append to output of a Go template snippet using consul-template.  Looked around a bit and couldn't figure out the simple solution. Basically, given this input</p>\n\n<pre><code>backend web_back\n    balance roundrobin\n    {{range service \"web-busybox\" \"passing\"}}\n        server  {{ .Name }} {{ .Address }}:80 check\n    {{ end }}\n</code></pre>\n\n<p>I would like to see <code>web-busybox-n 10.1.1.1:80 check</code></p>\n\n<p>Where n is the current index in the range loop.  Is this possible with range and maps?</p>\n"}, {"tags": ["go", "exit"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1555517253, "post_id": 55731760, "comment_id": 98142316, "body": "How do you run the go program?"}, {"owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1555517595, "post_id": 55731760, "comment_id": 98142496, "body": "Ah. Good point. Think I was running it using <code>go run main.go</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1555518639, "last_edit_date": 1592644375, "creation_date": 1555517285, "answer_id": 55731883, "question_id": 55731760, "link": "https://stackoverflow.com/questions/55731760/go-os-exit2-show-a-bash-value-of-1/55731883#55731883", "title": "Go os.Exit(2) show a bash $? value of 1", "body": "<p>The exit status <code>1</code> and <code>0</code> are not the exit status of your app but that of <code>go run</code>.</p>\n<p>If you run your app using <code>go run</code>, then <code>go run</code> will return <code>0</code> if your app returns <code>0</code> exit status, and <code>1</code> if your app returns a non-zero status (or <code>go run</code> itself fails).</p>\n<p>Build your app using <code>go build</code> or <code>go install</code>, then run your app directly. Then you will see a <code>2</code> exit status.</p>\n<p>Quoting from <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"noreferrer\">Command go: Compile and run Go program:</a></p>\n<blockquote>\n<p>The exit status of Run is not the exit status of the compiled binary.</p>\n</blockquote>\n<p>Note: If you run your app on the <a href=\"https://play.golang.org/p/XMAo1w_VLGL\" rel=\"noreferrer\">Go playground</a>, it also indicates the exit status of your app (with no output):</p>\n<pre><code>Program exited: status 2.\n</code></pre>\n<p>This &quot;issue&quot; was brought up before, see <a href=\"https://github.com/golang/go/issues/13440\" rel=\"noreferrer\">#13440</a>. Russ Cox's words:</p>\n<blockquote>\n<p>The real question is whether 'go run x.go' is supposed to be just an interpreter for Go programs, like 'python x.py' or whether it is a tool that runs a subprocess and reports the results itself, like make. To date, the answer has been the latter. So it's not obvious the behavior is wrong, unless 'go run' is supposed to be some kind of interactive go command, which we've said in the past it is not.</p>\n</blockquote>\n<p>And Dmitri Shuralyov's words:</p>\n<blockquote>\n<p>An exit code is a single-dimensional value. When doing go run, there are 2 processes that run and 2 exit codes one may want to know.</p>\n<p>However, go run is only able to report a single exit code value, not two. It's not possible to losslessly combine two exit codes into one. If it reported the exit code of the program it ran verbatim, then information about the go run exit code would be shadowed and effectively lost.</p>\n<p>IMO, if one cares about the exact exit code of the program that is executed, they need to build it and execute it themselves. go run is a convenience feature for when your needs are not as demanding and you're okay with less information, because it's unable to communicate more information than it already does.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1555517326, "creation_date": 1555517326, "answer_id": 55731892, "question_id": 55731760, "link": "https://stackoverflow.com/questions/55731760/go-os-exit2-show-a-bash-value-of-1/55731892#55731892", "title": "Go os.Exit(2) show a bash $? value of 1", "body": "<p>Execute the program. For example,</p>\n\n<p><code>exit.go</code>:</p>\n\n<pre><code>package main\n\nimport \"os\"\n\nfunc main() {\n    os.Exit(2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go build exit.go\n$ ./exit\n$ echo $?\n2\n$\n</code></pre>\n"}], "owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 1, "accepted_answer_id": 55731883, "answer_count": 2, "score": 3, "last_activity_date": 1555518706, "creation_date": 1555516956, "last_edit_date": 1555518706, "question_id": 55731760, "link": "https://stackoverflow.com/questions/55731760/go-os-exit2-show-a-bash-value-of-1", "title": "Go os.Exit(2) show a bash $? value of 1", "body": "<p>I wrote a short Go program using <code>os.Exit(2)</code> and ran this from a Bash shell.</p>\n\n<p>When I type <code>echo $?</code> it shows a values of <code>1</code> regardless of the exit value passed to <code>os.Exit</code>.</p>\n\n<p>The Bash script below shows a <code>$?</code> value of <code>2</code> as does the C program.</p>\n\n<p>Why does the Go program always show a value of <code>1</code>? How can I exit with a code other than <code>0</code> or <code>1</code>, and should I use this method to indicate differing exit states?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"os\"\n\nfunc main() {\n    os.Exit(2)\n}\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/bash\n\nexit 2\n</code></pre>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n\nint main() {\n    exit(2);\n}\n\n</code></pre>\n"}, {"tags": ["go", "buffer", "reader"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555514211, "post_id": 55730935, "comment_id": 98140606, "body": "The buffer is discarded every loop iteration. Can you explain what you mean by &quot;in the next packet it overwrites somewhere&quot;?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555514307, "post_id": 55730935, "comment_id": 98140664, "body": "The <code>reader.Reset</code> is pointless - in the line immediately following, the entire reader is discarded."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555516295, "post_id": 55730935, "comment_id": 98141838, "body": "bufio.NewReader returns its argument if possible. Given your problem description, serial.OpenPort returns a buffered reader already, and since you never advance it it makes sense that you get the same bytes over and over again."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 6821422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHi21.png?s=128&g=1", "display_name": "Jeet", "link": "https://stackoverflow.com/users/6821422/jeet"}, "edited": false, "score": 0, "creation_date": 1556606534, "post_id": 55741344, "comment_id": 98484826, "body": "I have indented the code in the question. I have tried your method but it is not receiving the whole packet."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 45, "user_id": 6821422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHi21.png?s=128&g=1", "display_name": "Jeet", "link": "https://stackoverflow.com/users/6821422/jeet"}, "edited": false, "score": 0, "creation_date": 1556622077, "post_id": 55741344, "comment_id": 98492828, "body": "@Logan make a new question with both server and client that you wrote so far."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1555573527, "creation_date": 1555573527, "answer_id": 55741344, "question_id": 55730935, "link": "https://stackoverflow.com/questions/55730935/how-to-reset-or-discard-the-buffered-data/55741344#55741344", "title": "How to reset or discard the buffered data", "body": "<p>bare in mind i cant check what i m saying here...</p>\n\n<p>1/ you must not instantiate the bufio reader at each iteration</p>\n\n<p>2/ bufio.Reader.Peek does NOT advance the reader\n<a href=\"https://golang.org/pkg/bufio/#Reader.Peek\" rel=\"nofollow noreferrer\">https://golang.org/pkg/bufio/#Reader.Peek</a></p>\n\n<p>3/ Unless you get a malformed packet, i think you dont need to reset at all.</p>\n\n<p>4/ Please indent your code at play.golang.org</p>\n\n<p>5/ You are not checking the read error for termination</p>\n\n<p>6/ All package i can found to work with serial ports in go exposes an instance of io.Reader, so it might be useless to use an additional bufio.Reader. I suspect you r using <a href=\"https://godoc.org/github.com/tarm/serial#OpenPort\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/tarm/serial#OpenPort</a></p>\n\n<p>This is probably not the definitive answer, but it should help.</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    s, err := serial.OpenPort(c)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    pck := make([]byte, 46)\n    for {\n        time.Sleep(time.Second / 2)\n        n, err := s.Read(pck)\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            log.Println(err)\n        }\n        pck = pck[:n]\n        go parse(pck)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 6821422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHi21.png?s=128&g=1", "display_name": "Jeet", "link": "https://stackoverflow.com/users/6821422/jeet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 799, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556606402, "creation_date": 1555514098, "last_edit_date": 1556606402, "question_id": 55730935, "link": "https://stackoverflow.com/questions/55730935/how-to-reset-or-discard-the-buffered-data", "title": "How to reset or discard the buffered data", "body": "<p>Not able to reset or discard the buffer.</p>\n\n<p>I am trying to get the data over the serial port where I am getting data packet of some fixed length for every 10 seconds. I have an infinite for loop to receive the data packets continuously. After receiving the new data packet I am resetting the buffer but when I receive the next data packet, it overwrites the buffer and I get mixed data packet.</p>\n\n<p>Let say I should receive packet <code>abcdef</code> continuously for every n second. But when I try the following code I am receiving packet <code>bcdefa</code> then after n second <code>cdefab</code> then <code>defabc</code> and so on</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"log\"\n    \"time\"\n    \"github.com/tarm/serial\"\n)\n\nfunc main() {\n    c := &amp;serial.Config{Name: \"/dev/ttyUSB0\", Baud: 57600}\n    s, err := serial.OpenPort(c)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    for {\n        time.Sleep(time.Second / 2)\n        reader := bufio.NewReader(s)\n        pck, err := reader.Peek(46)\n        if err != nil {\n            log.Println(err)\n        }\n        go parse(pck)\n        reader.Reset(s)\n    }\n}\n</code></pre>\n\n<p>How do I reset or discard the buffer data effectively so that I will receive the exact data packet.</p>\n"}, {"tags": ["go", "gonum"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1555513511, "post_id": 55730279, "comment_id": 98140137, "body": "Per the README, &quot;Gonum supports and tests on the three most recent minor versions of Go.&quot; The current release is 1.12 so you may run into issues with versions older than 1.10, which you are far behind. Try updating Go and see if that helps."}, {"owner": {"reputation": 13, "user_id": 10636562, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xHte_BwXXTI/AAAAAAAAAAI/AAAAAAAAABg/-O3gxwX7vHs/photo.jpg?sz=128", "display_name": "Vylly", "link": "https://stackoverflow.com/users/10636562/vylly"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555514643, "post_id": 55730279, "comment_id": 98140907, "body": "Thanks a lot, your comment made me realize the issue : I had the package go-golang installed (from apt-get ) and it was used instead of the released version I got from the go website so I was using an old version of go which didn&#39;t allow me to import gonum. I just had to remove the go-golang package to make it work (I also took the time to upgrade the go version I was using).  Thanks a lot @Adrian !"}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 10636562, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xHte_BwXXTI/AAAAAAAAAAI/AAAAAAAAABg/-O3gxwX7vHs/photo.jpg?sz=128", "display_name": "Vylly", "link": "https://stackoverflow.com/users/10636562/vylly"}, "is_accepted": true, "score": 1, "last_activity_date": 1555515252, "creation_date": 1555515252, "answer_id": 55731279, "question_id": 55730279, "link": "https://stackoverflow.com/questions/55730279/how-to-deal-with-import-cycle-not-allowed-while-trying-to-install-gonum/55731279#55731279", "title": "How to deal with &quot;import cycle not allowed&quot; while trying to install gonum?", "body": "<p>As Adrian told in the comments, the issue was that the go version I was running was too old for gonum to install correctly. This was due to the fact that the go-golang package installed on my computer via apt-get was giving me the 1.6 version of go. By removing the package and making sure I had a recent go release installed on my computer I managed to install gonum.</p>\n"}], "owner": {"reputation": 13, "user_id": 10636562, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xHte_BwXXTI/AAAAAAAAAAI/AAAAAAAAABg/-O3gxwX7vHs/photo.jpg?sz=128", "display_name": "Vylly", "link": "https://stackoverflow.com/users/10636562/vylly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 55731279, "answer_count": 1, "score": 0, "last_activity_date": 1555515252, "creation_date": 1555512153, "last_edit_date": 1555512526, "question_id": 55730279, "link": "https://stackoverflow.com/questions/55730279/how-to-deal-with-import-cycle-not-allowed-while-trying-to-install-gonum", "title": "How to deal with &quot;import cycle not allowed&quot; while trying to install gonum?", "body": "<p>I'd like to use the gonum libraries for go in order to experiment with some neural network stuff but I cannot go past the install process... </p>\n\n<p>I'm running the command found on the official gonum website : </p>\n\n<pre><code>go get -u -t gonum.org/v1/gonum/...\n</code></pre>\n\n<p>But it gives me : </p>\n\n<pre><code>import cycle not allowed\npackage gonum.org/v1/gonum\n    imports runtime\n    imports internal/bytealg\n    imports internal/cpu\n    imports runtime\n</code></pre>\n\n<p>Do you know what could be a reason for such a problem?</p>\n\n<p>In case you need my go env in order to help me out, here it is : </p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/me/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGO15VENDOREXPERIMENT=\"1\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>I'm running go 1.6.2.</p>\n"}, {"tags": ["go", "concurrency", "sequential"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555513589, "post_id": 55730273, "comment_id": 98140195, "body": "There isn&#39;t really a &quot;too many goroutines&quot;. Internally, Google runs services that spawn millions of goroutines. They are designed to be lightweight."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555513877, "post_id": 55730273, "comment_id": 98140386, "body": "You might find this informative: <a href=\"https://stackoverflow.com/questions/8509152/max-number-of-goroutines\" title=\"max number of goroutines\">stackoverflow.com/questions/8509152/max-number-of-goroutines</a>"}, {"owner": {"reputation": 993, "user_id": 1216466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee44b501c5f58ec95a17670fa6dc692b?s=128&d=identicon&r=PG", "display_name": "rtev", "link": "https://stackoverflow.com/users/1216466/rtev"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555513991, "post_id": 55730273, "comment_id": 98140460, "body": "Given the lightweight nature of go routines would you say that the design here is reasonable then?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555514108, "post_id": 55730273, "comment_id": 98140532, "body": "I don&#39;t have enough information to say that but based on what&#39;s presented I wouldn&#39;t immediately call it unreasonable. I would assume there&#39;s no problem unless you measure and detect a problem."}, {"owner": {"reputation": 993, "user_id": 1216466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee44b501c5f58ec95a17670fa6dc692b?s=128&d=identicon&r=PG", "display_name": "rtev", "link": "https://stackoverflow.com/users/1216466/rtev"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555521064, "post_id": 55730273, "comment_id": 98144202, "body": "Thank you for your comments!"}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1555522847, "post_id": 55730273, "comment_id": 98145001, "body": "Is the cardinality of your <code>id</code> bounded/fixed? Or can it grow dynamically? Thousands of go routines shouldn&#39;t be an issue, but having an unbounded operation could cause issue (ie <code>if !found</code>)"}, {"owner": {"reputation": 993, "user_id": 1216466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee44b501c5f58ec95a17670fa6dc692b?s=128&d=identicon&r=PG", "display_name": "rtev", "link": "https://stackoverflow.com/users/1216466/rtev"}, "edited": false, "score": 0, "creation_date": 1555528602, "post_id": 55730273, "comment_id": 98147517, "body": "It&#39;s bound a practical limit of several thousand. The current implementation works well, but it got me thinking about an implementation that could handle an unbounded situation."}], "answers": [{"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 1, "last_activity_date": 1556666703, "last_edit_date": 1556666703, "creation_date": 1555541061, "answer_id": 55736928, "question_id": 55730273, "link": "https://stackoverflow.com/questions/55730273/execute-jobs-concurrently-in-sequential-order/55736928#55736928", "title": "Execute jobs concurrently in sequential order", "body": "<p>Create a channel for each ID - perhaps a slice of channels or a map (indexed by ID).  Each channel would have a go-routine that processes the jobs for that ID in order. Simple.</p>\n\n<p>I wouldn't worry about creating too many go-routines. And I wouldn't use mutex - without getting into too much detail using channels and go-routines allows each job to only be processed by one go-routine at a time and avoids possibility of data races.</p>\n\n<p>BTW I only added this as an answer as I am not permitted to add comments (yet?).</p>\n"}], "owner": {"reputation": 993, "user_id": 1216466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee44b501c5f58ec95a17670fa6dc692b?s=128&d=identicon&r=PG", "display_name": "rtev", "link": "https://stackoverflow.com/users/1216466/rtev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556666703, "creation_date": 1555512138, "last_edit_date": 1555593391, "question_id": 55730273, "link": "https://stackoverflow.com/questions/55730273/execute-jobs-concurrently-in-sequential-order", "title": "Execute jobs concurrently in sequential order", "body": "<p>\"What?\" you ask, \"That title doesn't make any sense.\"</p>\n\n<p>Consider the following:\n<a href=\"https://i.stack.imgur.com/qANGe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qANGe.png\" alt=\"enter image description here\"></a>\nJobs with different ids may be processed asynchronously but jobs with the same id should be processed synchronously and in order from the queue.</p>\n\n<p>My current implementation creates a go routine to handle the jobs for each specific id and looks something like this:</p>\n\n<pre><code>func FanOut() chan&lt;- *Job {\n    channel := make(chan *Job)\n    routines = make(map[string]chan&lt;- *Job)\n    go func() {\n        for j := range channel {\n            r, found := routines[j.id]\n            if !found {\n                r = Routine()\n                routines[j.id] = r\n            }\n            r &lt;- j\n        }\n    }()\n    return channel\n}\n</code></pre>\n\n<p>This appears to work well (in current testing) but the creation of thousands of go routines might not be the best approach? Additionally the fan out code blocks unless a buffered channel is used.</p>\n\n<p>Rather than a collection of go routines (above) I'm considering using a collection of sync.Mutex. The idea would be to have a pool of go routines which must first establish a lock on the mutex corresponding to the job id.</p>\n\n<p>Are there any existing Go patterns suited to handling these requirements?</p>\n\n<p>Is there a better approach?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1555511237, "post_id": 55729833, "comment_id": 98138654, "body": "You read and modify the <code>msg</code> variable from multiple goroutines without synchronization, that&#39;s a data race and undefined behavior. You must synchronize access to <code>msg</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555511365, "post_id": 55729833, "comment_id": 98138735, "body": "Or better yet, just don&#39;t share variables between goroutines if you can possibly avoid it."}, {"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555511382, "post_id": 55729833, "comment_id": 98138745, "body": "@icza how do you synchronize access to primitive data structures like strings"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1555511434, "post_id": 55729833, "comment_id": 98138772, "body": "You program is buggy and may (or may not) output &quot;Let&#39;s JavaScript!&quot; or anything else. There is nothing to explain beyond &quot;your code is racy&quot;."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555511486, "post_id": 55729833, "comment_id": 98138812, "body": "With a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">Mutex</a>, for instance. But in this case it would be far simpler to just pass the message as an argument."}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 11345832, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FT4qmrvPKww/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdXFAuw-VtZudowvANCv57Jy6WiXg/mo/photo.jpg?sz=128", "display_name": "Filip Eriksson", "link": "https://stackoverflow.com/users/11345832/filip-eriksson"}, "is_accepted": true, "score": 1, "last_activity_date": 1555512143, "creation_date": 1555512143, "answer_id": 55730275, "question_id": 55729833, "link": "https://stackoverflow.com/questions/55729833/confusion-with-goroutine/55730275#55730275", "title": "Confusion with goroutine", "body": "<p>The very simplest answer I can give is that consider the goroutine similar to a process. When you call go func (){...}() it tells the program \"Please, start this \"process\" in the background while I keep executing my program\". As you may know, starting a process might take some time. So while it's starting up, the main program keeps executing, outputting \"Let's GoGoGo\". If you put your sleep before msg = \"Let's GoGoGo\" you would probably(not at all guaranteed!!) see \"Let's Go\" printed instead. </p>\n\n<p>I would recommend a book, called \"Concurrency in Go\" to help you understand how concurrency is done in Go.</p>\n"}], "owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 55730275, "answer_count": 1, "score": -1, "last_activity_date": 1582537737, "creation_date": 1555511052, "last_edit_date": 1582537737, "question_id": 55729833, "link": "https://stackoverflow.com/questions/55729833/confusion-with-goroutine", "title": "Confusion with goroutine", "body": "<p>Why does this code output <code>Let's GoGoGo</code> instead of the first value assigned to <code>msg</code>. I know this has something to do with goroutine. If someone versed with Go could explain it to me concretely I would appreciate it. Here is the <a href=\"https://play.golang.org/p/ASywel9KYgs\" rel=\"nofollow noreferrer\">playground</a>.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\n// try to run: go run -race\nfunc main() {\n   msg := \"Let's Go\"\n   go func() {\n    // Print: \"Let's Go\"\n    fmt.Println(msg)\n }()\n  msg = \"Let's GoGoGo\"\n  time.Sleep(1 * time.Second)\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1555509677, "post_id": 55729216, "comment_id": 98137609, "body": "<code>B []int</code> is <i>not</i> a pointer to slice it is a slice. You want <code>B *[]int</code>. Take the Tour of Go once more."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1555509759, "post_id": 55729216, "comment_id": 98137664, "body": "Later I rewrite it with <code>c</code> and slices are passed by reference, isn&#39;t it?!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555510915, "post_id": 55729216, "comment_id": 98138458, "body": "Nothing in Go is passed by reference. Slices contain a pointer to an underlying array."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555511012, "post_id": 55729216, "comment_id": 98138516, "body": "@Adrian, ok, can you fix my demo code so it works as expected?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555511238, "post_id": 55729216, "comment_id": 98138655, "body": "Read Volker&#39;s comment, that is the change to make for this code. I would say that this is pretty unusual (keeping a pointer to a struct field like this) as a use case, and your existing code would be fine in most circumstances (just referencing a field in a pointer to a struct), so this is very possibly an XY Problem."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 11148310, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WSzG8ZG32wk/AAAAAAAAAAI/AAAAAAAAADg/pGZQyyRr8S0/photo.jpg?sz=128", "display_name": "\u0414\u043c\u0438\u0442\u0440\u043e \u042f\u043d\u043a\u043e\u0432\u0441\u044c\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/11148310/%d0%94%d0%bc%d0%b8%d1%82%d1%80%d0%be-%d0%af%d0%bd%d0%ba%d0%be%d0%b2%d1%81%d1%8c%d0%ba%d0%b8%d0%b9"}, "is_accepted": true, "score": 1, "last_activity_date": 1555513643, "creation_date": 1555513643, "answer_id": 55730783, "question_id": 55729216, "link": "https://stackoverflow.com/questions/55729216/go-modifying-pointer-to-slice-doesnt-modify-the-original/55730783#55730783", "title": "go - Modifying pointer to slice doesn&#39;t modify the original", "body": "<p>You can use a slice of pointers like in example below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    B *[]int\n}\n\nfunc main() {\n    c := []int{}\n\n    a := &amp;A{\n        B: &amp;c,\n    }\n\n    *a.B = append(*a.B, 4)\n    *a.B = append(*a.B, 5)\n\n    fmt.Println(c)\n\n    fmt.Println(a.B)\n}\n</code></pre>\n\n<p>Result \n<a href=\"https://i.stack.imgur.com/WCwxv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WCwxv.png\" alt=\"The result is\"></a></p>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 55730783, "answer_count": 1, "score": -3, "last_activity_date": 1555513643, "creation_date": 1555509349, "question_id": 55729216, "link": "https://stackoverflow.com/questions/55729216/go-modifying-pointer-to-slice-doesnt-modify-the-original", "title": "go - Modifying pointer to slice doesn&#39;t modify the original", "body": "<p>I try to create a struct where one field is a pointer to the existing empty slice. Then I modify struct's field, and later I try to get the new content from the original slice - but it's still empty!</p>\n\n<p>Here is the demo code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    B []int\n}\n\nfunc main() {\n    c := []int{}\n\n    a := &amp;A{\n        B: c,\n    }\n\n    a.B = append(a.B, 5)\n\n    fmt.Println(c)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>The result here is:</p>\n\n<pre><code>[]\n&amp;{[5]}\n</code></pre>\n\n<p>The question is - how do I get the actual slice content from both original slice and struct's field? I have no passing the slice to the function as a param here.</p>\n"}, {"tags": ["reactjs", "go", "oauth-2.0", "linkedin"], "comments": [{"owner": {"reputation": 49, "user_id": 7194480, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iiQZ9KvVUVU/AAAAAAAAAAI/AAAAAAAAABU/zmdy4XLikEY/photo.jpg?sz=128", "display_name": "Naresh Manthena", "link": "https://stackoverflow.com/users/7194480/naresh-manthena"}, "edited": false, "score": 0, "creation_date": 1555509657, "post_id": 55728884, "comment_id": 98137596, "body": "Visit the Link : <a href=\"https://docs.microsoft.com/en-gb/linkedin/shared/authentication/authorization-code-flow?context=linkedin/consumer/context\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-gb/linkedin/shared/authentication/&hellip;</a>"}, {"owner": {"reputation": 1127, "user_id": 9438853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sg9e0.png?s=128&g=1", "display_name": "Jibin Joseph", "link": "https://stackoverflow.com/users/9438853/jibin-joseph"}, "edited": false, "score": 0, "creation_date": 1555521116, "post_id": 55728884, "comment_id": 98144222, "body": "Is your question answered?"}, {"owner": {"reputation": 49, "user_id": 7194480, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iiQZ9KvVUVU/AAAAAAAAAAI/AAAAAAAAABU/zmdy4XLikEY/photo.jpg?sz=128", "display_name": "Naresh Manthena", "link": "https://stackoverflow.com/users/7194480/naresh-manthena"}, "reply_to_user": {"reputation": 1127, "user_id": 9438853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sg9e0.png?s=128&g=1", "display_name": "Jibin Joseph", "link": "https://stackoverflow.com/users/9438853/jibin-joseph"}, "edited": false, "score": 0, "creation_date": 1555590853, "post_id": 55728884, "comment_id": 98169035, "body": "Yes I got the solution"}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 7194480, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iiQZ9KvVUVU/AAAAAAAAAAI/AAAAAAAAABU/zmdy4XLikEY/photo.jpg?sz=128", "display_name": "Naresh Manthena", "link": "https://stackoverflow.com/users/7194480/naresh-manthena"}, "is_accepted": false, "score": 0, "last_activity_date": 1555590820, "creation_date": 1555590820, "answer_id": 55746155, "question_id": 55728884, "link": "https://stackoverflow.com/questions/55728884/how-to-read-accesstoken-from-linkedin-oauth2/55746155#55746155", "title": "How to read accessToken from LinkedIn oAuth2", "body": "<p>I come to know finally that we have to use cURL to read the accessToken from http\nex: in node js we can use npm curl-request</p>\n"}], "owner": {"reputation": 49, "user_id": 7194480, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iiQZ9KvVUVU/AAAAAAAAAAI/AAAAAAAAABU/zmdy4XLikEY/photo.jpg?sz=128", "display_name": "Naresh Manthena", "link": "https://stackoverflow.com/users/7194480/naresh-manthena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 413, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1555590820, "creation_date": 1555508326, "question_id": 55728884, "link": "https://stackoverflow.com/questions/55728884/how-to-read-accesstoken-from-linkedin-oauth2", "title": "How to read accessToken from LinkedIn oAuth2", "body": "<p>I am new to linked in oAuth 2.0 sorry to ask this simple question.</p>\n\n<p>my application developing in react js and the backend is in golang.</p>\n\n<p>I am trying to get the access token from LinkedIn oAuth2.0 as per the \nVisit: <a href=\"http://www.example.com/)(https://docs.microsoft.com/en-gb/linkedin/shared/authentication/authorization-code-flow?context=linkedin/consumer/context\" rel=\"nofollow noreferrer\">http://www.example.com/)(https://docs.microsoft.com/en-gb/linkedin/shared/authentication/authorization-code-flow?context=linkedin/consumer/context</a></p>\n\n<p>in step 3 I can able to get the accessToken like this.</p>\n\n<pre><code>{\n\"access_token\": \"AQWAyxU2xC-2-MZILNex2q_EOKUsrar1GB3l-o1Cm3ErUcfjpe3Ri4QQzCgpMywYG7r-sSdLQPjTcJXUNDufaz97Xr9TtG8OOGl2ayCj7iwEbtRWojBkqkPeCXg-MjwX-AN6rgMzOnl4BIRp5r9xJrwQ0M7v6nyCZojLKXtSaVtomKF4cLyXurRPFOK_MutgYAb7gisaAloH4IjEOfmbab_O-MP-asDCvm6xuO6tEcf9Ws3HCsW5qGm_WYOZYIYGZKQeXps24zksj0X3M-fG1Ahb3_Z6KK5OScKtzOjyQmv3lBxNmgzoqLXc3TKwEeO4ZHmvYLlnBprbgE0eBt_moAVzHoybRg\",\n\"expires_in\": 5184000\n}\n</code></pre>\n\n<p>But my problem is how I can read this token for later uses because it's redirecting to the LinkedIn page from there I am unable to get it and I am unable to use the rest API because of CORS issue.</p>\n"}, {"tags": ["go", "types", "type-assertion"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1555507797, "creation_date": 1555507797, "answer_id": 55728722, "question_id": 55728678, "link": "https://stackoverflow.com/questions/55728678/go-change-from-interface-to-required-type/55728722#55728722", "title": "Go change from interface to required type", "body": "<p>Your <code>acctInterval</code> variable wraps an <code>int</code> value, so you can only <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type-assert</a> an <code>int</code> from it:</p>\n\n<pre><code>acctInterval.(int)\n</code></pre>\n\n<p>Which then you can <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">convert</a> to <code>AcctInterimInterval</code>:</p>\n\n<pre><code>test(AcctInterimInterval(acctInterval.(int)))\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/24xpo6-FCDa\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 7490, "user_id": 1515697, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/733f4b3d2139b2faa5188c9656785e50?s=128&d=identicon&r=PG", "display_name": "Romeo Mihalcea", "link": "https://stackoverflow.com/users/1515697/romeo-mihalcea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 0, "accepted_answer_id": 55728722, "answer_count": 1, "score": -1, "last_activity_date": 1555508306, "creation_date": 1555507669, "last_edit_date": 1555508306, "question_id": 55728678, "link": "https://stackoverflow.com/questions/55728678/go-change-from-interface-to-required-type", "title": "Go change from interface to required type", "body": "<p>I have this method where I receive an <code>int64</code> param. The parameter is used in some areas and then is supposed to be passed down to another method (from an external lib) that expects a different type: <code>type AcctInterimInterval uint32</code></p>\n\n<p>I tried converting it to a <code>uint32</code> but the script complains about it: <code>invalid type assertion: ... (non-interface type int on left)</code>.</p>\n\n<p>I also tried converting it to <code>AcctInterimInterval</code> but this time with a different error: <code>interface conversion: interface {} is int, not main.AcctInterimInterval</code></p>\n\n<p>Here's my test code so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n//  defined in some other lib\ntype AcctInterimInterval uint32\n\n//  defined in some other lib\nfunc test(value AcctInterimInterval){\n    fmt.Println(value)\n}\n\nfunc main() {\n    //  int received externally\n    interval := 60\n\n    var acctInterval interface{} = interval\n\n    test(acctInterval.(AcctInterimInterval))\n}\n</code></pre>\n\n<p>Associated playground: <a href=\"https://play.golang.org/p/tTW5J2FIAy3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tTW5J2FIAy3</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1555498437, "post_id": 55725635, "comment_id": 98130548, "body": "<a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#NullString</a>"}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 11148310, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WSzG8ZG32wk/AAAAAAAAAAI/AAAAAAAAADg/pGZQyyRr8S0/photo.jpg?sz=128", "display_name": "\u0414\u043c\u0438\u0442\u0440\u043e \u042f\u043d\u043a\u043e\u0432\u0441\u044c\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/11148310/%d0%94%d0%bc%d0%b8%d1%82%d1%80%d0%be-%d0%af%d0%bd%d0%ba%d0%be%d0%b2%d1%81%d1%8c%d0%ba%d0%b8%d0%b9"}, "is_accepted": false, "score": 3, "last_activity_date": 1555501574, "last_edit_date": 1555501574, "creation_date": 1555501231, "answer_id": 55726765, "question_id": 55725635, "link": "https://stackoverflow.com/questions/55725635/how-to-check-null-string-type-with-go/55726765#55726765", "title": "How to check null string type with go?", "body": "<p>You should pay your attention on sql types: <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#NullString</a></p>\n\n<p>Just use variable with this type in your select statement:</p>\n\n<pre><code>var yourstr sql.NullString\ndb.Select(\"Select your string\", &amp;yourstr)\n</code></pre>\n\n<p>Then you could check if it is valid and if it is not you could assign any value you want:</p>\n\n<pre><code>if !yourstr.Valid{\n  yourstr.String = \"\"\n}\n</code></pre>\n\n<p>In gorm also is a function to select NullString:</p>\n\n<pre><code>yourstr := dbmap.SelectNullStr(\"Select your string\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 1, "last_activity_date": 1555509886, "last_edit_date": 1555509886, "creation_date": 1555509147, "answer_id": 55729135, "question_id": 55725635, "link": "https://stackoverflow.com/questions/55725635/how-to-check-null-string-type-with-go/55729135#55729135", "title": "How to check null string type with go?", "body": "<p>You can also use a pointer to string to map NULL values from the database, but this will create cases where you cannot give values without creating a variable first. </p>\n\n<pre><code>var name *string\nif name != nil {\n  //\n}\n\n// but\nname = \"will not work\"\n</code></pre>\n\n<p>Or you could use the <code>github.com/go-sql-driver/mysql</code>(or whatever driver you are using) and <code>database/sql</code> package implementations.\nYou can define your own types based on those if you want to add functionality:</p>\n\n<pre><code>// NullInt64 is an alias for sql.NullInt64 data type\ntype NullInt64 sql.NullInt64\n// NullBool is an alias for sql.NullBool data type\ntype NullBool sql.NullBool\n// NullFloat64 is an alias for sql.NullFloat64 data type\ntype NullFloat64 sql.NullFloat64\n// NullString is an alias for sql.NullString data type\ntype NullString sql.NullString\n// NullTime is an alias for mysql.NullTime data type\ntype NullTime mysql.NullTime\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8183, "favorite_count": 0, "accepted_answer_id": 55729135, "answer_count": 2, "score": -4, "last_activity_date": 1555509886, "creation_date": 1555497513, "question_id": 55725635, "link": "https://stackoverflow.com/questions/55725635/how-to-check-null-string-type-with-go", "title": "How to check null string type with go?", "body": "<p>DB:</p>\n\n<pre><code>column: name\nvalue: NULL\n</code></pre>\n\n<p>Get the record from DB with gorm, then</p>\n\n<pre><code>var name string\nif name != nil {\n  //\n}\n</code></pre>\n\n<p>Got error:</p>\n\n<pre><code>invalid operation: name != nil (mismatched types string and nil)\n</code></pre>\n\n<p>Yes, nil is using for int type in go, but this case, the value in DB is <code>NULL</code> but not <code>\"\"</code>, so it's necessary to check <code>null</code>, how to do?</p>\n"}, {"tags": ["mongodb", "go", "mgo", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 1613, "user_id": 5013336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d627dbf935d8dcb71c8eff8a223e97cc?s=128&d=identicon&r=PG", "display_name": "Arka Mukherjee", "link": "https://stackoverflow.com/users/5013336/arka-mukherjee"}, "is_accepted": true, "score": 1, "last_activity_date": 1582967749, "last_edit_date": 1582967749, "creation_date": 1555497594, "answer_id": 55725657, "question_id": 55725327, "link": "https://stackoverflow.com/questions/55725327/using-findandmodify-to-run-queries-in-the-official-mongo-go-driver/55725657#55725657", "title": "Using FindAndModify to run queries in the official Mongo Go Driver", "body": "<p>I was able to solve this using the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.FindOneAndUpdate\" rel=\"nofollow noreferrer\">FindOneAndUpdate</a> API.</p>\n\n<p>It internally uses <code>FindAndModify</code>, even though it is not explicitly mentioned in the documentations. Code I used to emulate this feature of Mgo in Go's Mongo Driver is as follows:</p>\n\n<pre><code>MongoSession, err := mongo.NewClient(options.Client().ApplyURI(\"mongodb://localhost:27017\"))\nif err != nil {\n    panic(err)\n}\nctx, _ := context.WithTimeout(context.Background(), 10*time.Second)\nerr = MongoSession.Connect(ctx)\ncollection := MongoSession.Database(\"test\").Collection(\"people\")\na, err := primitive.ObjectIDFromHex(\"XXXXXXXXXX\") //hiding hex value\nb := collection.FindOneAndUpdate(ctx, bson.M{\"_id\": a}, bson.M{\"$set\": bson.M{\"phone\": \"Replacing using the query\"}})\n</code></pre>\n\n<p>Edit (29/02/20): It looks like after this answer, the MongoDB Engineers have updated the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">documentation</a> about the MongoDB functionality being used. The documentation now states that <code>FindOneAndUpdate</code> uses the <code>findAndModify</code> operation. </p>\n"}], "owner": {"reputation": 1613, "user_id": 5013336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d627dbf935d8dcb71c8eff8a223e97cc?s=128&d=identicon&r=PG", "display_name": "Arka Mukherjee", "link": "https://stackoverflow.com/users/5013336/arka-mukherjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 1, "accepted_answer_id": 55725657, "answer_count": 1, "score": 1, "last_activity_date": 1582967749, "creation_date": 1555496379, "question_id": 55725327, "link": "https://stackoverflow.com/questions/55725327/using-findandmodify-to-run-queries-in-the-official-mongo-go-driver", "title": "Using FindAndModify to run queries in the official Mongo Go Driver", "body": "<p>In the community driven Mongo driver for Go, i.e. Mgo, we can use the <code>Apply</code> API call to run MongoDB queries involving <code>$set</code> or <code>$inc</code>. An example of this use-case in Mgo is as follows: </p>\n\n<pre><code>change := mgo.Change{\n    Update:    bson.M{\"$set\": bson.M{\"phone\": \"+55 53 8402 8510\"}},\n    ReturnNew: true,\n}\n_, err = MongoSession.DB(\"test\").C(\"people\").Find(bson.M{\"_id\": a}).Apply(change, &amp;result)\n</code></pre>\n\n<p>Quoting the official <a href=\"https://godoc.org/labix.org/v2/mgo#Query.Apply\" rel=\"nofollow noreferrer\">documentation</a> for this API call:</p>\n\n<blockquote>\n  <p>Apply runs the findAndModify MongoDB command, which allows updating,\n  upserting or removing a document matching a query and atomically\n  returning either the old version (the default) or the new version of\n  the document (when ReturnNew is true).</p>\n</blockquote>\n\n<p>I am currently working on porting a project from <a href=\"https://godoc.org/labix.org/v2/mgo\" rel=\"nofollow noreferrer\">Mgo</a> to the <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">official Mongo Go driver</a>. However, I am unable to find any method that runs the findAndModify command to achieve a similar use-case. For replacing the Apply API with a relevant method from the official driver, what would be the recommended approach?  </p>\n\n<p>I have considered examining the query under 'Update' in the existing code, and manually using the Find/Update/Replace methods provided in the official driver. But, would there be any better way to do the same? </p>\n"}, {"tags": ["powershell", "docker", "go", "docker-for-windows"], "comments": [{"owner": {"reputation": 155, "user_id": 1903983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b1QfP.jpg?s=128&g=1", "display_name": "semaph0r", "link": "https://stackoverflow.com/users/1903983/semaph0r"}, "edited": false, "score": 0, "creation_date": 1555924289, "post_id": 55724685, "comment_id": 98253087, "body": "Just a quick info for users trying to interface windows containers using powershell. The <code>nanoserver</code> docker image does not include powershell. I used <code>servercore</code>."}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 1903983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b1QfP.jpg?s=128&g=1", "display_name": "semaph0r", "link": "https://stackoverflow.com/users/1903983/semaph0r"}, "edited": false, "score": 0, "creation_date": 1555890072, "post_id": 55783894, "comment_id": 98245680, "body": "Thank you for your example. But, is there something missing? <code>func (cli *Client) ContainerExecAttach(ctx context.Context, execID string, config types.ExecStartCheck) (types.HijackedResponse, error)</code> says that the configuration is of type <code>ExecStartCheck</code>. In the above example a config of type <code>ExecConfig</code> is passed."}, {"owner": {"reputation": 6303, "user_id": 4680436, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yAD2X.jpg?s=128&g=1", "display_name": "aristotll", "link": "https://stackoverflow.com/users/4680436/aristotll"}, "reply_to_user": {"reputation": 155, "user_id": 1903983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b1QfP.jpg?s=128&g=1", "display_name": "semaph0r", "link": "https://stackoverflow.com/users/1903983/semaph0r"}, "edited": false, "score": 1, "creation_date": 1555901717, "post_id": 55783894, "comment_id": 98247311, "body": "@semaph0r In my docker client version <i>docker v1.13.1</i>, it is <code>func (cli *Client) ContainerExecAttach(ctx context.Context, execID string, config types.ExecConfig) (types.HijackedResponse, error) { </code>, of course you can modify the code to satisfy your api version need."}, {"owner": {"reputation": 155, "user_id": 1903983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b1QfP.jpg?s=128&g=1", "display_name": "semaph0r", "link": "https://stackoverflow.com/users/1903983/semaph0r"}, "edited": false, "score": 0, "creation_date": 1555924139, "post_id": 55783894, "comment_id": 98253031, "body": "Thank you for your comment. I have added <code>execConfig := types.ExecStartCheck{Tty: false, Detach: false}</code> and passed it to <code>ContainerExecAttach</code>.  Good job, thank you for your work. This bounty is well deserved!"}], "tags": [], "owner": {"reputation": 6303, "user_id": 4680436, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yAD2X.jpg?s=128&g=1", "display_name": "aristotll", "link": "https://stackoverflow.com/users/4680436/aristotll"}, "is_accepted": true, "score": 1, "last_activity_date": 1555859030, "creation_date": 1555859030, "answer_id": 55783894, "question_id": 55724685, "link": "https://stackoverflow.com/questions/55724685/execute-powershell-command-in-running-container-via-docker-api/55783894#55783894", "title": "Execute powershell command in running container via Docker API", "body": "<p>The HijackedResponse struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type HijackedResponse struct {\n    Conn   net.Conn\n    Reader *bufio.Reader\n}\n\n\n</code></pre>\n\n<p>You need to copy the response from the <code>resp.Reader</code>,here is my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"fmt\"\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/client\"\n    \"github.com/docker/docker/pkg/stdcopy\"\n    \"strings\"\n)\n\nfunc readFromCommand() (string, error) {\n    cli, err := client.NewEnvClient()\n    if err != nil {\n        return \"\", err\n    }\n    ctx := context.Background()\n    config := types.ExecConfig{\n        Cmd:          strings.Split(\"powershell Get-PSDrive C | Select-Object Used,Free\", \" \"),\n        AttachStdout: true,\n        AttachStderr: true,\n    }\n    response, err := cli.ContainerExecCreate(ctx,\n        // container id\n        \"cf59d65ab1\", config)\n    if err != nil {\n        return \"\", err\n    }\n    execID := response.ID\n\n    resp, err := cli.ContainerExecAttach(ctx, execID, config)\n    if err != nil {\n        return \"\", err\n    }\n    defer resp.Close()\n    stdout := new(bytes.Buffer)\n    stderr := new(bytes.Buffer)\n    _, err = stdcopy.StdCopy(stdout, stderr, resp.Reader)\n    if err != nil {\n        return \"\", err\n    }\n    s := stdout.String()\n    fmt.Println(s)\n    i := stderr.String()\n    fmt.Println(i)\n    return s, nil\n\n}\n\n</code></pre>\n\n<p>Do remember to change the container id.</p>\n"}], "owner": {"reputation": 155, "user_id": 1903983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b1QfP.jpg?s=128&g=1", "display_name": "semaph0r", "link": "https://stackoverflow.com/users/1903983/semaph0r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1167, "favorite_count": 3, "accepted_answer_id": 55783894, "answer_count": 1, "score": 2, "last_activity_date": 1555859030, "creation_date": 1555494414, "last_edit_date": 1555717924, "question_id": 55724685, "link": "https://stackoverflow.com/questions/55724685/execute-powershell-command-in-running-container-via-docker-api", "title": "Execute powershell command in running container via Docker API", "body": "<p>I want to execute a powershell command in a docker container running on a windows host.</p>\n\n<p>The specific command I want to execute is <code>\"powershell Get-PSDrive C | Select-Object Used,Free\"</code></p>\n\n<p>I have implemented this using the Docker API for python and it is simple like calling:</p>\n\n<pre><code>cmd = \"powershell Get-PSDrive C | Select-Object Used,Free\"\noutput = container.exec_run(cmd)\n</code></pre>\n\n<p>This works as intended, but I need to implement this in golang.</p>\n\n<p>But somehow, it is not clear for me how to interact with the Docker API for golang. I looked into the API and was confused by the <code>hijackedSession</code>. How do I have to setup the calls for <code>ContainerExecCreate</code>, <code>ContainerExecAttach</code> and <code>ContainerExecStart</code> ?</p>\n\n<p>I expect the golang script to deliver the same results like the python code does:</p>\n\n<pre><code>        Used         Free\n        ----         ----\n199181606912 307151622144\n</code></pre>\n\n<p>Which then can be parsed by me.</p>\n"}, {"tags": ["go", "concurrency", "grpc", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": 1, "last_activity_date": 1555514618, "creation_date": 1555514618, "answer_id": 55731074, "question_id": 55720390, "link": "https://stackoverflow.com/questions/55720390/concurreny-modelin-grpc-server-in-golang/55731074#55731074", "title": "Concurreny modelin grpc server in golang", "body": "<blockquote>\n  <p>When a new gRPC call comes, does server create a new goroutine?</p>\n</blockquote>\n\n<p>Yes, and it's highly likely that it creates a lot of concurrent goroutines to handle every connection and request (especially streaming request).</p>\n\n<blockquote>\n  <p>What data is shared by these goroutines?</p>\n</blockquote>\n\n<p>I think this question is too broad. There are too much code both in <code>net/http2</code> and <code>google.golang.org/grpc</code> packages to answer your question without deep investigation. However, we can be sure, that these goroutines share at least the server itself, because <a href=\"https://github.com/golang/net/blob/release-branch.go1.12/http2/server.go#L316\" rel=\"nofollow noreferrer\"><code>ServeConn</code></a> is not a free function, but a method defined on <code>http2.Server</code> type.</p>\n"}], "owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555514618, "creation_date": 1555478441, "last_edit_date": 1555513863, "question_id": 55720390, "link": "https://stackoverflow.com/questions/55720390/concurreny-modelin-grpc-server-in-golang", "title": "Concurreny modelin grpc server in golang", "body": "<p>I have created a sample gRPC client and server in golang (used protobufs). I understand the concurrency model in golang. However, I am trying to understand the concurrency model in a server accepting parallel requests from same client(multiple goroutines on client side)/ multiple clients. </p>\n\n<p>More specifically:</p>\n\n<ol>\n<li>When a new gRPC call comes, does server create a new goroutine?</li>\n<li>What data is shared by these goroutines? Does <code>grpcServer.Serve</code> set the boundary for data shared across goroutines i.e. everything set before is shared? (I am thinking of threads in Java where the threads share global data)</li>\n</ol>\n"}, {"tags": ["go", "bson"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1555480991, "post_id": 55719948, "comment_id": 98121357, "body": "Yes, there is. This is a problem for which a optimal solution was claimed a few days ago: David Harvey, Joris Van Der Hoeven. Integer multiplication in time O(n log n). 2019. &lt;hal-02070778&gt; But this solution is probably a) not useful for your code and b) out of your reach. You probably should peek into package math/big which uses non-optimal but fast multiplication (Karatsuba)."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1555492316, "post_id": 55719948, "comment_id": 98126914, "body": "What do you mean by multiplying byte arrays ?. Can you give an example of your input and output."}, {"owner": {"reputation": 9, "user_id": 11371735, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3ae5k_Qn17s/AAAAAAAAAAI/AAAAAAAAER4/WVRQC0dDwQ0/photo.jpg?sz=128", "display_name": "Lynx", "link": "https://stackoverflow.com/users/11371735/lynx"}, "edited": false, "score": 0, "creation_date": 1555510780, "post_id": 55719948, "comment_id": 98138371, "body": "I edited my question for more description and example."}], "owner": {"reputation": 9, "user_id": 11371735, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3ae5k_Qn17s/AAAAAAAAAAI/AAAAAAAAER4/WVRQC0dDwQ0/photo.jpg?sz=128", "display_name": "Lynx", "link": "https://stackoverflow.com/users/11371735/lynx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 322, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555510742, "creation_date": 1555475591, "last_edit_date": 1555510742, "question_id": 55719948, "link": "https://stackoverflow.com/questions/55719948/is-there-more-efficient-way-of-multiplying-byte-array", "title": "Is there more efficient way of multiplying byte array?", "body": "<p>I developed a Golang package <a href=\"https://github.com/GoblinBear/beson-go\" rel=\"nofollow noreferrer\">BESON</a> for doing operation of big number.</p>\n\n<p>The <a href=\"https://github.com/GoblinBear/beson-go/blob/master/helper/misc.go#L266\" rel=\"nofollow noreferrer\">Multiply</a> operation code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Multiply(a []byte, b []byte) {\n    ans := make([]byte, len(a) + len(b))\n    bits := nbits(b)\n\n    var i uint\n    for i = bits - 1; int(i) &gt;= 0; i-- {\n        byteNum := i &gt;&gt; 3\n        bitNum := i &amp; 7\n\n        LeftShift(ans, 1, 0)\n        if (b[byteNum] &amp; (1 &lt;&lt; bitNum)) &gt; 0 {\n            Add(ans, a)\n        }\n    }\n    copy(a, ans)\n}\n</code></pre>\n\n<p>My way is to add every <code>a</code> multiply <strong>bits</strong> of <code>b</code>.\nIs there more efficient way to implement <code>Multiply</code>?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>The <a href=\"https://github.com/GoblinBear/beson-go\" rel=\"nofollow noreferrer\">BESON</a> package represent a big number in byte array. For example, it represent a 128-bit unsigned interger in an byte array of size 16. Therefore, when doing two 128-bit unsigned interger multiplying, it's actually multiplying two byte array.</p>\n\n<p>Example:</p>\n\n<ul>\n<li>input: <code>a</code>, <code>b</code></li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>a = []byte{ 204, 19, 46, 255, 0, 0, 0, 0 }\nb = []byte{ 117, 10, 68, 47, 0, 0, 0, 0 }\nMultiply(a, b)\nfmt.Println(a)\n</code></pre>\n\n<ul>\n<li>output: <code>a</code> (The result will write back to <code>a</code>)</li>\n</ul>\n\n<pre class=\"lang-sh prettyprint-override\"><code>[60 4 5 35 76 72 29 47]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 5772365, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e114544cf6b0a39de7e4df2a2d9a0c65?s=128&d=identicon&r=PG", "display_name": "gaoxinge", "link": "https://stackoverflow.com/users/5772365/gaoxinge"}, "edited": false, "score": 0, "creation_date": 1555476195, "post_id": 55719939, "comment_id": 98119828, "body": "So <code>a := int8(0xfc)</code> equals to the <code>var a int8 = 0xfc</code> in compile&#39;s opinion, and <code>int8</code> can not hold the information of <code>252</code>, so compile raises an error?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 333, "user_id": 5772365, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e114544cf6b0a39de7e4df2a2d9a0c65?s=128&d=identicon&r=PG", "display_name": "gaoxinge", "link": "https://stackoverflow.com/users/5772365/gaoxinge"}, "edited": false, "score": 0, "creation_date": 1555476326, "post_id": 55719939, "comment_id": 98119878, "body": "Yes it equals to <code>var a int8 = 252</code>, int8 has range -128 through 127,   but you really need: <code>var a int8 = -4</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555476577, "post_id": 55719939, "comment_id": 98119941, "body": "<code>int8(0xfc)</code> is a typed <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a>.  Values of typed constants must always be accurately representable by values of the constant type.  The value 252 cannot be represented by the values of int8."}, {"owner": {"reputation": 333, "user_id": 5772365, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e114544cf6b0a39de7e4df2a2d9a0c65?s=128&d=identicon&r=PG", "display_name": "gaoxinge", "link": "https://stackoverflow.com/users/5772365/gaoxinge"}, "edited": false, "score": 0, "creation_date": 1555476841, "post_id": 55719939, "comment_id": 98120011, "body": "@A.R My actual demand is to convert a <code>byte</code> to <code>int32</code> when parsing a binary file. I may encounter the constant byte <code>0xfc</code>,  and should transfer it to the <code>int8</code> before converting it to the <code>int32</code> with the consideration of sign.So <code>var a int8 = -4</code> may not be what I need."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 6, "last_activity_date": 1555477362, "last_edit_date": 1592644375, "creation_date": 1555475528, "answer_id": 55719939, "question_id": 55719813, "link": "https://stackoverflow.com/questions/55719813/confusion-about-convert-uint8-to-int8/55719939#55719939", "title": "confusion about convert `uint8` to `int8`", "body": "<ol>\n<li>see: <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Constant_expressions</a></li>\n</ol>\n<blockquote>\n<p>The values of typed constants must always be accurately representable by values of the constant type. The following constant expressions are illegal:</p>\n</blockquote>\n<pre><code>uint(-1)     // -1 cannot be represented as a uint\nint(3.14)    // 3.14 cannot be represented as an int\nint64(Huge)  // 1267650600228229401496703205376 cannot be represented as an int64\nFour * 300   // operand 300 cannot be represented as an int8 (type of Four)\nFour * 100   // product 400 cannot be represented as an int8 (type of Four)\n</code></pre>\n<ol start=\"2\">\n<li>see:\n<a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">https://blog.golang.org/constants</a></li>\n</ol>\n<blockquote>\n<p>not all integer values can fit in all integer types. There are two problems that might arise: the value might be too large, or it might be a negative value being assigned to an unsigned integer type. For instance, int8 has range -128 through 127, so constants outside of that range can never be assigned to a variable of type int8:<br />\n<code>var i8 int8 = 128 // Error: too large.</code><br />\nSimilarly, uint8, also known as byte, has range 0 through 255, so a large or negative constant cannot be assigned to a uint8:<br />\n<code>var u8 uint8 = -1 // Error: negative value.</code><br />\nThis type-checking can catch mistakes like this one:</p>\n<pre><code>    type Char byte\n    var c Char = '\u4e16' // Error: '\u4e16' has value 0x4e16, too large. \n</code></pre>\n<p>If the compiler complains about your use of a constant, it's likely a real bug like this.</p>\n</blockquote>\n<hr />\n<blockquote>\n<p>My actual demand is to convert a <code>byte</code> to <code>int32</code> when parsing a binary file. I may encounter the constant byte <code>0xfc</code>, and should transfer it to the <code>int8</code> before converting it to the <code>int32</code> with the consideration of sign.</p>\n</blockquote>\n<p>Yes, this is the way to go:</p>\n<pre><code>\n    var b byte = 0xff\n    i32 := int32(int8(b))\n    fmt.Println(i32) // -1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1555478477, "last_edit_date": 1555478477, "creation_date": 1555477394, "answer_id": 55720255, "question_id": 55719813, "link": "https://stackoverflow.com/questions/55719813/confusion-about-convert-uint8-to-int8/55720255#55720255", "title": "confusion about convert `uint8` to `int8`", "body": "<blockquote>\n  <p>Is there any difference between these two codes?</p>\n</blockquote>\n\n<p>The first example uses a <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a>. The second uses plain expressions.  Constant expressions are evaluated at compile time with different rules from plain expressions. </p>\n\n<blockquote>\n  <p>Why does the first one raise a compile error?</p>\n</blockquote>\n\n<p>The <code>int8(0xfc)</code> is a typed <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a>. Values of typed constants must always be accurately representable by values of the constant type. The compiler reports an error because the value 252 cannot be represented by the values of <code>int8</code>. </p>\n\n<p>Based on comments on other answers, I see that the goal is to get an <code>int32</code> from a byte with sign extension. Given a byte variable <code>b</code>, use the expression <code>int32(int8(b))</code> to get the <code>int32</code> value with sign extension.</p>\n"}], "owner": {"reputation": 333, "user_id": 5772365, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e114544cf6b0a39de7e4df2a2d9a0c65?s=128&d=identicon&r=PG", "display_name": "gaoxinge", "link": "https://stackoverflow.com/users/5772365/gaoxinge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3946, "favorite_count": 3, "accepted_answer_id": 55719939, "answer_count": 2, "score": 4, "last_activity_date": 1555478477, "creation_date": 1555474793, "last_edit_date": 1555476600, "question_id": 55719813, "link": "https://stackoverflow.com/questions/55719813/confusion-about-convert-uint8-to-int8", "title": "confusion about convert `uint8` to `int8`", "body": "<p>I want to convert <code>uint8</code> to <code>int</code>, so I write a const <code>0xfc</code>, and try to use <code>int8(0xfc)</code> to convert it. However the code raises an error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := int8(0xfc)  // compile error: constant 252 overflows int8\n    b := a\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>But if I defer the type conversion after assignment, the code can work around.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := 0xfc\n    b := int8(a)  // ok\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>My question: </p>\n\n<ul>\n<li>Is there any difference between these two codes?</li>\n<li>Why does the first one raise a compile error?</li>\n</ul>\n"}, {"tags": ["if-statement", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1555476103, "last_edit_date": 1555476103, "creation_date": 1555474958, "answer_id": 55719837, "question_id": 55719789, "link": "https://stackoverflow.com/questions/55719789/conditional-check-with-and-and-or-is-failing/55719837#55719837", "title": "Conditional check with AND and OR is failing", "body": "<p>See the <a href=\"https://golang.org/ref/spec#Operator_precedence\" rel=\"nofollow noreferrer\">operator precedence section of the specification</a>.  The <code>&amp;&amp;</code> operator has higher precedence than <code>||</code>.  The parentheses are required to get the grouping you intended.</p>\n\n<p>A type assertion is not needed when comparing a value to an <code>interface{}</code>. If <code>action</code> is one of the specified values, then it follows that <code>action != nil</code>.  Using these observations, simplify the code to:</p>\n\n<pre><code>if operationType == string(VNFHealthCheck) &amp;&amp; (action == CollectAlaramAddToReport || action == CollectResourcesAddCounters) {\n        fmt.Printf(\"Hello, playground %T\\n\", action)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": true, "score": 1, "last_activity_date": 1555475370, "creation_date": 1555475370, "answer_id": 55719906, "question_id": 55719789, "link": "https://stackoverflow.com/questions/55719789/conditional-check-with-and-and-or-is-failing/55719906#55719906", "title": "Conditional check with AND and OR is failing", "body": "<p>the <code>&amp;&amp;</code> has higher precedence than <code>||</code></p>\n\n<p>in the first condition, </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>operationType == string(VNFHealthCheck) &amp;&amp; action != nil &amp;&amp; action.(ActionType) == CollectAlaramAddToReport || action.(ActionType) == CollectResourcesAddCounters\n</code></pre>\n\n<p>cause <code>action</code> is <code>nil</code>, the condition becomes <code>false || action.(ActionType) == CollectResourcesAddCounters</code>. the <code>nil</code> cast trigger the panic</p>\n\n<p>the second condition becomes <code>false &amp;&amp; (action.(ActionType) == CollectAlaramAddToReport || action.(ActionType) == CollectResourcesAddCounters)</code>. cause the <code>false</code> short circuit the expression, the cast won't be executed. </p>\n"}], "owner": {"reputation": 122, "user_id": 2728010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf368fa3f6bd958386a88440864b6330?s=128&d=identicon&r=PG&f=1", "display_name": "sks", "link": "https://stackoverflow.com/users/2728010/sks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 55719906, "answer_count": 2, "score": 0, "last_activity_date": 1555476103, "creation_date": 1555474615, "question_id": 55719789, "link": "https://stackoverflow.com/questions/55719789/conditional-check-with-and-and-or-is-failing", "title": "Conditional check with AND and OR is failing", "body": "<p>I am trying to combine few conditional check</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype ActionType string\n\nconst (\n    VNFHealthCheck ActionType = \"vnf-health-check\"\n    CollectAlaramAddToReport    ActionType = \"write-initial-report\"\n    CollectResourcesAddCounters ActionType = \"abc\"\n)\n\nfunc main() {\n    var action, operationType interface{}\n    action = nil\n    operationType = \"vnf-health-check\"\n    if operationType == string(VNFHealthCheck) &amp;&amp; action != nil &amp;&amp; action.(ActionType) == CollectAlaramAddToReport {\n        fmt.Println(\"Type is \", reflect.TypeOf(action))\n    }\n}\n</code></pre>\n\n<p>The above code does not print anything as <strong>action != nil</strong> check fails.</p>\n\n<p>But when if condition changes to</p>\n\n<pre><code>if operationType == string(VNFHealthCheck) &amp;&amp; action != nil &amp;&amp; action.(ActionType) == CollectAlaramAddToReport || action.(ActionType) == CollectResourcesAddCounters {\n        fmt.Println(\"Hello, playground\", reflect.TypeOf(action))\n    }\n</code></pre>\n\n<p>Panic is seen with message\n<strong>panic: interface conversion: interface {} is nil, not main.ActionType</strong></p>\n\n<p>If condition check works fine after adding <em>()</em> around OR condition </p>\n\n<pre><code>if operationType == string(VNFHealthCheck) &amp;&amp; action != nil &amp;&amp; (action.(ActionType) == CollectAlaramAddToReport || action.(ActionType) == CollectResourcesAddCounters) {\n        fmt.Println(\"Hello, playground\", reflect.TypeOf(action))\n    }\n</code></pre>\n\n<p>What could be cause of the behavior.? I couldn't find any explanation.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1555471843, "post_id": 55719270, "comment_id": 98118868, "body": "A channel operation on an unbuffered channel blocks until both the sender and receiver are ready. Case #1 blocks sending to <code>lines</code> because there is no ready receiver.  Because the goroutine is blocked, the code will not execute the receive on <code>lines</code>. Deadlock. Panic. Boom! Possible duplicate of <a href=\"https://stackoverflow.com/questions/36505012/go-fatal-error-all-goroutines-are-asleep-deadlock\">Go: fatal error: all goroutines are asleep - deadlock</a>."}], "answers": [{"tags": [], "owner": {"reputation": 578, "user_id": 1471022, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/ff4eff176220cdcd4892a3777ad52ccd?s=128&d=identicon&r=PG", "display_name": "Kishore Karunakaran", "link": "https://stackoverflow.com/users/1471022/kishore-karunakaran"}, "is_accepted": false, "score": 1, "last_activity_date": 1555472796, "creation_date": 1555472796, "answer_id": 55719573, "question_id": 55719270, "link": "https://stackoverflow.com/questions/55719270/go-reading-a-file-goroutine-deadlock/55719573#55719573", "title": "Go: Reading a file, goroutine deadlock", "body": "<p>The sender blocks until the receiver has received the value in unbuffered channel.</p>\n\n<p>In unbuffered channel writing to channel will not happen until there must be some receiver which is waiting to receive the data.</p>\n\n<p>For Example:</p>\n\n<pre><code>queue := make(chan string)\nqueue &lt;- \"one\" /* Here main function which is also a goroutine is blocked, because\nthere is no goroutine to receive the channel value, hence the deadlock*/\nclose(queue)\nfor elem := range queue {\n    fmt.Println(elem)\n}\n</code></pre>\n\n<p>This will leads to deadlock and it is exactly what happened in your <strong>Case #1</strong> code.</p>\n\n<p>Now In case where we have other go routine</p>\n\n<pre><code>queue := make(chan string)\ngo func() {\n    queue &lt;- \"one\" \n    close(queue)\n}()\nfor elem := range queue {\n    fmt.Println(elem)\n}\n</code></pre>\n\n<p>This will work because main go routine is waiting for the data to be consumed before writes happen to unbuffered channel.</p>\n\n<p>This is exactly happen in your <strong>Case #2</strong></p>\n\n<p>So in short, writes to unbuffered channel happens only when there is some routine waiting to read from channel, else the write operation is blocked forever and leads to deadlock.</p>\n"}], "owner": {"reputation": 11, "user_id": 11371553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_j0ep2IXTGQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdn6zknGmAfflxHNOPqPTgMwoG6Gw/mo/photo.jpg?sz=128", "display_name": "critonix", "link": "https://stackoverflow.com/users/11371553/critonix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555472796, "creation_date": 1555470222, "question_id": 55719270, "link": "https://stackoverflow.com/questions/55719270/go-reading-a-file-goroutine-deadlock", "title": "Go: Reading a file, goroutine deadlock", "body": "<p>I have two sets of code - to read a file with random lines of text, and load each line to a channel. I am unable to understand why one returns an error. but the other doesn't. Case #1 returns \"fatal error: all goroutines are asleep - deadlock!\" but Case # works.</p>\n\n<h2>Case #1</h2>\n\n<p>func main () {</p>\n\n<pre><code>file, err := os.Open(\"/Users/sample/Downloads/wordlist\")\nif err != nil {\n    log.Fatal(err)\n}\nlines := make (chan string)\nscanner := bufio.NewScanner(file)\nfor scanner.Scan() {\n    lines &lt;- scanner.Text()\n}\nclose(lines)\n\nfor line := range (lines) {\n    fmt.Println(line)\n}\n</code></pre>\n\n<p>}</p>\n\n<h2>Case #2</h2>\n\n<p>func main () {</p>\n\n<pre><code>file, err := os.Open(\"/Users/sample/Downloads/wordlist\") \nif err != nil {\n    log.Fatal(err)\n}\nlines := make (chan string)\ngo func() {\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        lines &lt;- scanner.Text()\n    }\n    close(lines)\n}()\n\nfor line := range (lines) {\n    fmt.Println(line)\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["ubuntu", "go", "windows-subsystem-for-linux", "goland"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1555470100, "last_edit_date": 1555470100, "creation_date": 1555469640, "answer_id": 55719215, "question_id": 55719071, "link": "https://stackoverflow.com/questions/55719071/how-to-development-go-app-using-wsl-ubuntu-bash-in-win-10/55719215#55719215", "title": "How to development Go App using WSL Ubuntu Bash in Win 10", "body": "<blockquote>\n  <p><a href=\"https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-windows-10-version-1903/\" rel=\"nofollow noreferrer\">What\u2019s new for WSL in Windows 10 version 1903?</a></p>\n  \n  <p>Craig Loewen</p>\n  \n  <p>Craig</p>\n  \n  <p>February 15th, 2019</p>\n  \n  <p>The next Windows update is coming soon and we\u2019re bringing exciting new\n  updates to WSL with it! These include accessing the Linux file system\n  from Windows, and improvements to how you manage and configure your\n  distros in the command line.</p>\n  \n  <p>Accessing Linux files from Windows</p>\n  \n  <p>In the past, creating and changing Linux files from Windows resulted\n  in losing files or corrupting data. Making this possible has been a\n  highly requested and long anticipated feature. We\u2019re proud to announce\n  you can now easily access all the files in your Linux distros from\n  Windows.</p>\n  \n  <p>... you can access whatever Linux files you would like, just like you\n  would any other file through File explorer. This includes operations\n  such as: dragging files back and forth to other locations, copy and\n  paste, and even interesting scenarios like using the context menu to\n  open VSCode in a WSL directory!</p>\n  \n  <p>Craig Loewen</p>\n  \n  <p>Program Manager, Windows Developer Platform</p>\n</blockquote>\n\n<hr>\n\n<p>If you are impatient and you can tolerate the loss of privacy, consider using the Windows Insider program releases.</p>\n\n<hr>\n\n<blockquote>\n  <p>April 4, 2019 9:00 am</p>\n  \n  <p><a href=\"https://blogs.windows.com/windowsexperience/2019/04/04/improving-the-windows-10-update-experience-with-control-quality-and-transparency/\" rel=\"nofollow noreferrer\">Improving the Windows 10 update experience with control, quality and\n  transparency</a></p>\n  \n  <p>By Mike Fortin / Corporate Vice President, Windows </p>\n  \n  <p>I\u2019m pleased to announce that the Windows 10 May 2019 Update will start\n  to be available next week in the Release Preview Ring for those in the\n  Windows Insider Program.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1455, "user_id": 542271, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d240821bb9eccc63133cff302670a3a8?s=128&d=identicon&r=PG", "display_name": "dmotta", "link": "https://stackoverflow.com/users/542271/dmotta"}, "edited": false, "score": 0, "creation_date": 1557201509, "post_id": 55740797, "comment_id": 98674687, "body": "Good output, I been reached similar option below"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 1, "last_activity_date": 1555571262, "creation_date": 1555571262, "answer_id": 55740797, "question_id": 55719071, "link": "https://stackoverflow.com/questions/55719071/how-to-development-go-app-using-wsl-ubuntu-bash-in-win-10/55740797#55740797", "title": "How to development Go App using WSL Ubuntu Bash in Win 10", "body": "<blockquote>\n  <p>The issue I see going is where to keep my GOPATH (Golang workspace) and all src code. One of the main limitations with WSL is that you cannot modify files from the linux subsystem within Windows, so keeping my GOPATH under the linux subsystem and editing using Goland or VS Code on Windows won't work.</p>\n</blockquote>\n\n<p>What I do is the exact opposite.</p>\n\n<p>I keep the GOPATH in Windows, e.g. <code>D:\\go</code>, and then that's accessible via <code>/mnt/d/go</code> under WSL. I use two Go versions, one installed on Windows and one on WSL, and each environment uses their own version.</p>\n\n<p>This allows me to use GoLand for all the editing needs and I can use the built-in terminal (Alt+F12) to use the WSL prompt when needed.</p>\n"}, {"tags": [], "owner": {"reputation": 1455, "user_id": 542271, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d240821bb9eccc63133cff302670a3a8?s=128&d=identicon&r=PG", "display_name": "dmotta", "link": "https://stackoverflow.com/users/542271/dmotta"}, "is_accepted": false, "score": 3, "last_activity_date": 1557201381, "creation_date": 1557201381, "answer_id": 56015340, "question_id": 55719071, "link": "https://stackoverflow.com/questions/55719071/how-to-development-go-app-using-wsl-ubuntu-bash-in-win-10/56015340#56015340", "title": "How to development Go App using WSL Ubuntu Bash in Win 10", "body": "<blockquote>\n  <p>I keep the GOPATH in Windows, e.g. D:\\go, and then that's accessible via /mnt/d/go under WSL. I use two Go versions, one installed on Windows and one on WSL, and each environment uses their own version.</p>\n</blockquote>\n\n<p>The workaround implemented in my Alienware:</p>\n\n<pre><code> - Install WSL Ubuntu (go1.12.4 linux/amd64), JetBrains GoLand 2019.1 x64\n\n - Configure the GOPATH in Ubuntu:\n    export GOPATH=/mnt/d/dev/golang_ws\n\n - Configure the Project Goland in the folder: \"D:\\dev\\golang_ws\"\n\n - Build and Test the Golang application in WSL Ubuntu, using Ubuntu Bash.\nor \n -  IntelliJ IDEA uses cmd.exe in the terminal view by default. To replace it with the Ubuntu bash, open up the IntelliJ IDEA settings menu located under \u201cFile\u201d  &gt; Settings &gt; Tools &gt; Terminal &gt;\n   Start directory : D:/dev/golang_ws\n   Shell Path : C:\\Windows\\System32\\bash.exe\n   Tab Name: Local\n</code></pre>\n"}], "owner": {"reputation": 1455, "user_id": 542271, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d240821bb9eccc63133cff302670a3a8?s=128&d=identicon&r=PG", "display_name": "dmotta", "link": "https://stackoverflow.com/users/542271/dmotta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3519, "favorite_count": 4, "answer_count": 3, "score": 3, "last_activity_date": 1557201381, "creation_date": 1555468366, "last_edit_date": 1555468977, "question_id": 55719071, "link": "https://stackoverflow.com/questions/55719071/how-to-development-go-app-using-wsl-ubuntu-bash-in-win-10", "title": "How to development Go App using WSL Ubuntu Bash in Win 10", "body": "<p>I have a Windows 10 with WSL Ubuntu 18.04.1 LTS, I can't to install Linux on my Laptop by problems of compatibility.</p>\n\n<p>The issue I see going is where to keep my GOPATH (Golang workspace) and all src code. One of the main limitations with WSL is that you cannot modify files from the linux subsystem within Windows, so keeping my GOPATH under the linux subsystem and editing using Goland or VS Code on Windows won't work.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": 1, "last_activity_date": 1555516005, "creation_date": 1555516005, "answer_id": 55731476, "question_id": 55719053, "link": "https://stackoverflow.com/questions/55719053/find-client-name-for-grpc-call-in-go/55731476#55731476", "title": "Find client name for gRPC call in Go", "body": "<p>As an option, you can use <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md\" rel=\"nofollow noreferrer\">GRPC Metadata</a>. It's not strong typed (because it's just <code>map[string][]string</code>), but may fit your needs good. Set custom metadata field on client side and check this field in server handler.</p>\n"}, {"tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 2, "last_activity_date": 1555516414, "creation_date": 1555516414, "answer_id": 55731603, "question_id": 55719053, "link": "https://stackoverflow.com/questions/55719053/find-client-name-for-grpc-call-in-go/55731603#55731603", "title": "Find client name for gRPC call in Go", "body": "<p>You can use the <a href=\"https://godoc.org/google.golang.org/grpc#WithUserAgent\" rel=\"nofollow noreferrer\"><code>WithUserAgent</code></a> dial option to set a custom user agent string on the client.</p>\n\n<p>For retrieving the user agent on the server side, see <a href=\"https://stackoverflow.com/questions/51753461/how-can-i-get-the-client-ip-address-and-user-agent-in-golang-grpc#comment90466921_51753461\">this question</a>. It's not fully answered, but you can just print the metadata map and see how the user agent gets stored in the metadata. And then post your findings there :)</p>\n"}], "owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1555516414, "creation_date": 1555468093, "last_edit_date": 1555515830, "question_id": 55719053, "link": "https://stackoverflow.com/questions/55719053/find-client-name-for-grpc-call-in-go", "title": "Find client name for gRPC call in Go", "body": "<p>I have used protobufs to define my models and gRPC service, and generated protos for Go (.pb.go). When I make gRPC call to a service, I want to find out in server the name of the client/application calling the server API. \nCan the context parameter in the API be of any help here?</p>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 0, "last_activity_date": 1555468413, "creation_date": 1555468413, "answer_id": 55719077, "question_id": 55718920, "link": "https://stackoverflow.com/questions/55718920/is-it-possible-to-retrieve-the-sub-string-from-a-string-complex-string-in-gola/55719077#55719077", "title": "Is it possible to retrieve the sub-string from a string (complex string) in golang", "body": "<p>I couldn't post a comment, so I had to put this here...\nHave you researched regex capture groups?</p>\n\n<p>eg <a href=\"https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-golang-regular-expressions\">How to get capturing group functionality in Golang regular expressions?</a></p>\n"}, {"tags": [], "owner": {"reputation": 578, "user_id": 1471022, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/ff4eff176220cdcd4892a3777ad52ccd?s=128&d=identicon&r=PG", "display_name": "Kishore Karunakaran", "link": "https://stackoverflow.com/users/1471022/kishore-karunakaran"}, "is_accepted": true, "score": 1, "last_activity_date": 1555470802, "creation_date": 1555470802, "answer_id": 55719335, "question_id": 55718920, "link": "https://stackoverflow.com/questions/55718920/is-it-possible-to-retrieve-the-sub-string-from-a-string-complex-string-in-gola/55719335#55719335", "title": "Is it possible to retrieve the sub-string from a string (complex string) in golang", "body": "<p>Let me try to understand your problem, In the given input string, you want to find editor and sender name and also you want to extract date and time. </p>\n\n<p>As a start, You can have two regex one for matching names and one more for date and time, You could do something like this</p>\n\n<pre><code>namesRegex, _ := regexp.Compile(\"by\\\\s(.*?),(.*?)\\\\s*from\\\\s*(.*?)\\\\)\")\ndateTimeRegex, _ := regexp.Compile(\"(\\\\d{4})-(\\\\d{2})-(\\\\d{2}) (\\\\d{2}):(\\\\d{2}):(\\\\d{2})\")\ninput := \"In current chatting room: what do you eat for today? (This message is edited by Sharon, the message is sent on 2018-11-10 21:00:00 from Leon)\"\nif namesRegex.MatchString(input) {\n    res := namesRegex.FindStringSubmatch(input)\n    fmt.Println(\"Edited by = \", strings.TrimSpace(res[1]))\n    fmt.Println(\"From = \", strings.TrimSpace(res[3]))\n}\nif dateTimeRegex.MatchString(input) {\n    res := dateTimeRegex.FindAllString(input, 1)\n    fmt.Println(res[0])\n}\n</code></pre>\n\n<p><strong>Output</strong>:</p>\n\n<p>Edited by =  Sharon</p>\n\n<p>From =  Leon</p>\n\n<p>2018-11-10 21:00:00</p>\n"}], "owner": {"reputation": 168, "user_id": 7737245, "user_type": "registered", "accept_rate": 12, "profile_image": "https://lh6.googleusercontent.com/-y3mcneRr054/AAAAAAAAAAI/AAAAAAAAABM/_tJuZlnCpzQ/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/7737245/leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 55719335, "answer_count": 2, "score": 0, "last_activity_date": 1555470802, "creation_date": 1555466985, "question_id": 55718920, "link": "https://stackoverflow.com/questions/55718920/is-it-possible-to-retrieve-the-sub-string-from-a-string-complex-string-in-gola", "title": "Is it possible to retrieve the sub-string from a string (complex string) in golang", "body": "<p>I met a problem in using regular expression, two questions need to be solved, from simple to complex.\nFirstly is to use regular expression to match the string, after that it should retrieve some substrings from the message.</p>\n\n<p>like I have a string, which is</p>\n\n<p>\"In current chatting room: what do you eat for today? (This message is edited by Sharon, the message is sent on 2018-11-10 21:00:00 from Leon)\"</p>\n\n<p>\"In current chatting room: Hey mate, do you like golang? (This message is edited by Leon, the message is sent on 2018-01-10 10:00:59 from Mike)\"</p>\n\n<p>In the above message, some part will not change\nlike \"In current chatting room:\" and \"This message is edited by ..., the message is sent on ... from ...\"</p>\n\n<p>When I met this kind of message, this is considered as \"Editing Notice\"\nI need to filter all the message that compile with the structure.</p>\n\n<p>What I write is </p>\n\n<pre><code>var testRgx = regexp.MustCompile(`^In current chatting room: .* \\(This message is edited by .*, the message is sent on .* from .*\\)$`)\n</code></pre>\n\n<p>I know it is a little stupid, but at least could work</p>\n\n<p>and when I run it, the result shows it is true.</p>\n\n<pre><code>sample := \"In current chatting room: what do you eat for today? I input some shit (sdfhjskdfjksljhfdsjkdf) can you detect this? (This message is edited by Sharon, the message is sent on 2018-11-10 21:00:00 from Leon)\"\nfmt.Println(testRgx.MatchString(sample ))\n</code></pre>\n\n<p>Until now I think it is fine</p>\n\n<p>The second step is to retrieve the content, the editor, the time and the original sender. </p>\n\n<p>What I did is I replace the first part, which is \"In current chatting room: \"\nand then the string is changed to</p>\n\n<pre><code>changedString := \"what do you eat for today? I input some shit (sdfhjskdfjksljhfdsjkdf) can you detect this? (This message is edited by Sharon, the message is sent on 2018-11-10 21:00:00 from Leon)\"\n</code></pre>\n\n<p>And from the end of string, I cut the string after the last from, so I could fetch \"Leon\" out.</p>\n\n<pre><code>//after cut after from\ncutString := \"what do you eat for today? I input some shit (sdfhjskdfjksljhfdsjkdf) can you detect this? (This message is edited by Sharon, the message is sent on 2018-11-10 21:00:00 \"\n</code></pre>\n\n<p>Then cut the string after the last on to get the time.</p>\n\n<pre><code>//after cut after on\ncutString := \"what do you eat for today? I input some shit (sdfhjskdfjksljhfdsjkdf) can you detect this? (This message is edited by Sharon, the message is sent \"\n</code></pre>\n\n<p>Then the last step is to retrieve the editor out.</p>\n\n<p>I think this method is quite stupid, I have searched some example like retrieve component using regexp \n<a href=\"https://stackoverflow.com/questions/37316806/golang-extract-data-with-regex\">Golang: extract data with Regex</a></p>\n\n<p>but this is a little complex case, I think the method to retrieve component I written is quite ugly.</p>\n\n<p>Can I please ask whether there is a way to directly use regular expression to fetch the components?</p>\n\n<p>For the notice message,</p>\n\n<p>\"In current chatting room: \" will not change, the component of edited message will change, and the content inside bracket will only change the editor (Sharon), time (2018-11-10 21:00:00) and sender (Leon), other part in the bracket will not change like </p>\n\n<p>(This message is edited by xxxxx, the message is sent on xxxx from xxxx)</p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1555475817, "post_id": 55719646, "comment_id": 98119714, "body": "Yes, it is a bind mount (because it references a specific host-side path) and not a named-volume mount."}], "tags": [], "owner": {"reputation": 3497, "user_id": 606473, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fed26a79c37228a7e6b58e6a2c80e7ce?s=128&d=identicon&r=PG", "display_name": "d0c_s4vage", "link": "https://stackoverflow.com/users/606473/d0c-s4vage"}, "is_accepted": false, "score": 0, "last_activity_date": 1555473366, "creation_date": 1555473366, "answer_id": 55719646, "question_id": 55718603, "link": "https://stackoverflow.com/questions/55718603/golang-docker-library-mounting-host-directory-volumes/55719646#55719646", "title": "Golang docker library - mounting host directory volumes", "body": "<p>Removing the <code>Volumes</code> settings, adding the <code>Mounts</code> back in and changing the <code>Type</code> to <code>mount.TypeBind</code> made it work:</p>\n\n<pre><code>2019/04/16 20:53:18 Creating client\n2019/04/16 20:53:18              Image: ubuntu:18.04\n2019/04/16 20:53:18          Host Path: /home/user/go/src/test\n2019/04/16 20:53:18     Container Path: /host_files\n2019/04/16 20:53:18 Creating container\n2019/04/16 20:53:18 Starting container\n2019/04/16 20:53:19 Waiting for container to exit\n2019/04/16 20:53:19 Container exited normally!\n2019/04/16 20:53:19 Should be done!\n2019/04/16 20:53:19 Container output:\ntotal XXXX\ndrwxr-xr-x  7 1000 1000     4096 Apr 17 03:51 .\ndrwxr-xr-x 34 root root     4096 Apr 17 03:53 ..\n-rw-r--r--  1 1000 1000    10390 Apr 16 12:16 Gopkg.lock\n-rw-r--r--  1 1000 1000     1021 Apr 16 12:16 Gopkg.toml\n-rwxr-xr-x  1 1000 1000 12433827 Apr 17 03:53 container\n-rw-r--r--  1 1000 1000     2421 Apr 17 03:51 container.go\n2019/04/16 20:53:19 Cleaning up\n</code></pre>\n\n<p>Sigh.</p>\n\n<p>The only thing I'm not 100% sure about is if <code>docker -v /host/path:/container/path image:tag</code> <em>is actually</em> a bind mount, or not.</p>\n"}], "owner": {"reputation": 3497, "user_id": 606473, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fed26a79c37228a7e6b58e6a2c80e7ce?s=128&d=identicon&r=PG", "display_name": "d0c_s4vage", "link": "https://stackoverflow.com/users/606473/d0c-s4vage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 874, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555473366, "creation_date": 1555464157, "last_edit_date": 1555473067, "question_id": 55718603, "link": "https://stackoverflow.com/questions/55718603/golang-docker-library-mounting-host-directory-volumes", "title": "Golang docker library - mounting host directory volumes", "body": "<p>How do I perform the equivalent of:</p>\n\n<pre><code>docker run -v /host/path:/container/path image:tag\n</code></pre>\n\n<p>from Go using the official docker client package?</p>\n\n<p>I've tried different <a href=\"https://godoc.org/github.com/docker/docker/api/types/container#HostConfig\" rel=\"nofollow noreferrer\">Mounts</a> and <a href=\"https://godoc.org/github.com/docker/docker/api/types/container#Config\" rel=\"nofollow noreferrer\">Volumes</a> options within the HostOption and ConfigOption structs for the <a href=\"https://godoc.org/github.com/docker/docker/client#Client.ContainerCreate\" rel=\"nofollow noreferrer\">client.ContainerCreate() function</a>, but can't quite figure it out.</p>\n\n<p>In particular, the <code>Volumes</code> member (of type <code>map[string]struct{}</code>) is particularly hard to figure out how to use, and I can't find any documentation on what values are supposed to be present within the struct.</p>\n\n<p>Code to demonstrate my problem:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/api/types/container\"\n    //\"github.com/docker/docker/api/types/mount\"\n    \"github.com/docker/docker/client\"\n    \"github.com/docker/docker/pkg/stdcopy\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n)\n\nfunc getThisDir() string {\n    dir, err := filepath.Abs(filepath.Dir(os.Args[0]))\n    if err != nil {\n        panic(err)\n    }\n    return dir\n}\n\nfunc main() {\n    log.Println(\"Creating client\")\n    cli, err := client.NewClientWithOpts(client.FromEnv)\n    if err != nil {\n        panic(err)\n    }\n\n    image := \"ubuntu:18.04\"\n    hostPath := getThisDir()\n    containerPath := \"/host_files\"\n\n    log.Printf(\"             Image: %s\\n\", image)\n    log.Printf(\"         Host Path: %s\\n\", hostPath)\n    log.Printf(\"    Container Path: %s\\n\", containerPath)\n\n    ctx := context.Background()\n    cli.NegotiateAPIVersion(ctx)\n\n    log.Println(\"Creating container\")\n    var cont container.ContainerCreateCreatedBody\n    if cont, err = cli.ContainerCreate(\n        context.Background(),\n        &amp;container.Config{\n            Image:      image,\n            Entrypoint: []string{\"/bin/bash\", \"-c\", \"ls -la \" + containerPath},\n            Volumes: map[string]struct{}{\n                hostPath: {},\n            },\n        },\n        &amp;container.HostConfig{\n            Runtime: \"runsc\",\n            /*\n                Mounts: []mount.Mount{\n                    mount.Mount{\n                        Type:   mount.TypeVolume,\n                        Source: hostPath,\n                        Target: containerPath,\n                    },\n                },\n            */\n        },\n        nil,\n        \"TEST_CONTAINER\",\n    ); err != nil {\n        panic(err)\n    }\n\n    defer func() {\n        log.Println(\"Cleaning up\")\n        if err := cli.ContainerRemove(\n            context.Background(),\n            cont.ID,\n            types.ContainerRemoveOptions{\n                Force:         true,\n                RemoveVolumes: true,\n            },\n        ); err != nil {\n            panic(err)\n        }\n    }()\n\n    log.Println(\"Starting container\")\n    if err = cli.ContainerStart(\n        context.Background(),\n        cont.ID,\n        types.ContainerStartOptions{},\n    ); err != nil {\n        panic(err)\n    }\n\n    log.Println(\"Waiting for container to exit\")\n    waitOk, waitErr := cli.ContainerWait(\n        ctx,\n        cont.ID,\n        container.WaitConditionNotRunning,\n    )\n    select {\n    case &lt;-waitOk:\n        log.Println(\"Container exited normally!\")\n    case err = &lt;-waitErr:\n        log.Println(\"Error waiting\")\n        panic(err)\n    }\n    log.Println(\"Should be done!\")\n\n    logOutput, err := cli.ContainerLogs(\n        ctx,\n        cont.ID,\n        types.ContainerLogsOptions{\n            ShowStdout: true,\n            ShowStderr: true,\n            Follow:     false,\n        },\n    )\n    if err != nil {\n        panic(err)\n    }\n\n    log.Println(\"Container output:\")\n    stdcopy.StdCopy(os.Stdout, os.Stderr, logOutput)\n}\n</code></pre>\n\n<p>Compiling and running this yields the output:</p>\n\n<pre><code>2019/04/16 20:42:21 Creating client\n2019/04/16 20:42:21              Image: ubuntu:18.04\n2019/04/16 20:42:21          Host Path: /home/user/go/src/test\n2019/04/16 20:42:21     Container Path: /host_files\n2019/04/16 20:42:21 Creating container\n2019/04/16 20:42:22 Starting container\n2019/04/16 20:42:22 Waiting for container to exit\n2019/04/16 20:42:22 Container exited normally!\n2019/04/16 20:42:22 Should be done!\n2019/04/16 20:42:22 Container output:\nls: cannot access '/host_files': No such file or directory\n2019/04/16 20:42:22 Cleaning up\n</code></pre>\n\n<p>If you uncomment the mount-related lines, you get this output instead:</p>\n\n<pre><code>2019/04/16 20:23:32 Creating client\n2019/04/16 20:23:32              Image: ubuntu:18.04\n2019/04/16 20:23:32          Host Path: /home/user/go/src/test\n2019/04/16 20:23:32     Container Path: /host_files\n2019/04/16 20:23:32 Creating container\npanic: Error response from daemon: create /home/user/go/src/test: \"/home/user/go/src/test\" includes invalid characters for a local volume name, only \"[a-zA-Z0-9][a-zA-Z0-9_.-]\" are allowed. If you intended to pass a host directory, use absolute path\n\ngoroutine 1 [running]:\nmain.main()\n        /home/user/go/src/test/container.go:66 +0xb0c\n</code></pre>\n\n<p>The error message doesn't make sense, since I <em>am</em> using an absolute path. Maybe I should reread the documentation for <code>ContainerCreate</code>.</p>\n\n<h2>Update 1</h2>\n\n<p><a href=\"https://docs.docker.com/engine/api/v1.32/#operation/ContainerCreate\" rel=\"nofollow noreferrer\">The docker engine API documentation</a> contains more details about Volumes - I'm beginning to think that I'm mistaken about how <code>docker -v /host/path:/container/path</code> works - perhaps that is actually a bind mount and not a volume mount.</p>\n\n<h2>Update 2</h2>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Rubber_duck_debugging\" rel=\"nofollow noreferrer\">Rubber duck debugging</a> FTW I guess. Removing the <code>Volumes</code> settings, adding the <code>Mounts</code> back in and changing the <code>Type</code> to <code>mount.TypeBind</code> made it work:</p>\n\n<pre><code>2019/04/16 20:53:18 Creating client\n2019/04/16 20:53:18              Image: ubuntu:18.04\n2019/04/16 20:53:18          Host Path: /home/user/go/src/test\n2019/04/16 20:53:18     Container Path: /host_files\n2019/04/16 20:53:18 Creating container\n2019/04/16 20:53:18 Starting container\n2019/04/16 20:53:19 Waiting for container to exit\n2019/04/16 20:53:19 Container exited normally!\n2019/04/16 20:53:19 Should be done!\n2019/04/16 20:53:19 Container output:\ntotal XXXX\ndrwxr-xr-x  7 1000 1000     4096 Apr 17 03:51 .\ndrwxr-xr-x 34 root root     4096 Apr 17 03:53 ..\n-rw-r--r--  1 1000 1000    10390 Apr 16 12:16 Gopkg.lock\n-rw-r--r--  1 1000 1000     1021 Apr 16 12:16 Gopkg.toml\n-rwxr-xr-x  1 1000 1000 12433827 Apr 17 03:53 container\n-rw-r--r--  1 1000 1000     2421 Apr 17 03:51 container.go\n2019/04/16 20:53:19 Cleaning up\n</code></pre>\n"}, {"tags": ["go", "delve"], "comments": [{"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1556666191, "post_id": 55718316, "comment_id": 98513044, "body": "I am still having the problem and have done a lot of research. There are hints of similar problems but nobody else seems to have encountered this huge problem with delve.  I suspect it is <i>Windows</i> related (and most are running debugger on Linux), so I have changed the title to reflect this."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1562147028, "post_id": 55718316, "comment_id": 100283332, "body": "I have reproduced this problem with a very simpler project now, if anyone is interested."}], "answers": [{"comments": [{"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1562486724, "post_id": 56919271, "comment_id": 100383295, "body": "Sorry, I forgot to mention that I upgraded to 1.2.0 and nothing changed. Thanks for the info on delve command line - I&#39;ll see if I can use it."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1563779198, "post_id": 56919271, "comment_id": 100796767, "body": "Sorry, I should have given you the bounty. (I did not realise that it just disappeared if not used.) I was going to increase to it to 100 but now I know how it works I am <i>never</i> going to use a bounty again."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1563779641, "post_id": 56919271, "comment_id": 100796954, "body": "@AJR No problem. Hopefully, this answer can help others."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 1, "creation_date": 1593224806, "post_id": 56919271, "comment_id": 110712823, "body": "I meant I should have given you the bounty as otherwise it was wasted and you provided a useful comment.  The problem still occurs with GoLand, VSCode and command line debugging but seems to happen less often with latest Delve."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1593242049, "post_id": 56919271, "comment_id": 110715632, "body": "@AJR no problem, an upvote would still be appreciated"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1562472389, "creation_date": 1562472389, "answer_id": 56919271, "question_id": 55718316, "link": "https://stackoverflow.com/questions/55718316/go-delve-1-0-0-rc2-freezes-on-windows-after-breakpoint-hit/56919271#56919271", "title": "Go Delve (1.0.0-rc2) freezes on Windows after breakpoint hit", "body": "<p>First, 1.0.0-rc2 seems anvient forn Delve: the <a href=\"https://github.com/go-delve/delve/releases\" rel=\"nofollow noreferrer\">current version is 1.2.0</a></p>\n\n<p>1.0.0-rc2 is so ancient that a similar bug was reported in August 2018 (<a href=\"https://github.com/go-delve/delve/issues/1318\" rel=\"nofollow noreferrer\">issue 1318</a>) regarding an headless execution of delve:</p>\n\n<pre><code>dlv debug --headless ...\n</code></pre>\n\n<p>Adding <code>--log --log-output=rpc</code> can give you additional clues.</p>\n\n<pre><code>dlv debug --headless --listen=:2345 --api-version=2 --log --log-output=rpc ./test.go\n</code></pre>\n\n<blockquote>\n  <p>Delve itself, in headless mode, will ignore SIGINT.<br>\n  To stop the headless instance you have to connect to it and then terminate the connection.<br>\n  To send a SIGINT to the target program you have to start the target program, which you didn't, because to start the target program you have to connect to delve first.</p>\n</blockquote>\n"}], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1562472389, "creation_date": 1555461274, "last_edit_date": 1556666270, "question_id": 55718316, "link": "https://stackoverflow.com/questions/55718316/go-delve-1-0-0-rc2-freezes-on-windows-after-breakpoint-hit", "title": "Go Delve (1.0.0-rc2) freezes on Windows after breakpoint hit", "body": "<p>I have recently been having a problem which essentially makes debugging Go using delve next to impossible.  Basically I can't use breakpoints otherwise there is a good chance the debugged code freezes and all I can do is stop the debugger an restart.</p>\n\n<p>To start at the beginning... I have had an intermittent problem debugging Go using GoLand IDE (2019.1) and delve (1.0.0-rc2) for some time. The whole session would freeze - I know that nothing is happening because the debugged process CPU usage is zero, and the fact that there are no messages being written to the log (I have many go-routines most of which are writing occasional log messages).  It's as if a breakpoint was hit but the debugger commands (STEP, etc) are not enabled which indicates that the debugger is <em>not</em> at a breakpoint. When this happens I have to hit the GoLand STOP button <em>twice</em> to get the debugger to terminate and then start all over again.</p>\n\n<p>Recently this problem has become far more common. From perhaps a few times a day to almost every debug session. This is annoying but at least it has allowed me to track down what I believe is the underlying problem. It seems that sometimes when a breakpoint is encountered the debugger stops but delve or the IDE does not realise that - so there is no way to continue.</p>\n\n<p>How do I know this? I proved this to myself by setting a breakpoint on a log line (ie, log.Printf). When the breakpoint is on that line (and I know it will be hit) then the debug session freezes. If I ensure there are no breakpoints that will be hit then the program runs absolutely fine including printing the log line. If I set the (one and only) breakpoint on the line <em>after</em> log line the log line is printed and the session freezes.</p>\n\n<p>I think this is a problem with delve. Note that I have loaded the same project into VSCode and the exactly the same thing happens (GoLand and VSCode use the same version of delve), so I don't think GoLand is doing anything wrong. But if someone has another explanation I welcome it.</p>\n\n<p>I have tried a lot of things to track down the cause.  I have created a small project in order to demonstrate the problem but it does not occur in a simple project. It appears that I am doing something wrong (in my large project) that causes delve to misbehave but I have no idea what that is.</p>\n"}, {"tags": ["go", "build", "compilation", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1555463613, "post_id": 55717836, "comment_id": 98117270, "body": "No. The go command is the interface for the compiler. However that doesn\u2019t mean you can\u2019t compile the code from an in-memory filesystem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555508908, "post_id": 55717836, "comment_id": 98137062, "body": "<code>go build</code> compiles not just the provided source, but all dependencies (transitively, including the stdlib) and the runtime, and links everything. It&#39;s not just &quot;take a file and translate it to machine code&quot;."}, {"owner": {"reputation": 1567, "user_id": 810706, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7e50c2321b7235c53a46fee37497a98f?s=128&d=identicon&r=PG", "display_name": "Tyson", "link": "https://stackoverflow.com/users/810706/tyson"}, "edited": false, "score": 0, "creation_date": 1555531078, "post_id": 55717836, "comment_id": 98148538, "body": "In this case, the code has no external dependencies (other than the runtime)."}], "owner": {"reputation": 1567, "user_id": 810706, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7e50c2321b7235c53a46fee37497a98f?s=128&d=identicon&r=PG", "display_name": "Tyson", "link": "https://stackoverflow.com/users/810706/tyson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 3, "answer_count": 0, "score": 2, "last_activity_date": 1555456953, "creation_date": 1555456953, "question_id": 55717836, "link": "https://stackoverflow.com/questions/55717836/is-there-an-easy-way-to-compile-go-code-within-a-go-program-without-reading-from", "title": "Is there an easy way to compile Go code within a Go program without reading from/writing to disk?", "body": "<p>Is there an easy way to compile Go source code within a Go program? I'm looking for essentially the same functionality as running \"go build\" but without ever reading from/writing to disk. The Go standard library exposes Go compiler frontend functionality (eg. via go/scanner and go/parser) that makes it trivial to generate an AST from source, but I don't see the compiler backend functionality (eg. the rest of what's handled in work.runBuild in the compiler used to compile Go standard binary distributions) exposed.</p>\n"}, {"tags": ["go", "swagger", "mux"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 2, "creation_date": 1555449870, "post_id": 55716545, "comment_id": 98114125, "body": "Please post the code where you set up the routes.  Based on your example &quot;working/not working&quot;, it seems that you want a <code>PathPrefix</code> route...   (Solidi have a special meaning in URLs; they separate path elements.  Your route will match exactly one path element as {arg}.)"}, {"owner": {"reputation": 1234, "user_id": 4295410, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/WJfsc.png?s=128&g=1", "display_name": "cocoseis", "link": "https://stackoverflow.com/users/4295410/cocoseis"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1555495154, "post_id": 55716545, "comment_id": 98128652, "body": "I have added the route. However, why is the argument separated even though I am escaping it?"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1555501476, "post_id": 55717786, "comment_id": 98132296, "body": "See <a href=\"https://github.com/gorilla/mux/issues/77\" rel=\"nofollow noreferrer\">github.com/gorilla/mux/issues/77</a> and <a href=\"https://github.com/lighthouse-isu/lighthouse/issues/30\" rel=\"nofollow noreferrer\">github.com/lighthouse-isu/lighthouse/issues/30</a>"}], "tags": [], "owner": {"reputation": 56, "user_id": 7728251, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wlNmaWB4nMw/AAAAAAAAAAI/AAAAAAAAa5o/kGW54f9EwGs/photo.jpg?sz=128", "display_name": "Johan Dahl", "link": "https://stackoverflow.com/users/7728251/johan-dahl"}, "is_accepted": false, "score": 0, "last_activity_date": 1555456519, "creation_date": 1555456519, "answer_id": 55717786, "question_id": 55716545, "link": "https://stackoverflow.com/questions/55716545/url-escaped-parameter-not-resolving-properly/55717786#55717786", "title": "Url escaped parameter not resolving properly", "body": "<p>Replacing one of the / in this pages address is still pointing to this page:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/55716545%2Furl-escaped-parameter-not-resolving-properly\">https://stackoverflow.com/questions/55716545%2Furl-escaped-parameter-not-resolving-properly</a></p>\n\n<p>So I guess</p>\n\n<p><a href=\"http://localhost:9090/v1/abc/https%3A%2F%2Fgoogle.com\" rel=\"nofollow noreferrer\">http://localhost:9090/v1/abc/https%3A%2F%2Fgoogle.com</a></p>\n\n<p>Is seen as \n<a href=\"http://localhost:9090/v1/abc/https%3A//google.com\" rel=\"nofollow noreferrer\">http://localhost:9090/v1/abc/https%3A//google.com</a></p>\n\n<p>By your router and it doesn't seem to allow any more than one part after abc</p>\n"}, {"tags": [], "owner": {"reputation": 1234, "user_id": 4295410, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/WJfsc.png?s=128&g=1", "display_name": "cocoseis", "link": "https://stackoverflow.com/users/4295410/cocoseis"}, "is_accepted": false, "score": 1, "last_activity_date": 1555523362, "creation_date": 1555523362, "answer_id": 55733369, "question_id": 55716545, "link": "https://stackoverflow.com/questions/55716545/url-escaped-parameter-not-resolving-properly/55733369#55733369", "title": "Url escaped parameter not resolving properly", "body": "<p>It is working with</p>\n\n<p><code>router := mux.NewRouter().SkipClean(true).UseEncodedPath()</code></p>\n\n<p>ref: <a href=\"https://github.com/gorilla/mux/blob/master/mux.go\" rel=\"nofollow noreferrer\">https://github.com/gorilla/mux/blob/master/mux.go</a></p>\n"}], "owner": {"reputation": 1234, "user_id": 4295410, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/WJfsc.png?s=128&g=1", "display_name": "cocoseis", "link": "https://stackoverflow.com/users/4295410/cocoseis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1555523362, "creation_date": 1555448491, "last_edit_date": 1555495098, "question_id": 55716545, "link": "https://stackoverflow.com/questions/55716545/url-escaped-parameter-not-resolving-properly", "title": "Url escaped parameter not resolving properly", "body": "<p>I have generated a simple <code>gorilla/mux</code> API using swagger.\nFor my single endpoint <code>/v1/abc/{arg}</code> I am passing an argument. </p>\n\n<p>Therefore a request like: <code>http://localhost:9090/v1/abc/hello</code> simply echos the argument for now.\nThe following function handles the request:</p>\n\n<pre><code>func GetAbcByArg(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    vars := mux.Vars(r)\n    arg, _ := url.QueryUnescape(vars[\"arg\"])\n    log.Printf(\"arg %s\", arg)\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintf(w, \"%v\\n\", arg)\n}\n</code></pre>\n\n<p>So far so good. However, whenever I try to pass some special characters as the argument, I get a 404 error and the handler is not called. I though I could simply escape the argument by fully escaping URL characters (rfc3986), but that is also not working. Why? How can I prepare any string so I can pass it in a single element?</p>\n\n<p>Examples:</p>\n\n<p><code>http://localhost:9090/v1/abc/hello</code> working as expected</p>\n\n<p><code>http://localhost:9090/v1/abc/123/xyz</code> not working as expected</p>\n\n<p><code>http://localhost:9090/v1/abc/a.x</code> working as expected</p>\n\n<p><code>http://localhost:9090/v1/abc/https://google.com</code> not working as expected</p>\n\n<p><code>http://localhost:9090/v1/abc/https%3A%2F%2Fgoogle.com</code> not working, <strong>but why</strong>?</p>\n\n<h1>UPDATE</h1>\n\n<p>Route setup:</p>\n\n<pre><code>var routes = Routes{\n    Route{\n        \"GetAbcByArg\",\n        strings.ToUpper(\"Get\"),\n        \"/v1/abc/{arg}\",\n        GetAbcByArg,\n    },\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "cron"], "comments": [{"owner": {"reputation": 4468, "user_id": 923620, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/YOmxc.jpg?s=128&g=1", "display_name": "Max Lobur", "link": "https://stackoverflow.com/users/923620/max-lobur"}, "edited": false, "score": 0, "creation_date": 1555444757, "post_id": 55715625, "comment_id": 98111971, "body": "<code>CONS - very hard to debug, logs debug etc</code> - how a plain k8s pod with a cron timer inside helps to debug in this case? It will be the same container, just a container per job run."}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 4468, "user_id": 923620, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/YOmxc.jpg?s=128&g=1", "display_name": "Max Lobur", "link": "https://stackoverflow.com/users/923620/max-lobur"}, "edited": false, "score": 0, "creation_date": 1555444931, "post_id": 55715625, "comment_id": 98112053, "body": "@MaxLobur - im talking about local debug, go code vs shell script"}, {"owner": {"reputation": 2780, "user_id": 7992467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uhwP2.jpg?s=128&g=1", "display_name": "cookiedough", "link": "https://stackoverflow.com/users/7992467/cookiedough"}, "edited": false, "score": 0, "creation_date": 1555445369, "post_id": 55715625, "comment_id": 98112238, "body": "If you&#39;re running a K8S cronjob it creates a pod with every invocation of the job, so it&#39;ll be easy to debug. Is there a reason why you aren&#39;t running these cronjobs inside the container?  You can use a lifecycle hook, so you don&#39;t have to change your Dockerfile."}, {"owner": {"reputation": 4468, "user_id": 923620, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/YOmxc.jpg?s=128&g=1", "display_name": "Max Lobur", "link": "https://stackoverflow.com/users/923620/max-lobur"}, "edited": false, "score": 0, "creation_date": 1555445407, "post_id": 55715625, "comment_id": 98112251, "body": "so debugging should be in pros of k8s cron job. You write the code which does task exactly once and exits - easy to debug. If you implement cron timer yourself, you will need to separate that every time you debug."}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 2780, "user_id": 7992467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uhwP2.jpg?s=128&g=1", "display_name": "cookiedough", "link": "https://stackoverflow.com/users/7992467/cookiedough"}, "edited": false, "score": 0, "creation_date": 1555445612, "post_id": 55715625, "comment_id": 98112336, "body": "@cookiedough - I want to create a k8s <code>cronjob&#47;job</code> which execute a go program that running some API calls. this is not a good approach ?I dont want to create a pod for each invocation ...."}, {"owner": {"reputation": 2780, "user_id": 7992467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uhwP2.jpg?s=128&g=1", "display_name": "cookiedough", "link": "https://stackoverflow.com/users/7992467/cookiedough"}, "edited": false, "score": 0, "creation_date": 1555445704, "post_id": 55715625, "comment_id": 98112370, "body": "@NinaS it depends on the scope of your job, do you need access to your pod contents in the job?"}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 2780, "user_id": 7992467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uhwP2.jpg?s=128&g=1", "display_name": "cookiedough", "link": "https://stackoverflow.com/users/7992467/cookiedough"}, "edited": false, "score": 0, "creation_date": 1555445809, "post_id": 55715625, "comment_id": 98112420, "body": "@cookiedough - no the job should run as standalone ,run rest call go get status and in case of an issue send data to some system via rest call. so it can be k8s crd job which execute a binary which run this logic, what do you think?"}, {"owner": {"reputation": 2780, "user_id": 7992467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uhwP2.jpg?s=128&g=1", "display_name": "cookiedough", "link": "https://stackoverflow.com/users/7992467/cookiedough"}, "edited": false, "score": 0, "creation_date": 1555447368, "post_id": 55715625, "comment_id": 98113047, "body": "I would add a cronjob with the script attached as a configMap."}], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1555570758, "post_id": 55718070, "comment_id": 98158452, "body": "Thanks a lot! this is they way to go. one question, I need to keep for my <code>go</code> application the <code>kubeconfig</code> , as I dont want it to be visible and only can access by my program, how I should handle it, is there an opensource or approach to help for this issue ?"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 3, "last_activity_date": 1555458960, "creation_date": 1555458960, "answer_id": 55718070, "question_id": 55715625, "link": "https://stackoverflow.com/questions/55715625/cron-job-as-program-or-native-k8s-way/55718070#55718070", "title": "Cron job as program or native k8s way", "body": "<p>I'd approach this problem in several steps.</p>\n\n<p>First, write the program that does the REST calls, checks the result, maybe posts the alert, and exits.  You can write this program in whatever language or toolkit you feel like.  If you're comfortable in Go, great; I might pick Python myself; it'd be possible as a shell script, but probably more awkward than many alternatives.  <strong>Build this program completely independently of Kubernetes.</strong> Test it as much as you need to convince yourself that it does what you want.</p>\n\n<p>Once you've made the REST polling program work, and only then, build it into a Docker image; push it to a registry; and create a <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/\" rel=\"nofollow noreferrer\">CronJob</a> Kubernetes resource that runs it on a schedule.</p>\n\n<p>Given how you've described the task, I wouldn't write a specialized program just to replicate Kubernetes' built-in scheduled-task runner.  You could; I'd develop it the same way as above but use a Deployment instead of a CronJob; but probably the CronJob path is both simpler and more reliable.</p>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 1, "accepted_answer_id": 55718070, "answer_count": 1, "score": 3, "last_activity_date": 1555458960, "creation_date": 1555444093, "last_edit_date": 1555444537, "question_id": 55715625, "link": "https://stackoverflow.com/questions/55715625/cron-job-as-program-or-native-k8s-way", "title": "Cron job as program or native k8s way", "body": "<p>I need to create a Cron jobs at K8S.<br>\nsome jobs runs every minute , some of them every 5 minutes (24/7)</p>\n\n<p>This jobs need to run rest call (get) to some components and \nto check the availability and if something is wrong (post) a rest call to other system</p>\n\n<p>To handle this task I currently see two approaches </p>\n\n<ol>\n<li><strong>Create k8s cronjob</strong> - which is <strong>native</strong> k8s CRD and use <code>shell script</code> for it,  <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/</a></li>\n</ol>\n\n<p><strong>PROS</strong>  is using K8S native way to handle such issue</p>\n\n<p><strong>CONS</strong> - very hard to debug, logs debug etc </p>\n\n<ol start=\"2\">\n<li><strong>Create k8s job/cronjob</strong> - which execute run a <strong>Golang program</strong> that will do use following library as cronjob</li>\n</ol>\n\n<p><strong>PROS</strong> - debug , logging etc , <a href=\"https://github.com/robfig/cron\" rel=\"nofollow noreferrer\">https://github.com/robfig/cron</a></p>\n\n<p><strong>CONS</strong> - create some abstraction \u2026</p>\n\n<p>Any suggestion, recommendation which is better approach to use If I need a full control on those jobs</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555439599, "post_id": 55714557, "comment_id": 98109687, "body": "Why isn&#39;t defining structs an option? That&#39;s how you specify types for fields. Otherwise the numbers will be <code>float</code>s and the string will be <code>string</code> (since JSON is a subset of JavaScript and all JavaScript numbers are floats, the default numeric type is <code>float</code>)."}, {"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555439699, "post_id": 55714557, "comment_id": 98109734, "body": "The JSON data being passed in does not have a static structure. This Go app will need to handle JSON data of different names, structure and sizes."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1555439798, "post_id": 55714557, "comment_id": 98109785, "body": "If you can&#39;t use structs then use a map of <code>json.Number</code>. <a href=\"https://play.golang.org/p/vuo8KZekcZG\" rel=\"nofollow noreferrer\">play.golang.org/p/vuo8KZekcZG</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1555441286, "post_id": 55714557, "comment_id": 98110494, "body": "@mkopriva <code>json.Numer</code> is <code>float</code>. OP wants numbers with no fractional component to come through as <code>int</code> (which isn&#39;t possible without defining a type)."}, {"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "edited": false, "score": 0, "creation_date": 1555445657, "post_id": 55714557, "comment_id": 98112352, "body": "The key names in the question are just examples, the application should be able to handle data with different key names and different types of data. If this is unable to be done, that&#39;s fine too, just wondering if there was a way."}, {"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "edited": false, "score": 0, "creation_date": 1555450836, "post_id": 55714557, "comment_id": 98114465, "body": "In the JSON, if the value is surrounded by double quotes, it should be a string, without double quotes and without a decimal point would be an int, and anything without double quotes and with a decimal point would be a float, like the example. The key can be any arbitrary string."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1555473271, "post_id": 55714557, "comment_id": 98119148, "body": "And what type should be used for i.e. <code>0.3</code> which cannot be represented in a float? Or <code>9999999999999999999999999999999999999999999</code> which is too big for an int? What you try to do looks innocent, but does not work out well."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "edited": false, "score": 0, "creation_date": 1555445818, "post_id": 55715351, "comment_id": 98112423, "body": "How would it be possible to distinguish two different key-value pairs that have a string and an identical int or float? For example, if my data set is <code>{&quot;data1&quot;:&quot;123456&quot;, &quot;data2&quot;: 123456}</code>?"}], "tags": [], "owner": {"reputation": 21, "user_id": 6572480, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iZuP-JA82tY/AAAAAAAAAAI/AAAAAAAAXWY/K3uIardIS-4/photo.jpg?sz=128", "display_name": "Carlos Flores", "link": "https://stackoverflow.com/users/6572480/carlos-flores"}, "is_accepted": false, "score": 1, "last_activity_date": 1555442752, "creation_date": 1555442752, "answer_id": 55715351, "question_id": 55714557, "link": "https://stackoverflow.com/questions/55714557/how-to-unrmarshal-json-that-contains-ints-floats-and-strings-of-numbers/55715351#55715351", "title": "How to unrmarshal JSON that contains ints, floats and strings of numbers?", "body": "<p>You can unmarshal the json to a map[string]interface{} and then cast to the correct types using a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1555456808, "last_edit_date": 1555456808, "creation_date": 1555455590, "answer_id": 55717690, "question_id": 55714557, "link": "https://stackoverflow.com/questions/55714557/how-to-unrmarshal-json-that-contains-ints-floats-and-strings-of-numbers/55717690#55717690", "title": "How to unrmarshal JSON that contains ints, floats and strings of numbers?", "body": "<p>Decode to <code>map[string]interface{}</code> with the <a href=\"https://godoc.org/encoding/json#Decoder.UseNumber\" rel=\"nofollow noreferrer\">UseNumber</a> option. Use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to find numbers and convert based on presence of the \".\".</p>\n\n<pre><code>dec := json.NewDecoder(r)\ndec.UseNumber()\n\nvar m map[string]interface{}\nerr := dec.Decode(&amp;m)\nif err != nil {\n    log.Fatal(err)\n}\n\nfor k, v := range m {\n    v, err := decodeValue(v)\n    if err != nil {\n        log.Fatal(err)\n    }\nfor k, v := range m {\n    v, err := decodeValue(v)\n    if err != nil {\n        log.Fatal(err)\n    }\n    switch v := v.(type) {\n    case string:\n        fmt.Printf(\"%s is a string with value %q\\n\", k, v)\n    case int64:\n        fmt.Printf(\"%s is a integer with value %d\\n\", k, v)\n    case float64:\n        fmt.Printf(\"%s is a float with value %f\\n\", k, v)\n    default:\n        fmt.Printf(\"%s is a %T with value %v\\n\", k, v, v)\n    }\n}\n\n\n...\n\nfunc decodeValue(v interface{}) (interface{}, error) {\n    if vv, ok := v.(json.Number); ok {\n        if strings.Contains(vv.String(), \".\") {\n            return vv.Float64()\n        } else {\n            return vv.Int64()\n        }\n    } else {\n        return v, nil\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qgDhXGrW7tR\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>This example prints what's found and exits the program on error. If your goal is to create a map with the values of the correct types, then replace the code that prints numbers with <code>m[k] = n</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 55717690, "answer_count": 2, "score": -2, "last_activity_date": 1555456808, "creation_date": 1555439509, "last_edit_date": 1555456490, "question_id": 55714557, "link": "https://stackoverflow.com/questions/55714557/how-to-unrmarshal-json-that-contains-ints-floats-and-strings-of-numbers", "title": "How to unrmarshal JSON that contains ints, floats and strings of numbers?", "body": "<p>I have a multiple different JSON requests of data that is being passed into my Go app that contains numbers in different formats. An example of a request is as follows:</p>\n\n<pre><code>{\n    \"stringData\":\"123456\",\n    \"intData\": 123456,\n    \"floatData\": 123456.0\n}\n</code></pre>\n\n<p>Is there a way to unmarshal this data into the type which is determined by the JSON data. For example, string data would be \"123456\", int data would be 123456 and float data would be 123456.0. I do not have structs defined for these JSON objects and creating structs for these are not an option.</p>\n\n<p>I have looked at the decoder.UseNumber() method to convert the data into strings, but I don't know how to handle the difference between stringData and intData after that.</p>\n"}, {"tags": ["postgresql", "go", "pgadmin", "pgadmin-4"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555439228, "post_id": 55714437, "comment_id": 98109486, "body": "You can access a PostgreSQL database through a Go app, but pgAdmin is a python application, it has to be run by a python interpreter. Go is not going to help."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555439275, "post_id": 55714437, "comment_id": 98109516, "body": "yes I already access it through go app. Ok for python but do I really need apache?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555439352, "post_id": 55714437, "comment_id": 98109557, "body": "Apache is acting as the CGI host for Python. You need <i>something</i> to be a web server that can act as a CGI host. So, Apache, Nginx, etc."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555440050, "post_id": 55714437, "comment_id": 98109893, "body": "@Adrian so I need to put nginx or apache in front of postgres and golang instead of serving directly with golang?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555441358, "post_id": 55714437, "comment_id": 98110529, "body": "No, you don&#39;t need anything in front of Go. Your question appears to be about installing pgAdmin, which isn&#39;t a Go application. Maybe you can clarify what you&#39;re trying to do?"}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555441501, "post_id": 55714437, "comment_id": 98110605, "body": "@Adrian, I have VPS with a golang webserver and a postgres db, I want a simple way to access postgres apart from  ssh -&gt; psql (CLI). Usually at my local env I use pgadmin 4 I want to do the same or something similar in my VPS (with go and postgres). Any tips appreciated I have been reading also of ssh tunnels might be a viable option?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555441618, "post_id": 55714437, "comment_id": 98110662, "body": "If you want to access postgres directly from your PC, you either need to open Postgres&#39; port or set up a tunnel or VPN or something - Postgres is not a web application, so Nginx/Apache won&#39;t help you. Go won&#39;t help you either unless you want to write your own Go version of pgAdmin. pgAdmin might help you but you&#39;ll need to run it behind an appropriate web server."}, {"owner": {"reputation": 4629, "user_id": 3580115, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e563f6a8276664c598badcbc9f5dec7d?s=128&d=identicon&r=PG&f=1", "display_name": "Murtuza Z", "link": "https://stackoverflow.com/users/3580115/murtuza-z"}, "edited": false, "score": 0, "creation_date": 1555477071, "post_id": 55714437, "comment_id": 98120076, "body": "Docker is your friend. <a href=\"https://hub.docker.com/r/dpage/pgadmin4/\" rel=\"nofollow noreferrer\">hub.docker.com/r/dpage/pgadmin4</a>"}], "answers": [{"tags": [], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "is_accepted": false, "score": 0, "last_activity_date": 1555445778, "creation_date": 1555445778, "answer_id": 55715985, "question_id": 55714437, "link": "https://stackoverflow.com/questions/55714437/golang-and-accessing-postgres-via-a-client-in-an-ubuntu-vps/55715985#55715985", "title": "Golang and accessing postgres via a client in an Ubuntu VPS?", "body": "<p>So this is what I did to achieve connection from my laptop to my ubuntu VPS, via webstorm (I suppose any intellij works also should work with other IDE's)</p>\n\n<p>0 login to your server \n1. Locate <code>postgresql.conf</code> usually under <code>/etc/postgresql/10/main</code>\n2. <code>sudo nano postgresql.conf</code>\n3. Locate and change line at connections</p>\n\n<pre><code>    listen_addresses = '*'\n</code></pre>\n\n<ol start=\"4\">\n<li><p>Then in same dir edit: <code>sudo nano pg_hba.conf</code></p>\n\n<pre><code>#TYPE  DATABASE        USER            ADDRESS                 METHOD\nhost    all             all             0.0.0.0/0               md5\n</code></pre></li>\n</ol>\n\n<p>Md5 means I connect with user and his password</p>\n\n<p>5  Dont forget to allow ufw (firewall) </p>\n\n<pre><code>sudo ufw allow 5432/tcp\n</code></pre>\n\n<ol start=\"6\">\n<li><p>Open webstorm > Database (tab) > click + to add PostgtresSQL source (fill relevant info, user name, password, database name, host and port, etc...)</p>\n\n<pre><code>jdbc:postgresql://example.com:5432/my_database_name\n</code></pre></li>\n<li><p>Press on schemas and synchronize OR press:</p>\n\n<pre><code>Source &gt; Settings &gt; Schemas tab &gt; [check] All Databases &gt; refresh       \n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1555477252, "post_id": 55718242, "comment_id": 98120147, "body": "I&#39;ll give it a look later thanks! How should the new line look like in <code>pg_hba.conf</code>? for letting it tunnel ssh connections?"}], "tags": [], "owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "is_accepted": false, "score": 1, "last_activity_date": 1555460550, "creation_date": 1555460550, "answer_id": 55718242, "question_id": 55714437, "link": "https://stackoverflow.com/questions/55714437/golang-and-accessing-postgres-via-a-client-in-an-ubuntu-vps/55718242#55718242", "title": "Golang and accessing postgres via a client in an Ubuntu VPS?", "body": "<p>Seeing your other answer I would like to offer a more secure alternative.</p>\n\n<p><strong>What's wrong with the current approach?</strong></p>\n\n<p>Your PostgreSQL instance is accessible from the internet. Generally you should try to limit access only where it is required. Especially if you are not using SSL to connect to PostgreSQL, an open port like this is a target for traffic interception and brute force attacks.</p>\n\n<p><strong>Alternative</strong></p>\n\n<p>Seeing that you are you using JetBrains IDE's you only need one other step to access your data - setting up a SSH tunnel.</p>\n\n<p>This encrypts with SSH all your connections between development host and server without exposing PostgreSQL to the outside world.</p>\n\n<p>In the connection settings for your database in the Jetbrains IDE select the SSH/SSL tab and \"Use SSH tunnel\". Input the information of your server and the SSH user + password/SSH key (use SSH keys for better security) into the relevant input fields.</p>\n\n<p>Undo the settings changes you did to open the firewall and configure PostgreSQL to listen to all nodes.</p>\n\n<p>Connections to your database are now possible over encrypted tunnels without exposing your database to any unwanted attacks.</p>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1555460550, "creation_date": 1555439067, "question_id": 55714437, "link": "https://stackoverflow.com/questions/55714437/golang-and-accessing-postgres-via-a-client-in-an-ubuntu-vps", "title": "Golang and accessing postgres via a client in an Ubuntu VPS?", "body": "<p>I'm trying to follow the digital ocean tutorial on configuring pgadmin4 in server mode, but damn it is long, and I have to first configure apache server, python and virtualenv (via other 2 tutorials).</p>\n\n<p>I don't want to install so many dependencies in my server just to access postgres via pgamin 4.</p>\n\n<p>How do you guys do it?</p>\n\n<p>I'm running a go webserver via https listening on ports 443 and redirecting 80 to 443</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings"], "answers": [{"tags": [], "owner": {"reputation": 2984, "user_id": 1315512, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/24a3c7cbc4d169a5b5a731baf4b4ce15?s=128&d=identicon&r=PG", "display_name": "FranticRock", "link": "https://stackoverflow.com/users/1315512/franticrock"}, "is_accepted": true, "score": 0, "last_activity_date": 1555510030, "creation_date": 1555510030, "answer_id": 55729479, "question_id": 55713763, "link": "https://stackoverflow.com/questions/55713763/golang-extension-through-visual-studio-code-imports-do-not-work-builds-and-tes/55729479#55729479", "title": "GoLang extension through Visual Studio Code: Imports do not work. Builds and Tests fine from regular command line", "body": "<p>I found the answer to my problem.  VS did not like the file path structure for the project.  Here are the changes I made:</p>\n\n<ol>\n<li><p>Moved main.go from azure.com/myproj/cmd/service/main/main.go up a level to azure.com/myproj/cmd/service/main.go </p></li>\n<li><p>Moved the service implementation (service.go) into the internal folder:  azure.com/myproj/internal/service/service.go</p></li>\n<li><p>Moved the tests into the internal folder: \nazure.com/myproj/internal/service/test/service_test.go</p></li>\n</ol>\n\n<p>How VS code is able to run the tests without complaining of the imports not being found. </p>\n\n<p>So now I only have the main.go in my /cmd/service folder.  Everything lives in Internal, including tests.   I suspect that burying main.go into a subfolder is what was confusing VS Code. </p>\n"}], "owner": {"reputation": 2984, "user_id": 1315512, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/24a3c7cbc4d169a5b5a731baf4b4ce15?s=128&d=identicon&r=PG", "display_name": "FranticRock", "link": "https://stackoverflow.com/users/1315512/franticrock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1311, "favorite_count": 0, "accepted_answer_id": 55729479, "answer_count": 1, "score": 0, "last_activity_date": 1555510030, "creation_date": 1555436180, "last_edit_date": 1555437972, "question_id": 55713763, "link": "https://stackoverflow.com/questions/55713763/golang-extension-through-visual-studio-code-imports-do-not-work-builds-and-tes", "title": "GoLang extension through Visual Studio Code: Imports do not work. Builds and Tests fine from regular command line", "body": "<p>I am testing this very simple Go code on MacOS using VS Code.  The project consists of these sample packages / files: </p>\n\n<ol>\n<li>azure.com/myproj/cmd/service/main/main.go</li>\n<li>azure.com/myproj/cmd/service/service.go </li>\n<li>azure.com/myproj/cmd/service/tests/test.go</li>\n<li>azure.com/myproj/internal/common/common.go</li>\n</ol>\n\n<p>On the terminal command line, everything builds and all tests pass:\n    go build .   // (works in every folder)\n    go test .    // (tests work and pass)</p>\n\n<p>However, from VS code I have 2 problems:\n1. Imports from package to package do not work at all. For example: </p>\n\n<pre><code>package test\n\nimport (\n    service \"azure.com/myproj/cmd/service\"    // VS complains on this line when running the test.\n)\n</code></pre>\n\n<ol start=\"2\">\n<li>The command that VS code runs is not just \"go test . \".  It passes extra parameters that include what seems to be a cached path, which I tried deleting from the file system, but it did not have an effect.   This is what VS.code's Output tab contains: </li>\n</ol>\n\n<p>Go Tests tab:  </p>\n\n<pre><code>unknown import path \"azure.com/myproj/cmd/service\": \ncannot find module providing package \nazure.com/myproj/cmd/service\n</code></pre>\n\n<p>Go tab: </p>\n\n<pre><code>/Users/computername/go/src/azure.com/projname/cmd/service/tests \n&gt;Finished running tool: /usr/local/bin/go test -c -o \n/var/folders/q5/hm9v_6x53lj0gj02yxqtkmd40000gn/T/vscode-goKGOMES/go- code-check azure.com/myproj/cmd/service/tests\ncan't load package: package \n\nazure.com/myproj/cmd/service: unknown import path \n\"azure.com/myproj/cmd/service\": cannot find module \nproviding package azure.com/myproj/cmd/service\n</code></pre>\n\n<p>I do not understand what VS code is doing above with <strong>hm9v_6x53lj0gj02yxqtkmd40000gn</strong> and how I can change it.  It looks like a cache. </p>\n\n<p>So to summarize:  When testing through VS Code, i do not understand why it's using the command that it is to run the tests (above), and why it can not find the imports, which the regular  \"go build . \" and \"go test . \" commands have no problem with through the terminal. </p>\n\n<p>Once again:  From the terminal command line everything builds and all tests pass.  </p>\n\n<p>Seems to clearly be a VS Code related issue. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555432537, "post_id": 55712873, "comment_id": 98106330, "body": "&quot;not working&quot; meaning what? The zero value for <code>byte</code> is <code>0</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555432580, "post_id": 55712873, "comment_id": 98106350, "body": "Though there&#39;s no need to explicitly assign the zero value, <code>var a byte</code> will get you a <code>byte</code> with its zero value by default."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555432644, "post_id": 55712873, "comment_id": 98106377, "body": "<a href=\"https://play.golang.org/p/7dVbK4iy6ts\" rel=\"nofollow noreferrer\">play.golang.org/p/7dVbK4iy6ts</a>"}, {"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555432665, "post_id": 55712873, "comment_id": 98106392, "body": "@Adrian  the first one says <code>.&#47;main.go:4:16: empty character literal or unescaped &#39; in character literal</code>; the second one has length."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555432722, "post_id": 55712873, "comment_id": 98106419, "body": "The first one is illegal, yes, the second is correct. Not sure what you mean it &quot;has length&quot;. <code>byte</code> has no length property, it only has a value."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1555432765, "post_id": 55712873, "comment_id": 98106440, "body": "If you want something with no value and a zero length, that is <code>struct{}</code>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1555432813, "post_id": 55712873, "comment_id": 98106462, "body": "Use <code>*byte</code> to differentiate between no byte and a zero byte."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555432912, "post_id": 55712873, "comment_id": 98106513, "body": "Bear in mind that a <code>*byte</code> takes up 4-8 times as much memory as the <code>byte</code> it points to, which could be a problem in the aggregate."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1555433890, "post_id": 55712873, "comment_id": 98107026, "body": "<i>&quot;Want to have an empty char/byte in Go.&quot;</i> Can you please clarify what do you mean by &quot;empty&quot;?"}, {"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555435416, "post_id": 55712873, "comment_id": 98107750, "body": "@icza added more descriptions"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555435909, "post_id": 55712873, "comment_id": 98107974, "body": "<a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">A byte is 8 bits by definition</a>. You can&#39;t make a byte with zero bits. You must pick one of the 256 possible values to indicate &quot;empty&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555435918, "post_id": 55712873, "comment_id": 98107976, "body": "Again, <i>byte has no length property</i>. It is a single byte. Its &quot;length&quot; is always exactly one byte. Are you thinking of a byte slice? The Java question you linked has a similar result - you can have an empty string or an empty byte/char array or you can have a byte with the value <code>0</code>."}, {"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555438559, "post_id": 55712873, "comment_id": 98109155, "body": "@Adrian thanks! I think that you are right: there is empty string but no empty byte in Go."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1555454255, "post_id": 55712873, "comment_id": 98115374, "body": "Maybe you were looking for a byte array? That is more like a string. That would be <code>[]byte(&quot;&quot;)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 2, "last_activity_date": 1555817227, "last_edit_date": 1555817227, "creation_date": 1555816825, "answer_id": 55779582, "question_id": 55712873, "link": "https://stackoverflow.com/questions/55712873/how-to-represent-empty-byte-in-go/55779582#55779582", "title": "How to represent empty byte in Go", "body": "<p>A <code>byte</code> is an alias to the <code>uint8</code> type. Having an \"empty byte\" doesn't really make any sense, just as having an \"empty number\" doesn't make any sense (you can have the number 0, but what is an \"empty\" number?)</p>\n\n<p>You can assign a value of zero (<code>b := byte(0)</code>, or <code>var b byte</code>), which can be used to indicate that nothing is assigned yet (\"zero value\"). The byte value of <code>0</code> is is known as a \"null byte\". It normally never occurs in regular text, but often occurs in binary data (e.g. images, compressed files, etc.)</p>\n\n<p>This is different from <code>byte(\"\")</code>, which is a <em>sequence</em> of bytes. You <em>can</em> have a sequence of zero bytes. To give an analogy: I can have a wallet with no money in it, but I can't have a coin that is worth \"empty\".</p>\n\n<hr>\n\n<p>If you really want to distinguish between \"value of 0\" and \"never set\" you can use either a pointer or a struct. An example with a pointer:</p>\n\n<pre><code>var b *byte\nfmt.Println(b)      // &lt;nil&gt;, since it's a pointer which has no address to point to.\n\none := byte(0)\nb = &amp;one            // Set address to one.\nfmt.Println(b, *b)  // 0xc000014178 0 (first value will be different, as it's\n                    // a memory address).\n</code></pre>\n\n<p>You'll need to be a little bit careful here, as <code>*b</code> will be a panic if you haven't assigned a value yet. Depending on how it's used it can either work quite well, or be very awkward to work with. An example where this is used in the standard library is the <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\"><code>flag</code> package</a>.</p>\n\n<p>Another possibility is to use a struct with separate fiels for the byte itself and a flag to record whether it's been set or not. In the <code>database/sql</code> library there are already the <code>Null*</code> types (e.g. <a href=\"https://golang.org/pkg/database/sql/#NullInt64\" rel=\"nofollow noreferrer\"><code>NullInt64</code></a>, which you can use as a starting point.</p>\n"}], "owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5028, "favorite_count": 1, "accepted_answer_id": 55779582, "answer_count": 1, "score": 0, "last_activity_date": 1555817227, "creation_date": 1555432503, "last_edit_date": 1555435478, "question_id": 55712873, "link": "https://stackoverflow.com/questions/55712873/how-to-represent-empty-byte-in-go", "title": "How to represent empty byte in Go", "body": "<p>Want to have an empty char/byte, which has zero size/length, in Go, such as <code>byte(\"\")</code>.</p>\n\n<pre><code>\nfunc main() {\n    var a byte = '' // not working\n    var a byte = 0  // not working\n}\n\n</code></pre>\n\n<p>A more specific example is </p>\n\n<pre><code>\nfunc removeOuterParentheses(S string) string {\n    var stack []int\n    var res []byte\n    for i, b := range []byte(S) {\n        if b == '(' {\n            stack = append(stack, i)\n        } else {\n            if len(stack) == 1 {\n                res[stack[0]] = '' // set this byte to be empty\n                res[i] = '' // / set this byte to be empty\n            }\n            stack = stack[:len(stack)-1]\n        }\n    }\n    return string(res)\n}\n</code></pre>\n\n<p>There is <a href=\"https://stackoverflow.com/questions/8534178/how-to-represent-empty-char-in-java-character-class\">an equivalent question in Java</a></p>\n"}, {"tags": ["html", "go", "hugo"], "answers": [{"comments": [{"owner": {"reputation": 14141, "user_id": 519836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1c2aa95f64549bd119106e71022dc5c5?s=128&d=identicon&r=PG", "display_name": "Andry", "link": "https://stackoverflow.com/users/519836/andry"}, "edited": false, "score": 0, "creation_date": 1555482425, "post_id": 55712853, "comment_id": 98121887, "body": "I&#39;m gonna give this a try. Can you please help me understand the syntax? What is Go? And where does Hugo start? I mean, this {{ xxx }}`` syntax I understand being Hugo. Is it safe to understand that whatever falls inside those brackets is actual Go?"}], "tags": [], "owner": {"reputation": 396, "user_id": 6658596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdb05602716b4d9fe50f6528d18d1826?s=128&d=identicon&r=PG&f=1", "display_name": "Sefa \u015eahino\u011flu", "link": "https://stackoverflow.com/users/6658596/sefa-%c5%9eahino%c4%9flu"}, "is_accepted": true, "score": 8, "last_activity_date": 1555432451, "creation_date": 1555432451, "answer_id": 55712853, "question_id": 55712785, "link": "https://stackoverflow.com/questions/55712785/how-to-convert-a-list-of-values-into-comma-separated-string-in-hugo-template/55712853#55712853", "title": "How to convert a list of values into comma separated string in Hugo template", "body": "<p>Can you try </p>\n\n<pre><code>&lt;p&gt;Keywords: {{ delimit .Keywords \", \" }}&lt;/p&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14141, "user_id": 519836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1c2aa95f64549bd119106e71022dc5c5?s=128&d=identicon&r=PG", "display_name": "Andry", "link": "https://stackoverflow.com/users/519836/andry"}, "edited": false, "score": 0, "creation_date": 1555482457, "post_id": 55716130, "comment_id": 98121903, "body": "Gonna give this a try thanks. Can you explain the difference between <code>{{ xxx }}</code> and <code>{{- xxcx -}}</code>?"}, {"owner": {"reputation": 173, "user_id": 7665252, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lFLod.jpg?s=128&g=1", "display_name": "Bit33", "link": "https://stackoverflow.com/users/7665252/bit33"}, "reply_to_user": {"reputation": 14141, "user_id": 519836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1c2aa95f64549bd119106e71022dc5c5?s=128&d=identicon&r=PG", "display_name": "Andry", "link": "https://stackoverflow.com/users/519836/andry"}, "edited": false, "score": 2, "creation_date": 1555517689, "post_id": 55716130, "comment_id": 98142553, "body": "<a href=\"https://gohugo.io/templates/introduction/#whitespace\" rel=\"nofollow noreferrer\">Trimming</a> the whitespace !"}, {"owner": {"reputation": 14141, "user_id": 519836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1c2aa95f64549bd119106e71022dc5c5?s=128&d=identicon&r=PG", "display_name": "Andry", "link": "https://stackoverflow.com/users/519836/andry"}, "edited": false, "score": 0, "creation_date": 1555534746, "post_id": 55716130, "comment_id": 98149904, "body": "Thank you for your answer. The reason why I selected @Sefa&#39;s is because it is a one liner :) But yours is valuable and allowed me to understand a few things. Thank you."}], "tags": [], "owner": {"reputation": 173, "user_id": 7665252, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lFLod.jpg?s=128&g=1", "display_name": "Bit33", "link": "https://stackoverflow.com/users/7665252/bit33"}, "is_accepted": false, "score": 1, "last_activity_date": 1555446486, "creation_date": 1555446486, "answer_id": 55716130, "question_id": 55712785, "link": "https://stackoverflow.com/questions/55712785/how-to-convert-a-list-of-values-into-comma-separated-string-in-hugo-template/55716130#55716130", "title": "How to convert a list of values into comma separated string in Hugo template", "body": "<p>Only output the meta tag when keywords are in your front matter:</p>\n\n<pre><code>{{- with delimit .Keywords \",\" -}}\n  &lt;meta name=\"keywords\" content=\"{{.}}\"&gt;\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 14141, "user_id": 519836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1c2aa95f64549bd119106e71022dc5c5?s=128&d=identicon&r=PG", "display_name": "Andry", "link": "https://stackoverflow.com/users/519836/andry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 1, "accepted_answer_id": 55712853, "answer_count": 2, "score": 3, "last_activity_date": 1555446486, "creation_date": 1555432184, "question_id": 55712785, "link": "https://stackoverflow.com/questions/55712785/how-to-convert-a-list-of-values-into-comma-separated-string-in-hugo-template", "title": "How to convert a list of values into comma separated string in Hugo template", "body": "<p>I am new to Hugo, know nothing about GoLang and I am trying to do the following.</p>\n\n<h3>Problem</h3>\n\n<p>I have a Hugo site, and in my posts, I specify <code>keywords</code> in the front matter like:</p>\n\n<pre><code>---\nauthor: Andrea Tino\nkeywords:\n- language\n- image\n- fun\n---\n</code></pre>\n\n<p>In my template, I want to add a <code>&lt;meta&gt;</code> for keywords, so I have:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    {{ if .Keywords }}\n    &lt;meta name=\"keywords\" content=\"{{ .Keywords }}\"&gt;\n    {{ end }}\n    &lt;title&gt;{{ .Title }} | {{ .Site.Title }}&lt;/title&gt;\n&lt;/head&gt;\n</code></pre>\n\n<p>The problem, of course, is that I get this in the output:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;meta name=\"keywords\" content=\"[language image fun]\"&gt;\n    &lt;title&gt;{{ .Title }} | {{ .Site.Title }}&lt;/title&gt;\n&lt;/head&gt;\n</code></pre>\n\n<p>While my objective is to get:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;meta name=\"keywords\" content=\"language, image, fun\"&gt;\n</code></pre>\n\n<p>How to achieve this?</p>\n\n<hr>\n\n<h3>What I have tried</h3>\n\n<p>Looking at this <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\">documentation</a>, I have tried to play a little:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>{{ if .Keywords }}\n&lt;meta name=\"keywords\" content=\"{{ .Keywords | println }}\"&gt;\n{{ end }}\n</code></pre>\n\n<p>Also tried:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>{{ if .Keywords }}\n&lt;meta name=\"keywords\" content=\"{{ .Keywords | printf \"%s\" }}\"&gt;\n{{ end }}\n</code></pre>\n\n<p>They do not work. Also tried:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>{{ if .Keywords }}\n&lt;meta name=\"keywords\" content=\"{{ println(strings.Join(.Keywords, \", \")) }}\"&gt;\n{{ end }}\n</code></pre>\n\n<p>This last one causes an error:</p>\n\n<blockquote>\n  <p>Error: \"/Users/me/Git/myproj/themes/mytheme/layouts/partials/header.html:7:1\": parse failed: template: partials/header.html:7: unexpected \"(\" in operand</p>\n</blockquote>\n"}, {"tags": ["debugging", "go", "raspberry-pi", "windows-10", "delve"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1555441522, "post_id": 55712748, "comment_id": 98110615, "body": "<a href=\"https://github.com/Microsoft/vscode-go/wiki/Debugging-Go-code-using-VS-Code#remote-debugging\" rel=\"nofollow noreferrer\">github.com/Microsoft/vscode-go/wiki/&hellip;</a>"}], "owner": {"reputation": 161, "user_id": 2040530, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/55f9a578f1291f3dbf21c010e9163cda?s=128&d=identicon&r=PG", "display_name": "Sara", "link": "https://stackoverflow.com/users/2040530/sara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1555432073, "creation_date": 1555432073, "question_id": 55712748, "link": "https://stackoverflow.com/questions/55712748/debugging-golang-binary-in-raspberry-pi-from-visual-studio", "title": "Debugging golang binary in raspberry pi from visual studio", "body": "<p>I am cross-compiling the following sample code from visual studio in raspberry pi(Raspbian GNU/Linux 9 stretch) using Windows 10 OS:</p>\n\n<pre><code>package main\nimport \"fmt\"\nfunc main() {\n    fmt.Println(\"Hello World, \u4e16\u754c\")\n}\n</code></pre>\n\n<p>In order to run this in raspberry pi from VScode, I am doing the following:</p>\n\n<ul>\n<li>specifying env:GOARCH and env:GOOS</li>\n<li>go build main.go</li>\n<li>copying generated binary to raspberry pi directory</li>\n<li>logging into the pi and making the binary executable</li>\n<li>logging into the pi and running the binary \nThis is working well and I am getting the desired print statement. </li>\n</ul>\n\n<p>The problem I am facing is with debugging the code within raspberry pi from visual studio. I am able to debug the code in visual studio by installing delve, going to the current go directory in Windows, and running dlv debug main.go. However, I am completely lost on how to set breakpoint in visual studio, build and debug the code in raspberry pi? </p>\n\n<p>I did look up for tutorials online and tried some, however, none of them worked for me. Any help/link/guidance would be highly appreciated.</p>\n"}, {"tags": ["java", "go", "jwt", "jwe"], "comments": [{"owner": {"reputation": 98, "user_id": 1701907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6108946fac33d29f1abaecd0349be7a3?s=128&d=identicon&r=PG", "display_name": "user1701907", "link": "https://stackoverflow.com/users/1701907/user1701907"}, "edited": false, "score": 0, "creation_date": 1555503284, "post_id": 55711277, "comment_id": 98133366, "body": "I believe it is something in dealing with Curve P-521.  I posted an issue on the githhub repo for go-jose.  The response so far was it may have to do something with 8 byte boundaries and that curve doesn&#39;t play nice with that. <a href=\"https://github.com/square/go-jose/issues/228\" rel=\"nofollow noreferrer\">github.com/square/go-jose/issues/228</a>.  I have change to using P-256 (I can&#39;t permanently because clients are going to use P-251) and everything works 100% of the time"}, {"owner": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1555577038, "post_id": 55711277, "comment_id": 98161468, "body": "Is it possible to get a sample to test the decryption using another library? Can be sent in private if needed."}, {"owner": {"reputation": 98, "user_id": 1701907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6108946fac33d29f1abaecd0349be7a3?s=128&d=identicon&r=PG", "display_name": "user1701907", "link": "https://stackoverflow.com/users/1701907/user1701907"}, "reply_to_user": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1555590596, "post_id": 55711277, "comment_id": 98168880, "body": "Here is the encryped string: &quot;eyJlcGsiOnsia3R5IjoiRUMiLCJjcnYiOiJQLTUyMSIsIngiOiJBRUFNS2Z&zwnj;&#8203;GQ3p5NlY2WmdPdEFjSEh&zwnj;&#8203;1c0VEM0syUC1aZmdrd2x&zwnj;&#8203;LWmxtRFJaeGVLcTh4dUx&zwnj;&#8203;0cXJDTzFycWx5Wkh5MXp&zwnj;&#8203;fOEVmWXFNM0F6YlI3UGN&zwnj;&#8203;hQVdCTURkIiwieSI6IkF&zwnj;&#8203;MUWpEQjNLWWpLQ2twUUs&zwnj;&#8203;xd0VUVmtvbXZ1ZDRkT05&zwnj;&#8203;LeXhMeFJVcGpsQ0ZNSnl&zwnj;&#8203;1bXFlUjJvc0d4N0w3UC1&zwnj;&#8203;aU19vemJDTnhLaWU1RVQ&zwnj;&#8203;tdlNXUXczRmNLMDAifSw&zwnj;&#8203;iZW5jIjoiQTI1NkdDTSI&zwnj;&#8203;sImFsZyI6IkVDREgtRVM&zwnj;&#8203;ifQ..4pyFf4sd5muL9On&zwnj;&#8203;y.TOMCKHHWd20nPU8.NN&zwnj;&#8203;6MFByRemeyNa50yJGVUQ&zwnj;&#8203;&quot;"}, {"owner": {"reputation": 98, "user_id": 1701907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6108946fac33d29f1abaecd0349be7a3?s=128&d=identicon&r=PG", "display_name": "user1701907", "link": "https://stackoverflow.com/users/1701907/user1701907"}, "reply_to_user": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1555590671, "post_id": 55711277, "comment_id": 98168927, "body": "Here is the KeyPair Definition: {&quot;kty&quot;:&quot;EC&quot;,&quot;d&quot;:&quot;AGPoHUdXajyyRLV0bAokQTnDzlO7Kjs1zSucSu69CGf&zwnj;&#8203;Swpg7oXSxlfptApD-5O4&zwnj;&#8203;7d1PX3y0ag5228XsPFXV&zwnj;&#8203;zYnH0&quot;,&quot;crv&quot;:&quot;P-521&quot;&zwnj;&#8203;,&quot;x&quot;:&quot;AVuFsno89wJ5xT&zwnj;&#8203;2z63iznxVO8H5gsfcHmS&zwnj;&#8203;1XJ_JbfEzIsudqjrvKGr&zwnj;&#8203;zxJT96-dmP_NY7KeMvyJ&zwnj;&#8203;EUInmqcqCWbzcQ&quot;,&quot;y&quot;:&zwnj;&#8203;&quot;ANv5hayQ3_TwMcFqPrt&zwnj;&#8203;w-a9wNkfQuynuWhhbWOX&zwnj;&#8203;YvGArdvibDGYRIRx3O5g&zwnj;&#8203;AjfyumpibZFQ0K0jrjb0&zwnj;&#8203;9YP3AVbtc&quot;} . That should be enough to test in any library.  The x, y, and d values are Base64Encoded"}, {"owner": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1555604803, "post_id": 55711277, "comment_id": 98177098, "body": "I confirm that is not possible to decrypt the token with the key material and the JWE commented in the Go example. It is possible with the Java one. I concur with @user1701907 saying the ECDH-ES implementation of the go-jose is incorrect. The ephemeral keys are on the curve in both cases. My assumption is that the agreement key is not correctly computed by go-jose. It could be interresting to compare a key agreement computed by different libraries with known key."}], "owner": {"reputation": 98, "user_id": 1701907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6108946fac33d29f1abaecd0349be7a3?s=128&d=identicon&r=PG", "display_name": "user1701907", "link": "https://stackoverflow.com/users/1701907/user1701907"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 557, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1555459164, "creation_date": 1555427030, "last_edit_date": 1555459164, "question_id": 55711277, "link": "https://stackoverflow.com/questions/55711277/why-do-i-get-an-error-decrypting-jwe-between-java-and-go", "title": "Why do I get an error decrypting JWE between Java and Go", "body": "<p>I am not able to encrypt/decrypt within Java and Go using Curve P521, ECDH-ES, and A256GCM using the same values for curve X, Y, and D.  When I try to take the encrypted value from Go and Decrypt in Java it fails or vice versa it fails with:</p>\n\n<p>Go: square/go-jose: error in cryptographic primitive</p>\n\n<p>Java: AES/GCM/NoPadding decryption failed: mac check in GCM failed</p>\n\n<p>Any reason why this isn't working?</p>\n\n<p>!!!Update!!! I have also added code to parse a JWK to create my KeyPair in Go.  (I used the java program and printed the keypair to json).</p>\n\n<p>What I notice is that sometimes the Java encrypted value can be parsed in Go and sometimes it can't.  It is my thought that there is something in the GCM decryption that might not be working quite right in Go.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"crypto/ecdsa\"\n    \"crypto/elliptic\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"log\"\n    \"math/big\"\n    \"os\"\n\n    b64 \"encoding/base64\"\n\n    //\"github.com/contiamo/jwt\"\n\n    gojose \"gopkg.in/square/go-jose.v2\"\n    //jwtgo \"github.com/dgrijalva/jwt-go\"\n)\n\nfunc main() {\n\n    testgojmx()\n}\n\nfunc testgojmx() {\n    plaintext := []byte(\"test string\")\n\n    xEnc := \"AVuFsno89wJ5xT2z63iznxVO8H5gsfcHmS1XJ_JbfEzIsudqjrvKGrzxJT96-dmP_NY7KeMvyJEUInmqcqCWbzcQ\"\n    yEnc := \"ANv5hayQ3_TwMcFqPrtw-a9wNkfQuynuWhhbWOXYvGArdvibDGYRIRx3O5gAjfyumpibZFQ0K0jrjb09YP3AVbtc\"\n    dEnc := \"AGPoHUdXajyyRLV0bAokQTnDzlO7Kjs1zSucSu69CGfSwpg7oXSxlfptApD-5O47d1PX3y0ag5228XsPFXVzYnH0\"\n\n    x := new(big.Int)\n    temp, _ := b64.URLEncoding.DecodeString(xEnc)\n    x = x.SetBytes(temp)\n\n    y := new(big.Int)\n    temp, _ = b64.URLEncoding.DecodeString(yEnc)\n    y = y.SetBytes(temp)\n\n    d := new(big.Int)\n    temp, _ = b64.URLEncoding.DecodeString(dEnc)\n    d = d.SetBytes(temp)\n\n    privkey := new(ecdsa.PrivateKey)\n\n    privkey.PublicKey.Curve = elliptic.P521()\n    privkey.D = d\n    privkey.PublicKey.X = x\n    privkey.PublicKey.Y = y\n\n    //javaKey := `{\"kty\":\"EC\",\"d\":\"AGPoHUdXajyyRLV0bAokQTnDzlO7Kjs1zSucSu69CGfSwpg7oXSxlfptApD-5O47d1PX3y0ag5228XsPFXVzYnH0\",\"crv\":\"P-521\",\"x\":\"AVuFsno89wJ5xT2z63iznxVO8H5gsfcHmS1XJ_JbfEzIsudqjrvKGrzxJT96-dmP_NY7KeMvyJEUInmqcqCWbzcQ\",\"y\":\"ANv5hayQ3_TwMcFqPrtw-a9wNkfQuynuWhhbWOXYvGArdvibDGYRIRx3O5gAjfyumpibZFQ0K0jrjb09YP3AVbtc\"}`\n    //jwkSet, err := jwk.ParseString(javaKey)\n\n    //if err != nil {\n    //  panic(err)\n    //}\n\n    //key, err := jwkSet.Keys[0].Materialize()\n\n    //if err != nil {\n    //  panic(err)\n    //}\n\n    //privkey := key.(*ecdsa.PrivateKey)\n\n    fmt.Printf(\"X: %d\\nY: %d\\nD: %d\\n\", privkey.X, privkey.Y, privkey.D)\n\n    encrypter, err := gojose.NewEncrypter(gojose.A256GCM, gojose.Recipient{Algorithm: gojose.ECDH_ES, Key: privkey.Public()}, nil)\n    if err != nil {\n        panic(err)\n    }\n\n    encrypted, err := encrypter.Encrypt(plaintext)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"encrypted = %v\\n\", encrypted.Header)\n\n    compact, err := encrypted.CompactSerialize()\n    if err != nil {\n        panic(err)\n    }\n\n    //compact = \"eyJlcGsiOnsia3R5IjoiRUMiLCJjcnYiOiJQLTUyMSIsIngiOiJBRUFNS2ZGQ3p5NlY2WmdPdEFjSEh1c0VEM0syUC1aZmdrd2xLWmxtRFJaeGVLcTh4dUx0cXJDTzFycWx5Wkh5MXpfOEVmWXFNM0F6YlI3UGNhQVdCTURkIiwieSI6IkFMUWpEQjNLWWpLQ2twUUsxd0VUVmtvbXZ1ZDRkT05LeXhMeFJVcGpsQ0ZNSnl1bXFlUjJvc0d4N0w3UC1aU19vemJDTnhLaWU1RVQtdlNXUXczRmNLMDAifSwiZW5jIjoiQTI1NkdDTSIsImFsZyI6IkVDREgtRVMifQ..4pyFf4sd5muL9Ony.TOMCKHHWd20nPU8.NN6MFByRemeyNa50yJGVUQ\"\n\n    fmt.Printf(\"Compact Encrypted: %v\\n\", compact)\n\n    msg, _ := gojose.ParseEncrypted(compact)\n    fmt.Printf(\"Message from Encrypted: %v\\n\", msg.Header)\n\n    decrypted, err := msg.Decrypt(privkey)\n\n    fmt.Printf(\"Decrtyped: %s\\n\", decrypted)\n}\n</code></pre>\n\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication\npublic class EcdhjweApplication implements CommandLineRunner {\n\n    private static Logger LOG = LoggerFactory\n            .getLogger(EcdhjweApplication.class);\n\n    static ECKey exposedJWK = generateECKeyJwk();\n\n    public static void main(String[] args) {\n\n        SpringApplication.run(EcdhjweApplication.class, args);\n    }\n\n    @Override\n    public void run(String... args) {\n        LOG.info(\"EXECUTING : command line runner\");\n\n        try {\n            System.out.println(\"D: \\n\" + exposedJWK.toECPrivateKey().getS());\n            System.out.println(\"X: \\n\" + exposedJWK.toECPublicKey().getW().getAffineX());\n            System.out.println(\"Y: \\n\" + exposedJWK.toECPublicKey().getW().getAffineY());\n        } catch (JOSEException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(\"======================== Encrypting ================================\");\n        String encryptedRequest = null;\n        try {\n            encryptedRequest = encryptJWE(\"test string\", exposedJWK.toECPublicKey());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        System.out.println(\"Encrypted Requested::: \" + encryptedRequest);\n\n        //encryptedRequest = \"eyJhbGciOiJFQ0RILUVTIiwiZW5jIjoiQTI1NkdDTSIsImVwayI6eyJrdHkiOiJFQyIsImNydiI6IlAtNTIxIiwieCI6IkFOSXluNGRoZTd1UkpLWDJzTkVGaVU1dDFEYmR4ZUE5UjRReGVRdk1IXy1GZ2VLWWhNSk9uR1k0LWRzMEtVbjQtRlJfZVhuNl9HLWpqWEdGaThYVGdwVjUiLCJ5IjoiQUxYVkpaMEZmcHhaQzd6andhbEdWWjdyNTJxZlg5VmNsRnY4eWlsQ1pqY3lJbnlYT1BEVlhoWDlPYVU4R1ppeVVmOU1mQndSaTAzOUNMajdiQ0duM1lPRCJ9fQ.._ASNMu9mjl02agPG.QPV7DKPV77hiLJ8.SBGhv8JRJTl_adfFNxgO0Q\";\n\n        System.out.println(\"======================== Decrypting Request ================================\");\n        String decryptedDetails = null;\n        try {\n            decryptedDetails = decryptJWE(encryptedRequest, exposedJWK.toECPrivateKey());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        System.out.println(\"Decrypted Request:::\" + decryptedDetails);\n    }\n\n    //private static String encryptJWE(JSONObject payload, ECPublicKey ecPublicKey) throws Exception {\n    private static String encryptJWE(String payload, ECPublicKey ecPublicKey) throws Exception {\n        // Build JWE header\n        JWEHeader header = new JWEHeader.Builder(JWEAlgorithm.ECDH_ES, EncryptionMethod.A256GCM)\n                .build();\n\n        // Build JWE Object\n        JWEObject jweObjectClient = new JWEObject(header, new Payload(payload));\n\n        // Set Public Key, Encrypt\n        ECDHEncrypter encrypter = new ECDHEncrypter(ecPublicKey);\n        encrypter.getJCAContext().setContentEncryptionProvider(BouncyCastleProviderSingleton.getInstance());\n        jweObjectClient.encrypt(encrypter);\n        return jweObjectClient.serialize();\n    }\n\n    private static String decryptJWE(String vcnRequestJWE, ECPrivateKey ecPrivateKey) throws Exception {\n        // Parse JWE &amp; validate headers\n        JWEObject jweObject = EncryptedJWT.parse(vcnRequestJWE);\n\n        // Set PrivateKey and Decrypt\n        ECDHDecrypter decrypter = new ECDHDecrypter(ecPrivateKey);\n        decrypter.getJCAContext().setContentEncryptionProvider(BouncyCastleProviderSingleton.getInstance());\n        jweObject.decrypt(decrypter);\n\n        return jweObject.getPayload().toString();\n    }\n\n    public static ECKey generateECKeyJwk() {\n        try {\n            // Generate EC key pair with P-521 curve\n\n            String x = \"AVuFsno89wJ5xT2z63iznxVO8H5gsfcHmS1XJ_JbfEzIsudqjrvKGrzxJT96-dmP_NY7KeMvyJEUInmqcqCWbzcQ\";\n            String y = \"ANv5hayQ3_TwMcFqPrtw-a9wNkfQuynuWhhbWOXYvGArdvibDGYRIRx3O5gAjfyumpibZFQ0K0jrjb09YP3AVbtc\";\n            String d = \"AGPoHUdXajyyRLV0bAokQTnDzlO7Kjs1zSucSu69CGfSwpg7oXSxlfptApD-5O47d1PX3y0ag5228XsPFXVzYnH0\";\n\n            return new ECKey.Builder(Curve.P_521, new Base64URL(x), new Base64URL(y))\n                    .d(new Base64URL(d))\n                    .build();\n        } catch (Exception e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n}\n</code></pre>\n\n<p>The code as shown shows demonstrates working within the language.  The commented out strings are the result of a run from the other language</p>\n"}, {"tags": ["amazon-web-services", "go", "gzip", "amazon-sqs"], "comments": [{"owner": {"reputation": 487, "user_id": 11205949, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/4b982d309ca03555f824699accd64c2c?s=128&d=identicon&r=PG", "display_name": "guest", "link": "https://stackoverflow.com/users/11205949/guest"}, "edited": false, "score": 2, "creation_date": 1555427062, "post_id": 55710716, "comment_id": 98103272, "body": "Aside from the fact that buffering in memory will open you to data loss, how much will your time cost, and how many millions of requests will this cover if you don&#39;t do the work? Unless you&#39;re making pennies per hour, the answer should be clear."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555427587, "post_id": 55710716, "comment_id": 98103567, "body": "The stdlib gzip is a stream: <a href=\"https://golang.org/pkg/compress/gzip/\" rel=\"nofollow noreferrer\">golang.org/pkg/compress/gzip</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555427609, "post_id": 55710716, "comment_id": 98103578, "body": "You don&#39;t want to work with strings though, you want to work with byte slices."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1555426691, "creation_date": 1555426691, "answer_id": 55711169, "question_id": 55710716, "link": "https://stackoverflow.com/questions/55710716/most-efficient-way-to-use-aws-sqs-with-golang/55711169#55711169", "title": "Most efficient way to use AWS SQS (with Golang)", "body": "<p>I'd take the following approach</p>\n\n<ul>\n<li>Use a channel to accept incoming \"internal\" messages to a go routine</li>\n<li>In that go routine keep the messages in a \"raw\" format, so 10 messages is 10 raw uncompressed items</li>\n<li>Each time a new raw item arrives, compress all the raw messages into one.  If the size with the new message > 256k then compress messages EXCEPT the last one and push to SQS</li>\n</ul>\n\n<p>This is computationally expensive.  Each individual message causes a full compression of all pending messages.  However it is efficient for SQS use</p>\n"}, {"tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": false, "score": 0, "last_activity_date": 1555469949, "creation_date": 1555469949, "answer_id": 55719250, "question_id": 55710716, "link": "https://stackoverflow.com/questions/55710716/most-efficient-way-to-use-aws-sqs-with-golang/55719250#55719250", "title": "Most efficient way to use AWS SQS (with Golang)", "body": "<p>You could guesstimate the size of the gzipped messages and calculate whether you've reached the max size threshold. Keep track of a message size counter and for every new message increment the counter by it's expected compressed size.  Do the actual compression and send to SQS only if your counter will exceed 256kb. So you could avoid compressing every time a new message comes in.\nFor a use-case like this, running a few tests on a sample set of messages should give the rough percentage of compression expected.</p>\n"}, {"tags": [], "owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "is_accepted": false, "score": 0, "last_activity_date": 1600979281, "creation_date": 1600979281, "answer_id": 64053951, "question_id": 55710716, "link": "https://stackoverflow.com/questions/55710716/most-efficient-way-to-use-aws-sqs-with-golang/64053951#64053951", "title": "Most efficient way to use AWS SQS (with Golang)", "body": "<p>Before you get focused on compression, eliminate redundant data that is known on both sides. This is what encodings like <a href=\"https://msgpack.org\" rel=\"nofollow noreferrer\">msgpack</a>, <a href=\"https://developers.google.com/protocol-buffers/\" rel=\"nofollow noreferrer\">protobuf</a>, <a href=\"https://avro.apache.org\" rel=\"nofollow noreferrer\">AVRO</a>, and so on do.</p>\n<p>Let's say all of your messages are a struct like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Foo struct {\n    bar string\n    qux int\n}\n</code></pre>\n<p>and you were thinking of encoding it as JSON. Then the most efficient you could do is:</p>\n<pre><code>{&quot;bar&quot;:&quot;whatever&quot;,&quot;qux&quot;,123}\n</code></pre>\n<p>If you wanted to just append all of those together in memory, you might get something like this:</p>\n<pre><code>{&quot;bar&quot;:&quot;whatever&quot;,&quot;qux&quot;,123}{&quot;bar&quot;:&quot;hello world&quot;,&quot;qux&quot;,0}{&quot;bar&quot;:&quot;answer to life, the universe, and everything&quot;,&quot;qux&quot;,42}{&quot;bar&quot;:&quot;nice&quot;,&quot;qux&quot;,69}\n</code></pre>\n<p>A really good compression algorithm might look at hundreds of those messages and identify the repetitiveness of <code>{&quot;bar&quot;:&quot;</code> and <code>&quot;,&quot;qux&quot;,</code>.</p>\n<p>But compression has to do work to figure that out from your data each time.</p>\n<p>If the receiving code already knows what &quot;schema&quot; (the <code>{&quot;bar&quot;: some_string, &quot;qux&quot;: some_int}</code> &quot;shape&quot; of your data) each message has, then you can just serialize the messages like this:</p>\n<pre><code>&quot;whatever&quot;123&quot;hello world&quot;0&quot;answer to life, the universe, and everything&quot;42&quot;nice&quot;69\n</code></pre>\n<p>Note that in this example encoding, you can't just start in the middle of the data and unambiguously find your place. If you have a bunch of messages such as <code>{&quot;bar&quot;:&quot;1&quot;,&quot;qux&quot;:2}</code>, <code>{&quot;bar&quot;:&quot;2&quot;,&quot;qux&quot;:3}</code>, <code>{&quot;bar&quot;:&quot;3&quot;,&quot;qux&quot;:4}</code>, then the encoding will produce: <code>&quot;1&quot;2&quot;2&quot;3&quot;3&quot;4</code>, and you can't just start in the middle and know for sure if you're looking at a number or a string - you have to count from the ends. Whether or not this matters will depend on your use case.</p>\n<p>You can come up with other simple schemes that are more unambiguous or make the code for writing or reading messages easier or simpler, like using a field separator or message separator character which is escaped in your encoding of the other data (just like how <code>\\</code> and <code>&quot;</code> would be escaped in quoted JSON strings).</p>\n<p>If you can't have the receiver just know/hardcode the expected message schema - if you need the full flexibility of something like JSON and you always unmarshal into something like a <code>map[string]interface{}</code> or whatever - then you should consider using something like <a href=\"http://bsonspec.org\" rel=\"nofollow noreferrer\">BSON</a>.</p>\n<p>Of course, you can't use msgpack, protobuf, AVRO, or BSON directly - they need a medium that allows arbitrary bytes like <code>0x0</code>. And according to the <a href=\"https://aws.amazon.com/sqs/faqs/\" rel=\"nofollow noreferrer\">AWS SQS FAQ</a>:</p>\n<blockquote>\n<p>Q: What kind of data can I include in a message?</p>\n<p>Amazon SQS messages can contain up to 256 KB of text data, including XML, JSON and unformatted text. The following Unicode characters are accepted:</p>\n<p>#x9 | #xA | #xD | [#x20 to #xD7FF] | [#xE000 to #xFFFD] | [#x10000 to #x10FFFF]</p>\n</blockquote>\n<p>So if you want to aim for maximum space efficiency for your exact usecase, you'd have to write your own code which use the techniques from those encoding schemes, but only used bytes which bytes are allowed in SQS messages.</p>\n<p>Relatedly, if you have a lot of integers, and you know most of them are small (or clump around a certain spot of the number line, so that by adding a constant offset to all of them you can make most of them small), you can use one of the <a href=\"https://en.wikipedia.org/wiki/Variable-length_quantity\" rel=\"nofollow noreferrer\">variable length quantity</a> techniques to encode all of those integers. In fact several of those common encoding schemes mentioned above use variable length quantities in their encoding of integers. If you use a &quot;piece size&quot; of six (6) bits (instead of the standard implicitly assumed piece size of eight (8) bits to match a byte) then you can use base64. <em>Not</em> full base64 encoding, because the padding will completely defeat the purpose - just map from the 64 possible values that fit in six bits to the 64 distinct ASCII characters that base64 uses.</p>\n<p>Anyway, unless you know your data has a lot repetition (but not the kind that you can just not send, like the same field names in every message) I would start with all of that, and only then would I look at compression.</p>\n<p>Even so, if you want minimal size, I would aim for LZMA, and if you want minimal computing overhead, I would use LZ4. Gzip is not bad per se - if it's much easier to use gzip then just use it - but if you're optimizing for either size or for speed, there are better options. I don't know if gzip is even a good &quot;middle ground&quot; of speed and output size and working memory size - it's pretty old and maybe there's compression algorithms which are just strictly superior in speed and output and memory size by now. I think gzip, depending on implementation, also includes headers and framing information (like version metadata, size, checksums, and so on), which if you really need to minimize for size you probably don't want, and in the context of SQS messages you probably don't need.</p>\n"}], "owner": {"reputation": 57, "user_id": 1968215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a1b38eeffa5d74f82b5943a8f8ca2d5?s=128&d=identicon&r=PG", "display_name": "Konstantin", "link": "https://stackoverflow.com/users/1968215/konstantin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1678, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1600979281, "creation_date": 1555425369, "question_id": 55710716, "link": "https://stackoverflow.com/questions/55710716/most-efficient-way-to-use-aws-sqs-with-golang", "title": "Most efficient way to use AWS SQS (with Golang)", "body": "<p>When using the AWS SQS (Simple Queue Service) you pay for each request you make to the service (push, pull, ...). There is a maximum of 256kb for each message you can send to a queue.</p>\n\n<p>To save money I'd like to buffer messages sent to my Go application before I send them out to SQS until I have enough data to efficiently use the 256kb limit.</p>\n\n<p>Since my Go application is a webserver, my current idea is to use a string mutex and append messages as long as I would exceed the 256kb limit and then issue the SQS push event. To save even more space I could gzip every single message before appending it to the string mutex.</p>\n\n<p>I wonder if there is some kind of gzip stream that I could use for this. My assumption is that gzipping all concatenated messages together will result in smaller size then gzipping every message before appending it to the string mutex. One way would be to gzip the string mutex after every append to validate its size. But that might be very slow.</p>\n\n<p>Is there a better way? Or is there a total better approach involving channels? I'm still new to Go I have to admit.</p>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555423550, "post_id": 55709797, "comment_id": 98100937, "body": "It is definitely used in real-world applications, whether you need to use it depends on the use case. It works like this: <a href=\"https://tour.golang.org/concurrency/4\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/4</a>"}, {"owner": {"reputation": 2053, "user_id": 639009, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6b80c2ad9104b5682a98646de86041df?s=128&d=identicon&r=PG", "display_name": "Guy Fawkes", "link": "https://stackoverflow.com/users/639009/guy-fawkes"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555425899, "post_id": 55709797, "comment_id": 98102553, "body": "As I see, you didn&#39;t understood my question. I&#39;ve asked for double select of channel, not about close call."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1555426536, "post_id": 55709797, "comment_id": 98102960, "body": "To give the stop priority. In the second select, if there is work and a stop signal at the same time, one will be chosen at random."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1555431226, "last_edit_date": 1555431226, "creation_date": 1555430798, "answer_id": 55712401, "question_id": 55709797, "link": "https://stackoverflow.com/questions/55709797/understanding-graceful-channel-close-in-go/55712401#55712401", "title": "Understanding graceful channel close in Go", "body": "<p>The key here is to understand how select behaves if multiple cases can proceed, namely pseudo-randomly:</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection.</li>\n  </ol>\n</blockquote>\n\n<p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Select_statements</a></p>\n\n<pre><code>select {\ncase &lt;- stopCh:\n    return\ncase dataCh &lt;- rand.Intn(Max):\n}\n</code></pre>\n\n<p>With only this second select statement, after <code>stopCh</code> has been closed, it is possible that both cases can proceed if at least one of the following is true:</p>\n\n<ol>\n<li>dataCh is buffered and is not at capacity</li>\n<li>at least one goroutine attempts to receive from <code>dataCh</code> even after <code>stopCh</code> has been closed</li>\n</ol>\n\n<p>Without checking <code>stopCh</code> explicitely it is possible (albeit unlikely), that the runtime repeatedly chooses the second case even though the goroutine is expected to exit. If the goroutine happens to launch a missile in every iteration you can see how this may be a problem.</p>\n\n<p>If both of these condition can be positively ruled out, the first select statement can be omitted because it is impossible that both cases are ready to proceed. The Go101 article simply shows a solution that is guaranteed to work, without making any assumptions.</p>\n\n<p>This pattern is not uncommon in real-world code, and typically related to context cancellation:</p>\n\n<pre><code>func f(ctx context.Context, ch chan T) {\n    for {\n        // Make sure we don't shoot after ctx has been\n        // canceled, even if a target is already lined up.\n        select {\n        case &lt;-ctx.Done():\n            return\n        default:\n        }\n\n        // Or, equivalently: if ctx.Err() != nil { return }\n\n\n        select {\n        case &lt;-ctx.Done():\n            return\n        case t := &lt;-ch:\n            launchMissileAt(t)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2053, "user_id": 639009, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6b80c2ad9104b5682a98646de86041df?s=128&d=identicon&r=PG", "display_name": "Guy Fawkes", "link": "https://stackoverflow.com/users/639009/guy-fawkes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 891, "favorite_count": 1, "accepted_answer_id": 55712401, "answer_count": 1, "score": 0, "last_activity_date": 1555431226, "creation_date": 1555422561, "last_edit_date": 1555426084, "question_id": 55709797, "link": "https://stackoverflow.com/questions/55709797/understanding-graceful-channel-close-in-go", "title": "Understanding graceful channel close in Go", "body": "<p>In <a href=\"https://go101.org/article/channel-closing.html\" rel=\"nofollow noreferrer\">this article</a> from Go101 site I have read some trick with double selection for <code>stopCh</code> channel (in section \"2. One receiver, N senders, the only receiver says \"please stop sending more\" by closing an additional signal channel\"). </p>\n\n<p>Could you please describe how it works and do I really need to use it in real-world applications? </p>\n\n<p><strong>UPD</strong>: I don't asked about channel close. I have asked about usage of this part of the code:</p>\n\n<pre><code>        // The try-receive operation is to try\n        // to exit the goroutine as early as\n        // possible. For this specified example,\n        // it is not essential.\n        select {\n        case &lt;- stopCh:\n            return\n        default:\n        }\n\n        // Even if stopCh is closed, the first\n        // branch in the second select may be\n        // still not selected for some loops if\n        // the send to dataCh is also unblocked.\n        // But this is acceptable for this\n        // example, so the first select block\n        // above can be omitted.\n        select {\n        case &lt;- stopCh:\n            return\n        case dataCh &lt;- rand.Intn(Max):\n        }\n</code></pre>\n\n<p>What is the real use case for double selection of <code>stopCh</code>?</p>\n"}, {"tags": ["mongodb", "api", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1555424553, "post_id": 55709681, "comment_id": 98101657, "body": "The field tags in <code>Task</code> are not compatible with <a href=\"https://godoc.org/reflect#StructTag.Get\" rel=\"nofollow noreferrer\">reflect.StructTag.Get</a>.  Separate the pairs with spaces, not tabs.  The <code>go vet</code> command reports this error."}, {"owner": {"reputation": 148, "user_id": 9090874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vZo8E.gif?s=128&g=1", "display_name": "Sergio Guti&#233;rrez", "link": "https://stackoverflow.com/users/9090874/sergio-guti%c3%a9rrez"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555485833, "post_id": 55709681, "comment_id": 98123344, "body": "Yes, I realized 3 hours after &#39;-_-. Thank you for your answer!"}], "owner": {"reputation": 148, "user_id": 9090874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vZo8E.gif?s=128&g=1", "display_name": "Sergio Guti&#233;rrez", "link": "https://stackoverflow.com/users/9090874/sergio-guti%c3%a9rrez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555422217, "creation_date": 1555422217, "question_id": 55709681, "link": "https://stackoverflow.com/questions/55709681/mongodb-pipe-golang-returning-only-one-field-of-four-inside-the-document", "title": "MongoDB pipe (Golang) returning only one field of four inside the document", "body": "<p>I was trying to dump data received from a lookup using mgo/pkg package but when I receive data, dump it and return, I get this output:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code> [\r\n  {\r\n    \"_id\": \"\",\r\n    \"timerId\": \"\",\r\n    \"content\": \"task1\",\r\n    \"creationDate\": 0\r\n  },\r\n  {\r\n    \"_id\": \"\",\r\n    \"timerId\": \"\",\r\n    \"content\": \"task2\",\r\n    \"creationDate\": 0\r\n  },\r\n  {\r\n    \"_id\": \"\",\r\n    \"timerId\": \"\",\r\n    \"content\": \"task3\",\r\n    \"creationDate\": 0\r\n  }\r\n]</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Printing with fmt:</p>\n\n<pre><code>[{ObjectIdHex(\"\") ObjectIdHex(\"\") task1 0} {ObjectIdHex(\"\") ObjectIdHex(\"\") task2 0} {ObjectIdHex(\"\") ObjectIdHex(\"\") task3 0}]  \n</code></pre>\n\n<p>Code that is performing this action:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>func (m *MongoDbRepository) GetTasksOnTheSameDateAsUserTimers(userId string)([]model.Task, error) {\r\n\r\n\tvar tasks []model.Task\r\n\t// m.Db.Session.DB(\"project\").C(\"tasks\")\r\n\tpipe := m.Db.C(\"tasks\").Pipe([]bson.M{\r\n\t\t// bson.M{\r\n\t\t// \t\"$lookup\": bson.M{\r\n\t\t// \t\t\"from\":\t\t\t\"times\",\r\n\t\t// \t\t\"localField\": \t\"timerId\",\r\n\t\t// \t\t\"foreignField\":\t\"_id\",\r\n\t\t// \t\t\"as\":\t\t\t\"timers\",\r\n\t\t// \t},\r\n\t\t// },\r\n\t\t// bson.M{\r\n\t\t// \t\"$lookup\": bson.M{\r\n\t\t// \t\t\"from\":\t\t\t\"users\",\r\n\t\t// \t\t\"localField\": \t\"timers.userId\",\r\n\t\t// \t\t\"foreignField\":\t\"_id\",\r\n\t\t// \t\t\"as\":\t\t\t\"userTasks\",\r\n\t\t// \t},\r\n\t\t// },\r\n\t\t// bson.M{\r\n\t\t// \t\"$project\": bson.M{\r\n\t\t// \t\t\"timers\": 0,\r\n\t\t// \t},\r\n\t\t// },\r\n\t\t// bson.M{\r\n\t\t// \t\"$match\": bson.M{ \r\n\t\t// \t\t\"_id\":bson.ObjectIdHex(\"5cb58c5c4d11610c20b52f1a\"),\r\n\t\t// \t},\r\n\t\t// },\r\n\t})\r\n\r\n\terr := pipe.All(&amp;tasks)\r\n\tfmt.Println(tasks)\r\n\treturn tasks, err\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I have commented all inside pipe because I can't perform the lookup because of I can't get the result of the piping correctly. I know that is a dumping data error because if I change ending lines like this:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var tasksDump []interface{}\r\nerr := pipe.All(&amp;tasksDump)\r\nfmt.Println(tasksDump)</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Then this is the output:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>[map[_id:ObjectIdHex(\"5cb58c5c4d11610c20b52f1a\") content:task1 creationDate:1555400713 timerId:ObjectIdHex(\"5cb5880891b3fb1e2830b743\")] map[_id:ObjectIdHex(\"5cb58ccd4d11610c20b52f1b\") content:task2 creationDate:1555400714 timerId:ObjectIdHex(\"5cb5880891b3fb1e2830b743\")] map[_id:ObjectIdHex(\"5cb58d074d11610c20b52f1c\") content:task3 creationDate:1555400700 timerId:ObjectIdHex(\"5cb5880891b3fb1e2830b743\")]]</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>So data is arriving but when parse I have the issue. Why only content field is being parsed correctly?</p>\n\n<p>Code of the struct where I am dumping data from lookup:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>type Task struct {\r\n\tId\t\t\tbson.ObjectId\t\t`json:\"_id\"\t\t\t\tbson:\"_id\"`\r\n\tTimerId\t\t\tbson.ObjectId\t\t`json:\"timerId\"\t\t\tbson:\"timerId\"`\r\n\tContent\t\t\tstring\t\t\t`json:\"content\"\t\t\tbson:\"content\"`\r\n\tCreationDate\t        int64\t\t\t`json:\"creationDate\"\t bson:\"creationDate\"`\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>MongoDB collection from where I'm receiving data:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zfjvV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zfjvV.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1555415843, "post_id": 55707507, "comment_id": 98096001, "body": "are you sure you want to have the pointer there? IMO you should write <code>var userList []User</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555421173, "post_id": 55707507, "comment_id": 98099282, "body": "The information presented in the question is inconsistent.  All of the example JSON documents unmarshal to a slice with length &gt; 0 (see <a href=\"https://play.golang.org/p/N34S0opAQPp\" rel=\"nofollow noreferrer\">play.golang.org/p/N34S0opAQPp</a>), but a user is only specified in first two."}, {"owner": {"reputation": 11, "user_id": 11368132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4eb954fe36485f5edd96df0d19075c82?s=128&d=identicon&r=PG&f=1", "display_name": "slovet", "link": "https://stackoverflow.com/users/11368132/slovet"}, "edited": false, "score": 0, "creation_date": 1555501540, "post_id": 55707507, "comment_id": 98132331, "body": "Error checking in script before len (userList)  if handler.Error != nil { \t\treturn nil, handler.Error \t}"}], "answers": [{"comments": [{"owner": {"reputation": 34, "user_id": 4053730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K43yr9BGrRg/AAAAAAAAAAI/AAAAAAAAAEk/B3PNv7TkDq8/photo.jpg?sz=128", "display_name": "Magestro", "link": "https://stackoverflow.com/users/4053730/magestro"}, "reply_to_user": {"reputation": 11, "user_id": 11368132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4eb954fe36485f5edd96df0d19075c82?s=128&d=identicon&r=PG&f=1", "display_name": "slovet", "link": "https://stackoverflow.com/users/11368132/slovet"}, "edited": false, "score": 0, "creation_date": 1555417408, "post_id": 55707828, "comment_id": 98096894, "body": "In this case server returns <code>object</code>, not an <code>array</code>.  So this response can&#39;t unmarshall into slice type.  U have at least 2 solutions:   1) Create custom  ``` type UsersResponse struct { \tError struct { \t\tCose int \t\tMsg string \t\tRequestParams map[string]string \t} \tUsers []*User } ``` And create custom unmarshall funcs for this type  2) Check&#39;s error like this: <a href=\"https://play.golang.org/p/a7sUT5T_EOn\" rel=\"nofollow noreferrer\">play.golang.org/p/a7sUT5T_EOn</a>"}], "tags": [], "owner": {"reputation": 34, "user_id": 4053730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K43yr9BGrRg/AAAAAAAAAAI/AAAAAAAAAEk/B3PNv7TkDq8/photo.jpg?sz=128", "display_name": "Magestro", "link": "https://stackoverflow.com/users/4053730/magestro"}, "is_accepted": true, "score": 0, "last_activity_date": 1555416544, "creation_date": 1555416544, "answer_id": 55707828, "question_id": 55707507, "link": "https://stackoverflow.com/questions/55707507/how-to-check-key-for-existence-in-json-rawmessage-on-go/55707828#55707828", "title": "how to check KEY for existence in json.RawMessage on GO?", "body": "<p><code>error: index out of range</code> means that <code>userList</code> have no value with index <code>[0]</code>, not about empty <code>LastName</code></p>\n\n<p>In your example all works fine: <a href=\"https://play.golang.org/p/WHIqgB52w_I\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WHIqgB52w_I</a></p>\n\n<p>A u sure that server returns valid string and that this string exists in the <code>resp.Response</code>? </p>\n\n<p>Try print <code>resp.Response</code> and look for error in other place</p>\n"}], "owner": {"reputation": 11, "user_id": 11368132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4eb954fe36485f5edd96df0d19075c82?s=128&d=identicon&r=PG&f=1", "display_name": "slovet", "link": "https://stackoverflow.com/users/11368132/slovet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 0, "accepted_answer_id": 55707828, "answer_count": 1, "score": 0, "last_activity_date": 1555419939, "creation_date": 1555415469, "last_edit_date": 1555419939, "question_id": 55707507, "link": "https://stackoverflow.com/questions/55707507/how-to-check-key-for-existence-in-json-rawmessage-on-go", "title": "how to check KEY for existence in json.RawMessage on GO?", "body": "<p>I have a:</p>\n\n<pre><code>type User struct {\n    UID                     int          `json:\"id\"`\n    FirstName               string       `json:\"first_name\"`\n    LastName                string       `json:\"last_name\"`\n    Sex                     int          `json:\"sex\"`\n    Nickname                string       `json:\"nickname\"`\n    ScreenName              string       `json:\"screen_name\"`\n    BDate                   string       `json:\"bdate\"`\n\n}\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>var userList []*User\njson.Unmarshal(resp.Response, &amp;userList)\n</code></pre>\n\n<p>server response may be:</p>\n\n<pre><code>[{\"id\":1,\"first_name\":\"name\",\"last_name\":\"last\",\"sex\":2,\"nickname\":\"\",\"screen_name\":\"screen\",\"bdate\":\"1.1.1\"}]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>[{\"id\":1,\"first_name\":\"name\",\"sex\":2,\"nickname\":\"\",\"screen_name\":\"screen\"}]\n</code></pre>\n\n<p>my problem when calling a nonexistent KEY error runtime \"<code>userList[0].LastName</code>\":</p>\n\n<pre><code>error: index out of range\n</code></pre>\n\n<p>in the first case, the server returned:</p>\n\n<pre><code>\"last_name\":\"last\" and \"bdate\":\"1.1.1\"\n</code></pre>\n\n<p>in the second no</p>\n\n<p>When there is no user, the server returns.</p>\n\n<pre><code>[{\"error_code\": 0, \"error_msg\": \"Invalid user id\"}]\n</code></pre>\n\n<p>answer:</p>\n\n<pre><code>    if len(userList) &gt; 0 {\n            c.String(http.StatusOK, \"People name: %s\", userList[0].FirstName)\n        } else {\n            c.String(http.StatusOK, \"No People: %s\", login)\n        }\n</code></pre>\n\n<p>Thank Magestro</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 4015, "user_id": 199587, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b68c07c166a4ec20734a936ce6aad8f7?s=128&d=identicon&r=PG", "display_name": "tristan", "link": "https://stackoverflow.com/users/199587/tristan"}, "edited": false, "score": 1, "creation_date": 1555414175, "post_id": 55707036, "comment_id": 98095033, "body": "missing wg.Wait() before exiting main"}, {"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "reply_to_user": {"reputation": 4015, "user_id": 199587, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b68c07c166a4ec20734a936ce6aad8f7?s=128&d=identicon&r=PG", "display_name": "tristan", "link": "https://stackoverflow.com/users/199587/tristan"}, "edited": false, "score": 0, "creation_date": 1555414343, "post_id": 55707036, "comment_id": 98095110, "body": "@tristan You&#39;re right. added that statement. But it produces <code>all goroutines are asleep - deadlock!</code> error"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555423684, "post_id": 55707036, "comment_id": 98101024, "body": "Your goroutines immediately wait to receive a value on <code>ch</code>. Nothing ever sends any values on <code>ch</code>."}], "answers": [{"comments": [{"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "edited": false, "score": 0, "creation_date": 1555414880, "post_id": 55707151, "comment_id": 98095419, "body": "Thank you, this is very instructive"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1555422462, "last_edit_date": 1555422462, "creation_date": 1555414268, "answer_id": 55707151, "question_id": 55707036, "link": "https://stackoverflow.com/questions/55707036/channels-concurrency-issue/55707151#55707151", "title": "Channels concurrency issue", "body": "<p>When the <code>main()</code> function (the <code>main</code> goroutine) ends, your program ends as well (it doesn't wait for other non-<code>main</code> goroutines to finish). You must add a <code>wg.Wait()</code> call to the end. See <a href=\"https://stackoverflow.com/questions/28958192/no-output-from-goroutine-in-go/28958240#28958240\">No output from goroutine in Go</a>.</p>\n\n<p>Once you do this, you'll hit a deadlock. This is because all goroutines start with attempting to receive a value from the channel, and only then would they send something.</p>\n\n<p>So you should first send something on the channel to let at least one of the goroutines to proceed.</p>\n\n<p>Once you do that, you'll see numbers printed 10 times, and again deadlock. This is because when the last goroutine tries to send its incremented number, there will be no one to receive that. An easy way to fix that is to give a buffer to the channel.</p>\n\n<p>Final, working example:</p>\n\n<pre><code>wg := sync.WaitGroup{}\nch := make(chan int, 2)\n\ncount := func(ch chan int) {\n    var last int\n    last = &lt;-ch\n    last = last + 1\n    fmt.Println(last)\n    ch &lt;- last\n    wg.Done()\n}\n\nwg.Add(10)\nfor i := 1; i &lt;= 10; i++ {\n    go count(ch)\n\n}\ngo func() {\n    ch &lt;- 0\n}()\nwg.Wait()\n</code></pre>\n\n<p>Outputs (try it on the <a href=\"https://play.golang.org/p/UMjtqD5LUk_Y\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n</code></pre>\n\n<p>Also note that since we made the channel buffered, it's not necessary to use another goroutine to send an initial value, we can do that in the <code>main</code> goroutine:</p>\n\n<pre><code>ch &lt;- 0\nwg.Wait()\n</code></pre>\n\n<p>This will output the same. Try it on the <a href=\"https://play.golang.org/p/WjiZNX70jVR\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 3190, "user_id": 2987755, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gHWsA.jpg?s=128&g=1", "display_name": "dkb", "link": "https://stackoverflow.com/users/2987755/dkb"}, "edited": false, "score": 0, "creation_date": 1559793881, "post_id": 56470473, "comment_id": 99532470, "body": "Welcome to SO, please add some explanation too along with the code, it will help your answer to be more acceptable by SO members."}], "tags": [], "owner": {"reputation": 11, "user_id": 3319093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SZ3N0.jpg?s=128&g=1", "display_name": "ambitioner", "link": "https://stackoverflow.com/users/3319093/ambitioner"}, "is_accepted": false, "score": 1, "last_activity_date": 1559790899, "creation_date": 1559790899, "answer_id": 56470473, "question_id": 55707036, "link": "https://stackoverflow.com/questions/55707036/channels-concurrency-issue/56470473#56470473", "title": "Channels concurrency issue", "body": "<pre><code>func main() {\n    wg := sync.WaitGroup{}\n    ch := make(chan int)\n\n    count := func(ch chan int) {\n        var last int\n        last, ok := &lt;-ch // \u8fd9\u91cc\u505a\u4e00\u5c42\u4fdd\u62a4\n        if !ok {\n            return\n        }\n\n        last = last + 1\n        fmt.Println(last)\n\n        go func(ch chan int, res int) {\n            ch &lt;- res\n        }(ch, last)\n\n        wg.Done()\n    }\n\n    go func() {\n        ch &lt;- 0\n    }()\n\n    wg.Add(10)\n    for i := 1; i &lt;= 10; i++ {\n        go count(ch)\n    }\n\n    wg.Wait()\n\n    fmt.Println(\"main finish\")\n    close(ch)\n}\n</code></pre>\n"}], "owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 55707151, "answer_count": 2, "score": 3, "last_activity_date": 1582537750, "creation_date": 1555413880, "last_edit_date": 1582537750, "question_id": 55707036, "link": "https://stackoverflow.com/questions/55707036/channels-concurrency-issue", "title": "Channels concurrency issue", "body": "<p>I am experimenting with channel concept in Go. I wrote the below program <a href=\"https://play.golang.org/p/F-134OkQuFQ\" rel=\"nofollow noreferrer\">playground</a> to implement counter using channels. But I am not getting any output, although I am doing some printing in the goroutine body.</p>\n\n<pre><code>func main() {\n    wg := sync.WaitGroup{}\n    ch := make(chan int)\n\n    count := func(ch chan int) {\n        var last int\n        last = &lt;-ch\n        last = last + 1\n        fmt.Println(last)\n        ch &lt;- last\n        wg.Done()\n    }\n\n    wg.Add(10)\n    for i := 1; i &lt;= 10; i++ {\n        go count(ch)\n\n    }\n}\n</code></pre>\n\n<p>I expect at least some output but I am getting none at all.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 3, "last_activity_date": 1555488315, "creation_date": 1555488315, "answer_id": 55722762, "question_id": 55706317, "link": "https://stackoverflow.com/questions/55706317/setting-consistency-rules-to-monotonic-for-a-session-with-the-official-mongo-go/55722762#55722762", "title": "Setting consistency rules to monotonic for a session with the official Mongo Go driver mongo-go-driver (session.SetMode in mgo)", "body": "<blockquote>\n  <p>My understanding of doing so is to ensure: \"If a process reads the value of a data item x, any successive read operation on x by that process will always return that same value or a more recent value.\"</p>\n</blockquote>\n\n<p>Yes, but not always. Let's look into the code comment for Monotonic mode <a href=\"https://github.com/globalsign/mgo/blob/master/session.go#L73\" rel=\"nofollow noreferrer\">session.go#L73</a>:</p>\n\n<pre><code>// Monotonic mode is specific to mgo, and is same as SecondaryPreferred before first write. \n// Same as Primary after first write.\nMonotonic Mode = 1\n</code></pre>\n\n<p>According to <a href=\"https://godoc.org/github.com/globalsign/mgo#Session.SetMode\" rel=\"nofollow noreferrer\">godoc.org/github.com/globalsign/mgo</a> for <code>SetMode()</code>: </p>\n\n<blockquote>\n  <p>In the Monotonic consistency mode reads may not be entirely\n  up-to-date, but they will always see the history of changes moving\n  forward, the data read will be consistent across sequential queries in\n  the same session, and modifications made within the session will be\n  observed in following queries (read-your-writes).</p>\n  \n  <p>In practice, the Monotonic mode is obtained by performing initial\n  reads on a unique connection to an arbitrary secondary, if one is\n  available, and once the first write happens, the session connection is\n  switched over to the primary server. This manages to distribute some\n  of the reading load with secondaries, while maintaining some useful\n  guarantees.</p>\n</blockquote>\n\n<p>For most of the cases this is true, however there could be instances where <code>SecondaryPreferred</code> may choose <em>different</em> secondaries that could have different <a href=\"https://docs.mongodb.com/manual/core/replica-set-oplog/\" rel=\"nofollow noreferrer\">Oplog</a> times. </p>\n\n<blockquote>\n  <p>How would I do this using the official driver? </p>\n</blockquote>\n\n<p>Monotonic mode is a term specific for mgo, and does not exist for <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">MongoDB Go driver</a>. This has been superseded by new features such as <a href=\"https://docs.mongodb.com/manual/core/read-isolation-consistency-recency/#causal-consistency\" rel=\"nofollow noreferrer\">causal consistency</a> and/or <a href=\"https://docs.mongodb.com/manual/core/transactions/\" rel=\"nofollow noreferrer\">multi-document transactions</a>. </p>\n\n<p><code>mongo-go-driver</code> is more verbose, but also to provide more control over <a href=\"https://docs.mongodb.com/manual/core/read-preference/\" rel=\"nofollow noreferrer\">read preferences</a>, <a href=\"https://docs.mongodb.com/manual/reference/read-concern/\" rel=\"nofollow noreferrer\">read concern</a>, and <a href=\"https://docs.mongodb.com/manual/core/replica-set-write-concern/\" rel=\"nofollow noreferrer\">write concern</a></p>\n\n<p>Example of causal consistency: </p>\n\n<pre><code>opts := options.Client().ApplyURI(mongoURI).SetReadPreference(readpref.Secondary()).SetReadConcern(readconcern.Majority()).SetWriteConcern(writeconcern.New(writeconcern.WMajority()))\nclient, err := mongo.NewClient(opts)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>For transactions example see <a href=\"https://docs.mongodb.com/manual/core/transactions/#transactions-in-applications\" rel=\"nofollow noreferrer\">Transactions in Applications</a> (Choose <code>Go</code> language on the tab)</p>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 55722762, "answer_count": 1, "score": 0, "last_activity_date": 1555488315, "creation_date": 1555411480, "question_id": 55706317, "link": "https://stackoverflow.com/questions/55706317/setting-consistency-rules-to-monotonic-for-a-session-with-the-official-mongo-go", "title": "Setting consistency rules to monotonic for a session with the official Mongo Go driver mongo-go-driver (session.SetMode in mgo)", "body": "<p>We're switching to the official driver, away from the deprecated mgov2</p>\n\n<p>In mgo we set the session mode to be monotonic like this:</p>\n\n<pre><code>myMongoSession.SetMode(mgo.Monotonic, true)\n</code></pre>\n\n<p>My understanding of doing so is to ensure: \"If a process reads the value of a data item x, any successive read operation on x by that process will always return that same value or a more recent value.\"</p>\n\n<p>This is important for us</p>\n\n<p>How would I do this using the official driver? I can't find a reference to doing so</p>\n"}, {"tags": ["mongodb", "go", "aggregate", "bson", "mgo"], "owner": {"reputation": 31, "user_id": 4013836, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mICknyEafNI/AAAAAAAAAAI/AAAAAAAAAJw/WkdbRBF5uAc/photo.jpg?sz=128", "display_name": "Shreya Shah", "link": "https://stackoverflow.com/users/4013836/shreya-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555409988, "creation_date": 1555408669, "last_edit_date": 1555409988, "question_id": 55705448, "link": "https://stackoverflow.com/questions/55705448/how-to-aggregate-in-mgo-bson-for-a-field-type-mapstringuint32", "title": "How to aggregate in mgo bson for a field type map[string]uint32?", "body": "<p>I am trying to get aggregated values from a mongo collection using bson and Golang where the field used in Golang is of type <code>map[string]uint32</code>.</p>\n\n<p>This is the struct am using and the field is <code>Csat</code>.</p>\n\n<pre><code>type Conversations struct {\n     ID   bson.ObjectId     `bson:\"_id\"`\n     Csat map[string]uint32 `bson:\"csat\"`\n\n}\n</code></pre>\n\n<p>The output using bson should be in key value pairs, these are some examples I tried but did not work,</p>\n\n<p>1.</p>\n\n<pre><code>bson.M{\n\n    \"csat[\"1\"]\": bson.M{\n        \"$sum\": bson.M{\"$cond\": []interface{}{bson.M{\"$eq\": []interface{}{\"$score\", 1}}, 1, 0}},\n    },\n    \"csat[\"2\"]\": bson.M{\n        \"$sum\": bson.M{\"$cond\": []interface{}{bson.M{\"$eq\": []interface{}{\"$score\", 2}}, 1, 0}},\n    }\n</code></pre>\n\n<p>2.</p>\n\n<pre><code>bson.M{\n        \"csat\": bson.M{\n            \"1\": bson.M{\n                \"$sum\": bson.M{\"$cond\": []interface{}{bson.M{\"$eq\": []interface{}{\"$score\", 1}}, 1, 0}},\n            },\n            \"2\": bson.M{\n                \"$sum\": bson.M{\"$cond\": []interface{}{bson.M{\"$eq\": []interface{}{\"$score\", 2}}, 1, 0}},\n            },\n        }\n    }\n</code></pre>\n\n<p>I expect it to store it like <code>{\"csat\": {\"1\": 3}, {\"2\": 2}, ...}</code> where 3 and 2 could be values of the keys.</p>\n\n<p>If anyone has done something like this before, can you please help me out? </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1555408632, "post_id": 55705135, "comment_id": 98091747, "body": "I believe you&#39;re not missing anything in the doc, the matching of months in the layout is case sensitive, and your solution seems valid to me."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1555409081, "post_id": 55705135, "comment_id": 98092030, "body": "<a href=\"https://github.com/golang/go/blob/master/src/time/format.go#L154-L162\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/time/format.go#L154-L16&zwnj;&#8203;2</a>"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1555409318, "post_id": 55705135, "comment_id": 98092143, "body": "yeah, I know, it is quite unfortunate for go that we can&#39;t use date modifiers, which are much more powerful, or is it there any advantage of using layout"}], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1555410817, "creation_date": 1555407768, "question_id": 55705135, "link": "https://stackoverflow.com/questions/55705135/format-time-month-to-capital-letter", "title": "Format time month to Capital letter", "body": "<p>I want to format time to</p>\n\n<blockquote>\n  <p>2006/JAN/hello02JAN2006file.csv.zip</p>\n</blockquote>\n\n<p>It contains month name in Capital letter,</p>\n\n<p>say <code>downloadDate</code> is <code>time.Time</code></p>\n\n<p><code>downloadDate.Format(\"2006/JAN/hello02JAN2006file.csv.zip\")</code> won't convert <code>JAN</code> to Month name, as it won't parse JAN, it will need <code>Jan</code> ,If I give it <code>Jan</code> , then month name will also be like this ( <code>Apr</code>, <code>May</code>, ...) while I need <code>APR</code> or <code>MAY</code></p>\n\n<p>my solution to work around here is to replace JAN by using <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\">strings.Replace</a> method</p>\n\n<pre><code>strings.Replace(downloadDate.Format(\"2006/JAN/hello02JAN2006file.csv.zip\"), \"JAN\", strings.ToUpper(downloadDate.Format(\"Jan\")), -1)\n</code></pre>\n\n<p>am I missing something in <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">time.Time</a> doc, or above is the only way to accomplish this ?</p>\n"}, {"tags": ["go", "go-sqlite3"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1555405274, "post_id": 55704072, "comment_id": 98089645, "body": "What about <code>select count(*) from tags</code>? And then <code>SELECT id, name FROM tags LIMIT 100</code>. <a href=\"https://www.guru99.com/sqlite-query.html#4\" rel=\"nofollow noreferrer\">guru99.com/sqlite-query.html#4</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555405629, "post_id": 55704072, "comment_id": 98089871, "body": "No, it does not load everything into memory. It fetches data as required as Next() is called."}, {"owner": {"reputation": 2760, "user_id": 2053319, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VuROw.jpg?s=128&g=1", "display_name": "Suren Raju", "link": "https://stackoverflow.com/users/2053319/suren-raju"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1555406758, "post_id": 55704072, "comment_id": 98090538, "body": "@RickyA yes, we can write a custom logic. But i am wondering if there is an option from standard library."}, {"owner": {"reputation": 2760, "user_id": 2053319, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VuROw.jpg?s=128&g=1", "display_name": "Suren Raju", "link": "https://stackoverflow.com/users/2053319/suren-raju"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555406814, "post_id": 55704072, "comment_id": 98090574, "body": "@Peter does it make million calls to db of million rows matching rows?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1555407060, "post_id": 55704072, "comment_id": 98090743, "body": "@SurenRaju you can take tcpdump/wireshark and see what actual happens under the hood."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1555413153, "post_id": 55704072, "comment_id": 98094435, "body": "You should add <code>defer results.Close()</code>, too, and you can declare <code>var tag Tag</code> outside of the loop, and reuse the same variable inside"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555423442, "post_id": 55705575, "comment_id": 98100848, "body": "I may be wrong but I think OP is asking if the program (client) loads it all into memory, not if the database loads it all into memory."}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555425983, "post_id": 55705575, "comment_id": 98102605, "body": "Yes, the program is using the database&#39;s functionality. What I said still holds."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555426413, "post_id": 55705575, "comment_id": 98102882, "body": "Not really. Your answer talks about what the database will do with its memory, the question is about what the client will do with its memory. These are likely running on different machines, so what the database does with the memory on the database host is largely irrelevant to the matter of the client using memory on its own host."}], "tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": false, "score": 0, "last_activity_date": 1555409650, "last_edit_date": 1555409650, "creation_date": 1555409081, "answer_id": 55705575, "question_id": 55704072, "link": "https://stackoverflow.com/questions/55704072/how-to-set-fetch-size-in-golang/55705575#55705575", "title": "How to set fetch size in golang?", "body": "<p>This will work just fine for a single row and millions of rows. Most SQL implementations have the notion of batches when reading. They load data from the disk as needed and keeps RAM usage low/constant as needed.</p>\n\n<p>For example if you are selecting 1000 rows. The database may load the first 100 rows to the RAM.\nWhile you are calling <code>Next()</code>, for example when you reach the 50th row, the database grabs another hundred (rows 100 to 201 for example).</p>\n"}], "owner": {"reputation": 2760, "user_id": 2053319, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VuROw.jpg?s=128&g=1", "display_name": "Suren Raju", "link": "https://stackoverflow.com/users/2053319/suren-raju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 580, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555915739, "creation_date": 1555404428, "last_edit_date": 1555406952, "question_id": 55704072, "link": "https://stackoverflow.com/questions/55704072/how-to-set-fetch-size-in-golang", "title": "How to set fetch size in golang?", "body": "<p>I am trying to load a huge data set from DB. </p>\n\n<pre><code>    func main() {\n        db, err := sql.Open(\"mysql\", \"root:pass1@tcp(127.0.0.1:3306)/tuts\")\n\n        if err != nil {\n            log.Print(err.Error())\n        }\n        defer db.Close()\n        results, err := db.Query(\"SELECT id, name FROM tags\")\n        if err != nil {\n            panic(err.Error()) \n        }\n\n        for results.Next() {\n            var tag Tag\n            err = results.Scan(&amp;tag.ID, &amp;tag.Name)\n            if err != nil {\n                panic(err.Error()) \n            }\n\n            log.Printf(tag.Name)\n        }\n}\n</code></pre>\n\n<p>Does the program load all the records to memory in single shot? Or is there any way to specify the fetch size so that program will load only n of rows at a time? Assuming there are million rows in the database, i would like to fetch 1000 records each time.</p>\n"}, {"tags": ["mongodb", "go", "do-while"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555397875, "post_id": 55702259, "comment_id": 98085634, "body": "Please show us what you&#39;ve tried and what concrete problems you&#39;re having. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "owner": {"reputation": 312, "user_id": 4920026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KR0NK.jpg?s=128&g=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/4920026/priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1556707564, "creation_date": 1555397761, "last_edit_date": 1556707564, "question_id": 55702259, "link": "https://stackoverflow.com/questions/55702259/golang-building-mongo-query-from-nested-map-structure", "title": "Golang Building Mongo Query From Nested Map Structure", "body": "<p>I have Json structure like below. </p>\n\n<pre><code>{  \n \"type\":\"LogicalExpression\",\n \"operator\":\"&amp;&amp;\",\n \"left\":{  \n   \"type\":\"BinaryExpression\",\n  \"operator\":\"&gt;\",\n  \"left\":{  \n     \"name\":\"stage3_num1\",\n     \"type\":\"Identifier\"\n  },\n  \"right\":{  \n     \"value\":50,\n     \"raw\":\"50\",\n     \"type\":\"Literal\"\n  }\n },\n \"right\":{  \n  \"type\":\"LogicalExpression\",\n  \"operator\":\"||\",\n  \"left\":{  \n     \"type\":\"BinaryExpression\",\n     \"operator\":\"&gt;\",\n     \"left\":{  \n        \"name\":\"stage3_num2\",\n        \"type\":\"Identifier\"\n     },\n     \"right\":{  \n        \"type\":\"Literal\",\n        \"value\":200,\n        \"raw\":\"200\"\n     }\n  },\n  \"right\":{  \n     \"type\":\"BinaryExpression\",\n     \"operator\":\"&lt;=\",\n     \"left\":{  \n        \"type\":\"Identifier\",\n        \"name\":\"stage3_num3\"\n     },\n     \"right\":{  \n        \"value\":2000,\n        \"raw\":\"2000\",\n        \"type\":\"Literal\"\n     }\n   }\n }\n}\n</code></pre>\n\n<p>I want to build Mongo query from above structure where 'operator' denotes  binary or logical expression, and 'left','right' denotes fields and value. But I am unable to handle logical expression inside logical expression in an infinte loop. Any ideas, suggestion towards solution will be a great help.</p>\n\n<p><strong>Edit:</strong></p>\n\n<pre class=\"lang-go prettyprint-override\"><code>    query := bson.M{}\n    filter := jsonmap\n        for key, val := range filter {\n            if key == \"type\" &amp;&amp; val == \"BinaryExpression\" {\n                a := sel(filter)\n                query = a\n            } else if key == \"type\" &amp;&amp; val == \"LogicalExpression\" {\n                mongoparam := GetmongoParam(query[\"operator\"].(string))\n                query[mongoparam] = []bson.M{}\n                //Further operations..\n            }\n        }\n</code></pre>\n\n<p>Where sel is func -</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func sel(query map[string]interface{}) bson.M {\n    result := make(bson.M, len(query))\n    mongoparam := GetmongoParam(query[\"operator\"].(string))\n    var left string\n    var right interface{}\n    md, ok := query[\"left\"].(map[string]interface{})\n    if ok {\n        if md[\"type\"] == \"Identifier\" {\n            left = md[\"name\"].(string)\n        }\n    }\n    rd, ok := query[\"right\"].(map[string]interface{})\n    if ok {\n        if rd[\"type\"] == \"Identifier\" {\n            right = rd[\"name\"]\n        } else {\n            right = rd[\"value\"]\n        }\n    }\n    result[left] = bson.M{mongoparam: right}\n    return result\n}\n</code></pre>\n\n<p>I am just unable to proceed in nested maps and not getting how to iterate till 'type' is 'LogicalExpression', and append queries together.</p>\n"}, {"tags": ["json", "string", "go", "unicode", "emoji"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1555388610, "post_id": 55700149, "comment_id": 98082558, "body": "Stuff like <code>&quot;\\\\U0001f417&quot;</code> is <i>not</i> a code point but a string you need to parse to finde the code point. Unfortunately the default function from the stdlib strconv.Unquote cannot be applied directly as it a) requires extra quotes and b) a lowercase <code>u</code>. So: strip anything not a number and leading zeros, parse the hex digit and format that code point with the %c verb of fmt.Printf."}, {"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1555418068, "post_id": 55700149, "comment_id": 98097248, "body": "Ah that&#39;s a great pro-tip. Thanks for contributing!"}], "answers": [{"comments": [{"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "edited": false, "score": 0, "creation_date": 1555418116, "post_id": 55700686, "comment_id": 98097271, "body": "This is a neat alternative solution! Thanks for adding it in."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 3, "last_activity_date": 1555389736, "creation_date": 1555389736, "answer_id": 55700686, "question_id": 55700149, "link": "https://stackoverflow.com/questions/55700149/print-emoji-from-unicode-literal-loaded-from-file/55700686#55700686", "title": "Print emoji from Unicode literal loaded from file", "body": "<p>You can do this? <a href=\"https://play.golang.org/p/4mFQfyqeAXN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4mFQfyqeAXN</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"html\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    xx := \"\\\\U0001f47f\"\n\n    // Hex String\n    h := strings.ReplaceAll(xx, \"\\\\U\", \"0x\")\n\n    // Hex to Int\n    i, _ := strconv.ParseInt(h, 0, 64)\n\n    // Unescape the string (HTML Entity -&gt; String).\n    str := html.UnescapeString(string(i))\n\n    // Display the emoji.\n    fmt.Println(str)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "edited": false, "score": 0, "creation_date": 1555417967, "post_id": 55700990, "comment_id": 98097193, "body": "This is really great! Thanks for adding in the comments too; I&#39;m always tripped up by string encoding."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1555392067, "last_edit_date": 1555392067, "creation_date": 1555391721, "answer_id": 55700990, "question_id": 55700149, "link": "https://stackoverflow.com/questions/55700149/print-emoji-from-unicode-literal-loaded-from-file/55700990#55700990", "title": "Print emoji from Unicode literal loaded from file", "body": "<p>Use the following function to convert a rune specified in the format <code>\\Uxxxxxxxx</code> to the actual rune:</p>\n\n<pre><code>func unquoteCodePoint(s string) (rune, error) {\n    // 16 specifies hex encoding\n    // 32 is size in bits of the rune type\n    r, err := strconv.ParseInt(strings.TrimPrefix(s, \"\\\\U\"), 16, 32)\n    return rune(r), err\n}\n</code></pre>\n\n<p>A variation is to convert to a string instead of a rune:</p>\n\n<pre><code>func unquoteCodePoint(s string) (string, error) {\n    r, err := strconv.ParseInt(strings.TrimPrefix(s, \"\\\\U\"), 16, 32)\n    return string(r), err\n}\n</code></pre>\n\n<p>Use the string version like this:</p>\n\n<pre><code>s, err := unquoteCodePoint(\"\\\\U0001f47f\")\nif err != nil {\n    // handle error\n}\nfmt.Printf(\"%s\\n\", s) // prints  \ud83d\udc7f\n</code></pre>\n"}], "owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3034, "favorite_count": 2, "accepted_answer_id": 55700990, "answer_count": 2, "score": 1, "last_activity_date": 1584611107, "creation_date": 1555385408, "last_edit_date": 1584611107, "question_id": 55700149, "link": "https://stackoverflow.com/questions/55700149/print-emoji-from-unicode-literal-loaded-from-file", "title": "Print emoji from Unicode literal loaded from file", "body": "<p>I am attempting to print Unicode emoji characters loaded from a JSON file using Go.\nWhen I load and unmarshal my file, the struct field passed to <code>fmt.Println</code> only prints the escaped string sequence.</p>\n\n<p>For example, one string is stored within the file as <code>{\u2026\"Unicode\":\"\\\\U0001f47f\"}</code> and printing it yields <code>\\U0001f417</code> and not the emoji character.\nCalling <code>fmt.Printf(\"%q\", str)</code> yields <code>\\\\U0001f417</code>. I wasn't able to find a solution and I am bit stumped. I have attempted to remove the escape sequence and concatenate it within a template string, but it has no impact. I also attempted to use a string buffer but it didn't work either.</p>\n"}, {"tags": ["python", "python-3.x", "go"], "comments": [{"owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "edited": false, "score": 0, "creation_date": 1555382716, "post_id": 55699760, "comment_id": 98081345, "body": "It&#39;s just converting from hex to binary. Every two hex digits is an 8-bit byte (256 possible values)."}, {"owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "reply_to_user": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "edited": false, "score": 0, "creation_date": 1555383921, "post_id": 55699760, "comment_id": 98081591, "body": "@TigerhawkT3 sorry, <code>binascii.unhexlify</code> is simple"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555390368, "post_id": 55699760, "comment_id": 98082972, "body": "In case this isn&#39;t an exercise, production code should of course use the standard library: <a href=\"https://golang.org/pkg/encoding/hex/#Decode\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/hex/#Decode</a>."}, {"owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555390513, "post_id": 55699760, "comment_id": 98083016, "body": "@Peter tks, It&#39;s what i want"}], "answers": [{"tags": [], "owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "is_accepted": false, "score": -1, "last_activity_date": 1555390540, "last_edit_date": 1555390540, "creation_date": 1555384018, "answer_id": 55699978, "question_id": 55699760, "link": "https://stackoverflow.com/questions/55699760/go-how-to-implement-python-binascii-unhexlify-method/55699978#55699978", "title": "go how to implement python binascii.unhexlify method?", "body": "<p><code>binascii.unhexlify</code> method is simple enough.\nIt's just converting from hex to binary. Every two hex digits is an 8-bit byte (256 possible values).\nhere is my code</p>\n\n<pre><code>func unhexlify(str string) []byte {\n    res := make([]byte, 0)\n    for i := 0; i &lt; len(str); i+=2 {\n        x, _ := strconv.ParseInt(str[i:i+2], 16, 32)\n        res = append(res, byte(x))\n    }\n    return res\n}\n</code></pre>\n\n<hr>\n\n<p><strong>I should use the library</strong></p>\n\n<pre><code>func ExampleDecodeString() {\n    const s = \"48656c6c6f20476f7068657221\"\n    decoded, err := hex.DecodeString(s)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%s\\n\", decoded)\n\n    // Output:\n    // Hello Gopher!\n}\n</code></pre>\n"}], "owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 585, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1555390540, "creation_date": 1555382102, "question_id": 55699760, "link": "https://stackoverflow.com/questions/55699760/go-how-to-implement-python-binascii-unhexlify-method", "title": "go how to implement python binascii.unhexlify method?", "body": "<p>In my company there is a system written in python and I want to reimplement it using golang. </p>\n\n<h1>Question</h1>\n\n<p>Python <code>binascii.unhexlify</code> seems complex, and I don't know hot to implement it in go.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1555389704, "post_id": 55699773, "comment_id": 98082811, "body": "Also note that net.IP&#39;s underlying type is a byte slice, so for all intends and purposes it already <i>is</i> an intuitive binary representation for IP addresses."}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 1, "creation_date": 1555394026, "post_id": 55699773, "comment_id": 98084092, "body": "sorry, still a bit unclear to me - how do I convert an ipv4 address to type <code>[4]uint8</code>?  <a href=\"https://play.golang.org/p/mCBenQAf7j1\" rel=\"nofollow noreferrer\">play.golang.org/p/mCBenQAf7j1</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 1, "creation_date": 1555394228, "post_id": 55699773, "comment_id": 98084166, "body": "@struggling_learner That&#39;s a bit different. And it&#39;s not very likely that you actually need to do that. What is the actual context here?"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1555394776, "post_id": 55699773, "comment_id": 98084388, "body": "Almost like:  <a href=\"https://sourcegraph.com/github.com/golang/net/-/blob/dns/dnsmessage/example_test.go#L45\" rel=\"nofollow noreferrer\">sourcegraph.com/github.com/golang/net/-/blob/dns/dnsmessage/&zwnj;&#8203;&hellip;</a> - need to send an ipv4 address across in 4 bytes"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1555396012, "post_id": 55699773, "comment_id": 98084888, "body": "this! yes! thank you! if  you would it post this as an answer I would mark it as the accepted answer. (also, could you kindly include a ipv6 To16() example?)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555424323, "post_id": 55699773, "comment_id": 98101477, "body": "Exactly the same but with a larger byte array."}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 8, "last_activity_date": 1555382507, "last_edit_date": 1555382507, "creation_date": 1555382200, "answer_id": 55699773, "question_id": 55699616, "link": "https://stackoverflow.com/questions/55699616/golang-convert-ipv4-and-ipv6-addresses-from-text-to-binary-form/55699773#55699773", "title": "golang: convert IPv4 and IPv6 addresses from text to binary form", "body": "<p><a href=\"https://golang.org/pkg/net/#ParseIP\" rel=\"noreferrer\"><code>net.ParseIP()</code></a> will take an IPv4 or IPv6 formatted string and return a <a href=\"https://golang.org/pkg/net/#IP\" rel=\"noreferrer\"><code>net.IP</code></a> containing the IP address.</p>\n\n<p>The <code>net.IP</code> is what you'll need to feed to most other Go functions, such as to make a connection to the host.</p>\n\n<p>Note that unlike most Go functions which return an error, <code>net.ParseIP()</code> simply returns <code>nil</code> if the string could not be parsed into an IP address.</p>\n\n<p><a href=\"https://play.golang.org/p/Cgsrgth7JKY\" rel=\"noreferrer\">https://play.golang.org/p/Cgsrgth7JKY</a></p>\n"}, {"comments": [{"owner": {"reputation": 3752, "user_id": 180770, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/984685773ab2d725ffd59e204a94eb37?s=128&d=identicon&r=PG", "display_name": "rancidfishbreath", "link": "https://stackoverflow.com/users/180770/rancidfishbreath"}, "edited": false, "score": 0, "creation_date": 1614811662, "post_id": 64307682, "comment_id": 117502587, "body": "You can add 08 to the string interpolation to pad with zeros: <code>fmt.Printf(&quot;%08b&quot;, net.IP.To4(a))</code>. Also the %s gives me a warning."}], "tags": [], "owner": {"reputation": 186, "user_id": 459564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab3ba2a27daae0ae7b3431f02cfb4403?s=128&d=identicon&r=PG", "display_name": "3molo", "link": "https://stackoverflow.com/users/459564/3molo"}, "is_accepted": false, "score": 1, "last_activity_date": 1602618441, "last_edit_date": 1602618441, "creation_date": 1602441273, "answer_id": 64307682, "question_id": 55699616, "link": "https://stackoverflow.com/questions/55699616/golang-convert-ipv4-and-ipv6-addresses-from-text-to-binary-form/64307682#64307682", "title": "golang: convert IPv4 and IPv6 addresses from text to binary form", "body": "<p>Either you can use the net package:\n`</p>\n<pre><code>a := net.ParseIP(&quot;127.0.0.1&quot;)\nfmt.Printf(&quot;%b %s&quot;, net.IP.To4(a))\n</code></pre>\n<p>`\n<a href=\"https://play.golang.org/p/KzqYpk9OBh8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KzqYpk9OBh8</a></p>\n<p>Or, you can split the IP and convert each value into an integer using strconv.Atoi(), and thereafter convert each integer into byte()</p>\n<p>`</p>\n<pre><code>ipString := &quot;127.0.0.1&quot;\n\noctets := strings.Split(ipString, &quot;.&quot;)\n\noctet0, _ := strconv.Atoi(octets[0])\noctet1, _ := strconv.Atoi(octets[1])\noctet2, _ := strconv.Atoi(octets[2])\noctet3, _ := strconv.Atoi(octets[3])\n\nb := [4]byte{byte(octet0),byte(octet1),byte(octet2),byte(octet3)}\n\nfmt.Printf(&quot;%s has 4-byte representation of %b\\n&quot;, ipString, b)\n</code></pre>\n<p>`\n<a href=\"https://play.golang.org/p/2F3bC0df9wB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2F3bC0df9wB</a></p>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2339, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1602618441, "creation_date": 1555380823, "last_edit_date": 1555395681, "question_id": 55699616, "link": "https://stackoverflow.com/questions/55699616/golang-convert-ipv4-and-ipv6-addresses-from-text-to-binary-form", "title": "golang: convert IPv4 and IPv6 addresses from text to binary form", "body": "<p>looking to send an ipv4 address across in 4 bytes, and ipv6 address in 16 bytes - What's similar to <a href=\"https://beej.us/guide/bgnet/html/multi/inet_ntopman.html\" rel=\"nofollow noreferrer\"><code>inet_pton()</code></a> in go?</p>\n\n<pre><code>struct sockaddr_in sa;\nchar str[INET_ADDRSTRLEN];\ninet_pton(AF_INET, \"192.0.2.33\", &amp;(sa.sin_addr));\n\nstruct sockaddr_in6 sa;\nchar str[INET6_ADDRSTRLEN];\ninet_pton(AF_INET6, \"2001:db8:8714:3a90::12\", &amp;(sa.sin6_addr));\n</code></pre>\n\n<p>I know of <a href=\"https://play.golang.org/p/jn8t7zJzT5v\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jn8t7zJzT5v</a> - that is looking complicated for IPV6 addresses though. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1555388841, "post_id": 55699470, "comment_id": 98082609, "body": "Instead of the convenience http.ListenAndServe construct your own <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Server</a>. Let that one ListenAndServe in a own goroutine and Shutdown it once your test is done."}], "answers": [{"tags": [], "owner": {"reputation": 2808, "user_id": 98596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/213851cc1f442df8f40b000f59ecb08a?s=128&d=identicon&r=PG", "display_name": "ftl", "link": "https://stackoverflow.com/users/98596/ftl"}, "is_accepted": true, "score": 2, "last_activity_date": 1555424236, "creation_date": 1555424236, "answer_id": 55710364, "question_id": 55699470, "link": "https://stackoverflow.com/questions/55699470/how-to-test-refactor-to-test-a-function-that-calls-http-listenandserve/55710364#55710364", "title": "How to test/refactor-to-test a function that calls http.ListenAndServe", "body": "<p>You can build a test harness using a goroutine to execute <code>Run</code> in your unit test:</p>\n\n<pre><code>func TestRun(t *testing.T) {\n    service := Service{}\n    serviceRunning := make(chan struct{})\n    serviceDone := make(chan struct{})\n    go func() {\n        close(serviceRunning)\n        err := service.Run()            \n        defer close(serviceDone)\n    }()\n\n    // wait until the goroutine started to run (1)\n    &lt;-serviceRunning\n\n    //\n    // interact with your service to test whatever you want\n    //\n\n    // stop the service (2)\n    service.Shutdown()\n\n    // wait until the service is shutdown (3)\n    &lt;-serviceDone\n}\n</code></pre>\n\n<p>This is just a basic example to show how it could be done in principle. There are several points that should be improved for use in production:</p>\n\n<p>(0) The most important detail: <strong>Do not use <code>http.ListenAndServe</code> in production!</strong> Create your own instance of <code>http.Server</code> instead. This saves you a lot of trouble.</p>\n\n<pre><code>s.httpServer := http.Server {\n    Addr: \":8080\",\n    Handler: s.mux,\n}\n</code></pre>\n\n<p>(1) The indication that the service is running should be moved into your <code>Service</code> type. The initialization part in <code>Run</code> might take a while and the indication channel should be closed right before <code>ListenAndServe</code> is called:</p>\n\n<pre><code>close(s.Running)\ns.httpServer.ListenAndServe()\n</code></pre>\n\n<p>Of course, you need to add the indication channel to your Service type.</p>\n\n<p>(2) Add a <code>Shutdown</code> method to <code>Service</code> that calls <code>s.httpServer.Shutdown()</code>. This will cause the call to <code>s.httpServer.ListenAndServe</code> to return with the error <code>http.ErrServerClosed</code>. </p>\n\n<pre><code>if err := s.httpServer.ListenAndServe(); err != nil &amp;&amp; err != http.ErrServerClosed {\n    return err\n}\nreturn nil\n</code></pre>\n\n<p>It is important to shutdown your service at the end of the test. Otherwise you will not be able to have more than one unit test for your service. And it is good citizenship anyway to clean up the resources.</p>\n\n<p>(3) You need to wait until <code>service.Run</code> returned to make sure that the service is actually shutdown.</p>\n"}], "owner": {"reputation": 68, "user_id": 1825572, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0484029346011a34fb5a5967b138781b?s=128&d=identicon&r=PG", "display_name": "code123456", "link": "https://stackoverflow.com/users/1825572/code123456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "accepted_answer_id": 55710364, "answer_count": 1, "score": 0, "last_activity_date": 1555424236, "creation_date": 1555379572, "last_edit_date": 1555383483, "question_id": 55699470, "link": "https://stackoverflow.com/questions/55699470/how-to-test-refactor-to-test-a-function-that-calls-http-listenandserve", "title": "How to test/refactor-to-test a function that calls http.ListenAndServe", "body": "<p>I'm learning go and am working on a simple service that ingests some data from a queue and sticks it in the database. It also runs a web server to allow scraping of data. Right now I have two go files (omitted some text for brevity):</p>\n\n<pre><code>func main() {\n    parseConfig()\n\n    s := &amp;Service{ServiceConfig: config}\n    err := s.Run()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>And then the definition of the service (again left out some pieces for brevity):</p>\n\n<pre><code>func (s *Service) Run() error {\n\n    if err := s.validate(); err != nil {\n        return err\n    }\n\n    if err := s.initDB(); err != nil {\n        return err\n    }\n    defer s.db.Close()\n\n    // Same pattern with health check library (init, start, close)\n    // Same pattern starting queue consumer (init, start, close)\n\n    s.mux = http.NewServeMux()\n    s.registerHandlers(s.mux)\n\n    http.ListenAndServe(\":8080\", s.mux)\n\n    return nil\n}\n</code></pre>\n\n<p>And the struct</p>\n\n<pre><code>type Service struct {\n    Config // Hold db connection info\n    db  *sql.DB\n    hc  *health\n}\n</code></pre>\n\n<p>I'm able to test the individual pieces fine (like <code>initDB</code> or <code>validate</code>) but I'm not unclear how one would test the <code>Run</code> function because http.ListenAndServe blocks. I eventually time out. Previously, I would use httpTest and make a test server but that was when <code>main</code> would start the server (the application was more basic at first). </p>\n\n<p>Some things I would test:</p>\n\n<p>That I can hit the metrics endpoint once started.\nThat I can hit the health endpoint once started.\nThat I can push a message on the queue and it is received once started.\nThat <code>Run</code> actually starts w/o a panic.</p>\n\n<p>Some notes: I am using docker to spin up a queue and database. The point of testing the <code>Run</code> function is to ensure that the bootstrapping works and the application can run successfully. Eventually I will want to push data through the queue and assert that its been processed correctly.</p>\n\n<p>Question: How should I test this or refactor it so that it is more easily testable end to end?</p>\n"}, {"tags": ["go", "jwt", "jwt-go"], "comments": [{"owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "edited": false, "score": 0, "creation_date": 1555375815, "post_id": 55698770, "comment_id": 98080006, "body": "so, what&#39;s the problem? any errors or just looking for optimisations?"}], "answers": [{"comments": [{"owner": {"reputation": 312, "user_id": 7186497, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/810680182446687/picture?type=large", "display_name": "Annihil8", "link": "https://stackoverflow.com/users/7186497/annihil8"}, "edited": false, "score": 0, "creation_date": 1555378183, "post_id": 55699276, "comment_id": 98080470, "body": "Yes, that is correct. It&#39;s working fine outside of my app, but when run inside my app it&#39;s being strange and giving back this <code>&lt;nil&gt; map[] &lt;nil&gt;  false</code> for where the claims would be, but when run outside the app it gives me <code>map[alg:RS256 kid:NUVGODIxQThBQkY2NjExQjgzMEJEMjVBQTc3QThBNTY4QTY3MzhEMA typ:JWT] map[aud:https:&#47;&#47;rba.com&#47;doctor azp:3XFBbjTL6tsL9wH6iZQtkz3rKgGeiLwh exp:1.55546266e+09 gty:client-credentials iat:1.55537626e+09 iss:https:&#47;&#47;jor2.eu.auth0.com&#47; scope:Doctor sub:3XFBbjTL6tsL9wH6iZQtkz3rKgGeiLwh@clients]  false</code>.I will give your approach a go now, thanks."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 6, "last_activity_date": 1555377577, "last_edit_date": 1592644375, "creation_date": 1555377577, "answer_id": 55699276, "question_id": 55698770, "link": "https://stackoverflow.com/questions/55698770/decode-jwt-without-validation-and-find-scope/55699276#55699276", "title": "Decode JWT without validation and find scope", "body": "<p>You use <code>github.com/dgrijalva/jwt-go</code>. That's right?</p>\n<p>You use ParseUnverified(<a href=\"https://godoc.org/github.com/dgrijalva/jwt-go#Parser.ParseUnverified\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/dgrijalva/jwt-go#Parser.ParseUnverified</a>) without validation.</p>\n<p>Below code is ParseUnverified()' example.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;github.com/dgrijalva/jwt-go&quot;\n)\n\nfunc main() {\n    // This token is expired\n    var tokenString = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJleHAiOjE1MDAwLCJpc3MiOiJ0ZXN0In0.HE7fK0xOQwFEr4WDgRWj4teRPZ6i3GLwD5YCm6Pwu_c&quot;\n\n    token, _, err := new(jwt.Parser).ParseUnverified(tokenString, jwt.MapClaims{})\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    if claims, ok := token.Claims.(jwt.MapClaims); ok {\n        fmt.Println(claims[&quot;foo&quot;], claims[&quot;exp&quot;])\n    } else {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n<p>ParseUnverified() only use for debug.</p>\n<blockquote>\n<p>WARNING: Don't use this method unless you know what you're doing</p>\n<p>This method parses the token but doesn't validate the signature. It's only ever useful in cases where you know the signature is valid (because it has been checked previously in the stack) and you want to extract values from it.</p>\n</blockquote>\n"}], "owner": {"reputation": 312, "user_id": 7186497, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/810680182446687/picture?type=large", "display_name": "Annihil8", "link": "https://stackoverflow.com/users/7186497/annihil8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2098, "favorite_count": 0, "accepted_answer_id": 55699276, "answer_count": 1, "score": 0, "last_activity_date": 1588107397, "creation_date": 1555372936, "last_edit_date": 1588107397, "question_id": 55698770, "link": "https://stackoverflow.com/questions/55698770/decode-jwt-without-validation-and-find-scope", "title": "Decode JWT without validation and find scope", "body": "<p>I need to decode my JWT token and check if the scope is a \"Doctor\".</p>\n\n<p>I know very little about GO, but I just need to write a tiny snippet in my application to extend an existing application so it needs to be written in GO.</p>\n\n<p>This was my attempt at decoding the token and checking if \"Doctor\" was in the decoded token as I wasn't able to access the scope exclusively.</p>\n\n<pre><code>for k, v := range props {\n        token_value := fmt.Sprint(v)\n        token_key := fmt.Sprint(cfg.AuthKey)\n        if (k == \"custom_token_header\") &amp;&amp; strings.Contains(token_value, token_key) {\n            if token, _ := jwt.Parse(token_value, nil); token != nil {\n                parsed_token := fmt.Sprint(token)\n                log.Infof(\"Parsed token: \" ,parsed_token)\n                if strings.Contains(parsed_token, \"Doctor\")  {\n                    log.Infof(\"user is a Doctor, perform checks...\")\n                    loc, _ := time.LoadLocation(\"GMT\")\n                    now := time.Now().In(loc)\n                    hr, _, _ := now.Clock()\n                    if hr &gt;= 9 &amp;&amp; hr &lt; 5 {\n                        log.Infof(\"success, inside of work hours!!\")\n                        return &amp;v1beta1.CheckResult{\n                            Status: status.OK,\n                        }, nil\n                    }\n                    log.Infof(\"failure; outside of work hours!!\")\n                    return &amp;v1beta1.CheckResult{\n                        Status: status.WithPermissionDenied(\"Unauthorized...\"),\n                    }, nil\n                }\n            }\n            log.Infof(\"success, as you're not a doctor!!\")\n            return &amp;v1beta1.CheckResult{\n                Status: status.OK,\n            }, nil\n        }\n    }\n</code></pre>\n\n<p>It's working fine outside of my app, but when run inside my app it's being strange and giving back this <code>&lt;nil&gt; map[] &lt;nil&gt;  false</code> for where the claims would be, but when run outside the app it gives me</p>\n\n<pre><code>map[alg:RS256 kid:NUVGODIxQThBQkY2NjExQjgzMEJEMjVBQTc3QThBNTY4QTY3MzhEMA typ:JWT] map[aud:https://rba.com/doctor azp:3XFBbjTL6tsL9wH6iZQtkz3rKgGeiLwh exp:1.55546266e+09 gty:client-credentials iat:1.55537626e+09 iss:https://jor2.eu.auth0.com/ scope:Doctor sub:3XFBbjTL6tsL9wH6iZQtkz3rKgGeiLwh@clients]  false\n</code></pre>\n\n<p>Thanks to devdotlog I was able to get this working with this change:</p>\n\n<pre><code>for k, v := range props {\n        tokenString := fmt.Sprint(v)\n        tokenKey := fmt.Sprint(cfg.AuthKey)\n        if (k == \"custom_token_header\") &amp;&amp; strings.Contains(tokenString, tokenKey) {\n            tokenString = strings.Replace(tokenString, \"Bearer \", \"\", -1)\n            token, _, err := new(jwt.Parser).ParseUnverified(tokenString, jwt.MapClaims{})\n            if err != nil {\n                fmt.Println(err)\n                return nil, nil\n            }\n            if claims, ok := token.Claims.(jwt.MapClaims); ok {\n                tokenScope := fmt.Sprint(claims[\"scope\"])\n                log.Infof(\"Scope: \", tokenScope)\n                if tokenScope == \"Doctor\" {\n                    log.Infof(\"user is a Doctor, perform checks...\")\n                    loc, _ := time.LoadLocation(\"GMT\")\n                    now := time.Now().In(loc)\n                    hr, _, _ := now.Clock()\n                    if hr &gt;= 9 &amp;&amp; hr &lt; 5 {\n                        log.Infof(\"success, inside of work hours!!\")\n                        return &amp;v1beta1.CheckResult{\n                            Status: status.OK,\n                        }, nil\n                    }\n                    log.Infof(\"failure; outside of work hours!!\")\n                    return &amp;v1beta1.CheckResult{\n                        Status: status.WithPermissionDenied(\"Unauthorized...\"),\n                    }, nil\n                }\n                fmt.Println(claims[\"scope\"])\n            } else {\n                fmt.Println(err)\n            }\n            log.Infof(\"success, as you're not a doctor!!\")\n            return &amp;v1beta1.CheckResult{\n                Status: status.OK,\n            }, nil\n        }\n    }\n</code></pre>\n"}, {"tags": ["go", "ginkgo", "gomega"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1555369194, "post_id": 55697890, "comment_id": 98078730, "body": "White box testing, test inside the package!"}, {"owner": {"reputation": 96, "user_id": 7408619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r8mvD.jpg?s=128&g=1", "display_name": "SpiderShrimp", "link": "https://stackoverflow.com/users/7408619/spidershrimp"}, "edited": false, "score": 1, "creation_date": 1555383591, "post_id": 55697890, "comment_id": 98083244, "body": "I&#39;m a little bit confused.Is <code>service.Queue</code>&#39;s type interface{}? Are <code>return &amp;QueueA.NewQueue{...}</code> inside <code>GetQueue</code> and <code>NewService()</code> inside QueueA.go the same function?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555391315, "post_id": 55697890, "comment_id": 98083242, "body": "This code makes no sense. NewService isn&#39;t called anywhere and its return type doesn&#39;t match what it actually returns. Also, <code>function</code> isn&#39;t a keyword in Go. Try to make an example that accurately represents your real code, otherwise it&#39;s hard to see what your actual problem is."}, {"owner": {"reputation": 3157, "user_id": 1993552, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c77f27d5fb87727d535dc027d3c080d9?s=128&d=identicon&r=PG", "display_name": "injoy", "link": "https://stackoverflow.com/users/1993552/injoy"}, "reply_to_user": {"reputation": 96, "user_id": 7408619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r8mvD.jpg?s=128&g=1", "display_name": "SpiderShrimp", "link": "https://stackoverflow.com/users/7408619/spidershrimp"}, "edited": false, "score": 0, "creation_date": 1555398347, "post_id": 55697890, "comment_id": 98085856, "body": "@SpiderShrimp Sorry, I did&#39;t make it clear enough. I&#39;ve revised my questions a bit."}, {"owner": {"reputation": 3157, "user_id": 1993552, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c77f27d5fb87727d535dc027d3c080d9?s=128&d=identicon&r=PG", "display_name": "injoy", "link": "https://stackoverflow.com/users/1993552/injoy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555398369, "post_id": 55697890, "comment_id": 98085875, "body": "@Peter  Sorry, I did&#39;t make it clear enough. I&#39;ve revised my questions a bit."}], "owner": {"reputation": 3157, "user_id": 1993552, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c77f27d5fb87727d535dc027d3c080d9?s=128&d=identicon&r=PG", "display_name": "injoy", "link": "https://stackoverflow.com/users/1993552/injoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555398286, "creation_date": 1555366278, "last_edit_date": 1555398286, "question_id": 55697890, "link": "https://stackoverflow.com/questions/55697890/how-to-match-private-struct-types-using-ginkgo-and-gomega", "title": "How to match private struct types using Ginkgo and Gomega?", "body": "<p>Assume that I have a function called <code>GetQueue</code> with GoLang and depends on the configuration, it would return different types of queue implementations. </p>\n\n<pre><code>func GetQueue(config string) *service.Queue {\nswitch(config):\ncase \"A\":\n  return &amp;QueueA.NewQueue{...}\ncase \"B\":\n  return &amp;QueueB.NewQueue{...}\n...\n}\n</code></pre>\n\n<p>The <code>service.Queue</code> is an interface. And both <code>QueueA</code> and <code>QueueB</code> are implementations for this interface. The QueueA.go looks like:</p>\n\n<pre><code>type service struct {\n...\n}\n\nfunction NewService() *service.Queue {\n  return &amp;service{}\n}\n</code></pre>\n\n<p>I'd like to write a unit test for the <code>GetQueue</code> function (which is defined outside of the <code>service</code> package) and I would like to verify the returned types are as expected. However, both <code>QueueA.sevice</code> and <code>QueueB.service</code> are private structs. So how can I verify the returned types are the expected ones?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 10006645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3d4f64e6f346eb97ed2e9df4de0b63e?s=128&d=identicon&r=PG", "display_name": "Tobi696", "link": "https://stackoverflow.com/users/10006645/tobi696"}, "edited": false, "score": 0, "creation_date": 1555395429, "post_id": 55699598, "comment_id": 98084643, "body": "Thanks a lot! You just saved me a lot of headaches!"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1555380557, "creation_date": 1555380557, "answer_id": 55699598, "question_id": 55696562, "link": "https://stackoverflow.com/questions/55696562/why-does-my-mongodb-query-return-0-results/55699598#55699598", "title": "Why does my mongodb query return 0 results?", "body": "<p>Your query translates into: </p>\n\n<pre><code>{\"$or\":[\n   {\"stories_involved\":{\n           \"_id\": ObjectId(\"5cb4dd7e29d3dca573a73d4c\")}}, \n   {\"stories_created\":{\n           \"_id\":ObjectId(\"5cb4dd7e29d3dca573a73d4c\")}}\n]}\n</code></pre>\n\n<p>Which means that it's searching for either a document with a <em>nested document</em> \n i.e:</p>\n\n<p><code>{stories_involved: {_id: &lt;value&gt;}}</code> OR <code>{stories_created: {_id: &lt;value&gt;}}</code>. </p>\n\n<p>However, the documents in the collection contains <em>nested document array</em> i.e: </p>\n\n<p><code>{stories_involved: [{_id:&lt;value&gt;}]}</code> OR <code>{stories_created: [{_id:&lt;value&gt;}]}</code></p>\n\n<p>This is the reason your query is not returning any value (and no error because the query syntax is correct). </p>\n\n<p>There are two ways of <a href=\"https://docs.mongodb.com/manual/tutorial/query-array-of-documents/#query-for-a-document-nested-in-an-array\" rel=\"nofollow noreferrer\">Querying a document nested in an array</a> using <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-dot-notation\" rel=\"nofollow noreferrer\">dot notation</a>. If you know the index of the array for the document, you can just specify the position: </p>\n\n<pre><code>id, _ := primitive.ObjectIDFromHex(\"5cb4dd7e29d3dca573a73d4c\")\ninvolvedFilter := bson.M{\"stories_involved.0._id\": id}\ncreatedFilter := bson.M{\"stories_created.0._id\": id}\nfilter := bson.M{\"$or\": []bson.M{involvedFilter, createdFilter}}\ncur, err := collection.Find(ctx, filter)\n</code></pre>\n\n<p>If you do not know the index position of the document nested in the array, concatenate the name of the array field, with a dot (.) and the name of the field in the nested document: </p>\n\n<pre><code>id, _ := primitive.ObjectIDFromHex(\"5cb4dd7e29d3dca573a73d4c\")\ninvolvedFilter := bson.M{\"stories_involved._id\": id}\ncreatedFilter := bson.M{\"stories_created._id\": id}\nfilter := bson.M{\"$or\": []bson.M{involvedFilter, createdFilter}}\ncur, err := collection.Find(ctx, filter)\n</code></pre>\n\n<p>See also <a href=\"https://docs.mongodb.com/manual/tutorial/query-documents/\" rel=\"nofollow noreferrer\">MongoDB: Query Documents</a></p>\n"}], "owner": {"reputation": 346, "user_id": 10006645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3d4f64e6f346eb97ed2e9df4de0b63e?s=128&d=identicon&r=PG", "display_name": "Tobi696", "link": "https://stackoverflow.com/users/10006645/tobi696"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 55699598, "answer_count": 1, "score": 0, "last_activity_date": 1555380557, "creation_date": 1555358989, "question_id": 55696562, "link": "https://stackoverflow.com/questions/55696562/why-does-my-mongodb-query-return-0-results", "title": "Why does my mongodb query return 0 results?", "body": "<p>This is my database collection:\n<a href=\"https://i.stack.imgur.com/nlETA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nlETA.png\" alt=\"Documents\"></a>\n<br>With this go code, I try to get all the users who are either involved in the story or created the story with the given id.</p>\n\n<pre><code>func main() {\n    for stf.DB == nil {\n    }\n\n    collection := stf.DB.Collection(\"user\")\n    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n    defer cancel()\n\n    id, _ := primitive.ObjectIDFromHex(\"5cb4dd7e29d3dca573a73d4c\")\n    fter := bson.M{\"_id\": id}\n\n    involvedFilter := bson.M{\"stories_involved\": fter}\n    createdFilter := bson.M{\"stories_created\": fter}\n\n    filter := bson.M{\"$or\": []bson.M{involvedFilter, createdFilter}}\n\n    cur, err := collection.Find(ctx, filter)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    defer cur.Close(ctx)\n\n    for cur.Next(ctx) {\n        var result bson.M\n        err := cur.Decode(&amp;result)\n\n        if err != nil {\n            log.Fatal(err.Error())\n        }\n        fmt.Println(result)\n    }\n    if err := cur.Err(); err != nil {\n        log.Fatal(err.Error())\n    }\n}\n</code></pre>\n\n<p><br>\nThe code doesn't output any errors, but it also doesn't output any objects...\n<br>\nThanks for your help in advance!</p>\n"}, {"tags": ["json", "parsing", "go", "interface", "marshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1555358023, "post_id": 55696126, "comment_id": 98075082, "body": "Let&#39;s step up a level. Is there a reason that you you are using <code>map[string]interface{}</code> instead of a type that matches the structure of the data more directly.  For example <code>struct { Data []struct{ Group, ID, Name string; Released bool; Version int }}</code>."}, {"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555360226, "post_id": 55696126, "comment_id": 98075918, "body": "Yes, it is a reusable and common function which interacts with the server and its return type is map[string]interface{}."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555360409, "post_id": 55696126, "comment_id": 98075993, "body": "In most cases, common functions like that can be written to work with a type specific to the response.  Share that function if you&#39;d like assistance with that."}, {"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555360810, "post_id": 55696126, "comment_id": 98076151, "body": "I am sorry, I am very new to go, I am not sure if I understood you correctly. I can create an extra function to transform the data to a desired struct format, but I am not sure how to parse or iterate over the existing data format. Would you suggest a for loop of similar kind - <a href=\"https://play.golang.org/p/9OEPzbf0Me0\" rel=\"nofollow noreferrer\">link</a> for the transformation?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555361180, "post_id": 55696126, "comment_id": 98076303, "body": "I am suggesting that you let the JSON decoder to the heavy lifting by modifying the common function that interacts with the server to work with arbitrary types.  Is the structure of the JSON response known in advance for each API on the server?"}, {"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555361387, "post_id": 55696126, "comment_id": 98076376, "body": "Nope, unfortunately the response structure are varied and are not known in advance."}, {"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555362170, "post_id": 55696126, "comment_id": 98076688, "body": "I know the fields for the API on which I am working not each and every API which can be called, but the core/common function is general it just hits the server and gives the response, irrespective of any logic. It is simple http request and response."}], "answers": [{"comments": [{"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1601864372, "post_id": 55697758, "comment_id": 113528732, "body": "Related question <a href=\"https://stackoverflow.com/q/64201687/3317808\">stackoverflow.com/q/64201687/3317808</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1555365991, "last_edit_date": 1555365991, "creation_date": 1555365331, "answer_id": 55697758, "question_id": 55696126, "link": "https://stackoverflow.com/questions/55696126/reading-the-data-which-is-in-a-mapstringinterface/55697758#55697758", "title": "Reading the data which is in a map[string]interface{}", "body": "<p>The best solution is to decode the JSON directly to a Go type that matches the structure of the data.  This avoids the type assertions required to dig through a <code>map[string]interface{}</code>.</p>\n\n<p>I'll assume that the common function looks something like this:</p>\n\n<pre><code>func request(path string, ... more arguments) (map[string]interface{}}, error) {\n      ...\n      resp, err := client.Do(req)\n      if err != nil {\n         return nil, err\n      }\n      defer resp.Body.Close()\n      ...\n      var result map[string]interface{}\n      err := json.NewDecoder(resp.Body).Decode(&amp;result)\n      return result, err\n}\n</code></pre>\n\n<p>Change the function to take a pointer to the result as an argument:</p>\n\n<pre><code>func request(pv interface{}, path string, ... more arguments) error {\n      ...\n      resp, err := client.Do(req)\n      if err != nil {\n         return err\n      }\n      defer resp.Body.Close()\n      ...\n      err := json.NewDecoder(resp.Body).Decode(pv)\n      return err\n}\n</code></pre>\n\n<p>Call this modified function like this:</p>\n\n<pre><code>var result struct { \n    Data []struct{ \n        Group, ID, Name string\n        Released bool\n        Version int \n    }\n}\nerr := request(&amp;result, \"some/path\", ... more arguments )\nif err != nil {\n    // handle error\n}\n\nfor _, d := range result.Data {\n   if !d.Released {\n       continue\n   }\n   fmt.Println(d.Group, d.ID, d.Name, d.Version)\n   ... process d\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 786, "favorite_count": 0, "accepted_answer_id": 55697758, "answer_count": 1, "score": -1, "last_activity_date": 1555365991, "creation_date": 1555356829, "last_edit_date": 1555360370, "question_id": 55696126, "link": "https://stackoverflow.com/questions/55696126/reading-the-data-which-is-in-a-mapstringinterface", "title": "Reading the data which is in a map[string]interface{}", "body": "<p>Source server return the data in a Json format of multiple object \n    interfaces, how can we parse such data ?</p>\n\n<p>I am using a variable of JSON map[string]interface{}  type to hold the result from server </p>\n\n<pre><code> The data return from Server.\n\"data\": [\n       {\n        \"group\": \"PAA_TEST\",\n        \"id\": \"2018-04-10T09:24:18.000000Z\",\n        \"name\": \"PAA_STATION\",\n        \"released\": true,\n        \"version\": 33\n    },\n    {\n        \"group\": \"PAA_TEST\",\n        \"id\": \"2018-03-19T10:50:21.000000Z\",\n        \"name\": \"PAA_STATION\",\n        \"released\": false,\n        \"version\": 32\n    }\n</code></pre>\n\n<p>my fmt.print output outputdata[\"data\"] //where output data is of JSON \n                                            map[string]interface{}</p>\n\n<pre><code>    [\n       map[group:PAA_TEST id:2018-04-10T09:24:18.000000Z name:PAA_STATION \n       released:true version:33] \n       map[group:PAA_TEST id:2018-03-19T10:50:21.000000Z name:PAA_STATION \n       released:false version:32] \n   ]\n</code></pre>\n\n<p>How can we iterate with multiple Map interfaces? For example, if I just want to process the information with released status as true. I am trying various method for indexing but no luck yet.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6007960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76f457273551865bd6e9040417a79fab?s=128&d=identicon&r=PG&f=1", "display_name": "P.Brown", "link": "https://stackoverflow.com/users/6007960/p-brown"}, "edited": false, "score": 0, "creation_date": 1555339021, "post_id": 55691347, "comment_id": 98065972, "body": "Thank you very much, the second approach was exactly what I needed!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1555338643, "last_edit_date": 1555338643, "creation_date": 1555338278, "answer_id": 55691347, "question_id": 55691220, "link": "https://stackoverflow.com/questions/55691220/get-address-after-changing-type/55691347#55691347", "title": "Get address after changing type", "body": "<p>You cannot take the address of an arbitrary operation, including a type conversion. For details, see <a href=\"https://stackoverflow.com/questions/34197248/how-can-i-store-reference-to-the-result-of-an-operation-in-go/34197367#34197367\">How can I store reference to the result of an operation in Go?</a>; and <a href=\"https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/35146856#35146856\">Find address of constant in go</a>.</p>\n\n<p>You can omit one of the local variables if you convert the string literal:</p>\n\n<pre><code>specStr := specialString(\"James\")\nnested := nestedStruct{\n    name: &amp;specStr,\n}\n</code></pre>\n\n<p>If you already have a variable of <code>string</code> type and you want to omit the second variable (of <code>specialString</code> type), then take the address of the existing <code>string</code> variable, and convert it to <code>*specialString</code>:</p>\n\n<pre><code>str := \"James\"\nnested = nestedStruct{\n    name: (*specialString)(&amp;str),\n}\n</code></pre>\n\n<p>Try these examples on the <a href=\"https://play.golang.org/p/z2id5FF36Qx\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>If you want to omit the local variable, see this answer for options: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 6007960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76f457273551865bd6e9040417a79fab?s=128&d=identicon&r=PG&f=1", "display_name": "P.Brown", "link": "https://stackoverflow.com/users/6007960/p-brown"}, "edited": false, "score": 0, "creation_date": 1555338715, "post_id": 55691398, "comment_id": 98065770, "body": "Wouldn&#39;t this copy the value of the <code>str</code> and thereby create an unnecessary  performance overhead? Is there a way to write such function in a more general way so that it accepts multiple types and returns corresponding pointers?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11, "user_id": 6007960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76f457273551865bd6e9040417a79fab?s=128&d=identicon&r=PG&f=1", "display_name": "P.Brown", "link": "https://stackoverflow.com/users/6007960/p-brown"}, "edited": false, "score": 1, "creation_date": 1555338929, "post_id": 55691398, "comment_id": 98065916, "body": "This approach copies the string header (pointer, length), but not the backing array of bytes. The performance cost of copying the header is negligible. Any approach to solving this problem must copy string header to a variable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555339075, "post_id": 55691398, "comment_id": 98066007, "body": "Not to mention this simple function is most likely inlined by the compiler."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555339144, "post_id": 55691398, "comment_id": 98066050, "body": "See the <a href=\"https://godoc.org/github.com/aws/aws-sdk-go/aws#hdr-Value_and_Pointer_Conversion_Utilities\" rel=\"nofollow noreferrer\">AWS value and pointer conversion utilities</a> for one approach to handling multiple types.  AWS provides a helper function for each type."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555339398, "post_id": 55691398, "comment_id": 98066205, "body": "&quot;Wouldn&#39;t this ... create an unnecessary performance overhead?&quot; Maybe, maybe not, but there&#39;s no point in assuming it would. Write code that does what it&#39;s supposed to and makes sense to someone reading it. If you measure a performance problem, and profile to locate the source of the problem, then you can worry about optimization."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1555338449, "creation_date": 1555338449, "answer_id": 55691398, "question_id": 55691220, "link": "https://stackoverflow.com/questions/55691220/get-address-after-changing-type/55691398#55691398", "title": "Get address after changing type", "body": "<p>Use a function to eliminate the boilerplate at the point of initialization:</p>\n\n<pre><code>func specialStringPtr(s string) *specialString { \n     return (*specialString)(&amp;s) \n}\n\n\nnested := nestedStruct{\n    name: specialStringPtr(str),\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6007960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76f457273551865bd6e9040417a79fab?s=128&d=identicon&r=PG&f=1", "display_name": "P.Brown", "link": "https://stackoverflow.com/users/6007960/p-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 55691347, "answer_count": 2, "score": -1, "last_activity_date": 1555338643, "creation_date": 1555337891, "question_id": 55691220, "link": "https://stackoverflow.com/questions/55691220/get-address-after-changing-type", "title": "Get address after changing type", "body": "<p>I am new to Go and I'm trying to find a convenient way from a developers perspective to get an address of an object after changing type.</p>\n\n<p>Consider these two new types:</p>\n\n<pre><code>type specialString string\ntype nestedStruct struct {\n    name *specialString\n}\n</code></pre>\n\n<p>The canonical way I have found for filling in the nestedStruct is this:</p>\n\n<pre><code>str := \"James\"\nspecStr := specialString(str)\nnested := nestedStruct{\n    name: &amp;specStr,\n}\n</code></pre>\n\n<p>Is there a way to omit the declaration of <code>specStr</code>, which is then only used in one place? I tried this, but it triggers an syntax error (what is the logical reason for that?):</p>\n\n<pre><code>//Syntax error\nnested := nestedStruct{\n    name: &amp;specialString(str),\n}\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["go", "twitter", "twitter-oauth", "buffalo"], "comments": [{"owner": {"reputation": 8279, "user_id": 262478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1526dcb784188b422544c6344ef223c2?s=128&d=identicon&r=PG", "display_name": "Andy Piper", "link": "https://stackoverflow.com/users/262478/andy-piper"}, "edited": false, "score": 0, "creation_date": 1555339340, "post_id": 55691114, "comment_id": 98066171, "body": "Should be a case of taking the AccessToken and AccessTokenSecret from the OAuth step, substituting those into your Credentials struct, and using that to post."}, {"owner": {"reputation": 95, "user_id": 8556177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sCwe3.jpg?s=128&g=1", "display_name": "JamWill", "link": "https://stackoverflow.com/users/8556177/jamwill"}, "reply_to_user": {"reputation": 8279, "user_id": 262478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1526dcb784188b422544c6344ef223c2?s=128&d=identicon&r=PG", "display_name": "Andy Piper", "link": "https://stackoverflow.com/users/262478/andy-piper"}, "edited": false, "score": 0, "creation_date": 1555339950, "post_id": 55691114, "comment_id": 98066560, "body": "Thats what I had in mine @AndyPiper but i&#39;m not quite sure on how to retrieve that access token?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1555340796, "post_id": 55691114, "comment_id": 98067072, "body": "@JamWill Get the token from the <a href=\"https://godoc.org/github.com/markbates/goth#User.AccessToken\" rel=\"nofollow noreferrer\">User.AccessToken</a> and <a href=\"https://godoc.org/github.com/markbates/goth#User.AccessTokenSecret\" rel=\"nofollow noreferrer\">User.AccessTokenSecret</a> fields of <code>gu</code>."}, {"owner": {"reputation": 95, "user_id": 8556177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sCwe3.jpg?s=128&g=1", "display_name": "JamWill", "link": "https://stackoverflow.com/users/8556177/jamwill"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555409994, "post_id": 55691114, "comment_id": 98092522, "body": "Thank you @CeriseLim&#243;n this helped a lot. Make it an answer and i will mark it as right"}], "owner": {"reputation": 95, "user_id": 8556177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sCwe3.jpg?s=128&g=1", "display_name": "JamWill", "link": "https://stackoverflow.com/users/8556177/jamwill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555337560, "creation_date": 1555337560, "question_id": 55691114, "link": "https://stackoverflow.com/questions/55691114/can-i-post-to-twitter-from-the-oauth-logged-in-user", "title": "Can I post to twitter from the Oauth-logged in user?", "body": "<p>Currently have a web app that logs in a user (and saves them to the DB) through Oauthing with twitter.</p>\n\n<p>You can also tweet from the webapp, however the tweet is currently coded to be sent from a hardcoded AccessToken (Gotten from the developers dashboard) and not the previously signed in user.</p>\n\n<p>How do i access the access token generated when logging in, so that they can then send a tweet from that account? Or is there another method.</p>\n\n<p>Every single piece of code i find involves tweeting from the developers account, and not logging in through Oauth and then tweeting. </p>\n\n<p>I am currently using Golang buffalo framework, with Goth (for the auth) and dghubble's go-twitter (for the tweet) libraries.</p>\n\n<p>Here is the code for the auth:</p>\n\n<pre><code>func init() {\n    gothic.Store = App().SessionStore\n\n    goth.UseProviders(\n        twitter.New(os.Getenv(\"API_KEY\"), os.Getenv(\"API_SECRET\"), fmt.Sprintf(\"%s%s\", App().Host, \"/auth/twitter/callback\")),\n    )\n}\n\nfunc AuthCallback(c buffalo.Context) error {\n    gu, err := gothic.CompleteUserAuth(c.Response(), c.Request())\n    if err != nil {\n        return c.Error(401, err)\n    }\n    tx := c.Value(\"tx\").(*pop.Connection)\n    q := tx.Where(\"provider = ? and provider_id = ?\", gu.Provider, gu.UserID)\n    exists, err := q.Exists(\"users\")\n    if err != nil {\n        return errors.WithStack(err)\n    }\n    u := &amp;models.User{}\n    if exists {\n        if err = q.First(u); err != nil {\n            return errors.WithStack(err)\n        }\n    }\n    u.Name = defaults.String(gu.Name, gu.NickName)\n    u.Provider = gu.Provider\n    u.ProviderID = gu.UserID\n    u.Email = nulls.NewString(gu.Email)\n    if err = tx.Save(u); err != nil {\n        return errors.WithStack(err)\n    }\n\n    c.Session().Set(\"current_user_id\", u.ID)\n    if err = c.Session().Save(); err != nil {\n        return errors.WithStack(err)\n    }\n\n    c.Flash().Add(\"success\", \"You have been logged in\")\n    return c.Redirect(302, \"/\")\n}\n\nfunc AuthDestroy(c buffalo.Context) error {\n    c.Session().Clear()\n    c.Flash().Add(\"success\", \"You have been logged out\")\n    return c.Redirect(302, \"/\")\n}\n\nfunc SetCurrentUser(next buffalo.Handler) buffalo.Handler {\n    return func(c buffalo.Context) error {\n        if uid := c.Session().Get(\"current_user_id\"); uid != nil {\n            u := &amp;models.User{}\n            tx := c.Value(\"tx\").(*pop.Connection)\n            if err := tx.Find(u, uid); err != nil {\n                return errors.WithStack(err)\n            }\n            c.Set(\"current_user\", u)\n        }\n        return next(c)\n    }\n}\n\nfunc Authorize(next buffalo.Handler) buffalo.Handler {\n    return func(c buffalo.Context) error {\n        if uid := c.Session().Get(\"current_user_id\"); uid == nil {\n            c.Flash().Add(\"danger\", \"You must be authorized to see that page\")\n            return c.Redirect(302, \"/\")\n        }\n        return next(c)\n    }\n}\n</code></pre>\n\n<p>And here is the code that handles the tweet:</p>\n\n<p>GetClient sets up the client ready to send the tweet.</p>\n\n<pre><code>type Credentials struct {\n    APIKey            string\n    APISecret         string\n    AccessToken       string\n    AccessTokenSecret string\n}\n\n// getClient is a helper function that will return a twitter client\n// that we can subsequently use to send tweets, or to stream new tweets\n// this will take in a pointer to a Credential struct which will contain\n// everything needed to authenticate and return a pointer to a twitter Client\n// or an error\nfunc GetClient(creds *Credentials) (*twitter.Client, error) {\n    // Pass in your consumer key (API Key) and your Consumer Secret (API Secret)\n    config := oauth1.NewConfig(creds.APIKey, creds.APISecret)\n    // Pass in your Access Token and your Access Token Secret\n    token := oauth1.NewToken(creds.AccessToken, creds.AccessTokenSecret)\n\n    httpClient := config.Client(oauth1.NoContext, token)\n    client := twitter.NewClient(httpClient)\n\n    // Verify Credentials\n    verifyParams := &amp;twitter.AccountVerifyParams{\n        SkipStatus:   twitter.Bool(true),\n        IncludeEmail: twitter.Bool(true),\n    }\n\n    // we can retrieve the user and verify if the credentials\n    // we have used successfully allow us to log in!\n    user, _, err := client.Accounts.VerifyCredentials(verifyParams)\n    if err != nil {\n        return nil, err\n    }\n\n    log.Printf(\"User's ACCOUNT:\\n%+v\\n\", user)\n    return client, nil\n}\n</code></pre>\n\n<p>This sends the tweet:</p>\n\n<pre><code>func SendHandler(c buffalo.Context) error {\n\n    //Calls http.Request package to get the form values. Assigns it to Req\n    Req := c.Request()\n    //ParseForm decodes the form\n    Req.ParseForm()\n\n    //Gets the value from the form, assigns it to body.\n    body := Req.FormValue(\"tweetbody\")\n\n    fmt.Printf(\"%+v\\n\", creds)\n\n    //Gets the client from the twitter package\n    client, err := twitter.GetClient(&amp;creds)\n    if err != nil {\n        log.Println(\"Error getting Twitter Client\")\n        log.Println(err)\n    }\n\n    //Sending the actual tweet. Body from the form\n    tweet, resp, err := client.Statuses.Update(body, nil)\n    if err != nil {\n        log.Println(err)\n    }\n    log.Printf(\"%+v\\n\", resp)\n    log.Printf(\"%+v\\n\", tweet)\n    return c.Redirect(302, \"/tweet/confirm\")\n\n}\n</code></pre>\n\n<p>Im only assuming I have to get the access token from the oauth... If there is a better way please state it.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1555336879, "post_id": 55690876, "comment_id": 98064699, "body": "What do you unmarshal into? If it is a struct, you must export its fields!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555336882, "post_id": 55690876, "comment_id": 98064702, "body": "Please show the code you&#39;re having trouble with, including the definition of your data type struct, preferably in the form of a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, Verifiable Example</a>."}], "answers": [{"tags": [], "owner": {"reputation": 37, "user_id": 7716315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a47ecfa9c2d08eb0a64eeaff73141f73?s=128&d=identicon&r=PG&f=1", "display_name": "Soft Strategy", "link": "https://stackoverflow.com/users/7716315/soft-strategy"}, "is_accepted": false, "score": 0, "last_activity_date": 1555427395, "creation_date": 1555427395, "answer_id": 55711381, "question_id": 55690876, "link": "https://stackoverflow.com/questions/55690876/i-can-find-a-record-with-mongodb-official-golang-drivers-but-the-record-is-empt/55711381#55711381", "title": "I can Find a record with MongoDB official Golang drivers, but the record is empty", "body": "<p>The members of Items must start with an uppercase letter (just the variable names, the json/bson tags are fine) otherwise the deserializer can't access them.</p>\n"}], "owner": {"reputation": 37, "user_id": 7716315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a47ecfa9c2d08eb0a64eeaff73141f73?s=128&d=identicon&r=PG&f=1", "display_name": "Soft Strategy", "link": "https://stackoverflow.com/users/7716315/soft-strategy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555455229, "creation_date": 1555336825, "last_edit_date": 1555455229, "question_id": 55690876, "link": "https://stackoverflow.com/questions/55690876/i-can-find-a-record-with-mongodb-official-golang-drivers-but-the-record-is-empt", "title": "I can Find a record with MongoDB official Golang drivers, but the record is empty", "body": "<p>I'm trying to learn Go and I wrote a little code that handles a MongoDB test database, inserting some general \"items\".\nThis is the code:</p>\n\n<pre><code>https://pastebin.com/ptNwKbk2\n</code></pre>\n\n<p>I can insert and update records without issues but when I try to FindOne or Find a record what comes out is some empty shell, it finds the record but the record only shows its id.<br>\nFirst Find [line 89]:</p>\n\n<pre><code>err = collection.FindOne(context.TODO(), filter).Decode(&amp;resultItem)\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Found a single document: {ID:ObjectID(\"5cb488c30eeb652e64ecdaeb\") itemID: priority:0 desc:}\n</code></pre>\n\n<p>Second Find [line 95]:</p>\n\n<pre><code>cur, err := collection.Find(context.TODO(), emptyFilter, findOptions)\n</code></pre>\n\n<p>Result, every element has an id but no data inside (\"itemID: priority:0 desc:\"):</p>\n\n<pre><code>Found multiple documents (array of pointers): [0xc00004c840 0xc00004c8c0]\n</code></pre>\n\n<p>Could someone find what the problem is here?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555332619, "post_id": 55689543, "comment_id": 98062059, "body": "Are you sure <code>_id</code> is of type <code>ObjectId</code> in your database? Can you post an example document?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555333142, "post_id": 55689543, "comment_id": 98062370, "body": "Your query works for me. Are you sure collection name is correct? Are you sure you have records inserted in the last 10 minutes? Please do note that the logic that inserts documents may not generate ObjectID&#39;s that use the current time!"}, {"owner": {"reputation": 1, "user_id": 11094548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9XV5Zgff-UI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPpWeBgMoM-Tyh3UPdolXptYI_A7Q/mo/photo.jpg?sz=128", "display_name": "Dzmitry Tsitavets", "link": "https://stackoverflow.com/users/11094548/dzmitry-tsitavets"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555333414, "post_id": 55689543, "comment_id": 98062519, "body": "@icza, once i change query to bson.M{} it works fine. So collection name is ok. I`m inserting data right before querying, i also tried to query data for last 24 hours. May the problem be in timezones?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555334864, "post_id": 55689543, "comment_id": 98063464, "body": "The time part of the <code>ObjectId</code> is the time-zone independent Unix timestamp. Please show how the records are inserted to your db."}, {"owner": {"reputation": 1, "user_id": 11094548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9XV5Zgff-UI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPpWeBgMoM-Tyh3UPdolXptYI_A7Q/mo/photo.jpg?sz=128", "display_name": "Dzmitry Tsitavets", "link": "https://stackoverflow.com/users/11094548/dzmitry-tsitavets"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555335426, "post_id": 55689543, "comment_id": 98063832, "body": "@icza, Tried both by db.insert from the shell and `\tc := session.DB(r.database).C(source) \terr := c.Insert(rawInt...)`, where rawInt is a slice on interface{}"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1555335480, "post_id": 55689543, "comment_id": 98063869, "body": "Again, your example works for me. If you want help, you need to show us a code that reproduces the problem. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "owner": {"reputation": 1, "user_id": 11094548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9XV5Zgff-UI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPpWeBgMoM-Tyh3UPdolXptYI_A7Q/mo/photo.jpg?sz=128", "display_name": "Dzmitry Tsitavets", "link": "https://stackoverflow.com/users/11094548/dzmitry-tsitavets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1555332974, "creation_date": 1555332435, "last_edit_date": 1555332974, "question_id": 55689543, "link": "https://stackoverflow.com/questions/55689543/query-all-documents-for-last-10-minutes-by-objectid-timestamp", "title": "Query all documents for last 10 minutes by ObjectId timestamp", "body": "<p>Im trying to get all documents fro the last 10 minutes. I thought it wold be convenient to use ObjectId for it. I`m using this code to achieve it.</p>\n\n<pre><code>currentTime := time.Now().UTC()\nqueryTime := currentTime.Add(-10 * time.Minute)\nvar oidtime = bson.NewObjectIdWithTime(queryTime)\nquery := bson.M{\"_id\": bson.M{\"$gt\": oidtime}}\nerr := c.Find(query).All(&amp;result)\n</code></pre>\n\n<p>But I always have null as an answer. </p>\n\n<pre><code>err := c.Find(bson.M{}).All(&amp;result)\n</code></pre>\n\n<p>This kind of query works fine though. \nI have this thing in mongo logs.</p>\n\n<pre><code>command: find { find: \"meraki\", filter: { _id: { $gt: \"\\\ufffdD\ufffd        \" } }, skip: 0, $db: \"devices\" } planSummary: IXSCAN {\n_id: 1 } keysExamined:0 docsExamined:0 cursorExhausted:1 numYields:0 nreturned:0 reslen:118 locks:{ Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { r: 1 } }, Collection: { acquireCount: { r: 1 } } } protocol:op_query 0ms\n</code></pre>\n\n<p>updated: Document example</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5cb464aff3276d5fa21cd31d\"), \"lldp\" : *, \"cdp\" : null, \"id\" : \"*\"}\n</code></pre>\n"}, {"tags": ["qt", "go", "winapi", "borderless"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "edited": false, "score": 0, "creation_date": 1555667608, "post_id": 55755824, "comment_id": 98194775, "body": "the standard frame includes extended frames? I followed the advice and fix the code like the following, but the problem could not be solved.  <code>case win.WM_NCCALCSIZE: \tif msg.WParam == 1 { \t\tresult = 0 \t\treturn true \t} else { \t \tresult = int(win.DefWindowProc(hwnd, win.WM_NCCALCSIZE,\twparam, lparam)) \t} \treturn false</code>"}, {"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "reply_to_user": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "edited": false, "score": 0, "creation_date": 1555920520, "post_id": 55755824, "comment_id": 98251860, "body": "<code>return win.DefWindowProc(hwnd, win.WM_NCCALCSIZE,\twparam, lparam);</code> instead of <code>return true&#47;false</code>"}, {"owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "edited": false, "score": 0, "creation_date": 1555926825, "post_id": 55755824, "comment_id": 98254114, "body": "<code>win.DefWindowProc()</code> is uintptr type and return type should be bool, so, I trying the following but not working. <code>case win.WM_NCCALCSIZE: \t\t\tret := win.DefWindowProc(msg.Hwnd, win.WM_NCCALCSIZE, msg.WParam, msg.LParam) \t\t\tif ret == 1 { \t\t\t\treturn true \t\t\t} else { \t\t\t\treturn false \t\t\t}</code>"}, {"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "reply_to_user": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "edited": false, "score": 0, "creation_date": 1556790156, "post_id": 55755824, "comment_id": 98551714, "body": "Set the return value with the <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-setwindowlonga#DWL_MSGRESULT\" rel=\"nofollow noreferrer\"><code>DWL_MSGRESULT</code></a> instead of <code>result = 0</code>"}], "tags": [], "owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "is_accepted": false, "score": 1, "last_activity_date": 1556790105, "last_edit_date": 1556790105, "creation_date": 1555640541, "answer_id": 55755824, "question_id": 55688899, "link": "https://stackoverflow.com/questions/55688899/how-to-keep-shadow-in-borderless-window/55755824#55755824", "title": "how to keep shadow in borderless window", "body": "<p><a href=\"https://docs.microsoft.com/en-us/windows/desktop/winmsg/wm-nccalcsize\" rel=\"nofollow noreferrer\"><code>WM_NCCALCSIZE</code></a>:</p>\n\n<blockquote>\n  <p>If wParam is TRUE, the application should return zero or a combination\n  of the following values.(In document)</p>\n</blockquote>\n\n<p>And also:</p>\n\n<blockquote>\n  <p>When wParam is TRUE, simply returning 0 without processing the\n  NCCALCSIZE_PARAMS rectangles will cause the client area to resize to\n  the size of the window, including the window frame. This will remove\n  the window frame and caption items from your window, leaving only the\n  client area displayed.</p>\n</blockquote>\n\n<p>Starting with Windows Vista, simply returning 0 does not affect extended frames, only the standard frame will be removed.</p>\n\n<p>EDIT:</p>\n\n<p>Set the return value with the <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-setwindowlonga#DWL_MSGRESULT\" rel=\"nofollow noreferrer\"><code>DWL_MSGRESULT</code></a> instead of <code>result = 0</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1591590731, "creation_date": 1555330189, "last_edit_date": 1591590731, "question_id": 55688899, "link": "https://stackoverflow.com/questions/55688899/how-to-keep-shadow-in-borderless-window", "title": "how to keep shadow in borderless window", "body": "<p>I'm trying to drop a shadow on a borderless window using Qt in windows.\nI succeeded in dropping the shadow when launching the application, referring to the following article.</p>\n\n<ul>\n<li><p><a href=\"https://stackoverflow.com/questions/16765561/borderless-window-using-areo-snap-shadow-minimize-animation-and-shake\">Borderless Window Using Areo Snap, Shadow, Minimize Animation, and Shake</a></p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/43818022/borderless-window-with-drop-shadow\">Borderless Window with Drop Shadow</a></p></li>\n</ul>\n\n<p>But I encountered the problem that the shadow will disappear if the application is deactivated and reactivated (\nIn other words, click the other applications, and click my application again.)</p>\n\n<p>Perhaps my implementation is not good enough.\nI'm glad if you have some ideas for this issue.</p>\n\n<p>I'm trying to imprement Qt with <a href=\"https://github.com/therecipe/qt\" rel=\"nofollow noreferrer\">Go bindings</a>\nHere is the code snippet:</p>\n\n<pre><code>package qframelesswindow\n\nimport (\n    \"unsafe\"\n\n    \"github.com/therecipe/qt/core\"\n    \"github.com/therecipe/qt/widgets\"\n\n    win \"github.com/akiyosi/w32\"\n)\n\nfunc (f *QFramelessWindow) SetNativeEvent(app *widgets.QApplication) {\n    filterObj := core.NewQAbstractNativeEventFilter()\n    filterObj.ConnectNativeEventFilter(func(eventType *core.QByteArray, message unsafe.Pointer, result int) bool {\n        msg := (*win.MSG)(message)\n        lparam := msg.LParam\n        hwnd := msg.Hwnd\n        var uflag uint\n        uflag = win.SWP_NOZORDER | win.SWP_NOOWNERZORDER | win.SWP_NOMOVE | win.SWP_NOSIZE | win.SWP_FRAMECHANGED\n        var nullptr win.HWND\n        shadow := &amp;win.MARGINS{0, 0, 0, 1}\n\n        switch msg.Message {\n        case win.WM_CREATE:\n            style := win.WS_POPUP | win.WS_THICKFRAME | win.WS_MINIMIZEBOX | win.WS_MAXIMIZEBOX | win.WS_CAPTION\n            win.SetWindowLong(hwnd, win.GWL_STYLE, uint32(style))\n\n            win.DwmExtendFrameIntoClientArea(hwnd, shadow)\n            win.SetWindowPos(hwnd, nullptr, 0, 0, 0, 0, uflag)\n\n            return true\n\n        case win.WM_NCCALCSIZE:\n            if msg.WParam == 1 {\n                // this kills the window frame and title bar we added with WS_THICKFRAME and WS_CAPTION\n                result = 0\n                return true\n            }\n            return false\n\n        case win.WM_GETMINMAXINFO:\n            mm := (*win.MINMAXINFO)((unsafe.Pointer)(lparam))\n            mm.PtMinTrackSize.X = int32(f.minimumWidth)\n            mm.PtMinTrackSize.Y = int32(f.minimumHeight)\n            return true\n\n        default:\n        }\n        return false\n    })\n    app.InstallNativeEventFilter(filterObj)\n}\n</code></pre>\n\n<p>All source code is in my repository;\n<a href=\"https://github.com/akiyosi/goqtframelesswindow\" rel=\"nofollow noreferrer\">akiyosi/goqtframelesswindow</a></p>\n"}, {"tags": ["go", "video-streaming"], "comments": [{"owner": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "edited": false, "score": 0, "creation_date": 1555378021, "post_id": 55688480, "comment_id": 98080441, "body": "If you use a http connection, the data must be send in the base 7 format. The client side must then convert it back to base 8."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 1862925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32df229408779a6c772c90164f441dd?s=128&d=identicon&r=PG", "display_name": "user1862925", "link": "https://stackoverflow.com/users/1862925/user1862925"}, "edited": false, "score": 0, "creation_date": 1555359344, "post_id": 55695316, "comment_id": 98075556, "body": "Oh the video is not playing at all, on any browser sorry for not mentioning that. The player loads but the connection is broken before it plays anything. Also the disconnects happen after just a couple of seconds, i have never experienced similar behaviour when streaming files before, so i am quite certain something is wrong with my implementation or the way i serve data. The range request should be handled properly when using http.ServeContent with a ReadSeeker according to the documentation."}, {"owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "reply_to_user": {"reputation": 63, "user_id": 1862925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32df229408779a6c772c90164f441dd?s=128&d=identicon&r=PG", "display_name": "user1862925", "link": "https://stackoverflow.com/users/1862925/user1862925"}, "edited": false, "score": 0, "creation_date": 1555359449, "post_id": 55695316, "comment_id": 98075604, "body": "<code>Also the disconnects happen after just a couple of seconds, i have never experienced similar behavior when streaming files before</code> Thats strange, because it very common, especial on apple clients. Only the option is you are corrupting the data somehow."}, {"owner": {"reputation": 63, "user_id": 1862925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32df229408779a6c772c90164f441dd?s=128&d=identicon&r=PG", "display_name": "user1862925", "link": "https://stackoverflow.com/users/1862925/user1862925"}, "edited": false, "score": 0, "creation_date": 1555360189, "post_id": 55695316, "comment_id": 98075900, "body": "What do you mean its very common? So normally any attempt to see any video over http fails for you? Surely VLC which has an option to add a video steam wouldn&#39;t behave the same way as my browser? I get the exact same error after around the same amount of chunks. Maybe i should try to change to another OS to see if the issue persists but i do think something is wrong elsewhere"}, {"owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "reply_to_user": {"reputation": 63, "user_id": 1862925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32df229408779a6c772c90164f441dd?s=128&d=identicon&r=PG", "display_name": "user1862925", "link": "https://stackoverflow.com/users/1862925/user1862925"}, "edited": false, "score": 0, "creation_date": 1555360240, "post_id": 55695316, "comment_id": 98075923, "body": "No, The client canceling an HTTP request (by closing the TCP session) before the last byte is received is very common."}], "tags": [], "owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "is_accepted": false, "score": 1, "last_activity_date": 1555353153, "creation_date": 1555353153, "answer_id": 55695316, "question_id": 55688480, "link": "https://stackoverflow.com/questions/55688480/why-does-clients-reading-my-video-via-http-servecontent-keep-closing-the-connect/55695316#55695316", "title": "Why does clients reading my video via http.ServeContent keep closing the connection?", "body": "<p>Nothing is wrong. There is nothing that requires the client to not disconnect until the server has sent all the data. It is very common, especially for mp4 files, for the client to perform a standard http request, then cancel after it has received the headers. </p>\n\n<p>I suspect however the video is not playing they way you expect? If that is the case, make sure your server  implements http range requests. </p>\n"}], "owner": {"reputation": 63, "user_id": 1862925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32df229408779a6c772c90164f441dd?s=128&d=identicon&r=PG", "display_name": "user1862925", "link": "https://stackoverflow.com/users/1862925/user1862925"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555353153, "creation_date": 1555328753, "last_edit_date": 1555351727, "question_id": 55688480, "link": "https://stackoverflow.com/questions/55688480/why-does-clients-reading-my-video-via-http-servecontent-keep-closing-the-connect", "title": "Why does clients reading my video via http.ServeContent keep closing the connection?", "body": "<p>I am currently working on a small project for serving video to a browser or other media clients via http.ServeContent. I have implemented my own ReadSeeker which looks like this: </p>\n\n<pre><code>//the seek is not fully working yet but works fine for the initial two calls that is being called internally from http to decide the file size.\n\nfunc (c *Client) Seek(offset int64, whence int) (t int64, e error) {\n    switch whence {\n    case 0:\n        t = offset\n    case 1:\n        t = c.seek + offset\n    case 2:\n        t = c.SelectedFile().Length + offset\n    }\n\n    if c.seek != t {\n        //TODO\n        c.seek = t\n    }\n\n    return\n}\n\nfunc (c *Client) Read(p []byte) (n int, err error) {\n    if c.done {\n        return 0, io.EOF\n    }\n\n    for {\n        result := &lt;-c.Results\n\n        if result.piece == nil {\n            return 0, io.EOF\n        }\n\n        for i, b := range result.bytes {\n            index := int64(i)\n            if index &lt; 0 || index &gt; c.SelectedFile().Length {\n                continue\n            }\n\n            n++\n            p[index] = b\n        }\n\n        return\n    }\n}\n</code></pre>\n\n<p>Everything works fine and dandy if I for instance use curl to fetch the data eg data keeps being streamed (1024 bytes per read). However as soon as I use a browser or even VLC, after between 5 to 10 reads the http writer.Write() returns an EPIPE error and the connection is broken. The error appear to come directly from dst.Write(buf[0:nr]) inside io.go :</p>\n\n<pre><code>...\nfunc copyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error) {\n    ...\n    for {\n        nr, er := src.Read(buf)\n        if nr &gt; 0 {\n            nw, ew := dst.Write(buf[0:nr])\n            if nw &gt; 0 {\n                written += int64(nw)\n            }\n            if ew != nil {\n                err = ew\n                break\n            }\n            if nr != nw {\n                err = ErrShortWrite\n                break\n            }\n        }\n        if er != nil {\n            if er != EOF {\n                err = er\n            }\n            break\n        }\n    }\n    return written, err\n}\n</code></pre>\n\n<p>I have tried to debug for days now and can't seem to figure out the cause.  I've been comparing the bytes I serve with the actual file and it does not not seem to be anything wrong with the data.</p>\n\n<p>Any ideas what might be wrong?</p>\n"}, {"tags": ["go", "environment-variables", "apm"], "comments": [{"owner": {"reputation": 179, "user_id": 4718921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c07e4f74942d3e358b307d23a057e3?s=128&d=identicon&r=PG&f=1", "display_name": "Muhamed Keta", "link": "https://stackoverflow.com/users/4718921/muhamed-keta"}, "edited": false, "score": 0, "creation_date": 1555330724, "post_id": 55688256, "comment_id": 98060987, "body": "Recheck gotenv.Load() in init or before initing the struct"}, {"owner": {"reputation": 87, "user_id": 3879339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9d85ecedc58d7a3109dfbb291c79b79?s=128&d=identicon&r=PG&f=1", "display_name": "M7Shapan", "link": "https://stackoverflow.com/users/3879339/m7shapan"}, "reply_to_user": {"reputation": 179, "user_id": 4718921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c07e4f74942d3e358b307d23a057e3?s=128&d=identicon&r=PG&f=1", "display_name": "Muhamed Keta", "link": "https://stackoverflow.com/users/4718921/muhamed-keta"}, "edited": false, "score": 0, "creation_date": 1555334758, "post_id": 55688256, "comment_id": 98063389, "body": "@MuhamedKeta <code>gotenv.Load()</code> working well, but the problem is that <code>go.elastic.co&#47;apm</code> can&#39;t see env variables"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555336382, "post_id": 55688256, "comment_id": 98064396, "body": "This is probably an issue with <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">initialization order</a>. <a href=\"https://github.com/elastic/apm-agent-go/blob/d4ce90a/tracer.go#L62\" rel=\"nofollow noreferrer\">go.elastic.co/apm reads the environment variables in its init method</a>. We can&#39;t tell for sure or offer solutions without seeing some code. If you <a href=\"https://godoc.org/go.elastic.co/apm#NewTracer\" rel=\"nofollow noreferrer\">create your own Tracer</a> after loading your file it&#39;ll probably work."}, {"owner": {"reputation": 87, "user_id": 3879339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9d85ecedc58d7a3109dfbb291c79b79?s=128&d=identicon&r=PG&f=1", "display_name": "M7Shapan", "link": "https://stackoverflow.com/users/3879339/m7shapan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555351545, "post_id": 55688256, "comment_id": 98072436, "body": "@Peter Thank you peter i created new tracer and it works now"}], "owner": {"reputation": 87, "user_id": 3879339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9d85ecedc58d7a3109dfbb291c79b79?s=128&d=identicon&r=PG&f=1", "display_name": "M7Shapan", "link": "https://stackoverflow.com/users/3879339/m7shapan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 277, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555327848, "creation_date": 1555327848, "question_id": 55688256, "link": "https://stackoverflow.com/questions/55688256/read-apm-env-variable-from-env-file-golang", "title": "read apm env variable from env file golang", "body": "<p>I'm using elastic apm for my go app during\n development i export env variable through the terminal and it's working.\nbut now i want to deploy the app so i need to read variables from the  .env file </p>\n\n<p>explanation</p>\n\n<p>i use <code>go.elastic.co/apm/module/apmhttp</code> at my app\nand when <code>go.elastic.co/apm</code> read env variables, \nit can't see <code>ELASTIC_APM_SERVICE_NAME</code>, <code>ELASTIC_APM_SERVER_URL</code> or <code>ELASTIC_APM_SECRET_TOKEN</code>\nthat existed at my .env on my app files.</p>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1555317358, "post_id": 55685257, "comment_id": 98054204, "body": "You have to abstract out (mock) not related dependencies. In your case, you might  want to mock the directory&#39;s content."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555335822, "post_id": 55685257, "comment_id": 98064082, "body": "&quot;How can I pass a folder&quot; - you wouldn&#39;t pass a directory (folder) to test your handler, because that&#39;s not what your handler takes in normally. That&#39;s what your <i>JavaScript</i> works with. Your handler just receives a set of files, which is what it should be tested against."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 11148310, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WSzG8ZG32wk/AAAAAAAAAAI/AAAAAAAAADg/pGZQyyRr8S0/photo.jpg?sz=128", "display_name": "\u0414\u043c\u0438\u0442\u0440\u043e \u042f\u043d\u043a\u043e\u0432\u0441\u044c\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/11148310/%d0%94%d0%bc%d0%b8%d1%82%d1%80%d0%be-%d0%af%d0%bd%d0%ba%d0%be%d0%b2%d1%81%d1%8c%d0%ba%d0%b8%d0%b9"}, "is_accepted": false, "score": 2, "last_activity_date": 1555319306, "creation_date": 1555319306, "answer_id": 55685863, "question_id": 55685257, "link": "https://stackoverflow.com/questions/55685257/how-to-test-an-http-function-which-takes-folder-as-an-input/55685863#55685863", "title": "How to test an HTTP function which takes folder as an input?", "body": "<p>You should write your file to request:</p>\n\n<pre><code>func newFileUploadRequest(url string, paramName, path string) (*http.Request, error) {\nfile, err := os.Open(path)\n\nif err != nil {\n    return nil, err\n}\n\ndefer file.Close()\n\nbody := new(bytes.Buffer)\n\nwriter := multipart.NewWriter(body)\n\npart, err := writer.CreateFormFile(paramName, filepath.Base(path))\n\nif err != nil {\n    return nil, err\n}\n\n_, err = io.Copy(part, file)\n\nif err != nil {\n    return nil, err\n}\n\nerr = writer.Close()\nif err != nil {\n    return nil, err\n}\nreq, err := http.NewRequest(\"POST\", url, body)\n\nif err != nil {\n    return nil, err\n}\n\nreq.Header.Add(\"Content-Type\", writer.FormDataContentType())\n\nreturn req, err\n</code></pre>\n\n<p>}</p>\n\n<p>then use it: </p>\n\n<pre><code>    req, err := newFileUploadRequest(\"http://localhost:1234/upload\", \"multiplefiles\", path)\n\nclient := &amp;http.Client{}\n\nresp, err := client.Do(req)\n</code></pre>\n\n<p>It works for me, hope it helps you)</p>\n"}], "owner": {"reputation": 11, "user_id": 10374937, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-s416XnsRka8/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO6UBAXFCgJD3qdbDiw1_hxuQ6SFg/mo/photo.jpg?sz=128", "display_name": "akshita babel", "link": "https://stackoverflow.com/users/10374937/akshita-babel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555323883, "creation_date": 1555317121, "last_edit_date": 1555323883, "question_id": 55685257, "link": "https://stackoverflow.com/questions/55685257/how-to-test-an-http-function-which-takes-folder-as-an-input", "title": "How to test an HTTP function which takes folder as an input?", "body": "<p>I have an HTTP handler function (POST) which allows a user to upload a folder from a web browser application. The folder is passed from JavaScript code as an array of files in a folder and on the backend (Go API) it is accepted as a <code>[]*multipart.FileHeader</code>. I am struggling in writing a Go unit test for this function. How can I pass a folder as input from a test function? I need help in creating the <code>httpRequest</code> in the right format.</p>\n\n<p>I have tried to use / set values for an array of <code>FileHeader</code>, but some attributes are not allowed to be imported. So there must be a different way of testing this handler that I am not aware of.</p>\n\n<p>Handler Function for folder upload:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func FolderUpload(w http.ResponseWriter, r *http.Request, p httprouter.Params) { \n// SOME LOGIC\n\nfiles := r.MultipartForm.File[\"multiplefiles\"] // files is of the type []*multipart.FileHeader\n\n// SOME LOGIC TO PARSE THE FILE NAMES TO RECREATE THE SAME TREE STRUCTURE ON THE SERVER-SIDE AND STORE THEM AS A FOLDER\n</code></pre>\n\n<p>Unit Test function for the same handler:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestFolderUpload(t *testing.T) {\n//     FolderPreCondition()\n     request, err := http.NewRequest(\"POST\", uri, body) //Q: HOW TO CREATE THE BODY ACCEPTABLE BY THE ABOVE HANDLER FUNC?\n//     SOME ASSERTION LOGIC\n}\n</code></pre>\n"}, {"tags": ["go", "reverse-proxy"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1555317123, "post_id": 55684748, "comment_id": 98054093, "body": "<code>mux.Handle(&quot;&#47;app1&quot;, proxy)</code> handles only the exact path <code>&quot;&#47;app1&quot;</code>. To also handle things like <code>&quot;&#47;app1&#47;style.css&quot;</code>, register the path <code>&quot;&#47;app1&#47;&quot;</code> (with trailing slash), <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">as documented</a>."}, {"owner": {"reputation": 877, "user_id": 1291234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ww6O2.jpg?s=128&g=1", "display_name": "hsnkhrmn", "link": "https://stackoverflow.com/users/1291234/hsnkhrmn"}, "edited": false, "score": 0, "creation_date": 1555317331, "post_id": 55684748, "comment_id": 98054186, "body": "You may want to check <a href=\"https://medium.com/ymedialabs-innovation/reverse-proxy-in-go-d26482acbcad\" rel=\"nofollow noreferrer\">this tutorial</a> for more comprehensive example."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1555397337, "post_id": 55684892, "comment_id": 98085402, "body": "The OP is already using golang&#39;s native <code>httputil.ReverseProxy</code>. Its source is a much more reliable/maintained place to learn from: <a href=\"https://golang.org/src/net/http/httputil/reverseproxy.go\" rel=\"nofollow noreferrer\">golang.org/src/net/http/httputil/reverseproxy.go</a>"}], "tags": [], "owner": {"reputation": 56, "user_id": 435071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a141091cb34d9929dd27bf7af3d934?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/435071/chris"}, "is_accepted": true, "score": 0, "last_activity_date": 1555315682, "creation_date": 1555315682, "answer_id": 55684892, "question_id": 55684748, "link": "https://stackoverflow.com/questions/55684748/how-to-make-reverse-proxy/55684892#55684892", "title": "How to make reverse proxy?", "body": "<p>Writing a reverse proxy is a complex task. If you plan to expose it on the public internet, I suggest to use an existing one, e.g. <a href=\"https://caddyserver.com/\" rel=\"nofollow noreferrer\">Caddyserver</a>, which is written in Go and still free if you compile it yourself instead of using the pre-compiled binaries. The <a href=\"https://github.com/mholt/caddy\" rel=\"nofollow noreferrer\">source code of Caddyserver</a> can also give you ideas how to implement it on your own, if you still want to pursue that idea.</p>\n\n<p>To your more specific question about serving files: This can be done with the http.ServeFile method or easier with <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">httprouter's</a> ServeFiles or FileServer methods. See <a href=\"https://github.com/julienschmidt/httprouter#static-files\" rel=\"nofollow noreferrer\">https://github.com/julienschmidt/httprouter#static-files</a>.</p>\n"}], "owner": {"reputation": 127, "user_id": 9717132, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f7hldCt1OsQ/AAAAAAAAAAI/AAAAAAAAABk/bOP59Q7vf5M/photo.jpg?sz=128", "display_name": "Angel Pensive", "link": "https://stackoverflow.com/users/9717132/angel-pensive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 55684892, "answer_count": 1, "score": 0, "last_activity_date": 1555316200, "creation_date": 1555315026, "last_edit_date": 1555316200, "question_id": 55684748, "link": "https://stackoverflow.com/questions/55684748/how-to-make-reverse-proxy", "title": "How to make reverse proxy?", "body": "<p>I have a server written in Go. I want to write for it a reverse proxy server.  The server is compiled into one binary file.  When I try to access it through a proxy server, it returns only the HTML page without bindings to CSS and JS scripts. How can I organize the transfer of static files?</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n    \"time\"\n)\n\nfunc main() {\n    mux := http.NewServeMux()\n    u1, _ := url.Parse(\"http://localhost:8080/\")\n    proxy := httputil.NewSingleHostReverseProxy(u1)\n    mux.Handle(\"/app1\", proxy)\n\n    serv := &amp;http.Server{\n        Addr:           \":9090\",\n        ReadTimeout:    10 * time.Second,\n        WriteTimeout:   10 * time.Second,\n        Handler:        mux,\n    }\n\n    err := serv.ListenAndServe()\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "reflect"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1555315787, "post_id": 55684734, "comment_id": 98053499, "body": "You have to use package reflect."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1555316647, "last_edit_date": 1555316647, "creation_date": 1555316227, "answer_id": 55685024, "question_id": 55684734, "link": "https://stackoverflow.com/questions/55684734/how-to-through-structs-fieldname-get-value/55685024#55685024", "title": "How to through struct&#39;s fieldName get value", "body": "<p>You may do what you want with the <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow noreferrer\"><code>Value.FieldByName()</code></a> function. Just range over the parts of the path which may be splitted using <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>strings.Split()</code></a>.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>func getValue(i interface{}, path string) interface{} {\n    v := reflect.ValueOf(i)\n    for _, field := range strings.Split(path[1:], \"/\") {\n        v = v.FieldByName(field)\n    }\n    return v.Interface()\n}\n\nfunc main() {\n    mycat := cat{\"cat\", mcat{1}}\n    id := getValue(mycat, \"/M/ID\")\n    fmt.Println(id)\n}\n</code></pre>\n\n<p>It outputs (try it on the <a href=\"https://play.golang.org/p/-Gzk90D2jf7\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1\n</code></pre>\n\n<p><strong>Some things to note:</strong></p>\n\n<p>The above solution works for all struct types, not just with <code>cat</code>. Checks if the passed value is a struct or the field exists is omitted.</p>\n\n<p>I cut of the leading <code>/</code> of the path with a slice expression: <code>path[1:]</code> so we don't have to deal with an empty field name inside the loop.</p>\n\n<p>The above <code>getValue()</code> returns the result as an <code>interface{}</code>. If you need the <code>ID</code> as an <code>int</code>, you may use type assertion like this:</p>\n\n<pre><code>var intID int\nintID = id.(int)\n</code></pre>\n\n<p>Also note that it may be nicer / more useful to use a variadic parameter for the path:</p>\n\n<pre><code>func getValue(i interface{}, path ...string) interface{} {\n    v := reflect.ValueOf(i)\n    for _, field := range path {\n        v = v.FieldByName(field)\n    }\n    return v.Interface()\n}\n\nfunc main() {\n    mycat := cat{\"cat\", mcat{1}}\n    id := getValue(mycat, \"M\", \"ID\")\n    fmt.Println(id)\n}\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/OyMDHxrJW4Q\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7352372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4eff2a8c7dea232dd1723128d06811f7?s=128&d=identicon&r=PG&f=1", "display_name": "\u4e54\u4f1f\u6770", "link": "https://stackoverflow.com/users/7352372/%e4%b9%94%e4%bc%9f%e6%9d%b0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555316693, "creation_date": 1555314969, "last_edit_date": 1555316693, "question_id": 55684734, "link": "https://stackoverflow.com/questions/55684734/how-to-through-structs-fieldname-get-value", "title": "How to through struct&#39;s fieldName get value", "body": "<pre><code>type mcat struct {\n    ID int\n}\ntype cat struct {\n    Name string\n    M    mcat\n}\n\nfunc getValue(path string, mcat cat){\n    //throuth struct path get the value\n}\n\nfunc main(){\n    mycat := cat{\"cat\", mcat{1}}\n    id := getvalue(\"/M/ID\", mycat)\n}\n</code></pre>\n\n<p>Can I do this by reflecting to get a value based on the field name?</p>\n"}, {"tags": ["docker", "go", "module", "package"], "answers": [{"tags": [], "owner": {"reputation": 1800, "user_id": 2372663, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/D76OC.jpg?s=128&g=1", "display_name": "petomalina", "link": "https://stackoverflow.com/users/2372663/petomalina"}, "is_accepted": false, "score": 0, "last_activity_date": 1555334138, "creation_date": 1555334138, "answer_id": 55690042, "question_id": 55684346, "link": "https://stackoverflow.com/questions/55684346/dockerizing-a-package-oriented-design-go-modules-application/55690042#55690042", "title": "Dockerizing a package oriented design go modules application", "body": "<p>This looks like you are building the project without experimental modules enabled while out of GOPATH.</p>\n\n<p>Try copying your sources into <code>/go/src/github.com/your-name/project1</code> and build the project there.</p>\n"}, {"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1564428383, "creation_date": 1564428383, "answer_id": 57260275, "question_id": 55684346, "link": "https://stackoverflow.com/questions/55684346/dockerizing-a-package-oriented-design-go-modules-application/57260275#57260275", "title": "Dockerizing a package oriented design go modules application", "body": "<p>The fact that the error message refers to <code>GOPATH</code> indicates that the <code>go</code> command is not running in module mode.</p>\n\n<p>The most likely causes of that are a missing <code>go.mod</code> file or a working directory inside <code>$GOPATH/src</code>. (I notice that you're explicitly changing the working directory to <code>/src</code>, but if <code>$GOPATH</code> is equal to <code>/</code> that's still not going to activate module mode.)</p>\n\n<p>Try adding <code>GO111MODULE=on</code> to the environment. (That should at least resolve the immediate problem, but may expose some new ones.)</p>\n"}], "owner": {"reputation": 61, "user_id": 2136784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd547aeaec45565e870d51a9d716075?s=128&d=identicon&r=PG", "display_name": "Mota Nginya", "link": "https://stackoverflow.com/users/2136784/mota-nginya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 232, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1564428383, "creation_date": 1555313291, "question_id": 55684346, "link": "https://stackoverflow.com/questions/55684346/dockerizing-a-package-oriented-design-go-modules-application", "title": "Dockerizing a package oriented design go modules application", "body": "<p>I am in the process of trying out go modules in a package oriented design fashion as described <a href=\"https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html\" rel=\"nofollow noreferrer\">here</a> so that multiple executable services can be 'dockerized' but I am struggling to get things wired up properly in a single repo. I am unable to get successful docker image built using this approach. Most of the examples online are geared towards single module approach where main.go is and dockerfile are in the root folder.</p>\n\n<p>My directory structure looks like this\nproject1\n - api\n - build\n   - service1\n     - dockerfile\n   - service2\n     - dockerfile\n - cmd\n   - service1\n     - main.go\n   - service2\n     - main.go\n - deployments\n - docs\n - internal\n - third_party\n - go.mod\n - go.sum\n - Makefile\n - vendor</p>\n\n<pre><code># Accept the Go version for the image to be set as a build argument.\n# Default to Go 1.11\nARG GO_VERSION=1.11\n\n# First stage: build the executable.\nFROM golang:${GO_VERSION}-alpine AS builder\n\n# Create the user and group files that will be used in the running container to\n# run the process as an unprivileged user.\nRUN mkdir /user &amp;&amp; \\\n    echo 'nobody:x:65534:65534:nobody:/:' &gt; /user/passwd &amp;&amp; \\\n    echo 'nobody:x:65534:' &gt; /user/group\n\n# Install the Certificate-Authority certificates for the service1 to be able to make\n# calls to HTTPS endpoints.\nRUN apk add --no-cache ca-certificates\n\n# Set the environment variables for the go command:\n# * CGO_ENABLED=0 to build a statically-linked executable\n# * GOFLAGS=-mod=vendor to force `go build` to look into the `/vendor` folder.\nENV CGO_ENABLED=0 GOFLAGS=-mod=vendor\n\n# Set the working directory outside $GOPATH to enable the support for modules.\nWORKDIR /src\n\n# Import the code from the context.\nCOPY ./ ./\n\n# Build the executable to `/service1`. Mark the build as statically linked.\nRUN go build \\\n    -installsuffix 'static' \\\n    -o /service1 .\n\n# Final stage: the running container.\nFROM scratch AS final\n\n# Import the user and group files from the first stage.\nCOPY --from=builder /user/group /user/passwd /etc/\n\n# Import the Certificate-Authority certificates for enabling HTTPS.\nCOPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\n\n# Import the compiled executable from the second stage.\nCOPY --from=builder /service1 /service1\n\nEXPOSE 8080\n\n# # Run the compiled binary.\nENTRYPOINT [\"/service1\"]\n\n</code></pre>\n\n<p>When I run a <code>docker build -t service1:v0.0.1 .</code> I get this error for all my dependencies </p>\n\n<pre><code> /go/src/github.com/.../project1/internal/pkg/common (from $GOPATH)\nmain.go:15:2: cannot find package \"github.com/.../project1/internal/pkg/delegates\" in any of:\n        /usr/local/go/src/github.com/.../project1/internal/pkg/delegates (from $GOROOT)\n        /go/src/github.com/.../project1/internal/pkg/delegates (from $GOPATH)\nmain.go:16:2: cannot find package \"github.com/.../project1/internal/pkg/secure\" in any of:\n        /usr/local/go/src/github.com/.../project1/internal/pkg/secure (from $GOROOT)\n        /go/src/github.com/.../project1/internal/pkg/secure (from $GOPATH)\nmain.go:17:2: cannot find package \"github.com/.../project1/statik\" in any of:\n        /usr/local/go/src/github.com/.../project1/statik (from $GOROOT)\n        /go/src/github.com/.../project1/statik (from $GOPATH)\nmain.go:18:2: cannot find package \"github.com/grpc-ecosystem/grpc-gateway/runtime\" in any of:\n        /usr/local/go/src/github.com/grpc-ecosystem/grpc-gateway/runtime (from $GOROOT)\n        /go/src/github.com/grpc-ecosystem/grpc-gateway/runtime (from $GOPATH)\nmain.go:19:2: cannot find package \"github.com/heptiolabs/healthcheck\" in any of:\n        /usr/local/go/src/github.com/heptiolabs/healthcheck (from $GOROOT)\n        /go/src/github.com/heptiolabs/healthcheck (from $GOPATH)\nmain.go:21:2: cannot find package \"github.com/rakyll/statik/fs\" in any of:\n        /usr/local/go/src/github.com/rakyll/statik/fs (from $GOROOT)\n        /go/src/github.com/rakyll/statik/fs (from $GOPATH)\nmain.go:22:2: cannot find package \"github.com/sirupsen/logrus\" in any of:\n        /usr/local/go/src/github.com/sirupsen/logrus (from $GOROOT)\n        /go/src/github.com/sirupsen/logrus (from $GOPATH)\nmain.go:23:2: cannot find package \"google.golang.org/grpc\" in any of:\n        /usr/local/go/src/google.golang.org/grpc (from $GOROOT)\n        /go/src/google.golang.org/grpc (from $GOPATH)\n\n</code></pre>\n\n<p>Basically it cannot find all dependencies ...</p>\n"}, {"tags": ["go", "build", "package", "main", "golang-migrate"], "comments": [{"owner": {"reputation": 3167, "user_id": 2227031, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/aee34ebdb4f8efaf6ddf16716343f301?s=128&d=identicon&r=PG", "display_name": "jk2K", "link": "https://stackoverflow.com/users/2227031/jk2k"}, "edited": false, "score": 0, "creation_date": 1569461047, "post_id": 55684090, "comment_id": 102607034, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28081486/how-can-i-go-run-a-project-with-multiple-files-in-the-main-package\">How can I &quot;go run&quot; a project with multiple files in the main package?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 2468938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QejyD.jpg?s=128&g=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/2468938/roman"}, "edited": false, "score": 0, "creation_date": 1555316067, "post_id": 55684385, "comment_id": 98053627, "body": "Thank you for your reply. I can not find documentation about this case. A phrase like this: you can use both possibilities, but it is recommended ..."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1555316386, "last_edit_date": 1555316386, "creation_date": 1555313467, "answer_id": 55684385, "question_id": 55684090, "link": "https://stackoverflow.com/questions/55684090/is-it-wrong-duplicate-func-main-in-package-main-and-why-it-is-wrong/55684385#55684385", "title": "Is it wrong duplicate &quot;func main&quot; in &quot;package main&quot; and why it is wrong?", "body": "<p>You can't have the same symbol declared twice at the package level in the same package.</p>\n\n<p>And if you have 2 files in the same folder, both having <code>package main</code> declaration, that is exactly what you're doing. This is why your IDE complains: it tries to build / compile those 2 files as one package, same as writing <code>go build .</code>: this designates the package in the current folder, including all source files.</p>\n\n<p><code>go run main.go</code> and <code>go run second.go</code> works because you specify <em>files</em> to build (more specifically a single file), not packages. And having a single <code>main.go</code> or <code>second.go</code> being the <code>main</code> package does not violate the above rule: each file only contains the <code>main()</code> function once.</p>\n\n<p>So in short: <code>go run main.go</code> <strong>ignores</strong> <code>second.go</code>.</p>\n\n<p>Usually if you want to create multiple apps with multiple <code>main()</code> functions in the same project, it's easiest to just place different <code>main()</code> functions in different folders, conventionally inside a <code>cmd</code> folder.</p>\n\n<p><a href=\"https://golang.org/cmd/go/\" rel=\"noreferrer\">See Command Go:</a></p>\n\n<blockquote>\n  <h2><a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"noreferrer\">Compile packages and dependencies</a></h2>\n  \n  <p>Usage:</p>\n\n<pre><code>go build [-o output] [-i] [build flags] [packages]\n</code></pre>\n  \n  <p>Build compiles the packages named by the import paths, along with their dependencies, but it does not install the results.</p>\n  \n  <p><strong>If the arguments to build are a list of .go files, build treats them as a list of source files specifying a single package.</strong></p>\n  \n  <h2><a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"noreferrer\">Compile and run Go program</a></h2>\n  \n  <p>Usage:</p>\n\n<pre><code>go run [build flags] [-exec xprog] package [arguments...]\n</code></pre>\n  \n  <p>Run compiles and runs the named main Go package. <strong>Typically the package is specified as a list of .go source files, but it may also be an import path, file system path, or pattern matching a single known package, as in 'go run .' or 'go run my/cmd'.</strong></p>\n</blockquote>\n\n<p>Also see <a href=\"https://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a></p>\n"}], "owner": {"reputation": 39, "user_id": 2468938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QejyD.jpg?s=128&g=1", "display_name": "Roman", "link": "https://stackoverflow.com/users/2468938/roman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1555316386, "creation_date": 1555312290, "question_id": 55684090, "link": "https://stackoverflow.com/questions/55684090/is-it-wrong-duplicate-func-main-in-package-main-and-why-it-is-wrong", "title": "Is it wrong duplicate &quot;func main&quot; in &quot;package main&quot; and why it is wrong?", "body": "<p>Please help me to understand why duplicate \"func main\" in \"package main\" is wrong. Error in VC: \"main redeclared in this block\".</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n// $ tree\n// .\n// \u251c\u2500\u2500 main.go\n// \u251c\u2500\u2500 second.go\n\n// ```go build main.go```\n// or \n// ```go build .```\n\n\n// file: main.go\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"this is file MAIN\")\n}\n\n// file: second.go\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"this is file SECOND\")\n}\n\n</code></pre>\n\n<p>I can build/run this:\ngo build/run main.go - correct\ngo build/run . - wrong</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 0, "creation_date": 1555300145, "post_id": 55681868, "comment_id": 98048713, "body": "Please add the command and the exact error message."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1555304763, "post_id": 55681868, "comment_id": 98049561, "body": "What&#39;s wrong with <code>.&#47;...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10958852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9358d76efe003d043d991139c01eb290?s=128&d=identicon&r=PG&f=1", "display_name": "Dack.H", "link": "https://stackoverflow.com/users/10958852/dack-h"}, "edited": false, "score": 0, "creation_date": 1555324553, "post_id": 55685420, "comment_id": 98057777, "body": "my solution <code>for filename in $(ls $pwd); do if [ -d &quot;$filename&quot; ] &amp;&amp; [ &quot;$filename&quot; != &quot;static&quot; ];then go test .&#47;$filename&#47;...; fi; done</code>"}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": true, "score": 0, "last_activity_date": 1555317779, "creation_date": 1555317779, "answer_id": 55685420, "question_id": 55681868, "link": "https://stackoverflow.com/questions/55681868/golang-go-test-specific-directory/55685420#55685420", "title": "Golang go test specific directory", "body": "<p>You can use this command to exclude a specific folder:</p>\n\n<pre><code> find ./ -type d  ! -path \"./static*\" ! -path \"./.git*\"  -exec go test -v \"{}\" \\;\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 10958852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9358d76efe003d043d991139c01eb290?s=128&d=identicon&r=PG&f=1", "display_name": "Dack.H", "link": "https://stackoverflow.com/users/10958852/dack-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 55685420, "answer_count": 1, "score": 0, "last_activity_date": 1555317779, "creation_date": 1555294892, "last_edit_date": 1555299349, "question_id": 55681868, "link": "https://stackoverflow.com/questions/55681868/golang-go-test-specific-directory", "title": "Golang go test specific directory", "body": "<p>I want to test files in all other paths except the <code>static</code> path.</p>\n\n<p>I had checked the information,can pass <code>go test -run</code> ,but I have been try to fail</p>\n\n<p>Below is my project path structure</p>\n\n<pre><code>api/...\ncommon/...\nstatic/...    //except this\n...\n</code></pre>\n"}, {"tags": ["sqlite", "go", "darwin"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1555298956, "post_id": 55681778, "comment_id": 98048540, "body": "What does your build command look like?"}, {"owner": {"reputation": 217, "user_id": 3505542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfddb45af24af49d50d95a8aebdbd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "andri_sasuke", "link": "https://stackoverflow.com/users/3505542/andri-sasuke"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1555323690, "post_id": 55681778, "comment_id": 98057316, "body": "go build main.go. @colminator"}], "answers": [{"comments": [{"owner": {"reputation": 217, "user_id": 3505542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfddb45af24af49d50d95a8aebdbd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "andri_sasuke", "link": "https://stackoverflow.com/users/3505542/andri-sasuke"}, "edited": false, "score": 0, "creation_date": 1555323754, "post_id": 55685487, "comment_id": 98057348, "body": "can you give some example for sqlite ?"}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1555318023, "creation_date": 1555318023, "answer_id": 55685487, "question_id": 55681778, "link": "https://stackoverflow.com/questions/55681778/go-sqlite-fail-to-build-compile-on-mac-osx/55685487#55685487", "title": "Go sqlite fail to build/compile on mac osx", "body": "<p>We struggled with that problem for a while . We came to this solution to make the whole library as <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">go plugin</a> and compile it on a linux system and use it in other operating systems.</p>\n"}], "owner": {"reputation": 217, "user_id": 3505542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfddb45af24af49d50d95a8aebdbd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "andri_sasuke", "link": "https://stackoverflow.com/users/3505542/andri-sasuke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555318023, "creation_date": 1555294020, "question_id": 55681778, "link": "https://stackoverflow.com/questions/55681778/go-sqlite-fail-to-build-compile-on-mac-osx", "title": "Go sqlite fail to build/compile on mac osx", "body": "<p>i always fail to compile simple Go code every call or use sqlite library.\ni use go version 1.9.7 and osx mojave (10.14.3)</p>\n\n<p>sample code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jmoiron/sqlx\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\nfunc main() {\n    fmt.Print(\"connecting.\")\n    db := sqlx.MustConnect(\"sqlite3\", \":memory:\")\n    db.Ping()\n    fmt.Print(\"connected\")\n}\n</code></pre>\n\n<p>always getting this error</p>\n\n<pre><code># command-line-arguments\n/usr/local/go/pkg/tool/darwin_amd64/link: /usr/local/go/pkg/tool/darwin_amd64/link: combining dwarf failed: Unknown load command 0x32 (50)\n</code></pre>\n\n<p>any idea ?</p>\n"}, {"tags": ["c", "go", "struct", "pack"], "comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 2, "creation_date": 1555293294, "post_id": 55681650, "comment_id": 98047557, "body": "Does this help?<a href=\"https://medium.com/@liamkelly17/working-with-packed-c-structs-in-cgo-224a0a3b708b\" rel=\"nofollow noreferrer\">medium.com/@liamkelly17/&hellip;</a>"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1555293943, "post_id": 55681650, "comment_id": 98047663, "body": "Thanks for the link, very informative, yet quite complex &gt;&lt;"}], "answers": [{"tags": [], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "is_accepted": true, "score": 2, "last_activity_date": 1555379833, "last_edit_date": 1555379833, "creation_date": 1555358005, "answer_id": 55696357, "question_id": 55681650, "link": "https://stackoverflow.com/questions/55681650/golang-pack-a-struct/55696357#55696357", "title": "golang: pack a struct", "body": "<p>So, per <a href=\"https://github.com/golang/go/wiki/cgo#struct-alignment-issues\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/cgo#struct-alignment-issues</a>: </p>\n\n<p><em>Go doesn't support packed struct (e.g., structs where maximum alignment is 1 byte), you can't use packed C struct in Go. Even if your program passes compilation, it won't do what you want. To use it, <strong>you have to read/write the struct as byte array/slice</strong>.</em></p>\n\n<p>From \"what\" I understood, I've put together this: <a href=\"https://play.golang.org/p/OmdMVDMikSn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OmdMVDMikSn</a>. </p>\n\n<p>Essentially, set up the struct, and <code>binary.Write</code> it into a byte slice, the slice shows 10 bytes.</p>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2887, "favorite_count": 2, "accepted_answer_id": 55696357, "answer_count": 1, "score": 3, "last_activity_date": 1555379833, "creation_date": 1555292519, "question_id": 55681650, "link": "https://stackoverflow.com/questions/55681650/golang-pack-a-struct", "title": "golang: pack a struct", "body": "<p>Please consider this sample go code:</p>\n\n<pre><code>package main\n\n//#include &lt;stdio.h&gt;\n//#include &lt;stdint.h&gt;\n//#pragma pack(push, 1)\n//struct Packed_Struct {\n//  uint16_t A;\n//  uint16_t B;\n//  uint32_t C;\n//  uint16_t D;\n//};\n//#pragma pack(pop)\n//\n//struct UnPacked_Struct {\n//  uint16_t A;\n//  uint16_t B;\n//  uint32_t C;\n//  uint16_t D;\n//};\n//\n//\n//void print_C_struct_size(){\n//  struct Packed_Struct Packed_Struct;\n//  struct UnPacked_Struct UnPacked_Struct;\n//  printf(\"Sizeof Packed_Struct: %lu\\n\", sizeof(Packed_Struct) );\n//  printf(\"Sizeof UnPacked_Struct: %lu\\n\", sizeof(UnPacked_Struct) );\n//  return;\n//}\n//\nimport \"C\"\n\n\n\nimport(\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype GoStruct struct{\n    A   uint16\n    B   uint16\n    C   uint32\n    D   uint16\n}\n\n\nfunc main(){\n    fmt.Println(\"Hello world!\")\n    meh := C.print_C_struct_size()\n    var GoStruct GoStruct\n    fmt.Printf(\"Sizeof GoStruct : %d\\n\", unsafe.Sizeof(GoStruct) ) \n    fmt.Printf(\"meh type: %T\\n\", meh)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>$ go run cgo.go \nHello world!\nSizeof Packed_Struct: 10\nSizeof UnPacked_Struct: 12\nSizeof GoStruct : 12\nmeh type: main._Ctype_void\n</code></pre>\n\n<p>Notice that the struct when packed takes 10 bytes, 12 otherwise. By default, my tries in Go seems to take 12 bytes as shown here. </p>\n\n<p>Is there a Go-ish way to pack this struct so it uses only 10 bytes? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 3000543, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/53af8524a71601fa4c4152ec372f9ae3?s=128&d=identicon&r=PG&f=1", "display_name": "Voz", "link": "https://stackoverflow.com/users/3000543/voz"}, "is_accepted": false, "score": 1, "last_activity_date": 1555283863, "creation_date": 1555283863, "answer_id": 55680887, "question_id": 55680760, "link": "https://stackoverflow.com/questions/55680760/how-can-i-tell-which-version-of-a-dependency-was-pulled/55680887#55680887", "title": "How can I tell which version of a dependency was pulled?", "body": "<p>There's a couple ways you can go about this. When you run <code>go get remote/path/to/lib</code>, it installs that to <code>$GOPATH/src/remote/path/to/lib</code>, so if you <code>cd</code> into that path and run <code>git describe --tags</code>, you'll see the latest version pulled. However, if you manage your project with go modules, you should be able to see the version you're using in the <code>go.mod</code> file after the dependency name.</p>\n\n<p>So, in essence:\n<code>go get github.com/bwmarrin/discordgo &amp;&amp; cd $GOPATH/src/github.com/bwmarrin/discordgo &amp;&amp; git describe --tags</code> should be the quick and dirty way to find what version you're using for this specific scenario.</p>\n"}, {"tags": [], "owner": {"reputation": 2485, "user_id": 3639630, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPscq.jpg?s=128&g=1", "display_name": "Wesgur", "link": "https://stackoverflow.com/users/3639630/wesgur"}, "is_accepted": false, "score": 0, "last_activity_date": 1555286731, "last_edit_date": 1555286731, "creation_date": 1555284029, "answer_id": 55680899, "question_id": 55680760, "link": "https://stackoverflow.com/questions/55680760/how-can-i-tell-which-version-of-a-dependency-was-pulled/55680899#55680899", "title": "How can I tell which version of a dependency was pulled?", "body": "<p>If you want an updated version of your package try using <code>go get -u &lt;package&gt;</code></p>\n\n<p>Or maybe use dependency management such as <code>dep</code>. (<a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">https://github.com/golang/dep</a>) \nYou can specify your versions in your <code>Gopkg.toml</code>. </p>\n\n<p>Or <code>go modules</code> if you are using version 1.11 or higher for golang. </p>\n"}, {"tags": [], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "is_accepted": false, "score": 0, "last_activity_date": 1555284428, "creation_date": 1555284428, "answer_id": 55680931, "question_id": 55680760, "link": "https://stackoverflow.com/questions/55680760/how-can-i-tell-which-version-of-a-dependency-was-pulled/55680931#55680931", "title": "How can I tell which version of a dependency was pulled?", "body": "<p>I see your GoLand SDK is in different version with your Docker.\nIf you use 1.12, you can try to use go module. It will generate a file go.mod, which will describe your package and version, and better management. For example:</p>\n\n<pre><code>module github.com/example\n\nrequire (\n    github.com/Azure/azure-storage-blob-go v0.0.0-20190104215108-45d0c5e3638e\n    github.com/buger/jsonparser v0.0.0-20181115193947-bf1c66bbce23\n    github.com/gorilla/context v1.1.1 // indirect\n    github.com/gorilla/mux v1.6.2\n    github.com/patrickmn/go-cache v2.1.0+incompatible\n    github.com/prometheus/client_golang v0.9.2\n    github.com/sirupsen/logrus v1.3.0\n    golang.org/x/net v0.0.0-20181220203305-927f97764cc3\n    golang.org/x/sync v0.0.0-20181221193216-37e7f081c4d4 // indirect\n    golang.org/x/sys v0.0.0-20180909124046-d0be0721c37e // indirect\n    gopkg.in/resty.v1 v1.12.0\n)\n</code></pre>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1555286731, "creation_date": 1555282493, "question_id": 55680760, "link": "https://stackoverflow.com/questions/55680760/how-can-i-tell-which-version-of-a-dependency-was-pulled", "title": "How can I tell which version of a dependency was pulled?", "body": "<p>In <code>main.go</code> I have this import statement:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"strings\"\n    \"syscall\"\n    \"github.com/bwmarrin/discordgo\"\n)\n</code></pre>\n\n<p>And I'm running into a bug that is supposed to be fixed in the more recent versions of this dependency.  <strong>How can I determine what version was pulled in when I built my docker container that I deployed?</strong></p>\n\n<p>In GoLand it doesn't show any external dependencies:</p>\n\n<p><a href=\"https://i.stack.imgur.com/faC3A.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/faC3A.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here's my Dockerfile:</p>\n\n<pre><code>FROM golang:1.12-alpine\nRUN mkdir /app\nWORKDIR /app\nADD src/ /app\n\nENV CGO_ENABLED=0\nENV GO111MODULE=off\n\n# Fetch application dependencies\nRUN apk add --no-cache --update git \\\n    &amp;&amp; go get github.com/bwmarrin/discordgo \\\n    &amp;&amp; go get github.com/jonas747/dshardmanager \\\n    &amp;&amp; go get github.com/bugsnag/bugsnag-go \\\n    &amp;&amp; apk del git\n\n# Build binary\nRUN go build -o main .\n\nCMD [\"/app/main\"]\n</code></pre>\n"}, {"tags": ["go", "testing", "error-handling"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1555276102, "post_id": 55680015, "comment_id": 98044576, "body": "May be <a href=\"https://godoc.org/github.com/pkg/errors\" rel=\"nofollow noreferrer\">godoc.org/github.com/pkg/errors</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1555276625, "post_id": 55680015, "comment_id": 98044686, "body": "Errors don&#39;t need to be strings. The standard library is full of error types that wrap other, underlying errors (<a href=\"https://golang.org/pkg/os/#PathError\" rel=\"nofollow noreferrer\">os.PathError</a> for instance). The package zerkms suggests is quick and easy to use, but I strongly suggest to create specific, useful types that let errors be <i>handled</i> and not only reported."}, {"owner": {"reputation": 185, "user_id": 9892052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/33gTl.jpg?s=128&g=1", "display_name": "Sebastian Stark", "link": "https://stackoverflow.com/users/9892052/sebastian-stark"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555277851, "post_id": 55680015, "comment_id": 98044966, "body": "@Peter could you maybe give an example for a specific, useful type? I looked at os.PathError, it has an &quot;Err error&quot; field containing the &quot;upstream&quot; error. Is that what you suggest?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555278324, "post_id": 55680015, "comment_id": 98045081, "body": "Yes. But it also has a Timeout method. In fact, <a href=\"https://golang.org/search?q=Timeout#Methods\" rel=\"nofollow noreferrer\">many types do</a> and there is also a common <a href=\"https://golang.org/search?q=Temporary#Methods\" rel=\"nofollow noreferrer\">Temporary method</a>. They help callers decide whether it&#39;s worth retrying something."}, {"owner": {"reputation": 185, "user_id": 9892052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/33gTl.jpg?s=128&g=1", "display_name": "Sebastian Stark", "link": "https://stackoverflow.com/users/9892052/sebastian-stark"}, "edited": false, "score": 1, "creation_date": 1555308031, "post_id": 55680015, "comment_id": 98050418, "body": "To let errors be <i>handled</i> and not only reported is the kind of hint I needed. While the package proposed by zerkms is a good read certainly, I don&#39;t feel like I want to add this to my projects. Hopefully somebody will add an answer with a little code example for a good, specific error type with context, maybe I will come up with something later."}], "answers": [{"tags": [], "owner": {"reputation": 185, "user_id": 9892052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/33gTl.jpg?s=128&g=1", "display_name": "Sebastian Stark", "link": "https://stackoverflow.com/users/9892052/sebastian-stark"}, "is_accepted": false, "score": 0, "last_activity_date": 1555695748, "creation_date": 1555695748, "answer_id": 55765712, "question_id": 55680015, "link": "https://stackoverflow.com/questions/55680015/how-can-i-use-dynamic-errors-while-retaining-comparability-for-testing/55765712#55765712", "title": "How can I use dynamic errors while retaining comparability for testing?", "body": "<p>My preliminary answer to this is: In Go currently there is no canonical way to achieve nested errors with comparable error values.</p>\n\n<p>After reading the offical documents and blog posts on error handling again, quite some source code from standard libraries, and finally this proposal: <a href=\"https://github.com/golang/proposal/blob/master/design/go2draft-error-values-overview.md\" rel=\"nofollow noreferrer\">https://github.com/golang/proposal/blob/master/design/go2draft-error-values-overview.md</a>, I decided I will keep my error types simple and static and wait for Go 2 to offer a better way.</p>\n"}], "owner": {"reputation": 185, "user_id": 9892052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/33gTl.jpg?s=128&g=1", "display_name": "Sebastian Stark", "link": "https://stackoverflow.com/users/9892052/sebastian-stark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555695748, "creation_date": 1555275876, "question_id": 55680015, "link": "https://stackoverflow.com/questions/55680015/how-can-i-use-dynamic-errors-while-retaining-comparability-for-testing", "title": "How can I use dynamic errors while retaining comparability for testing?", "body": "<p>In go I often use</p>\n\n<pre><code>func MyFunc(s someInterface) error {\n    err := OtherFunc(s)\n    return fmt.Errorf(\"something wrong: %s\", err)\n}\n</code></pre>\n\n<p>So I lose the original error value, because I just take the error string and forge it into a new error. That is what I mean with dynamic errors.</p>\n\n<p>Now consider a test for <code>MyFunc()</code>:</p>\n\n<pre><code>func TestMyFunc(t *testing.T) {\n    s := mockSomeInterface()\n    testErr := MyFunc(s)\n    if testErr != interfaceSpecificErrorValue {\n        t.Errorf(\"fail\")\n    }\n}\n</code></pre>\n\n<p>What would I use for <code>interfaceSpecificErrorValue</code> (which is specific to <code>someInterface</code> in this example)? Or how could I make this testable?</p>\n\n<p>I understand that I can solve this by defining all my possible errors beforehand and give them a constant value. What I am interested in is if there is another way to achieve this, because I like the hierarchical error messages that you can dynamically build up using <code>fmt.Errorf(\"...: %s, err)</code>. There must be a good way to keep the error hierarchy without losing the original value.</p>\n\n<p>(Comparing the output of the <code>Error()</code> method is a possibility, but not a good one.)</p>\n"}, {"tags": ["postgresql", "go", "sql-null"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1555273336, "post_id": 55679188, "comment_id": 98043943, "body": "Did you try <code>sql:&quot;smallint,pk,notnull&quot;</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "is_accepted": false, "score": -1, "last_activity_date": 1555281526, "creation_date": 1555281526, "answer_id": 55680660, "question_id": 55679188, "link": "https://stackoverflow.com/questions/55679188/how-to-avoid-that-0-zero-int-turns-into-postgres-null-value-and-violates-no/55680660#55680660", "title": "How to avoid that 0 (zero) int turns into Postgres &quot;null&quot; value and violates &quot;not null&quot; constraint?", "body": "<p>I think the easiest solution to your problem is to make your <code>ID</code> column of type <code>SERIAL</code> and let Postgres deal with setting and auto-incrementing the value for you. If you need the value within your application directly after inserting it, you can always use a <code>RETURNING</code> psql clause, like such:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>INSERT INTO shows(\n    user_id, name, description, created, modified\n) VALUES(\n    :user_id, :name, :created, :modified\n) RETURNING id;\n</code></pre>\n\n<p>And capture the response within your code.</p>\n"}, {"tags": [], "owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "is_accepted": false, "score": 2, "last_activity_date": 1555291424, "creation_date": 1555291424, "answer_id": 55681548, "question_id": 55679188, "link": "https://stackoverflow.com/questions/55679188/how-to-avoid-that-0-zero-int-turns-into-postgres-null-value-and-violates-no/55681548#55681548", "title": "How to avoid that 0 (zero) int turns into Postgres &quot;null&quot; value and violates &quot;not null&quot; constraint?", "body": "<p>While it's not immediately obvious with <code>go-pg</code> you can use the struct tag <code>sql:\",notnull\"</code> to show that Go empty values (<code>\"\"</code>, <code>0</code>, <code>[]</code> etc.) are allowed and should not be treated as SQL <code>NULL</code>.</p>\n\n<p>You can see it in the <a href=\"https://github.com/go-pg/pg#features\" rel=\"nofollow noreferrer\">Features list</a>.</p>\n\n<p>In your case I would change this to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Account struct {\n   Number int `sql:\"type:smallint,pk,notnull\"`\n   Name string\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11360182, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dhHP3RfiJRE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdKx_w5AyB-Nn4K71cxTB_0EG5u1g/mo/photo.jpg?sz=128", "display_name": "Philipp Sebastian", "link": "https://stackoverflow.com/users/11360182/philipp-sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2053, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1555291424, "creation_date": 1555269874, "last_edit_date": 1555284182, "question_id": 55679188, "link": "https://stackoverflow.com/questions/55679188/how-to-avoid-that-0-zero-int-turns-into-postgres-null-value-and-violates-no", "title": "How to avoid that 0 (zero) int turns into Postgres &quot;null&quot; value and violates &quot;not null&quot; constraint?", "body": "<p>In Go, I am unmarshalling/decoding JSON into a struct with an ID field of type int. Then I try to insert this struct into a PostgreSQL database using go-pg with the ID column as the primary key (which has a not-null constraint). The first entry has a <code>0</code> as its ID. In the Postgres documentation, it states that <code>0</code> is ok as a value of a primary key. However, I keep getting an error message:</p>\n\n<blockquote>\n  <p>\"ERROR #23502 null value in column \"number\" violates not-null constraint\". </p>\n</blockquote>\n\n<p>It looks like the <code>0</code> turns into a Go \"zero value\" when it is unmarshalled into the int value. Then it is inserted as <code>null</code> value into Postgres. Any tips on how I might be able to avoid this would be greatly appreciated.</p>\n\n<pre><code>type Account struct {\n   Number int `sql:\"type:smallint, pk\"`\n   Name string\n}\n\n[...]\n\naccount := Account{}\nerr := json.NewDecoder(r.Body).Decode(&amp;account)\n\n[...]\n\ninsertErr := pgLayer.db.Insert(&amp;account)\nif insertErr != nil {\n   log.Printf(\"Error while inserting new item\")\n   return \"n/a\", insertErr\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 3, "last_activity_date": 1555273576, "last_edit_date": 1555273576, "creation_date": 1555268359, "answer_id": 55678928, "question_id": 55678732, "link": "https://stackoverflow.com/questions/55678732/why-does-this-work-i-am-slicing-1-past-max-index-and-not-getting-an-error/55678928#55678928", "title": "Why does this work, I am slicing 1 past max index and not getting an error?", "body": "<p>It's in <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">the spec</a>. Having <code>low</code> or <code>high</code> equal to the length is allowed.</p>\n\n<blockquote>\n  <p>For arrays or strings, the indices are in range if <code>0 &lt;= low &lt;= high &lt;= len(a)</code>, otherwise they are out of range.</p>\n</blockquote>\n\n<p>As to \"why is this not an error\": you can visualize the slicing operation as cutting <em>between</em> the elements. Like this:</p>\n\n<pre><code>\u2502   a   t   t   r   i   b   u   t   e   =    \u2502\n\u2502 \u2191   \u2191   \u2191   \u2191   \u2191   \u2191   \u2191   \u2191   \u2191   \u2191   \u2191  \u2502\n\u2502 0   1   2   3   4   5   6   7   8   9   10 \u2502\n</code></pre>\n\n<p>Technically slice point 10 is still within bounds, but it has no elements after it. That's why <code>[10:]</code> results in an empty string (that, or because there are no elements between <code>low</code> and <code>high</code>). This works the same way in ruby, for example. Maybe other languages too.</p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 6204240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aba60e4cbc1b265a1cda06e14694fdb9?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/6204240/mike"}, "edited": false, "score": 0, "creation_date": 1555337474, "post_id": 55678944, "comment_id": 98065022, "body": "Thanks Abdullah. Thas was unexpexted, but makes perfect sense."}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": false, "score": 2, "last_activity_date": 1555268422, "creation_date": 1555268422, "answer_id": 55678944, "question_id": 55678732, "link": "https://stackoverflow.com/questions/55678732/why-does-this-work-i-am-slicing-1-past-max-index-and-not-getting-an-error/55678944#55678944", "title": "Why does this work, I am slicing 1 past max index and not getting an error?", "body": "<p>From the language specification for <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Slice expressions</a>:</p>\n\n<blockquote>\n  <p>For a string, array, pointer to array, or slice a, the primary expression</p>\n\n<pre><code>a[low : high]\n</code></pre>\n  \n  <p>constructs a substring or slice. The indices low and high select which elements of operand a appear in the result.</p>\n  \n  <p>.\n  .\n  .</p>\n  \n  <p>For arrays or strings, the indices are in range if 0 &lt;= low &lt;= high &lt;= len(a), otherwise they are out of range. For slices, the upper index bound is the slice capacity cap(a) rather than the length.</p>\n</blockquote>\n\n<p>So, both low and high <strong>can</strong> have the values <code>0</code> and <code>len(a)</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 6204240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aba60e4cbc1b265a1cda06e14694fdb9?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/6204240/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 55678928, "answer_count": 2, "score": -3, "last_activity_date": 1555273576, "creation_date": 1555267176, "last_edit_date": 1555273046, "question_id": 55678732, "link": "https://stackoverflow.com/questions/55678732/why-does-this-work-i-am-slicing-1-past-max-index-and-not-getting-an-error", "title": "Why does this work, I am slicing 1 past max index and not getting an error?", "body": "<p>I was playing around with slices, and I found something that I can't explain. I create a string of total length 10 (index ranges from 0 to 9) and then I create a slice from it specifying one past the max index and it does not panic. It will panic if I go more than one past the last index. What am I not understanding please?</p>\n\n<p>I have investigated with integer slices as well thinking there might be something odd about strings, but it showed the same behavior.</p>\n\n<p>Here is an example: I expected a failure at <code>x:= str[10:]</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    var str = \"attribute=\"\n\n    x := str[10:]\n    fmt.Printf(\"type of x is %T\\n\", x)\n    //fmt.Printf(\"x is a %T and length of x is %d\\n\", x, len(x))\n\n    for k, v := range []byte(str) {\n        fmt.Printf(\"%d, %x\\n\", k, v)\n    }\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Z-3YvTx3-s6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Z-3YvTx3-s6</a></p>\n\n<p>Output:</p>\n\n<pre><code>type of x is string\n0, 61\n1, 74\n2, 74\n3, 72\n4, 69\n5, 62\n6, 75\n7, 74\n8, 65\n9, 3d\n</code></pre>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": false, "score": 1, "last_activity_date": 1555269903, "creation_date": 1555269903, "answer_id": 55679191, "question_id": 55677822, "link": "https://stackoverflow.com/questions/55677822/creating-empty-kubernetes-resource-struct-when-knowing-the-resource-kind-type-on/55679191#55679191", "title": "Creating empty Kubernetes resource struct when knowing the resource kind/type only (in golang)", "body": "<p>There is no pretty way to do this.</p>\n\n<p>This would require two steps:</p>\n\n<ol>\n<li>Building a type map: map[string]reflect.Type</li>\n</ol>\n\n<p>You could either write your own code to go through each k8s api type and insert into a map, as in this answer: <a href=\"https://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\">is there a way to create an instance of a struct from a string?</a></p>\n\n<p>Or, you could use an extremely non-portable method to extract types from binaries, which allows you to avoid knowing which types to add to the map:\n<a href=\"https://stackoverflow.com/questions/32132064/how-to-discover-all-package-types-at-runtime\">How to discover all package types at runtime?</a></p>\n\n<ol start=\"2\">\n<li><p>Use the map to instantiate.  Lookup myType from a string using the map, then:</p>\n\n<p>reflect.New(myType).Elem()</p></li>\n</ol>\n\n<p>where myType is the instance of reflect.Type </p>\n"}, {"tags": [], "owner": {"reputation": 2267, "user_id": 4716370, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-U_FFkjaXK2I/AAAAAAAAAAI/AAAAAAAAnbo/UQ9DkPR0VqM/photo.jpg?sz=128", "display_name": "Antoine Cotten", "link": "https://stackoverflow.com/users/4716370/antoine-cotten"}, "is_accepted": true, "score": 2, "last_activity_date": 1555324016, "last_edit_date": 1555324016, "creation_date": 1555323545, "answer_id": 55687022, "question_id": 55677822, "link": "https://stackoverflow.com/questions/55677822/creating-empty-kubernetes-resource-struct-when-knowing-the-resource-kind-type-on/55687022#55687022", "title": "Creating empty Kubernetes resource struct when knowing the resource kind/type only (in golang)", "body": "<p>Knowing the <code>Kind</code> is not enough, however a combination of API Group + API Version + object Kind (<a href=\"https://godoc.org/k8s.io/apimachinery/pkg/runtime/schema#GroupVersionKind\" rel=\"nofollow noreferrer\"><code>GroupVersionKind</code></a>) would allow you to use the information contained in the default <a href=\"https://godoc.org/k8s.io/client-go/kubernetes/scheme#pkg-variables\" rel=\"nofollow noreferrer\"><code>scheme.Scheme</code></a> variable to generate a new object.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"k8s.io/apimachinery/pkg/runtime/schema\"\n    \"k8s.io/client-go/kubernetes/scheme\"\n)\n\nfunc main() {\n    // apiVersion's syntax is \"group/version\" for non-core API groups\n    // e.g. \"apps/v1\"\n    podGvk := schema.FromAPIVersionAndKind(\"v1\", \"Pod\")\n\n    obj, err := scheme.Scheme.New(podGvk)  // error handling omitted\n\n    fmt.Printf(\"%T\", obj)\n    /* prints '*v1.Pod' */\n}\n</code></pre>\n\n<p>See godoc for <a href=\"https://godoc.org/k8s.io/apimachinery/pkg/runtime#Scheme.New\" rel=\"nofollow noreferrer\"><code>func (*Scheme) New</code></a></p>\n"}], "owner": {"reputation": 2397, "user_id": 207604, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/912cc3cbe4b49b0c4b255894726a5950?s=128&d=identicon&r=PG", "display_name": "Roland Hu&#223;", "link": "https://stackoverflow.com/users/207604/roland-hu%c3%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 55687022, "answer_count": 2, "score": 0, "last_activity_date": 1555324016, "creation_date": 1555261133, "question_id": 55677822, "link": "https://stackoverflow.com/questions/55677822/creating-empty-kubernetes-resource-struct-when-knowing-the-resource-kind-type-on", "title": "Creating empty Kubernetes resource struct when knowing the resource kind/type only (in golang)", "body": "<p>How can I create an empty struct of a certain Kubernetes resource when the resource kind/type is given as string ?</p>\n\n<p>I.e. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var object *runtime.Object\n\nobject = factory.NewResourceFromKind(\"pod\")\n</code></pre>\n\n<p>and <code>object</code> should then contain <code>&amp;apiv1.Pod{}</code> ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1555250989, "post_id": 55676152, "comment_id": 98037471, "body": "On linux you can just rm the running executable from itself. On Windows its not that easy."}, {"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1555251677, "post_id": 55676152, "comment_id": 98037674, "body": "@tkausl good to know, I also tried this with <code>cmd.Start()</code> instead of <code>cmd.Run()</code> and still nothing happens when I test on Mac OS."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1555251807, "post_id": 55676152, "comment_id": 98037714, "body": "Why do you even call <code>rm</code> instead of deleting the file from Go directly?"}, {"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1555252315, "post_id": 55676152, "comment_id": 98037860, "body": "@tkausl good point, I have updated my question to include this, I now see that the file is also removed on mac but only if I call my program with the <code>-rm</code> flag directly and not when the <code>.&#47;test</code> calls <code>.&#47;remove -rm</code>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1555252766, "post_id": 55676152, "comment_id": 98037990, "body": "Try setting <code>cmd.Stdout</code> and <code>cmd.Stderr</code> to your own streams to see the output of the called program"}, {"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1555253242, "post_id": 55676152, "comment_id": 98038137, "body": "@tkausl I didn&#39;t think it would keep sending me output but now that I test it it seems my program does exactly what I want it to do, it deletes the initial program. I guess I need to find a windows machine to test this. Thanks for the help!"}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 435071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a141091cb34d9929dd27bf7af3d934?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/435071/chris"}, "is_accepted": false, "score": 1, "last_activity_date": 1555316436, "creation_date": 1555316436, "answer_id": 55685076, "question_id": 55676152, "link": "https://stackoverflow.com/questions/55676152/how-can-i-make-a-go-program-that-can-remove-itself/55685076#55685076", "title": "How can i make a go program that can remove itself?", "body": "<p>Since your goal is for an application to update itself, I would move this functionality into a second \"updater\" application. The executable file (depending on OS) might be locked otherwise plus you still have the issue of restarting the app. The flow would be like this:</p>\n\n<ul>\n<li>main program spawns updater and terminates itself</li>\n<li>updater waits for main program to terminate</li>\n<li>updater replaces executable file and restarts app (if desired)</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "is_accepted": true, "score": 1, "last_activity_date": 1555525544, "creation_date": 1555525544, "answer_id": 55733861, "question_id": 55676152, "link": "https://stackoverflow.com/questions/55676152/how-can-i-make-a-go-program-that-can-remove-itself/55733861#55733861", "title": "How can i make a go program that can remove itself?", "body": "<p>So an example of how I can solve this which works on Mac OS, Linux and Windows is the following code.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main()  {\n    fmt.Println(\"program started\")\n    remove := flag.Bool(\"rm\", false, \"removes test\")\n    flag.Parse()\n\n    if *remove {\n        var err error\n        // Wait 5 seconds to let other program finish\n        time.Sleep(5 * time.Second)\n        // Try to remove program that started this program\n        fmt.Println(\"running rm\")\n        if runtime.GOOS == \"windows\" {\n            err = os.Remove(\"./test.exe\")\n        } else {\n            err = os.Remove(\"./test\")\n        }\n        if err != nil {\n            log.Fatalf(\"os.Remove() failed with %s\\n\", err)\n        }\n    } else {\n        var cmd *exec.Cmd\n        // Call the second remove program which will remove ./test which is currently running\n        fmt.Println(\"running remove program\")\n        if runtime.GOOS == \"windows\" {\n            cmd = exec.Command(\"./remove.exe\", \"-rm\")\n        } else {\n            cmd = exec.Command(\"./remove\", \"-rm\")\n        }\n        cmd.Stdout = os.Stdout\n        cmd.Stderr = os.Stderr\n        err := cmd.Start()\n        if err != nil {\n            log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n        }\n    }\n    fmt.Println(\"Finished running program\")\n}\n</code></pre>\n\n<p>This program will remove itself if you run it like so</p>\n\n<pre><code>uberswe$ go build -o test\nuberswe$ go build -o remove\nuberswe$ ./test\n</code></pre>\n\n<p>On windows I had to make one change which is to add the .exe extension in order for windows cmd to recognize the binary as an executable file. I was able to make the application <code>test</code> call on <code>remove</code> to delete itself.</p>\n"}], "owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 55733861, "answer_count": 2, "score": 2, "last_activity_date": 1555525544, "creation_date": 1555250670, "last_edit_date": 1555252220, "question_id": 55676152, "link": "https://stackoverflow.com/questions/55676152/how-can-i-make-a-go-program-that-can-remove-itself", "title": "How can i make a go program that can remove itself?", "body": "<p>This all started when I wanted to make a program that could update itself. I figured I need the program to download a new version and run a function that copies the new program and replaces the original with the downloaded version.</p>\n\n<p>I tried to make this problem as small as possible, how can I make a program that calls another program to remove itself, here is my attempt:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc main()  {\n    fmt.Println(\"program started\")\n    remove := flag.Bool(\"rm\", false, \"removes test\")\n    flag.Parse()\n\n    if *remove {\n        // Wait 5 seconds to let other program finish\n        time.Sleep(5 * time.Second)\n        // Try to remove program that started this program\n        fmt.Println(\"running rm\")\n        err := os.Remove(\"./test\")\n        if err != nil {\n            log.Fatalf(\"os.Remove() failed with %s\\n\", err)\n        }\n    } else {\n        // Call the second program which will remove ./test which is currently running\n        fmt.Println(\"running remove program\")\n        cmd := exec.Command(\"./remove\", \"-rm\")\n        err := cmd.Start()\n        if err != nil {\n            log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n        }\n    }\n}\n</code></pre>\n\n<p>Here is how I call this via cli.</p>\n\n<pre><code>uberswe$ go build -o test\nuberswe$ go build -o remove\nuberswe$ ./test\nprogram started\nrunning remove program\nuberswe$ ls -la\ntotal 9048\ndrwxr-xr-x@  6 uberswe  staff      192 Apr 14 15:55 .\ndrwxr-xr-x@ 56 uberswe  staff     1792 Apr 14 15:36 ..\ndrwxr-xr-x@  6 uberswe  staff      192 Apr 14 15:55 .idea\n-rw-r--r--@  1 uberswe  staff      680 Apr 14 15:55 main.go\n-rwxr-xr-x@  1 uberswe  staff  2311528 Apr 14 15:55 remove\n-rwxr-xr-x@  1 uberswe  staff  2311528 Apr 14 15:55 test\n</code></pre>\n\n<p>So in summary: <strong>How can I make a program that can remove itself either on its own or via a second command/program?</strong></p>\n\n<p>Bonus if it is portable to different operating systems.</p>\n"}, {"tags": ["json", "go", "yaml", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 1114, "user_id": 8190553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OTwb.png?s=128&g=1", "display_name": "will7200", "link": "https://stackoverflow.com/users/8190553/will7200"}, "edited": false, "score": 2, "creation_date": 1555600713, "post_id": 55674853, "comment_id": 98174953, "body": "The first thing I spoke of is an issue with the go-yaml package. Marshalling from a read in yaml.Node produces invalid yaml. Filed a issue <a href=\"https://github.com/go-yaml/yaml/issues/454\" rel=\"nofollow noreferrer\">github.com/go-yaml/yaml/issues/454</a>."}, {"owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "reply_to_user": {"reputation": 1114, "user_id": 8190553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OTwb.png?s=128&g=1", "display_name": "will7200", "link": "https://stackoverflow.com/users/8190553/will7200"}, "edited": false, "score": 1, "creation_date": 1555917157, "post_id": 55674853, "comment_id": 98250626, "body": "@will7200 - thank you very much for taking this extra mile!, i&#39;ll close the question as answer even its not working since the issue is with the OS , one question, is it possible to add some sample how would you delete one application or both from the file ?"}, {"owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "reply_to_user": {"reputation": 1114, "user_id": 8190553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OTwb.png?s=128&g=1", "display_name": "will7200", "link": "https://stackoverflow.com/users/8190553/will7200"}, "edited": false, "score": 0, "creation_date": 1555998843, "post_id": 55674853, "comment_id": 98277929, "body": "@will7200 - I&#39;ve closed the question and provide the bounty :) , it will be great if you can answer my last question regard the delete one or all applications from the yaml file. thank you very much!"}, {"owner": {"reputation": 1114, "user_id": 8190553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OTwb.png?s=128&g=1", "display_name": "will7200", "link": "https://stackoverflow.com/users/8190553/will7200"}, "edited": false, "score": 0, "creation_date": 1556042045, "post_id": 55674853, "comment_id": 98300364, "body": "I added an example and function to remove a specific application, you must provide the identifier and value, and only does one removal at a time. You can expand to remove multiple at a time if need be. If you want to delete all of them look at the comments I provided in the code."}], "answers": [{"comments": [{"owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "edited": false, "score": 0, "creation_date": 1555588839, "post_id": 55733904, "comment_id": 98167905, "body": "Thank you very much ! 1+ there is some issues with your solution, please see my update"}], "tags": [], "owner": {"reputation": 1114, "user_id": 8190553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OTwb.png?s=128&g=1", "display_name": "will7200", "link": "https://stackoverflow.com/users/8190553/will7200"}, "is_accepted": true, "score": 15, "last_activity_date": 1556041874, "last_edit_date": 1556041874, "creation_date": 1555525717, "answer_id": 55733904, "question_id": 55674853, "link": "https://stackoverflow.com/questions/55674853/modify-existing-yaml-file-and-add-new-data-and-comments/55733904#55733904", "title": "Modify existing yaml file and add new data and comments", "body": "<p>First, let Me Start off by saying using yaml.Node does not produce valid yaml when marshalled from a valid yaml, given by the following example. Probably should file an issue.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v3\"\n)\n\nvar (\n    sourceYaml = `version: 1\ntype: verbose\nkind : bfr\n\n# my list of applications\napplications:\n\n#  First app\n  - name: app1\n    kind: nodejs\n    path: app1\n    exec:\n      platforms: k8s\n      builder: test\n`\n)\n\nfunc main() {\n    t := yaml.Node{}\n\n    err := yaml.Unmarshal([]byte(sourceYaml), &amp;t)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    b, err := yaml.Marshal(&amp;t)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>Produces the following invalid yaml in go version go1.12.3 windows/amd64</p>\n\n<pre><code>version: 1\ntype: verbose\nkind: bfr\n\n\n# my list of applications\napplications:\n-   #  First app\nname: app1\n    kind: nodejs\n    path: app1\n    exec:\n        platforms: k8s\n        builder: test\n</code></pre>\n\n<hr>\n\n<p>Secondly, using a struct such as </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type VTS struct {\n    Version string       `yaml:\"version\" json:\"version\"`\n    Types   string       `yaml:\"type\" json:\"type\"`\n    Kind    string       `yaml:\"kind,omitempty\" json:\"kind,omitempty\"`\n    Apps    yaml.Node `yaml:\"applications,omitempty\" json:\"applications,omitempty\"`\n}\n</code></pre>\n\n<p>From ubuntu's blog and the source documentation it made it seem that it would correctly identify fields within the struct that are nodes and build that tree separately, but that is not the case.\nWhen unmarshalled, it will give a correct node tree, but when remarshalled it will produce the following yaml with all of the fields that yaml.Node exposes. Sadly we cannot go this route, must find another way.</p>\n\n<pre><code>version: \"1\"\ntype: verbose\nkind: bfr\napplications:\n    kind: 2\n    style: 0\n    tag: '!!seq'\n    value: \"\"\n    anchor: \"\"\n    alias: null\n    content:\n    -   #  First app\nname: app1\n        kind: nodejs\n        path: app1\n        exec:\n            platforms: k8s\n            builder: test\n    headcomment: \"\"\n    linecomment: \"\"\n    footcomment: \"\"\n    line: 9\n    column: 3\n</code></pre>\n\n<hr>\n\n<p>Overlooking the first issue and the marshal bug for yaml.Nodes in a struct (on gopkg.in/yaml.v3 v3.0.0-20190409140830-cdc409dda467) we can now go about manipulating the Nodes that the package exposes. Unfortunately, there is no abstraction that will add Nodes with ease, so uses might vary and identifying nodes can be a pain. Reflection might help here a bit, so I leave that as an exercise for you.</p>\n\n<p>You will find comment spew.Dumps that dump the entire node Tree in a nice format, this helped with debugging when adding Nodes to the source tree.</p>\n\n<p>You can certainly remove nodes as well, you will just need to identify which particular nodes that need to be removed. You just have to ensure that you remove the parent nodes if it were a map or sequence.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v3\"\n)\n\nvar (\n    sourceYaml = `version: 1\ntype: verbose\nkind : bfr\n\n# my list of applications\napplications:\n\n#  First app\n  - name: app1\n    kind: nodejs\n    path: app1\n    exec:\n      platforms: k8s\n      builder: test\n`\n    modifyJsonSource = `\n[\n\n    {\n        \"comment\": \"Second app\",\n        \"name\": \"app2\",\n        \"kind\": \"golang\",\n        \"path\": \"app2\",\n        \"exec\": {\n            \"platforms\": \"dockerh\",\n            \"builder\": \"test\"\n        }\n    }\n]\n`\n)\n\n// VTS Need to Make Fields Public otherwise unmarshalling will not fill in the unexported fields.\ntype VTS struct {\n    Version string       `yaml:\"version\" json:\"version\"`\n    Types   string       `yaml:\"type\" json:\"type\"`\n    Kind    string       `yaml:\"kind,omitempty\" json:\"kind,omitempty\"`\n    Apps    Applications `yaml:\"applications,omitempty\" json:\"applications,omitempty\"`\n}\n\ntype Applications []struct {\n    Name string `yaml:\"name,omitempty\" json:\"name,omitempty\"`\n    Kind string `yaml:\"kind,omitempty\" json:\"kind,omitempty\"`\n    Path string `yaml:\"path,omitempty\" json:\"path,omitempty\"`\n    Exec struct {\n        Platforms string `yaml:\"platforms,omitempty\" json:\"platforms,omitempty\"`\n        Builder   string `yaml:\"builder,omitempty\" json:\"builder,omitempty\"`\n    } `yaml:\"exec,omitempty\" json:\"exec,omitempty\"`\n    Comment string `yaml:\"comment,omitempty\" json:\"comment,omitempty\"`\n}\n\nfunc main() {\n    t := yaml.Node{}\n\n    err := yaml.Unmarshal([]byte(sourceYaml), &amp;t)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    // Look for the Map Node with the seq array of items\n    applicationNode := iterateNode(&amp;t, \"applications\")\n\n    // spew.Dump(iterateNode(&amp;t, \"applications\"))\n\n    var addFromJson Applications\n    err = json.Unmarshal([]byte(modifyJsonSource), &amp;addFromJson)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    // Delete the Original Applications the following options:\n    // applicationNode.Content = []*yaml.Node{}\n    // deleteAllContents(applicationNode)\n    deleteApplication(applicationNode, \"name\", \"app1\")\n\n\n    for _, app := range addFromJson {\n        // Build New Map Node for new sequences coming in from json\n        mapNode := &amp;yaml.Node{Kind: yaml.MappingNode, Tag: \"!!map\"}\n\n        // Build Name, Kind, and Path Nodes\n        mapNode.Content = append(mapNode.Content, buildStringNodes(\"name\", app.Name, app.Comment)...)\n        mapNode.Content = append(mapNode.Content, buildStringNodes(\"kind\", app.Kind, \"\")...)\n        mapNode.Content = append(mapNode.Content, buildStringNodes(\"path\", app.Path, \"\")...)\n\n        // Build the Exec Nodes and the Platform and Builder Nodes within it\n        keyMapNode, keyMapValuesNode := buildMapNodes(\"exec\")\n        keyMapValuesNode.Content = append(keyMapValuesNode.Content, buildStringNodes(\"platform\", app.Exec.Platforms, \"\")...)\n        keyMapValuesNode.Content = append(keyMapValuesNode.Content, buildStringNodes(\"builder\", app.Exec.Builder, \"\")...)\n\n        // Add to parent map Node\n        mapNode.Content = append(mapNode.Content, keyMapNode, keyMapValuesNode)\n\n        // Add to applications Node\n        applicationNode.Content = append(applicationNode.Content, mapNode)\n    }\n    // spew.Dump(t)\n    b, err := yaml.Marshal(&amp;t)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(b))\n}\n\n// iterateNode will recursive look for the node following the identifier Node,\n// as go-yaml has a node for the key and the value itself\n// we want to manipulate the value Node\nfunc iterateNode(node *yaml.Node, identifier string) *yaml.Node {\n    returnNode := false\n    for _, n := range node.Content {\n        if n.Value == identifier {\n            returnNode = true\n            continue\n        }\n        if returnNode {\n            return n\n        }\n        if len(n.Content) &gt; 0 {\n            ac_node := iterateNode(n, identifier)\n            if ac_node != nil {\n                return ac_node\n            }\n        }\n    }\n    return nil\n}\n\n// deleteAllContents will remove all the contents of a node\n// Mark sure to pass the correct node in otherwise bad things will happen\nfunc deleteAllContents(node *yaml.Node) {\n    node.Content = []*yaml.Node{}\n}\n\n// deleteApplication expects that a sequence Node with all the applications are present\n// if the key value are not found it will not log any errors, and return silently\n// this is expecting a map like structure for the applications\nfunc deleteApplication(node *yaml.Node, key, value string) {\n    state := -1\n    indexRemove := -1\n    for index, parentNode := range node.Content {\n        for _, childNode := range parentNode.Content {\n            if key == childNode.Value &amp;&amp; state == -1 {\n                state += 1\n                continue // found expected move onto next\n            }\n            if value == childNode.Value &amp;&amp; state == 0 {\n                state += 1\n                indexRemove = index\n                break // found the target exit out of the loop\n            } else if state == 0 {\n                state = -1\n            }\n        }\n    }\n    if state == 1 {\n        // Remove node from contents\n        // node.Content = append(node.Content[:indexRemove], node.Content[indexRemove+1:]...)\n        // Don't Do this you might have a potential memory leak source: https://github.com/golang/go/wiki/SliceTricks\n        // Since the underlying nodes are pointers\n        length := len(node.Content)\n        copy(node.Content[indexRemove:], node.Content[indexRemove+1:])\n        node.Content[length-1] = nil\n        node.Content = node.Content[:length-1]\n    }\n}\n\n\n// buildStringNodes builds Nodes for a single key: value instance\nfunc buildStringNodes(key, value, comment string) []*yaml.Node {\n    keyNode := &amp;yaml.Node{\n        Kind:        yaml.ScalarNode,\n        Tag:         \"!!str\",\n        Value:       key,\n        HeadComment: comment,\n    }\n    valueNode := &amp;yaml.Node{\n        Kind:  yaml.ScalarNode,\n        Tag:   \"!!str\",\n        Value: value,\n    }\n    return []*yaml.Node{keyNode, valueNode}\n}\n\n// buildMapNodes builds Nodes for a key: map instance\nfunc buildMapNodes(key string) (*yaml.Node, *yaml.Node) {\n    n1, n2 := &amp;yaml.Node{\n        Kind:  yaml.ScalarNode,\n        Tag:   \"!!str\",\n        Value: key,\n    }, &amp;yaml.Node{Kind: yaml.MappingNode,\n        Tag: \"!!map\",\n    }\n    return n1, n2\n}\n\n</code></pre>\n\n<p>Produces yaml</p>\n\n<pre><code>version: 1\ntype: verbose\nkind: bfr\n\n\n# my list of applications\napplications:\n-   #  First app\nname: app1\n    kind: nodejs\n    path: app1\n    exec:\n        platforms: k8s\n        builder: test\n-   # Second app\nname: app2\n    kind: golang\n    path: app2\n    exec:\n        platform: dockerh\n        builder: test\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 4698580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9cd3df340c0f0cddf14637d9e51dc8d?s=128&d=identicon&r=PG&f=1", "display_name": "nettrino", "link": "https://stackoverflow.com/users/4698580/nettrino"}, "is_accepted": false, "score": 1, "last_activity_date": 1569959556, "creation_date": 1569959556, "answer_id": 58191428, "question_id": 55674853, "link": "https://stackoverflow.com/questions/55674853/modify-existing-yaml-file-and-add-new-data-and-comments/58191428#58191428", "title": "Modify existing yaml file and add new data and comments", "body": "<p>You could create a new node and directly append to the contents, without deleting the previous node. The following example illustrates this point:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v3\"\n)\n\nvar (\n    sourceYaml = `version: 1\ntype: verbose\nkind : bfr\n\n# my list of applications\napplications:\n\n#  First app\n  - name: app1\n    kind: nodejs\n    path: app1\n    exec:\n      platforms: k8s\n      builder: test\n`\n)\n\ntype Application struct {\n    Name string `yaml:\"name,omitempty\" json:\"name,omitempty\"`\n    Kind string `yaml:\"kind,omitempty\" json:\"kind,omitempty\"`\n    Path string `yaml:\"path,omitempty\" json:\"path,omitempty\"`\n    Exec struct {\n        Platforms string `yaml:\"platforms,omitempty\" json:\"platforms,omitempty\"`\n        Builder   string `yaml:\"builder,omitempty\" json:\"builder,omitempty\"`\n    } `yaml:\"exec,omitempty\" json:\"exec,omitempty\"`\n}\n\nfunc newApplicationNode(\n    name string,\n    kind string,\n    path string,\n    platforms string,\n    builder string,\n    comment string) (*yaml.Node, error) {\n\n    app := Application{\n        Name: name,\n        Kind: kind,\n        Path: path,\n        Exec: struct {\n            Platforms string `yaml:\"platforms,omitempty\" json:\"platforms,omitempty\"`\n            Builder   string `yaml:\"builder,omitempty\" json:\"builder,omitempty\"`\n        }{platforms, builder},\n    }\n    marshalledApp, err := yaml.Marshal(&amp;app)\n    if err != nil {\n        return nil, err\n    }\n\n    node := yaml.Node{}\n    if err := yaml.Unmarshal(marshalledApp, &amp;node); err != nil {\n        return nil, err\n    }\n    node.Content[0].HeadComment = comment\n    return &amp;node, nil\n}\n\nfunc main() {\n    yamlNode := yaml.Node{}\n\n    err := yaml.Unmarshal([]byte(sourceYaml), &amp;yamlNode)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    newApp, err := newApplicationNode(\"app2\", \"golang\", \"app2\", \"dockerh\",\n        \"test\", \"Second app\")\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    appIdx := -1\n    for i, k := range yamlNode.Content[0].Content {\n        if k.Value == \"applications\" {\n            appIdx = i + 1\n            break\n        }\n    }\n\n    yamlNode.Content[0].Content[appIdx].Content = append(\n        yamlNode.Content[0].Content[appIdx].Content, newApp.Content[0])\n\n    out, err := yaml.Marshal(&amp;yamlNode)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(out))\n}\n\n</code></pre>\n\n<p>Clearly instead of going the hacky way as I did in <code>newApplicationNode</code> you can unmarshal properly from your JSON. However, as stated in previous answers, it is important to notice that the key and actual value are in subsequent indexes inside <code>Content</code>, therefore you need to take this into account when modifying the document. (e.g., look up <code>applications</code> key but then consider the next index (<code>appIdx = i + 1</code> in my example) for its contents.</p>\n\n<p>Hope that helps!</p>\n"}], "owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7605, "favorite_count": 5, "accepted_answer_id": 55733904, "answer_count": 2, "score": 15, "last_activity_date": 1569959556, "creation_date": 1555242021, "last_edit_date": 1555588860, "question_id": 55674853, "link": "https://stackoverflow.com/questions/55674853/modify-existing-yaml-file-and-add-new-data-and-comments", "title": "Modify existing yaml file and add new data and comments", "body": "<p>I recently saw that the go <a href=\"https://github.com/go-yaml/yaml/tree/v3\" rel=\"noreferrer\">yaml</a> lib has new version (V3)</p>\n\n<p>with the <a href=\"https://github.com/go-yaml/yaml/blob/v3/yaml.go#L348\" rel=\"noreferrer\">nodes</a> capabilities (which in my opinion is a killer feature :) ) which can helps a lots with modifying yamls without changing the structure of the file</p>\n\n<p>But since it is fairly new (from last week ) I didn't find some helpful docs and example for the <strong>context which I need</strong> (add new object/node and to keep the <strong>file structure the same</strong> without removing the comments etc)</p>\n\n<p>what I need is to manipulate yaml file </p>\n\n<p>for example </p>\n\n<p>lets say I\u2019ve this yaml file</p>\n\n<pre><code>version: 1\ntype: verbose\nkind : bfr\n\n# my list of applications\napplications:\n  - name: app1\n    kind: nodejs\n    path: app1\n    exec:\n      platforms: k8s\n      builder: test\n</code></pre>\n\n<p>Now I got an json object (e.g. with <code>app2</code>) which I need to insert to the existing file</p>\n\n<pre><code>[\n\n    {\n        \"comment: \"Second app\",\n        \"name\": \"app2\",\n        \"kind\": \"golang\",\n        \"path\": \"app2\",\n        \"exec\": {\n            \"platforms\": \"dockerh\",\n            \"builder\": \"test\"\n        }\n    }\n]\n</code></pre>\n\n<p>and I need to add it to the yml file after the first application, (applications is array of application)</p>\n\n<pre><code>version: 1\ntype: verbose\nkind : bfr\n\n# my list of applications\napplications:\n\n#  First app\n  - name: app1\n    kind: nodejs\n    path: app1\n    exec:\n      platforms: k8s\n      builder: test\n\n# Second app\n  - name: app2\n    kind: golang\n    path: app2\n    exec:\n      platforms: dockerh\n      builder: test\n</code></pre>\n\n<p>is it possible to add from the yaml file the new json object ? also remove existing</p>\n\n<p><strong>I also found this blog</strong>\n<a href=\"https://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-available\" rel=\"noreferrer\">https://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-available</a></p>\n\n<p>This is the types which represent the object </p>\n\n<pre><code>type VTS struct {\n    version string       `yaml:\"version\"`\n    types   string       `yaml:\"type\"`\n    kind    string       `yaml:\"kind,omitempty\"`\n    apps    Applications `yaml:\"applications,omitempty\"`\n}\n\ntype Applications []struct {\n    Name string `yaml:\"name,omitempty\"`\n    Kind string `yaml:\"kind,omitempty\"`\n    Path string `yaml:\"path,omitempty\"`\n    Exec struct {\n        Platforms string `yaml:\"platforms,omitempty\"`\n        Builder   string `yaml:\"builder,omitempty\"`\n    } `yaml:\"exec,omitempty\"`\n}\n</code></pre>\n\n<p><strong>update</strong></p>\n\n<p>after testing the solution which is provided by <code>wiil7200</code>   I found 2 issues</p>\n\n<p>I use at the end write it to file\n<code>err = ioutil.WriteFile(\"output.yaml\", b, 0644)</code></p>\n\n<p>And the yaml output have 2 issue.</p>\n\n<blockquote>\n  <ol>\n  <li><p>The array of the application is starting from the comments, it should\n  start from the name</p></li>\n  <li><p>After the <code>name</code> entry the <code>kind</code> property and all others after are\n  not aligned to the <code>name</code></p></li>\n  </ol>\n</blockquote>\n\n<p>any idea how to solve those issue ? regard the <code>comments</code> issue, lets say I got it from other property\nand not from the json (if it make it more simpler)</p>\n\n<pre><code>version: 1\ntype: verbose\nkind: bfr\n\n\n# my list of applications\napplications:\n-   #  First app\nname: app1\n    kind: nodejs\n    path: app1\n    exec:\n        platforms: k8s\n        builder: test\n-   # test 1\nname: app2\n    kind: golang\n    path: app2\n    exec:\n        platform: dockerh\n        builder: test\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 1, "creation_date": 1555233857, "post_id": 55673735, "comment_id": 98032982, "body": "If you want to match exactly 8 repeating digits, you could use <code>{7}</code> instead of <code>{8}</code> because the first digit is already matched in the capturing group. Try <code>^(\\d)\\\\1{7}$</code>"}, {"owner": {"reputation": 835, "user_id": 4008473, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/bab2d01a5c2ce91bed8964aabf65527c?s=128&d=identicon&r=PG&f=1", "display_name": "user27111987", "link": "https://stackoverflow.com/users/4008473/user27111987"}, "reply_to_user": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1555234117, "post_id": 55673735, "comment_id": 98033046, "body": "It still says no match"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1555234862, "post_id": 55673735, "comment_id": 98033187, "body": "<a href=\"https://golang.org/s/re2syntax\" rel=\"nofollow noreferrer\">Backreferences are not supported in RE2</a>."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1555240317, "post_id": 55673735, "comment_id": 98034466, "body": "regexp not support back reference because of performance, if do wanna use regex, try <a href=\"https://godoc.org/?q=pcre\" rel=\"nofollow noreferrer\">pcre</a>. but i think it&#39;s also not hard to write some go code."}], "answers": [{"tags": [], "owner": {"reputation": 2680, "user_id": 4440387, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D6s38.png?s=128&g=1", "display_name": "Denis Rasulev", "link": "https://stackoverflow.com/users/4440387/denis-rasulev"}, "is_accepted": false, "score": 1, "last_activity_date": 1555239503, "creation_date": 1555239503, "answer_id": 55674511, "question_id": 55673735, "link": "https://stackoverflow.com/questions/55673735/regex-to-find-repetive-number-of-length-n/55674511#55674511", "title": "Regex to find repetive number of length n", "body": "<p>If you need to catch exactly eight repetitions of the same digit as a single word in the beginning of the string, then this shall work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    testString := \"11111111\"\n    repetitive := \"^0{8}$|^1{8}$|^2{8}$|^3{8}$|^4{8}$|^5{8}$|^6{8}$|^7{8}$|^8{8}$|^9{8}$\"\n    repetitiveR := regexp.MustCompile(repetitive)\n    if repetitiveR.MatchString(testString) {\n        fmt.Println(\"Match\")\n    } else {\n        fmt.Println(\"No match\")\n    }\n}\n</code></pre>\n\n<p>Note: Your <em>cubersome</em> regexp will catch 8+ digits words, for instance, so I've corrected it a bit.</p>\n\n<p>From <a href=\"https://github.com/google/re2/wiki/WhyRE2\" rel=\"nofollow noreferrer\">official GitHub</a> and as was mentioned in the comments:</p>\n\n<blockquote>\n  <p>RE2 does not support constructs for which\n  only backtracking solutions are known to exist. Thus, <strong>backreferences</strong>\n  and <strong>look-around assertions</strong> are not supported.</p>\n</blockquote>\n\n<p>Also, <a href=\"https://stackoverflow.com/questions/23968992/how-to-match-a-regex-with-backreference-in-go\">this answer</a> may be helpful in your situation.</p>\n"}], "owner": {"reputation": 835, "user_id": 4008473, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/bab2d01a5c2ce91bed8964aabf65527c?s=128&d=identicon&r=PG&f=1", "display_name": "user27111987", "link": "https://stackoverflow.com/users/4008473/user27111987"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555239503, "creation_date": 1555233604, "question_id": 55673735, "link": "https://stackoverflow.com/questions/55673735/regex-to-find-repetive-number-of-length-n", "title": "Regex to find repetive number of length n", "body": "<p>I am trying to use golang regexp to find the repetition of digits. Here is what I have tried to find repetitive digits of length 8. I was trying to follow the suggestion at <a href=\"https://stackoverflow.com/questions/6507982/regex-to-find-repeating-numbers\">Regex to find repeating numbers</a></p>\n\n<pre><code>    testString := \"11111111\" \n    repetitive := `^(\\d)\\\\1{8}$`\n    repetitiveR := regexp.MustCompile(repetitive)\n    if repetitiveR.MatchString(testString) {\n        fmt.Println(\"Match\")\n    } else {\n        fmt.Println(\"No match\")\n    }\n</code></pre>\n\n<p>It always gives me result as \"No match\". Another way that works it is cumbersome</p>\n\n<pre><code>  testString := \"11111111\" \n  repetitive := `^(0{8})|(1{8})|(2{8})|(3{8})|(4{8})|(5{8})|(6{8})|(7{8})|(8{8})|(9{8})$`\n  repetitiveR := regexp.MustCompile(repetitive)\n  if repetitiveR.MatchString(testString) {\n    fmt.Println(\"Match\")\n  } else {\n    fmt.Println(\"No match\")\n  }\n</code></pre>\n\n<p>Output: Match</p>\n\n<p>Any suggestions</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 11358186, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FP5xoduSCyc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdzrDfx7lajHevvUV6ZLO8WKGRARQ/mo/photo.jpg?sz=128", "display_name": "Den", "link": "https://stackoverflow.com/users/11358186/den"}, "is_accepted": false, "score": 1, "last_activity_date": 1555226770, "creation_date": 1555226770, "answer_id": 55672948, "question_id": 55672809, "link": "https://stackoverflow.com/questions/55672809/how-to-define-an-empty-interface-in-proto-file/55672948#55672948", "title": "How to define an empty interface in *.proto file?", "body": "<p>Protobuf  does not support generic types.\nBecause I know all the possible types I can use <code>Oneof</code>  : <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#oneof\" rel=\"nofollow noreferrer\">Oneof</a></p>\n"}], "owner": {"reputation": 21, "user_id": 11358186, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FP5xoduSCyc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdzrDfx7lajHevvUV6ZLO8WKGRARQ/mo/photo.jpg?sz=128", "display_name": "Den", "link": "https://stackoverflow.com/users/11358186/den"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555226770, "creation_date": 1555225672, "question_id": 55672809, "link": "https://stackoverflow.com/questions/55672809/how-to-define-an-empty-interface-in-proto-file", "title": "How to define an empty interface in *.proto file?", "body": "<p>I need such a structure in the Go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type SomeStruct struct{\n    Foo bool\n    Bar interface{}\n}\n</code></pre>\n\n<p>How to define an empty interface in *.proto file? If this is not possible then how to solve the problem with the description of a field of variable type *.proto file?</p>\n"}, {"tags": ["string", "go", "compression", "gzip", "gunzip"], "answers": [{"comments": [{"owner": {"reputation": 547, "user_id": 4293902, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/275f62145e5393776735a6a58fe4f9fb?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/4293902/mark"}, "edited": false, "score": 0, "creation_date": 1555227401, "post_id": 55672915, "comment_id": 98031600, "body": "Any hints on how to decode from chunked transfer encoding with go?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 547, "user_id": 4293902, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/275f62145e5393776735a6a58fe4f9fb?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/4293902/mark"}, "edited": false, "score": 0, "creation_date": 1555228044, "post_id": 55672915, "comment_id": 98031722, "body": "@Mark: This has nothing to do with how to decompress from byte array. It should thus be asked as a separate question since nobody would expect this discussed in a comment to an unrelated question. And maybe you should explain in this new question also why you have the HTTP response in this form in the first place, because when requesting data with net/http it would be much better to just access the body directly."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 547, "user_id": 4293902, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/275f62145e5393776735a6a58fe4f9fb?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/4293902/mark"}, "edited": false, "score": 1, "creation_date": 1555234081, "post_id": 55672915, "comment_id": 98033040, "body": "@Mark, <a href=\"https://golang.org/pkg/net/http/httputil/#NewChunkedReader\" rel=\"nofollow noreferrer\">http.NewChunkedReader</a>"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 2, "last_activity_date": 1555227253, "last_edit_date": 1555227253, "creation_date": 1555226499, "answer_id": 55672915, "question_id": 55672570, "link": "https://stackoverflow.com/questions/55672570/uncompress-gzip-from-byte-array-in-golang/55672915#55672915", "title": "Uncompress gzip from byte array in golang", "body": "<blockquote>\n<pre><code>content := []byte{72,84,84,80,47,49,46,49,32,50,48,48,32,79,75, ...\n</code></pre>\n</blockquote>\n\n<p>This is no gzip data at all. Proper gzip data start with the magic sequence <code>0x1f 0x8b</code>, i.e. <code>[]byte{31,139,...}</code>. Insofar it rightly complains about <em>gzip: invalid header</em>.  </p>\n\n<p>So lets have a closer look of what this byte sequence actually is. When printing it as string it gives:</p>\n\n<pre><code>HTTP/1.1 200 OK\nTransfer-Encoding: chunked\nConnection: Keep-Alive\nContent-Encoding: gzip\nContent-Type: text/html\nDate: Sun, 14 Apr 2019 05:12:23 GMT\nKeep-Alive: timeout=5, max=100\nServer: Apache/2.4.10 (Debian)\nVary: Accept-Encoding\n\n6bd\n... binary data ..\n0\n</code></pre>\n\n<p>Thus, this is a HTTP response where the body is first compressed with gzip and then encoded with chunked transfer encoding. To extract the data you need to first remove the HTTP header, then decode from chunked transfer encoding and then you'll can take the result and decompress it with gzip.</p>\n"}], "owner": {"reputation": 547, "user_id": 4293902, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/275f62145e5393776735a6a58fe4f9fb?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/4293902/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1200, "favorite_count": 0, "accepted_answer_id": 55672915, "answer_count": 1, "score": -2, "last_activity_date": 1555227253, "creation_date": 1555223486, "question_id": 55672570, "link": "https://stackoverflow.com/questions/55672570/uncompress-gzip-from-byte-array-in-golang", "title": "Uncompress gzip from byte array in golang", "body": "<p>I have a bunch of files that come from some web requests, and some are gziped, i need to unpack them and print them as a string. This is the first time I try using golang, I tried some examples I found online but can't get it working.</p>\n\n<p>Here's the last test I was trying:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/gzip\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    content := []byte{72,84,84,80,47,49,46,49,32,50,48,48,32,79,75,13,10,84,114,97,110,115,102,101,114,45,69,110,99,111,100,105,110,103,58,32,99,104,117,110,107,101,100,13,10,67,111,110,110,101,99,116,105,111,110,58,32,75,101,101,112,45,65,108,105,118,101,13,10,67,111,110,116,101,110,116,45,69,110,99,111,100,105,110,103,58,32,103,122,105,112,13,10,67,111,110,116,101,110,116,45,84,121,112,101,58,32,116,101,120,116,47,104,116,109,108,13,10,68,97,116,101,58,32,83,117,110,44,32,49,52,32,65,112,114,32,50,48,49,57,32,48,53,58,49,50,58,50,51,32,71,77,84,13,10,75,101,101,112,45,65,108,105,118,101,58,32,116,105,109,101,111,117,116,61,53,44,32,109,97,120,61,49,48,48,13,10,83,101,114,118,101,114,58,32,65,112,97,99,104,101,47,50,46,52,46,49,48,32,40,68,101,98,105,97,110,41,13,10,86,97,114,121,58,32,65,99,99,101,112,116,45,69,110,99,111,100,105,110,103,13,10,13,10,54,98,100,13,10,31,139,8,0,0,0,0,0,0,3,236,89,235,111,218,72,16,255,156,254,21,83,127,1,36,108,243,200,163,215,0,82,66,104,19,53,205,85,133,94,85,157,78,104,177,7,188,141,189,246,237,174,33,180,234,255,126,179,182,73,8,143,132,180,167,83,117,106,68,204,122,119,231,249,155,89,123,134,103,123,173,231,103,191,119,7,159,222,245,32,208,81,216,121,214,202,191,0,90,1,50,223,12,104,168,185,14,177,211,239,95,2,116,121,18,160,132,126,202,53,42,250,74,146,88,106,244,225,116,14,159,226,84,194,169,140,103,10,101,203,205,105,114,250,231,182,221,138,80,51,16,44,194,182,53,229,56,51,100,22,120,177,208,40,116,219,154,113,95,7,109,31,167,220,67,59,187,169,2,23,92,115,22,218,202,99,33,182,235,78,205,234,216,118,193,241,135,185,85,33,98,55,60,74,163,197,132,117,167,43,156,198,177,86,90,178,4,110,5,134,92,92,67,32,113,220,182,60,165,220,209,98,135,19,113,225,208,140,5,18,195,182,165,244,60,68,21,32,146,58,17,250,156,209,148,39,17,133,181,204,39,219,202,73,93,171,96,25,104,157,168,151,174,235,121,142,239,41,244,156,84,112,59,96,66,196,83,148,142,143,46,143,38,238,152,77,29,34,178,64,207,19,178,155,71,108,130,238,141,157,241,201,16,115,23,144,181,70,177,63,47,4,250,124,10,220,39,159,144,178,214,210,156,23,50,165,200,24,242,25,227,2,101,177,182,186,158,144,16,219,240,189,183,99,111,121,11,33,190,180,68,139,247,86,85,194,68,157,160,107,5,245,44,130,150,3,8,206,8,70,30,42,136,199,43,209,67,155,91,46,113,121,152,111,131,216,178,220,133,165,133,11,103,179,153,179,193,131,165,78,139,124,8,74,122,237,146,113,230,89,183,143,158,125,25,79,226,161,23,205,175,157,68,76,104,139,203,54,136,93,153,89,189,189,211,169,68,218,151,54,59,169,148,187,161,212,25,4,92,193,12,71,42,203,159,9,159,210,117,30,167,20,158,227,88,70,76,243,88,0,125,116,128,96,188,229,229,222,82,121,186,205,141,143,70,185,143,104,46,203,61,5,68,8,100,113,42,185,152,192,249,96,240,174,111,50,65,160,103,152,41,103,69,223,117,173,72,229,189,189,91,115,216,74,72,234,25,215,154,92,232,197,145,171,2,38,209,90,32,80,172,216,217,172,61,74,181,54,1,237,51,205,236,84,134,59,4,181,23,160,119,93,80,104,188,161,196,237,154,25,136,83,189,226,128,45,166,59,5,177,226,95,40,33,66,38,39,88,204,4,76,5,154,77,140,150,161,202,121,88,157,193,140,242,210,96,76,246,82,48,81,98,242,68,119,158,143,83,145,185,170,236,87,85,149,251,149,175,83,38,225,179,170,142,63,171,182,239,76,80,247,66,140,232,92,81,167,243,1,155,92,209,161,83,86,149,63,107,127,29,243,113,249,249,242,134,211,249,133,95,38,6,149,175,25,37,229,61,211,88,172,17,201,241,103,229,80,38,114,223,12,76,32,90,174,155,132,76,27,224,157,101,55,211,137,69,76,149,243,89,89,199,164,132,147,144,127,133,190,138,125,116,184,32,251,245,41,18,13,150,115,29,43,199,223,190,149,253,216,75,141,152,170,149,91,101,85,111,225,153,17,155,202,113,203,45,204,93,10,132,173,113,221,26,73,183,211,74,22,81,18,82,250,151,204,33,82,34,103,14,77,164,150,58,219,158,3,163,251,207,1,40,199,146,142,142,124,33,161,192,162,177,240,176,242,178,229,38,157,181,212,217,16,154,45,58,101,99,49,233,244,19,244,200,134,252,38,87,117,117,247,254,221,238,123,135,140,65,236,17,210,37,65,111,112,14,125,138,167,71,40,14,239,40,206,48,119,45,133,208,42,209,26,233,54,51,203,94,173,218,24,85,182,26,214,235,158,157,247,108,186,246,79,236,147,94,191,222,120,97,191,238,190,181,251,231,39,141,131,195,173,54,209,54,56,229,122,171,5,198,86,188,241,40,39,39,248,18,214,142,82,20,206,140,95,243,196,60,199,156,88,78,92,115,231,246,194,208,24,235,13,233,196,153,226,240,140,143,199,28,237,115,12,195,136,137,18,104,147,133,186,93,26,142,66,38,174,115,205,77,206,85,129,128,151,243,204,77,59,203,58,241,167,140,194,197,31,246,110,105,135,125,205,132,207,164,191,46,138,28,147,75,122,123,210,221,89,4,185,208,38,31,174,115,91,248,150,117,156,239,66,243,232,49,52,223,223,97,249,11,199,159,22,199,102,109,71,28,73,200,34,39,155,47,246,183,98,73,219,126,97,185,3,150,228,195,141,88,102,190,253,78,44,235,251,79,192,146,100,253,2,241,7,65,172,111,132,176,254,125,0,214,106,213,223,252,237,0,254,4,105,72,42,12,203,44,156,196,146,235,32,170,172,27,79,27,126,118,200,254,245,188,35,216,154,7,59,193,246,159,103,220,255,1,175,157,83,108,219,59,253,56,149,84,108,201,226,189,254,85,126,183,92,143,238,246,174,222,44,117,62,208,11,191,125,50,161,50,228,229,102,156,94,148,58,111,227,47,60,12,153,123,224,212,160,252,145,11,159,202,4,184,26,64,189,230,212,142,129,38,14,247,143,225,230,112,191,2,39,73,18,226,71,28,189,225,218,61,104,30,57,205,67,40,191,57,31,188,189,172,66,200,175,17,94,83,169,24,87,160,27,200,56,66,247,168,233,212,104,203,139,166,83,175,53,161,207,198,76,242,130,236,73,17,75,102,188,203,202,20,83,179,80,1,234,14,46,251,64,245,170,202,161,223,102,22,237,154,214,157,198,83,69,237,138,51,210,3,65,14,77,33,51,188,16,62,247,50,92,54,0,127,117,97,112,191,7,222,118,157,183,213,229,79,53,194,148,233,74,51,42,220,233,193,101,42,85,208,60,194,135,156,69,181,189,113,107,78,20,143,239,23,247,62,247,65,196,26,20,10,31,88,198,11,166,44,76,113,67,56,155,81,214,81,185,107,120,64,170,168,32,45,240,0,170,129,3,216,242,186,13,44,19,80,188,92,195,53,157,32,166,149,114,151,234,206,35,153,35,25,57,228,61,155,237,150,32,141,82,231,143,71,227,168,233,52,225,73,254,111,44,74,113,245,16,210,181,198,168,74,151,35,186,52,107,116,169,239,211,163,148,142,229,39,203,234,221,104,20,198,134,135,196,213,232,175,74,255,7,230,194,204,101,100,46,126,117,60,174,213,105,84,111,60,89,238,123,140,98,42,229,7,255,81,96,61,91,52,71,158,45,53,249,76,23,53,73,85,96,45,247,8,139,225,222,237,142,113,76,138,222,245,74,31,237,181,46,226,202,138,82,211,63,241,232,220,225,218,202,163,154,180,54,45,108,160,97,34,227,41,247,243,62,138,233,141,173,245,233,182,244,61,173,181,67,226,172,219,239,117,179,99,66,162,66,38,189,0,38,50,78,19,96,122,51,215,213,182,221,58,203,75,228,35,193,191,192,7,193,179,163,82,207,225,188,32,200,158,67,134,111,65,99,229,52,171,141,239,45,218,187,60,74,72,75,149,70,142,249,93,194,234,92,208,61,23,89,19,47,239,82,193,69,134,50,4,108,138,148,208,115,58,9,162,172,89,7,148,202,127,167,168,178,38,40,208,163,132,41,204,126,33,96,222,138,157,15,136,31,179,32,44,36,247,153,162,183,11,120,69,51,121,155,56,185,133,120,61,26,104,144,183,224,41,142,242,31,84,246,254,1,0,0,255,255,3,0,8,20,73,242,107,25,0,0,13,10,48,13,10,13,10}\n    buf := bytes.NewBuffer(content)\n    reader, err := gzip.NewReader(buf)\n    if err != nil {\n        panic(err)\n    }\n    defer reader.Close()\n\n\n    s, err := ioutil.ReadAll(reader)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"decompressed:\\t\", string(s))\n}\n</code></pre>\n\n<p>But it shows the error: panic: <code>gzip: invalid header</code>, same as a few other examples.</p>\n\n<p>How can I ungzip the byte array content?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 3, "last_activity_date": 1555211360, "creation_date": 1555211360, "answer_id": 55671645, "question_id": 55671413, "link": "https://stackoverflow.com/questions/55671413/golang-gorm-api-end-point-returning-only-last-record/55671645#55671645", "title": "golang/gorm: api end point returning only last record", "body": "<p>You are filling the same <code>acc</code> struct through each iteration. You are also passing a pointer to a pointer of <code>Account</code>. Try adding a slice to hold all the accounts.</p>\n\n<pre><code>func GetAllUsers() []*Account {\n    accs := []*Account{}\n    rows, err := GetDB().Raw(\"select * from accounts\").Rows()\n    if err != nil {\n        fmt.Printf(\"error: %v\", err)\n    }\n    for rows.Next() {\n        acc := &amp;Account{}\n        GetDB().ScanRows(rows, acc)\n        accs = append(accs, acc)\n    }\n    return accs\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 696, "user_id": 9164597, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uQZnBHLXb2s/AAAAAAAAAAI/AAAAAAAAADU/U5m5a5XeWNU/photo.jpg?sz=128", "display_name": "Ruslan Isay", "link": "https://stackoverflow.com/users/9164597/ruslan-isay"}, "is_accepted": false, "score": 2, "last_activity_date": 1555216372, "creation_date": 1555216372, "answer_id": 55671993, "question_id": 55671413, "link": "https://stackoverflow.com/questions/55671413/golang-gorm-api-end-point-returning-only-last-record/55671993#55671993", "title": "golang/gorm: api end point returning only last record", "body": "<p>Without any special need, better to use default gorm approach to retrieve entries for some model:</p>\n\n<pre><code>func GetAllUsers() []Account {\n    var accs []Account\n    res := GetDB().Find(&amp;accs)\n\n    if res.Error != nil {\n        // Query is failed, handle error as you like.\n    }\n\n    return accs\n}\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 1234419, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/44b28a82e9785233801ad999b57770a2?s=128&d=identicon&r=PG", "display_name": "Vaibhav Chauhan", "link": "https://stackoverflow.com/users/1234419/vaibhav-chauhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 55671645, "answer_count": 2, "score": 1, "last_activity_date": 1555402012, "creation_date": 1555207633, "last_edit_date": 1555402012, "question_id": 55671413, "link": "https://stackoverflow.com/questions/55671413/golang-gorm-api-end-point-returning-only-last-record", "title": "golang/gorm: api end point returning only last record", "body": "<p>Hi I am learning to use golang right now, and there is an api end point, where I want to return all the existing users in the database, however my query is returning only last user. </p>\n\n<pre><code>base.go &lt; responsible for establishing db conns\nimport (\n\"github.com/jinzhu/gorm\"\n_ \"github.com/jinzhu/gorm/dialects/sqlite\")\nvar db *gorm.DB //database\nfunc GetDB() *gorm.DB {\nreturn db\n}\n\nmodels.go &lt; responsible for data abstractions\n\ntype Account struct {\n    gorm.Model\n    Email    string `json:\"email\"`\n    Password string `json:\"password\"`\n    Token    string `json:\"token\";sql:\"-\"`\n}\nfunc GetAllUsers() *Account {\n\nacc := &amp;Account{}\nrows, err := GetDB().Raw(\"select * from accounts\").Rows()\nif err != nil {\n    fmt.Print(\"error\")\n}\nfor rows.Next() {\n    GetDB().ScanRows(rows, &amp;acc)\n}\nreturn acc\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 1, "creation_date": 1555204077, "post_id": 55671153, "comment_id": 98028560, "body": "What does the returned data look like? Whatever is returned by <code>resp.MarshalJSON()</code>"}, {"owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "reply_to_user": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 0, "creation_date": 1555204211, "post_id": 55671153, "comment_id": 98028572, "body": "@Ibu it returns a slice of byte. specifically <a href=\"https://godoc.org/google.golang.org/api/sheets/v4#ValueRange.MarshalJSON\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/api/sheets/&hellip;</a>"}, {"owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 0, "creation_date": 1555204383, "post_id": 55671153, "comment_id": 98028597, "body": "you can do something like <code>fmt.Printf(&quot;%s&quot;,string(byt))</code> to see the actual content, so you can properly used the returned data rather use the interface."}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1555206192, "post_id": 55671153, "comment_id": 98028797, "body": "In order to correctly understand about your situation, can you provide a sample Spreadsheet?"}, {"owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1555207416, "post_id": 55671153, "comment_id": 98028925, "body": "@Tanaike Hey, this is the one i&#39;m using: <a href=\"https://docs.google.com/spreadsheets/d/1VoMAKHSnB6nptPnQqabMlKWraxWolYgPBxRo-thwmgk/edit#gid=0\" rel=\"nofollow noreferrer\">docs.google.com/spreadsheets/d/&hellip;</a>"}, {"owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "reply_to_user": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 0, "creation_date": 1555207637, "post_id": 55671153, "comment_id": 98028960, "body": "@Ibu wow, thanks. The returned string is  &quot;&quot;{&quot;majorDimension&quot;:&quot;ROWS&quot;,&quot;range&quot;:&quot;Sheet1!A1:F1000&quot;,&quot;values&zwnj;&#8203;&quot;:[[&quot;Daniel Webster&quot;,&quot;425255565&quot;],[&quot;Omar Roger&quot;,&quot;425566544&quot;],[&quot;Samuel Peter&quot;,&quot;455551515&quot;]]}&quot;&quot;  It is nicely formatted but how can I put it in a struct?"}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1555209926, "post_id": 55671153, "comment_id": 98029237, "body": "@tony Thank you for providing the sample Spreadsheet. For example, in your case, how about directly putting the values of <code>resp.Values</code> to <code>records</code> like <code>for i, row := range resp.Values { records[i].Name = row[0].(string) records[i].Mobile = row[1].(string) }</code>? I&#39;m not sure whether this is the result you want. So I posted this as a comment."}, {"owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 1, "creation_date": 1555213409, "post_id": 55671153, "comment_id": 98029602, "body": "@Tanaike thanks! works well, happy to accept your answer!"}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1555213617, "post_id": 55671153, "comment_id": 98029623, "body": "@tony Thank you for replying. I posted it as an answer. Could you please confirm it?"}], "answers": [{"tags": [], "owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "is_accepted": true, "score": 0, "last_activity_date": 1555213608, "creation_date": 1555213608, "answer_id": 55671819, "question_id": 55671153, "link": "https://stackoverflow.com/questions/55671153/how-to-convert-2d-slice-of-interface-into-struct/55671819#55671819", "title": "How to convert 2d slice of interface into struct", "body": "<p>How about this modification? In this case, the values are directly put from <code>resp.Values</code> to <code>records</code>.</p>\n\n<h3>Modified script:</h3>\n\n<pre><code>func main() {\n    srv err := InitialiseSheets()\n    fmt.Println(\"\")\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve data from sheet: %v\", err)\n    }\n\n    spreadsheetId := \"1VoMAKHSnB6nptPnQqabMlKWraxWolYgPBxRo-thwmgk\"\n    readRange := \"A:B\"\n    resp, err := srv.Spreadsheets.Values.Get(spreadsheetId, readRange).Do()\n\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve data from sheet: %v\", err)\n    }\n\n    var records []Record = make([]Record, len(resp.Values))\n\n    // Below script was modified.\n    for i, row := range resp.Values {\n        records[i].Name = row[0].(string)\n        records[i].Mobile = row[1].(string)\n    }\n\n    // do something\n\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 55671819, "answer_count": 1, "score": 1, "last_activity_date": 1555213608, "creation_date": 1555203648, "last_edit_date": 1555204113, "question_id": 55671153, "link": "https://stackoverflow.com/questions/55671153/how-to-convert-2d-slice-of-interface-into-struct", "title": "How to convert 2d slice of interface into struct", "body": "<p>I want to get all the rows from the Google sheets API. It returns the data with the <a href=\"https://godoc.org/google.golang.org/api/sheets/v4#DataFilterValueRange\" rel=\"nofollow noreferrer\">type</a><br>\n<code>[][]interface{}</code>.</p>\n\n<p>My struct is </p>\n\n<pre><code>type Record struct {\n    Name string `json:\"firstname\"`\n    Mobile    string `json:\"mobile\"`\n}\n</code></pre>\n\n<p>I would like to put all the rows in a slice of struct <code>[]Record</code> where each field is a cell in the excel sheet.</p>\n\n<p>Please see the code below for my attempt:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\nfunc main() {\n    srv err := InitialiseSheets()\n    fmt.Println(\"\")\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve data from sheet: %v\", err)\n    }\n\n    spreadsheetId := \"1VoMAKHSnB6nptPnQqabMlKWraxWolYgPBxRo-thwmgk\"\n    readRange := \"A:B\"\n    resp, err := srv.Spreadsheets.Values.Get(spreadsheetId, readRange).Do()\n\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve data from sheet: %v\", err)\n    }\n\n    var records []Record = make([]Record, len(resp.Values))\n\n    byt, err := resp.MarshalJSON()\n    var dat map[string]interface{}\n\n    if err = json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n\n    for key, value := range dat {\n        switch key {\n        case \"values\":\n            switch vv := value.(type) {\n            case []interface{}:\n                for i, u := range vv {\n                    switch r := u.(type) {\n                    case interface{}:\n            records[i].Name = r.([]interface{})[0].(string)\n                        records[i].Mobile = r.([]interface{})[1].(string)\n                        // [Daniel Webster 425255565]\n                        fmt.Println(\"kk.([]interface{})\", r.([]interface{}))\n                        // [Daniel Webster]\n                        fmt.Println(\"kk.([]interface{})[0]\", r.([]interface{})[0])\n\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I'm sure doing something like <code>records[i].Mobile = r.([]interface{})[1].(string)</code> isn't a proper way to do it, not sure how I even came up with it. Whats the best way in Go to do what I'm trying to achieve?</p>\n\n<p>If you would like to run this code please setup authentication first by following: <a href=\"https://developers.google.com/sheets/api/quickstart/go\" rel=\"nofollow noreferrer\">https://developers.google.com/sheets/api/quickstart/go</a> and you can copy/paste my code.</p>\n"}, {"tags": ["go", "synchronization", "timeout"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555192650, "post_id": 55670182, "comment_id": 98026721, "body": "Is this the higher-level problem that you are trying to solve:  When removing requests from a queue, discard the request with an error if request was in the queue for longer than some specified duration."}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555192832, "post_id": 55670182, "comment_id": 98026754, "body": "Yes -- that is the problem I am trying to solve!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555193061, "post_id": 55670182, "comment_id": 98026812, "body": "Does it work to use <code>struct { r Request, enqueueTime time.Time }</code> as the queue element type and check the enqueue time when removing an element from the queue?   <code>if time.Since(e.enqueueTime) &gt; duration { &#47;* discard with error *&#47; }</code>"}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555193325, "post_id": 55670182, "comment_id": 98026883, "body": "That almost works, except that the 504 wouldn&#39;t be returned as soon as the timeout was exceeded."}, {"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 0, "creation_date": 1555200706, "post_id": 55670182, "comment_id": 98028099, "body": "What about making processing a two way channel and sending a signal from your timeout block in the select? That way your queue can throw the request away by checking <code>&lt;-processing</code>. Or have a separate channel specifically for that use like <code>hasTimedOut</code>. (Edit: I think I misunderstood your question ignore me)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555256610, "post_id": 55670182, "comment_id": 98039119, "body": "Is the purpose of the queue to ensure that the processing code is not executed concurrently?  If yes, then there&#39;s a simpler approach."}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "edited": false, "score": 0, "creation_date": 1555280590, "post_id": 55670182, "comment_id": 98045498, "body": "The queue is helping with the implementation of a fairness algorithm, not helping make things more concurrent."}], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "edited": false, "score": 0, "creation_date": 1555253115, "post_id": 55671756, "comment_id": 98038094, "body": "My understanding is that Go makes no guarantee about the order in which goroutines will be run. So, hypothetically, what if we check the context, and it&#39;s not cancelled. Then, time.After triggers, and we return a 504. Next, we send to resultCh. There&#39;s still a race condition, right? There&#39;s no way for the thing reading from the queue to be absolutely sure we haven&#39;t already served a 504. Maybe I&#39;m missing something."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "edited": false, "score": 0, "creation_date": 1555256515, "post_id": 55671756, "comment_id": 98039092, "body": "There&#39;s a race in that the queue may process the work after the request handler has returned.  There are no data races or races that will cause a goroutine to block forever."}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "edited": false, "score": 0, "creation_date": 1555280647, "post_id": 55671756, "comment_id": 98045510, "body": "Mhm, but the same is true of using a shared atomic boolean like I mentioned in the question, right? The main problem I&#39;m trying to solve is making sure processing doesn&#39;t happen if we return a 504."}, {"owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "edited": false, "score": 0, "creation_date": 1555288828, "post_id": 55671756, "comment_id": 98046882, "body": "Looks great -- thanks for working on that -- really helpful!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1555285889, "last_edit_date": 1555285889, "creation_date": 1555212882, "answer_id": 55671756, "question_id": 55670182, "link": "https://stackoverflow.com/questions/55670182/how-to-do-idiomatic-synchronization-with-time-after/55671756#55671756", "title": "How to do idiomatic synchronization with time.After?", "body": "<p>Use a mutex coordinate processing of the data and timeout.</p>\n\n<p>Define a type to hold the mutex, input, result, a channel to signal completion of the work and a flag indicating that the work, if any, is complete.</p>\n\n<pre><code>type work struct {\n    sync.Mutex\n    input    InputType\n    result   ResultType\n    signal   chan struct {}\n    done     bool\n}\n</code></pre>\n\n<p>The request handler creates and enqueues a work item and waits for a timeout or a signal from the queue processor. Either way, the request handler checks to see if the queue processor did the work and responds as appropriate.</p>\n\n<pre><code>func handler(resp http.ResponseWriter, req *http.Request) {\n    w := &amp;queueElement{\n        input: computeInputFromRequest(req)\n        signal:  make(chan struct{})\n    }\n    enqueue(w)\n\n    // Wait for timeout or for queue processor to signal that the work is complete.\n    select {\n    case &lt;-time.After(5 * time.Second):\n    case &lt;-w.signal:\n    }\n\n    w.Lock()\n    done := w.done  // Record state of the work item.\n    w.done = true   // Mark the work item as complete.\n    w.Unlock()\n\n    if !done {\n        http.Error(w, \"Timeout\", http.StatusGatewayTimeout)\n    }  else {\n        respondWithResult(resp, w.result)\n    }\n}\n</code></pre>\n\n<p>The queue processor will look something like this:</p>\n\n<pre><code> for {\n   w := dequeue()\n   w.Lock()\n   if !w.done {\n      w.done = true\n      w.result = computeResultFromInput(w.input)\n      close(w.signal)\n   }\n   w.Unlock()\n}\n</code></pre>\n\n<p>To ensure that the request handler waits on the result, the queue processor holds the lock while processing the work item.</p>\n"}], "owner": {"reputation": 383, "user_id": 6889933, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1b819d95e4d369dfa5b4aeac622c703b?s=128&d=identicon&r=PG&f=1", "display_name": "nickackerman42", "link": "https://stackoverflow.com/users/6889933/nickackerman42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 55671756, "answer_count": 1, "score": 1, "last_activity_date": 1555285889, "creation_date": 1555192326, "question_id": 55670182, "link": "https://stackoverflow.com/questions/55670182/how-to-do-idiomatic-synchronization-with-time-after", "title": "How to do idiomatic synchronization with time.After?", "body": "<p>I'm writing an application that queues incoming requests. If a request has been on the queue for more than a certain amount of time, I'd like to throw a timeout. I'm doing that with time.After:</p>\n\n<pre><code>timeoutCh := time.After(5 * time.Second)\nselect {\n    case &lt;-timeoutCh:\n         //throw timeout 504\n    case &lt;-processing:\n         //process request\n}\n</code></pre>\n\n<p>The processing channel (along with the request) is put on the queue, and when a request is taken off to be processed, I send a signal to the channel to hit the case statement:</p>\n\n<pre><code>processing &lt;- true\n</code></pre>\n\n<p>The problem with this is that if timeoutCh has already been selected, the processing channel will block, so I need some way to check whether the request has timed out.</p>\n\n<p>I considered using a shared atomic boolean, but if I do something like this:</p>\n\n<pre><code>case &lt;-timeoutCh:\n     requestTimedOut = true\n</code></pre>\n\n<p>and then check the boolean before sending to the processing channel, there's still a race condition, because the timeoutCh case may have been selected, but the bool not yet set to true!</p>\n\n<p>Is there an idiomatic way of dealing with this sort of synchronization problem in Go?</p>\n"}, {"tags": ["go", "atomic"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1555191530, "post_id": 55670039, "comment_id": 98026461, "body": "The second and third versions of the application eliminate the data race on <code>closed</code>, but they may not eliminate all races. What happens if the foo is closed immediately after the check in <code>Add</code> completes?"}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 2, "last_activity_date": 1555212456, "last_edit_date": 1555212456, "creation_date": 1555192722, "answer_id": 55670219, "question_id": 55670039, "link": "https://stackoverflow.com/questions/55670039/is-this-use-of-golangs-atomic-package-correct/55670219#55670219", "title": "Is this use of golangs atomic package correct?", "body": "<blockquote>\n  <p>This is a race condition right?</p>\n</blockquote>\n\n<p>If <code>Close()</code> is being called concurrently with <code>Add()</code>, it is indeed a data race. \"Race condition\" is a more general term and atomics only prevent data races, not all race conditions. The definition of concurrently is based on <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">https://golang.org/ref/mem</a> but if there is no coordination and it is being done from multiple goroutines, it is concurrent.</p>\n\n<blockquote>\n  <p>So would using an atomic store/load in this situation make sense?</p>\n</blockquote>\n\n<p>Strictly speaking, it is unlikely it would make sense. What you have written is data race free. However, atomics are tricky. For example, if you now added an atomic int64 to this struct, it would have dataraces on x86-32 machines for not being 64 bit aligned while if you ordered the int64 first it wouldn't. Atomics can be dangerous and should be used with extreme caution.</p>\n\n<blockquote>\n  <p>Or would a channel be a more idomatic way to do this</p>\n</blockquote>\n\n<p>Yes! You can also use a sync.Mutex or even sync.RWMutex. Atomics, unless you are literally writing the sync.Mutex implementation, are an optimization. You should always avoid them in a first implementation. If you are having measurable lock contention, you can then look into using atomics. Just be very careful and realize that there is a good chance of messing it up.</p>\n"}], "owner": {"reputation": 1061, "user_id": 489149, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2369401260afca71c5bc5707f5b8765d?s=128&d=identicon&r=PG", "display_name": "Ian Herbert", "link": "https://stackoverflow.com/users/489149/ian-herbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 55670219, "answer_count": 1, "score": 1, "last_activity_date": 1555249515, "creation_date": 1555190950, "last_edit_date": 1555249515, "question_id": 55670039, "link": "https://stackoverflow.com/questions/55670039/is-this-use-of-golangs-atomic-package-correct", "title": "Is this use of golangs atomic package correct?", "body": "<p>I have a type with two methods; <code>Add</code> &amp; <code>Close</code>. The <code>Add</code> method is accessed concurrently and it should check if <code>Close</code> was ever called.</p>\n\n<pre><code>type foo struct {\n  closed bool\n}\n\nfunc (f *foo) Close() error {\n f.closed = true\n  ...\n}\n\nfunc (f *foo) Add(...) error {\n  if f.closed {\n    return ErrClosed\n  }\n  ...\n}\n</code></pre>\n\n<p>This is a race condition right?</p>\n\n<p>So would using an atomic store/load in this situation make sense?</p>\n\n<pre><code>type foo struct {\n  closed int32\n}\n\nfunc (f *foo) Close() error {\n  atomic.StoreInt32(&amp;f.closed, 1)\n  ...\n}\n\nfunc (f *foo) Add(...) error {\n  if atomic.LoadInt32(&amp;f.closed) == 1 {\n    return ErrClosed\n  }\n  ...\n}\n</code></pre>\n\n<p>Or would a channel be a more idiomatic way to do this:</p>\n\n<pre><code>type foo struct {\n  closed chan struct{}\n}\n\nfunc NewFoo() *foo {\n  return &amp;foo{make(chan struct{})}\n}\n\nfunc (f *foo) isClosed() bool {\n    select {\n    case &lt;-f.closed:\n        return true\n    default:\n    }\n    return false\n}\n\nfunc (f *foo) Close() error {\n  close(f.closed)\n  ...\n}\n\nfunc (f *foo) Add(...) error {\n  if f.isClosed() {\n    return ErrClosed\n  }\n  ...\n}\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Thank you for the comments, I ended up with this.</p>\n\n<pre><code>type foo struct {\n  closed bool\n  closeLock sync.RWMutex\n}\n\nfunc (f *foo) Close() error {\n  f.closeLock.Lock()\n  defer f.closeLock.Unlock()\n  f.closed = true\n  ...\n}\n\nfunc (f *foo) Add(...) error {\n  f.closeLock.RLock()\n  defer f.closeLock.RUnlock()\n\n  if f.closed {\n    return ErrClosed\n  }\n  ...\n}\n</code></pre>\n"}, {"tags": ["string", "go"], "answers": [{"comments": [{"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1555189390, "post_id": 55669442, "comment_id": 98025939, "body": "<a href=\"https://play.golang.org/p/xzzT1EKncwP\" rel=\"nofollow noreferrer\">play.golang.org/p/xzzT1EKncwP</a> - I had tried that, however <code>strings.Replace</code> expects a string. not a char  literal"}, {"owner": {"reputation": 1558, "user_id": 11265949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x7xqr.png?s=128&g=1", "display_name": "filipe", "link": "https://stackoverflow.com/users/11265949/filipe"}, "reply_to_user": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 1, "creation_date": 1555190106, "post_id": 55669442, "comment_id": 98026114, "body": "In go lang all strings are constants, you cant just replace a single char in a string, you have to assign a new one."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1555198364, "post_id": 55669442, "comment_id": 98027758, "body": "@struggling_learner: So use a string? Why is it important that it be a character literal? You can take the character literal and make a string with it, if it is somehow important to start with one character."}], "tags": [], "owner": {"reputation": 1558, "user_id": 11265949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x7xqr.png?s=128&g=1", "display_name": "filipe", "link": "https://stackoverflow.com/users/11265949/filipe"}, "is_accepted": true, "score": 2, "last_activity_date": 1555226757, "last_edit_date": 1555226757, "creation_date": 1555186314, "answer_id": 55669442, "question_id": 55669382, "link": "https://stackoverflow.com/questions/55669382/go-replace-a-char-literal-in-a-string/55669442#55669442", "title": "go replace a char literal in a string", "body": "<p>This is the the nearest of the c example I could make:</p>\n\n<pre><code>func main() {\n    input := \"Look ma no hands\"\n\n    var b strings.Builder\n    b.Grow(len(input))\n    for _, p := range input[:] {\n        if p == ' '{\n            fmt.Fprintf(&amp;b, \"%c\", '3')\n        }else{\n            fmt.Fprintf(&amp;b, \"%c\", p)\n        }\n    }\n    s := b.String()\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>But as you can see, we can't modify the original string so we are not \"replacing\" in original string but creating a new string.</p>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 55669442, "answer_count": 1, "score": 1, "last_activity_date": 1555226757, "creation_date": 1555185870, "question_id": 55669382, "link": "https://stackoverflow.com/questions/55669382/go-replace-a-char-literal-in-a-string", "title": "go replace a char literal in a string", "body": "<p>In golang, what's the easiest way to replace a char literal in a string? </p>\n\n<p>Here's the C code, where we replace the whitespace with '3': </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(){\n\n    char input[] = \"Look ma no hands\";\n    printf(\"Input \\\"%s\\\" \", input);\n    for (int i = 0; i &lt; strlen(input); i++){\n        //printf(\"input[%d] is %c\\n\", i, input[i]);\n        if ( input[i] == ' ' ){\n            input[i] = 3;\n        }\n    }\n\n    printf(\",converted to :%s\\n\", input);\n    return 0;\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>$ ./a.out \nInput \"Look ma no hands\" ,converted to :Lookmanohands\n</code></pre>\n\n<p>How can we do this in golang? </p>\n"}, {"tags": ["go", "swagger"], "comments": [{"owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "edited": false, "score": 1, "creation_date": 1555246579, "post_id": 55668980, "comment_id": 98036136, "body": "Can you provide some of your code"}, {"owner": {"reputation": 74, "user_id": 8147937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cf46fcd1a3a82c2ff156fdbef0b24b2?s=128&d=identicon&r=PG&f=1", "display_name": "Niel_patel", "link": "https://stackoverflow.com/users/8147937/niel-patel"}, "reply_to_user": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "edited": false, "score": 0, "creation_date": 1555528140, "post_id": 55668980, "comment_id": 98147290, "body": "I am able to fix this. just need to import docs in main,go"}], "owner": {"reputation": 74, "user_id": 8147937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cf46fcd1a3a82c2ff156fdbef0b24b2?s=128&d=identicon&r=PG&f=1", "display_name": "Niel_patel", "link": "https://stackoverflow.com/users/8147937/niel-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555222884, "creation_date": 1555182666, "last_edit_date": 1555222884, "question_id": 55668980, "link": "https://stackoverflow.com/questions/55668980/no-spec-provided-even-if-it-has-json-file-generated", "title": "No spec provided even if it has json file generated", "body": "<p>I am trying to implement swagger with go and I am using go package <code>swag</code> for that. Not encountered any error. I am able to see swagger UI but it doesn't have specs in it even if I have generated a file in code.</p>\n\n<p>I have installed a http-swagger package of go and added it to routes as mentioned in the document in <a href=\"https://github.com/swaggo/http-swagger\" rel=\"nofollow noreferrer\">https://github.com/swaggo/http-swagger</a>.</p>\n\n<ol>\n<li><code>go get github.com/swaggo/swag/cmd/swag</code></li>\n<li><code>swag init</code> (files created)</li>\n<li><code>go get -u github.com/swaggo/http-swagger</code></li>\n<li>followed exact same thing as documentation of package.</li>\n</ol>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1555183437, "last_edit_date": 1555183437, "creation_date": 1555182255, "answer_id": 55668936, "question_id": 55668781, "link": "https://stackoverflow.com/questions/55668781/golang-howto-unmarshal-nested-structure-into-a-slice-of-structs/55668936#55668936", "title": "Golang howto unmarshal nested structure into a slice of structs", "body": "<p>Remove spaces between <code>:</code> and <code>\"</code> in field tags. <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Export</a> all fields.</p>\n\n<pre><code>type Device struct {\n    Hostname    string `json:\"hostname\"`\n    Ipaddress   string `json:\"ipaddress\"`\n    SnmpVersion int    `json:\"snmpVersion\"`\n    SnmpV1cred  struct {\n        Community string `json:\"community\"`\n    } `json:\"snmpV1\"`\n    SnmpV3cred struct {\n        SecName      string `json:\"secName\"`\n        AuthPassword string `json:\"authPassword\"`\n        AuthProto    string `json:\"authProtocol\"`\n        PrivPassword string `json:\"privPassword\"`\n        PrivProto    string `json:\"priveProtocol\"`\n        SecLevel     string `json:\"secLevel\"`\n    } `json:\"snmpV3\"`\n}\n</code></pre>\n\n<p>The <code>go vet</code> command reports these errors.</p>\n"}], "owner": {"reputation": 3, "user_id": 2254058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAJoD.png?s=128&g=1", "display_name": "NLTBO", "link": "https://stackoverflow.com/users/2254058/nltbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 55668936, "answer_count": 1, "score": 0, "last_activity_date": 1555189947, "creation_date": 1555181018, "last_edit_date": 1555189947, "question_id": 55668781, "link": "https://stackoverflow.com/questions/55668781/golang-howto-unmarshal-nested-structure-into-a-slice-of-structs", "title": "Golang howto unmarshal nested structure into a slice of structs", "body": "<p>How do I unMarshal this json code in Golang. I have the hostname and ipaddress but not the snmpV1 part:</p>\n\n<pre><code>[\n    {\n        \"hostname\" : \"myserver\",\n        \"ipaddress\" : \"127.0.0.1\",\n        \"snmpVersion\" : 1,\n        \"snmpV1\" : {\n            \"community\" : \"public\"\n        }\n    }\n]\n</code></pre>\n\n<p>I have the following struct:</p>\n\n<pre><code>type Device struct {\n    Hostname string `json: \"hostname\"`\n    Ipaddress string `json:\"ipaddress\"`\n    SnmpVersion int `json:\"snmpVersion\"`\n    SnmpV1cred struct {\n        Community string `json: \"community\"`\n    } `json: \"snmpV1\"`\n    SnmpV3cred struct {\n        secName string `json: \"secName\"`\n        authPassword string `json: \"authPassword\"`\n        AuthProto string `json: \"authProtocol\"`\n        PrivPassword string `json: \"privPassword\"`\n        PrivProto string `json: \"priveProtocol\"`\n        secLevel string `json: \"secLevel\"`\n    } `json: \"snmpV3\"`\n}\n</code></pre>\n\n<p>Then I unmarshal using:</p>\n\n<pre><code>deviceList := []Device{}\nbuffer, err := ioutil.ReadFile(deviceFile)\nif err != nil {\n    logger.Fatal(err)\n}\n\nerr = json.Unmarshal(buffer, &amp;deviceList)\n</code></pre>\n\n<p>However I only get this with a fmt.Println:\n[{myserver 127.0.0.1 1 {} {     }}]</p>\n"}, {"tags": ["go", "gopath", "go-packages"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1555179952, "last_edit_date": 1555179952, "creation_date": 1555179644, "answer_id": 55668575, "question_id": 55668421, "link": "https://stackoverflow.com/questions/55668421/getting-full-path-to-a-package-source-from-the-package-import-path/55668575#55668575", "title": "Getting full path to a package source from the package import path", "body": "<p>Use the <a href=\"https://godoc.org/go/build\" rel=\"nofollow noreferrer\">go/build</a> package to resolve an import path to a directory:</p>\n\n<pre><code> p, err := build.Default.Import(\"github.com/pkg/errors\", \".\", build.FindOnly)\n if err != nil {\n     // handle error\n }\n d := p.Dir\n</code></pre>\n\n<p>This snippet resolves <a href=\"https://godoc.org/go/build#IsLocalImport\" rel=\"nofollow noreferrer\">local imports</a> relative to the current working directory.  Replace <code>\".\"</code> with <code>\"\"</code> if you don't want to resolve local imports or supply a different directory if appropriate.</p>\n"}], "owner": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 55668575, "answer_count": 1, "score": 0, "last_activity_date": 1555179952, "creation_date": 1555178628, "question_id": 55668421, "link": "https://stackoverflow.com/questions/55668421/getting-full-path-to-a-package-source-from-the-package-import-path", "title": "Getting full path to a package source from the package import path", "body": "<p>Currently I have a parameter like <code>str := \"github.com/pkg/errors\"</code>. I need the full path to the package.</p>\n\n<p>Currently how I achieve this is by using <code>build.Default.GOPATH+\"/src/\"+str</code>.</p>\n\n<p>Is there a native non hacky way of resolving the full path to an import (which could be in a <code>vendor</code> folder etc...).</p>\n"}, {"tags": ["git", "go", "jenkins", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6345186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9WLqb.jpg?s=128&g=1", "display_name": "c1ayy", "link": "https://stackoverflow.com/users/6345186/c1ayy"}, "is_accepted": false, "score": -1, "last_activity_date": 1605176414, "creation_date": 1605176414, "answer_id": 64802037, "question_id": 55666333, "link": "https://stackoverflow.com/questions/55666333/how-to-use-go-modules-in-jenkins-with-private-repository/64802037#64802037", "title": "How to use go modules in jenkins with private repository?", "body": "<p>Best approch is make your project ./vendor directory to you git repositry.\nThen jenkins build will use vendor and not try to get from intnernet.\nbuild command:</p>\n<pre><code>env GO111MODULE=off go build\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 10258312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f42aa83ecfde474612cb2a8020f5bfd?s=128&d=identicon&r=PG&f=1", "display_name": "makisang", "link": "https://stackoverflow.com/users/10258312/makisang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 745, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1605176414, "creation_date": 1555164214, "question_id": 55666333, "link": "https://stackoverflow.com/questions/55666333/how-to-use-go-modules-in-jenkins-with-private-repository", "title": "How to use go modules in jenkins with private repository?", "body": "<p>I'm building a go app through Jenkins Pipeline, at first I add all my go depedencies in vendor dir and push to VCS, and then pull all the code when building in Jenkins, this works fine. </p>\n\n<p>Then I want to migrate to go modules, because I have a private lib dependency in Gitlab, so I modify the netrc  file in Jenkins server as this page says: <a href=\"https://golang.org/doc/faq#git_https\" rel=\"nofollow noreferrer\">git_https</a>, and 'go build' works perfectly in local machine and download all the dependencies as expected, but in Jenkins server has some problem. \nHere is my Jenkinsfile:</p>\n\n<pre><code>pipeline {\n    agent any\n\n    stages {\n\n        stage('build') {\n            agent {\n                docker { image 'golang:1.12' }\n            }\n\n            steps {\n\n                sh \"export XDG_CACHE_HOME=/tmp/.cache \\\n                &amp;&amp; go build\"\n            }\n        }\n\n    }\n}\n</code></pre>\n\n<p>As the code shows, I use 'go build' to trigger go module build process, , but still I got this error when building:</p>\n\n<pre><code>go get gitlab.com/gbuda/dblib: git ls-remote -q origin in /go/pkg/mod/cache/vcs/a8fb1674af641945219afa3eee63923c22afe0df48bc030a6bf714abb7116332: exit status 128:\n    fatal: could not read Username for 'https://gitlab.com': terminal prompts disabled\nIf this is a private repository, see https://golang.org/doc/faq#git_https for additional information.\n</code></pre>\n\n<p><code>gitlab.com/gbuda/dblib</code> is my private repository, it seems the config in <code>netrc</code> in Jenkins server didn't work, how can I fix this problem? Thanks for any advice.</p>\n"}, {"tags": ["c", "linux", "go", "constants", "stat"], "comments": [{"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 3, "creation_date": 1555163877, "post_id": 55666262, "comment_id": 98019080, "body": "Octal is a wonderful base, isn&#39;t it?"}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1555164869, "post_id": 55666262, "comment_id": 98019362, "body": "Thank you very much @EOF I didn&#39;t realise 00040 was octal. If you can add it as an answer, I will accept it. I was under the impression that this was decimal."}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1555164962, "post_id": 55666262, "comment_id": 98019385, "body": "Pretty sure there will be a number of duplicates, but I can&#39;t <i>find</i> that number because of terrible legacy numerical formats ;-)"}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1555165263, "post_id": 55666262, "comment_id": 98019471, "body": "@EOF Found one here <a href=\"https://stackoverflow.com/questions/48123541/how-does-the-go-language-os-filemode-function-convert-permissions-from-integers\" title=\"how does the go language os filemode function convert permissions from integers\">stackoverflow.com/questions/48123541/&hellip;</a> May be you can mark it as a duplicate."}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "closed_date": 1555165532, "answer_count": 0, "score": 0, "last_activity_date": 1555163758, "creation_date": 1555163758, "question_id": 55666262, "link": "https://stackoverflow.com/questions/55666262/difference-between-constants-defined-in-gos-syscall-and-cs-stat-h", "closed_reason": "Duplicate", "title": "Difference between constants defined in Go&#39;s syscall and C&#39;s stat.h", "body": "<p>Hello stackoverflow friends,</p>\n\n<p>I am on arch linux.</p>\n\n<p>I was going over the constants defined in syscall package related to permission bits as a part of my internal project, and I see that the value of a few constants that I was interested in, is different from what is defined in the stat.h. </p>\n\n<p>The ones I looked into was</p>\n\n<pre><code>        S_IRGRP                          = 0x20\n        S_IWGRP                          = 0x10\n        S_IXGRP                          = 0x8\n</code></pre>\n\n<p>which is defined in <a href=\"https://golang.org/pkg/syscall/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/</a></p>\n\n<p>whereas in linux's stat.h, the value is</p>\n\n<pre><code>#define S_IRGRP 00040\n#define S_IWGRP 00020\n#define S_IXGRP 00010\n</code></pre>\n\n<p>(<a href=\"https://github.com/torvalds/linux/blob/master/include/uapi/linux/stat.h#L35\" rel=\"nofollow noreferrer\">https://github.com/torvalds/linux/blob/master/include/uapi/linux/stat.h#L35</a>)\nThese were the values I checked so far, and there may be a few more that doesn't match with the C header file.\nAs of now, I have declared the constants with values that matches the one in <code>stat.h</code> within my project and using it, but I am not sure why there is this difference in the values between go's syscall constants and the stat.h #define constants.</p>\n\n<p>Has anyone came across this before and know why there is this difference? Are these constants used for different purposes in C and Go?</p>\n\n<p>Thank you very much.</p>\n"}, {"tags": ["go", "vue.js", "active-directory", "axios", "kerberos"], "comments": [{"owner": {"reputation": 3796, "user_id": 5458806, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W2bL0.jpg?s=128&g=1", "display_name": "Ahmad Mobaraki", "link": "https://stackoverflow.com/users/5458806/ahmad-mobaraki"}, "edited": false, "score": 1, "creation_date": 1555159023, "post_id": 55665441, "comment_id": 98017713, "body": "axios third  argument can be used for headers: <code>axios.get(url, {withCredentials: true},{   headers: {&#39;Negotiate&#39;: &#39;oi4u234p5oiu34po&#39;}   })</code>"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 3796, "user_id": 5458806, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W2bL0.jpg?s=128&g=1", "display_name": "Ahmad Mobaraki", "link": "https://stackoverflow.com/users/5458806/ahmad-mobaraki"}, "edited": false, "score": 0, "creation_date": 1555220683, "post_id": 55665441, "comment_id": 98030502, "body": "@AhmadMobaraki hello! Where did you get this token value? As I understand this token which you set in Negotiate is dynamic, right?"}, {"owner": {"reputation": 3796, "user_id": 5458806, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W2bL0.jpg?s=128&g=1", "display_name": "Ahmad Mobaraki", "link": "https://stackoverflow.com/users/5458806/ahmad-mobaraki"}, "edited": false, "score": 0, "creation_date": 1555222020, "post_id": 55665441, "comment_id": 98030672, "body": "Yes it&#39;s dynamic, I just gave you a tip for how to add a header to axios request"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 3796, "user_id": 5458806, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W2bL0.jpg?s=128&g=1", "display_name": "Ahmad Mobaraki", "link": "https://stackoverflow.com/users/5458806/ahmad-mobaraki"}, "edited": false, "score": 0, "creation_date": 1555225969, "post_id": 55665441, "comment_id": 98031336, "body": "@AhmadMobaraki do you have any ideas how to generate that token?"}, {"owner": {"reputation": 3796, "user_id": 5458806, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W2bL0.jpg?s=128&g=1", "display_name": "Ahmad Mobaraki", "link": "https://stackoverflow.com/users/5458806/ahmad-mobaraki"}, "edited": false, "score": 0, "creation_date": 1555226159, "post_id": 55665441, "comment_id": 98031379, "body": "Sorry I have no idea"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 564, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1555158543, "creation_date": 1555158543, "question_id": 55665441, "link": "https://stackoverflow.com/questions/55665441/how-make-axios-request-negotiate-spnego-token", "title": "How make axios request (Negotiate/SPNEGO token)?", "body": "<p>From <code>frontend</code> application (Vue.js) I make axios (ajax) request to the URL of <code>backend</code> application (Golang) which works with <strong>Kerberos</strong>. I need to return information about the employee when frontend application makes GET request to the route of backend application.</p>\n\n<p>Inside frontend application I make such axios request:</p>\n\n<pre><code>axios.get(url, {withCredentials: true})\n</code></pre>\n\n<p>Inside backend application I set CORS options like that:</p>\n\n<pre><code>headers := handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\", \"Authorization\"})\nmethods := handlers.AllowedMethods([]string{\"GET\", \"POST\", \"PATCH\", \"PUT\", \"DELETE\", \"OPTIONS\"})\norigins := handlers.AllowedOrigins([]string{\"*\"})\ncredentials := handlers.AllowCredentials() // true\n</code></pre>\n\n<p>Right now client application raise <code>HTTP 401 Unauthorized</code> error when I make axios request. Everythink works fine only if I make request from browser.</p>\n\n<p>In the log of the backend application I see such header information when I make request from browser:</p>\n\n<pre><code>map[Upgrade-Insecure-Requests:[1] User-Agent:[Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36] Accept:[text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3] Accept-Encoding:[gzip, deflate] Accept-Language:[ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7] Connection:[keep-alive] Cache-Control:[max-age=0]]\nmap[Connection:[keep-alive] Upgrade-Insecure-Requests:[1] User-Agent:[Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36] Accept-Language:[ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7] Cache-Control:[max-age=0] Authorization:[Negotiate YIIHVQYGKwYBBQUCoIIHSTCCB0WgMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBw8EggcLYIIHBwYJKoZIhvcSAQICAQBuggb2MIIG8qADAgEFoQMCAQ6iBwMFACAAAACjggV4YYIFdDCCBXCgAwIBBaEPGw1LQVItVEVMLkxPQ0FMoi0wK6ADAgECoSQwIhsESFRUUBsaa3otZG1waWdudDA1Lmthci10ZWwubG9jYWyjggUnMIIFI6ADAgEXoQMCAQOiggUVBIIFETMAZStUfDPJR4GItJfk8JST2HU7YxuFq4HPQ/PWoK/gW5HzZj+dc9CC1stR/D/LhOJFKcAdzkDRmjHNanWWaolcJDhHttrGcF01jHH0xHVUPir8B/7j65QOXmedHIRDexlQsUzjztWuxtPQjERcZFPAo4RtTkpLB2wIHJaeNTevkBOofxVmBunxIqBk+h9Rk2qswOfQlj/Eevrm2R3t6AG3kgliUBg3KbrZ7KxRWUdx2dvaZ6lZ8sKLRY8NYorozVTDS4hlLiGAldZlXICO5PbyiXcy/qHyiUge98r1vqQzyVNYixG9ZEj7fy6hSNF3KDSgjjT70zLaRb8Bj44VKR8BKqRTh6zby+ku6VGjrUdn/7r9iG3G0nnjc+1/WQyY55afcI5SKs7oBJlfqsX5OPF+VEtWbDG2UVK9KiTIbtFpnl6rkimam0pFaT9Rthgcy/1ehR1OvPAajC46s1gFz9St0qZO2syqukfStb3bdWIdxNVQZMjKlHjMm2URtBNOK34kXzdEmLh9kYtufGBK9M1VMRJ53VijG1ZUEodYeUi0JVwfSAvpq2NVdJ1kOgY93REYjHVjSR7Ur3uUzxFszVj7ur35bjlUK+K7Dwu+AZNsNiQ6Xq9FIzZZzkcuA4s+L6FYx1ttCPqDw7cPIO+LlpsOyhxK+SP1N9E8veeR5sS3MPt6xsSPf70lw9m7ztVudIksDK5Myth6VY9QdpEGlbQ2XKaw+ZVjPyMhvn90eJznQXf4IpbhpE6r4owf4CuFMcJ4hZrnP9tmT9CrCdDzVunV6JCORwu5mErGitzjM8o1pesKw9lvrv/RxZQS9lI8MziRxTCp/ZiMZYk9ZlsyMAJMrquweaFHDFLRn3B20xJouH8GtR2TIefPuwkhJn1m7rbsnRZa7QAki+yBP/meLLffstU+fGGBiVQfsc1Tj6acZDRyFeMCbLnqZZGiFwhxsJtI1h/hs/F5awpEZ7P1eyjhK6p7v+itvhT9O4FYTQkJ/Fce9TMiUSxcPiTH5UbKAsOt7jaqJjGwJSFf3DtKpgulPLv42DlyX4+mnsDNMp1yniloh5j6goxc/riL8iqO9LEyxId0n3QyNNqs6Iq6ZjVk48bQ+mocNkLDJ85k8bZOVjnFrRlUHLzTqLPuNn1cbVn4yoFOj3DROfRQf9HEukE5wgjUg/nlKECsn+eJwfLFpNCiyJZnojOs5chW8E6IZgP/qGy/poqNAazuGFx9Bf8wqJ4UcQGWuu7IdGM2SdKttxigMnvR8wMkw8mvl2Z07vY8Czrl+h/NfMJZTdPJYk/VLiu5qXRMdAPiSI5HuvWZuuDpuh6FijvR3bRwtjOgoU5V96zSC6CfiLXZy5TWCTtWtg2OZYPXUrO+sTeSLCI8toJQzJ3QzQD7yiPmdsDr1VA/pbWn6o0M29L0R+uwkw17sf4XlEffWzPj+JDIFYOaMtPra/FNEOdyg2GGG5I13UvIJq6anNiSb54FQxOaX2ed7vQl3PTx4SB0+AxVTfic5osUZo9/GY8U+qIsMQRnECxGiNWBMkPRPupFjwLV3HAM27XE2KV7dk2HeMAuD4+reASoNrctPoBox16ACliE2XLL/hnmcASSi32XeJOCDTcvcaIeib4K8GceMK5P+himWI/RjuGy7yUfjQIx3kYQERoVZBXycQFnE9XNBlzknP0Tbfy6DKLrjx1s4x0s5ngKgy/xOYg4tq40V/D0Xa8ICpqkggFfMIIBW6ADAgEXooIBUgSCAU7K5/v8GkuLM9ygpogXpOHDnydt9A3f/2N/d49zmcFkQzNRR6enJpvm++OxEuho4Zl/PMhK5eHZT+Zl11EXrWfmzyBw5AE61vp/bTy4m1S/YYRexOyKuwV1eJIamp31iFuxgTJ6bHgij7B+H7crnb1cmzafooewazuKpycmtroqN7FMnFvohSWoB8IOudxEHF/oVSYrRhSFt63YqiJ5c2nLLKxhkFobkDS2IGuWsxQt9w7epEcgu73aVr3AwHT0IeeDUpIZIjfEtBZO77MipC+oGyUEZt1ZMMcP+I+3c9qht2Qj7nk+daOZSQge/3OCWzj6wpImsaBjCYNYz57+KEBIJDhMLZjR16ibnp8b+oGLgkQwm9TRuLZ9CHIy+lOgQv+aeGrNS3TvcjX3nIxlC3O9pImpExmhtLsapHLFOgMcdDyBMY0wsxvLNa/gKLqq] Accept:[text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3] Accept-Encoding:[gzip, deflate]]\n</code></pre>\n\n<p>As you can see browser somehow generate SPNEGO (Negotiate) token and set it to header automatically. I can't understand how I can make the same result via axios request. I will be grateful for any help.</p>\n"}, {"tags": ["go", "godeps", "go-modules", "govendor"], "answers": [{"comments": [{"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1560330305, "post_id": 55664631, "comment_id": 99696893, "body": "After I ran these when I try to build, I am getting this error <code>clang: error: unable to read SDK settings for &#39;&#47;Library&#47;Developer&#47;CommandLineTools&#47;SDKs&#47;MacOSX.sdk&#39;</code>"}, {"owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "reply_to_user": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1560337197, "post_id": 55664631, "comment_id": 99700701, "body": "@Surya try updating your CommandLineTools: <code>xcode-select --install</code>"}, {"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1560338025, "post_id": 55664631, "comment_id": 99701161, "body": "Yes did that and did this too xcode-select --switch /Library/Developer/CommandLineTools/ Still no luck @Nicholas"}, {"owner": {"reputation": 387, "user_id": 1329504, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/20b9d2d20ce2839af9cba29450cc12f5?s=128&d=identicon&r=PG", "display_name": "Ali Faizan", "link": "https://stackoverflow.com/users/1329504/ali-faizan"}, "edited": false, "score": 0, "creation_date": 1586884325, "post_id": 55664631, "comment_id": 108290962, "body": "Be cautious with step 5. If your repo has vendor folder, it quite possibly contains some stuff unavailable otherwise"}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1618541043, "post_id": 55664631, "comment_id": 118637948, "body": "EXCELLENT answer, thanks @Nicholas!"}], "tags": [], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "is_accepted": true, "score": 64, "last_activity_date": 1583437420, "last_edit_date": 1583437420, "creation_date": 1555152555, "answer_id": 55664631, "question_id": 55664630, "link": "https://stackoverflow.com/questions/55664630/how-do-i-migrate-from-dep-to-go-modules/55664631#55664631", "title": "How do I migrate from Dep to Go Modules", "body": "<p>Migrating from Dep to Go Modules is very easy.</p>\n\n<ol>\n<li>Run <code>go version</code> and make sure you're using Go version 1.11 or later.</li>\n<li>Move your code outside of GOPATH or set <code>export GO111MODULE=on</code>.</li>\n<li><code>go mod init [module path]</code>: This will import dependencies from Gopkg.lock.</li>\n<li><code>go mod tidy</code>: This will remove unnecessary imports, and add indirect ones.</li>\n<li>(Optional) Delete your vendor folder (<code>rm -rf vendor/</code> or move to trash)</li>\n<li><code>go build</code>: Do a test build to see if it works.</li>\n<li><code>rm -f Gopkg.lock Gopkg.toml</code>: Delete the obsolete files used for Dep.</li>\n</ol>\n\n<p>Go has imported my dependencies from Dep by reading the <code>Gopkg.lock</code> file and also created a <code>go.mod</code> file.</p>\n\n<p>If you want to keep your vendor folder:</p>\n\n<ol start=\"7\">\n<li>Run <code>go mod vendor</code> to copy your dependencies into the vendor folder.</li>\n<li>Run <code>go build -mod=vendor</code> to ensure <code>go build</code> uses your vendor folder.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1056, "user_id": 4154706, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/b91e34f88755d8517830e1389972fb18?s=128&d=identicon&r=PG", "display_name": "aitchkhan", "link": "https://stackoverflow.com/users/4154706/aitchkhan"}, "is_accepted": false, "score": 3, "last_activity_date": 1555228849, "creation_date": 1555228849, "answer_id": 55673177, "question_id": 55664630, "link": "https://stackoverflow.com/questions/55664630/how-do-i-migrate-from-dep-to-go-modules/55673177#55673177", "title": "How do I migrate from Dep to Go Modules", "body": "<p>To add to @Nicholas answer's:</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/Modules#how-to-define-a-module\" rel=\"nofollow noreferrer\">Here</a> is from the offical golang documenation:</p>\n\n<p>To create a go.mod for an existing project:</p>\n\n<ol>\n<li>Navigate to the root of the module's source tree outside of GOPATH:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ export GO111MODULE=on                         # manually active module mode\n$ cd $GOPATH/src/&lt;project path&gt;                 # e.g., cd $GOPATH/src/you/hello\n</code></pre>\n\n<ol start=\"2\">\n<li>Create the initial module definition and write it to the go.mod file:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go mod init      \n</code></pre>\n\n<p>This step converts from any existing <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> Gopkg.lock file or <a href=\"https://tip.golang.org/pkg/cmd/go/internal/modconv/?m=all#pkg-variables\" rel=\"nofollow noreferrer\">from any of the other nine total supported dependency formats</a>, adding require statements to match the existing configuration.</p>\n\n<ol start=\"3\">\n<li>Build the module. When executed from the root directory of a module, the ./... pattern matches all the packages within the current module. go build will automatically add missing or unconverted dependencies as needed to satisfy imports for this particular build invocation:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go build ./...\n</code></pre>\n\n<ol start=\"4\">\n<li>Test the module as configured to ensure that it works with the selected versions:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go test ./...\n</code></pre>\n\n<ol start=\"5\">\n<li><p>(Optional) Run the tests for your module plus the tests for all direct and indirect dependencies to check for incompatibilities:</p></li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go test all\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1562, "user_id": 3053228, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003319530324/picture?type=large", "display_name": "prashant", "link": "https://stackoverflow.com/users/3053228/prashant"}, "is_accepted": false, "score": 1, "last_activity_date": 1574239538, "last_edit_date": 1574239538, "creation_date": 1574230378, "answer_id": 58947843, "question_id": 55664630, "link": "https://stackoverflow.com/questions/55664630/how-do-i-migrate-from-dep-to-go-modules/58947843#58947843", "title": "How do I migrate from Dep to Go Modules", "body": "<p>Another way to upgrade to modules.</p>\n\n<ul>\n<li><p>Remove the Gopkg.toml and Gopkg.lock</p>\n\n<p><code>rm Gopkg.*</code></p></li>\n<li><p>Initialise the Go modules</p>\n\n<p><code>GO111MODULE=on go mod init</code></p></li>\n<li><p>Run go mod tidy to pull all the indirect modules and remove unused modules</p>\n\n<p><code>GO111MODULE=on go mod tidy</code></p></li>\n<li><p>Run build to ensure everything works fine</p>\n\n<p><code>go build</code></p></li>\n</ul>\n\n<p>Tip in case you face few modules not found then manually update the modules tag in go.mod file.</p>\n"}], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13211, "favorite_count": 11, "accepted_answer_id": 55664631, "answer_count": 3, "score": 39, "last_activity_date": 1583437420, "creation_date": 1555152555, "question_id": 55664630, "link": "https://stackoverflow.com/questions/55664630/how-do-i-migrate-from-dep-to-go-modules", "title": "How do I migrate from Dep to Go Modules", "body": "<p>I'm currently using Dep and would like to start using Go modules.</p>\n\n<p>How do I migrate?</p>\n"}, {"tags": ["go", "struct", "sizeof"], "comments": [{"owner": {"reputation": 5234, "user_id": 7400903, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/66a5c6bdca5a30cc6fdacd92fc5745a2?s=128&d=identicon&r=PG&f=1", "display_name": "goodvibration", "link": "https://stackoverflow.com/users/7400903/goodvibration"}, "edited": false, "score": 0, "creation_date": 1555151479, "post_id": 55664457, "comment_id": 98015962, "body": "Conclusion: The second setup (gcc for Raspberry) pads to alignment of 64 bits. The first setup doesn&#39;t pad to alignment of 64 bits (though it probably pads to alignment of 32 bits)."}], "answers": [{"comments": [{"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "reply_to_user": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "edited": false, "score": 0, "creation_date": 1555162779, "post_id": 55664491, "comment_id": 98018801, "body": "@schlamar: you can do it, but in this case you need to add the padding in the <code>go</code> structure. First check where those padding bytes are (most probably at the end) and then add another <code>reserved</code> 32-bit integer to the <code>go</code> structure in the proper position."}, {"owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "edited": false, "score": 0, "creation_date": 1555327929, "post_id": 55664491, "comment_id": 98059517, "body": "And how would you do that across multiple architectures in practice? I know you can calculate this manually (<a href=\"https://fresh2refresh.com/c-programming/c-structure-padding/\" rel=\"nofollow noreferrer\">fresh2refresh.com/c-programming/c-structure-padding</a>) but this is tedious."}, {"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "reply_to_user": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "edited": false, "score": 0, "creation_date": 1555333411, "post_id": 55664491, "comment_id": 98062516, "body": "@schlamar: there is no way to &quot;compute&quot; the result for different architectures (or even different compilers for the same architecture). Padding in C and C++ is a <b>choice</b> of the compiler implementer. See edited answer."}, {"owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "edited": false, "score": 0, "creation_date": 1555398728, "post_id": 55664491, "comment_id": 98086052, "body": "That&#39;s not quite correct, usually the C platform ABI guarantees a deterministic struct alignment (if you don&#39;t use any compiler options / pragmas / etc. of course). C++ is more complicated, but that&#39;s not relevant here. See also my answer to this question."}], "tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": false, "score": 2, "last_activity_date": 1555419923, "last_edit_date": 1555419923, "creation_date": 1555151515, "answer_id": 55664491, "question_id": 55664457, "link": "https://stackoverflow.com/questions/55664457/how-to-use-syscalls-correctly-in-go-different-results-from-go-unsafe-sizeof-vs/55664491#55664491", "title": "How to use syscalls correctly in go (different results from Go unsafe.Sizeof vs C sizeof)", "body": "<p>The <code>go</code> compiler and the <code>C</code> compiler are handling alignment differently.</p>\n\n<p>In C the structure has been aligned to 16 bytes (adding a 4 bytes slack space after <code>id</code> or before it). The <code>go</code> compiler instead packed the fields without adding any slack space.</p>\n\n<p>Your mistake is thinking that two \"structures\" in different languages with different compilers should have the same memory layout.</p>\n\n<p>Note that there is no way to \"compute\" what will be the padding in a C or C++ structure because padding is a <strong>choice</strong> of the implementer. It's well possible that two different standard-conforming C compilers for the same architecture will generate different paddings (or even the same compiler with different compiling options).</p>\n\n<p>The only way to get the padding correct is to check the specific case, either manually or by writing a script that calls the compiler passing the same compiling options and checks the result (e.g. by output the results of <code>offsetof</code> on all the members) and then generates the needed <code>go</code> source code after parsing that output.</p>\n"}, {"comments": [{"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1555408966, "post_id": 55702379, "comment_id": 98091964, "body": "You apparently ignore that the &quot;C rules for structure padding&quot; are extremely liberal... (basically they only forbid padding at the begin of structures, that&#39;s all). It&#39;s impossible (theoretically impossible) for <code>go</code> to be compatible at structure level with &quot;C&quot; programs because there can be (and actually there are) standard-conforming C compilers that are not compatible each other at structure layout level, even on the same platform."}, {"owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "reply_to_user": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1555417779, "post_id": 55702379, "comment_id": 98097094, "body": "That&#39;s wrong. The aligment of a struct in C is defined by the platform&#39;s ABI if no compiler options regarding padding are set. Otherwise, FFI with structs from for example Rust (<a href=\"https://doc.rust-lang.org/nomicon/ffi.html#interoperability-with-foreign-code\" rel=\"nofollow noreferrer\">doc.rust-lang.org/nomicon/&hellip;</a>) or Python (<a href=\"https://gist.github.com/Overdrivr/cdd58cea15d7e28c50ea\" rel=\"nofollow noreferrer\">gist.github.com/Overdrivr/cdd58cea15d7e28c50ea</a>) to C wouldn&#39;t work. Actually, even the C example from the question wouldn&#39;t be portable across different compilers."}, {"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1555419848, "post_id": 55702379, "comment_id": 98098407, "body": "You are mixing up levels. The &quot;C&quot; level defines no ABI. The &quot;C&quot; language padding is not governed by &quot;rules&quot; as you think them. The rules are instead &quot;there may be padding between members and after the end&quot; and &quot;there must be no padding at beginning&quot;; how much and if there is padding at all or not is not guaranteed by the C standard. Feel free to check C standard documents if you don&#39;t trust me. I passed long ago the age in which trying to correct every ignorant on the internet was my top priority; you are free to self-accept your own wrong answer if it makes you feel better. No offense taken."}, {"owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "reply_to_user": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1555427935, "post_id": 55702379, "comment_id": 98103769, "body": "Yeah, I never said this is defined in the C standard. The ABI comes from the compiler. In theory a compiler can do want he wants (regarding to padding) but in practice they follow the platform&#39;s default ABI (at least that&#39;s the case for clang and gcc on Linux, they are ABI compatible: <a href=\"http://lists.llvm.org/pipermail/cfe-dev/2015-April/042357.html\" rel=\"nofollow noreferrer\">lists.llvm.org/pipermail/cfe-dev/2015-April/042357.html</a>)."}, {"owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "reply_to_user": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1555428932, "post_id": 55702379, "comment_id": 98104398, "body": "MSVC guarantees a stable ABI for structs (&quot;POD&quot;), too: You should never write code that depends on a particular layout for an object that isn&#39;t a COM interface or a POD object. <a href=\"https://docs.microsoft.com/de-de/cpp/porting/binary-compat-2015-2017?view=vs-2019\" rel=\"nofollow noreferrer\">docs.microsoft.com/de-de/cpp/porting/&hellip;</a>"}], "tags": [], "owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "is_accepted": false, "score": 0, "last_activity_date": 1555398199, "creation_date": 1555398199, "answer_id": 55702379, "question_id": 55664457, "link": "https://stackoverflow.com/questions/55664457/how-to-use-syscalls-correctly-in-go-different-results-from-go-unsafe-sizeof-vs/55702379#55702379", "title": "How to use syscalls correctly in go (different results from Go unsafe.Sizeof vs C sizeof)", "body": "<p>According to <a href=\"https://go101.org/article/memory-layout.html\" rel=\"nofollow noreferrer\">https://go101.org/article/memory-layout.html</a>, go generally follows the C rules for structure padding (see <a href=\"https://stackoverflow.com/a/38144117/851737\">https://stackoverflow.com/a/38144117/851737</a> for details of the C memory alignment rules and <a href=\"https://doc.rust-lang.org/reference/type-layout.html#reprc-structs\" rel=\"nofollow noreferrer\">here</a> for an algorithm in pseudocode).</p>\n\n<p>However, there is a <a href=\"https://github.com/golang/go/issues/599\" rel=\"nofollow noreferrer\">known bug</a> that go doesn't align 64bit values on 32bit architectures correctly.</p>\n"}], "owner": {"reputation": 8522, "user_id": 851737, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f981b37f5120cd32282071b4e9de12bb?s=128&d=identicon&r=PG", "display_name": "schlamar", "link": "https://stackoverflow.com/users/851737/schlamar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1555419923, "creation_date": 1555151228, "last_edit_date": 1555153223, "question_id": 55664457, "link": "https://stackoverflow.com/questions/55664457/how-to-use-syscalls-correctly-in-go-different-results-from-go-unsafe-sizeof-vs", "title": "How to use syscalls correctly in go (different results from Go unsafe.Sizeof vs C sizeof)", "body": "<p>Go's <code>unsafe.Sizeof</code> is returning a different result than C's <code>sizeof</code>.</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"unsafe\"\n)\n\ntype gpioeventdata struct {\n    Timestamp uint64\n    ID        uint32\n}\n\nfunc main() {\n    eventdata := gpioeventdata{}\n    println(\"Size\", unsafe.Sizeof(eventdata))\n}\n</code></pre>\n\n<p>Prints <code>12</code> when compiled with <code>env GOOS=linux GOARCH=arm GOARM=6 go build</code> on macOS and run on Raspberry Pi Zero.</p>\n\n<p>gpio.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;linux/gpio.h&gt;\n\nint main() {    \n    printf(\"sizeof gpioevent_data %zu\\n\", sizeof(struct gpioevent_data));\n}\n</code></pre>\n\n<p>Prints <code>16</code> when compiled and run on Raspberry (with <code>gcc</code>).</p>\n\n<p>struct definition in gpio.h:</p>\n\n<pre><code>struct gpioevent_data {\n    __u64 timestamp;\n    __u32 id;\n};\n</code></pre>\n\n<p><strong>Edit</strong> </p>\n\n<p>I already thought that this is due to alignment, but a lot of people are passing Go structs to <code>syscall.Syscall</code> (e.g. <a href=\"https://github.com/stapelberg/hmgo/blob/master/internal/gpio/reset.go#L49\" rel=\"nofollow noreferrer\">https://github.com/stapelberg/hmgo/blob/master/internal/gpio/reset.go#L49</a>). So that's basically wrong and you should never do that?</p>\n\n<p>If that's wrong, what would be the correct approach calling syscalls with go so that works correctly with different architectures. For example GPIO ioctl calls:</p>\n\n<pre><code>ret = ioctl(fd, GPIO_GET_LINEEVENT_IOCTL, &amp;req);\n...\nstruct gpioevent_data event;\nret = read(req.fd, &amp;event, sizeof(event));\n</code></pre>\n"}, {"tags": ["oracle", "go", "oci8", "go-xorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1555166025, "post_id": 55664155, "comment_id": 98019698, "body": "Can you share the table definition? Also <code>Find</code> returns an <code>error</code> value, have you checked whether its <code>nil</code> or not?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1555166705, "post_id": 55664155, "comment_id": 98019887, "body": "... my guess is that the problem is caused by the letter-case, looking at the column names returned by the <code>Query</code> method it looks like you declared the relation in all caps, now when you use identifiers without quotes around them, as you do in <code>Query</code>, the matching is <i>case insensitive</i>, however when you put quotes around the identifiers, like done by the <code>Find</code> method, then the matching is <i>case sensitive</i> and since you, most probably, defined the table as <code>USERTEST</code> a select query from <code>&quot;usertest&quot;</code> cannot possibly succeed since there&#39;s no such table."}, {"owner": {"reputation": 51, "user_id": 5171509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e5a2b0636d4967f3f28954ba94b51f5?s=128&d=identicon&r=PG&f=1", "display_name": "t-okamoto", "link": "https://stackoverflow.com/users/5171509/t-okamoto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1555204987, "post_id": 55664155, "comment_id": 98028676, "body": "@mkopriva You&#39;re right. The table has actual values but the table name is &quot;USERTEST&quot; so that this couldn&#39;t find the table. I added the method which returns actual table name and that works. Thanks for your help :)"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5171509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e5a2b0636d4967f3f28954ba94b51f5?s=128&d=identicon&r=PG&f=1", "display_name": "t-okamoto", "link": "https://stackoverflow.com/users/5171509/t-okamoto"}, "is_accepted": false, "score": 1, "last_activity_date": 1555205023, "creation_date": 1555205023, "answer_id": 55671240, "question_id": 55664155, "link": "https://stackoverflow.com/questions/55664155/how-to-get-table-values-by-xorm-from-oracle-db/55671240#55671240", "title": "How to get table values by xorm from Oracle DB?", "body": "<p>I added the method which returns the actual table name.</p>\n\n<pre><code>type Usertest struct {\n    Id       int64  `json:\"id\" xorm:\"'ID'\"`\n    Name     string `json:\"name\" xorm:\"'NAME'\"`\n    Pass string `json:\"pass\" xorm:\"'PASS'\"`\n}\n// add this method\nfunc (Usertest) TableName() string {\n    return \"USERTEST\"\n}\n\nmain(){\n    ...\n    ...\n    engine.Find(&amp;usertest01)\n    fmt.Println(usertest01)\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5171509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e5a2b0636d4967f3f28954ba94b51f5?s=128&d=identicon&r=PG&f=1", "display_name": "t-okamoto", "link": "https://stackoverflow.com/users/5171509/t-okamoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555205023, "creation_date": 1555148895, "question_id": 55664155, "link": "https://stackoverflow.com/questions/55664155/how-to-get-table-values-by-xorm-from-oracle-db", "title": "How to get table values by xorm from Oracle DB?", "body": "<p>I try to get values by using xorm and call engine.Find(&amp;xxxx) method but the result object is empty. \nI've checked that it can get result through engine.Query() method.\nThis means database connection is working correctly and .\nHow to put the result in <code>usertest01</code>?</p>\n\n<pre><code>package main\n\nimport (\n\n    \"database/sql\"\n    _ \"github.com/mattn/go-oci8\"\n    \"github.com/go-xorm/xorm\"\n)\n\n\ntype Usertest struct {\n    Id       int64  `json:\"id\" xorm:\"'id'\"`\n    Name     string `json:\"name\" xorm:\"'name'\"`\n    Password string `json:\"password\"\u3000xorm:\"'password'\"`\n}\n\nvar engine *xorm.Engine\n\nfunc main(){\n    engine, err = xorm.NewEngine(\"oci8\", getDSN())\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n\n    var usertest01 []Usertest\n    engine.Find(&amp;usertest01)\n    fmt.Println(\"--- result by struct. doesn't work ---\")\n    fmt.Println(usertest01)\n\n    usertest02, err := engine.Query(\"select * from usertest\")\n    fmt.Println(\"--- result by Query. this works ---\")\n    fmt.Println(usertest02) \n\n}\n\n</code></pre>\n\n<p>console</p>\n\n<pre><code>[xorm] [info]  2019/04/13 18:24:45.986664 [SQL] SELECT \"id\", \"name\", \"password\" FROM \"usertest\"\n--- result by struct. doesn't work---\n[]\n[xorm] [info]  2019/04/13 18:24:46.095214 [SQL] select * from usertest\n--- result by Query. this works ---\n[map[ID:[49] NAME:[78 65 77 69] PASS:[80 65 83 83]]]\n\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "post", "slack"], "answers": [{"comments": [{"owner": {"reputation": 23463, "user_id": 4379151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kOLJQ.jpg?s=128&g=1", "display_name": "Erik Kalkoken", "link": "https://stackoverflow.com/users/4379151/erik-kalkoken"}, "edited": false, "score": 0, "creation_date": 1555172768, "post_id": 55663935, "comment_id": 98021526, "body": "Hi and thanks for posting your solution. Self-answers are welcome, but if would be nice if you could put some explanation or summary of the solution in the answer, not only a bunch of code. Also question box should still contain a real and specific question. Thanks!"}], "tags": [], "owner": {"reputation": 487, "user_id": 214891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YCG7w.jpg?s=128&g=1", "display_name": "Richard Varno", "link": "https://stackoverflow.com/users/214891/richard-varno"}, "is_accepted": false, "score": 0, "last_activity_date": 1555147346, "creation_date": 1555147346, "answer_id": 55663935, "question_id": 55663934, "link": "https://stackoverflow.com/questions/55663934/quick-and-easy-post-to-slack-webhook-from-golang-appengine/55663935#55663935", "title": "Quick and Easy Post to Slack Webhook from Golang AppEngine", "body": "<pre><code>import (\n\"bytes\"\n\"google.golang.org/appengine\"\n\"google.golang.org/appengine/urlfetch\"\n\"net/http\"\n)\n\nfunc postSlackBetaSignup(req *http.Request, msg string) string {\n\nctx := appengine.NewContext(req);\nrequest := urlfetch.Client(ctx);\ndata := []byte(\"{'text': '\" + msg + \"'}\");\nbody := bytes.NewReader(data);\nresp, err := request.Post(\"https://hooks.slack.com/services/&lt;&lt;&lt;YOUR WEBHOOK HERE&gt;&gt;&gt;\", \"application/json\", body);\nif err != nil {\n    return err.Error();\n} else {\n    return resp.Status;\n}\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 487, "user_id": 214891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YCG7w.jpg?s=128&g=1", "display_name": "Richard Varno", "link": "https://stackoverflow.com/users/214891/richard-varno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555147346, "creation_date": 1555147346, "question_id": 55663934, "link": "https://stackoverflow.com/questions/55663934/quick-and-easy-post-to-slack-webhook-from-golang-appengine", "title": "Quick and Easy Post to Slack Webhook from Golang AppEngine", "body": "<p>Not so much a question as help for others having this problem.  Took a fair amount of beating my head against a wall to make this work. (as much I as love golang, you do have think a little differently) - This will also work as a generic way to do any sort of post to an outside source in AppEngine.</p>\n\n<p>Here is the function I am using to post simple messages to a slack channel via webhook.  (assumes you know how to set up a webhook in slack - very easy to do - <a href=\"https://get.slack.help/hc/en-us/articles/115005265063-Incoming-WebHooks-for-Slack\" rel=\"nofollow noreferrer\">https://get.slack.help/hc/en-us/articles/115005265063-Incoming-WebHooks-for-Slack</a> ) - NOTE: while there are a fair # of additional parameters you can pass in the json message (see link above) simple things like email addresses and image urls / web addresses will be automatically parsed by slack if passed in the 'text' parameter.</p>\n\n<pre><code>import (\n\"bytes\"\n\"google.golang.org/appengine\"\n\"google.golang.org/appengine/urlfetch\"\n\"net/http\"\n)\n\nfunc postSlackBetaSignup(req *http.Request, msg string) string {\n\nctx := appengine.NewContext(req);\nrequest := urlfetch.Client(ctx);\ndata := []byte(\"{'text': '\" + msg + \"'}\");\nbody := bytes.NewReader(data);\nresp, err := request.Post(\"https://hooks.slack.com/services/&lt;&lt;&lt;YOUR WEBHOOK HERE&gt;&gt;&gt;\", \"application/json\", body);\nif err != nil {\n    return err.Error();\n} else {\n    return resp.Status;\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "types", "interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1555139494, "post_id": 55662913, "comment_id": 98013454, "body": "<code>*User</code> implements <code>KeyProvider</code>, it does not implement <code>*KeyProvider</code>. But even so <code>[]*User</code> is not directly convertible to <code>[]KeyProvider</code>. You need to loop over the users slice and create a new key provider slice from its individual elements."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1555139545, "post_id": 55662913, "comment_id": 98013464, "body": "<a href=\"https://stackoverflow.com/a/12754757/965900\">stackoverflow.com/a/12754757/965900</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": true, "score": 2, "last_activity_date": 1555142430, "last_edit_date": 1555142430, "creation_date": 1555142119, "answer_id": 55663269, "question_id": 55662913, "link": "https://stackoverflow.com/questions/55662913/cannot-use-type-x-as-type-y-even-if-same-interface/55663269#55663269", "title": "Cannot use type X as type Y even if same interface", "body": "<p>always keep in mind, Go requires explicit type conversions.</p>\n\n<p>1.<code>func ToKeys(l []*KeyProvider) []*datastore.Key</code> should be <code>func ToKeys(l []KeyProvider) []*datastore.Key</code>.<br>\nshould almost never use pointer to an interface, use interface.</p>\n\n<p>2.not allow to convert <code>[]*User</code> to <code>[]KeyProvider</code> directly, because of different representation in memory (if you are interesting about <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">slice's internal</a>).</p>\n\n<p>you need to convert the slice manually, for example:</p>\n\n<pre><code>func foo(t []*User) {\n    s := make([]KeyProvider, len(t))\n    for i, v := range t {\n        s[i] = v\n    }\n\n    keys := ToKeys(s)\n}\n</code></pre>\n\n<p>check this two urls:<br>\n<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#convert_slice_of_interface</a> <a href=\"https://golang.org/doc/faq#convert_slice_with_same_underlying_type\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#convert_slice_with_same_underlying_type</a></p>\n"}], "owner": {"reputation": 144, "user_id": 5817748, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4_WauPfNYlQ/AAAAAAAAAAI/AAAAAAAAAhY/25dhIN10RXk/photo.jpg?sz=128", "display_name": "Alexander Richey", "link": "https://stackoverflow.com/users/5817748/alexander-richey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "protected_date": 1555748790, "accepted_answer_id": 55663269, "answer_count": 1, "score": 0, "last_activity_date": 1555747731, "creation_date": 1555138685, "question_id": 55662913, "link": "https://stackoverflow.com/questions/55662913/cannot-use-type-x-as-type-y-even-if-same-interface", "title": "Cannot use type X as type Y even if same interface", "body": "<p>I am trying to write a function which takes anything that implements a certain interface as an argument.</p>\n\n<p>I have defined an interface <code>KeyProvider</code> which specifies a <code>GetKey()</code> method. I have defined a function that uses this interface <code>ToKeys()</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type KeyProvider interface {\n    GetKey() *datastore.Key \n}\n\nfunc ToKeys(l []*KeyProvider) []*datastore.Key {\n    keys := make([]*datastore.Key, len(l))\n    for i, vp := range l {\n        v := *vp\n        keys[i] = v.GetKey()\n    }\n    return keys\n}\n</code></pre>\n\n<p>I have implemented this interface on a struct <code>User</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n    Key *datastore.Key\n}\n\nfunc (u *User) GetKey() *datastore.Key {\n    return u.Key\n}\n</code></pre>\n\n<p>I try to use the <code>ToKeys()</code> method.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func foo(users []*User) {\n    keys := ToKeys(users)\n}\n</code></pre>\n\n<p>But I get this error:</p>\n\n<pre><code>cannot use users (type []*User) as type []*KeyProvider in argument to ToKeys\n</code></pre>\n\n<p>Why? And how can I get something like this working?</p>\n"}, {"tags": ["go", "go-modules", "go-build"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1555134725, "post_id": 55662147, "comment_id": 98012507, "body": "I think the key part of the help you are showing is &quot;when in module mode&quot;. This will only happen when you are working on code outside of GOPATH or if you have set the GO111MODULE=on environment variable. <a href=\"https://golang.org/cmd/go/#hdr-Preliminary_module_support\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Preliminary_module_support</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 3, "last_activity_date": 1555179425, "creation_date": 1555179425, "answer_id": 55668546, "question_id": 55662147, "link": "https://stackoverflow.com/questions/55662147/error-build-flag-mod-vendor-only-valid-when-using-modules-when-building-go-p/55668546#55668546", "title": "Error: &quot;build flag -mod=vendor only valid when using modules&quot; when building Go project", "body": "<p>I think the key part of the help you are showing is <code>when in module mode</code>. This will only happen when you are working on code outside of GOPATH or if you have set the <code>GO111MODULE=on</code> environment variable so I think you have this set in your local environment but not the build server.</p>\n\n<p>More information about enabling module support is here:</p>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Preliminary_module_support\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Preliminary_module_support</a></p>\n"}], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3599, "favorite_count": 1, "accepted_answer_id": 55668546, "answer_count": 1, "score": 2, "last_activity_date": 1596249684, "creation_date": 1555131305, "last_edit_date": 1596249684, "question_id": 55662147, "link": "https://stackoverflow.com/questions/55662147/error-build-flag-mod-vendor-only-valid-when-using-modules-when-building-go-p", "title": "Error: &quot;build flag -mod=vendor only valid when using modules&quot; when building Go project", "body": "<p>According to <a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">this document</a> I need to add <code>-mod=vendor</code> to my build command to make use of my local <code>vendor</code> folder:</p>\n\n<blockquote>\n  <p>By default, go commands like go build ignore the vendor directory when in module mode. The -mod=vendor flag (e.g., go build -mod=vendor) instructs the go commands to use the main module's top-level vendor directory to satisfy dependencies.</p>\n</blockquote>\n\n<p>When I run this command:</p>\n\n<pre><code>go build -mod=vendor -a -ldflags \"-s -w -X github.com/my-api/pkg/config.Version=169.3988801\" -o bin/my-api\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>build flag -mod=vendor only valid when using modules\n</code></pre>\n\n<p>Locally the command works as expected, the error only occurs on the build server.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 2, "creation_date": 1555129661, "post_id": 55661916, "comment_id": 98011769, "body": "You are building a single Go file here so the compiler won&#39;t be able to link the required routes.go file resulting in the above error. Try &quot;$ go build&quot; to create the binary and then execute it. Alternately, you can use &quot;go install&quot; as well."}, {"owner": {"reputation": 1223, "user_id": 1201937, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/w56Lr.jpg?s=128&g=1", "display_name": "Bertho Joris", "link": "https://stackoverflow.com/users/1201937/bertho-joris"}, "reply_to_user": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 0, "creation_date": 1555129744, "post_id": 55661916, "comment_id": 98011777, "body": "@KshitijSaraogi ok I&#39;ll try"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1555142189, "post_id": 55661916, "comment_id": 98013981, "body": "See <a href=\"https://stackoverflow.com/a/55260736/5198756\">this</a> answer!"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1555147752, "post_id": 55661916, "comment_id": 98015180, "body": "@BerthoJoris feel free to vote the answer if you found it helpful :)"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565786305, "post_id": 55663396, "comment_id": 101459314, "body": "There is no need to export the function, it&#39;s all in the same package. It should be <code>go run .</code>, it doesn&#39;t make sense to give multiple package arguments to <code>go run</code> (which is what &quot;./...&quot; does)."}], "tags": [], "owner": {"reputation": 252, "user_id": 4894552, "user_type": "registered", "accept_rate": 31, "profile_image": "https://lh3.googleusercontent.com/-ivqPvzKF7PU/AAAAAAAAAAI/AAAAAAAAEEs/JWAQAOt6Nok/photo.jpg?sz=128", "display_name": "Adrien Chapelet", "link": "https://stackoverflow.com/users/4894552/adrien-chapelet"}, "is_accepted": true, "score": 0, "last_activity_date": 1565779612, "last_edit_date": 1565779612, "creation_date": 1555143153, "answer_id": 55663396, "question_id": 55661916, "link": "https://stackoverflow.com/questions/55661916/how-to-import-routes/55663396#55663396", "title": "How to import routes", "body": "<p>You need both things:</p>\n\n<ul>\n<li>Run your application with <code>go run ./...</code> or <code>go run main.go model.go routes.go</code></li>\n<li>Rename your function <code>registerRoutes</code> to <code>RegisterRoutes</code>, to make your function public, and visible in your package</li>\n</ul>\n"}], "owner": {"reputation": 1223, "user_id": 1201937, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/w56Lr.jpg?s=128&g=1", "display_name": "Bertho Joris", "link": "https://stackoverflow.com/users/1201937/bertho-joris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 55663396, "answer_count": 1, "score": 1, "last_activity_date": 1565779612, "creation_date": 1555128674, "last_edit_date": 1555136975, "question_id": 55661916, "link": "https://stackoverflow.com/questions/55661916/how-to-import-routes", "title": "How to import routes", "body": "<p>I just started a Go project by following the tutorial on Pluralsight, but I experienced a bit of an obstacle when I wanted to <em>separate</em> all of my routes into <em>one file route</em>.</p>\n\n<p>Previously my code went well:</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n)\n\nfunc main() {\n    r := gin.Default()\n    r.LoadHTMLGlob(\"templates/*.html\")\n\n    r.GET(\"/\", func(c *gin.Context) {\n        c.String(http.StatusOK, \"Helo from %v\", \"Gin\")\n    })\n\n    r.GET(\"/json\", func(c *gin.Context) {\n        c.JSON(200, gin.H {\n            \"status\":  \"posted\",\n            \"message\": \"Hi...\",\n            \"nick\":    \"Nick here\",\n        })\n    })\n\n    r.GET(\"/template/index\", func(c *gin.Context) {\n        c.HTML(http.StatusOK, \"index.html\", nil)\n    })\n\n    r.Run(\":3000\")\n}\n</code></pre>\n\n<p>Until here, all of my code is <strong>running well</strong>.</p>\n\n<p>Then I made a route file like this:</p>\n\n<p>routes.go</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n)\n\nfunc registerRoutes() *gin.Engine {\n    r := gin.Default()\n    r.LoadHTMLGlob(\"templates/*.html\")\n\n    r.GET(\"/\", func(c *gin.Context) {\n        c.String(http.StatusOK, \"Helo from %v\", \"Gin\")\n    })\n\n    r.GET(\"/json\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"status\":  \"posted\",\n            \"message\": \"Hi broh\",\n            \"nick\":    \"Nick here\",\n        })\n    })\n\n    r.GET(\"/template/index\", func(c *gin.Context) {\n        c.HTML(http.StatusOK, \"index.html\", nil)\n    })\n\n    return r\n}\n</code></pre>\n\n<p>And I changed the code on my <code>main.go</code> to:</p>\n\n<pre><code>package main\n\nfunc main() {\n    r := registerRoutes()\n\n    r.Run(\":3000\")\n}\n</code></pre>\n\n<p>When I run it, I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>go build main.go\n# command-line-arguments\n.\\main.go:4:7: undefined: registerRoutes\n</code></pre>\n\n<p>I have tried to understand it but I always get that error message. Is something wrong with my code?</p>\n\n<p>My project structure:</p>\n\n<p><a href=\"https://i.stack.imgur.com/P3fNG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P3fNG.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "init"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1555113070, "post_id": 55660723, "comment_id": 98009598, "body": "Use assignment instead of a short variable declaration in the init function."}], "answers": [{"tags": [], "owner": {"reputation": 4060, "user_id": 763355, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/dxAhW.jpg?s=128&g=1", "display_name": "MoDJ", "link": "https://stackoverflow.com/users/763355/modj"}, "is_accepted": true, "score": 3, "last_activity_date": 1555113067, "creation_date": 1555113067, "answer_id": 55660756, "question_id": 55660723, "link": "https://stackoverflow.com/questions/55660723/why-am-i-getting-an-error-in-the-go-init-method/55660756#55660756", "title": "Why am I getting an error in the GO init() method?", "body": "<p>That just creates a local variable named \"foo\" inside the method. You need to assign the string to the already declared var at the module scope via foo = \"bar\".</p>\n"}, {"tags": [], "owner": {"reputation": 457, "user_id": 6427258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wZ4IU.jpg?s=128&g=1", "display_name": "tendai", "link": "https://stackoverflow.com/users/6427258/tendai"}, "is_accepted": false, "score": 0, "last_activity_date": 1555113705, "creation_date": 1555113705, "answer_id": 55660810, "question_id": 55660723, "link": "https://stackoverflow.com/questions/55660723/why-am-i-getting-an-error-in-the-go-init-method/55660810#55660810", "title": "Why am I getting an error in the GO init() method?", "body": "<p>In Go <code>foo:=\"bar\"</code> is a short assignment statement that can be used in a function in place of a <code>var</code> declaration. </p>\n\n<p>So essentially what you have done is declare a new <code>foo</code> variable inside the <code>init</code> method instead of used the global <code>foo</code></p>\n"}, {"tags": [], "owner": {"reputation": 119, "user_id": 9160403, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K1U7Hl0_D9I/AAAAAAAAAAI/AAAAAAAABfo/3O0tmAVoJYY/photo.jpg?sz=128", "display_name": "Virepri", "link": "https://stackoverflow.com/users/9160403/virepri"}, "is_accepted": false, "score": 0, "last_activity_date": 1555168090, "creation_date": 1555168090, "answer_id": 55666905, "question_id": 55660723, "link": "https://stackoverflow.com/questions/55660723/why-am-i-getting-an-error-in-the-go-init-method/55666905#55666905", "title": "Why am I getting an error in the GO init() method?", "body": "<p>The keyword <code>:=</code> is shorthand for \"assign to new variable\"-- Go lets you shadow old variables with new variables in deeper scopes.</p>\n\n<p><code>foo</code> exists within the global scope, but you've created a new <code>foo</code> inside the <code>init()</code> scope-- therefore, inside of <code>init()</code>, <code>foo</code> shadows the global <code>foo</code>.</p>\n\n<p>Furthermore, Go complains about unused variables in local scopes. In this case, your <code>foo</code> in <code>init()</code> is unused.</p>\n\n<p>So, to walk over this,</p>\n\n<ul>\n<li>You defined <code>foo</code> in the global scope</li>\n<li>You entered <code>init()</code>, and then defined a <code>foo</code> within <code>init()</code>, shadowing the global <code>foo</code></li>\n<li>You did not use the local variable <code>foo</code>.</li>\n</ul>\n\n<p>If you want to set the global foo, use <code>=</code>, not <code>:=</code>, as <code>:=</code> creates a new variable.</p>\n"}], "owner": {"reputation": 2372, "user_id": 468778, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/XgvcC.jpg?s=128&g=1", "display_name": "Roger Hill", "link": "https://stackoverflow.com/users/468778/roger-hill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 55660756, "answer_count": 3, "score": -1, "last_activity_date": 1555168090, "creation_date": 1555112656, "question_id": 55660723, "link": "https://stackoverflow.com/questions/55660723/why-am-i-getting-an-error-in-the-go-init-method", "title": "Why am I getting an error in the GO init() method?", "body": "<p>So I understand that in go, init() is a special method that can be used to initialize an object in a package. When I try to use this technique, I get an error that the variable is declared and not used. For example:</p>\n\n<pre><code>package fizzbuzz\n\nvar foo string\n\nfunc init() {\n    foo := \"bar\"\n}\n</code></pre>\n\n<p>It seems to me that most of the time variables that you put in this method will not be used local to int(), so that is just fine. What am I missing?</p>\n"}]