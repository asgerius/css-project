[{"tags": ["json", "go"], "comments": [{"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 2, "creation_date": 1534978453, "post_id": 51976181, "comment_id": 90902736, "body": "Don&#39;t ignore error, it has a hint."}, {"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534978462, "post_id": 51976181, "comment_id": 90902738, "body": "What result would you like to get? A slice of three PublicKeys? A slice of two PublicKeys, where the second has a MyData slice of length two?"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1534978715, "post_id": 51976181, "comment_id": 90902778, "body": "@ferhatelmas oops! added it."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534978772, "post_id": 51976181, "comment_id": 90902787, "body": "@robx the latter."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534978883, "post_id": 51976181, "comment_id": 90902812, "body": "@robx: to clarify there would be 1 PublicKey that has a MyData slice along with the  top-level &quot;ID&quot; and &quot;Key&quot; fields."}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1534978987, "post_id": 51976181, "comment_id": 90902832, "body": "So, this sample data isn&#39;t the correct one but something you artificially generate to match your struct ?"}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1534979084, "post_id": 51976181, "comment_id": 90902852, "body": "updated your sample <a href=\"https://play.golang.org/p/EE7mwRsyb8g\" rel=\"nofollow noreferrer\">play.golang.org/p/EE7mwRsyb8g</a>"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1534979128, "post_id": 51976181, "comment_id": 90902863, "body": "@ferhatelmas No, the sample data is correct. Your update has a key and mine doesn&#39;t and that&#39;s why yours works."}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 1, "creation_date": 1534979494, "post_id": 51976181, "comment_id": 90902931, "body": "Why are you mixing arrays and objects in the top level ? How is it generated ? It makes parsing unnecessarily more difficult."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1534980954, "post_id": 51976181, "comment_id": 90903206, "body": "@ferhatelmas I&#39;m not. That&#39;s the data that is given me. Like I said, it is ugly data. My question is how can I unmarshal it?"}, {"owner": {"reputation": 472, "user_id": 5689112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8218d0d54eb2d0cffcc671894e9f6d63?s=128&d=identicon&r=PG&f=1", "display_name": "kitt", "link": "https://stackoverflow.com/users/5689112/kitt"}, "edited": false, "score": 0, "creation_date": 1534985320, "post_id": 51976181, "comment_id": 90903991, "body": "Do you want to unmarshal all the keys into the same Public Key array? Or match the JSON strictly?"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1534986172, "post_id": 51976181, "comment_id": 90904157, "body": "Would like to match the JSON but whatever works is fine"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1535002595, "post_id": 51976181, "comment_id": 90907553, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/48697961/unmarshal-2-different-structs-in-a-slice\">Unmarshal 2 different structs in a slice</a>"}], "answers": [{"tags": [], "owner": {"reputation": 27119, "user_id": 8753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NLxHO.jpg?s=128&g=1", "display_name": "laz", "link": "https://stackoverflow.com/users/8753/laz"}, "is_accepted": true, "score": 1, "last_activity_date": 1535032466, "last_edit_date": 1535032466, "creation_date": 1534993559, "answer_id": 51977795, "question_id": 51976181, "link": "https://stackoverflow.com/questions/51976181/how-do-i-json-unmarshal-slice-inside-a-slice/51977795#51977795", "title": "How do I json unmarshal slice inside a slice", "body": "<p>That is some truly hideous JSON! I have two approaches to handling the mixed array elements and I like the 2nd one better. Here's the first approach using <code>interface</code> and a type switch:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n)\n\ntype PublicKey struct {\n    ID  int    `json:\"id\"`\n    Key string `json:\"key\"`\n}\n\ntype MyData struct {\n    ID    string `json:\"id\"`\n    Value int    `json:\"value\"`\n}\n\ntype MixedData struct {\n    Key    []PublicKey\n    MyData [][]MyData\n}\n\nfunc (md *MixedData) UnmarshalJSON(b []byte) error {\n    md.Key = []PublicKey{}\n    md.MyData = [][]MyData{}\n    var obj []interface{}\n    err := json.Unmarshal([]byte(b), &amp;obj)\n    if err != nil {\n        return err\n    }\n    for _, o := range obj {\n        switch o.(type) {\n        case map[string]interface{}:\n            m := o.(map[string]interface{})\n            id, ok := m[\"id\"].(float64)\n            if !ok {\n                return errors.New(\"public key id must be an int\")\n            }\n            pk := PublicKey{}\n            pk.ID = int(id)\n            pk.Key, ok = m[\"key\"].(string)\n            if !ok {\n                return errors.New(\"public key key must be a string\")\n            }\n            md.Key = append(md.Key, pk)\n        case []interface{}:\n            a := o.([]interface{})\n            myData := make([]MyData, len(a))\n            for i, x := range a {\n                m, ok := x.(map[string]interface{})\n                if !ok {\n                    return errors.New(\"data array contains unexpected object\")\n                }\n                val, ok := m[\"value\"].(float64)\n                if !ok {\n                    return errors.New(\"data value must be an int\")\n                }\n                myData[i].Value = int(val)\n                myData[i].ID, ok = m[\"id\"].(string)\n                if !ok {\n                    return errors.New(\"data id must be a string\")\n                }\n                md.MyData = append(md.MyData, myData)\n            }\n        default:\n            // got something unexpected, handle somehow\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    b := `[\n  {\n    \"id\": 1,\n    \"key\": \"my_key\"\n  },\n  [\n    {\n      \"id\": \"some_id\",\n      \"value\": 12\n    },\n    {\n      \"id\": \"another_id\",\n      \"value\": 13\n    }\n  ]\n]`\n\n    m := MixedData{}\n    err := json.Unmarshal([]byte(b), &amp;m)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(m)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/g8d_AsH-pYY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g8d_AsH-pYY</a></p>\n\n<p>Hopefully there aren't any unexpected other elements, but they can be handled similarly.</p>\n\n<p>Here is the second that relies more on Go's internal JSON parsing with the help of <code>json.RawMessage</code>. It makes the same assumptions about the contents of the array. It assumes that any objects will Unmarshal into <code>PublicKey</code> instances and any arrays consist of only <code>MyData</code> instances. I also added how to marshal back into the target JSON for symmetry:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype PublicKey struct {\n    ID  int    `json:\"id\"`\n    Key string `json:\"key\"`\n}\n\ntype MyData struct {\n    ID    string `json:\"id\"`\n    Value int    `json:\"value\"`\n}\n\ntype MixedData struct {\n    Keys   []PublicKey\n    MyData [][]MyData\n}\n\nfunc (md *MixedData) UnmarshalJSON(b []byte) error {\n    md.Keys = []PublicKey{}\n    md.MyData = [][]MyData{}\n    obj := []json.RawMessage{}\n    err := json.Unmarshal([]byte(b), &amp;obj)\n    if err != nil {\n        return err\n    }\n    for _, o := range obj {\n        switch o[0] {\n        case '{':\n            pk := PublicKey{}\n            err := json.Unmarshal(o, &amp;pk)\n            if err != nil {\n                return err\n            }\n            md.Keys = append(md.Keys, pk)\n        case '[':\n            myData := []MyData{}\n            err := json.Unmarshal(o, &amp;myData)\n            if err != nil {\n                return err\n            }\n            md.MyData = append(md.MyData, myData)\n        default:\n            // got something unexpected, handle somehow\n        }\n    }\n    return nil\n}\n\nfunc (md *MixedData) MarshalJSON() ([]byte, error) {\n    out := make([]interface{}, len(md.Keys)+len(md.MyData))\n    i := 0\n    for _, x := range md.Keys {\n        out[i] = x\n        i++\n    }\n    for _, x := range md.MyData {\n        out[i] = x\n        i++\n    }\n    return json.Marshal(out)\n}\n\nfunc main() {\n    b := `[\n  {\n    \"id\": 1,\n    \"key\": \"my_key\"\n  },\n  [\n    {\n      \"id\": \"some_id\",\n      \"value\": 12\n    },\n    {\n      \"id\": \"another_id\",\n      \"value\": 13\n    }\n  ]\n]`\n\n    m := MixedData{}\n    err := json.Unmarshal([]byte(b), &amp;m)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    fmt.Println(m)\n\n    enc := json.NewEncoder(os.Stdout)\n    enc.SetIndent(\"\", \"    \")\n    if err := enc.Encode(m); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ryZzaWKNcN0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ryZzaWKNcN0</a></p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1535038205, "last_edit_date": 1535038205, "creation_date": 1535036831, "answer_id": 51988918, "question_id": 51976181, "link": "https://stackoverflow.com/questions/51976181/how-do-i-json-unmarshal-slice-inside-a-slice/51988918#51988918", "title": "How do I json unmarshal slice inside a slice", "body": "<p>Here's an approach that combines <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a> with the trick of using the default unmarshaler in a type that implements <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> by creating a new temporary type that aliases the target type.</p>\n\n<p>The idea is that we unmarshal the incoming array into a raw message and ensure that the array length is what we expect. Then we unmarshal the individual array elements into the custom struct types using their JSON tag annotations. The end result is that we can unmarshal the <code>PublicKey</code> type in the usual way and the <code>UnmarshalJSON</code> code is not terribly difficult to follow once you understand the tricks.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/s8Bc8Z1Oq4q\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type PublicKey struct {\n  ID   int    `json:\"id\"`\n  Key  string `json:\"key\"`\n  Data []MyData\n}\n\ntype MyData struct {\n  ID    string `json:\"id\"`\n  Value int    `json:\"value\"`\n}\n\nfunc (pk *PublicKey) UnmarshalJSON(bs []byte) error {\n  // Unmarshal into a RawMessage so we can inspect the array length.\n  var rawMessage []json.RawMessage\n  err := json.Unmarshal(bs, &amp;rawMessage)\n  if err != nil {\n    return err\n  }\n  if len(rawMessage) != 2 {\n    return fmt.Errorf(\"expected array of length 2, got %d\", len(rawMessage))\n  }\n\n  // Parse the first object as PublicKey using the default unmarshaler\n  // using a temporary type that is an alias for the target type.\n  type PublicKey2 PublicKey\n  var pk2 PublicKey2\n  err = json.Unmarshal(rawMessage[0], &amp;pk2)\n  if err != nil {\n    return err\n  }\n\n  // Parse the second object as []MyData in the usual way.\n  err = json.Unmarshal(rawMessage[1], &amp;pk2.Data)\n  if err != nil {\n    return err\n  }\n\n  // Finally, assign the aliased object to the target object.\n  *pk = PublicKey(pk2)\n  return nil\n}\n\nfunc main() {\n  var pk PublicKey\n  err := json.Unmarshal([]byte(jsonstr), &amp;pk)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Printf(\"%#v\\n\", pk)\n  // main.PublicKey{ID:1, Key:\"my_key\", Data:[]main.MyData{main.MyData{ID:\"some_id\", Value:12}, main.MyData{ID:\"anorther_id\", Value:13}}}\n\n}\n</code></pre>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1903, "favorite_count": 1, "accepted_answer_id": 51977795, "answer_count": 2, "score": 1, "last_activity_date": 1535038205, "creation_date": 1534978066, "last_edit_date": 1534978584, "question_id": 51976181, "link": "https://stackoverflow.com/questions/51976181/how-do-i-json-unmarshal-slice-inside-a-slice", "title": "How do I json unmarshal slice inside a slice", "body": "<p>I am trying to unmarshal some pretty ugly json but can't figure out how. I have:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype PublicKey struct {\n    ID     int    `json:\"id\"`\n    Key    string `json:\"key\"`\n    MyData []struct {\n        ID    string `json:\"id\"`\n        Value int    `json:\"value\"`\n    }\n}\n\nfunc main() {\n    b := `[\n  {\n    \"id\": 1,\n    \"key\": \"my_key\"\n  },\n  [\n    {\n      \"id\": \"some_id\",\n      \"value\": 12\n    },\n    {\n      \"id\": \"anorther_id\",\n      \"value\": 13\n    }\n  ]\n]`\n\n    var pk []PublicKey\n    err := json.Unmarshal([]byte(b), &amp;pk)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(pk)\n\n}\n</code></pre>\n\n<p>For the result I am getting:</p>\n\n<pre><code>[{1 my_key []} {0  []}]\n</code></pre>\n\n<p>The second slice is empty when it shouldn't be. </p>\n\n<p><strong>EDIT</strong>:\nThe error I get is:</p>\n\n<pre><code>json: cannot unmarshal array into Go struct field PublicKey.key of type main.PublicKey\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cztXOchiiS5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cztXOchiiS5</a></p>\n"}, {"tags": ["go", "jsonschema"], "comments": [{"owner": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535013008, "post_id": 51976000, "comment_id": 90912516, "body": "Hi! I&#39;ll be able to help best if you provide your full JSON Schema and full JSON instance data you&#39;re trying to validate. I&#39;m not familiar with go, but I&#39;ll be able to easily tell you if there is a schema issue or not."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535019450, "post_id": 51976000, "comment_id": 90916319, "body": "@Relequestual I have updated the post with the full schema and also my JSON data. Thank you."}, {"owner": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535020211, "post_id": 51976000, "comment_id": 90916755, "body": "I&#39;ve tested your schema and data using <a href=\"https://www.jsonschemavalidator.net\" rel=\"nofollow noreferrer\">jsonschemavalidator.net</a>. You can remove <code>pattern</code>, <code>default</code>, and <code>examples</code>, they aren&#39;t doing anything here. Also you don&#39;t need to specify the <code>$id</code> for each field. I&#39;m able to make <code>required</code> work as expected. I&#39;m also able to make each field fail validation. I think you may be expecting JSON Schema to do something it is not. Can you provide examples of JSON data you expect to fail validation please?"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535021171, "post_id": 51976000, "comment_id": 90917300, "body": "@Relequestual Updated. I would also like to point out that required does not seem to override min-length rules for parameters when trying the schema validator you provided."}, {"owner": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535021462, "post_id": 51976000, "comment_id": 90917476, "body": "I&#39;m not sure how <code>required</code> would override <code>min-length</code>. Required just means that the object key must be present, and specifies nothing about its value. In terms of your example that should fail: In your schema, &quot;Password&quot; doesn&#39;t have a min length set. &quot;Username&quot; and &quot;DisplayName&quot; fail as expected, min length not met. For &quot;format&quot;, support for these are optional, and depend on each implementation."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535021548, "post_id": 51976000, "comment_id": 90917516, "body": "@Relequestual Indeed. I have printed the JSON schema outputted by my server after all parsing and it is woring fine in the validator. Could schemas be encoding sensitive or some weird crap like that?"}, {"owner": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535021646, "post_id": 51976000, "comment_id": 90917569, "body": "The author of the library you&#39;re using is going to take a look. I&#39;ve discussed this issue with him specifically on our JSON Schema slack. Happy bug hunting! =]"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 8891, "user_id": 89211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d8b4889359df45a8c8099ef16bd96be9?s=128&d=identicon&r=PG", "display_name": "Relequestual", "link": "https://stackoverflow.com/users/89211/relequestual"}, "edited": false, "score": 0, "creation_date": 1535021698, "post_id": 51976000, "comment_id": 90917604, "body": "@Relequestual I appreciate that! Thanks for all of your help."}], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1535040266, "post_id": 51987070, "comment_id": 90929508, "body": "I have printed the value of the schema in the end, and used it in the schema validator and in there it works perfectly fine. I&#39;m thinking there must be some other error here that you can&#39;t easily spot with the bare eye, like an encoding issue or something?"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1535040954, "post_id": 51987070, "comment_id": 90929904, "body": "I made a quick repo for you, if you&#39;d like to try it out yourself: <a href=\"https://github.com/akkelw/gojsonschema_debug\" rel=\"nofollow noreferrer\">github.com/akkelw/gojsonschema_debug</a>"}, {"owner": {"reputation": 61, "user_id": 9328575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7230e3fb2ba1b9151719721dce2afef7?s=128&d=identicon&r=PG&f=1", "display_name": "A_Noniem", "link": "https://stackoverflow.com/users/9328575/a-noniem"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1535108454, "post_id": 51987070, "comment_id": 90955120, "body": "The problem is that you get the values from the form, put them in a struct and then convert that struct to JSON. If all values in the form are empty this will still lead to the following JSON:  <code>{&quot;DisplayName&quot;:&quot;&quot;,&quot;Username&quot;:&quot;&quot;,&quot;Email&quot;:&quot;&quot;,&quot;Password&quot;:&quot;&quot;}</code> This means that all properties are present, they&#39;re just empty, so the required check will pass fine, and the password is actually valid because it passes the regex <code>^(.*)$</code>. You should specify <code>json:omitempty</code> in the struct fields to remove the empty fields."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1535121241, "post_id": 51987070, "comment_id": 90963366, "body": "Thanks for the help on this. I was wondering if that actually meant any difference, and that answered my question."}], "tags": [], "owner": {"reputation": 61, "user_id": 9328575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7230e3fb2ba1b9151719721dce2afef7?s=128&d=identicon&r=PG&f=1", "display_name": "A_Noniem", "link": "https://stackoverflow.com/users/9328575/a-noniem"}, "is_accepted": true, "score": 0, "last_activity_date": 1535031249, "creation_date": 1535031249, "answer_id": 51987070, "question_id": 51976000, "link": "https://stackoverflow.com/questions/51976000/custom-built-json-schema-not-validating-properly/51987070#51987070", "title": "Custom built JSON schema not validating properly", "body": "<p>If I manually load the schema and data using <code>gojsonschema</code> it works as expected. I suspect that since you're loading the schema in a somewhat complicated fashion the schema you put in ends up being something different than what you'd expect, but since your code samples are all HTTP based I can't really test it out myself.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 0, "accepted_answer_id": 51987070, "answer_count": 1, "score": 0, "last_activity_date": 1535106212, "creation_date": 1534976849, "last_edit_date": 1535106212, "question_id": 51976000, "link": "https://stackoverflow.com/questions/51976000/custom-built-json-schema-not-validating-properly", "title": "Custom built JSON schema not validating properly", "body": "<p>I have a custom built JSON schema that only has a few more top-levels. The problem here is that it doesn't validate everything to 100%. For example, it only detects 2 out of 4 fields, and the required fields do not work at all, neither does additionalproperties, etc. I'm using <a href=\"http://github.com/xeipuuv/gojsonschema\" rel=\"nofollow noreferrer\">this library</a> for my json schema.</p>\n\n<pre><code>{\n    \"users\": {\n        \"PUT\": {\n          \"definitions\": {},\n          \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n          \"$id\": \"http://example.com/root.json\",\n          \"type\": \"object\",\n          \"title\": \"The Root Schema\",\n          \"required\": [\n            \"DisplayName\",\n            \"Username\",\n            \"Email\",\n            \"Password\"\n          ],\n          \"properties\": {\n            \"DisplayName\": {\n              \"$id\": \"#/properties/DisplayName\",\n              \"type\": \"string\",\n              \"title\": \"The Displayname Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"\"\n              ],\n              \"minLength\": 3,\n              \"maxLength\": 24,\n              \"pattern\": \"^(.*)$\"\n            },\n            \"Username\": {\n              \"$id\": \"#/properties/Username\",\n              \"type\": \"string\",\n              \"title\": \"The Username Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"\"\n              ],\n              \"minLength\": 3,\n              \"maxLength\": 15,\n              \"pattern\": \"^(.*)$\"\n            },\n            \"Email\": {\n              \"$id\": \"#/properties/Email\",\n              \"type\": \"string\",\n              \"title\": \"The Email Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"\"\n              ],\n              \"minLength\": 7,\n              \"pattern\": \"^(.*)$\",\n              \"format\": \"email\"\n            },\n            \"Password\": {\n              \"$id\": \"#/properties/Password\",\n              \"type\": \"string\",\n              \"title\": \"The Password Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"\"\n              ],\n              \"pattern\": \"^(.*)$\"\n            }\n        },\n        \"additionalProperties\": false\n        }\n    }\n}\n</code></pre>\n\n<p>I'm parsing everything like this:</p>\n\n<pre><code>func Validate(data interface{}, r *http.Request) (interface{}, error) {\n    // Convert the data struct to a readable JSON bytes\n    JSONparams, err := json.Marshal(data)\n    if err != nil {\n        return nil, err\n    }\n\n    // Split URL segments so we know what part of the API they are accessing\n    modules := strings.Split(r.URL.String(), \"/\")\n    modules = modules[(len(modules) - 1):]\n\n    // Read the schema file\n    fileSchema, _ := ioutil.ReadFile(\"config/schema/schema.json\")\n    var object interface{}\n\n    // Unmarshal it so we can choose what schema we specifically want\n    err = json.Unmarshal(fileSchema, &amp;object)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Choose the preferred schema\n    encodedJSON, err := json.Marshal(object.(map[string]interface{})[strings.Join(modules, \"\") + \"s\"].(map[string]interface{})[r.Method])\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Load the JSON schema\n    schema := gojsonschema.NewStringLoader(string(encodedJSON))\n\n    // Load the JSON params\n    document := gojsonschema.NewStringLoader(string(JSONparams))\n\n    // Validate the document\n    result, err := gojsonschema.Validate(schema, document)\n    if err != nil {\n        return nil, err\n    }\n\n    if !result.Valid() {\n        // Map the errors into a new array\n        var errors = make(map[string]string)\n        for _, err := range result.Errors() {\n            errors[err.Field()] = err.Description()\n        }\n\n        // Convert the array to an interface that we can convert to JSON\n        resultMap := map[string]interface{}{\n            \"success\": false,\n            \"result\": map[string]interface{}{},\n            \"errors\": errors,\n        }\n\n        // Convert the interface to a JSON object\n        errorObject, err := json.Marshal(resultMap)\n        if err != nil {\n            return nil, err\n        }\n\n        return errorObject, nil\n    }\n\n    return nil, nil\n}\n\ntype CreateParams struct {\n    DisplayName     string\n    Username        string\n    Email           string\n    Password        string\n}\n\nvar (\n    response interface{}\n    status int = 0\n)\n\nfunc Create(w http.ResponseWriter, r *http.Request) {\n    status = 0\n\n    // Parse the request so we can access the query parameters\n    r.ParseForm()\n\n    // Assign them to the interface variables\n    data := &amp;CreateParams{\n        DisplayName: r.Form.Get(\"DisplayName\"),\n        Username: r.Form.Get(\"Username\"),\n        Email: r.Form.Get(\"Email\"),\n        Password: r.Form.Get(\"Password\"),\n    }\n\n    // Validate the JSON data\n    errors, err := schema.Validate(data, r)\n\n    if err != nil {\n        responseJSON  := map[string]interface{}{\n            \"success\": false,\n            \"result\": map[string]interface{}{},\n        }\n\n        log.Fatal(err.Error())\n\n        response, err = json.Marshal(responseJSON)\n        status = http.StatusInternalServerError\n    }\n\n    // Catch any errors generated by the validator and assign them to the response interface\n    if errors != nil {\n        response = errors\n        status = http.StatusBadRequest\n    }\n\n    // Status has not been set yet, so it's safe to assume that everything went fine\n    if status == 0 {\n        responseJSON  := map[string]interface{}{\n            \"success\": true,\n            \"result\": map[string]interface{} {\n                \"DisplayName\": data.DisplayName,\n                \"Username\": data.Username,\n                \"Email\": data.Email,\n                \"Password\": nil,\n            },\n        }\n\n        response, err = json.Marshal(responseJSON)\n        status = http.StatusOK\n    }\n\n    // We are going to respond with JSON, so set the appropriate header\n    w.Header().Set(\"Content-Type\", \"application/json\")\n\n    // Write the header and the response\n    w.WriteHeader(status)\n    w.Write(response.([]byte))\n}\n</code></pre>\n\n<p>The reason to why I'm doing it like this is I'm building a REST API and if <code>api/auth/user</code> gets a PUT request, I want to be able to specify the data requirements for specifically the \"users\" parts with the PUT method.</p>\n\n<p>Any idea how this can be achieved?</p>\n\n<p><strong>EDIT:</strong>\nMy json data:</p>\n\n<pre><code>{\n  \"DisplayName\": \"1234\",\n  \"Username\": \"1234\",\n  \"Email\": \"test@gmail.com\",\n  \"Password\": \"123456\"\n}\n</code></pre>\n\n<p><strong>EDIT 2:</strong>\nThis data should fail with the schema.</p>\n\n<pre><code>{\n  \"DisplayName\": \"1\", // min length is 3\n  \"Username\": \"\", // this field is required but is empty here\n  \"Email\": \"testgmail.com\", // not following the email format\n  \"Password\": \"123456111111111111111111111111111111111111111111111\" // too long\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 2, "creation_date": 1534977638, "post_id": 51975902, "comment_id": 90902540, "body": "Please edit the source code into the question."}], "answers": [{"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 3, "last_activity_date": 1534977791, "creation_date": 1534977791, "answer_id": 51976135, "question_id": 51975902, "link": "https://stackoverflow.com/questions/51975902/bytes-string-vs-bytes-bytes-in-go/51976135#51976135", "title": "bytes.String() vs bytes.Bytes() in Go", "body": "<p>The difference is that <code>bytes.Buffer.String</code> copies the memory, while <code>bytes.Buffer.Bytes</code> does not. Quoting the <a href=\"https://godoc.org/bytes#Buffer.Bytes\" rel=\"nofollow noreferrer\">documentation</a>,</p>\n\n<blockquote>\n  <p>The slice is valid for use only until the next buffer modification (that is, only until the next call to a method like Read, Write, Reset, or Truncate).</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": true, "score": 5, "last_activity_date": 1534977807, "creation_date": 1534977807, "answer_id": 51976138, "question_id": 51975902, "link": "https://stackoverflow.com/questions/51975902/bytes-string-vs-bytes-bytes-in-go/51976138#51976138", "title": "bytes.String() vs bytes.Bytes() in Go", "body": "<p>In the string version, </p>\n\n<pre><code>parts[i] = buf.String()\n</code></pre>\n\n<p>sets <code>parts[i]</code> to a new string every time.  In the <code>[]byte</code> version,</p>\n\n<pre><code>parts[i] = buf.Bytes()\n</code></pre>\n\n<p>sets <code>parts[i]</code> to a byte slice backed by the same array every time.  The contents of the backing array are the same for all three slices, but the lengths match the length when created, which is why all three slices show the same content but cut off at different places.</p>\n\n<p>You could replace the byte slice line</p>\n\n<pre><code>parts[i] = buf.Bytes()\n</code></pre>\n\n<p>with something like this:</p>\n\n<pre><code>bb := buf.Bytes()\nb := make([]byte, len(bb))\ncopy(b, bb)\nparts[i] = b\n</code></pre>\n\n<p>in order to get the behavior to match the string version.  But the string version is easier and better matches what you seem to be trying to do.</p>\n"}], "owner": {"reputation": 313, "user_id": 6650701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26fbd263ecf4554fd90857ecd55d207?s=128&d=identicon&r=PG&f=1", "display_name": "stef", "link": "https://stackoverflow.com/users/6650701/stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 51976138, "answer_count": 2, "score": 0, "last_activity_date": 1535034098, "creation_date": 1534976194, "last_edit_date": 1535034098, "question_id": 51975902, "link": "https://stackoverflow.com/questions/51975902/bytes-string-vs-bytes-bytes-in-go", "title": "bytes.String() vs bytes.Bytes() in Go", "body": "<p>Consider a text file like this:</p>\n\n<pre><code>Some text\nhere.\n---\nMore text\nanother line.\n---\nThird part of text.\n</code></pre>\n\n<p>I want to split it into three parts, divided by the <code>---</code> separator. The parts should be stored in a map.</p>\n\n<p>Now, the exact same programs with different types.</p>\n\n<p>When I use <code>string</code>, everything works fine:</p>\n\n<pre><code>KEY: 0\nSome text\nhere.\nKEY: 1\nMore text\nanother line.\nKEY: 2\nThird part of text.\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IcGdoUNcTEe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IcGdoUNcTEe</a></p>\n\n<p>When I use <code>[]byte</code>, things gets messed up:</p>\n\n<pre><code>KEY: 0\nThird part of teKEY: 1\nThird part of text.\nne.\nKEY: 2\nThird part of text.\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jqLhCrqsvOs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jqLhCrqsvOs</a></p>\n\n<p>Why?</p>\n\n<hr>\n\n<p>Program 1 (<code>string</code>):</p>\n\n<pre><code>func main() {\n    parts := parseParts([]byte(input))\n\n    for k, v := range parts {\n        fmt.Printf(\"KEY: %d\\n%s\", k, v)\n    }\n}\n\nfunc parseParts(input []byte) map[int]string {\n    parts := map[int]string{}\n    s := bufio.NewScanner(bytes.NewReader(input))\n    buf := bytes.Buffer{}\n    i := 0\n    for s.Scan() {\n        if s.Text() == \"---\" {\n            parts[i] = buf.String()\n            buf.Reset()\n            i++\n            continue\n        }\n        buf.Write(s.Bytes())\n        buf.WriteString(\"\\n\")\n    }\n    parts[i] = buf.String()\n    return parts\n}\n</code></pre>\n\n<hr>\n\n<p>Program 2 (<code>[]byte</code>):</p>\n\n<pre><code>func main() {\n    parts := parseParts([]byte(input))\n\n    for k, v := range parts {\n        fmt.Printf(\"KEY: %d\\n%s\", k, v)\n    }\n}\n\nfunc parseParts(input []byte) map[int]string {\n    parts := map[int]string{}\n    s := bufio.NewScanner(bytes.NewReader(input))\n    buf := bytes.Buffer{}\n    i := 0\n    for s.Scan() {\n        if s.Text() == \"---\" {\n            parts[i] = buf.String()\n            buf.Reset()\n            i++\n            continue\n        }\n        buf.Write(s.Bytes())\n        buf.WriteString(\"\\n\")\n    }\n    parts[i] = buf.String()\n    return parts\n}\n</code></pre>\n"}, {"tags": ["go", "hugo"], "owner": {"reputation": 1809, "user_id": 1338852, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/i7gSV.jpg?s=128&g=1", "display_name": "Edu Ruiz", "link": "https://stackoverflow.com/users/1338852/edu-ruiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1534973095, "creation_date": 1534973095, "question_id": 51975363, "link": "https://stackoverflow.com/questions/51975363/use-uniq-inside-range-on-hugo-template", "title": "Use uniq inside range on hugo template", "body": "<p>I have a sorted range</p>\n\n<pre><code>{{ range sort . \"id\" \"asc\" }}\n    {{ .topic.name }}\n{{ end }}\n</code></pre>\n\n<p>but <code>.topic.name</code> has a lot of repeated names, and I want to get show only one of each.</p>\n\n<p>I find the <a href=\"https://gohugo.io/functions/uniq/\" rel=\"nofollow noreferrer\">uniq</a> function on Hugo, but can't find the right syntax to use it.</p>\n\n<p>I had tried:</p>\n\n<pre><code>{{ range sort . \"id\" \"asc\" }}\n    {{ slice .topic.name | uniq }}\n{{ end }}\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>{{ range sort . \"id\" \"asc\" }}\n    {{ uniq (slice .topic.name) }}\n{{ end }}\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>{{ range sort . \"id\" \"asc\" }}\n    {{ uniq .topic.name }}\n{{ end }}\n</code></pre>\n\n<p>And some other variations. Also searched in the examples of Hugo documentation and repository examples with no luck.</p>\n"}, {"tags": ["go", "google-admin-sdk"], "comments": [{"owner": {"reputation": 8677, "user_id": 9337071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52afdb783a619060eb2b0c0cb5766d3?s=128&d=identicon&r=PG&f=1", "display_name": "tehhowch", "link": "https://stackoverflow.com/users/9337071/tehhowch"}, "edited": false, "score": 2, "creation_date": 1534973877, "post_id": 51975329, "comment_id": 90901424, "body": "&quot;we use this code, there is a problem&quot; ... so show the code and the specifics that result in the error? How can we determine you are not already doing what we will recommend you do, if you do not show how you use the resources?"}, {"owner": {"reputation": 1, "user_id": 10261821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UWFiX9PAFzY/AAAAAAAAAAI/AAAAAAAAAAA/8C2c9ncUEu0/photo.jpg?sz=128", "display_name": "Chrome Book", "link": "https://stackoverflow.com/users/10261821/chrome-book"}, "reply_to_user": {"reputation": 8677, "user_id": 9337071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52afdb783a619060eb2b0c0cb5766d3?s=128&d=identicon&r=PG&f=1", "display_name": "tehhowch", "link": "https://stackoverflow.com/users/9337071/tehhowch"}, "edited": false, "score": 0, "creation_date": 1534975585, "post_id": 51975329, "comment_id": 90902030, "body": "After page 1 I am sleeping for 70 minutes to simulate the issue by renewing access token and using old page token"}, {"owner": {"reputation": 8677, "user_id": 9337071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52afdb783a619060eb2b0c0cb5766d3?s=128&d=identicon&r=PG&f=1", "display_name": "tehhowch", "link": "https://stackoverflow.com/users/9337071/tehhowch"}, "edited": false, "score": 0, "creation_date": 1534979230, "post_id": 51975329, "comment_id": 90902887, "body": "This doesn&#39;t look like JavaScript / Google Apps Script code (perhaps <code>Go</code>?). please make sure you&#39;ve tagged your question correctly. It looks like you could tag at least 1 client library, in addition to the language and the admin sdk..."}], "owner": {"reputation": 1, "user_id": 10261821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UWFiX9PAFzY/AAAAAAAAAAI/AAAAAAAAAAA/8C2c9ncUEu0/photo.jpg?sz=128", "display_name": "Chrome Book", "link": "https://stackoverflow.com/users/10261821/chrome-book"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535009257, "creation_date": 1534972903, "last_edit_date": 1535009257, "question_id": 51975329, "link": "https://stackoverflow.com/questions/51975329/chromeosdevices-list-api-error-with-page-token", "title": "Chromeosdevices: list API error with page token", "body": "<p>We are trying to fetch ChromeOS end points. We use page token to fetch the next page. When the token expires, we renew the token and try to resume polling. But we get error saying page token is invalid.</p>\n\n<p>If we do not use page token, we get back page 0.</p>\n\n<p>So question is how do we resume polling using renewed page token?</p>\n\n<pre><code>srv, err := admin.New(client)\nif err != nil {\n    log.Fatalf(\"Unable to retrieve directory Client %v\", err)\n}\n\npageID := 1\npageToken := \"\"\nsleep := false\nfor {\n    log.Printf(\"Fetch page: %d\", pageID)\n\n    srv := srv.Chromeosdevices.List(\"my_customer\").MaxResults(1).Projection(\"FULL\")\n    if pageToken != \"\" {\n        srv = srv.PageToken(pageToken)\n    }\n    r, err := srv.Do()\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve devices: %v\", err)\n    }\n\n    if len(r.Chromeosdevices) == 0 {\n        log.Printf(\"No devices found\")\n        break\n    }\n\n    for _, u := range r.Chromeosdevices {\n        log.Printf(\"Page(%d) MAc: %s Model: %s\", pageID, u.MacAddress, u.Model)\n    }\n\n    time.Sleep(3 * time.Second)\n\n    pageToken = r.NextPageToken\n\n    if pageToken == \"\" {\n        log.Printf(\"Completed with all pages\")\n        break\n    }\n\n    pageID += 1\n\n    if !sleep {\n        log.Printf(\"Sleeping for 70 minutes\")\n        time.Sleep(4200 * time.Second)\n        sleep = true\n        log.Printf(\"Done Sleeping for 70 minutes\")\n    }\n</code></pre>\n"}, {"tags": ["arrays", "string", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535009444, "post_id": 51974735, "comment_id": 90910549, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37351022/golang-mixed-assignation-and-declaration\">Golang mixed assignation and declaration</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1534970553, "creation_date": 1534970553, "answer_id": 51974809, "question_id": 51974735, "link": "https://stackoverflow.com/questions/51974735/golang-string-is-empty/51974809#51974809", "title": "GoLang String is empty", "body": "<p>In <code>insert</code> you have:</p>\n\n<pre><code>            Fields := make([]string, num)\n            Values := make([]string, num)\n</code></pre>\n\n<p>This defines two <em>new, local</em> variables, which \"shadow\" the global variables. Remember, <code>:=</code> <em>defines and assigns</em> a variable in one operation. To get the behavior you want, just assign to your globals instead of redefining them:</p>\n\n<pre><code>            Fields = make([]string, num)\n            Values = make([]string, num)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10146782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/158b8c2d05e18b6082b0f873ab311521?s=128&d=identicon&r=PG&f=1", "display_name": "Sucheta", "link": "https://stackoverflow.com/users/10146782/sucheta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 51974809, "answer_count": 1, "score": -3, "last_activity_date": 1534970553, "creation_date": 1534970218, "last_edit_date": 1534970537, "question_id": 51974735, "link": "https://stackoverflow.com/questions/51974735/golang-string-is-empty", "title": "GoLang String is empty", "body": "<p>Following is my code;</p>\n\n<p>I am passing Field and Values to a method called <code>insert()</code>, where the values are populated in the string array <code>Fields[]</code>  and <code>Values[]</code>  respectively.\nThe string array variables <code>Fields[]</code>  and <code>Values[]</code> are getting populated in the <code>insert()</code> . But when I print the same in the main method, they are empty.\nI want the values to be retained.</p>\n\n<p>How do I achieve this?\nKindly let me know.</p>\n\n<p>Thanks</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"strconv\"\n)\n\nvar Field string = \"text,text,text,text\"\nvar Value string = \"1,2,3,4\"\nvar num int = 4\nvar Fields[]  string\nvar Values[]  string\n\n\nfunc main() {\n\n    insert(Field, Value)\n\n\n    fmt.Println(\"Fields from main():\", Fields)\n    fmt.Println(\"Values from main():\", Values)\n\n\n\n}\n\nfunc insert(Field string, Value string){\n    if Field != \"\" &amp;&amp; Value != \"\" {\n        c := 0\n                Fields := make([]string, num)\n                Values := make([]string, num)\n\n        field := strings.Split(Field, \",\")\n        value := strings.Split(Value, \",\")\n\n        for i := range field {\n            Fields[c] = field[i]\n            c = c + 1\n                }\n                c = 0\n                for j := range value {\n                        Values[c] = value[j]\n            c = c + 1\n                }\n\n        fmt.Println(\"Fields from insert():\", Fields)\n        fmt.Println(\"Values from insert():\", Values)\n\n        }   \n}\n</code></pre>\n\n<p>Following is the output;</p>\n\n<pre><code>Fields from insert(): [text text text text]\nValues from insert(): [1 2 3 4]\nFields from main(): []\nValues from main(): []\n</code></pre>\n"}, {"tags": ["go", "hugo", "toml"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1534969675, "post_id": 51974423, "comment_id": 90899709, "body": "We need to see the code."}], "answers": [{"comments": [{"owner": {"reputation": 134, "user_id": 5187694, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/plKB0.jpg?s=128&g=1", "display_name": "Pranav Sharma", "link": "https://stackoverflow.com/users/5187694/pranav-sharma"}, "edited": false, "score": 2, "creation_date": 1564657978, "post_id": 51992360, "comment_id": 101107863, "body": "This post actually helped on my main website, as I had forgotten to remove the draft boolean. Didn&#39;t know about the default.md thing though, might come in handy."}], "tags": [], "owner": {"reputation": 1845, "user_id": 622883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f82bed7b3272eb6afab070efeb94ba34?s=128&d=identicon&r=PG", "display_name": "bornfree", "link": "https://stackoverflow.com/users/622883/bornfree"}, "is_accepted": false, "score": 13, "last_activity_date": 1535049745, "creation_date": 1535049745, "answer_id": 51992360, "question_id": 51974423, "link": "https://stackoverflow.com/questions/51974423/hugo-posts-not-displaying/51992360#51992360", "title": "Hugo Posts not displaying", "body": "<p>In your content/posts/, look for the field <code>draft</code> in the front matter(should be at the top of every file in posts folder). The front matter should be similar to</p>\n\n<blockquote>\n  <p>title: \"My First Post\"</p>\n  \n  <p>date: 2018-08-14T20:08:02+05:30</p>\n  \n  <p>draft: true</p>\n</blockquote>\n\n<p>Replace <code>true</code> with <code>false</code> for <code>draft</code>. Now run <code>hugo server</code> and check. You should be able to see your post now.</p>\n\n<p>It seems by default, the posts that are being created in your content folder have <code>draft</code> set as <code>true</code>. hugo will not show these as web pages by default as these are drafts and not ready for publishing yet. To show these drafts you have to pass <code>-D</code> flag to <code>hugo server</code>, which is why you are able to see your posts on running this command.</p>\n\n<p>If you want to set <code>draft</code> as <code>false</code> for every newly created post, you will have to set <code>draft</code> field in <code>archetype/default.md</code> as <code>false</code>.</p>\n"}], "owner": {"reputation": 1466, "user_id": 1708393, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/99d00ea444a0e95485798d8c1f9d76dd?s=128&d=identicon&r=PG&f=1", "display_name": "Muli", "link": "https://stackoverflow.com/users/1708393/muli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3961, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1562512445, "creation_date": 1534968758, "question_id": 51974423, "link": "https://stackoverflow.com/questions/51974423/hugo-posts-not-displaying", "title": "Hugo Posts not displaying", "body": "<p>Using <a href=\"https://gohugo.io/getting-started/quick-start/\" rel=\"nofollow noreferrer\">Hugo Quickstart</a>, I was able to up and running set up a blog and even wrote a post. When I run either <code>hugo server -D</code> or <code>hugo server -D --watch --verbose</code> I can see my post on localhost. But when I run only <code>hugo server</code> my blog loads only the Title and no posts. I have generareted the necessary files using <code>hugo server</code>. \nWhat should I do such that when I run <code>hugo server</code> everything loads? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "edited": false, "score": 0, "creation_date": 1534967062, "post_id": 51974004, "comment_id": 90898563, "body": "Have you tried using <a href=\"https://github.com/jessevdk/go-assets\" rel=\"nofollow noreferrer\">go-assets</a>? They have <a href=\"https://github.com/gin-gonic/gin#build-a-single-binary-with-templates\" rel=\"nofollow noreferrer\">an example</a> for it in gin repository."}], "answers": [{"tags": [], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "is_accepted": true, "score": 1, "last_activity_date": 1534982669, "creation_date": 1534982669, "answer_id": 51976702, "question_id": 51974004, "link": "https://stackoverflow.com/questions/51974004/how-to-use-go-bindata-with-gin/51976702#51976702", "title": "How to use go-bindata with Gin?", "body": "<p>Basically you would need to roll your own static file handler using <code>go-bindata</code>...</p>\n\n<pre><code>func bindataStaticHandler(c *gin.Context) {\n   path := c.Param(\"filepath\")\n   data, err := Asset(\"pub/style/foo.css\")\n   if err != nil {\n    // Asset was not found.\n   }\n   // Write asset\n   c.Writer.Write(data)\n   // Handle errors here too and cache headers\n}\n</code></pre>\n\n<p>And you declare the route (after creating a gin engine)</p>\n\n<pre><code>router.GET(\"/static/*filepath\", bindataStaticHandler)\n</code></pre>\n\n<p>This is something very rudimentary but just to show you how you would do it</p>\n"}], "owner": {"reputation": 289, "user_id": 4640107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9de16c66a9eea778d4386419798e795?s=128&d=identicon&r=PG&f=1", "display_name": "Alan42", "link": "https://stackoverflow.com/users/4640107/alan42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 51976702, "answer_count": 1, "score": -1, "last_activity_date": 1534982669, "creation_date": 1534966635, "question_id": 51974004, "link": "https://stackoverflow.com/questions/51974004/how-to-use-go-bindata-with-gin", "title": "How to use go-bindata with Gin?", "body": "<p>I am going to package the static file into an Golang executable file. How to use go-bindata (or go-bindata-assetfs) in Gin? There are missing examples on the Internet.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1534964491, "post_id": 51973415, "comment_id": 90897410, "body": "As a first step, try switching to <a href=\"https://godoc.org/github.com/360EntSecGroup-Skylar/excelize#File.Rows\" rel=\"nofollow noreferrer\"><code>File.Rows</code></a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1534964509, "post_id": 51973415, "comment_id": 90897413, "body": "&quot;Is there a faster way to load this data ?&quot; Maybe? Have you looked at alternative libraries? Have you profiled the program to see where time is being spent? If most of the time is in reading the file from disk then likely the only way to make it faster is to use a faster disk."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1534965071, "post_id": 51973415, "comment_id": 90897667, "body": "If you&#39;re going to load more than 10 million cells regularly, you should really consider <b>not</b> using xls format to store your data. For the sake of common sense, do convert your data into some format close to your memory representation. And if I/O read is the bottleneck, compress your data to reduce the data needed to be read."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1534965658, "post_id": 51973415, "comment_id": 90897927, "body": "Assuming your data are all float32s this is about 45 MB of data. With the right data structure this should take &lt; 1 second to load on your machine. I agree with icza that you should store your data in a different file format and maybe import it once from .xls, convert it to your own format and when you are done (we do not know what exactly it is that you do with the data) you can still export it back to .xls."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1534966093, "post_id": 51973415, "comment_id": 90898107, "body": "thanks Icza and @gonutz, do you have any other file format to suggest ? I don&#39;t need to export it back to .xls, I output charts."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1534966602, "post_id": 51973415, "comment_id": 90898349, "body": "thanks @TimCooper, I will try file.rows and revert"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1534967027, "post_id": 51973415, "comment_id": 90898545, "body": "If it is really just all numbers of the same type, then just write the width and height as two integers, then in one go write all the data back-to-back, either row-wise or column-wise, what you prefer. That is the simplest format I can imagine and it will be fast."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1534967250, "post_id": 51973415, "comment_id": 90898636, "body": "If performance is critical, consider using a custom binary format, and for implementation consider using <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\"><code>encoding&#47;binary</code></a> and <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>encoding&#47;gob</code></a>. You can easily wrap such implementation in a compressed stream too."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1535485000, "post_id": 51973415, "comment_id": 91080712, "body": "Check to see if you really need the whole thing in memory.  If you know that you are only summing columns in a row for instance, you don&#39;t need to hold more than one row in memory at any given time.  In other words, send the data through counters.  If you can stream data like this, then you may find order-of-magnitude speed ups.    Putting the whole data structure is sometimes necessary, but only if the order in which you traverse it forces you to do so.  Note that uploading raw files should be at least 50MB/s in throughput."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "reply_to_user": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1535485676, "post_id": 51973415, "comment_id": 91080999, "body": "thanks @Rob, I really need all rows and most columns in memory. But all good in terms of performance, it&#39;s much faster that way than before."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1535490217, "post_id": 51973415, "comment_id": 91082747, "body": "Tim&#39;s suggestion to use File.Rows appears to not just blindly pull the whole thing into memory.  If you have an iterator with a Next(), it&#39;s unknown how much data it had to pull into memory (a good thing): &quot;func (rows *Rows) Next() bool&quot;.  If it returned &quot;[]Row&quot;, then it has to have it in memory.  I would add to gonutz advice: stored as array of rows (with columns for that row next to each other) is best for write, and stored as array of columns (with rows for that column next to each other) is best for read (when doing stats over whole columns etc). I would hope excel lib does it for you."}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 3, "last_activity_date": 1534968660, "creation_date": 1534968660, "answer_id": 51974411, "question_id": 51973415, "link": "https://stackoverflow.com/questions/51973415/fastest-way-to-load-data-in-go/51974411#51974411", "title": "Fastest way to load data in Go", "body": "<p>As suggested in the comments, instead of using the XLS format, use a custom, fast data format for reading and writing your table.</p>\n\n<p>In the most basic case, just write the number of columns and rows to a binary file, then write all the data in one go. This will be very fast, I have created a little example <a href=\"https://play.golang.org/p/Dqvm9LRnc0f\" rel=\"nofollow noreferrer\">here</a> which just writes 300.000 by 40 float32s to a file and reads them back. On my machine this takes about 400ms and 250ms (notice that the file is hot in cache after writing it, may take longer on initial read).</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"os\"\n\n    \"github.com/gonutz/tic\"\n)\n\nfunc main() {\n    const (\n        rowCount = 300000\n        colCount = 40\n    )\n    values := make([]float32, rowCount*colCount)\n    func() {\n        defer tic.Toc()(\"write\")\n        f, _ := os.Create(\"file\")\n        defer f.Close()\n        binary.Write(f, binary.LittleEndian, int64(rowCount))\n        binary.Write(f, binary.LittleEndian, int64(colCount))\n        check(binary.Write(f, binary.LittleEndian, values))\n    }()\n    func() {\n        defer tic.Toc()(\"read\")\n        f, _ := os.Open(\"file\")\n        defer f.Close()\n        var rows, cols int64\n        binary.Read(f, binary.LittleEndian, &amp;rows)\n        binary.Read(f, binary.LittleEndian, &amp;cols)\n        vals := make([]float32, rows*cols)\n        check(binary.Read(f, binary.LittleEndian, vals))\n    }()\n}\n\nfunc check(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 51974411, "answer_count": 1, "score": 3, "last_activity_date": 1535483478, "creation_date": 1534964035, "last_edit_date": 1535483478, "question_id": 51973415, "link": "https://stackoverflow.com/questions/51973415/fastest-way-to-load-data-in-go", "title": "Fastest way to load data in Go", "body": "<p>I need to regularly load over <code>300'000 rows x 78 columns</code> of data into my Go program.</p>\n\n<p><strong>Currently I use (<code>import github.com/360EntSecGroup-Skylar/excelize</code>):</strong></p>\n\n<pre><code>xlsx, err := excelize.OpenFile(\"/media/test snaps.xlsm\")\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\n//read all rows into df\ndf := xlsx.GetRows(\"data\")\n</code></pre>\n\n<p>It takes about <em>4</em> minutes on a decent PC using Samsung 960 EVO Series - M.2 Internal SSD.</p>\n\n<p>Is there a faster way to load this data? Currently it takes me more time to read the data than processing it. I'm also opened to other file formats.</p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534964755, "post_id": 51972759, "comment_id": 90897524, "body": "On a 3GHz machine, one clock cycle is about 0.3ns. Your benchmark results are likely inaccurate and, like all microbenchmarks like this, highly influenced by factors outside the code being measured (eg the setup and loop iteration)."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534967407, "post_id": 51972759, "comment_id": 90898718, "body": "Hmm, but isn\u2019t the idea of the benchmark that it\u2019ll do millions of operations so that there won\u2019t be much noise in the average measurement? Every time I run the bench it\u2019s at least twice as slow for method 2"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534967602, "post_id": 51972759, "comment_id": 90898792, "body": "Because the compiler generates different machine code. Nothing more to say here. Might change in the next compiler version and be different in the one after that again."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1534968195, "post_id": 51974267, "comment_id": 90899038, "body": "&quot;It should be obvious&quot; is not a very helpful explanation."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 1, "creation_date": 1534968320, "post_id": 51974267, "comment_id": 90899086, "body": "It\u2019s not obvious to me what is going on. What bounds check is being eliminated and why?"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1534982172, "post_id": 51974267, "comment_id": 90903414, "body": "I guess he means that if you first do an access on the higher indice, the compiler will skip bound check on next access on lower indice.  Its probably an optimisation the compiler can easily do. TIL"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": -1, "last_activity_date": 1534969612, "last_edit_date": 1534969612, "creation_date": 1534967992, "answer_id": 51974267, "question_id": 51972759, "link": "https://stackoverflow.com/questions/51972759/go-bitwise-operation-performance-mystery/51974267#51974267", "title": "Go bitwise operation performance mystery", "body": "<p>There is no mystery. Optimization!</p>\n\n<pre><code>package blah\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"testing\"\n)\n\nfunc BenchmarkByteConversionLeast(t *testing.B) {\n    var i uint32 = 3419234848\n    buf := new(bytes.Buffer)\n    _ = binary.Write(buf, binary.BigEndian, i)\n    b := buf.Bytes()\n\n    for n := 0; n &lt; t.N; n++ {\n        // Start with least significant bit: 0.27 nanos\n        value := uint32(b[3]) | uint32(b[2])&lt;&lt;8 | uint32(b[2])&lt;&lt;16 | uint32(b[0])&lt;&lt;24\n        _ = value\n    }\n}\n\nfunc BenchmarkByteConversionMost(t *testing.B) {\n    var i uint32 = 3419234848\n    buf := new(bytes.Buffer)\n    _ = binary.Write(buf, binary.BigEndian, i)\n    b := buf.Bytes()\n\n    for n := 0; n &lt; t.N; n++ {\n        // Start with most significant bit: 0.68 nanos\n        value := uint32(b[0])&lt;&lt;24 | uint32(b[1])&lt;&lt;16 | uint32(b[2])&lt;&lt;8 | uint32(b[3])\n        _ = value\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>go test silly_test.go -bench=.\ngoos: linux\ngoarch: amd64\nBenchmarkByteConversionLeast-4      2000000000           0.72 ns/op\nBenchmarkByteConversionMost-4       2000000000           1.80 ns/op\n</code></pre>\n\n<p>It should be obvious. Bounds check elimination.</p>\n\n<hr>\n\n<p>Just use common sense. If you check the array bounds for indices 3, 2, 1, and 0 you can stop checking at 3 since, obviously, 2, 1, and 0 will also be valid. If you check the array bounds for indices 0, 1, 2, and 3 you have to check the bounds for them all. One bounds check versus four bounds checks.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Bounds_checking\" rel=\"nofollow noreferrer\">Wikipedia: Bounds checking</a></p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Bounds-checking_elimination\" rel=\"nofollow noreferrer\">Wikipedia: Bounds-checking elimination</a></p>\n\n<hr>\n\n<p>You should also be reading good code, like the Go standard library. For example,</p>\n\n<pre><code>func (littleEndian) PutUint64(b []byte, v uint64) {\n    _ = b[7] // early bounds check to guarantee safety of writes below\n    b[0] = byte(v)\n    b[1] = byte(v &gt;&gt; 8)\n    b[2] = byte(v &gt;&gt; 16)\n    b[3] = byte(v &gt;&gt; 24)\n    b[4] = byte(v &gt;&gt; 32)\n    b[5] = byte(v &gt;&gt; 40)\n    b[6] = byte(v &gt;&gt; 48)\n    b[7] = byte(v &gt;&gt; 56)\n}\n</code></pre>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 51974267, "answer_count": 1, "score": -1, "last_activity_date": 1534969612, "creation_date": 1534961281, "question_id": 51972759, "link": "https://stackoverflow.com/questions/51972759/go-bitwise-operation-performance-mystery", "title": "Go bitwise operation performance mystery", "body": "<p>While benchmarking the performance of conversion from byte arrays to <code>uint32</code>s, I noticed that the conversion ran faster when starting with the least significant bits:</p>\n\n<pre><code>package blah\n\nimport (\n    \"testing\"\n    \"encoding/binary\"\n    \"bytes\"\n)\n\nfunc BenchmarkByteConversion(t *testing.B) {\n    var i uint32 = 3419234848\n    buf := new(bytes.Buffer)\n    _ = binary.Write(buf, binary.BigEndian, i)\n    b := buf.Bytes()\n\n    for n := 0; n &lt; t.N; n++ {\n        // Start with least significant bit: 0.27 nanos\n        value := uint32(b[3]) | uint32(b[2])&lt;&lt;8 | uint32(b[2])&lt;&lt;16 | uint32(b[0])&lt;&lt;24\n\n        // Start with most significant bit: 0.68 nanos\n        // value := uint32(b[0])&lt;&lt;24 | uint32(b[1])&lt;&lt;16 | uint32(b[2])&lt;&lt;8 | uint32(b[3])\n        _ = value\n    }\n}\n</code></pre>\n\n<p>When I run <code>go test -bench=.</code>, I get 0.27 nanos per iteration when computing <code>value</code> the first way, and 0.68 nanos per iteration when computing <code>value</code> the second way. Why is it twice as fast to start with the least significant bits when <code>|</code>ing together numbers?</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1534959119, "post_id": 51971955, "comment_id": 90894980, "body": "Do your &quot;simple&quot; commands also fail if you add an option to them? Say, run <code>who --login</code> or <code>ls -1</code>\u2014do they work or fail?"}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1534960861, "post_id": 51971955, "comment_id": 90895790, "body": "They do indeed work with options, even if I pass them in through my webform or directly through Session.Run()"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1534962583, "post_id": 51971955, "comment_id": 90896543, "body": "add a destination for session.Stderr too. That might give more clues. might be os.Stderr."}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "edited": false, "score": 0, "creation_date": 1534962723, "post_id": 51971955, "comment_id": 90896597, "body": "unfortunately stderr just prints 0."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534963042, "post_id": 51971955, "comment_id": 90896732, "body": ":! could it be related to sudo ? Could it be that stdin not being set something weird occurs ? Could it be that it requires absolute path of the bin program ? could it be related to inputData having blankspace or so ?"}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "edited": false, "score": 0, "creation_date": 1534963160, "post_id": 51971955, "comment_id": 90896786, "body": "Touche! It seems to be sudo, unfortunately I need to use it on the servers I&#39;m running this against, I now wonder what would be stopping that.  I have noticed I do not see the commands I&#39;m running in that user&#39;s history regardless, so now I&#39;m wondering how its logging in and performing these commands."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534967281, "post_id": 51971955, "comment_id": 90898653, "body": "although, seems weird you have no output on stderr. I would really try to setup stdin. Besides, consider the system environment setup, consider if this is a password less user or not. If not, you ll have to deal with the sudo challenge."}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "edited": false, "score": 0, "creation_date": 1534967409, "post_id": 51971955, "comment_id": 90898720, "body": "I&#39;ll attempt to possibly send it through stdin instead, luckily a password isn&#39;t necessary to use sudo with the commands I&#39;m sending.  Thanks!"}], "owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1534957789, "creation_date": 1534957789, "question_id": 51971955, "link": "https://stackoverflow.com/questions/51971955/golang-ssh-commands-with-slashes-seem-to-instantly-fail", "title": "GoLang SSH Commands with slashes seem to instantly fail", "body": "<p>I'm currently writing an app that given a parameter, will run a command on a remote server.  I'm using the /x/crypto/ssh package, everything seems to go smoothly if I use one liner commands like \"who\" or \"ls\", however, if I run a more complex command such as:</p>\n\n<p>\"grep SOMEDATA /var/log/logfile.log\"</p>\n\n<p>the program immediately exits and the command execution line with nothing more than \"process exited with status 1\", and I don't get anything else back.  </p>\n\n<p>If I check the history of the user I'm having it SSH into the remote system as, I do not see the command running at all.</p>\n\n<p>Has anyone else run into this type of issue before?  Here's a snippet of the code I'm using to execute this (sensitive data removed of course):</p>\n\n<pre><code>func returnData(w http.ResponseWriter, r *http.Request) {\nvar b bytes.Buffer\nhostKey, err := getHostKey(\"SERVERNAME\")\nif err != nil {\n    log.Fatalln(err)\n}\n\nerr = r.ParseForm()\nif err != nil {\n    log.Fatalln(err)\n}\n\nconfig := &amp;ssh.ClientConfig{\n    User: \"USERNAME\",\n    Auth: []ssh.AuthMethod{\n        ssh.Password(\"TESTPASS\"),\n    },\n    HostKeyCallback: ssh.FixedHostKey(hostKey),\n}\n\nclient, err := ssh.Dial(\"tcp\", \"SERVERNAME:22\", config)\nif err != nil {\n    log.Fatalln(\"Creating Client Failed: \", err)\n}\n\nsession, err := client.NewSession()\nif err != nil {\n    log.Fatalln(\"Creating new Session Failed: \", err)\n}\n\nsession.Stdout = &amp;b\ninputData := r.Form[\"fname\"][0]\ncmdExecute := fmt.Sprintf(`sudo grep %v /var/log/logfile.log`, inputData)\nlog.Println(cmdExecute)\nif err := session.Run(cmdExecute); err != nil {\n    log.Fatalln(\"Getting Data From session Failed: \", err)\n    log.Fatalln(b.String())\n}\n//log.Println(hostKey)\ndefer session.Close()\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534954812, "post_id": 51971121, "comment_id": 90892799, "body": "Can you show your working mongo direct query?"}, {"owner": {"reputation": 43, "user_id": 5576897, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eOz4U1hZm3s/AAAAAAAAAAI/AAAAAAAACt8/J4VRvCl_Lgw/photo.jpg?sz=128", "display_name": "Ricardo Moreira", "link": "https://stackoverflow.com/users/5576897/ricardo-moreira"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534955274, "post_id": 51971121, "comment_id": 90893060, "body": "db.getCollection(&#39;myCollection&#39;).aggregate(     [         {           &quot;$group&quot;:{             &quot;_id&quot;:{               &quot;ProductCode&quot;:&quot;$ProductCode&quot;,             &quot;Dir&quot;:&quot;$Dir&quot;,             &quot;WharehouseID&quot;:&quot;$WharehouseID&quot;           }         }       }     ]   )"}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 5576897, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eOz4U1hZm3s/AAAAAAAAAAI/AAAAAAAACt8/J4VRvCl_Lgw/photo.jpg?sz=128", "display_name": "Ricardo Moreira", "link": "https://stackoverflow.com/users/5576897/ricardo-moreira"}, "is_accepted": false, "score": 1, "last_activity_date": 1534957274, "creation_date": 1534957274, "answer_id": 51971832, "question_id": 51971121, "link": "https://stackoverflow.com/questions/51971121/mongo-go-driver-aggregate-call-always-returns-error/51971832#51971832", "title": "mongo-go-driver aggregate call always returns error", "body": "<p>I got it!</p>\n\n<p>Two mistakes I was making:</p>\n\n<p>1 - I have to parse an array of JSON objects</p>\n\n<p>2 - No new lines before closing \"`\"</p>\n\n<p>Here is the working example:</p>\n\n<pre><code>    group, e := bson.ParseExtJSONArray(`[{\n      \"$group\": {\n        \"_id\":{\n          \"ProductCode\":\"$ProductCode\",\n          \"Dir\":\"$Dir\",\n          \"WharehouseID\":\"$WharehouseID\"\n        }\n      }\n    }]`)\n\n    cursor, e := myCollection.Aggregate(\n       context.Background(),\n       group,\n    )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1535333914, "creation_date": 1535333914, "answer_id": 52031608, "question_id": 51971121, "link": "https://stackoverflow.com/questions/51971121/mongo-go-driver-aggregate-call-always-returns-error/52031608#52031608", "title": "mongo-go-driver aggregate call always returns error", "body": "<p>An alternative to parsing a string of <a href=\"https://docs.mongodb.com/manual/reference/mongodb-extended-json/\" rel=\"nofollow noreferrer\">MongoDB Extended JSON</a> to build an aggregation pipeline, you could also construct a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#Array\" rel=\"nofollow noreferrer\">bson.Array</a> object (typed): </p>\n\n<p>For example: </p>\n\n<pre><code>pipeline := bson.NewArray(\n    bson.VC.DocumentFromElements(\n        bson.EC.SubDocumentFromElements(\n            \"$group\",\n            bson.EC.SubDocumentFromElements(\n                \"_id\",\n                bson.EC.String(\"ProductCode\",\"$ProductCode\"),\n                bson.EC.String(\"Dir\",\"$Dir\"),\n                bson.EC.String(\"WharehouseID\",\"$WharehouseID\"),\n            ),\n        ),\n    ),\n)\ncursor, err := collection.Aggregate(context.Background(), pipeline)\n</code></pre>\n\n<p>The above snippet is compatible with the current <a href=\"https://github.com/mongodb/mongo-go-driver/releases/tag/v0.0.12\" rel=\"nofollow noreferrer\">mongo-go-driver version 0.0.12</a></p>\n"}], "owner": {"reputation": 43, "user_id": 5576897, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eOz4U1hZm3s/AAAAAAAAAAI/AAAAAAAACt8/J4VRvCl_Lgw/photo.jpg?sz=128", "display_name": "Ricardo Moreira", "link": "https://stackoverflow.com/users/5576897/ricardo-moreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3024, "favorite_count": 2, "accepted_answer_id": 52031608, "answer_count": 2, "score": 3, "last_activity_date": 1535333914, "creation_date": 1534954634, "last_edit_date": 1534957222, "question_id": 51971121, "link": "https://stackoverflow.com/questions/51971121/mongo-go-driver-aggregate-call-always-returns-error", "title": "mongo-go-driver aggregate call always returns error", "body": "<p>I'm trying to do an aggregation with mongo-go-driver (MongoDB team driver for Golang) and I can't see what I'm doing wrong here: </p>\n\n<pre><code>// group\ngroup, e := bson.ParseExtJSONObject(`\n    {\n      \"$group\": {\n        \"_id\":{\n          \"ProductCode\":\"$ProductCode\",\n          \"Dir\":\"$Dir\",\n          \"WharehouseID\":\"$WharehouseID\"\n        }\n      }\n    }\n`)\n\n\ncursor, e := myCollection.Aggregate(\n    context.Background(),\n    group,\n)\n\n// e output: \"(Location40324) Unrecognized pipeline stage name: '_id'\"\n</code></pre>\n\n<p>This is a mongodb error but if I execute this query in a mongodb native client I get the results and no error occurs. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1534953285, "post_id": 51970509, "comment_id": 90891862, "body": "Thanks for the answer, it&#39;s really helpful. I&#39;m just wondering though, as seen in my question I had a variable, but in your answer it is missing. I need it so I can loop the json file, etc. Is that still possible?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1534953626, "post_id": 51970509, "comment_id": 90892069, "body": "The only variable I removed was <code>helpers</code> because its definition was mistaken. If you want to use the unmarshalled JSON, it&#39;s in the <code>schemaHelper</code> variable."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1534953624, "last_edit_date": 1534953624, "creation_date": 1534952534, "answer_id": 51970509, "question_id": 51970372, "link": "https://stackoverflow.com/questions/51970372/struct-is-not-a-type-when-passed-as-a-parameter-to-a-function-in-a-separate-pack/51970509#51970509", "title": "Struct is not a type when passed as a parameter to a function in a separate package", "body": "<p>You're trying to declare a variable called <code>helpers</code>, of type <code>schemaHelper</code>, but (at least within the code shown) you have not defined any type called <code>schemaHelper</code>. You have a <em>variable</em> called <code>schemaHelper</code>. You can't use a type as a variable, or a variable as a type. You'd have to call <code>Validate</code> by passing an <em>instance</em> of <code>UsersJSON</code>, which you could then unmarshal the JSON into directly. It seems like what you're likely looking for is instead something like this:</p>\n\n<pre><code>func MyFunc(w http.ResponseWriter, r *http.Request) {\n    var unmarshaled UsersJSON\n    errors, _ := schema.Validate(&amp;unmarshaled)\n}\n\nfunc Validate(schemaHelper interface{}) (error) {\n    file, err := os.Open(\"config/schema/schema.json\")\n    if err != nil {\n        return nil, err\n    }\n\n    defer file.Close()\n\n    byteValue, _ := ioutil.ReadAll(file)\n\n    return json.Unmarshal(byteValue, schemaHelper)\n}\n</code></pre>\n\n<p>This would unmarshal the JSON into the variable <code>schemaHelper</code> (whatever type it might be), for the caller to then use as it sees fit. Note that this is a rough best guess, because in your question the call to <code>Validate</code> passes 3 parameters but the function definition given only accepts 1 parameter.</p>\n\n<p>However, I don't think this does \"validation\" in the way that you think it does based on the question. It only validates that the JSON is <em>syntactically valid</em>, not that it has any relation to the <code>struct</code> you pass in - it could have fields that aren't defined in the struct, it could be missing fields that are defined, and it will not return any errors.</p>\n\n<p>Lastly, the type <code>UsersJSON</code> has no exported fields (all the fields begin with a lower-case letter, making them unexported/private), so nothing will be unmarshaled into it no matter what. <code>encoding/json</code> can only unmarshal into exported fields.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10260532, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YqlWM.jpg?s=128&g=1", "display_name": "shaq", "link": "https://stackoverflow.com/users/10260532/shaq"}, "is_accepted": false, "score": 0, "last_activity_date": 1534952587, "creation_date": 1534952587, "answer_id": 51970521, "question_id": 51970372, "link": "https://stackoverflow.com/questions/51970372/struct-is-not-a-type-when-passed-as-a-parameter-to-a-function-in-a-separate-pack/51970521#51970521", "title": "Struct is not a type when passed as a parameter to a function in a separate package", "body": "<p>You are getting this error because <code>schemaHelper</code> is not a type. It is in fact, a function variable of type <code>interface{}</code>, as you have declared in the function <code>Validate</code>.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 0, "accepted_answer_id": 51970509, "answer_count": 2, "score": -1, "last_activity_date": 1534953624, "creation_date": 1534952160, "question_id": 51970372, "link": "https://stackoverflow.com/questions/51970372/struct-is-not-a-type-when-passed-as-a-parameter-to-a-function-in-a-separate-pack", "title": "Struct is not a type when passed as a parameter to a function in a separate package", "body": "<p>I'm making a JSON validation function and I'm trying to implement it. However I'm having issues with my structs when I try to import them as a parameter to my validation function, which is in another package.</p>\n\n<p>The reason to why it's in another package is because a universal validation function that I will call in different route files, so I can't actually have any structs inside that package, they must be imported and defined in the route file.</p>\n\n<pre><code>type UsersJSON struct {\n    Users struct {\n        Put []UserJSON `json:\"PUT\"`\n    } `json:\"users\"`\n}\n\ntype UserJSON struct {\n    display_name     string `json:\"display_name\"`\n    username        string `json:\"username\"`\n    email           string `json:\"email\"`\n    password        string `json:\"password\"`\n}\n\nfunc MyFunc(w http.ResponseWriter, r *http.Request) {\n    errors, _ := schema.Validate(data, r, UsersJSON)\n}\n\nfunc Validate(schemaHelper interface{}) (interface{}, error) {\n    file, err := os.Open(\"config/schema/schema.json\")\n    if err != nil {\n        return nil, err\n    }\n\n    defer file.Close()\n\n    byteValue, _ := ioutil.ReadAll(file)\n\n    var helpers schemaHelper // this is the error\n\n    json.Unmarshal(byteValue, &amp;helpers)\n    fmt.Printf(\"%v\", helpers)\n}\n</code></pre>\n\n<p>My JSON schema looks like this:</p>\n\n<pre><code>{\n    \"users\": {\n        \"PUT\": {\n        }\n    }\n}\n</code></pre>\n\n<p>I want to make this method work because it makes automating validation much easier and faster.</p>\n\n<p>This doesn't compile and gives the error <code>schemaHelper is not a type</code></p>\n\n<p>Any idea how I can solve this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "reply_to_user": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 1, "creation_date": 1534949408, "post_id": 51969470, "comment_id": 90889521, "body": "Not a duplicate. The final sentence in my question points out that the Itoa function (the solution to that question, which uses standard int types), does not support my data here."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534950333, "post_id": 51969470, "comment_id": 90890091, "body": "So do an inline conversion: <code>strconv.Itoa(int(value))</code>"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1539133526, "post_id": 51969470, "comment_id": 92387507, "body": "the question of how to convert an string to an int is absolutelly valid! i guess that the ConvertToStringWithSeparator is not the main topic of the question, is something related to another task that make wide the answer. For example, in my personal opinion i would strike your problem thinking in more little things that can be combined for achieve the ConvertToStringWithSeparator-goal, so first the conversion of scalar value, then apply the conversion to each element of the slice,and then apply a join that concatenates all of the elements in a slice into a string separated by a given char."}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594286370, "post_id": 51969470, "comment_id": 111075030, "body": "<code>strconv.Itoa(int(i))</code> (int to ASCII) or fmt.Sprintf(&quot;%d&quot;, i) to set an int to a string. See <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a> and <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a>.  <code>strconv.Atoi(s)</code> (ASCII to int) to set a string to an int. See <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1534949824, "post_id": 51969628, "comment_id": 90889789, "body": "Sprintf is expensive, as it creates items, I&#39;d like to do this inline line if possible :P"}, {"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "reply_to_user": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1534949985, "post_id": 51969628, "comment_id": 90889883, "body": "just edited my answer, added another way using strconv.Itoa"}], "tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 4, "last_activity_date": 1534949927, "last_edit_date": 1534949927, "creation_date": 1534949646, "answer_id": 51969628, "question_id": 51969470, "link": "https://stackoverflow.com/questions/51969470/int-to-string-in-go/51969628#51969628", "title": "Int to string in go?", "body": "<p>you can use Sprintf: </p>\n\n<pre><code>  num := 33\n  str := fmt.Sprintf(\"%d\", num)\n  fmt.Println(str)\n</code></pre>\n\n<p>or Itoa </p>\n\n<pre><code>str := strconv.Itoa(3)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7625597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a3119e97a4e0bbd3595b01bb1d8587?s=128&d=identicon&r=PG&f=1", "display_name": "Uttarkar", "link": "https://stackoverflow.com/users/7625597/uttarkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1534951389, "creation_date": 1534951389, "answer_id": 51970144, "question_id": 51969470, "link": "https://stackoverflow.com/questions/51969470/int-to-string-in-go/51970144#51970144", "title": "Int to string in go?", "body": "<p>You can convert the int16 to int and then use the strconv.Itoa function to convert int16 to string.</p>\n\n<p>Ex: <a href=\"https://play.golang.org/p/pToOjqDKEoi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pToOjqDKEoi</a></p>\n"}, {"comments": [{"owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 3, "creation_date": 1534973259, "post_id": 51970375, "comment_id": 90901180, "body": "I love this answer. We need more people like you."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 6, "last_activity_date": 1534952561, "last_edit_date": 1534952561, "creation_date": 1534952169, "answer_id": 51970375, "question_id": 51969470, "link": "https://stackoverflow.com/questions/51969470/int-to-string-in-go/51970375#51970375", "title": "Int to string in go?", "body": "<p>You can use <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"noreferrer\"><code>strconv.Itoa</code></a> (or <a href=\"https://golang.org/pkg/strconv/#FormatInt\" rel=\"noreferrer\"><code>strconv.FormatInt</code></a> if performance is critical) by simply converting the <code>int16</code> to an <code>int</code> or <code>int64</code>, for example (<a href=\"https://play.golang.com/p/5KcuYxsB9F3\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>x := uint16(123)\nstrconv.Itoa(int(x))            // =&gt; \"123\"\nstrconv.FormatInt(int64(x), 10) // =&gt; \"123\"\n</code></pre>\n\n<p>Note that <code>strconv.FormatInt(...)</code> may be slightly faster according to a simple benchmark:</p>\n\n<pre><code>// itoa_test.go\npackage main\n\nimport (\n  \"strconv\"\n  \"testing\"\n)\n\nconst x = int16(123)\n\nfunc Benchmark_Itoa(b *testing.B) {\n  for i := 0; i &lt; b.N; i++ {\n    strconv.Itoa(int(x))\n  }\n}\n\nfunc Benchmark_FormatInt(b *testing.B) {\n  for i := 0; i &lt; b.N; i++ {\n    strconv.FormatInt(int64(x), 10)\n  }\n}\n</code></pre>\n\n<p>Run as <code>$ go test -bench=. ./itoa_test.go</code>:</p>\n\n<pre><code>goos: darwin\ngoarch: amd64\nBenchmark_Itoa-8            50000000            30.3 ns/op\nBenchmark_FormatInt-8       50000000            27.8 ns/op\nPASS\nok      command-line-arguments  2.976s\n</code></pre>\n"}], "owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4965, "favorite_count": 0, "closed_date": 1534965237, "accepted_answer_id": 51970375, "answer_count": 3, "score": 3, "last_activity_date": 1534952561, "creation_date": 1534949136, "last_edit_date": 1534949473, "question_id": 51969470, "link": "https://stackoverflow.com/questions/51969470/int-to-string-in-go", "closed_reason": "Duplicate", "title": "Int to string in go?", "body": "<p>I really thought this would be as simple as : </p>\n\n<pre><code>string(myInt)\n</code></pre>\n\n<p>It appears not.</p>\n\n<p>I am writing a function which takes a slice of ints, and appends each one to a string - and adds a separator between each one. Here is my code.</p>\n\n<pre><code>func(xis *Int16Slice) ConvertToStringWithSeparator(separator string) string{\n    var buffer bytes.Buffer\n    for i, value := range *xis{\n        buffer.WriteString(string(value))\n        if i != len(*xis) -1 {\n            buffer.WriteString(separator)\n        }\n    }\n    return buffer.String()\n}\n</code></pre>\n\n<p>Please read the sentence below. This is not a duplicate of <a href=\"https://stackoverflow.com/questions/10105935\">How to convert an int value to string in Go?</a> - because : \nI am aware of things like the strconv.Itoa function, but it appears as though that will only work on \"regular\" ints. It will not support an int16</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534947798, "post_id": 51968946, "comment_id": 90888358, "body": "What specifically is the issue you&#39;re having? I would have to diff the actual/expected output to find the difference."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534948847, "post_id": 51968946, "comment_id": 90889129, "body": "It is not a good practice to name your variables like <code>x.x.y</code> and don&#39;t use your struct type as struct value name."}, {"owner": {"reputation": 27, "user_id": 9822273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65mbV.jpg?s=128&g=1", "display_name": "ddhille", "link": "https://stackoverflow.com/users/9822273/ddhille"}, "edited": false, "score": 1, "creation_date": 1534948984, "post_id": 51968946, "comment_id": 90889235, "body": "You&#39;re right, the structs are not very well structered. Anyway, the context demands it."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1534951041, "last_edit_date": 1534951041, "creation_date": 1534947826, "answer_id": 51969046, "question_id": 51968946, "link": "https://stackoverflow.com/questions/51968946/dynamic-json-struct-in-golang-doesnt-behave-as-expected/51969046#51969046", "title": "Dynamic JSON struct in Golang doesn&#39;t behave as expected", "body": "<p>The output you are not getting which you want is because you have used embedded struct for <code>ContentItem</code> in <code>DataManagement</code> rather than field name to add to the struct. </p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is called an\n  embedded field. An embedded field must be specified as a type name T\n  or as a pointer to a non-interface type name *T, and T itself may not\n  be a pointer type. The unqualified type name acts as the field name.</p>\n</blockquote>\n\n<p>A field declaration will sove your issue. You should change the struct <code>DataManagement</code> to:</p>\n\n<pre><code>type DataManagement struct {\n    DataManagement struct {\n        Type  string\n        Asset struct {\n            LocalAssetUID string\n            Type          string\n        }\n        *ContentProductionOrder // this is embedded struct\n        ContentItem *ContentItem\n        TimeStamp time.Time\n        Hash      string\n    }\n}\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/o9HiYVKKLid\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>For more information, Have a look at Golang Spec for <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct Types</a></p>\n"}], "owner": {"reputation": 27, "user_id": 9822273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65mbV.jpg?s=128&g=1", "display_name": "ddhille", "link": "https://stackoverflow.com/users/9822273/ddhille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 51969046, "answer_count": 1, "score": 0, "last_activity_date": 1534951041, "creation_date": 1534947530, "last_edit_date": 1534949003, "question_id": 51968946, "link": "https://stackoverflow.com/questions/51968946/dynamic-json-struct-in-golang-doesnt-behave-as-expected", "title": "Dynamic JSON struct in Golang doesn&#39;t behave as expected", "body": "<p>I'm trying to create a struct with some basic fields which are always present and some optional fields which are structs by themselves.</p>\n\n<p><strong>I'm wondering why the following code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\ntype DataManagement struct {\n    DataManagement struct {\n        Type              string\n        Asset struct {\n            LocalAssetUID string\n            Type          string\n        }\n        *ContentProductionOrder\n        *ContentItem\n        TimeStamp         time.Time\n        Hash              string\n    }\n}\n\ntype ContentProductionOrder struct {\n    ProductionOrderNo int\n    ItemNo            int\n    StartDate         time.Time\n    FinishDate        time.Time\n    StatusID          int\n    StatusDate        time.Time\n    SourceTypeID      int\n    TrackingID        int\n}\n\ntype ContentItem struct {\n    ItemNo     int\n    ItemText   string\n    Quantity   int\n}\n\nfunc main() {\n    var contentItem ContentItem\n    contentItem.ItemNo = 123\n    contentItem.ItemText = \"aaaaaaaa\"\n    contentItem.Quantity = 3\n\n    var dataManagement DataManagement\n    dataManagement.DataManagement.Type = \"asd\"\n    dataManagement.DataManagement.Asset.LocalAssetUID = \"asd\"\n    dataManagement.DataManagement.Asset.Type = \"asd\"\n    dataManagement.DataManagement.ContentItem = &amp;contentItem\n    dataManagement.DataManagement.TimeStamp = time.Now().UTC()\n    dataManagement.DataManagement.Hash = \"123\"\n\n    xy, _ := json.MarshalIndent(dataManagement, \"\", \"  \")\n    fmt.Println(string(xy))\n    xy, _ = json.MarshalIndent(contentItem, \"\", \"  \")\n    fmt.Println(string(xy))\n}\n</code></pre>\n\n<p><strong>outputs to the following:</strong></p>\n\n<pre><code>{\n  \"DataManagement\": {\n    \"Type\": \"asd\",\n    \"Asset\": {\n      \"LocalAssetUID\": \"asd\",\n      \"Type\": \"asd\"\n    },\n    \"ItemText\": \"aaaaaaaa\",\n    \"Quantity\": 3,\n    \"TimeStamp\": \"2009-11-10T23:00:00Z\",\n    \"Hash\": \"123\"\n  }\n}\n{\n  \"ItemNo\": 123,\n  \"ItemText\": \"aaaaaaaa\",\n  \"Quantity\": 3\n}\n</code></pre>\n\n<p><strong>and not to:</strong> </p>\n\n<pre><code>{\n  \"DataManagement\": {\n    \"Type\": \"asd\",\n    \"Asset\": {\n      \"LocalAssetUID\": \"asd\",\n      \"Type\": \"asd\"\n    },\n    \"ContentItem\": {\n      \"ItemNo\": 123,\n      \"ItemText\": \"aaaaaaaa\",\n      \"Quantity\": 3\n    },\n    \"TimeStamp\": \"2009-11-10T23:00:00Z\",\n    \"Hash\": \"123\"\n  }\n}\n{\n  \"ItemNo\": 123,\n  \"ItemText\": \"aaaaaaaa\",\n  \"Quantity\": 3\n}\n</code></pre>\n\n<p>Any ideas? It's probably pretty easy to explain; I'm not that experienced in Golang.</p>\n\n<p>Here's a Playground link: <a href=\"https://play.golang.org/p/iRDcaRIZ_ZU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iRDcaRIZ_ZU</a></p>\n"}, {"tags": ["go", "compiler-errors", "cross-compiling"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1534947405, "post_id": 51968117, "comment_id": 90888096, "body": "I don&#39;t think you can cross-compile anything that requires cgo."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534948539, "post_id": 51968117, "comment_id": 90888906, "body": "I think, you need to install gcc, because cgo may request c related details from gcc. <code>shmi_linux.go</code> is using <code>c.Int</code> type, while defining <code>shmi</code> struct. Once try installing gcc and then try."}, {"owner": {"reputation": 11, "user_id": 2123988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ebe10d87aa59973286aa309c171bd3?s=128&d=identicon&r=PG", "display_name": "user2123988", "link": "https://stackoverflow.com/users/2123988/user2123988"}, "edited": false, "score": 0, "creation_date": 1534952763, "post_id": 51968117, "comment_id": 90891543, "body": "Hmmm.. I&#39;ll try that tonight and see what I can make of it"}, {"owner": {"reputation": 11, "user_id": 2123988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ebe10d87aa59973286aa309c171bd3?s=128&d=identicon&r=PG", "display_name": "user2123988", "link": "https://stackoverflow.com/users/2123988/user2123988"}, "edited": false, "score": 0, "creation_date": 1535010223, "post_id": 51968117, "comment_id": 90910975, "body": "Installed gcc but no luck trying to compile. Think i am gonna try to do it with docker instead"}, {"owner": {"reputation": 11, "user_id": 2123988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ebe10d87aa59973286aa309c171bd3?s=128&d=identicon&r=PG", "display_name": "user2123988", "link": "https://stackoverflow.com/users/2123988/user2123988"}, "edited": false, "score": 0, "creation_date": 1535108625, "post_id": 51968117, "comment_id": 90955218, "body": "I ended up just using the &quot;new&quot; linux subsystem on windows. Very simple and the work effort to solve the issue where quite small. Thanks for the help!"}], "owner": {"reputation": 11, "user_id": 2123988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ebe10d87aa59973286aa309c171bd3?s=128&d=identicon&r=PG", "display_name": "user2123988", "link": "https://stackoverflow.com/users/2123988/user2123988"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534945398, "creation_date": 1534944843, "last_edit_date": 1534945398, "question_id": 51968117, "link": "https://stackoverflow.com/questions/51968117/crosscompile-linux-dependent-code-on-windows-machine", "title": "Crosscompile linux dependent code on windows machine", "body": "<p>I have an issue when trying to compile linux specific GoLang code on my windows machine</p>\n\n<p>I am using, in this case, <a href=\"https://github.com/hidez8891/shm\" rel=\"nofollow noreferrer\">https://github.com/hidez8891/shm</a> pretty straight off, but the only thing i get back is \".\\shm.go:10:7: undefined: shmi\".</p>\n\n<p>GOOS is set to linux and GOARCH is set to amd64. Do anyone have any ideas, perhaps it's not even possible to do what i am trying to do. All help would be great.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534943518, "post_id": 51967482, "comment_id": 90885440, "body": "<a href=\"https://play.golang.org/p/s1gqGLVRiIC\" rel=\"nofollow noreferrer\">play.golang.org/p/s1gqGLVRiIC</a> ?"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534943663, "post_id": 51967482, "comment_id": 90885533, "body": "That works like a charm! If you post it as the answer I&#39;ll accept it."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534943680, "post_id": 51967482, "comment_id": 90885540, "body": "This is because <code>appendtoMap</code> is not a map it is a string value of the map <code>resultMapErrors</code>"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1534943761, "post_id": 51967482, "comment_id": 90885614, "body": "Thanks for the input!"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1534943792, "creation_date": 1534943792, "answer_id": 51967795, "question_id": 51967482, "link": "https://stackoverflow.com/questions/51967482/how-to-turn-array-into-nested-json-object-after-splitting/51967795#51967795", "title": "How to turn array into nested json object after splitting", "body": "<pre><code>var errors = make(map[string]string)\nfor _, err := range result.Errors() {\n    errors[err.Field()] = err.Description()\n}\n\n// Make the JSON map we want to append values to\nresultMap := map[string]interface{}{\n    \"errors\": errors,\n}\n\nfinalErrors, _ := json.Marshal(resultMap)\nfmt.Println(string(finalErrors))\n</code></pre>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 51967795, "answer_count": 1, "score": -2, "last_activity_date": 1534943792, "creation_date": 1534942785, "question_id": 51967482, "link": "https://stackoverflow.com/questions/51967482/how-to-turn-array-into-nested-json-object-after-splitting", "title": "How to turn array into nested json object after splitting", "body": "<p>I'm trying to deal with some error descriptions from <a href=\"https://github.com/xeipuuv/gojsonschema\" rel=\"nofollow noreferrer\">this library</a> because I need them to be nested JSON objects.</p>\n\n<p>The errors seem to be an array originally, like this:</p>\n\n<pre><code>[\"String length must be greater than or equal to 3\",\"Does not match format 'email'\"]\n</code></pre>\n\n<p>I needed that to also include the field name of the containing error:</p>\n\n<pre><code>[\"Field1: String length must be greater than or equal to 3\",\"Email1: Does not match format 'email'\"]\n</code></pre>\n\n<p>After that I need to split each array value by colon <code>:</code> so I can have the field name and error description in separate variables like <code>slice[0]</code> and <code>slice[1]</code>. </p>\n\n<p>With that I want to make a nested JSON object like so:</p>\n\n<pre><code>{\n    \"errors\": {\n        \"Field1\": \"String length must be greater than or equal to 3\",\n        \"Email1\": \"Does not match format 'email'\"\n    }\n}\n</code></pre>\n\n<p>This is my way of trying to achieve this:</p>\n\n<pre><code>var errors []string\nfor _, err := range result.Errors() {\n    // Append the errors into an array that we can use to split later\n    errors = append(errors, err.Field() + \":\" + err.Description())\n}\n\n// Make the JSON map we want to append values to\nresultMap := map[string]interface{}{\n    \"errors\": map[string]string {\n        \"Field1\": \"\",\n        \"Email1\": \"\"\n    },\n}\n\n// So we actually can use the index keys when appending\nresultMapErrors, _ := resultMap[\"errors\"].(map[string]string)\n\nfor _, split := range errors {\n    slice := strings.Split(split, \":\")\n    for _, appendToMap := range resultMapErrors {\n        appendToMap[slice[0]] = slice[1] // append it like so?\n    }\n}\n\nfinalErrors, _ := json.Marshal(resultMapErrors)\nfmt.Println(string(finalErrors))\n</code></pre>\n\n<p>But this throws the errors</p>\n\n<pre><code>main.go:59:28: non-integer string index slice[0]\nmain.go:59:39: cannot assign to appendToMap[slice[0]]\n</code></pre>\n\n<p>Any clue how I can achieve this?</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 1176, "user_id": 2486401, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/03116430f52abc27467d5408ad273c53?s=128&d=identicon&r=PG", "display_name": "janDro", "link": "https://stackoverflow.com/users/2486401/jandro"}, "edited": false, "score": 0, "creation_date": 1534940990, "post_id": 51966925, "comment_id": 90883768, "body": "Does that folder exist in the container?"}, {"owner": {"reputation": 179, "user_id": 6247233, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-h8u0wOdgTlc/AAAAAAAAAAI/AAAAAAAAAB8/dG_6tyhgUj8/photo.jpg?sz=128", "display_name": "Anoop Krishnan", "link": "https://stackoverflow.com/users/6247233/anoop-krishnan"}, "reply_to_user": {"reputation": 1176, "user_id": 2486401, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/03116430f52abc27467d5408ad273c53?s=128&d=identicon&r=PG", "display_name": "janDro", "link": "https://stackoverflow.com/users/2486401/jandro"}, "edited": false, "score": 0, "creation_date": 1534941048, "post_id": 51966925, "comment_id": 90883803, "body": "@janDro yup able to cd to directory /usr/src/app and see files there"}, {"owner": {"reputation": 1176, "user_id": 2486401, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/03116430f52abc27467d5408ad273c53?s=128&d=identicon&r=PG", "display_name": "janDro", "link": "https://stackoverflow.com/users/2486401/jandro"}, "edited": false, "score": 0, "creation_date": 1534941175, "post_id": 51966925, "comment_id": 90883881, "body": "And <code>First</code> also on the host?"}, {"owner": {"reputation": 179, "user_id": 6247233, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-h8u0wOdgTlc/AAAAAAAAAAI/AAAAAAAAAB8/dG_6tyhgUj8/photo.jpg?sz=128", "display_name": "Anoop Krishnan", "link": "https://stackoverflow.com/users/6247233/anoop-krishnan"}, "reply_to_user": {"reputation": 1176, "user_id": 2486401, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/03116430f52abc27467d5408ad273c53?s=128&d=identicon&r=PG", "display_name": "janDro", "link": "https://stackoverflow.com/users/2486401/jandro"}, "edited": false, "score": 0, "creation_date": 1534941336, "post_id": 51966925, "comment_id": 90883969, "body": "@janDro yup its there in host and in it there is an app.go file with code"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534941505, "post_id": 51966925, "comment_id": 90884087, "body": "<a href=\"https://stackoverflow.com/a/51917779/965900\">stackoverflow.com/a/51917779/965900</a>"}, {"owner": {"reputation": 1176, "user_id": 2486401, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/03116430f52abc27467d5408ad273c53?s=128&d=identicon&r=PG", "display_name": "janDro", "link": "https://stackoverflow.com/users/2486401/jandro"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534941561, "post_id": 51966925, "comment_id": 90884122, "body": "Yeah either @mkopriva &#39;s link or I&#39;d suggest messing around with the permissions of the First directory and make sure it has execute on it. Also refer to -&gt; <a href=\"https://github.com/docker/compose/issues/4039\" rel=\"nofollow noreferrer\">github.com/docker/compose/issues/4039</a>"}, {"owner": {"reputation": 179, "user_id": 6247233, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-h8u0wOdgTlc/AAAAAAAAAAI/AAAAAAAAAB8/dG_6tyhgUj8/photo.jpg?sz=128", "display_name": "Anoop Krishnan", "link": "https://stackoverflow.com/users/6247233/anoop-krishnan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534942012, "post_id": 51966925, "comment_id": 90884399, "body": "@mkopriva thanks it worked.. is there anyway to do hotloading for  go"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534942516, "post_id": 51966925, "comment_id": 90884748, "body": "@AnoopKrishnan I don&#39;t have any experience with hot reloading go projects, so the best I can offer is this: <a href=\"https://www.google.com/search?q=golang+hot+reload\" rel=\"nofollow noreferrer\">google.com/search?q=golang+hot+reload</a>."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1534946008, "post_id": 51966925, "comment_id": 90887198, "body": "@AnoopKrishnan I use <a href=\"https://github.com/pilu/fresh\" rel=\"nofollow noreferrer\"><b>fresh</b></a>, and I&#39;m pretty satisfied with it. On the other note your Dockerfile is quite strange."}], "answers": [{"tags": [], "owner": {"reputation": 474, "user_id": 2709131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2814a78ae5b7945b770965603bd31df6?s=128&d=identicon&r=PG&f=1", "display_name": "pwaterz", "link": "https://stackoverflow.com/users/2709131/pwaterz"}, "is_accepted": false, "score": 1, "last_activity_date": 1534949762, "creation_date": 1534949762, "answer_id": 51969664, "question_id": 51966925, "link": "https://stackoverflow.com/questions/51966925/unable-to-build-golang-app-in-docker/51969664#51969664", "title": "Unable to build golang app in docker", "body": "<p>What looks off to me is that you are setting the working directory to /usr/src/app but then you are running go build ./app. Try changing ./app to just .</p>\n"}], "owner": {"reputation": 179, "user_id": 6247233, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-h8u0wOdgTlc/AAAAAAAAAAI/AAAAAAAAAB8/dG_6tyhgUj8/photo.jpg?sz=128", "display_name": "Anoop Krishnan", "link": "https://stackoverflow.com/users/6247233/anoop-krishnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534949762, "creation_date": 1534940904, "question_id": 51966925, "link": "https://stackoverflow.com/questions/51966925/unable-to-build-golang-app-in-docker", "title": "Unable to build golang app in docker", "body": "<p>I have made a golang app using sample example, however when I setup docker to build and run it it fails to build giving the error</p>\n\n<pre><code>ERROR: for goserver  Cannot start service goserver: b'OCI runtime create failed: container_linux.go:348: starting container process caused \"exec: \\\\\"./app\\\\\": stat ./app: no such file or directory\": unknown'\n</code></pre>\n\n<p>My Dockerfile is</p>\n\n<pre><code>FROM golang:1.8\nWORKDIR /usr/src/app\nCOPY . .\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix nocgo -o ./app .\nENTRYPOINT [\"./app\"]\n</code></pre>\n\n<p>and my docker-compose is</p>\n\n<pre><code>version: '2'\n\nvolumes:\n app_nm:\n driver: local\n\nservices:\n goserver:\n  container_name: \"goserver\"\n  image: \"mygoserver\"\n  build:\n   context: ./First\n   dockerfile: Dockerfile\n  volumes:\n   - ./First:/usr/src/app\n  ports:\n   - 8081:8080\n  tty: true\n</code></pre>\n\n<p>I tried logging into container via docker exec by setting tty: true and executing the build command and it works fine. What could be the issue?</p>\n"}, {"tags": ["windows", "go", "cmd", "go-cobra"], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "edited": false, "score": 0, "creation_date": 1534947853, "post_id": 51968830, "comment_id": 90888404, "body": "Thank you for your response. Right now I can see the first output. But I&#39;d like to open a fully functional console so I don&#39;t have to navigate through my file system."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "reply_to_user": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "edited": false, "score": 1, "creation_date": 1534947937, "post_id": 51968830, "comment_id": 90888460, "body": "&gt;But I&#39;d like to open a fully functional console so I don&#39;t have to navigate through my file system. I don&#39;t understand what you were asking."}, {"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "edited": false, "score": 0, "creation_date": 1534949165, "post_id": 51968830, "comment_id": 90889369, "body": "I want to have the application and the corresponding database in one folder. If I click on the <code>.exe</code> it will open a terminal where I can make my inputs. Just as in a C console application."}, {"owner": {"reputation": 2657, "user_id": 755405, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Vekdd.jpg?s=128&g=1", "display_name": "W1M0R", "link": "https://stackoverflow.com/users/755405/w1m0r"}, "reply_to_user": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "edited": false, "score": 0, "creation_date": 1606136750, "post_id": 51968830, "comment_id": 114860744, "body": "@alexfwulf Maybe you can consider using <a href=\"https://github.com/c-bata/go-prompt\" rel=\"nofollow noreferrer\">github.com/c-bata/go-prompt</a> to implement what you require"}], "tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": false, "score": 1, "last_activity_date": 1534947180, "creation_date": 1534947180, "answer_id": 51968830, "question_id": 51966714, "link": "https://stackoverflow.com/questions/51966714/go-c-style-console-application/51968830#51968830", "title": "GO C-Style Console Application", "body": "<p>This is done on purpose as no arguments will be provided to the command when started through explorer.exe, as the main purpose of using cobra is for parsing arguments and stuff.</p>\n\n<p>To disable this feature.</p>\n\n<p>Add this line in your <code>init()</code></p>\n\n<pre><code>func init(){\n  cobra.MousetrapHelpText = \"\"\n}\n</code></pre>\n\n<p>This let's your program run, and it exits immediately, to see if it's working fine.\nUse <code>time.Sleep()</code>, so that you can see the output.</p>\n"}], "owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1534947180, "creation_date": 1534940204, "last_edit_date": 1534940250, "question_id": 51966714, "link": "https://stackoverflow.com/questions/51966714/go-c-style-console-application", "title": "GO C-Style Console Application", "body": "<p>I created a Go CLI app with the cobra framework via the <code>cobra add</code> command. After building it with <code>go build</code> it works totally fine if I'm in the repository in the windows cmd. If I click on the <code>.exe</code> I get the following message on a terminal:</p>\n\n<pre><code>This is a command line tool.\n\nYou need to open cmd.exe and run it from there.\n</code></pre>\n\n<p>This is not suitable for my case. I'd like to have a console applocation like in C or C++ which opens directly and you can type in commands there. Do you have any suggestions how I could realize this while using cobra?</p>\n\n<p>Thank you a lot in advance.</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api"], "comments": [{"owner": {"reputation": 23213, "user_id": 7131757, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/wvEUE.jpg?s=128&g=1", "display_name": "Giorgos Myrianthous", "link": "https://stackoverflow.com/users/7131757/giorgos-myrianthous"}, "edited": false, "score": 0, "creation_date": 1534944217, "post_id": 51966212, "comment_id": 90885942, "body": "Are you running a multi-broker setup?"}, {"owner": {"reputation": 2905, "user_id": 2036995, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/af70d05f380d9930df7a7cd9f3907920?s=128&d=identicon&r=PG", "display_name": "franck", "link": "https://stackoverflow.com/users/2036995/franck"}, "reply_to_user": {"reputation": 23213, "user_id": 7131757, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/wvEUE.jpg?s=128&g=1", "display_name": "Giorgos Myrianthous", "link": "https://stackoverflow.com/users/7131757/giorgos-myrianthous"}, "edited": false, "score": 0, "creation_date": 1535001476, "post_id": 51966212, "comment_id": 90907146, "body": "Yes, 2 brokers."}, {"owner": {"reputation": 3484, "user_id": 1016425, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GLTjc.gif?s=128&g=1", "display_name": "lloiacono", "link": "https://stackoverflow.com/users/1016425/lloiacono"}, "edited": false, "score": 0, "creation_date": 1553084628, "post_id": 51966212, "comment_id": 97252684, "body": "I answered a similar question here: <a href=\"https://stackoverflow.com/a/53600352/1016425\">stackoverflow.com/a/53600352/1016425</a> check it out"}, {"owner": {"reputation": 64413, "user_id": 1305344, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/thhxw.png?s=128&g=1", "display_name": "Jacek Laskowski", "link": "https://stackoverflow.com/users/1305344/jacek-laskowski"}, "edited": false, "score": 0, "creation_date": 1582464762, "post_id": 51966212, "comment_id": 106779142, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/53571823/why-could-kafka-warn-partitions-have-leader-brokers-without-a-matching-listener\">Why could Kafka warn &quot;partitions have leader brokers without a matching listener&quot;?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 644, "user_id": 5950470, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-w0eQFIhrOhs/AAAAAAAAAAI/AAAAAAAAAlE/GGNAC0iP1Fo/photo.jpg?sz=128", "display_name": "Abhilash Nayak", "link": "https://stackoverflow.com/users/5950470/abhilash-nayak"}, "edited": false, "score": 0, "creation_date": 1544170691, "post_id": 51978795, "comment_id": 94188954, "body": "We were facing the same issue, started all the brokers and the issue was resolved."}], "tags": [], "owner": {"reputation": 2905, "user_id": 2036995, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/af70d05f380d9930df7a7cd9f3907920?s=128&d=identicon&r=PG", "display_name": "franck", "link": "https://stackoverflow.com/users/2036995/franck"}, "is_accepted": false, "score": 1, "last_activity_date": 1535001533, "creation_date": 1535001533, "answer_id": 51978795, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/51978795#51978795", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>I think my problem is I was running 2 instances, without setting anything special for replications. (prob no replication?) then I removed a broker. Some topics stopped working.</p>\n"}, {"comments": [{"owner": {"reputation": 4085, "user_id": 4185106, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/er5li.png?s=128&g=1", "display_name": "moffeltje", "link": "https://stackoverflow.com/users/4185106/moffeltje"}, "edited": false, "score": 3, "creation_date": 1580809362, "post_id": 57590198, "comment_id": 106210727, "body": "Small correction: if you try to run multiple consumers from the same consumer group."}], "tags": [], "owner": {"reputation": 761, "user_id": 2655966, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b0cad1d7b4ef593549c26df7016c32e9?s=128&d=identicon&r=PG&f=1", "display_name": "arunan", "link": "https://stackoverflow.com/users/2655966/arunan"}, "is_accepted": true, "score": 7, "last_activity_date": 1587042798, "last_edit_date": 1587042798, "creation_date": 1566385442, "answer_id": 57590198, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/57590198#57590198", "title": "Leader brokers without a matching listener error in kafka", "body": "<blockquote>\n  <p>[2018-08-22 11:40:49,429] WARN [Consumer clientId=consumer-1, groupId=console-consumer-62114] 1 partitions have leader brokers without a matching listener, including [topicname-0] (org.apache.kafka.clients.NetworkClient)</p>\n</blockquote>\n\n<p>This error also happens if you try to run multiple consumers and the kafka topic contains only one partition. Generally one consumer should mapped with one partition. If you are using two consumers then you should have 2 partition in the kafka topic.</p>\n"}, {"tags": [], "owner": {"reputation": 2208, "user_id": 4982691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3afef4e5dfd2ea621b98d4259cd149e1?s=128&d=identicon&r=PG&f=1", "display_name": "jumping_monkey", "link": "https://stackoverflow.com/users/4982691/jumping-monkey"}, "is_accepted": false, "score": 3, "last_activity_date": 1609175846, "last_edit_date": 1609175846, "creation_date": 1574414874, "answer_id": 58991179, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/58991179#58991179", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>In my case, i was getting this error when i was testing <code>Kafka</code> fail-over. I brought down 1 <code>Kafka</code>, and expected the message to be written to the <strong>other</strong> <code>Kafka</code>.</p>\n<p>The issue was that topic <code>replication-factor</code> was set to 1, when i needed to set it to 2. (2 Kafka instances)</p>\n<p><b>Bonus</b>:<br> Check out the directories where the topics are created(<em>in my case: kafka-logs-xx</em>) for both <code>Kafka</code>, and you will understand why :-)</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 4865935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2a5f91831ce0f6319e913a19c12281b?s=128&d=identicon&r=PG&f=1", "display_name": "Vezir", "link": "https://stackoverflow.com/users/4865935/vezir"}, "is_accepted": false, "score": 0, "last_activity_date": 1581506784, "creation_date": 1581506784, "answer_id": 60187306, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/60187306#60187306", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>In my case, i was getting this error while updating my kafka cluster from v2.0 to v2.4. The reason was the configuration settings was wrong for log.dirs in server.properties file. Because I didnt noticed different disk name for different nodes and i missmatch the disknames in log.dirs settings.</p>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 13315015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhFLxRE_yXfK1lxbUpYhPL0fDf_5llQY_wmkLfF=k-s128", "display_name": "ntifi amine", "link": "https://stackoverflow.com/users/13315015/ntifi-amine"}, "is_accepted": false, "score": -1, "last_activity_date": 1586896582, "creation_date": 1586896582, "answer_id": 61216759, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/61216759#61216759", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>I had this problem and i resolved it by creating a new broker and starting it. Afterwards you have to restart the different consumers, producers and so on.</p>\n"}, {"tags": [], "owner": {"reputation": 310, "user_id": 3869771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce46aff4dff01f1e1aaf0db1c54e748c?s=128&d=identicon&r=PG&f=1", "display_name": "stsmurf", "link": "https://stackoverflow.com/users/3869771/stsmurf"}, "is_accepted": false, "score": 0, "last_activity_date": 1595872742, "creation_date": 1595872742, "answer_id": 63120951, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/63120951#63120951", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>jumping_monkey's bonus on checking the directories is helpful. For me, I was deploying with <a href=\"https://bitnami.com/stack/kafka/containers\" rel=\"nofollow noreferrer\">Bitnami Kafka</a>. On first deploy I was not <code>config</code> in the helm values. I wanted to change retention down to minutes, and set that:</p>\n<pre><code>config: |-\n  log.retention.minutes=10\n</code></pre>\n<p>This caused the <code>log.dirs</code> directory to switch from <code>/bitnami/kafka/data</code> to <code>/tmp/logs</code>.</p>\n<p>Essentially where the data is being stored on the Kafka brokers caused the error to show up.</p>\n"}, {"tags": [], "owner": {"reputation": 22902, "user_id": 327862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c01354fc5d46f88822d737d2a1ce981c?s=128&d=identicon&r=PG", "display_name": "Mukesh Chapagain", "link": "https://stackoverflow.com/users/327862/mukesh-chapagain"}, "is_accepted": false, "score": 0, "last_activity_date": 1610874321, "creation_date": 1610874321, "answer_id": 65758874, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka/65758874#65758874", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>I had this issue while running Kafka in a docker container.</p>\n<p>The following solution helped to resolve the issue.</p>\n<p>As mentioned by <code>@coldkreap</code> in the comment of this answer: <a href=\"https://stackoverflow.com/a/58067985/327862\">https://stackoverflow.com/a/58067985/327862</a></p>\n<blockquote>\n<p>The kafka broker information is kept between restarts because the\n<code>wurstmeister/kafka</code> image creates a volume named 'kafka'. If you run\ndocker volume ls you will see a kafka volume. Remove that volume and\nyou will be able to recreate topics, etc.</p>\n</blockquote>\n<p>If using <code>docker-compose</code>, you can run the following command to remove containers along with their associated volumes:</p>\n<pre><code>docker-compose down -v\n</code></pre>\n<p>OR</p>\n<pre><code>docker-compose rm -sv\n</code></pre>\n"}], "owner": {"reputation": 2905, "user_id": 2036995, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/af70d05f380d9930df7a7cd9f3907920?s=128&d=identicon&r=PG", "display_name": "franck", "link": "https://stackoverflow.com/users/2036995/franck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20801, "favorite_count": 5, "accepted_answer_id": 57590198, "answer_count": 7, "score": 14, "last_activity_date": 1610874321, "creation_date": 1534938531, "last_edit_date": 1534947753, "question_id": 51966212, "link": "https://stackoverflow.com/questions/51966212/leader-brokers-without-a-matching-listener-error-in-kafka", "title": "Leader brokers without a matching listener error in kafka", "body": "<p>What is the meaning of this kafka error ?</p>\n\n<blockquote>\n  <p>[2018-08-22 11:40:49,429] WARN [Consumer clientId=consumer-1,\n  groupId=console-consumer-62114] 1 partitions have leader brokers\n  without a matching listener, including [topicname-0]\n  (org.apache.kafka.clients.NetworkClient)</p>\n</blockquote>\n\n<p>I'm getting it when running:</p>\n\n<pre><code>./kafka-console-consumer.sh --topic topicname --bootstrap-server localhost:9094\n</code></pre>\n\n<p>And I'm getting some errors inside a golang program when trying to read this topic:</p>\n\n<blockquote>\n  <p>2018/08/22 11:44:12 ReadOffsetWithRetryOnError conn error: &lt; dial tcp\n  :0: connect: connection refused >  kafka0:9094  topic: 0</p>\n</blockquote>\n\n<p>The code snippet:</p>\n\n<pre><code>conn, err := kafka.DialLeader(context.Background(), \"tcp\", ip, getTopic(topic), 0)\n                if err != nil {\n                    log.Println(\"ReadOffsetWithRetryOnError conn error: &lt;\", err, \"&gt; \", ip, \" topic:\", topic)\n                }\n</code></pre>\n\n<p>This is quite weird because, when reading on different topic it is working fine at the same time.</p>\n\n<p>More error logs:</p>\n\n<blockquote>\n  <p>/kafka-topics.sh --describe --zookeeper localhost:2181 --topic\n  topicname Topic:indexBlock        PartitionCount:1<br>\n  ReplicationFactor:1     Configs:\n          Topic: topicname       Partition: 0    Leader: -1      Replicas: 1002  Isr: 1002</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1534938914, "post_id": 51966179, "comment_id": 90882346, "body": "Try to give simple example, remove unnecessary things while asking questions like testing, command and other external packages."}, {"owner": {"reputation": 13154, "user_id": 2999675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb0b7c8c3b13457a7cb7749d1334d3ae?s=128&d=identicon&r=PG&f=1", "display_name": "Hello lad", "link": "https://stackoverflow.com/users/2999675/hello-lad"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534941244, "post_id": 51966179, "comment_id": 90883925, "body": "@nilsocket  thanks for the comment. I have reedited the question :)"}, {"owner": {"reputation": 13154, "user_id": 2999675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb0b7c8c3b13457a7cb7749d1334d3ae?s=128&d=identicon&r=PG&f=1", "display_name": "Hello lad", "link": "https://stackoverflow.com/users/2999675/hello-lad"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1534941297, "post_id": 51966179, "comment_id": 90883945, "body": "@MartinTournoij  Scan() function, outputs nothing. I try to make a MCV example"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 3, "creation_date": 1534941981, "post_id": 51966179, "comment_id": 90884381, "body": "<code>package main  import ( \t&quot;bufio&quot; \t&quot;fmt&quot; \t&quot;log&quot; \t&quot;os&quot; \t&quot;os&#47;exec&quot; )  func main() { \tcmd := exec.Command(&quot;ls&quot;, &quot;-l&quot;, &quot;-h&quot;) \tcmd.Stdin = os.Stdin \tstdout, _ := cmd.StdoutPipe() \tb := bufio.NewScanner(stdout) \terr := cmd.Start() \tif err != nil { \t\tlog.Println(err) \t} \tfor b.Scan() { \t\tfmt.Println(b.Text()) \t} } </code>You didn&#39;t start the command, you should start the command once all parameters were set. The above example just work&#39;s fine."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534945587, "post_id": 51966179, "comment_id": 90886914, "body": "Also <code>Scanner.Scan()</code> isn&#39;t <i>supposed</i> to output anything. It <i>returns</i> a value (which you&#39;re discarding), it prints nothing."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534947195, "post_id": 51966179, "comment_id": 90887970, "body": "@nilsocket That looks like an answer. It should probably be posted as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": false, "score": 2, "last_activity_date": 1534947706, "creation_date": 1534947706, "answer_id": 51968998, "question_id": 51966179, "link": "https://stackoverflow.com/questions/51966179/bufio-newscanner-scan-hangs-the-program/51968998#51968998", "title": "bufio.NewScanner.Scan hangs the program", "body": "<p>Comments were added where ever required.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    //args should be specified as you provide them in terminal\n    cmd := exec.Command(\"ls\", \"-l\", \"-h\")\n    //set all required parameters\n    cmd.Stdin = os.Stdin\n    stdout, _ := cmd.StdoutPipe()\n    b := bufio.NewScanner(stdout)\n    //start the command\n    err := cmd.Start()\n    if err != nil {\n        log.Println(err)\n    }\n    //see if you have something, until EOF\n    //b.Scan() blocks until you get some input, or EOF\n    //It's something like streaming input.\n    for b.Scan() {\n        //print the input\n        fmt.Println(b.Text())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13154, "user_id": 2999675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb0b7c8c3b13457a7cb7749d1334d3ae?s=128&d=identicon&r=PG&f=1", "display_name": "Hello lad", "link": "https://stackoverflow.com/users/2999675/hello-lad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1534947706, "creation_date": 1534938400, "last_edit_date": 1534942713, "question_id": 51966179, "link": "https://stackoverflow.com/questions/51966179/bufio-newscanner-scan-hangs-the-program", "title": "bufio.NewScanner.Scan hangs the program", "body": "<p>I have the following code snippet</p>\n\n<pre><code>package main\nimport (\n  \"os/exec\"\n  \"bufio\"\n  \"fmt\"\n)\n\nfunc main() {\n  cmd := exec.Command(\"terraform\", \"init\")\n  cmd.Dir = \"\"\n  stdout, _ := cmd.StdoutPipe()\n  stdoutScanner := bufio.NewScanner(stdout)\n  stdoutScanner.Scan()\n  fmt.Println(\"End of main\")\n}\n</code></pre>\n\n<p>stdoutScanner.Scan() hangs forever without any outputs</p>\n\n<p>I am in a VPC with proxy.</p>\n\n<p>Is there any possible reason why this happens ?</p>\n"}, {"tags": ["git", "go", "exec"], "answers": [{"tags": [], "owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "is_accepted": true, "score": 8, "last_activity_date": 1534938359, "creation_date": 1534938359, "answer_id": 51966161, "question_id": 51966053, "link": "https://stackoverflow.com/questions/51966053/what-is-wrong-with-invoking-git-shortlog-from-go-exec/51966161#51966161", "title": "What is wrong with invoking `git shortlog` from Go &#39;exec()&#39;?", "body": "<p>Turns out, I was able to find the answer by re-reading the <a href=\"https://git-scm.com/docs/git-shortlog\" rel=\"noreferrer\">git docs</a></p>\n\n<p>The answer was in this line:</p>\n\n<blockquote>\n  <p>If no revisions are passed on the command line and either <strong>standard input is not a terminal</strong> or there is no current branch, git shortlog will output a summary of the log read from standard input, without reference to the current repository.</p>\n</blockquote>\n\n<p>Despite the fact that I can run <code>git shortlog</code> from the terminal and see expected output, when running via the <code>exec()</code> command, I need to specify the branch.</p>\n\n<p>So in the above examples, I added 'master' to the command arguments like so:</p>\n\n<pre><code>cmdOut, err := exec.Command(\"git\", \"shortlog\", \"master\").Output()\n</code></pre>\n\n<p>And everything works as expected.</p>\n"}], "owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 51966161, "answer_count": 1, "score": 3, "last_activity_date": 1534938359, "creation_date": 1534938005, "last_edit_date": 1592644375, "question_id": 51966053, "link": "https://stackoverflow.com/questions/51966053/what-is-wrong-with-invoking-git-shortlog-from-go-exec", "title": "What is wrong with invoking `git shortlog` from Go &#39;exec()&#39;?", "body": "<p>I'm trying to invoke <code>git shortlog</code> from Go to grab the output, but I'm running into a wall.</p>\n<p>Here's a working example of how I'm able to do this with <code>git log</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;os/exec&quot;\n)\n\nfunc main() {\n    runBasicExample()\n}\n\nfunc runBasicExample() {\n    cmdOut, err := exec.Command(&quot;git&quot;, &quot;log&quot;).Output()\n    if err != nil {\n        fmt.Fprintln(os.Stderr, &quot;There was an error running the git command: &quot;, err)\n        os.Exit(1)\n    }\n    output := string(cmdOut)\n    fmt.Printf(&quot;Output: \\n%s\\n&quot;, output)\n}\n</code></pre>\n<p>Which gives expected output:</p>\n<pre><code>$&gt;  go run show-commits.go \nOutput: \ncommit 4abb96396c69fa4e604c9739abe338e03705f9d4\nAuthor: TheAndruu\nDate:   Tue Aug 21 21:55:07 2018 -0400\n\n    Updating readme\n</code></pre>\n<h2>But I really want to do this with <code>git shortlog</code>.</h2>\n<p>For some reason... I just can't get it to work with shortlog.  Here's the program again, with the only change being the git command line:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;os/exec&quot;\n)\n\nfunc main() {\n    runBasicExample()\n}\n\nfunc runBasicExample() {\n    cmdOut, err := exec.Command(&quot;git&quot;, &quot;shortlog&quot;).Output()\n    if err != nil {\n        fmt.Fprintln(os.Stderr, &quot;There was an error running the git command: &quot;, err)\n        os.Exit(1)\n    }\n    output := string(cmdOut)\n    fmt.Printf(&quot;Output: \\n%s\\n&quot;, output)\n}\n</code></pre>\n<p>With empty output:</p>\n<pre><code>$&gt;  go run show-commits.go \nOutput: \n</code></pre>\n<p>I can run <code>git shortlog</code> directly from the command line and it seems to work fine.  Checking the <a href=\"https://git-scm.com/docs/git-shortlog\" rel=\"nofollow noreferrer\">docs</a>, I'm led to believe the 'shortlog' command is part of git itself.</p>\n<p>Can anyone help point out what I could do different?</p>\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1534937462, "post_id": 51965870, "comment_id": 90881512, "body": "Show us what you have tried so far in code."}], "answers": [{"comments": [{"owner": {"reputation": 7356, "user_id": 4732175, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/w2Po6.jpg?s=128&g=1", "display_name": "Zhang Buzz", "link": "https://stackoverflow.com/users/4732175/zhang-buzz"}, "edited": false, "score": 0, "creation_date": 1534943563, "post_id": 51966003, "comment_id": 90885468, "body": "Thanks! It works!"}], "tags": [], "owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "is_accepted": true, "score": 2, "last_activity_date": 1534937820, "creation_date": 1534937820, "answer_id": 51966003, "question_id": 51965870, "link": "https://stackoverflow.com/questions/51965870/how-to-get-hour-of-specified-timezone-in-go-language/51966003#51966003", "title": "How to get Hour() of specified timezone in Go language?", "body": "<p>Just use <code>In()</code> function and it should work. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    loc, _ := time.LoadLocation(\"Europe/Berlin\")\n\n    t := time.Now().In(loc)\n    fmt.Println(t.Hour())\n}\n</code></pre>\n"}], "owner": {"reputation": 7356, "user_id": 4732175, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/w2Po6.jpg?s=128&g=1", "display_name": "Zhang Buzz", "link": "https://stackoverflow.com/users/4732175/zhang-buzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "closed_date": 1534945606, "accepted_answer_id": 51966003, "answer_count": 1, "score": -1, "last_activity_date": 1534937820, "creation_date": 1534937355, "question_id": 51965870, "link": "https://stackoverflow.com/questions/51965870/how-to-get-hour-of-specified-timezone-in-go-language", "closed_reason": "Not suitable for this site", "title": "How to get Hour() of specified timezone in Go language?", "body": "<p>When I use Hour() function, it keeps return the UTC hour. How to get the correct Hour number with specified Timezone? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1534934908, "post_id": 51964971, "comment_id": 90880144, "body": "What have you tried? What problems did you have?"}, {"owner": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534935009, "post_id": 51964971, "comment_id": 90880191, "body": "This is what I had before I posted : ({{media url=.*?}})"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534935033, "post_id": 51964971, "comment_id": 90880206, "body": "So what is the problem?"}], "answers": [{"comments": [{"owner": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534934966, "post_id": 51965131, "comment_id": 90880164, "body": "Thanks. I needed to add ? after .* otherwise it took everything. What about replacing it with the appended value? I need to replace every instance of these, there could be any number of them and replace it with  <a href=\"https://img.abc.com/xyz/valueOfURL\" rel=\"nofollow noreferrer\">img.abc.com/xyz/valueOfURL</a> from ab"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534935157, "post_id": 51965131, "comment_id": 90880281, "body": "If it&#39;s from a string that you want to replace it, what you need is to use <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\">strings.Replace</a>."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534935496, "post_id": 51965131, "comment_id": 90880469, "body": "I&#39;ll update the answer with the whole thing"}, {"owner": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534935514, "post_id": 51965131, "comment_id": 90880484, "body": "Thanks :).........."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534935797, "post_id": 51965131, "comment_id": 90880624, "body": "The example I originally put also captured the double quotes, fixed it now it should do exactly what you want. For next time though, when asking a question here, please include at least a piece of code that you wrote as an attempt, and we&#39;ll guide you through making it work, rather than code it for you :p"}, {"owner": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "edited": false, "score": 0, "creation_date": 1534935927, "post_id": 51965131, "comment_id": 90880685, "body": "Sure. The new code does not seem to be working though. <a href=\"https://play.golang.org/p/AfeoxBIa2Oy\" rel=\"nofollow noreferrer\">play.golang.org/p/AfeoxBIa2Oy</a> @Ullaakut"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 1, "last_activity_date": 1534937126, "last_edit_date": 1534937126, "creation_date": 1534934786, "answer_id": 51965131, "question_id": 51964971, "link": "https://stackoverflow.com/questions/51964971/regex-to-match-string-value-and-replace-all-occurrences-in-golang/51965131#51965131", "title": "regex to match string value and replace all occurrences in golang", "body": "<p><code>({{(media|skin) url=\\\\\"(.*)\\\\\"}})</code> should do the job.</p>\n\n<p>It also will allow you to get the type (media or skin) as a string in your code for further use if needed.</p>\n\n<p>For example, this code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n\n    re := regexp.MustCompile(`{{(media|skin) url=.*}}`)\n    stringMedia := \"{{media url=\\\"wysiwyg/Out_story.png\\\"}}\"\n    stringSkin := \"{{skin url=\\\"wysiwyg/Out_story.png\\\"}}\"\n\n    match := re.FindStringSubmatch(stringMedia)\n    if len(match) != 0 {\n        fmt.Printf(\"1. %s\\n\", match[1])\n    }\n\n    match = re.FindStringSubmatch(stringSkin)\n    if len(match) != 0 {\n        fmt.Printf(\"2. %s\\n\", match[1])\n    }\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<pre><code>1. media\n2. skin\n</code></pre>\n\n<p>Then, to replace the match with the URL it contained, you can do something like this (Note the tweaks to the regexp to capture the full match as well as the url independently):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n\n    re := regexp.MustCompile(`({{(media|skin) url=\\\\\"(.*)\\\\\"}})`)\n    stringMedia := \"other stuff {{media url=\\\"wysiwyg/Out_story.png\\\"}} other stuff\"\n    stringSkin := \"other stuff {{skin url=\\\"wysiwyg/Out_story.png\\\"}} other stuff\"\n\n    match := re.FindStringSubmatch(stringMedia)\n    if len(match) != 0 {\n        stringMedia = strings.Replace(stringMedia, match[1], fmt.Sprintf(\"https://img.abc.com/xyz/%s\", match[3]), -1)\n        fmt.Println(stringMedia)\n    }\n\n    match = re.FindStringSubmatch(stringSkin)\n    if len(match) != 0 {\n        stringSkin = strings.Replace(stringSkin, match[1], fmt.Sprintf(\"https://img.abc.com/xyz/%s\", match[3]), -1)\n        fmt.Println(stringSkin)\n    }\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>other stuff https://img.abc.com/xyz/wysiwyg/Out_story.png other stuff\nother stuff https://img.abc.com/xyz/wysiwyg/Out_story.png other stuff\n</code></pre>\n\n<p>You can test it out yourself on <a href=\"https://regex-golang.appspot.com/assets/html/index.html\" rel=\"nofollow noreferrer\">regex-golang.appspot.com</a> or on the <a href=\"https://play.golang.org/p/Kj2EG4gqzyO\" rel=\"nofollow noreferrer\">playground</a>.</p>\n"}], "owner": {"reputation": 2866, "user_id": 2699001, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/09lZu.jpg?s=128&g=1", "display_name": "S Khurana", "link": "https://stackoverflow.com/users/2699001/s-khurana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1329, "favorite_count": 0, "closed_date": 1534939959, "accepted_answer_id": 51965131, "answer_count": 1, "score": -4, "last_activity_date": 1534937126, "creation_date": 1534934240, "question_id": 51964971, "link": "https://stackoverflow.com/questions/51964971/regex-to-match-string-value-and-replace-all-occurrences-in-golang", "closed_reason": "Not suitable for this site", "title": "regex to match string value and replace all occurrences in golang", "body": "<p>what would be the regex to match string </p>\n\n<pre><code>\"{{media url=\\\"wysiwyg/Out_story.png\\\"}}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>\"{{skin url=\\\"wysiwyg/Out_story.png\\\"}}\n</code></pre>\n\n<p>in Golang</p>\n\n<p>I need to replace every instance of these, there could be any number of them and replace it with</p>\n\n<p><code>https://img.abc.com/xyz/valueOfURL</code> from above</p>\n"}, {"tags": ["go", "types", "interface"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534937182, "last_edit_date": 1534937182, "creation_date": 1534932252, "answer_id": 51964441, "question_id": 51964392, "link": "https://stackoverflow.com/questions/51964392/golang-source-code-why-write-in-this-way/51964441#51964441", "title": "golang source code why write in this way", "body": "<p>This is used to check the if type T implements an interface I.</p>\n\n<pre><code>var _ errcode.ErrorCode = (*StoreTombstonedErr)(nil) // assert implements interface\nvar _ errcode.ErrorCode = (*StoreBlockedErr)(nil) \n</code></pre>\n\n<p>In above code snippet First line checks that <code>StoreTombstonedErr</code> implmenets <code>errcode.ErrorCode</code></p>\n\n<p>While Second line checks that <code>*StoreBlockedErr</code> implements <code>errcode.ErrorCode</code>. </p>\n\n<blockquote>\n  <p>You can ask the compiler to check that the type T implements the\n  interface I by attempting an assignment using the zero value for T or\n  pointer to T, as appropriate:</p>\n</blockquote>\n\n<pre><code>type T struct{}\nvar _ I = T{}       // Verify that T implements I.\nvar _ I = (*T)(nil) // Verify that *T implements I.\n</code></pre>\n\n<p>If T (or *T, accordingly) doesn't implement I, the mistake will be caught at compile time. </p>\n\n<p>If you wish the users of an interface to explicitly declare that they implement it, you can add a method with a descriptive name to the interface's method set. For example: </p>\n\n<pre><code>type Fooer interface {\n    Foo()\n    ImplementsFooer()\n}\n</code></pre>\n\n<p>A type must then implement the ImplementsFooer method to be a Fooer</p>\n\n<pre><code>type Bar struct{}\nfunc (b Bar) ImplementsFooer() {}\nfunc (b Bar) Foo() {}\n</code></pre>\n"}], "owner": {"reputation": 1071, "user_id": 3296612, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/DXU72.jpg?s=128&g=1", "display_name": "xren", "link": "https://stackoverflow.com/users/3296612/xren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "closed_date": 1534933345, "accepted_answer_id": 51964441, "answer_count": 1, "score": -1, "last_activity_date": 1534937182, "creation_date": 1534932114, "last_edit_date": 1534933238, "question_id": 51964392, "link": "https://stackoverflow.com/questions/51964392/golang-source-code-why-write-in-this-way", "closed_reason": "Duplicate", "title": "golang source code why write in this way", "body": "<p>I saw some golang code and I don't know how it works! Anyone known ?\nWhy write in this way ?</p>\n\n<pre><code>var _ errcode.ErrorCode = (*StoreTombstonedErr)(nil) // assert implements interface\nvar _ errcode.ErrorCode = (*StoreBlockedErr)(nil)    // assert implements interface\n</code></pre>\n\n<p>And the source code link is <a href=\"https://github.com/pingcap/pd/blob/0e216a703776c51cb71f324c36b6b94c1d25b62f/server/core/errors.go#L37\" rel=\"nofollow noreferrer\">https://github.com/pingcap/pd/blob/0e216a703776c51cb71f324c36b6b94c1d25b62f/server/core/errors.go#L37</a></p>\n"}, {"tags": ["go", "google-cloud-datastore", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534956688, "post_id": 51964305, "comment_id": 90893818, "body": "have you checked <a href=\"https://stackoverflow.com/a/36762520/4466350\">stackoverflow.com/a/36762520/4466350</a> ?"}, {"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535002738, "post_id": 51964305, "comment_id": 90907611, "body": "I saw it, but it doesn&#39;t apply here, he was trying to write a child to his incomplete key, I can&#39;t write the item with the incomplete key itself."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535055609, "post_id": 51964305, "comment_id": 90937032, "body": "is parent[0] a complete key itself ?"}, {"owner": {"reputation": 1823, "user_id": 7644371, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K8-GVAQWClY/AAAAAAAAAAI/AAAAAAAAAKY/44LvrIzzJVw/photo.jpg?sz=128", "display_name": "Jim Morrison", "link": "https://stackoverflow.com/users/7644371/jim-morrison"}, "edited": false, "score": 0, "creation_date": 1535061120, "post_id": 51964305, "comment_id": 90939191, "body": "You&#39;ll need to print out newKey at some point to see what is being passed to Put()."}, {"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "reply_to_user": {"reputation": 1823, "user_id": 7644371, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K8-GVAQWClY/AAAAAAAAAAI/AAAAAAAAAKY/44LvrIzzJVw/photo.jpg?sz=128", "display_name": "Jim Morrison", "link": "https://stackoverflow.com/users/7644371/jim-morrison"}, "edited": false, "score": 0, "creation_date": 1535088576, "post_id": 51964305, "comment_id": 90945091, "body": "As far as I can tell it looks good @JimMorrison . <code>newKey: &#47;Inventory,5634161670881280&#47;Supplier,supplier-01&#47;InventoryIt&zwnj;&#8203;em,0</code>. I did realize however, that the namespace is not set on the <code>newKey</code> only on <code>parentKey</code>. Could this be the problem? My understanding was that the parent key would implicitly set the namespace for the new entity but maybe I have to do it explicitly?"}], "answers": [{"comments": [{"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 0, "creation_date": 1535175150, "post_id": 52012998, "comment_id": 90979015, "body": "Thanks Jim, judging from the docs I would have thought this to be either done implicitly via the parent namespace or have a proper method exposed to set the namespace on the new key like you do for queries etc."}], "tags": [], "owner": {"reputation": 1823, "user_id": 7644371, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K8-GVAQWClY/AAAAAAAAAAI/AAAAAAAAAKY/44LvrIzzJVw/photo.jpg?sz=128", "display_name": "Jim Morrison", "link": "https://stackoverflow.com/users/7644371/jim-morrison"}, "is_accepted": true, "score": 1, "last_activity_date": 1535155432, "creation_date": 1535155432, "answer_id": 52012998, "question_id": 51964305, "link": "https://stackoverflow.com/questions/51964305/google-datastore-invalid-key-error/52012998#52012998", "title": "Google Datastore invalid key error", "body": "<p>Tommy, you nailed it in your comment.  You need to set the namespace on your new key.  I don't see a way in the <a href=\"https://godoc.org/cloud.google.com/go/datastore#Key\" rel=\"nofollow noreferrer\">Cloud Datastore Go documentation</a> to do this implicitly, so you'll have to do newKey.namespace = parentKey.namespace before calling Put().</p>\n"}], "owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 0, "accepted_answer_id": 52012998, "answer_count": 1, "score": 0, "last_activity_date": 1535155432, "creation_date": 1534931885, "last_edit_date": 1535100148, "question_id": 51964305, "link": "https://stackoverflow.com/questions/51964305/google-datastore-invalid-key-error", "title": "Google Datastore invalid key error", "body": "<p>I'm trying to put an item to the Google Datastore using golang.</p>\n\n<p>I'm always running into a <code>datastore: invalid key</code> error though and can't figure out what's wrong here. I'm using the <code>\"cloud.google.com/go/datastore\"</code> package.</p>\n\n<p>First I try to get the key for the parent node (not sure this is the right way to do it, but I do end up getting a <code>datastore.Key</code> as <code>parentKey</code>).</p>\n\n<p>When now creating a new key using the <code>parentKey</code> as parent and then trying to <code>put</code> the item with this <code>newKey</code> I get the <code>invalid key</code> error message.</p>\n\n<pre><code>q := datastore.NewQuery(\"Supplier\")\n              .Namespace(\"inventory\")\n              .Filter(\"Name =\", \"supplier-01\")\n              .Limit(1)\nvar s []supplier\nparentKey, err := client.GetAll(ctx, q, &amp;s)\nif err != nil || len(parentKey) &lt; 1 {\n    fmt.Printf(\"could not find parent key: %v\\n\", err)\n    return\n}\nnewKey := datastore.IncompleteKey(\"InventoryItem\", parentKey[0])\n//newKey := datastore.NameKey(\"InventoryItem\", item.Name, parentKey[0])\nif _, err := client.Put(ctx, newKey, &amp;item); err != nil {\n    fmt.Printf(\"could not save item: %v\\n\", err)\n    return\n}\n</code></pre>\n\n<p>I tried it both with the <code>NameKey</code> and <code>IncompleteKey</code> but no luck with either. </p>\n\n<p>I'm obviously missing something here but can't figure out what it is and how to write my item to the datastore as the child of the other node.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1534933734, "post_id": 51964102, "comment_id": 90879536, "body": "Even though that is not the way to create a linked list, what you have written is working fine.It is creating a linked list of 98 values. Here is the <a href=\"https://play.golang.org/p/qc7Bi7kl2Ck\" rel=\"nofollow noreferrer\">code</a> to check it."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6607418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b728d6815ab3d334f69db9afdee4296b?s=128&d=identicon&r=PG&f=1", "display_name": "\u5468\u5929\u661f", "link": "https://stackoverflow.com/users/6607418/%e5%91%a8%e5%a4%a9%e6%98%9f"}, "edited": false, "score": 0, "creation_date": 1534987994, "post_id": 51965521, "comment_id": 90904494, "body": "Thank you, I get it. Now, I use IntelliJ IDEA for my golang leaning, which IDE is ok for this problem?"}, {"owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "reply_to_user": {"reputation": 11, "user_id": 6607418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b728d6815ab3d334f69db9afdee4296b?s=128&d=identicon&r=PG&f=1", "display_name": "\u5468\u5929\u661f", "link": "https://stackoverflow.com/users/6607418/%e5%91%a8%e5%a4%a9%e6%98%9f"}, "edited": false, "score": 0, "creation_date": 1535026270, "post_id": 51965521, "comment_id": 90920361, "body": "The issue could be not from the IDE because almost every IDE uses <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">delv</a> as the debugger. Though if you want to try another IDE give it shot. Try atom for example it&#39;s awesome."}, {"owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "reply_to_user": {"reputation": 11, "user_id": 6607418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b728d6815ab3d334f69db9afdee4296b?s=128&d=identicon&r=PG&f=1", "display_name": "\u5468\u5929\u661f", "link": "https://stackoverflow.com/users/6607418/%e5%91%a8%e5%a4%a9%e6%98%9f"}, "edited": false, "score": 0, "creation_date": 1535026279, "post_id": 51965521, "comment_id": 90920364, "body": "Also, get use to printing everything everywhere for debugging instead of using a debugger in my experience it&#39;s the most effective approach. because there are environments it&#39;s hard to setup a debugger or the debugger performance is awful. e.g. having the binary running on a remote machine or having an embedded board running the program (which is the debugging is done through <a href=\"https://en.wikipedia.org/wiki/JTAG\" rel=\"nofollow noreferrer\">JTAG</a>)."}], "tags": [], "owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "is_accepted": true, "score": 4, "last_activity_date": 1534940111, "last_edit_date": 1534940111, "creation_date": 1534936102, "answer_id": 51965521, "question_id": 51964102, "link": "https://stackoverflow.com/questions/51964102/i-cant-create-a-long-linked-list/51965521#51965521", "title": "I can&#39;t create a long linked list", "body": "<p>Your linked list is working fine although it's not the right way to create linked lists. The reason that you only 3 nodes is your debugger tracing limitations. I wrote a printing loop to show the values in the linked list.</p>\n\n<pre><code>package main\n\nfunc main() {\n    var arr [99]ListNode\n    for i := 0; i &lt; 99; i++ {\n        var tempArr ListNode\n        tempArr.Val = i\n        arr[i] = tempArr\n    }\n    for i := 0; i &lt; 98; i++ {\n        arr[i].Next = &amp;arr[i+1]\n    }\n}\n\ntype ListNode struct {\n    Val  int\n    Next *ListNode\n}\n</code></pre>\n\n<p>Also I wrote another code to show how you can create linked lists in its proper way.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    start := &amp;ListNode{}\n    node := start\n    for i := 0; i &lt; 100; i++ {\n        node.Val = i\n        node.Next = &amp;ListNode{}\n        node = node.Next\n    }\n    for node := start; node.Next != nil; node = node.Next {\n        fmt.Printf(\"%d -&gt; \", node.Val)\n    }\n}\n\ntype ListNode struct {\n    Val  int\n    Next *ListNode\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6607418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b728d6815ab3d334f69db9afdee4296b?s=128&d=identicon&r=PG&f=1", "display_name": "\u5468\u5929\u661f", "link": "https://stackoverflow.com/users/6607418/%e5%91%a8%e5%a4%a9%e6%98%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 51965521, "answer_count": 1, "score": -1, "last_activity_date": 1535026146, "creation_date": 1534931247, "last_edit_date": 1534940097, "question_id": 51964102, "link": "https://stackoverflow.com/questions/51964102/i-cant-create-a-long-linked-list", "title": "I can&#39;t create a long linked list", "body": "<pre><code>package main\n\nfunc main() {\n    var arr [99]ListNode\n    for i := 0; i &lt; 99; i++ {\n        var tempArr ListNode\n        tempArr.Val = i\n        arr[i] = tempArr\n    }\n    for i := 0; i &lt; 98; i++ {\n        arr[i].Next = &amp;arr[i+1]\n    }\n}\n\ntype ListNode struct {\n    Val  int\n    Next *ListNode\n}\n</code></pre>\n\n<p>I want to create a linked list with 99 elements, but it breaks every 3 node. See the image below for more information:</p>\n\n<p><img src=\"https://i.stack.imgur.com/hybgo.jpg\" alt=\"image\"></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 957, "user_id": 2100994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6Dre.jpg?s=128&g=1", "display_name": "Stef Geysels", "link": "https://stackoverflow.com/users/2100994/stef-geysels"}, "edited": false, "score": 1, "creation_date": 1534931125, "post_id": 51963049, "comment_id": 90878126, "body": "Down-votes without explanation? As for a new member, this isn&#39;t useful and wouldn&#39;t help improve his question."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1534966926, "post_id": 51963049, "comment_id": 90898496, "body": "One of the major issues is your append.  You&#39;re creating <code>rest</code> with <i>length</i> equal to the length of columnNames (I&#39;m assuming from context that this is 18).  You are appending <i>after</i> those initial 18 (empty) entries the values stored in the objects slice, on each row scan.  So the length of <code>rest</code> will be len(columnNames) * (numRows + 1), with the first columnNames entries being empty values.  If you want to create an array with a <i>capacity</i> but 0 length, you need to do <code>rest = make([]interface, 0, len(columnNames))</code>.  This avoids append allocating, but lets you append starting at index 0."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 0, "creation_date": 1534928477, "post_id": 51963211, "comment_id": 90876622, "body": "Is there another way to do this? I want to post these operations by function, i.e. separately make the select function and insert function"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 1, "creation_date": 1534928553, "post_id": 51963211, "comment_id": 90876670, "body": "I&#39;m sure there are countless ways to do this. But I don&#39;t understand your requirement, so I&#39;m not sure what to suggest."}, {"owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 0, "creation_date": 1534929152, "post_id": 51963211, "comment_id": 90877021, "body": "The output I want to have two functions. One select function that returns an interface with data. The second insert function that accepts this interface."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 1, "creation_date": 1534929376, "post_id": 51963211, "comment_id": 90877129, "body": "interfaces don&#39;t have data. So I&#39;m not really sure what you mean. But you also seem to be focusing on your specific solution, rather than the problem, which makes this seem like a bit of an XY Problem."}, {"owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 0, "creation_date": 1534930304, "post_id": 51963211, "comment_id": 90877654, "body": "OK. If you take the problem. The select function returns a structure with data? How do I write an insert function to accept this structure as input?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "edited": false, "score": 1, "creation_date": 1534930564, "post_id": 51963211, "comment_id": 90877806, "body": "That&#39;s exactly what my answer tells you to do."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1534928296, "creation_date": 1534928296, "answer_id": 51963211, "question_id": 51963049, "link": "https://stackoverflow.com/questions/51963049/cannot-insert-data-into-database-after-retrieval/51963211#51963211", "title": "Cannot insert data into database after retrieval", "body": "<p>You're joining all of your rows into a single <code>rest</code> variable, then trying to insert them all into a single row in Postgres. This obviously won't work.</p>\n\n<p>You probably need to move your <code>db.Insert</code> statement into your <code>rows.Next()</code> loop, and do one insert per row.</p>\n"}], "owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1534928327, "creation_date": 1534927726, "last_edit_date": 1534928327, "question_id": 51963049, "link": "https://stackoverflow.com/questions/51963049/cannot-insert-data-into-database-after-retrieval", "title": "Cannot insert data into database after retrieval", "body": "<p>Need help extracting data from database ms sql and add them to the database postgres. The data extraction is successful. But with the insert problem. I can't break the interface down into 18.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n\n    _ \"github.com/denisenkom/go-mssqldb\"\n    _ \"github.com/lib/pq\"\n)\n\nconst (\n// config to connect to ms sql server\n\n// config to connect to PostgreSQL\n\n)\n\nfunc main() {\n    connStringmssql := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d;database=%s;\", server, user, password, port, database)\n    db, err := connect(\"mssql\", connStringmssql)\n    checkError(\"Error mssql connect function \", err)\n    defer db.Close()\n    defer fmt.Printf(\"Disconnected mssql!\\n\")\n\n    connStringpg := fmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s sslmode=%s\", serverpg, portpg, userpg, passwordpg, databasepg, \"disable\")\n    dbpg, err := connect(\"postgres\", connStringpg)\n    checkError(\"Error connect function pg \", err)\n    defer dbpg.Close()\n    defer fmt.Printf(\"Disconnected pg!\\n\")\n\n    // Read sql query from file and convert it\n    mssqlSelectQueryUnConvert, err := ioutil.ReadFile(\"./sql/mssqlSelect.sql\")\n    checkError(\"Error read sql file\", err)\n    mssqlSelectQuery := string(mssqlSelectQueryUnConvert)\n\n    rows, err := db.Query(mssqlSelectQuery)\n    checkError(\"Error in sql query \", err)\n    defer rows.Close()\n    columnNames, err := rows.Columns()\n    checkError(\"Error sql columns names \", err)\n\n    objects := make([]interface{}, len(columnNames))\n    objectsScan := make([]interface{}, len(columnNames))\n    rest := make([]interface{}, len(columnNames))\n    for i := range objects {\n        objectsScan[i] = &amp;objects[i]\n    }\n\n    for rows.Next() {\n        err = rows.Scan(objectsScan...)\n        if err != nil {\n            fmt.Println(\"Failed to scan row\", err)\n            return\n        }\n        rest = append(rest, objects...)\n    }\n    fmt.Println(rest)\n\n    dbInsert, err := dbpg.Exec(\"INSERT INTO object_test (column1...column18) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18)\", rest...)\n    checkError(\"Error dbpg insert \", err)\n    fmt.Println(dbInsert.RowsAffected())\n}\n</code></pre>\n\n<p>I get error:\nError dbpg insert pq: got 54 parameters but the statement requests 18</p>\n\n<p>Where did I go wrong?\nThanks.</p>\n"}, {"tags": ["c#", "multithreading", "go", "task-parallel-library"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534945902, "post_id": 51962682, "comment_id": 90887128, "body": "Where do goroutines claim to be faster than TPL?"}, {"owner": {"reputation": 1215, "user_id": 3205479, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3fe387946a5449c6cff2c78549c8cecc?s=128&d=identicon&r=PG&f=1", "display_name": "user3205479", "link": "https://stackoverflow.com/users/3205479/user3205479"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534952843, "post_id": 51962682, "comment_id": 90891591, "body": "@Adrian I have already mentioned correct me if my assumptions are wrong. Sorry it was my assumption"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534952919, "post_id": 51962682, "comment_id": 90891633, "body": "The quoted paragraph about Go states that goroutines are more efficient than <i>threads</i>, which they are. I&#39;m not aware of any official statement either way comparing goroutines to TPL."}, {"owner": {"reputation": 1215, "user_id": 3205479, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3fe387946a5449c6cff2c78549c8cecc?s=128&d=identicon&r=PG&f=1", "display_name": "user3205479", "link": "https://stackoverflow.com/users/3205479/user3205479"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534953026, "post_id": 51962682, "comment_id": 90891702, "body": "@Adrian Do you think goroutines and TPL are one and the same?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534953142, "post_id": 51962682, "comment_id": 90891774, "body": "No, goroutines are a feature of Go, TPL is a feature of C#, they are completely separate and distinct implementations of the same basic programming concept. I don&#39;t think anyone would claim they are the same thing, though some might claim they are roughly equivalent."}], "answers": [{"comments": [{"owner": {"reputation": 219328, "user_id": 15498, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wi4EN.png?s=128&g=1", "display_name": "Damien_The_Unbeliever", "link": "https://stackoverflow.com/users/15498/damien-the-unbeliever"}, "edited": false, "score": 5, "creation_date": 1534935476, "post_id": 51964790, "comment_id": 90880460, "body": "On the other hand, <code>async</code>/<code>await</code> aren&#39;t tied to particular operations (you can even write your own awaitables if <code>Task</code> isn&#39;t the right abstraction) and if you&#39;re doing it right, you end up not tying up <a href=\"https://blog.stephencleary.com/2013/11/there-is-no-thread.html\" rel=\"nofollow noreferrer\">any threads at all</a>. At least as currently implemented in C#."}, {"owner": {"reputation": 3343, "user_id": 442396, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2c7ec89489bfcad5a94119f7bd9a1abf?s=128&d=identicon&r=PG", "display_name": "Sentinel", "link": "https://stackoverflow.com/users/442396/sentinel"}, "edited": false, "score": 0, "creation_date": 1540536103, "post_id": 51964790, "comment_id": 92909645, "body": "Yeah this sounds like async/await"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 6, "last_activity_date": 1534935876, "last_edit_date": 1534935876, "creation_date": 1534933490, "answer_id": 51964790, "question_id": 51962682, "link": "https://stackoverflow.com/questions/51962682/implementation-of-go-routines-vs-task-parallel-library/51964790#51964790", "title": "Implementation of Go-routines vs Task Parallel Library", "body": "<p>The chief difference is that Go runtime tightly couples scheduling of the goroutines with I/O which basically works like this: if a goroutine is about to block on some I/O operation or on a channel operation, the scheduler suspends that goroutine and re-activates it once it knows the original I/O or channel operation can now proceed. This allows writing Go code in purely sequential manner\u2014without all the callback hell and \"futures\"/\"promises\" kludges, which merely wraps callbacks into objects, and also without <code>async</code>/<code>await</code> machinery which, again, merely couples compiler tricks with plain OS threads.</p>\n\n<p>This stuff is very good explained in <a href=\"http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"noreferrer\">this classic piece</a> by one of the developers of the Dart programming language.</p>\n\n<p>Also see <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"noreferrer\">this</a> and <a href=\"https://rakyll.org/scheduler/\" rel=\"noreferrer\">this</a>.</p>\n"}], "owner": {"reputation": 1215, "user_id": 3205479, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3fe387946a5449c6cff2c78549c8cecc?s=128&d=identicon&r=PG&f=1", "display_name": "user3205479", "link": "https://stackoverflow.com/users/3205479/user3205479"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1528, "favorite_count": 1, "accepted_answer_id": 51964790, "answer_count": 1, "score": 4, "last_activity_date": 1534935876, "creation_date": 1534926334, "last_edit_date": 1534928576, "question_id": 51962682, "link": "https://stackoverflow.com/questions/51962682/implementation-of-go-routines-vs-task-parallel-library", "title": "Implementation of Go-routines vs Task Parallel Library", "body": "<p>I have just started learning Go. The strength of Go lies in goroutines for handling multiple concurrent connections. It was mentioned </p>\n\n<blockquote>\n  <p>Goroutines can be considered as light-weight threads (but not actually threads) which can grow/shrink stack size and these are multiplexed into multiple os threads. Say if you have 1000 goroutines then these are scheduled to native OS threads based on blocking and waiting modes of goroutines.</p>\n</blockquote>\n\n<p>Basically, I am from C# and Nodejs background. I am pretty confused how it is different from TaskParallelLibrary implemented in C#.</p>\n\n<blockquote>\n  <p>TaskParallelLibrary hides the complexity of creating threads and managing them. You just start a task and CLR takes care of mapping them to native threads. Here you can create thousands of tiny tasks which are mapped and scheduled to OS threads. However TPL solves async problems specifically. </p>\n</blockquote>\n\n<p>My question is how TPL is different from goroutines? Do goroutines use coroutines (pausable functions or?). TPL also multiplexes the async/syscalls operations to the thread pool, even Go also multiplexes syscalls to the thread pool.</p>\n\n<p>Correct me if any of my assumptions are wrong. Could anyone help me where exactly the implementation differs? Why do goroutines claim to be faster than TPL?</p>\n"}, {"tags": ["function", "go"], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "edited": false, "score": 0, "creation_date": 1534924319, "post_id": 51962073, "comment_id": 90874421, "body": "yeah! Thanks a lot!"}, {"owner": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "edited": false, "score": 0, "creation_date": 1534924470, "post_id": 51962073, "comment_id": 90874502, "body": "Can You tell me how it works? And all functions types are their return values? e.g <code>func a</code> return int,  when i use <code>a()</code> it values is int, but i use <code>a</code> it value is <code>func a</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "edited": false, "score": 0, "creation_date": 1534925489, "post_id": 51962073, "comment_id": 90875041, "body": "@nhas functions in Go are first class. Learn more here: <a href=\"https://www.google.com/search?q=golang+first+class+functions\" rel=\"nofollow noreferrer\">google.com/search?q=golang+first+class+functions</a>"}, {"owner": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "edited": false, "score": 0, "creation_date": 1534926483, "post_id": 51962073, "comment_id": 90875552, "body": "Yeah, I know. If i call function as <code>a</code> without brackets The name of function is a pointer that point to function. But when i use <code>a()</code> the value is a pointer that point to function return values if It can do. Thanks a lot"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1534928614, "post_id": 51962073, "comment_id": 90876704, "body": "<code>a()</code> calls the a function with no arguments. The function <code>a</code> is executed and you get back the return value from that call. That return value has a certain type (not neccesarily a pointer). <code>func a() int { return 1}</code> returns an int, <code>val := a()</code> will make <code>val</code> an int. While <code>func a() *int { var v int = 1 return &amp;v}</code> <code>val := a()</code>   makes <code>val</code> a pointer to int."}, {"owner": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "edited": false, "score": 0, "creation_date": 1534928980, "post_id": 51962073, "comment_id": 90876905, "body": "Ok, i got it. Thanks"}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": true, "score": 1, "last_activity_date": 1534928832, "last_edit_date": 1534928832, "creation_date": 1534923981, "answer_id": 51962073, "question_id": 51962013, "link": "https://stackoverflow.com/questions/51962013/how-can-i-convert-function-type/51962073#51962073", "title": "How can I convert function type?", "body": "<p>You are calling the <code>upCase</code> function in your call to <code>expand</code> (so it returns a string that you pass to your <code>expand</code> function). You need to pass in the function:</p>\n\n<pre><code>test := expand(s, upCase)\n</code></pre>\n\n<p>Your current code <code>test := expand(s, upCase(s1))</code> is the same as doing:</p>\n\n<pre><code>v := upCase(s1)\ntest := expand(s, v)\n</code></pre>\n\n<p>I.e, you are just calling <code>upCase(s1)</code> that returns a string, and you pass that string to <code>expand</code> , which expects a function, not a string as its 2. argument.</p>\n"}], "owner": {"reputation": 7, "user_id": 9870175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eCAl8iv704s/AAAAAAAAAAI/AAAAAAAAAAk/KIcYIyyooco/photo.jpg?sz=128", "display_name": "nhas", "link": "https://stackoverflow.com/users/9870175/nhas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1534954616, "accepted_answer_id": 51962073, "answer_count": 1, "score": -2, "last_activity_date": 1534928832, "creation_date": 1534923784, "last_edit_date": 1534924269, "question_id": 51962013, "link": "https://stackoverflow.com/questions/51962013/how-can-i-convert-function-type", "closed_reason": "Not suitable for this site", "title": "How can I convert function type?", "body": "<p>I want to use upCase as a variable in expend, But it said \"Cannot use 'upCase(s1)'(type string) as type func(string) string.\nhow can I to convert upCase type? Or what do I need do to make the wrong disappear?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := \"test func\"\n    s1 := \"\"\n    test := expand(s, upCase(s1))\n    fmt.Print(test)\n}\nfunc expand(s string, f func(string) string) string {\n    s1 := \"test\"\n    var s2 string\n    if strings.Contains(s, s1) {\n        // todo \u5b57\u7b26\u4e32\u4e2ds1\u7684\u503c\u66f4\u6539\u4e3af(s1)\u7684\u503c\n        s1 = f(s1)\n        strings.Replace(s1, s, s2, -1)\n    } else {\n        return \"\"\n    }\n    return s2\n}\n\nfunc upCase(s string) string {\n    s = strings.ToUpper(s)\n    return s\n}\n</code></pre>\n"}, {"tags": ["sql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534923667, "post_id": 51961783, "comment_id": 90874113, "body": "It uses the name of your type. Here the type is <code>User</code> so <code>gorm</code> will use the <code>users</code> table by default. You can also configure it to not use the plural form if you&#39;d like."}, {"owner": {"reputation": 143, "user_id": 8581594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c418cdca47ec082b36675911ba3a5501?s=128&d=identicon&r=PG&f=1", "display_name": "\u0428\u0435\u0440\u0437\u043e\u0434 \u0401\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/8581594/%d0%a8%d0%b5%d1%80%d0%b7%d0%be%d0%b4-%d0%81%d1%80%d0%be%d0%b2"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534924224, "post_id": 51961783, "comment_id": 90874373, "body": "@Ullaakut how to do that?"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 2, "creation_date": 1534925301, "post_id": 51961783, "comment_id": 90874954, "body": "<a href=\"http://gorm.io/docs/conventions.html#Pluralized-Table-Name\" rel=\"nofollow noreferrer\">gorm.io/docs/conventions.html#Pluralized-Table-Name</a> this should explain you how to use custom table names"}], "owner": {"reputation": 143, "user_id": 8581594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c418cdca47ec082b36675911ba3a5501?s=128&d=identicon&r=PG&f=1", "display_name": "\u0428\u0435\u0440\u0437\u043e\u0434 \u0401\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/8581594/%d0%a8%d0%b5%d1%80%d0%b7%d0%be%d0%b4-%d0%81%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 592, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1539070347, "creation_date": 1534922913, "last_edit_date": 1539070347, "question_id": 51961783, "link": "https://stackoverflow.com/questions/51961783/how-does-gorm-determine-which-table-to-use", "title": "How does gorm determine which table to use?", "body": "<p>I want connect to SQL SERVER using gorm. I've read documentation how to create new record in table. There is a code:</p>\n\n<pre><code>user := User{Name: \"Jinzhu\", Age: 18, Birthday: time.Now()}\n\ndb.NewRecord(user) // =&gt; returns `true` as primary key is blank\n\ndb.Create(&amp;user)\n\ndb.NewRecord(user) // =&gt; return `false` after `user` created\n</code></pre>\n\n<p>I do not understand, how <code>gorm</code> indicate which table is inserting current record? By struct field or what? </p>\n"}, {"tags": ["json", "go", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 6, "last_activity_date": 1534924943, "last_edit_date": 1534924943, "creation_date": 1534922899, "answer_id": 51961778, "question_id": 51961358, "link": "https://stackoverflow.com/questions/51961358/how-do-you-marshal-a-sql-nullstring-such-that-the-output-is-flattened-to-give-ju/51961778#51961778", "title": "How do you marshal a sql.NullString such that the output is flattened to give just the value in go?", "body": "<p>You cannot, at least not using just <code>sql.NullString</code> and <code>encoding/json</code>.</p>\n\n<p>What you can do is to declare a custom type that embeds <code>sql.NullString</code> and have that custom type implement the <code>json.Marshaler</code> interface.</p>\n\n<pre><code>type MyNullString struct {\n    sql.NullString\n}\n\nfunc (s MyNullString) MarshalJSON() ([]byte, error) {\n    if s.Valid {\n        return json.Marshal(s.String)\n    }\n    return []byte(`null`), nil\n}\n\ntype Company struct {\n    ID   int          `json:\"id\"`              \n    Abn  MyNullString `json:\"abn,string\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Ak_D6QgIzLb\" rel=\"noreferrer\">https://play.golang.org/p/Ak_D6QgIzLb</a></p>\n"}, {"tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": true, "score": 7, "last_activity_date": 1534924837, "last_edit_date": 1534924837, "creation_date": 1534923358, "answer_id": 51961903, "question_id": 51961358, "link": "https://stackoverflow.com/questions/51961358/how-do-you-marshal-a-sql-nullstring-such-that-the-output-is-flattened-to-give-ju/51961903#51961903", "title": "How do you marshal a sql.NullString such that the output is flattened to give just the value in go?", "body": "<p>Here is the code,</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\n//Company details\ntype Company struct {\n    ID  int        `json:\"id\"`\n    Abn NullString `json:\"abn\"`\n}\n\n//NullString is a wrapper around sql.NullString\ntype NullString sql.NullString\n\n//MarshalJSON method is called by json.Marshal,\n//whenever it is of type NullString\nfunc (x *NullString) MarshalJSON() ([]byte, error) {\n    if !x.Valid {\n        return []byte(\"null\"), nil\n    }\n    return json.Marshal(x.String)\n}\n\nfunc main() {\n    company := &amp;Company{}\n    company.ID = 68\n    //create new NullString value\n    nStr := sql.NullString{String: \"hello\", Valid: true}\n    //cast it\n    company.Abn = NullString(nStr)\n    result, err := json.Marshal(company)\n    if err != nil {\n        log.Println(err)\n    }\n    fmt.Println(string(result))\n}\n</code></pre>\n\n<p><a href=\"https://medium.com/aubergine-solutions/how-i-handled-null-possible-values-from-database-rows-in-golang-521fb0ee267\" rel=\"noreferrer\">Here</a> is the blog post which explains it in detail.</p>\n"}, {"tags": [], "owner": {"reputation": 958, "user_id": 515241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63e7de4b75e622a5f6ee9d10b2909934?s=128&d=identicon&r=PG", "display_name": "Tomek Cejner", "link": "https://stackoverflow.com/users/515241/tomek-cejner"}, "is_accepted": false, "score": 2, "last_activity_date": 1597089803, "creation_date": 1597089803, "answer_id": 63347246, "question_id": 51961358, "link": "https://stackoverflow.com/questions/51961358/how-do-you-marshal-a-sql-nullstring-such-that-the-output-is-flattened-to-give-ju/63347246#63347246", "title": "How do you marshal a sql.NullString such that the output is flattened to give just the value in go?", "body": "<p>The question suggests that you want to expose your database structure as JSON (presumably REST-ish) API. Unless the project is going to have a short lifespan or the logic layer is trivial, such an approach is considered an antipattern. The internals (database structure) become coupled with the external interface (API) and may result in a high cost of making a change.</p>\n<p>I'm attaching some reads as Google is full of tutorials on how to do the opposite:</p>\n<p><a href=\"https://lostechies.com/jimmybogard/2016/05/12/entities-arent-resources-resources-arent-representations/\" rel=\"nofollow noreferrer\">https://lostechies.com/jimmybogard/2016/05/12/entities-arent-resources-resources-arent-representations/</a></p>\n<p><a href=\"https://thorben-janssen.com/dont-expose-entities-in-api/\" rel=\"nofollow noreferrer\">https://thorben-janssen.com/dont-expose-entities-in-api/</a></p>\n"}], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4667, "favorite_count": 3, "accepted_answer_id": 51961903, "answer_count": 3, "score": 9, "last_activity_date": 1597089803, "creation_date": 1534921251, "last_edit_date": 1534927224, "question_id": 51961358, "link": "https://stackoverflow.com/questions/51961358/how-do-you-marshal-a-sql-nullstring-such-that-the-output-is-flattened-to-give-ju", "title": "How do you marshal a sql.NullString such that the output is flattened to give just the value in go?", "body": "<p>Given a go struct</p>\n\n<pre><code>type Company struct {\n    ID   int             `json:\"id\"`              \n    Abn  sql.NullString  `json:\"abn,string\"`\n}\n</code></pre>\n\n<p>when marshalled with something like this</p>\n\n<pre><code>company := &amp;Company{}\ncompany.ID = 68\ncompany.Abn = \"SomeABN\"\nresult, err := json.Marshal(company)\n</code></pre>\n\n<p>the result is</p>\n\n<pre><code>{\n    \"id\": \"68\",\n    \"abn\": {\n        \"String\": \"SomeABN\",\n        \"Valid\": true\n    }\n}\n</code></pre>\n\n<p>The result desired is </p>\n\n<pre><code>{\n    \"id\": \"68\",\n    \"abn\": \"SomeABN\"\n}\n</code></pre>\n\n<p>I've tried explicitly stating that Abn is a string.</p>\n\n<pre><code>Abn  sql.NullString  `json:\"abn,string\"`\n</code></pre>\n\n<p>which did not change the result.</p>\n\n<p>How do you marshal a sql.NullString such that the output is flattened to give just the value in go?</p>\n\n<p>EDIT</p>\n\n<p>Something like I ended up with after reading the answers from <a href=\"https://stackoverflow.com/users/8256506/nilsocket\">https://stackoverflow.com/users/8256506/nilsocket</a> and <a href=\"https://stackoverflow.com/users/965900/mkopriva\">https://stackoverflow.com/users/965900/mkopriva</a></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"reflect\"\n    //\"github.com/lib/pq\"\n)\n\n/*\n    https://medium.com/aubergine-solutions/how-i-handled-null-possible-values-from-database-rows-in-golang-521fb0ee267\n*/\n\ntype NullString sql.NullString\n\nfunc (x *NullString) MarshalJSON() ([]byte, error) {\n    if !x.Valid {\n        x.Valid = true\n        x.String = \"\"\n        //return []byte(\"null\"), nil\n    }\n    return json.Marshal(x.String)\n}\n\n// Scan implements the Scanner interface for NullString\nfunc (ns *NullString) Scan(value interface{}) error {\n    var s sql.NullString\n    if err := s.Scan(value); err != nil {\n        return err\n    }\n\n    // if nil then make Valid false\n    if reflect.TypeOf(value) == nil {\n        *ns = NullString{s.String, false}\n    } else {\n        *ns = NullString{s.String, true}\n    }\n\n    return nil\n}\n\ntype Company struct {\n    ID                     int             `json:\"id\"`    \n    Abn                    NullString      `json:\"abn\"`         \n}\n</code></pre>\n"}, {"tags": ["algorithm", "go", "crc", "crc32"], "comments": [{"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 1, "creation_date": 1534948444, "post_id": 51960305, "comment_id": 90888841, "body": "To clarify Matt Timmermans answer, the wiki article includes a section on reciprocal polynomials. The wiki article mentions &quot;codeword&quot;, which is a message and an appended CRC, then goes on to explain if all but the first n bits of a codeword are reversed, then the reciprocal polynomial used to generate a new CRC, that CRC will equal the reverse of the first n bits of the codeword. This is not how a LSB CRC can be converted into a MSB CRC."}], "answers": [{"comments": [{"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1534989283, "post_id": 51967128, "comment_id": 90904731, "body": "Thanks, Matt. The table reversal was clearly the thing that I did not try."}, {"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1534989909, "post_id": 51967128, "comment_id": 90904854, "body": "Actually, that doesn&#39;t help completely, you&#39;re still using the MSB table constructor, which is not provided by the standard library."}, {"owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "reply_to_user": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1535022736, "post_id": 51967128, "comment_id": 90918181, "body": "You only have to make the table once, and it won&#39;t affect the speed of the standard library update call.  I don&#39;t understand why you want to avoid making your own table."}, {"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1535028096, "post_id": 51967128, "comment_id": 90921442, "body": "The code I currently have makes the table and does the sum. I was hoping that I could remove those lines and depend on the standard library with a minor addition, It seems this is not possible, so I&#39;ll just leave the implementation I have as it is."}], "tags": [], "owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "is_accepted": false, "score": 2, "last_activity_date": 1534941645, "creation_date": 1534941645, "answer_id": 51967128, "question_id": 51960305, "link": "https://stackoverflow.com/questions/51960305/convert-crc32-sum-from-lsb-first-algorithm-to-sum-for-msb-first-algorithm/51967128#51967128", "title": "Convert CRC32 sum from LSB-first algorithm to sum for MSB-first algorithm", "body": "<p>You can't actually convert a CRC into the reciprocal version, but that is not what you need to do.  You certainly <em>can</em> use the standard library function you have to implement the CRC that you want.</p>\n\n<p>Both update functions do the same thing, but they use a different byte order in the CRC polynomial itself.</p>\n\n<p>To make your MSB table work for the LSB update function, just byte-reverse every entry.  When you're done, byte-reverse the result.</p>\n\n<p>I've shown that in your implementation here:  <a href=\"https://play.golang.org/p/VxuZIrTiens\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VxuZIrTiens</a></p>\n"}, {"comments": [{"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1534989896, "post_id": 51976614, "comment_id": 90904852, "body": "Thanks. At the moment, I&#39;m just using essentially the MSB code I have here."}], "tags": [], "owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "is_accepted": false, "score": 1, "last_activity_date": 1534981803, "creation_date": 1534981803, "answer_id": 51976614, "question_id": 51960305, "link": "https://stackoverflow.com/questions/51960305/convert-crc32-sum-from-lsb-first-algorithm-to-sum-for-msb-first-algorithm/51976614#51976614", "title": "Convert CRC32 sum from LSB-first algorithm to sum for MSB-first algorithm", "body": "<p>That equation is simply how to reverse the bits in the <em>polynomial</em> (G). The only way to derive a forward CRC from a reverse CRC is to reverse the bits of the <em>message</em> as well. Then you can reverse the bits of the resulting CRC. You can reverse the bits of the message with a table lookup, which should be relatively quick. So it <em>may</em> be faster to do that along with the built-in CRC, than to just write your own CRC that does what you need.</p>\n"}, {"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": false, "score": 0, "last_activity_date": 1535103542, "creation_date": 1535103542, "answer_id": 52001622, "question_id": 51960305, "link": "https://stackoverflow.com/questions/51960305/convert-crc32-sum-from-lsb-first-algorithm-to-sum-for-msb-first-algorithm/52001622#52001622", "title": "Convert CRC32 sum from LSB-first algorithm to sum for MSB-first algorithm", "body": "<p>I have implemented a generic <a href=\"https://github.com/snksoft/crc\" rel=\"nofollow noreferrer\">CRC for Go</a>. And I believe what you are after is \"CRC-32/MPEG-2\" in reveng catalog. Yes, name is slightly different, but a rechecked MPEG-TS spec and your question and still believe this is the one you are after. So, you can simply use my implementation with the parameters from reveng catalog. Or if you'd like to have your own implementation for whatever reason, you can still use my code as an example of how to prepare a table and how to use it later. Just keep in mind that LSB is called \"reflected\" there and MSB is not \"reflected\" (which is a naming convention introduced by Ross Williams and followed by most implementations).</p>\n"}], "owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1535103542, "creation_date": 1534915312, "last_edit_date": 1534919610, "question_id": 51960305, "link": "https://stackoverflow.com/questions/51960305/convert-crc32-sum-from-lsb-first-algorithm-to-sum-for-msb-first-algorithm", "title": "Convert CRC32 sum from LSB-first algorithm to sum for MSB-first algorithm", "body": "<p>CRC32 sums can be represented either as least significant bit first or most significant bit first. For example the IEEE CRC32 polynomial can be represented as either <code>0xedb88320</code> or <code>0x4c11db7</code>, with associated changes to the CRC32 algorithm as shown here (Go code).</p>\n\n<p>LSB-first algorithm (reverse representation):</p>\n\n<pre><code>func crc32Update(crc uint32, tab *table, p []byte) uint32 {\n    crc = ^crc\n    for _, v := range p {\n        crc = tab[byte(crc)^v] ^ (crc &gt;&gt; 8)\n    }\n    return ^crc\n}\n</code></pre>\n\n<p>MSB-first algorithm (normal representation):</p>\n\n<pre><code>func crc32Update(crc uint32, tab *table, p []byte) uint32 {\n    crc = ^crc\n    for _, v := range p {\n        crc = tab[byte(crc&gt;&gt;24)^v] ^ (crc &lt;&lt; 8)\n    }\n    return ^crc\n}\n</code></pre>\n\n<p>(These have associated bit reversal changes in the CRC32 table construction that I don't include here, but see these two playground implementations for <a href=\"https://play.golang.org/p/KJrgM6i7h7b\" rel=\"nofollow noreferrer\">LSB and MSB</a> including a call to the Go std library implementation).</p>\n\n<p>As described in this <a href=\"https://en.wikipedia.org/wiki/Mathematics_of_cyclic_redundancy_checks#Reversed_representations_and_reciprocal_polynomials\" rel=\"nofollow noreferrer\">wikipedia article</a> it is possible to convert the LSB algorithm sum to an MSB sum. However, it is not clear to me how this would be implemented. As far as I understand, the article linked says that the there is a way to inter-convert between the two sums according to $G(x) = x^nG(x^-1)$, but I don't understand how I would go about using this relationship.</p>\n\n<p>Can anyone point me to documentation explaining this better than the WP article does so that I can code this up?</p>\n\n<p>The reason for this question is that the standard library in Go provides fast LSB-first implementations, but I am having to deal with inputs that have been summed using the MSB-first algorithm (MPEG-TS packet video streams).</p>\n"}, {"tags": ["string", "dictionary", "go", "slice", "memory-optimization"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 2, "creation_date": 1534920871, "post_id": 51959783, "comment_id": 90872766, "body": "This article should help. <a href=\"https://dave.cheney.net/2017/04/26/understand-go-pointers-in-less-than-800-words-or-your-money-back\" rel=\"nofollow noreferrer\">dave.cheney.net/2017/04/26/&hellip;</a>.  Golang use pointer copy. So the result can be garbage collected after the loop."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1534924509, "post_id": 51959783, "comment_id": 90874523, "body": "I like your question, because I am asking myself often the same. The only way to find out is to write tests and benchmarks. After the garbage collector is optimized almost with every Go release there is no correct answer for all Go versions. If you care about memory consumption I would go for version 2. But you need to test if you want to be sure."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1534926363, "creation_date": 1534926363, "answer_id": 51962687, "question_id": 51959783, "link": "https://stackoverflow.com/questions/51959783/garbage-collection-and-correct-usage-of-pointers-in-go/51962687#51962687", "title": "Garbage collection and correct usage of pointers in Go", "body": "<blockquote>\n  <p>Will the [...] be garbage collected correctly?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>You never need to worry that something will be collected which is still in use and you can rely on everything being collected once it is no longer used.</p>\n\n<p>So the question about GC is never \"Will it be collected correctly?\" but \"Do I generate unnecessary garbage?\". Now this actual question does not depend that much on the data <em>structure</em> than on the amount of neu objects created (on the heap). So this is a question about how the data structures are used and much less on the structure itself. Use benchmarks and run go test with -benchmem.</p>\n\n<p>(High end performance might also consider how much work the GC has to do: Scanning pointers might take time. Forget that for now.)</p>\n\n<p>The other relevant question is about memory <em>consumption</em>. Copying a string copies just three words while copying a *string copies one word. So there is not much to safe here by using *string.</p>\n\n<p>So unfortunately there are no clear answers to the relevant questions (amount of garbage generated and total memory consumption). Don't overthink the problem, use what fits your purpose, measure and refactor.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1535021970, "post_id": 51983331, "comment_id": 90917758, "body": "Two nitpicks I think are worth mentioning: 1) the OP should note that since <code>cache</code> is a global variable it cannot be used concurrently by multiple goroutines; if they are about to concurrently fetch/process something, the code has to be structured in a way that each worker goroutine has its own <code>cache</code> variable. 2) The trimming process demonstrated at the answer&#39;s end up producing a spike in memory usage (up to almost twice the space the <code>urls</code> occupies\u2014depending on the <code>cap&#47;len</code> ratio)\u2014until the GC actually collects the source slice. Usually not a big deal but worth considering."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1535022368, "post_id": 51983331, "comment_id": 90917960, "body": "@kostix Yes, good tips. About <code>cache</code> being global: if this <code>tagToUrlMap</code> construction is needed concurrently from multiple goroutines, easiest is to move that <code>cache</code> variable to be local; or if used in different places, it is worth creating its own type and methods for it (and just create values of it where needed)."}, {"owner": {"reputation": 15176, "user_id": 270663, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ff0aefddc23d7231fc266ee5394bf2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Vincent", "link": "https://stackoverflow.com/users/270663/vincent"}, "edited": false, "score": 0, "creation_date": 1535406646, "post_id": 51983331, "comment_id": 91045760, "body": "Thanks for a thorough, in-depth answer. My understanding of pointers to strings was wrong."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1592250939, "last_edit_date": 1592250939, "creation_date": 1535018915, "answer_id": 51983331, "question_id": 51959783, "link": "https://stackoverflow.com/questions/51959783/garbage-collection-and-correct-usage-of-pointers-in-go/51983331#51983331", "title": "Garbage collection and correct usage of pointers in Go", "body": "<p><strong>Foreword:</strong> I released the presented string pool in my <a href=\"https://github.com/icza/gox\" rel=\"nofollow noreferrer\"><code>github.com/icza/gox</code></a> library, see <a href=\"https://godoc.org/github.com/icza/gox/stringsx#Pool\" rel=\"nofollow noreferrer\"><code>stringsx.Pool</code></a>.</p>\n\n<hr>\n\n<p>First some background. <code>string</code> values in Go are represented by a small struct-like data structure <a href=\"https://golang.org/pkg/reflect/#StringHeader\" rel=\"nofollow noreferrer\"><code>reflect.StringHeader</code></a>:</p>\n\n<pre><code>type StringHeader struct {\n        Data uintptr\n        Len  int\n}\n</code></pre>\n\n<p>So basically passing / copying a <code>string</code> value passes / copies this small struct value, which is 2 words only regardless of the length of the <code>string</code>. On 64-bit architectures, it's only 16 bytes, even if the <code>string</code> has a thousand characters. </p>\n\n<p>So basically <code>string</code> values already act as pointers. Introducing another pointer like <code>*string</code> just complicates usage, and you won't really gain any noticable memory. For the sake of memory optimization, forget about using <code>*string</code>.</p>\n\n<blockquote>\n  <p>It works and my first question is what happens to the result data structure after I build the mapping in this way? Will the Image URL string fields be left in memory somehow and the rest of the result will be garbage collected? Or will the result data structure stay in memory until the end of the program because something points to its members?</p>\n</blockquote>\n\n<p>If you have a pointer value pointing to a field of a struct value, then the whole struct will be kept in memory, it can't be garbage collected. Note that although it could be possible to release memory reserved for other fields of the struct, but the current Go runtime and garbage collector does not do so. So to achieve optimal memory usage, you should forget about storing addresses of struct fields (unless you also need the complete struct values, but still, storing field addresses and slice/array element addresses always requires care).</p>\n\n<p><sup>The reason for this is because memory for struct values are allocated as a contiguous segment, and so keeping only a single referenced field would strongly fragment the available / free memory, and would make optimal memory management even harder and less efficient. Defragmenting such areas would also require copying the referenced field's memory area, which would require \"live-changing\" pointer values (changing memory addresses).</sup></p>\n\n<p>So while using pointers to <code>string</code> values may save you some tiny memory, the added complexity and additional indirections make it unworthy.</p>\n\n<p>So what to do then?</p>\n\n<h2>\"Optimal\" solution</h2>\n\n<p>So the cleanest way is to keep using <code>string</code> values.</p>\n\n<p>And there is one more optimization we didn't talk about earlier.</p>\n\n<p>You get your results by unmarshaling a JSON API response. This means that if the same URL or tag value is included multiple times in the JSON response, different <code>string</code> values will be created for them.</p>\n\n<p>What does this mean? If you have the same URL twice in the JSON response, after unmarshaling, you will have 2 distinct <code>string</code> values which will contain 2 different pointers pointing to 2 different allocated byte sequences (string content which otherwise will be the same). The <code>encoding/json</code> package does not do <em><code>string</code> interning</em>.</p>\n\n<p>Here's a little app that proves this:</p>\n\n<pre><code>var s []string\nerr := json.Unmarshal([]byte(`[\"abc\", \"abc\", \"abc\"]`), &amp;s)\nif err != nil {\n    panic(err)\n}\n\nfor i := range s {\n    hdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;s[i]))\n    fmt.Println(hdr.Data)\n}\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/P8dilule4ZI\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>273760312\n273760315\n273760320\n</code></pre>\n\n<p>We see 3 different pointers. They could be the same, as <code>string</code> values are immutable.</p>\n\n<p>The <code>json</code> package does not detect repeating <code>string</code> values because the detection adds memory and computational overhead, which is obviously something unwanted. But in our case we shoot for optimal memory usage, so an \"initial\", additional computation does worth the big memory gain.</p>\n\n<p>So let's do our own string interning. How to do that?</p>\n\n<p>After unmarshaling the JSON result, during building the <code>tagToUrlMap</code> map, let's keep track of <code>string</code> values we have come across, and if the subsequent <code>string</code> value has been seen earlier, just use that earlier value (its string descriptor).</p>\n\n<p>Here's a very simple string interner implementation:</p>\n\n<pre><code>var cache = map[string]string{}\n\nfunc interned(s string) string {\n    if s2, ok := cache[s]; ok {\n        return s2\n    }\n    // New string, store it\n    cache[s] = s\n    return s\n}\n</code></pre>\n\n<p>Let's test this \"interner\" in the example code above:</p>\n\n<pre><code>var s []string\nerr := json.Unmarshal([]byte(`[\"abc\", \"abc\", \"abc\"]`), &amp;s)\nif err != nil {\n    panic(err)\n}\n\nfor i := range s {\n    hdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;s[i]))\n    fmt.Println(hdr.Data, s[i])\n}\n\nfor i := range s {\n    s[i] = interned(s[i])\n}\n\nfor i := range s {\n    hdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;s[i]))\n    fmt.Println(hdr.Data, s[i])\n}\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/uIx9FgpapTU\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>273760312 abc\n273760315 abc\n273760320 abc\n273760312 abc\n273760312 abc\n273760312 abc\n</code></pre>\n\n<p>Wonderful! As we can see, after using our <code>interned()</code> function, only a single instance of the <code>\"abc\"</code> string is used in our data structure (which is actually the first occurrence). This means all other instances (given no one else uses them) can be\u2013and will be\u2013properly garbage collected (by the garbage collector, some time in the future).</p>\n\n<p>One thing to not forget here: the string interner uses a <code>cache</code> dictionary which stores all previously encountered string values. So to let those strings go, you should \"clear\" this cache map too, simplest done by assigning a <code>nil</code> value to it.</p>\n\n<p>Without further ado, let's see our solution:</p>\n\n<pre><code>result := searchImages()\n\ntagToUrlMap := make(map[string][]string)\n\nfor _, image := range result {\n    imageURL := interned(image.URL)\n\n    for _, tag := range image.Tags {\n        tagName := interned(tag.Name)\n        tagToUrlMap[tagName] = append(tagToUrlMap[tagName], imageURL)\n    }\n}\n\n// Clear the interner cache:\ncache = nil\n</code></pre>\n\n<p>To verify the results:</p>\n\n<pre><code>enc := json.NewEncoder(os.Stdout)\nenc.SetIndent(\"\", \"  \")\nif err := enc.Encode(tagToUrlMap); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Output is (try it on the <a href=\"https://play.golang.org/p/XDlYPQNfdd-\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\n  \"blue\": [\n    \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\"\n  ],\n  \"bridge\": [\n    \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n  ],\n  \"forest\": [\n    \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\",\n    \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n  ],\n  \"ocean\": [\n    \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\"\n  ],\n  \"river\": [\n    \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n  ],\n  \"water\": [\n    \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\",\n    \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n  ]\n}\n</code></pre>\n\n<h3>Further memory optimizations:</h3>\n\n<p>We used the builtin <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> function to add new image URLs to tags. <code>append()</code> may (and usually does) allocate bigger slices than needed (thinking of future growth). After our \"build\" process, we may go through our <code>tagToUrlMap</code> map and \"trim\" those slices to the minimum needed.</p>\n\n<p>This is how it could be done:</p>\n\n<pre><code>for tagName, urls := range tagToUrlMap {\n    if cap(urls) &gt; len(urls) {\n        urls2 := make([]string, len(urls))\n        copy(urls2, urls)\n        tagToUrlMap[tagName] = urls2\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15176, "user_id": 270663, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ff0aefddc23d7231fc266ee5394bf2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Vincent", "link": "https://stackoverflow.com/users/270663/vincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3276, "favorite_count": 3, "accepted_answer_id": 51983331, "answer_count": 2, "score": 6, "last_activity_date": 1592250939, "creation_date": 1534911260, "last_edit_date": 1535019522, "question_id": 51959783, "link": "https://stackoverflow.com/questions/51959783/garbage-collection-and-correct-usage-of-pointers-in-go", "title": "Garbage collection and correct usage of pointers in Go", "body": "<p>I come from a Python/Ruby/JavaScript background. I understand how pointers work, however, I'm not completely sure how to leverage them in the following situation.</p>\n\n<p>Let's pretend we have a fictitious web API that searches some image database and returns a JSON describing what's displayed in each image that was found:</p>\n\n<pre><code>[\n    {\n        \"url\": \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\",\n        \"description\": \"Ocean islands\",\n        \"tags\": [\n            {\"name\":\"ocean\", \"rank\":1},\n            {\"name\":\"water\", \"rank\":2},\n            {\"name\":\"blue\", \"rank\":3},\n            {\"name\":\"forest\", \"rank\":4}\n        ]\n    },\n\n    ...\n\n    {\n        \"url\": \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\",\n        \"description\": \"Bridge over river\",\n        \"tags\": [\n            {\"name\":\"bridge\", \"rank\":1},\n            {\"name\":\"river\", \"rank\":2},\n            {\"name\":\"water\", \"rank\":3},\n            {\"name\":\"forest\", \"rank\":4}\n        ]\n    }\n]\n</code></pre>\n\n<p>My goal is to create a data structure in Go that will map each tag to a list of image URLs that would look like this:</p>\n\n<pre><code>{\n    \"ocean\": [\n        \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\"\n    ],\n    \"water\": [\n        \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\",\n        \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n    ],\n    \"blue\": [\n        \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\"\n    ],\n    \"forest\":[\n        \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\", \n        \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n    ],\n    \"bridge\": [\n        \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n    ],\n    \"river\":[\n        \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\"\n    ]\n}\n</code></pre>\n\n<p>As you can see, each image URL can belong to multiple tags at the same time. If I have thousands of images and even more tags, this data structure can grow very large if image URL strings are copied by value for each tag. This is where I want to leverage pointers.</p>\n\n<p>I can represent the JSON API response by two structs in Go, <code>func searchImages()</code> mimics the fake API:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\ntype Image struct {\n    URL string\n    Description string\n    Tags []*Tag\n}\n\ntype Tag struct {\n    Name string\n    Rank int\n}\n\n// this function mimics json.NewDecoder(resp.Body).Decode(&amp;parsedJSON)\nfunc searchImages() []*Image {\n    parsedJSON := []*Image{\n        &amp;Image {\n            URL: \"https://c8.staticflickr.com/4/3707/11603200203_87810ddb43_o.jpg\",\n            Description: \"Ocean islands\",\n            Tags: []*Tag{\n                &amp;Tag{\"ocean\", 1},\n                &amp;Tag{\"water\", 2},\n                &amp;Tag{\"blue\", 3},\n                &amp;Tag{\"forest\", 4},\n            }, \n        },\n        &amp;Image {\n            URL: \"https://c3.staticflickr.com/1/48/164626048_edeca27ed7_o.jpg\",\n            Description: \"Bridge over river\",\n            Tags: []*Tag{\n                &amp;Tag{\"bridge\", 1},\n                &amp;Tag{\"river\", 2},\n                &amp;Tag{\"water\", 3},\n                &amp;Tag{\"forest\", 4},\n            }, \n        },\n    }\n    return parsedJSON\n}\n</code></pre>\n\n<p>Now the less optimal mapping function that results in a very large in-memory data structure can look like this:</p>\n\n<pre><code>func main() {\n    result := searchImages()\n\n    tagToUrlMap := make(map[string][]string)\n\n    for _, image := range result {\n        for _, tag := range image.Tags {\n            // fmt.Println(image.URL, tag.Name)\n            tagToUrlMap[tag.Name] = append(tagToUrlMap[tag.Name], image.URL)\n        }\n    }\n\n    fmt.Println(tagToUrlMap)\n}\n</code></pre>\n\n<p>I can modify it to use pointers to the <code>Image</code> struct <code>URL</code> field instead of copying it by value:</p>\n\n<pre><code>    // Version 1\n\n    tagToUrlMap := make(map[string][]*string)\n\n    for _, image := range result {\n        for _, tag := range image.Tags {\n            // fmt.Println(image.URL, tag.Name)\n            tagToUrlMap[tag.Name] = append(tagToUrlMap[tag.Name], &amp;image.URL)\n        }\n    }\n</code></pre>\n\n<p>It works and my first question is what happens to the <code>result</code> data structure after I build the mapping in this way? Will the <code>Image</code> <code>URL</code> string fields be left in memory somehow and the rest of the <code>result</code> will be garbage collected? Or will the <code>result</code> data structure stay in memory until the end of the program because something points to its members? </p>\n\n<p>Another way to do this would be to copy the URL to an intermediate variable and use a pointer to it instead:</p>\n\n<pre><code>    // Version 2\n\n    tagToUrlMap := make(map[string][]*string)\n\n    for _, image := range result {\n        imageUrl = image.URL\n        for _, tag := range image.Tags {\n            // fmt.Println(image.URL, tag.Name)    \n            tagToUrlMap[tag.Name] = append(tagToUrlMap[tag.Name], &amp;imageUrl)\n        }\n    }\n</code></pre>\n\n<p>Is this better? Will the <code>result</code> data structure be garbage collected correctly?</p>\n\n<p>Or perhaps I should use a pointer to string in the <code>Image</code> struct instead?</p>\n\n<pre><code>type Image struct {\n    URL *string\n    Description string\n    Tags []*Tag\n}\n</code></pre>\n\n<p>Is there a better way to do this? I would also appreciate any resources on Go that describe various uses of pointers in depth. Thanks!</p>\n\n<p><a href=\"https://play.golang.org/p/QX36w82D-HS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VcKWUYLIpH7</a></p>\n\n<p><strong>UPDATE:</strong> I'm worried about optimal memory consumption and not generating unwanted garbage the most. My goal is to use the minimal amount of memory possible.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1534945941, "post_id": 51959339, "comment_id": 90887157, "body": "It sounds like you really want Gorilla mux. It&#39;s not clear why you have rejected it."}, {"owner": {"reputation": 79, "user_id": 3196132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adbe3b16f809f2b990c3da986811a4f2?s=128&d=identicon&r=PG&f=1", "display_name": "Lilmortal", "link": "https://stackoverflow.com/users/3196132/lilmortal"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1534988947, "post_id": 51959339, "comment_id": 90904671, "body": "I prefer using Golang default handlers then gorilla handlers. I&#39;m trying to limit the use of frameworks."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535030709, "post_id": 51959339, "comment_id": 90923243, "body": "Well, you can reinvent the wheel, write some terribly complicated router of your own, or use a library that is actually worth using. Mux is not really a framework; it&#39;s a very lightweight library. I think you have rejected it because you want to limit outside dependencies, but mux is <i>so useful</i> that it&#39;s worth including in just about any project that serves HTTP."}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 3196132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adbe3b16f809f2b990c3da986811a4f2?s=128&d=identicon&r=PG&f=1", "display_name": "Lilmortal", "link": "https://stackoverflow.com/users/3196132/lilmortal"}, "edited": false, "score": 0, "creation_date": 1534988902, "post_id": 51959951, "comment_id": 90904664, "body": "Thank&#39;s alot! it works; unfortunately if I enter /api/v1/ by itself, it will strip it from the URL which is an unfortunate side effect of this."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 5, "last_activity_date": 1534912628, "creation_date": 1534912628, "answer_id": 51959951, "question_id": 51959339, "link": "https://stackoverflow.com/questions/51959339/how-do-i-compose-api-v1-users-id-id-in-net-http/51959951#51959951", "title": "How do I compose /api/v1/users/id/{id} in net/http?", "body": "<p>The standard <code>net/http</code> does not support dynamic path segments, so <code>/{id}</code> is not gonna work the way you might imagine. As for the prefix thing, you can use this <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"noreferrer\">https://golang.org/pkg/net/http/#StripPrefix</a>.</p>\n\n<pre><code>v1mux := http.NewServeMux()\nv1mux.HandleFunc(\"/users/\", handler)\n\nmux := http.NewServeMux()\nmux.Handle(\"/api/v1/\", http.StripPrefix(\"/api/v1\", v1mux))\n\nlog.Fatal(http.ListenAndServe(fmt.Sprintf(\"%s%d\", \":\", portNumber), mux))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534948509, "post_id": 51962068, "comment_id": 90888887, "body": "This answer could use more explanation and less criticism of OP&#39;s choice of library."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535097842, "post_id": 51962068, "comment_id": 90949092, "body": "The <code>if you insist</code> said with humor. I eventually took the time to write something in order to try to help. Although if @Flimzy say something about that I would love to apologise. I think drawing the politically correct gun for every little thing do not do good to any community. I also think the code is straight forward I&#39;ll be happy to elaborate if someone ask to."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": -1, "last_activity_date": 1534923966, "creation_date": 1534923966, "answer_id": 51962068, "question_id": 51959339, "link": "https://stackoverflow.com/questions/51959339/how-do-i-compose-api-v1-users-id-id-in-net-http/51962068#51962068", "title": "How do I compose /api/v1/users/id/{id} in net/http?", "body": "<p>I suggest using <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">https://github.com/julienschmidt/httprouter</a>. But if you insist.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    res := resourceone{}\n    http.HandleFunc(\"/api/v1/users/\", res.router)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\ntype resourceone struct {\n}\n\nfunc (res *resourceone) router(w http.ResponseWriter, r *http.Request) {\n    args := strings.Split(r.URL.String()[len(`/api/v1/users/`):], `/`)\n    switch args[0] {\n    case `id`:\n        id, _ := strconv.Atoi(args[1])\n        res.one(w, r, id)\n    case `name`:\n        res.two(w, r, args[1])\n    }\n}\n\nfunc (res *resourceone) one(w http.ResponseWriter, r *http.Request, id int) {\n    w.Write([]byte(strconv.Itoa(id)))\n}\n\nfunc (res *resourceone) two(w http.ResponseWriter, r *http.Request, name string) {\n    w.Write([]byte(name))\n}\n</code></pre>\n\n<p>Test:</p>\n\n<p><code>curl 127.0.0.1:8080/api/v1/users/name/david</code></p>\n\n<p><code>curl 127.0.0.1:8080/api/v1/users/id/1234</code></p>\n"}], "owner": {"reputation": 79, "user_id": 3196132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adbe3b16f809f2b990c3da986811a4f2?s=128&d=identicon&r=PG&f=1", "display_name": "Lilmortal", "link": "https://stackoverflow.com/users/3196132/lilmortal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 51959951, "answer_count": 2, "score": 1, "last_activity_date": 1534923966, "creation_date": 1534907203, "last_edit_date": 1534922889, "question_id": 51959339, "link": "https://stackoverflow.com/questions/51959339/how-do-i-compose-api-v1-users-id-id-in-net-http", "title": "How do I compose /api/v1/users/id/{id} in net/http?", "body": "<p>For example, I want to do <code>/api/v1/users/id/{id}</code>.</p>\n\n<p>At the moment, I have this:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.Handle(\"/api/v1/users\", HandleUsersV1{db: db, mux: mux})\nlog.Fatal(http.ListenAndServe(fmt.Sprintf(\"%s%d\", \":\", portNumber), mux))\n</code></pre>\n\n<p>I want:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.Handle(\"/api/v1\", HandleV1{})\n</code></pre>\n\n<p>And then in <code>HandleV1</code>:</p>\n\n<pre><code>mux.HandleFunc(\"/users/{id}\", handler)\n</code></pre>\n\n<p>I know Gorilla Mux can do it for me with <code>PathPrefix</code>, but I prefer <code>net/http</code>. </p>\n"}, {"tags": ["java", "performance", "go"], "comments": [{"owner": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 0, "creation_date": 1534902165, "post_id": 51958664, "comment_id": 90867956, "body": "what version of java and golang, also what bits 32/64?"}, {"owner": {"reputation": 7020, "user_id": 4822566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HlNVB.png?s=128&g=1", "display_name": "Alex Taylor", "link": "https://stackoverflow.com/users/4822566/alex-taylor"}, "edited": false, "score": 6, "creation_date": 1534902301, "post_id": 51958664, "comment_id": 90867989, "body": "This is an educated guess, but I suspect Java has optimized the inner-most loop away and all you&#39;re seeing is the JVM start-up time with a count to 10, but Go has actually executed it."}, {"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "reply_to_user": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 0, "creation_date": 1534902369, "post_id": 51958664, "comment_id": 90867997, "body": "@IlyaBursov <code>go version go1.10.3 darwin&#47;amd64</code> and <code>java version &quot;1.8.0_112&quot;</code> 64-bit MacOSX"}, {"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "reply_to_user": {"reputation": 7020, "user_id": 4822566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HlNVB.png?s=128&g=1", "display_name": "Alex Taylor", "link": "https://stackoverflow.com/users/4822566/alex-taylor"}, "edited": false, "score": 1, "creation_date": 1534902459, "post_id": 51958664, "comment_id": 90868019, "body": "@AlexTaylor When I first wrote this, Java definitely optimized out the loops entirely.  So I added the <code>count++</code> to the inner method and printed it out to verify it hits that part of the loop."}, {"owner": {"reputation": 12675, "user_id": 636009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IIQJV.jpg?s=128&g=1", "display_name": "David Conrad", "link": "https://stackoverflow.com/users/636009/david-conrad"}, "edited": false, "score": 1, "creation_date": 1534903518, "post_id": 51958664, "comment_id": 90868221, "body": "That won&#39;t necessarily prevent it from optimizing the loop away entirely. It can just optimize it to <code>count += 2_000_000_000;</code> You need to use <a href=\"http://openjdk.java.net/projects/code-tools/jmh/\" rel=\"nofollow noreferrer\">jmh</a> for microbenchmarks."}, {"owner": {"reputation": 42640, "user_id": 1553851, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=128&d=identicon&r=PG", "display_name": "shmosel", "link": "https://stackoverflow.com/users/1553851/shmosel"}, "reply_to_user": {"reputation": 12675, "user_id": 636009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IIQJV.jpg?s=128&g=1", "display_name": "David Conrad", "link": "https://stackoverflow.com/users/636009/david-conrad"}, "edited": false, "score": 1, "creation_date": 1534903556, "post_id": 51958664, "comment_id": 90868230, "body": "@DavidConrad It probably wouldn&#39;t take so long if that were the case."}, {"owner": {"reputation": 12675, "user_id": 636009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IIQJV.jpg?s=128&g=1", "display_name": "David Conrad", "link": "https://stackoverflow.com/users/636009/david-conrad"}, "reply_to_user": {"reputation": 42640, "user_id": 1553851, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=128&d=identicon&r=PG", "display_name": "shmosel", "link": "https://stackoverflow.com/users/1553851/shmosel"}, "edited": false, "score": 0, "creation_date": 1534903900, "post_id": 51958664, "comment_id": 90868306, "body": "@shmosel That&#39;s possible, in which case you may need to look at the <a href=\"https://stackoverflow.com/questions/1503479/how-to-see-jit-compiled-code-in-jvm\">code produced by the JIT</a> to be sure."}, {"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "edited": false, "score": 0, "creation_date": 1534904739, "post_id": 51958664, "comment_id": 90868461, "body": "When It didn&#39;t have the <code>count++</code> in the inner loop, it was taking 14ms in Java... effectively just doing the Println() statements in the outer loop.  Then it increased substantially to the 392ms, so it really feels like it&#39;s hitting that loop now."}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "edited": false, "score": 0, "creation_date": 1534907844, "post_id": 51958664, "comment_id": 90869089, "body": "I would like to point out that in your Go code you are using a ns call instead of a ms call. Getting the unix time in milliseconds is generally a lot faster than getting it in nanoseconds because they are two wildly different implementations."}, {"owner": {"reputation": 1622, "user_id": 1563394, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/67835df71913e21410945dfa8c33d70f?s=128&d=identicon&r=PG", "display_name": "lwi", "link": "https://stackoverflow.com/users/1563394/lwi"}, "edited": false, "score": 4, "creation_date": 1534923787, "post_id": 51958664, "comment_id": 90874165, "body": "Doing a  back-of-the-envelope calculation  it looks like there must be some loop optimization applied by Java. Suppose you have a single core processor with 3Ghz, that gives you a 0.3ns per instruction, lets assume that every increment is one instruction. So 0.3ns *20 bilion = 6s  wich is around the performance you see from Go."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534968152, "post_id": 51959374, "comment_id": 90899022, "body": "This answer might be more helpful if it were less vitriolic toward Go."}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534971481, "post_id": 51959374, "comment_id": 90900484, "body": "@Adrian I have spent years studying compiler and optimizer output, I have never before seen something as strange and complex as the Go output. It appears to have a garbage collector for code without objects. I don\u2019t know enough about Go to know what it is doing, but I do know that those excessive instructions are causing massive delays. I gave it a fair comparison, I looked for ways to enable optimization and I couldn\u2019t find any. If you know of a way to optimize that, or a Go compiler built on top of llvm I would love to hear about it. But otherwise the output I got is probably what the Op got"}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534971710, "post_id": 51959374, "comment_id": 90900572, "body": "@Adrian I\u2019m also in no way saying that C++ is a good language, it isn\u2019t, it is notorious for memory leaks. I\u2019m only saying that it has a very good optimizer. Go could also have very good optimization, the compiler I used for C++ - Clang - is built on top of llvm, which is basically an optimizer that makes it easy to create a new languages."}], "tags": [], "owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "is_accepted": false, "score": 0, "last_activity_date": 1534907651, "creation_date": 1534907651, "answer_id": 51959374, "question_id": 51958664, "link": "https://stackoverflow.com/questions/51958664/why-does-this-code-take-substantially-longer-to-run-in-go-vs-java/51959374#51959374", "title": "Why does this code take substantially longer to run in Go vs Java", "body": "<p>Here are some observations I made. I am going to show some Intel syntax assembly code I got from compiling this program. I am using <a href=\"http://godbolt.org\" rel=\"nofollow noreferrer\" title=\"Compiler Explorer\">Compiler Explorer</a>. To understand what follows you don't have to know a lot of assembly, the most important element here is size, the bigger it is the slower it is. If I could I would make this post smaller, but the code generated is surprisingly huge, and I don't know enough about Go to know what is useless. If you want to see what each statement converts to in assembly the Compiler Explorer will highlight everything for you.</p>\n\n<p><strong>TL;DR</strong>:<br>\nThe Go compiler is a disastrous mess in my opinion, the C++ code get's very well optimized, and Java is small compared to Go. JIT'ing may have a major effect on the Java code, it may also be too complex for a loop unraveling inline optimization (precompute the value of <code>count</code>).</p>\n\n<hr>\n\n<p>The Go code compiled down to this monstrosity:</p>\n\n<pre><code>text    \"\".main(SB), $224-0\nmovq    (TLS), CX\nleaq    -96(SP), AX\ncmpq    AX, 16(CX)\njls     835\nsubq    $224, SP\nmovq    BP, 216(SP)\nleaq    216(SP), BP\nfuncdata        $0, gclocals\u00b7f6bd6b3389b872033d462029172c8612(SB)\nfuncdata        $1, gclocals\u00b717283ea8379a997487dd6f8baf7ae6ea(SB)\npcdata  $0, $0\ncall    time.Now(SB)\nmovq    16(SP), AX\nmovq    8(SP), CX\nmovq    (SP), DX\nmovq    DX, time.t\u00b72+160(SP)\nmovq    CX, time.t\u00b72+168(SP)\nmovq    AX, time.t\u00b72+176(SP)\nmovq    time.t\u00b72+160(SP), AX\nmovq    AX, CX\nshrq    $63, AX\nshlq    $63, AX\ntestq   $-1, AX\njeq     806\nmovq    CX, DX\nshlq    $1, CX\nshrq    $31, CX\nmovq    $59453308800, BX\naddq    BX, CX\nandq    $1073741823, DX\nmovlqsx DX, DX\nimulq   $1000000000, CX\naddq    DX, CX\nmovq    $-6795364578871345152, DX\naddq    DX, CX\nmovq    $4835703278458516699, AX\nimulq   CX\nsarq    $63, CX\nsarq    $18, DX\nsubq    CX, DX\nmovq    DX, \"\".start+72(SP)\nxorl    AX, AX\nmovq    AX, CX\njmp     257\nincq    CX\nincq    AX\ncmpq    CX, $2000000000\njlt     213\nmovq    \"\".i+80(SP), SI\nincq    SI\nmovq    \"\".start+72(SP), DX\nmovq    $59453308800, BX\nmovq    AX, CX\nmovq    SI, AX\nmovq    CX, \"\".count+88(SP)\ncmpq    AX, $10\njge     404\nmovq    AX, \"\".i+80(SP)\nmovq    AX, \"\"..autotmp_24+112(SP)\nxorps   X0, X0\nmovups  X0, \"\"..autotmp_23+120(SP)\nleaq    type.int(SB), CX\nmovq    CX, (SP)\nleaq    \"\"..autotmp_24+112(SP), DX\nmovq    DX, 8(SP)\npcdata  $0, $1\ncall    runtime.convT2E64(SB)\nmovq    24(SP), AX\nmovq    16(SP), CX\nmovq    CX, \"\"..autotmp_23+120(SP)\nmovq    AX, \"\"..autotmp_23+128(SP)\nleaq    go.string.\"On step %d\\n\"(SB), AX\nmovq    AX, (SP)\nmovq    $11, 8(SP)\nleaq    \"\"..autotmp_23+120(SP), CX\nmovq    CX, 16(SP)\nmovq    $1, 24(SP)\nmovq    $1, 32(SP)\npcdata  $0, $1\ncall    fmt.Printf(SB)\nmovq    \"\".count+88(SP), AX\nxorl    CX, CX\njmp     219\npcdata  $0, $2\ncall    time.Now(SB)\nmovq    16(SP), AX\nmovq    8(SP), CX\nmovq    (SP), DX\nmovq    DX, time.t\u00b72+136(SP)\nmovq    CX, time.t\u00b72+144(SP)\nmovq    AX, time.t\u00b72+152(SP)\nmovq    time.t\u00b72+136(SP), AX\nmovq    AX, CX\nshrq    $63, AX\nshlq    $63, AX\ntestq   $-1, AX\njeq     787\nmovq    CX, DX\nshlq    $1, CX\nshrq    $31, CX\nmovq    $59453308800, BX\naddq    BX, CX\nimulq   $1000000000, CX\nandq    $1073741823, DX\nmovlqsx DX, DX\naddq    DX, CX\nmovq    $-6795364578871345152, DX\nleaq    (DX)(CX*1), AX\nmovq    AX, \"\".~R0+64(SP)\nmovq    $4835703278458516699, CX\nimulq   CX\nsarq    $18, DX\nmovq    \"\".~R0+64(SP), CX\nsarq    $63, CX\nsubq    CX, DX\nmovq    \"\".start+72(SP), CX\nsubq    CX, DX\nmovq    DX, \"\"..autotmp_29+104(SP)\nmovq    \"\".count+88(SP), CX\nmovq    CX, \"\"..autotmp_30+96(SP)\nxorps   X0, X0\nmovups  X0, \"\"..autotmp_28+184(SP)\nmovups  X0, \"\"..autotmp_28+200(SP)\nleaq    type.int64(SB), CX\nmovq    CX, (SP)\nleaq    \"\"..autotmp_29+104(SP), CX\nmovq    CX, 8(SP)\npcdata  $0, $3\ncall    runtime.convT2E64(SB)\nmovq    16(SP), CX\nmovq    24(SP), DX\nmovq    CX, \"\"..autotmp_28+184(SP)\nmovq    DX, \"\"..autotmp_28+192(SP)\nleaq    type.int(SB), CX\nmovq    CX, (SP)\nleaq    \"\"..autotmp_30+96(SP), CX\nmovq    CX, 8(SP)\npcdata  $0, $3\ncall    runtime.convT2E64(SB)\nmovq    24(SP), CX\nmovq    16(SP), DX\nmovq    DX, \"\"..autotmp_28+200(SP)\nmovq    CX, \"\"..autotmp_28+208(SP)\nleaq    go.string.\"Total time took: %d to get at count: %d\\n\"(SB), CX\nmovq    CX, (SP)\nmovq    $40, 8(SP)\nleaq    \"\"..autotmp_28+184(SP), CX\nmovq    CX, 16(SP)\nmovq    $2, 24(SP)\nmovq    $2, 32(SP)\npcdata  $0, $3\ncall    fmt.Printf(SB)\nmovq    216(SP), BP\naddq    $224, SP\nret\nmovq    time.t\u00b72+144(SP), BX\nmovq    CX, DX\nmovq    BX, CX\njmp     501\nmovq    time.t\u00b72+168(SP), SI\nmovq    CX, DX\nmovq    $59453308800, BX\nmovq    SI, CX\njmp     144\nnop\npcdata  $0, $-1\ncall    runtime.morestack_noctxt(SB)\njmp     0\ntext    \"\".init(SB), $8-0\nmovq    (TLS), CX\ncmpq    SP, 16(CX)\njls     89\nsubq    $8, SP\nmovq    BP, (SP)\nleaq    (SP), BP\nfuncdata        $0, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\nfuncdata        $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\nmovblzx \"\".initdone\u00b7(SB), AX\ncmpb    AL, $1\njls     47\nmovq    (SP), BP\naddq    $8, SP\nret\njne     56\npcdata  $0, $0\ncall    runtime.throwinit(SB)\nundef\nmovb    $1, \"\".initdone\u00b7(SB)\npcdata  $0, $0\ncall    fmt.init(SB)\npcdata  $0, $0\ncall    time.init(SB)\nmovb    $2, \"\".initdone\u00b7(SB)\nmovq    (SP), BP\naddq    $8, SP\nret\nnop\npcdata  $0, $-1\ncall    runtime.morestack_noctxt(SB)\njmp     0\ntext    type..hash.[2]interface {}(SB), DUPOK, $40-24\nmovq    (TLS), CX\ncmpq    SP, 16(CX)\njls     103\nsubq    $40, SP\nmovq    BP, 32(SP)\nleaq    32(SP), BP\nfuncdata        $0, gclocals\u00b7d4dc2f11db048877dbc0f60a22b4adb3(SB)\nfuncdata        $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\nxorl    AX, AX\nmovq    \"\".h+56(SP), CX\njmp     82\nmovq    AX, \"\".i+24(SP)\nshlq    $4, AX\nmovq    \"\".p+48(SP), BX\naddq    BX, AX\nmovq    AX, (SP)\nmovq    CX, 8(SP)\npcdata  $0, $0\ncall    runtime.nilinterhash(SB)\nmovq    16(SP), CX\nmovq    \"\".i+24(SP), AX\nincq    AX\ncmpq    AX, $2\njlt     38\nmovq    CX, \"\".~r2+64(SP)\nmovq    32(SP), BP\naddq    $40, SP\nret\nnop\npcdata  $0, $-1\ncall    runtime.morestack_noctxt(SB)\njmp     0\ntext    type..eq.[2]interface {}(SB), DUPOK, $48-24\nmovq    (TLS), CX\ncmpq    SP, 16(CX)\njls     155\nsubq    $48, SP\nmovq    BP, 40(SP)\nleaq    40(SP), BP\nfuncdata        $0, gclocals\u00b78f9cec06d1ae35cc9900c511c5e4bdab(SB)\nfuncdata        $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\nxorl    AX, AX\njmp     46\nmovq    \"\"..autotmp_8+32(SP), CX\nleaq    1(CX), AX\ncmpq    AX, $2\njge     140\nmovq    AX, CX\nshlq    $4, AX\nmovq    \"\".p+56(SP), DX\nmovq    8(AX)(DX*1), BX\nmovq    (AX)(DX*1), SI\nmovq    \"\".q+64(SP), DI\nmovq    8(AX)(DI*1), R8\nmovq    (AX)(DI*1), AX\ncmpq    SI, AX\njne     125\nmovq    CX, \"\"..autotmp_8+32(SP)\nmovq    SI, (SP)\nmovq    BX, 8(SP)\nmovq    R8, 16(SP)\npcdata  $0, $0\ncall    runtime.efaceeq(SB)\nmovblzx 24(SP), AX\ntestb   AL, AL\njne     37\nmovb    $0, \"\".~r2+72(SP)\nmovq    40(SP), BP\naddq    $48, SP\nret\nmovb    $1, \"\".~r2+72(SP)\nmovq    40(SP), BP\naddq    $48, SP\nret\nnop\npcdata  $0, $-1\ncall    runtime.morestack_noctxt(SB)\njmp     0\n</code></pre>\n\n<p>I have no clue what most of that is doing. I can only hope that most of that is some sort of GC code. I looked up how to enable optimizations for the Go compiler, and all I could find was how to <em>disable</em> optimizations.</p>\n\n<p>Comparatively I looked at a similar function in C++</p>\n\n<pre><code>#include &lt;cstdio&gt;\n#include &lt;chrono&gt;\n#include &lt;cinttypes&gt;\n\nusing namespace std::chrono;\n\n\nmilliseconds getMS()\n{\n    return duration_cast&lt; milliseconds &gt;(\n        system_clock::now().time_since_epoch()\n    );\n}\n\nint main()\n{\n    int count = 0;\n    milliseconds millis = getMS();\n\n    for(int i = 0; i &lt; 10; ++i)\n    {\n        printf(\"On step %d\\n\", i);\n        for(int j = 0; j &lt; 2000000000; ++j)\n        {\n            ++count;\n        }\n    }\n\n    milliseconds time = getMS() - millis;\n\n    printf(\"Total time took: %\" PRId64 \" to get at count: %d\\n\", time.count(), count);\n}\n</code></pre>\n\n<p>Which without optimizations compiled down to (compiler <code>x86-64 clang (trunk (probably 6.0.0)</code>, flags: <code>-std=c++0x -O0</code>):</p>\n\n<pre><code>main:                                   # @main\n        push    rbp\n        mov     rbp, rsp\n        sub     rsp, 48\n        mov     dword ptr [rbp - 4], 0\n        mov     dword ptr [rbp - 8], 0\n        call    getMS()\n        mov     qword ptr [rbp - 16], rax\n        mov     dword ptr [rbp - 20], 0\n.LBB3_1:                                # =&gt;This Loop Header: Depth=1\n        cmp     dword ptr [rbp - 20], 10\n        jge     .LBB3_8\n        mov     esi, dword ptr [rbp - 20]\n        movabs  rdi, offset .L.str\n        mov     al, 0\n        call    printf\n        mov     dword ptr [rbp - 24], 0\n        mov     dword ptr [rbp - 44], eax # 4-byte Spill\n.LBB3_3:                                #   Parent Loop BB3_1 Depth=1\n        cmp     dword ptr [rbp - 24], 2000000000\n        jge     .LBB3_6\n        mov     eax, dword ptr [rbp - 8]\n        add     eax, 1\n        mov     dword ptr [rbp - 8], eax\n        mov     eax, dword ptr [rbp - 24]\n        add     eax, 1\n        mov     dword ptr [rbp - 24], eax\n        jmp     .LBB3_3\n.LBB3_6:                                #   in Loop: Header=BB3_1 Depth=1\n        jmp     .LBB3_7\n.LBB3_7:                                #   in Loop: Header=BB3_1 Depth=1\n        mov     eax, dword ptr [rbp - 20]\n        add     eax, 1\n        mov     dword ptr [rbp - 20], eax\n        jmp     .LBB3_1\n.LBB3_8:\n        call    getMS()\n        mov     qword ptr [rbp - 40], rax\n        lea     rdi, [rbp - 40]\n        lea     rsi, [rbp - 16]\n        call    std::common_type&lt;std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;, std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; &gt;::type std::chrono::operator-&lt;long, std::ratio&lt;1l, 1000l&gt;, long, std::ratio&lt;1l, 1000l&gt; &gt;(std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; const&amp;, std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; const&amp;)\n        mov     qword ptr [rbp - 32], rax\n        lea     rdi, [rbp - 32]\n        call    std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;::count() const\n        mov     edx, dword ptr [rbp - 8]\n        movabs  rdi, offset .L.str.1\n        mov     rsi, rax\n        mov     al, 0\n        call    printf\n        mov     edx, dword ptr [rbp - 4]\n        mov     dword ptr [rbp - 48], eax # 4-byte Spill\n        mov     eax, edx\n        add     rsp, 48\n        pop     rbp\n        ret\n.L.str:\n        .asciz  \"On step %d\\n\"\n\n.L.str.1:\n        .asciz  \"Total time took: %ld to get at count: %d\\n\"\n</code></pre>\n\n<p>There is actually a lot more code than that, but it is just the chrono implementation, in the optimized code it is just a library function call. I've also removed the implementation of <code>getMS</code> because it is mostly a wrapper method.</p>\n\n<p>With O1 (size) optimizations this turns into:</p>\n\n<pre><code>main:                                   # @main\n        push    rbx\n        sub     rsp, 32\n        call    getMS()\n        mov     qword ptr [rsp + 24], rax\n        xor     ebx, ebx\n.LBB3_1:                                # =&gt;This Inner Loop Header: Depth=1\n        mov     edi, offset .L.str\n        xor     eax, eax\n        mov     esi, ebx\n        call    printf\n        add     ebx, 1\n        cmp     ebx, 10\n        jne     .LBB3_1\n        call    getMS()\n        mov     qword ptr [rsp + 8], rax\n        lea     rdi, [rsp + 8]\n        lea     rsi, [rsp + 24]\n        call    std::common_type&lt;std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;, std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; &gt;::type std::chrono::operator-&lt;long, std::ratio&lt;1l, 1000l&gt;, long, std::ratio&lt;1l, 1000l&gt; &gt;(std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; const&amp;, std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt; const&amp;)\n        mov     qword ptr [rsp + 16], rax\n        lea     rdi, [rsp + 16]\n        call    std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;::count() const\n        mov     rcx, rax\n        mov     edi, offset .L.str.1\n        mov     edx, -1474836480\n        xor     eax, eax\n        mov     rsi, rcx\n        call    printf\n        xor     eax, eax\n        add     rsp, 32\n        pop     rbx\n        ret\n.L.str:\n        .asciz  \"On step %d\\n\"\n\n.L.str.1:\n        .asciz  \"Total time took: %ld to get at count: %d\\n\"\n</code></pre>\n\n<p>O2 (speed) and O3 (max) optimizations essentially boil down to an unrolled outer loop (which is only there for the print statements), and a precomputed count value.</p>\n\n<p>This mostly shows the terrible code generated by Go and some of the optimizations that occur in C++. But none of this shows exactly what the Java bytecode contains or what that will get JIT'ed down to if it is run enough times. So here is the Java bytecode:</p>\n\n<pre><code>public static void countToTwentyBillion();\n    Code:\n\n0: lconst_0\n\n1: lstore_0\n\n2: invokestatic  #2\n// Method java/lang/System.currentTimeMillis:()J\n\n5: lstore_2\n\n6: iconst_0\n\n7: istore\n4\n\n9: iload\n4\n\n11: bipush\n10\n\n13: if_icmpge\n68\n\n16: getstatic\n#3\n// Field java/lang/System.out:Ljava/io/PrintStream;\n\n19: new\n#4\n// class java/lang/StringBuilder\n\n22: dup\n\n23: invokespecial #5\n// Method java/lang/StringBuilder.'&lt;init&gt;':()V\n\n26: ldc\n#6\n// String On step\n\n28: invokevirtual #7\n// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;\n\n31: iload\n4\n\n33: invokevirtual #8\n// Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;\n\n36: invokevirtual #9\n// Method java/lang/StringBuilder.toString:()Ljava/lang/String;\n\n39: invokevirtual #10\n// Method java/io/PrintStream.println:(Ljava/lang/String;)V\n\n42: iconst_0\n\n43: istore\n5\n\n45: iload\n5\n\n47: ldc\n#11\n// int 2000000000\n\n49: if_icmpge\n62\n\n52: lload_0\n\n53: lconst_1\n\n54: ladd\n\n55: lstore_0\n\n56: iinc\n5, 1\n\n59: goto\n45\n\n62: iinc\n4, 1\n\n65: goto\n9\n\n68: invokestatic  #2\n// Method java/lang/System.currentTimeMillis:()J\n\n71: lstore\n4\n\n73: getstatic\n#3\n// Field java/lang/System.out:Ljava/io/PrintStream;\n\n76: new\n#4\n// class java/lang/StringBuilder\n\n79: dup\n\n80: invokespecial #5\n// Method java/lang/StringBuilder.'&lt;init&gt;':()V\n\n83: ldc\n#12\n// String Total time took:\n\n85: invokevirtual #7\n// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;\n\n88: lload\n4\n\n90: lload_2\n\n91: lsub\n\n92: invokevirtual #13\n// Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder;\n\n95: ldc\n#14\n// String  ms to get at count:\n\n97: invokevirtual #7\n// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;\n\n100: lload_0\n\n101: invokevirtual #13\n// Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder;\n\n104: invokevirtual #9\n// Method java/lang/StringBuilder.toString:()Ljava/lang/String;\n\n107: invokevirtual #10\n// Method java/io/PrintStream.println:(Ljava/lang/String;)V\n\n110: return\n</code></pre>\n\n<p>Unfortunately at the moment I don't feel like compiling hsdis and JIT'ing the code, but it will probably end up looking like some of the C++ examples. From what I know about the JIT, it <em>might</em> be able to precompute the count value. But this code is a bit complex (in terms of looping) which may make it harder for a fast JIT optimization.</p>\n"}, {"comments": [{"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "edited": false, "score": 0, "creation_date": 1534941041, "post_id": 51962335, "comment_id": 90883798, "body": "<code>-XX:LoopUnrollLimit=1</code> made all the difference. With it specified, it now gives <code>5,837 ms</code> in java.  Also to clarify - the post wasn&#39;t to make a judgement for java vs go... I was just really surprised in the outcome.  And it teaches me not to take everything for granted"}], "tags": [], "owner": {"reputation": 1622, "user_id": 1563394, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/67835df71913e21410945dfa8c33d70f?s=128&d=identicon&r=PG", "display_name": "lwi", "link": "https://stackoverflow.com/users/1563394/lwi"}, "is_accepted": true, "score": 8, "last_activity_date": 1534924975, "creation_date": 1534924975, "answer_id": 51962335, "question_id": 51958664, "link": "https://stackoverflow.com/questions/51958664/why-does-this-code-take-substantially-longer-to-run-in-go-vs-java/51962335#51962335", "title": "Why does this code take substantially longer to run in Go vs Java", "body": "<p>I am not an Go expert but java is definitively optimizing the loop. </p>\n\n<p>Suppose you have a single core processor with <code>3Ghz</code>, that gives you a 0.3ns per instruction, lets assume that every increment is one instruction. So <code>0.3ns *20 bilion = 6s</code> is the performance one would roughly estimate without any optimizations in-place.</p>\n\n<p>You can verify that java does some trickery here by supplying <code>-XX:LoopUnrollLimit=1</code> to your program. This tells the JVM to do almost no loop unrolling and therefore prevents most JIT optimizations from happening in your example.</p>\n\n<p>Doing that, the runtime of your java example is now <code>6s</code> on my machine which is comparable to the Go benchmark.</p>\n\n<p>There is probably an option to enable optimizations like loop unrolling in the Go version as well (consult the Go manual for that).</p>\n\n<p>Finally, this shows again that micro benchmarks are tricky to get right. They often fool oneself in assuming things that are incorrect.</p>\n"}], "owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 4, "accepted_answer_id": 51962335, "answer_count": 2, "score": 1, "last_activity_date": 1534924975, "creation_date": 1534900807, "last_edit_date": 1534901722, "question_id": 51958664, "link": "https://stackoverflow.com/questions/51958664/why-does-this-code-take-substantially-longer-to-run-in-go-vs-java", "title": "Why does this code take substantially longer to run in Go vs Java", "body": "<p>Been picking up Go recently and I'm a big fan, coming from a Java background.</p>\n\n<p>I was comparing the languages in different ways, and was surprised that a simple loop counting up to 20 billion took substantially longer in Golang vs Java.  </p>\n\n<p>Was wondering if anyone can give any insight for if I'm missing something here.  This is what I did:</p>\n\n<h2>Java</h2>\n\n<p>Wrote the below code, executed it from a normal <code>main()</code> method, built an executable jar with Gradle, and executed it from the command line with the command: <code>java -jar build/libs/my-executable.jar</code></p>\n\n<pre><code>private void countToTwentyBillion() {\n    long count = 0;\n    long start = System.currentTimeMillis();\n    for (int k = 0; k &lt; 10; k++) {\n        System.out.println(\"On step \" + k);\n        for (int i = 0; i &lt; 2_000_000_000; i++) {\n            // Do nothing but count\n            count++;\n        }\n    }\n    long end = System.currentTimeMillis();\n    System.out.println(\"Total time took: \" + (end - start) + \" ms to get at count: \" + count);\n}\n</code></pre>\n\n<p>Across 3 separate trials, I got these results:</p>\n\n<pre><code>// Total time took: 396 ms to get at count: 20000000000\n// Total time took: 393 ms to get at count: 20000000000\n// Total time took: 388 ms to get at count: 20000000000\n// 392 ms average\n</code></pre>\n\n<h2>Go</h2>\n\n<p>Built this file in Go, built it with 'go build' and executed at the command line with <code>./loop-counter</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    count := 0\n\n    nanos := time.Now().UnixNano()\n    start := nanos / 1000000\n\n    for i := 0; i &lt; 10; i++ {\n        fmt.Printf(\"On step %d\\n\", i)\n        for k := 0; k &lt; 2000000000; k++ {\n            count++\n        }\n    }\n    nanos = time.Now().UnixNano()\n    end := nanos / 1000000\n\n    timeLength := end - start\n\n    fmt.Printf(\"Total time took: %d ms to get at count: %d\\n\", timeLength, count)\n\n}\n</code></pre>\n\n<p>After 3 separate trials, I got these results:</p>\n\n<pre><code>// Total time took: 5812 ms to get at count: 20000000000\n// Total time took: 5834 ms to get at count: 20000000000\n// Total time took: 5907 ms to get at count: 20000000000\n// 5,851 ms average\n</code></pre>\n\n<p>I went into this expecting Go to be faster and ended up being surprised.  All trials were done on the same machine with the same conditions.  </p>\n\n<p>Can anyone tell what gives?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "currency"], "answers": [{"tags": [], "owner": {"reputation": 248, "user_id": 10241251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4914e1aa950528e4456441cbf22fe99b?s=128&d=identicon&r=PG&f=1", "display_name": "Auberon L&#243;pez", "link": "https://stackoverflow.com/users/10241251/auberon-l%c3%b3pez"}, "is_accepted": true, "score": 4, "last_activity_date": 1534900020, "creation_date": 1534900020, "answer_id": 51958603, "question_id": 51958390, "link": "https://stackoverflow.com/questions/51958390/get-number-of-digits-after-the-decimal/51958603#51958603", "title": "Get number of digits after the decimal", "body": "<p>I'd recommend checking out the <a href=\"https://godoc.org/golang.org/x/text/currency\" rel=\"nofollow noreferrer\">x/text/currency library</a>.</p>\n\n<p>It has functionality for fetching how many decimals ought to be used for a currency in standard, cash, or accounting contexts. For example:</p>\n\n<pre><code>currencyNames := []string{\"USD\", \"JPY\", \"EUR\"}\nfor _, currencyName := range currencyNames {\n        isoCurrency := currency.MustParseISO(currencyName)\n        scale , _ := currency.Standard.Rounding(isoCurrency)\n        fmt.Printf(\"%s: %d\\n\", currencyName, scale)\n}\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>USD: 2\nJPY: 0\nEUR: 2\n</code></pre>\n\n<p>Depending on what you're hoping to do with that information, some of the formatting functions in that library may be even closer to what your end goal is.</p>\n\n<p>One caveat though, as noted on the linked documentation page:</p>\n\n<blockquote>\n  <p>NOTE: the formatting functionality is currently under development and may change without notice.</p>\n</blockquote>\n"}], "owner": {"reputation": 16096, "user_id": 2014591, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7d6cff955bb3f1865a419650bfe1372c?s=128&d=identicon&r=PG", "display_name": "hlin117", "link": "https://stackoverflow.com/users/2014591/hlin117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "accepted_answer_id": 51958603, "answer_count": 1, "score": 1, "last_activity_date": 1534922975, "creation_date": 1534897691, "last_edit_date": 1534922975, "question_id": 51958390, "link": "https://stackoverflow.com/questions/51958390/get-number-of-digits-after-the-decimal", "title": "Get number of digits after the decimal", "body": "<p>What's the idiomatic way to get the number of digits after the decimal for a currency? More specifically, <a href=\"https://en.wikipedia.org/wiki/ISO_4217#Active_codes\" rel=\"nofollow noreferrer\">based on the Wikipedia page for ISO 4217</a>, I want the following mapping between currency codes / number of places after the decimal:</p>\n\n<ul>\n<li>USD: 2</li>\n<li>JPY: 0</li>\n<li>EUR: 2</li>\n</ul>\n\n<p>Is there a library which would get this information for me?</p>\n"}, {"tags": ["json", "go", "recursion", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 561, "user_id": 2503184, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PrvWN.png?s=128&g=1", "display_name": "Ben Pingilley", "link": "https://stackoverflow.com/users/2503184/ben-pingilley"}, "is_accepted": false, "score": 0, "last_activity_date": 1534953812, "creation_date": 1534953812, "answer_id": 51970887, "question_id": 51958255, "link": "https://stackoverflow.com/questions/51958255/how-to-build-recursive-slices-of-structs-in-go/51970887#51970887", "title": "How to build recursive slices of structs in Go?", "body": "<p>I needed to create a function which would return the index of the existing folder in the slice. Then recurse its Children.</p>\n\n<pre><code>// DirectoryStructure stores the directory structure\ntype DirectoryStructure struct {\n    Name     string               `json:\"Name\"`\n    Children []DirectoryStructure `json:\"Children,omitempty\"`\n    Files    []File               `json:\"Files,omitempty\"`\n}\n\n// File stores the name of file and path to file\ntype File struct {\n    Name string `json:\"Name\"`\n    Path string `json:\"Path\"`\n}\n\nfunc main() {\n    // Build slice of strings\n    filePaths := []string{}\n    filePaths = append(filePaths, \"alpha/file1.json\")\n    filePaths = append(filePaths, \"alpha/beta/file2.json\")\n    filePaths = append(filePaths, \"alpha/beta/charlie/file3.json\")\n    filePaths = append(filePaths, \"alpha/beta/charlie/file4.json\")\n    filePaths = append(filePaths, \"delta/file5.json\")\n\n    // Create directory with slice of structs\n    directory := []DirectoryStructure{}\n\n    // Iterate through slice\n    for _, path := range filePaths {\n        pathSlice := strings.Split(path, \"/\")\n        // Start recursive function. Passing directory and assigning it to itself\n        directory = buildDirectory(pathSlice, path, directory)\n    }\n\n    b, err := json.Marshal(directory)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(string(b))\n}\n\nfunc buildDirectory(path []string, key string, directory []DirectoryStructure) []DirectoryStructure {\n    // Return index of folder if it already exists.\n    folderIndex := doesExist(path[0], directory)\n    // If folder exists and the next value in the path slice is not the file\n    if folderIndex &gt; -1 &amp;&amp; len(path) != 2 {\n        // Pass existing folder's Children to buildDirectory function and assign to itself\n        directory[folderIndex].Children = buildDirectory(path[1:], key, directory[folderIndex].Children)\n        return directory\n    }\n    // If next value in the path slice is a file\n    if len(path) == 2 {\n        // If folder does not exist\n        if folderIndex == -1 {\n            // Create new folder with files inside and append to directory\n            fileDirectory := DirectoryStructure{}\n            fileDirectory.Files = []File{{path[1], string(key)}}\n            fileDirectory.Name = path[0]\n            directory = append(directory, fileDirectory)\n        } else {\n            // If folder does exist, append files to the directory\n            directory[folderIndex].Files = append(directory[folderIndex].Files, File{path[1], string(key)})\n        }\n        return directory\n    }\n    // Folder does not exist and the next value is not a file\n    // Create new directory, recurse it's Children, and append when returned\n    currentDirectory := DirectoryStructure{}\n    currentDirectory.Name = path[0]\n    currentDirectory.Children = buildDirectory(path[1:], key, []DirectoryStructure{})\n    directory = append(directory, currentDirectory)\n    return directory\n\n}\n\n// doesExist returns index of folder if exists\nfunc doesExist(folderName string, directory []DirectoryStructure) int {\n    for index, element := range directory {\n        if folderName == element.Name {\n            return index\n        }\n    }\n    return -1\n}\n</code></pre>\n"}], "owner": {"reputation": 561, "user_id": 2503184, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PrvWN.png?s=128&g=1", "display_name": "Ben Pingilley", "link": "https://stackoverflow.com/users/2503184/ben-pingilley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 429, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534953812, "creation_date": 1534896582, "last_edit_date": 1534900231, "question_id": 51958255, "link": "https://stackoverflow.com/questions/51958255/how-to-build-recursive-slices-of-structs-in-go", "title": "How to build recursive slices of structs in Go?", "body": "<p>I need to create a JSON payload from a slice of strings. They represent the path to an individual file. They need to be merged together into final JSON payload representing the whole directory structure.</p>\n\n<h3>If the strings are below:</h3>\n\n<pre><code>[\n    \"alpha/file1.json\"\n    \"alpha/beta/file2.json\"\n    \"alpha/beta/charlie/file3.json\"\n    \"alpha/beta/charlie/file4.json\"\n    \"delta/file5.json\n]\n</code></pre>\n\n<h3>JSON Payload Structure</h3>\n\n<ul>\n<li>A Directory struct should include a name, with either Children and/or Files.</li>\n<li>Children will represent another Directory struct with it's own files</li>\n<li>Files represents the file(s) inside the Directory</li>\n</ul>\n\n<h3>The JSON payload would be this:</h3>\n\n<pre><code>[{\n    \"Name\": \"alpha\",\n    \"Files\": [{\n        \"Name\": \"file1.json\",\n        \"Path\": \"alpha/file1.json\"\n    }],\n    \"Children\": [{\n        \"Name\": \"beta\",\n        \"Files\": [{\n            \"Name\": \"file2.json\",\n            \"Path\": \"alpha/beta/file2.json\"\n        }],\n        \"Children\": [{\n            \"Name\": \"charlie\",\n            \"Files\": [{\n                \"Name\": \"file3.json\",\n                \"Path\": \"alpha/beta/charlie/file3.json\"\n            },\n            {\n                \"Name\": \"file4.json\",\n                \"Path\": \"alpha/beta/charlie/file4.json\"\n            }]\n        }]\n    }]\n},{\n    \"Name\": \"delta\",\n    \"Files\": [\n        {\n            \"Name\": \"file5.json\",\n            \"Path\": \"delta/file5.json\"\n        }\n    ]\n}]\n</code></pre>\n\n<p>I can't figure out how to look to determine if the directory name already exists and pass the pointer to that directory if it does. Currently, it appends a new directory structure to the base slice for each file path. Below is what I've got so far.</p>\n\n<p><a href=\"https://play.golang.org/p/WoNEcJLe51z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WoNEcJLe51z</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 1, "creation_date": 1534896414, "post_id": 51958207, "comment_id": 90866894, "body": "The output should be same and is same for both building and running the file..The output you are saying should be when you chose new string as <code>\\\\\\\\.</code>."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10257166, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9Km2bIRIpag/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPaQzBZsL9PsVCSmo7ev83u-WpqGw/mo/photo.jpg?sz=128", "display_name": "ravi", "link": "https://stackoverflow.com/users/10257166/ravi"}, "edited": false, "score": 0, "creation_date": 1534896755, "post_id": 51958234, "comment_id": 90866949, "body": "Yeah, that&#39;s what is strange about this. One thing, I am running in my mac but build and test is run on a RHEL server. Could this issue be because of OS?"}], "tags": [], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "is_accepted": false, "score": 0, "last_activity_date": 1534896348, "creation_date": 1534896348, "answer_id": 51958234, "question_id": 51958207, "link": "https://stackoverflow.com/questions/51958207/escaping-character-in-string/51958234#51958234", "title": "Escaping &#39;.&#39; character in string", "body": "<p>Are you sure about your output? This Go Playground gives me your desired output <a href=\"https://play.golang.org/p/fGzLeE_3h6h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fGzLeE_3h6h</a></p>\n\n<p>Compiling does the same, I get the correct output... Are you sure your code is running fine (with the values you expect)?</p>\n\n<p><code>go run</code> does the same as  <code>go build</code> however <code>go run</code> executes the compiled binary for you, more like a shortcut</p>\n"}], "owner": {"reputation": 51, "user_id": 10257166, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9Km2bIRIpag/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPaQzBZsL9PsVCSmo7ev83u-WpqGw/mo/photo.jpg?sz=128", "display_name": "ravi", "link": "https://stackoverflow.com/users/10257166/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534923002, "creation_date": 1534896100, "last_edit_date": 1534923002, "question_id": 51958207, "link": "https://stackoverflow.com/questions/51958207/escaping-character-in-string", "title": "Escaping &#39;.&#39; character in string", "body": "<p>I am trying to escape all occurrence of '.' character in a string with backslash. When I run my Go code it works fine but when I compile and build the binary and then run it, it adds one more backslash.</p>\n\n<pre><code>s := \"strings.test\"\ni := strings.Replace(s, \".\", \"\\\\.\", -1)\n</code></pre>\n\n<p>I even tried </p>\n\n<pre><code>s := \"strings.test\"\ni := strings.Replace(s, \".\", `\\.`, -1)\n</code></pre>\n\n<p><strong>Output: \"strings\\\\.test\"</strong></p>\n\n<p><strong>Expected Output: \"strings\\.test\"</strong></p>\n\n<p>Not sure what is the difference between running the main.go vs building the project and then running it.</p>\n"}, {"tags": ["python", "json", "go"], "comments": [{"owner": {"reputation": 2068, "user_id": 402891, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3ba541a3204f4ea4b274049a152489c5?s=128&d=identicon&r=PG", "display_name": "interfect", "link": "https://stackoverflow.com/users/402891/interfect"}, "edited": false, "score": 3, "creation_date": 1534889536, "post_id": 51957339, "comment_id": 90865289, "body": "What kind of classifier are you using? It must be from a library; there is no notion of a classifier built into Python. Whatever library provides the classifier may have a way to export it in a format that a Golang library knows how to read and execute."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6085111, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/97dd963568ae0c0b105228bbb246feb3?s=128&d=identicon&r=PG&f=1", "display_name": "Nadim Obeid", "link": "https://stackoverflow.com/users/6085111/nadim-obeid"}, "edited": false, "score": 0, "creation_date": 1534921013, "post_id": 51958401, "comment_id": 90872837, "body": "Thank you for your answer. I just thought of that. Can I load the data in python, send it to my tcp Go server and  unpickle data using the stalecucumber library?"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 0, "last_activity_date": 1534897879, "creation_date": 1534897879, "answer_id": 51958401, "question_id": 51957339, "link": "https://stackoverflow.com/questions/51957339/can-i-load-a-python-trained-classifier-in-golang/51958401#51958401", "title": "Can I load a Python trained classifier in Golang?", "body": "<p><a href=\"https://docs.python.org/3/library/pickle.html#data-stream-format\" rel=\"nofollow noreferrer\">The documentation for the Python pickle library</a> notes:</p>\n\n<blockquote>\n  <p>The data format used by <code>pickle</code> is Python-specific. This [...] means that non-Python programs may not be able to reconstruct pickled Python objects.</p>\n</blockquote>\n\n<p>In principle you could read back the format (it's \"just\" a byte stream representing an object graph) and assign some meaning to the Python class name references in the pickle file.  This would be highly specific to the specific object format you're reading back.</p>\n\n<p>My gut feel is that if it would take you 3 days to re-train your model using either Go-native tools or export it into a more neutral format, that will probably be faster and less frustrating than trying to decode the pickle file.</p>\n"}], "owner": {"reputation": 33, "user_id": 6085111, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/97dd963568ae0c0b105228bbb246feb3?s=128&d=identicon&r=PG&f=1", "display_name": "Nadim Obeid", "link": "https://stackoverflow.com/users/6085111/nadim-obeid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 467, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534897879, "creation_date": 1534889100, "question_id": 51957339, "link": "https://stackoverflow.com/questions/51957339/can-i-load-a-python-trained-classifier-in-golang", "title": "Can I load a Python trained classifier in Golang?", "body": "<p>I am trying to load a python trained classifier in a Golang server. </p>\n\n<p>In python, I generally do that:</p>\n\n<pre><code>classifier = pickle.load( open(\"classifier1.p\", \"rb\"))\n</code></pre>\n\n<p>Is there any equivalent in Golang? </p>\n\n<p>It took me 3 days to train the data and I can't wait again. So I tried to convert the classifier1.p to JSON format using this code.</p>\n\n<pre><code>fpkl = pickle.load( open(\"whatever/classifier1.p\", \"rb\"))\nfjson = open(\"whatever/classifier.json\", \"w\")\njson.dump(fpkl, fjson, ensure_ascii=False, sort_keys=True, indent=4)\n</code></pre>\n\n<p>An error occured: Object of type 'Pipeline' is not JSON serializable</p>\n\n<p>I need some advice. Is there any Golang equivalent for my first problem? If there isn't, what can I do to avoid the data training again?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534885999, "post_id": 51956621, "comment_id": 90864179, "body": "per the README, <code>gojsonschema.NewReferenceLoader(...)</code> takes an uri such as file:// etc. I guess, but one has to read the doc thoroughly, that NewStringLoader seems more appropriate."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534886147, "post_id": 51956621, "comment_id": 90864235, "body": "Or course! That was my problem. Feel free to post this as the answer!"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 679, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534885124, "creation_date": 1534885124, "question_id": 51956621, "link": "https://stackoverflow.com/questions/51956621/rest-api-with-gojsonschema-first-path-segment-in-url-cannot-contain-colon", "title": "REST API with gojsonschema: first path segment in URL cannot contain colon", "body": "<p>I'm having issues making <code>github.com/xeipuuv/gojsonschema</code> work for my REST API that I'm currently building.</p>\n\n<p>The procedure would look like this</p>\n\n<ul>\n<li>User sends request to /api/books/create (in this case I'm sending a <code>PUT</code> request)</li>\n<li>User inputs body parameters <code>name</code> and <code>content</code></li>\n<li>The server converts these body parameters into readable JSON</li>\n<li>The server tries to validate the JSON using a json schema</li>\n<li>The server performs the request</li>\n</ul>\n\n<p>or that is how it <strong>should</strong> work.</p>\n\n<p>I get this error when trying to validate the JSON and I have no clue how to fix it.\n<code>http: panic serving [::1]:58611: parse {\"name\":\"1\",\"content\":\"2\"}: first path segment in URL cannot contain colon</code></p>\n\n<pre><code>type CreateParams struct {\n    Name     string\n    Content        string\n}\n\nfunc Create(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n\n    data := &amp;CreateParams{\n        Name: r.Form.Get(\"name\"),\n        Content: r.Form.Get(\"Content\"),\n    }\n\n    jsonData, err := json.Marshal(data)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(string(jsonData))\n\n    schema := `{\n          \"required\": [\n            \"Name\",\n            \"Content\"\n          ],\n          \"properties\": {\n            \"Name\": {\n              \"$id\": \"#/properties/Name\",\n              \"type\": \"string\",\n              \"title\": \"The Name Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"1\"\n              ],\n              \"minLength\": 3,\n              \"pattern\": \"^(.*)$\"\n            },\n            \"Content\": {\n              \"$id\": \"#/properties/Content\",\n              \"type\": \"string\",\n              \"title\": \"The Content Schema\",\n              \"default\": \"\",\n              \"examples\": [\n                \"2\"\n              ],\n              \"pattern\": \"^(.*)$\"\n            }\n          }\n        }`\n    schemaLoader := gojsonschema.NewStringLoader(schema)\n    documentLoader := gojsonschema.NewReferenceLoader(string(jsonData))\n\n    result, err := gojsonschema.Validate(schemaLoader, documentLoader)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    if result.Valid() {\n        fmt.Printf(\"The document is valid\\n\")\n    } else {\n        fmt.Printf(\"The document is not valid. see errors :\\n\")\n        for _, desc := range result.Errors() {\n            fmt.Printf(\"- %s\\n\", desc)\n        }\n    }\n}\n</code></pre>\n\n<p>My first thought was that it breaks because <code>r.ParseForm()</code> outputs things in a weird way, but I'm not sure anymore.</p>\n\n<p>Note that I would like to have a \"universal\" method as I'm dealing with all kinds of requests: <code>GET</code>, <code>POST</code>, <code>PUT</code>, etc. But if you have a better solution I could work with that.</p>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534882515, "post_id": 51955883, "comment_id": 90862667, "body": "does io.Copy returns an error ? Also you are not closing the pipes after io.Copy."}, {"owner": {"reputation": 93, "user_id": 1475857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33605ab0ba1748f7313b9abf3cc00069?s=128&d=identicon&r=PG", "display_name": "Coxeh", "link": "https://stackoverflow.com/users/1475857/coxeh"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534883648, "post_id": 51955883, "comment_id": 90863227, "body": "the io.Copy does not return an error. If i close the pipes after the Copy i get this error:      <code>Post http:&#47;&#47;localhost:1323&#47;discounts&#47;import: io: read&#47;write on closed pipe     Post http:&#47;&#47;localhost:1323&#47;products&#47;import: io: read&#47;write on closed pipe</code>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1534884731, "post_id": 51955883, "comment_id": 90863673, "body": "have you closed the write half of the pipe ?"}, {"owner": {"reputation": 93, "user_id": 1475857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33605ab0ba1748f7313b9abf3cc00069?s=128&d=identicon&r=PG", "display_name": "Coxeh", "link": "https://stackoverflow.com/users/1475857/coxeh"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534918551, "post_id": 51955883, "comment_id": 90871786, "body": "You are correct. If I close both writers <code>oneW</code> and <code>twoW</code> after the <code>io.Copy</code> The code then the code works correctly"}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1534919986, "creation_date": 1534919986, "answer_id": 51961055, "question_id": 51955883, "link": "https://stackoverflow.com/questions/51955883/concurrent-posts-with-multireader-do-not-return-a-response/51961055#51961055", "title": "Concurrent POSTs with multireader do not return a response", "body": "<p>The issue in OP code is that the http.Post calls never detects the EOF of the provided io.Reader.</p>\n\n<p>That happens because the provided half write pipe is never closed, thus, the half read pipe never emits the regular EOF error.</p>\n\n<p>As a note about OP comment that closing the half read pipe would generate irregular errors, one has to understand that reading from a closed pipe is not a correct behavior.</p>\n\n<p>Thus in this situation, care should be taken to close the half write side right after the content has been copied.</p>\n\n<p>The resulting source code should be changed to</p>\n\n<pre><code>func ImportAggregate(c echo.Context) error {\n    oneR, oneW := io.Pipe()\n    twoR, twoW := io.Pipe()\n\n    done := make(chan bool, 2)\n\n    go func() {\n        fmt.Println(\"Product Starting\")\n        response, err := http.Post(\"http://localhost:1323/products/import\", \"application/json\", oneR)\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(response.Body)\n        }\n        done &lt;- true\n    }()\n\n    go func() {\n        fmt.Println(\"Import Starting\")\n        response, err := http.Post(\"http://localhost:1323/discounts/import\", \"application/json\", twoR)\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(response.Body)\n        }\n        done &lt;- true\n    }()\n\n    mw := io.MultiWriter(oneW, twoW)\n    io.Copy(mw, c.Request().Body)\n    oneW.Close()\n    twoW.Close()\n\n    &lt;-done\n    &lt;-done\n\n    return c.String(200, \"Imported\")\n}\n</code></pre>\n\n<p>Side notes beyond OP question:</p>\n\n<ul>\n<li><p>an error check must implemented around the io.Copy in order to detect a transmission error.</p></li>\n<li><p>it is not needed to close the half read side of the pipe, http.Post will do it after it received the EOF signal.</p></li>\n<li><p>the goroutines responsible to consume the pipes must be declared and started before the input request is copied. The Pipes being synchronous, the code would block during the io.Copy waiting to be consumed on its other end.</p></li>\n<li><p>the done chan does not require to be unbuffered (of length 2)</p></li>\n<li><p>a way to forward error from outgoing requests to the outgoing response would be to use a channel of type <code>(chan error)</code>, loop over it two times, and check for the first error encountered.</p></li>\n</ul>\n"}], "owner": {"reputation": 93, "user_id": 1475857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33605ab0ba1748f7313b9abf3cc00069?s=128&d=identicon&r=PG", "display_name": "Coxeh", "link": "https://stackoverflow.com/users/1475857/coxeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 51961055, "answer_count": 1, "score": 0, "last_activity_date": 1534923011, "creation_date": 1534881623, "last_edit_date": 1534923011, "question_id": 51955883, "link": "https://stackoverflow.com/questions/51955883/concurrent-posts-with-multireader-do-not-return-a-response", "title": "Concurrent POSTs with multireader do not return a response", "body": "<p>I have a proof of concept http server using <a href=\"https://echo.labstack.com/\" rel=\"nofollow noreferrer\">echo</a> which takes a POST request with a JSON body. I am trying to stream the request body over to multiple POST requests using pipes and the multiwriter but it is not working correctly. </p>\n\n<p>In the example below I can see the data is sent to the 2 POST endpoints and I can see a log from those requests but I never get a response back it seems the code hangs waiting for the <code>http.Post(...)</code> functions to complete.</p>\n\n<p>If I call these 2 endpoints directly they work fine and give a valid json response, so i believe the problem is with this piece of code which is my handler for the route.</p>\n\n<pre><code>func ImportAggregate(c echo.Context) error {\n    oneR, oneW := io.Pipe()\n    twoR, twoW := io.Pipe()\n\n    done := make(chan bool, 2)\n\n    go func() {\n        fmt.Println(\"Product Starting\")\n        response, err := http.Post(\"http://localhost:1323/products/import\", \"application/json\", oneR)\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(response.Body)\n        }\n        done &lt;- true\n    }()\n\n    go func() {\n        fmt.Println(\"Import Starting\")\n        response, err := http.Post(\"http://localhost:1323/discounts/import\", \"application/json\", twoR)\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(response.Body)\n        }\n        done &lt;- true\n    }()\n\n    mw := io.MultiWriter(oneW, twoW)\n    io.Copy(mw, c.Request().Body)\n\n    &lt;-done\n    &lt;-done\n\n    return c.String(200, \"Imported\")\n}\n</code></pre>\n\n<p>The output in console is:</p>\n\n<pre><code>Product Starting\nImport Starting\n</code></pre>\n"}, {"tags": ["visual-studio", "go", "dll", "x86", "64-bit"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534876643, "post_id": 51954745, "comment_id": 90860089, "body": "What is your windows OS bit architecture. Is it 64bit or 32bit ?"}, {"owner": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534877205, "post_id": 51954745, "comment_id": 90860332, "body": "64 bit WIndows 10"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "edited": false, "score": 0, "creation_date": 1534877833, "post_id": 51954999, "comment_id": 90860633, "body": "And if the dll dont have 64bit version. There is anything to do?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "edited": false, "score": 0, "creation_date": 1534877906, "post_id": 51954999, "comment_id": 90860663, "body": "@OtavioMoreira No there should be give me the link for the dll. If not there is nothing you can do."}, {"owner": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "edited": false, "score": 0, "creation_date": 1534879088, "post_id": 51954999, "comment_id": 90861145, "body": "I&#39;m using ehlapi32.dll for ibm emulator"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "edited": false, "score": 0, "creation_date": 1534879283, "post_id": 51954999, "comment_id": 90861226, "body": "@OtavioMoreira No this will not going to work. Search for 64bit and if they don&#39;t have that raise an issue on github library. I think they don&#39;t have that because the ibm site is mentioning only 16bit and 32bit. You should check there me some turn around for this."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534877523, "creation_date": 1534877523, "answer_id": 51954999, "question_id": 51954745, "link": "https://stackoverflow.com/questions/51954745/how-to-use-32bit-dll-on-64bit-go-project-in-goarch-386-with-vscode/51954999#51954999", "title": "How to use 32bit DLL on 64bit GO project in GOARCH=386 with VSCode", "body": "<p>The issue is because you are trying to load 32bit dll on 64bit architecture. Use 64 bit dll file. Along with that Install using 64bit dll for golang.</p>\n\n<p>Just if you try to install delve from 32bit dll on 64 bit OS. This is also mentioned in the issues on github:</p>\n\n<p><a href=\"https://github.com/derekparker/delve/issues/20\" rel=\"nofollow noreferrer\">https://github.com/derekparker/delve/issues/20</a></p>\n\n<p>VS Code complains if you want to run 32bit dll on 64 bit OS.\nIf you have 32bit dll for golang Uninstall that and install from 64bit dll again.</p>\n"}, {"tags": [], "owner": {"reputation": 1812, "user_id": 706055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59587d800e072afcecf5dfe8bc374957?s=128&d=identicon&r=PG&f=1", "display_name": "Amit G.", "link": "https://stackoverflow.com/users/706055/amit-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1534883612, "last_edit_date": 1534883612, "creation_date": 1534879910, "answer_id": 51955500, "question_id": 51954745, "link": "https://stackoverflow.com/questions/51954745/how-to-use-32bit-dll-on-64bit-go-project-in-goarch-386-with-vscode/51955500#51955500", "title": "How to use 32bit DLL on 64bit GO project in GOARCH=386 with VSCode", "body": "<p><em>(I assume that a 64-bit DLL is out of reach)</em></p>\n\n<p>64-bit process cannot load a 32-bit module into its process space, and a 32-bit processes cannot load a 64-bit module into its process space. The only way that communication can happen between 32-bit and 64-bit modules is through inter-process communication (IPC). Microsoft recommends that you use inter-process COM to use 32 bit code with a 64 bit application. <a href=\"https://blog.mattmags.com/2007/06/30/accessing-32-bit-dlls-from-64-bit-code/\" rel=\"nofollow noreferrer\">Here's an article explaining the process</a>. It's ugly.</p>\n\n<p>If it's OK on your end, build your project to X86 platform (32-bit). In that way <code>ehlapi32.dll</code> is compatible &amp; problem solved. Your 32-bit software is still supported on a 64-bit platform as 32-bit processes can be executed on 64-bit Windows operating system.</p>\n\n<p>--</p>\n\n<ul>\n<li>I familiar with C++ &amp; not at all with GO. I have no idea how (or if at all) that technique can be implemented in GO.</li>\n</ul>\n"}], "owner": {"reputation": 25, "user_id": 6579552, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mt5R9jTqahk/AAAAAAAAAAI/AAAAAAAAABE/-chsKQ19_l8/photo.jpg?sz=128", "display_name": "Otavio Moreira", "link": "https://stackoverflow.com/users/6579552/otavio-moreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 960, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534888572, "creation_date": 1534876449, "last_edit_date": 1534888572, "question_id": 51954745, "link": "https://stackoverflow.com/questions/51954745/how-to-use-32bit-dll-on-64bit-go-project-in-goarch-386-with-vscode", "title": "How to use 32bit DLL on 64bit GO project in GOARCH=386 with VSCode", "body": "<p>I have installed VSCode and GO extension with defaults packages.\nMy project need to load a 32-bit DLL. When I launch project with <kbd>F5</kbd>, I get error 193 on syscall.LoadLibrary(). </p>\n\n<p>I found on internet that error usually occurs when someone try to load a 32-bit DLL on a 64-bit arch. </p>\n\n<p>I think if I debug with GOARCH=386 I would be able to load the DLL. But every time that I try to execute with GOARCH=386 I get error on VSCode saying that this architecture is unsupported.</p>\n\n<p>Need help. </p>\n"}, {"tags": ["go", "casting"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534873827, "post_id": 51954147, "comment_id": 90858702, "body": "Please post the code where you are using the maps in golang. Show the definition of <code>ArrayKeys</code> function."}, {"owner": {"reputation": 2034, "user_id": 1704895, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/SvOnC.jpg?s=128&g=1", "display_name": "Cequiel", "link": "https://stackoverflow.com/users/1704895/cequiel"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534873932, "post_id": 51954147, "comment_id": 90858751, "body": "Here it is: <a href=\"https://play.golang.org/p/0ImqjPJFFiE\" rel=\"nofollow noreferrer\">play.golang.org/p/0ImqjPJFFiE</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1534874632, "post_id": 51954147, "comment_id": 90859136, "body": "you will have to specialize it for each type you want to iterate over. One generic solution involves usage of the reflection package, but it is noticeably slower."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534874782, "post_id": 51954147, "comment_id": 90859235, "body": "about reflection package usage, see <a href=\"https://stackoverflow.com/a/25773086/4466350\">stackoverflow.com/a/25773086/4466350</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1534874816, "post_id": 51954187, "comment_id": 90859247, "body": "I like this suggestion the best. But do add some more explanation to you answer."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 3, "last_activity_date": 1534875672, "last_edit_date": 1534875672, "creation_date": 1534873894, "answer_id": 51954187, "question_id": 51954147, "link": "https://stackoverflow.com/questions/51954147/retrieve-the-keys-of-an-arbitrary-map-variable/51954187#51954187", "title": "Retrieve the keys of an arbitrary map variable", "body": "<p>You should change the function to work with your types:</p>\n\n<pre><code>func ArrayKeys(elements map[string]int) []string  {\n    i, keys := 0, make([]string, len(elements))\n    for key, _ := range elements {\n        keys[i] = key\n        i++\n    }\n    return keys\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/n5kZego0ePY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/n5kZego0ePY</a></p>\n\n<p>But why should you change the signature?</p>\n\n<p>If a function in Go takes an empty interface all the including variables has no type any more. But Go is strongly typed, so dealing with variables without a type is difficult. If you provide a function like yours the code should deal really with any type. To do so you would need to use the reflection package. And if you have an error that you missed something your program will panic, when the error occurs. When you writing a server it can run for months and stop running then.</p>\n\n<p>If you write an <code>ArrayKey</code> function for every type you have the things are different. The compiler ensures that your code is robust and will never panic at that point. If you want to try to use the function with another type of map the code will not compile. That is the way Go works.</p>\n"}, {"comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534874890, "post_id": 51954269, "comment_id": 90859302, "body": "Bad idea. Panics with another type: <a href=\"https://play.golang.org/p/ZNo263ktae5\" rel=\"nofollow noreferrer\">play.golang.org/p/ZNo263ktae5</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534875061, "post_id": 51954269, "comment_id": 90859389, "body": "@apxp try that option with your anser that also it will panic :). Because you have changed the type it is common and basics. and it is obvious too. you are creating a different type and then saying my code panic ofcourse your will panics to in that case."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534875170, "post_id": 51954269, "comment_id": 90859433, "body": "The difference is that if you have the the type as input the compiler makes your function safe. Using my function witch a different type the code does not compile. If a code compiles and gives in another case a panic that code is not safe for production. If you use type conversions inside your function you have to check everytime your conversion and handle a different type."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534875520, "post_id": 51954269, "comment_id": 90859601, "body": "@apxp if you check my answer I have strictly mentioned that if you want to use interface then you can use it like I have given. I have edited my answer with an option on how to use interface in OP case."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534876022, "last_edit_date": 1534876022, "creation_date": 1534874241, "answer_id": 51954269, "question_id": 51954147, "link": "https://stackoverflow.com/questions/51954147/retrieve-the-keys-of-an-arbitrary-map-variable/51954269#51954269", "title": "Retrieve the keys of an arbitrary map variable", "body": "<p>The error clearly mentioned:</p>\n\n<blockquote>\n  <p>cannot use items (type map[string]int) as type map[interface\n  {}]interface {} in argument to ArrayKeys</p>\n</blockquote>\n\n<p>Because of mismatched types you are getting above error. If you want to use any type in the function you can go for interface because <code>interface{}</code> is not equal to <code>map[interface{}]interface{}</code></p>\n\n<p>You can go for <code>interface{}</code> to wrap the data coming from <code>maps</code> if you really want to use interface. Else you should use the same type as an argument to the function as mentioned in above answers.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc ArrayKeys(elements interface{}) []interface{} {\n    i, keys := 0, make([]interface{}, len(elements.(interface{}).(map[string]int)))\n    for key, _ := range elements.(interface{}).(map[string]int) {\n        keys[i] = key\n        i++\n    }\n    return keys\n}\n\nfunc main() {\n    items := map[string]int{\n        \"one\":   1,\n        \"two\":   2,\n        \"three\": 3,\n    }\n    keys := ArrayKeys(items)\n    fmt.Println(keys)\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/DkBgrpyK9QX\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1534874855, "last_edit_date": 1534874855, "creation_date": 1534874478, "answer_id": 51954325, "question_id": 51954147, "link": "https://stackoverflow.com/questions/51954147/retrieve-the-keys-of-an-arbitrary-map-variable/51954325#51954325", "title": "Retrieve the keys of an arbitrary map variable", "body": "<p>In Go, write a simple function. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    items := map[string]int{\n        \"one\":   1,\n        \"two\":   2,\n        \"three\": 3,\n    }\n\n    keys := func(m map[string]int) []string {\n        mk := make([]string, 0, len(m))\n        for k := range m {\n            mk = append(mk, k)\n        }\n        return mk\n    }(items)\n\n    fmt.Printf(\"%d %q\\n\", len(keys), keys)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/B0kOxAGbQCZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/B0kOxAGbQCZ</a></p>\n\n<p>Output:</p>\n\n<pre><code>3 [\"three\" \"one\" \"two\"]\n</code></pre>\n\n<hr>\n\n<p>For sorted keys,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n\n    items := map[string]int{\n        \"one\":   1,\n        \"two\":   2,\n        \"three\": 3,\n    }\n\n    keys := func(m map[string]int) []string {\n        mk := make([]string, 0, len(m))\n        for k := range m {\n            mk = append(mk, k)\n        }\n        sort.Strings(mk)\n        return mk\n    }(items)\n\n    fmt.Printf(\"%d %q\\n\", len(keys), keys)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/IQLx7gjGk8j\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IQLx7gjGk8j</a></p>\n\n<p>Output:</p>\n\n<pre><code>3 [\"one\" \"three\" \"two\"]\n</code></pre>\n"}], "owner": {"reputation": 2034, "user_id": 1704895, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/SvOnC.jpg?s=128&g=1", "display_name": "Cequiel", "link": "https://stackoverflow.com/users/1704895/cequiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1534923020, "creation_date": 1534873732, "last_edit_date": 1534923020, "question_id": 51954147, "link": "https://stackoverflow.com/questions/51954147/retrieve-the-keys-of-an-arbitrary-map-variable", "title": "Retrieve the keys of an arbitrary map variable", "body": "<p>I would like to get the keys of an arbitrary map variable. And I found this function, which replicates the PHP <code>array_keys</code> behaviour: <a href=\"https://www.php2golang.com/method/function.array-keys.html\" rel=\"nofollow noreferrer\">https://www.php2golang.com/method/function.array-keys.html</a>. But the following code:</p>\n\n<pre><code>items := map[string]int{\n    \"one\":   1,\n    \"two\":   2,\n    \"three\": 3,\n}\nkeys := ArrayKeys(items)\n</code></pre>\n\n<p>throws the next 'compile time' exception:</p>\n\n<blockquote>\n  <p>cannot use items (type map[string]int) as type map[interface\n  {}]interface {} in argument to ArrayKeys</p>\n</blockquote>\n\n<p>what am I doing wrong?</p>\n\n<p>Here's an example: <a href=\"https://play.golang.org/p/0ImqjPJFFiE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0ImqjPJFFiE</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 6, "creation_date": 1534872068, "post_id": 51953778, "comment_id": 90857872, "body": "Use Printf with the verb <code>%p</code>. Read more about verbs here: <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "is_accepted": true, "score": 2, "last_activity_date": 1534872152, "creation_date": 1534872152, "answer_id": 51953816, "question_id": 51953778, "link": "https://stackoverflow.com/questions/51953778/printing-pointer-variables/51953816#51953816", "title": "Printing pointer variables", "body": "<p>From <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a> :</p>\n\n<blockquote>\n  <p>Println formats using the default formats for its operands</p>\n</blockquote>\n\n<p>If you want to print in a specific way, you need to use <code>fmt.Printf()</code> and supply the format you want.</p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1534876006, "creation_date": 1534876006, "answer_id": 51954664, "question_id": 51953778, "link": "https://stackoverflow.com/questions/51953778/printing-pointer-variables/51954664#51954664", "title": "Printing pointer variables", "body": "<p>The <a href=\"https://golang.org/pkg/fmt/#Println\" rel=\"nofollow noreferrer\"><code>fmt.Println(...)</code> function</a> \"[uses] the default formats for its operands\" and according to the <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\"><code>fmt</code> package header documentation</a>:</p>\n\n<pre><code>%v  the value in a default format\n...\nstruct:             {field0 field1 ...}\n...\npointer to above:   &amp;{}, &amp;[], &amp;map[]\n</code></pre>\n\n<p>So the following lines are effectively the same:</p>\n\n<pre><code>fmt.Println(p, q)\nfmt.Printf(\"%v %v\\n\", p, q)\n</code></pre>\n\n<p>If you want to print the memory address of a pointer then you should use the <code>%p</code> format verb:</p>\n\n<pre><code>Pointer:\n%p  base 16 notation, with leading 0x\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>fmt.Printf(\"%p\\n\", q) // =&gt; 0x1953e4\n</code></pre>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 0, "accepted_answer_id": 51953816, "answer_count": 2, "score": 0, "last_activity_date": 1534923030, "creation_date": 1534871927, "last_edit_date": 1534923030, "question_id": 51953778, "link": "https://stackoverflow.com/questions/51953778/printing-pointer-variables", "title": "Printing pointer variables", "body": "<p>I created 2 Vertex objects below- q &amp; q.</p>\n\n<p>Now, when I print the pointer variable q = &amp;Vertex, I expected it to be the memory address, why is it printing the - &amp;{1,2}</p>\n\n<p>Output:</p>\n\n<pre><code>{1 2} &amp;{1 2}\n</code></pre>\n\n<p>Program:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Vertex struct {\n    X, Y int\n}\n\nvar (\n    p = Vertex{1, 2}  // has type Vertex\n    q = &amp;Vertex{1, 2} // has type *Vertex\n)\n\nfunc main() {\n    fmt.Println(p, q)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xtkeejTQ6Cf\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 7, "creation_date": 1534871194, "post_id": 51953191, "comment_id": 90857506, "body": "init is invoked by the runtime, sync.Do is under your control; you decide if it&#39;s called, when it&#39;s called, and what it does."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1534874381, "post_id": 51953191, "comment_id": 90858992, "body": "Your tests can\u2019t decide to not call <code>init()</code>; <code>init()</code> runs before any command-line processing you might do."}, {"owner": {"reputation": 744, "user_id": 6819874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ic7D9.jpg?s=128&g=1", "display_name": "lokanadham100", "link": "https://stackoverflow.com/users/6819874/lokanadham100"}, "edited": false, "score": 0, "creation_date": 1534920462, "post_id": 51953191, "comment_id": 90872563, "body": "why this question kept on hold?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534923097, "post_id": 51953191, "comment_id": 90873819, "body": "It&#39;s on hold for the reason stated: It&#39;s primariliy opinion based. &quot;Which one is best?&quot; is 100% subjective--this is why both methods exist. Each is best for different situations."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534923128, "post_id": 51953191, "comment_id": 90873833, "body": "If you narrow your question to simply &quot;What is the difference?&quot; there&#39;s a chance it might be re-opened. It would at least no longer be opinion based. It would still lack research effort, though, so I suspect few people would vote to re-open it."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 11, "last_activity_date": 1534873505, "creation_date": 1534873505, "answer_id": 51954101, "question_id": 51953191, "link": "https://stackoverflow.com/questions/51953191/difference-between-init-and-sync-once-in-golang/51954101#51954101", "title": "Difference between init() and sync.Once in golang", "body": "<p>Package <code>init()</code> functions are guaranteed by the spec to be called only once and all called from a single thread (not to say they couldn't start goroutines, but they're thread safe unless you make them multi-threaded).</p>\n\n<p>The reason you'd use <code>sync.Once</code> is if you want to control if and when some code is executed. A package <code>init()</code> function will be called at application start, period. <code>sync.Once</code> allows you to do things like lazy initialization, for example creating a resource the first time it is requested (but only once, in case multiple \"first\" requests come in at the same time) rather than at application start; or to only initialize a resource if it is actually going to be needed.</p>\n"}], "owner": {"reputation": 744, "user_id": 6819874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ic7D9.jpg?s=128&g=1", "display_name": "lokanadham100", "link": "https://stackoverflow.com/users/6819874/lokanadham100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4191, "favorite_count": 1, "closed_date": 1534912592, "accepted_answer_id": 51954101, "answer_count": 1, "score": 5, "last_activity_date": 1534929149, "creation_date": 1534869523, "last_edit_date": 1534929149, "question_id": 51953191, "link": "https://stackoverflow.com/questions/51953191/difference-between-init-and-sync-once-in-golang", "closed_reason": "Opinion-based", "title": "Difference between init() and sync.Once in golang", "body": "<p>I saw 2 ways of using singleton pattern in golang.</p>\n\n<ol>\n<li>Using init() functions</li>\n<li>Using sync.Once in sync package</li>\n</ol>\n\n<p>Whats the difference?</p>\n\n<p>What is the best way to follow by considering thread safety also?</p>\n\n<p>If init() solves all problems then what is sync.Once designed for?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534868023, "post_id": 51952800, "comment_id": 90855962, "body": "Use <code>fmt.Sprintf</code>: <a href=\"https://golang.org/pkg/fmt\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1534868565, "post_id": 51952800, "comment_id": 90856243, "body": "Rather use <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\"><code>url.URL</code></a> and <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\"><code>url.Values</code></a> so the values get URL-escaped properly."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534923206, "post_id": 51952800, "comment_id": 90873878, "body": "What have you tried? Show your current code (the example code you show now is invalid, and won&#39;t even compile), and explain the problem you&#39;re facing."}, {"owner": {"reputation": 1, "user_id": 9714169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/325636fe81040e6fd892cd2b51421ece?s=128&d=identicon&r=PG&f=1", "display_name": "k0ngoz", "link": "https://stackoverflow.com/users/9714169/k0ngoz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534935780, "post_id": 51952800, "comment_id": 90880616, "body": "@Flimzy Yes the code does not work i was just trying to illustrate what i needed, i figured it out, but thanks for responding!"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9714169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/325636fe81040e6fd892cd2b51421ece?s=128&d=identicon&r=PG&f=1", "display_name": "k0ngoz", "link": "https://stackoverflow.com/users/9714169/k0ngoz"}, "edited": false, "score": 0, "creation_date": 1534935743, "post_id": 51955853, "comment_id": 90880601, "body": "Perfect, exactly what I needed. Thanks very much!"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 1, "user_id": 9714169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/325636fe81040e6fd892cd2b51421ece?s=128&d=identicon&r=PG&f=1", "display_name": "k0ngoz", "link": "https://stackoverflow.com/users/9714169/k0ngoz"}, "edited": false, "score": 0, "creation_date": 1534945579, "post_id": 51955853, "comment_id": 90886906, "body": "@k0ngoz You\u2019re welcome! You can upvote and/or accept this answer if it solves your problem."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1534882373, "last_edit_date": 1534882373, "creation_date": 1534881482, "answer_id": 51955853, "question_id": 51952800, "link": "https://stackoverflow.com/questions/51952800/how-to-pass-multiple-strings-into-a-url-in-http-get/51955853#51955853", "title": "How to pass multiple strings into a url in http get?", "body": "<p>Use <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\"><code>fmt.Sprintf(...)</code></a> to build a string that does not require encoding:</p>\n\n<pre><code>hostname := fmt.Sprintf(\"google.%s\", \"dk\")\n// =&gt; \"google.dk\"\n</code></pre>\n\n<p>Use the <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow noreferrer\"><code>net/url</code> package</a> to build URLs so they are encoded properly:</p>\n\n<pre><code>u := &amp;url.URL{Scheme: \"https\", Host: hostname}\nfmt.Println(u)\n// =&gt; https://google.dk\n\nq := u.Query()\nq.Add(\"value1\", \"foo\")\nq.Add(\"value2\", \"Hello, World!\")\nu.RawQuery = q.Encode()\nfmt.Println(u)\n// =&gt; https://google.dk?value1=foo&amp;value2=Hello%2C+World%21\n\nresp, err := c.Get(u.String())\n// ...\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9714169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/325636fe81040e6fd892cd2b51421ece?s=128&d=identicon&r=PG&f=1", "display_name": "k0ngoz", "link": "https://stackoverflow.com/users/9714169/k0ngoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": -7, "last_activity_date": 1534923184, "creation_date": 1534867981, "last_edit_date": 1534923184, "question_id": 51952800, "link": "https://stackoverflow.com/questions/51952800/how-to-pass-multiple-strings-into-a-url-in-http-get", "title": "How to pass multiple strings into a url in http get?", "body": "<p>This is my current code:</p>\n\n<pre><code>var dek string = \"dk\"\nresp,err := c.Get(\"https://google.\"VALUEHERE\"\")\n</code></pre>\n\n<p>What I want to be able to is pass different strings into my url if I need a bunch of different ones.</p>\n\n<p>So ideally would be something like:</p>\n\n<pre><code>resp,err := c.Get(\"https://google.dk/value1=%v&amp;value2=%v\", value1, value2)\n</code></pre>\n\n<p>Is this possible in any way?</p>\n"}, {"tags": ["go", "protocol-buffers", "microservices", "grpc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534867642, "post_id": 51952694, "comment_id": 90855721, "body": "While protobuf &amp; gRPC are certainly popular, so is bog-standard JSON REST. Have you done analysis to determine if using JSON REST throughout the whole system would be an appropriate solution for your use case? If it is, it certainly sounds like it might be simpler."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534867774, "post_id": 51952694, "comment_id": 90855808, "body": "It seems that protobufs and gRPC might be a proverbial bandwagon. It makes sense for Google, with their huge distributed architecture and zillions of project teams to have a common communication protocol, but for small to medium projects it seems like more bother than a boon."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534867838, "post_id": 51952694, "comment_id": 90855841, "body": "I am currently considering AMQP and a broker for my messaging and either JSON or MsgPack for my data format."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534867958, "post_id": 51952694, "comment_id": 90855926, "body": "Protobuf and gRPC have advantages at scale because they are extremely efficient, both in terms of bandwidth and encode/decode compute. REST and JSON are much less efficient, but are more widely-known, widely-used, widely-supported, and generally easier to work with. There are a ton of options out there beyond just those two as well. Don&#39;t let what&#39;s popular/trending make your decisions for you, rather make an informed decision based on research &amp; analysis (and prototyping if needed)."}], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534867507, "creation_date": 1534867507, "question_id": 51952694, "link": "https://stackoverflow.com/questions/51952694/microservice-messaging-in-go", "title": "Microservice messaging in go", "body": "<p>I am working on a project splitting services off of a monolithic codebase. Currently, the two services I am working on are a login/authentication service, a service providing a few REST API endpoints and a data retrieval service feeding the REST API. I need the services to exchange data with each other, in particular, data retrieval needs to send data to the REST API and REST API needs to exchange authentication requests/responses with the login service.</p>\n\n<p>The technology of choice in go world seems to be protobufs and gRPC. I have been looking into using these, but it seems really inconvenient, so I wonder if I am just doing things wrong.</p>\n\n<p>For example, my data retrieval gets records from an RDBMS and my REST API serves this data as JSON. Normally, I would define a \"model\" struct for each type of record in the database/API, use reflect annotations for both database and JSON in the struct definitions and used something like sqlx to scan query results into structs and encoding/json to serialize structs into JSON. But if I want to pass the data around using gRPC and protobufs this whole setup goes out of the window. Since protobuf generates its own struct types, I would have to manually implement conversion from SQL rows into protobufs and from protobufs into JSON for every single message type I define. Not that implementing conversions is hard, but it introduces more opportunities for bugs and code fragility and feels like reinventing the wheel.</p>\n\n<p>And this seems like this should be a very common problem. Am I missing some obvious solution?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534866999, "post_id": 51952530, "comment_id": 90855375, "body": "Just move that logic to a function that builds the connection string, and unit test that."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534867104, "post_id": 51952530, "comment_id": 90855431, "body": "I&#39;d have to get the boss&#39;s permission to do that. (I&#39;m responsible only for unit-testing and documenting.)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534867225, "post_id": 51952530, "comment_id": 90855484, "body": "If you&#39;re responsible for writing the tests but not the code, that&#39;s a highly unfortunate situation (that&#39;s an objectively terrible way to operate), but I suppose you could write a test for the connection-string-building function which does not exist, and let that test fail until a dev changes the code."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534870972, "post_id": 51952530, "comment_id": 90857406, "body": "@Adrian good news: boss told me not to worry about it"}], "answers": [{"tags": [], "owner": {"reputation": 6247, "user_id": 1307186, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/387ed5b468ef3d8d0d668ea772a4d043?s=128&d=identicon&r=PG", "display_name": "darethas", "link": "https://stackoverflow.com/users/1307186/darethas"}, "is_accepted": false, "score": 0, "last_activity_date": 1534907484, "creation_date": 1534907484, "answer_id": 51959366, "question_id": 51952530, "link": "https://stackoverflow.com/questions/51952530/getting-connection-string-of-db-connection/51959366#51959366", "title": "Getting connection string of db connection", "body": "<p><code>database/sql</code> is primarily focused on being an interface for doing things with SQL. Connection strings are typically driver specific, so I would look to the driver that you are using for clues how to get the connection string In your case, judging by the comment at the top, you are using MySQL, so I am assuming you would be using the <code>go-sql-driver/mysql</code>. You can import it directly in your code (rather than using a blank import) and access the <code>Config</code> struct, documented here: <a href=\"https://github.com/go-sql-driver/mysql/blob/master/dsn.go#L35\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql/blob/master/dsn.go#L35</a> which gets populated from your dsn passed into <code>sql.Open</code></p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1802, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1617118797, "creation_date": 1534866913, "last_edit_date": 1617118797, "question_id": 51952530, "link": "https://stackoverflow.com/questions/51952530/getting-connection-string-of-db-connection", "title": "Getting connection string of db connection", "body": "<p>I'm trying to test this function:</p>\n\n<pre><code>//OpenConnection opens a connection to a MySQL database by `connStr`\n// or returns error. If `connStr` is empty, error is returned.\n//\n// Parameters:\n// - `connStr`: the URL of the database to connect to\n// - `interpolateParams` : should we interpolate parameters?\n//\n// Returns:\n// - pointer to the database connection\n// - any errors that happened during this process\nfunc OpenConnection(connStr string, interpolateParams bool) (*sql.DB, *errors.ErrorSt) {\n    if connStr == \"\" {\n        return nil, errors.Database().ReplaceMessage(\"No database connection string.\")\n    }\n    connStr = connStr + \"?parseTime=true&amp;multiStatements=true\"\n    if interpolateParams {\n        connStr += \"&amp;interpolateParams=true\"\n    }\n\n    db, err := sql.Open(\"mysql\", connStr)\n    if err != nil {\n        return nil, errors.Database().AddDetails(err.Error(), connStr)\n    }\n    return db, nil\n}\n</code></pre>\n\n<p>for the case of <code>interpolateParams</code>. I'm sifting through <a href=\"https://golang.org/pkg/database/sql\" rel=\"nofollow noreferrer\">the official documentation</a> and see no simple way to get the connection string from an <code>sql.DB</code>. Since this is unit testing, I am, of course, hitting the function with a fake connection URL. </p>\n\n<p><strong>Is there a way to get the connection URL from <code>sql.DB</code> to check for the interpolation query string?</strong></p>\n"}, {"tags": ["go", "struct", "gonum"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534861671, "post_id": 51950841, "comment_id": 90852000, "body": "Please post the code for <code>AddVec</code> function where you are passing the Vector struct."}, {"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534861839, "post_id": 51950841, "comment_id": 90852111, "body": "<code>AddVec</code> is implemented by gonum: <a href=\"https://github.com/gonum/gonum/blob/master/mat/vector.go#L333\" rel=\"nofollow noreferrer\">github.com/gonum/gonum/blob/master/mat/vector.go#L333</a>. I&#39;ll update the main post with this refernece."}, {"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534863688, "post_id": 51950841, "comment_id": 90853311, "body": "Probably I am doing something very dumb. However, following your pointers I got to the following solution, which actually works: <code>func (v *Vector) AddVec(a *Vector, b *Vector) { \tv.VecDense.AddVec(&amp;a.VecDense, &amp;b.VecDense) } </code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534863839, "post_id": 51950841, "comment_id": 90853423, "body": "This is what I have provided in the example to use the function with embedded struct and using pointer type arguments to <code>AddVec</code>. Please check my answer and the link."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534864176, "post_id": 51950841, "comment_id": 90853644, "body": "Now what you changed is you are passing a pointer to the struct which I have edited that the argument should be of pointer to <code>Vector</code>."}, {"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534864176, "post_id": 51950841, "comment_id": 90853645, "body": "Methods on embedded structs are promoted, unless overwritten on the parent struct. Also note that there is a difference between my <code>Vector</code> definition (which is a struct embedding VecDense), and the <code>Vector</code> interface, which the gonum <code>AddVec</code> expects."}, {"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1541505871, "post_id": 51950841, "comment_id": 93232664, "body": "It looks to me like to are trying to fit Go into a class-based like solution. Why are you trying to extend <code>*VecDense</code>? The appropriate approach would be to add functions that take the types as parameters."}, {"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "reply_to_user": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1541756068, "post_id": 51950841, "comment_id": 93333031, "body": "@kortschak there was no particular concept in doing so, I am learning Golang and perhaps my OO experience has skewed my approach. My goal was to have a linear algebra package, that we can internally use, and that builds on top of gonum."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "edited": false, "score": 0, "creation_date": 1534862408, "post_id": 51951071, "comment_id": 90852478, "body": "Thank you for the suggestion, but if the type were incompatible, would the code not even compile? <code>Vector</code> embeds the <code>VecDense</code> struct, so I can use the methods of the original struct."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "edited": false, "score": 0, "creation_date": 1534862584, "post_id": 51951071, "comment_id": 90852579, "body": "@BalazsDianiska try to embed the struct with an example and check if you can do that or not. you can but by calling the name of the parent embedded struct."}, {"owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "edited": false, "score": 0, "creation_date": 1534863034, "post_id": 51951071, "comment_id": 90852875, "body": "thanks for the tip, unfortunately the issue remains."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "edited": false, "score": 0, "creation_date": 1534863184, "post_id": 51951071, "comment_id": 90852970, "body": "@BalazsDianiska I have noticed one more thing which is that <code>NewVector</code> returns pointer while the arguments to <code>AddVec</code> is of value type."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "edited": false, "score": 0, "creation_date": 1534864286, "post_id": 51951071, "comment_id": 90853714, "body": "@BalazsDianiska yes that&#39;s why I have changed the answer and edited that the problem was when passing the arguments to the <code>AddVec</code> method not with the receiver. I know the method of embedded struct is promted."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534876527, "last_edit_date": 1534876527, "creation_date": 1534862096, "answer_id": 51951071, "question_id": 51950841, "link": "https://stackoverflow.com/questions/51950841/gonum-throws-bad-region-panic-when-using-an-embedded-struct/51951071#51951071", "title": "Gonum throws bad region panic when using an embedded struct", "body": "<p>In Golang it is described for promoted methods as</p>\n\n<blockquote>\n  <p>Promoted fields act like ordinary fields of a struct except that they\n  cannot be used as field names in composite literals of the struct.</p>\n</blockquote>\n\n<p>Given a struct type S and a defined type T, promoted methods are included in the method set of the struct as follows: </p>\n\n<ul>\n<li>If S contains an embedded field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S also includes promoted methods with receiver *T.</li>\n<li>If S contains an embedded field *T, the method sets of S and *S both include promoted methods with receiver T or *T.</li>\n</ul>\n\n<p>The problem is that you are passing pointer type arguments to <code>AddVec</code> function. But you are using pointer type fields in second case.</p>\n\n<pre><code>func (v *VecDense) AddVec(a, b Vector)\n</code></pre>\n\n<p>One more thing to notice is that <code>AddVec</code> has value type arguments of <code>Vector</code> struct but you are passing pointer to <code>Vector</code> fields as</p>\n\n<pre><code>x, y := NewVector(3, []float64{1, 2, 3}), NewVector(3, []float64{4, 5, 6}) \n</code></pre>\n\n<p>In above code <code>x,y</code> are pointer type returned from <code>NewVector</code></p>\n\n<pre><code>x.AddVec(x, y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 636, "user_id": 1695784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb781a195c97a5945823cb3fc0f408b8?s=128&d=identicon&r=PG", "display_name": "Brendan Tracey", "link": "https://stackoverflow.com/users/1695784/brendan-tracey"}, "is_accepted": false, "score": 0, "last_activity_date": 1554067267, "creation_date": 1554067267, "answer_id": 55445563, "question_id": 51950841, "link": "https://stackoverflow.com/questions/51950841/gonum-throws-bad-region-panic-when-using-an-embedded-struct/55445563#55445563", "title": "Gonum throws bad region panic when using an embedded struct", "body": "<p>The problem is that the pointers are compared when doing shadow detection. This is a bug IMO. I just filed <a href=\"https://github.com/gonum/gonum/issues/945\" rel=\"nofollow noreferrer\">https://github.com/gonum/gonum/issues/945</a></p>\n"}], "owner": {"reputation": 43, "user_id": 10255283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16fe97459180b1916821f65eced61d3?s=128&d=identicon&r=PG&f=1", "display_name": "snufkin", "link": "https://stackoverflow.com/users/10255283/snufkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 51951071, "answer_count": 2, "score": 4, "last_activity_date": 1554067267, "creation_date": 1534861339, "last_edit_date": 1534869364, "question_id": 51950841, "link": "https://stackoverflow.com/questions/51950841/gonum-throws-bad-region-panic-when-using-an-embedded-struct", "title": "Gonum throws bad region panic when using an embedded struct", "body": "<p>I am using gonum to perform a few linear algebra calculations. After extending the original <code>mat.VecDense</code> struct I am getting a \"bad region: identical\" panic when applying a method on itself. This error does not occur when I am using the original setup gonum provides.</p>\n\n<p>Here is my implementation:</p>\n\n<pre><code>type Vector struct {\n    mat.VecDense\n}\nfunc NewVector(n int, data []float64) *Vector {\n    return &amp;Vector{*mat.NewVecDense(n, data)}\n}\n</code></pre>\n\n<p>I am testing it using the following snippet:</p>\n\n<pre><code>func main() {\n    u, v := mat.NewVecDense(3, []float64{1, 2, 3}), mat.NewVecDense(3, []float64{4, 5, 6})\n    fmt.Printf(\"[U - NewVecDense]\\tADDRESS: %v, VALUE: %v\\n\", &amp;u, u)\n    fmt.Printf(\"[V - NewVecDense]\\tADDRESS: %v, VALUE: %v\\n\", &amp;v, v)\n    u.AddVec(u, v)\n\n    fmt.Println(\"-------------------------\")\n    x, y := NewVector(3, []float64{1, 2, 3}), NewVector(3, []float64{4, 5, 6})\n    fmt.Printf(\"[X - NewVector]\\tADDRESS: %v, VALUE: %v\\n\", &amp;x, x)\n    fmt.Printf(\"[Y - NewVector]\\tADDRESS: %v, VALUE: %v\\n\", &amp;y, y)\n    x.AddVec(x, y)\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>While the first addition executes fine, the second fails:</p>\n\n<pre><code>[U - NewVecDense]   ADDRESS: 0xc42000c028, VALUE: &amp;{{[1 2 3] 1} 3}\n[V - NewVecDense]   ADDRESS: 0xc42000c030, VALUE: &amp;{{[4 5 6] 1} 3}\n-------------------------\n[X - NewVector] ADDRESS: 0xc42000c040, VALUE: &amp;{{{[1 2 3] 1} 3}}\n[Y - NewVector] ADDRESS: 0xc42000c048, VALUE: &amp;{{{[4 5 6] 1} 3}}\npanic: mat: bad region: identical\n</code></pre>\n\n<p><code>AddVec</code> is a method <a href=\"https://github.com/gonum/gonum/blob/master/mat/vector.go#L333\" rel=\"nofollow noreferrer\">implemented by gonum</a>: </p>\n\n<pre><code>func (v *VecDense) AddVec(a, b Vector)\n</code></pre>\n\n<p>Why is this happening, hand what is the right way of implementing this?</p>\n\n<hr>\n\n<p>Edit: </p>\n\n<p>Thanks to @Himanshu I managed to solve the problem.</p>\n\n<p>I created pass-through methods for each method I am using, passing the right level of the struct through:</p>\n\n<pre><code>type Vector struct {\n    *mat.VecDense\n}\n\nfunc NewVector(n int, data []float64) Vector {\n    return Vector{mat.NewVecDense(n, data)}\n}\n\nfunc (v *Vector) AddVec(a, b Vector) {\n    v.VecDense.AddVec(a.VecDense, b.VecDense)\n}\n\nfunc (v *Vector) SubVec(a, b Vector) {\n    v.VecDense.SubVec(a.VecDense, b.VecDense)\n}\n\nfunc (v *Vector) ScaleVec(alpha float64, a Vector) {\n    v.VecDense.ScaleVec(alpha, a.VecDense)\n}\n\nfunc (v *Vector) AddScaledVec(a Vector, alpha float64, b Vector) {\n    v.VecDense.AddScaledVec(a.VecDense, alpha, b.VecDense)\n}\n</code></pre>\n\n<p>In addition - I am not sure if this is the right approach or not - I have also changed the return type for <code>NewVector</code> from pointer to value, since it holds a pointer to the <code>mat.VecDense</code> anyway. Note that <code>*mat.VecDense</code> satisfies the <code>Vector</code> interface from gonum, so passing this internal field on to the methods worked fine, as the example above shows.</p>\n"}, {"tags": ["go", "associations", "go-gorm"], "comments": [{"owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "edited": false, "score": 0, "creation_date": 1534863068, "post_id": 51949519, "comment_id": 90852899, "body": "take a look at <a href=\"http://gorm.io/docs/preload.html\" rel=\"nofollow noreferrer\">gorm.io/docs/preload.html</a>"}, {"owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "reply_to_user": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "edited": false, "score": 0, "creation_date": 1534869635, "post_id": 51949519, "comment_id": 90856761, "body": "I read the whole documentation multiple times, believe me, I didn&#39;t manage to do it, otherwise I wouldnt be asking"}, {"owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "edited": false, "score": 0, "creation_date": 1534883124, "post_id": 51949519, "comment_id": 90862988, "body": "set debug option to see the generated query. this looks like a dup (<a href=\"https://stackoverflow.com/questions/29230261/how-preload-a-full-hierarchy-in-go-using-gorm\" title=\"how preload a full hierarchy in go using gorm\">stackoverflow.com/questions/29230261/&hellip;</a>). hope that helps"}, {"owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "reply_to_user": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "edited": false, "score": 0, "creation_date": 1534922971, "post_id": 51949519, "comment_id": 90873765, "body": "Not really the only thing im getting out of it now is <code>Error fetching Boxes: can&#39;t preload field store_id for db100.Box</code>. Furthermore I dont think its a dub, as I want to load the parents, not the Childern. I want to get a list of all Boxes with the Store they are in as well as the Stores Manager."}], "answers": [{"tags": [], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "is_accepted": false, "score": 0, "last_activity_date": 1536156727, "creation_date": 1536156727, "answer_id": 52187251, "question_id": 51949519, "link": "https://stackoverflow.com/questions/51949519/selecting-associations-the-right-way/52187251#52187251", "title": "Selecting Associations the right way", "body": "<p>try</p>\n\n<pre><code>boxes := []Box{}\ndb.Model(&amp;Box{}).Preload(\"Store.Manager\").Find(&amp;boxes)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536156727, "creation_date": 1534857164, "question_id": 51949519, "link": "https://stackoverflow.com/questions/51949519/selecting-associations-the-right-way", "title": "Selecting Associations the right way", "body": "<p>I'm trying to model a warehouse. Now I have my stuff setup and know how I want to model it, but I don't know how to select stuff here the right way with gorm.</p>\n\n<p>I have the following types:</p>\n\n<pre><code>type Store struct {\n    StoreID   int    `gorm:\"primary_key;AUTO_INCREMENT;not null\"`\n    Name      string `gorm:\"not null\"`\n    Adress    string `gorm:\"not null\"`\n    Manager   User   `gorm:\"not null\"`\n    ManagerID int    `gorm:\"foreignkey:ManagerID;not null\"`\n    Boxes     []Box  `gorm:\"foreignkey:StoreID;association_foreignkey:StoreID\"`\n}\n\ntype User struct {\n    UserID   int       `json:\"id\" gorm:\"primary_key;AUTO_INCREMENT;not null\"`\n    Username string    `json:\"username\" gorm:\"not null\"`\n    Password string    `json:\"password\" gorm:\"not null\"`\n    Email    string    `json:\"email\" gorm:\"not null\"`\n    Right    UserRight `json:\"userright\" gorm:\"not null\"`\n}\n\ntype Box struct {\n    BoxID       int    `gorm:\"primary_key;AUTO_INCREMENT;not null\"`\n    StoreID     int    `gorm:\"not null\"`\n    Code        int    `gorm:\"type:integer(13)\"`\n    Description string `gorm:\"not null\"`\n}\n</code></pre>\n\n<p>Now I'd like to select All Boxes, with their associated Stores aswell as the associated Mangers to said Stores.\nDo I have to do this with a join or has gorm a nicer method for this?</p>\n"}, {"tags": ["go", "struct", "yaml", "slice"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1534855659, "post_id": 51948996, "comment_id": 90847736, "body": "Thanks, but I need to return <code>Exec</code>, can you please update?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1534856440, "post_id": 51948996, "comment_id": 90848293, "body": "Sorry my mistake, as my question I need to return []Exec"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534856720, "post_id": 51948996, "comment_id": 90848515, "body": "@RaynD Edited my answer just check the new build function. For full example check the Playground link"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534861729, "last_edit_date": 1534861729, "creation_date": 1534855535, "answer_id": 51948996, "question_id": 51948670, "link": "https://stackoverflow.com/questions/51948670/match-array-according-to-value/51948996#51948996", "title": "Match array according to value", "body": "<p>Assign the name of runners object to the struct <code>Exec</code> field for name and append the command list to the <code>[]string</code> type field with the commands of the function that matched the name as:</p>\n\n<pre><code>func build(name string, runners Result) []Exec {\n    exec := make([]Exec, len(runners.Runners))\n    for i, runner := range runners.Runners {\n\n        if name == runner.Name {\n            exec[i].NameVal = runner.Name\n            for _, cmd := range runner.Type {\n                exec[i].Executer = append(exec[i].Executer, cmd.Command)\n            }\n            fmt.Printf(\"%+v\", exec)\n            return exec\n        }\n    }\n    return exec\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/LDs0RMppkAA\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 51948996, "answer_count": 1, "score": 2, "last_activity_date": 1534861729, "creation_date": 1534854403, "last_edit_date": 1534861047, "question_id": 51948670, "link": "https://stackoverflow.com/questions/51948670/match-array-according-to-value", "title": "Match array according to value", "body": "<p>I'm using the following code to parse yaml and should get output as <code>runners</code> object and the function <code>build</code>should change the data structure and provide output according to below struct</p>\n\n<pre><code>type Exec struct {\n    NameVal string\n    Executer []string\n}\n</code></pre>\n\n<p>This is what I have tried but I'm not sure how to <strong>replace \nthe hard-code values</strong> inside the function runner from the value I'm getting inside the yaml</p>\n\n<pre><code>return []Exec{\n    {\"#mytest\",\n        []string{\"spawn child process\", \"build\", \"gulp\"}},\n}\n</code></pre>\n\n<p>with the data from the <code>parsed runner</code></p>\n\n<p>This is all what I have tried any idea how it could be done? </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\nvar runContent = []byte(`\napi_ver: 1\nrunners:\n  - name: function1\n    data: mytest\n    type:\n    - command: spawn child process\n    - command: build\n    - command: gulp\n  - name: function2\n    data: mytest2\n    type:\n    - command: webpack\n  - name: function3\n    data: mytest3\n    type:\n    - command: ruby build\n  - name: function4\n    type:\n  - command: go build\n`)\n\ntype Result struct {\n    Version string    `yaml:\"api_ver\"`\n    Runners []Runners `yaml:\"runners\"`\n}\n\ntype Runners struct {\n    Name string    `yaml:\"name\"`\n    Type []Command `yaml:\"type\"`\n}\n\ntype Command struct {\n    Command string `yaml:\"command\"`\n}\n\nfunc main() {\n\n    var runners Result\n    err := yaml.Unmarshal(runContent, &amp;runners)\n    if err != nil {\n        log.Fatalf(\"Error : %v\", err)\n    }\n\n    //Here Im calling to the function with the parsed structured data  which need to return the list of Exec\n    build(\"function1\", runners)\n\n}\n\ntype Exec struct {\n    NameVal  string\n    Executer []string\n}\n\nfunc build(name string, runners Result) []Exec {\n\n    for _, runner := range runners.Runners {\n\n        if name == runner.Name {\n            return []Exec{\n                // this just for example, nameVal and Command\n                {\"# mytest\",\n                    []string{\"spawn child process\", \"build\", \"gulp\"}},\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "postman", "go-gin"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534854790, "post_id": 51948215, "comment_id": 90847218, "body": "Your code works fine on my machine, there must be something wrong with your postman settings. Also, this has absolutely nothing to do with unit testing or mongodb so please edit those tags out"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534854840, "post_id": 51948215, "comment_id": 90847247, "body": "Screenshot of your exact code (with just the print changed to be less of a mess) running fine with postman and the terminal logs: <a href=\"https://imgur.com/a/alq2kW1\" rel=\"nofollow noreferrer\">imgur.com/a/alq2kW1</a>"}, {"owner": {"reputation": 73, "user_id": 7266302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a009eefde3e36ff0c9fcba087320e2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Abhijit", "link": "https://stackoverflow.com/users/7266302/abhijit"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534855349, "post_id": 51948215, "comment_id": 90847548, "body": "Thanks for checking this  out , removed the tags.Created new collection  too  in postman, still  getting the issue"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534855876, "post_id": 51948215, "comment_id": 90847885, "body": "Try just creating a new request from scratch, using <code>http:&#47;&#47;localhost:8080</code> as the URL, switching to POST and setting the form-data fields. If it still does not work, try using a curl request instead: <code>curl -X POST \\   http:&#47;&#47;localhost:8080&#47;saveCustomer \\   -H &#39;Cache-Control: no-cache&#39; \\   -H &#39;Postman-Token: 0741a012-7dee-411a-9aa6-695d780025fb&#39; \\   -H &#39;content-type: multipart&#47;form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&#39; \\   -F firstName=John \\   -F lastName=Doe \\   -F email=john.doe@test.com \\   -F &#39;phone_no=+12 345 678 901&#39;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 1503386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/686386f49a0ceb9c78b3acc2a7854ef2?s=128&d=identicon&r=PG", "display_name": "xie cui", "link": "https://stackoverflow.com/users/1503386/xie-cui"}, "is_accepted": false, "score": 0, "last_activity_date": 1547882661, "creation_date": 1547882661, "answer_id": 54264967, "question_id": 51948215, "link": "https://stackoverflow.com/questions/51948215/no-value-gets-shown-after-using-gin-package-to-get-data-from-postman-form/54264967#54264967", "title": "No value gets shown after using gin package to get data from Postman Form", "body": "<p>maybe you should using x-www-form-urlencoded instead?</p>\n\n<pre><code>func main() {\nrouter := gin.Default()\n\nrouter.POST(\"/post\", func(c *gin.Context) {\n\n    id := c.Query(\"id\")\n    page := c.DefaultQuery(\"page\", \"0\")\n    name := c.PostForm(\"name\")\n    message := c.PostForm(\"message\")\n\n    fmt.Printf(\"id: %s; page: %s; name: %s; message: %s\", id, page, name, message)\n})\nrouter.Run(\":8080\")\n</code></pre>\n\n<p>}</p>\n\n<p>data post:</p>\n\n<pre><code>POST /post?id=1234&amp;page=1 HTTP/1.1\n</code></pre>\n\n<p>Content-Type: application/x-www-form-urlencoded</p>\n\n<p>name=manu&amp;message=this_is_great</p>\n"}], "owner": {"reputation": 73, "user_id": 7266302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a009eefde3e36ff0c9fcba087320e2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Abhijit", "link": "https://stackoverflow.com/users/7266302/abhijit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 404, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1597434814, "creation_date": 1534852887, "last_edit_date": 1597434814, "question_id": 51948215, "link": "https://stackoverflow.com/questions/51948215/no-value-gets-shown-after-using-gin-package-to-get-data-from-postman-form", "title": "No value gets shown after using gin package to get data from Postman Form", "body": "<p>Below is the code I've being working on. It shows a success message when it is run, but doesn't show the value defined in the post man form. Instead it shows blank spaces in command prompt.</p>\n<pre><code>package main\n\nimport (\n&quot;fmt&quot;\n&quot;github.com/gin-gonic/gin&quot;\n)\n\nfunc saveCustomer(c *gin.Context){\n    fn := c.PostForm(&quot;firstName&quot;)\n    ln := c.PostForm(&quot;lastName&quot;)\n    em := c.PostForm(&quot;email&quot;)\n    phnno := c.PostForm(&quot;phone_no&quot;)\n    fmt.Printf(&quot;fn: %v; ln: %v ; em: %v ; phnno: %v ;&quot;,fn ,ln ,em ,phnno )\n    c.String(200, &quot;Success&quot;)\n}\nfunc main() {\n    r := gin.Default()\n    r.POST(&quot;/saveCustomer&quot;, saveCustomer)\n    r.Run(&quot;:8080&quot;)\n}\n</code></pre>\n<p>here, no values are shown, instead blank spaces are shown</p>\n<p><a href=\"https://i.stack.imgur.com/wQ8Zs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wQ8Zs.png\" alt=\"enter image description here\" /></a></p>\n<p>and below is the postman data fields with success message.</p>\n<p><a href=\"https://i.stack.imgur.com/mfZ2L.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mfZ2L.png\" alt=\"enter image description here\" /></a></p>\n"}, {"tags": ["go", "merge", "yaml", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534851683, "post_id": 51947879, "comment_id": 90845190, "body": "I&#39;m sure it is possible. What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534851719, "post_id": 51947879, "comment_id": 90845218, "body": "It is possible without defining the struct but I cannot understand what you actually want to merge which fields you want to merge and how."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534851828, "post_id": 51947879, "comment_id": 90845268, "body": "Why don&#39;t you use struct with only the fields you required and skip the fields you do not require that will save a lot of work using interfaces."}, {"owner": {"reputation": 3067, "user_id": 1117934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed8623d1684e61c146982f9792677af4?s=128&d=identicon&r=PG", "display_name": "DominicEU", "link": "https://stackoverflow.com/users/1117934/dominiceu"}, "edited": false, "score": 0, "creation_date": 1534851865, "post_id": 51947879, "comment_id": 90845293, "body": "I&#39;ve added some extra information. I&#39;m not sure which fields may be overridden, they are fields that could be passed to us at will, which is why I was hoping we&#39;d be able to be super generic and abstract about this."}], "answers": [{"comments": [{"owner": {"reputation": 3067, "user_id": 1117934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed8623d1684e61c146982f9792677af4?s=128&d=identicon&r=PG", "display_name": "DominicEU", "link": "https://stackoverflow.com/users/1117934/dominiceu"}, "edited": false, "score": 1, "creation_date": 1534852459, "post_id": 51948038, "comment_id": 90845664, "body": "Oh snap, <code>map[string]interface{}</code> and then iterating as a map is a perfect solution. Cheers."}, {"owner": {"reputation": 3067, "user_id": 1117934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed8623d1684e61c146982f9792677af4?s=128&d=identicon&r=PG", "display_name": "DominicEU", "link": "https://stackoverflow.com/users/1117934/dominiceu"}, "edited": false, "score": 0, "creation_date": 1534853688, "post_id": 51948038, "comment_id": 90846461, "body": "How might this look multiple levels deep? Is an approach like <code>if reflect.ValueOf(masterYaml[k]).Kind() == reflect.Map</code> recommended in Go?"}, {"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "reply_to_user": {"reputation": 3067, "user_id": 1117934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed8623d1684e61c146982f9792677af4?s=128&d=identicon&r=PG", "display_name": "DominicEU", "link": "https://stackoverflow.com/users/1117934/dominiceu"}, "edited": false, "score": 0, "creation_date": 1534859806, "post_id": 51948038, "comment_id": 90850739, "body": "I wouldn&#39;t recommend reflection, but you can do things like <code>if m, ok := v.(map[interface{}]interface{}); ok { ...</code> and treat the case of maps specially."}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": true, "score": 5, "last_activity_date": 1534852174, "creation_date": 1534852174, "answer_id": 51948038, "question_id": 51947879, "link": "https://stackoverflow.com/questions/51947879/read-and-merge-two-yaml-files/51948038#51948038", "title": "Read and merge two Yaml files", "body": "<p>Assuming that you just want to merge at the top level, you can unmarshal into maps of type <code>map[string]interface{}</code>, as follows:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"io/ioutil\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\nfunc main() {\n    var master map[string]interface{}\n    bs, err := ioutil.ReadFile(\"master.yaml\")\n    if err != nil {\n        panic(err)\n    }\n    if err := yaml.Unmarshal(bs, &amp;master); err != nil {\n        panic(err)\n    }\n\n    var override map[string]interface{}\n    bs, err = ioutil.ReadFile(\"override.yaml\")\n    if err != nil {\n        panic(err)\n    }\n    if err := yaml.Unmarshal(bs, &amp;override); err != nil {\n        panic(err)\n    }\n\n    for k, v := range override {\n        master[k] = v\n    }\n\n    bs, err = yaml.Marshal(master)\n    if err != nil {\n        panic(err)\n    }\n    if err := ioutil.WriteFile(\"merged.yaml\", bs, 0644); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1258, "user_id": 6494282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WtoNR.jpg?s=128&g=1", "display_name": "pcampana", "link": "https://stackoverflow.com/users/6494282/pcampana"}, "is_accepted": false, "score": 2, "last_activity_date": 1584632611, "creation_date": 1584632611, "answer_id": 60760548, "question_id": 51947879, "link": "https://stackoverflow.com/questions/51947879/read-and-merge-two-yaml-files/60760548#60760548", "title": "Read and merge two Yaml files", "body": "<p>For a broader solution (with n input files), you can use this function. I have used @robox answer to do my solution:</p>\n\n<pre><code>func ReadValues(filenames ...string) (string, error) {\n    if len(filenames) &lt;= 0 {\n        return \"\", errors.New(\"You must provide at least one filename for reading Values\")\n    }\n    var resultValues map[string]interface{}\n    for _, filename := range filenames {\n\n        var override map[string]interface{}\n        bs, err := ioutil.ReadFile(filename)\n        if err != nil {\n            log.Info(err)\n            continue\n        }\n        if err := yaml.Unmarshal(bs, &amp;override); err != nil {\n            log.Info(err)\n            continue\n        }\n\n        //check if is nil. This will only happen for the first filename\n        if resultValues == nil {\n            resultValues = override\n        } else {\n            for k, v := range override {\n                resultValues[k] = v\n            }\n        }\n\n    }\n    bs, err := yaml.Marshal(resultValues)\n    if err != nil {\n        log.Info(err)\n        return \"\", err\n    }\n\n    return string(bs), nil\n}\n</code></pre>\n\n<p>So for this example you should call it with this order:</p>\n\n<pre><code>result, _ := ReadValues(\"master.yaml\", \"overwrite.yaml\")\n</code></pre>\n\n<p>In the case you have an extra file <code>newFile.yaml</code>, you could also use this function:</p>\n\n<pre><code>result, _ := ReadValues(\"master.yaml\", \"overwrite.yaml\", \"newFile.yaml\")\n</code></pre>\n"}], "owner": {"reputation": 3067, "user_id": 1117934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed8623d1684e61c146982f9792677af4?s=128&d=identicon&r=PG", "display_name": "DominicEU", "link": "https://stackoverflow.com/users/1117934/dominiceu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4510, "favorite_count": 1, "accepted_answer_id": 51948038, "answer_count": 2, "score": 4, "last_activity_date": 1612262312, "creation_date": 1534851545, "last_edit_date": 1534851947, "question_id": 51947879, "link": "https://stackoverflow.com/questions/51947879/read-and-merge-two-yaml-files", "title": "Read and merge two Yaml files", "body": "<p>Assuming we have two yaml files </p>\n\n<p><em>master.yaml</em></p>\n\n<pre><code>someProperty: \"someVaue\"\nanotherProperty: \"anotherValue\"\n</code></pre>\n\n<p><em>override.yaml</em></p>\n\n<pre><code>someProperty: \"overriddenVaue\"\n</code></pre>\n\n<p>Is it possible to unmarshall, merge, and then write those changes to a file without having to define a <code>struct</code> for every property in the yaml file? </p>\n\n<p>The master file has over 500 properties in it that are not at all important to the service at this point of execution, so ideally I'd be able to just unmarshal into a map, do a merge and write out in yaml again but I'm relatively new to go so wanted some opinions.</p>\n\n<p>I've got some code to read the yaml into an <code>interface</code> but i'm unsure on the best approach to then merge the two.</p>\n\n<pre><code>var masterYaml interface{}\nyamlBytes, _ := ioutil.ReadFile(\"master.yaml\")\nyaml.Unmarshal(yamlBytes, &amp;masterYaml)\n\nvar overrideYaml interface{}\nyamlBytes, _ = ioutil.ReadFile(\"override.yaml\")\nyaml.Unmarshal(yamlBytes, &amp;overrideYaml)\n</code></pre>\n\n<p>I've looked into libraries like <a href=\"https://github.com/imdario/mergo\" rel=\"nofollow noreferrer\">mergo</a> but i'm not sure if that's the right approach.</p>\n\n<p>I'm hoping that after the master I would be able to write out to file with properties</p>\n\n<pre><code>someProperty: \"overriddenVaue\"\nanotherProperty: \"anotherValue\"\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 5582616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42f922f11e27911e8e29e58971cdef?s=128&d=identicon&r=PG&f=1", "display_name": "GreenHorse", "link": "https://stackoverflow.com/users/5582616/greenhorse"}, "is_accepted": false, "score": 1, "last_activity_date": 1534854681, "last_edit_date": 1534854681, "creation_date": 1534853560, "answer_id": 51948414, "question_id": 51947674, "link": "https://stackoverflow.com/questions/51947674/update-fields-create-new-foreignkey-items-instead-of-updating-them/51948414#51948414", "title": "Update fields create new foreignkey items instead of updating them", "body": "<p>You can use this to <strong>not</strong> modify the associated entities</p>\n\n<p><code>db.Set(\"gorm:save_associations\", false).Save(previousModel)</code></p>\n\n<p>or to save only one field of the struct</p>\n\n<p><code>db.Model(previousModel).UpdateColumn(\"PersoID\", appUpdated.PersoID)</code></p>\n\n<p>if you want to update an associated entity and not the relation\nyou will need to update the entity itself</p>\n\n<p><code>db.Model(Location{ID:*previousModel.LocationID}).Update(appUpdated.Location)</code></p>\n"}, {"tags": [], "owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "is_accepted": false, "score": 0, "last_activity_date": 1534864993, "creation_date": 1534864993, "answer_id": 51951979, "question_id": 51947674, "link": "https://stackoverflow.com/questions/51947674/update-fields-create-new-foreignkey-items-instead-of-updating-them/51951979#51951979", "title": "Update fields create new foreignkey items instead of updating them", "body": "<p>Well, once more (but let's not blame the guy, he is alone) the main problem comes from an incomplete documentation.</p>\n\n<p>All my problems were solved when I checked that I properly preloaded my foreign object + indicate it's ID (which blocked the fact that the foreignKey was Inserted instead of Updated)</p>\n\n<p>Then, to be able to update it properly I had to do:</p>\n\n<pre><code>db.\n    Model(previousModel).\n    UpdateColumns(appUpdated).\n    Model(&amp;previousModel.Location).\n    Updates(appUpdated.Location)\n</code></pre>\n\n<p>Was very painful, but at least it's solved.</p>\n"}], "owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534864993, "creation_date": 1534850778, "last_edit_date": 1534851085, "question_id": 51947674, "link": "https://stackoverflow.com/questions/51947674/update-fields-create-new-foreignkey-items-instead-of-updating-them", "title": "Update fields create new foreignkey items instead of updating them", "body": "<p>I've got a one-to-one relationship, Location, working with postgresql:</p>\n\n<pre><code>type App struct {\n    gorm.Model\n\n    PersoID      string `gorm:\"primary_key;unique\" json:\"perso_id\"`\n\n    Location   OllyLocation `gorm:\"foreignkey:location_id\"`\n    LocationID *uint        `json:\"-\" gorm:\"type:integer REFERENCES locations(id)\"`\n\n    Users          []User       `json:\"users,omitempty\" gorm:\"many2many:app_users;\"`\n}\n\ntype Location struct {\n    ID        uint      `json:\"-\" gorm:\"primary_key;unique\"`\n    CreatedAt time.Time `json:\"-\"`\n    UpdatedAt time.Time\n\n    Lat         float64 `json:\"lat\"`\n    Long        float64 `json:\"long\"`\n    Address     string  `json:\"address\"`\n    Country     string  `json:\"country\"`\n}\n</code></pre>\n\n<p>But as you can see, the App structure has its own primaryKey id as string (and the GORM one).\nThus this block from doing a simple <code>db.Save()</code> from gorm.</p>\n\n<p>So I've tried to do:</p>\n\n<pre><code>func (previousModel *App) UpdateAndReturnedUpdated(db *gorm.DB, appUpdated *App) error {\n    if err := db.Model(previousModel).Update(appUpdated).Error; err != nil {\n        return err\n    }\n\n    return db.Preload(\"Location\").First(previousModel, App{PersoID: appUpdated.PersoID}).Error\n}\n</code></pre>\n\n<p>With this, the App is correctly updated - fantastic! - but not the Location.</p>\n\n<p>The location is re created in the db with the new values and the foreignKey LocationID is updated on the App.</p>\n\n<p>This is super annoying because if I want to do an update of the address only without specifying other fields, they are just re created with the original type value (lat / long will be 0)</p>\n\n<p>Any ideas about how to update the foreignKey? Thanks!</p>\n"}, {"tags": ["http", "go", "server"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534846418, "post_id": 51945810, "comment_id": 90842083, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29197685/how-to-close-abort-a-golang-http-client-post-prematurely\">how to close/abort a Golang http.Client POST prematurely</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1534851246, "post_id": 51945810, "comment_id": 90844966, "body": "Much clearer. Thanks.  It&#39;s still a duplicate, though :)"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 8, "last_activity_date": 1534847408, "creation_date": 1534847408, "answer_id": 51946691, "question_id": 51945810, "link": "https://stackoverflow.com/questions/51945810/how-to-non-destructively-check-if-an-http-client-has-shut-down-the-connection/51946691#51946691", "title": "How to non-destructively check if an HTTP client has shut down the connection?", "body": "<p>Interrogate the <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"noreferrer\">request context</a>:</p>\n\n<blockquote>\n  <p>For incoming server requests, the context is canceled when the client's connection closes, the request is canceled (with HTTP/2), or when the ServeHTTP method returns.</p>\n</blockquote>\n\n<pre><code>var r *http.Request\nselect {\n    case &lt;-r.Context().Done():\n        // Client gave up\n    default:\n}\n</code></pre>\n"}], "owner": {"reputation": 774, "user_id": 4838452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415db9ee399cfd4f383700942b45f977?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Klauer", "link": "https://stackoverflow.com/users/4838452/alexander-klauer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1149, "favorite_count": 1, "accepted_answer_id": 51946691, "answer_count": 1, "score": 6, "last_activity_date": 1534851120, "creation_date": 1534844370, "last_edit_date": 1534851120, "question_id": 51945810, "link": "https://stackoverflow.com/questions/51945810/how-to-non-destructively-check-if-an-http-client-has-shut-down-the-connection", "title": "How to non-destructively check if an HTTP client has shut down the connection?", "body": "<p>I have a <code>net/http</code> Server serving a GET request (via <code>ServeHTTP()</code>) which can take a very long time to complete. Consequently, no client timeout is configured server side. However, the connected client may have shut down its connection to the server (typically due to a timeout on its side, but of course, other reasons are possible as well). I have no control over the clients.</p>\n\n<p>How do I detect such a condition within <code>ServeHTTP()</code> without \"disturbing\" the connection?</p>\n\n<ul>\n<li>I cannot send a series of <code>1xx</code> response headers because it's not supported by <code>ResponseWriter.WriteHeader()</code> (also, it allows only one header to be set and does not return anything).</li>\n<li>I cannot use <code>ResponseWriter.Write()</code> with zero-sized data, as that would send a header.</li>\n</ul>\n\n<p>What other options do I have?</p>\n\n<p>Edit: this is not a duplicate of <a href=\"https://stackoverflow.com/questions/29197685/how-to-close-abort-a-golang-http-client-post-prematurely\">how to close/abort a Golang http.Client POST prematurely</a> because there the question is how to cancel a request from the client side while my question is about detecting such a cancellation from the server side. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1534841664, "post_id": 51945006, "comment_id": 90839455, "body": "Change <code>Connect()</code> to return <code>(A, error)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 0, "creation_date": 1534842533, "post_id": 51945045, "comment_id": 90839893, "body": "Thanks, but what if struct C and D are not in my package and I want to mock them? I can&#39;t edit these functions"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 0, "creation_date": 1534850362, "post_id": 51945045, "comment_id": 90844448, "body": "@Abdulafaja You do not want to mock functions. Thats what you might have been told to do is the right thing. It is not."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1534841710, "creation_date": 1534841710, "answer_id": 51945045, "question_id": 51945006, "link": "https://stackoverflow.com/questions/51945006/struct-does-not-implement-interface-if-it-has-a-function-which-parameter-impleme/51945045#51945045", "title": "Struct does not implement interface if it has a function which parameter implement interface", "body": "<p>The returned type for your <code>Connect</code> method should be <code>A</code> and not <code>*C</code>.</p>\n\n<p>The way you defined the <code>Connect</code> method is that it should return an interface, not a specific type. You will still be able to return <code>*C</code> as it implements the <code>A</code> interface.</p>\n\n<pre><code>package main\n\ntype A interface {\n    Close()\n}\n\ntype B interface {\n    Connect() (A, error)\n}\n\ntype C struct {\n}\n\nfunc (c *C) Close() {\n}\n\ntype D struct {\n}\n\nfunc (d *D) Connect() (A, error) {\n    c := new(C)\n    println(\"successfully created new C:\", c)\n    return c, nil\n}\n\nfunc test(b B) {\n    b.Connect()\n}\n\nfunc main() {\n    d := new(D)\n    test(d)\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<blockquote>\n  <p>successfully created new C: 0xe28f0</p>\n</blockquote>\n\n<p>Try it out yourself <a href=\"https://play.golang.org/p/0E7x1WLzFco\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 0, "creation_date": 1534842658, "post_id": 51945113, "comment_id": 90839950, "body": "Ok, I thought if *C implements A interface it is possible to use that. Imagine that C and D are from external package and I can&#39;t change their functions. How to mock them?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 1, "creation_date": 1534843326, "post_id": 51945113, "comment_id": 90840311, "body": "@Abdulafaja One thing you can do is import the struct from another package. If you cannot change the function then create a new one which should implement B."}, {"owner": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 0, "creation_date": 1534845415, "post_id": 51945113, "comment_id": 90841541, "body": "thanks, it was the most helpful. I have created another structure which override external struct and I have added correct function (like here <a href=\"https://stackoverflow.com/questions/28800672/how-to-add-new-methods-to-an-existing-type-in-go\" title=\"how to add new methods to an existing type in go\">stackoverflow.com/questions/28800672/&hellip;</a>). But still I think that compiler should pass my code"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "edited": false, "score": 1, "creation_date": 1534846350, "post_id": 51945113, "comment_id": 90842050, "body": "@Abdulafaja you can accept the answer if it is helpful to you."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1534873307, "last_edit_date": 1534873307, "creation_date": 1534841957, "answer_id": 51945113, "question_id": 51945006, "link": "https://stackoverflow.com/questions/51945006/struct-does-not-implement-interface-if-it-has-a-function-which-parameter-impleme/51945113#51945113", "title": "Struct does not implement interface if it has a function which parameter implement interface", "body": "<p>For implementing the interface there is one to concern about which is:</p>\n\n<blockquote>\n  <p>A Go type satisfies an interface by implementing the methods of that\n  interface, nothing more. This property allows interfaces to be defined\n  and used without having to modify existing code. It enables a kind of\n  structural typing that promotes separation of concerns and improves\n  code re-use, and makes it easier to build on patterns that emerge as\n  the code develops.</p>\n</blockquote>\n\n<p>The error you are getting because the struct <code>D</code> you are using as an argument to test function does not implement the interface. The reason behind this is that the function <code>Connect</code> you are using with receiver <code>D</code> is different. Since it has different return type:</p>\n\n<pre><code>func (d *D) Connect() (*C, error) { // the struct D does not implement the interface B because of wrong function definition to interface B function\n    c := new(C)\n    return c, nil\n}\n</code></pre>\n\n<p>while if you want to implement the interface <code>B</code> the function definition along with its return type should match the function in interface <code>B</code> which is</p>\n\n<pre><code>type B interface {\n    Connect() (A, error)\n}\n</code></pre>\n\n<p>So if you want to implement the interface the Connect method you are using should match the Connect method of the interface B</p>\n\n<pre><code>package main\n\ntype A interface {\n    Close()\n}\ntype B interface {\n    Connect() (A, error)\n}\n\ntype C struct {\n}\n\nfunc (c *C) Close() {\n\n}\n\ntype D struct {\n}\n\nfunc (d *D) Connect() (A, error) {\n    c := new(C)\n    return c, nil\n}\n\nfunc test(b B) {}\n\nfunc main() {\n    d := new(D)\n    test(d)\n}\n</code></pre>\n\n<p>Check on <a href=\"https://play.golang.org/p/wn4PyVz_vS2\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>Consider this simple interface to represent an object that can compare itself with another value:</p>\n\n<pre><code>type Equaler interface {\n    Equal(Equaler) bool\n}\n</code></pre>\n\n<p>and this type, T:</p>\n\n<pre><code>type T int\nfunc (t T) Equal(u T) bool { return t == u } // does not satisfy Equaler\n</code></pre>\n\n<p>The argument type of T.Equal is T, not literally the required type Equaler.</p>\n\n<p>In Go, the type system does not promote the argument of Equal; that is the programmer's responsibility, as illustrated by the type T2, which does implement Equaler:</p>\n\n<pre><code>type T2 int\nfunc (t T2) Equal(u Equaler) bool { return t == u.(T2) }  // satisfies Equaler\n</code></pre>\n"}], "owner": {"reputation": 224, "user_id": 6709516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8e7bf85f79cba425a52312330e874?s=128&d=identicon&r=PG&f=1", "display_name": "Abdulafaja", "link": "https://stackoverflow.com/users/6709516/abdulafaja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534873307, "creation_date": 1534841557, "question_id": 51945006, "link": "https://stackoverflow.com/questions/51945006/struct-does-not-implement-interface-if-it-has-a-function-which-parameter-impleme", "title": "Struct does not implement interface if it has a function which parameter implement interface", "body": "<p>I have a package in which I have two interfaces</p>\n\n<pre><code>package main\ntype A interface {\n    Close()\n}\ntype B interface {\n    Connect() (A, error)\n}\n</code></pre>\n\n<p>I have also two structures which implements these interfaces</p>\n\n<pre><code>type C struct {\n}\n\nfunc (c *C) Close() {\n\n}\n\ntype D struct {\n}\n\nfunc (d *D) Connect() (*C, error) {\n    c := new(C)\n    return c, nil\n}\n</code></pre>\n\n<p>Next I have a function which as a parameter wants an object which implements interface B</p>\n\n<pre><code>func test(b B) {\n}\n</code></pre>\n\n<p>Finally, at the main() function I create D structure object and want to call test() function</p>\n\n<pre><code>func main() {\n    d := new(D)\n    test(d)\n}\n</code></pre>\n\n<p>If I try to build that package I have an error.</p>\n\n<blockquote>\n  <p>cannot use d (type *D) as type B in argument to test:\n          *D does not implement B (wrong type for Connect method)\n                  have Connect() (*C, error)\n                  want Connect() (A, error)</p>\n</blockquote>\n\n<p>It is simple example of my code where I use external package and want to mock structures for tests. Is it any solution to use interfaces instead of types?</p>\n"}, {"tags": ["go", "dialogflow-es"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10253767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/decbefb38f2b0ffed699efda94c9d5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Haru", "link": "https://stackoverflow.com/users/10253767/haru"}, "is_accepted": false, "score": 0, "last_activity_date": 1534897194, "creation_date": 1534897194, "answer_id": 51958328, "question_id": 51944976, "link": "https://stackoverflow.com/questions/51944976/how-to-kick-followupevent-from-dialoflow-webhook-in-golang/51958328#51958328", "title": "How to kick FollowupEvent from dialoflow webhook in Golang", "body": "<p>solved:</p>\n\n<p>foovar:= &amp;dialogflow.GoogleCloudDialogflowV2EventInput{\n        LanguageCode: \"en\",\n        Name:         \"nextevent-follow\",\n        Parameters:   []byte(messages),\n    }</p>\n"}], "owner": {"reputation": 1, "user_id": 10253767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/decbefb38f2b0ffed699efda94c9d5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Haru", "link": "https://stackoverflow.com/users/10253767/haru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1534897361, "creation_date": 1534841461, "last_edit_date": 1534897361, "question_id": 51944976, "link": "https://stackoverflow.com/questions/51944976/how-to-kick-followupevent-from-dialoflow-webhook-in-golang", "title": "How to kick FollowupEvent from dialoflow webhook in Golang", "body": "<p>I am not familiar with Go. Could you tell me how to build correct structure of dialogflow.GoogleCloudDialogflowV2WebhookResponse for Followup event.</p>\n\n<p>The following code is not working: </p>\n\n<pre><code>return dialogflow.GoogleCloudDialogflowV2WebhookResponse{\n    FollowupEventInput: &amp;dialogflow.GoogleCloudDialogflowV2EventInput{Name: \"event-follow\"},\n}\n</code></pre>\n"}, {"tags": ["go", "oauth", "ibm-cloud", "cloud-foundry"], "comments": [{"owner": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 0, "creation_date": 1534951778, "post_id": 51944243, "comment_id": 90890957, "body": "What sort of &quot;token scenario&quot;? For cli based apps, you&#39;re typically going to do what you&#39;ve done already and require the user to enter their credentials or you&#39;re going to use client credentials (which is like a service account). The only other option would be to require someone to enter an existing bearer token, but that&#39;s not a good user experience. For web based apps, you&#39;re going to want to use standard oauth2 authorization flow. Your client of choice might help you implement these scenarios, but ultimately it&#39;s pick a oauth2 flow: <a href=\"https://auth0.com/docs/api-auth/which-oauth-flow-to-use\" rel=\"nofollow noreferrer\">auth0.com/docs/api-auth/which-oauth-flow-to-use</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 1, "creation_date": 1535020554, "post_id": 51944243, "comment_id": 90916957, "body": "@DanielMikusa - Thanks! , not really sure how can I test it E2E with CF golnag client and with client that path the oauth2 token, it will be great if you can provide example"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 0, "creation_date": 1536411221, "post_id": 51944243, "comment_id": 91419532, "body": "@DanielMikusa - I put a bounty please have a look and see if you can assist, thanks in advance!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1536745661, "post_id": 52290974, "comment_id": 91532236, "body": "Thanks! ,Can you please provide the full solution (the code) how can I receive it and pass it to the <code>cf client</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1536745915, "post_id": 52290974, "comment_id": 91532386, "body": "please Dont worry about  the refresh , even for the first time connection with token this is suffienct for me"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1536837566, "post_id": 52290974, "comment_id": 91572091, "body": "it will be great if you can provide all your code, I want to test it on my end"}], "tags": [], "owner": {"reputation": 362, "user_id": 1111002, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5175ed7bc99de14d8026f9173bdbb679?s=128&d=identicon&r=PG", "display_name": "sio4", "link": "https://stackoverflow.com/users/1111002/sio4"}, "is_accepted": false, "score": 2, "last_activity_date": 1536834376, "last_edit_date": 1536834376, "creation_date": 1536741671, "answer_id": 52290974, "question_id": 51944243, "link": "https://stackoverflow.com/questions/51944243/how-to-use-cf-client-with-user-token-e2e/52290974#52290974", "title": "How to use CF client with user token E2E", "body": "<p>You can find a typical OAuth2 token handling sequence for CF from the link below. For using this token for the other API call, you can also refer to other test cases.</p>\n\n<p><a href=\"https://github.com/cloudfoundry-community/go-cfclient/blob/a0a191bdc19a7a7189c050444aeaf20d2a125875/client_test.go#L117\" rel=\"nofollow noreferrer\">https://github.com/cloudfoundry-community/go-cfclient/blob/a0a191bdc19a7a7189c050444aeaf20d2a125875/client_test.go#L117</a></p>\n\n<p>Anyway, it is an OAuth2 token which is expired after its expiration period. You cannot avoid login with user/pass if you do not refresh it within the expiration period.</p>\n\n<p><strong>UPDATED</strong></p>\n\n<p>You already said you can log in with username and password, so what you need to do is simply get token with API call for it. something like:</p>\n\n<pre><code>c := &amp;Config{\n    ApiAddress: myApiAddress,\n    Username:   \"foo\",\n    Password:   \"bar\",\n}\n\nclient, err1 := NewClient(c)\nif err1 != nil {\n    // error handling for connection failure\n}\n// you already reach here. right?\n\ntoken, err2 := client.GetToken()\nif err2 != nil {\n    // error handling for token retreive failure\n}\n\n// just do what you want with token\n</code></pre>\n\n<p>you can find what is happening under the hood by checking the source: <a href=\"https://github.com/cloudfoundry-community/go-cfclient/blob/a0a191bdc19a7a7189c050444aeaf20d2a125875/client.go#L375\" rel=\"nofollow noreferrer\">https://github.com/cloudfoundry-community/go-cfclient/blob/a0a191bdc19a7a7189c050444aeaf20d2a125875/client.go#L375</a></p>\n\n<p>for more information, jsut try to print out the <code>client</code> structure:</p>\n\n<pre><code>fmt.Printf(\"client: %v\\n\", client)\n</code></pre>\n\n<p>then I guess you can found more information.</p>\n"}, {"tags": [], "owner": {"reputation": 2754, "user_id": 849632, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/NDhZK.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/849632/arun"}, "is_accepted": false, "score": 0, "last_activity_date": 1536928655, "creation_date": 1536928655, "answer_id": 52332210, "question_id": 51944243, "link": "https://stackoverflow.com/questions/51944243/how-to-use-cf-client-with-user-token-e2e/52332210#52332210", "title": "How to use CF client with user token E2E", "body": "<p>I would always prefer writing a <code>Wrapper-Script</code> using <code>Powershell</code> or in <code>Bash</code> scripting Language</p>\n\n<p>Your <code>CF-CLI</code> leaves all the login information under <code>~\\.cf\\config.json</code> and reading this using script language is very easy and not demands high programming effort.</p>\n\n<p>In my case, I used this to switch between different foundations. My Powershell script would execute with this command <code>./cfwrapper switch</code></p>\n\n<pre><code>Function SwitchFoundation () {\n\n    Write-Host 'Which Foundation You would like to Switch ??'`n\n    $foundationNumber = FoundationPrompt\n    $foundationIndex = $foundationNumber-1\n    $foundations = $foundationsJsonSettings\n    $foundation = $foundations[$foundationIndex]\n\n\n    if ($foundation -ne $null) {\n        if (Test-Path $configPath$foundationNumber) {\n            Write-Host 'You are now getting Switched to another Foundation. Please wait for a moment'`n\n            CopyConfig ($foundationNumber) ('reverse')\n            cf target\n        }else {\n            Write-Host 'Your login to this Foundation is not found. Kindly do a Fresh login below'`n\n            CFLoginSSOCommand ($foundationNumber) ($foundation.api_url)\n        }\n\n    } else {\n        Write-Host 'Foundation Number is wrong. Please retry..'\n    }\n\n\n}\n\nFunction CFLoginSSOCommand ($foundationNumber,$apiUrl) {\n    Write-Host 'Logout command will be executed blankly to flush out all your current Logins'\n    cf logout\n    cf login --sso -a $apiUrl\n    CopyConfig($foundationNumber)\n\n\n}\n\nFunction CopyConfig($foundationNumber, $flag) {\n    Write-Host 'Copying Config Path'\n    if ($flag -eq 'reverse') {\n        Copy-Item -Path $configPath$foundationNumber -Destination $configPath\n    }else {\n        Copy-Item -Path $configPath -Destination $configPath$foundationNumber\n    }\n\n}\n</code></pre>\n\n<p>In short, CF-CLI has got all the necessary commands.. All that we require is to write a simple wrapper around it .</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 1, "answer_count": 2, "score": 9, "last_activity_date": 1536928655, "creation_date": 1534838674, "last_edit_date": 1536912433, "question_id": 51944243, "link": "https://stackoverflow.com/questions/51944243/how-to-use-cf-client-with-user-token-e2e", "title": "How to use CF client with user token E2E", "body": "<p>I want to use the <a href=\"https://github.com/cloudfoundry-community/go-cfclient\" rel=\"nofollow noreferrer\">go-cfclient</a> library to connect to <strong>Cloud Foundry</strong> and check for application services etc.</p>\n\n<p>I was able to connect with Java/Node/Go while using <strong>my user password <em>explicit in the code</em></strong>.</p>\n\n<p>Now I want to simulate a scenario using a <strong>token</strong>, i.e. <strong>instead</strong> of using my password, use <strong>my user token</strong> to simulate the connection.</p>\n\n<p>How can I achieve this kind of simulation?</p>\n\n<p>Preferred in <a href=\"https://github.com/cloudfoundry-community/go-cfclient\" rel=\"nofollow noreferrer\">go-cfclient</a> or Node.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I need an E2E real-life example with a CF token where the user uses some sample UI and maybe provides some credentials the first time, but all subsequent requests should work with the CF token only.</p>\n\n<p>I need this example in Golang.</p>\n"}, {"tags": ["go", "struct", "types", "casting"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534833778, "post_id": 51942947, "comment_id": 90835463, "body": "That is not possible if you have struct in another package or file and wants to create another struct of the same type even using type assertion. What you can do is create another struct with same fields and fetch their value to be used in your function. But still both struct will be different."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1534835119, "creation_date": 1534835119, "answer_id": 51943322, "question_id": 51942947, "link": "https://stackoverflow.com/questions/51942947/can-you-type-assert-an-anonymous-struct/51943322#51943322", "title": "Can you type assert an anonymous struct?", "body": "<blockquote>\n  <p>Can you type assert an anonymous struct?</p>\n</blockquote>\n\n<p>Of course you can!  But there are limitations.</p>\n\n<p>Some things that will work:</p>\n\n<ol>\n<li><p>Assert to a matching anonymous struct:</p>\n\n<pre><code>x := interface{}(struct { Count int }{Count: 5})\nfmt.Printf(\"x's count: %d\\n\", x.(struct{Count int}).Count)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uF9FBPqp0PN\" rel=\"nofollow noreferrer\">Playground</a>.</p></li>\n<li><p>Assert to an interface:</p>\n\n<pre><code>    type Fooer interface {\n    Foo()\n}\n\ntype X struct {}\n\nfunc (x X) Foo() { fmt.Printf(\"X Fooed\\n\") }\n\n\nfunc main() {\n    x := interface{}(struct { X }{ X{} }) // An anonymous struct which embeds X\n    x.(Fooer).Foo()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MtSt7hT7Ulj\" rel=\"nofollow noreferrer\">Playground</a>.</p></li>\n</ol>\n\n<p>Some things that won't work:</p>\n\n<ol>\n<li><p>Assert to a matching anonymous struct from another package, with un-exported fields.</p>\n\n<pre><code>x := url.UserPassword(\"foo\",\"bar\")\nfmt.Printf(\"Username: %s\\n\", x.(struct{username string; password string; passwordSet bool}).username)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/WnXSOl4w4VQ\" rel=\"nofollow noreferrer\">Playground</a>.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1534835420, "creation_date": 1534835420, "answer_id": 51943395, "question_id": 51942947, "link": "https://stackoverflow.com/questions/51942947/can-you-type-assert-an-anonymous-struct/51943395#51943395", "title": "Can you type assert an anonymous struct?", "body": "<p>What you try to do in your specific case is not possible. Even though the <code>Struct1</code> and your anonymous struct have the same layout, they are different types for the Go compiler. Think of the time.Duration for example, it is actually just an <code>int64</code> but you cannot use them interchangeably. This is done on purpose in Go. Other languages, like C, allow you to do all kinds of conversions and casts and will rarely give you a compiler error. This has shown to be a source of programmer errors and thus was done differently in Go.</p>\n\n<p>To still give you a \"solution\" to your problem, just for completeness, here is a version that uses C-like unsafe casts to make your anonymous struct into a <code>Struct1</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype S struct {\n    i int\n}\n\ntype I interface {\n    display()\n}\n\nfunc (s S) display() {\n    fmt.Println(s.i)\n}\n\nfunc check(i interface{}) {\n    i.(S).display()\n}\n\nfunc main() {\n    data := struct{ int }{2}\n    // check(data) this will not work\n    check(*((*S)(unsafe.Pointer(&amp;data))))\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10132765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e74516adada96074df5984ba41a074f3?s=128&d=identicon&r=PG&f=1", "display_name": "Nirmal Agrawal", "link": "https://stackoverflow.com/users/10132765/nirmal-agrawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1011, "favorite_count": 0, "accepted_answer_id": 51943322, "answer_count": 2, "score": 1, "last_activity_date": 1534835420, "creation_date": 1534833529, "question_id": 51942947, "link": "https://stackoverflow.com/questions/51942947/can-you-type-assert-an-anonymous-struct", "title": "Can you type assert an anonymous struct?", "body": "<p>I want to do something like this:</p>\n\n<pre><code>type Struct1 struct {\n    var1 int\n}\n\ntype i interface {\n    display()\n}\n\nfunc (s Struct1) display() {\n    fmt.Println(s.var1)\n}\n\nfunc check(i interface{}) {\n    i.(Struct1).display()\n}\n\nfunc main() {\n    data := struct {\n        int\n    }{\n        2,\n    }\n\n    check(interface{}(data))\n}\n</code></pre>\n\n<p>I have a function in an external dependency that accepts and returns interface{} type. That function type asserts a struct(let's say Struct1). The struct has fields that are not exported to I cannot create an instance of it to pass to the function. I know what fields it has, their names and types. Is it possible to send data not of type Struct1 that can be asserted to become Struct1 type.</p>\n"}, {"tags": ["c", "go", "shared-libraries"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534832991, "post_id": 51942486, "comment_id": 90835084, "body": "look over <a href=\"https://stackoverflow.com/questions/27506579/calling-functions-in-an-so-file-from-go\">here</a>"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 2, "creation_date": 1534833057, "post_id": 51942486, "comment_id": 90835114, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27506579/calling-functions-in-an-so-file-from-go\">Calling functions in an so file from Go</a>"}, {"owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1534835938, "post_id": 51942486, "comment_id": 90836514, "body": "I edited question to explain more what i want to get"}], "owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1008, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534835755, "creation_date": 1534831341, "last_edit_date": 1534835755, "question_id": 51942486, "link": "https://stackoverflow.com/questions/51942486/golang-using-so-in-linux", "title": "Golang using .so in Linux", "body": "<p>How can I load <code>.so</code> on Linux?</p>\n\n<p>On Windows I do something like this:</p>\n\n<pre><code>h, e = syscall.LoadLibrary(\"name.dll\") \n    if e != nil {\n        log.Fatal(e)\n    }\n    defer syscall.FreeLibrary(h)\n</code></pre>\n\n<p>Is it possible to do it on Linux with <code>.so</code> library?</p>\n\n<pre><code>proc, e := syscall.GetProcAddress(h, processName) //One of the functions in the DLL\nif e != nil {\n    log.Fatal(\"errror:\", e, processName)\n}\npid, _, _ := syscall.Syscall6(uintptr(proc), uintptr(paramSize), a1, a2, a3, 0, 0, 0) //handler, countParam, param, 0 // zawiera jakiego\u015b print \"Hello World\" - value\nfmt.Println(processName, pid)\n</code></pre>\n\n<p>I want to get the function(process) address and use it to call in syscall.Syscall6.</p>\n\n<p>There is answer with using CGo but it is not complete and doesn't explain how to void this function and pass param to it.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 4, "last_activity_date": 1534823829, "creation_date": 1534823829, "answer_id": 51941346, "question_id": 51941132, "link": "https://stackoverflow.com/questions/51941132/how-to-kill-goroutines/51941346#51941346", "title": "How to kill goroutines?", "body": "<blockquote>\n  <p>Is there a way to stop the below goroutine before it returns?</p>\n</blockquote>\n\n<p>No there is not (except calling os.Exit to abort the whole program).</p>\n\n<p>Goroutines are self-contained and not controllable from the outside.</p>\n"}], "owner": {"reputation": 811, "user_id": 7591522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36651b6d9cf1af9d50e3657f0f05cec5?s=128&d=identicon&r=PG&f=1", "display_name": "Andr&#233; Betz", "link": "https://stackoverflow.com/users/7591522/andr%c3%a9-betz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 1, "closed_date": 1534831545, "answer_count": 1, "score": 3, "last_activity_date": 1534823829, "creation_date": 1534821787, "last_edit_date": 1534823618, "question_id": 51941132, "link": "https://stackoverflow.com/questions/51941132/how-to-kill-goroutines", "closed_reason": "Duplicate", "title": "How to kill goroutines?", "body": "<p>I would like to know how to kill/stop goroutines. All examples are based on channels and select, which seems to only work if the goroutine contains some repeating task between which it can listen on a channel. Is there a way to stop the below goroutine before it returns?</p>\n\n<pre><code>package main\n\nimport (\n        \"time\"\n)\n\nfunc main() {\n    stop := make(chan string, 1)\n\n    go func() {\n        time.Sleep(10 * time.Second)\n        stop &lt;- \"stop\"\n        return\n    }()\n    &lt;- stop\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534824069, "post_id": 51940582, "comment_id": 90832409, "body": "Duplicate. For loop var reused."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534866243, "post_id": 51940582, "comment_id": 90854902, "body": "This question is already closed but for future reference please post text, not screenshots of text."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1534823958, "creation_date": 1534823958, "answer_id": 51941360, "question_id": 51940582, "link": "https://stackoverflow.com/questions/51940582/goroutine-in-a-loop-with-a-channel/51941360#51941360", "title": "goroutine in a loop with a channel", "body": "<p>Loop variables are reused: Every iteration of the for loop uses the <em>same</em> <code>task</code> variable and thus all your goroutines receive the same address.</p>\n\n<p>(And do not post screenshots).</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 1, "creation_date": 1534850444, "post_id": 51944579, "comment_id": 90844483, "body": "The anonymous function take a pointer, so you should pass &amp;t to it. If it would take a value, you could pass task directly."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1534851329, "post_id": 51944579, "comment_id": 90845012, "body": "Yep, fixed example"}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 1, "last_activity_date": 1534850964, "last_edit_date": 1534850964, "creation_date": 1534839980, "answer_id": 51944579, "question_id": 51940582, "link": "https://stackoverflow.com/questions/51940582/goroutine-in-a-loop-with-a-channel/51944579#51944579", "title": "goroutine in a loop with a channel", "body": "<p>As it was mentioned in the previous answer the address of the task loop variable is always the same. So this should work for you:</p>\n\n<pre><code>for _, task := range tasks {\n        t := task\n        fmt.Println(\"task \", t.Name)\n        time.Sleep(2 * time.Second)\n        go func(t *DB.TaskLog) {\n            defer GetTaskQueue().Done()\n            fmt.Println(\"task \", t.Name)\n            CrawlAirdrop(t.Link)\n        }(&amp;t)\n\n        select {\n        case &lt;-ctx.Done():\n            return\n        default:\n        }\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9055468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fcf576d8c7cfdac5e505f368e36e3a8?s=128&d=identicon&r=PG&f=1", "display_name": "Sylvia", "link": "https://stackoverflow.com/users/9055468/sylvia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 848, "favorite_count": 0, "closed_date": 1534858172, "answer_count": 2, "score": -1, "last_activity_date": 1534850964, "creation_date": 1534816418, "last_edit_date": 1534822927, "question_id": 51940582, "link": "https://stackoverflow.com/questions/51940582/goroutine-in-a-loop-with-a-channel", "closed_reason": "Not suitable for this site", "title": "goroutine in a loop with a channel", "body": "<p><img src=\"https://i.stack.imgur.com/h5LMZ.png\" alt=\"enter image description here\"></p>\n\n<p>Note: <code>GetTaskQueue()</code> returns a global variable which struct is </p>\n\n<pre><code>type TaskQueue struct {\n    ch   chan int\n    wg   *sync.WaitGroup\n}\n</code></pre>\n\n<p>The channel is used to limit the number of goroutines, and the max number of goroutines is set to be 3.</p>\n\n<p>My expectation is that all <code>t</code>s should match the <code>task</code>s. However, <code>Dominium</code> and <code>dApp Builder</code> did not show in <code>t</code>, while <code>EthicHub Twitter</code> and <code>Apollo</code> duplicated.</p>\n\n<p>The output is shown below.</p>\n\n<p><img src=\"https://i.stack.imgur.com/4K8BI.png\" alt=\"enter image description here\"></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1534815135, "post_id": 51940356, "comment_id": 90830717, "body": "Yes, <code>:=</code> creates a new variable. <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">That is its purpose</a>. Generally, don&#39;t do that with an HTTP client. Create one and re-use it (or at least the Transport). The nil pointer dereference probably happens because you continue execution even after errors occur, or because you use the response without checking the error first."}, {"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534815517, "post_id": 51940356, "comment_id": 90830778, "body": "If I create one and reuse it won&#39;t it be problem as its a pointer variable..Other coroutines will refer to the same one and override the result?  Regarding the invalid memory address - its because of - socket: too many open files panic: runtime error"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1534816117, "post_id": 51940356, "comment_id": 90830886, "body": "That error happens because you create way, way too many clients. Each one maintains its own connection pool. Not sure what you mean by &quot;override the result&quot;. It&#39;s also unclear why you don&#39;t just use <a href=\"https://golang.org/pkg/net/http/#pkg-variables\" rel=\"nofollow noreferrer\">http.DefaultClient</a>."}, {"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534816222, "post_id": 51940356, "comment_id": 90830903, "body": "When I create the pointer variable and reuse it, won&#39;t the same variable be shared with other co-routines causing confusion..I will check  on defaultclient..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534816322, "post_id": 51940356, "comment_id": 90830920, "body": "&quot;The Client&#39;s Transport typically has internal state (cached TCP connections), so Clients should be reused instead of created as needed. Clients are safe for concurrent use by multiple goroutines.&quot; <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Client</a>"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1535955027, "post_id": 51940356, "comment_id": 91237706, "body": "its late but can you share rest of log error ?"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535963447, "creation_date": 1534814227, "last_edit_date": 1535963447, "question_id": 51940356, "link": "https://stackoverflow.com/questions/51940356/go-handling-coroutines-variable-initialization", "title": "go handling coroutines variable initialization", "body": "<p>Im trying to create goroutines for a http call. I have huge number of URL's.</p>\n\n<p>I create a batch of 200 and send a batch request to the api.</p>\n\n<p>Question:-</p>\n\n<ol>\n<li><p>When I create the client object - client := &amp;http.Client{}, I see a pointer variable is created, will it create a new one for each and every iteration of the for loop? How can I check if the client object created is unique or its pointing to the same one?</p></li>\n<li><p>When I run this program with 250 batches I don't see a issues but once I increase to 270 it fails with an error. Error is given below, Not sure if this is memory error or program error.</p>\n\n<pre><code>for _, batch := range data_batch {\n\n        var str_join string = strings.Join(batch, \",\")\n\n        // fmt.Println(str_join)\n        str_join = \"{\" + \"\\\"inputs\\\":[\" + str_join + \"]}\"\n\n        input_json_data := []byte(str_join)\n\n        var output core.Data\n\n        go http_call(respond, &amp;wg, input_json_data, output)\n\n    }\n\n\nfunc http_call(respond chan&lt;- core.Data, wg *sync.WaitGroup, input_json_data []byte, output core.Data) {\n    defer wg.Done()\n\n\n\n    // clarifai http request URL\n    httpurl := os.Getenv(\"api_url\")\n\n    //Create the client Object\n    client := &amp;http.Client{}\n\n    //generating the HTTP GET request\n    request, err := http.NewRequest(\"POST\", httpurl, bytes.NewBuffer(input_json_data))\n    if err != nil {\n        log.Println(err)\n    }\n\n    // setting authorization\n\n    api_key := \"Key \" + os.Getenv(\"api_key\")\n    request.Header.Add(\"Authorization\", api_key)\n\n    // setting content-type\n    request.Header.Add(\"Content-Type\", \"application/json\")\n\n    //calling the URL\n    response, err := client.Do(request)\n\n    if response.StatusCode != 200 {\n        if err != nil {\n            log.Println(err)\n\n        }\n        log.Println(\"statuscode = \", response.StatusCode)\n    }\n\n    bodyBytes, _ := ioutil.ReadAll(response.Body)\n    bodyString := string(bodyBytes)\n\n    err = json.Unmarshal([]byte(bodyString), &amp;output)\n\n    if err != nil {\n        print(err)\n    }\n    respond &lt;- output\n\n}\n</code></pre></li>\n</ol>\n\n<p>Error:-</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0xb5593]\n\ngoroutine 261 [running]:\ngithub.com/p/go/utils.http_call(0xc820440d80, 0xc8204317a0, 0xc82052b730, 0x68, 0x70, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n</code></pre>\n"}, {"tags": ["go", "aws-lambda", "aws-sdk", "serverless-framework"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 1138897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ac2173b11737eda8eec8d35e9e8a75?s=128&d=identicon&r=PG", "display_name": "PotatoPeanut", "link": "https://stackoverflow.com/users/1138897/potatopeanut"}, "edited": false, "score": 0, "creation_date": 1534860993, "post_id": 51939991, "comment_id": 90851536, "body": "The region looks right, and I am using the ARN as the function name. I have <code>hooknodeFnName</code> as a <code>const</code>.  Just to clarify, I am able to invoke the lambda. It just seems like the <code>payload</code> is not making it, and is blank."}], "tags": [], "owner": {"reputation": 487, "user_id": 2314120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0HGk8.jpg?s=128&g=1", "display_name": "Chad Elias", "link": "https://stackoverflow.com/users/2314120/chad-elias"}, "is_accepted": false, "score": 0, "last_activity_date": 1540353006, "last_edit_date": 1540353006, "creation_date": 1534810283, "answer_id": 51939991, "question_id": 51939336, "link": "https://stackoverflow.com/questions/51939336/how-to-handle-manual-invoked-aws-lambda-using-serverless-framework/51939991#51939991", "title": "How to handle manual invoked AWS lambda using serverless framework", "body": "<p>Check the region that this function is in, and then check the region from which you are calling the function.</p>\n\n<p>Instead of supplying the function name, insert the functions ARN as the function name.</p>\n\n<pre><code>Payload: JSON.stringify(payload) \n</code></pre>\n\n<p>instead of just</p>\n\n<pre><code>Payload: payload\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 1138897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ac2173b11737eda8eec8d35e9e8a75?s=128&d=identicon&r=PG", "display_name": "PotatoPeanut", "link": "https://stackoverflow.com/users/1138897/potatopeanut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 208, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1540353006, "creation_date": 1534804415, "question_id": 51939336, "link": "https://stackoverflow.com/questions/51939336/how-to-handle-manual-invoked-aws-lambda-using-serverless-framework", "title": "How to handle manual invoked AWS lambda using serverless framework", "body": "<p>I am manually invoking my lambda function since the 30s HTTP gateway timeout is too short for my purpose. The function was working when using HTTP, but when I manually invoke the function, the <code>request.Body</code> is empty.</p>\n\n<p>Here is the handler on my lambda code:</p>\n\n<pre><code>func handler(request events.APIGatewayProxyRequest) \n    (events.APIGatewayProxyResponse, error) {\n    // Left out implementation details.\n    // request.Body == \"\" here\n}\n</code></pre>\n\n<p>Here is how I invoke it:</p>\n\n<pre><code>func InvokeHooknode(req *HooknodeReq) error {\n    // Serialize params\n    payload, err := json.Marshal(*req)\n    if err != nil {\n        return err\n    }\n\n    // Invoke lambda.\n    client := lambda.New(sess)\n    res, err := client.Invoke(&amp;lambda.InvokeInput{\n        FunctionName: aws.String(hooknodeFnName),\n        Payload:      payload,\n    })\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I've printed out <code>payload</code>, and it looks correct. I'm just not sure how to access the payload in my lambda handler.</p>\n"}, {"tags": ["go", "dry"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1534815760, "post_id": 51939102, "comment_id": 90830814, "body": "Presumably the else branch is different too. Just keep two functions, if you ask me. These functions are so small that removing a bit of duplication isn&#39;t worth the trouble of giving up static type safety or converting slice types elsewhere to work with a &quot;unified&quot; API."}], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1534806152, "post_id": 51939495, "comment_id": 90829062, "body": "I&#39;m guessing the channel itself can at least commit to the type <code>&lt;-chan []datum.Candle</code> in the function signature; the unchecked type assertion in the first line is risky."}, {"owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1534818261, "post_id": 51939495, "comment_id": 90831266, "body": "simplified function signature suggested by David"}], "tags": [], "owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "is_accepted": false, "score": 1, "last_activity_date": 1534817908, "last_edit_date": 1534817908, "creation_date": 1534805686, "answer_id": 51939495, "question_id": 51939102, "link": "https://stackoverflow.com/questions/51939102/how-to-combine-two-functions-that-only-differ-in-parameter-type/51939495#51939495", "title": "How to combine two functions that only differ in parameter type", "body": "<p>use type <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"nofollow noreferrer\">assertions</a></p>\n\n<pre><code>func addDaysListener(ch &lt;-chan []datum.Candle , db *sql.DB) {\n    for days := range ch {\n        if len(days) == 0 {\n            continue\n        }\n\n        logger := logrus.WithFields(logrus.Fields{\n           \"ticker\": days[0].Ticker(),\n           \"count\":  len(days),\n       })\n\n     switch v:=days.(type){\n       case  []entity.Day:\n            if err := update.InsertDays(db,v); err != nil {\n               logger.Error(err)\n            } else {\n               logger.Info(\"Inserted Days\")\n            }\n       case  []entity.Minute:\n            if err := update.InsertMinutes(db, v); err != nil {\n               logger.Error(err)\n            } else {\n               logger.Info(\"Inserted Minutes\")\n            }\n\n      }\n\n   }\n  }\n</code></pre>\n"}], "owner": {"reputation": 364, "user_id": 4665078, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kuO4jWrTmAo/AAAAAAAAAAI/AAAAAAAABwY/KFhPAPCI3OE/photo.jpg?sz=128", "display_name": "onwsk8r", "link": "https://stackoverflow.com/users/4665078/onwsk8r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1534817908, "creation_date": 1534802817, "question_id": 51939102, "link": "https://stackoverflow.com/questions/51939102/how-to-combine-two-functions-that-only-differ-in-parameter-type", "title": "How to combine two functions that only differ in parameter type", "body": "<p>So I have this golang function that looks like this:</p>\n\n<pre><code>func addDaysListener(ch &lt;-chan []entity.Day, db *sql.DB) {\n    for days := range ch {\n        if len(days) == 0 {\n            continue\n        }\n\n        logger := logrus.WithFields(logrus.Fields{\n            \"ticker\": days[0].Ticker(),\n            \"count\":  len(days),\n        })\n        if err := update.InsertDays(db, days); err != nil {\n            logger.Error(err)\n        } else {\n            logger.Info(\"Inserted Days\")\n        }\n    }\n}\n</code></pre>\n\n<p>I also have a function called <code>addMinutesListener()</code> that is identical EXCEPT:</p>\n\n<ul>\n<li>It listens on a <code>&lt;-chan []entity.Minute</code></li>\n<li>It calls <code>update.InsertMinutes()</code></li>\n</ul>\n\n<p>Both <code>entity.Day</code> and <code>entity.Minute</code> implement <code>datum.Candle</code>, although the update functions require the specific type. I'd like to write something like this:</p>\n\n<pre><code>func addItemsListener(db *sql.DB, ch &lt;-chan []datum.Candle, insertFunc func(*sql.DB, []datum.Candle) error) {\n    for items := range ch {\n        if len(items) == 0 {\n            continue\n        }\n\n        logger := logrus.WithFields(logrus.Fields{\n            \"ticker\": items[0].Ticker(),\n            \"count\":  len(items),\n        })\n        if err := insertFunc(db, items); err != nil {\n            logger.Error(err)\n        } else {\n            logger.Info(\"Inserted Days\")\n        }\n    }\n}\n</code></pre>\n\n<p>...Except the function signature for <code>update.InsertDays</code> and <code>update.InsertMinutes</code> both require the specific type, not the generic type, and the channels are set up like that as well. I could potentially change the channels, but I really can't change the insert functions because they do require the correct type as they insert the data into the database and the fields (properties) vary greatly between the two.</p>\n\n<p>I feel like the correct answer to this problem may be something far more sinister, which is why I'm asking you, SO!</p>\n\n<p>I'm sorry for the nondescript title; please feel free to comment if you have better ideas.</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1534816413, "post_id": 51938541, "comment_id": 90830935, "body": "Sounds like you want to do something that is not standard. In that case you should probably create your own Umarshaller.  <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">choly.ca/post/go-json-marshalling</a>  <a href=\"https://medium.com/@nate510/dynamic-json-umarshalling-in-go-88095561d6a0\" rel=\"nofollow noreferrer\">medium.com/@nate510/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5991669, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y5Esvne-EAI/AAAAAAAAAAI/AAAAAAAAAQ0/ZyyU6_M7vz8/photo.jpg?sz=128", "display_name": "Manitica", "link": "https://stackoverflow.com/users/5991669/manitica"}, "edited": false, "score": 0, "creation_date": 1534799837, "post_id": 51938580, "comment_id": 90827325, "body": "This doesn&#39;t answer my question, as I want to use a map, which has many doors."}, {"owner": {"reputation": 89, "user_id": 9016532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beed93ac48cd8f94c28dd3a9630c5454?s=128&d=identicon&r=PG&f=1", "display_name": "Fishdigger", "link": "https://stackoverflow.com/users/9016532/fishdigger"}, "edited": false, "score": 0, "creation_date": 1534799992, "post_id": 51938580, "comment_id": 90827372, "body": "You&#39;ll want to have two structs most likely then. One that represents the return from the server, and one that you want to pass around your program. Have a function that will convert between the two to make it easier."}], "tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 2, "last_activity_date": 1534801879, "last_edit_date": 1534801879, "creation_date": 1534799712, "answer_id": 51938580, "question_id": 51938541, "link": "https://stackoverflow.com/questions/51938541/concatenate-two-values-from-a-json-object-into-a-mapstringbool-in-go/51938580#51938580", "title": "Concatenate two values from a JSON object into a map[string]bool in Go", "body": "<p>your json and your struct are not representing the same object\nyour struct should be as follows:</p>\n\n<pre><code>    type AccessControl struct {\n    SessionID string `json:\"sessionId\"`\n    Door      string `json:\"door\"`\n    Access    bool   `json:\"access\"`\n    }\n</code></pre>\n\n<p>and for the \"full example\" that you asked for:</p>\n\n<pre><code>type ServerAccessControl struct {\n    SessionID string `json:\"sessionId\"`\n    Door      string `json:\"door\"`\n    Access    bool   `json:\"access\"`\n}\n\ntype AccessControl struct {\n    SessionId  string `json:\"sessionId\"`\n    DoorAccess map[string]bool\n}\n\nfunc main() {\n    jsn := `{ \"sessionId\": \"232\", \"door\": \"Main Door\", \"access\": true }`\n    var data ServerAccessControl\n    json.Unmarshal([]byte(jsn), &amp;data)\n    accessControl := ServerAccessControlToAccessControl(&amp;data)\n    fmt.Println(accessControl)\n\n}\n\n//ServerAccessControlToAccessControl convert a access control obj from the server into a map based struct.\nfunc ServerAccessControlToAccessControl(fromServer *ServerAccessControl) AccessControl {\n    var accessControl AccessControl\n    accessControl.SessionId = fromServer.SessionID\n    accessControl.DoorAccess = make(map[string]bool)\n    accessControl.DoorAccess[fromServer.Door] = fromServer.Access\n    return accessControl\n}\n</code></pre>\n\n<p>I created the ServerAccessControl struct which represent the json that you are getting from the server and the Access Control class as you wanted it.</p>\n\n<p>It is important that you will notice that you are not getting a collection from the server, and if you plan to add more doors into your map, you will need to implement the logic your self.</p>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1534816950, "creation_date": 1534816950, "answer_id": 51940627, "question_id": 51938541, "link": "https://stackoverflow.com/questions/51938541/concatenate-two-values-from-a-json-object-into-a-mapstringbool-in-go/51940627#51940627", "title": "Concatenate two values from a JSON object into a map[string]bool in Go", "body": "<p>Sounds like you want to use a custom Unmarshaller. Here's an example. See my comments for articles explaining the process.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nvar data = `{\n    \"sessionId\": \"232\",\n    \"door\": \"Main Door\",\n    \"access\": true\n}`\n\ntype AccessControl struct {\n    SessionId  string `json:\"sessionId\"`\n    DoorAccess map[string]bool\n}\n\nfunc (a *AccessControl) UnmarshalJSON(data []byte) error {\n\n    tmp := struct {\n        SessionID string `json:\"sessionId\"`\n        Door      string `json:\"door\"`\n        Access    bool   `json:\"access\"`\n    }{}\n\n    err := json.Unmarshal(data, &amp;tmp)\n    if err != nil {\n        return err\n    }\n\n    a.SessionId = tmp.SessionID\n    a.DoorAccess = map[string]bool{tmp.Door: tmp.Access}\n    return nil\n}\n\nfunc main() {\n    var ac AccessControl\n    err := json.Unmarshal([]byte(data), &amp;ac)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%+v\\n\", ac)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5991669, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y5Esvne-EAI/AAAAAAAAAAI/AAAAAAAAAQ0/ZyyU6_M7vz8/photo.jpg?sz=128", "display_name": "Manitica", "link": "https://stackoverflow.com/users/5991669/manitica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534849347, "creation_date": 1534799473, "last_edit_date": 1534849347, "question_id": 51938541, "link": "https://stackoverflow.com/questions/51938541/concatenate-two-values-from-a-json-object-into-a-mapstringbool-in-go", "title": "Concatenate two values from a JSON object into a map[string]bool in Go", "body": "<p>I am trying to concatenate two values, door and access, from a JSON object into a map[string]bool, which is declared inside a struct. Right now, I am getting the error:</p>\n\n<blockquote>\n  <p>json: cannot unmarshal string into Go struct field Data.pasted of type\n  map[string]bool</p>\n</blockquote>\n\n<p>The struct is defined as follows:</p>\n\n<pre><code>type AccessControl struct{\n    SessionId string `json:\"sessionId\"`\n    DoorAccess map[string]bool \n} \n</code></pre>\n\n<p>The JSON object I am getting from the server is:</p>\n\n<pre><code>{\n    \"sessionId\": \"232\",\n    \"door\": \"Main Door\",\n    \"access\": true\n}\n</code></pre>\n\n<p>And this is my function:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request){\n    var data AccessControl\n    err := json.NewDecoder(r.Body).Decode(&amp;data)\n}\n</code></pre>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1534866130, "last_edit_date": 1534866130, "creation_date": 1534805098, "answer_id": 51939423, "question_id": 51938303, "link": "https://stackoverflow.com/questions/51938303/clearing-and-rewriting-slice-in-loop/51939423#51939423", "title": "Clearing and rewriting slice in loop", "body": "<p>First, simplify your code,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc populateSlice(offset int) []string {\n    letters := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"OP\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"}\n    lo, hi := offset, offset+10\n    if hi &gt; len(letters) {\n        hi = len(letters)\n    }\n    if lo &lt; 0 || lo &gt;= hi {\n        return nil\n    }\n    return letters[lo:hi:hi]\n}\n\nfunc main() {\n    var bigSlice []string\n    for offset := 0; ; {\n        smallSlice := populateSlice(offset)\n        fmt.Printf(\"smallSlice: %#v\\n\", smallSlice)\n        if len(smallSlice) == 0 {\n            break\n        }\n        bigSlice = append(bigSlice, smallSlice...)\n        offset += len(smallSlice)\n    }\n    bigSlice = bigSlice[:len(bigSlice):len(bigSlice)]\n    fmt.Printf(\"bigSlice: %#v\\n\", bigSlice)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/sRqazV_luol\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sRqazV_luol</a></p>\n\n<p>Output:</p>\n\n<pre><code>smallSlice: []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\"}\nsmallSlice: []string{\"k\", \"l\", \"m\", \"n\", \"OP\", \"q\", \"r\", \"s\", \"t\", \"u\"}\nsmallSlice: []string{\"v\", \"w\", \"x\", \"y\", \"z\"}\nsmallSlice: []string(nil)\nbigSlice: []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"OP\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"}\n</code></pre>\n\n<p>There are no slices to delete. There are no memory leaks. Go has a garbage collector. There is no bad data.</p>\n"}], "owner": {"reputation": 29, "user_id": 9932573, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpEqDZ1RcdE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2gkMZ5CmhZ_vNZXs6Ng1MxylkcfQ/mo/photo.jpg?sz=128", "display_name": "Grehgous", "link": "https://stackoverflow.com/users/9932573/grehgous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1534866130, "creation_date": 1534798192, "last_edit_date": 1534835536, "question_id": 51938303, "link": "https://stackoverflow.com/questions/51938303/clearing-and-rewriting-slice-in-loop", "title": "Clearing and rewriting slice in loop", "body": "<p>I am wondering what the \"most\" correct way is to delete a slice in my use case is. I have a for loop where I can function which returns a slice, then that slice is appended to a bigger slice. Each time the for loop is called the smaller slice should be empty. I can't just overwrite the slice with the values returned because I need to know the length.</p>\n\n<p>I get the expected output, but don't know if I can run into errors with memory leaks or getting bad data.\nIs it best to set the slice as nil, make a new slice, or something else?</p>\n\n<p><a href=\"https://play.golang.org/p/JxMKaFQAPWL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JxMKaFQAPWL</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc populateSlice(offset int) []string {\n    letters := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"OP\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"}\n    toReturn := make([]string, 0)\n\n    if len(letters)-offset &lt;= 0 {\n        toReturn = nil\n    } else if len(letters) &lt; offset+10 {\n        remaining := len(letters) - offset\n        toReturn = letters[offset:remaining+offset]\n    } else {\n        toReturn = letters[offset:10+offset]\n    }\n\n    fmt.Printf(\"toReturn: %#v\\n\", toReturn)\n    return toReturn\n\n}\n\nfunc main() {\n\n    offset := 0\n    bigSlice := make([]string, 0)\n\n    for {\n\n        smallSlice := populateSlice(offset)\n\n        bigSlice = append(bigSlice, smallSlice...)\n\n        if smallSlice == nil || len(smallSlice) &lt; 5 {\n            fmt.Printf(\"break: len(smallSlice): %v\", len(smallSlice))\n            break\n        }\n        offset += len(smallSlice)\n\n        fmt.Printf(\"smallSlice: %#v\\n\", smallSlice)\n        fmt.Printf(\"bigSlice: %#v\\n\\n\", bigSlice)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1534792013, "post_id": 51937039, "comment_id": 90824091, "body": "Use struct tags. They&#39;re covered in the <code>encoding&#47;json</code> documentation, and most posts on SO regarding JSON and Go."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1534818828, "last_edit_date": 1534818828, "creation_date": 1534795457, "answer_id": 51937801, "question_id": 51937039, "link": "https://stackoverflow.com/questions/51937039/decoding-json-object-and-mapping-the-values-to-a-struct-in-go/51937801#51937801", "title": "Decoding JSON object and mapping the values to a struct in Go", "body": "<p>Search for \"tag\" in the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal</code> documentation</a>.</p>\n\n<p>Basically, you can tag struct fields with special annotations that tell the default un/marshaler to use the given name instead of the (case-insensitive) name of the struct field.</p>\n\n<p>For your struct you can likely just do the following, depending on your actual intent:</p>\n\n<pre><code>type JsonData struct {\n  Operation string `json:\"function\"`\n  IsStaff   int    `json:\"is_staff\"`\n}\n\nfunc main() {\n  jsonstr := `{\"function\":\"search\",\"is_staff\":1,\"description\":\"Test\"}`\n\n  var jd JsonData\n  err := json.Unmarshal([]byte(jsonstr), &amp;jd)\n\n  fmt.Printf(\"OK: jd=%#v, err=%v\\n\", jd, err)\n  // OK: jd=main.JsonData{Operation:\"search\", IsStaff:1}, err=&lt;nil&gt;\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5991669, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y5Esvne-EAI/AAAAAAAAAAI/AAAAAAAAAQ0/ZyyU6_M7vz8/photo.jpg?sz=128", "display_name": "Manitica", "link": "https://stackoverflow.com/users/5991669/manitica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1534818828, "creation_date": 1534791928, "question_id": 51937039, "link": "https://stackoverflow.com/questions/51937039/decoding-json-object-and-mapping-the-values-to-a-struct-in-go", "title": "Decoding JSON object and mapping the values to a struct in Go", "body": "<p>I have created a webserver using the library net http. My problem is that I want to create a Struct like below from a JSON object, whose keys names don't match with the struct attributes.</p>\n\n<pre><code>type JsonData struct {\n    Operation     string\n    IsStaff       int\n} \n</code></pre>\n\n<p>The JSON object sent from the server is:</p>\n\n<pre><code>{\n    \"function\": \"search\",\n    \"is_staff\": 1\n    \"description\": \"Test\"\n}\n</code></pre>\n\n<p>Most of the solutions I have found are creating another struct, where the JSON keys and struct attribute names match each other. Is there a way to map the JSON decoded to my JsonData struct? Below it is my current function right now.</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request){\n    switch r.Method {   \n        case http.MethodPost:\n            var data JsonData\n             err := json.NewDecoder(r.Body).Decode(&amp;data)\n     }\n }\n</code></pre>\n"}, {"tags": ["api", "web-services", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534790225, "post_id": 51936651, "comment_id": 90823387, "body": "A pointer will only affect other goroutines if they all have pointers to the same value. Make sure they don&#39;t and it will work fine."}, {"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534790705, "post_id": 51936651, "comment_id": 90823581, "body": "@Adrian: THanks, How can I create dynamic variables in golang? The &amp;output variable that is passed to the function should be created dynamically based on the number of goroutines created using the range parameter."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534790744, "post_id": 51936651, "comment_id": 90823604, "body": "What do you mean by &quot;dynamic variable&quot;?"}, {"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534790910, "post_id": 51936651, "comment_id": 90823678, "body": "ignore it, was lil bit confused initially..thanks"}], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 3, "last_activity_date": 1534790136, "creation_date": 1534790136, "answer_id": 51936687, "question_id": 51936651, "link": "https://stackoverflow.com/questions/51936651/pointers-in-golang-json-unmarshalling/51936687#51936687", "title": "pointers in golang json unmarshalling", "body": "<p>As you can see, <code>json.Unmarshal</code> does not return a value, so if you passed a value instead of a pointer, it would have no way to work properly as it would fill its copy of the interface it takes as parameter.</p>\n\n<p>The way it works is that you pass a pointer to the structure you want to fill, and <code>json.Unmarshal</code> will populate it directly using the pointer.</p>\n\n<p>See <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">the documentation</a> for more details.</p>\n\n<blockquote>\n  <p>Unmarshal parses the JSON-encoded data and stores the result in the <strong>value pointed to by v</strong>. If v is nil or not a pointer, Unmarshal returns an InvalidUnmarshalError.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1548, "user_id": 2841607, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JjWu8.jpg?s=128&g=1", "display_name": "minitauros", "link": "https://stackoverflow.com/users/2841607/minitauros"}, "is_accepted": true, "score": 2, "last_activity_date": 1534790172, "creation_date": 1534790172, "answer_id": 51936697, "question_id": 51936651, "link": "https://stackoverflow.com/questions/51936651/pointers-in-golang-json-unmarshalling/51936697#51936697", "title": "pointers in golang json unmarshalling", "body": "<p>It is because the <code>Unmarshal</code> function takes the <code>output</code> struct and populates it with the data. If you do not pass a pointer, it will take a copy of your struct and fill it, after which you don't have access to it any more. If you pass a pointer, the <code>output</code> struct behind the pointer will be populated and remain available.</p>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 0, "accepted_answer_id": 51936697, "answer_count": 2, "score": 0, "last_activity_date": 1534844671, "creation_date": 1534789978, "last_edit_date": 1534844671, "question_id": 51936651, "link": "https://stackoverflow.com/questions/51936651/pointers-in-golang-json-unmarshalling", "title": "pointers in golang json unmarshalling", "body": "<p>I'm trying to unmarshal a web service response using the below command and it works fine.</p>\n\n<pre><code>bodyBytes, _ := ioutil.ReadAll(response.Body)\nbodyString := string(bodyBytes)\nerr = json.Unmarshal([]byte(bodyString), &amp;output)\nfmt.Println(&amp;output)\n</code></pre>\n\n<p>When I use the pointer variable '&amp;output' it works fine ie; the outputs are displayed properly.</p>\n\n<p>but when I try to use the variable directly without &amp;(ampersand), the outputs do not look good.</p>\n\n<pre><code>bodyBytes, _ := ioutil.ReadAll(response.Body)\nbodyString := string(bodyBytes)\nerr = json.Unmarshal([]byte(bodyString), output)\nfmt.Println(output)\n</code></pre>\n\n<p>What is the difference between these 2 variable - pointer vs normal variable while unmarshalling?</p>\n\n<pre><code>var output core.ApiData\n</code></pre>\n\n<p>The output is a type struct to match the apidata output.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 1, "creation_date": 1534793050, "post_id": 51936410, "comment_id": 90824559, "body": "What platform (Windows, Linux, ...) do you need this to work on? From reading the Go source, the behavior is platform-dependent. You&#39;re probably better off overriding DNS on the OS level, or using a different package like <a href=\"https://godoc.org/github.com\" rel=\"nofollow noreferrer\">github.com/miekg/dns</a>./miekg/dns"}, {"owner": {"reputation": 185, "user_id": 1785435, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95367e30f1e03cf4e740f6be6e40fecd?s=128&d=identicon&r=PG", "display_name": "Matthias R. Wiora", "link": "https://stackoverflow.com/users/1785435/matthias-r-wiora"}, "reply_to_user": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534794633, "post_id": 51936410, "comment_id": 90825290, "body": "actually windows in this case - I will give it a try - thanks!"}, {"owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "edited": false, "score": 0, "creation_date": 1534808498, "post_id": 51936410, "comment_id": 90829529, "body": "probably in the next release (<a href=\"https://go-review.googlesource.com/c/go/+/115855\" rel=\"nofollow noreferrer\">go-review.googlesource.com/c/go/+/115855</a>)"}, {"owner": {"reputation": 185, "user_id": 1785435, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95367e30f1e03cf4e740f6be6e40fecd?s=128&d=identicon&r=PG", "display_name": "Matthias R. Wiora", "link": "https://stackoverflow.com/users/1785435/matthias-r-wiora"}, "edited": false, "score": 0, "creation_date": 1534809181, "post_id": 51936410, "comment_id": 90829670, "body": "thanks man - I actually was successful using the miekg dns variant - does what I need for the moment. For those looking for the correct link <a href=\"https://github.com/miekg/dns\" rel=\"nofollow noreferrer\">github.com/miekg/dns</a> (the one above is broken)"}], "owner": {"reputation": 185, "user_id": 1785435, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95367e30f1e03cf4e740f6be6e40fecd?s=128&d=identicon&r=PG", "display_name": "Matthias R. Wiora", "link": "https://stackoverflow.com/users/1785435/matthias-r-wiora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534835597, "creation_date": 1534788836, "last_edit_date": 1534835597, "question_id": 51936410, "link": "https://stackoverflow.com/questions/51936410/enforce-use-of-resolver-and-disable-fallback", "title": "Enforce use of resolver and disable fallback", "body": "<p>I want to achieve resolving a given domain by the DNS Server I provide.</p>\n\n<p>The code below I've grabbed from <a href=\"https://play.golang.org/p/s2KtkFrQs7R\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s2KtkFrQs7R</a>\nThe result is giving the correct results - but unfortunately even when I'm giving an IP like 123.123.123.123:53 as the resolver IP...</p>\n\n<p>I guess there's a fallback - but I could not find (<a href=\"https://golang.org/pkg/net/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/</a>) the switch to turn it off...</p>\n\n<p>Thanks in advance for any hint...</p>\n\n<p>Matthias</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"time\"\n)\n\nfunc GoogleDNSDialer(ctx context.Context, network, address string) (net.Conn, error) {\n    d := net.Dialer{}\n    return d.DialContext(ctx, \"udp\", \"123.123.123.123:53\")\n}\n\nfunc main() {\n    domain := \"www.google.com\"\n    const timeout = 1000 * time.Millisecond\n    ctx, cancel := context.WithTimeout(context.TODO(), timeout)\n    defer cancel()\n    // var r net.Resolver\n    r := net.Resolver{\n        PreferGo: true,\n        Dial:     GoogleDNSDialer,\n    }\n\n    records, err := r.LookupHost(ctx, domain)\n\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        fmt.Printf(\"Records %v \\n\", records[0])\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "threadpool"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534784596, "post_id": 51935169, "comment_id": 90820950, "body": "You can&#39;t really query the status of a waitgroup, you just wait for the group to be finished. But yes, this is the precise use case for a waitgroup."}, {"owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534786924, "post_id": 51935169, "comment_id": 90821938, "body": "@Adrian Please feel free to write an answer so I can gratify you with virtual points? :) (Just outline how this should be implemented?)"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1534788663, "creation_date": 1534788663, "answer_id": 51936357, "question_id": 51935169, "link": "https://stackoverflow.com/questions/51935169/determining-all-workers-are-done/51936357#51936357", "title": "Determining all workers are done", "body": "<p>Per <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n\n<blockquote>\n  <p>A WaitGroup waits for a collection of goroutines to finish.</p>\n</blockquote>\n\n<p>So, yes, to wait for a collection of goroutines to finish, I would recommend a <code>WaitGroup</code>. As the docs state, you call <code>Add</code> for each worker started, and <code>Done</code> when each worker finishes. Your <code>for len()</code> busy loop would be replaced with:</p>\n\n<pre><code>wg.Wait()\n</code></pre>\n\n<p>As per the documentation.</p>\n"}], "owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 51936357, "answer_count": 1, "score": -1, "last_activity_date": 1534788663, "creation_date": 1534783291, "question_id": 51935169, "link": "https://stackoverflow.com/questions/51935169/determining-all-workers-are-done", "title": "Determining all workers are done", "body": "<p>Following <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">Marcio's thread pool implementation</a> is it possible to determine when all work is done?</p>\n\n<p>Waiting for the JobQueue to empty is trivial:</p>\n\n<pre><code>// Wait for the job queue to clear\nfor len(JobQueue) &gt; 0 {\n    // Just wait\n}\n</code></pre>\n\n<p>However after that there might still be goroutines waiting for workers, or workers have not unfinished all tasks:</p>\n\n<pre><code>func (d *Dispatcher) dispatch() {\n    for {\n        select {\n        case job := &lt;-JobQueue:\n            // a job request has been received\n            go func(job Job) {\n                // try to obtain a worker job channel that is available.\n                // this will block until a worker is idle\n                jobChannel := &lt;-d.WorkerPool\n\n                // dispatch the job to the worker job channel\n                jobChannel &lt;- job\n            }(job)\n        }\n    }\n}\n</code></pre>\n\n<p>What's the best approach to this? Add a WaitGroup to the dispatcher, and a method for querying the status of the WaitGroup? Any pointers towards this would be appreciated.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534783300, "post_id": 51935136, "comment_id": 90820334, "body": "You are having trouble unit testing this specific function or you are having trouble because you want to unit test code that uses this function? Either way seems pretty straight forward"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534783352, "post_id": 51935136, "comment_id": 90820358, "body": "I want to unit-test code that <i>uses</i> this function."}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 1, "creation_date": 1534783574, "post_id": 51935136, "comment_id": 90820463, "body": "This could be done using an interface. Try writing the code you want to test (which depends on <code>Get(AccessCode) *ErrorSt</code>) to depend on an interface type which provides this method. Then in your test code, you can provide a mock/stub implementation."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534783695, "post_id": 51935136, "comment_id": 90820513, "body": "Like I said, if I do that, I&#39;ll break code in a lot of places, outside my job title and control."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534783751, "post_id": 51935136, "comment_id": 90820545, "body": "I&#39;ll have to talk with the boss about this."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1534784064, "post_id": 51935136, "comment_id": 90820695, "body": "And what&#39;s the problem with testing code that uses this function? Its output is predictable."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534784189, "post_id": 51935136, "comment_id": 90820758, "body": "I try to give it specifications on what state it should return and it not only fails those expectations, but assertions that the spy method was even called fails."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534784408, "post_id": 51935136, "comment_id": 90820864, "body": "I don&#39;t see the logic in stubbing this out in the first place."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534784452, "post_id": 51935136, "comment_id": 90820881, "body": "My bad, I&#39;ll add it, right after lunch."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534787550, "post_id": 51935136, "comment_id": 90822203, "body": "I was right: the function is being used in too many places; /* If we refactor it into a method, it would break much of the existing code base */  I had to, since this function was trying to <code>Get</code> from the <code>Errors</code>, write to <code>Errors</code>. ick! (This isn&#39;t unit testing! WTF is this!?)"}], "answers": [{"tags": [], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "is_accepted": false, "score": 0, "last_activity_date": 1534788246, "creation_date": 1534788246, "answer_id": 51936256, "question_id": 51935136, "link": "https://stackoverflow.com/questions/51935136/stubbing-a-function-in-golang/51936256#51936256", "title": "Stubbing a function in Golang", "body": "<p>Learned that spying is only doable on methods implemented from interfaces (I'm so used to Java, where <strong>everything</strong> is method!) I talked to the boss, and he said no to the proposal of refactoring this function, and all the instances in which it's used, to a method.</p>\n\n<p>Failing that, I had to break the core principle of unit-testing and worry about what <code>Get</code> was returning. Luckily, in my case, it was trying to return an <code>ErrorSt</code> from the map <code>Errors</code>. Seeing that, I had to simply do the following: </p>\n\n<pre><code>errors := Errors\nErrors = map[AccessCode]ErrorSt { \n    // anything I expect Get to return \n}\n\ndefer func() { Errors = errors }()\n</code></pre>\n\n<p>and then I was good to go. </p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 731, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534788246, "creation_date": 1534783135, "last_edit_date": 1534786092, "question_id": 51935136, "link": "https://stackoverflow.com/questions/51935136/stubbing-a-function-in-golang", "title": "Stubbing a function in Golang", "body": "<p>There's a function that keeps coming up in the code that I'm responsible for unit-testing (that hasn't even been tested yet), defined as follows: </p>\n\n<pre><code>//Get Retreives an error with the given access code.\nfunc Get(code AccessCode) *ErrorSt {\n    if err, ok := Errors[code]; ok {\n        err.Stack = utilityCore.GetCleanStack(logger.Instance.GetProjectNames())\n        return &amp;err\n    }\n    err := NewError(string(ACPanic), fmt.Sprintf(\"Error '%s' can't be retreived.\", code), ESSystem, SError)\n    return err\n}\n</code></pre>\n\n<p>It is invoked by a couple of the methods that I have tried to test thus far. My instinct is to either stub or <a href=\"https://godoc.org/github.com/nyarly/spies\" rel=\"nofollow noreferrer\">spy on</a> the function, but this fails. </p>\n\n<p>This function is used in many places throughout my employer's APIs, thus I cannot change it (if I do, it will break a lot of things). Is there any way to do true unit testing and test-double it out?</p>\n\n<p>My spy attempt: </p>\n\n<pre><code>type ErrorSpy struct {\n    spies.Spy\n}\n\nfunc (spy *ErrorSpy) Get(code AccessCode) *ErrorSt {\n    res := spy.Called(code)\n\n    return res.Get(0).(*ErrorSt)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1534782182, "post_id": 51934318, "comment_id": 90819770, "body": "Ah, -printfuncs is just what I was looking for. One clarification: what do you mean by &quot;format strings are run-time values&quot;? It seems that they can be analyzed at compile-time like anything else (since the types of the arguments are known)."}, {"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1534783640, "post_id": 51934318, "comment_id": 90820492, "body": "I tried to clarify the part about why this is difficult, does it make sense now?"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1534789700, "post_id": 51934318, "comment_id": 90823149, "body": "Ah okay, you\u2019re saying that the first art of Printf can be a variable whose value isn\u2019t known at compile time. It does seem like in most uses the first arg is a constant string, but I guess Go doesn\u2019t want to disambiguate these cases?"}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": true, "score": 4, "last_activity_date": 1534783522, "last_edit_date": 1534783522, "creation_date": 1534780050, "answer_id": 51934318, "question_id": 51933966, "link": "https://stackoverflow.com/questions/51933966/how-to-check-for-type-errors-in-errors-errorf/51934318#51934318", "title": "How to check for type errors in errors.Errorf()?", "body": "<p>You can tell <code>go vet</code> which functions to check for (compare <a href=\"https://godoc.org/cmd/vet#hdr-Printf_family\" rel=\"nofollow noreferrer\">godoc.org/cmd/vet</a>):</p>\n\n<pre><code>$ cat x.go\npackage main\n\nimport \"github.com/pkg/errors\"\n\nfunc ReturnError(s string, i int) error {\n    // Swap %d and %s, and forget to include the second argument\n    return errors.Errorf(\"invalid arguments %d and %s\", s)\n}\n$ go vet x.go \n$ go vet -printfuncs Errorf x.go \n# command-line-arguments\n./x.go:7: Errorf format %d has arg s of wrong type string\n</code></pre>\n\n<p>It's not straightforward to do this better for a number of reasons:</p>\n\n<ul>\n<li>Format strings are run-time values: You might well call <code>fmt.Sprintf(prefix + \"%s\", ...)</code>. So it is impossible to catch all invalid format strings at compile time.</li>\n<li>Format strings don't have a special type. Hence the compiler can't easily determine that some function (<code>errors.Errorf</code> in this case) expects its arguments to behave like <code>fmt.Printf</code> just by looking at the function definition.</li>\n</ul>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1118, "favorite_count": 1, "accepted_answer_id": 51934318, "answer_count": 1, "score": -1, "last_activity_date": 1534783522, "creation_date": 1534778661, "question_id": 51933966, "link": "https://stackoverflow.com/questions/51933966/how-to-check-for-type-errors-in-errors-errorf", "title": "How to check for type errors in errors.Errorf()?", "body": "<p>Calls to string formatting functions like fmt.Printf seem to be a weak spot for the Go compiler. I end up with lots of bugs (using the wrong formatter after a refactor, forgetting to include all the arguments) that only reveal themselves at runtime. So I end up having to squint hard every time I write one of these.</p>\n\n<p>I did some research today and discovered <code>go tool vet</code>, which appears to work for fmt.Printf, but it doesn't catch mistakes in errors.Errorf (see below).</p>\n\n<pre><code>import \"github.com/pkg/errors\"\n\nfunc ReturnError(s string, i int) error {\n    // Swap %d and %s, and forget to include the second argument\n    return errors.Errorf(\"invalid arguments %d and %s\", s)\n}\n</code></pre>\n\n<p>Is there an analog to <code>go tool vet</code> that can capture string formatting errors in errors.Errorf()? Also, for my own understanding, why is this such a hard problem? It doesn't seem any more difficult for the Go compiler to catch string formatting type errors than any other kind of type errors.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 520, "user_id": 1416534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyC0X.png?s=128&g=1", "display_name": "Murli", "link": "https://stackoverflow.com/users/1416534/murli"}, "edited": false, "score": 0, "creation_date": 1534943654, "post_id": 51934419, "comment_id": 90885525, "body": "Seems like this role needs &quot;go&quot; version to be specified in &quot;go_version_target&quot; variable. It won&#39;t just fetch the latest &quot;go&quot; version."}, {"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "reply_to_user": {"reputation": 520, "user_id": 1416534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyC0X.png?s=128&g=1", "display_name": "Murli", "link": "https://stackoverflow.com/users/1416534/murli"}, "edited": false, "score": 0, "creation_date": 1534975263, "post_id": 51934419, "comment_id": 90901925, "body": "Quoting the package description: &quot;Ansible role that installs Go (<a href=\"http://golang.org/\" rel=\"nofollow noreferrer\">golang.org</a>). The latest stable release that has been compiled for x86 64-bit Linux systems is installed by default, and different platforms and versions are supported by modifying the role variables.&quot; Is that at odds with the source code?"}, {"owner": {"reputation": 520, "user_id": 1416534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyC0X.png?s=128&g=1", "display_name": "Murli", "link": "https://stackoverflow.com/users/1416534/murli"}, "edited": false, "score": 1, "creation_date": 1534986524, "post_id": 51934419, "comment_id": 90904225, "body": "In &quot; ansible-go/defaults/main.yml&quot;, the default version points to &quot;go1.8.1.linux-amd64.tar.gz&quot;. The latest version as of now is go1.10.3.linux-amd64.tar.gz   The default version was updated a year ago. Effectively one needs to manually update what is the latest version in this package also!!!"}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 0, "last_activity_date": 1534780442, "creation_date": 1534780442, "answer_id": 51934419, "question_id": 51933636, "link": "https://stackoverflow.com/questions/51933636/url-for-golang-latest-stable-release/51934419#51934419", "title": "URL for golang latest stable release", "body": "<p>I would suggest to defer to something like <a href=\"https://github.com/jlund/ansible-go\" rel=\"nofollow noreferrer\">jlund/ansible-go</a>, or copy over the parts of that role that you need.</p>\n"}, {"tags": [], "owner": {"reputation": 520, "user_id": 1416534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyC0X.png?s=128&g=1", "display_name": "Murli", "link": "https://stackoverflow.com/users/1416534/murli"}, "is_accepted": true, "score": 1, "last_activity_date": 1534943843, "creation_date": 1534943843, "answer_id": 51967814, "question_id": 51933636, "link": "https://stackoverflow.com/questions/51933636/url-for-golang-latest-stable-release/51967814#51967814", "title": "URL for golang latest stable release", "body": "<p>Google has a Linux installer to install go on linux:\n<a href=\"https://storage.googleapis.com/golang/getgo/installer_linux\" rel=\"nofollow noreferrer\">https://storage.googleapis.com/golang/getgo/installer_linux</a></p>\n\n<p>This fetches the latest version of \"go\" and installs it. Seems like this is the easiest way as of now to install the latest go version on Linux.</p>\n"}, {"comments": [{"owner": {"reputation": 28594, "user_id": 2370483, "user_type": "moderator", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Y0oJ0.jpg?s=128&g=1", "display_name": "Machavity", "link": "https://stackoverflow.com/users/2370483/machavity"}, "edited": false, "score": 0, "creation_date": 1558116437, "post_id": 56177551, "comment_id": 99007837, "body": "I think you&#39;ve misunderstood the question. They don&#39;t want the latest version <i>number</i>, they want the latest version <i>installer</i>"}, {"owner": {"reputation": 176, "user_id": 5322291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xz45S.png?s=128&g=1", "display_name": "fhusson", "link": "https://stackoverflow.com/users/5322291/fhusson"}, "reply_to_user": {"reputation": 28594, "user_id": 2370483, "user_type": "moderator", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Y0oJ0.jpg?s=128&g=1", "display_name": "Machavity", "link": "https://stackoverflow.com/users/2370483/machavity"}, "edited": false, "score": 0, "creation_date": 1558207900, "post_id": 56177551, "comment_id": 99027070, "body": "You are right, just the url <a href=\"https://golang.org/VERSION?m=text\" rel=\"nofollow noreferrer\">https://golang.org/VERSION?m=text</a> is not enough, but it was the missing part from the other answer to make a script, I have updated my answer to be more complete."}], "tags": [], "owner": {"reputation": 176, "user_id": 5322291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xz45S.png?s=128&g=1", "display_name": "fhusson", "link": "https://stackoverflow.com/users/5322291/fhusson"}, "is_accepted": false, "score": 1, "last_activity_date": 1558207623, "last_edit_date": 1558207623, "creation_date": 1558047147, "answer_id": 56177551, "question_id": 51933636, "link": "https://stackoverflow.com/questions/51933636/url-for-golang-latest-stable-release/56177551#56177551", "title": "URL for golang latest stable release", "body": "<p>You can generate the lastest url with :</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>https://dl.google.com/go{{ version }}.{{ os }}-{{ arch }}.tar.gz\n</code></pre>\n\n<p>os: linux, darwin, windows, freebsd\narch : amd64, 386, armv6l, arm64, s390, ppc64le</p>\n\n<p>and for the latest stable version you can fetch the value with curl or something else from the url :</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>https://golang.org/VERSION?m=text\n</code></pre>\n\n<p>Here is an ansible playbook as an example :</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>---\n- hosts: server\n  gather_facts: no\n\n  vars:\n    version : \"latest\"\n    arch: arm64\n    os: linux\n\n    latest_version_url: https://golang.org/VERSION?m=text\n    archive_name: \"{{ filename_prefix }}.{{ os }}-{{ arch }}.tar.gz\"\n    download_url: https://dl.google.com/go/{{ archive_name }}\n    bin_path: /usr/local/go/bin\n\n  tasks:\n    - name: Get filename prefix with latest version\n      set_fact:\n        filename_prefix: \"{{ lookup('url', latest_version_url, split_lines=False) }}\"\n      when: version == \"latest\"\n\n    - name: Get filename prefix with fixed version\n      set_fact:\n        filename_prefix: go{{ version }}\n      when: version != \"latest\"\n\n    - name: Try to get current go version installed\n      command: go version\n      register: result\n      changed_when: false\n\n    - name: Set current_version var to the current\n      set_fact:\n        current_version: \"{{ result.stdout.split(' ')[2] }}\"\n      when: result.failed == false\n\n    - name: Set current_version var to none\n      set_fact:\n        current_version: \"none\"\n      when: result.failed == true\n\n    - debug:\n        var: current_version\n\n    - name: Download and extract the archive {{ archive_name }}\n      become: true\n      unarchive:\n          src: \"{{ download_url }}\"\n          dest: /usr/local\n          remote_src: yes\n      when: current_version != filename_prefix\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 58, "user_id": 7125297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02fa1cd1f87c719e6b3c2a13883fd1b3?s=128&d=identicon&r=PG&f=1", "display_name": "Caster", "link": "https://stackoverflow.com/users/7125297/caster"}, "edited": false, "score": 0, "creation_date": 1606891170, "post_id": 57725365, "comment_id": 115096921, "body": "<code>wget &quot;https:&#47;&#47;dl.google.com&#47;go&#47;$(curl &#39;https:&#47;&#47;golang.org&#47;VERSION?m=text&#39;).linux-amd64.tar.gz&quot;</code> useful"}], "tags": [], "owner": {"reputation": 3554, "user_id": 235362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5887ca943fb6720a6ae30f2d1fb82b55?s=128&d=identicon&r=PG", "display_name": "nad2000", "link": "https://stackoverflow.com/users/235362/nad2000"}, "is_accepted": false, "score": 10, "last_activity_date": 1567162248, "creation_date": 1567162248, "answer_id": 57725365, "question_id": 51933636, "link": "https://stackoverflow.com/questions/51933636/url-for-golang-latest-stable-release/57725365#57725365", "title": "URL for golang latest stable release", "body": "<p>You can download the latest stable GO version in one go :)</p>\n\n<pre><code>wget \"https://dl.google.com/go/$(curl https://golang.org/VERSION?m=text).linux-amd64.tar.gz\"\n</code></pre>\n"}], "owner": {"reputation": 520, "user_id": 1416534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xyC0X.png?s=128&g=1", "display_name": "Murli", "link": "https://stackoverflow.com/users/1416534/murli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1780, "favorite_count": 2, "accepted_answer_id": 51967814, "answer_count": 4, "score": 6, "last_activity_date": 1567162248, "creation_date": 1534777589, "question_id": 51933636, "link": "https://stackoverflow.com/questions/51933636/url-for-golang-latest-stable-release", "title": "URL for golang latest stable release", "body": "<p>Is there is a permanent URL that points to current latest linux binary release of golang?</p>\n\n<p>I am writing an ansible script which should download the latest golang release and install it. In the golang download site \"<a href=\"https://golang.org/dl/\" rel=\"noreferrer\">https://golang.org/dl/</a>\" I could see only release specific download links. </p>\n\n<p>I am wondering if there a link like \"<a href=\"https://dl.google.com/go/latest.linux-amd64.tar.gz\" rel=\"noreferrer\">https://dl.google.com/go/latest.linux-amd64.tar.gz</a>\" available?</p>\n\n<p>If not any suggestion on how to script fetching the latest golang version and install it?</p>\n"}, {"tags": ["rest", "go", "go-chi"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 12, "creation_date": 1534779176, "post_id": 51933367, "comment_id": 90818210, "body": "Just a guess as I am not a <code>chi</code> user, but I assume it doesn&#39;t match against query parameters, so leave it out when registering the handler and use <code>r.URL.Query().Get(&quot;version&quot;)</code> to retrieve the value."}], "answers": [{"tags": [], "owner": {"reputation": 35177, "user_id": 125380, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4c2e7e7267110bb949cbe4aac47190f2?s=128&d=identicon&r=PG", "display_name": "User1", "link": "https://stackoverflow.com/users/125380/user1"}, "is_accepted": false, "score": 9, "last_activity_date": 1581692389, "creation_date": 1581692389, "answer_id": 60228735, "question_id": 51933367, "link": "https://stackoverflow.com/questions/51933367/golang-chi-router-with-query-params-not-working/60228735#60228735", "title": "golang Chi router with query params not working", "body": "<p>As @mkopriva mentioned, simply use <code>r.URL.Query().Get(\"version\")</code> to get the query parameter.</p>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7374, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1581692389, "creation_date": 1534776705, "last_edit_date": 1536588059, "question_id": 51933367, "link": "https://stackoverflow.com/questions/51933367/golang-chi-router-with-query-params-not-working", "title": "golang Chi router with query params not working", "body": "<p>I am working on a restful service in golang using chi. I am trying to create a route as below </p>\n\n<pre><code>r.Mount(\"/api/dest\", router.NewDestRouter(chi.NewRouter(), destSrv).InitRoutes())\n\nfunc (dr *DestRouter) InitRoutes() http.Handler {\n    dr.router.Post(\"/{number}/product?version={v}\", handlers.HandleProduct(dr.dest))\n    return dr.router\n}\n</code></pre>\n\n<p>But I try to hit this endpoint via post man I get a 404 not found</p>\n\n<pre><code>http://localhost:8345/api/dest/1235abc/product?version=1\n</code></pre>\n\n<p>May I know the issue here?</p>\n"}, {"tags": ["c", "go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 5315188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeae8754201cb35c733e2472ac1732c?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaelYu", "link": "https://stackoverflow.com/users/5315188/raphaelyu"}, "edited": false, "score": 0, "creation_date": 1535194162, "post_id": 51997355, "comment_id": 90983118, "body": "I met same problem. I didn&#39;t use stdlib at all. The error is still there. And the preprocess is right. It compare the __BYTE_ORDER to ENDIAN. one variable isn&#39;t possible has 2 different value on same time"}, {"owner": {"reputation": 47, "user_id": 5315188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeae8754201cb35c733e2472ac1732c?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaelYu", "link": "https://stackoverflow.com/users/5315188/raphaelyu"}, "edited": false, "score": 1, "creation_date": 1535380790, "post_id": 51997355, "comment_id": 91034091, "body": "Thank you ,it helps I found I have a endian.h header file in my project that cause this error."}, {"owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "reply_to_user": {"reputation": 47, "user_id": 5315188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeae8754201cb35c733e2472ac1732c?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaelYu", "link": "https://stackoverflow.com/users/5315188/raphaelyu"}, "edited": false, "score": 0, "creation_date": 1535415300, "post_id": 51997355, "comment_id": 91047665, "body": "Glad to hear it @RaphaelYu. Go ahead and accept the answer if it helped :)"}], "tags": [], "owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "is_accepted": false, "score": 1, "last_activity_date": 1535084292, "last_edit_date": 1535084292, "creation_date": 1535083817, "answer_id": 51997355, "question_id": 51932899, "link": "https://stackoverflow.com/questions/51932899/go-build-with-c-library-met-duplicated-members-which-are-in-stdlib-h/51997355#51997355", "title": "go build with c library, met duplicated members which are in stdlib.h", "body": "<p>The problem you're having is probably due to GOLang not parsing the pre-processor commands in the GNU C Library properly (or at all). It could also be due to an issue with your importing <code>endian.h</code>, or requiring some other C/GO/CGO import or define.</p>\n\n<p>Here's an excerpt from <code>waitstatus.h</code> (<a href=\"https://github.com/lattera/glibc/blob/master/bits/waitstatus.h\" rel=\"nofollow noreferrer\">or see the full file on GitHub</a>):</p>\n\n<pre><code># if    __BYTE_ORDER == __LITTLE_ENDIAN \n    unsigned int __w_termsig:7;\n    unsigned int __w_coredump:1;\n    unsigned int __w_retcode:8;\n    unsigned int:16;\n# endif /* Little endian. */ \n# if    __BYTE_ORDER == __BIG_ENDIAN \n    unsigned int:16; \n    unsigned int __w_retcode:8; \n    unsigned int __w_coredump:1; \n    unsigned int __w_termsig:7; \n# endif /* Big endian.  */\n</code></pre>\n\n<p>You'll notice that the same variables are announced twice - one for each Endian. GOLang is erroring because of this. You could resolve this by manually editing the file if you know which endian you're compiling for.</p>\n"}], "owner": {"reputation": 47, "user_id": 5315188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeae8754201cb35c733e2472ac1732c?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaelYu", "link": "https://stackoverflow.com/users/5315188/raphaelyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1565169360, "creation_date": 1534775100, "last_edit_date": 1565169360, "question_id": 51932899, "link": "https://stackoverflow.com/questions/51932899/go-build-with-c-library-met-duplicated-members-which-are-in-stdlib-h", "title": "go build with c library, met duplicated members which are in stdlib.h", "body": "<p>I am doing some protocol stack programming with golang. I put codec thing in C. And build C with a simple CMake configuration as below:</p>\n\n<pre><code>cmake_minimum_required (VERSION 2.8)\n\nproject (Demo1)\n\naux_source_directory(. DIR_SRCS)\n\n\nadd_library(codecLib SHARED ${DIR_SRCS})\n</code></pre>\n\n<p>and Link the shared library with this kind code</p>\n\n<pre><code>//#cgo CFLAGS:-I./codec/\n\n//#cgo LDFLAGS: ./codec/build -lcodecLib\n\n//#include &lt;protocol.h&gt;\n\nimport \"C\"\n\nimport \"fmt\"\n</code></pre>\n\n<p>at last, I met following error while building it with command\n\"CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build\",</p>\n\n<pre><code>In file included from /usr/include/stdlib.h:42:0,\nfrom _cgo_export.c:2:\n/usr/include/x86_64-linux-gnu/bits/waitstatus.h:79:15: error: duplicate member \u2018__w_retcode\u2019\n  unsigned int __w_retcode:8;\n               ^\n/usr/include/x86_64-linux-gnu/bits/waitstatus.h:80:15: error: duplicate member \u2018__w_coredump\u2019\n  unsigned int __w_coredump:1;\n               ^\n/usr/include/x86_64-linux-gnu/bits/waitstatus.h:81:15: error: duplicate member \u2018__w_termsig\u2019\n  unsigned int __w_termsig:7;\n               ^\n/usr/include/x86_64-linux-gnu/bits/waitstatus.h:93:15: error: duplicate member \u2018__w_stopsig\u2019\n  unsigned int __w_stopsig:8; /* Stopping signal.  */\n               ^\n/usr/include/x86_64-linux-gnu/bits/waitstatus.h:94:15: error: duplicate member \u2018__w_stopval\u2019\n  unsigned int __w_stopval:8; /* W_STOPPED if stopped.  */\n</code></pre>\n\n<p>I didn't find the solution yet. I appreciate for the solution.</p>\n"}, {"tags": ["go", "verify", "ecdsa"], "comments": [{"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534786558, "post_id": 51932108, "comment_id": 90821771, "body": "Verification still fails after fixing the space. The code seems fine, have you verified yourself that this is a valid signature using other tools?"}, {"owner": {"reputation": 51, "user_id": 10205981, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5c11\u5e74\u8ffd\u68a6", "link": "https://stackoverflow.com/users/10205981/%e5%b0%91%e5%b9%b4%e8%bf%bd%e6%a2%a6"}, "reply_to_user": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 0, "creation_date": 1534809270, "post_id": 51932108, "comment_id": 90829689, "body": "very thinks your reply.this link is about how i build my signature and how someone say he success verify in other ways. I feel helpless now.             [<a href=\"https://bitcointalk.org/index.php?topic=4879014.msg43992837#msg43992837]\" rel=\"nofollow noreferrer\">bitcointalk.org/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10205981, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5c11\u5e74\u8ffd\u68a6", "link": "https://stackoverflow.com/users/10205981/%e5%b0%91%e5%b9%b4%e8%bf%bd%e6%a2%a6"}, "edited": false, "score": 0, "creation_date": 1535526062, "post_id": 51941176, "comment_id": 91092316, "body": "very thinks!! you are master in bitcoin and go!"}, {"owner": {"reputation": 51, "user_id": 10205981, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5c11\u5e74\u8ffd\u68a6", "link": "https://stackoverflow.com/users/10205981/%e5%b0%91%e5%b9%b4%e8%bf%bd%e6%a2%a6"}, "edited": false, "score": 0, "creation_date": 1535526157, "post_id": 51941176, "comment_id": 91092358, "body": "i have a go code complement it ! now i also have a problem about the op_checksig,can you help me?"}, {"owner": {"reputation": 51, "user_id": 10205981, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5c11\u5e74\u8ffd\u68a6", "link": "https://stackoverflow.com/users/10205981/%e5%b0%91%e5%b9%b4%e8%bf%bd%e6%a2%a6"}, "edited": false, "score": 0, "creation_date": 1535590380, "post_id": 51941176, "comment_id": 91125975, "body": "this is my new question:<a href=\"https://stackoverflow.com/questions/52073613/failing-to-verify-ecdsa-sinature-2\" title=\"failing to verify ecdsa sinature 2\">stackoverflow.com/questions/52073613/&hellip;</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1548691463, "post_id": 51941176, "comment_id": 95622346, "body": "You may find a secp256k1 library suitable for Bitcoin at <a href=\"https://github.com/btcsuite/btcd/btcec\" rel=\"nofollow noreferrer\">github.com/btcsuite/btcd/btcec</a>"}], "tags": [], "owner": {"reputation": 74087, "user_id": 214790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f878c8230342730990acd21f889301d4?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/214790/matt"}, "is_accepted": false, "score": 1, "last_activity_date": 1534953592, "last_edit_date": 1534953592, "creation_date": 1534822167, "answer_id": 51941176, "question_id": 51932108, "link": "https://stackoverflow.com/questions/51932108/failing-to-verify-ecdsa-signature/51941176#51941176", "title": "Failing to verify ECDSA signature", "body": "<p>You are trying to use the wrong curve. P-256, also known as secp256r1, is <em>not</em> the same as the curve used in Bitcoin, which is secp256k1. Your public key doesn\u2019t correspond to a point on P-256 (you can check with <code>curve.IsOnCurve(&amp;x, &amp;y)</code>), but it <em>is</em> a point on secp256k1.</p>\n\n<p>Golang doesn\u2019t include support for the Bitcoin curve, so you will need to find a library that does ECDSA using it.</p>\n\n<p>I can confirm that signature does verify that data for that key if you use the correct curve.</p>\n"}], "owner": {"reputation": 51, "user_id": 10205981, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5c11\u5e74\u8ffd\u68a6", "link": "https://stackoverflow.com/users/10205981/%e5%b0%91%e5%b9%b4%e8%bf%bd%e6%a2%a6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 733, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1548679628, "creation_date": 1534772652, "last_edit_date": 1548679628, "question_id": 51932108, "link": "https://stackoverflow.com/questions/51932108/failing-to-verify-ecdsa-signature", "title": "Failing to verify ECDSA signature", "body": "<p>I have a signature:</p>\n\n<blockquote>\n  <p>3044022014d647cd08f1ea5b31d1e6539b6cbceb9182f6e7b2e29fb969354ef7e3434923022028bb4eda36af410149baa936322e7c0e46cc5540a3aa89c811bc3c360028bfd301</p>\n</blockquote>\n\n<p>a hash</p>\n\n<blockquote>\n  <p>f27c6c3aa42563c958292922be1e53fe107f4db0dfadba11122f0b12bf77f3ab</p>\n</blockquote>\n\n<p>and a pubkey</p>\n\n<blockquote>\n  <p>04b0bd634234abbb1ba1e986e884185c61cf43e001f9137f23c2c409273eb16e6537a576782eba668a7ef8bd3b3cfb1edb7117ab65129b8a2e681f3c1e0908ef7b</p>\n</blockquote>\n\n<p>Below is my Go code to verify the signature but it fails! I have information that the three pieces should validate OK and some other person has verified them in other ways. So I want to kown what mistake in this Go code make me get the false result.</p>\n\n<p>if you want more information\uff0cthis link is about how i build my signature and how someone say he success verify in other ways. I feel helpless now:\n<a href=\"https://bitcointalk.org/index.php?topic=4879014.msg43992837#msg43992837\" rel=\"nofollow noreferrer\">https://bitcointalk.org/index.php?topic=4879014.msg43992837#msg43992837</a></p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/ecdsa\"\n    \"crypto/elliptic\"\n    \"encoding/hex\"\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    pubkey, err := hex.DecodeString(\"b0bd634234abbb1ba1e986e884185c61cf43e001f9137f23c2c409273eb16e6537a576782eba668a7ef8bd3b3cfb1edb7117ab65129b8a2e681f3c1e0908ef7b\")\n    if err != nil {\n        panic(err)\n    }\n    curve := elliptic.P256()\n    // length\n    keyLen := len(pubkey)\n\n    x := big.Int{}\n    y := big.Int{}\n    x.SetBytes(pubkey[:(keyLen / 2)])\n    y.SetBytes(pubkey[(keyLen / 2):])\n\n    rawPubKey := ecdsa.PublicKey{curve, &amp;x, &amp;y}\n\n    // hash\n    hash, err := hex.DecodeString(\"f27c6c3aa42563c958292922be1e53fe107f4db0dfadba11122f0b12bf77f3ab\")\n    if err != nil {\n        panic(err)\n    }\n\n    r := big.Int{}\n    s := big.Int{}\n    rr, err := hex.DecodeString(\"14d647cd08f1ea5b31d1e6539b6cbceb9182f6e7b2e29fb969354ef7e3434923\")\n    if err != nil {\n        panic(err)\n    }\n\n    ss, err := hex.DecodeString(\"28bb4eda36af410149baa936322e7c0e46cc5540a3aa89c811bc3c360028bfd3\")\n    if err != nil {\n        panic(err)\n    }\n\n    r.SetBytes(rr)\n    s.SetBytes(ss)\n\n    fmt.Printf(\"%v\\n\", ecdsa.Verify(&amp;rawPubKey, hash[:], &amp;r, &amp;s))    \n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "go", "garbage-collection", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "is_accepted": true, "score": 4, "last_activity_date": 1534808633, "creation_date": 1534808633, "answer_id": 51939816, "question_id": 51932020, "link": "https://stackoverflow.com/questions/51932020/calling-a-c-function-with-a-double-pointer-output-parameter-using-cgo/51939816#51939816", "title": "Calling a C function with a double pointer output parameter using CGo", "body": "<p>Apparently, the first version is fine. Quoting <a href=\"https://golang.org/cmd/cgo/#hdr-Passing_pointers\" rel=\"nofollow noreferrer\">the docs</a>:</p>\n\n<blockquote>\n  <p>Go code may pass a Go pointer to C provided the Go memory to which it points does not contain any Go pointers.</p>\n</blockquote>\n\n<p>From what I understand, since <code>var bufferContents *C.uchar</code> will be initialised to nil, it does not count as a \"Go pointer\" for the above rule. The following simplified code examples confirm this:</p>\n\n<pre><code>package main\n\n// void F(char **p) {}\nimport \"C\"\n\nfunc main() {\n    var p *C.char = new(C.char)\n    C.F(&amp;p)\n}\n</code></pre>\n\n<p>will trigger \"panic: runtime error: cgo argument has Go pointer to Go pointer\"</p>\n\n<pre><code>package main\n\n// void F(char **p) {}\nimport \"C\"\n\nfunc main() {\n    var p *C.char\n    C.F(&amp;p)\n}\n</code></pre>\n\n<p>works just fine, even when setting <code>GODEBUG=cgocheck=2</code>.</p>\n\n<p>Thanks to the folks on the #cgo channel on the Gophers Slack community for helping me understand this!</p>\n"}], "owner": {"reputation": 7445, "user_id": 1174378, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8e5416e29987d91116420dc387e7153?s=128&d=identicon&r=PG", "display_name": "Mihai Todor", "link": "https://stackoverflow.com/users/1174378/mihai-todor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1303, "favorite_count": 1, "accepted_answer_id": 51939816, "answer_count": 1, "score": 5, "last_activity_date": 1534808633, "creation_date": 1534772368, "last_edit_date": 1534776405, "question_id": 51932020, "link": "https://stackoverflow.com/questions/51932020/calling-a-c-function-with-a-double-pointer-output-parameter-using-cgo", "title": "Calling a C function with a double pointer output parameter using CGo", "body": "<p>I am trying to figure out th right way to call <a href=\"https://github.com/ArtifexSoftware/mupdf/blob/3359bfb0bef6a13b3cfabb11a3de096ab2783e01/source/fitz/buffer.c#L177-L182\" rel=\"noreferrer\">this function</a>:</p>\n\n<pre><code>size_t\nfz_buffer_storage(fz_context *ctx, fz_buffer *buf, unsigned char **datap)\n{\n    if (datap)\n        *datap = (buf ? buf-&gt;data : NULL);\n    return (buf ? buf-&gt;len : 0);\n}\n</code></pre>\n\n<p>using CGo to get the underlying string and its length as a byte array in Go.</p>\n\n<p>Is this the right way to do it?</p>\n\n<pre><code>var bufferContents *C.uchar\nlength := C.fz_buffer_storage(ctx, buf, &amp;bufferContents)\nbytes := C.GoBytes(unsafe.Pointer(bufferContents), C.int(length))\n</code></pre>\n\n<p>Since the C code overwrites <code>*datap</code>, I am not sure if the garbage collector will still do the right thing.</p>\n\n<p>I saw an answer <a href=\"https://stackoverflow.com/a/14834389/1174378\">here</a> suggesting something along the lines of</p>\n\n<pre><code>var tempUcharPtr *C.uchar\nbufferContents := C.malloc(C.size_t(unsafe.Sizeof(tempUcharPtr)))\ndefer C.free(bufferContents)\nlength := C.fz_buffer_storage(ctx, buf, (**C.uchar)(bufferContents))\nbytes := C.GoBytes(unsafe.Pointer(*(**C.uchar)(bufferContents)), C.int(length))\n</code></pre>\n\n<p>which also seems to work, but it's much more convoluted and I'm wondering if it's better / safer than the previous version.</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1534772924, "creation_date": 1534772924, "answer_id": 51932192, "question_id": 51931814, "link": "https://stackoverflow.com/questions/51931814/effectively-remove-invalid-characters-from-json-file/51932192#51932192", "title": "Effectively remove invalid characters from JSON file?", "body": "<p>There are several significant issues with this code causing it to behave not as intended. I've noted these with comments below:</p>\n\n<pre><code>func removeInvalidJSON(file []byte, path string) {\n\n    info, _ := os.Stat(path)\n    mode := info.Mode()\n\n    array := strings.Split(string(file), \"\\n\")\n    fmt.Println(array)\n\n    //If we have the clunky items array which is invalid JSON, remove the first line\n    if strings.Contains(array[0], \"items\") {\n        fmt.Println(\"Removing items\")\n        // If you just want to remove the first item, this should be array = array[1:].\n        // As written, this appends the rest of the array to the first item, i.e. nothing.\n        array = append(array[:1], array[1+1:]...)\n    }\n\n    // Finds the last ~index~ *line* of the array\n    lastIndex := array[len(array)-1]\n\n    // If we have the \"}\" in the last line, remove it as this is invalid JSON\n    if strings.Contains(lastIndex, \"}\") {\n        fmt.Println(\"Removing }\")\n        // Strings are immutable. `strings.Trim` does nothing if you discard the return value\n        strings.Trim(lastIndex, \"}\")\n        // After the trim, if you want this to have any effect, you need to put it back in `array`.\n    }\n\n    // Nothing changed?\n    fmt.Println(array)\n\n    ioutil.WriteFile(path, []byte(strings.Join(array, \"\\n\")), mode)\n}\n</code></pre>\n\n<p>I think what you want is something more like:</p>\n\n<pre><code>func removeInvalidJSON(file []byte, path string) {\n    info, _ := os.Stat(path)\n    mode := info.Mode()\n\n    array := strings.Split(string(file), \"\\n\")\n    fmt.Println(array)\n\n    //If we have the clunky items array which is invalid JSON, remove the first line\n    if strings.Contains(array[0], \"items\") {\n        fmt.Println(\"Removing items\")\n        array = array[1:]\n    }\n\n    // Finds the last line of the array\n    lastLine := array[len(array)-1]\n\n    array[len(array)-1] = strings.Trim(lastLine, \"}\")\n\n    fmt.Println(array)\n\n    ioutil.WriteFile(path, []byte(strings.Join(array, \"\\n\")), mode)\n}\n</code></pre>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1125, "favorite_count": 0, "accepted_answer_id": 51932192, "answer_count": 1, "score": 0, "last_activity_date": 1534772924, "creation_date": 1534771766, "last_edit_date": 1534772320, "question_id": 51931814, "link": "https://stackoverflow.com/questions/51931814/effectively-remove-invalid-characters-from-json-file", "title": "Effectively remove invalid characters from JSON file?", "body": "<p>I am reading in a file via the command line.</p>\n\n<p>As the file is a JSON export from Oracle, it has a certain structure. This default structure is not valid JSON for some reason. Example:</p>\n\n<pre><code>// This isn't valid JSON\n,\"items\":\n[\n{\"id\":123,\"language\":\"ja-JP\",\"location\":\"Osaka\"}\n,{\"id\":33,\"language\":\"ja-JP\",\"location\":\"Tokyo\"}\n,{\"id\":22,\"language\":\"ja-JP\",\"location\":\"Kentok\"}\n]}\n</code></pre>\n\n<p>I wish for it to only be an array of object, thus having the expected output:</p>\n\n<pre><code>// This is valid json\n[\n{\"id\":123,\"language\":\"ja-JP\",\"location\":\"Osaka\"}\n,{\"id\":33,\"language\":\"ja-JP\",\"location\":\"Tokyo\"}\n,{\"id\":22,\"language\":\"ja-JP\",\"location\":\"Kentok\"}\n]\n</code></pre>\n\n<p>Therefore, I need to remove line 1(entirely) as well as the last <code>}</code> from the last line of the file. </p>\n\n<p>The file is being parsed via commandline from the input:</p>\n\n<pre><code>file, err := ioutil.ReadFile(os.Args[1])\n</code></pre>\n\n<p>I am trying to remove the invalid strings/words this way, but it does not reformat anything:</p>\n\n<pre><code>// in func main()\nremoveInvalidJSON(file, os.Args[1])\n\n// later on .. \nfunc removeInvalidJSON(file []byte, path string) {\n\n    info, _ := os.Stat(path)\n    mode := info.Mode()\n\n    array := strings.Split(string(file), \"\\n\")\n    fmt.Println(array)\n\n    //If we have the clunky items array which is invalid JSON, remove the first line\n    if strings.Contains(array[0], \"items\") {\n        fmt.Println(\"Removing items\")\n        array = append(array[:1], array[1+1:]...)\n    }\n\n    // Finds the last index of the array\n    lastIndex := array[len(array)-1]\n\n    // If we have the \"}\" in the last line, remove it as this is invalid JSON\n    if strings.Contains(lastIndex, \"}\") {\n        fmt.Println(\"Removing }\")\n        strings.Trim(lastIndex, \"}\")\n    }\n\n    // Nothing changed?\n    fmt.Println(array)\n\n    ioutil.WriteFile(path, []byte(strings.Join(array, \"\\n\")), mode)\n}\n</code></pre>\n\n<p>The above function does write to the file I can see - but it does not alter the array as far as I can tell, and does not write it into the file.</p>\n\n<p>How do I effectively remote the first line of the file, as well as the last false curly brace <code>}</code> from the file?</p>\n\n<p>I unmarshall the JSON in another function: Is there a method of doing it more \"cleanly\" using the <code>\"encoding/json\"</code> library? </p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 0, "creation_date": 1534771389, "post_id": 51931673, "comment_id": 90813303, "body": "I&#39;m not familiar with go. Which part here is the struct tag and what does it do?"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1534771464, "post_id": 51931673, "comment_id": 90813355, "body": "Not exactly like that, but you can take a look at how that&#39;s done e.g. in <a href=\"https://marshmallow.readthedocs.io/en/3.0/\" rel=\"nofollow noreferrer\">Marshmallow</a>."}, {"owner": {"reputation": 5835, "user_id": 1446154, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e203591509f88fc8c8aeadc01dc1a5d1?s=128&d=identicon&r=PG&f=1", "display_name": "Laser", "link": "https://stackoverflow.com/users/1446154/laser"}, "reply_to_user": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 0, "creation_date": 1534771686, "post_id": 51931673, "comment_id": 90813484, "body": "@MadPhysicist <a href=\"https://medium.com/golangspec/tags-in-golang-3e5db0b8ef3e\" rel=\"nofollow noreferrer\">medium.com/golangspec/tags-in-golang-3e5db0b8ef3e</a>"}, {"owner": {"reputation": 5835, "user_id": 1446154, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e203591509f88fc8c8aeadc01dc1a5d1?s=128&d=identicon&r=PG&f=1", "display_name": "Laser", "link": "https://stackoverflow.com/users/1446154/laser"}, "reply_to_user": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 0, "creation_date": 1534772112, "post_id": 51931673, "comment_id": 90813787, "body": "@MadPhysicist <code>json:&quot;test_int&quot; db:&quot;TestInt&quot;</code>  - struct tag. It describes which data (name of the fields) will be parsed and saved into <code>TestFiled</code> in case of json unmarshall or read from database."}], "owner": {"reputation": 5835, "user_id": 1446154, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e203591509f88fc8c8aeadc01dc1a5d1?s=128&d=identicon&r=PG&f=1", "display_name": "Laser", "link": "https://stackoverflow.com/users/1446154/laser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534774522, "creation_date": 1534771253, "last_edit_date": 1534774522, "question_id": 51931673, "link": "https://stackoverflow.com/questions/51931673/go-struct-tags-in-python", "title": "Go struct tags in Python", "body": "<p>Go lang has a feature, that has a name \"struct tags\".<br>\n<a href=\"https://github.com/golang/go/wiki/Well-known-struct-tags\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Well-known-struct-tags</a></p>\n\n<p>Does python have something similar to it?<br>\nI mean that I want to say python somehow that if I'm using my class in json unmarshalling that it should be filled using one names, and if it's data from db reading that names could be a little bit different.</p>\n\n<p>Go example:</p>\n\n<pre><code>struct test {\n      TestField   int64  `json:\"test_int\" db:\"TestInt\"`  \n}\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 1, "creation_date": 1534772620, "post_id": 51930928, "comment_id": 90814124, "body": "Down-voted for not knowing go. Nice :-D"}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1534770128, "post_id": 51930992, "comment_id": 90812496, "body": "@leafbebop Unexported does not mean you cannot have an instance of such a type. If some function F in package a gives you a a.unexported with method M and thne you can do u := a.F(); u.M()."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1534770312, "post_id": 51930992, "comment_id": 90812613, "body": "I thought you were referring to an unexported field as OP specified. Nevermind."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 3, "last_activity_date": 1534768884, "creation_date": 1534768884, "answer_id": 51930992, "question_id": 51930928, "link": "https://stackoverflow.com/questions/51930928/how-to-test-unexported-struct-field-in-a-different-package-in-go/51930992#51930992", "title": "How to test unexported struct field in a different package in go?", "body": "<blockquote>\n  <p>How to test unexported [...] a different package in go?</p>\n</blockquote>\n\n<p>Not at all. Undoable, do not try.</p>\n\n<p>(If the unexported thing has an exported method, then you can call this method.)</p>\n"}, {"tags": [], "owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "is_accepted": false, "score": 1, "last_activity_date": 1534769688, "creation_date": 1534769688, "answer_id": 51931237, "question_id": 51930928, "link": "https://stackoverflow.com/questions/51930928/how-to-test-unexported-struct-field-in-a-different-package-in-go/51931237#51931237", "title": "How to test unexported struct field in a different package in go?", "body": "<p>There is no direct way to achieve this. You have multiple options to achieve something similar, all with their own tradeoffs. It's up to you to decide which tradeoff is most acceptable in your case.</p>\n\n<p>In general, I would try them in this order:</p>\n\n<ol>\n<li>Make package <code>config</code> depend on an interface instead of on the <code>GitFetcher</code> struct. That way you can mock <code>GitFetcher</code> in your tests.</li>\n<li>Add an additional factory method specifically for tests that can construct <code>GitFetcher</code> more easily.</li>\n<li>Make the unexported field exported.</li>\n<li>Simply combine the packages. That way you can access the unexported fields of both objects in your tests.</li>\n</ol>\n"}], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1228, "favorite_count": 0, "accepted_answer_id": 51930992, "answer_count": 2, "score": 0, "last_activity_date": 1534769688, "creation_date": 1534768642, "question_id": 51930928, "link": "https://stackoverflow.com/questions/51930928/how-to-test-unexported-struct-field-in-a-different-package-in-go", "title": "How to test unexported struct field in a different package in go?", "body": "<p>I have a package that creates objects with a factory. The structs have unexported fields, e.g.:</p>\n\n<pre><code>package fetcher\ntype GitFetcher struct {\n    uri    string\n}\n</code></pre>\n\n<p>I have another package that parses some config files and then builds another object which uses the above objects:</p>\n\n<pre><code>package config\ntype Source struct {\n    fetcher    GitFetcher\n}\n</code></pre>\n\n<p>I'm trying to test my <code>config</code> package. I want to build some expected objects, but since my tests are in <code>config</code> and my <code>GitFetcher</code> is in <code>fetcher</code> I can't just create the objects I want, e.g.:</p>\n\n<pre><code>package config\nexpected := GitFetcher{\n    uri: \"example.com/repo.git\"      // doesn't work. Field isn't exported.\n}\n</code></pre>\n\n<p>How can I build objects across packages for testing like this? I don't want to use the <code>fetcher</code> factory method since the parameters it takes aren't straightforward.</p>\n"}, {"tags": ["go", "dependency-management", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 863, "user_id": 6662539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8a765be3a3288f4841501828d0f6b37?s=128&d=identicon&r=PG&f=1", "display_name": "yuxiaoyu", "link": "https://stackoverflow.com/users/6662539/yuxiaoyu"}, "edited": false, "score": 1, "creation_date": 1542953021, "post_id": 51929022, "comment_id": 93755637, "body": "it works for me, just need to change <code>go add </code> to <code>govendor add</code> in the last cmd line"}], "tags": [], "owner": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "is_accepted": true, "score": 2, "last_activity_date": 1548672124, "last_edit_date": 1548672124, "creation_date": 1534761782, "answer_id": 51929022, "question_id": 51929021, "link": "https://stackoverflow.com/questions/51929021/header-file-not-found-when-running-go-vet-with-dep/51929022#51929022", "title": "Header file not found when running go vet with dep", "body": "<p>Some dependency management tools for go do not vendor all code that is referenced by the project. This means that in some circumstances C code, that can be used in go files with cgo, are not included in the vendor directory.</p>\n\n<p>I have encountered this issue twice with two separate vendoring tools, but there is work to support these <a href=\"https://github.com/golang/dep/issues/1306\" rel=\"nofollow noreferrer\">use cases</a>.</p>\n\n<p>The simplest method I have found so far is to use <a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\">govendor</a> and then import the complete directory to ensure that all the required files are there. This is a very simple solution that ignores a lot of the complexity around including c dependencies in go projects, but fixes the issue whilst there is no permanent fix for the issue.</p>\n\n<pre><code>go get github.com/kardianos/govendor\ngovendor init\ngovendor add +e\n# Remove the directory that is missing the c dependencies\nrm -rf ./vendor/github.com/ethereum/go-ethereum/crypto/secp256k1/\n# Add the file and include all files\n# https://github.com/kardianos/govendor/issues/247\ngovendor add github.com/ethereum/go-ethereum/crypto/secp256k1/^\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1928, "user_id": 3280050, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0f86ec29ab3a8f7f841f471d582a933?s=128&d=identicon&r=PG", "display_name": "truongnm", "link": "https://stackoverflow.com/users/3280050/truongnm"}, "is_accepted": false, "score": 1, "last_activity_date": 1551934242, "creation_date": 1551934242, "answer_id": 55036312, "question_id": 51929021, "link": "https://stackoverflow.com/questions/51929021/header-file-not-found-when-running-go-vet-with-dep/55036312#55036312", "title": "Header file not found when running go vet with dep", "body": "<p>In <code>Gopkg.toml</code> you can add</p>\n\n<pre><code>[prune]\n  go-tests = true\n  unused-packages = true\n  non-go = true\n\n  [[prune.project]]\n    name = \"github.com/ethereum/go-ethereum\"\n    non-go = false\n    unused-packages = false\n</code></pre>\n"}], "owner": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 1, "accepted_answer_id": 51929022, "answer_count": 2, "score": 2, "last_activity_date": 1551934242, "creation_date": 1534761782, "last_edit_date": 1534767165, "question_id": 51929021, "link": "https://stackoverflow.com/questions/51929021/header-file-not-found-when-running-go-vet-with-dep", "title": "Header file not found when running go vet with dep", "body": "<p>I get this error when running go vet in my project, with vendored dependencies.</p>\n\n<pre><code>$ go vet ./...\n# &lt;project path...&gt;/vendor/github.com/ethereum/go-ethereum/crypto/secp256k1\nvendor/github.com/ethereum/go-ethereum/crypto/secp256k1/curve.go:42:10: fatal error: libsecp256k1/include/secp256k1.h: No such file or directory\n #include \"libsecp256k1/include/secp256k1.h\"\n</code></pre>\n\n<p>I thought that this was a dependency missing in the development environment, but when looking at the original project source, the include path is relative to the source file.</p>\n\n<p>Why can the file not be found?</p>\n"}, {"tags": ["bash", "git", "go", "sh", "developer-tools"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1534761596, "post_id": 51928952, "comment_id": 90807445, "body": "What do you mean by &quot;badly formed Go packages&quot;? Your answer mentions github, but all github repos are automatically &quot;valid Go packages&quot; (assuming they contain Go code)."}, {"owner": {"reputation": 10360, "user_id": 587021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/390ae6c8c1e917c0ac3a562680fed3b7?s=128&d=identicon&r=PG", "display_name": "A T", "link": "https://stackoverflow.com/users/587021/a-t"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534762430, "post_id": 51928952, "comment_id": 90807893, "body": "Sometimes the Go code isn&#39;t in the root, so you have to specify the subdir (e.g.: <code>&lt;project_name&gt;&#47;&lt;project_name&gt;&#47;cmd</code>). Which if you haven&#39;t looked thoroughly through the code, you don&#39;t know where it is. So a <code>git clone</code> would be needed, or you can use my answer instead."}], "answers": [{"tags": [], "owner": {"reputation": 10360, "user_id": 587021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/390ae6c8c1e917c0ac3a562680fed3b7?s=128&d=identicon&r=PG", "display_name": "A T", "link": "https://stackoverflow.com/users/587021/a-t"}, "is_accepted": false, "score": -1, "last_activity_date": 1534762580, "last_edit_date": 1534762580, "creation_date": 1534761519, "answer_id": 51928953, "question_id": 51928952, "link": "https://stackoverflow.com/questions/51928952/git-clone-to-gopath-without-go-get/51928953#51928953", "title": "`git clone` to $GOPATH without `go get`?", "body": "<p>Wrote this little shell function for my purposes, might prove useful to you too:\n</p>\n\n<pre><code>function glone()\n{\n  IFS='/' read -r _ _ host team repo &lt;&lt;&lt; \"$1\";\n  to_dir=\"${GOPATH:-$HOME/go}/src/$host/$team/$repo\";\n  if ! [ -d \"$to_dir\" ]; then\n    mkdir -p \"$to_dir\";\n    git clone \"$1\" \"$to_dir\";\n  fi\n  cd \"$to_dir\";\n}\n</code></pre>\n\n<p>Usage:\n</p>\n\n<pre><code>$ glone https://github.com/bradleyfalzon/gopherci\n</code></pre>\n"}], "owner": {"reputation": 10360, "user_id": 587021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/390ae6c8c1e917c0ac3a562680fed3b7?s=128&d=identicon&r=PG", "display_name": "A T", "link": "https://stackoverflow.com/users/587021/a-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1534762580, "creation_date": 1534761519, "question_id": 51928952, "link": "https://stackoverflow.com/questions/51928952/git-clone-to-gopath-without-go-get", "title": "`git clone` to $GOPATH without `go get`?", "body": "<p>With badly formed Go packages, this doesn't work:</p>\n\n<pre><code>go get -u\n</code></pre>\n\n<p>How do I <code>clone</code> without <code>go get</code>, and without manually parsing out the path?</p>\n"}, {"tags": ["session", "authentication", "go", "encryption", "cookies"], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1534761219, "last_edit_date": 1534761219, "creation_date": 1534760878, "answer_id": 51928785, "question_id": 51927278, "link": "https://stackoverflow.com/questions/51927278/authentication-and-encryption-keys-in-cookie-based-session-management/51928785#51928785", "title": "Authentication and encryption keys in cookie based session management", "body": "<p>From the docs:</p>\n\n<blockquote>\n  <p>Keys are defined in pairs to allow key rotation, but the common case is to set a single authentication key and optionally an encryption key.</p>\n</blockquote>\n\n<p>The first pair is used for authentication, encryption and decryption, all other pairs are only used for authentication and decryption (but not encryption).</p>\n\n<p>This is a very common strategy for key rotation. A new key pair is generated regularly and becomes the new key for encryption. Some or all other keys are kept around so that existing data can still be decrypted for some time. The oldest key can be discarded eventually. This limits the impact of a disclosed key because it becomes useless after some time.</p>\n\n<p>Other software that uses this method:</p>\n\n<ul>\n<li>Google's KMS: <a href=\"https://cloud.google.com/kms/docs/key-rotation\" rel=\"nofollow noreferrer\">https://cloud.google.com/kms/docs/key-rotation</a></li>\n<li>Amazon's KMS: <a href=\"https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html</a></li>\n<li>HashiCorp's Vault: <a href=\"https://www.vaultproject.io/api/secret/transit/index.html#rotate-key\" rel=\"nofollow noreferrer\">https://www.vaultproject.io/api/secret/transit/index.html#rotate-key</a></li>\n</ul>\n"}], "owner": {"reputation": 158, "user_id": 3584906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f47b52341fabcfee97c2c3dbca41338?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/3584906/mahesh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 51928785, "answer_count": 1, "score": 0, "last_activity_date": 1534761219, "creation_date": 1534755429, "question_id": 51927278, "link": "https://stackoverflow.com/questions/51927278/authentication-and-encryption-keys-in-cookie-based-session-management", "title": "Authentication and encryption keys in cookie based session management", "body": "<p>My query comes from trying to use session store for eg. <a href=\"https://godoc.org/github.com/gin-contrib/sessions/redis#NewStore\" rel=\"nofollow noreferrer\">RedisStore</a> in Golang where the store takes a vararg as last argument which as per document are pairs of authentication and encryption keys.</p>\n\n<p>Most of the examples I see just use a single argument here (for eg. \"secret\", \"mysecret\" etc.) and I couldn't get any information about what is achieved by sending multiple pairs of authentication and encryption keys.</p>\n\n<p>Could someone please explain more or direct me to some information about the purpose of the authentication and encryption keys in session management using cookies.</p>\n"}, {"tags": ["go", "dll"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 8, "last_activity_date": 1534755836, "last_edit_date": 1592644375, "creation_date": 1534748670, "answer_id": 51925586, "question_id": 51925111, "link": "https://stackoverflow.com/questions/51925111/passing-string-to-syscalluintptr/51925586#51925586", "title": "Passing string to Syscall(uintptr)", "body": "<p>To pass a string to syscall you need to pass a pointer to the first character of the string. The first question is what string encoding your DLL function expects. Go strings are encoded as UTF-8 unicode so if your C function expects something else you have to convert them first. Here are some common cases:</p>\n<h1>1) ASCII string</h1>\n<p>Say your C function expects a zero-terminated ASCII string, then you can do the following:</p>\n<pre><code>s := &quot;some string&quot;\nb := append([]byte(s), 0)\nsyscall.Syscall(uintptr(proc), 1, uintptr(unsafe.Pointer(&amp;b[0])), 0, 0)\n</code></pre>\n<p>First convert your string to a byte array and add the zero that C expects at the end. Then pass the pointer to the first byte character.</p>\n<p>To be safe you  should also make sure that you actually pass in only valid ASCII strings and no invalid characters. Usually only characters in the range [0..127] are valid for general ASCII. The rest depends on the current codepage.</p>\n<h1>2) UTF-16 on Windows</h1>\n<p>If you call into a Windows DLL you want to usually use their UTF-16 version of that function, e.g. <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms644950(v=vs.85).aspx\" rel=\"nofollow noreferrer\">SendMessageW</a>, and thus need to convert your string to UTF-16. Luckily there is a wrapper function for that under Windows, so you can just do the following:</p>\n<pre><code>s := &quot;some string&quot;\ns16, err := syscall.UTF16PtrFromString(s)\nif err == nil {\n    syscall.Syscall(uintptr(proc), 1, uintptr(unsafe.Pointer(s16)), 0, 0)\n}\n</code></pre>\n<p>This will convert to UTF-16 and append the expected zero at the end for you.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 1, "last_activity_date": 1610320078, "last_edit_date": 1610320078, "creation_date": 1606257008, "answer_id": 64995792, "question_id": 51925111, "link": "https://stackoverflow.com/questions/51925111/passing-string-to-syscalluintptr/64995792#64995792", "title": "Passing string to Syscall(uintptr)", "body": "<p>A good way to handle this, is to use the <a href=\"//github.com/golang/sys/tree/master/windows/mkwinsyscall\" rel=\"nofollow noreferrer\">mkwinsyscall</a> tool. You can create\na Go file like this:</p>\n<pre><code>package main\n//go:generate mkwinsyscall -output zmsi.go msi.go\n//sys MsiInstallProduct(path string, command string) (e error) = msi.MsiInstallProductW\n</code></pre>\n<p>Then run <code>go generate</code>, and you get a result file like this (some parts removed\nfor brevity):</p>\n<pre><code>func MsiInstallProduct(path string, command string) (e error) {\n    var _p0 *uint16\n    _p0, e = syscall.UTF16PtrFromString(path)\n    if e != nil {\n        return\n    }\n    var _p1 *uint16\n    _p1, e = syscall.UTF16PtrFromString(command)\n    if e != nil {\n        return\n    }\n    return _MsiInstallProduct(_p0, _p1)\n}\n\nfunc _MsiInstallProduct(path *uint16, command *uint16) (e error) {\n    r0, _, _ := syscall.Syscall(procMsiInstallProductW.Addr(), 2, uintptr(unsafe.Pointer(path)), uintptr(unsafe.Pointer(command)), 0)\n    if r0 != 0 {\n        e = syscall.Errno(r0)\n    }\n    return\n}\n</code></pre>\n<p>As you can see, it automatically takes care of the string conversion, as well\nas the Syscall code, and even the error handling.</p>\n"}], "owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1848, "favorite_count": 2, "accepted_answer_id": 51925586, "answer_count": 2, "score": 3, "last_activity_date": 1610320078, "creation_date": 1534746370, "last_edit_date": 1534774150, "question_id": 51925111, "link": "https://stackoverflow.com/questions/51925111/passing-string-to-syscalluintptr", "title": "Passing string to Syscall(uintptr)", "body": "<p>I need to pass string as param to C DLL in golang, i want to get something like this:</p>\n\n<pre><code>  proc, e = syscall.GetProcAddress(h, \"JLINKARM_ExecCommand\") //One of the functions\n\n    vals := []string{\"device = STM32F429ZI\"}\n    start := uintptr(unsafe.Pointer(&amp;vals[0]))\n\n    asd, _, _ = syscall.Syscall6(uintptr(proc), 3, start, 0, 0, 0, 0, 0) \n</code></pre>\n\n<p>but it doesn't work. Syscall take as param uintptr.\nI can't use C package because it won't build on windows.</p>\n\n<p>In C it works like:</p>\n\n<pre><code>strcpy(acIn, \"device = STM32F407IE\");\n\nJLINKARM_ExecCommand(acIn, &amp;acOut[0], sizeof(acOut));\n</code></pre>\n\n<p>So it is any chance that C  DLL can get string param and use it properly?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 74, "user_id": 5203991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BkGjI.jpg?s=128&g=1", "display_name": "Vincent", "link": "https://stackoverflow.com/users/5203991/vincent"}, "edited": false, "score": 0, "creation_date": 1534738367, "post_id": 51923863, "comment_id": 90797566, "body": "Tag field as  <code>float64</code>,  then convert what you want?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1534742065, "post_id": 51923863, "comment_id": 90798364, "body": "<a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Number</a>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534743350, "post_id": 51923863, "comment_id": 90798664, "body": "You should give some more information about the api. Why do you have to deal with different types of x and y? How big is the JSON you will get?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534743943, "post_id": 51923863, "comment_id": 90798845, "body": "If your json is small and the marshaling can be a little bit slower you could parse the input and replace <code>&quot;y&quot;: 1.23</code> with <code>&quot;y&quot;: &quot;1.23&quot;</code> then you would always handle a string internal, but your api can handle both."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534744214, "post_id": 51923863, "comment_id": 90798913, "body": "As @apxp if yor api is small change the type to string and then convert afterwards if required. But if the data is big or is not in your hand to change use <code>interface{}</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534749129, "post_id": 51923863, "comment_id": 90800689, "body": "What error do you receive?"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1534781042, "creation_date": 1534781042, "answer_id": 51934566, "question_id": 51923863, "link": "https://stackoverflow.com/questions/51923863/how-to-construct-json-so-i-can-receive-int64-and-string-using-golang/51934566#51934566", "title": "How to construct JSON so I can receive int64 and string using golang?", "body": "<p>You will need to define a custom type that implements the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code> interface</a> in such a way that the value can be either a string or a plain number.</p>\n\n<p>The example below shows how to do it for a single type (<code>uint64</code>); you will need to repeat the pattern for any other numerical types (<a href=\"https://play.golang.com/p/rAGkZuV4S8T\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type Uint64 uint64\n\ntype Num struct {\n  X Uint64 `json:\"x\"`\n}\n\nfunc (u *Uint64) UnmarshalJSON(bs []byte) error {\n  str := string(bs) // Parse plain numbers directly.\n  if bs[0] == '\"' &amp;&amp; bs[len(bs)-1] == '\"' {\n    // Unwrap the quotes from string numbers.\n    str = string(bs[1 : len(bs)-1])\n  }\n  x, err := strconv.ParseUint(str, 10, 64)\n  if err != nil {\n    return err\n  }\n  *u = Uint64(x)\n  return nil\n}\n\nfunc main() {\n  ss := []string{`{\"x\":\"123\"}`, `{\"x\":123}`}\n  var n Num\n\n  for _, s := range ss {\n    err := json.Unmarshal([]byte(s), &amp;n)\n    fmt.Printf(\"OK: s=%-11s  n=%#v  err=%v\\n\", s, n, err)\n  }\n  // OK: s={\"x\":\"123\"}  n=main.Num{X:0x7b}  err=&lt;nil&gt;\n  // OK: s={\"x\":123}    n=main.Num{X:0x7b}  err=&lt;nil&gt;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 1, "last_activity_date": 1534782489, "creation_date": 1534782489, "answer_id": 51934973, "question_id": 51923863, "link": "https://stackoverflow.com/questions/51923863/how-to-construct-json-so-i-can-receive-int64-and-string-using-golang/51934973#51934973", "title": "How to construct JSON so I can receive int64 and string using golang?", "body": "<p>Building on @maerics answer, you can defer both cases to the usual json unmarshaler, which feels a bit more robust:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n)\n\ntype Uint64 uint64\n\ntype Num struct {\n    X Uint64 `json:\"x\"`\n}\n\nfunc (u *Uint64) UnmarshalJSON(bs []byte) error {\n    var i uint64\n    if err := json.Unmarshal(bs, &amp;i); err == nil {\n        *u = Uint64(i)\n        return nil\n    }\n    var s string\n    if err := json.Unmarshal(bs, &amp;s); err != nil {\n        return errors.New(\"expected a string or an integer\")\n    }\n    if err := json.Unmarshal([]byte(s), &amp;i); err != nil {\n        return err\n    }\n    *u = Uint64(i)\n    return nil\n}\n\nfunc main() {\n    ss := []string{`{\"x\":\"123\"}`, `{\"x\":123}`, `{\"x\":0.12}`}\n    var n Num\n\n    for _, s := range ss {\n        err := json.Unmarshal([]byte(s), &amp;n)\n        fmt.Printf(\"OK: s=%-11s  n=%#v  err=%v\\n\", s, n, err)\n    }\n}\n</code></pre>\n\n<p>which gives</p>\n\n<pre><code>OK: s={\"x\":\"123\"}  n=main.Num{X:0x7b}  err=&lt;nil&gt;\nOK: s={\"x\":123}    n=main.Num{X:0x7b}  err=&lt;nil&gt;\nOK: s={\"x\":0.12}   n=main.Num{X:0x7b}  err=expected a string or an integer\n</code></pre>\n"}], "owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1024, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534813961, "creation_date": 1534736267, "last_edit_date": 1534813961, "question_id": 51923863, "link": "https://stackoverflow.com/questions/51923863/how-to-construct-json-so-i-can-receive-int64-and-string-using-golang", "title": "How to construct JSON so I can receive int64 and string using golang?", "body": "<p>I have the follow example code:</p>\n\n<pre><code>type Num struct {\n    X uint64 `json:\"x,string\"`\n    Y float64 `json:\"y,string\"`\n}\n</code></pre>\n\n<p>Now, if I run the code</p>\n\n<pre><code>js := []byte(`{\"x\": \"123\", \"y\": \"1.23\"}`)\nvar n Num\nerr := json.Unmarshal(js, &amp;n)\n</code></pre>\n\n<p>it will parse ok.</p>\n\n<p>But if I change the JSON to</p>\n\n<pre><code>js := []byte(`{\"x\": 123, \"y\": 1.23}`)\n</code></pre>\n\n<p>it returns an error.</p>\n\n<p>The result I can understand.</p>\n\n<p>Now, my problem is how can I make it accept both string and uint64/float64?</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9396962, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jilpansi", "link": "https://stackoverflow.com/users/9396962/jilpansi"}, "edited": false, "score": 0, "creation_date": 1534794631, "post_id": 51925776, "comment_id": 90825289, "body": "I agree. This seems more like a prometheus integration. My initial goal was to capture the hit count, last access time, and other metadata, and have the UpdateFunc (for the informer) method kick in, after a resync period. Based on the data gathered, the controller would automate other things. But looks like this just not possible with the core API."}], "tags": [], "owner": {"reputation": 15982, "user_id": 3871750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ac2c6d71d9abbc8924947b8da73460?s=128&d=identicon&r=PG", "display_name": "Radek &#39;Goblin&#39; Pieczonka", "link": "https://stackoverflow.com/users/3871750/radek-goblin-pieczonka"}, "is_accepted": false, "score": 1, "last_activity_date": 1534749563, "creation_date": 1534749563, "answer_id": 51925776, "question_id": 51923494, "link": "https://stackoverflow.com/questions/51923494/hit-count-for-kubernetes-services-object/51925776#51925776", "title": "Hit count for kubernetes services object", "body": "<p>it sounds like you're in fact trying to implement a metric inside kubernetes api. It's hardly a controller though. In a nutshell, controller is piece of software that continuously realizes an intent stated in kubernetes API in a real world. </p>\n\n<p>Semantics aside, status object in kubernetes API is defined in it's type. For Pod, at the moment of writing of this answer it's <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/api/core/v1/types.go#L2978\" rel=\"nofollow noreferrer\">here</a> and it's not an extensible one. So you can't really put your metric into the Pod object.</p>\n\n<p>The question that this naturally poses is why not use something that is expected for metrics collection and visualization like prometheus/grafana ?</p>\n\n<p>All of that aside, you also have an issue of how will you expose/collect that metric. Istio could help here, or the software in pod it self could expose it's metrics (which, if possible, is the best route to take imo)</p>\n"}], "owner": {"reputation": 21, "user_id": 9396962, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jilpansi", "link": "https://stackoverflow.com/users/9396962/jilpansi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1534749563, "creation_date": 1534732388, "last_edit_date": 1534748165, "question_id": 51923494, "link": "https://stackoverflow.com/questions/51923494/hit-count-for-kubernetes-services-object", "title": "Hit count for kubernetes services object", "body": "<p>I am writing a custom Kubernetes controller and resource to keep track of the number of times a service object is called. The idea behind this is to add a \"hitcount\" field to the resource and update it every time a service is invoked. (Meaning update the count every time a request is made to the pod that is part of the service)</p>\n\n<p>Is this possible? Does the kubernetes API have an option to do this?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1534731229, "post_id": 51922990, "comment_id": 90796310, "body": "This looks fines. The problem in your <code>templates</code>."}], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "edited": false, "score": 2, "creation_date": 1534742477, "post_id": 51923491, "comment_id": 90798471, "body": "You saved my day! I missed two dots on &quot;_layout.html&quot;, both of which are in {{}} expressions. Thanks very much!"}, {"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "reply_to_user": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "edited": false, "score": 0, "creation_date": 1534894390, "post_id": 51923491, "comment_id": 90866446, "body": "Welcome. Accept this answer if this is correct. Thank you"}], "tags": [], "owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "is_accepted": true, "score": 1, "last_activity_date": 1534732336, "creation_date": 1534732336, "answer_id": 51923491, "question_id": 51922990, "link": "https://stackoverflow.com/questions/51922990/error-calling-eq-invalid-type-for-comparison-in-go-template/51923491#51923491", "title": "error calling eq: invalid type for comparison in Go template", "body": "<p>Change your <a href=\"https://github.com/IdiotLeon/TutorialCreatingWebApplicationWithGo/blob/5d4aed46596b17ff1dc4d10a70db9f7b3dfd10f5/templates/_layout.html\" rel=\"nofollow noreferrer\">template/_layout.html</a> to this</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;{{.Title}}&lt;/title&gt;\n&lt;link href=\"/css/app.css\" rel=\"stylesheet\" /&gt;\n{{block \"styles\" .}}{{end}}\n&lt;/head&gt;\n&lt;body&gt;\n    {{template \"_header.html\" .}}\n    {{template \"content\" .}}\n    {{template \"_footer.html\" .}}\n    {{block \"scripts\" .}}{{end}}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Your base template was not correct and that's why you are getting this error.</p>\n"}], "owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2887, "favorite_count": 0, "accepted_answer_id": 51923491, "answer_count": 1, "score": 2, "last_activity_date": 1534748548, "creation_date": 1534726727, "last_edit_date": 1534748548, "question_id": 51922990, "link": "https://stackoverflow.com/questions/51922990/error-calling-eq-invalid-type-for-comparison-in-go-template", "title": "error calling eq: invalid type for comparison in Go template", "body": "<p>Background: a few static webpages share the same header. I am going to highlight the active header item by judging its state (in the Go template), with </p>\n\n<pre><code>&lt;a href=\"/home\" class=\"{{ if eq .Active \"home\"}} active{{end}}\"&gt;Home&lt;/a&gt;\n</code></pre>\n\n<p>which, in the terminal, ended up with </p>\n\n<pre><code>2018/08/19 16:46:49 template: _header.html:21:53: executing \"_header.html\" at &lt;eq . \"home\"&gt;: error calling eq: invalid type for comparison\n</code></pre>\n\n<p>The error basically complained about undefined \"<code>.Active</code>\", which made me believe in failure with loading view models.<br/>\nHere is the <a href=\"https://github.com/IdiotLeon/TutorialCreatingWebApplicationWithGo/commit/5d4aed46596b17ff1dc4d10a70db9f7b3dfd10f5\" rel=\"nofollow noreferrer\">commit</a> and <a href=\"https://github.com/IdiotLeon/TutorialCreatingWebApplicationWithGo\" rel=\"nofollow noreferrer\">repo</a>. And I will show key files below:</p>\n\n<p>_layout.html</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n\n&lt;html&gt;\n\n&lt;head&gt;\n    &lt;title&gt;{{.Title}}&lt;/title&gt;\n    &lt;link href=\"/css/app.css\" rel=\"stylesheet\" /&gt; {{block \"styles\" .}}{{end}}\n&lt;/head&gt;\n\n&lt;body&gt;\n    {{template \"_header.html\"}} {{template \"content\" .}} {{template \"_footer.html\"}}{{block \"scripts\" .}}{{end}}\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n\n<p>_header.html</p>\n\n<pre><code>&lt;header class=\"row\"&gt;\n    &lt;div class=\"columns small-2\"&gt;\n        &lt;div class=\"logo-container\"&gt;\n            &lt;div class=\"logo\"&gt;&lt;/div&gt;\n            &lt;h1&gt;Lemonade Stand Supply&lt;/h1&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"columns small-10\"&gt;\n        &lt;div class=\"row\"&gt;\n            &lt;div class=\"columns small-1 small-offset-9\"&gt;\n                &lt;a class=\"secondary-color tiny\" href=\"/login\"&gt; login &lt;/a&gt;\n            &lt;/div&gt;\n            &lt;div class=\"columns small-2\"&gt;\n                &lt;img src=\"/img/cart_small.png\" alt=\"cart\" /&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"row\"&gt;\n            &lt;nav class=\"columns small-6 small-offset-6\"&gt;\n                &lt;div class=\"row\"&gt;\n                    &lt;div class=\"columns small-3 item\"&gt;\n                        &lt;a href=\"/home\" class=\"{{ if eq .Active \"home\"}} active {{end}}\"&gt;Home&lt;/a&gt;\n                    &lt;/div&gt;\n                    &lt;div class=\"columns small-3 item\"&gt;\n                        &lt;a href=\"/shop\" class=\"{{ if eq .Active \"shop\"}} active {{end}}\"&gt;Shop&lt;/a&gt;\n                    &lt;/div&gt;\n                    &lt;div class=\"columns small-6 item\"&gt;\n                        &lt;a href=\".\" class=\"{{ if eq .Active \"standlocator\"}} active {{end}}\"&gt;Stand Locator&lt;/a&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/nav&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/header&gt;\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"TutorialCreatingWebApplicationsWithGo/src/github.com/lss/webapp/viewmodel\"\n)\n\nfunc main() {\n    templates := populateTemplates()\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        requestedFile := r.URL.Path[1:]\n        template := templates[requestedFile+\".html\"]\n        var context interface{}\n        switch requestedFile {\n        case \"shop\":\n            context = viewmodel.NewShop()\n        default:\n            context = viewmodel.NewHome()\n        }\n        if template != nil {\n            err := template.Execute(w, context)\n            if err != nil {\n                log.Println(err)\n            }\n        } else {\n            w.WriteHeader(http.StatusNotFound)\n        }\n    })\n    http.Handle(\"/img/\", http.FileServer(http.Dir(\"../../../../public\")))\n    http.Handle(\"/css/\", http.FileServer(http.Dir(\"../../../../public\")))\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc populateTemplates() map[string]*template.Template {\n    result := make(map[string]*template.Template)\n    const basePath = \"../../../../templates\"\n    layout := template.Must(template.ParseFiles(basePath + \"/_layout.html\"))\n    template.Must(layout.ParseFiles(basePath+\"/_header.html\", basePath+\"/_footer.html\"))\n    dir, err := os.Open(basePath + \"/content\")\n    if err != nil {\n        panic(\"Failed to open template blocks directory: \" + err.Error())\n    }\n    fis, err := dir.Readdir(-1)\n    if err != nil {\n        panic(\"Failed to read contents of content directory: \" + err.Error())\n    }\n    for _, fi := range fis {\n        f, err := os.Open(basePath + \"/content/\" + fi.Name())\n        if err != nil {\n            panic(\"Failed to open template '\" + fi.Name() + \"'\")\n        }\n        content, err := ioutil.ReadAll(f)\n        if err != nil {\n            panic(\"Failed to read content from file '\" + fi.Name() + \"'\")\n        }\n        f.Close()\n        tmpl := template.Must(layout.Clone())\n        _, err = tmpl.Parse(string(content))\n        if err != nil {\n            panic(\"Failed to parse contents of '\" + fi.Name() + \"' as template\")\n        }\n        result[fi.Name()] = tmpl\n    }\n    return result\n}\n</code></pre>\n\n<p>view model - home.go</p>\n\n<pre><code>package viewmodel\n\ntype Home struct {\n    Title  string\n    Active string\n}\n\nfunc NewHome() Home {\n    result := Home{\n        Active: \"home\",\n        Title:  \"Lemonade Stand Supply\",\n    }\n    return result\n}\n</code></pre>\n\n<p>a view model - shop.go</p>\n\n<pre><code>package viewmodel\n\ntype Shop struct {\n    Title      string\n    Active     string\n    Categories []Category\n}\n\ntype Category struct {\n    URL         string\n    ImageURL    string\n    Title       string\n    Description string\n}\n\nfunc NewShop() Shop {\n    result := Shop{\n        Title:  \"Lemonade Stand Supply - Shop\",\n        Active: \"shop\",\n    }\n    juiceCategory := Category{\n        URL:      \"/shop_details\",\n        ImageURL: \"lemon.png\",\n        Title:    \"Juices and Mixes\",\n        Description: `Explore our wide assortment of juices and mixes expected by today's\n        lemonade stand clientelle. Now featuring a full line of organic juices that are guaranceed\n        to be obtained from trees that have never been treated with pesticide or artificial fertilizers.`,\n    }\n    supplyCategory := Category{\n        URL:      \".\",\n        ImageURL: \"kiwi.png\",\n        Title:    \"Cups, Straws, and Other Supplies\",\n        Description: `From paper cups to bio-degradable plastic to straws and napkins,\n        LSS is your source for the sundries that keep you stand running smoothl.`,\n    }\n    advertiseCategory := Category{\n        URL:      \".\",\n        ImageURL: \"pineapple.png\",\n        Title:    \"Signs and Advertising\",\n        Description: `Sure, you could just wait for people to find your stand along\n        the side of the road, but if you want to take it to the next level, our premium\n        line of advertising supplies.`,\n    }\n    result.Categories = []Category{juiceCategory, supplyCategory, advertiseCategory}\n    return result\n}\n</code></pre>\n\n<p>This is literal follow up with the course <a href=\"https://app.pluralsight.com/library/courses/creating-web-applications-go-update/table-of-contents\" rel=\"nofollow noreferrer\"><em>Creating Web Application</em> with Go by Mike Van Sickle</a> (module 5.7, <a href=\"https://app.pluralsight.com/player?course=creating-web-applications-go-update&amp;author=mike-vansickle&amp;name=creating-web-applications-go-update-m4&amp;clip=7&amp;mode=live\" rel=\"nofollow noreferrer\">Logical Tests</a>) . Having carefully matched each file with the example code provided by the lecturer (which worked perfectly fine), I found the code were the same and still cannot find the cause to the problem.</p>\n"}, {"tags": ["pointers", "go", "struct", "nested"], "comments": [{"owner": {"reputation": 8276, "user_id": 2058552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rymLy.jpg?s=128&g=1", "display_name": "Mukesh Sharma", "link": "https://stackoverflow.com/users/2058552/mukesh-sharma"}, "edited": false, "score": 0, "creation_date": 1534731824, "post_id": 51922735, "comment_id": 90796398, "body": "<a href=\"https://stackoverflow.com/a/23551970/2100197\">stackoverflow.com/a/23551970/2100197</a>"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 8276, "user_id": 2058552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rymLy.jpg?s=128&g=1", "display_name": "Mukesh Sharma", "link": "https://stackoverflow.com/users/2058552/mukesh-sharma"}, "edited": false, "score": 0, "creation_date": 1534735760, "post_id": 51922735, "comment_id": 90797144, "body": "I read that and I can understand is there is no point using &quot;pointer&quot; in my use case above. it is perfect to go with Case B."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534736136, "post_id": 51922735, "comment_id": 90797197, "body": "All your question do not have answers: They all depend on other things than pointer vs- non-pointer. If all your method are on *User you probably want to store *Users. For all the &quot;performance&quot; related questions: Measure your actual use case and decide."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1534738287, "post_id": 51922735, "comment_id": 90797551, "body": "There is no method where the struct is used as pointer or reference. Everything is stored straight away to database after providing value to the struct.  That is why, I mentioned to answer based on above situation without assuming anything extra."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534746635, "post_id": 51922735, "comment_id": 90799645, "body": "Okay, so just runtime performance and amount of generated garbage: Measure! Thats why you got tools to do so. There is no sense in guessing or asking (on SO or somewhere other): Measure your specific case!"}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 1835585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b738ee56fed49030d7764b4dbe3e91e0?s=128&d=identicon&r=PG", "display_name": "thesyncim", "link": "https://stackoverflow.com/users/1835585/thesyncim"}, "is_accepted": false, "score": 0, "last_activity_date": 1534811357, "last_edit_date": 1534811357, "creation_date": 1534810541, "answer_id": 51940014, "question_id": 51922735, "link": "https://stackoverflow.com/questions/51922735/confusion-between-pointer-or-no-pointer-for-nested-array-struct/51940014#51940014", "title": "Confusion between Pointer or No Pointer for Nested array struct", "body": "<p>use option B</p>\n\n<p>but if you want avoid allocation during iterations or change the content, you need to do it like this:</p>\n\n<pre><code> for i:=range G.Games{\n       G.Games[i]....\n }\n</code></pre>\n\n<p>this way a copy will be created in every iteration</p>\n\n<pre><code>for _,game:=range G.Games{\n      game....\n }\n</code></pre>\n\n<p>this looks like premature optimization.\nwrite in the most simple/readable way and if is not fast enough, take a look at <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">this</a> in order to find the bottleneck </p>\n"}], "owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1534811357, "creation_date": 1534723101, "last_edit_date": 1534760973, "question_id": 51922735, "link": "https://stackoverflow.com/questions/51922735/confusion-between-pointer-or-no-pointer-for-nested-array-struct", "title": "Confusion between Pointer or No Pointer for Nested array struct", "body": "<p>I have read some of the stack overflow question related to \"why pointer and why not pointer\", but I could not understand much.</p>\n\n<p>So, want to understand based on my example below</p>\n\n<p>I have a list of users and I am finding a hard time to understand which approach is better and faster for the purpose of nesting array struct of users inside another struct.</p>\n\n<p>For an example -</p>\n\n<pre><code>type loc struct {\n    Type string\n    Point []float64\n}\n\ntype User struct {\n    ID string\n    Name string\n    Location loc\n    ... // 30 more fields\n}\n</code></pre>\n\n<p><strong>Case A - Using pointer for nested array struct</strong></p>\n\n<pre><code>type Games struct {\n    ID string\n    Owner []*User\n    Player []*User\n}\n\n// and storing it as\n\nG:= Games{\n    ID: \"1\",\n    Owner: []*User{\n        &amp;User {\n            ID: \"2\",\n            Name: \"User A\",\n        },\n    },\n}\n</code></pre>\n\n<p><strong>Case B - Should I use above approach or below approach to</strong> </p>\n\n<pre><code>type Games struct {\n    ID string\n    Owner []User\n    Player []User\n}\n\n// storing it as\n\nG := Games {\n    ID: \"1\",\n    Owner: []User{\n        {\n            ID: \"2\",\n            Name: \"User A\",\n        },\n    },\n}\n</code></pre>\n\n<p>Considering the situation, I do not have to change data for <code>Owner</code> or <code>Player</code> after creating value for <code>Games</code> above and <strong><code>Player</code> can sometimes remain Nil</strong>, should I use only <code>User</code> or it's better to use <code>*User</code></p>\n\n<p>I  have following confusion based on above 2 cases</p>\n\n<ul>\n<li>Performance - which one is better &amp; why?</li>\n<li>Garbage Collection - which one is better &amp; why?</li>\n<li>Any Memory effects?</li>\n<li>Any other effects!</li>\n</ul>\n\n<h2>Please help me out understanding based on the above example, which method would you have chosen above and why?</h2>\n"}, {"tags": ["go", "browser", "automation", "chromedp"], "answers": [{"tags": [], "owner": {"reputation": 3789, "user_id": 2284676, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/13e34de97b1df53aac80c039b6ffc977?s=128&d=identicon&r=PG&f=1", "display_name": "octohedron", "link": "https://stackoverflow.com/users/2284676/octohedron"}, "is_accepted": false, "score": 1, "last_activity_date": 1564727956, "last_edit_date": 1564727956, "creation_date": 1534721434, "answer_id": 51922612, "question_id": 51922052, "link": "https://stackoverflow.com/questions/51922052/how-to-login-webpage-and-take-screenshot/51922612#51922612", "title": "how to login webpage and take screenshot", "body": "<p>An example to send text to a website's inputs</p>\n\n<pre><code>func main() {\n    var err error\n\n    // create context\n    ctxt, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    // create chrome instance\n    c, err := chromedp.New(ctxt, chromedp.WithLog(log.Printf))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // run task list\n    var val1, val2, val3, val4 string\n    err = c.Run(ctxt, sendkeys(&amp;val1, &amp;val2, &amp;val3, &amp;val4))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // shutdown chrome\n    err = c.Shutdown(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // wait for chrome to finish\n    err = c.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"#input1 value: %s\", val1)\n    log.Printf(\"#textarea1 value: %s\", val2)\n    log.Printf(\"#input2 value: %s\", val3)\n    log.Printf(\"#select1 value: %s\", val4)\n}\n\nfunc sendkeys(val1, val2, val3, val4 *string) chromedp.Tasks {\n    return chromedp.Tasks{\n        chromedp.Navigate(\"file:\" + os.Getenv(\"GOPATH\") + \n      \"/src/github.com/chromedp/chromedp/testdata/visible.html\"),\n        chromedp.WaitVisible(`#input1`, chromedp.ByID),\n        chromedp.WaitVisible(`#textarea1`, chromedp.ByID),\n        chromedp.SendKeys(`#textarea1`,\n      kb.End+\"\\b\\b\\n\\naoeu\\n\\ntest1\\n\\nblah2\\n\\n\\t\\t\\t\\b\\bother\n      box!\\t\\ntest4\", chromedp.ByID),\n        chromedp.Value(`#input1`, val1, chromedp.ByID),\n        chromedp.Value(`#textarea1`, val2, chromedp.ByID),\n        chromedp.SetValue(`#input2`, \"test3\", chromedp.ByID),\n        chromedp.Value(`#input2`, val3, chromedp.ByID),\n        chromedp.SendKeys(`#select1`, kb.ArrowDown+kb.ArrowDown,\n      chromedp.ByID),\n        chromedp.Value(`#select1`, val4, chromedp.ByID),\n        chromedp.Sleep(30 * time.Second),\n    }\n}\n</code></pre>\n\n<p>After that you can click on the login button, another example</p>\n\n<pre><code>// Command click is a chromedp example demonstrating how to use a selector to\n// click on an element.\npackage main\n\nimport (\n    \"context\"\n    \"log\"\n    \"time\"\n\n    \"github.com/chromedp/chromedp\"\n)\n\nfunc main() {\n    var err error\n\n    // create context\n    ctxt, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    // create chrome instance\n    c, err := chromedp.New(ctxt, chromedp.WithLog(log.Printf))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // run task list\n    err = c.Run(ctxt, click())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // shutdown chrome\n    err = c.Shutdown(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // wait for chrome to finish\n    err = c.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc click() chromedp.Tasks {\n    return chromedp.Tasks{\n        chromedp.Navigate(`https://golang.org/pkg/time/`),\n        chromedp.WaitVisible(`#footer`),\n        chromedp.Click(`#pkg-overview`, chromedp.NodeVisible),\n        chromedp.Sleep(150 * time.Second),\n    }\n}\n</code></pre>\n\n<p>For taking a screenshot</p>\n\n<pre><code>// Command screenshot is a chromedp example demonstrating how to take a\n// screenshot of a specific element.\npackage main\n\nimport (\n    \"context\"\n    \"io/ioutil\"\n    \"log\"\n    \"time\"\n\n    \"github.com/chromedp/chromedp\"\n)\n\nfunc main() {\n    var err error\n\n    // create context\n    ctxt, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    // create chrome instance\n    c, err := chromedp.New(ctxt, chromedp.WithLog(log.Printf))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // run task list\n    var buf []byte\n    err = c.Run(ctxt, screenshot(`https://brank.as/`, `#contact-form`, &amp;buf))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // shutdown chrome\n    err = c.Shutdown(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // wait for chrome to finish\n    err = c.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = ioutil.WriteFile(\"contact-form.png\", buf, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc screenshot(urlstr, sel string, res *[]byte) chromedp.Tasks {\n    return chromedp.Tasks{\n        chromedp.Navigate(urlstr),\n        chromedp.Sleep(2 * time.Second),\n        chromedp.WaitVisible(sel, chromedp.ByID),\n        chromedp.WaitNotVisible(`div.v-middle &gt; div.la-ball-clip-rotate`, chromedp.ByQuery),\n        chromedp.Screenshot(sel, res, chromedp.NodeVisible, chromedp.ByID),\n    }\n}\n</code></pre>\n\n<p>If you want a more detailed answer you need to post the website, hope it helps</p>\n"}], "owner": {"reputation": 39, "user_id": 6159637, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91ceed2471c40e72e788ee2abe61e59?s=128&d=identicon&r=PG&f=1", "display_name": "shamimakhtar", "link": "https://stackoverflow.com/users/6159637/shamimakhtar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2081, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1571731484, "creation_date": 1534714882, "last_edit_date": 1571731484, "question_id": 51922052, "link": "https://stackoverflow.com/questions/51922052/how-to-login-webpage-and-take-screenshot", "title": "how to login webpage and take screenshot", "body": "<p>How to login webpage with chromedp and take screenshot. </p>\n\n<p><a href=\"https://github.com/chromedp/chromedp\" rel=\"nofollow noreferrer\">https://github.com/chromedp/chromedp</a></p>\n"}, {"tags": ["validation", "go", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534707200, "post_id": 51920940, "comment_id": 90792051, "body": "That&#39;s how <code>Bind</code> works, the nice errors come from Validation which happends only after binding finished successfully. If <code>Bind</code> cannot set a value to a field (the string <code>&quot;abc&quot;</code> to an <code>int</code> field for example) then it returns an error without ever invoking the validation. Validation can happen only when the fields are already set by binding... One workaround is to use <code>ShouldBind</code> instead of <code>Bind</code>, the <code>ShouldBindXxx</code> group of methods returns the error to you instead of just responding with <code>400</code> like <code>Bind</code> does."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534707266, "post_id": 51920940, "comment_id": 90792060, "body": "... but you&#39;ll have to do some manual work, you&#39;ll have to turn the <code>ParseInt</code> error into something you can use in the html template. How you do that is up to you."}, {"owner": {"reputation": 1342, "user_id": 5508532, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/67f7923644113e4d8897b755a75b8272?s=128&d=identicon&r=PG&f=1", "display_name": "binary01", "link": "https://stackoverflow.com/users/5508532/binary01"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534707686, "post_id": 51920940, "comment_id": 90792157, "body": "Ok, are there other frameworks that provides a more friendly binding and validation support, so it&#39;s easier to inform users about which field they messed up  - without doing it all on the frontend ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534709191, "post_id": 51920940, "comment_id": 90792509, "body": "I don&#39;t know, maybe there are but I don&#39;t know any so you&#39;ll have to research that yourself."}, {"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "edited": false, "score": 0, "creation_date": 1560961684, "post_id": 51920940, "comment_id": 99911740, "body": "@binary01 Did you manage to find a solution to this problem?"}], "owner": {"reputation": 1342, "user_id": 5508532, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/67f7923644113e4d8897b755a75b8272?s=128&d=identicon&r=PG&f=1", "display_name": "binary01", "link": "https://stackoverflow.com/users/5508532/binary01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2004, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1534705499, "creation_date": 1534705499, "question_id": 51920940, "link": "https://stackoverflow.com/questions/51920940/how-to-get-field-with-error-from-gin-binding-validation", "title": "How to get field with error from gin binding/validation?", "body": "<p>I have this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gin-gonic/gin\"\n)\n\ntype TestForm struct {\n    Age  int    `form:\"age\" binding:\"required\"`\n    Name string `form:\"name\" binding:\"required\"`\n}\n\nfunc home(c *gin.Context) {\n    c.HTML(200, \"index.html\", nil)\n}\n\nfunc homePost(c *gin.Context) {\n    var f TestForm\n    err := c.Bind(&amp;f)\n    c.String(200, fmt.Sprintf(\"%v : %v\", err, f))\n}\n\nfunc main() {\n    r := gin.Default()\n    r.LoadHTMLGlob(\"templates/*\")\n    r.Use(gin.Recovery())\n    r.GET(\"/\", home)\n    r.POST(\"/\", homePost)\n    r.Run()\n}\n</code></pre>\n\n<p>and templates/index.html : </p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;hello&lt;/h1&gt;\n&lt;form action=\"/\" method=\"POST\"&gt;\n&lt;input type=\"text\" name=\"name\"&gt;\n&lt;input type=\"text\" name=\"age\"&gt; \n&lt;input type=\"submit\"&gt;\n\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>When the fields fail binding/validation, I would like to iterate over all the fields in order to render an error in HTML on the matching field.</p>\n\n<p>If I input <strong>test</strong> as <code>name</code> leave <code>age</code> blank, the response is this:</p>\n\n<pre><code>Key: 'TestForm.Age' Error:Field validation for 'Age' failed on the 'required' tag : {0 asd}\n</code></pre>\n\n<p>I have found the <code>err</code> returned from <code>err := c.Bind(&amp;f)</code> to be the type <code>validator.ValidationErrors</code> which allows me to do exactly this, so far all is good.</p>\n\n<p>However if I input <strong>test</strong> as <code>name</code> and <code>abc</code> as age` (or eve just input a number with a space after it), the response is this:</p>\n\n<pre><code>strconv.ParseInt: parsing \"abc\": invalid syntax : {0 }\n</code></pre>\n\n<p>So, just a generic error that somewhere something failed to parse an integer. </p>\n\n<p>Now I have no way of knowing which field failed, nor do I get any info about other fields failing validation. Is there any way to have gin tell me that the <code>age</code> field failed in this case ?</p>\n"}, {"tags": ["go", "bitcoin"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1534705826, "creation_date": 1534705826, "answer_id": 51920979, "question_id": 51920895, "link": "https://stackoverflow.com/questions/51920895/go-error-on-make-btcd-undefined-time-until/51920979#51920979", "title": "go error on make btcd: undefined: time.Until", "body": "<p>The time.Until function was <a href=\"https://go-review.googlesource.com/c/go/+/20118\" rel=\"nofollow noreferrer\">added only recently</a>. Make sure you use the latest version of Go. It seems that this function was added in Go version 1.8.</p>\n"}], "owner": {"reputation": 500, "user_id": 1017466, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73d62289ed695b520ad2a3ae80c45277?s=128&d=identicon&r=PG", "display_name": "bluethundr", "link": "https://stackoverflow.com/users/1017466/bluethundr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 51920979, "answer_count": 1, "score": 0, "last_activity_date": 1534705826, "creation_date": 1534705113, "question_id": 51920895, "link": "https://stackoverflow.com/questions/51920895/go-error-on-make-btcd-undefined-time-until", "title": "go error on make btcd: undefined: time.Until", "body": "<p>I am trying to install btcd as part of LND. </p>\n\n<p>I've already installed LND successfully: <a href=\"https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md\" rel=\"nofollow noreferrer\">https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md</a></p>\n\n<p>But when I go to make btcd I get this error:</p>\n\n<pre><code># github.com/btcsuite/btcd\n../../btcsuite/btcd/server.go:1564: /\nmake: *** [btcd] Error 2\n</code></pre>\n\n<p>How do I correct this error so that I can install and run btcd?</p>\n"}, {"tags": ["go", "gomock"], "answers": [{"tags": [], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "is_accepted": false, "score": 0, "last_activity_date": 1534710552, "creation_date": 1534710552, "answer_id": 51921592, "question_id": 51920705, "link": "https://stackoverflow.com/questions/51920705/how-to-deal-with-random-input-and-output-values/51921592#51921592", "title": "How to deal with random input and output values", "body": "<p>Found out how the matcher works. This is what I needed to do</p>\n\n<pre><code>m.EXPECT().DownloadFile(\"myfile\", gomock.Any()).Return(\"/var/folders/ls/ok\", nil)\n</code></pre>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534748649, "creation_date": 1534703703, "last_edit_date": 1534748649, "question_id": 51920705, "link": "https://stackoverflow.com/questions/51920705/how-to-deal-with-random-input-and-output-values", "title": "How to deal with random input and output values", "body": "<p>I have a wrapper interface that defines a Downloadfile function. The problem is that one of parameters has a random temporary directoriename and the output is a random temporary filename. How do I mock it using <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">https://github.com/golang/mock</a> so I can test the addFile function</p>\n\n<pre><code>var wrapper\nfunc Test(t *testing.T) {\n    ctrl, _ := gomock.WithContext(context.Background(), t)\n    defer ctrl.Finish()\n    m := mock.NewMockWrapperInterface(ctrl)\n    m.EXPECT().DownloadFile(\"myfile\", \"/var/folders/ls/???\").Return(\"/var/folders/ls/???\", nil)\n    wrapper = m\n    path, err := addFile(myfile, key)\n    ...\n}\n\nfunc addFile(myfile, key) (string, error) {\n    tmpDirectory := helper.CreateTemporaryDirectory(objectKey)\n    defer helper.CleanUpDirectory(tmpDirectory)\n    return wrapper.DownloadFile(myfile, tmpDirectory)\n}\n</code></pre>\n"}, {"tags": ["go", "encryption", "server", "slice", "nacl-cryptography"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1534699466, "post_id": 51919794, "comment_id": 90790023, "body": "Are you sure the panic is on the line where you&#39;re setting <code>decrypted</code> and not on the line above? If <code>encrypted[:24]</code> is OK, then <code>encrypted[24:]</code> should also be OK."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1534700383, "post_id": 51919794, "comment_id": 90790254, "body": "According to VS Code it&#39;s the line with &quot;decrypted&quot;.  Go also counts the lines starting with 1, doesn&#39;t it?  I would guess, that the problems lies at the end of each slice, as encrypted[:24] works. Maybe <code>code</code> fmt.Fprintf(conn, text+&quot;\\n&quot;) <code>code</code> is the problem, as it adds the (needed) new line to print?  EDIT: in the above code it&#39;s line 74 (not 79), as I removed some comments not relevant for this post."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1534711285, "post_id": 51921438, "comment_id": 90793025, "body": "Thx! This is highly probably the cause. But  <code>len(input.Bytes()) &gt;= 24</code> should be true when input.Bytes() is generated via <code>var nonce [24]byte \t\tif _, err := io.ReadFull(crypto_rand.Reader, nonce[:]); err != nil { \t\t\tpanic(err) \t\t} \t\tsenderPrivateKey := readKey(&quot;localPrivate&quot;) \t\trecipientPublicKey := readKey(&quot;remotePublic&quot;) \t\tencrypted := box.Seal(nonce[:], textIn, &amp;nonce, recipientPublicKey, senderPrivateKey) \t\ttext := BytesToString(encrypted) \t\tfmt.Fprintf(conn, text+&quot;\\n&quot;)</code> (see above for better readability). Encryption without transmission works. So where is it shortened / changed?"}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1534746314, "post_id": 51921438, "comment_id": 90799517, "body": "Thanks for your effort. I totally agree. Somehow the standalone encryption / decryption from os.Stdin doesn&#39;t produce this kind of error, though. It&#39;s the sample implementation from golang with os.Stdin input added. <a href=\"https://gist.github.com/halux9000/b3545858c2438ac519f4f1f410eb382a\" rel=\"nofollow noreferrer\">gist.github.com/halux9000/b3545858c2438ac519f4f1f410eb382a</a> ...  May you point to the mistake in my code? Is the problem that I convert the cipthertext to string before transmitting and the string includes &quot;\\n&quot; (which seems not to be a problem for []byte)? Would you advice another method of sending ciphertext byte to conn?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1534849974, "last_edit_date": 1534849974, "creation_date": 1534709375, "answer_id": 51921438, "question_id": 51919794, "link": "https://stackoverflow.com/questions/51919794/runtime-error-slice-bounds-out-of-range-in-encrypted-chat/51921438#51921438", "title": "&quot;runtime error: slice bounds out of range&quot; in encrypted chat", "body": "<p>For no apparent reason, you hope that <code>len(input.Bytes()) &gt;= 24</code>. When it is not: <code>panic: runtime error: slice bounds out of range</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nfunc main() {\n    /*\n       var decryptNonce [24]byte\n       encrypted := input.Bytes()\n       copy(decryptNonce[:], encrypted[:24])\n       decrypted, ok := box.Open(nil, encrypted[24:], &amp;decryptNonce, senderPublicKey, recipientPrivateKey)\n       if !ok {\n           fmt.Println(\"decryption error\")\n       }\n    */\n\n    var decryptNonce [24]byte\n    encrypted := make([]byte, 23, 24) // len(input.Bytes()) &lt; 24\n    copy(decryptNonce[:], encrypted[:24])\n    // panic: runtime error: slice bounds out of range\n    _ = encrypted[24:]\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/LZ34NgLV84G\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LZ34NgLV84G</a></p>\n\n<p>Output:</p>\n\n<pre><code>panic: runtime error: slice bounds out of range\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox792172306/main.go:18 +0xa0\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><strong>Comment by Halux9000</strong>:</p>\n  \n  <p>This is highly probably the cause. But <code>len(input.Bytes()) &gt;= 24</code> should\n  be true when <code>input.Bytes()</code> is generated via </p>\n\n<pre><code>var nonce [24]byte\nif _, err := io.ReadFull(crypto_rand.Reader, nonce[:]); err != nil {\n  panic(err)\n}\nsenderPrivateKey := readKey(\"localPrivate\")\nrecipientPublicKey := readKey(\"remotePublic\")\nencrypted := box.Seal(nonce[:], textIn, &amp;nonce, recipientPublicKey, senderPrivateKey)\ntext := BytesToString(encrypted)\nfmt.Fprintf(conn, text+\"\\n\")\n</code></pre>\n  \n  <p>Encryption without transmission works. So where is it shortened /\n  changed?</p>\n</blockquote>\n\n<p>I'm not persuaded by your \"should\" argument. I believe the program. </p>\n\n<p>If you have random or encrypted bytes then some of them are going to be newlines. I calculated the expected percentage of lines with a newline in the first 24 bytes (the nonce) as 8.966% and confirmed that by experiment.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/rand\"\n    \"fmt\"\n    \"io\"\n)\n\nvar nonce [24]byte\n\nfunc expected() float64 {\n    e := 0.0\n    for range nonce {\n        e += (float64(len(nonce)) - e) / 256\n    }\n    return e * 100 / float64(len(nonce))\n}\n\nfunc actual() float64 {\n    a, n := 0, 1024*1024\n    for i := 0; i &lt; n; i++ {\n        if _, err := io.ReadFull(rand.Reader, nonce[:]); err != nil {\n            panic(err)\n        }\n        if bytes.IndexByte(nonce[:], '\\n') &gt;= 0 {\n            a++\n        }\n    }\n    return float64(a*100) / float64(n)\n}\n\nfunc main() {\n    fmt.Printf(\"expected: %.3f%%\\n\", expected())\n    fmt.Printf(\"actual:   %.3f%%\\n\", actual())\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/cKJlGUSbi3u\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cKJlGUSbi3u</a></p>\n\n<p>Output:</p>\n\n<pre><code>$ go run newlines.go\nexpected: 8.966%\nactual:   8.943%\n$ go run newlines.go\nexpected: 8.966%\nactual:   8.956%\n$ go run newlines.go\nexpected: 8.966%\nactual:   8.976%\n$ go run newlines.go\nexpected: 8.966%\nactual:   8.992%\n$\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><strong>Comment by Halux9000</strong>:</p>\n  \n  <p>Would you advise another method of sending ciphertext bytes to conn?</p>\n</blockquote>\n\n<p>You need a more robust message protocol that is not sensitive to message content. For example, prefix the message content with the message content length.</p>\n\n<p>A simple illustration,</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    // Connection\n    var conn = new(bytes.Buffer)\n\n    {\n        // Server\n        buf := make([]byte, 0, 2+64*1024)\n        msgLen := uint16(16)\n        buf = buf[0 : 2+msgLen]\n        binary.BigEndian.PutUint16(buf[0:2], msgLen)\n        for i := uint16(0); i &lt; msgLen; i++ {\n            buf[2+i] = byte(i)\n        }\n        fmt.Println(msgLen, len(buf), buf)\n        n, err := conn.Write(buf)\n        if err != nil {\n            fmt.Println(n, err)\n            return\n        }\n    }\n\n    {\n        // Client\n        buf := make([]byte, 0, 2+64*1024)\n        n, err := io.ReadFull(conn, buf[:2])\n        if err != nil {\n            fmt.Println(n, err)\n            return\n        }\n        msgLen := binary.BigEndian.Uint16(buf[0:2])\n        buf = buf[0 : 2+msgLen]\n        n, err = io.ReadFull(conn, buf[2:2+msgLen])\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        fmt.Println(msgLen, len(buf), buf)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/nS3xpFrG4uB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nS3xpFrG4uB</a></p>\n\n<p>Output:</p>\n\n<pre><code>16 18 [0 16 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15]\n16 18 [0 16 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15]\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2420, "favorite_count": 1, "accepted_answer_id": 51921438, "answer_count": 1, "score": 1, "last_activity_date": 1534849974, "creation_date": 1534696978, "last_edit_date": 1534781170, "question_id": 51919794, "link": "https://stackoverflow.com/questions/51919794/runtime-error-slice-bounds-out-of-range-in-encrypted-chat", "title": "&quot;runtime error: slice bounds out of range&quot; in encrypted chat", "body": "<p><strong>Update:</strong> thanks to peterSO the error seems to be that random bytes, read as strings will include \"\\n\" which causes a newline and the error. \nThe problem is neither</p>\n\n<pre><code>io.Copy(conn, bytes.NewReader(encrypted))\n</code></pre>\n\n<p>nor</p>\n\n<pre><code>conn.Write([]byte(encrypted))\n</code></pre>\n\n<p>work.\nAnyone has an idea how to write the chipertext to conn?</p>\n\n<p><strong>Original post:</strong>\nThe chat program consists of one server and two clients. It uses TLS and NaCl for (end-to-end-)encryption. In 3/4 of cases it works, but sometimes I get an error:</p>\n\n<pre><code>panic: runtime error: slice bounds out of range\n\ngoroutine 34 [running]:\nmain.handleConnection(0x600a60, 0xc04246c000)\n    path-to/client.go:79 \n+0x3a6\ncreated by main.main\n    path-to/client.go:44 \n+0x436\nexit status 2\n</code></pre>\n\n<p>Line 44 calls</p>\n\n<pre><code>go handleConnection(conn)\n</code></pre>\n\n<p>Line 79 is the \"decrypted\" line:</p>\n\n<pre><code>func handleConnection(conn net.Conn) {\n    defer conn.Close()\n    input := bufio.NewScanner(conn)\n    for input.Scan() {\n        senderPublicKey := readKey(\"localPublic\")\n        recipientPrivateKey := readKey(\"remotePrivate\")\n        var decryptNonce [24]byte\n        encrypted := input.Bytes()\n        copy(decryptNonce[:], encrypted[:24])\n        decrypted, ok := box.Open(nil, encrypted[24:], &amp;decryptNonce, senderPublicKey, recipientPrivateKey)\n        if !ok {\n            fmt.Println(\"decryption error\")\n        }\n        fmt.Println(BytesToString(decrypted))\n    }\n}\n</code></pre>\n\n<p>The full code is further down. As it works flawlessly without encryption and a test-implementation of just the encryption also works, I would point to the transmission between client-server-client. Normally the length of the slice shouldn't change, as the output should remain the same?</p>\n\n<p>The client reads:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    crypto_rand \"crypto/rand\"\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"os\"\n\n    \"golang.org/x/crypto/nacl/box\"\n)\n\nfunc main() {\n    cert, err := tls.LoadX509KeyPair(\"cert.pem\", \"key.pem\")\n    if err != nil {\n        log.Fatalln(\"Unable to load cert\", err)\n    }\n\n    clientCACert, err := ioutil.ReadFile(\"cert.pem\")\n    if err != nil {\n        log.Fatal(\"Unable to open cert\", err)\n    }\n\n    clientCertPool := x509.NewCertPool()\n    clientCertPool.AppendCertsFromPEM(clientCACert)\n\n    conf := &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n        RootCAs:      clientCertPool,\n        //InsecureSkipVerify: true,\n    }\n\n    conn, err := tls.Dial(\"tcp\", \"localhost:443\", conf)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer conn.Close()\n    go handleConnection(conn)\n    for {\n        stdin := bufio.NewReader(os.Stdin)\n        textIn, err := stdin.ReadBytes('\\n')\n        if err != nil {\n            fmt.Println(err)\n        }\n        var nonce [24]byte\n        if _, err := io.ReadFull(crypto_rand.Reader, nonce[:]); err != nil {\n            panic(err)\n        }\n        senderPrivateKey := readKey(\"localPrivate\")\n        recipientPublicKey := readKey(\"remotePublic\")\n        encrypted := box.Seal(nonce[:], textIn, &amp;nonce, recipientPublicKey, senderPrivateKey)\n        text := BytesToString(encrypted)\n        fmt.Fprintf(conn, text+\"\\n\")\n    }\n\n}\n\nfunc handleConnection(conn net.Conn) {\n    defer conn.Close()\n    input := bufio.NewScanner(conn)\n    for input.Scan() {\n        senderPublicKey := readKey(\"localPublic\")\n        recipientPrivateKey := readKey(\"remotePrivate\")\n        var decryptNonce [24]byte\n        encrypted := input.Bytes()\n        copy(decryptNonce[:], encrypted[:24])\n        decrypted, ok := box.Open(nil, encrypted[24:], &amp;decryptNonce, senderPublicKey, recipientPrivateKey)\n        if !ok {\n            fmt.Println(\"decryption error\")\n        }\n        fmt.Println(BytesToString(decrypted))\n    }\n}\n\n//BytesToString converts []byte to str\nfunc BytesToString(data []byte) string {\n    return string(data[:])\n}\n\n//Read the keys from file, pass filename without .ending\nfunc readKey(name string) (prv *[32]byte) {\n    prv = new([32]byte)\n    f, err := os.Open(name + \".key\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = io.ReadFull(f, prv[:])\n    if err != nil {\n        panic(err)\n    }\n\n    return\n}\n</code></pre>\n\n<p>The server side:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"crypto/tls\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n)\n\n\ntype client chan&lt;- string // an outgoing message channel\n\nvar (\n    entering = make(chan client)\n    leaving  = make(chan client)\n    messages = make(chan string) // all incoming client messages\n)\n\n// Broadcast incoming message to all clients' outgoing message channels.\nfunc broadcaster() {\n    clients := make(map[client]bool) // all connected clients\n    for {\n        select {\n        case msg := &lt;-messages:\n            for cli := range clients {\n                cli &lt;- msg\n            }\n        case cli := &lt;-entering:\n            clients[cli] = true\n        case cli := &lt;-leaving:\n            delete(clients, cli)\n            close(cli)\n        }\n    }\n}\n\nfunc handleConn(conn net.Conn) {\n    ch := make(chan string) // outgoing client messages\n    go clientWriter(conn, ch)\n\n    //who := conn.RemoteAddr().String()\n    entering &lt;- ch\n    //messages &lt;- who + \" has arrived\"\n    input := bufio.NewScanner(conn)\n    for input.Scan() {\n        messages &lt;- input.Text()\n    }\n    //messages &lt;- who + \" has left\"\n    leaving &lt;- ch\n    conn.Close()\n}\n\nfunc clientWriter(conn net.Conn, ch &lt;-chan string) {\n    for msg := range ch {\n        fmt.Fprintln(conn, msg)\n    }\n}\n\n\n\n\nfunc main() {\n    cer, err := tls.LoadX509KeyPair(\"cert.pem\", \"key.pem\")\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    config := &amp;tls.Config{\n        Certificates: []tls.Certificate{cer},\n        //PFS, this will reject client with RSA certificates\n        CipherSuites: []uint16{tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384},\n        //Force it server side\n        PreferServerCipherSuites: true,\n        //Force TLS Version\n        MinVersion: tls.VersionTLS12}\n\n    listener, err := tls.Listen(\"tcp\", \"localhost:443\", config)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    go broadcaster()\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            log.Print(err)\n            continue\n        }\n        go handleConn(conn)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534694362, "post_id": 51919428, "comment_id": 90788573, "body": "Please post the code you have tried to insert the data."}], "answers": [{"tags": [], "owner": {"reputation": 176, "user_id": 8551142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LXW13.jpg?s=128&g=1", "display_name": "zypox", "link": "https://stackoverflow.com/users/8551142/zypox"}, "is_accepted": false, "score": 1, "last_activity_date": 1534694764, "creation_date": 1534694764, "answer_id": 51919492, "question_id": 51919428, "link": "https://stackoverflow.com/questions/51919428/why-doesnt-gorm-report-an-insert-error-in-the-logs/51919492#51919492", "title": "Why doesn&#39;t gorm report an insert error in the logs?", "body": "<p>You have to append <code>.Error</code> at the end of your insert statement in order for GORM to return the error message if there were any. Also, you can use <code>.GetErrors()</code> to get all raised errors as a slice.</p>\n"}, {"comments": [{"owner": {"reputation": 4917, "user_id": 2320961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AdwXN.png?s=128&g=1", "display_name": "Nic3500", "link": "https://stackoverflow.com/users/2320961/nic3500"}, "edited": false, "score": 0, "creation_date": 1534723214, "post_id": 51919987, "comment_id": 90795071, "body": "While this code may answer the question, providing additional context regarding how and/or why it solves the problem would improve the answer&#39;s long-term value."}], "tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": false, "score": 0, "last_activity_date": 1534698418, "creation_date": 1534698418, "answer_id": 51919987, "question_id": 51919428, "link": "https://stackoverflow.com/questions/51919428/why-doesnt-gorm-report-an-insert-error-in-the-logs/51919987#51919987", "title": "Why doesn&#39;t gorm report an insert error in the logs?", "body": "<pre><code>if err := db.Create(&amp;entity).Error; err != nil {\n  fmt.Println(err.Error())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2236, "user_id": 3385651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OS7Kn.png?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/3385651/bruno"}, "is_accepted": true, "score": 1, "last_activity_date": 1534783795, "creation_date": 1534783795, "answer_id": 51935269, "question_id": 51919428, "link": "https://stackoverflow.com/questions/51919428/why-doesnt-gorm-report-an-insert-error-in-the-logs/51935269#51935269", "title": "Why doesn&#39;t gorm report an insert error in the logs?", "body": "<p>You should use gorm in debug mode to see error messages!</p>\n\n<pre><code>// Enable Logger, show detailed log\ndb.LogMode(true)\n\n// Disable Logger, don't show any log even errors\ndb.LogMode(false)\n\n// Debug a single operation, show detailed log for this operation\ndb.Debug().Where(\"name = ?\", \"jinzhu\").First(&amp;User{})\n</code></pre>\n\n<p><a href=\"http://gorm.io/docs/logger.html\" rel=\"nofollow noreferrer\">Gorm documentation for Logger</a></p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 431, "favorite_count": 0, "accepted_answer_id": 51935269, "answer_count": 3, "score": 0, "last_activity_date": 1539070354, "creation_date": 1534694269, "last_edit_date": 1539070354, "question_id": 51919428, "link": "https://stackoverflow.com/questions/51919428/why-doesnt-gorm-report-an-insert-error-in-the-logs", "title": "Why doesn&#39;t gorm report an insert error in the logs?", "body": "<p>I tried performing an insert using GORM and my logs displays the insert statement and says </p>\n\n<blockquote>\n  <p>0 rows affected or returned</p>\n</blockquote>\n\n<p>If I copy and paste the insert statement, I can see this error in psql:</p>\n\n<blockquote>\n  <p>ERROR:  null value in column \"start_dt\" violates not-null constraint</p>\n</blockquote>\n\n<p><strong>Is there a way for me to see this error in my go logs right away?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534689957, "post_id": 51918763, "comment_id": 90787393, "body": "What program you want to reload do you want to re-run the go file using go run."}, {"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534690091, "post_id": 51918763, "comment_id": 90787439, "body": "a simple single file like  test.go  or  test binary file . like gdb can reload after source code modify."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534690136, "post_id": 51918763, "comment_id": 90787454, "body": "Use <code>F5</code> short key after changing the code and see the output in vscode debug console."}, {"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534690611, "post_id": 51918763, "comment_id": 90787569, "body": "i don&#39;t understand, for examle  , I have run  &quot; dlv debug test.go&quot; , how to reload file without dlv exit after  file have modified.  i use F5 in the dlv debug console and not have any influences."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534690913, "post_id": 51918763, "comment_id": 90787635, "body": "Use it in the vscode where you have opened the file for modification."}, {"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534691528, "post_id": 51918763, "comment_id": 90787783, "body": "my environment is centos  and editor is vim , so can do that in the terminal console?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534691642, "post_id": 51918763, "comment_id": 90787813, "body": "Oh I get you should edit our question adding the information that you are using vim editor and centos. Because I was thinking you are using vscode as editor."}, {"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534691836, "post_id": 51918763, "comment_id": 90787869, "body": "I&#39;m sorry for not description clear about my Development environment, and have any method can do that in dlv debug mode in linux console ."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "edited": false, "score": 0, "creation_date": 1534730219, "post_id": 51923142, "comment_id": 90796131, "body": "~.~, I just want reload file within  dlv debug mode , and need not to exit ."}, {"owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "edited": false, "score": 0, "creation_date": 1534831096, "post_id": 51923142, "comment_id": 90834306, "body": "maybe i not describe clear,  i  mean  dlv have any command like gdb &quot;file&quot;    command that can reload executable when my source code have changed. thanks again"}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1534991755, "last_edit_date": 1534991755, "creation_date": 1534728524, "answer_id": 51923142, "question_id": 51918763, "link": "https://stackoverflow.com/questions/51918763/how-to-reload-source-files-in-golang-dlv/51923142#51923142", "title": "How to reload source files in golang dlv", "body": "<p>~~ guess you are looking for live code reloading like this ~~</p>\n\n<p>~~ <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">https://github.com/codegangsta/gin</a> ~~</p>\n\n<ul>\n<li><p>1 if you are looking to debug without exiting vim then:\n<code>:new | 0read ! dlv debug #</code> will do.</p></li>\n<li><p>2 if you are looking to load the dlv mode constantly you can probably use tmux with split-pane. With one pane having vim and your file open and the other running dlv. <em>When you change your file in vim(in a pane) delve(in the companion pane) reloads this file for debugging</em>. </p></li>\n<li><p>3 if you just want to run debug at the time of saving the file, prefix the first command with <code>autocmd BufWritePre Filetype go</code> and add that to your <code>virmc</code>. </p></li>\n</ul>\n\n<p>If you are looking for some command that rebuilds your executable each time you make a change, I think you are in the wrong place, debugging is not meant to rebuild the executable. After you are done debugging, you can check your application and run the command(some variation of <code>go build</code> or some wrapper that calls it). To build your executable. </p>\n"}, {"tags": [], "owner": {"reputation": 50, "user_id": 235794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f029827874b9947cd1c5f8551881ee8?s=128&d=identicon&r=PG", "display_name": "Jerry Seutter", "link": "https://stackoverflow.com/users/235794/jerry-seutter"}, "is_accepted": true, "score": 2, "last_activity_date": 1557951881, "creation_date": 1557951881, "answer_id": 56157110, "question_id": 51918763, "link": "https://stackoverflow.com/questions/51918763/how-to-reload-source-files-in-golang-dlv/56157110#56157110", "title": "How to reload source files in golang dlv", "body": "<p>Delve currently does not have a way to reload the compiled code you are running while preserving your state like breakpoints and traces.  Probably the best thing you can do is use the \"source\" command in Delve.  For example, if you put a file called <code>debug.txt</code> in the local directory, you can add:</p>\n\n<pre><code>break foo.go:171\non 1 print myVar\n</code></pre>\n\n<p>..and back in <code>dlv debug</code>:</p>\n\n<pre><code>$ dlv debug\nType 'help' for list of commands.\n(dlv) source debug.txt\nBreakpoint 1 set at 0x1b0f5e5 for /path/to/foo.MyFunction() ./foo.go:171\n(dlv)\n</code></pre>\n\n<p>your configured breakpoints are loaded.</p>\n\n<p>This isn't a perfect solution and I miss the gdb behavior, so I created a GitHub issue to start a discussion: <a href=\"https://github.com/go-delve/delve/issues/1551\" rel=\"nofollow noreferrer\">https://github.com/go-delve/delve/issues/1551</a></p>\n"}], "owner": {"reputation": 49, "user_id": 6612455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpYHO.png?s=128&g=1", "display_name": "Long", "link": "https://stackoverflow.com/users/6612455/long"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1454, "favorite_count": 0, "accepted_answer_id": 56157110, "answer_count": 2, "score": 1, "last_activity_date": 1557951881, "creation_date": 1534689668, "last_edit_date": 1534756183, "question_id": 51918763, "link": "https://stackoverflow.com/questions/51918763/how-to-reload-source-files-in-golang-dlv", "title": "How to reload source files in golang dlv", "body": "<p>I am using dlv to debug golang source code. Is there any command that reloads a program after modifying the source code? I have searched online and the dlv documentation but did not found anything on how to do that.</p>\n\n<p>Any help will be appreciated.</p>\n\n<p>environment : centos</p>\n"}, {"tags": ["go", "tshark"], "comments": [{"owner": {"reputation": 3917, "user_id": 2755698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=128&d=identicon&r=PG", "display_name": "Christopher Maynard", "link": "https://stackoverflow.com/users/2755698/christopher-maynard"}, "edited": false, "score": 1, "creation_date": 1534722587, "post_id": 51918178, "comment_id": 90794978, "body": "Do you see any output if you manually run &quot;tshark -i em1&quot;?"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "edited": false, "score": 0, "creation_date": 1534705264, "post_id": 51919719, "comment_id": 90791530, "body": "Thank you, will test right now and come back with the answer :)"}, {"owner": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "edited": false, "score": 0, "creation_date": 1534705840, "post_id": 51919719, "comment_id": 90791685, "body": "Well, your code execute correctly, but there is no output in outfile.txt. In errfile.txt there is &#39;Capturing on em1&#39; . This means that tshark is called &amp; execute successfully but there is no output"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "edited": false, "score": 0, "creation_date": 1534726601, "post_id": 51919719, "comment_id": 90795534, "body": "that is because there is some error in interface <code>em1</code>, can you try a generic command like <code>exec.Command(&quot;tshark&quot;,&quot;-v&quot;)</code>?, if this gives out put in <code>outfile.txt</code>, then its some problem with the interface <code>em1</code>."}, {"owner": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "edited": false, "score": 0, "creation_date": 1534751217, "post_id": 51919719, "comment_id": 90801795, "body": "Well, i found the solution. Go needs relative path when execute external command, or at least in the case of tshark. So executing /usr/local/bin/tshark with arguments works fine. Thank you !"}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1534696355, "creation_date": 1534696355, "answer_id": 51919719, "question_id": 51918178, "link": "https://stackoverflow.com/questions/51918178/continuously-execute-tshark-from-go-script/51919719#51919719", "title": "Continuously execute tshark from Go script", "body": "<p>I have no idea of tshark, but here is a code that will work continously, you need <code>os.Interrupt</code>, and <code>select</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"os/exec\"\n    \"os/signal\"\n)\n\nfunc main() {\n    out := exec.Command(\"ping\", \"8.8.8.8\")\n    f1, _ := os.OpenFile(\"./outfile.txt\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0755)\n    f2, _ := os.OpenFile(\"./errfile.txt\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0755)\n    out.Stdout = f1\n    out.Stderr = f2\n    defer func() {\n        f1.Close()\n        f2.Close()\n    }()\n\n    err := out.Run()\n    if err != nil {\n        panic(err)\n    }\n\n    var ctrlcInt chan os.Signal\n    ctrlcInt = make(chan os.Signal, 1)\n    signal.Notify(ctrlcInt, os.Interrupt)\n    for {\n        select {\n        case &lt;-ctrlcInt:\n            break\n        default:\n            continue\n        }\n    }\n\n    return\n}\n</code></pre>\n\n<p>this code pings <code>8.8.8.8</code> and writes out put to <code>outfile.txt</code>, it will exit when you press <code>ctrl+c</code>. If there is error it will write to <code>errfile.txt</code>. You can tail the files and see the output. Hope this helps.</p>\n"}], "owner": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534696355, "creation_date": 1534685651, "last_edit_date": 1534695887, "question_id": 51918178, "link": "https://stackoverflow.com/questions/51918178/continuously-execute-tshark-from-go-script", "title": "Continuously execute tshark from Go script", "body": "<p>I am trying to execute tskarh from golang script using the example from\n    <a href=\"https://tutorialedge.net/golang/executing-system-commands-with-golang/\" rel=\"nofollow noreferrer\">https://tutorialedge.net/golang/executing-system-commands-with-golang/</a></p>\n\n<p>The script works fine, but i don't receive any kind of output</p>\n\n<p>What i want to get is the following:</p>\n\n<ol>\n<li>Continuously run the script, </li>\n<li>capture some packets, </li>\n<li>extract some fields values,</li>\n<li>and assign to variables</li>\n</ol>\n\n<p>Any help please ?</p>\n\n<p><a href=\"https://pastebin.com/PeAz7vh9\" rel=\"nofollow noreferrer\">https://pastebin.com/PeAz7vh9</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"runtime\"\n)\n\nfunc execute() {\n\n  // here we perform the pwd command.\n  // we can store the output of this in our out variable\n  // and catch any errors in err\n    out, err := exec.Command(\"tshark\", \"-i\", \"em1\").CombinedOutput()\n\n  // if there is an error with our execution\n  // handle it here\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n    }\n\n    fmt.Println(\"Command Successfully Executed\")\n  // as the out variable defined above is of type []byte we need to convert\n  // this to a string or else we will see garbage printed out in our console\n  // this is how we convert it to a string\n    output := string(out[:])\n\n  // once we have converted it to a string we can then output it.\n    fmt.Println(output)\n}\n\nfunc main() {\n\n    fmt.Println(\"Simple Shell\")\n    fmt.Println(\"---------------------\")\n\n    if runtime.GOOS == \"windows\" {\n        fmt.Println(\"Can't Execute this on a windows machine\")\n    } else {\n        execute()\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "go", "hash"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1534684535, "post_id": 51917943, "comment_id": 90785824, "body": "<code>sum</code> in your C code has type <code>int</code>, which is at least a 16-bit signed integer (but more likely to be a 32-bit signed integer). In your Go code, you made <code>sum</code> an 8-bit unsigned integer (<code>uint8</code>). Also, if that&#39;s your actual C code, you&#39;re using <code>strcat</code> with a string literal as the first parameter, meaning it cannot be modified, so whatever program is using that piece of code will likely halt execution."}, {"owner": {"reputation": 314, "user_id": 2294055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33b5e828c7fae5ee04d894882b3a77cb?s=128&d=identicon&r=PG", "display_name": "saimonsez", "link": "https://stackoverflow.com/users/2294055/saimonsez"}, "edited": false, "score": 0, "creation_date": 1534687548, "post_id": 51917943, "comment_id": 90786714, "body": "Excellent, please provide this as an answer. However, how can I convert that to bytes?      invalid operation: sum += msg[i] (mismatched types uint32 and byte)"}], "answers": [{"comments": [{"owner": {"reputation": 314, "user_id": 2294055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33b5e828c7fae5ee04d894882b3a77cb?s=128&d=identicon&r=PG", "display_name": "saimonsez", "link": "https://stackoverflow.com/users/2294055/saimonsez"}, "edited": false, "score": 0, "creation_date": 1534705216, "post_id": 51917967, "comment_id": 90791524, "body": "thx, that&#39;s to the point. Chrono&#39;s answer was more detailed but you are perfectly right"}], "tags": [], "owner": {"reputation": 3006, "user_id": 2412419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26107ee329a0b65638e60227d4052f7e?s=128&d=identicon&r=PG", "display_name": "faffaffaff", "link": "https://stackoverflow.com/users/2412419/faffaffaff"}, "is_accepted": false, "score": 4, "last_activity_date": 1534684420, "last_edit_date": 1534684420, "creation_date": 1534684170, "answer_id": 51917967, "question_id": 51917943, "link": "https://stackoverflow.com/questions/51917943/converting-a-simple-hash-function-from-c-to-go/51917967#51917967", "title": "Converting a simple hash function from c to go", "body": "<p>You need to make \"var sum\" an \"uint16\", otherwise it'll never go above 00FF.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": true, "score": 2, "last_activity_date": 1534689731, "last_edit_date": 1534689731, "creation_date": 1534688976, "answer_id": 51918647, "question_id": 51917943, "link": "https://stackoverflow.com/questions/51917943/converting-a-simple-hash-function-from-c-to-go/51918647#51918647", "title": "Converting a simple hash function from c to go", "body": "<p>In your C code, the type of <code>sum</code> is <code>int</code>, which is a signed integer type at least 16 bits in size<sup>1</sup>.</p>\n\n<p>However, the type of <code>sum</code> is <code>uint8</code> in your Go code, an unsigned integer type limited to 8 bits.</p>\n\n<p>Judging by your format string <code>%04X}</code>, you probably are wanting a 16-bit value.</p>\n\n<p>To fix the Go code, just change <code>uint8</code> to <code>int</code> and use <code>sum += int(msg[i])</code> to make the compiler happy.  If you want to keep the value of <code>sum</code> strictly 16-bit, you could use <code>uint16</code> instead and <code>sum += uint16(msg[i])</code>.</p>\n\n<p>If you're wondering why you need to wrap <code>msg[i]</code> in <code>uint16(...)</code>, it's because you're converting the value to a different type.  C has \"integer promotion\" rules that automatically convert a value that has a width less than <code>int</code> to a value of type <code>int</code>.  Go, however, has no such rules and simply refuses to compile, stating that the types are incompatible.</p>\n\n<hr>\n\n<p>By the way, you could simply do this in your Go code due to its automatic memory management:</p>\n\n<pre><code>req := msg + fmt.Sprintf(\"%04X}\", sum)\nfmt.Println(req)\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>s := fmt.Sprintf(\"%04X}\", sum)\nfmt.Println(msg + sum)\n</code></pre>\n\n<p>Nothing wrong with your current approach; it's just extra verbose.</p>\n\n<hr>\n\n<p><sup>1</sup> <code>int</code> is required to be at least 16-bit in C and at least 32-bit in Go, but it is commonly 32-bit these days in both languages.  You should be aware, however, that it could be 64-bit on some current systems and could very well be 64-bit by default at some point in the future for either language; they're not required to keep their data type sizes synchronized.  You should keep this in mind when adding the values in <code>msg</code> to ensure the value of <code>sum</code> is 16-bit (or just use <code>uint16</code>).</p>\n"}], "owner": {"reputation": 314, "user_id": 2294055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33b5e828c7fae5ee04d894882b3a77cb?s=128&d=identicon&r=PG", "display_name": "saimonsez", "link": "https://stackoverflow.com/users/2294055/saimonsez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 51918647, "answer_count": 2, "score": 1, "last_activity_date": 1534689731, "creation_date": 1534684056, "question_id": 51917943, "link": "https://stackoverflow.com/questions/51917943/converting-a-simple-hash-function-from-c-to-go", "title": "Converting a simple hash function from c to go", "body": "<p>I'm trying to to convert a simple hash-function from C to Go.</p>\n\n<p>What is the difference between these C and Go scripts and how do I fix the Go code?</p>\n\n<p>C -> Results in {FB;01;4C|64:KDY;KMT;KYR;KT0;TKK;PAC;UD01;UD02;UD03;ID01;ID02;ID03;SYS|124A}</p>\n\n<pre><code>int   sum;\nchar* pChar;\nchar  s[8];\n\nmsg = \"{FB;01;4C|64:KDY;KMT;KYR;KT0;TKK;PAC;UD01;UD02;UD03;ID01;ID02;ID03;SYS|\"\nsum = 0;\npChar = msg + 1; // sum starts after the opening {\nwhile (*pChar != 0) {\n  sum += (int)*pChar++;\n}\nsprintf(s, \"%04X}\", sum);\nstrcat(msg, s);\n</code></pre>\n\n<p>Go -> Results in {FB;01;4C|64:KDY;KMT;KYR;KT0;TKK;PAC;UD01;UD02;UD03;ID01;ID02;ID03;SYS|004A}</p>\n\n<pre><code>msg := \"{FB;01;4C|64:KDY;KMT;KYR;KT0;TKK;PAC;UD01;UD02;UD03;ID01;ID02;ID03;SYS|\"\nvar sum uint8\nfor i := 1; i &lt; len(msg); i++ {\n    sum += msg[i]\n}\ns := fmt.Sprintf(\"%04X}\", sum)\nreq := strings.Join([]string{msg, s}, \"\")\nfmt.Println(req)\n</code></pre>\n"}, {"tags": ["go", "fasthttp"], "comments": [{"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1534686094, "post_id": 51917809, "comment_id": 90786232, "body": "PING/PONG is a good technique!!"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1534686942, "post_id": 51917809, "comment_id": 90786515, "body": "I don&#39;t try! Try changes MaxKeepaliveDuration. KeepAlive is a socket mechanism to check if connect is live! (See more in <a href=\"https://github.com/valyala/fasthttp/search?q=keepalive&amp;unscoped_q=keepalive\" rel=\"nofollow noreferrer\">github.com/valyala/fasthttp/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/1480236/does-a-tcp-socket-connection-have-a-keep-alive\" title=\"does a tcp socket connection have a keep alive\">stackoverflow.com/questions/1480236/&hellip;</a>)"}, {"owner": {"reputation": 75, "user_id": 1258992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88c9c7a22588d15431a4306a8ed1b0d0?s=128&d=identicon&r=PG", "display_name": "Denis Karpov", "link": "https://stackoverflow.com/users/1258992/denis-karpov"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1534698546, "post_id": 51917809, "comment_id": 90789753, "body": "@AristofanioGarcia thank you. AFAIK keep-alive http header is for reusing same TCP connection for multiple HTTP requests. However, I&#39;m your ping/pong suggestion will definitely work, thank you! I&#39;ve found more on http connection close here: <a href=\"https://www.safaribooksonline.com/library/view/http-the-definitive/1565925092/ch04s07.html\" rel=\"nofollow noreferrer\">safaribooksonline.com/library/view/http-the-definitive/&hellip;</a>"}], "owner": {"reputation": 75, "user_id": 1258992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88c9c7a22588d15431a4306a8ed1b0d0?s=128&d=identicon&r=PG", "display_name": "Denis Karpov", "link": "https://stackoverflow.com/users/1258992/denis-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1582281235, "creation_date": 1534682799, "last_edit_date": 1582281235, "question_id": 51917809, "link": "https://stackoverflow.com/questions/51917809/how-to-handle-closure-event-for-server-push-http-connections", "title": "How to handle closure event for &quot;server push&quot; http connections", "body": "<p>The situation is: a server has many open connections with custom BodyStreamWriter (for server push), and all the clients close the connections on their side. I see two issues:</p>\n\n<ol>\n<li>fasthttp seems keeping all the related internal objects in memory</li>\n<li>BodyStreamWriter is not aware of the closure and does not dispose all the related objects/resources too</li>\n</ol>\n\n<p>Is there any way to prevent the issues above? Thanks!</p>\n"}]