[{"tags": ["object", "inheritance", "struct", "go"], "answers": [{"comments": [{"owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "edited": false, "score": 0, "creation_date": 1437006452, "post_id": 31442988, "comment_id": 50855918, "body": "Essentially, there will be many structures that will have Foo as an anonymous field to have Bar string. Also, all of those structures will have their own BarTheFoo() function, but each of them can be different. However, FooBar() function is identical everywhere - it will always call BarTheFoo() first, then return Bar. I want a way to enforce the conformity on all structures that have the Foo as the anonymous field."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1437003093, "creation_date": 1437003093, "answer_id": 31442988, "question_id": 31442849, "link": "https://stackoverflow.com/questions/31442849/is-it-possible-to-specify-both-a-structure-with-variables-and-an-interface-at-th/31442988#31442988", "title": "Is it possible to specify both a structure with variables and an interface at the same time in golang?", "body": "<p>Yeah but in order to understand it fully I think you'll need to depart from those notions of inheritance as they don't exist in Go. The nearest thing you can do is 'embed' <code>Bar</code> in all your types (<code>Foo</code> included).</p>\n\n<p>This feature acts somewhat like a blend of inheritance and composition. While the <code>Foo</code> type will technically be 'composed' of a <code>Bar</code> type (among other fields), the methods on the <code>Bar</code> type are in a sense promoted so that they can be invoked directly from <code>Foo</code>. It looks like this;</p>\n\n<pre><code>type Foo struct {\n    Bar\n}\n\ntype Bar struct {\n    // pretend this type is useful\n}\n\nfunc (b Bar)FooBar() string {\n    // pretend this is useful\n    return b.ThatProperty\n}\n</code></pre>\n\n<p>Then in some other context you can do;</p>\n\n<pre><code>f := &amp;Foo{}\nf.Bar()\n</code></pre>\n\n<p>I'm not sure that is exactly what you want to do and I can edit with more guidance however I can't answer your question specifically because what you're asking doesn't exist in Go.</p>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437003093, "creation_date": 1437002256, "question_id": 31442849, "link": "https://stackoverflow.com/questions/31442849/is-it-possible-to-specify-both-a-structure-with-variables-and-an-interface-at-th", "title": "Is it possible to specify both a structure with variables and an interface at the same time in golang?", "body": "<p>I'm currently working on cleaning up some golang code. The code deals with a lot of structures that behave in a similar fashion and share some similar data fields. I'm wondering whether it's possible to specify a common structure and interface at the same time? Something like:</p>\n\n<pre><code>type Foo struct {\n    Bar string\n    BarTheFoo() string\n}\n\nfunc (f Foo)FooBar() string {\n    BarTheFoo()\n    return f.Bar\n}\n</code></pre>\n\n<p>Meaning that any other structure inheriting from Foo will have the Bar variable in it, but that it should also implement its own BarTheFoo() function. Knowing that all the Foo derivatives will have BarTheFoo(), I would like to use it in a function I know will look the same for every Foo derivative.</p>\n\n<p>Is something like this possible in Go?</p>\n"}, {"tags": ["python", "google-app-engine", "go", "atom-editor"], "comments": [{"owner": {"reputation": 1889, "user_id": 1477364, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ded6e69660b0493583d054a8861fdefb?s=128&d=identicon&r=PG&f=1", "display_name": "Travis", "link": "https://stackoverflow.com/users/1477364/travis"}, "edited": false, "score": 0, "creation_date": 1436998054, "post_id": 31441833, "comment_id": 50853210, "body": "Are you using version control? Can you roll back?"}, {"owner": {"reputation": 21993, "user_id": 702275, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/25411d307fa0ce0f741e7eb1b28d2cd9?s=128&d=identicon&r=PG", "display_name": "tim peterson", "link": "https://stackoverflow.com/users/702275/tim-peterson"}, "reply_to_user": {"reputation": 1889, "user_id": 1477364, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ded6e69660b0493583d054a8861fdefb?s=128&d=identicon&r=PG&f=1", "display_name": "Travis", "link": "https://stackoverflow.com/users/1477364/travis"}, "edited": false, "score": 0, "creation_date": 1436998545, "post_id": 31441833, "comment_id": 50853397, "body": "I am using version control on my app but not the whole app engine platform and the problem seems with the platform"}, {"owner": {"reputation": 1889, "user_id": 1477364, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ded6e69660b0493583d054a8861fdefb?s=128&d=identicon&r=PG&f=1", "display_name": "Travis", "link": "https://stackoverflow.com/users/1477364/travis"}, "edited": false, "score": 2, "creation_date": 1437001408, "post_id": 31441833, "comment_id": 50854424, "body": "If it were me, I&#39;d reinstall the SDK if that&#39;s what&#39;s been mangled. I would have less than 100% confidence in a repaired SDK even if it appeared to work fine."}, {"owner": {"reputation": 1620, "user_id": 4316235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b46c2d21f13517cd4460f4513815fd46?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Deskins", "link": "https://stackoverflow.com/users/4316235/jeff-deskins"}, "edited": false, "score": 0, "creation_date": 1437008288, "post_id": 31441833, "comment_id": 50856307, "body": "Another thing to consider if you use the Google Cloud SDK.  Starting with release 0.9.68, it will no longer be distributing the stand alone App Engine SDK, which includes dev_appserver.py.  You can continue to use those scripts by installing the stand-alone App Engine SDK: <a href=\"https://cloud.google.com/appengine/downloads\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/downloads</a>."}], "owner": {"reputation": 21993, "user_id": 702275, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/25411d307fa0ce0f741e7eb1b28d2cd9?s=128&d=identicon&r=PG", "display_name": "tim peterson", "link": "https://stackoverflow.com/users/702275/tim-peterson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 241, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436997261, "creation_date": 1436997261, "question_id": 31441833, "link": "https://stackoverflow.com/questions/31441833/google-app-engine-unable-to-find-dev-appserver-py", "title": "Google App Engine unable to find dev_appserver.py", "body": "<p>I started using <a href=\"https://github.com/atom/find-and-replace/issues/189\" rel=\"nofollow\">Atom</a> editor and inadvertently renamed everything in my google app engine folder from \"appengine\" to \"google.golang.org\". I switched it all back even replacing the \"go_appengine\" folder but I'm still getting the following error when I run my app:</p>\n\n<pre><code>goapp serve: unable to find dev_appserver.py\n</code></pre>\n\n<p>Thoughts?</p>\n"}, {"tags": ["json", "go", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1437071984, "last_edit_date": 1437071984, "creation_date": 1436984090, "answer_id": 31438053, "question_id": 31437749, "link": "https://stackoverflow.com/questions/31437749/json-marshaling-producing-unexpected-results/31438053#31438053", "title": "JSON Marshaling producing unexpected results", "body": "<p>Your code works fine, you just have one little bug.</p>\n\n<pre><code>// MarshalJSON returns the *j as the JSON encoding of j.\nfunc (j JsonText) MarshalJSON() ([]byte, error) {\n    return j, nil\n} // note i modified this so the receiver isn't a pointer\n</code></pre>\n\n<p>Your code didn't work because this is your definition of your datatype that wraps JsonText;</p>\n\n<pre><code>// Example struct I want to marshal and unmarshal\ntype TestData struct {\n    Field1 JsonText `json:\"field_1\"`\n}\n</code></pre>\n\n<p>But only the <code>*JsonText</code> type  implements the marshaler interface in your code. So you can change the types in either place ( I did in the <code>MarshalJSON()</code> ) but they need to be consistent.</p>\n\n<p>In the playground; <a href=\"http://play.golang.org/p/NI_z3bQx7a\" rel=\"nofollow\">http://play.golang.org/p/NI_z3bQx7a</a></p>\n"}], "owner": {"reputation": 1993, "user_id": 623949, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cf441bdd92dabf1b772104901c78cf99?s=128&d=identicon&r=PG", "display_name": "tgrosinger", "link": "https://stackoverflow.com/users/623949/tgrosinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 31438053, "answer_count": 1, "score": 0, "last_activity_date": 1437074219, "creation_date": 1436983191, "last_edit_date": 1437074219, "question_id": 31437749, "link": "https://stackoverflow.com/questions/31437749/json-marshaling-producing-unexpected-results", "title": "JSON Marshaling producing unexpected results", "body": "<p>Here is a Go Playground demonstrating my problem: <a href=\"http://play.golang.org/p/2fq3Fg7rPg\" rel=\"nofollow\">http://play.golang.org/p/2fq3Fg7rPg</a></p>\n\n<p>Essentially, I am trying to JSON marshal a struct containing a custom type wrapping <code>json.RawMessage</code>. When using <code>CustomType.MarshalJSON()</code> I get the expected results, but just calling <code>json.Marshal</code> on my full struct does not work as expected. See the playground link for a concrete example.</p>\n\n<p>What is causing this difference?</p>\n\n<p>Is there a way to have <code>json.Marshal</code> work as I expect it to?</p>\n"}, {"tags": ["go", "time-series", "store", "leveldb"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436976903, "post_id": 31435702, "comment_id": 50841414, "body": "You&#39;re looking for a different StackExchange for this question, clearly falls under the &#39;opinion based&#39; category which seems to offend round these parts ;p"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436978912, "post_id": 31435702, "comment_id": 50842576, "body": "as evanmcdonnal said, this isn&#39;t the place for library recommendations, <i>but</i>... you could always go back to the tried-and-true constant-space time-series db: <code>rrd</code>. MongoDB also has &quot;Capped collections&quot; which support high volume inserts with fixed storage size."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1436982004, "post_id": 31435702, "comment_id": 50844431, "body": "Part of the problem is that I don&#39;t need constant space, I need a window of time. How much data shows up in that window can vary drastically.   I don&#39;t want a library recommendation as much as I want a data-structure recommendation. If it was in memory I&#39;d use a circular buffer of buckets. I want something like that, but on disk."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436985188, "post_id": 31435702, "comment_id": 50846328, "body": "To me it sounds like a use for kafka. At least, in my limited experience working in data collection, I&#39;ve seen kafka used for this type of thing. I believe the main features your want are inherit in it&#39;s design."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1436985328, "post_id": 31435702, "comment_id": 50846399, "body": "That&#39;s a little more complex than what can reduced to a &quot;data structure&quot;, but if this is in-order, write-once data, something as simple as a log file per bucket could suffice. You might want to look at <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow noreferrer\">boltdb</a> where you can store and delete in buckets (bonus, it&#39;s a Go library)."}, {"owner": {"reputation": 506, "user_id": 3835333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c838f6bc14ea3297f3305aca42f8bf?s=128&d=identicon&r=PG&f=1", "display_name": "SkyeC", "link": "https://stackoverflow.com/users/3835333/skyec"}, "edited": false, "score": 1, "creation_date": 1437062070, "post_id": 31435702, "comment_id": 50884861, "body": "+1 for what JimB said. Use files, or directories if too many files, to slice up your time series. Then &#39;rm -fr&#39; the expired range."}], "answers": [{"tags": [], "owner": {"reputation": 11978, "user_id": 774651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d174682a9c2469488ac0cd91f0253215?s=128&d=identicon&r=PG&f=1", "display_name": "Lol4t0", "link": "https://stackoverflow.com/users/774651/lol4t0"}, "is_accepted": false, "score": 2, "last_activity_date": 1437759200, "creation_date": 1437759200, "answer_id": 31616506, "question_id": 31435702, "link": "https://stackoverflow.com/questions/31435702/storing-sliding-window-of-time-series-data-on-disk/31616506#31616506", "title": "Storing sliding window of time-series data on disk", "body": "<p>The simplest solution is just always have 2 leveldb's  - for the current day and the previous one. And you write to the current only.</p>\n\n<p>And once a day you just </p>\n\n<pre><code>delete(previous)\nprevious := current\ncurrent := new()\n</code></pre>\n\n<p>You may then save almost 2 days instead of one, but rotation is really easy.</p>\n"}], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437759200, "creation_date": 1436976740, "question_id": 31435702, "link": "https://stackoverflow.com/questions/31435702/storing-sliding-window-of-time-series-data-on-disk", "title": "Storing sliding window of time-series data on disk", "body": "<p>I've written a server which consumes a live stream of chronologically ordered events (time-series) and maintains a sliding window (24h) of the data. It only supports one type of query:</p>\n\n<pre><code>get N seconds of events starting at timestamp T\n</code></pre>\n\n<p>I'm currently using <a href=\"https://github.com/google/leveldb\" rel=\"nofollow\">leveldb</a> with unix timestamps as the keys. This works alright but, since leveldb is a <a href=\"https://en.wikipedia.org/wiki/Log-structured_merge-tree\" rel=\"nofollow\">LSM</a>, the deletes are expensive (tombstones).</p>\n\n<p>Can anyone suggest a better solution/datasore for this use case?</p>\n\n<ul>\n<li>The data is too big to store in memory</li>\n<li>The server is written in Go</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436979514, "post_id": 31435617, "comment_id": 50842961, "body": "Not sure what exactly you&#39;re trying to do. The <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">spec</a> is pretty clear about how slices can be accessed/indexed. Anything beyond that needs <a href=\"https://play.golang.org/p/wTaFfWiF4i\" rel=\"nofollow noreferrer\">to be coded yourself</a>."}], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 2362699, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/72ff3403c968926e53a05eb04f35a357?s=128&d=identicon&r=PG", "display_name": "user2362699", "link": "https://stackoverflow.com/users/2362699/user2362699"}, "edited": false, "score": 0, "creation_date": 1436979794, "post_id": 31435692, "comment_id": 50843114, "body": "Excellent. Yep, this is what I wanted. Thanks so much!!"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 478, "user_id": 2362699, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/72ff3403c968926e53a05eb04f35a357?s=128&d=identicon&r=PG", "display_name": "user2362699", "link": "https://stackoverflow.com/users/2362699/user2362699"}, "edited": false, "score": 0, "creation_date": 1436984178, "post_id": 31435692, "comment_id": 50845749, "body": "@user2362699 please accept the answer if it solved your problem."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1436976708, "creation_date": 1436976708, "answer_id": 31435692, "question_id": 31435617, "link": "https://stackoverflow.com/questions/31435617/how-to-print-out-non-contiguous-sections-of-the-slice-in-go/31435692#31435692", "title": "How to print out non-contiguous sections of the slice in Go?", "body": "<p>You can index into the slice, you just are doing it wrong.</p>\n\n<pre><code>fmt.Printf(\"%s %s\\n\", words[0], words[5])\n</code></pre>\n\n<p>Your syntax for indexing didn't work because the second variable was just the index stuff without <code>words</code>. Additionally your format string was wrong, a single <code>%s</code> which means Printf is only expecting a single argument after that. Gotta have one formatter per arg.</p>\n"}], "owner": {"reputation": 478, "user_id": 2362699, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/72ff3403c968926e53a05eb04f35a357?s=128&d=identicon&r=PG", "display_name": "user2362699", "link": "https://stackoverflow.com/users/2362699/user2362699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1436976708, "creation_date": 1436976483, "question_id": 31435617, "link": "https://stackoverflow.com/questions/31435617/how-to-print-out-non-contiguous-sections-of-the-slice-in-go", "title": "How to print out non-contiguous sections of the slice in Go?", "body": "<p>Wondering if there is a way to print out non contiguous portions of slice in Gol? </p>\n\n<p><strong>Example:</strong></p>\n\n<blockquote>\n  <p>words := []string{\"Mary\",\"had\",\"a\",\"little\",\"lamb\"}</p>\n</blockquote>\n\n<p>and I want to print out \"<strong>Mary</strong>\" and \"<strong>lamb\"</strong> from the slice?</p>\n\n<p>Something along the lines of:</p>\n\n<blockquote>\n  <p>fmt.Printf(\"%s\\n\", words[0],[5])</p>\n</blockquote>\n\n<p>...which obviously this won't work... Is there a way ? :(</p>\n\n<p>Thanks a lot!!</p>\n"}, {"tags": ["go", "compression", "codec"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436974242, "post_id": 31434554, "comment_id": 50839510, "body": "In go you can just implement whatever <code>io.Writer</code> you want, and keep an internal state of the byte buffer, and manage it however you want."}, {"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436974676, "post_id": 31434554, "comment_id": 50839832, "body": "Yes, thank you. But the point isn&#39;t actually about go. I&#39;d had this problem in every other language where a byte is the smallest unit to write information to a stream. The point of this question is about how to write &quot;single bits&quot; more or less efficiently."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436975612, "post_id": 31434554, "comment_id": 50840536, "body": "Go doesn&#39;t do anything different from other languages, this is mostly an architecture restraint. Maybe you compress larger chunks more efficiently, e.g. 8 groups of 12bytes under your scheme would compress to 7bytes."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436975766, "post_id": 31434554, "comment_id": 50840650, "body": "I don&#39;t understand though if you want to be bound by a standard stream interface or not, because you can always create your own that works on a bit level and not byte level."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436976590, "post_id": 31434554, "comment_id": 50841204, "body": "The problem is obviously that you&#39;re encoding into a 7 bit word when data is base 2... You&#39;re either going to be wasting 12.5% of the space or you&#39;re going to have to do a bitwise operation everytime you want to read a value. The obvious solution is to not use a compression algorithm incongruous with the storage system."}, {"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437024070, "post_id": 31434554, "comment_id": 50860479, "body": "@evanmcdonnal: I agree. Tell that ITU-T which invented G.711 ;-) And it&#39;s rather about network than storage - which doesn&#39;t do any big difference."}], "answers": [{"tags": [], "owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "is_accepted": true, "score": 0, "last_activity_date": 1436978346, "last_edit_date": 1436978346, "creation_date": 1436977908, "answer_id": 31436063, "question_id": 31434554, "link": "https://stackoverflow.com/questions/31434554/efficiently-write-compressed-values-to-stream/31436063#31436063", "title": "Efficiently write compressed values to stream", "body": "<p>Use binary shift operators to load seven bits at a time into a bit buffer, and whenever the bit buffer has eight bits, output that.  At the end, if there are any bits leftover, output a final byte with what's in the buffer.</p>\n\n<p>So something like (don't know Go, but this should be close):</p>\n\n<pre><code>bits = 0\nbitbuf = 0\n... some loop ...\n    ...make your seven bits ...\n    bitbuf |= sevenbits &lt;&lt; bits\n    bits += 7\n    if bits &gt;= 8 {\n        output(bitbuf &amp; 0xff)\n        bitbuf &gt;&gt;= 8;\n        bits -= 8;\n    }\n...\nif bits &gt; 0 {\n    output(bitbuf)\n}\n</code></pre>\n"}], "owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 31436063, "answer_count": 1, "score": 0, "last_activity_date": 1436978346, "creation_date": 1436973798, "last_edit_date": 1436974718, "question_id": 31434554, "link": "https://stackoverflow.com/questions/31434554/efficiently-write-compressed-values-to-stream", "title": "Efficiently write compressed values to stream", "body": "<p>Currently, I'm trying to translate some compression algorithm from existing C code.</p>\n\n<p>Encoding and decoding doesn't appear difficult to me. It's more about the serialization to and from a stream (be it a file or a socket).</p>\n\n<p>The input is 12 bit and the compressed output is 7 bits. But writing something to a stream always involves writing entire 8 bits.</p>\n\n<p>So as there is always 1 bit remaining for each value, does that mean I would have to buffer 7 bytes just to be able to write 8 values? Which would give the following bytes (whereas all 1s belong to the first value, all 2's to the second one, etc.)</p>\n\n<pre><code>11111112\n22222233\n33333444\n44445555\n55566666\n66777777\n78888888\n</code></pre>\n\n<p>The real codec or the language being used both don't really matter (actually: the codec is G.711 and the language is Golang). So maybe the <code>go</code>-Tag is inappropriate.</p>\n\n<p>Any clue on this?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1436971171, "creation_date": 1436971171, "answer_id": 31433470, "question_id": 31431719, "link": "https://stackoverflow.com/questions/31431719/golang-xml-attributes-from-another-struct/31433470#31433470", "title": "Golang: XML attributes from another struct", "body": "<p><a href=\"http://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow\">Embed</a> the type with common attrs into your other types.</p>\n\n<pre><code>type AuthData struct {\n    BuyerId  string `xml:\"BuyerId,attr\"`\n    UserId   string `xml:\"UserId,attr\"`\n    Language string `xml:\"Language,attr\"`\n}\n\ntype MyRequest struct {\n    XMLName  xml.Name `xml:\"MyRequest\"`\n    AuthData // Embedding.\n    Action   struct{} `xml:\"Action\"`\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/u23HuwYgq2\" rel=\"nofollow\">http://play.golang.org/p/u23HuwYgq2</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 3214935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d7bc0986530f8a5b13b6263355d32ac?s=128&d=identicon&r=PG&f=1", "display_name": "user3214935", "link": "https://stackoverflow.com/users/3214935/user3214935"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 1, "accepted_answer_id": 31433470, "answer_count": 1, "score": 0, "last_activity_date": 1437147984, "creation_date": 1436966791, "last_edit_date": 1437147984, "question_id": 31431719, "link": "https://stackoverflow.com/questions/31431719/golang-xml-attributes-from-another-struct", "title": "Golang: XML attributes from another struct", "body": "<p>How can I add an XML element attribute from another struct?</p>\n\n<p>For example: <a href=\"http://play.golang.org/p/E3K1KYnRH8\" rel=\"nofollow\">http://play.golang.org/p/E3K1KYnRH8</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "edited": false, "score": 0, "creation_date": 1436952332, "post_id": 31426337, "comment_id": 50824016, "body": "Now I see it!! My eyes were seeing p[i] | p[j] = p[j] | p[i] and I was like &quot;what is the point of assigning p[j] to p[j]&quot;. Thank you for pointing out the TUPLE assigment."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1436953749, "last_edit_date": 1436953749, "creation_date": 1436951979, "answer_id": 31426337, "question_id": 31426232, "link": "https://stackoverflow.com/questions/31426232/golang-sort-swap-method/31426337#31426337", "title": "Golang sort.Swap Method", "body": "<p>It does what its name says: it swaps the i<sup>th</sup> and j<sup>th</sup> elements.</p>\n\n<p>It is an <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow\">assignment</a>, more specifically a tuple assignment:</p>\n\n<pre><code>p[i], p[j] = p[j], p[i]\n</code></pre>\n\n<p>It assigns values to <code>p[i]</code> and <code>p[j]</code>, and the values that are assigned to them in order are <code>p[j]</code> and <code>p[i]</code>.</p>\n\n<blockquote>\n  <p>The assignment proceeds in two phases. First, the operands of <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow\">index expressions</a> and <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow\">pointer indirections</a> (including implicit pointer indirections in <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow\">selectors</a>) on the left and the expressions on the right are all <a href=\"https://golang.org/ref/spec#Order_of_evaluation\" rel=\"nofollow\">evaluated in the usual order</a>. Second, the assignments are carried out in left-to-right order.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 390, "user_id": 4401682, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a5696cfc9087ea6003bada234cb2c8cb?s=128&d=identicon&r=PG&f=1", "display_name": "Vutuz", "link": "https://stackoverflow.com/users/4401682/vutuz"}, "is_accepted": false, "score": 0, "last_activity_date": 1466670105, "creation_date": 1466670105, "answer_id": 37985958, "question_id": 31426232, "link": "https://stackoverflow.com/questions/31426232/golang-sort-swap-method/37985958#37985958", "title": "Golang sort.Swap Method", "body": "<p>here in golang, we dont need a tmp variable. \nIt will assign directly with line\np[i], p[j] = p[j], p[i]</p>\n\n<p>it is one of miracles in golang\nEnjoy!</p>\n"}], "owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 31426337, "answer_count": 2, "score": 0, "last_activity_date": 1466670105, "creation_date": 1436951745, "question_id": 31426232, "link": "https://stackoverflow.com/questions/31426232/golang-sort-swap-method", "title": "Golang sort.Swap Method", "body": "<p>I am fairly new to Golang, although I have already written some lines of code. I was exploring the sorting options when I found this<sup><a href=\"https://golang.org/src/sort/sort.go?s=6435:6470#L252\" rel=\"nofollow\">(src)</a></sup>:</p>\n\n<pre><code>func (p StringSlice) Swap(i, j int)      { p[i], p[j] = p[j], p[i] }\n</code></pre>\n\n<p>I have no clue what is it going on there. Could someone explain to me what <code>p[i], p[j] = p[j], p[i]</code> is doing?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436972158, "post_id": 31423294, "comment_id": 50838025, "body": "stdout and stderr from what?"}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1436965082, "creation_date": 1436965082, "answer_id": 31431085, "question_id": 31423294, "link": "https://stackoverflow.com/questions/31423294/what-is-the-best-way-to-redirect-stdout-stderr-to-a-function-that-in-turn-format/31431085#31431085", "title": "What is the best way to redirect stdout/stderr to a function that in turn formats the message and prints it to the console?", "body": "<p>You can use <a href=\"https://golang.org/pkg/os/exec/#Cmd.CombinedOutput\" rel=\"nofollow\"><code>cmd.CombinedOutput</code></a> or <a href=\"https://golang.org/pkg/os/exec/#Cmd.Output\" rel=\"nofollow\"><code>cmd.Output</code></a>:</p>\n\n<pre><code>out, err := exec.Command(\"ls\", \"-al\").CombinedOutput()\n//or\nout, err := exec.Command(\"ls\", \"-al\").Output()\n</code></pre>\n"}], "owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436965082, "creation_date": 1436942865, "question_id": 31423294, "link": "https://stackoverflow.com/questions/31423294/what-is-the-best-way-to-redirect-stdout-stderr-to-a-function-that-in-turn-format", "title": "What is the best way to redirect stdout/stderr to a function that in turn formats the message and prints it to the console?", "body": "<p>I want to capture all stdout and stderr messages, and parse the data and print them in my desired format.  How do I do this in go?</p>\n"}, {"tags": ["json", "go", "neo4j", "neoism"], "answers": [{"comments": [{"owner": {"reputation": 4448, "user_id": 1354978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e04efd06db0188e49ce01b806e599717?s=128&d=identicon&r=PG", "display_name": "earlonrails", "link": "https://stackoverflow.com/users/1354978/earlonrails"}, "edited": false, "score": 0, "creation_date": 1436972668, "post_id": 31419930, "comment_id": 50838390, "body": "That is what I would like to do, but right now it is returning the struct inside the GetAccounts function:        res := []struct {         UserId string <code>json:&quot;account.UserId&quot;</code>         FirstName  string <code>json:&quot;account.firstName&quot;</code>         LastName  string <code>json:&quot;account.lastName&quot;</code>     }{}  Maybe there is a way to use the struct above the function though?"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1436923091, "creation_date": 1436923091, "answer_id": 31419930, "question_id": 31419861, "link": "https://stackoverflow.com/questions/31419861/how-can-i-clean-up-this-return-type-for-neoism-go-lang/31419930#31419930", "title": "How can I clean up this return type for neoism go-lang?", "body": "<p>Can getAccounts return an array of account pointers?</p>\n\n<p><code>func GetAccounts() []*Account {}</code></p>\n"}, {"tags": [], "owner": {"reputation": 4448, "user_id": 1354978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e04efd06db0188e49ce01b806e599717?s=128&d=identicon&r=PG", "display_name": "earlonrails", "link": "https://stackoverflow.com/users/1354978/earlonrails"}, "is_accepted": true, "score": 0, "last_activity_date": 1436976382, "creation_date": 1436976382, "answer_id": 31435588, "question_id": 31419861, "link": "https://stackoverflow.com/questions/31419861/how-can-i-clean-up-this-return-type-for-neoism-go-lang/31435588#31435588", "title": "How can I clean up this return type for neoism go-lang?", "body": "<pre><code>package models\n\nimport (\n  \"errors\"\n  \"strconv\"\n  \"time\"\n  // \"fmt\"\n\n  \"github.com/jmcvetta/neoism\"\n)\n\nvar (\n  Accounts map[string]*Account\n)\n\nvar (\n  db *neoism.Database\n)\n\nfunc panicErr(err error) {\n  if err != nil {\n    panic(err)\n  }\n}\n\ntype Account struct {\n  UserId   string `json:\"account.UserId\"`\n  FirstName     string `json:\"account.firstName\"`\n  LastName      string `json:\"account.lastName\"`\n}\n\nfunc init() {\n  var err error\n  db, err = neoism.Connect(\"http://neo4j:password@localhost:7474/db/data\")\n  if err != nil {\n    panic(err)\n  }\n}\n\n// map[lastName:PATRUS UserId:7f7014f9-bd59-4739-8e1b-5aebfa00f4c5 firstName:LARISSA]\n\nfunc GetAccounts() []Account {\n  stmt := `\n    MATCH (account:Account) RETURN account.UserId, account.firstName, account.lastName\n  `\n\n  var accounts []Account\n\n  // construct query\n  cq := neoism.CypherQuery{\n    Statement:  stmt,\n    Result:     &amp;accounts,\n  }\n\n  // execute query\n  err := db.Cypher(&amp;cq)\n  panicErr(err)\n\n  return accounts\n}\n</code></pre>\n\n<p>need to use the Account struct above the function and then make a variable inside and use pointer to var for the response of neoism db.</p>\n"}], "owner": {"reputation": 4448, "user_id": 1354978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e04efd06db0188e49ce01b806e599717?s=128&d=identicon&r=PG", "display_name": "earlonrails", "link": "https://stackoverflow.com/users/1354978/earlonrails"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 31435588, "answer_count": 2, "score": 0, "last_activity_date": 1436976382, "creation_date": 1436922611, "question_id": 31419861, "link": "https://stackoverflow.com/questions/31419861/how-can-i-clean-up-this-return-type-for-neoism-go-lang", "title": "How can I clean up this return type for neoism go-lang?", "body": "<p>This model I am trying to make with neoism is working now but I can't figure out how to make the return type shorter and or cleaner looking.\nThere must be a way to make this:\n <code>[]struct { UserId string \"json:\\\"account.UserId\\\"\"; FirstName string \"json:\\\"account.firstName\\\"\"; LastName string \"json:\\\"account.lastName\\\"\" }</code></p>\n\n<p>Into: \n<code>[]Account</code> or something</p>\n\n<pre><code>package models\n\nimport (\n  \"errors\"\n  \"strconv\"\n  \"time\"\n  // \"fmt\"\n\n  \"github.com/jmcvetta/neoism\"\n)\n\nvar (\n  Accounts map[string]*Account\n)\n\nvar (\n  db *neoism.Database\n)\n\nfunc panicErr(err error) {\n  if err != nil {\n    panic(err)\n  }\n}\n\ntype Account struct {\n  UserId   string `json:\"account.UserId\"`\n  FirstName     string `json:\"account.firstName\"`\n  LastName      string `json:\"account.lastName\"`\n}\n\nfunc init() {\n  var err error\n  db, err = neoism.Connect(\"http://neo4j:password@localhost:7474/db/data\")\n  if err != nil {\n    panic(err)\n  }\n}\n\n// map[lastName:PATRUS UserId:7f7014f9-bd59-4739-8e1b-5aebfa00f4c5 firstName:LARISSA]\n\nfunc GetAccounts() []struct { UserId string \"json:\\\"account.UserId\\\"\"; FirstName string \"json:\\\"account.firstName\\\"\"; LastName string \"json:\\\"account.lastName\\\"\" } {\n  stmt := `\n    MATCH (account:Account) RETURN account.UserId, account.firstName, account.lastName\n  `\n\n  res := []struct {\n    UserId string `json:\"account.UserId\"`\n    FirstName  string `json:\"account.firstName\"`\n    LastName  string `json:\"account.lastName\"`\n  }{}\n\n  // construct query\n  cq := neoism.CypherQuery{\n    Statement:  stmt,\n    Result:     &amp;res,\n  }\n\n  // execute query\n  err := db.Cypher(&amp;cq)\n  panicErr(err)\n\n  return res\n}\n</code></pre>\n\n<p>Here is another copy:\n<a href=\"http://play.golang.org/p/14gzc0a_89\" rel=\"nofollow\">http://play.golang.org/p/14gzc0a_89</a></p>\n\n<p>I am new to go and I am going off of these examples for neoism: \n<a href=\"https://gist.github.com/verdverm/b43444063995a7f5b913\" rel=\"nofollow\">https://gist.github.com/verdverm/b43444063995a7f5b913</a></p>\n\n<p>There are many examples, but verdverm is always just outputting and not returning. </p>\n\n<p>I have a controller as well where I would like to output the json.</p>\n\n<pre><code>package controllers\n\nimport (\n  \"github.com/astaxie/beego\"\n  \"social/models\"\n)\n\ntype AccountsController struct {\n  beego.Controller\n}\n\nfunc (c *AccountsController) Get() {\n  c.Data[\"json\"] = models.GetAccounts()\n  // c.Data[\"json\"] = \"hello world\"\n  c.ServeJson()\n}\n</code></pre>\n\n<p>Thanks for any help/tips for go newbie!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1436919983, "post_id": 31419533, "comment_id": 50811561, "body": "I thought of that but a file bigger than 2gb could produce wrong results"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 3, "creation_date": 1436923034, "post_id": 31419533, "comment_id": 50812302, "body": "@Thellimist Length of a slice is guaranteed to fit in an integer. The <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">specification</a> does not say it directly, but it&#39;s implied.  The specification states that <code>len</code> returns an <code>int</code>. The specification states that the elements of a slice can be indexed from 0 to <code>len(s) -1</code>. It follows that the length of a slice cannot be larger than the maximum <code>int</code>.  See also the discussion <a href=\"http://stackoverflow.com/a/27647793/4130971\">here</a>."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 3, "creation_date": 1436965671, "post_id": 31419533, "comment_id": 50832896, "body": "@Thellimist keep in mind that int/uint are 32bit on a 32bit machine and 64bit on a 64bit machine."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1436921039, "last_edit_date": 1436921039, "creation_date": 1436919707, "answer_id": 31419533, "question_id": 31419521, "link": "https://stackoverflow.com/questions/31419521/golang-size-of-byte-in-int64/31419533#31419533", "title": "Golang size of []byte in int64", "body": "<p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Convert</a> the <code>int</code> to an <code>int64</code>:</p>\n\n<pre><code>l := int64(len(data))\n</code></pre>\n\n<p>The length of a slice is guaranteed to fit in an <code>int</code>. If the file is larger than what can be represented by an <code>int</code>, then it's not possible to read the entire file into a []byte.</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9855, "favorite_count": 0, "accepted_answer_id": 31419533, "answer_count": 1, "score": 0, "last_activity_date": 1453847557, "creation_date": 1436919565, "question_id": 31419521, "link": "https://stackoverflow.com/questions/31419521/golang-size-of-byte-in-int64", "title": "Golang size of []byte in int64", "body": "<pre><code>//data = file in []byte \nlength := len(data)\n</code></pre>\n\n<p><code>length</code> is in type <code>int</code>. I need to find the length in <code>int64</code>. I only have the <code>[]byte</code> data of the file. How can I find the size of data in <code>int64</code>?</p>\n"}, {"tags": ["memory", "reflection", "go", "profiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436966454, "post_id": 31419307, "comment_id": 50833505, "body": "Can you try profiling this with go1.5? A side effect of the new runtime is that it exposes more internals to the profiler."}, {"owner": {"reputation": 407, "user_id": 1604253, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c911d6bde98f400a59ea525eb4df6710?s=128&d=identicon&r=PG", "display_name": "cellofellow", "link": "https://stackoverflow.com/users/1604253/cellofellow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436989914, "post_id": 31419307, "comment_id": 50848909, "body": "@JimB that would have been awesome if it had worked but unfortunately it doesn&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437037019, "post_id": 31427777, "comment_id": 50867168, "body": "@cellofellow: if you&#39;re not planning to propose the change please tell me so I can do it."}, {"owner": {"reputation": 407, "user_id": 1604253, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c911d6bde98f400a59ea525eb4df6710?s=128&d=identicon&r=PG", "display_name": "cellofellow", "link": "https://stackoverflow.com/users/1604253/cellofellow"}, "edited": false, "score": 0, "creation_date": 1437175662, "post_id": 31427777, "comment_id": 50936775, "body": "go ahead and make the proposal :)"}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 0, "last_activity_date": 1442410144, "last_edit_date": 1442410144, "creation_date": 1436955842, "answer_id": 31427777, "question_id": 31419307, "link": "https://stackoverflow.com/questions/31419307/golang-is-there-a-way-to-profile-memory-usage-of-code-that-uses-reflect/31427777#31427777", "title": "GoLang - Is there a way to profile memory usage of code that uses reflect?", "body": "<p>The short answer is that you can't directly. <code>reflect.Value.call</code> calls <code>reflect.call</code> which forwards to <code>runtime.reflectcall</code> which is an assembly routine implemented in the runtime, for example for amd64, <a href=\"https://github.com/golang/go/blob/f5d494bbdf945f2662eb4da45cdb75de2b7d43d4/src/runtime/asm_amd64.s#L371\" rel=\"nofollow\">here</a>. This circumvents what the profiler can see. </p>\n\n<p>Your best bet is to invoke your handlers without reflection and test them like that individually.</p>\n\n<p>Also, enabling the profiler to follow reflective calls would arguably be an acceptable change to propose for the next Go iteration. You should follow the <a href=\"https://docs.google.com/document/d/12Nj3YuQYFFMkL1Dv39q3JZrDHjtq2lZMRejmfQeBGpU/edit\" rel=\"nofollow\">change proposal process</a> for this.</p>\n\n<p>Edit: <a href=\"https://github.com/golang/go/issues/11786\" rel=\"nofollow\">issue</a> created.</p>\n"}, {"tags": [], "owner": {"reputation": 1381, "user_id": 1537746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50168cfc0da8a5f4eea545df4c022b15?s=128&d=identicon&r=PG", "display_name": "Russ Cox", "link": "https://stackoverflow.com/users/1537746/russ-cox"}, "is_accepted": true, "score": 3, "last_activity_date": 1499688651, "last_edit_date": 1499688651, "creation_date": 1446744975, "answer_id": 33551185, "question_id": 31419307, "link": "https://stackoverflow.com/questions/31419307/golang-is-there-a-way-to-profile-memory-usage-of-code-that-uses-reflect/33551185#33551185", "title": "GoLang - Is there a way to profile memory usage of code that uses reflect?", "body": "<p>Thanks to @thwd for filing <a href=\"http://golang.org/issue/11786\" rel=\"nofollow noreferrer\">http://golang.org/issue/11786</a> about this. This is a display issue in pprof. All the data is there, just being hidden. You can get the data you need by invoking pprof with the <code>-runtime</code> flag. It will also show data you don't need, but it should serve as a decent workaround until Go 1.6 is out.</p>\n"}], "owner": {"reputation": 407, "user_id": 1604253, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c911d6bde98f400a59ea525eb4df6710?s=128&d=identicon&r=PG", "display_name": "cellofellow", "link": "https://stackoverflow.com/users/1604253/cellofellow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 774, "favorite_count": 0, "accepted_answer_id": 33551185, "answer_count": 2, "score": 4, "last_activity_date": 1499688651, "creation_date": 1436918036, "question_id": 31419307, "link": "https://stackoverflow.com/questions/31419307/golang-is-there-a-way-to-profile-memory-usage-of-code-that-uses-reflect", "title": "GoLang - Is there a way to profile memory usage of code that uses reflect?", "body": "<p>I am using <code>gocraft/web</code> in a project and am trying to debug some high memory usage. <code>gocraft/web</code> uses reflection to call handlers. I've set up the <code>net/http/pprof</code> profiler which works very well, but the largest block of memory, and the one that I am iterested in, only shows <code>reflect.Value.call</code> as the function. That's not very helpful.</p>\n\n<p>How can I get around the fact that <code>gocraft/web</code> is using reflection and dig deeper into the memory profile?</p>\n\n<p>Here's an example of the profile output I am seeing:</p>\n\n<p><img src=\"https://i.stack.imgur.com/IRpkq.png\" alt=\"Example Profile\"></p>\n"}, {"tags": ["struct", "go", "interface"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1436917301, "post_id": 31419128, "comment_id": 50810849, "body": "See: <a href=\"http://stackoverflow.com/questions/14289256/cannot-convert-data-type-interface-to-type-string-need-type-assertion\" title=\"cannot convert data type interface to type string need type assertion\">stackoverflow.com/questions/14289256/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1277, "user_id": 1709647, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/efef9722d3a47141694ee7e2b3ae7f55?s=128&d=identicon&r=PG", "display_name": "Knights", "link": "https://stackoverflow.com/users/1709647/knights"}, "edited": false, "score": 0, "creation_date": 1436946799, "post_id": 31420447, "comment_id": 50820586, "body": "What if the struct was passed from another package, and you do not know which struct was passed? Eg. Beego frameworks allow one to pass your own struct, how does it figure our ur methods, and struct in the 1st place"}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": false, "score": 1, "last_activity_date": 1436926931, "creation_date": 1436926931, "answer_id": 31420447, "question_id": 31419128, "link": "https://stackoverflow.com/questions/31419128/get-you-struct-back-to-its-data-type-after-passing-it-as-an-interface-and-run-i/31420447#31420447", "title": "Get you struct back to it&#39;s data type after passing it as an interface and run it&#39;s methods?", "body": "<p>What you want is <a href=\"http://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">Type Assertion</a>. Solution could something like this:</p>\n\n<pre><code>func fn(args ...interfaces) {\n    if strt, ok := args[0].(*MyStruct); ok {\n        // use struct\n    } else {\n        // something went wrong\n    }\n    // .......\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7865, "user_id": 576932, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2084548226e1ab1a0814812cccb29bef?s=128&d=identicon&r=PG", "display_name": "ford", "link": "https://stackoverflow.com/users/576932/ford"}, "is_accepted": false, "score": 0, "last_activity_date": 1436963296, "creation_date": 1436963296, "answer_id": 31430408, "question_id": 31419128, "link": "https://stackoverflow.com/questions/31419128/get-you-struct-back-to-its-data-type-after-passing-it-as-an-interface-and-run-i/31430408#31430408", "title": "Get you struct back to it&#39;s data type after passing it as an interface and run it&#39;s methods?", "body": "<p>It sounds like what you want here is a specific interface, specifically one that has a <code>Get</code> method that accepts a pointer to an <code>http.Request</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>type Getter interface {\n    Get(*http.Request)\n}\n\nfunc fn(getters ...Getter) {\n    getter := getters[0]\n    getter.Get(*http.Request)\n}\n\nfunc main() {\n    a := &amp;MyStruct{}\n    fn(a)\n}\n</code></pre>\n\n<p>This allows the compiler to check that the arguments to <code>fn</code> have <em>exactly</em> the methods you need, but it doesn't need to know anything else about the type. Read more about interfaces <a href=\"http://golang.org/doc/effective_go.html#interface_methods\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 1277, "user_id": 1709647, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/efef9722d3a47141694ee7e2b3ae7f55?s=128&d=identicon&r=PG", "display_name": "Knights", "link": "https://stackoverflow.com/users/1709647/knights"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1436963296, "creation_date": 1436916823, "last_edit_date": 1436954503, "question_id": 31419128, "link": "https://stackoverflow.com/questions/31419128/get-you-struct-back-to-its-data-type-after-passing-it-as-an-interface-and-run-i", "title": "Get you struct back to it&#39;s data type after passing it as an interface and run it&#39;s methods?", "body": "<p>I have a struct as follows</p>\n\n<pre><code>type MyStruct {\n   EmbeddedFooBar\n}\n\nfunc (m *MyStruct) Foo(b *http.Request) {\n   // Doing something\n} \n\nfunc fn(args ...interfaces) {\n    // It's here I want to get my struct back and run the \"Get\" method\n    // Please keep in mind I am too pass a pointer param into the struct method\n    strt := args[0]\n\n    ....\n    get struct back to static data type MyStruct\n    and run \"Get()\", dont mind how/where I will get *http.Request to pass, assume I can\n    ....\n\n    strt.Get(*http.Request)\n}\n\nfunc main() {\n    a := &amp;MyStruct{}\n    fn(a)\n}\n</code></pre>\n\n<p>I am passing the struct above to a variadic function <code>fn</code> that expects <code>...interfaces{}</code> (thus any type can satisfy the params)  </p>\n\n<p>Inside the function <code>fn</code> I want to get back my struct <code>MyStruct</code> to it's data type and value and run it's method <code>Get</code> that can also accept receivers such as <code>*http.Request</code>  </p>\n\n<p>How do I get My Struct back from the interface <code>arg[0]</code> and run the method <code>Get</code> of the struct with the ability of passing a pointer.</p>\n"}, {"tags": ["unicode", "go", "slice"], "comments": [{"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 3, "creation_date": 1436912836, "post_id": 31418376, "comment_id": 50809430, "body": "You can make use of <code>At</code> method of <code>golang.org&#47;x&#47;exp&#47;utf8string</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1018, "user_id": 1566161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ixPny.jpg?s=128&g=1", "display_name": "Jonathan Simon Prates", "link": "https://stackoverflow.com/users/1566161/jonathan-simon-prates"}, "edited": false, "score": 10, "creation_date": 1436972686, "post_id": 31418646, "comment_id": 50838401, "body": "It worked. Thanks. Note: Instead use len(s), I have used utf8.RuneCountInString(s) to get string size. Function len(s) counts bytes, not chars. <a href=\"http://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#len</a>"}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 19, "last_activity_date": 1436913705, "creation_date": 1436913705, "answer_id": 31418646, "question_id": 31418376, "link": "https://stackoverflow.com/questions/31418376/slice-string-in-go-how-can-i-slice-arabic-or-other-unicode-strings/31418646#31418646", "title": "Slice string in Go: How can I slice arabic (or other unicode) strings?", "body": "<p>First of all, you should really read about <a href=\"https://blog.golang.org/strings\" rel=\"noreferrer\">strings, bytes and runes in Go</a>.</p>\n\n<p>And here is how you can achieve what you want: <kbd><a href=\"http://play.golang.org/p/4Fxdt8RvGA\" rel=\"noreferrer\">Go playground</a></kbd> (I was not able to properly paste arabic symbols, but if Chinese works, arabic should work too).</p>\n\n<pre><code>    s := \"abcdefghijklmnop\" \n    fmt.Println(s[2:9]) \n\n    s = \"\u7ef4\u57fa\u767e\u79d1:\u5173\u4e8e\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1\" \n    fmt.Println(string([]rune(s)[2:9]))\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>cdefghi\n\u767e\u79d1:\u5173\u4e8e\u4e2d\u6587\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1609817389, "creation_date": 1609817389, "answer_id": 65572851, "question_id": 31418376, "link": "https://stackoverflow.com/questions/31418376/slice-string-in-go-how-can-i-slice-arabic-or-other-unicode-strings/65572851#65572851", "title": "Slice string in Go: How can I slice arabic (or other unicode) strings?", "body": "<p>You can use the <code>utf8string</code> package:</p>\n<pre><code>package main\nimport &quot;golang.org/x/exp/utf8string&quot;\n\nfunc main() {\n   o := utf8string.NewString(&quot;\ud83c\udf88\ud83c\udf84\ud83c\udf80\ud83c\udfa2\ud83d\udc53&quot;)\n   // example 1\n   s1 := o.At(1)\n   // example 2\n   s2 := o.Slice(1, 3)\n   // example 3\n   n3 := o.RuneCount()\n   // print\n   println(s1 == '\ud83c\udf84', s2 == &quot;\ud83c\udf84\ud83c\udf80&quot;, n3 == 5)\n}\n</code></pre>\n<p><a href=\"https://pkg.go.dev/golang.org/x/exp/utf8string\" rel=\"nofollow noreferrer\">https://pkg.go.dev/golang.org/x/exp/utf8string</a></p>\n"}], "owner": {"reputation": 1018, "user_id": 1566161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ixPny.jpg?s=128&g=1", "display_name": "Jonathan Simon Prates", "link": "https://stackoverflow.com/users/1566161/jonathan-simon-prates"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11957, "favorite_count": 1, "accepted_answer_id": 31418646, "answer_count": 2, "score": 9, "last_activity_date": 1609817389, "creation_date": 1436912255, "last_edit_date": 1436922832, "question_id": 31418376, "link": "https://stackoverflow.com/questions/31418376/slice-string-in-go-how-can-i-slice-arabic-or-other-unicode-strings", "title": "Slice string in Go: How can I slice arabic (or other unicode) strings?", "body": "<p>I need to slice a string in Go. Sometimes I have latin chars, otherwise I have arabic chars, but [:1] for arabic returns a different value.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := \"a\"\n    fmt.Println(a[:1]) // work\n\n    b := \"\u0630\"\n    fmt.Println(b[:1]) // not work\n    fmt.Println(b[:2]) // work\n\n    fmt.Println(len(a) == len(b)) // false\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/R-JxaxbfNL\" rel=\"noreferrer\">http://play.golang.org/p/R-JxaxbfNL</a></p>\n"}, {"tags": ["go", "imap"], "comments": [{"owner": {"reputation": 1844, "user_id": 238074, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3fed50cc653f3ea8c50eb4c227237840?s=128&d=identicon&r=PG", "display_name": "Kevin Buchs", "link": "https://stackoverflow.com/users/238074/kevin-buchs"}, "edited": false, "score": 0, "creation_date": 1436909945, "post_id": 31417852, "comment_id": 50808239, "body": "import ( \t&quot;code.google.com/p/go-imap/go1/imap&quot; \t&quot;fmt&quot; \t&quot;time&quot; \t&quot;net/mail&quot; \t&quot;bytes&quot; \t&quot;mime&quot; \t&quot;mime/multipart&quot; \t&quot;strings&quot; \t&quot;io&quot; \t&quot;io/ioutil&quot; \t&quot;os&quot;     )"}, {"owner": {"reputation": 9142, "user_id": 1442918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7490251da02084a2e2720e20029d2bff?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/1442918/max"}, "edited": false, "score": 0, "creation_date": 1436922432, "post_id": 31417852, "comment_id": 50812167, "body": "The flag is spelled \\Deleted, which will make a large difference."}], "answers": [{"tags": [], "owner": {"reputation": 1844, "user_id": 238074, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3fed50cc653f3ea8c50eb4c227237840?s=128&d=identicon&r=PG", "display_name": "Kevin Buchs", "link": "https://stackoverflow.com/users/238074/kevin-buchs"}, "is_accepted": false, "score": 0, "last_activity_date": 1437066437, "creation_date": 1437066437, "answer_id": 31460461, "question_id": 31417852, "link": "https://stackoverflow.com/questions/31417852/how-to-flag-imap-message-deleted-via-go-imap-library/31460461#31460461", "title": "how to flag imap message /Deleted via go imap library", "body": "<p>I got directed to the answer found in demo code that is part of the package. </p>\n\n<p><a href=\"https://github.com/mxk/go-imap/blob/master/imap-demo/demo1.go#L94\" rel=\"nofollow\">https://github.com/mxk/go-imap/blob/master/imap-demo/demo1.go#L94</a></p>\n\n<p>Note, this package location is preferred over the code.google.com location. And, yes, the flag is \\Deleted. </p>\n"}], "owner": {"reputation": 1844, "user_id": 238074, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3fed50cc653f3ea8c50eb4c227237840?s=128&d=identicon&r=PG", "display_name": "Kevin Buchs", "link": "https://stackoverflow.com/users/238074/kevin-buchs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1079, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437066437, "creation_date": 1436909867, "question_id": 31417852, "link": "https://stackoverflow.com/questions/31417852/how-to-flag-imap-message-deleted-via-go-imap-library", "title": "how to flag imap message /Deleted via go imap library", "body": "<p>I'm looking to develop Go code to read email from an IMAP server and then delete the message (i.e. flag it /Deleted and expunge). This is <strong>not</strong> how to do it, as it seems to be a no-op. The variable <em>message_id</em> is an uint32 message number.</p>\n\n<pre><code>delset, _ := imap.NewSeqSet(string(message_id))\ncmd2, err = client.Store(delset, \"+FLAGS\", \"/Deleted\")\nif err != nil {\n    fmt.Printf(\"Error on store command, err: %s\\n\", err)\n    return\n}\n// below just stalls in a wait forever...\n// Process responses while the command is running\n// for cmd2.InProgress() {\n//  // Wait for the next response (no timeout)\n//  // client.Recv(-1)\n//  // Process command data\n//  for _, rsp2 = range cmd2.Data {\n//      fmt.Println(\"Response from store\")\n//      fmt.Println(rsp2)\n//  }\n// }\n\n// And later:\n// Expunge\ncmd3, err = client.Expunge(nil)\n</code></pre>\n"}, {"tags": ["go", "smtp"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1436908409, "last_edit_date": 1436908409, "creation_date": 1436906708, "answer_id": 31416969, "question_id": 31415529, "link": "https://stackoverflow.com/questions/31415529/receipt-address-wont-show-up-in-the-email-sent-by-golang-smtp-client/31416969#31416969", "title": "Receipt address won&#39;t show up in the email sent by golang smtp client", "body": "<p>You're setting the values for the mail envelope, but you haven't put any headers in the email itself except for <code>Subject:</code>. You should also be using <code>\\r\\n</code> as a newline for email.</p>\n\n<p>A minimal example might look like:</p>\n\n<pre><code>headers := make(map[string]string)\n\nheaders[\"Subject\"] = \"this is a test\"\nheaders[\"From\"] = \"me@example.com\"\nheaders[\"To\"] = \"you@example.com\"\n\nbody := \"hello,\\nthis is a test\"\n\nvar msg bytes.Buffer\nfor k, v := range headers {\n    msg.WriteString(k + \": \" + v + \"\\r\\n\")\n}\n\nmsg.WriteString(\"\\r\\n\")\nmsg.WriteString(body)\n</code></pre>\n\n<p>Some other helpful stdlib packages:</p>\n\n<ul>\n<li><a href=\"http://golang.org/pkg/net/textproto/\" rel=\"nofollow\"><code>net/textproto</code></a> for MIME header handling</li>\n<li><a href=\"http://golang.org/pkg/net/mail/\" rel=\"nofollow\"><code>net/mail</code></a> for address handling (though the package is really only for parsing email)</li>\n<li><a href=\"http://gopkg.in/gomail.v1\" rel=\"nofollow\">http://gopkg.in/gomail.v1</a> for a more complete solution (there are probably many others)</li>\n</ul>\n"}], "owner": {"reputation": 91, "user_id": 4055540, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-U-xpguGAMhI/AAAAAAAAAAI/AAAAAAAAANc/ZXXSkHyEMbA/photo.jpg?sz=128", "display_name": "Wilson Wang", "link": "https://stackoverflow.com/users/4055540/wilson-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1436908409, "creation_date": 1436901782, "question_id": 31415529, "link": "https://stackoverflow.com/questions/31415529/receipt-address-wont-show-up-in-the-email-sent-by-golang-smtp-client", "title": "Receipt address won&#39;t show up in the email sent by golang smtp client", "body": "<p>Here is the code snippet to send the email via a local postfix server:</p>\n\n<pre><code>from := r.FormValue(\"from\")\nto := strings.Split(r.FormValue(\"to\"), \";\")\nbody := r.FormValue(\"body\")\nmime := \"MIME-version:1.0;\\nContent-Type:text/html;charset=\\\"UTF-8\\\";\\n\\n\"\nsubject := fmt.Sprintf(\"Subject: %s\\n\", r.FormValue(\"subject\"))\nmsg := []byte(subject + mime + body)\n\nerr := smtp.SendMail(\"localhost:25\", nil, from, to, msg)\n</code></pre>\n\n<p>The email was sent/received fine. However, it is missing the receipt address in the To field of received email. I also tried it on an exchange server. The receipt addresses are missing as well. Here is what it shows in the email source.</p>\n\n<pre><code>To: Undisclosed recipients:;\n</code></pre>\n\n<p>Any suggestions to fix it? thanks!</p>\n"}, {"tags": ["testing", "go", "cover"], "answers": [{"comments": [{"owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 0, "creation_date": 1436898342, "post_id": 31413494, "comment_id": 50801860, "body": "I&#39;m not seeing <code>-html</code> or <code>-func</code> as an option... Am I missing something? <a href=\"http://pastebin.com/d2wgQyDM\" rel=\"nofollow noreferrer\">pastebin.com/d2wgQyDM</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 1, "creation_date": 1436898830, "post_id": 31413494, "comment_id": 50802144, "body": "@ChristianNuss: you need to use the cover tool. Use the commands exactly as they are printed in my answer (which is taken directly from <code>go tool cover -help</code>)"}, {"owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 0, "creation_date": 1436902942, "post_id": 31413494, "comment_id": 50804447, "body": "Ahh, thanks, First run go test -coverprofile, and then run go tool cover on that output file.  Still, is there a way to convert the raw cover output file into another format, preferably xunit?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 2, "creation_date": 1436903448, "post_id": 31413494, "comment_id": 50804707, "body": "@ChristianNuss: I&#39;m not aware of any translators. The mailing list would probably be the best place to ask if anyone has written one."}, {"owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 0, "creation_date": 1436977521, "post_id": 31413494, "comment_id": 50841759, "body": "Useful comment from the forums: I need to try each out but the tools seem viable: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/iUc68Zrxk_c\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/iUc68Zrxk_c</a>"}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 0, "creation_date": 1589029199, "post_id": 31413494, "comment_id": 109131898, "body": "<code>go tool cover -h</code>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 9, "last_activity_date": 1508135926, "last_edit_date": 1508135926, "creation_date": 1436895155, "answer_id": 31413494, "question_id": 31413281, "link": "https://stackoverflow.com/questions/31413281/golang-coverprofile-output-format/31413494#31413494", "title": "Golang coverprofile output format", "body": "<p>You process the cover profile using the go <code>cover</code> tool:</p>\n\n<p>Open a web browser displaying annotated source code:</p>\n\n<pre><code>    go tool cover -html=c.out\n</code></pre>\n\n<p>Write out an HTML file instead of launching a web browser:</p>\n\n<pre><code>    go tool cover -html=c.out -o coverage.html\n</code></pre>\n\n<p>Display coverage percentages to stdout for each function:</p>\n\n<pre><code>    go tool cover -func=c.out\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 120, "user_id": 1459532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8db043f0615e38a27e22ee5eaaee569?s=128&d=identicon&r=PG", "display_name": "Sam Jones", "link": "https://stackoverflow.com/users/1459532/sam-jones"}, "edited": false, "score": 9, "creation_date": 1486651491, "post_id": 31440740, "comment_id": 71445398, "body": "How is this the accepted answer? It doesn&#39;t answer the question!"}], "tags": [], "owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "is_accepted": true, "score": 12, "last_activity_date": 1436993222, "creation_date": 1436993222, "answer_id": 31440740, "question_id": 31413281, "link": "https://stackoverflow.com/questions/31413281/golang-coverprofile-output-format/31440740#31440740", "title": "Golang coverprofile output format", "body": "<p>The golang-nuts community (<a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"noreferrer\">https://groups.google.com/forum/#!forum/golang-nuts</a>) provided a couple useful tools for converting Go coverage into more useful formats.</p>\n\n<p>JUnit Format (for summarizing test executions):</p>\n\n<pre><code># Prerequisites\ngo get github.com/jstemmer/go-junit-report\n# Tests\ngo test -v | go-junit-report &gt; report.xml\n</code></pre>\n\n<p>Cobertura Format (for detailing code coverage):</p>\n\n<pre><code># Prerequisites\ngo get github.com/axw/gocov/gocov\ngo get github.com/AlekSi/gocov-xml\n# Coverage\ngo test -coverprofile=cover.out\ngocov convert cover.out | gocov-xml &gt; coverage.xml\n</code></pre>\n\n<p>The thread that pointed me in this direction was here:\n<a href=\"https://groups.google.com/forum/#!topic/golang-nuts/iUc68Zrxk_c\" rel=\"noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/iUc68Zrxk_c</a> </p>\n"}, {"comments": [{"owner": {"reputation": 507, "user_id": 287266, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/30b63787b6fe215309507ce479f33ef6?s=128&d=identicon&r=PG", "display_name": "Tareq Sha", "link": "https://stackoverflow.com/users/287266/tareq-sha"}, "edited": false, "score": 1, "creation_date": 1560938711, "post_id": 39453143, "comment_id": 99898348, "body": "From a recent research I found that the last field is actually a 0/1 flag that tells whether the specified statements are covered or not"}, {"owner": {"reputation": 714, "user_id": 1404361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SUNs0.jpg?s=128&g=1", "display_name": "Roger Russel", "link": "https://stackoverflow.com/users/1404361/roger-russel"}, "edited": false, "score": 0, "creation_date": 1589514402, "post_id": 39453143, "comment_id": 109330999, "body": "Thank you, I finally found what I was looking for."}, {"owner": {"reputation": 24752, "user_id": 351984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f3133cf8379692c9b8c52bbcb6438aae?s=128&d=identicon&r=PG", "display_name": "Paul Rubel", "link": "https://stackoverflow.com/users/351984/paul-rubel"}, "reply_to_user": {"reputation": 507, "user_id": 287266, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/30b63787b6fe215309507ce479f33ef6?s=128&d=identicon&r=PG", "display_name": "Tareq Sha", "link": "https://stackoverflow.com/users/287266/tareq-sha"}, "edited": false, "score": 0, "creation_date": 1606855235, "post_id": 39453143, "comment_id": 115087988, "body": "Re: @Tareq Sha, I just had a look at go 1.15.2 and the last field had values that weren&#39;t 0/1, count seems more likely"}], "tags": [], "owner": {"reputation": 13941, "user_id": 11687, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f93a872e399bc1353cc8d4e791d5401?s=128&d=identicon&r=PG", "display_name": "mislav", "link": "https://stackoverflow.com/users/11687/mislav"}, "is_accepted": false, "score": 36, "last_activity_date": 1473691845, "creation_date": 1473691845, "answer_id": 39453143, "question_id": 31413281, "link": "https://stackoverflow.com/questions/31413281/golang-coverprofile-output-format/39453143#39453143", "title": "Golang coverprofile output format", "body": "<p>The fields are:</p>\n\n<pre><code>name.go:line.column,line.column numberOfStatements count\n</code></pre>\n\n<p><a href=\"https://github.com/golang/go/blob/0104a31b8fbcbe52728a08867b26415d282c35d2/src/cmd/cover/profile.go#L56\" rel=\"noreferrer\">Source</a></p>\n"}], "owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11436, "favorite_count": 8, "accepted_answer_id": 31440740, "answer_count": 3, "score": 28, "last_activity_date": 1589029048, "creation_date": 1436894404, "last_edit_date": 1589029048, "question_id": 31413281, "link": "https://stackoverflow.com/questions/31413281/golang-coverprofile-output-format", "title": "Golang coverprofile output format", "body": "<p>I'm trying to make sense of the <code>-coverprofile cover.out</code> option in <code>go test</code>, specifically the format of the file.</p>\n\n<p>Covering <code>server.go</code> for example, yields the output in <code>cover.out</code>:</p>\n\n<pre><code>mode: set\ngithub.com/cnuss/api_server/server.go:47.2,48.16 2 0\ngithub.com/cnuss/api_server/server.go:52.2,53.16 2 0\ngithub.com/cnuss/api_server/server.go:57.2,58.16 2 0\ngithub.com/cnuss/api_server/server.go:62.2,63.16 2 0\ngithub.com/cnuss/api_server/server.go:67.2,68.16 2 0\ngithub.com/cnuss/api_server/server.go:72.2,73.16 2 0\ngithub.com/cnuss/api_server/server.go:77.2,78.16 2 0\n</code></pre>\n\n<ol>\n<li>What do each of the different columns mean?</li>\n<li>Is the format of the output in a \"standard\" format, e.g. gcov, xunit, etc. and convertable to another format?</li>\n</ol>\n"}, {"tags": ["http", "go", "http-headers", "cors", "preflight"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436892172, "post_id": 31412478, "comment_id": 50798180, "body": "404 probably means it&#39;s not finding a handler. Check that the path being requested matches your handler&#39;s route."}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436892825, "post_id": 31412478, "comment_id": 50798565, "body": "Request Header:Accept:*/* Accept-Encoding:gzip, deflate, sdch Accept-Language:en-US,en;q=0.8 Access-Control-Request-Headers:accept, content-type Access-Control-Request-Method:POST Connection:keep-alive Host:localhost:8080 Origin:<a href=\"http://localhost:63342\" rel=\"nofollow noreferrer\">localhost:63342</a> Referer:<a href=\"http://localhost:63342/Main/app/\" rel=\"nofollow noreferrer\">localhost:63342/Main/app</a> User-Agent:Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436893042, "post_id": 31412478, "comment_id": 50798696, "body": "Show the code that you use to register the route and the URL entered from the browser.  Also, use <a href=\"http://godoc.org/net/http#MaxBytesReader\" rel=\"nofollow noreferrer\">godoc.org/net/http#MaxBytesReader</a> instead of io.LimitReader.  io.LimitReader will not prevent the server from the entire  request body."}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436893209, "post_id": 31412478, "comment_id": 50798791, "body": "if I change the method from POST to OPTIONS in the router I am getting status code 200"}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436893349, "post_id": 31412478, "comment_id": 50798876, "body": "func NewRouter() *mux.Router {  \trouter := mux.NewRouter().StrictSlash(true) \tfor _, route := range routes {  \t\tvar handler http.Handler  \t\thandler = route.HandlerFunc \t\t//handler = commonlibrary.Logger(handler, route.Name)  \t\trouter. \t\t\tMethods(route.Method). \t\t\tPath(route.Pattern). \t\t\tName(route.Name). \t\t\tHandler(handler)  \t}  \treturn router }"}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436893527, "post_id": 31412478, "comment_id": 50798989, "body": "Route{ \t\t&quot;saveConfig&quot;, \t\t&quot;POST&quot;, \t\t&quot;/saveConfig&quot;, \t\tsaveConfig, \t},"}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436894652, "post_id": 31412478, "comment_id": 50799693, "body": "@BravadaZadada: Here is my Angularjs call :  $http.post(&#39;<a href=\"http://localhost:8080/saveConfig\" rel=\"nofollow noreferrer\">localhost:8080/saveConfig</a>&#39;, data = JSON.stringify(custconfig))"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436896222, "post_id": 31413624, "comment_id": 50800607, "body": "I went with the options: Route{&quot;saveConfig&quot;, &quot;OPTIONS&quot;, &quot;/saveConfig&quot;, preflight} Now if I make the call from Angularjs  $http.post(&#39;<a href=\"http://localhost:8080/saveConfig\" rel=\"nofollow noreferrer\">localhost:8080/saveConfig</a>&#39;, data = JSON.stringify(custconfig)) I am getting  HTTP/1.1 200 OK but it&#39;s not calling the POST though. Looks like only Options  is getting called from the clientside"}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436896241, "post_id": 31413624, "comment_id": 50800624, "body": "Here is my preflightcode: func saveConfigPreFlight(w http.ResponseWriter, r *http.Request) { \tif origin := r.Header.Get(&quot;Origin&quot;); origin == &quot;<a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">localhost:8080</a>&quot; { \t\tw.Header().Set(&quot;Access-Control-Allow-Origin&quot;, origin) \t\tw.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;POST&quot;) \t\tw.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization&quot;) \t} \t// Stop here if its Preflighted OPTIONS request \tif r.Method == &quot;OPTIONS&quot; { \t\treturn \t}  \tsaveConfig(w, r)  }"}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "edited": false, "score": 0, "creation_date": 1436897417, "post_id": 31413624, "comment_id": 50801269, "body": "removed the saveconfig(w,r) from the preflight handler and the POST is working fine now.   but on the Chrome I still see the error :1 XMLHttpRequest cannot load <a href=\"http://localhost:8080/saveConfig\" rel=\"nofollow noreferrer\">localhost:8080/saveConfig</a>. No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;<a href=\"http://localhost:63342\" rel=\"nofollow noreferrer\">localhost:63342</a>&#39; is therefore not allowed access."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1436895604, "creation_date": 1436895604, "answer_id": 31413624, "question_id": 31412478, "link": "https://stackoverflow.com/questions/31412478/preflight-issue-with-http-post-in-golang/31413624#31413624", "title": "Preflight issue with http POST in golang", "body": "<p>The code registers for POST, but not OPTIONS. One approach is to change your code to the following:</p>\n\n<pre><code>func NewRouter() *mux.Router { \n    router := mux.NewRouter().StrictSlash(true) \n    for _, route := range routes { \n        var handler http.Handler \n        handler = route.HandlerFunc\n        handler = commonlibrary.Logger(handler, route.Name) \n        return router.Methods(route.Method, \"OPTIONS\").Path(route.Pattern).Name(route.Name).Handler(handler)\n }\n</code></pre>\n\n<p>This will add OPTIONS to all handlers. Another approach is to change the Route Method field to <code>Methods []string</code> and create the router as:</p>\n\n<pre><code>return router.Methods(route.Methods..., \"OPTIONS\").Path(route.Pattern).Name(route.Name).Handler(handler)\n</code></pre>\n\n<p>This will allow you to add OPTIONS to a subset of the handlers. </p>\n\n<p>Yet another approach is to register a separate handler for OPTIONS:</p>\n\n<pre><code> Route{\"saveConfig\", \"OPTIONS\", \"/saveConfig\", preflight}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2641, "favorite_count": 0, "accepted_answer_id": 31413624, "answer_count": 1, "score": 1, "last_activity_date": 1436922945, "creation_date": 1436891799, "last_edit_date": 1436922945, "question_id": 31412478, "link": "https://stackoverflow.com/questions/31412478/preflight-issue-with-http-post-in-golang", "title": "Preflight issue with http POST in golang", "body": "<p>I am using mux package and have this code:</p>\n\n<pre><code>func saveConfig(w http.ResponseWriter, r *http.Request) {\n    if origin := r.Header.Get(\"Origin\"); origin != \"\" {\n        w.Header().Set(\"Access-Control-Allow-Origin\", origin)\n        fmt.Println(\"Origin: \" + origin)\n        w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n    }\n    // Stop here if its Preflighted OPTIONS request\n    if r.Method == \"OPTIONS\" {\n        return\n    }\n\n    body, err := ioutil.ReadAll(io.LimitReader(r.Body, 1048576))\n    if err != nil {\n        fmt.Println(\"Error: %s\\n\", err)\n        w.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n\n    fmt.Println(\"JSON body:\" + string(body))\n    if err := r.Body.Close(); err != nil {\n        panic(err)\n    }\n\n    w.WriteHeader(http.StatusCreated)\n}\n</code></pre>\n\n<p>It's working fine on IE but chrome  preflight is sending an OPTIONS method and I am getting 404 response back. Any help would be greatly appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1436890601, "creation_date": 1436890601, "answer_id": 31412038, "question_id": 31411972, "link": "https://stackoverflow.com/questions/31411972/cannot-use-some-type-in-function-call/31412038#31412038", "title": "Cannot use some type in function call", "body": "<p>Never use a pointer to an interface (well, unless you know <em>exactly</em> why you would want to do so)</p>\n\n<p>In order to pass that into the defined function, you would need to create the <code>*somepkg.Handler</code> explicitly (but don't really do this)</p>\n\n<pre><code>var handler somepkg.Handler = new(MyHandler)\nmySomeThing.Handle(&amp;handler)\n</code></pre>\n\n<p>If you define <code>Handle</code> as</p>\n\n<pre><code>Handle(handler Handler)\n</code></pre>\n\n<p>any type that satisfies the <code>somepkg.Handler</code> interface can be passed in directly.</p>\n"}, {"comments": [{"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 0, "creation_date": 1436905188, "post_id": 31412169, "comment_id": 50805633, "body": "But using the method signature <code>func (l *SomeThingImpl) Handle(handler Handler)</code>, doesn&#39;t do this produce a copy of <code>handler</code> when passing it by value?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 0, "creation_date": 1436905783, "post_id": 31412169, "comment_id": 50805961, "body": "@Atmocreations I&#39;d prefer not to elaborate on how it technically works because I&#39;d need to do some research but I&#39;m pretty sure that is not the case. I&#39;m pretty sure though that it&#39;s much like how a slice is actually a very small struct which points to the underlying array, the thing you pass in is a lightweight struct that has the type information. Not a value copy of the object itself."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 1, "creation_date": 1436905946, "post_id": 31412169, "comment_id": 50806065, "body": "@Atmocreations yep &quot;An interface value is constructed of two words of data; one word is used to point to a method table for the value\u2019s underlying type, and the other word is used to point to the actual data being held by that value.&quot; - so what you&#39;re passing is slightly larger thn a pointer, but not by much. You can read more about that here <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow noreferrer\">jordanorelli.com/post/32665860244/how-to-use-interfaces-in-g&zwnj;&#8203;o</a>"}, {"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 0, "creation_date": 1436939335, "post_id": 31412169, "comment_id": 50816563, "body": "Okay then. What I want to avoid is to create expensive copies each time I pass my handler around. Well the handler is only a small object, but I&#39;m currently learning golang and want to get used to it."}, {"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 0, "creation_date": 1436940512, "post_id": 31412169, "comment_id": 50817017, "body": "btw jordan orelli&#39;s article is a very useful one, thank you"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1436892359, "last_edit_date": 1436892359, "creation_date": 1436890972, "answer_id": 31412169, "question_id": 31411972, "link": "https://stackoverflow.com/questions/31411972/cannot-use-some-type-in-function-call/31412169#31412169", "title": "Cannot use some type in function call", "body": "<p>You have this method; </p>\n\n<pre><code>func (l *SomeThingImpl) Handle(handler *Handler) {\n  fmt.Printf(\"handler: %s\", handler)\n}\n</code></pre>\n\n<p>Defined to take an interface pointer which is likely not what you want. What you're actually looking for is to have <code>*MyHandler</code> implement the <code>Handler</code> interface rather than <code>MyHandler</code> (or both could) so that you can pass your reference type into the method. </p>\n\n<pre><code>//new method sig\nHandle(handler Handler)\n// my preferred syntax for assignment here\nhandler := &amp;MyHandler{}\n// works just fine\nmySomeThing.Handle(handler)\n</code></pre>\n\n<p>If you really want to keep the method sig how you have it, to make your code work you just need to do <code>mySomeThing.Handle(&amp;handler)</code> but I'm doubtful that's actually what you want to do.</p>\n\n<p>btw; In your code <code>*MyHandler</code> is already implementing the interface due to this method <code>func (h *MyHandler) IncomingCall(request *somepkg.IncomingRequest)</code> haveing <code>*MyHandler</code> as the receiving type as apposed to <code>func (h MyHandler)</code> which would make it so only <code>MyHandler</code> implements the <code>Handler</code> interface. Some little Go nuance with recievers and interfaces there.</p>\n"}], "owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 31412169, "answer_count": 2, "score": 0, "last_activity_date": 1436892359, "creation_date": 1436890406, "question_id": 31411972, "link": "https://stackoverflow.com/questions/31411972/cannot-use-some-type-in-function-call", "title": "Cannot use some type in function call", "body": "<p>Currently, I'm having two files in two packages.</p>\n\n<h1>File <code>somepkg/something.go</code></h1>\n\n<pre><code>package somepkg\n\n// ----------------------------------------------------------------------------\n// Interfaces\n// ----------------------------------------------------------------------------\n\ntype SomeThing interface {\n  // some other methods\n  Handle(handler *Handler)\n}\ntype SomeThingImpl struct {\n  handlers []Handler\n}\n\ntype Handler interface {\n  IncomingCall(request *IncomingRequest)\n}\n\n// ----------------------------------------------------------------------------\n// SomeThingImpl implementation\n// ----------------------------------------------------------------------------\nfunc NewSomeThing() SomeThing {\n  u := new(SomethingImpl)\n  // some more operations with u\n  return u\n}\nfunc (l *SomeThingImpl) Handle(handler *Handler) {\n  fmt.Printf(\"handler: %s\", handler)\n}\n</code></pre>\n\n<h1>File <code>main.go</code></h1>\n\n<pre><code>package main\nimport (\n  \"fmt\"\n  )\n\ntype MyHandler struct {}\nfunc (h *MyHandler) IncomingCall(request *somepkg.IncomingRequest) {\n  fmt.Printf(\"Handler!\")\n}\n\nfunc main() {\n  mySomeThing := somepkg.NewSomeThing()\n\n\n  handler := new(MyHandler)\n  // works so far.\n  mySomeThing.Handle(handler) // &lt;-- here the compilation error occurs\n}\n</code></pre>\n\n<p>trying to run <code>go build</code> yields the following compilation error:</p>\n\n<pre><code>{...}\\main.go:20: cannot use handler (type *MyHandler) as type *somepkg.Handler in argument to mySomething.Handle:\n    *somepkg.Handler is pointer to interface, not interface\n</code></pre>\n\n<p>whereas <code>main.go:20</code> refers to the line above where I'm calling <code>mySomeThing.Handle(handler)</code>.</p>\n\n<p>Actually, both <code>MyHandler</code> and <code>somepkg.Handler</code> seem to be pointers. Both of them implement the same methods.</p>\n\n<p>Why does the compiler not consider these types to be compatible ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1462651902, "post_id": 31411555, "comment_id": 61730144, "body": "&quot;decelerate statement outside function body&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1436973876, "last_edit_date": 1436973876, "creation_date": 1436890086, "answer_id": 31411854, "question_id": 31411555, "link": "https://stackoverflow.com/questions/31411555/syntax-error-unexpected-name-expecting-semicolon-or-newline/31411854#31411854", "title": "syntax error: unexpected name, expecting semicolon or newline", "body": "<p>There's 2 primary issues (and many unrelated).</p>\n\n<p>First, you need to parenthesize named return parameters</p>\n\n<pre><code>func ping(curl_out string) (endtime int64) {\n</code></pre>\n\n<p>Second, you can't assign the return value of a goroutine. It's executed asynchronously in an entirely new context. Use a channel to communicate between goroutines</p>\n\n<p>You could declare the ping function like:</p>\n\n<pre><code>func ping(curl_out string, endtime chan&lt;- int64) {\n</code></pre>\n\n<p>And then pass in a channel on which to receive the value</p>\n\n<pre><code>ch := make(chan int64)\ngo ping(string(curl_out), ch)\nendtime &lt;- ch\n</code></pre>\n\n<p>(Though there is no point in this case to using a goroutine, since you want the value synchronously)</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 3928279, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8af0a001ed0640b756e748836ce2599d?s=128&d=identicon&r=PG&f=1", "display_name": "david", "link": "https://stackoverflow.com/users/3928279/david"}, "edited": false, "score": 0, "creation_date": 1436949122, "post_id": 31411861, "comment_id": 50821988, "body": "I want to calculate time.  starttiem  = service stop in consul endtime = this service don&#39;t parse."}], "tags": [], "owner": {"reputation": 183757, "user_id": 20654, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/94066dfa49c2feb14706cb081848fda7?s=128&d=identicon&r=PG", "display_name": "OscarRyz", "link": "https://stackoverflow.com/users/20654/oscarryz"}, "is_accepted": false, "score": 1, "last_activity_date": 1436891001, "last_edit_date": 1436891001, "creation_date": 1436890101, "answer_id": 31411861, "question_id": 31411555, "link": "https://stackoverflow.com/questions/31411555/syntax-error-unexpected-name-expecting-semicolon-or-newline/31411861#31411861", "title": "syntax error: unexpected name, expecting semicolon or newline", "body": "<p>In line 9:</p>\n\n<p>Add parenthesis </p>\n\n<pre><code>func ping(curl_out string) (endtime int64) {\n</code></pre>\n\n<p>or remove return value name:</p>\n\n<pre><code>func ping(curl_out string) int64 {\n</code></pre>\n\n<p>And you're right about the use of <code>go</code> keyword to create a goroutine, you can't assign that to a return value, just remove the <code>go</code> keyword and assign the value directly.</p>\n\n<p>Also (style)  go variables are in camelCase so you should change your variables from <code>run_container</code>  to either <code>runContainer</code>  or better just <code>container</code> or even better just <code>c</code>, same goes for <code>run_curl</code> it could be <code>curl</code></p>\n\n<p>Here's an slightly enhanced version of your code ( without really knowing what it does)</p>\n\n<p><a href=\"http://play.golang.org/p/3Y7TPip5kP\" rel=\"nofollow\">http://play.golang.org/p/3Y7TPip5kP</a></p>\n"}], "owner": {"reputation": 29, "user_id": 3928279, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8af0a001ed0640b756e748836ce2599d?s=128&d=identicon&r=PG&f=1", "display_name": "david", "link": "https://stackoverflow.com/users/3928279/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3957, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1462651703, "creation_date": 1436889248, "last_edit_date": 1462651703, "question_id": 31411555, "link": "https://stackoverflow.com/questions/31411555/syntax-error-unexpected-name-expecting-semicolon-or-newline", "title": "syntax error: unexpected name, expecting semicolon or newline", "body": "<p>I don't understand why my code has syntax error.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc ping(curl_out string) endtime int64 {\n    try_curl := exec.Command(\"curl\", \"localhost:8500/v1/catalog/nodes\")\n    try_curl_out := try_curl.Output()\n    for try_curl_out == curl_out {\n        try_curl := exec.Command(\"curl\", \"localhost:8500/v1/catalog/nodes\")\n        try_curl_out := try_curl.Output()\n    }\n    endtime := time.Now().Unix()\n    return endtime\n}\n\nfunc main() {\n    run_container := exec.Command(\"docker\", \"run\", \"-p\", \"8400:8400\", \"-p\", \"8500:8500\", \"-p\", \"8600:53/udp\", \"-h\", \"node1\", \"progrium/consul\", \"-server\", \"-bootstrap\")\n    container_id, err := run_container.Output()\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    run_curl := exec.Command(\"curl\", \"localhost:8500/v1/catalog/nodes\")\n    curl_out, err := run_curl.Output()\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    endtime := go ping(string(curl_out))\n    container_id, err = exec.Command(\"docker\", \"stop\", container_id)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    startime := time.Now().Unix()\n    fmt.Println(\"delay is\", endtime-startime)\n}\n\n# command-line-arguments\n./main.go:9: syntax error: unexpected name, expecting semicolon or newline\n./main.go:11: non-declaration statement outside function body\n./main.go:15: non-declaration statement outside function body\n./main.go:16: non-declaration statement outside function body\n./main.go:17: non-declaration statement outside function body\n./main.go:18: syntax error: unexpected }\n</code></pre>\n\n<p>This code calculates time between docker start and stop.\nI use routine to return end time. </p>\n\n<pre><code>endtime := go ping(string(curl_out))\n</code></pre>\n\n<p>I think it's wrong. How can I use keyword go?</p>\n\n<p>In Go, Do I decelerate statement outside function body?</p>\n"}, {"tags": ["eclipse", "go", "goclipse"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1436890872, "post_id": 31410761, "comment_id": 50797320, "body": "I personally don&#39;t use Goclipse. there are far better alternatives IMO. I know that&#39;s not what you asked, but try the IntelliJ plugin, LiteIDE, Atom or Sublime."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1436895956, "post_id": 31410761, "comment_id": 50800457, "body": "I agree with @Not_a_Golfer that ecplise isn&#39;t a very good IDE, especially for Go. But if you want to use it I suggest doing some searching for Eclipse errors because your problem has nothing to do with Go and everything to do with Ecplise being a piece of shit that can&#39;t even install itself without troubleshooting of dependencies. Generally the problems are due to your Java install but in this case, it may not know your Go path or something along those lines."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1436922941, "post_id": 31410761, "comment_id": 50812272, "body": "ecplise is bad, now."}, {"owner": {"reputation": 1357, "user_id": 393898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89b55a355cb66fff949fe85c45ea4897?s=128&d=identicon&r=PG", "display_name": "BrunoMedeiros", "link": "https://stackoverflow.com/users/393898/brunomedeiros"}, "edited": false, "score": 0, "creation_date": 1437043506, "post_id": 31410761, "comment_id": 50871485, "body": "Have you read the Goclipse UserGuide ( <a href=\"https://github.com/GoClipse/goclipse/blob/latest/documentation/UserGuide.md#user-guide\" rel=\"nofollow noreferrer\">github.com/GoClipse/goclipse/blob/latest/documentation/&hellip;</a> ) to make sure you know how to configure and use Goclipse? What settings did you use for the Go compiler paths and arch? What is the output in the Go build console in Eclipse when you try to build the project?"}, {"owner": {"reputation": 107, "user_id": 4903180, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10206015533888282/picture?type=large", "display_name": "Marco Jammajalla Mangraviti", "link": "https://stackoverflow.com/users/4903180/marco-jammajalla-mangraviti"}, "edited": false, "score": 0, "creation_date": 1437910955, "post_id": 31410761, "comment_id": 51219680, "body": "i need to program a cuda-device with go language so i thought to use eclipse because i already use it for cuda. Can you offer me an alternative? I read Userguide and i set GOPATH and GOROOT.  I wrote this on terminal:                    mkdir $HOME/go               export GOPATH=$HOME/go               export PATH=$PATH:GOPATH/bin"}, {"owner": {"reputation": 107, "user_id": 4903180, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10206015533888282/picture?type=large", "display_name": "Marco Jammajalla Mangraviti", "link": "https://stackoverflow.com/users/4903180/marco-jammajalla-mangraviti"}, "edited": false, "score": 0, "creation_date": 1437912166, "post_id": 31410761, "comment_id": 51220005, "body": "i just SOLVED!!!! GOPATH subfolders are: &quot;bin&quot; , &quot;pkg&quot; and &quot;src&quot;. I created a folder into &quot;src&quot; and i paste source file &quot;hello.go&quot; in this new folder! Now it work!!"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 5159276, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/d43b720ec59992826f9fee3cc123011f?s=128&d=identicon&r=PG", "display_name": "Riju Nayak", "link": "https://stackoverflow.com/users/5159276/riju-nayak"}, "is_accepted": false, "score": -1, "last_activity_date": 1437978042, "creation_date": 1437978042, "answer_id": 31646141, "question_id": 31410761, "link": "https://stackoverflow.com/questions/31410761/goclipse-internal-error-executing-preparing-launch-reason-java-lang-nullpoint/31646141#31646141", "title": "goClipse: internal error executing preparing launch. reason: java.lang.NullPointerException why?", "body": "<p>The \"main.go\" needs to be inside a sub directory inside the src folder of the project structure. Go files directly under the src folder are ignored. I suggest creating a \"MainProgram\" directory under src and running it from there. </p>\n"}], "owner": {"reputation": 107, "user_id": 4903180, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10206015533888282/picture?type=large", "display_name": "Marco Jammajalla Mangraviti", "link": "https://stackoverflow.com/users/4903180/marco-jammajalla-mangraviti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 409, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437978042, "creation_date": 1436887278, "last_edit_date": 1436888149, "question_id": 31410761, "link": "https://stackoverflow.com/questions/31410761/goclipse-internal-error-executing-preparing-launch-reason-java-lang-nullpoint", "title": "goClipse: internal error executing preparing launch. reason: java.lang.NullPointerException why?", "body": "<p>I'm trying to install goClipse on ubuntu 14.04.\nI've installed java8 from repository and i downloaded eclipse mars 4.5.</p>\n\n<p>i tried this example code,in a file called hello.go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\nfmt.Printf(\"hello, world\\n\")\n}\n</code></pre>\n\n<p>but it work only from terminal with follow commands:</p>\n\n<pre><code>go run hello.go\n</code></pre>\n\n<p>thankyou</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "edited": false, "score": 0, "creation_date": 1436885593, "post_id": 31409627, "comment_id": 50793517, "body": "arrays, I need to read up on slices....though the core problem is being able to use an array like data structure and passing that as an argument"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1436886742, "post_id": 31409627, "comment_id": 50794326, "body": "in this case the slice fit better. Since the array has a limitation: its length must be non-negative constant."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436889522, "post_id": 31409627, "comment_id": 50796382, "body": "FYI, your slice syntax doesn&#39;t do what you think it does. The <code>mat[:]</code> slices the outer array creating a <code>[][3]int</code>. Adding another slice operator just repeats the process -- <code>mat[:][:][:]</code> is still a <code>[][3]int</code>."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "is_accepted": true, "score": 10, "last_activity_date": 1436885532, "creation_date": 1436885532, "answer_id": 31410075, "question_id": 31409627, "link": "https://stackoverflow.com/questions/31409627/how-to-pass-a-2-dimensional-array-as-a-function-argument-in-go/31410075#31410075", "title": "How to pass a 2 dimensional array as a function argument in Go?", "body": "<p>The easiest way to use slices. Unlike arrays they are passed by reference,not by value. For example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Matrix [][]float64\nfunc main() {\n    oneMatrix := Matrix{{1, 2}, {2, 3}}\n    twoMatrix := Matrix{{1, 2,3}, {2, 3,4}, {5, 6,7}}\n    print (oneMatrix)\n    print (twoMatrix)\n\n}\nfunc print(X Matrix) {\n    for _, i := range X {\n        for _, j := range i {\n            fmt.Printf(\"%f \", j)\n        }\n        fmt.Println()\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UV_0HcOwsE\">link:</a> </p>\n"}], "owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2318, "favorite_count": 0, "accepted_answer_id": 31410075, "answer_count": 1, "score": 2, "last_activity_date": 1436885532, "creation_date": 1436884373, "question_id": 31409627, "link": "https://stackoverflow.com/questions/31409627/how-to-pass-a-2-dimensional-array-as-a-function-argument-in-go", "title": "How to pass a 2 dimensional array as a function argument in Go?", "body": "<p>So I want to be able to pass a matrix as a function in an argument in Golang.  It could be a different size each time - e.g., a 4x4 matrix, 3x2 matrix, etc.  If I try running the test code below against the source code I get an error message like:</p>\n\n<p>How do I pass a 2 dimensional array into a function?  I'm new to Go and come from a dynamic language background (Python, Ruby).</p>\n\n<pre><code>cannot use mat[:][:] (type [][3]int) as type [][]int in argument to zeroReplaceMatrix\n</code></pre>\n\n<p><strong>source code</strong></p>\n\n<pre><code>func ReplaceMatrix(mat [][]int, rows, cols, a, b int) {\n\n}\n</code></pre>\n\n<p><strong>test code</strong></p>\n\n<pre><code>func TestReplaceMatrix(t *testing.T) {\n    var mat [3][3]int\n    //some code\n    got := ReplaceMatrix(mat[:][:], 3, 3, 0, 1)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 4, "last_activity_date": 1436882053, "creation_date": 1436882053, "answer_id": 31408705, "question_id": 31406892, "link": "https://stackoverflow.com/questions/31406892/golang-how-is-func-interface-and-func-mystruct-incompatible-types/31408705#31408705", "title": "golang: how is &quot;func() interface {}&quot; and &quot;func() *MyStruct&quot; incompatible types?", "body": "<p>One workaround is to define an inline function that calls <code>personBuilder</code>.</p>\n\n<pre><code>printRetrievedItem(func() interface{} {return personBuilder()});\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/ct5pR1CLVh\" rel=\"nofollow\">Playground</a></kbd></p>\n"}, {"comments": [{"owner": {"reputation": 815, "user_id": 943428, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ea1c683f53f26b5d720da6d4b2162db?s=128&d=identicon&r=PG", "display_name": "uiron", "link": "https://stackoverflow.com/users/943428/uiron"}, "edited": false, "score": 0, "creation_date": 1436884086, "post_id": 31408842, "comment_id": 50792340, "body": "Yeah, but in my case I don&#39;t know common interface for an object (the consumer function just passes received object to third party reflection based functions, like JSON serialization)."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 3, "last_activity_date": 1436882383, "creation_date": 1436882383, "answer_id": 31408842, "question_id": 31406892, "link": "https://stackoverflow.com/questions/31406892/golang-how-is-func-interface-and-func-mystruct-incompatible-types/31408842#31408842", "title": "golang: how is &quot;func() interface {}&quot; and &quot;func() *MyStruct&quot; incompatible types?", "body": "<p>Either do a wrapper like @Grzegorz\u017bur suggested or define your own interface and make your <code>xxxxBuilder</code> return it:</p>\n\n<pre><code>type Namer interface {\n    Name() string\n}\n\ntype Person struct {\n    name string\n}\n\nfunc (p *Person) Name() string {\n    return p.name\n}\n\nfunc personBuilder() Namer {\n    return &amp;Person{name: \"John\"}\n}\n\nfunc printRetrievedItem(callback func() Namer) {\n    fmt.Printf(\"%T: %v\", callback(), callback().Name())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 815, "user_id": 943428, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ea1c683f53f26b5d720da6d4b2162db?s=128&d=identicon&r=PG", "display_name": "uiron", "link": "https://stackoverflow.com/users/943428/uiron"}, "edited": false, "score": 0, "creation_date": 1436883784, "post_id": 31408887, "comment_id": 50792078, "body": "yeah, though about that part, but in my particular case I wanted to decouple item producer and item consumer. I did not want to enforce special interface for item producer to implement so the consumer can use it. Thanks for explanation on compatibility though."}], "tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": false, "score": 3, "last_activity_date": 1436882484, "creation_date": 1436882484, "answer_id": 31408887, "question_id": 31406892, "link": "https://stackoverflow.com/questions/31406892/golang-how-is-func-interface-and-func-mystruct-incompatible-types/31408887#31408887", "title": "golang: how is &quot;func() interface {}&quot; and &quot;func() *MyStruct&quot; incompatible types?", "body": "<p>You can create an interface with a method that returns an <code>interface{}</code>:</p>\n\n<pre><code>type Thinger interface {\n    Thing() interface{}\n}\n\nfunc (p *Person) Thing() interface{} {\n    return p\n}\n\nfunc printRetrievedItem(t Thinger){\n    fmt.Print(t.Thing());\n}\n\nfunc doStuff(){\n    printRetrievedItem(personBuilder);\n}\n</code></pre>\n\n<p>This is just an example, please use a better name!</p>\n\n<p>To answer your question, <code>fun() A</code> is not a <code>func() interface{}</code>, for the same reason that <code>[]A</code> is not an <code>[]interface{}</code>. It's explained very well in the <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow\">go wiki</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 815, "user_id": 943428, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ea1c683f53f26b5d720da6d4b2162db?s=128&d=identicon&r=PG", "display_name": "uiron", "link": "https://stackoverflow.com/users/943428/uiron"}, "edited": false, "score": 0, "creation_date": 1436883908, "post_id": 31409167, "comment_id": 50792181, "body": "Hm, yeah, solves my question, but obviously not really an elegant code to be used in prod code. Maybe I&#39;ll just rethink the application structure in general (use channel to exchange objects between producer and consumer? don&#39;t know)"}, {"owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "reply_to_user": {"reputation": 815, "user_id": 943428, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ea1c683f53f26b5d720da6d4b2162db?s=128&d=identicon&r=PG", "display_name": "uiron", "link": "https://stackoverflow.com/users/943428/uiron"}, "edited": false, "score": 0, "creation_date": 1436884121, "post_id": 31409167, "comment_id": 50792360, "body": "@uiron agreed. Just wanted to show it was technically possible :-)"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1436884941, "post_id": 31409167, "comment_id": 50792998, "body": "@jabclab just keep in mind that function calls through reflection are extremely slow."}], "tags": [], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "is_accepted": true, "score": 1, "last_activity_date": 1436884163, "last_edit_date": 1495541167, "creation_date": 1436883137, "answer_id": 31409167, "question_id": 31406892, "link": "https://stackoverflow.com/questions/31406892/golang-how-is-func-interface-and-func-mystruct-incompatible-types/31409167#31409167", "title": "golang: how is &quot;func() interface {}&quot; and &quot;func() *MyStruct&quot; incompatible types?", "body": "<p>You can use <a href=\"http://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\">pkg <code>reflect</code></a> for this. (Note however that the solution of <a href=\"https://stackoverflow.com/users/145587/oneofone\"><strong>@OneOfOne</strong></a> is more idiomatic).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Person struct {\n    Name string\n}\n\nfunc personBuilder() *Person {\n    return &amp;Person{Name: \"John\"}\n}\n\nfunc printRetrievedItem(callback interface{}) {\n    vals := reflect.ValueOf(callback).Call([]reflect.Value{})\n    fmt.Println(vals[0].Interface())\n}\n\nfunc main() {\n    printRetrievedItem(personBuilder) // &amp;{John}\n    printRetrievedItem(func() string { return \"hello\" }) // hello\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PH9ieDOwdF\" rel=\"nofollow noreferrer\">Here</a>'s an example in the playground.</p>\n"}], "owner": {"reputation": 815, "user_id": 943428, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ea1c683f53f26b5d720da6d4b2162db?s=128&d=identicon&r=PG", "display_name": "uiron", "link": "https://stackoverflow.com/users/943428/uiron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2203, "favorite_count": 0, "accepted_answer_id": 31409167, "answer_count": 4, "score": 4, "last_activity_date": 1436884163, "creation_date": 1436877678, "last_edit_date": 1436882363, "question_id": 31406892, "link": "https://stackoverflow.com/questions/31406892/golang-how-is-func-interface-and-func-mystruct-incompatible-types", "title": "golang: how is &quot;func() interface {}&quot; and &quot;func() *MyStruct&quot; incompatible types?", "body": "<p>Suppose I have code, where a function accepts another one as an argument:</p>\n\n\n\n<pre><code>type Person struct {\n    Name string\n}\n\nfunc personBuilder() * Person {\n    return &amp;Person{Name: \"John\"}\n}\n\nfunc printRetrievedItem(callback func() interface {}){\n    fmt.Print(callback());\n}\n\nfunc doStuff(){\n    printRetrievedItem(personBuilder);\n}\n</code></pre>\n\n<p>This results in error <code>cannot use personBuilder (type func() *Person) as type func() interface {} in function argument</code>. If I change <code>personBuilder</code> return type to <code>interface{}</code>, it works, but in real project I'm working on I want to have a concrete type for clear design and TDD purposes.</p>\n\n<p>Does Go support such method signature generalization? What are the workarounds, if you could not change the <code>personBuilder</code> part (e.g. you have a lot parameterless functions that return different type of struct, and you want to build a consumer function that accepts any of those builders as argument)?</p>\n"}, {"tags": ["go", "deferred"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1436892719, "last_edit_date": 1436892719, "creation_date": 1436871490, "answer_id": 31404704, "question_id": 31404471, "link": "https://stackoverflow.com/questions/31404471/defer-usage-clarification/31404704#31404704", "title": "Defer usage clarification", "body": "<p>Generally what is important is <code>x</code> cannot be a parameter of the function you are deferring, because they are evaluated when <code>defer</code> is executed.</p>\n\n<h3>1) With Anonymous Function</h3>\n\n<p>Here's a solution using an anonymous function:</p>\n\n<pre><code>defer func() { fmt.Println(x) }()\n</code></pre>\n\n<p>Here <code>x</code> is not a parameter of the deferred anonymous function, so it will not be evaluated. Only when the anonymous function is executed and it calls <code>fmt.Println()</code>.</p>\n\n<h3>2) With Pointer</h3>\n\n<p>Using a pointer (like <code>&amp;x</code>) pointing to <code>x</code> would work, because only the address is evaluated, and the pointed value at the end will be <code>5</code> of course. The problem with this is that <code>fmt.Println()</code> will not print the pointed value but the pointer itself.</p>\n\n<p>But to demonstrate its working, see this helper function:</p>\n\n<pre><code>func Print(i *int) {\n    fmt.Println(*i)\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>defer Print(&amp;x) // Will print 5 at the end\n</code></pre>\n\n<h3>3) With custom type</h3>\n\n<p>This is similar to the pointer solution, but doesn't need a helper function. But it does need you to write your <code>String()</code> method:</p>\n\n<pre><code>type MyInt int\n\nfunc (m *MyInt) String() string {\n    return strconv.Itoa(int(*m))\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>var x MyInt\n\ndefer fmt.Println(&amp;x)\n\nfor i := 0; i &lt; 5; i++ {\n    x++\n}\n</code></pre>\n\n<p>When <code>defer</code> statement is executed, only the pointer will be evaluated (address of <code>x</code>, type of <code>*Myint</code>). And since the type <code>*MyInt</code> implements <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow\"><code>fmt.Stringer</code></a>, <code>fmt.Println()</code> will call its <code>String()</code> method.</p>\n\n<h3>4) Wrapping</h3>\n\n<p>This is also similar to the pointer solution, and this will not even print exactly just <code>5</code> as you expect, but:</p>\n\n<p>Problem with #2 was that <code>fmt.Println()</code> will print the pointer and not the pointed value (which we solved with our own <code>Print()</code> function). However there are other types which are similar to pointers and <code>fmt.Println()</code> will print their content.</p>\n\n<p>So let's wrap the variable into a slice, and see what happens:</p>\n\n<pre><code>x := []int{0}\n\ndefer fmt.Println(x)\n\nfor i := 0; i &lt; 5; i++ {\n    x[0]++\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>[5]\n</code></pre>\n\n<p>Reason for seeing <code>5</code> is that a slice is a descriptor. When <code>defer</code> is evaluated, a copy is made of the slice (that will be passed to <code>fmt.Println()</code> when it gets executed) but it refers to the same underlying array.</p>\n\n<p>Also note that <code>fmt.Println()</code> prints the pointed content if the pointer is a pointer to a struct, array, slice, maps, so the following code also works:</p>\n\n<pre><code>x := struct{ i int }{}\n\ndefer fmt.Println(&amp;x)\n\nfor i := 0; i &lt; 5; i++ {\n    x.i++\n}\n</code></pre>\n\n<p>And prints:</p>\n\n<pre><code>&amp;{5}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 4, "last_activity_date": 1436872575, "creation_date": 1436872575, "answer_id": 31405075, "question_id": 31404471, "link": "https://stackoverflow.com/questions/31404471/defer-usage-clarification/31405075#31405075", "title": "Defer usage clarification", "body": "<p>If the defer has arguments they are evaluated at the line of the defer-statement; this is illustrated in the following snippet, where the defer will print 0:</p>\n\n<pre><code>func printNumber() {\n   i := 0\n   defer fmt.Println(i) // will print 0\n   i++\n   return\n}\n</code></pre>\n\n<p>You can use an anonymous function as a defer statement if you want to postpone the execution of a statement or a function until the end of the enclosing (calling) function. Here is an updated example:</p>\n\n<pre><code>func printNumbers() {\n    x := 0\n    defer func() { fmt.Println(x) }()\n    for i:=0; i &lt; 5; i++ {\n        x++;\n    }\n    return\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/YQGQ_8a0_9\" rel=\"nofollow\">http://play.golang.org/p/YQGQ_8a0_9</a></p>\n"}], "owner": {"reputation": 315, "user_id": 5114718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5def6a646fae2b7ab3fe1b6a71213853?s=128&d=identicon&r=PG", "display_name": "Zallin", "link": "https://stackoverflow.com/users/5114718/zallin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 31405075, "answer_count": 2, "score": 2, "last_activity_date": 1436892719, "creation_date": 1436870884, "last_edit_date": 1436875410, "question_id": 31404471, "link": "https://stackoverflow.com/questions/31404471/defer-usage-clarification", "title": "Defer usage clarification", "body": "<p>Let's assume I have the following function</p>\n\n<pre><code>func printNumbers(){\n var x int\n\n defer fmt.Println(x)\n\n for i := 0; i &lt; 5; i++{\n  x++\n }\n}\n</code></pre>\n\n<p>As it is said in the <a href=\"http://golang.org/ref/spec#Defer_statements\" rel=\"nofollow\">specification</a>:</p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked.</p>\n</blockquote>\n\n<p>Obviously, zero will be printed out when the function execution ends. \nBut what should I do if I want to print out the final value of variable <code>x</code>?</p>\n\n<p>I've come up with the following solution:</p>\n\n<pre><code>func printNumbers(){\n  var x int\n\n  printVal := func(){\n    fmt.Println(x)\n  }\n\n  defer printVal()\n\n  for i := 0; i &lt; 5; i++{\n    x++\n  }\n}\n</code></pre>\n\n<p>So I wonder if there is a better way to resolve this problem.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 5, "creation_date": 1436851012, "post_id": 31398044, "comment_id": 50771581, "body": "The first three bytes are the <a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\" rel=\"nofollow noreferrer\">BOM</a> (239 187 191) for UTF-8. Have the server <i>not</i> include the UTF-8 BOM or toss out the first 3 bytes before processing the rest (which is the actual UTF-8 encoded string)."}, {"owner": {"reputation": 690, "user_id": 10009545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01bced6ffc06afc71a25d9d2913cd71c?s=128&d=identicon&r=PG&f=1", "display_name": "konstantin", "link": "https://stackoverflow.com/users/10009545/konstantin"}, "edited": false, "score": 0, "creation_date": 1618827330, "post_id": 31398044, "comment_id": 118711546, "body": "I got a similar error message: &quot;invalid character... looking for beginning of value&quot; when binding a request body to a model. The error in my case was client-side: The request payload data were sent with the wrong content type (not as json)."}], "answers": [{"comments": [{"owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 2, "creation_date": 1436858517, "post_id": 31399046, "comment_id": 50774961, "body": "Thank you, but not sure why Microsoft Web site will response with extra BOM identifiers."}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 5, "creation_date": 1436858758, "post_id": 31399046, "comment_id": 50775110, "body": "@EvanLin Welcome :) . It is strange behavior. The JSON specs (RFC7159) explicitly states that &quot;Implementations MUST NOT add a byte order mark&quot;. But it also says that decoding implementations &quot;MAY ignore the presence of a byte order mark    rather than treating it as an error&quot;, so trimming it away is okay."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 9, "creation_date": 1436882895, "post_id": 31399046, "comment_id": 50791388, "body": "@EvanLin &quot;Microsoft&quot;, that&#39;s why."}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 27, "last_activity_date": 1436855333, "last_edit_date": 1436855333, "creation_date": 1436854687, "answer_id": 31399046, "question_id": 31398044, "link": "https://stackoverflow.com/questions/31398044/got-error-invalid-character-%c3%af-looking-for-beginning-of-value-from-json-unmar/31399046#31399046", "title": "Got error &quot;invalid character &#39;&#239;&#39; looking for beginning of value\u201d from json.Unmarshal", "body": "<p>The server is sending you a UTF-8 text string with a <a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\">Byte Order Mark (BOM)</a>. The BOM identifies that the text is UTF-8 encoded, but it should be removed before decoding.</p>\n\n<p>This can be done with the following line (using <a href=\"http://golang.org/pkg/bytes/\">package \"bytes\"</a>):</p>\n\n<pre><code>body = bytes.TrimPrefix(body, []byte(\"\\xef\\xbb\\xbf\")) // Or []byte{239, 187, 191}\n</code></pre>\n\n<p>PS. The error referring to <code>\u00ef</code> is because the UTF-8 BOM interpreted as an ISO-8859-1 string will produce the characters <code>\u00ef\u00bb\u00bf</code>.</p>\n"}], "owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19349, "favorite_count": 6, "accepted_answer_id": 31399046, "answer_count": 1, "score": 15, "last_activity_date": 1436858449, "creation_date": 1436850372, "last_edit_date": 1436858449, "question_id": 31398044, "link": "https://stackoverflow.com/questions/31398044/got-error-invalid-character-%c3%af-looking-for-beginning-of-value-from-json-unmar", "title": "Got error &quot;invalid character &#39;&#239;&#39; looking for beginning of value\u201d from json.Unmarshal", "body": "<p>I use a Golang HTTP request to get json output as follow.\nThe web service I am trying to access is Micrsoft Translator <a href=\"https://msdn.microsoft.com/en-us/library/dn876735.aspx\" rel=\"noreferrer\">https://msdn.microsoft.com/en-us/library/dn876735.aspx</a></p>\n\n<pre><code>//Data struct of TransformTextResponse\ntype TransformTextResponse struct {\n    ErrorCondition   int    `json:\"ec\"`       // A positive number representing an error condition\n    ErrorDescriptive string `json:\"em\"`       // A descriptive error message\n    Sentence         string `json:\"sentence\"` // transformed text\n}\n\n\n//some code ....\nbody, err := ioutil.ReadAll(response.Body)\ndefer response.Body.Close()\nif err != nil {\n    return \"\", tracerr.Wrap(err)\n}\n\ntransTransform = TransformTextResponse{}\nerr = json.Unmarshal(body, &amp;transTransform)\nif err != nil {\n   return \"\", tracerr.Wrap(err)\n}\n</code></pre>\n\n<p>I got an error from <code>invalid character '\u00ef' looking for beginning of value</code></p>\n\n<p>So, I try to print the <code>body</code> as string <code>fmt.Println(string(body))</code>, it show:</p>\n\n<pre><code>{\"ec\":0,\"em\":\"OK\",\"sentence\":\"This is too strange i just want to go home soon\"}\n</code></pre>\n\n<p>It seems the data doesn't have any problem, so I tried to create the same value by <code>jason.Marshal</code></p>\n\n<pre><code>transTransform := TransformTextResponse{}\ntransTransform.ErrorCondition = 0\ntransTransform.ErrorDescriptive = \"OK\"\ntransTransform.Sentence = \"This is too strange i just want to go home soon\"\njbody, _ := json.Marshal(transTransform)\n</code></pre>\n\n<p>I found the original data might have problem, so I try to compare two data in <code>[]byte</code> format.</p>\n\n<p>Data from <code>response.Body</code>: </p>\n\n<pre><code>[239 187 191 123 34 101 99 34 58 48 44 34 101 109 34 58 34 79 75 34 44 34 115 101 110 116 101 110 99 101 34 58 34 84 104 105 115 32 105 115 32 116 111 111 32 115 116 114 97 110 103 101 32 105 32 106 117 115 116 32 119 97 110 116 32 116 111 32 103 111 32 104 111 109 101 32 115 111 111 110 34 125]\n</code></pre>\n\n<p>Data from <code>json.Marshal</code></p>\n\n<pre><code>[123 34 101 99 34 58 48 44 34 101 109 34 58 34 79 75 34 44 34 115 101 110 116 101 110 99 101 34 58 34 84 104 105 115 32 105 115 32 116 111 111 32 115 116 114 97 110 103 101 32 105 32 106 117 115 116 32 119 97 110 116 32 116 111 32 103 111 32 104 111 109 101 32 115 111 111 110 34 125]\n</code></pre>\n\n<p>Any idea how I parse this <code>response.Body</code> and Unmarshal it into data structure?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1436847759, "post_id": 31397516, "comment_id": 50770685, "body": "Yeah - in that doc in the &quot;Computing the Itable&quot; section it talks about computing the itables per-type, not per instance.  The Go guys are not dumb; should be no problem."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1436890671, "last_edit_date": 1436890671, "creation_date": 1436847213, "answer_id": 31397516, "question_id": 31397094, "link": "https://stackoverflow.com/questions/31397094/how-are-go-type-method-sets-allocated-in-memory/31397516#31397516", "title": "How are Go type method sets allocated in memory?", "body": "<p>The runtime allocates an <em>itable</em> when a concrete type is assigned to an interface type. The <em>itable</em> for the concrete type and interface type is cached and used on later assignments.</p>\n\n<p>As an example, this code will allocate one itable:</p>\n\n<pre><code>type Volume interface {\n    TurnItUp()\n    TurnItDown()\n}\nvar many []Volume\nfor i := 0; i &lt; 10000; i++ {\n    many = append(many, Custom{value: \"nowhere\"})\n}\n</code></pre>\n\n<p>and this code will allocate two itables, one for (Custom, Upper) and one for (Custom, Downer):</p>\n\n<pre><code>type Upper interface {\n    TurnItUp()\n}\ntype Downer interface {\n    TurnItDown()\n}\nvar uppers []Upper\nvar downers []Downer\nfor i := 0; i &lt; 10000; i++ {\n    uppers = append(uppers, Custom{value: \"nowhere\"})\n    downers = append(downers, Custom{value: \"nowhere\"})\n}\n</code></pre>\n\n<p>Because the example in the question does not assign a Custom value to an interface, no itables are created. </p>\n\n<p>The runtime uses static metadata data to construct itables. The static data is allocated and initialized once.</p>\n\n<p>See <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow\">Go Data Structures: Interfaces</a> for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 3, "last_activity_date": 1436872279, "creation_date": 1436872279, "answer_id": 31404960, "question_id": 31397094, "link": "https://stackoverflow.com/questions/31397094/how-are-go-type-method-sets-allocated-in-memory/31404960#31404960", "title": "How are Go type method sets allocated in memory?", "body": "<p>Bravada Zadada basically answered your question, but here's how you make a test that shows how many allocations does a certain action cause:</p>\n\n<pre><code>func TestMethods(t *testing.T) {\n    mem := testing.AllocsPerRun(10000000, func() {\n        _ = Custom{value: \"nowhere\"}\n    })\n    if mem != 0 {\n        t.Errorf(\"creating an object allocated %v memory\", mem)\n    }\n}\n</code></pre>\n\n<p>See <a href=\"http://golang.org/pkg/testing/#AllocsPerRun\" rel=\"nofollow\"><code>testing.AllocsPerRun</code></a> documentation. You can make similar tests with interfaces, pointer methods and what not.</p>\n"}], "owner": {"reputation": 150, "user_id": 3737839, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VRDR.jpg?s=128&g=1", "display_name": "Jordan L. Osier", "link": "https://stackoverflow.com/users/3737839/jordan-l-osier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 31397516, "answer_count": 2, "score": 0, "last_activity_date": 1436890671, "creation_date": 1436844383, "last_edit_date": 1436889422, "question_id": 31397094, "link": "https://stackoverflow.com/questions/31397094/how-are-go-type-method-sets-allocated-in-memory", "title": "How are Go type method sets allocated in memory?", "body": "<p>C++ avoids allocating memory for class methods every time an instance is created. My gut feeling is to assume that Go also mitigates this kind of duplication. Just to confirm, does Go store the method set of a custom struct only once?</p>\n\n<pre><code>type Custom struct {\n    value string\n}\n\nfunc (c Custom) TurnItUp() {\n    c.value = \"up\"\n}\n\nfunc (c Custom) TurnItDown() {\n    c.value = \"down\"\n}\n\n... // Many more methods defined for Custom. \n    // (Positive and negative directions in 100 dimensions)\n\nfunc main() {\n    var many []Custom\n    fmt.Println(\"Memory: \", foo.memory()) // Measure memory used.\n    for i := 0; i &lt; 10000; i++ {\n        append(many, Custom{value: \"nowhere\"})\n    } \n    fmt.Println(\"Memory: \", foo.memory()) // Measure memory used. \n}\n</code></pre>\n"}, {"tags": ["json", "go", "json-rpc"], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": -1, "last_activity_date": 1436853986, "creation_date": 1436853986, "answer_id": 31398822, "question_id": 31396924, "link": "https://stackoverflow.com/questions/31396924/golang-httpjsonrpc-access-from-web-page/31398822#31398822", "title": "golang http+jsonrpc access from web page", "body": "<p>a RPC framework shoud have language supports list, I not used json-rpc, but it should support javascript language by <a href=\"http://json-rpc.org/wiki/implementations\" rel=\"nofollow\">this link</a>. you need add one of the javascript client sdk listed there.</p>\n"}, {"tags": [], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "is_accepted": true, "score": 6, "last_activity_date": 1437013727, "last_edit_date": 1437013727, "creation_date": 1437012826, "answer_id": 31444294, "question_id": 31396924, "link": "https://stackoverflow.com/questions/31396924/golang-httpjsonrpc-access-from-web-page/31444294#31444294", "title": "golang http+jsonrpc access from web page", "body": "<p>FWIW, I got this working by making a simple HTTP handler that adapts the HTTP request/response to a ServerCodec.  Seems to work like a charm. </p>\n\n<p>Here's the working code as a test:</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"net/rpc\"\n    \"net/rpc/jsonrpc\"\n    \"testing\"\n)\n\n// adapt HTTP connection to ReadWriteCloser\ntype HttpConn struct {\n    in  io.Reader\n    out io.Writer\n}\n\nfunc (c *HttpConn) Read(p []byte) (n int, err error)  { return c.in.Read(p) }\nfunc (c *HttpConn) Write(d []byte) (n int, err error) { return c.out.Write(d) }\nfunc (c *HttpConn) Close() error                      { return nil }\n\n// our service\ntype CakeBaker struct{}\n\nfunc (cb *CakeBaker) BakeIt(n int, msg *string) error {\n    *msg = fmt.Sprintf(\"your cake has been bacon (%d)\", n)\n    return nil\n}\n\nfunc TestHTTPServer(t *testing.T) {\n\n    fmt.Printf(\"TestHTTPServer\\n\")\n\n    cb := &amp;CakeBaker{}\n\n    server := rpc.NewServer()\n    server.Register(cb)\n\n    listener, e := net.Listen(\"tcp\", \":4321\")\n    if e != nil {\n        log.Fatal(\"listen error:\", e)\n    }\n    defer listener.Close()\n\n    go http.Serve(listener, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        if r.URL.Path == \"/bake-me-a-cake\" {\n            serverCodec := jsonrpc.NewServerCodec(&amp;HttpConn{in: r.Body, out: w})\n            w.Header().Set(\"Content-type\", \"application/json\")\n            w.WriteHeader(200)\n            err := server.ServeRequest(serverCodec)\n            if err != nil {\n                log.Printf(\"Error while serving JSON request: %v\", err)\n                http.Error(w, \"Error while serving JSON request, details have been logged.\", 500)\n                return\n            }\n        }\n\n    }))\n\n    resp, err := http.Post(\"http://localhost:4321/bake-me-a-cake\", \"application/json\", bytes.NewBufferString(\n        `{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"CakeBaker.BakeIt\",\"params\":[10]}`,\n    ))\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"returned JSON: %s\\n\", string(b))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1894, "favorite_count": 2, "accepted_answer_id": 31444294, "answer_count": 2, "score": 3, "last_activity_date": 1437013727, "creation_date": 1436843037, "last_edit_date": 1436866205, "question_id": 31396924, "link": "https://stackoverflow.com/questions/31396924/golang-httpjsonrpc-access-from-web-page", "title": "golang http+jsonrpc access from web page", "body": "<p>I've used Go's <code>net/rpc</code> and <code>net/rpc/jsonrpc</code> packages a bit to perform connections between Go processes, however I'm wondering if there is a way to connect to an HTTP JSONRPC server using only the server tooling from the standard library (not that I have a problem writing my own, just don't want to do it if I don't have to).</p>\n\n<p>This is the basic server setup I have:</p>\n\n<pre><code>arith := new(server.Arith)\n\nserver := rpc.NewServer()\nserver.Register(arith)\n\nserver.HandleHTTP(rpc.DefaultRPCPath, rpc.DefaultDebugPath)\n\nlistener, e := net.Listen(\"tcp\", \":4321\")\nif e != nil {\n    log.Fatal(\"listen error:\", e)\n}\ndefer listener.Close()\n\nhttp.Serve(listener, http.DefaultServeMux)\n</code></pre>\n\n<p>And I'd like to be able to be hitting this from a web page or a simple command line CURL call - just a regular POST.</p>\n\n<p>However, this line: <a href=\"http://golang.org/src/net/rpc/server.go?s=20445:20475#L670\" rel=\"nofollow\">http://golang.org/src/net/rpc/server.go?s=20445:20475#L670</a> appears to indicate that it expects an HTTP client to issue a CONNECT and then directly write the JSON RPC request to the stream and receive the reply back the same way.  I don't know if this is even possible from a browser, but it certainly is not as common or compatible as a simple POST.</p>\n\n<p>Is there a way to start a JSON RPC server that I can just POST to using good ol' XMLHttpRequest ?</p>\n\n<p>EDIT: Crap - the above is not even using the jsonrpc stuff - this is probably trying to use Gob, but whatever - the problem is the same - the code in src/net/rpc/server.go is not going to handle POSTs, so this route overall isn't going to work regardless of server codec.</p>\n"}, {"tags": ["go", "synchronization", "race-condition"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1436888221, "last_edit_date": 1436888221, "creation_date": 1436832007, "answer_id": 31395450, "question_id": 31395316, "link": "https://stackoverflow.com/questions/31395316/is-type-assertion-of-a-dereferenced-pointer-a-memory-write-in-go/31395450#31395450", "title": "Is type assertion of a dereferenced pointer a memory write in go?", "body": "<p>A type assertion of a dereferenced pointer does not write to a variable in Go. </p>\n\n<p>This code</p>\n\n<pre><code>for read := range [chan of datastore.F] {\n   s.lock.Lock()\n   s.fs[read.Fi()] = &amp;read\n   s.lock.Unlock()\n}\n</code></pre>\n\n<p>sets the map value to the address of the local variable <code>read</code>. The variable <code>read</code> has a scope outside the for loop block and is modified on every iteration through the loop. All map values contain the same pointer, which is probably not what you intended.</p>\n\n<p>The closure reads the the variable <code>read</code> by dereferencing the pointer in the map. The race detector complains because there's no synchronization between the reader (the closure) and the writer (the for loop).</p>\n\n<p>To fix the problem, declare a new variable inside the loop:</p>\n\n<pre><code>for read := range [chan of datastore.F] {\n   read := read  // &lt;-- Add this line\n   s.lock.Lock()\n   s.fs[read.Fi()] = &amp;read\n   s.lock.Unlock()\n}\n</code></pre>\n\n<p>With this change, each map value points to a unique variable that is set once.</p>\n\n<p>It is rare to use pointers to interfaces in Go. The preferred fix to this problem is to change all use of the type <code>*datastore.F</code> to <code>datastore.F</code>. This change eliminates references to the the variable <code>read</code> across goroutine boundaries and eliminates an unnecessary level of indirection.</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 31395450, "answer_count": 1, "score": 2, "last_activity_date": 1436888221, "creation_date": 1436831117, "question_id": 31395316, "link": "https://stackoverflow.com/questions/31395316/is-type-assertion-of-a-dereferenced-pointer-a-memory-write-in-go", "title": "Is type assertion of a dereferenced pointer a memory write in go?", "body": "<p>The go race detector complains about my code in a way that makes no sense to me, but I guess that the authors of the race detector know more about this than I do.</p>\n\n<p>I have this closure:</p>\n\n<pre><code>func(f *datastore.F) bool {\n    a, ok := (*f).(*datastore.T)\n    ...\n}\n</code></pre>\n\n<p>that I pass as an argument to this function:</p>\n\n<pre><code>func GetFunc(f func(fid *datastore.F) bool) (*datastore.F, bool) {\n    kvs.lock.RLock()\n    defer kvs.lock.RUnlock()\n\n    for _, v := range kvs.fs {\n        if f(v) {\n            return v, true\n        }\n    }\n    return nil, false\n}\n</code></pre>\n\n<p>and this is the relevant part of the other goroutine:</p>\n\n<pre><code>for read := range [chan of datastore.F] {\n    s.lock.Lock()\n    s.fs[read.Fi()] = &amp;read\n    s.lock.Unlock()\n}\n</code></pre>\n\n<p><code>kvs</code> is an instance of this type:</p>\n\n<pre><code>type kvstore struct {\n    lock  sync.RWMutex\n    fs map[datastore.Fi]*datastore.F\n}\n</code></pre>\n\n<p><code>datastore.F</code> is an interface, and <code>*datastore.T</code> implements that interface.</p>\n\n<p>The race detector complains that the closure and the other goroutine have a data race. The other goroutine writes and the closure reads. What I don't see is how this could conflict, given the <code>sync.RWMutex</code> in place.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1436818790, "last_edit_date": 1436818790, "creation_date": 1436809434, "answer_id": 31389998, "question_id": 31389484, "link": "https://stackoverflow.com/questions/31389484/how-does-groupcache-in-go-compare-to-redis-and-memcached/31389998#31389998", "title": "How does groupcache in Go compare to redis and memcached?", "body": "<p>There are excellent Go clients for Redis and Memcache. There's no reason to rule these tools out because you are using Go.</p>\n\n<p>Pick the tool that best meets the functionality requirements of your application. There is some overlap in the functionality of these tools, but for the most part they are not replacements for each other. It's impossible for a third party like me to make a recommendation between these tools without knowing a lot more about your application, production environment, experience and more. </p>\n"}, {"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436822981, "post_id": 31392543, "comment_id": 50763940, "body": "Would you recommend redigo or radix or go-redis?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 2, "creation_date": 1436823798, "post_id": 31392543, "comment_id": 50764301, "body": "@Alex redigo is great"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436861528, "post_id": 31392543, "comment_id": 50776705, "body": "@Alex, from my experience with botg redigo and go-redis I can say that I&#39;ve found redigo to be much better in terms of documentation and ease of use. Granted, I haven&#39;t tested the latest go-redis v3. I can&#39;t speak about radix."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 4, "last_activity_date": 1436818353, "creation_date": 1436818353, "answer_id": 31392543, "question_id": 31389484, "link": "https://stackoverflow.com/questions/31389484/how-does-groupcache-in-go-compare-to-redis-and-memcached/31392543#31392543", "title": "How does groupcache in Go compare to redis and memcached?", "body": "<p>Groupcache is not meant to be a full replacement for Redis or Memcached. Groupcache for example doesn't support updating an item or deleting it. </p>\n\n<p>It's useful for \"hot\" items that you want to cache but are immutable.</p>\n\n<p>Also, compared to Redis, it doesn't support any of the advanced features that Redis supports because it has a different intended usage scenario.</p>\n\n<p>Unless you have such things, I'd recommend to stick to using Redis or Memcached.</p>\n\n<p>Indeed, if you can trick your implementation into making each item immutable by following some logic (maybe address the items by a key which includes a timestamp?) then you might be able to work-around it but I guess it might be too much work compared to just using other solutions.</p>\n\n<p>Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 1, "creation_date": 1436901391, "post_id": 31411840, "comment_id": 50803605, "body": "Do you know if it is more performant? There must be a reason that the creator of memcache created another caching tool. I don&#39;t quite understand the benefits."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 4, "creation_date": 1436998021, "post_id": 31411840, "comment_id": 50853194, "body": "One of the benefit is that groupcache can distribute the cache across the cluster automatically and also sync hot-spots. You can really read more from the differences here: <a href=\"https://github.com/golang/groupcache#comparison-to-memcached\" rel=\"nofollow noreferrer\">github.com/golang/groupcache#comparison-to-memcached</a>"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1453337008, "post_id": 31411840, "comment_id": 57562229, "body": "I&#39;d assume it&#39;s faster for the specific use case it was designed for, since performance was one of the reasons for creating it. Another benefit is groupcache mitigates the &#39;thundering herd&#39; problem memcache is susceptible to."}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 7, "last_activity_date": 1453337297, "last_edit_date": 1453337297, "creation_date": 1436890042, "answer_id": 31411840, "question_id": 31389484, "link": "https://stackoverflow.com/questions/31389484/how-does-groupcache-in-go-compare-to-redis-and-memcached/31411840#31411840", "title": "How does groupcache in Go compare to redis and memcached?", "body": "<p>Currently, groupcache is a library written in Go whereas there are many language bindings for redis, etc.</p>\n\n<p>groupcache was originally created to serve blobs of binary files for Google's static file servers.</p>\n\n<p>groupcache was originally written by the author of memcache, Brad Fitzpatrick.</p>\n\n<p>See also <a href=\"https://talks.golang.org/2013/oscon-dl.slide#43\" rel=\"noreferrer\">mention of Groupcache by the author in a presentation of the rewrite of dl.google.com from C++ to Go</a>.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4118, "favorite_count": 1, "accepted_answer_id": 31392543, "answer_count": 3, "score": 7, "last_activity_date": 1453337297, "creation_date": 1436807599, "question_id": 31389484, "link": "https://stackoverflow.com/questions/31389484/how-does-groupcache-in-go-compare-to-redis-and-memcached", "title": "How does groupcache in Go compare to redis and memcached?", "body": "<p>I was wondering if anyone with real life experience in groupcache and other memory caching tools such as redis and memcached knows how they compare to each other in terms of performance, ease of use, and other areas that are worth mentioning.</p>\n\n<p>The reason I am asking is because I am interested in completely switching over to Go, but I don't have much experience with it and no experience with groupcache.</p>\n"}, {"tags": ["reflection", "struct", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436805761, "post_id": 31388775, "comment_id": 50754450, "body": "What is it that is actually throwing the error?"}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436807403, "post_id": 31388775, "comment_id": 50755410, "body": "@JimB I added the code with some sparse comments."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1436809168, "post_id": 31388775, "comment_id": 50756508, "body": "Please make a <a href=\"http://stackoverflow.com/help/mcve\">minimal example</a> that shows the problem. In your code you have a &quot;csv&quot; package which doesn&#39;t exist in the stdlib, you have relative imports which you should not use, and <code>os.Error</code> which doesn&#39;t exist (well, technically it did, but not since go1 was released)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1436811073, "post_id": 31388775, "comment_id": 50757571, "body": "<code>time.Time</code> is a implemented as a struct, it does not implement your <code>Value</code> interface... no where in your code do you handle it so why would you expect your code to magically work with <code>time.Time</code>??"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1436811338, "post_id": 31388775, "comment_id": 50757747, "body": "BTW, since CSV is a text format, instead of making your own <code>Value</code> interface why not use <a href=\"https://golang.org/pkg/encoding/#TextMarshaler\" rel=\"nofollow noreferrer\"><code>encoding.TextMarshaler</code></a> and <a href=\"https://golang.org/pkg/encoding/#TextUnmarshaler\" rel=\"nofollow noreferrer\"><code>encoding.TextUnmarshaler</code></a>? A side effect of doing that would be <code>time.Time</code> (which implements both) would just work."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436814749, "post_id": 31388775, "comment_id": 50759640, "body": "@DaveC It&#39;s not actually my code, I was implementing another example. But now I see the issue as you have pointed out. I had inadvertently overlooked it. Thank you."}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1554, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436807866, "creation_date": 1436805367, "last_edit_date": 1436807866, "question_id": 31388775, "link": "https://stackoverflow.com/questions/31388775/reflect-on-time-type-in-go", "title": "Reflect on Time type in go", "body": "<p>I am trying to write a csv parser using the example provided <a href=\"https://gist.github.com/stevedonovan/1422274\" rel=\"nofollow\">here</a>. It works great for all native types but I am having trouble with any structs that contain a timestamp of type time.Time. It exits with an error of \"cannot convert this type\". </p>\n\n<p><b>This is the code.</b></p>\n\n<pre>\n//For each field in a given struct...\n    //Get a field\n    val := sv.Field(i)\n    // this is necessary because Kind can't tell \n    // distinguish between a primitive type\n    // and a type derived from it. We're looking \n    // for a Value interface defined on\n    // the pointer to this value\n    _, ok := val.Addr().Interface().(Value)\n    if ok {\n        val = val.Addr()\n        kind = value_k\n    } else {\n        switch Kind {\n        case reflect.Int, reflect.Int16, reflect.Int8, \n             reflect.Int32, reflect.Int64:\n            kind = int_k\n        case reflect.Uint, reflect.Uint16, reflect.Uint8, \n             reflect.Uint32, reflect.Uint64:\n            kind = uint_k\n        case reflect.Float32, reflect.Float64:\n            kind = float_k\n        case reflect.String:\n            kind = string_k\n        default:\n                  // Kind is Struct here\n            kind = value_k\n            _, ok := val.Interface().(Value)\n            if !ok {\n                err = os.NewError(\"cannot convert this type \")\n                this = nil\n                return\n            }\n        }\n    }\n</pre>\n\n<p>What this code does is take an interface and a reader. It attempts to match the field headers in the reader (csv file) with field names in the interface. It also reflects on the interface (struct) and collects positional a type information for later setting the fields in the iterator. It is this step that is failing for non-native types.</p>\n\n<p>I've tried a few methods to work around this but the only thing that seems to work is changing the timestamp to a string. I am undoubtedly missing something and would greatly appreciate some guidance.</p>\n"}, {"tags": ["multithreading", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1436798039, "post_id": 31386044, "comment_id": 50749124, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/6235317/why-doesnt-the-go-statement-execute-in-parallel\">Why doesn&#39;t the go statement execute in parallel?</a>"}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1436808503, "post_id": 31386044, "comment_id": 50756080, "body": "You&#39;re making the CPU do almost nothing. Why would you expect it to be the limiting factor?"}], "answers": [{"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436797969, "post_id": 31386105, "comment_id": 50749072, "body": "Can I just include &quot;runtime&quot;, and do runtime.GOMAXPROCS(2) inside of main before anything else or should I do it in a special way?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436798020, "post_id": 31386105, "comment_id": 50749111, "body": "@Alex correct, you just add it to the top of main (or even init()"}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436798063, "post_id": 31386105, "comment_id": 50749144, "body": "@Alex Yes, you can do it like that. However, for testing using an environment variable might be easier. For example, you could test like this: <code>GOMAXPROCS=X .&#47;YourBinary</code>."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1436799059, "post_id": 31386105, "comment_id": 50749893, "body": "I changed the code and the results from wrk increased, but not the results from ab. Does anyone know why this is the case? When doing benchmarking on facebooks HHVM on ab I do get to see the increase. But not on go for some reason."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 4, "creation_date": 1436801273, "post_id": 31386105, "comment_id": 50751483, "body": "@Alex: Because <code>ab</code> uses http1.0, and sets keepalive off by default.  A single <code>ab</code> process can&#39;t keep up with the go server, so you&#39;re basically benchmarking the benchmark tool. I recommend not using <code>ab</code> at all."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436802186, "post_id": 31386105, "comment_id": 50752128, "body": "@JimB could you recommend and alternative benchmarking tool?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 2, "creation_date": 1436803022, "post_id": 31386105, "comment_id": 50752749, "body": "@dm03514: <code>wrk</code> isn&#39;t too bad, but as soon as the benchmark tool affects the measurements, you start to have problems. This server code does so little, that the benchmark tool makes a large impact on the result. Plus, not only do you have to take into account the tool&#39;s overhead, but the network, OS, and maybe even hardware (network card and drivers, numa scheduling, cache interference when running on the same host, etc). Real benchmarks are hard, and there is no one tool that does it all."}], "tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 6, "last_activity_date": 1436797743, "creation_date": 1436797743, "answer_id": 31386105, "question_id": 31386044, "link": "https://stackoverflow.com/questions/31386044/go-server-performance-is-the-same-when-adding-more-cores/31386105#31386105", "title": "Go server performance is the same when adding more cores", "body": "<p>You need to tell the Go runtime to use more cores by setting the environment variable <code>GOMAXPROCS</code> to your desired core count. Alternatively, there is also a <a href=\"https://godoc.org/runtime#GOMAXPROCS\">function</a> to change it.</p>\n\n<p>By default, this is set to one. As of <a href=\"https://tip.golang.org/doc/go1.5\">Go 1.5</a> it will be the number of cores in your system.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 31386105, "answer_count": 1, "score": 1, "last_activity_date": 1436806644, "creation_date": 1436797588, "last_edit_date": 1436806644, "question_id": 31386044, "link": "https://stackoverflow.com/questions/31386044/go-server-performance-is-the-same-when-adding-more-cores", "title": "Go server performance is the same when adding more cores", "body": "<p>I am trying to understand how the go server scales when adding more cores but it seems that I can't see an improvement and I don't know why.</p>\n\n<p>There does not seem to be a change in any way when increasing cores. Do I need to do something in the code to let it know that I want to use more than 1 core? Would that help on performance?</p>\n\n<p>The code I am using for the test is a simple server that outputs \"Hello World\".</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        w.Write([]byte(\"Hello World\"))\n    })\n    http.ListenAndServe(\":80\", nil)\n}\n</code></pre>\n\n<p>I am doing the tests on virtualbox.</p>\n\n<p>These results are with 1 core:</p>\n\n<pre><code>$ nproc\n1\n</code></pre>\n\n<p>Testing with ab with 1 core:</p>\n\n<pre><code>$ ab -n 10000 -c 1000 http://127.0.0.1/\n</code></pre>\n\n<p>Result from ab with 1 core:</p>\n\n<pre><code>Concurrency Level:      1000\nTime taken for tests:   1.467 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1280000 bytes\nHTML transferred:       110000 bytes\nRequests per second:    6815.42 [#/sec] (mean)\nTime per request:       146.726 [ms] (mean)\nTime per request:       0.147 [ms] (mean, across all concurrent requests)\nTransfer rate:          851.93 [Kbytes/sec] received    \n</code></pre>\n\n<p>Testing with wrk with 1 core:</p>\n\n<pre><code>$ wrk -t1 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Result from wrk with 1 core:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    32.32ms   15.79ms 279.10ms   77.01%\n    Req/Sec    24.61k     1.89k   27.77k    64.58%\n  121709 requests in 5.01s, 14.86MB read\nRequests/sec:  24313.72\nTransfer/sec:      2.97MB\n</code></pre>\n\n<p>Changing to 2 cores:</p>\n\n<pre><code>$ nproc\n2\n</code></pre>\n\n<p>Testing with ab with 2 cores:</p>\n\n<pre><code>$ ab -n 10000 -c 1000 http://127.0.0.1/\n</code></pre>\n\n<p>Result from ab with 2 cores:</p>\n\n<pre><code>Concurrency Level:      1000\nTime taken for tests:   1.247 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1280000 bytes\nHTML transferred:       110000 bytes\nRequests per second:    8021.12 [#/sec] (mean)\nTime per request:       124.671 [ms] (mean)\nTime per request:       0.125 [ms] (mean, across all concurrent requests)\nTransfer rate:          1002.64 [Kbytes/sec] received   \n</code></pre>\n\n<p>Testing with wrk with 2 cores:</p>\n\n<pre><code>$ wrk -t1 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Result with wrk with 2 cores:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    37.04ms    5.67ms  64.92ms   79.73%\n    Req/Sec    26.98k     1.97k   29.71k    66.00%\n  134040 requests in 5.06s, 16.36MB read\nRequests/sec:  26481.38\nTransfer/sec:      3.23MB   \n</code></pre>\n\n<p>Testing with wrk with 2 cores and 2 threads:</p>\n\n<pre><code>$ wrk -t2 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Results with wrk with 2 cores and 2 threads:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  2 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    29.32ms   29.21ms 505.22ms   98.47%\n    Req/Sec    13.48k     2.11k   18.16k    63.00%\n  134121 requests in 5.03s, 16.37MB read\nRequests/sec:  26680.46\nTransfer/sec:      3.26MB       \n</code></pre>\n\n<p>Changing to 4 cores:</p>\n\n<pre><code>$ nproc\n4\n</code></pre>\n\n<p>Testing with ab with 4 cores:</p>\n\n<pre><code>$ ab -n 10000 -c 1000 http://127.0.0.1/\n</code></pre>\n\n<p>Result with ab with 4 cores:</p>\n\n<pre><code>Concurrency Level:      1000\nTime taken for tests:   1.301 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1280000 bytes\nHTML transferred:       110000 bytes\nRequests per second:    7683.90 [#/sec] (mean)\nTime per request:       130.142 [ms] (mean)\nTime per request:       0.130 [ms] (mean, across all concurrent requests)\nTransfer rate:          960.49 [Kbytes/sec] received\n</code></pre>\n\n<p>Testing with wrk with 4 cores:  </p>\n\n<pre><code>$ wrk -t1 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Result with wrk with 4 cores:   </p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    36.84ms    5.78ms  58.23ms   77.43%\n    Req/Sec    26.69k     2.06k   30.19k    64.00%\n  132604 requests in 5.06s, 16.19MB read\nRequests/sec:  26207.42\nTransfer/sec:      3.20MB   \n</code></pre>\n\n<p>Testing with wrk with 4 cores and 4 threads:</p>\n\n<pre><code>$ wrk -t4 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Results with wrk with 4 cores and 4 threads:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  4 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    35.58ms   26.65ms 508.77ms   98.44%\n    Req/Sec     5.82k     2.21k   10.44k    64.85%\n  117089 requests in 5.10s, 14.29MB read\nRequests/sec:  22972.33\nTransfer/sec:      2.80MB   \n</code></pre>\n\n<p>I don't know if I can use go if it \"does not scale\" at all, with multiple cores. I don't understand how go works compared to other languages. When I run tests with facebooks HHVM it scales no problem out of the box when adding more cores.</p>\n\n<p>What can I do to see a performance gain in the go server when adding more cores?</p>\n\n<p>EDIT:</p>\n\n<p>After changing the initial code to:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"runtime\"\n)\n\nfunc main() {\n\n    runtime.GOMAXPROCS(4)\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        w.Write([]byte(\"Hello World\"))\n    })\n    http.ListenAndServe(\":80\", nil)\n}\n</code></pre>\n\n<p>The results from wrk were different, changing the GOMAXPROCS from 1 to 4 resulted in significant increase.</p>\n\n<p>Testing 1 thread 4 cores:</p>\n\n<pre><code>$ wrk -t1 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Result for 1 thread and 4 cores:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    11.00ms    4.33ms  53.58ms   83.83%\n    Req/Sec    48.65k     3.30k   55.18k    81.25%\n  242131 requests in 5.08s, 29.56MB read\nRequests/sec:  47658.92\nTransfer/sec:      5.82MB\n</code></pre>\n\n<p>Testing 4 thread 4 cores:</p>\n\n<pre><code>$ wrk -t4 -c1000 -d5s http://127.0.0.1:80/\n</code></pre>\n\n<p>Result for 4 thread and 4 cores:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/\n  4 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    15.47ms    8.49ms  99.35ms   80.88%\n    Req/Sec    14.98k     2.98k   27.42k    78.65%\n  298885 requests in 5.10s, 36.48MB read\nRequests/sec:  58639.84\nTransfer/sec:      7.16MB\n</code></pre>\n\n<p>But the tests with ab were the same. Does anyone know why it does not affect ab? When benchmarking with HHVM ab results also gets affected. But on go I get same results.</p>\n\n<pre><code>$ ab -n 10000 -c 1000 http://127.0.0.1/\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>Concurrency Level:      1000\nTime taken for tests:   1.410 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1280000 bytes\nHTML transferred:       110000 bytes\nRequests per second:    7094.18 [#/sec] (mean)\nTime per request:       140.961 [ms] (mean)\nTime per request:       0.141 [ms] (mean, across all concurrent requests)\nTransfer rate:          886.77 [Kbytes/sec] received\n</code></pre>\n"}, {"tags": ["mysql", "go", "gorp"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436804456, "post_id": 31385680, "comment_id": 50753661, "body": "Why do you have a nested query? How about <code>select count(1) from Table ... joins ect</code>. Not that it&#39;s going to solve your problem, but it could be related."}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436862705, "post_id": 31385680, "comment_id": 50777403, "body": "Because of the GROUP BY. COUNT does not respect the GROUP BY so you have to do a sub select."}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1436796559, "creation_date": 1436796559, "question_id": 31385680, "link": "https://stackoverflow.com/questions/31385680/golang-gorp-no-error-no-results", "title": "Golang GORP - No error, no results", "body": "<pre><code>dbCount, er2 = dbmap.SelectInt(\"SELECT COUNT(*) AS N FROM (SELECT av.id FROM Table av LEFT JOIN Table2 dt ON dt.`app_id` = av.`app_id` LEFT JOIN Table3 a ON a.`id` = av.`app_id` WHERE dt.`user_id` IN (?) OR a.`org_id` IN (?) GROUP BY av.id LIMIT ? OFFSET ?) tmp\", user_id, org_ids, limit, offset)\n</code></pre>\n\n<p><code>user_id = 1000</code><br>\n<code>org_ids = 13444,12444,10333</code><br>\n<code>limit = 25</code><br>\n<code>offset = 0</code></p>\n\n<p>Any idea why this returns no error or results in GO but when run directly on the database returns 1 result? There are no errors either.</p>\n"}, {"tags": ["http", "tcp", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436797394, "post_id": 31385487, "comment_id": 50748710, "body": "Looks like the server is closing the connections without proper content length headers. Did you check the headers and content returned?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436804707, "post_id": 31385487, "comment_id": 50753827, "body": "What is your rate of request/roughly how much data are you trying to pull per minute? I&#39;ve only ever received responses like that as a matter of hodge podge rate limiting..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436814114, "post_id": 31385487, "comment_id": 50759307, "body": "As the others have said, this is because the sever is closing the connection. Others possible reasons I&#39;ve encountered: The server has a timeout that consistently closes the connection at about the same time you&#39;re making the next request, or it&#39;s an poor reverse-proxy/server combination that is incorrectly closing requests without a <code>Connection: close</code> header."}, {"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436854184, "post_id": 31385487, "comment_id": 50772784, "body": "@evanmcdonnal added details in questions"}, {"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436854219, "post_id": 31385487, "comment_id": 50772798, "body": "@JimB I think same, but tcp_keepalive_time = 300 &amp; tcp_keepalive_time = 300"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1436883573, "post_id": 31385487, "comment_id": 50791913, "body": "<code>tcp_keepalive_time</code> is irrelevant. That just is the default interval for keepalive probes (plus the default http.Transport sets a 30s keepalive to begin with)."}], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1436964895, "post_id": 31409281, "comment_id": 50832268, "body": "I am not sure, but I think you are telling some thing like : body,err := GetResponseBytesByURL_raw( url, t1, t2) ;  if nil != err{body,err = GetResponseBytesByURL_raw( url, t1, t2)}"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1436966380, "post_id": 31409281, "comment_id": 50833436, "body": "@niraj.nijju: I&#39;m not sure what that that&#39;s doing, but it might be a simple way to test a retry."}, {"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1437050991, "post_id": 31409281, "comment_id": 50876344, "body": "I looked for MaxIdleConnsPerHost and I should use it, but I am confused with method, please suggest a way  <a href=\"http://play.golang.org/p/4yVkuqS2iU\" rel=\"nofollow noreferrer\">play.golang.org/p/4yVkuqS2iU</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1437053717, "post_id": 31409281, "comment_id": 50878455, "body": "@niraj.nijju: There&#39;s no reason to create a new Client and Transport each time. Not only does it waste resources, but you won&#39;t be able to reuse your connections at all. In your second example, it looks like you&#39;re initializing <code>client</code> twice for some reason (though the syntax in wrong). For your Transport, look at the configuration of http.DefaultTransport; you probably want a similar Dialer and TLSHandshakeTimeout."}, {"owner": {"reputation": 1779, "user_id": 253773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0797402e2558924b62845d0ac0fddbb3?s=128&d=identicon&r=PG", "display_name": "Jon Stevens", "link": "https://stackoverflow.com/users/253773/jon-stevens"}, "edited": false, "score": 0, "creation_date": 1608329002, "post_id": 31409281, "comment_id": 115559899, "body": "Good news, this has been addressed in go 1.16. <a href=\"https://tip.golang.org/doc/go1.16#net\" rel=\"nofollow noreferrer\">tip.golang.org/doc/go1.16#net</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 4, "last_activity_date": 1436893494, "last_edit_date": 1436893494, "creation_date": 1436883449, "answer_id": 31409281, "question_id": 31385487, "link": "https://stackoverflow.com/questions/31385487/golang-http-having-use-of-closed-network-connection-error/31409281#31409281", "title": "GOLANG, HTTP having &quot;use of closed network connection&quot; error", "body": "<p>When making connections at a high rate over the internet, it's very likely you're going to encounter <em>some</em> connection problems. You can't mitigate them completely, so you may want to add retry logic around the request. The actual error type at this point probably doesn't matter, but matching the error string for <code>use of closed network connection</code> or <code>connection reset by peer</code> is about the best you can do if you want to be specific. Make sure to limit the retries with a backoff, as some systems will drop or reset connections as a way to limit request rates, and you may get more errors the faster you reconnect.</p>\n\n<p>Depending on the number of remote hosts you're communicating with, you will want to increase <code>Transport.MaxIdleConnsPerHost</code> (the default is only 2). The fewer hosts you talk to, the higher you can set this. This will decrease the number of new connections made, and speed up the requests overall.</p>\n\n<p>If you can, try the go1.5 beta. There have been a couple changes around keep-alive connections that may help reduce the number of errors you see.</p>\n"}, {"comments": [{"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 1, "creation_date": 1437051891, "post_id": 31411754, "comment_id": 50877017, "body": "As I have to return response within 500ms otherwise my client will not care about my response and took decision on it&#39;s own, so I can&#39;t use large back off slots, but surely use retry if failed within 200ms. (This may increase load during peak, but let me try it.)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1436889786, "creation_date": 1436889786, "answer_id": 31411754, "question_id": 31385487, "link": "https://stackoverflow.com/questions/31385487/golang-http-having-use-of-closed-network-connection-error/31411754#31411754", "title": "GOLANG, HTTP having &quot;use of closed network connection&quot; error", "body": "<p>I recommend implementing an exponential back off or some other rate limiting mechanism on your side of the wire. There's not really anything you can do about those error, and using exponential back off won't necessarily make <em>you</em> get the data any faster either. But it can ensure that you get <em>all</em> the data and the API you're pulling from will surely appreciate the reduced traffic. Here's a link to one I found on GitHub; <a href=\"https://github.com/cenkalti/backoff\" rel=\"nofollow\">https://github.com/cenkalti/backoff</a></p>\n\n<p>There was another popular option as well though I haven't used either. Implementing one yourself isn't terribly difficult either and I could provide some sample of that on request. One thing I do recommend based off my experience is make sure you're using a retry function that has an abort channel. If you get to really long back off times then you'll want some way for the caller to kill it.</p>\n"}], "owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22176, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1436893494, "creation_date": 1436796086, "last_edit_date": 1436854286, "question_id": 31385487, "link": "https://stackoverflow.com/questions/31385487/golang-http-having-use-of-closed-network-connection-error", "title": "GOLANG, HTTP having &quot;use of closed network connection&quot; error", "body": "<p>I am getting a lot of error like below mentioned, </p>\n\n<p>read tcp xx.xx.xx.xx:80: <strong>use of closed network connection</strong></p>\n\n<p>read tcp xx.xx.xx.xx:80: <strong>connection reset by peer</strong></p>\n\n<p>//function for HTTP connection</p>\n\n<pre><code>func GetResponseBytesByURL_raw(restUrl, connectionTimeOutStr, readTimeOutStr string) ([]byte, error) {\n    connectionTimeOut, _ /*err*/ := time.ParseDuration(connectionTimeOutStr)\n    readTimeOut, _ /*err*/ := time.ParseDuration(readTimeOutStr)\n    timeout := connectionTimeOut + readTimeOut // time.Duration((strconv.Atoi(connectionTimeOutStr) + strconv.Atoi(readTimeOutStr)))\n    //timeout = 200 * time.Millisecond\n    client := http.Client{\n        Timeout: timeout,\n    }\n    resp, err := client.Get(restUrl)\n    if nil != err {\n        logger.SetLog(\"Error GetResponseBytesByURL_raw |err: \", logs.LevelError, err)\n        return make([]byte, 0), err\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    return body, err\n}\n</code></pre>\n\n<p>Update (July 14):</p>\n\n<p>Server : NumCPU=8, RAM=24GB, GO=go1.4.2.linux-amd64</p>\n\n<p>I am getting such error during some high traffic.\n<strong>20000-30000 request per minutes</strong>, and I have a <strong>time frame of 500ms to fetch response from third party api.</strong> </p>\n\n<p><strong>netstat status</strong> from my server (using : netstat -nat | awk '{print $6}' | sort | uniq -c | sort -n) to get frequency</p>\n\n<pre><code>      1 established)\n      1 Foreign\n      9 LISTEN\n     33 FIN_WAIT1\n    338 ESTABLISHED\n   5530 SYN_SENT\n  32202 TIME_WAIT\n</code></pre>\n\n<p><strong>sysctl -p</strong></p>\n\n<pre><code>**sysctl -p**\nfs.file-max = 2097152\nvm.swappiness = 10\nvm.dirty_ratio = 60\nvm.dirty_background_ratio = 2\nnet.ipv4.tcp_synack_retries = 2\nnet.ipv4.ip_local_port_range = 2000 65535\nnet.ipv4.tcp_rfc1337 = 1\nnet.ipv4.tcp_fin_timeout = 5\nnet.ipv4.tcp_keepalive_time = 300\nnet.ipv4.tcp_keepalive_probes = 5\nnet.ipv4.tcp_keepalive_intvl = 15\nnet.core.rmem_default = 31457280\nnet.core.rmem_max = 12582912\nnet.core.wmem_default = 31457280\nnet.core.wmem_max = 12582912\nnet.core.somaxconn = 65536\nnet.core.netdev_max_backlog = 65536\nnet.core.optmem_max = 25165824\nnet.ipv4.tcp_mem = 65536 131072 262144\nnet.ipv4.udp_mem = 65536 131072 262144\nnet.ipv4.tcp_rmem = 8192 87380 16777216\nnet.ipv4.udp_rmem_min = 16384\nnet.ipv4.tcp_wmem = 8192 65536 16777216\nnet.ipv4.udp_wmem_min = 16384\nnet.ipv4.tcp_max_tw_buckets = 1440000\nnet.ipv4.tcp_tw_recycle = 0\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv6.bindv6only = 1\nnet.ipv4.conf.all.rp_filter = 1\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv4.icmp_echo_ignore_broadcasts = 1\nerror: \"net.ipv4.icmp_ignore_bogus_error_messages\" is an unknown key\nkernel.exec-shield = 1\nkernel.randomize_va_space = 1\nnet.ipv4.conf.all.log_martians = 1\nnet.ipv4.conf.default.log_martians = 1\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.all.secure_redirects = 0\nnet.ipv4.conf.default.secure_redirects = 0\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1436795280, "post_id": 31385033, "comment_id": 50747196, "body": "I hardly understand your question but the title seems to ask something different than what the text is."}, {"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1436795500, "post_id": 31385033, "comment_id": 50747353, "body": "@inf For example if I have 1436795473 I should know that is July, Monday, today, for example"}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1436797749, "last_edit_date": 1436797749, "creation_date": 1436795670, "answer_id": 31385324, "question_id": 31385033, "link": "https://stackoverflow.com/questions/31385033/how-to-cluster-utc-in-milliseconds-to-months-which-belongs/31385324#31385324", "title": "How to cluster utc in milliseconds to months which belongs", "body": "<p>You can get the month and weekday with the time package:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    ms := int64(0)\n    t := time.Unix(0, ms*int64(time.Millisecond))\n    fmt.Println(t.Month(), t.Weekday())\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/cPRXZyFnTA\" rel=\"nofollow\">http://play.golang.org/p/cPRXZyFnTA</a></p>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436797749, "creation_date": 1436794960, "question_id": 31385033, "link": "https://stackoverflow.com/questions/31385033/how-to-cluster-utc-in-milliseconds-to-months-which-belongs", "title": "How to cluster utc in milliseconds to months which belongs", "body": "<p>Every document in <code>Mongo</code> has <code>timestamp in millisecond</code>s and I get array of documents as result of query.\nHow to cluster data to <code>array of arrays</code> where inner array are documents which <code>belongs to same month</code> ?\n( Have to to do this also for <code>weeks</code>, week starts at <code>Monday</code> and the last day is <code>Sunday</code>).</p>\n"}, {"tags": ["python", "go", "porting", "ternary-operator"], "comments": [{"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 4, "creation_date": 1436794359, "post_id": 31384764, "comment_id": 50746615, "body": "For this specific example the author used <code>and</code> and <code>or</code> as a poor-man&#39;s conditional expression (Python now has a proper conditional expression and the above should really be written as <code>self.items[-1] if self.items else None</code>)."}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 5, "creation_date": 1436794388, "post_id": 31384764, "comment_id": 50746636, "body": "The quality of that piece of code is generally terrible, however, even without the conditional expression. It is returning the last <code>self.items</code> value if available, or <code>None</code> if not. <code>self.items and self.items[-1] or None</code> would have done too, except where <code>self.items[-1]</code> is a false-y value such as <code>0</code> or <code>&#39;&#39;</code>, which is what the author tried to work around with the whole lists dance."}, {"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "reply_to_user": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 0, "creation_date": 1436794676, "post_id": 31384764, "comment_id": 50746834, "body": "So I don&#39;t need to worry about the fact that that &#39;hack&#39; can give incorrect results under certain conditions being deliberately left because that&#39;s what the author intended?"}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 2, "creation_date": 1436794945, "post_id": 31384764, "comment_id": 50747007, "body": "The author hacked a hack because the <code>and</code>..<code>or</code> hack can lead to incorrect results without such further messing about. Their version gives correct results but is unreadable and needlessly verbose. The version in my first comment is idiomatic Python and works correctly."}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 0, "creation_date": 1436795033, "post_id": 31384764, "comment_id": 50747059, "body": "Also see <a href=\"http://stackoverflow.com/q/394809\">Does Python have a ternary conditional operator?</a>"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "closed_date": 1436794279, "answer_count": 0, "score": 0, "last_activity_date": 1436794220, "creation_date": 1436794220, "question_id": 31384764, "link": "https://stackoverflow.com/questions/31384764/what-is-pythons-and-or-hack-and-how-can-it-be-emulated-in-go", "closed_reason": "Duplicate", "title": "What is Python&#39;s &quot;and/or hack&quot; and how can it be emulated in Go?", "body": "<p>I'm porting an Excel-style formula parser from Python to Go and came across this comment in the function definition of the token stack:</p>\n\n<pre><code>def token(self):\n        # Note: this uses Pythons and/or \"hack\" to emulate C's ternary operator (i.e. cond ? exp1 : exp2)\n        return ((len(self.items) &gt; 0) and [self.items[len(self.items) - 1]] or [None])[0]\n</code></pre>\n\n<p>I'm not really sure what the implications are of this, having only limited Python experience. I was going to attempt to literally translate as much of the code as possible and then debug later but as the author thought it important enough to warrant the comment, I feel like I should research this before I write anything.</p>\n\n<p>I know what the ternary operator is, and I know it's been called unsafe to use the above over if statements in Python but I think it's been left in to exploit this. Could someone with a better knowledge of Python explain to me why someone would use this so-called hack over the recommended way so I know how to emulate its behaviour?</p>\n\n<p>The full Python solution can be found <a href=\"http://www.ewbi.com/ewbi.develop/samples/jsport_nonEAT.html\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": ["web-services", "soap", "go", "ntlm", "windows-server-2012-r2"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437573378, "post_id": 31381805, "comment_id": 51085855, "body": "Gpack, FYI <a href=\"https://stackoverflow.com\">Stack Overflow</a> isn&#39;t a forum, it is undesirable to &quot;tag&quot; titles at all much less with [SOLVED]. Instead the existence of an accepted answer marks it as &quot;answered&quot; for display and search."}, {"owner": {"reputation": 639, "user_id": 3466729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76920232f54c864476c01e7454cdf522?s=128&d=identicon&r=PG&f=1", "display_name": "Gpack", "link": "https://stackoverflow.com/users/3466729/gpack"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437614645, "post_id": 31381805, "comment_id": 51107830, "body": "Understood. Sorry..."}], "answers": [{"tags": [], "owner": {"reputation": 639, "user_id": 3466729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76920232f54c864476c01e7454cdf522?s=128&d=identicon&r=PG&f=1", "display_name": "Gpack", "link": "https://stackoverflow.com/users/3466729/gpack"}, "is_accepted": true, "score": 0, "last_activity_date": 1437535799, "last_edit_date": 1495540269, "creation_date": 1437535799, "answer_id": 31553341, "question_id": 31381805, "link": "https://stackoverflow.com/questions/31381805/how-to-debug-ntlm-authentication-on-windows-server-2012-r2/31553341#31553341", "title": "How to debug NTLM authentication on Windows Server 2012 r2", "body": "<p>I eventually managed to solve my problem.\nIt came from the fact that I wasn't reading entirely the response body of my HTTP request in my golang program. Therefore, every time I made a request, the server interpreted as a new connection but the NTLM authentication scheme requires all the requests to be made in a single connection. It's actually this <a href=\"https://stackoverflow.com/questions/17948827/reusing-http-connections-in-golang\">answer</a> that solved my problem.</p>\n\n<p>For future coders, this is the code that you should use if you want to reuse the same connection:</p>\n\n<pre><code>res, _ := client.Do(req)\nio.Copy(ioutil.Discard, res.Body)\nres.Body.Close()\n</code></pre>\n\n<p>To conclude, I didn't manage to get much info from the logs of Windows. The tools that put me on the right track were the Failed Request Tracer that you can access from the IIS Manager and the goold old Wireshark to compare the requests made by my program and those of SoapUI.</p>\n\n<p>Hope this can be useful to someone.</p>\n"}], "owner": {"reputation": 639, "user_id": 3466729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76920232f54c864476c01e7454cdf522?s=128&d=identicon&r=PG&f=1", "display_name": "Gpack", "link": "https://stackoverflow.com/users/3466729/gpack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1627, "favorite_count": 1, "accepted_answer_id": 31553341, "answer_count": 1, "score": 1, "last_activity_date": 1437573275, "creation_date": 1436785825, "last_edit_date": 1437573275, "question_id": 31381805, "link": "https://stackoverflow.com/questions/31381805/how-to-debug-ntlm-authentication-on-windows-server-2012-r2", "title": "How to debug NTLM authentication on Windows Server 2012 r2", "body": "<p>I have set up a SOAP service on a virtual machine running Windows Server 2012 r2.\nI secured it using NTLM and I managed to access it from the host computer using <a href=\"http://soapui.org/downloads/soapui/open-source.html\" rel=\"nofollow\">SoapUI</a>. So far so good...</p>\n\n<p>I am now trying to access my service, still from the host, but using a golang program this time. I am using <a href=\"https://github.com/ThomsonReutersEikon/go-ntlm\" rel=\"nofollow\">this library</a> to do it (I only had to implement the GenerateNegotiateMessage() method and made sure that the Negotiate flags are the same as the ones of SoapUI).</p>\n\n<p>To make sure that I did things right, I downloaded the source code of SoapUI and compared the outputs (NegotiateMessage and AuthenticateMessage) of my golang program and SoapUI. If I fix the inputs (timestamp and random client challenge), I do get the same outputs. However, when I try to connect to the service, I get a 401 with \"Access is denied due to invalid credentials\". No need to say I'm 100% sure the credentials are right as I am able to access the service with the same credentials using SoapUI. So there must be something wrong in my go code. But to figure it out, I would need more logs from my Windows Server. Any idea of where I could start looking?</p>\n\n<p>Below is the web.config of my Soap service:</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;configuration&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"aspnet:UseTaskFriendlySynchronizationContext\" value=\"true\"/&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.5\"/&gt;\n    &lt;httpRuntime targetFramework=\"4.5\"/&gt;\n    &lt;trace enabled=\"true\" pageOutput=\"true\" requestLimit=\"40\" localOnly=\"false\"/&gt;\n  &lt;/system.web&gt;\n  &lt;system.serviceModel&gt;\n\n    &lt;diagnostics wmiProviderEnabled=\"true\"&gt;\n      &lt;messageLogging\n           logEntireMessage=\"true\"\n           logMalformedMessages=\"true\"\n           logMessagesAtServiceLevel=\"true\"\n           logMessagesAtTransportLevel=\"true\"\n           maxMessagesToLog=\"3000\"\n       /&gt;\n    &lt;/diagnostics&gt;\n\n    &lt;behaviors&gt;\n      &lt;serviceBehaviors&gt;\n        &lt;behavior&gt;\n          &lt;serviceMetadata httpGetEnabled=\"true\" httpsGetEnabled=\"false\"/&gt;\n          &lt;serviceDebug includeExceptionDetailInFaults=\"true\"/&gt;\n        &lt;/behavior&gt;\n      &lt;/serviceBehaviors&gt;\n    &lt;/behaviors&gt;\n\n    &lt;bindings&gt;\n      &lt;basicHttpBinding&gt;\n        &lt;binding&gt;\n          &lt;security mode=\"TransportCredentialOnly\"&gt;\n            &lt;transport clientCredentialType=\"Ntlm\" /&gt;\n          &lt;/security&gt;\n        &lt;/binding&gt;\n      &lt;/basicHttpBinding&gt;\n    &lt;/bindings&gt;\n\n    &lt;serviceHostingEnvironment aspNetCompatibilityEnabled=\"true\" multipleSiteBindingsEnabled=\"true\"/&gt;\n  &lt;/system.serviceModel&gt;\n  &lt;system.webServer&gt;\n    &lt;modules runAllManagedModulesForAllRequests=\"true\"/&gt;\n    &lt;directoryBrowse enabled=\"true\"/&gt;\n  &lt;/system.webServer&gt;\n  &lt;system.diagnostics&gt;\n    &lt;sources&gt;\n      &lt;source name=\"System.ServiceModel\" switchValue=\"All\" propagateActivity=\"true\"&gt;\n        &lt;listeners&gt;\n          &lt;add name=\"myListener\" type=\"System.Diagnostics.TextWriterTraceListener\" initializeData=\"C:\\logs\\TextWriterOutput.log\"/&gt;\n        &lt;/listeners&gt;\n      &lt;/source&gt;\n    &lt;/sources&gt;\n  &lt;/system.diagnostics&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Thanks a lot for your help!</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 1224, "user_id": 2052755, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ec83e8c62d4ad62a26ab4ee7771177d1?s=128&d=identicon&r=PG", "display_name": "user31986", "link": "https://stackoverflow.com/users/2052755/user31986"}, "edited": false, "score": 0, "creation_date": 1455847083, "post_id": 31380366, "comment_id": 58684288, "body": "Append behavior in Go: <a href=\"http://criticalindirection.com/2016/02/17/slice-with-a-pinch-of-salt/\" rel=\"nofollow noreferrer\">criticalindirection.com/2016/02/17/slice-with-a-pinch-of-sal&zwnj;&#8203;t</a>"}], "answers": [{"comments": [{"owner": {"reputation": 891, "user_id": 4033727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ceFYV.jpg?s=128&g=1", "display_name": "hanswim", "link": "https://stackoverflow.com/users/4033727/hanswim"}, "edited": false, "score": 0, "creation_date": 1436786832, "post_id": 31381190, "comment_id": 50741807, "body": "Thanks for @icza . I think I have understood this issue."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1436787340, "last_edit_date": 1436787340, "creation_date": 1436784054, "answer_id": 31381190, "question_id": 31380366, "link": "https://stackoverflow.com/questions/31380366/golang-problems-when-using-append-on-slice/31381190#31381190", "title": "Golang: Problems when using append on slice", "body": "<p>This is the code in question:</p>\n\n<pre><code>fmt.Println(\"===before,v:\", v)\nc := append(v[:i], append([]int{insertNum}, v[i:]...)...)\nfmt.Println(\"===after,v:\", v)\n</code></pre>\n\n<p>You ask why <code>v</code> changes between the 2 <code>Println()</code> statements.</p>\n\n<p>Because you are using the builtin <a href=\"http://golang.org/pkg/builtin/#append\" rel=\"nofollow\"><code>append()</code></a> function, quoting from its doc:</p>\n\n<blockquote>\n  <p>The append built-in function appends elements to the end of a slice. <strong>If it has sufficient capacity, the destination is resliced to accommodate the new elements.</strong> If it does not, a new underlying array will be allocated. Append returns the updated slice. </p>\n</blockquote>\n\n<p>So if the slice you append to has enough room (capacity) to accomodate the elements you want to append, no new slice will be allocated, instead the destination slice will be re-sliced (which will use the same underlying array) and append will happen in that.</p>\n\n<p>Let's check the capacity:</p>\n\n<pre><code>fmt.Println(\"===before,v:\", v, cap(v))\nc := append(v[:i], append([]int{insertNum}, v[i:]...)...)\nfmt.Println(\"===after,v:\", v, cap(v))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>===before,v: [1] 2\n===after,v: [2] 2\n</code></pre>\n\n<p>The <code>v</code> slice has a capacity of <code>2</code>. When <code>for</code> loop starts, <code>i=0</code>, <code>v[:i]</code> is <code>v[:0]</code> which is an empty slice (but has capacity <code>2</code>) and so appending 1 or 2 elements will not allocate a new array/slice, it will be done \"in place\". This \"in place\" is the 0th element of <code>v</code>, since <code>v[:i]</code> is shorthand for <code>v[0:i]</code>. Hence the elements will be appended starting from <code>v[0]</code> in the underlying array which is shared, so the element denoted by <code>v[0]</code> will change.</p>\n\n<p>Note that slicing a slice results in a slice which shares its underlying backing array with the original slice (does not make a copy of the elements).</p>\n\n<p>If you want to avoid this, use or allocate a new slice, <a href=\"http://golang.org/pkg/builtin/#copy\" rel=\"nofollow\">copy</a> original content and append to the new slice, e.g.:</p>\n\n<pre><code>src := []int{1, 2}\nc := make([]int, len(src))\ncopy(c, src)\n// Append something:\nc = append(c, 3, 4)\n\nfmt.Println(src) // [1 2] - src doesn't change\nfmt.Println(c)   // [1 2 3 4]\n</code></pre>\n"}], "owner": {"reputation": 891, "user_id": 4033727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ceFYV.jpg?s=128&g=1", "display_name": "hanswim", "link": "https://stackoverflow.com/users/4033727/hanswim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1014, "favorite_count": 0, "accepted_answer_id": 31381190, "answer_count": 1, "score": 1, "last_activity_date": 1540102530, "creation_date": 1436781561, "last_edit_date": 1436836143, "question_id": 31380366, "link": "https://stackoverflow.com/questions/31380366/golang-problems-when-using-append-on-slice", "title": "Golang: Problems when using append on slice", "body": "<p>I am using golang. Here is my code:</p>\n\n<pre><code>func main() {\n    quanPailie([]int{1, 2})\n}\n\nfunc quanPailie(nums []int) [][]int {\n    COUNT := len(nums)\n\n    //only one item\n    if COUNT == 1 {\n        return [][]int{nums}\n    }\n\n    insertItem(quanPailie(nums[:COUNT-1]), nums[COUNT-1])\n    return [][]int{}\n}\n\nfunc insertItem(res [][]int, insertNum int) {\n    fmt.Println(\"insertItem,res:\", res, \"insertNum\", insertNum) //insertItem,res: [[1]] insertNum 2\n\n    for _, v := range res {\n        for i := 0; i &lt; len(v); i++ {\n            fmt.Println(\"===before,v:\", v)\n            c := append(v[:i], append([]int{insertNum}, v[i:]...)...)\n            fmt.Println(\"===after,v:\", v)\n\n            fmt.Println(\"ccc\", c)\n\n        }\n    }\n}\n</code></pre>\n\n<p>What makes me very confused is the output:</p>\n\n<pre><code>===before,v: [1]\n===after,v: [2]\n</code></pre>\n\n<p>Why did the value of <code>v</code> change? Hope someone can help me. Thanks a lot.</p>\n\n<p>Go playground: <a href=\"https://play.golang.org/p/jBNFsCqUn3\" rel=\"nofollow\">https://play.golang.org/p/wITYsGpX7U</a></p>\n\n<p><strong>EDIT:</strong><br/>\nThanks for icza's great help, I think I have understood this problem.<br>\nAnd, here is a simple code to show this issue.</p>\n\n<pre><code>func test1() {\n    nums := []int{1, 2, 3}\n    _ = append(nums[:2], 4)\n    fmt.Println(\"test1:\", nums)\n\n    //nums changes because the cap is big enought, the original array is modified.\n\n}\n\nfunc test2() {\n    nums := []int{1, 2, 3}\n    c := append(nums[:2], []int{4, 5, 6}...)\n    fmt.Println(\"test2:\", nums)\n    fmt.Println(\"cc:\", c)\n\n    //nums dont't change because the cap isn't big enought.\n    //a new array is allocated while the nums still points to the old array.\n    //Of course, the return value of append points to the new array.\n}\n</code></pre>\n\n<p>Go playground: <a href=\"https://play.golang.org/p/jBNFsCqUn3\" rel=\"nofollow\">https://play.golang.org/p/jBNFsCqUn3</a></p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 1226, "user_id": 1716905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf004baf04689322a8766ebc1efd5e07?s=128&d=identicon&r=PG&f=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/1716905/luke"}, "edited": false, "score": 2, "creation_date": 1587648714, "post_id": 31868189, "comment_id": 108598253, "body": "The official documentation at <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md\" rel=\"nofollow noreferrer\">github.com/grpc/grpc-go/blob/master/Documentation/&hellip;</a> is really well done."}], "tags": [], "owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "is_accepted": true, "score": 18, "last_activity_date": 1574165889, "last_edit_date": 1574165889, "creation_date": 1438909932, "answer_id": 31868189, "question_id": 31379995, "link": "https://stackoverflow.com/questions/31379995/grpc-header-cookie-in-go/31868189#31868189", "title": "grpc header/cookie in Go", "body": "<p>Headers in gRPC are called \"Metadata.\" Clients can only send \"headers\". Servers can send both \"headers\" and \"trailers.\"</p>\n\n<p>You want to:</p>\n\n<ul>\n<li>Use the <code>google.golang.org/grpc/metadata</code> package and <code>metadata.NewContext()</code> to send metadata <em>from</em> the client-side. </li>\n<li>Use <code>grpc.SendHeader()</code> and <code>grpc.SetTrailer()</code> to send metadata <em>from</em> the server-side. </li>\n<li>Use the <code>grpc.Header()</code> and <code>grpc.Trailer()</code> <code>CallOptions</code> for receiving the <code>Metadata</code> <em>on</em> the client-side. </li>\n<li>Use <code>metadata.FromContext()</code> for receiving metadata <em>on</em> the server-side.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 3250, "user_id": 356645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c81c08678b0b7eec374998db6469f9aa?s=128&d=identicon&r=PG", "display_name": "shams", "link": "https://stackoverflow.com/users/356645/shams"}, "is_accepted": false, "score": 0, "last_activity_date": 1587493246, "creation_date": 1587493246, "answer_id": 61350406, "question_id": 31379995, "link": "https://stackoverflow.com/questions/31379995/grpc-header-cookie-in-go/61350406#61350406", "title": "grpc header/cookie in Go", "body": "<p>Shameless plug: support for cookies in gRPC <strong>Java</strong> implemented as a custom <code>ClientInterceptor</code>.\nCookies are managed by inspecting set-cookie HTTP headers received in the response from the server and by forwarding cookies using the cookie HTTP header in the request to the server.</p>\n\n<p><a href=\"https://github.com/shamsimam/grpc-java-cookies\" rel=\"nofollow noreferrer\">https://github.com/shamsimam/grpc-java-cookies</a></p>\n"}], "owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6605, "favorite_count": 3, "accepted_answer_id": 31868189, "answer_count": 2, "score": 4, "last_activity_date": 1587493246, "creation_date": 1436780417, "last_edit_date": 1459815012, "question_id": 31379995, "link": "https://stackoverflow.com/questions/31379995/grpc-header-cookie-in-go", "title": "grpc header/cookie in Go", "body": "<p>I want to do place on server application which can be called by Go APP and Java app both.  </p>\n\n<p>for some reason ,there's a cookie authentication and oAuth mechanism ,so I want to set one Go app as  Auth Micro-service for the authentication purpose.</p>\n\n<p>As GRPC is built on the HTTP2 ,so The headers and cookies are on the protocol.but I did not find out how to carry on header and cookie when the rpc occurs,implemented by Go, on GitHub I only found the JAVA-Implementation for headers at :</p>\n\n<pre><code>https://github.com/grpc/grpc-java/tree/master/examples/src/main/java/io/grpc/examples/header\n</code></pre>\n\n<p>Can anybody give me some direction of Go implementation for this purpose?</p>\n"}, {"tags": ["go", "types", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 317, "user_id": 1796494, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/x9Vj6.png?s=128&g=1", "display_name": "Babbleshack", "link": "https://stackoverflow.com/users/1796494/babbleshack"}, "edited": false, "score": 0, "creation_date": 1589548640, "post_id": 31379484, "comment_id": 109345472, "body": "Completely missed it haha."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 84, "last_activity_date": 1563908346, "last_edit_date": 1592644375, "creation_date": 1436778899, "answer_id": 31379484, "question_id": 31379404, "link": "https://stackoverflow.com/questions/31379404/is-this-casting-in-golang/31379484#31379484", "title": "Is this casting in golang?", "body": "<p>It's a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">Type assertion</a>. A type assertion can be used to:</p>\n<ul>\n<li>obtain a value of <em>concrete</em> type from a value of <em>interface</em> type</li>\n<li>or to obtain a value of a <em>different</em> interface type than the initial one (an interface with a different <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"noreferrer\">method set</a>, practically not subset of the original one as that could simply be obtained using a simple type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">conversion</a>).</li>\n</ul>\n<p>Quoting from the spec:</p>\n<blockquote>\n<p>For an expression <code>x</code> of interface type and a type <code>T</code>, the primary expression</p>\n<pre><code>x.(T)\n</code></pre>\n<p>asserts that <code>x</code> is not <code>nil</code> and that the value stored in <code>x</code> is of type <code>T</code>. The notation <code>x.(T)</code> is called a <em>type assertion</em>.</p>\n<p>More precisely, if <code>T</code> is not an interface type, <code>x.(T)</code> asserts that the dynamic type of <code>x</code> is <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"noreferrer\">identical</a> to the type <code>T</code>. In this case, <code>T</code> must <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"noreferrer\">implement</a> the (interface) type of <code>x</code>; otherwise the type assertion is invalid since it is not possible for <code>x</code> to store a value of type <code>T</code>. If <code>T</code> is an interface type, <code>x.(T)</code> asserts that the dynamic type of <code>x</code> implements the interface <code>T</code>.</p>\n</blockquote>\n<p>More specifically your example is a special form of it which also reports whether the type assertion holds. If not, <code>ok</code> will be <code>false</code>, and if the assertion holds, <code>ok</code> will be <code>true</code>.</p>\n<p>This special form never panics unlike the form of:</p>\n<pre><code>paxPayment = dataObject.(*entities.PassengerPayment)\n</code></pre>\n<p>Which if <code>dataObject</code> does not hold a value of type <code>*entities.PassengerPayment</code> will panic.</p>\n"}], "owner": {"reputation": 1109, "user_id": 4160987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0fe8027fb4a18d37c60f9ecd3268491e?s=128&d=identicon&r=PG&f=1", "display_name": "Varun Patro", "link": "https://stackoverflow.com/users/4160987/varun-patro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43013, "favorite_count": 8, "accepted_answer_id": 31379484, "answer_count": 1, "score": 64, "last_activity_date": 1563908346, "creation_date": 1436778603, "last_edit_date": 1550679660, "question_id": 31379404, "link": "https://stackoverflow.com/questions/31379404/is-this-casting-in-golang", "title": "Is this casting in golang?", "body": "<p><code>paxPayment, ok = dataObject.(*entities.PassengerPayment)</code></p>\n\n<p>What are the brackets used for? I'm not sure what is going on in this assignment operation.</p>\n\n<p>Do you need any more details to answer this question?</p>\n"}, {"tags": ["regex", "string", "algorithm", "replace", "go"], "answers": [{"comments": [{"owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "edited": false, "score": 0, "creation_date": 1436777840, "post_id": 31379008, "comment_id": 50736551, "body": "thanks, using this method, the performance improved by about 50%. i will wait to see if there are other answers."}, {"owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "edited": false, "score": 0, "creation_date": 1436778672, "post_id": 31379008, "comment_id": 50737075, "body": "how do i detect if there is a digit in input without iterating through the entire string?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "edited": false, "score": 1, "creation_date": 1436778750, "post_id": 31379008, "comment_id": 50737128, "body": "@paradite You can&#39;t, so it&#39;s a little overhead. But if you do so and find out that no digit is contained, you can immediately return the input string without doing anything else."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1496864350, "last_edit_date": 1496864350, "creation_date": 1436777322, "answer_id": 31379008, "question_id": 31378833, "link": "https://stackoverflow.com/questions/31378833/replacing-numbers-with-zeros-in-golang/31379008#31379008", "title": "Replacing numbers with zeros in golang", "body": "<p>The fastest solution is (always) building output on-the-fly. This requires to loop over the runes of the input once, and with a proper initial output \"buffer\" (which is <code>[]rune</code> in this case) you can also avoid reallocation.</p>\n\n<p><strong>Here is the implementation:</strong></p>\n\n<pre><code>func repNums(s string) string {\n    out := make([]rune, len(s)) // len(s) is bytes not runes, this is just estimation\n\n    i, added := 0, false\n    for _, r := range s {\n        if r &gt;= '0' &amp;&amp; r &lt;= '9' {\n            if added {\n                continue\n            }\n            added, out[i] = true, '0'\n        } else {\n            added, out[i] = false, r\n        }\n        i++\n    }\n    return string(out[:i])\n}\n</code></pre>\n\n<p><strong>Testing it:</strong></p>\n\n<pre><code>fmt.Printf(\"%q\\n\", repNums(\"abc826def47\")) // \"abc0def0\"\nfmt.Printf(\"%q\\n\", repNums(\"1234\"))        // \"0\"\nfmt.Printf(\"%q\\n\", repNums(\"asdf\"))        // \"asdf\"\nfmt.Printf(\"%q\\n\", repNums(\"\"))            // \"\"\nfmt.Printf(\"%q\\n\", repNums(\"a12b34c9d\"))   // \"a0b0c0d\"\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/7MFTB7vHhb\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Notes:</strong></p>\n\n<ul>\n<li>I estimated output buffer (number of runes) with <code>len(s)</code> which is not the rune count of the input but the bytes count. This is an upper estimation but requires no effort. You may use <a href=\"https://golang.org/pkg/unicode/utf8/#RuneCountInString\" rel=\"nofollow noreferrer\"><code>utf8.RuneCountInString()</code></a> to get the exact number of runes in input <code>string</code> if you wish so (but this decodes and loops over the runes of the input <code>string</code>, not really worth it).</li>\n<li>I test digits with the condition <code>r &gt;= '0' &amp;&amp; r &lt;= '9'</code>. Alternatively you may use <a href=\"https://golang.org/pkg/unicode/#IsDigit\" rel=\"nofollow noreferrer\"><code>unicode.IsDigit()</code></a></li>\n<li>Depending on the nature of your input strings, if the frequency of inputs where no digit is contained is high (and therefore output is equal to input), you may improve performance by first testing if there is a digit in input, and if not, simply return the input <code>string</code> (which is immutable).</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 371, "user_id": 10483800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95f8d1dd31ae836634d29cd9b6317fd4?s=128&d=identicon&r=PG", "display_name": "Anton Yurchenko", "link": "https://stackoverflow.com/users/10483800/anton-yurchenko"}, "is_accepted": false, "score": 1, "last_activity_date": 1582524938, "creation_date": 1582524938, "answer_id": 60370453, "question_id": 31378833, "link": "https://stackoverflow.com/questions/31378833/replacing-numbers-with-zeros-in-golang/60370453#60370453", "title": "Replacing numbers with zeros in golang", "body": "<p>You may use <strong>regexp</strong> package:</p>\n\n<pre><code>t := \"abc826def47\"\n\nre := regexp.MustCompile(`\\d`)\nr := re.ReplaceAllString(t, \"0\")\n</code></pre>\n\n<p>This will get you <code>abc000def00</code> out of <code>abc826def47</code>.</p>\n"}], "owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1232, "favorite_count": 0, "accepted_answer_id": 31379008, "answer_count": 2, "score": 3, "last_activity_date": 1582524938, "creation_date": 1436776754, "last_edit_date": 1436777717, "question_id": 31378833, "link": "https://stackoverflow.com/questions/31378833/replacing-numbers-with-zeros-in-golang", "title": "Replacing numbers with zeros in golang", "body": "<p>I want to replace all the numbers in a string with zeros, and ideally consecutive numbers should be replaced with one zero.<br>\n<code>abc826def47</code> should become <code>abc0def0</code></p>\n\n<p>I have tried two methods:<br>\n<strong>Using regex:</strong></p>\n\n<pre><code>var numbersRegExp = regexp.MustCompile(\"[0-9]+\")\nfunc normalizeNumbers(str string) string{\n    return numbersRegExp.ReplaceAllString(str, \"0\")\n}\n</code></pre>\n\n<p><strong>Using strings.Replace</strong></p>\n\n<pre><code>import s \"strings\"\nfunc normalizeNumbers(str string) string{\n    str = s.Replace(str, \"1\", \"0\", -1)\n    str = s.Replace(str, \"2\", \"0\", -1)\n    str = s.Replace(str, \"3\", \"0\", -1)\n    str = s.Replace(str, \"4\", \"0\", -1)\n    str = s.Replace(str, \"5\", \"0\", -1)\n    str = s.Replace(str, \"6\", \"0\", -1)\n    str = s.Replace(str, \"7\", \"0\", -1)\n    str = s.Replace(str, \"8\", \"0\", -1)\n    str = s.Replace(str, \"9\", \"0\", -1)\n    str = s.Replace(str, \"00\", \"0\", -1)\n    return str\n}\n</code></pre>\n\n<p>The second method without using regex seems to be a little faster, but still very slow when working with about 100k strings, and it does not replace consecutive numbers well.<br>\nIs there a better way of doing this?</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436772673, "post_id": 31377433, "comment_id": 50733763, "body": "You didn&#39;t try that code, since it doesn&#39;t compile."}, {"owner": {"reputation": 3164, "user_id": 514329, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/6YdMT.jpg?s=128&g=1", "display_name": "Mohsen", "link": "https://stackoverflow.com/users/514329/mohsen"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436773298, "post_id": 31377433, "comment_id": 50734094, "body": "@ rightfold: I tried it , just added more details."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 19, "last_activity_date": 1527956092, "last_edit_date": 1527956092, "creation_date": 1436773156, "answer_id": 31377793, "question_id": 31377433, "link": "https://stackoverflow.com/questions/31377433/getting-method-parameter-names/31377793#31377793", "title": "Getting method parameter names", "body": "<p>There is no way to get the names of the parameters of a method or a function.</p>\n\n<p>The reason for this is because the names are not really important for someone calling a method or a function. What matters is the types of the parameters and their order.</p>\n\n<p>A <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"noreferrer\">Function type</a> denotes the set of all functions with the same parameter and result types. The type of 2 functions having the same parameter and result types is identical regardless of the names of the parameters. The following code prints <code>true</code>:</p>\n\n<pre><code>func f1(a int) {}\nfunc f2(b int) {}\n\nfmt.Println(reflect.TypeOf(f1) == reflect.TypeOf(f2))\n</code></pre>\n\n<p>It is even possible to create a function or method where you don't even give names to the parameters (within a list of parameters or results, the names must either all be present or all be absent). This is valid code:</p>\n\n<pre><code>func NamelessParams(int, string) {\n    fmt.Println(\"NamelessParams called\")\n}\n</code></pre>\n\n<p>For details and examples, see <a href=\"https://stackoverflow.com/questions/40950877/is-unnamed-arguments-a-thing-in-go/40951013#40951013\">Is unnamed arguments a thing in Go?</a></p>\n\n<p>If you want to create some kind of framework where you call functions passing values to \"named\" parameters (e.g. mapping incoming API params to Go function/method params), you may use a <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\"><code>struct</code></a> because using the <code>reflect</code> package you can get the named fields (e.g. <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"noreferrer\"><code>Value.FieldByName()</code></a> and <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"noreferrer\"><code>Type.FieldByName()</code></a>), or you may use a <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\"><code>map</code></a>. See this related question: <a href=\"https://stackoverflow.com/questions/48153929/initialize-function-fields/48154019#48154019\">Initialize function fields</a></p>\n\n<p>Here is a relevant discussion on the <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/nM_ZhL7fuGc\" rel=\"noreferrer\">golang-nuts mailing list</a>.</p>\n"}], "owner": {"reputation": 3164, "user_id": 514329, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/6YdMT.jpg?s=128&g=1", "display_name": "Mohsen", "link": "https://stackoverflow.com/users/514329/mohsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10096, "favorite_count": 2, "accepted_answer_id": 31377793, "answer_count": 1, "score": 8, "last_activity_date": 1565436718, "creation_date": 1436771806, "last_edit_date": 1565436718, "question_id": 31377433, "link": "https://stackoverflow.com/questions/31377433/getting-method-parameter-names", "title": "Getting method parameter names", "body": "<p>Given the following Go method:</p>\n\n<pre><code>func (t *T) TMethod(data *testData) (interface{}, *error) {\n    ...\n}\n</code></pre>\n\n<p>I want to reflect the name of the parameter (which is <code>data</code> here).</p>\n\n<p>I tried the following, but it returns the structure name (which is <code>testData</code> here):</p>\n\n<pre><code>reflect.ValueOf(T).MethodByName(\"TMethod\").Type().In(0).Elem().Name()\n</code></pre>\n\n<p>How can I get the name of the parameter?</p>\n"}, {"tags": ["swift", "security", "go", "base64", "decode"], "comments": [{"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 1, "creation_date": 1436758526, "post_id": 31374733, "comment_id": 50729000, "body": "These two files appear to be <i>completely</i> different.  Are you <i>sure</i> you are doing the same encoding to both?"}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1436759049, "post_id": 31374733, "comment_id": 50729093, "body": "@TimBiegeleisen I&#39;m doing the encoding with the codes I provided. The decode is also problematic since they can&#39;t decode each others encoded strings. <a href=\"https://golang.org/src/encoding/base64/base64.go?s=1903:1947#L61\" rel=\"nofollow noreferrer\">golang.org/src/encoding/base64/base64.go?s=1903:1947#L61</a>"}, {"owner": {"reputation": 1731, "user_id": 3022173, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D4inY.jpg?s=128&g=1", "display_name": "mttdbrd", "link": "https://stackoverflow.com/users/3022173/mttdbrd"}, "edited": false, "score": 0, "creation_date": 1436763384, "post_id": 31374733, "comment_id": 50730050, "body": "@Thellimist What version of Go are you using?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436767332, "post_id": 31374733, "comment_id": 50731224, "body": "Space in the swift output looks suspicious: <code>...ACZjs EJ...</code>. base64 encoded string shouldn&#39;t contain spaces. Have a look at <a href=\"http://stackoverflow.com/questions/24769074/base64encodedstringwithoptions-in-swift-fails-with-compile-error\" title=\"base64encodedstringwithoptions in swift fails with compile error\">stackoverflow.com/questions/24769074/&hellip;</a>"}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436773724, "post_id": 31374733, "comment_id": 50734308, "body": "@kostya I tried the things in that link. but there are still spaces. If options made <code>NSDataBase64EncodingOptions.Encoding64CharacterLineLength</code> even <code>\\n</code> character appears. still it crashes at byte 220 which is the space character"}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 1731, "user_id": 3022173, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D4inY.jpg?s=128&g=1", "display_name": "mttdbrd", "link": "https://stackoverflow.com/users/3022173/mttdbrd"}, "edited": false, "score": 0, "creation_date": 1436774217, "post_id": 31374733, "comment_id": 50734575, "body": "@mttdbrd go version go1.4.2 darwin/amd64"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1436797442, "post_id": 31374733, "comment_id": 50748736, "body": "@Thellimist, there are no spaces in the file that you uploaded to dropbox. Why &#39;+&#39; was replaced with space in this string? Have you called URLDecode or similar on it? Also the files that you uploaded to dropbox are valid base64 files but they were created from different files. Please describe the exact steps including all details how you get the error otherwise it is impossible to answer what is wrong."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436802002, "post_id": 31374733, "comment_id": 50751996, "body": "@kostya you were right. When I send the data to go server the <code>+</code> are converted to spaces. I added <code>imageData = strings.Replace(imageData, &quot; &quot;, &quot;+&quot;, -1)</code> to go server and the bug got fixed. I&#39;m using <a href=\"https://github.com/nghialv/Net/\" rel=\"nofollow noreferrer\">github.com/nghialv/Net</a> for network. Couldn&#39;t find anything that could cause this. Also I&#39;m using <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin</a> for routing. Couldn&#39;t find anything that can cause this also."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436802059, "post_id": 31374733, "comment_id": 50752029, "body": "@kostya And still there is the problem where base64 are different but the images are same. I am positive where original images are the same but the encodings are different. Only scenario I can think of is <code>UIImageJPEGRepresentation(unwrappedImage, 1.0)</code> function changes the images."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436802346, "post_id": 31374733, "comment_id": 50752256, "body": "I am not familiar with iOS API but the source files are certainly different. <a href=\"http://stackoverflow.com/questions/17005456/calling-imagewithdatauiimagejpegrepresentation-multiple-times-only-compresses\" title=\"calling imagewithdatauiimagejpegrepresentation multiple times only compresses\">stackoverflow.com/questions/17005456/&hellip;</a> suggests that the function does not return the original image."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436802487, "post_id": 31374733, "comment_id": 50752355, "body": "@kostya Yes, I checked. The function does change the image even though the original image is jpeg."}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1440492408, "post_id": 31374733, "comment_id": 52283390, "body": "I have the same problem! I use Golang to base64 encode an API key for use in basic auth but the encoding is wrong. I can see the difference too if iI encode it with postman or other tools."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1440493066, "post_id": 31374733, "comment_id": 52283785, "body": "@Zahrec the problem was uiimagerepresentation changes the image. The encoding is correct"}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1440493110, "post_id": 31374733, "comment_id": 52283813, "body": "Thanks for the info."}], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1436760646, "post_id": 31375059, "comment_id": 50729435, "body": "I tried your style for another image which is JPG. <a href=\"http://codepad.org/8N4l63JF\" rel=\"nofollow noreferrer\">codepad.org/8N4l63JF</a> . Since they don&#39;t encode the same way I can&#39;t decode it either."}], "tags": [], "owner": {"reputation": 6288, "user_id": 2499076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72dcd37bc8460b1645d72f7a8248156e?s=128&d=identicon&r=PG", "display_name": "Ewan Mellor", "link": "https://stackoverflow.com/users/2499076/ewan-mellor"}, "is_accepted": false, "score": 4, "last_activity_date": 1436758643, "creation_date": 1436758643, "answer_id": 31375059, "question_id": 31374733, "link": "https://stackoverflow.com/questions/31374733/swift-and-golang-encoding-base64-gives-different-results/31375059#31375059", "title": "Swift and golang encoding base64 gives different results", "body": "<p>With your Swift-encoded string, this is clearly a JPEG generated in Photoshop (JFIF is the JPEG transport signature):</p>\n\n<pre><code>$ echo '/9j/4AAQSkZJRgABAQAASABIAAD/4QBYRXhpZgAATU0AKgAAAAgAAgESAAMAAAABAAEAAIdpAAQAAAABAAAAJgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABLKADAAQAAAABAAABLAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs' | base64 -D | hexdump -C\n00000000  ff d8 ff e0 00 10 4a 46  49 46 00 01 01 00 00 48  |......JFIF.....H|\n00000010  00 48 00 00 ff e1 00 58  45 78 69 66 00 00 4d 4d  |.H.....XExif..MM|\n00000020  00 2a 00 00 00 08 00 02  01 12 00 03 00 00 00 01  |.*..............|\n00000030  00 01 00 00 87 69 00 04  00 00 00 01 00 00 00 26  |.....i.........&amp;|\n00000040  00 00 00 00 00 03 a0 01  00 03 00 00 00 01 00 01  |................|\n00000050  00 00 a0 02 00 04 00 00  00 01 00 00 01 2c a0 03  |.............,..|\n00000060  00 04 00 00 00 01 00 00  01 2c 00 00 00 00 ff ed  |.........,......|\n00000070  00 38 50 68 6f 74 6f 73  68 6f 70 20 33 2e 30 00  |.8Photoshop 3.0.|\n00000080  38 42 49 4d 04 04 00 00  00 00 00 00 38 42 49 4d  |8BIM........8BIM|\n00000090  04 25 00 00 00 00 00 10  d4 1d 8c d9 8f 00 b2 04  |.%..............|\n000000a0  e9 80 09 98 ec                                    |.....|\n000000a5\n</code></pre>\n\n<p>With your Golang-generated string, nothing of the sort:</p>\n\n<pre><code>$ echo '/9j/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIASwBLAMBIgACEQEDEQH/xAGiAAABBQEBAQEB' | base64 -D | hexdump -C\n00000000  ff d8 ff db 00 84 00 08  06 06 07 06 05 08 07 07  |................|\n00000010  07 09 09 08 0a 0c 14 0d  0c 0b 0b 0c 19 12 13 0f  |................|\n00000020  14 1d 1a 1f 1e 1d 1a 1c  1c 20 24 2e 27 20 22 2c  |......... $.' \",|\n00000030  23 1c 1c 28 37 29 2c 30  31 34 34 34 1f 27 39 3d  |#..(7),01444.'9=|\n00000040  38 32 3c 2e 33 34 32 01  09 09 09 0c 0b 0c 18 0d  |82&lt;.342.........|\n00000050  0d 18 32 21 1c 21 32 32  32 32 32 32 32 32 32 32  |..2!.!2222222222|\n00000060  32 32 32 32 32 32 32 32  32 32 32 32 32 32 32 32  |2222222222222222|\n*\n00000080  32 32 32 32 32 32 32 32  ff c0 00 11 08 01 2c 01  |22222222......,.|\n00000090  2c 03 01 22 00 02 11 01  03 11 01 ff c4 01 a2 00  |,..\"............|\n000000a0  00 01 05 01 01 01 01 01                           |........|\n000000a8\n</code></pre>\n\n<p>You need to post your full Go code.  It looks like that's the code that's at fault.  That run of 0x32 is very suspicious.</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 780, "favorite_count": 3, "answer_count": 1, "score": 2, "last_activity_date": 1437417527, "creation_date": 1436755335, "last_edit_date": 1437417527, "question_id": 31374733, "link": "https://stackoverflow.com/questions/31374733/swift-and-golang-encoding-base64-gives-different-results", "title": "Swift and golang encoding base64 gives different results", "body": "<p>I'm encoding an image with swift using</p>\n\n<pre><code>let base64String = data!.base64EncodedStringWithOptions(NSDataBase64EncodingOptions(rawValue: 0))\n</code></pre>\n\n<p>the first 222 character of encoded string is <code>/9j/4AAQSkZJRgABAQAASABIAAD/4QBYRXhpZgAATU0AKgAAAAgAAgESAAMAAAABAAEAAIdpAAQAAAABAAAAJgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABLKADAAQAAAABAAABLAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ...</code></p>\n\n<p>I encoded the same image with golang using</p>\n\n<pre><code>sEnc := base64.StdEncoding.EncodeToString(imageData)\n</code></pre>\n\n<p>the first 224 character of encoded string is\n<code>/9j/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIASwBLAMBIgACEQEDEQH/xAGiAAABBQEBAQEB...</code></p>\n\n<hr>\n\n<p>When I decode the image in swift using </p>\n\n<pre><code>let decodedData = NSData(base64EncodedString: base64String, options: NSDataBase64DecodingOptions(rawValue: 0))\nvar decodedimage = UIImage(data: decodedData!)\n</code></pre>\n\n<p>the image looks exactly the same.</p>\n\n<p>When I decode swift generated base64 string in golang with</p>\n\n<pre><code>dec, err := base64.StdEncoding.DecodeString(imageData)\n</code></pre>\n\n<p>I'm getting error  while decoding base64 string: <code>illegal base64 data at input byte 220</code> which is the <code>+</code> character. But when I decode the golang generated base64 the output correct.</p>\n\n<p>Why are the encoded strings different? How can I fix it?</p>\n\n<p>EDIT: </p>\n\n<p>Swift last 10 bytes <code>eqvr h/9k=</code><br>\nGolang last 10 bytes <code>cvdR//2Q==</code></p>\n\n<p>EDIT2:</p>\n\n<p>In Golang I'm using <code>ioutil for reading file</code></p>\n\n<pre><code>b, err := ioutil.ReadFile(fileName)\n</code></pre>\n\n<p>EDIT3: </p>\n\n<p>Added results for a different test case\n<a href=\"https://www.dropbox.com/sh/zd1wj7ppjedrx6a/AAAoX15iztTimtav6U_8IF4Ma?dl=0\" rel=\"nofollow\">https://www.dropbox.com/sh/zd1wj7ppjedrx6a/AAAoX15iztTimtav6U_8IF4Ma?dl=0</a> </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1436748353, "post_id": 31374007, "comment_id": 50727104, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/27402956/is-it-possible-use-go-build-with-extra-build-steps\">Is it possible use Go build with extra build steps?</a>"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436749170, "post_id": 31374007, "comment_id": 50727261, "body": "if you are using protobuf I would suggest to commit generated code along with proto files. This way the library won&#39;t require protoc compiler being available on the user&#39;s machine."}], "answers": [{"tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": false, "score": 0, "last_activity_date": 1436927254, "creation_date": 1436927254, "answer_id": 31420481, "question_id": 31374007, "link": "https://stackoverflow.com/questions/31374007/how-can-i-make-go-get-hooks-for-my-go-project/31420481#31420481", "title": "How can I make go get hooks for my go project?", "body": "<p>You cannot add hook to <code>go get</code> build but you could use <a href=\"http://blog.golang.org/generate\" rel=\"nofollow\"><code>go generate</code></a> to get protobuffers compiled when compiling your go code.</p>\n"}], "owner": {"reputation": 381, "user_id": 1781243, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8cb61a49bf64231466660e3697cb2e6f?s=128&d=identicon&r=PG", "display_name": "Dakota West", "link": "https://stackoverflow.com/users/1781243/dakota-west"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436927254, "creation_date": 1436748096, "question_id": 31374007, "link": "https://stackoverflow.com/questions/31374007/how-can-i-make-go-get-hooks-for-my-go-project", "title": "How can I make go get hooks for my go project?", "body": "<p>Example: In a project with protobuffers, how can I require that when the package is go get'd, the protobuffers are compiled before attempting to build?</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436767692, "post_id": 31371339, "comment_id": 50731390, "body": "I am not aware of any guarantee that two gob encodings of the same value will produce the same bytes."}, {"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436771620, "post_id": 31371339, "comment_id": 50733222, "body": "@BravadaZadada well if not that would be another reason to use BSON (one presumes it&#39;s true there or searches would be hard)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436794015, "post_id": 31371339, "comment_id": 50746370, "body": "Mgo encodes struct fields in definition order, but I don&#39;t see anything in the documentation that guarantees the order. Mgo&#39;s own tests assume that fields are encoded in definition order. I suggest filing an issue with mgo requesting that the order be documented."}, {"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1436870470, "post_id": 31371339, "comment_id": 50782336, "body": "@BravadaZadada done - <a href=\"https://github.com/go-mgo/mgo/issues/132\" rel=\"nofollow noreferrer\">github.com/go-mgo/mgo/issues/132</a>"}], "answers": [{"comments": [{"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "edited": false, "score": 0, "creation_date": 1436869693, "post_id": 31399712, "comment_id": 50781875, "body": "How do you BSON is guaranteed to keep order?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "edited": false, "score": 0, "creation_date": 1436922015, "post_id": 31399712, "comment_id": 50812058, "body": "I not want to say more about BSON. The really problem is not to marshal twice, and my solution works for it."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1436921924, "last_edit_date": 1436921924, "creation_date": 1436856930, "answer_id": 31399712, "question_id": 31371339, "link": "https://stackoverflow.com/questions/31371339/is-mgo-bson-marshalling-guaranteed-to-preserve-order-of-struct-components/31399712#31399712", "title": "Is mgo bson marshalling guaranteed to preserve order of struct components?", "body": "<p>BSON keeps order. I would do all secret in a couple of simple wrap function:</p>\n\n<pre><code>type StructWrap struct{\n    Value bson.Raw\n    Hash []byte\n}\n\nfunc save2mgo(in interface{}){\n    str := StructWrap{}\n    orig,_err := bson.Marshal(in)\n    str.Value = bson.Raw{0, orig}\n    str.Hash = &lt;do hash based on orig bytes&gt;\n    //to save str to mgo. because Value already in bson.Raw, it will not do marshal again.\n}\n\nfunc unmarshal(inType interface{}){\n    //read from mgo\n    //check str.Hash here \n    str.Value.Unmarshal(inType)\n}\n</code></pre>\n\n<p>hope can help you.</p>\n"}, {"comments": [{"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "edited": false, "score": 0, "creation_date": 1437059636, "post_id": 31455750, "comment_id": 50883126, "body": "Thanks - that is my problem exactly. Currently I&#39;m serialising manually by iterating through the fields in definition order with the <code>structs</code> package. I note your spec doesn&#39;t currently include unambiguous ways of serializing time, which is something to think about (<code>go</code> and <code>gob</code> hold time to a greater precision than <code>bson</code>)."}], "tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": true, "score": 1, "last_activity_date": 1437053688, "creation_date": 1437053688, "answer_id": 31455750, "question_id": 31371339, "link": "https://stackoverflow.com/questions/31371339/is-mgo-bson-marshalling-guaranteed-to-preserve-order-of-struct-components/31455750#31455750", "title": "Is mgo bson marshalling guaranteed to preserve order of struct components?", "body": "<p>Answering your actual question, yes, you can trust <code>mgo/bson</code> to always marshal struct fields in the order they are observed in the code. Although not yet documented (<a href=\"https://github.com/go-mgo/mgo/issues/132\" rel=\"nofollow\">issue</a>), this is very much intentional behavior, and even mgo itself depends on it internally.</p>\n\n<p>Now, responding to your intended usage: <em>don't do that.</em> The fact fields are in a guaranteed order does not mean the binary format is stable as a whole. Even now there are known ways the output can change without breaking even the existing clients, but that would break a hash of its output.</p>\n\n<p>Here is some suggested reading to understand a bit better the ins and outs of the problem you are trying to solve (I'm the author):</p>\n\n<ul>\n<li><a href=\"http://blog.labix.org/2013/06/25/strepr-v1\" rel=\"nofollow\">http://blog.labix.org/2013/06/25/strepr-v1</a></li>\n<li><a href=\"http://blog.labix.org/2013/07/03/reference-strepr-implementation\" rel=\"nofollow\">http://blog.labix.org/2013/07/03/reference-strepr-implementation</a></li>\n</ul>\n\n<p>This is precisely addressing the issue of marshaling an arbitrary or map with arbitrary fields and keys in a stable way, to obtain a stable hash out of it for signatures. The reference implementation is in Go. </p>\n"}], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "accepted_answer_id": 31455750, "answer_count": 2, "score": 1, "last_activity_date": 1437053688, "creation_date": 1436727005, "question_id": 31371339, "link": "https://stackoverflow.com/questions/31371339/is-mgo-bson-marshalling-guaranteed-to-preserve-order-of-struct-components", "title": "Is mgo bson marshalling guaranteed to preserve order of struct components?", "body": "<p>I am saving go structs in mongo using mgo. I wish to save them with a hash of that struct (and a secret) to determine whether they have been tampered with (and I do not wish the mongo db itself to have the secret).</p>\n\n<p>Currently I am hashing the structs by serializing them using <code>gob</code> whose ordering of struct components is well-defined. This works great, save when I go to reread the struct from mango, things have changed - to be precise the time values in mongo have truncated accuracy compared to go - therefore the hashes do not match up.</p>\n\n<p>My planned work around for this is simply to marshall and unmarshall the struct from BSON before calculating the hash, i.e.:</p>\n\n<ul>\n<li>Marshal struct to BSON</li>\n<li>Unmarshal struct from BSON (thereby losing precision on time)</li>\n<li>Marshall struct to gob and hash resultant <code>[]byte</code></li>\n<li>Put hash in struct</li>\n<li>Save struct to mongo</li>\n</ul>\n\n<p>Now, that's more than a little circuitous.</p>\n\n<p>If I could guaranteed that the BSON itself always preserved order of components in structs, I could:</p>\n\n<ul>\n<li>Marshal struct to BSON</li>\n<li>hash resultant <code>byte[]</code></li>\n<li>Put hash in struct</li>\n<li>Save struct to mongo</li>\n</ul>\n\n<p>Which would be less nasty (albeit that it would still require converting to BSON twice).</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 901, "user_id": 3615752, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95f412691055035fad3a563e8b162dc4?s=128&d=identicon&r=PG&f=1", "display_name": "kamal", "link": "https://stackoverflow.com/users/3615752/kamal"}, "edited": false, "score": 1, "creation_date": 1485959493, "post_id": 31372630, "comment_id": 71142253, "body": "What about query parameters? @elithrar"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 901, "user_id": 3615752, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95f412691055035fad3a563e8b162dc4?s=128&d=identicon&r=PG&f=1", "display_name": "kamal", "link": "https://stackoverflow.com/users/3615752/kamal"}, "edited": false, "score": 1, "creation_date": 1485979621, "post_id": 31372630, "comment_id": 71154859, "body": "@kamal &quot;Query strings in Go are accessed via r.URL.Query&quot;"}, {"owner": {"reputation": 1082, "user_id": 561323, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4f84ac855299c2b0ab55c570814a4522?s=128&d=identicon&r=PG", "display_name": "Grim", "link": "https://stackoverflow.com/users/561323/grim"}, "edited": false, "score": 0, "creation_date": 1511348522, "post_id": 31372630, "comment_id": 81820232, "body": "There is a typo in the code it has to be <code>if len(productTypes) &gt;= 1</code>"}, {"owner": {"reputation": 2695, "user_id": 1130342, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52ff3fc6190f6f2b4813a5683697fbf6?s=128&d=identicon&r=PG", "display_name": "Luke Pighetti", "link": "https://stackoverflow.com/users/1130342/luke-pighetti"}, "edited": false, "score": 0, "creation_date": 1562193079, "post_id": 31372630, "comment_id": 100305825, "body": "I expected <code>mux.Vars(r)</code> to return query parameters as well, but it does not seem to. Can anyone confirm?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 2695, "user_id": 1130342, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52ff3fc6190f6f2b4813a5683697fbf6?s=128&d=identicon&r=PG", "display_name": "Luke Pighetti", "link": "https://stackoverflow.com/users/1130342/luke-pighetti"}, "edited": false, "score": 1, "creation_date": 1562223312, "post_id": 31372630, "comment_id": 100312134, "body": "@LukePighetti <code>mux.Vars(r)</code> returns the route variables from mux. Query parameters are returned via <code>r.URL.Query</code>."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 31, "last_activity_date": 1511363182, "last_edit_date": 1511363182, "creation_date": 1436735430, "answer_id": 31372630, "question_id": 31371111, "link": "https://stackoverflow.com/questions/31371111/mux-vars-not-working/31372630#31372630", "title": "mux.Vars not working", "body": "<p>When you enter a URL like <code>somedomain.com/products?type=model</code> you're specifying a query string, not a variable.</p>\n\n<p>Query strings in Go are accessed via <code>r.URL.Query</code> - e.g.</p>\n\n<pre><code>vals := r.URL.Query() // Returns a url.Values, which is a map[string][]string\nproductTypes, ok := vals[\"type\"] // Note type, not ID. ID wasn't specified anywhere.\nvar pt string\nif ok {\n    if len(productTypes) &gt;= 1 {\n        pt = productTypes[0] // The first `?type=model`\n    }\n}\n</code></pre>\n\n<p>As you can see, this can be a little clunky as it has to account for the map value being empty and for the possibility of a URL like <code>somedomain.com/products?type=model&amp;this=that&amp;here=there&amp;type=cat</code> where a key can be specified more than once.</p>\n\n<p>As <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"noreferrer\">per the gorilla/mux docs</a> you can use route variables:</p>\n\n<pre><code>   // List all products, or the latest\n   apiProductRoute.Handle(\"/\", handler(listProducts)).Methods(\"GET\")\n   // List a specific product\n   apiProductRoute.Handle(\"/{id}/\", handler(showProduct)).Methods(\"GET\")\n</code></pre>\n\n<p>This is where you would use <code>mux.Vars</code>:</p>\n\n<pre><code>vars := mux.Vars(request)\nid := vars[\"id\"]\n</code></pre>\n\n<p>Hope that helps clarify. I'd recommend the variables approach unless you specifically need to use query strings.</p>\n"}, {"tags": [], "owner": {"reputation": 497, "user_id": 1334174, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5b912fe96966d18e2c703c84671d32ea?s=128&d=identicon&r=PG", "display_name": "ystark", "link": "https://stackoverflow.com/users/1334174/ystark"}, "is_accepted": false, "score": 2, "last_activity_date": 1506518961, "creation_date": 1506518961, "answer_id": 46449196, "question_id": 31371111, "link": "https://stackoverflow.com/questions/31371111/mux-vars-not-working/46449196#46449196", "title": "mux.Vars not working", "body": "<p>An easier way to solve this is to add query parameters in your route through <code>Queries</code>, like:</p>\n\n<pre><code>apiProductRoute.Handle(\"/\", handler(listProducts)).\n                Queries(\"type\",\"{type}\").Methods(\"GET\")\n</code></pre>\n\n<p>You can get it using:</p>\n\n<pre><code>v := mux.Vars(r)\ntype := v[\"type\"]\n</code></pre>\n\n<p>NOTE: This might not have been possible when the question was originally posted but I stumbled across this when I encountered a similar problem and the gorilla docs helped. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16492, "favorite_count": 2, "accepted_answer_id": 31372630, "answer_count": 2, "score": 6, "last_activity_date": 1511363182, "creation_date": 1436725590, "question_id": 31371111, "link": "https://stackoverflow.com/questions/31371111/mux-vars-not-working", "title": "mux.Vars not working", "body": "<p>I'm running on HTTPS (port 10443) and use subroutes:</p>\n\n<pre><code>mainRoute := mux.NewRouter()\nmainRoute.StrictSlash(true)\nmainRoute.Handle(\"/\", http.RedirectHandler(\"/static/\", 302))\nmainRoute.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static\", *fh))\n\n// Bind API Routes\napiRoute := mainRoute.PathPrefix(\"/api\").Subrouter()\n\napiProductRoute := apiRoute.PathPrefix(\"/products\").Subrouter()\napiProductRoute.Handle(\"/\", handler(listProducts)).Methods(\"GET\")\n</code></pre>\n\n<p>And the functions:</p>\n\n<pre><code>func listProducts(w http.ResponseWriter, r *http.Request) (interface{}, *handleHTTPError) {\n    vars := mux.Vars(r)\n\n    productType, ok := vars[\"id\"]\n    log.Println(productType)\n    log.Println(ok)\n}\n</code></pre>\n\n<p><code>ok</code> is <code>false</code> and I have no idea why. I'm doing a simple <code>?type=model</code> after my URL..</p>\n"}, {"tags": ["http", "go", "http-headers"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 4, "creation_date": 1436687570, "post_id": 31365474, "comment_id": 50711235, "body": "Where are you seeing this? <code>gin.Context.Header</code> just calls <code>http.ResponseWriter.Header.Set</code> underneath. Testing with <code>curl -v http:&#47;&#47;localhost:9000&#47;ping</code> returns a verbatim <code>X-Next: abc</code> as expected. I suspect your browser is just lowercasing it\u2014which is not a problem as headers should not be case-sensitive."}, {"owner": {"reputation": 974, "user_id": 89476, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/81b42575255726df77b5a836dcfe2c42?s=128&d=identicon&r=PG", "display_name": "rsk", "link": "https://stackoverflow.com/users/89476/rsk"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436688245, "post_id": 31365474, "comment_id": 50711396, "body": "Yes, looks like its browser. Probably browser lower cases &quot;non standard&quot; headers."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1436696035, "post_id": 31365474, "comment_id": 50713034, "body": "Does it matter? Headers in HTTP are case-insensitive. Treating them as case-sensitive is always a bug."}], "answers": [{"comments": [{"owner": {"reputation": 35134, "user_id": 50543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCFWL.jpg?s=128&g=1", "display_name": "Julian Reschke", "link": "https://stackoverflow.com/users/50543/julian-reschke"}, "edited": false, "score": 1, "creation_date": 1436763563, "post_id": 31365755, "comment_id": 50730097, "body": "It&#39;s not an issue anyway; header field names are case-insensitive."}], "tags": [], "owner": {"reputation": 974, "user_id": 89476, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/81b42575255726df77b5a836dcfe2c42?s=128&d=identicon&r=PG", "display_name": "rsk", "link": "https://stackoverflow.com/users/89476/rsk"}, "is_accepted": false, "score": 0, "last_activity_date": 1436688541, "creation_date": 1436688541, "answer_id": 31365755, "question_id": 31365474, "link": "https://stackoverflow.com/questions/31365474/why-gin-golang-makes-my-custom-header-lowercase/31365755#31365755", "title": "Why gin (golang) makes my custom header lowercase?", "body": "<p>Looks like its browser changes case of header, and it is not an issue with gin. Thanks @elithrar for hint.</p>\n"}], "owner": {"reputation": 974, "user_id": 89476, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/81b42575255726df77b5a836dcfe2c42?s=128&d=identicon&r=PG", "display_name": "rsk", "link": "https://stackoverflow.com/users/89476/rsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1648, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1436688541, "creation_date": 1436686290, "question_id": 31365474, "link": "https://stackoverflow.com/questions/31365474/why-gin-golang-makes-my-custom-header-lowercase", "title": "Why gin (golang) makes my custom header lowercase?", "body": "<p>I'm stuck on this problem while learning go/gin. When I use custom header gin makes it lowercase, here is code example:</p>\n\n<pre><code>package main\n\nimport \"github.com/gin-gonic/gin\"\n\nfunc main() {\n    r := gin.New()\n    r.GET(\"/ping\", func(c *gin.Context) {\n        c.Header(\"X-Next\", \"abc\")\n        c.String(200, \"ok\")\n    })\n    r.Run(\":9000\")\n}\n</code></pre>\n\n<p>Header becomes <code>x-next</code>, can't figure it out why it is happening. Similar example with standard <code>http</code> module works fine.</p>\n"}, {"tags": ["go", "floating-point", "integer"], "answers": [{"comments": [{"owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "edited": false, "score": 2, "creation_date": 1436705017, "post_id": 31364536, "comment_id": 50715265, "body": "Not exactly what you are doing but related, for some popular constants, you can also use <code>math</code> package constant values. So say for pi, you can just use <code>math.Pi</code> and you don&#39;t have to compute the value. <a href=\"http://golang.org/pkg/math/\" rel=\"nofollow noreferrer\">golang.org/pkg/math</a>"}, {"owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "reply_to_user": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "edited": false, "score": 0, "creation_date": 1436706362, "post_id": 31364536, "comment_id": 50715658, "body": "Thanks for the insight, much appreciated!"}, {"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 1, "creation_date": 1436714249, "post_id": 31364536, "comment_id": 50717927, "body": "@CuriousMind The reason for this conversion is that for constant values automatic type conversion is applied (this only happens with constant values). Integer division of <code>22&#47;7</code> is done and the result is converted to <code>float64</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1436718360, "post_id": 31364536, "comment_id": 50719155, "body": "See <a href=\"https://blog.golang.org/constants#TOC_8.\" rel=\"nofollow noreferrer\">The Go Blog: Constants</a>. In particular, you can have a very high precision constant if you leave it untyped, e.g. <code>const b = 22.0 &#47; 7</code>; this can make a difference if you do further constant math before assignment."}], "tags": [], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "is_accepted": true, "score": 3, "last_activity_date": 1436677341, "creation_date": 1436677341, "answer_id": 31364536, "question_id": 31364523, "link": "https://stackoverflow.com/questions/31364523/float64-typed-constant-in-go-loses-precision/31364536#31364536", "title": "Float64 typed constant in go, loses precision", "body": "<p>NeverMind, I got the answer. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    const pi float64 = 22.0 / 7.0\n    fmt.Println(\"pi value\", pi)\n}\n</code></pre>\n\n<p>Output  <code>3.142857142857143</code>. it seems types depend if type integer are be divided, it will return a integer regardless if the receiving var is type float64. so get a float value, devision has you occur between float values. </p>\n"}], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 31364536, "answer_count": 1, "score": -1, "last_activity_date": 1436714049, "creation_date": 1436677187, "last_edit_date": 1436714049, "question_id": 31364523, "link": "https://stackoverflow.com/questions/31364523/float64-typed-constant-in-go-loses-precision", "title": "Float64 typed constant in go, loses precision", "body": "<p>Consider the following code written in go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    const pi float64 = 22 / 7\n    fmt.Println(\"pi value\", pi)\n}\n</code></pre>\n\n<p>here the value of <code>pi</code> is <code>3</code>. The question is why is the value losing precision even though it is of type <code>float64</code>?</p>\n"}, {"tags": ["database", "unit-testing", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436677322, "post_id": 31364291, "comment_id": 50709460, "body": "<code>*sql.Rows</code> doesn&#39;t implement <code>IStmt</code>, so you can&#39;t return it. Change the interface to return the concrete type (quickest fix). I&#39;d also suggest reading <a href=\"https://golang.org/doc/effective_go.html#interface-names\" rel=\"nofollow noreferrer\">Effective Go</a> and looking at your interface naming (i.e. <code>Queryer</code> or <code>Queryable</code>) and/or reading <a href=\"https://robots.thoughtbot.com/interface-with-your-database-in-go\" rel=\"nofollow noreferrer\">robots.thoughtbot.com/interface-with-your-database-in-go</a>"}, {"owner": {"reputation": 317, "user_id": 4005052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xlj1f.jpg?s=128&g=1", "display_name": "Rob Archibald", "link": "https://stackoverflow.com/users/4005052/rob-archibald"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436683288, "post_id": 31364291, "comment_id": 50710401, "body": "But *sql.Stmt implements a Query method and QueryRow method just like mine.  <code>Query(args ...interface{}) (*Rows, error)</code> and <code>QueryRow(args ...interface{}) *Row</code>.  Sure, I use an interface to represent <code>*sql.Rows</code> and <code>*sql.Row</code>, but the method signatures I use are exactly the same.  If I change these methods to return <code>*sql.Rows</code> and <code>*sql.Row</code> respectively, it works.  If Go can&#39;t handle a nested interface from a return type, that&#39;s a real shame!"}], "answers": [{"tags": [], "owner": {"reputation": 317, "user_id": 4005052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xlj1f.jpg?s=128&g=1", "display_name": "Rob Archibald", "link": "https://stackoverflow.com/users/4005052/rob-archibald"}, "is_accepted": true, "score": 3, "last_activity_date": 1495521012, "creation_date": 1495521012, "answer_id": 44127338, "question_id": 31364291, "link": "https://stackoverflow.com/questions/31364291/mocking-database-sql-structs-in-go/44127338#44127338", "title": "Mocking database/sql structs in Go", "body": "<p>Here's what I ended up creating to accomplish what I needed. Note that all of this is available in the onedb library that I created at: <a href=\"https://github.com/EndFirstCorp/onedb\" rel=\"nofollow noreferrer\">https://github.com/EndFirstCorp/onedb</a>. In addition to mocking, onedb makes it possible to query Redis and OpenLDAP with the same methods.</p>\n\n<pre><code>import \"database/sql\"\n\ntype rowsScanner interface {\n    Columns() ([]string, error)\n    Next() bool\n    Close() error\n    Err() error\n    scanner\n}\n\ntype scanner interface {\n    Scan(dest ...interface{}) error\n}\n\ntype DBer interface {\n    Ping() error\n    Close() error\n    Execute(query string, args ...interface{}) error\n    Query(query string, args ...interface{}) (rowsScanner, error)\n    QueryRow(query string, args ...interface{}) scanner\n}\n</code></pre>\n\n<p><code>rowsScanner</code> and <code>scanner</code> are essentially the interfaces for the return of the database/sql <code>Query</code> and <code>QueryRow</code> methods respectively. <code>DBer</code> is ultimately the interface I wish I could get out of database/sql so I could mock it. But, since I can't do that, I created an object which can do the conversion.  </p>\n\n<pre><code>type sqllibBackend struct {\n    db *sql.DB\n    DBer\n}\n</code></pre>\n\n<p><code>sqllibBackend</code> is the magic struct that does the conversion. It converts the output from <code>*sql.DB</code> methods into the mockable <code>DBer</code> interface. That just leaves the converter struct:</p>\n\n<pre><code>func NewSqllib(driverName, connectionString string) (DBer, error) {\n    sqlDb, err := sql.Open(driverName, connectionString)\n    if err != nil {\n        return nil, err\n    }\n    err = sqlDb.Ping()\n    if err != nil {\n        return nil, err\n    }\n    return &amp;sqllibBackend{db: sqlDb}, nil\n}\n\nfunc (b *sqllibBackend) Close() error {\n    return b.db.Close()\n}\n\nfunc (b *sqllibBackend) Query(query string, args ...interface{}) (rowsScanner, error) {\n    return b.db.Query(query, args...)\n}\n\nfunc (b *sqllibBackend) QueryRow(query string, args ...interface{}) scanner {\n    return b.db.QueryRow(query, args...)\n}\n\nfunc (b *sqllibBackend) Execute(query string, args ...interface{}) error {\n    _, err := b.db.Exec(query, args...)\n    return err\n}\n</code></pre>\n\n<p>Now, rather than using the real database/sql, I can use <code>sqllibBackend</code> and it returns the easily mockable DBer interface.</p>\n"}], "owner": {"reputation": 317, "user_id": 4005052, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xlj1f.jpg?s=128&g=1", "display_name": "Rob Archibald", "link": "https://stackoverflow.com/users/4005052/rob-archibald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5432, "favorite_count": 0, "accepted_answer_id": 44127338, "answer_count": 1, "score": 4, "last_activity_date": 1495521012, "creation_date": 1436674302, "question_id": 31364291, "link": "https://stackoverflow.com/questions/31364291/mocking-database-sql-structs-in-go", "title": "Mocking database/sql structs in Go", "body": "<p>In testing database methods, I created a minimal wrapper over the database/sql package to allow me to test against interfaces instead of the difficult if not impossible to setup concrete classes.  But, I get the following error when I try to mock sql.Stmt:</p>\n\n<pre><code>cannot use *sql.Stmt as type IStmt in return argument:\n    *sql.Stmt does not implement IStmt (wrong type for Query method)\n            have Query(...interface {}) (*sql.Rows, error)\n            want Query(...interface {}) (IRows, error)\n</code></pre>\n\n<p>Here are my interfaces:</p>\n\n<pre><code>type IStmt interface {\n    Query(args ...interface{}) (IRows, error)\n    QueryRow(args ...interface{}) IRow\n}\n\ntype IRows interface {\n    Columns() ([]string, error)\n    Next() bool\n    Close() error\n    Scan(dest ...interface{}) error\n    Err() error\n}\n</code></pre>\n\n<p>And here's the problem method:</p>\n\n<pre><code>func (c *DbConnection) Prepare(query string) (IStmt, error) {\n    return c.conn.Prepare(query)\n}\n</code></pre>\n\n<p>I know that one of the beautiful things about Go is that you can create your own interface and any struct that implements it will automatically \"implement\" it without having to use the <code>implements</code> keyword in java or use the semicolon like in C# to subclass.  Why isn't it working with this return type?  Am I doing something wrong?</p>\n"}, {"tags": ["go", "call-graph"], "comments": [{"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1561731315, "post_id": 31362332, "comment_id": 100171205, "body": "Updated link about go tool pprof (accidentally lost the .org domain, sorry): <a href=\"http://saml.rilspace.com/profiling-and-creating-call-graphs-for-go-programs-with-go-tool-pprof\" rel=\"nofollow noreferrer\">saml.rilspace.com/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436689010, "post_id": 31363995, "comment_id": 50711553, "body": "This is the method described in the first link I mentioned; I forgot to link to the original site. For me this does not give satisfactory results; I see lots of function calls which are not of interest to me, but I do not see the function calls which I am interested in at all. After some profiling runs I see some of the interesting functions, but never all. Isn&#39;t there a static tool, which simply goes through the code and creates graphs?"}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436692036, "post_id": 31363995, "comment_id": 50712163, "body": "One of my problems is that I am also interested in functions which are executed only once (during setup). Is there a way to increase the sampling rate of the tool, s.t. the probability increases that short running functions are also sampled?"}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436694665, "post_id": 31363995, "comment_id": 50712720, "body": "The sampling rate is hardcoded in runtime/pprof.go:587 via runtime.SetCPUProfileRate(hz) with hz=100, i.e. 100 samples per second. If one calls runtime.SetCPUProfileRate(desiredSamplingRate) <i>before</i> calling profile.Start(), one can override this. Trying to set the sampling rate after calling profile.Start() will not work (&quot;runtime: cannot set cpu profile rate until previous profile has finished.&quot;)."}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436694755, "post_id": 31363995, "comment_id": 50712734, "body": "Still it does not solve my problem, since my program spends most of its time in http calls or waiting and the reason why I want the call graph is not for profiling but for understanding the logic of the code (not my own). I want to know how the separate components work together, i.e. which function calls which other function / the flow of the program."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 14, "last_activity_date": 1619281238, "last_edit_date": 1619281238, "creation_date": 1436670414, "answer_id": 31363995, "question_id": 31362332, "link": "https://stackoverflow.com/questions/31362332/creating-call-graph/31363995#31363995", "title": "Creating call graph", "body": "<p>Take a look here:</p>\n<ul>\n<li><a href=\"http://dave.cheney.net/2014/10/22/simple-profiling-package-moved-updated\" rel=\"nofollow noreferrer\">http://dave.cheney.net/2014/10/22/simple-profiling-package-moved-updated</a></li>\n<li><a href=\"https://github.com/pkg/profile\" rel=\"nofollow noreferrer\">https://github.com/pkg/profile</a></li>\n</ul>\n<pre><code>func main() {\n   defer profile.Start(profile.CPUProfile, profile.ProfilePath(&quot;.&quot;)).Stop()\n   // Rest of program\n}\n</code></pre>\n<p>Build and run your program as per normal. You'll see the profiling hook\nmentioned:</p>\n<pre><code>2015/07/12 09:02:02 profile: cpu profiling enabled, cpu.pprof\n</code></pre>\n<p>Run your program (bench it, run through it, etc) to generate the profile during\nruntime. Once you've hit what you want, quit and then generate the call-graph:</p>\n<pre><code>go tool pprof -pdf -output cgraph.pdf $YOURPROGBINARY cpu.pprof\n</code></pre>\n<p>You can also run <code>go tool pprof $YOURPROGBINARY cpu.pprof</code> to get an\ninteractive prompt where you can call <code>top10</code> or <code>web</code> to generate an svg. Type\n<code>help</code> at the pprof prompt to get a list of commands.</p>\n<p>e.g. - here's the CPU profile for a buffer pool implementation I wrote:</p>\n<pre><code>~/Desktop go tool pprof poolio cpu.pprof\nEntering interactive mode (type &quot;help&quot; for commands)\n(pprof) top5\n24770ms of 35160ms total (70.45%)\nDropped 217 nodes (cum &lt;= 175.80ms)\nShowing top 5 nodes out of 74 (cum &gt;= 650ms)\n    flat  flat%   sum%        cum   cum%\n 12520ms 35.61% 35.61%    12520ms 35.61%  runtime.mach_semaphore_wait\n  9300ms 26.45% 62.06%     9360ms 26.62%  syscall.Syscall\n  1380ms  3.92% 65.98%     2120ms  6.03%  encoding/json.(*encodeState).string\n  1030ms  2.93% 68.91%     1030ms  2.93%  runtime.kevent\n   540ms  1.54% 70.45%      650ms  1.85%  runtime.mallocgc\n</code></pre>\n<p>And here's a quick way to generate a PNG from the prompt:</p>\n<pre><code>(pprof) png &gt; graph.png\nGenerating report in graph.png\n</code></pre>\n<p>Which outputs this:</p>\n<p><img src=\"https://i.stack.imgur.com/1v7eY.png\" alt=\"callgraph-example-poolio\" /></p>\n"}, {"comments": [{"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436721627, "post_id": 31369718, "comment_id": 50720158, "body": "Thanks! I experimented with callgraph using the different algo-flags and tried to produce a pdf using graphviz/dot or query the output of callgraph using digraph. Unfortunately, the output of callgraph contains mostly go libs and producing a pdf from the output of callgraph does not give anything usable. The query capabilities of digraph may turn out helpfull. The best solution for me would be, if I could filter out the go lib function calls - especially the deeply nested ones, for which my code is not even responsible. Maybe I can just do some postprocessing with callgraph&#39;s result."}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1436722306, "post_id": 31369718, "comment_id": 50720362, "body": "There is another major obstacle which prevents me from using callgraph - it refuses to work, when I import ZeroMQ bindings (github.com/pebbe/zmq3). The first output is &quot;cgo pkg-config not supported&quot; and than lots of &quot;undeclared name&quot; errors from the zmq package, although they are declared in the package."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 13, "last_activity_date": 1436716687, "creation_date": 1436716687, "answer_id": 31369718, "question_id": 31362332, "link": "https://stackoverflow.com/questions/31362332/creating-call-graph/31369718#31369718", "title": "Creating call graph", "body": "<p>You were close with \u2026<code>/x/tools/go/callgraph/static</code>. I'm pretty sure <code>go install golang.org/x/tools/cmd/callgraph</code> is what you want. Once installed run it without arguments to see it's full help/usage.</p>\n\n<p>(In general, the things under \u2026<code>/x/tools/</code> are somewhat reusable packages with command line front-ends living under \u2026<code>/x/tools/cmd</code>, you can install them all with <code>go install golang.org/x/tools/cmd/...</code>, the literal <code>/...</code> matches all sub-packages).</p>\n\n<p>E.g. running just <code>callgraph</code> produces usage output that starts with:</p>\n\n<blockquote>\n  <p><strong>callgraph</strong>: display the the call graph of a Go program.</p>\n  \n  <p>Usage:</p>\n  \n  <p><code>callgraph [-algo=static|cha|rta|pta] [-test] [-format=...] &lt;args&gt;...</code></p>\n  \n  <p>Flags:</p>\n  \n  <p><code>-algo</code>      Specifies the call-graph construction algorithm, one of:</p>\n\n<pre><code>        static      static calls only (unsound)\n        cha         Class Hierarchy Analysis\n        rta         Rapid Type Analysis\n        pta         inclusion-based Points-To Analysis\n\n       The algorithms are ordered by increasing precision in their\n       treatment of dynamic calls (and thus also computational cost).\n       RTA and PTA require a whole program (main or test), and\n       include only functions reachable from main.\n</code></pre>\n  \n  <p><code>-test</code>      Include the package's tests in the analysis.</p>\n  \n  <p><code>-format</code>    Specifies the format in which each call graph edge is displayed.\n             One of:</p>\n\n<pre><code>        digraph     output suitable for input to\n                    golang.org/x/tools/cmd/digraph.\n        graphviz    output in AT&amp;T GraphViz (.dot) format.\n</code></pre>\n</blockquote>\n\n<p>It can produce arbitrary formatted output (using Go's template syntax) or graphviz or digraph output. The last is a tool you can install with <code>go install golang.org/x/tools/cmd/digraph</code> (and once again, full/help usage is seen by running it without arguments) and can answer queries about arbitrary directed graphs (including call graphs obviously).</p>\n"}, {"comments": [{"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1473257887, "post_id": 39363908, "comment_id": 66072631, "body": "Looks interesting, will try it out later"}], "tags": [], "owner": {"reputation": 39, "user_id": 6803401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2422c762946718ed0d2cf73d953ca7a2?s=128&d=identicon&r=PG&f=1", "display_name": "fiefdx", "link": "https://stackoverflow.com/users/6803401/fiefdx"}, "is_accepted": false, "score": 0, "last_activity_date": 1473233828, "creation_date": 1473233828, "answer_id": 39363908, "question_id": 31362332, "link": "https://stackoverflow.com/questions/31362332/creating-call-graph/39363908#39363908", "title": "Creating call graph", "body": "<p>I used golang callgraph recently, and I build a web tool with python + callgraph called CallingViewer here: <a href=\"https://github.com/fiefdx/CallingViewer\" rel=\"nofollow\">https://github.com/fiefdx/CallingViewer</a> , it maybe rough, but it work, the screenshot at below:\n<a href=\"http://i.stack.imgur.com/4HXgX.png\" rel=\"nofollow\">screenshot of CallingViewer</a></p>\n"}], "owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13181, "favorite_count": 20, "answer_count": 3, "score": 24, "last_activity_date": 1619281238, "creation_date": 1436652656, "last_edit_date": 1568821720, "question_id": 31362332, "link": "https://stackoverflow.com/questions/31362332/creating-call-graph", "title": "Creating call graph", "body": "<p>I am looking for a possibility to generate a call graph for Go projects. Something similar to <a href=\"http://www.doxygen.nl/manual/diagrams.html\" rel=\"noreferrer\">Doxygen's diagram functionality</a> for C++ classes (with the option CALL_GRAPH=YES).</p>\n\n<p>So far I found </p>\n\n<p><a href=\"http://saml.rilspace.org/profiling-and-creating-call-graphs-for-go-programs-with-go-tool-pprof\" rel=\"noreferrer\">http://saml.rilspace.org/profiling-and-creating-call-graphs-for-go-programs-with-go-tool-pprof</a>\n<br>or<br>\n<a href=\"http://blog.golang.org/profiling-go-programs\" rel=\"noreferrer\">http://blog.golang.org/profiling-go-programs</a></p>\n\n<p>This samples the call stack of your program 100 times per second while the program is running and creates a graph useful for profiling. If your program spends most of its time in functions not relevant to you, I found this solution not very usefull.</p>\n\n<p>Then there is this:</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/tools/go/callgraph/static\" rel=\"noreferrer\">https://godoc.org/golang.org/x/tools/go/callgraph/static</a></p>\n\n<p>which from its description sounds like what I would need, but there seem to be no docs and I don't understand how to use it.</p>\n\n<p>I also found</p>\n\n<p><a href=\"https://github.com/davecheney/graphpkg/blob/master/README.md\" rel=\"noreferrer\">https://github.com/davecheney/graphpkg/blob/master/README.md</a>\n<br>and<br>\n<a href=\"https://github.com/paetzke/go-dep-graph/blob/master/README.org\" rel=\"noreferrer\">https://github.com/paetzke/go-dep-graph/blob/master/README.org</a></p>\n\n<p>but they create only dependency graphs.</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 3249, "user_id": 2295256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f0562db96652dd9b2840470850c5f7a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Godwyll", "link": "https://stackoverflow.com/users/2295256/jeffrey-godwyll"}, "is_accepted": false, "score": 1, "last_activity_date": 1436666395, "creation_date": 1436666395, "answer_id": 31363653, "question_id": 31362068, "link": "https://stackoverflow.com/questions/31362068/golang-appengine-how-to-serve-a-static-file-from-root-url/31363653#31363653", "title": "Golang Appengine - How to serve a static file from root url", "body": "<p>The handler is not seeing your <code>index.html</code> in your <code>uploads</code> directory that corresponds with the given <code>url</code> and <code>static_files</code>. Use this instead:</p>\n\n<pre><code>handlers:\n- url: /\n  static_files: js_app/index.html\n  upload: js_app/index.html\n</code></pre>\n\n<p>If you have other static files you want to make available under the <code>uploads</code> route I'll suggest you separate them to be:</p>\n\n<pre><code>handlers:\n- url: /\n  static_files: js_app/index.html\n  upload: js_app/index.html\n\n- url: /uploads\n  static_dir: js_app/uploads/\n</code></pre>\n"}], "owner": {"reputation": 1559, "user_id": 185633, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/223b4b2094092f3ff4e3af9a78925b5e?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/185633/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1436666395, "creation_date": 1436650479, "question_id": 31362068, "link": "https://stackoverflow.com/questions/31362068/golang-appengine-how-to-serve-a-static-file-from-root-url", "title": "Golang Appengine - How to serve a static file from root url", "body": "<p>I tried to deploy my go app to appengine and it complains that my root url isn't handled on the server. My app.yml file is set up to serve index.html when the root url is hit. It seems to work locally. Is there something wrong with this approach? Here's my yaml file. Thanks!</p>\n\n<pre><code>application: myapp-go\nversion: 2\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /\n  static_files: js_app/index.html\n  upload: js_app/uploads/.*\n\n- url: /api/.*\n  script: _go_app\n\n- url: /javascripts\n  static_dir: js_app/javascripts/\n\n- url: /stylesheets\n  static_dir: js_app/stylesheets/\n\n- url: /templates\n  static_dir: js_app/templates/\n\n- url: /images\n  static_dir: js_app/images/\n</code></pre>\n"}, {"tags": ["go", "anonymous-types"], "answers": [{"comments": [{"owner": {"reputation": 17462, "user_id": 97964, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Nrh5.jpg?s=128&g=1", "display_name": "jocull", "link": "https://stackoverflow.com/users/97964/jocull"}, "edited": false, "score": 1, "creation_date": 1436753022, "post_id": 31362378, "comment_id": 50728016, "body": "This is really awesome, and I like how it&#39;s semi-structured. Embedding is really neat."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1486901265, "post_id": 31362378, "comment_id": 71536820, "body": "At first I&#39;ve read the part &quot;not possible&quot;, but then came back and actually had run it! Nice one!"}, {"owner": {"reputation": 8208, "user_id": 1971598, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2dadb39a8fbedbdb2c473a162c251b2a?s=128&d=identicon&r=PG", "display_name": "Edgar Aroutiounian", "link": "https://stackoverflow.com/users/1971598/edgar-aroutiounian"}, "edited": false, "score": 0, "creation_date": 1567979664, "post_id": 31362378, "comment_id": 102119244, "body": "@nemo why is ProtoThing a struct, not an interface?"}, {"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "reply_to_user": {"reputation": 8208, "user_id": 1971598, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2dadb39a8fbedbdb2c473a162c251b2a?s=128&d=identicon&r=PG", "display_name": "Edgar Aroutiounian", "link": "https://stackoverflow.com/users/1971598/edgar-aroutiounian"}, "edited": false, "score": 1, "creation_date": 1568189742, "post_id": 31362378, "comment_id": 102192125, "body": "@EdgarAroutiounian The question was about a construct in Go which can satisfy an interface (in this case <code>Thing</code>) anonymously, i.e. without declaring a named type. <code>ProtoThing</code> is a construct which allows you to satisfy the <code>Thing</code> interface but swap out the functionality of the methods."}, {"owner": {"reputation": 563, "user_id": 921684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pUbv3.png?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/921684/nobody"}, "edited": false, "score": 0, "creation_date": 1616765649, "post_id": 31362378, "comment_id": 118112755, "body": "At this point <code>ProtoThing</code> feels the same as an abstract class in OOP"}], "tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": true, "score": 62, "last_activity_date": 1436652988, "creation_date": 1436652988, "answer_id": 31362378, "question_id": 31362044, "link": "https://stackoverflow.com/questions/31362044/anonymous-interface-implementation-in-golang/31362378#31362378", "title": "Anonymous interface implementation in Golang", "body": "<p>Go uses <a href=\"http://golang.org/ref/spec#Method_sets\">method sets</a> to declare which methods belong to a type. There is only one way to declare functions with receiver types (methods):</p>\n\n<pre><code>func (v T) methodName(...) ... { }\n</code></pre>\n\n<p>Since nested functions are forbidden, there is no way to define a method set on anonymous structs.</p>\n\n<p>The second thing that will not allow this is that methods are read-only. <a href=\"http://golang.org/ref/spec#Method_values\">Method values</a> were introduced to allow to pass methods around and use them in goroutines but not to manipulate the method set.</p>\n\n<p>What you can do instead is to provide a ProtoThing and refer to underlying implementations of your anonymous struct (<a href=\"http://play.golang.org/p/k0lCJqyF6p\">on play</a>):</p>\n\n<pre><code>type ProtoThing struct { \n    itemMethod func() float64\n    setItemMethod func(float64)\n}\n\nfunc (t ProtoThing) Item() float64 { return t.itemMethod() }\nfunc (t ProtoThing) SetItem(x float64) { t.setItemMethod(x) }\n\n// ...\n\nt := struct { ProtoThing }{}\n\nt.itemMethod = func() float64 { return 2.0 }\nt.setItemMethod = func(x float64) { item = x }\n</code></pre>\n\n<p>This works because by embedding <code>ProtoThing</code> the method set is inherited. Thus the anonymous struct also satisfies the <code>Thing</code> interface.</p>\n"}, {"tags": [], "owner": {"reputation": 918, "user_id": 429828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2028f8517e3123ca997938df3acd4fc5?s=128&d=identicon&r=PG", "display_name": "Allen Hamilton", "link": "https://stackoverflow.com/users/429828/allen-hamilton"}, "is_accepted": false, "score": 20, "last_activity_date": 1487897652, "last_edit_date": 1487897652, "creation_date": 1486860190, "answer_id": 42182987, "question_id": 31362044, "link": "https://stackoverflow.com/questions/31362044/anonymous-interface-implementation-in-golang/42182987#42182987", "title": "Anonymous interface implementation in Golang", "body": "<p>Here's neat way to satisfy an interface with an anonymous function.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Thinger interface {\n    DoThing()\n}\n\ntype DoThingWith func()\n\n// Satisfy Thinger interface.\n// So we can now pass an anonymous function using DoThingWith, \n// which implements Thinger.\nfunc (thing DoThingWith) DoThing() {\n    // delegate to the anonymous function\n    thing()\n}\n\ntype App struct {\n}\n\nfunc (a App) DoThing(f Thinger) {\n    f.DoThing()\n}\n\n\n//...Somewhere else in your code:\napp := App{}\n\n// Here we use an anonymous function which satisfies the interface\n// The trick here is to convert the anonymous function to the DoThingWith type\n// which delegates to the anonymous function\n\napp.DoThing(DoThingWith(func() {\n    fmt.Println(\"Hey interface, are you satisfied?\")\n}))\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/k8_X9g2NYc\" rel=\"noreferrer\">https://play.golang.org/p/k8_X9g2NYc</a></p>\n\n<p>nb, it looks like HandlerFunc in http package uses this pattern: <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"noreferrer\">https://golang.org/pkg/net/http/#HandlerFunc</a></p>\n\n<p>edit: Changed type DoThing to DoThingWith for clarity. Updated playground</p>\n"}, {"tags": [], "owner": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "is_accepted": false, "score": 3, "last_activity_date": 1492209488, "creation_date": 1492209488, "answer_id": 43420100, "question_id": 31362044, "link": "https://stackoverflow.com/questions/31362044/anonymous-interface-implementation-in-golang/43420100#43420100", "title": "Anonymous interface implementation in Golang", "body": "<p>You can not instantiate a struct with methods, they need to be declared as functions, but in Go functions are \"first class citizens\", so they can be field values just like in JavaScript (but typed).</p>\n\n<p>You can make a generic struct that accepts func fields to implement the interface:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Thing interface {\n    Item() float64\n    SetItem(float64)\n}\n\n// Implements Thing interface\ntype thingImpl struct {\n    item    func() float64\n    setItem func(float64)\n}\nfunc (i thingImpl) Item() float64     { return i.item() }\nfunc (i thingImpl) SetItem(v float64) { i.setItem(v) }\n\nfunc newThing() Thing {\n    item := 0.0\n    return thingImpl{\n        item:    func() float64 { return item },\n        setItem: func(x float64) { item = x },\n    }\n}\n\nfunc main() {\n    thing := newThing()\n    fmt.Println(\"Hello, playground\")\n    fmt.Println(thing)\n}\n</code></pre>\n"}], "owner": {"reputation": 17462, "user_id": 97964, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Nrh5.jpg?s=128&g=1", "display_name": "jocull", "link": "https://stackoverflow.com/users/97964/jocull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36339, "favorite_count": 10, "accepted_answer_id": 31362378, "answer_count": 3, "score": 57, "last_activity_date": 1492209488, "creation_date": 1436650252, "question_id": 31362044, "link": "https://stackoverflow.com/questions/31362044/anonymous-interface-implementation-in-golang", "title": "Anonymous interface implementation in Golang", "body": "<p>In Go, is there a way to satisfy an interface anonymously? It doesn't seem like there is, but this was my best attempt.</p>\n\n<p>(In the <a href=\"http://play.golang.org/p/4i-8o087dg\" rel=\"noreferrer\">Playground</a>)</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Thing interface {\n    Item() float64\n    SetItem(float64)\n}\n\nfunc newThing() Thing {\n    item := 0.0\n    return struct {\n        Item (func() float64)\n        SetItem (func(float64))\n    }{\n        Item: func() float64 { return item },\n        SetItem: func(x float64) { item = x },\n    }\n}\n\nfunc main() {\n    thing := newThing()\n    fmt.Println(\"Hello, playground\")\n    fmt.Println(thing)\n}\n</code></pre>\n"}, {"tags": ["go", "go-html-template"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1436648295, "post_id": 31361745, "comment_id": 50704295, "body": "Can you check if Go 1.5 beta 1 (<a href=\"http://golang.org/dl/#go1.5beta1\" rel=\"nofollow noreferrer\">golang.org/dl/#go1.5beta1</a>) changes anything? (in case garbage collector speed is an issue here)"}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1436649166, "post_id": 31361745, "comment_id": 50704532, "body": "Yes, I did. The results are the same."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1436666792, "post_id": 31361745, "comment_id": 50707760, "body": "Look at profiling using <a href=\"https://github.com/pkg/profile\" rel=\"nofollow noreferrer\">github.com/pkg/profile</a> and posting the top10 from the CPU profile. It&#39;d also help to see whether your template does any work on the input? I&#39;m assuming it just iterates over the input array."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1436668940, "post_id": 31361745, "comment_id": 50708168, "body": "Passing a pointer to .Execute should speed it up a bit."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436673994, "post_id": 31361745, "comment_id": 50709012, "body": "@elithrar how do I read the file? I got /tmp/profile*****/cpu.pprof in the end, but it doesn&#39;t seem to be readable..."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436674146, "post_id": 31361745, "comment_id": 50709031, "body": "@uiwe83 <code>go tool pprof $YOURBINARY cpu.pprof</code> and then type <code>top10</code> at the prompt and post the results in your question. I suspect a lot of makeSlice calls."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436841318, "post_id": 31361745, "comment_id": 50769135, "body": "How do you run your PHP app?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436841628, "post_id": 31361745, "comment_id": 50769202, "body": "Also given that profiler shows 35.5% time spent in <code>reflect.Value.call</code> it would be interesting to see how the performance changes when <code>Post</code> and <code>Page</code> structs are replaces with maps (like in your PHP example)."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436856054, "post_id": 31361745, "comment_id": 50773706, "body": "@kostya I suppose you&#39;ve already seen my code from reddit post so... ;) Yes I will definitely try to replace with maps, the reason I went for structs is just because I first noticed them and from the start liked to build them."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436862268, "post_id": 31361745, "comment_id": 50777111, "body": "@uiwe83, yes, I saw your reddit post, though I don&#39;t have an account there ;) Using structs would be my preference too as the code is cleaner and safer. Using structs is also much faster if all properties are resolved at compile time. I was just curious how much difference in performance would maps make."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436917919, "post_id": 31361745, "comment_id": 50811026, "body": "@kostya I realize the PHP code is quite simple, tried to make it as similar on Go as possible and ended up with this code using maps (though in PHP I&#39;m using array of arrays and they&#39;re not even associative, yet I couldn&#39;t recreate it in Go): <a href=\"http://pastebin.com/1ckqEDYZ\" rel=\"nofollow noreferrer\">pastebin.com/1ckqEDYZ</a> - benchmarking it gives roughly 5k successful results, just like in my first try - even with text/template."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436703991, "post_id": 31367138, "comment_id": 50714996, "body": "Thank you. This is very interesting (proper management of pointers, addresses and so on) and makes a lot of sense to me. Surprisingly, I&#39;ve tested this code multiple times once again and still stuck with 5-6k barrier. I will update the question with the results of profiling tool. I&#39;m utilizing only one core on my test machine (as it has only 1), but still using runtime.GOMAXPROCS."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436749759, "post_id": 31367138, "comment_id": 50727387, "body": "<code>Posts := make([]Post, 100)</code> (a slice of Posts) might be more efficient in this case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1436767333, "post_id": 31367138, "comment_id": 50731225, "body": "@kostya It might. I was hesitating which to choose, because filling the array seems faster if elements are pointers, as in case of non-pointers, structs will be copied. Also when processing the slice, a simple <code>for range</code> would also copy each element into the &quot;loop variable&quot;. Needs benchmarking."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436788382, "post_id": 31367138, "comment_id": 50742747, "body": "In go-nuts I&#39;ve been advised to put variable creation and filling into init(), though that still didn&#39;t resolve a problem with ExecuteTemplate. The only way that for now really improves the performance (155k hits) is caching a template in bytes buffer at program init, but that means the data loaded on user&#39;s request is always the same."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436789834, "post_id": 31367138, "comment_id": 50743611, "body": "It&#39;s great that Go has a library for working with templates, looks like if I use some similar templating package in PHP (with those fancy security features), the results might be the same, not sure. Still in many cases I don&#39;t think I need them, because there won&#39;t be any user-generated content, why would I lose so much performance on simple {{ range }} of my blog posts."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436841087, "post_id": 31367138, "comment_id": 50769075, "body": "Can you do a quick test replacing <code>html&#47;template</code> with <code>text&#47;template</code> to measure performance penalty of HTML escaping?"}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436855903, "post_id": 31367138, "comment_id": 50773626, "body": "@kostya yes I did, the performance improved greatly to the level of PHP, though I know this costs me losing benefits of automatic escaping."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1460166751, "last_edit_date": 1460166751, "creation_date": 1436699543, "answer_id": 31367138, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround/31367138#31367138", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p>You are working with arrays and structs, both which are non-pointer types, nor are they descriptors (like slices or maps or channels). So passing them always creates a copy of the value, assigning an array value to a variable copies all the elements. This is slow and gives a huge amount of work to the GC.</p>\n\n<hr>\n\n<p>Also you are utilizing only 1 CPU core. To utilize more, add this to your <code>main()</code> function:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(http.ListenAndServe(\":8888\", nil))\n}\n</code></pre>\n\n<p><strong>Edit:</strong> <em>This was only the case prior to Go 1.5. Since Go 1.5 <code>runtime.NumCPU()</code> is the default.</em></p>\n\n<hr>\n\n<h3>Your code</h3>\n\n<pre><code>var Posts [100]Post\n</code></pre>\n\n<p>An array with space for 100 <code>Post</code>s is allocated.</p>\n\n<pre><code>Posts[i] = Post{i, \"Sample Title\", \"Lorem Ipsum Dolor Sit Amet\"}\n</code></pre>\n\n<p>You create a <code>Post</code> value with a composite literal, then this value is copied into the <code>i</code>th element in the array. (redundant)</p>\n\n<pre><code>var p Page\n</code></pre>\n\n<p>This creates a variable of type <code>Page</code>. It is a <code>struct</code>, so its memory is allocated which also contains a field <code>Posts [100]Post</code> so another array of <code>100</code> elements is allocated.</p>\n\n<pre><code>p.Posts = Posts\n</code></pre>\n\n<p>This copies <code>100</code> elements (a hundred structs)!</p>\n\n<pre><code>tmpl.ExecuteTemplate(w, \"index.html\", p)\n</code></pre>\n\n<p>This creates a copy of <code>p</code> (which is of type <code>Page</code>), so another array of <code>100</code> posts is created and elements from <code>p</code> are copied, then it is passed to <code>ExecuteTemplate()</code>.</p>\n\n<p>And since <code>Page.Posts</code> is an array, most likely when it is processed (iterated over in the template engine), a copy will be made from each element (haven't checked - not verified).</p>\n\n<h3>Proposal for a more efficient code</h3>\n\n<p>Some things to speed up your code:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    type Post struct {\n        Id int\n        Title, Content string\n    }\n\n    Posts := make([]*Post, 100) // A slice of pointers\n\n    // Fill posts\n    for i := range Posts {\n        // Initialize pointers: just copies the address of the created struct value\n        Posts[i]= &amp;Post{i, \"Sample Title\", \"Lorem Ipsum Dolor Sit Amet\"}\n    }\n\n    type Page struct {\n        Title, Subtitle string\n        Posts []*Post // \"Just\" a slice type (it's a descriptor)\n    }\n\n    // Create a page, only the Posts slice descriptor is copied\n    p := Page{\"Index Page of My Super Blog\", \"A blog about everything\", Posts}\n\n    tmpl := templates[\"index.html\"]\n\n    // Only pass the address of p\n    // Although since Page.Posts is now just a slice, passing by value would also be OK \n    tmpl.ExecuteTemplate(w, \"index.html\", &amp;p)\n}\n</code></pre>\n\n<p>Please test this code and report back your results.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 4629185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fe34f350374f9d300a232d2420168bd?s=128&d=identicon&r=PG", "display_name": "Brent Rowland", "link": "https://stackoverflow.com/users/4629185/brent-rowland"}, "is_accepted": false, "score": 0, "last_activity_date": 1436831555, "creation_date": 1436831555, "answer_id": 31395386, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround/31395386#31395386", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p>PHP isn't answering 5000 requests concurrently. The requests are being multiplexed to a handful of processes for serial execution. This makes more efficient use of both CPU and memory. 5000 concurrent connections may make sense for a message broker or similar, doing limited processing of small pieces of data, but it makes little sense for any service doing real I/O or processing. If your Go app is not behind a proxy of some type that will limit the number of concurrent requests, you will want to do so yourself, perhaps at the beginning of your handler, using a buffered channel or a wait group, a la <a href=\"https://blakemesdag.com/blog/2014/11/12/limiting-go-concurrency/\" rel=\"nofollow\">https://blakemesdag.com/blog/2014/11/12/limiting-go-concurrency/</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436856229, "post_id": 31399199, "comment_id": 50773800, "body": "Thanks, I think both yours and @icza answers are great, though yours answers the question more clearly. One thing I left wondering - is it appropriate to try to use goroutines / channels and would it help if still using html/template?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436857009, "post_id": 31399199, "comment_id": 50774162, "body": "<code>http.ListenAndServer</code> creates one goroutine per request so rendering the same template for different connections happens in parallel."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436859302, "post_id": 31399199, "comment_id": 50775434, "body": "I mean, will it be of any use if I use them for inside loops (where I create them, fill with data etc.)? And if so, would you provide an example based on my code? Sorry for the question off topic and asking too much! Right now I&#39;m struggling with it but don&#39;t want to create a new question regarding this. This is my code so far: <a href=\"http://pastebin.com/9NBQ9xY8\" rel=\"nofollow noreferrer\">pastebin.com/9NBQ9xY8</a>"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436861993, "post_id": 31399199, "comment_id": 50776953, "body": "I don&#39;t think it is possible to speed this up by using more goroutines. Think about it this way. Goroutines can only make some code faster if the code can be parallelized and executed on multiple cores simultaneously. In this case template rendering algorithm cannot be parallelized but more importantly all processor cores are already busy rendering templates for other connections and do not have capacity to do anything else. Generally if an app is IO bound adding more goroutines might help, if an app is CPU bound adding more goroutines might even slow the app down."}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "edited": false, "score": 0, "creation_date": 1436887908, "post_id": 31399199, "comment_id": 50795175, "body": "Interesting, I see. Interesting short overview btw, I&#39;ve upgraded test machine to 2 cores and 4 gb of RAM, loaded with the same stress testing and resulted with 300 of 300k possible responses on php, while only twice more (I was using max procs) - around 120k, with Go. Go app is loading both cores on 100% each while processing... I&#39;m not sure why..."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 11, "last_activity_date": 1436855159, "creation_date": 1436855159, "answer_id": 31399199, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround/31399199#31399199", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p>There are two main reasons why the equivalent application using <code>html/template</code> is slower than PHP variant.</p>\n\n<p>First of all <code>html/template</code> provides more functionality than the PHP. The main difference is that <code>html/template</code> will automatically escape variables using correct escaping rules (HTML, JS, CSS, etc) depending on their location in the resulting HTML output (which I think is quite cool!).</p>\n\n<p>Secondly <code>html/template</code> rendering code heavily uses reflection and methods with variable number of arguments and they are just not as fast as statically compiled code.</p>\n\n<p>Under the hood the following template</p>\n\n<pre><code>{{ .Title }}\n{{ .Subtitle }}\n\n{{ range .Posts }}\n    {{ .Title }}\n    {{ .Content }}\n{{ end }}\n</code></pre>\n\n<p>is converted to something like</p>\n\n<pre><code>{{ .Title | html_template_htmlescaper }}\n{{ .Subtitle | html_template_htmlescaper }}\n\n{{ range .Posts }}\n    {{ .Title | html_template_htmlescaper }}\n    {{ .Content | html_template_htmlescaper }}\n{{ end }}\n</code></pre>\n\n<p>Calling <code>html_template_htmlescaper</code> using reflection in a loop kills performance.</p>\n\n<p>Having said all that this micro-benchmark of <code>html/template</code> shouldn't be used to decide whether to use Go or not. Once you add code to work with the database to the request handler I suspect that template rendering time will hardly be noticeable.</p>\n\n<p>Also I am pretty sure that over time both Go reflection and <code>html/template</code> package will become faster.</p>\n\n<p>If in a real application you will find that <code>html/template</code> is a bottleneck it still possible to switch to <code>text/template</code> and supply it with already escaped data.</p>\n"}, {"tags": [], "owner": {"reputation": 2246, "user_id": 274937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d848784d081501a5cba4a2fa7856e965?s=128&d=identicon&r=PG", "display_name": "valyala", "link": "https://stackoverflow.com/users/274937/valyala"}, "is_accepted": false, "score": 1, "last_activity_date": 1458137802, "creation_date": 1458137802, "answer_id": 36038279, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround/36038279#36038279", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p><code>html/template</code> is slow because it uses <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow\">reflection</a>, which isn't optimized for speed yet.</p>\n\n<p>Try <a href=\"https://github.com/valyala/quicktemplate\" rel=\"nofollow\">quicktemplate</a> as a workaround of slow <code>html/template</code>. Currently <code>quicktemplate</code> is more than 20x faster than <code>html/template</code> according to the benchmark from its' source code.</p>\n"}, {"tags": [], "owner": {"reputation": 144, "user_id": 5148187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fY6Bu.jpg?s=128&g=1", "display_name": "Jo&#227;o Wiciuk", "link": "https://stackoverflow.com/users/5148187/jo%c3%a3o-wiciuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1579803310, "creation_date": 1579803310, "answer_id": 59884814, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround/59884814#59884814", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p>There is a template benchmark you can check at <a href=\"https://github.com/SlinSo/goTemplateBenchmark\" rel=\"nofollow noreferrer\">goTemplateBenchmark</a>. Personally, I think <a href=\"https://github.com/shiyanhui/hero\" rel=\"nofollow noreferrer\">Hero</a> is the one that best combines efficiency and readability.</p>\n"}], "owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6599, "favorite_count": 3, "accepted_answer_id": 31399199, "answer_count": 5, "score": 12, "last_activity_date": 1579803310, "creation_date": 1436648091, "last_edit_date": 1436713729, "question_id": 31361745, "link": "https://stackoverflow.com/questions/31361745/slow-performance-of-html-template-in-go-lang-any-workaround", "title": "Slow performance of html/template in Go lang, any workaround?", "body": "<p>I'm stress testing (with loader.io) this type of code in Go to create an array of 100 items along with some other basic variables and parse them all in the template:</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"net/http\"\n)\n\nvar templates map[string]*template.Template\n\n// Load templates on program initialisation\nfunc init() {\n    if templates == nil {\n        templates = make(map[string]*template.Template)\n    }\n\n    templates[\"index.html\"] = template.Must(template.ParseFiles(\"index.html\"))\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    type Post struct {\n        Id int\n        Title, Content string\n    }\n\n    var Posts [100]Post\n\n    // Fill posts\n    for i := 0; i &lt; 100; i++ {\n        Posts[i] = Post{i, \"Sample Title\", \"Lorem Ipsum Dolor Sit Amet\"}\n    }\n\n    type Page struct {\n        Title, Subtitle string\n        Posts [100]Post\n    }\n\n    var p Page\n\n    p.Title = \"Index Page of My Super Blog\"\n    p.Subtitle = \"A blog about everything\"\n    p.Posts = Posts\n\n    tmpl := templates[\"index.html\"]\n\n    tmpl.ExecuteTemplate(w, \"index.html\", p)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8888\", nil)\n}\n</code></pre>\n\n<p>My test with Loader is using 5k concurrent connections/s through 1 minute. The problem is, just after a few seconds after starting the test, I get a high average latency (almost 10s) and as a result 5k successful responses and the test stops because it reaches the Error Rate of 50% (timeouts).</p>\n\n<p>On the same machine, PHP gives 50k+.</p>\n\n<p>I understand that it's not Go performance issue, but probably something related to html/template. Go can easily manage hard enough calculations a lot faster than anything like PHP of course, but when it comes to parsing the data to the template, why is it so awful?</p>\n\n<p>Any workarounds, or probably I'm just doing it wrong (I'm new to Go)?</p>\n\n<p>P.S. Actually even with 1 item it's exactly the same... 5-6k and stopping after huge amount of timeouts. But that's probably because the array with posts is staying of the same length.</p>\n\n<p>My template code (index.html):</p>\n\n<pre><code>{{ .Title }}\n{{ .Subtitle }}\n\n{{ range .Posts }}\n        {{ .Title }}\n        {{ .Content }}\n{{ end }}\n</code></pre>\n\n<p>Here's the profiling result of github.com/pkg/profile:</p>\n\n<pre><code>root@Test:~# go tool pprof app /tmp/profile311243501/cpu.pprof\nPossible precedence issue with control flow operator at /usr/lib/go/pkg/tool/linux_amd64/pprof line 3008.\nWelcome to pprof!  For help, type 'help'.\n(pprof) top10\nTotal: 2054 samples\n      97   4.7%   4.7%      726  35.3% reflect.Value.call\n      89   4.3%   9.1%      278  13.5% runtime.mallocgc\n      85   4.1%  13.2%       86   4.2% syscall.Syscall\n      66   3.2%  16.4%       75   3.7% runtime.MSpan_Sweep\n      58   2.8%  19.2%     1842  89.7% text/template.(*state).walk\n      54   2.6%  21.9%      928  45.2% text/template.(*state).evalCall\n      51   2.5%  24.3%       53   2.6% settype\n      47   2.3%  26.6%       47   2.3% runtime.stringiter2\n      44   2.1%  28.8%      149   7.3% runtime.makeslice\n      40   1.9%  30.7%      223  10.9% text/template.(*state).evalField\n</code></pre>\n\n<p>These are profiling results after refining the code (as suggested in the answer by icza):</p>\n\n<pre><code>root@Test:~# go tool pprof app /tmp/profile501566907/cpu.pprof\nPossible precedence issue with control flow operator at /usr/lib/go/pkg/tool/linux_amd64/pprof line 3008.\nWelcome to pprof!  For help, type 'help'.\n(pprof) top10\nTotal: 2811 samples\n     137   4.9%   4.9%      442  15.7% runtime.mallocgc\n     126   4.5%   9.4%      999  35.5% reflect.Value.call\n     113   4.0%  13.4%      115   4.1% syscall.Syscall\n     110   3.9%  17.3%      122   4.3% runtime.MSpan_Sweep\n     102   3.6%  20.9%     2561  91.1% text/template.(*state).walk\n      74   2.6%  23.6%      337  12.0% text/template.(*state).evalField\n      68   2.4%  26.0%       72   2.6% settype\n      66   2.3%  28.3%     1279  45.5% text/template.(*state).evalCall\n      65   2.3%  30.6%      226   8.0% runtime.makeslice\n      57   2.0%  32.7%       57   2.0% runtime.stringiter2\n(pprof)\n</code></pre>\n"}, {"tags": ["go", "compilation"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 2, "creation_date": 1436646313, "post_id": 31360907, "comment_id": 50703755, "body": "I do not understand your question. Could you elaborate?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1436647831, "creation_date": 1436647831, "answer_id": 31361704, "question_id": 31360907, "link": "https://stackoverflow.com/questions/31360907/is-it-possible-to-compile-golang-code-with-dependencies/31361704#31361704", "title": "Is it possible to compile golang code with dependencies?", "body": "<p>As mentioned in \"<a href=\"http://blog.hashbangbash.com/2014/04/linking-golang-statically/\" rel=\"nofollow\">Linking golang statically</a>\" (<a href=\"http://www.slackware.com/~vbatts/\" rel=\"nofollow\">Vincent Batts</a>):</p>\n\n<blockquote>\n  <p>As long as the source being compiled is native go, the go compiler will statically link the executable.<br>\n  Though when you need to use cgo, then the compiler has to use its external linker.</p>\n</blockquote>\n\n<p>A pure go program will show like this:</p>\n\n<pre><code>$&gt; go build ./code-pure.go\n$&gt; ldd ./code-pure\n        not a dynamic executable\n$&gt; file ./code-pure\n./code-pure: ELF 64-bit LSB  executable, x86-64, version 1 (SYSV), statically linked, not stripped\n</code></pre>\n\n<p>This isn't so with cgo, unless you add an extra flag like:</p>\n\n<pre><code>go build --ldflags '-extldflags \"-static\"' ./code-cgo.go\n# or, with gccgo\ngo build -compiler gccgo --gccgoflags \"-static\" ./code-cgo.go\n</code></pre>\n\n<p>Reminder, even with Go 1.5 (which uses go for compilation, and not <code>gc</code>), <a href=\"https://talks.golang.org/2015/gogo.slide#2\" rel=\"nofollow\">gccgo will still be there</a>.</p>\n"}], "owner": {"reputation": 3319, "user_id": 1665263, "user_type": "registered", "accept_rate": 15, "profile_image": "https://i.stack.imgur.com/H3nUc.gif?s=128&g=1", "display_name": "agrynchuk", "link": "https://stackoverflow.com/users/1665263/agrynchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1162, "favorite_count": 1, "closed_date": 1436734651, "answer_count": 1, "score": -2, "last_activity_date": 1436647831, "creation_date": 1436642537, "question_id": 31360907, "link": "https://stackoverflow.com/questions/31360907/is-it-possible-to-compile-golang-code-with-dependencies", "closed_reason": "Needs details or clarity", "title": "Is it possible to compile golang code with dependencies?", "body": "<p>Is it possible to compile golang code with dependencies? For an executable file was small.</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 1, "creation_date": 1436637864, "post_id": 31359904, "comment_id": 50701465, "body": "it could be easier to generate the values you need in your main program then pass them to the template, instead of trying to generate them in the template and return them to the caller..."}, {"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1436638017, "post_id": 31359904, "comment_id": 50701501, "body": "Yes, it would be easier, but in that case, I would have to modify the program and compile it everytime I want to change the behaviour. This way, it can be done externally by someone else who knows how to create templates but not how to program in Go."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 1, "last_activity_date": 1436668206, "last_edit_date": 1436668206, "creation_date": 1436667547, "answer_id": 31363738, "question_id": 31359904, "link": "https://stackoverflow.com/questions/31359904/getting-values-from-a-template-execution/31363738#31363738", "title": "Getting values from a template execution", "body": "<p>You don't actually need to pass a funcmap, just pass the struct.</p>\n\n<pre><code>var tmpl = template.Must(template.New(\"test\").Parse(`Before: {{.Data}}{{.Set \"YY\"}}, after: {{.Data}}`))\n\nfunc main() {\n    c := &amp;CustomData{\"XX\"}\n    tmpl.Execute(os.Stdout, c)\n    fmt.Println()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/2eLSFoTdtn\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n\n<p><strike>You can always pass a <a href=\"http://golang.org/pkg/html/template/#FuncMap\" rel=\"nofollow\"><code>FuncMap</code></a> to the template, here's an extremely simple example: </strike></p>\n\n<pre><code>const tmpl = `Before: {{.Data}}{{.Set \"YY\"}}, after: {{.Data}}`\n\ntype CustomData struct {\n    Data string\n}\n\nfunc (c *CustomData) Set(d string) string { // it has to return anything\n    c.Data = d\n    return \"\"\n}\n\nfunc main() {\n    c := &amp;CustomData{\"XX\"}\n    funcMap := template.FuncMap{\n        \"Set\": c.Set,\n    }\n    t, _ := template.New(\"test\").Funcs(funcMap).Parse(tmpl) // don't ignore errors in real code\n    t.Execute(os.Stdout, c)\n    fmt.Println()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/-MRe1sK3pA\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 31363738, "answer_count": 1, "score": 1, "last_activity_date": 1436668206, "creation_date": 1436635877, "question_id": 31359904, "link": "https://stackoverflow.com/questions/31359904/getting-values-from-a-template-execution", "title": "Getting values from a template execution", "body": "<p>I have a HTML template that I execute passing a map[string]string variable. The template uses the variable to create the HTML output that I send to clients.</p>\n\n<p>In addition to producing the HTML, I would like to use the very same template to generate some values that are retured to the main program, so I can use the same file to put some logic externally. </p>\n\n<p>As far as I know, it is not possible to modify the variable I pass to Execute (something like <code>{{.output = \"value\"}}</code>). </p>\n\n<p>So how could I get multiple output values from a template Execution? </p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 3048, "user_id": 1161812, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0d7beefda859c7d02439a323ae8d142a?s=128&d=identicon&r=PG", "display_name": "danqing", "link": "https://stackoverflow.com/users/1161812/danqing"}, "edited": false, "score": 0, "creation_date": 1436767301, "post_id": 31359777, "comment_id": 50731213, "body": "So for HTTP in Go, which part is expensive so that we should reuse as much as possible, if any, and why?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3048, "user_id": 1161812, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0d7beefda859c7d02439a323ae8d142a?s=128&d=identicon&r=PG", "display_name": "danqing", "link": "https://stackoverflow.com/users/1161812/danqing"}, "edited": false, "score": 1, "creation_date": 1436795685, "post_id": 31359777, "comment_id": 50747483, "body": "@Danqing: What do you mean &quot;which part is expensive&quot;? Client and Transport- and what do you mean by &quot;expensive&quot;? Everything has a cost, so reuse what you can. For example, the Transport is where the connections are handled, hence using a single transport increases the likelihood of reusing connections."}, {"owner": {"reputation": 985, "user_id": 292095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/977ae09ff56044340ea0de3479869687?s=128&d=identicon&r=PG", "display_name": "mjturner", "link": "https://stackoverflow.com/users/292095/mjturner"}, "edited": false, "score": 0, "creation_date": 1593292382, "post_id": 31359777, "comment_id": 110730455, "body": "Is this correct? From the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">net/http</a> documentation: <i>&quot;Clients and Transports are safe for concurrent use by multiple goroutines and for efficiency should only be created once and re-used.&quot;</i>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 985, "user_id": 292095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/977ae09ff56044340ea0de3479869687?s=128&d=identicon&r=PG", "display_name": "mjturner", "link": "https://stackoverflow.com/users/292095/mjturner"}, "edited": false, "score": 0, "creation_date": 1593292695, "post_id": 31359777, "comment_id": 110730523, "body": "@mjturner, you can use a client concurrently, but you cannot modify it concurrently."}, {"owner": {"reputation": 985, "user_id": 292095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/977ae09ff56044340ea0de3479869687?s=128&d=identicon&r=PG", "display_name": "mjturner", "link": "https://stackoverflow.com/users/292095/mjturner"}, "edited": false, "score": 0, "creation_date": 1593293235, "post_id": 31359777, "comment_id": 110730628, "body": "@JimB Ah, gotcha - makes sense."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1436795368, "last_edit_date": 1436795368, "creation_date": 1436635135, "answer_id": 31359777, "question_id": 31359043, "link": "https://stackoverflow.com/questions/31359043/golang-goroutine-safe-http-client-with-different-timeout/31359777#31359777", "title": "Golang goroutine-safe http client with different timeout?", "body": "<p>You need to use different Clients. Even if you protect your function with a mutex, you can't protect the internal access by the Client, and another goroutine could change it while making the request. </p>\n\n<p>Multiple Clients can still share the same Transport, and they both will use the DefaultTransport if you don't specify one.</p>\n"}], "owner": {"reputation": 3048, "user_id": 1161812, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0d7beefda859c7d02439a323ae8d142a?s=128&d=identicon&r=PG", "display_name": "danqing", "link": "https://stackoverflow.com/users/1161812/danqing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1249, "favorite_count": 1, "accepted_answer_id": 31359777, "answer_count": 1, "score": 0, "last_activity_date": 1436795368, "creation_date": 1436630564, "question_id": 31359043, "link": "https://stackoverflow.com/questions/31359043/golang-goroutine-safe-http-client-with-different-timeout", "title": "Golang goroutine-safe http client with different timeout?", "body": "<p>Suppose I have the following function:</p>\n\n<pre><code>func SendRequest(c *Client, timeout time.Duration) {\n  if timeout &gt; 0 {\n    c.Timeout = timeout\n  } else {\n    c.Timeout = defaultTimeout\n  }\n  ...\n}\n</code></pre>\n\n<p>I want to allow multiple go-routines to call this function (to share the same HTTP client), but the way this is written apparently can't guarantee goroutine safety. (Also changing the timeout of the client passed in is weird too...)</p>\n\n<p>I'm not sure what's the best way to do this. Should I use different client for different timeouts? Should I use some mutex? Or in general how do I share a HTTP client with different timeouts?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 2, "creation_date": 1436619580, "post_id": 31357414, "comment_id": 50696304, "body": "&quot;Somehow the result is broken&quot;..."}, {"owner": {"reputation": 89, "user_id": 5091584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc1a0e14477d4ff4706fc566070546d?s=128&d=identicon&r=PG", "display_name": "Seif Lotfy", "link": "https://stackoverflow.com/users/5091584/seif-lotfy"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1436619875, "post_id": 31357414, "comment_id": 50696386, "body": "Improved description"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1436620536, "post_id": 31357414, "comment_id": 50696557, "body": "Try replacing <code>unsafe.Pointer(&amp;s)</code> with <code>unsafe.Pointer(&amp;s[0])</code>. FWIW, A <a href=\"https://godoc.org/github.com/dgryski/go-farmhash\" rel=\"nofollow noreferrer\">Go binding for farmhash</a> already exists."}, {"owner": {"reputation": 89, "user_id": 5091584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc1a0e14477d4ff4706fc566070546d?s=128&d=identicon&r=PG", "display_name": "Seif Lotfy", "link": "https://stackoverflow.com/users/5091584/seif-lotfy"}, "edited": false, "score": 0, "creation_date": 1436624212, "post_id": 31357414, "comment_id": 50697444, "body": "Those bindings are broken afaict. I can get it to segfault! also it reports way different stuff than the other bindings from other languages (python-farmhash);"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1436624695, "post_id": 31357414, "comment_id": 50697580, "body": "<a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">RTM</a>, also <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 3, "creation_date": 1436626553, "post_id": 31357414, "comment_id": 50698097, "body": "the code in which <code>::</code> is used for namespace qualification doesn&#39;t quite look like C."}], "answers": [{"tags": [], "owner": {"reputation": 4577, "user_id": 217965, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/2f56f147c441727ffd27a57d747f131c?s=128&d=identicon&r=PG", "display_name": "Drew", "link": "https://stackoverflow.com/users/217965/drew"}, "is_accepted": false, "score": 3, "last_activity_date": 1437624014, "creation_date": 1437624014, "answer_id": 31577925, "question_id": 31357414, "link": "https://stackoverflow.com/questions/31357414/passing-a-byte-array-from-go-to-cgo/31577925#31577925", "title": "passing a byte array from go to cgo", "body": "<p>Yes, you can create *C.char in Go via <code>C.CString</code>. cgo is not allowed on google playground, so you will need to download this link and run it locally to use it.</p>\n\n<p><a href=\"http://play.golang.org/p/inthA1i0C2\" rel=\"nofollow\">http://play.golang.org/p/inthA1i0C2</a></p>\n\n<p>Convert the byte slice to a string, then to *char <code>C.CString(string([]byte(\"bytes\")))</code>.</p>\n"}], "owner": {"reputation": 89, "user_id": 5091584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc1a0e14477d4ff4706fc566070546d?s=128&d=identicon&r=PG", "display_name": "Seif Lotfy", "link": "https://stackoverflow.com/users/5091584/seif-lotfy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3003, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437624014, "creation_date": 1436619376, "last_edit_date": 1436619862, "question_id": 31357414, "link": "https://stackoverflow.com/questions/31357414/passing-a-byte-array-from-go-to-cgo", "title": "passing a byte array from go to cgo", "body": "<p>I have the following C code</p>\n\n<pre><code>uint32_t cHash32(const char *s, size_t len) { return util::Hash32(s, len); }\n</code></pre>\n\n<p>I am calling it from a go project as follows</p>\n\n<pre><code>func Hash32(s []byte) uint32 {\n    return uint32(C.cHash32((*C.char)(unsafe.Pointer(&amp;s)),   C.size_t(len(s))))\n}\n</code></pre>\n\n<p>Somehow the result is broken.</p>\n\n<p>When passing \"hi\" the expected result should be 4063302914 according to the python bindings to the same library (farmhash by google).</p>\n\n<p>I guess that assuming s can be translated to a *C.char is a bit naive isn't it!</p>\n\n<p>How do I pass the content of s as a *C.char?</p>\n"}, {"tags": ["function", "data-structures", "types", "go", "parameters"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1436608793, "post_id": 31355426, "comment_id": 50693473, "body": "These are slices, not arrays. It is important because with slices you can operate on the same data, while arrays are separate values."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436631486, "post_id": 31355426, "comment_id": 50699509, "body": "Side note: if the slice (as already noted, <i>not</i> an array) might be large then a better implementation would be to construct a map (actually a set) from the input slice and then turn the map keys into a slice for return. If this kind of thing is done often then the original data type should likely be changed to be a map (or a compound object that includes a map)."}, {"owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "edited": false, "score": 0, "creation_date": 1436635577, "post_id": 31355426, "comment_id": 50700775, "body": "Yeah, i should say slice in this case. But because a slice describes a section of an array, it&#39;s something make me confused why i cant call it as array - in a more generalist way."}], "answers": [{"comments": [{"owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "edited": false, "score": 0, "creation_date": 1436866140, "post_id": 31355752, "comment_id": 50779626, "body": "Thanks, it works perfectly and it seems very idiomatic as well."}], "tags": [], "owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "is_accepted": true, "score": 2, "last_activity_date": 1436608334, "last_edit_date": 1436608334, "creation_date": 1436607775, "answer_id": 31355752, "question_id": 31355426, "link": "https://stackoverflow.com/questions/31355426/passing-different-types-parameters-to-the-function/31355752#31355752", "title": "Passing different type&#39;s parameters to the function", "body": "<p>If you alter the function signature to accept interface{} you can get something that works on built in types.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := []interface{}{\"bob\", \"doug\", \"bob\"}\n    fmt.Println(RemoveDuplicate(x))\n    y := []interface{}{1, 3, 1}\n    fmt.Println(RemoveDuplicate(y))\n    z := []interface{}{\"bob\", \"2\", \"doug\", 3, 2, \"bob\"}\n    fmt.Println(RemoveDuplicate(z)) \n}\n\nfunc RemoveDuplicate(arr []interface{}) []interface{} {\n    arr2 := arr[:1]\nLoop:\n    for i := 1; i &lt; len(arr); {\n        for j := 0; j &lt; len(arr2); {\n            if arr[i] != arr[j] {\n                j++\n            } else {\n                i++\n                continue Loop\n            }\n        }\n        arr2 = append(arr2, arr[i])\n        i++\n    }\n    return arr2\n}\n</code></pre>\n\n<p>Have a look at the FAQ <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow\">Can I convert a []T to an []interface{}?</a> (and the one before) for more information.</p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1436608734, "creation_date": 1436608734, "answer_id": 31355909, "question_id": 31355426, "link": "https://stackoverflow.com/questions/31355426/passing-different-types-parameters-to-the-function/31355909#31355909", "title": "Passing different type&#39;s parameters to the function", "body": "<p>Any kind of generic algorithms in Go can be implemented with either of two mechanisms: interfaces and reflection. With interfaces, you can do it similarly to the <a href=\"http://golang.org/pkg/sort/\" rel=\"nofollow\"><code>sort</code></a> package:</p>\n\n<pre><code>type Slice interface {\n    Len() int\n    Swap(i, j int)\n    Eq(i, j int) bool\n    SubSlice(i, j int) Slice\n}\n\nfunc RemoveDuplicate(s Slice) Slice {\n    n := 1\nLoop:\n    for i := 1; i &lt; s.Len(); i++ {\n        for j := 0; j &lt; n; j++ {\n            if s.Eq(i, j) {\n                continue Loop\n            }\n        }\n        s.Swap(n, i)\n        n++\n    }\n    return s.SubSlice(0, n)\n}\n</code></pre>\n\n<p>Playground with ints and strings: <a href=\"http://play.golang.org/p/WwC27eP72n\" rel=\"nofollow\">http://play.golang.org/p/WwC27eP72n</a>.</p>\n"}], "owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 31355752, "answer_count": 2, "score": 2, "last_activity_date": 1436635623, "creation_date": 1436605568, "last_edit_date": 1436635623, "question_id": 31355426, "link": "https://stackoverflow.com/questions/31355426/passing-different-types-parameters-to-the-function", "title": "Passing different type&#39;s parameters to the function", "body": "<p>I have this function and i would like to make it be able to receive all types of slices, not only []string, but []int and so on... I would like to know if is there some way to abstract the type when passing the parameter to the function header or if i should do other thing to accomplish that.</p>\n\n<pre><code>package removeDuplicate\n\n// RemoveDuplicate remove duplicate items from slice setting it to arr2\nfunc RemoveDuplicate(arr []string) []string {\n    arr2 := arr[:1]\nLoop:\n    for i := 1; i &lt; len(arr); {\n        for j := 0; j &lt; len(arr2); {\n            if arr[i] != arr[j] {\n                j++\n            } else {\n                i++\n                continue Loop\n            }\n        }\n        arr2 = append(arr2, arr[i])\n        i++\n    }\n    return arr2\n}\n</code></pre>\n\n<p>Thanks in advance =]</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1436646414, "post_id": 31354304, "comment_id": 50703790, "body": "I don&#39;t see why this question is downvoted."}], "answers": [{"comments": [{"owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "edited": false, "score": 0, "creation_date": 1436626791, "post_id": 31354340, "comment_id": 50698171, "body": "So, for fork and develop purposes, I&#39;d have to look through all files in the package to hunt for where functions are written via grep?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "edited": false, "score": 0, "creation_date": 1436635543, "post_id": 31354340, "comment_id": 50700769, "body": "@paulkon how is this different than any other language that can compile from multiple files?  You can use whatever tooling your comfortable with. The standard <code>godoc</code> is very useful for this."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "edited": false, "score": 0, "creation_date": 1436646400, "post_id": 31354340, "comment_id": 50703781, "body": "@paulkon Yes. All the files of a package form that package. Lower-case symbols have package-scope, not file-scope."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "edited": false, "score": 0, "creation_date": 1436649056, "post_id": 31354340, "comment_id": 50704504, "body": "@paulkon I recommend using a good editor, sublime text + gosublime or atom with goplus or even vim."}], "tags": [], "owner": {"reputation": 23094, "user_id": 473914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/333f7be87dc935f7a362cabb0a4abce7?s=128&d=identicon&r=PG", "display_name": "tobyodavies", "link": "https://stackoverflow.com/users/473914/tobyodavies"}, "is_accepted": true, "score": 2, "last_activity_date": 1436597441, "creation_date": 1436597441, "answer_id": 31354340, "question_id": 31354304, "link": "https://stackoverflow.com/questions/31354304/implicit-private-function-import/31354340#31354340", "title": "Implicit private function import?", "body": "<p>Both are in the same package. In Go you import packages, not files, thus the private function is available.</p>\n"}], "owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 31354340, "answer_count": 1, "score": -1, "last_activity_date": 1436597441, "creation_date": 1436597219, "question_id": 31354304, "link": "https://stackoverflow.com/questions/31354304/implicit-private-function-import", "title": "Implicit private function import?", "body": "<p>How is <code>main.go</code> able to use <code>buildIndexMapping</code>?</p>\n\n<p>The function is not uppercased so how is it publicly accessible within the package and that too without an explicit import of <code>mapping.go</code>?</p>\n\n<p><strong>main.go</strong>: <a href=\"https://github.com/blevesearch/beer-search/blob/721fab2198a52d919133df08058fde8043bab365/main.go#L55\" rel=\"nofollow\">https://github.com/blevesearch/beer-search/blob/721fab2198a52d919133df08058fde8043bab365/main.go#L55</a></p>\n\n<p><strong>mapping.go</strong>: <a href=\"https://github.com/blevesearch/beer-search/blob/721fab2198a52d919133df08058fde8043bab365/mapping.go#L19\" rel=\"nofollow\">https://github.com/blevesearch/beer-search/blob/721fab2198a52d919133df08058fde8043bab365/mapping.go#L19</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436630353, "post_id": 31353522, "comment_id": 50699176, "body": "Also see <a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">The Go Blog: Constants</a>. In your specific example making <code>a</code> an untyped constant (i.e. <code>const i = 1</code>) would avoid the need for explicit conversion."}, {"owner": {"reputation": 655, "user_id": 4064661, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b64710b9285fc7793b9b782252073c29?s=128&d=identicon&r=PG", "display_name": "breeden", "link": "https://stackoverflow.com/users/4064661/breeden"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436633064, "post_id": 31353522, "comment_id": 50699991, "body": "@DaveC Yeah, I read that last night.  It was a good read and cleared up a few details for me."}], "answers": [{"comments": [{"owner": {"reputation": 655, "user_id": 4064661, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b64710b9285fc7793b9b782252073c29?s=128&d=identicon&r=PG", "display_name": "breeden", "link": "https://stackoverflow.com/users/4064661/breeden"}, "edited": false, "score": 0, "creation_date": 1436591080, "post_id": 31353577, "comment_id": 50689643, "body": "Thank you!  I didn&#39;t think that automatically converting numeric types would break the strictly-statically typed language as is shown in C.  I didn&#39;t consider the complications involved with unsigned vs signed and overflow problems."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 655, "user_id": 4064661, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b64710b9285fc7793b9b782252073c29?s=128&d=identicon&r=PG", "display_name": "breeden", "link": "https://stackoverflow.com/users/4064661/breeden"}, "edited": false, "score": 1, "creation_date": 1436591318, "post_id": 31353577, "comment_id": 50689684, "body": "@breeden yes, you can see what one of the creators of that language Go (Rob Pike) has to say about this: <a href=\"http://blog.golang.org/constants\" rel=\"nofollow noreferrer\">blog.golang.org/constants</a>: &quot;When designing Go, we decided to avoid this minefield by mandating that there is no mixing of numeric types. If you want to add i and u, you must be explicit about what you want the result to be.&quot;"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 14, "last_activity_date": 1436590513, "creation_date": 1436590513, "answer_id": 31353577, "question_id": 31353522, "link": "https://stackoverflow.com/questions/31353522/why-must-i-convert-an-integer-to-a-float64-to-type-match/31353577#31353577", "title": "Why must I convert an integer to a float64 to type match?", "body": "<p>This is mentioned in the FAQ: <a href=\"https://golang.org/doc/faq#conversions\" rel=\"noreferrer\">Why does Go not provide implicit numeric conversions?</a></p>\n\n<blockquote>\n  <p>The convenience of automatic conversion between numeric types in C is outweighed by the confusion it causes. When is an expression unsigned? How big is the value? Does it overflow? Is the result portable, independent of the machine on which it executes?<br>\n  It also complicates the compiler.</p>\n</blockquote>\n\n<p>That is why you need:</p>\n\n<ul>\n<li><p>either to do an explicit <strong><a href=\"http://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">type conversion</a></strong>:</p>\n\n<pre><code>c := float64(a)/b\n</code></pre></li>\n<li><p>or to use <code>var float64</code></p>\n\n<pre><code>var a, b float64\na = 1     //float64\nb = 1.0   //float64\nc := a/b \n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 655, "user_id": 4064661, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b64710b9285fc7793b9b782252073c29?s=128&d=identicon&r=PG", "display_name": "breeden", "link": "https://stackoverflow.com/users/4064661/breeden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9505, "favorite_count": 2, "accepted_answer_id": 31353577, "answer_count": 1, "score": 11, "last_activity_date": 1436633256, "creation_date": 1436589939, "last_edit_date": 1436633256, "question_id": 31353522, "link": "https://stackoverflow.com/questions/31353522/why-must-i-convert-an-integer-to-a-float64-to-type-match", "title": "Why must I convert an integer to a float64 to type match?", "body": "<p>I have been playing around with Go and I ran into a (non?)feature of Go while running the following code:</p>\n\n<pre><code>a := 1     //int\nb := 1.0   //float64\n\nc := a/b   //should be float64\n</code></pre>\n\n<p>When I ran this I get the following run-time error:</p>\n\n<pre><code>invalid operation: a / b (mismatched types int and float64) \n</code></pre>\n\n<p>I thought GoLang was supposed to be pretty good with type inference.  Why should it be necessary for me to write:</p>\n\n<pre><code>c := float64(a)/b    //float64\n</code></pre>\n\n<p>In general, given two number types, c should be inferred to be the smallest type that contains both.  I can't see this as being an oversight, so I am just trying to figure out why this behavior was decided upon.  For readability reasons only?  Or would my suggested behavior cause some kind of logical inconsistency in language or something?</p>\n"}, {"tags": ["unit-testing", "testing", "import", "go", "main"], "comments": [{"owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "edited": false, "score": 0, "creation_date": 1436575536, "post_id": 31352239, "comment_id": 50687269, "body": "There&#39;s a good video introduction to the testing package in this video (starting at 3m30s) <a href=\"https://youtu.be/XCsL89YtqCs?t=3m30s\" rel=\"nofollow noreferrer\">https://youtu.be/XCsL89YtqCs?t=3m30s</a>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1436592175, "post_id": 31352239, "comment_id": 50689840, "body": "Your main() function (and ideally, your package main as a whole) shouldn&#39;t need testing: it should be a &quot;dumb&quot; endpoint for a library or libraries. Test those."}, {"owner": {"reputation": 3456, "user_id": 419097, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/99d9c8a12fbedd5a8b8309ade725dc36?s=128&d=identicon&r=PG", "display_name": "b01", "link": "https://stackoverflow.com/users/419097/b01"}, "edited": false, "score": 0, "creation_date": 1606915771, "post_id": 31352239, "comment_id": 115107073, "body": "The function &quot;foo&quot; in <code>main.go</code> begins with a lowercase &quot;f&quot; making it private, so I don&#39;t think your test can call it directly, as it would not have access."}], "answers": [{"comments": [{"owner": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "edited": false, "score": 5, "creation_date": 1538149382, "post_id": 31352478, "comment_id": 92055987, "body": "but to achieve 100% coverage, the main function needs to be tested, how can this be achieved?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "edited": false, "score": 7, "creation_date": 1538158428, "post_id": 31352478, "comment_id": 92059963, "body": "@perrohunter 100% test coverage is a mirage. Don&#39;t bother with it. The thing I hate most about unrealistic test coverage policies is one time I added an if err to something like a file close it reduced the test coverage because we couldn&#39;t simulate a file close error. It may have been untested but that&#39;s 100% better than ignoring the error and pretending it can&#39;t happen!"}, {"owner": {"reputation": 301, "user_id": 3833263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75d580fb2544563a80e0feb3296baae0?s=128&d=identicon&r=PG&f=1", "display_name": "Michael B.", "link": "https://stackoverflow.com/users/3833263/michael-b"}, "edited": false, "score": 9, "creation_date": 1550542227, "post_id": 31352478, "comment_id": 96297179, "body": "I don&#39;t want to start a code coverage rage war here, but I disagree with the statement that 100% coverage is a mirage. Pragmatically speaking, yes, there are times when the cost of delayed delivery of software due to satisfying a coverage policy outweighs the cost of not covering manually tested code. But when you say that you couldn&#39;t simulate a file close error, that&#39;s actually a design flaw. This is where interfaces come in handy in Go. For example, &quot;func Foo(file os.File)&quot; is not as easily tested as &quot;func Foo(file io.ReadWriteCloser)&quot;"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 17, "last_activity_date": 1436577316, "creation_date": 1436577316, "answer_id": 31352478, "question_id": 31352239, "link": "https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang/31352478#31352478", "title": "How to test the main package functions in golang?", "body": "<p>Unit tests only go so far. At some point you have to actually run the program. Then you test that it works with real input, from real sources, producing real output to real destinations. For real.</p>\n\n<p>If you want to unit test a thing move it out of main().</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 6, "creation_date": 1436630142, "post_id": 31352521, "comment_id": 50699100, "body": "Why are you specifying any files at all to <code>go test</code>? Don&#39;t."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1436648162, "post_id": 31352521, "comment_id": 50704259, "body": "true, but I figured the persona asking is struggling a bit and I didn&#39;t want to confuse the issue with setting GOPATH or anything like that.  Make &quot;go test .&quot; would work?  (haven&#39;t tried that outside of GOPATH before)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088543"}, "edited": false, "score": 0, "creation_date": 1460661370, "post_id": 31352521, "comment_id": 60859345, "body": "You don&#39;t want your test file to be in the main package. You will end up with a lot of code and flags you didn&#39;t want if you do."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 30, "last_activity_date": 1436577862, "creation_date": 1436577862, "answer_id": 31352521, "question_id": 31352239, "link": "https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang/31352521#31352521", "title": "How to test the main package functions in golang?", "body": "<p>when you specify files on the command line, you have to specify all of them</p>\n\n<p>Here's my run:</p>\n\n<pre><code>$ ls\nmain.go     main_test.go\n$ go test *.go\nok      command-line-arguments  0.003s\n</code></pre>\n\n<p>note, in my version, I ran with both main.go and main_test.go on the command line</p>\n\n<p>Also, your _test file is not quite right, you need your test function to be called TestXXX and take a pointer to testing.T</p>\n\n<p>Here's the modified verison:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc TestFoo(t *testing.T) {\n    t.Error(foo())\n}\n</code></pre>\n\n<p>and the modified output:</p>\n\n<pre><code>$ go test *.go\n--- FAIL: TestFoo (0.00s)\n    main_test.go:8: Foo\nFAIL\nFAIL    command-line-arguments  0.003s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4242, "user_id": 367180, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e356e3a921bedb73efd7594ff7f37b73?s=128&d=identicon&r=PG", "display_name": "matthias krull", "link": "https://stackoverflow.com/users/367180/matthias-krull"}, "edited": false, "score": 0, "creation_date": 1512922456, "post_id": 44152652, "comment_id": 82441627, "body": "The answer doesn&#39;t really answer the the question. It is just a complicated equivalent to calling <code>go test</code> without specifying files."}], "tags": [], "owner": {"reputation": 7, "user_id": 4247681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3N3MP.jpg?s=128&g=1", "display_name": "Levente Tak&#225;cs", "link": "https://stackoverflow.com/users/4247681/levente-tak%c3%a1cs"}, "is_accepted": false, "score": -4, "last_activity_date": 1495613513, "creation_date": 1495613513, "answer_id": 44152652, "question_id": 31352239, "link": "https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang/44152652#44152652", "title": "How to test the main package functions in golang?", "body": "<p>Change package name from main to foobar in both sources.\nMove source files under src/foobar.</p>\n\n<pre><code>mkdir -p src/foobar\nmv main.go main_test.go src/foobar/\n</code></pre>\n\n<p>Make sure to set GOPATH to the folder where src/foobar resides.</p>\n\n<pre><code>export GOPATH=`pwd -P`\n</code></pre>\n\n<p>Test it with</p>\n\n<pre><code>go test foobar\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 910, "user_id": 426853, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7fbf02bd4eb6fa180937d44a6afdcd0?s=128&d=identicon&r=PG", "display_name": "Mike Ellis", "link": "https://stackoverflow.com/users/426853/mike-ellis"}, "is_accepted": false, "score": 6, "last_activity_date": 1553437027, "creation_date": 1553437027, "answer_id": 55324723, "question_id": 31352239, "link": "https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang/55324723#55324723", "title": "How to test the main package functions in golang?", "body": "<p>This is <strong>not</strong> a direct answer to the OP's question and I'm in general agreement with prior answers and comments urging that <code>main</code> should be mostly a caller of packaged functions. That being said, here's an approach I'm finding useful for testing executables. It makes use of <code>log.Fataln</code> and <code>exec.Command</code>.</p>\n\n<ol>\n<li>Write <code>main.go</code> with a deferred function that calls log.Fatalln() to write a message to stderr before returning. </li>\n<li>In <code>main_test.go</code>, use <code>exec.Command(...)</code> and <code>cmd.CombinedOutput()</code> to run your program with arguments chosen to test for some expected outcome.</li>\n</ol>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n    // Ensure we exit with an error code and log message\n    // when needed after deferred cleanups have run.\n    // Credit: https://medium.com/@matryer/golang-advent-calendar-day-three-fatally-exiting-a-command-line-tool-with-grace-874befeb64a4\n    var err error\n    defer func() {\n        if err != nil {\n            log.Fatalln(err)\n        }\n    }()\n\n    // Initialize and do stuff\n\n    // check for errors in the usual way\n    err = somefunc()\n    if err != nil {\n        err = fmt.Errorf(\"somefunc failed : %v\", err)\n        return\n    }\n\n    // do more stuff ...\n\n }\n</code></pre>\n\n<p>In <code>main_test.go</code>,a test for, say, bad arguments that should cause <code>somefunc</code> to fail could look like:</p>\n\n<pre><code>func TestBadArgs(t *testing.T) {\n    var err error\n    cmd := exec.Command(yourprogname, \"some\", \"bad\", \"args\")\n    out, err := cmd.CombinedOutput()\n    sout := string(out) // because out is []byte\n    if err != nil &amp;&amp; !strings.Contains(sout, \"somefunc failed\") {\n        fmt.Println(sout) // so we can see the full output \n        t.Errorf(\"%v\", err)\n    }\n}\n</code></pre>\n\n<p>Note that <code>err</code> from <code>CombinedOutput()</code> is the non-zero exit code from log.Fatalln's under-the-hood call to <code>os.Exit(1)</code>. That's why we need to use <code>out</code> to extract the error message from <code>somefunc</code>.</p>\n\n<p>The <code>exec</code> package also provides <code>cmd.Run</code> and <code>cmd.Output</code>. These may be more appropriate than <code>cmd.CombinedOutput</code> for some tests. I also find it useful to have a <code>TestMain(m *testing.M)</code> function that does setup and cleanup before and after running the tests.</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    // call flag.Parse() here if TestMain uses flags\n    os.Mkdir(\"test\", 0777) // set up a temporary dir for generate files\n\n    // Create whatever testfiles are needed in test/\n\n    // Run all tests and clean up\n    exitcode := m.Run()\n    os.RemoveAll(\"test\") // remove the directory and its contents.\n    os.Exit(exitcode)\n</code></pre>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40669, "favorite_count": 2, "answer_count": 4, "score": 45, "last_activity_date": 1553437027, "creation_date": 1436574810, "question_id": 31352239, "link": "https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang", "title": "How to test the main package functions in golang?", "body": "<p>I want to test a few functions that are included in my main package, but my tests don't appear to be able to access those functions.</p>\n\n<p>My sample main.go file looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n)\n\nfunc main() {\n    log.Printf(foo())\n}\n\nfunc foo() string {\n    return \"Foo\"\n}\n</code></pre>\n\n<p>and my main_test.go file looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc Foo(t testing.T) {\n    t.Error(foo())\n}\n</code></pre>\n\n<p>when I run <code>go test main_test.go</code> I get</p>\n\n<pre><code># command-line-arguments\n.\\main_test.go:8: undefined: foo\nFAIL    command-line-arguments [build failed]\n</code></pre>\n\n<p>As I understand, even if I moved the test file elsewhere and tried importing from the main.go file, I couldn't import it, since it's <code>package main</code>.</p>\n\n<p>What is the correct way of structuring such tests? Should I just remove everything from the <code>main</code> package asides a simple main function to run everything and then test the functions in their own package, or is there a way for me to call those functions from the main file during testing?</p>\n"}, {"tags": ["json", "struct", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1436569943, "post_id": 31351553, "comment_id": 50686251, "body": "More info is needed to help: Please show the Members struct, the code that calls Unmarshal and tell us about any errors returned from unmarshal."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1436574251, "post_id": 31351553, "comment_id": 50687051, "body": "<a href=\"http://play.golang.org/p/uuO8iGh2Uo\" rel=\"nofollow noreferrer\">play.golang.org/p/uuO8iGh2Uo</a> &lt; it works fine, are you sure you&#39;re using a pointer?"}, {"owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "edited": false, "score": 0, "creation_date": 1436578693, "post_id": 31351553, "comment_id": 50687786, "body": "Sorry something busy came up. I&#39;ll try to answer everyone. go version: <code>go version go1.4.1 darwin&#47;amd64</code> I&#39;ll add more info when I get the chance. Also it looks like it&#39;s working for you OneOfOne hmm. This was example code, I&#39;ll post the actual code shortly"}], "answers": [{"tags": [], "owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "is_accepted": true, "score": 0, "last_activity_date": 1436799103, "creation_date": 1436799103, "answer_id": 31386643, "question_id": 31351553, "link": "https://stackoverflow.com/questions/31351553/golang-json-unmarshal-multiple-calls/31386643#31386643", "title": "Golang JSON Unmarshal multiple calls", "body": "<p>Alright so my issue has nothing to do with <code>Unmarshal</code> per say. What was happening was that the API response returns:</p>\n\n<pre><code>{\n   results: [{\n          group_id: 123,\n          group_name: \"cool kids\"\n       }, ...],\n   ...\n}\n</code></pre>\n\n<p>...each result being an individual group. My problem was that each group was it's own struct and I had a method for the <code>Group</code> struct that would make the next call to expand its <code>Members</code> field, and I was using the <code>Group</code> struct as the destination for <code>Unmarshal</code> instead of something like <code>Results</code> which would be structured correctly for the API response and THEN extract the correct <code>Group</code> and its <code>Members</code> field</p>\n"}], "owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 31386643, "answer_count": 1, "score": 0, "last_activity_date": 1436799103, "creation_date": 1436569171, "last_edit_date": 1436652670, "question_id": 31351553, "link": "https://stackoverflow.com/questions/31351553/golang-json-unmarshal-multiple-calls", "title": "Golang JSON Unmarshal multiple calls", "body": "<p>I'm writing an API wrapper where a call to the API returns a json response of some data, lets say:</p>\n\n<pre><code>{\n    group_id: 123,\n    group_name: \"cool kids\",\n}\n</code></pre>\n\n<p>for the url <code>example.com/api/groups</code></p>\n\n<p>You can then append <code>fields=members</code> to the url (so something like: <code>example.com/api/groups?group_id=123&amp;fields=members</code>) to then get:</p>\n\n<pre><code>{\n    members: [...some data..]\n}\n</code></pre>\n\n<p>Note how the other fields are now missing...</p>\n\n<p><s>Well I'm trying to use a single <code>struct</code> which would look like:</p>\n\n<pre><code>type Club struct {\n    GroupId int `json:\"group_id\"`\n    GroupName string `json:\"group_name\"`\n    Members []struct {...} `json:\"members\"\n}\n</code></pre>\n\n<p></s>This is what the structs look like:</p>\n\n<pre><code>type Committee struct {\n    GroupId     string `json:\"group_id\"`\n    GroupName   string `json:\"group_name\"`\n    Members     []struct {\n        Person     Person  `json:\"person\"`\n        Rank       float64 `json:\"rank\"`\n        Side       string  `json:\"side\"`\n        Title      string  `json:\"title\"`\n    } `json:\"members\"`\n}\n\ntype Person struct {\n    id     string `json:\"id\"`\n    name   string `json:\"name\"`\n    age    int    `json:\"age\"`\n}\n\nfunc getGroup() Club {...}\nfunc (c *Club) GetMembers() {...}\n</code></pre>\n\n<p>So I make the first call which unmarshals using <code>getGroup</code> so the struct has <code>GroupId</code> and <code>GroupName</code> just fine and <code>Members</code> is empty because the call didn't return anything for it. </p>\n\n<p>I then call <code>club.GetMembers()</code> to populate the <code>Members</code> field so that the entire struct would be populated but it doesn't seem to be extracting it into the struct because at the end <code>Members</code> is still empty and the data for <code>GroupId</code> and <code>GroupName</code> is still there.</p>\n\n<p>I know for sure that the call is returning what I'm expecting so I figure it's <code>Unmarshal</code> that isn't working so how would I go about this? Is this not within the functionality of <code>Unmarshal</code>?</p>\n\n<p><strong>EDIT</strong>\nI just pushed the exact code to github, still unsure.</p>\n\n<p>This is the repo: <a href=\"https://github.com/PeteJodo/gosun\" rel=\"nofollow\">https://github.com/PeteJodo/gosun</a></p>\n\n<p>This is a gist using the above repo: <a href=\"https://gist.github.com/PeteJodo/d5335b9f66304148483b\" rel=\"nofollow\">https://gist.github.com/PeteJodo/d5335b9f66304148483b</a></p>\n\n<p>The main files of concern:</p>\n\n<p><a href=\"https://github.com/PeteJodo/gosun/blob/master/service.go\" rel=\"nofollow\">service.go</a></p>\n\n<p><a href=\"https://github.com/PeteJodo/gosun/blob/master/congress/congress.go\" rel=\"nofollow\">congress.go</a></p>\n\n<p><a href=\"https://github.com/PeteJodo/gosun/blob/master/congress/committees.go\" rel=\"nofollow\">committees.go</a></p>\n\n<p><a href=\"https://github.com/PeteJodo/gosun/blob/master/congress/legislators.go\" rel=\"nofollow\">legislators.go</a></p>\n"}, {"tags": ["arrays", "data-structures", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "edited": false, "score": 0, "creation_date": 1436565709, "post_id": 31349953, "comment_id": 50684983, "body": "Thanks. I did tried to use s2 := s1[:1], but on Go Playground and for that i was getting an error. But i tried now on my computer and yes, this solution works just fine! Thanks again."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1436561014, "creation_date": 1436561014, "answer_id": 31349953, "question_id": 31349803, "link": "https://stackoverflow.com/questions/31349803/reproducing-an-array-of-same-type/31349953#31349953", "title": "Reproducing an array of same type", "body": "<p>You could just subslice it in place:</p>\n\n<pre><code>s2 := s1[0:1]\n</code></pre>\n\n<p>But if you really need to create a new slice, you can do it like this:</p>\n\n<pre><code>func f(s interface{}) interface{} {\n    v := reflect.ValueOf(s)\n    t := v.Type()\n    res := reflect.MakeSlice(t, 1, 1)\n    res.Index(0).Set(v.Index(0))\n    return res.Interface()\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/w1N3pgvAwr\" rel=\"nofollow\">http://play.golang.org/p/w1N3pgvAwr</a>.</p>\n"}], "owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 31349953, "answer_count": 1, "score": -1, "last_activity_date": 1436561014, "creation_date": 1436560288, "question_id": 31349803, "link": "https://stackoverflow.com/questions/31349803/reproducing-an-array-of-same-type", "title": "Reproducing an array of same type", "body": "<p>I would like to write a program that receive a array (of string, int, or whatever) and create another array of the same type contain only the first element.</p>\n\n<p>For example:</p>\n\n<p>for a array of strings <code>arr := []string(\"hello\", \"world\")</code></p>\n\n<p>my output would be <code>arr2 := []string(arr[0]);</code></p>\n\n<p>I can't use the copy function because to do that, i would have to create(make) a new slice for it. And in this case, i still have to discover which type the first array is (string, int, bool, and so on...)</p>\n\n<p>Maybe I could use the <code>reflect.TypeOf()</code> but i would still not know how to use that information to create the same type of slice or array. </p>\n\n<p>i'm not considering to use conditionals for that. \nFor example:</p>\n\n<pre><code>if reflect.TypeOf(arr) == []int {\n   arr := []int(arr[0])\n} else if reflect.TypeOf(arr) == []string\n   arr := []string(arr[0])\n} ...\n</code></pre>\n\n<p>I would be glad get a help on there.\nThanks in advance.</p>\n"}, {"tags": ["string", "replace", "go"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 2, "last_activity_date": 1436557802, "last_edit_date": 1495540903, "creation_date": 1436557802, "answer_id": 31349138, "question_id": 31348919, "link": "https://stackoverflow.com/questions/31348919/case-insensitive-string-replace-in-go/31349138#31349138", "title": "Case insensitive string replace in Go", "body": "<p>Based on the documentation it <a href=\"http://golang.org/pkg/strings/#NewReplacer\" rel=\"nofollow noreferrer\">does not</a>.</p>\n\n<p>I am not sure about the best way, but you can do this with <a href=\"https://golang.org/pkg/regexp/#Regexp.ReplaceAll\" rel=\"nofollow noreferrer\">replace in regular expressions</a> and make it case-insensitive with <code>i</code> <a href=\"https://stackoverflow.com/a/15326471/1090562\">flag</a></p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 11, "last_activity_date": 1436558355, "creation_date": 1436558355, "answer_id": 31349294, "question_id": 31348919, "link": "https://stackoverflow.com/questions/31348919/case-insensitive-string-replace-in-go/31349294#31349294", "title": "Case insensitive string replace in Go", "body": "<p>You can use regular expressions for that:</p>\n\n<pre><code>re := regexp.MustCompile(`(?i)html`)\nfmt.Println(re.ReplaceAllString(\"html HTML Html\", \"XML\"))\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/H0Gk6pbp2c\">http://play.golang.org/p/H0Gk6pbp2c</a>.</p>\n\n<p>It's worth noting that case is a thing that can be different depending on the language and locale. For example, the capital form of German letter \"\u00df\" is \"SS\". While this doesn't generally influence English texts, this is something to bear in mind when working with multi-lingual texts and programs that need to work them.</p>\n"}, {"tags": [], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "is_accepted": false, "score": 2, "last_activity_date": 1436558906, "creation_date": 1436558906, "answer_id": 31349424, "question_id": 31348919, "link": "https://stackoverflow.com/questions/31348919/case-insensitive-string-replace-in-go/31349424#31349424", "title": "Case insensitive string replace in Go", "body": "<p>A generic solution would be as follows:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"regexp\"\n)\n\ntype CaseInsensitiveReplacer struct {\n    toReplace   *regexp.Regexp\n    replaceWith string\n}\n\nfunc NewCaseInsensitiveReplacer(toReplace, replaceWith string) *CaseInsensitiveReplacer {\n    return &amp;CaseInsensitiveReplacer{\n        toReplace:   regexp.MustCompile(\"(?i)\" + toReplace),\n        replaceWith: replaceWith,\n    }\n}\n\nfunc (cir *CaseInsensitiveReplacer) Replace(str string) string {\n    return cir.toReplace.ReplaceAllString(str, cir.replaceWith)\n}\n</code></pre>\n\n<p>And then used via:</p>\n\n<pre><code>r := NewCaseInsensitiveReplacer(\"html\", \"xml\")\nfmt.Println(r.Replace(\"This is &lt;b&gt;HTML&lt;/b&gt;!\"))\n</code></pre>\n\n<p>Here's a <a href=\"https://play.golang.org/p/Rh9-n1xNeP\" rel=\"nofollow\">link</a> to an example in the playground.</p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2809, "favorite_count": 0, "accepted_answer_id": 31349294, "answer_count": 3, "score": 6, "last_activity_date": 1436558906, "creation_date": 1436556786, "question_id": 31348919, "link": "https://stackoverflow.com/questions/31348919/case-insensitive-string-replace-in-go", "title": "Case insensitive string replace in Go", "body": "<p>Can NewReplacer.Replace do case insensitive string replacement?</p>\n\n<pre><code>r := strings.NewReplacer(\"html\", \"xml\")\nfmt.Println(r.Replace(\"This is &lt;b&gt;HTML&lt;/b&gt;!\"))\n</code></pre>\n\n<p>If not, what's the best way to do case insensitive string replace in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1436544093, "post_id": 31345230, "comment_id": 50674409, "body": "It&#39;s not commented, it&#39;s a cgo&#39;s magic comment. It looks for the file where any C compiler would look for it. Make sure you&#39;ve installed libmagic correctly. See <a href=\"http://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>."}, {"owner": {"reputation": 1181, "user_id": 1162584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mdQdX.jpg?s=128&g=1", "display_name": "timbl", "link": "https://stackoverflow.com/users/1162584/timbl"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1436545284, "post_id": 31345230, "comment_id": 50675103, "body": "I have uninstalled and reinstalled libmagic, using brew, which also installed go.   The question is how to take the lid off what go is doing.  The source file it is using doesn&#39;t match the one in the src tree -- so where did it get it from?      $ find ~/go/src  -name &quot;*.go&quot; -exec grep magic.h {} \\;      // #include &lt;magic.h&gt;     // #include &lt;magic.h&gt;        &gt;-note commented out line"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1436545931, "post_id": 31345230, "comment_id": 50675489, "body": "Have you read the cgo link? It&#39;s a magic comment. The Go compiler translates that to a call to C compiler, which in turn fails because it can&#39;t find magic.h. Try creating a C file with <code>#include &lt;magic.h&gt;</code> in it and compile with a C compiler. It that doesn&#39;t fail, it gets interesting."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1436546726, "post_id": 31345230, "comment_id": 50675909, "body": "Also you might need to call <code>brew link libmagic</code> (see <a href=\"https://gist.github.com/eparreno/1845561\" rel=\"nofollow noreferrer\">gist.github.com/eparreno/1845561</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 100, "last_activity_date": 1436545847, "creation_date": 1436545847, "answer_id": 31345910, "question_id": 31345230, "link": "https://stackoverflow.com/questions/31345230/how-can-i-see-the-internal-compile-commands-which-fail-in-a-go-get-installatio/31345910#31345910", "title": "How can I see the internal compile commands which fail in a &quot;go get&quot; installation?", "body": "<p>Run go build -x on problem package:</p>\n\n<pre><code>go build -x github.com/presbrey/magicmime\n</code></pre>\n"}], "owner": {"reputation": 1181, "user_id": 1162584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mdQdX.jpg?s=128&g=1", "display_name": "timbl", "link": "https://stackoverflow.com/users/1162584/timbl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5338, "favorite_count": 17, "answer_count": 1, "score": 126, "last_activity_date": 1437061168, "creation_date": 1436543764, "last_edit_date": 1437061168, "question_id": 31345230, "link": "https://stackoverflow.com/questions/31345230/how-can-i-see-the-internal-compile-commands-which-fail-in-a-go-get-installatio", "title": "How can I see the internal compile commands which fail in a &quot;go get&quot; installation?", "body": "<p>I am pulling and installing a package with dependencies, and a compilation fails, in this case not finding a file, <code>magic.h</code>.   How do I see what the compilation commands and flags were? The <code>-v</code> option does not help. (I do NOT want ideas about where to get magic.h from, this is just an example.)</p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>$ go get -u github.com/presbrey/magicmime\n# github.com/presbrey/magicmime\n../../../src/github.com/presbrey/magicmime/magicmime.go:20:11: fatal error:   'magic.h' file not found\n#include &lt;magic.h&gt;\n</code></pre>\n\n<p>How can I find, for example, where it was looking for include files, what source <em>exactly</em> it was compiling? (In this case the source file I see in <code>$GO_PATH/src</code> has that <code>#include</code> commented out, and a <code>/usr/local/include/match.h</code> exists anyway.)</p>\n"}, {"tags": ["ubuntu", "go", "ubuntu-14.04", "apt-get"], "answers": [{"tags": [], "owner": {"reputation": 5661, "user_id": 3179857, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=128&d=identicon&r=PG", "display_name": "Evan", "link": "https://stackoverflow.com/users/3179857/evan"}, "is_accepted": false, "score": 0, "last_activity_date": 1436544057, "creation_date": 1436544057, "answer_id": 31345339, "question_id": 31345037, "link": "https://stackoverflow.com/questions/31345037/need-to-upgrade-go-1-2-1-to-1-3-on-ubuntu-14-04-trusty64/31345339#31345339", "title": "Need to upgrade Go 1.2.1 to 1.3+ on Ubuntu 14.04 (trusty64)", "body": "<p>The typical approach I believe is to use the <code>godeb</code> tool: <a href=\"https://github.com/niemeyer/godeb\" rel=\"nofollow\">https://github.com/niemeyer/godeb</a></p>\n"}, {"tags": [], "owner": {"reputation": 1773, "user_id": 211180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/925027f0f36c5abf1e8cd65fe0fb1f1d?s=128&d=identicon&r=PG", "display_name": "Arash Payan", "link": "https://stackoverflow.com/users/211180/arash-payan"}, "is_accepted": false, "score": 0, "last_activity_date": 1436644513, "creation_date": 1436644513, "answer_id": 31361223, "question_id": 31345037, "link": "https://stackoverflow.com/questions/31345037/need-to-upgrade-go-1-2-1-to-1-3-on-ubuntu-14-04-trusty64/31361223#31361223", "title": "Need to upgrade Go 1.2.1 to 1.3+ on Ubuntu 14.04 (trusty64)", "body": "<p>I recommend uninstalling the version of Go that comes with Ubuntu (1.2.1, as you mentioned). Instead, follow the instructions on the <a href=\"http://golang.org/doc/install\" rel=\"nofollow\">Go install page</a>.</p>\n\n<p>Summary:</p>\n\n<ol>\n<li>Download the latest tarball for your OS. In this case, you'll want the 64-bit linux package. Currently <code>go1.4.2.linux-amd64.tar.gz</code>.</li>\n<li>Open up a terminal to the directory you downloaded the tarball and type<br/><code>sudo tar -C /usr/local -xzf go1.4.2.linux-amd64.tar.gz</code></li>\n<li>The package is now installed on your system, but you still need to export the binaries to your <code>$PATH</code>. So we'll <a href=\"https://help.ubuntu.com/community/EnvironmentVariables#A.2Fetc.2Fprofile.d.2F.2A.sh\" rel=\"nofollow\">modify your environment using the Ubuntu way</a>:<br/>\n<code>sudo echo \"export PATH=\\$PATH:/usr/local/go/bin\" &gt; /etc/profile.d/golang_bin.sh</code></li>\n<li>Close the terminal window, and open up a new one (so the new profile file we created gets read) then check that your installation succeeded by typing:<br/>\n<code>go version</code></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3755, "user_id": 1940850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zqElV.png?s=128&g=1", "display_name": "karel", "link": "https://stackoverflow.com/users/1940850/karel"}, "is_accepted": false, "score": 0, "last_activity_date": 1576816639, "last_edit_date": 1576816639, "creation_date": 1541855648, "answer_id": 53239298, "question_id": 31345037, "link": "https://stackoverflow.com/questions/31345037/need-to-upgrade-go-1-2-1-to-1-3-on-ubuntu-14-04-trusty64/53239298#53239298", "title": "Need to upgrade Go 1.2.1 to 1.3+ on Ubuntu 14.04 (trusty64)", "body": "<p>To install the latest version of Go programming language in all currently supported versions of Ubuntu open the terminal and type:</p>\n\n<pre><code>sudo snap install go --classic --channel stable \n</code></pre>\n\n<p>This snap provides an assembler, compiler, linker, and compiled libraries for the Go programming language. There are other channels besides stable, but the stable channel is the latest version of Go programming language. The go snap package will be updated automatically when updates are available.</p>\n"}], "owner": {"reputation": 119, "user_id": 1759781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30a15eebdac5b15f949bc2d93c7d17b?s=128&d=identicon&r=PG", "display_name": "hackg", "link": "https://stackoverflow.com/users/1759781/hackg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1373, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1576816639, "creation_date": 1436543168, "question_id": 31345037, "link": "https://stackoverflow.com/questions/31345037/need-to-upgrade-go-1-2-1-to-1-3-on-ubuntu-14-04-trusty64", "title": "Need to upgrade Go 1.2.1 to 1.3+ on Ubuntu 14.04 (trusty64)", "body": "<p>ENVIRONMENT<br>\nvagrant / virtualbox / ubuntu-trusty64</p>\n\n<p>my Go version is 1.2.1\ninstalled via apt-get install golang</p>\n\n<p>I need and should have installed a more recent (1.3+) version (repo outdated)</p>\n\n<p>Is it best to:<br>\nA - apt-get uninstall, re-install using more updated repo<br>\nB - try to upgrade existing Go to 1.3 or higher<br>\nC - ?</p>\n"}, {"tags": ["sockets", "http", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "edited": false, "score": 0, "creation_date": 1436541934, "post_id": 31344587, "comment_id": 50673034, "body": "I am running this under ubuntu 14.04 and go1.5beta1"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436543659, "post_id": 31344587, "comment_id": 50674132, "body": "@BravadaZadada The request is to the same host. And inside a function. Thanks"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436547340, "post_id": 31344587, "comment_id": 50676222, "body": "No, just this one request. Thanks"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "edited": false, "score": 0, "creation_date": 1436543296, "post_id": 31344938, "comment_id": 50673889, "body": "Thank! I am calling this one call inside one function. What would be the best way? Should pass around the client pointer around other calls as well? I was trying to reinitiate the api call and destroy it in one function call."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1436543562, "post_id": 31344938, "comment_id": 50674060, "body": "Updated with example. You shouldn&#39;t need anything special here."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 8, "last_activity_date": 1436543491, "last_edit_date": 1436543491, "creation_date": 1436542913, "answer_id": 31344938, "question_id": 31344587, "link": "https://stackoverflow.com/questions/31344587/go-socket-too-many-open-files/31344938#31344938", "title": "Go socket : too many open files", "body": "<p>Why are you deferring the close? Are you actually reading from this body?</p>\n\n<pre><code>defer resp.Body.Close()\n</code></pre>\n\n<p>Do you actually return from the current function before performing another <code>Get</code>? If not, then the <code>defer</code> will never execute, and you'll never release this connection for reuse.</p>\n\n<p><code>req.Close = true</code> is an unusual choice here, as well. This also prevents connection reuse, which is something you'd probably want rather than forbid. This doesn't automatically close the request on your side. It forces the <em>server</em> to immediately close the connection, which you would otherwise reuse. You'll hold your side open until you close it.</p>\n\n<p>Typically for a simple GET request like you have here, I would just do this:</p>\n\n<pre><code>resp, err := http.Get(\"...\")\nif err != nil {\n    panic(err) // panic seems harsh, usually you'd just return the error. But either way...\n}\nresp.Body.Close()\n</code></pre>\n\n<p>There's no need for a special client here. Just use the default one. It'll take care of the rest as long as you make sure to close the response body. And there's no need to complicate things with a <code>defer</code> if you're going to immediately close the body. The reason for <code>defer</code> is to make sure you close the body if you have a bunch of processing later that might return or panic on error.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8023, "favorite_count": 0, "accepted_answer_id": 31344938, "answer_count": 1, "score": 1, "last_activity_date": 1436553343, "creation_date": 1436541917, "last_edit_date": 1436553343, "question_id": 31344587, "link": "https://stackoverflow.com/questions/31344587/go-socket-too-many-open-files", "title": "Go socket : too many open files", "body": "<p>When I send requests from the following code:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"my_target:\", nil)\nif err != nil {\n    panic(err)\n}\nreq.Close = true\nclient := http.DefaultClient\nresp, err := client.Do(req)\nif err != nil {\n    panic(err)\n}\ndefer resp.Body.Close()\n</code></pre>\n\n<p>After a few hours of sending average 10 requests per minutes, I get this error:</p>\n\n<pre><code>socket: too many open files\n</code></pre>\n\n<p>How do I find the cause of this problem?</p>\n\n<p>Am I not closing the http.Request?</p>\n\n<p>I thought <code>req.Close = true</code> does that job.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "neo4j", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1436539195, "post_id": 31341156, "comment_id": 50671119, "body": "Thanks for your help, that works perfectly for a single template, but if I attatch two template nodes to the page (I dont need to do this but will on other queries), both templates are pulled in by the query but any ideas how I would populate an array of []Template structs with my templates. including []Template in the page struct doesnt work... any ideas?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1436543805, "post_id": 31341156, "comment_id": 50674242, "body": "Sorry, I&#39;ve never worked with neo4j. You&#39;ll have to either look up the docs to see if it can generate JSON arrays (like <code>[{&quot;t.name&quot;:&quot;1&quot;},{&quot;t.name&quot;:&quot;2&quot;}]</code>) to unmarshal them into <code>[]Template</code>, or ask a new question about it."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1436545337, "post_id": 31341156, "comment_id": 50675138, "body": "OK, thanks for your help with the JSON marshalling, I shall continue to investigate next week"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1436532381, "creation_date": 1436532381, "answer_id": 31341156, "question_id": 31339950, "link": "https://stackoverflow.com/questions/31339950/unmarshalling-neo4j-results-to-a-nested-struct-in-golang/31341156#31341156", "title": "Unmarshalling neo4j results to a nested struct in Golang", "body": "<p>Use <a href=\"http://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow\">embedding</a>.</p>\n\n<pre><code>type Page struct {\n    Name string `json:\"p.name\"`\n    // ...\n    Template\n}\n\ntype Template struct {\n    Name string `json:\"t.name\"`\n    // ...\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/B3ro3wgsGS\" rel=\"nofollow\">http://play.golang.org/p/B3ro3wgsGS</a>.</p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 0, "accepted_answer_id": 31341156, "answer_count": 1, "score": 2, "last_activity_date": 1436532381, "creation_date": 1436528726, "question_id": 31339950, "link": "https://stackoverflow.com/questions/31339950/unmarshalling-neo4j-results-to-a-nested-struct-in-golang", "title": "Unmarshalling neo4j results to a nested struct in Golang", "body": "<p>I'm using the neoism library (<a href=\"https://github.com/jmcvetta/neois\" rel=\"nofollow\">https://github.com/jmcvetta/neois</a>) to talk to a local neo4j database - I'm fairly new to go and am new to neo4j so the gap in my understanding could be on either side of the problem.</p>\n\n<p>I have a simple database, a single \"page\" node which is related to a single \"template\" node. I was hoping to be able to have struct representing each node and nest them inside one another but I'm strugging to get this to work.</p>\n\n<p>Creating the simple DB:</p>\n\n<pre><code>template, err := ioutil.ReadFile(viewPath + \"templates/default.mustache\")\n\nif err != nil{\n    panic(err)\n}\n\ndefaultTemplate, _ := db.CreateNode(neoism.Props{\n    \"name\": \"default\",\n    \"content\": string(template),\n})\n\ndefaultTemplate.AddLabel(\"Template\")\n\nn0, _ := db.CreateNode(neoism.Props{\n    \"name\": \"Home\",\n    \"slug\": \"home\",\n    \"title\": \"Home Page\",\n    \"content\" : \"here I am\",\n})\n\nn0.AddLabel(\"Page\")\nn0.Relate(\"TEMPLATE\", template.Id(), neoism.Props{}) \n</code></pre>\n\n<p>Now to the business of trying to get the data back out...</p>\n\n<p>Here is my query which works just fine:</p>\n\n<pre><code>type PageStruct struct{\n    Name string `json:\"p.name\"`\n    Slug string `json:\"p.slug\"`\n    Title string `json:\"p.title\"`\n    Content string `json:\"p.content\"`\n    TemplateName string `json:\"t.name\"`\n    TemplateContent string `json:\"t.content\"`\n\n}    \n\nres := []PageStruct{}\n\n    cq := neoism.CypherQuery{\n        Statement: `\n            MATCH (p:Page)-[r:TEMPLATE]-&gt;(t:Template)\n            WHERE p.slug = {slug}\n            RETURN p.name, p.slug, p.title, p.content, t.name, t.content\n        `,\n        Parameters: neoism.Props{\"slug\": pageSlug},\n        Result:     &amp;res,\n    }\n\n    db.Cypher(&amp;cq)\n    page := res[0]\n</code></pre>\n\n<p>But ideally what I want is to unmarshall into a nested struct, something like this:</p>\n\n<pre><code>    type PageStruct struct{\n        Name string `json:\"p.name\"`\n        Slug string `json:\"p.slug\"`\n        Title string `json:\"p.title\"`\n        Content string `json:\"p.content\"`\n        Template struct {\n            Name string `json:\"t.name\"`\n            Content string `json:\"t.content\"`\n                 } `json:\"t\"`\n\n}\n</code></pre>\n\n<p>I've been trying various things with no success, could anyone give me any advice on how to achieve this abitious feat of computer engineering... </p>\n\n<p>Additionally I'm slightly unclear as to how to handle relationships in neo4j in the sense of having no enforcement (that I'm aware of) as to the type of relationship (e.g one-to-one, one-to-many) so how to handle this - do we always just assume an array of data?</p>\n\n<p>Any help/advice is greatly appreciated.</p>\n"}, {"tags": ["json", "dictionary", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1436533707, "post_id": 31339249, "comment_id": 50667213, "body": "As an aside, it&#39;s simpler to use <code>err := json.Unmarshal([]byte(input), output); if err != nil { return err }</code>."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 15, "last_activity_date": 1436528198, "creation_date": 1436528198, "answer_id": 31339799, "question_id": 31339249, "link": "https://stackoverflow.com/questions/31339249/check-if-a-map-is-initialised-in-golang/31339799#31339799", "title": "Check if a map is initialised in Golang", "body": "<p>The <a href=\"http://golang.org/ref/spec#The_zero_value\">zero value</a> of any map is <code>nil</code>, so just check against it:</p>\n\n<pre><code>if output.Servers == nil { /* ... */ }\n</code></pre>\n\n<p>Alternatively, you can also check its length. This also handles the case of empty map:</p>\n\n<pre><code>if len(output.Servers) == 0 { /* ... */ }\n</code></pre>\n"}], "owner": {"reputation": 651, "user_id": 216695, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/79d7ee2589743eef43349a74a58bd291?s=128&d=identicon&r=PG", "display_name": "shearn89", "link": "https://stackoverflow.com/users/216695/shearn89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5807, "favorite_count": 2, "accepted_answer_id": 31339799, "answer_count": 1, "score": 6, "last_activity_date": 1436528198, "creation_date": 1436526478, "question_id": 31339249, "link": "https://stackoverflow.com/questions/31339249/check-if-a-map-is-initialised-in-golang", "title": "Check if a map is initialised in Golang", "body": "<p>I'm decoding some JSON into a struct, and I'd like to handle the case where a particular field is not provided.</p>\n\n<p>Struct:</p>\n\n<pre><code>type Config struct {\n    SolrHost string\n    SolrPort int\n    SolrCore string\n    Servers  map[string][]int\n}\n</code></pre>\n\n<p>JSON to decode:</p>\n\n<pre><code>{\n  \"solrHost\": \"localhost\",\n  \"solrPort\": 8380,\n  \"solrCore\": \"testcore\",\n}\n</code></pre>\n\n<p>In the method that decodes the JSON, I'd like to check if the <code>map[string][]int</code> has been initialised, and if not, do so.</p>\n\n<p>Current code:</p>\n\n<pre><code>func decodeJson(input string, output *Config) error {\n    if len(input) == 0 {\n        return fmt.Errorf(\"empty string\")\n    }\n    decoder := json.NewDecoder(strings.NewReader(input))\n    err := decoder.Decode(output)\n    if err != nil {\n        if err != io.EOF {\n            return err\n        }\n    }\n\n    // if output.Server.isNotInitialized...\n\n    return nil\n}\n</code></pre>\n\n<p>Could I make use of <code>recover()</code>? Is that the \"nicest\" way to achieve my task?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 4, "creation_date": 1436531421, "post_id": 31338752, "comment_id": 50665589, "body": "Alternatively, you can use <code>unsafe.Sizeof(myType{})</code>."}, {"owner": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1436588061, "post_id": 31338752, "comment_id": 50689147, "body": "@thwd You are right but my getSize function have to find size of any structure, it has to find the type of structure during run time. Because of that I chose reflect package"}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": true, "score": 11, "last_activity_date": 1436524833, "creation_date": 1436524833, "answer_id": 31338752, "question_id": 31338588, "link": "https://stackoverflow.com/questions/31338588/generic-function-to-get-size-of-any-structure-in-golang/31338752#31338752", "title": "generic function to get size of any structure in golang", "body": "<p>You're getting the size of the <code>reflect.Value</code> struct, not of the object contained in the interface <code>T</code>. Fortunately, <code>reflect.Type</code> has a <code>Size()</code> method:</p>\n\n<pre><code>size := reflect.TypeOf(T).Size()\n</code></pre>\n\n<p>This gives me 40, which makes sense because of padding.</p>\n"}], "owner": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4653, "favorite_count": 2, "accepted_answer_id": 31338752, "answer_count": 1, "score": 8, "last_activity_date": 1436524957, "creation_date": 1436524360, "question_id": 31338588, "link": "https://stackoverflow.com/questions/31338588/generic-function-to-get-size-of-any-structure-in-golang", "title": "generic function to get size of any structure in golang", "body": "<p>I am writing a generic function which get any type of structure and return size of that structure, similar to <strong><em>sizeof</em></strong> function in C language.</p>\n\n<p>I am trying to do this using interface and reflection but i not able to get the correct result. Code is below</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc main() {\n    type myType struct {\n        a int\n        b int64\n        c float32\n        d float64\n        e float64\n    }\n    info := myType{1, 2, 3.0, 4.0, 5.0}\n    getSize(info)\n}\n\nfunc getSize(T interface{}) {\n    v := reflect.ValueOf(T)\n    const size = unsafe.Sizeof(v)\n    fmt.Println(size)\n}\n</code></pre>\n\n<p>This code return wrong result as 12. I am very new to golang, kindly help me on this.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 19, "last_activity_date": 1436523956, "creation_date": 1436523956, "answer_id": 31338443, "question_id": 31337891, "link": "https://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0/31338443#31338443", "title": "net/http: http: ContentLength=222 with Body length 0", "body": "<p>The problem is that the request body is read to the end on the first call to Do(). On subsequent calls to Do(), no data is read from the response body.</p>\n\n<p>The fix is to move the creation of the body reader inside the for loop. This requires that the request also be created inside the for loop.</p>\n\n<pre><code>func Post(URL string, form url.Values, cl *http.Client) ([]byte, error) {\n  body := form.Encode()\n  for i := 0; i &lt; 10; i++ {\n    req, err := http.NewRequest(\"POST\", URL, strings.NewReader(body))\n    if err != nil {\n        log.Error(err)\n        return nil, err\n    }\n    req.Header.Set(\"User-Agent\", ua)\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    rsp, err := cl.Do(req)\n    if err == nil {\n        defer rsp.Body.Close()\n        b, err := ioutil.ReadAll(rsp.Body)\n        if err != nil {\n            log.Error(err)\n            return nil, err\n        }\n        return b, nil\n    }\n\n    if !IsErrorProxy(err) {\n        return nil, err\n    }\n\n    log.Errorf(\"Proxy is slow or down \")\n    time.Sleep(6 * time.Second)\n  }\n  return nil, fmt.Errorf(\"after 10 tries error: %v\", err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 4670191, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Hpl-KY0T9mg/AAAAAAAAAAI/AAAAAAAACXE/1ZiPnqlgATI/photo.jpg?sz=128", "display_name": "Rambo", "link": "https://stackoverflow.com/users/4670191/rambo"}, "is_accepted": false, "score": 2, "last_activity_date": 1510915713, "creation_date": 1510915713, "answer_id": 47348886, "question_id": 31337891, "link": "https://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0/47348886#47348886", "title": "net/http: http: ContentLength=222 with Body length 0", "body": "<p>Let's see what does <code>http.NewRequest</code> do</p>\n\n<pre><code>rc, ok := body.(io.ReadCloser)\nif !ok &amp;&amp; body != nil {\n    rc = ioutil.NopCloser(body)\n}\n// The host's colon:port should be normalized. See Issue 14836.\nu.Host = removeEmptyPort(u.Host)\nreq := &amp;Request{\n    Method:     method,\n    URL:        u,\n    Proto:      \"HTTP/1.1\",\n    ProtoMajor: 1,\n    ProtoMinor: 1,\n    Header:     make(Header),\n    Body:       rc,\n    Host:       u.Host,\n}\n</code></pre>\n\n<p><code>body</code> is type of <code>io.Reader</code>, and convert to <code>io.ReaderCloser</code> by <code>ioutil.NopCloser</code>. As @Cerise Lim\u00f3n said, the Request.Body had been read and the stream is closer, so when you <code>Do()</code> again, the <code>Body Length</code> is 0.</p>\n\n<p>So, we could reset the Request.Body before invoke <code>Do</code>.</p>\n\n<pre><code>func Post(URL string, form url.Values, cl *http.Client) ([]byte, error) {\n    requestBodyString := form.Encode()\n    req, err := http.NewRequest(\"POST\", URL, strings.NewReader(requestBodyString))\n    // ...\n\n    rsp, err := do(cl, req, requestBodyString)\n\n    //...\n    return b, nil\n}\n\nfunc do(cl *http.Client, req *http.Request, requestBodyString string)(*http.Response, error){\n    rsp, err := cl.Do(req)\n    for i := 0; IsErrProxy(err); i++ {\n        log.Errorf(\"Proxy is slow or down \")\n        time.Sleep(6 * time.Second)\n        // reset Request.Body\n        req.Body = ioutil.NopCloser(strings.NewReader(requestBodyString))\n        rsp, err = cl.Do(&amp;req)\n        if err == nil{\n            return rsp, nil\n        }\n        if i &gt; 10 {\n\n            return nil, fmt.Errorf(\"after %v tries error: %v\", i, err)\n        }\n    }\n    return rsp, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 651, "user_id": 1915230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250443e45304d0d52e56f00e0c9eaf0f?s=128&d=identicon&r=PG", "display_name": "toudi", "link": "https://stackoverflow.com/users/1915230/toudi"}, "is_accepted": false, "score": 0, "last_activity_date": 1561629085, "creation_date": 1561629085, "answer_id": 56788441, "question_id": 31337891, "link": "https://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0/56788441#56788441", "title": "net/http: http: ContentLength=222 with Body length 0", "body": "<p>I found a way to do this without re-creating the request every time. here's a sample code, which is a very slight modification of @Cerise Lim\u00f3n and is similar to @Rambo's code in that it creates the request only once:</p>\n\n<pre><code>func Post(URL string, data *bytes.Buffer, cl *http.Client) ([]byte, error) {\n    var err error\n\n    req, err := http.NewRequest(\"POST\", URL, ioutil.NopCloser(data))\n    if err != nil {\n        log.Errorf(\"Unable to create the request: %v\", err)\n        return nil, err\n    }\n    req.Header.Set(\"User-Agent\", ua)\n\n    for i := 0; i &lt; 10; i++ {\n        rsp, err := cl.Do(req)\n        if err == nil &amp;&amp; rsp.StatusCode == 200 {\n            defer rsp.Body.Close()\n            b, err := ioutil.ReadAll(rsp.Body)\n            if err != nil {\n                fmt.Printf(\"Error: %v\", err)\n                return nil, err\n            }\n            return b, nil\n        }\n\n        log.Errorf(\"Proxy is slow or down %v\", err)\n        time.Sleep(1 * time.Second)\n    }\n    return nil, fmt.Errorf(\"after 10 tries error: %v\", err)\n}\n\nfunc main() {\n    client := http.Client{}\n    data := []byte{0, 1, 2, 3, 4}\n    Post(\"http://server/my/api/resource/\", bytes.NewBuffer(data), &amp;client)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11890, "favorite_count": 5, "accepted_answer_id": 31338443, "answer_count": 3, "score": 15, "last_activity_date": 1561629085, "creation_date": 1436522227, "question_id": 31337891, "link": "https://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0", "title": "net/http: http: ContentLength=222 with Body length 0", "body": "<p>I'm trying to retry a request if there is a connection/proxy error. For some reasons I keep getting this error which doesn't seem to recover regardless the attepts to retry the request:</p>\n\n<pre><code>    Post https://m.somewebsite.co.uk/api/di/34433: http: ContentLength=222  with Body length 0\n</code></pre>\n\n<p>Am I doing something wrong? My first suspicion is that the http.Request is consumed somehow so on the next attempts it's no longer good. Should I manage a copy?</p>\n\n<pre><code>func Post(URL string, form url.Values, cl *http.Client) ([]byte, error) {\n    req, err := http.NewRequest(\"POST\", URL, strings.NewReader(form.Encode()))\n    if err != nil {\n        log.Error(err)\n        return nil, err\n    }\n    req.Header.Set(\"User-Agent\", ua)\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    rsp, err := do(cl, req)\n\n    if err != nil {\n        return nil, err\n    }\n    defer rsp.Body.Close()\n    b, err := ioutil.ReadAll(rsp.Body)\n    if err != nil {\n        log.Error(err)\n        return nil, err\n    }\n\n    return b, nil\n}\n\nfunc do(cl *http.Client, req *http.Request)(*http.Response, error){\n    rsp, err := cl.Do(req)\n    for i := 0; IsErrProxy(err); i++ {\n        log.Errorf(\"Proxy is slow or down \")\n        time.Sleep(6 * time.Second)\n5t      rsp, err = cl.Do(&amp;ncp)\n        if err == nil{\n            return rsp, nil\n        }\n        if i &gt; 10 {\n\n            return nil, fmt.Errorf(\"after %v tries error: %v\", i, err)\n        }\n    }\n    return rsp, err\n}\n</code></pre>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 2596, "user_id": 438039, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/16dc9a9ba1826f5e89204a7df84cfde0?s=128&d=identicon&r=PG", "display_name": "kagali-san", "link": "https://stackoverflow.com/users/438039/kagali-san"}, "edited": false, "score": 1, "creation_date": 1436517665, "post_id": 31335579, "comment_id": 50656855, "body": "probably unrelated (it must be some Go thing building a wrong format of executable): there&#39;s a fair amount of errors coming from linux and hard to recognize: for example, if executable format is ELF, but it doesn&#39;t specifies the ld.so (ld-linux.so) entrypoint properly, error would be &quot;File not found&quot;. Anyway, run ldd on your binary to see if it&#39;s ok.."}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "reply_to_user": {"reputation": 2596, "user_id": 438039, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/16dc9a9ba1826f5e89204a7df84cfde0?s=128&d=identicon&r=PG", "display_name": "kagali-san", "link": "https://stackoverflow.com/users/438039/kagali-san"}, "edited": false, "score": 0, "creation_date": 1436518568, "post_id": 31335579, "comment_id": 50657387, "body": "Output from ldd: linux-vdso.so.1 =&gt;  (0x00007ffd50dbb000)         libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f6a5dc87000)         libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f6a5d8c6000)         /lib64/ld-linux-x86-64.so.2 (0x00007f6a5dea9000)"}, {"owner": {"reputation": 2924, "user_id": 2066459, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d8408d7e5ef47a2e2af09f3c6da6e1a6?s=128&d=identicon&r=PG", "display_name": "Robert Jacobs", "link": "https://stackoverflow.com/users/2066459/robert-jacobs"}, "edited": false, "score": 1, "creation_date": 1436542814, "post_id": 31335579, "comment_id": 50673559, "body": "Try running strace on the bad executable. It will show all the system calls run by your program. All the libraries will read and shown in the system calls. Read the output to find out what failed."}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1436540834, "post_id": 31337383, "comment_id": 50672320, "body": "I&#39;ve applied the steps that you outline, but the issue remains. Strangely, if I copy the binary generated from &quot;go build&quot; into the $GOPATH/bin folder, and attempt to execute it, I get the &quot;Invalid argument&quot; error. Yet it runs without issue when executed from the $GOPATH/src/myapp folder, after building."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1436541994, "post_id": 31337383, "comment_id": 50673078, "body": "You can just run <code>go install -a</code> (once) to force it to rebuild dependant packages if you suspect it&#39;s an out-of-date compiled package. Alternatively, you can delete everything in your <code>$GOPATH&#47;pkg</code> directory and then <code>go install</code> will build fresh copies of each package the first time it&#39;s needed."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 1, "creation_date": 1436542618, "post_id": 31337383, "comment_id": 50673449, "body": "@PaulMooney, care to tun it under <code>strace</code> then (from the location where it fails)? Alternatively, try running it while having <code>LD_VERBOSE=1</code> in the environment to make the dynamic loader print what it does to bring up your program (see the <code>ld.so(8)</code> manual page)."}, {"owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "edited": false, "score": 0, "creation_date": 1436775001, "post_id": 31337383, "comment_id": 50734987, "body": "Rebuilding the dependencies one-by-one revealed an error in one of the dependent packages. The dependent package also relied on a configuration file. Copying the file to $GOPATH/bin solved the &quot;Invalid argument&quot; problem."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1436541870, "last_edit_date": 1436541870, "creation_date": 1436520836, "answer_id": 31337383, "question_id": 31335579, "link": "https://stackoverflow.com/questions/31335579/invalid-argument-running-google-go-binary-in-linux/31337383#31337383", "title": "Invalid Argument Running Google Go Binary in Linux", "body": "<p><code>go build</code> builds <em>everything</em> (that is, all dependent packages), then produces the resulting executable files and then discards the intermediate results (see <a href=\"http://dave.cheney.net/2014/06/04/what-does-go-build-build\" rel=\"nofollow\">this</a> for an alternative take; also consider carefully reading outputs of <code>go help build</code> and <code>go help install</code>).</p>\n\n<p><code>go install</code>, on the contrary, uses precompiled versions of the dependent packages, if it finds them; otherwise it builds them as well, and installs under <code>$PATH/pkg</code>. Hence I might suggest that <code>go install</code> sees some outdated packages which screw the resulting build.</p>\n\n<p>Consider running <code>go install ./...</code> in your <code>$GOPATH/src</code>.\nOr may be just selective <code>go install uri/of/the/package</code> for each dependent package, and then retry building the executable.</p>\n"}], "owner": {"reputation": 1479, "user_id": 476648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5330a9884cc276cb8db323c890289107?s=128&d=identicon&r=PG", "display_name": "Paul Mooney", "link": "https://stackoverflow.com/users/476648/paul-mooney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 0, "accepted_answer_id": 31337383, "answer_count": 1, "score": 1, "last_activity_date": 1436541870, "creation_date": 1436515529, "last_edit_date": 1436516578, "question_id": 31335579, "link": "https://stackoverflow.com/questions/31335579/invalid-argument-running-google-go-binary-in-linux", "title": "Invalid Argument Running Google Go Binary in Linux", "body": "<p>I\u2019ve written a very small application in Go, and configured an AWS Linux AMI to host. The application is a very simple web server. I\u2019ve installed Go on the Linux VM by following the instructions in the official documentation to the letter. My application runs as expected when invoked with the \u201c<code>go run main.go</code>\u201d command.</p>\n\n<p>However, I receive an \u201cInvalid argument\u201d error when I attempt to manually launch the binary file generated as a result of running \u201c<code>go install</code>\u201d. Instead, if I run \u201c<code>go build</code>\u201d (which I understand to be essentially the same thing, with a few exceptions) and then invoke the resulting binary, the application launches as expected.</p>\n\n<p>I\u2019m invoking the file from within the <code>$GOPATH/bin/</code> folder as follows:</p>\n\n<pre><code>./myapp\n</code></pre>\n\n<p>I\u2019ve also added <code>$GOPATH/bin</code> to the <code>$PATH</code> variable.\nI have also moved the binary from <code>$GOPATH/bin/</code> to the <code>src</code> folder, and successfully run it from there.</p>\n\n<p>The Linux instance is a 64-bit instance, and I have installed the corresponding Go 64-bit installation.</p>\n"}, {"tags": ["go", "rethinkdb"], "answers": [{"comments": [{"owner": {"reputation": 2922, "user_id": 132347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/317976b83cf7b2cf3a23c233ef65661b?s=128&d=identicon&r=PG", "display_name": "Sumit M Asok", "link": "https://stackoverflow.com/users/132347/sumit-m-asok"}, "edited": false, "score": 0, "creation_date": 1436516532, "post_id": 31335649, "comment_id": 50656235, "body": "The filter around Between was the error. How ever I have not yet been able to get the result. But no more errors in Query. Thanks"}, {"owner": {"reputation": 2922, "user_id": 132347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/317976b83cf7b2cf3a23c233ef65661b?s=128&d=identicon&r=PG", "display_name": "Sumit M Asok", "link": "https://stackoverflow.com/users/132347/sumit-m-asok"}, "edited": false, "score": 0, "creation_date": 1436516572, "post_id": 31335649, "comment_id": 50656268, "body": "Also the &#39;Z&#39; should  have been &quot;Z&quot;"}, {"owner": {"reputation": 2922, "user_id": 132347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/317976b83cf7b2cf3a23c233ef65661b?s=128&d=identicon&r=PG", "display_name": "Sumit M Asok", "link": "https://stackoverflow.com/users/132347/sumit-m-asok"}, "edited": false, "score": 0, "creation_date": 1436764171, "post_id": 31335649, "comment_id": 50730235, "body": "Thanks for the help Ferhat, however Dancannon responded saying, We should be using During instead of Between."}], "tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": false, "score": 1, "last_activity_date": 1436515836, "creation_date": 1436515836, "answer_id": 31335649, "question_id": 31335258, "link": "https://stackoverflow.com/questions/31335258/create-between-query-using-gorethink/31335649#31335649", "title": "Create Between Query using gorethink", "body": "<pre><code>t := r.Table(\"yourTable\")\nt.Between(from, to,\n    r.BetweenOpts{Index: \"updated_at\"}\n).OrderBy(r.OrderByOpts{Index: r.Desc(\"updated_at\")}).Run(dbs)\n</code></pre>\n\n<p>Here, <code>from</code> and <code>to</code> depends how you save these values i.e int64, string, time, etc. According to previous example <code>r.Time(args)</code> should work.</p>\n\n<p>If nonexist, create index via:</p>\n\n<pre><code>t.IndexCreate(\"updated_at\").Exec(dbs)\nt.IndexWait().RunWrite(dbs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2922, "user_id": 132347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/317976b83cf7b2cf3a23c233ef65661b?s=128&d=identicon&r=PG", "display_name": "Sumit M Asok", "link": "https://stackoverflow.com/users/132347/sumit-m-asok"}, "is_accepted": true, "score": 0, "last_activity_date": 1436764089, "creation_date": 1436764089, "answer_id": 31375725, "question_id": 31335258, "link": "https://stackoverflow.com/questions/31335258/create-between-query-using-gorethink/31375725#31375725", "title": "Create Between Query using gorethink", "body": "<p>As per dancannon's response on gitter channel <a href=\"https://gitter.im/dancannon/gorethink\" rel=\"nofollow\">https://gitter.im/dancannon/gorethink</a></p>\n\n<p>We should use During instead of Between for Dates.</p>\n\n<p><code>\nFilter(func(row r.Term) r.Term {\n    return row.Field(\"updated_at\").During(r.Time(2014, 8, 12, 'Z'), r.Time(2014, 8, 12, 'Z'))\n}).Run(session)\n</code></p>\n"}], "owner": {"reputation": 2922, "user_id": 132347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/317976b83cf7b2cf3a23c233ef65661b?s=128&d=identicon&r=PG", "display_name": "Sumit M Asok", "link": "https://stackoverflow.com/users/132347/sumit-m-asok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "accepted_answer_id": 31375725, "answer_count": 2, "score": 0, "last_activity_date": 1436764089, "creation_date": 1436514467, "question_id": 31335258, "link": "https://stackoverflow.com/questions/31335258/create-between-query-using-gorethink", "title": "Create Between Query using gorethink", "body": "<p>How to convert this rethinkdb query into gorethink query</p>\n\n<p><code>\nr.db(\"arkinventory\").table(\"reportsdata\").between(new Date(\"2012-08-13T23:32:49.923Z\"), new Date(\"2013-08-13T23:32:49.923Z\"), {index: \"updated_at\"})\n</code></p>\n\n<p>I tried</p>\n\n<p><code>\n.Filter(func(row r.Term) r.Term {\n        return row.Between(r.Time(2014, 8, 12, 'Z'), r.Time(2014, 8, 12, 'Z'), r.BetweenOpts{Index: \"updated_at\"})\n    }).Run(session)\n</code></p>\n\n<p>row.Date\nrow.ToEpochTime</p>\n\n<p>But yet not able to get the result. Please help me formulate this query in gorethink.</p>\n"}, {"tags": ["go", "influxdb"], "answers": [{"tags": [], "owner": {"reputation": 622, "user_id": 2949830, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/I9CgV.jpg?s=128&g=1", "display_name": "rusnasonov", "link": "https://stackoverflow.com/users/2949830/rusnasonov"}, "is_accepted": true, "score": 18, "last_activity_date": 1436520756, "creation_date": 1436520756, "answer_id": 31337344, "question_id": 31334197, "link": "https://stackoverflow.com/questions/31334197/failed-to-install-golang-org-x-crypto-bcrypt/31337344#31337344", "title": "Failed to install golang.org/x/crypto/bcrypt", "body": "<p>I found temporary solution.</p>\n\n<p>Library <em>golang.org/x/crypto/bcrypt</em> has mirror on <a href=\"https://github.com/golang/crypto\" rel=\"noreferrer\">github</a>.</p>\n\n<p>Create folder <code>src/golang.org/x/</code> into you <code>GOPATH</code>.</p>\n\n<pre><code>mkdir -p $GOPATH/src/golang.org/x/\n</code></pre>\n\n<p>Then clone <em>crypto</em> from github.</p>\n\n<pre><code>cd $GOPATH/src/golang.org/x/\ngit clone git@github.com:golang/crypto.git\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 651, "user_id": 4460294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dj2KDkekyM4/AAAAAAAAAAI/AAAAAAAAAIQ/C-OhGO-gz2E/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/4460294/mayank-gupta"}, "is_accepted": false, "score": 12, "last_activity_date": 1566508407, "last_edit_date": 1566508407, "creation_date": 1566507035, "answer_id": 57616882, "question_id": 31334197, "link": "https://stackoverflow.com/questions/31334197/failed-to-install-golang-org-x-crypto-bcrypt/57616882#57616882", "title": "Failed to install golang.org/x/crypto/bcrypt", "body": "<p>I resolved it by using command: </p>\n\n<p><code>go get golang.org/x/crypto/bcrypt</code></p>\n"}, {"comments": [{"owner": {"reputation": 1042, "user_id": 15070659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HkdKp.jpg?s=128&g=1", "display_name": "EsTeAa", "link": "https://stackoverflow.com/users/15070659/esteaa"}, "edited": false, "score": 3, "creation_date": 1614704232, "post_id": 66443177, "comment_id": 117463980, "body": "Thank you for contributing an answer. Would you kindly edit your answer to to include an explanation of your code? That will help future readers better understand what is going on, and especially those members of the community who are new to the language and struggling to understand the concepts."}], "tags": [], "owner": {"reputation": 1, "user_id": 15316212, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Kf_PIs7YT0g/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuclrQHIQxkfiZkIAgirK8bXcQZTLgQ/s96-c/photo.jpg?sz=128", "display_name": "anakein", "link": "https://stackoverflow.com/users/15316212/anakein"}, "is_accepted": false, "score": 0, "last_activity_date": 1614702191, "creation_date": 1614702191, "answer_id": 66443177, "question_id": 31334197, "link": "https://stackoverflow.com/questions/31334197/failed-to-install-golang-org-x-crypto-bcrypt/66443177#66443177", "title": "Failed to install golang.org/x/crypto/bcrypt", "body": "<pre><code>1 - cd /usr/local/go/src/\n2 - sudo mkdir x\n3 - cd x\n4 - sudo git clone https://github.com/golang/crypto.git\n5 - restart vscode \n</code></pre>\n"}], "owner": {"reputation": 622, "user_id": 2949830, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/I9CgV.jpg?s=128&g=1", "display_name": "rusnasonov", "link": "https://stackoverflow.com/users/2949830/rusnasonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14740, "favorite_count": 5, "accepted_answer_id": 31337344, "answer_count": 3, "score": 16, "last_activity_date": 1614702191, "creation_date": 1436510781, "last_edit_date": 1551073366, "question_id": 31334197, "link": "https://stackoverflow.com/questions/31334197/failed-to-install-golang-org-x-crypto-bcrypt", "title": "Failed to install golang.org/x/crypto/bcrypt", "body": "<p>I trying install <a href=\"https://github.com/influxdb/influxdb\" rel=\"noreferrer\">InfluxDB</a> client. But installation failed. This is my trace:</p>\n\n<pre><code>go get -u -v -x github.com/influxdb/influxdb/client\ngithub.com/influxdb/influxdb (download)\n...\ngit remote -v\nFetching https://golang.org/x/crypto/bcrypt?go-get=1\n[1]    6625 segmentation fault (core dumped)  go get -u -v -x github.com/influxdb/influxdb/client\n</code></pre>\n\n<p>I did not find package <em>golang.org/x/crypto/bcrypt</em> into <strong>GOROOT</strong> and <strong>GOPATH</strong>.</p>\n\n<p>When I trying install <strong>crypto/bcrypt</strong>  I have this error:</p>\n\n<pre><code>go get -u -v golang.org/x/crypto/bcrypt\nFetching https://golang.org/x/crypto/bcrypt?go-get=1\n[1]    7667 segmentation fault (core dumped)  go get -u -v golang.org/x/crypto/bcrypt\n</code></pre>\n\n<p>How I can install <em>golang.org/x/crypto/bcrypt</em>?</p>\n\n<p>My golang version is <strong>go version go1.4.2 gccgo</strong></p>\n"}, {"tags": ["string", "go"], "answers": [{"comments": [{"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 1, "creation_date": 1436512876, "post_id": 31333790, "comment_id": 50654216, "body": "This works as well. However, the time taken is 1.08 seconds. The other solution was accepted because it took 0.28 seconds."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436515514, "post_id": 31333790, "comment_id": 50655704, "body": "@callmekatootie, yes makes sense. <code>scanner.Text()</code> allocates memory and that what it makes it slower than the solution by @icza"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 2, "last_activity_date": 1436509236, "creation_date": 1436509236, "answer_id": 31333790, "question_id": 31333353, "link": "https://stackoverflow.com/questions/31333353/faster-input-scanning/31333790#31333790", "title": "Faster input scanning", "body": "<p>Try using <code>bufio.Scanner</code> (as suggested in the thread you mentioned):</p>\n\n<pre><code>fmt.Scan(&amp;n)\nfmt.Scan(&amp;k)\n\nscanner := bufio.NewScanner(os.Stdin)\nfor n &gt; 0 {\n    scanner.Scan()\n    k, _ := strconv.Atoi(scanner.Text())\n    ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436512236, "post_id": 31334515, "comment_id": 50653778, "body": "How to stop scanning input? <code>scanner.Scan()</code> loop continues even if I only press enter key"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436512445, "post_id": 31334515, "comment_id": 50653912, "body": "@callmekatootie <code>scanner.Scan()</code> returns <code>true</code> until there is input. If you want to test it locally, use a modified loop which counts the lines. See edited answer."}, {"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436512571, "post_id": 31334515, "comment_id": 50654003, "body": "Ok. The variable <code>n</code> which is the number of inputs. So, I assume that if I need to stop after n inputs, I replace the for condition with the <code>n&gt;0</code>  condition and move the <code>scanner.Scan()</code> inside the for loop"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436512635, "post_id": 31334515, "comment_id": 50654035, "body": "@callmekatootie I edited the answer to avoid confusion. The full example now loops to read <code>n</code> lines. The simplified loop is now moved to the &quot;Notes&quot; section."}, {"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1436513049, "post_id": 31334515, "comment_id": 50654316, "body": "Out of curiosity, how do you &quot;close&quot; input when testing locally? I mean, I tried hitting the enter key without input, it still took it and did not stop. Ctrl+C terminates the program itself. So how to &quot;close&quot; input but not stop program?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 1, "creation_date": 1436514064, "post_id": 31334515, "comment_id": 50654914, "body": "@callmekatootie, Ctrl+D if you are using Linux"}, {"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436715013, "post_id": 31334515, "comment_id": 50718176, "body": "@kostya Yup. That does it. Thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1436521739, "last_edit_date": 1436521739, "creation_date": 1436511872, "answer_id": 31334515, "question_id": 31333353, "link": "https://stackoverflow.com/questions/31333353/faster-input-scanning/31334515#31334515", "title": "Faster input scanning", "body": "<p>You can use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> to read lines from the input.</p>\n\n<p>And since we're always reading numbers, we can create a highly optimized converter to get the number. We should avoid using <a href=\"https://golang.org/pkg/bufio/#Scanner.Text\" rel=\"noreferrer\"><code>Scanner.Text()</code></a> which creates a <code>string</code> as we can obtain the number just from the raw bytes returned by <a href=\"https://golang.org/pkg/bufio/#Scanner.Bytes\" rel=\"noreferrer\"><code>Scanner.Bytes()</code></a>. <code>Scanner.Text()</code> returns the same token as <code>Scanner.Bytes()</code> but it first converts to <code>string</code> which is obviously slower and generates \"garbage\" and work for the gc.</p>\n\n<p>So here is a converter function which obtains an <code>int</code> from the raw bytes:</p>\n\n<pre><code>func toInt(buf []byte) (n int) {\n    for _, v := range buf {\n        n = n*10 + int(v-'0')\n    }\n    return\n}\n</code></pre>\n\n<p>This <code>toInt()</code> works because the <code>[]byte</code> contains the UTF-8 encoded byte sequence of the string representation of the decimal format of the number, which contains only digits in the range of <code>'0'..'9'</code> whose UTF-8 encoded bytes are mapped one-to-one (one byte is used for one digit). The mapping from digit to byte is simply a shift: <code>'0' -&gt; 48</code>, <code>'1' -&gt; 49</code> etc.</p>\n\n<p>Using this your complete application:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    var n, k, c int\n    scanner := bufio.NewScanner(os.Stdin)\n\n    scanner.Scan()\n    fmt.Sscanf(scanner.Text(), \"%d %d\", &amp;n, &amp;k)\n\n    for ;n &gt; 0; n-- {\n        scanner.Scan()\n        if toInt(scanner.Bytes())%k == 0 {\n            c++\n        }\n    }\n\n    fmt.Println(c)\n}\n\nfunc toInt(buf []byte) (n int) {\n    for _, v := range buf {\n        n = n*10 + int(v-'0')\n    }\n    return\n}\n</code></pre>\n\n<p>This solution is about 4 times faster than calling <a href=\"https://golang.org/pkg/strconv/#Atoi\" rel=\"noreferrer\"><code>strconv.Atoi()</code></a> for example.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>In the above solution I assumed input is valid, that is it always contains valid numbers and contains at least <code>n</code> lines after the first (which gives us <code>n</code> and <code>k</code>).</p>\n\n<p>If the input is closed after <code>n+1</code> lines, we can use a simplified <code>for</code> (and we don't even need to decrement and rely on <code>n</code>):</p>\n\n<pre><code>for scanner.Scan() {\n    if toInt(scanner.Bytes())%k == 0 {\n        c++\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 7718471, "user_type": "registered", "profile_image": "https://graph.facebook.com/1593355237359906/picture?type=large", "display_name": "Alex Lucchesi", "link": "https://stackoverflow.com/users/7718471/alex-lucchesi"}, "is_accepted": false, "score": 0, "last_activity_date": 1595368431, "creation_date": 1595368431, "answer_id": 63023672, "question_id": 31333353, "link": "https://stackoverflow.com/questions/31333353/faster-input-scanning/63023672#63023672", "title": "Faster input scanning", "body": "<p>I coded 3 versions to compare them.\nThe first using <code>fmt.Scanf(&quot;%d&quot;, &amp;v)</code>, the second converting numbers from bytes (like @icza), and the third converting using <code>strconv.Atoi</code>. To use the functions I initializated scanner in that way:</p>\n<pre><code>scanner := bufio.NewScanner(os.Stdin)\nscanner.Split(bufio.ScanWords)\n</code></pre>\n<p>So, every time I call scanner.Scan, it returns a token splitted by spaces.\nAnd the functions follow:</p>\n<pre><code>func scanFromBytes(scanner *bufio.Scanner) (n int) {\n    scanner.Scan()\n\n    buf := scanner.Bytes()\n    for _, v := range buf {\n        n = n*10 + int(v-'0')\n    }\n\n    return\n}\n</code></pre>\n<p>And:</p>\n<pre><code>func scanAtoi(scanner *bufio.Scanner) (n int) {\n    scanner.Scan()\n    \n    n, _ = strconv.Atoi(scanner.Text())\n\n    return\n}\n</code></pre>\n<p>I have tested with a big file (40k tests), reading about 8 integers per test.\nThe <code>fmt.Scanf</code> solution, takes about 1.9s, as expected (more than the others).\nIn the two functions I got about 0.8s. But the <code>scanAtoi</code> always takes about 0.05s less than <code>scanFromBytes</code>, except for the very first time (maybe some caching occurs).</p>\n"}], "owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3685, "favorite_count": 1, "accepted_answer_id": 31334515, "answer_count": 3, "score": 12, "last_activity_date": 1595368431, "creation_date": 1436507360, "last_edit_date": 1537191635, "question_id": 31333353, "link": "https://stackoverflow.com/questions/31333353/faster-input-scanning", "title": "Faster input scanning", "body": "<p>I am attempting to solve the SPOJ question that can be found <a href=\"http://www.spoj.com/problems/INTEST/\" rel=\"noreferrer\">here</a></p>\n\n<p>Following is my solution:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"bufio\"\nimport \"os\"\n\nfunc main() {\n    var n, k int\n    var num int\n    var divisible int\n\n    in := bufio.NewReader(os.Stdin)\n\n    fmt.Fscan(in, &amp;n)\n    fmt.Fscan(in, &amp;k)\n\n    for n &gt; 0 {\n        fmt.Fscan(in, &amp;num)\n\n        if num%k == 0 {\n            divisible++\n        }\n\n        n--\n    }\n\n    fmt.Println(divisible)\n}\n</code></pre>\n\n<p>The code works fine. The issue here is that I get a timeout when I execute it in SPOJ.</p>\n\n<p>I was first using only <code>fmt.Scan</code> but I then came across <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/W08rFBcHKbc\" rel=\"noreferrer\">this</a> thread that suggested that I use <code>bufio</code> instead for faster input scanning.</p>\n\n<p>But I still get a timeout issue. I am only looping to get all the inputs and within this loop itself I determine whether the input is divisible or not. So, I believe that its not the loop but the input scanning that's taking time. How can I improve this to read the input faster? Or is the issue somewhere else?</p>\n"}, {"tags": ["go", "webserver"], "answers": [{"comments": [{"owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 0, "creation_date": 1436513902, "post_id": 31333472, "comment_id": 50654822, "body": "I generally tend to assume that a lookup table is faster than any kind of runtime conditional evaulation. This <a href=\"http://stackoverflow.com/questions/9928221/table-of-functions-vs-switch-in-golang\">SO  thread</a> would appear to support that assumption.  That apart all of my code is emitted by a script, not written by hand and it turns out to be cleaner/more efficient to emit a lookup table."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 0, "creation_date": 1436514640, "post_id": 31333472, "comment_id": 50655220, "body": "@DroidOS, the thread you mentioned is from 2012. It is possible that the latest Go compiler produces faster code. E.g. <a href=\"https://github.com/golang/go/commit/4bc9badd759f863f784e5f8d105a25c615324359\" rel=\"nofollow noreferrer\">github.com/golang/go/commit/&hellip;</a> If performance is really important I would suggest you to benchmark two different approaches."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 1, "creation_date": 1436514947, "post_id": 31333472, "comment_id": 50655397, "body": "@DroidOS, if the code is auto-generated and no one looks at it other than Go compiler than I think it doesn&#39;t really matter if it is idiomatic or not. Just make it as efficient as possible. Look at stringer output for example (<a href=\"http://blog.golang.org/generate\" rel=\"nofollow noreferrer\">blog.golang.org/generate</a>)."}, {"owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 0, "creation_date": 1436514966, "post_id": 31333472, "comment_id": 50655410, "body": "I just mentioned the possible speed issue in passing. The more important issue here is that emitting the lookup table is cleaner &amp; faster than building a lengthy <code>switch</code> statement"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 0, "last_activity_date": 1436507896, "creation_date": 1436507896, "answer_id": 31333472, "question_id": 31333059, "link": "https://stackoverflow.com/questions/31333059/using-mapped-handlers-in-a-golang-web-server/31333472#31333472", "title": "Using mapped handlers in a Golang web server", "body": "<p>How about using a <code>switch</code> statement in <code>handleConnection</code>?</p>\n\n<pre><code>switch hh {\ncase \"h1\":\n    h1(\"rg\", w, r)\ncase \"h2\":\n    h2(\"rg\", w, r)\ncase \"h3\":\n    h3(\"rg\", w, r)\ndefault:\n    // return HTTP 400 here\n}\n</code></pre>\n\n<p>The advantages are:</p>\n\n<ul>\n<li>Simpler to understand code: \n\n<ul>\n<li>no <code>apiFunc</code> and <code>gHandlers</code> types</li>\n<li>no need to browse around the source code in order to understand the routing logic, it is all in one place</li>\n</ul></li>\n<li>More flexible: you can call functions with different arguments and implement more complex routing rules if necessary.</li>\n</ul>\n"}], "owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436509096, "creation_date": 1436505863, "last_edit_date": 1436509096, "question_id": 31333059, "link": "https://stackoverflow.com/questions/31333059/using-mapped-handlers-in-a-golang-web-server", "title": "Using mapped handlers in a Golang web server", "body": "<p>I need to define request handlers for specific requests in my Golang web server.  The way I am doing this at present is as follows</p>\n\n<pre><code>package main\n\nimport \"net/http\"\n\ntype apiFunc func(rg string, w http.ResponseWriter, r *http.Request)\n\nfunc h1(rg string, w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Bonjour\"))\n}\n\nfunc h2(rg string, w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Guten Tag!\"))\n}\n\nfunc h3(rg string, w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Good Morning!\"))\n}\n\ntype gHandlers map[string]apiFunc\n\nvar handlers gHandlers\n\nfunc handleConnection(w http.ResponseWriter, r *http.Request) {\n    hh := r.URL.Query().Get(\"handler\")\n    handlers[hh](\"rg\", w, r)\n}\n\nfunc main() {\n    handlers = make(map[string]apiFunc, 3)\n    handlers[\"h1\"] = h1\n    handlers[\"h2\"] = h2\n    handlers[\"h3\"] = h3\n    http.HandleFunc(\"/\", handleConnection)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>This works just fine.  However, I am still a newcomer to Golang so it may not be the \"right\" way to do things.  I'd be much obliged to anyone who might be able to indicate whether is a better way to go about achieving this result</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 3, "last_activity_date": 1436492332, "creation_date": 1436492332, "answer_id": 31331094, "question_id": 31331016, "link": "https://stackoverflow.com/questions/31331016/golang-initilize-inner-struct-object-in-nested-structs/31331094#31331094", "title": "golang initilize inner struct object in nested structs", "body": "<p>You can't. <code>Posts.Data</code> isn't the name of a type. The only thing you could do is <code>var innerData struct{ ... }</code>, which I'm sure you don't want to because then you would have repetition and need to make changes in two places. Otherwise, you have to give it a name. That name doesn't have to be <code>Data</code>, it can be <code>PostData</code> or something to make it unique.</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 31331094, "answer_count": 1, "score": 0, "last_activity_date": 1436492332, "creation_date": 1436491743, "question_id": 31331016, "link": "https://stackoverflow.com/questions/31331016/golang-initilize-inner-struct-object-in-nested-structs", "title": "golang initilize inner struct object in nested structs", "body": "<p>I have a nested struct</p>\n\n<pre><code>type Posts struct {\n    Id        int\n    CreatedAt time.Time\n    Data      struct {\n        Title    string\n        UserName string\n    }\n}\n</code></pre>\n\n<p>I want to create a Data object but <code>var innerData Posts.Data</code> doesn't seem to work. I don't want to create separate <code>Data struct</code> because I'm planning to avoid name collusions by having multiple structs which will have different inner structs named Data.</p>\n"}, {"tags": ["syntax", "go"], "answers": [{"comments": [{"owner": {"reputation": 2641, "user_id": 1852838, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/0NrW1.jpg?s=128&g=1", "display_name": "jeteon", "link": "https://stackoverflow.com/users/1852838/jeteon"}, "edited": false, "score": 0, "creation_date": 1436523815, "post_id": 31331385, "comment_id": 50660901, "body": "I was trying to suggest that the expression <code>y &lt;- x</code> be a read from channel <code>y</code> into channel <code>x</code> if <code>y</code> is also a similar channel. But I hear you...the syntax  is not as expressive anymore, and you would have to read the entire code in order to interpret it."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1436494455, "creation_date": 1436494455, "answer_id": 31331385, "question_id": 31330610, "link": "https://stackoverflow.com/questions/31330610/why-does-assigning-to-a-variable-in-go-have-an-equal-sign/31331385#31331385", "title": "Why does assigning to a variable in Go have an equal sign", "body": "<p>Combining two orthogonal operators each doing one thing is much more expressive.</p>\n\n<p>In addition to the examples provided by @sedat-kapanoglu, think how would you express the following:</p>\n\n<pre><code>x := &lt;-ch\nx += &lt;-ch\nx, y = &lt;-ch1, &lt;-ch2\n</code></pre>\n\n<p>Also with your proposal the following expression:</p>\n\n<pre><code>y &lt;- x\n</code></pre>\n\n<p>could be a read from a channel <code>x</code> or a write to a channel <code>y</code> depending on the types <code>x</code> and <code>y</code>. Compare it to the code that uses the existing syntax:</p>\n\n<pre><code>y = &lt;-x\ny &lt;- x\n</code></pre>\n"}], "owner": {"reputation": 2641, "user_id": 1852838, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/0NrW1.jpg?s=128&g=1", "display_name": "jeteon", "link": "https://stackoverflow.com/users/1852838/jeteon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 31331385, "answer_count": 1, "score": 2, "last_activity_date": 1436494455, "creation_date": 1436488545, "last_edit_date": 1436489048, "question_id": 31330610, "link": "https://stackoverflow.com/questions/31330610/why-does-assigning-to-a-variable-in-go-have-an-equal-sign", "title": "Why does assigning to a variable in Go have an equal sign", "body": "<p>I would like to say upfront that I'm only starting to learn about and use the Go language and also that this isn't a syntax question but more of a language design question.</p>\n\n<p>In Go, assuming that you have a channel <code>c</code> of <code>int</code>, you can send on the channel using:</p>\n\n<pre><code>c &lt;- 1\n</code></pre>\n\n<p>And receive from the channel into a variable <code>v</code> with:</p>\n\n<pre><code>v = &lt;- c\n</code></pre>\n\n<p>I've read that a simple way to remember the syntax is that the \"arrow\" points in the direction in which information is flowing, which I think is poetic, especially being quite the Python fan. My question is why is this not taken all the way so you have the symmetric syntax:</p>\n\n<pre><code>v &lt;- c\n</code></pre>\n\n<p>in order to receive from a channel? Why have the equals sign there?</p>\n\n<p>I suppose the interpreter would end up with adjacent syntax tokens like:</p>\n\n<pre><code>[variable][value]\n</code></pre>\n\n<p>which could conceivably come from a statement like:</p>\n\n<pre><code>v 1 \n</code></pre>\n\n<p>So that the equals sign there allows you to reuse the usual variable assignment machinery by making that channel receipt evaluate to a value. Would it be that difficult to make the interpreter accept the version without the equals sign though? It would basically just have to treat it as a binary operator for that case.</p>\n\n<p>It also seems to lead to other cases where if there are two channels <code>c1</code> and <code>c2</code> you have the syntax:</p>\n\n<pre><code>c2 &lt;- &lt;- c1\n</code></pre>\n\n<p>In order to read from one and transmit it into the other. </p>\n\n<hr>\n\n<p>I'd like to also say that I'm not trying to elicit opinions on style but rather trying to understand the decisions drove Go to be the way it is.</p>\n"}, {"tags": ["regex", "go", "infinite-loop"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436484566, "post_id": 31329930, "comment_id": 50645778, "body": "I don&#39;t have time to dig into this, but what happens if stop re-using the <code>indexes</code> slice? I&#39;m pretty skeptical of that code. Just at a glance you&#39;re doing a bunch of re-slicing, given I have to stop and think about what the collection is like after each line of code, that is probably where your error happens."}, {"owner": {"reputation": 831, "user_id": 3442448, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rxckz.png?s=128&g=1", "display_name": "Jason L.", "link": "https://stackoverflow.com/users/3442448/jason-l"}, "edited": false, "score": 0, "creation_date": 1436486735, "post_id": 31329930, "comment_id": 50646401, "body": "Is it possible to restate the problem in terms of a sample input and the desired output?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1436541095, "post_id": 31329930, "comment_id": 50672487, "body": "Markdown image links can also specify a title: <code>![alt text](&#47;path&#47;to&#47;img.jpg &quot;Title&quot;)</code> And what about the perfectly valid markdown of <code>![alt text][id]</code> then later <code>[id]: &#47;path&#47;to&#47;img.jpg &quot;Title&quot;</code>? Trying to parse things with regexps is often at best difficult and error prone. Surely there must be a markdown parser available in Go."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1436708995, "post_id": 31329930, "comment_id": 50716395, "body": "Yup there is a markdown parser. The problem is I am hosting the markdown and images for display from a golang web server. The server needs to know the location of the images. When the author of the markdown puts a relative path, I need to change that to an absolute path. You are right though, so I restrict the markdown authors to just image relative location and the images must be in the same directory as the markdown file itself."}], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1436709809, "post_id": 31336647, "comment_id": 50716618, "body": "Ive updated the original question with a working version now. Thanks"}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 0, "last_activity_date": 1436518934, "creation_date": 1436518934, "answer_id": 31336647, "question_id": 31329930, "link": "https://stackoverflow.com/questions/31329930/regex-for-markdown-url-on-all-urls-in-golang/31336647#31336647", "title": "Regex for markdown url on all urls in golang", "body": "<p>After this line:</p>\n\n<pre><code>imageLocation := body[indexes[0]:indexes[1]]\n</code></pre>\n\n<p><code>imageLocation</code> will contain a string like <code>![image](anImage.png)</code>.</p>\n\n<pre><code>body = body[:indexes[0]] + imageLocation + body[indexes[1]:]\n</code></pre>\n\n<p>After that line, body will be the same as it was before. You're basically reconstructing it out of 3 segments.</p>\n\n<p>This is equivalent to doing <a href=\"http://play.golang.org/p/UUk5A_oHwv\" rel=\"nofollow\">the following</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := \"Hello, playground\"\n    t := s[2:4]\n    s = s[:2] + t + s[4:]\n    fmt.Println(s) // prints \"Hello, playground\"\n}\n</code></pre>\n\n<p>In the next iteration, the same left-most match will be found again, ad perpetuum.</p>\n\n<p>Have you read the documentation for <a href=\"http://golang.org/pkg/regexp/#Regexp.FindStringIndex\" rel=\"nofollow\"><code>FindStringIndex</code></a>?</p>\n\n<p>If you edit your question to say what you're trying to do I can provide you with a working code snippet.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 893, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1436709795, "creation_date": 1436483839, "last_edit_date": 1436709795, "question_id": 31329930, "link": "https://stackoverflow.com/questions/31329930/regex-for-markdown-url-on-all-urls-in-golang", "title": "Regex for markdown url on all urls in golang", "body": "<p>I am trying to work through a markdown file, replacing all the image urls. The format of a markdown image url is <code>![alternative name](imageurl.png)</code></p>\n\n<p>My regex search finds the first one, returns the location and I replace it, I then cycle through the document until my regex search doesnt find any - i.e its array of match dimensions is empty. </p>\n\n<p>The problem is for some reason it continues to match on \"i dont exactly know what\". I.e the length of the array returned from the regex search is never 0</p>\n\n<pre><code>location := split[:locationSplit]\n\nbodyRe := regexp.MustCompile(`!\\[(.*)\\]\\((.*)\\)`)\nindexes := bodyRe.FindStringIndex(body)\nfmt.Println(\"location: \", absoluteFileLocation)\nfmt.Println(\"length: \", indexes)\n\nfor len(indexes) != 0 {\n    fmt.Println(\"length: \", len(indexes))\n    imageLocation := body[indexes[0]:indexes[1]]\n    body = body[:indexes[0]] + imageLocation + body[indexes[1]:]\n    indexes = indexes[:0]\n    fmt.Println(\"length: \", len(indexes))\n    indexes = bodyRe.FindStringIndex(body)\n}\n</code></pre>\n\n<p>this returns a continual:</p>\n\n<pre><code>length:  2\nlength:  0\nlength:  2\nlength:  0\nlength:  2\nlength:  0\nlength:  2\nlength:  0\nlength:  2\n</code></pre>\n\n<p>the 2's come from the line <code>indexes = bodyRe.FindStringIndex(body)</code> inside the loop as I set indexes to 0 just before.</p>\n\n<p>Help appreciated</p>\n\n<p>EDIT: Edit due to request for example included. The above method is clearly flawed, this following method works for the first image, but not for the next ones</p>\n\n<p>So I attempted this technique:</p>\n\n<p>(sample markdown file)</p>\n\n<pre><code>some markdown\n\n![image](anImage.png)\n\nmore markdown\n\n![image2](anImage2.png)\n\nmore markdown &amp; end of document\n</code></pre>\n\n<p>and the the revised code:</p>\n\n<pre><code>...\n...\n    bodyRe := regexp.MustCompile(`!\\[(.*)\\]\\((.*)\\)`)\n    indexes := bodyRe.FindAllStringSubmatchIndex(body, -1)\n\n    for _, j := range(indexes) { //i is the index, j is the element (in this case j = []int )\n        imageLocation := body[j[4]:j[5]]\n        body = body[:j[4]] + \"/App/Image/?image=\" + location + \"/\" + imageLocation + body[j[5]:]\n    }\n    return body\n</code></pre>\n\n<p>(required output markdown)</p>\n\n<pre><code>some markdown\n\n![image](/App/Image/?image=[location]/anImage.png)\n\nmore markdown\n\n![image2](/App/Image/?image=[location]/anImage2.png)\n\nmore markdown\nend of document\n</code></pre>\n\n<p>And that works for the first image. But not the second one. The problem is (I think that when that method loops through and replaces the first one, the indexes in body (i.e <code>body[j[4]:j[5]]</code>) change and so it replaces the second one in the wrong place.</p>\n\n<p>I need to do this so that when the markdown is eventually rendered the image urls point to places where they can be served from.</p>\n\n<p>EDIT: Fixed</p>\n\n<p>Thanks guys.\nDue to the fact that people struggled to understand what I wanted to do, I suspect that I am going about the problem in a strange way. I have got it working and below is the code snippet that works for any one else looking into this.</p>\n\n<p>Firstly I will explain why I had the problem.\nI wanted to seperate out the writing of blogs for a site, from the actual maintenance of the site itself. Therefore 'blog writers' were told to write blogs in markdown, with all image tags in the format of ` where all images must be in the same directory as the markdown file itself.\nBecause this directory is not part of the code base of the website itself, the image urls needed replacing with the absolute urls so they could be served. I didnt want this to be something the blog writers needed to worry about.</p>\n\n<p>Everything worked fine for the first image, but because the replacement absolute URL changed the length and therefore the positions of all of the characters in the blog contents, the indexes that the regex found, no longer aligned, so I had to add the new length to the indexes of matches.</p>\n\n<pre><code>adjustment := 0\nfor _, j := range(indexes) {\n    imageLocation := body[j[4]+adjustment:j[5]+adjustment]\n\n    replacement := \"?imageurl=\" + url.QueryEscape(location) + \"/\" + imageLocation\n    body = body[:j[4] + adjustment] + replacement + body[j[5] + adjustment:]\n    adjustment += len(replacement) - len(imageLocation)\n}\n</code></pre>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1436483044, "post_id": 31329324, "comment_id": 50645312, "body": "I don&#39;t think you want to use pipes at all since you have direct access to standard io in Go. As you can see what you&#39;re referring to is a <code>os.pipe()</code>... Like  <code>|</code> in Bash, which composes two commands, sending the output from the first as input to the second. But to accomplish the same in Go you just read on stdout and then call the next command with the data in that <code>io.Reader</code>, no pipes involved."}, {"owner": {"reputation": 11, "user_id": 4032227, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-UBItefiNm_Y/AAAAAAAAAAI/AAAAAAAAAIE/7kbgYqPKr74/photo.jpg?sz=128", "display_name": "Alexander Steshenko", "link": "https://stackoverflow.com/users/4032227/alexander-steshenko"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436512729, "post_id": 31329324, "comment_id": 50654105, "body": "Hi Evan, thanks. But it<code>s not only simple calling pythonic script and his immediately terminated, this exactly client part which in future will coding in C# or C++. All action in scripts accomplish in infinity loop how in Go (server side). So I needed communicated in running proces. Or I don</code>t undestand you approach?"}], "owner": {"reputation": 11, "user_id": 4032227, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-UBItefiNm_Y/AAAAAAAAAAI/AAAAAAAAAIE/7kbgYqPKr74/photo.jpg?sz=128", "display_name": "Alexander Steshenko", "link": "https://stackoverflow.com/users/4032227/alexander-steshenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 493, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436480747, "creation_date": 1436480747, "question_id": 31329324, "link": "https://stackoverflow.com/questions/31329324/connecting-golang-pipes-and-python-2-7", "title": "Connecting Golang pipes and Python 2.7", "body": "<p>I have following task: need connecting Go pipe with Python. I understand how run pythonic process under Go:</p>\n\n<pre><code>var compiler string = \"python\"\nvar path string = \"...here script path\"\npyExec := exec.Command(compiler, path)\npyExecIn, _ := pyExec.StdinPipe()\npyExecOut, _ := pyExec.StdoutPipe()\npyExec.Start()\n// acitions\npyExec.Wait()\n</code></pre>\n\n<p>I can write data in stdin but I read it only after terminating script.\nFor get data inside process I decide use pipe, but I only can write message into pythonic script. When Go trying read data from python process is blocked. Answer me please, this is trouble with implementation or Goland pipes and pythonic pipes not compatible? Exist another way connection both process (except socket and so on)</p>\n\n<p>Go: </p>\n\n<pre><code>var compiler string = \"python\"\nvar path string = \"...here script path\"\npyExec := exec.Command(compiler, path)\npyExecIn, _ := pyExec.StdinPipe()\npyExecOut, _ := pyExec.StdoutPipe()\npipeReader, pipeWriter := io.Pipe()\npyExec.Stdin = pipeReader\npyExec.Stdout = pipeWriter\npyExec.Start()\npipeWriter.Write(message)\nvar received_data = make([]byte, 1024)\ndata, _ := pipeReader.Read(received_data)\npyExecIn.Close()\npyExecOut.Close()\npyExec.Wait()\n</code></pre>\n\n<p>Python:</p>\n\n<pre><code>r, w = os.pipe()\nr = os.fdopen(r, 'r')\nraw_responce = r.read(1024)\n# actions\nw = os.fdopen(w, 'w')\nw.write(data)\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["linux", "unix", "process", "go", "ps"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1436476175, "post_id": 31328213, "comment_id": 50642635, "body": "Only as a matter of convention but clearly these things do; &#39;cwd&#39;: &#39;/home/ben/gocode/src/SampleMePlz&#39;,  &#39;exe&#39;: &#39;/home/ben/gocode/src/SampleMePlz/SampleMePlz&#39;,"}, {"owner": {"reputation": 1683, "user_id": 3624201, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4103a1a9daaf21559dbb9b7f83bfa314?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Sandler", "link": "https://stackoverflow.com/users/3624201/ben-sandler"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436476359, "post_id": 31328213, "comment_id": 50642730, "body": "Good point. I&#39;d rather not depend on the directory it is executed from to be  my $GOPATH. It feels a bit hacky (and won&#39;t always work)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436476406, "post_id": 31328213, "comment_id": 50642764, "body": "Yeah it is a hack. Otherwise I think the answer is no. Which is good because the OS has no business disclosing the implementation details of software it&#39;s running anyway. Maybe my IP is obfuscated in that binary."}, {"owner": {"reputation": 1683, "user_id": 3624201, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4103a1a9daaf21559dbb9b7f83bfa314?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Sandler", "link": "https://stackoverflow.com/users/3624201/ben-sandler"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436476541, "post_id": 31328213, "comment_id": 50642835, "body": "What do you mean &quot;my IP&quot;?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436477131, "post_id": 31328213, "comment_id": 50643120, "body": "Intellectual Property. Like the OS shouldn&#39;t help you to peer into the inner workers of compiled applications."}, {"owner": {"reputation": 3170, "user_id": 1008681, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/61d390f373d185083712b99e541ebee7?s=128&d=identicon&r=PG", "display_name": "Joe Doherty", "link": "https://stackoverflow.com/users/1008681/joe-doherty"}, "edited": false, "score": 4, "creation_date": 1436477443, "post_id": 31328213, "comment_id": 50643266, "body": "He&#39;s correct the answer is no. It is a compiled language which means that it is machine code which is running. You could possibly tell by memory fingerprints and run time metrics but that would take a lot more efford and sort of forensic analysis. Unlike Python which runs inside Python so you can see that through ps"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436487191, "post_id": 31328213, "comment_id": 50646492, "body": "It&#39;s probably for categorizing your own procs--in that case a convention like @evanmcdonnal mentioned in the first comment makes lots of sense to me."}], "answers": [{"comments": [{"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1436521830, "post_id": 31328676, "comment_id": 50659557, "body": "Even such doesn&#39;t proof that it is a &quot;go&quot; process, their are symptoms not proof."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1436477839, "creation_date": 1436477839, "answer_id": 31328676, "question_id": 31328213, "link": "https://stackoverflow.com/questions/31328213/check-if-a-process-is-a-go-application-in-linux-unix/31328676#31328676", "title": "Check if a process is a Go application (in Linux/Unix)", "body": "<p>The short answer is no. The code is compiled leaving no information about what language/compiler produced it. You can look for symptoms of a go-program, like references to your GOPATH or sub directories of it, but not much more.</p>\n"}, {"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 1, "last_activity_date": 1436492345, "last_edit_date": 1436492345, "creation_date": 1436491656, "answer_id": 31331002, "question_id": 31328213, "link": "https://stackoverflow.com/questions/31328213/check-if-a-process-is-a-go-application-in-linux-unix/31331002#31331002", "title": "Check if a process is a Go application (in Linux/Unix)", "body": "<p>In addition to @evanmcdonnal's answer, here's a (very, very) hacky solution:</p>\n\n<pre><code>strings /path/to/binary/from/ps/output | grep 'runtime.gogc' \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;snip&gt;\nruntime.gogc                                                                                            runtime.gogc   \nruntime.gogc   \n&lt;snip&gt;\n</code></pre>\n\n<p>This of course relies on the binary format not changing or otherwise being obfuscated, which is not a good assumption to make long-term. I'm also assuming that <code>runtime.gogc</code> exists across all Go binaries (it may not).</p>\n\n<p>Note that it would be <strong>very</strong> rare for this to be useful information from an operational point of view.</p>\n"}], "owner": {"reputation": 1683, "user_id": 3624201, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4103a1a9daaf21559dbb9b7f83bfa314?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Sandler", "link": "https://stackoverflow.com/users/3624201/ben-sandler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 31328676, "answer_count": 2, "score": 0, "last_activity_date": 1436492345, "creation_date": 1436475901, "question_id": 31328213, "link": "https://stackoverflow.com/questions/31328213/check-if-a-process-is-a-go-application-in-linux-unix", "title": "Check if a process is a Go application (in Linux/Unix)", "body": "<p>I am using ps (specifically the <a href=\"https://pypi.python.org/pypi/psutil\" rel=\"nofollow\">psutil</a> python library) to see a list of running processes on my linux machine. I want to deterimine which processes are running Go applications (that is, they are running Go code).</p>\n\n<p>Below is the <code>ps</code> output for a process that is written in Go. Is there anything that indicates that it is running Go code?</p>\n\n<pre><code>{'cmdline': ['./SampleMePlz'],\n 'connections': [connection(fd=3, family=10, type=1, laddr=('::', 8080), raddr=(), status='LISTEN')],\n 'cpu_affinity': [0, 1, 2, 3],\n 'cpu_percent': 0.0,\n 'cpu_times': cputimes(user=0.0, system=0.0),\n 'create_time': 1436474176.89,\n 'cwd': '/home/ben/gocode/src/SampleMePlz',\n 'exe': '/home/ben/gocode/src/SampleMePlz/SampleMePlz',\n 'ext_memory_info': meminfo(rss=4071424, vms=192684032, shared=3092480, text=3096576, lib=0, data=179523584, dirty=0),\n 'gids': group(real=5000, effective=5000, saved=5000),\n 'io_counters': io(read_count=12, write_count=0, read_bytes=4096, write_bytes=0),\n 'ionice': ionice(ioclass=0, value=4),\n 'memory_info': meminfo(rss=4071424, vms=192684032),\n 'memory_maps': [mmap(path='/lib/x86_64-linux-gnu/libpthread-2.15.so', rss=65536, size=2199552, pss=8192, shared_clean=57344, shared_dirty=0, private_clean=0, private_dirty=8192, referenced=65536, anonymous=8192, swap=0),\n                 mmap(path='/lib/x86_64-linux-gnu/libc-2.15.so', rss=311296, size=3903488, pss=26624, shared_clean=286720, shared_dirty=0, private_clean=0, private_dirty=24576, referenced=311296, anonymous=24576, swap=0),\n                 mmap(path='[stack]', rss=8192, size=139264, pss=8192, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=8192, referenced=8192, anonymous=8192, swap=0),\n                 mmap(path='[anon]', rss=946176, size=179245056, pss=946176, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=946176, referenced=946176, anonymous=946176, swap=0),\n                 mmap(path='/lib/x86_64-linux-gnu/ld-2.15.so', rss=122880, size=151552, pss=13312, shared_clean=110592, shared_dirty=0, private_clean=0, private_dirty=12288, referenced=122880, anonymous=12288, swap=0),\n                 mmap(path='[vsyscall]', rss=0, size=4096, pss=0, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=0, referenced=0, anonymous=0, swap=0),\n                 mmap(path='[heap]', rss=4096, size=135168, pss=4096, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=4096, referenced=4096, anonymous=4096, swap=0),\n                 mmap(path='[vdso]', rss=4096, size=4096, pss=0, shared_clean=4096, shared_dirty=0, private_clean=0, private_dirty=0, referenced=4096, anonymous=0, swap=0),\n                 mmap(path='/home/ben/gocode/src/SampleMePlz/SampleMePlz', rss=2908160, size=6905856, pss=2908160, shared_clean=0, shared_dirty=0, private_clean=2879488, private_dirty=28672, referenced=2908160, anonymous=28672, swap=0)],\n 'memory_percent': 0.025919821179310142,\n 'name': 'SampleMePlz',\n 'nice': 0,\n 'num_ctx_switches': amount(voluntary=15, involuntary=18),\n 'num_fds': 5,\n 'num_threads': 6,\n 'open_files': [],\n 'pid': 111252,\n 'ppid': 42061,\n 'status': 'sleeping',\n 'terminal': '/dev/pts/9',\n 'threads': [thread(id=111252, user_time=0.0, system_time=0.0),\n             thread(id=111253, user_time=0.0, system_time=0.0),\n             thread(id=111254, user_time=0.0, system_time=0.0),\n             thread(id=113972, user_time=0.0, system_time=0.0),\n             thread(id=113973, user_time=0.0, system_time=0.0),\n             thread(id=113974, user_time=0.0, system_time=0.0)],\n 'uids': user(real=3008, effective=3008, saved=3008),\n 'username': 'ben'}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1393, "user_id": 4261259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tvFIJ.png?s=128&g=1", "display_name": "Luc", "link": "https://stackoverflow.com/users/4261259/luc"}, "edited": false, "score": 0, "creation_date": 1436472381, "post_id": 31327124, "comment_id": 50640570, "body": "You could get the day of week (using  Weekday) for the &quot;t&quot; and &quot;f&quot;. Knowing how many days are between t and f you can calculate how many weekends there are."}, {"owner": {"reputation": 43, "user_id": 5004338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b541cd7ed93acf0654bc8a4ef220001c?s=128&d=identicon&r=PG&f=1", "display_name": "sekhelmet", "link": "https://stackoverflow.com/users/5004338/sekhelmet"}, "reply_to_user": {"reputation": 1393, "user_id": 4261259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tvFIJ.png?s=128&g=1", "display_name": "Luc", "link": "https://stackoverflow.com/users/4261259/luc"}, "edited": false, "score": 0, "creation_date": 1436473086, "post_id": 31327124, "comment_id": 50640932, "body": "That gives me a number like Friday = 5 and thursday =4 so if I did an if statement like if t.Weekday() ==6 and decrement that that should reduce the number of days by every Saturday but how do I loop through the days?"}, {"owner": {"reputation": 1393, "user_id": 4261259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tvFIJ.png?s=128&g=1", "display_name": "Luc", "link": "https://stackoverflow.com/users/4261259/luc"}, "edited": false, "score": 0, "creation_date": 1436473683, "post_id": 31327124, "comment_id": 50641240, "body": "Can&#39;t you create an algorithm, for every 7 days there are 5 business data. For the remaining days if day of week of start is layer then end there is a weekend in between"}], "answers": [{"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1436482496, "post_id": 31327554, "comment_id": 50645128, "body": "Hm... this is okay but I believe there is a better way using modulo."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1436482706, "post_id": 31327554, "comment_id": 50645203, "body": "@FUZxxl I was planning to do modulo but I don&#39;t think actually makes any difference. You still have to iterate over time and you can&#39;t like &quot;range&quot; a <code>Duration</code> as far as I can tell. If I just chose to use modulo within my current code it would make no difference. Could you elaborate?"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1436491612, "post_id": 31327554, "comment_id": 50647501, "body": "You can divide the number of days by seven to get the number of weeks and than multiply by five to get the number of week-days. Then you need to do some sort of fixup so the number is correct. This is an O(1) procedure as opposed to your O(n) procedure and should be a lot faster, especially for longer periods. I&#39;m too tired right now to work through the details though."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1586212576, "last_edit_date": 1586212576, "creation_date": 1436473605, "answer_id": 31327554, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/31327554#31327554", "title": "How to calculate number of business days in Golang", "body": "<p>Here's a simple little solution.</p>\n\n<pre><code>days := 0\nfor {\n     if (t.Equal(f)) {\n         return days\n     }\n     if (t.Weekday() != time.Saturday &amp;&amp; t.Weekday() != time.Sunday) {\n          days++\n     }\n     t = t.Add(time.Hour*24)\n}\n</code></pre>\n\n<p>You probably don't want to use your original <code>t</code> variable but keeping the example simple. I loop until <code>t</code> equals <code>f</code>, if they're equal I return my days count. If they're not I check to make sure it's a weekday and increment my days count if it is. I unconditionally add one day to my starting time.</p>\n"}, {"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1436482469, "post_id": 31329658, "comment_id": 50645117, "body": "If the answer from evanmcdonnal helped you, you can mark it as accepted by clicking the tick mark below the score counter."}], "tags": [], "owner": {"reputation": 43, "user_id": 5004338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b541cd7ed93acf0654bc8a4ef220001c?s=128&d=identicon&r=PG&f=1", "display_name": "sekhelmet", "link": "https://stackoverflow.com/users/5004338/sekhelmet"}, "is_accepted": false, "score": 0, "last_activity_date": 1586211926, "last_edit_date": 1586211926, "creation_date": 1436482382, "answer_id": 31329658, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/31329658#31329658", "title": "How to calculate number of business days in Golang", "body": "<p>Here is a solution. Thank you <code>evanmcdonnal</code> and <code>luc</code> for answering.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.Date(2015, time.Now().Month(), time.Now().Day(), time.Now().Hour(), time.Now().Minute(), time.Now().Second(), time.Now().Nanosecond()*0, time.UTC)\n    fmt.Printf(\"%s\\n\",t)\n    f := time.Date(2015, time.August, 22, time.Now().Hour(), time.Now().Minute(), time.Now().Second(), time.Now().Nanosecond()*0, time.UTC)\n    fmt.Printf(\"%s\\n\",f)\n\n    days := 0\n    for {\n        if (t.Equal(f)) {\n            break\n        }\n        if (t.Weekday() != 6 &amp;&amp; t.Weekday() != 0) {\n            days++\n        }\n        t = t.Add(time.Hour*24)\n    }\n\n    fmt.Printf(\"days %d\\n\", days)\n}\n</code></pre>\n\n<p>Output: 32</p>\n"}, {"tags": [], "owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "is_accepted": false, "score": 0, "last_activity_date": 1489181687, "last_edit_date": 1489181687, "creation_date": 1489181341, "answer_id": 42728004, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/42728004#42728004", "title": "How to calculate number of business days in Golang", "body": "<p>Better to use <code>AddDate</code> for time calculations greater than 24 hours:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc AddWorkDays(t time.Time, workdays int) time.Time {\n    curDate := t\n    for curWorkdays := 0; curWorkdays &lt;= workdays; {\n        curDate = curDate.AddDate(0, 0, 1)\n        if curDate.Weekday() != 6 &amp;&amp; t.Weekday() != 7 {\n            curWorkdays++\n        }\n    }\n    return curDate\n}\n\nfunc main() {\n    now := time.Now()\n    workdays := 3\n    t := AddWorkDays(now, workdays)\n    fmt.Printf(\"  now %-9v %v\\n\", now.Weekday(), now)\n    fmt.Printf(\"later %-9v %v\\n\", t.Weekday(), t)\n}\n</code></pre>\n\n<p>Output on day I'm answering:</p>\n\n<pre><code>  now Friday    2017-03-10 21:33:28.395198671 +0000 UTC\nlater Wednesday 2017-03-15 21:33:28.395198671 +0000 UTC\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 0, "last_activity_date": 1499349013, "creation_date": 1499349013, "answer_id": 44950870, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/44950870#44950870", "title": "How to calculate number of business days in Golang", "body": "<p>Realizing that we are calculating an integral and remembering that integrals are usually calculated using primitive functions, which can be taken to be the integral from some fixed time, we can write the following code.</p>\n\n<p>The function <code>primitive()</code> gives the number of workdays since 3 January 2000, chosen to be a Monday to simplify the formula. The number of workdays between two dates is then given by the difference of <code>primitive()</code> for the two days.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Date struct {\n    year int\n    month time.Month\n    day int\n}\n\nfunc date2unix(d Date, loc *time.Location) int64 {\n    return time.Date(d.year, d.month, d.day, 0, 0, 0, 0, loc).Unix()\n}\n\nfunc primitive(d Date, loc *time.Location) int64 {\n    // 3 January 2000 was a Monday\n    base := Date{2000, time.January, 3}\n    seconds := date2unix(d, loc) - date2unix(base, loc)\n    weeks := seconds / (7*24*60*60)\n    seconds_into_week := seconds % (7*24*60*60)\n    workdays := seconds_into_week / (24*60*60)\n    if workdays &gt; 5 {\n        workdays = 5\n    }\n\n    return 5*weeks + workdays\n}\n\nfunc DayCountExcludingWeekends(from, to Date, loc *time.Location) int {\n    return int(primitive(to, loc) - primitive(from, loc))\n}\n\nfunc main() {\n    loc, err := time.LoadLocation(\"Europe/Stockholm\")\n    if err != nil {\n        panic(err)\n    }\n\n    f := Date{2017, 6, 28}\n    t := Date{2017, 7,  6}\n\n    fmt.Println(DayCountExcludingWeekends(f, t, loc))\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/_wxw8-PyMO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_wxw8-PyMO</a></li>\n<li><a href=\"https://goplay.space/#wWU0Stv5zO\" rel=\"nofollow noreferrer\">https://goplay.space/#wWU0Stv5zO</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 2736415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73bcb0b868dfd344d4e8b64bdd38e2e8?s=128&d=identicon&r=PG&f=1", "display_name": "vinceg", "link": "https://stackoverflow.com/users/2736415/vinceg"}, "is_accepted": false, "score": 0, "last_activity_date": 1519940729, "last_edit_date": 1519940729, "creation_date": 1519939326, "answer_id": 49058889, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/49058889#49058889", "title": "How to calculate number of business days in Golang", "body": "<p>CalcBusinessDays calculates the business days between two dates, not accounting for the holidays.\nThe calculation is inclusive for both dates.</p>\n\n<pre><code>func CalcBusinessDays(from *time.Time, to *time.Time) int {\n\ntotalDays := float32(to.Sub(*from) / (24 * time.Hour))\nweekDays := float32(from.Weekday()) - float32(to.Weekday())\nbusinessDays := int(1 + (totalDays*5-weekDays*2)/7)\nif to.Weekday() == time.Saturday {\n    businessDays--\n}\nif from.Weekday() == time.Sunday {\n    businessDays--\n}\n\nreturn businessDays\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 6531412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/084b658415409442e63ed040e83713fd?s=128&d=identicon&r=PG&f=1", "display_name": "Scott Owens", "link": "https://stackoverflow.com/users/6531412/scott-owens"}, "is_accepted": false, "score": 1, "last_activity_date": 1533019627, "creation_date": 1533019627, "answer_id": 51607001, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/51607001#51607001", "title": "How to calculate number of business days in Golang", "body": "<p>I know this has been marked done for a while, but for various reasons I recently had to get the number of weekdays between two dates that could be decades apart.</p>\n\n<p>So if anyone needs it, an O(1) solution.</p>\n\n<pre><code>func GetWeekdaysBetween(start, end time.Time) int {\n    offset := -int(start.Weekday())\n    start = start.AddDate(0, 0, -int(start.Weekday()))\n\n    offset += int(end.Weekday())\n    if end.Weekday() == time.Sunday {\n        offset++\n    }\n    end = end.AddDate(0, 0, -int(end.Weekday()))\n\n    dif := end.Sub(start).Truncate(time.Hour * 24)\n    weeks := float64((dif.Hours() / 24) / 7)\n    return int(math.Round(weeks)*5) + offset\n}\n</code></pre>\n\n<p>If your wanting business days though, this doesn't account for public holidays, which would require some additional planning.</p>\n"}, {"tags": [], "owner": {"reputation": 2572, "user_id": 8253209, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RJs6R.jpg?s=128&g=1", "display_name": "Matt Ke", "link": "https://stackoverflow.com/users/8253209/matt-ke"}, "is_accepted": false, "score": 1, "last_activity_date": 1586216893, "creation_date": 1586216893, "answer_id": 61070679, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang/61070679#61070679", "title": "How to calculate number of business days in Golang", "body": "<p>I wanted a solution which doesn't need a loop to calculate the number of days. (The posted answers by <code>md2perpe</code>, <code>vinceg</code> and <code>Scott Owens</code> however didn't work for me and calculated wrong results.)</p>\n\n<p>Here is solution which doesn't require a loop:</p>\n\n<p>(The solution calculates full weeks and loose days separately and adds them later.)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func calculateWorkingDays(startTime time.Time, endTime time.Time) int {\n    // Reduce dates to previous Mondays\n    startOffset := weekday(startTime)\n    startTime = startTime.AddDate(0, 0, -startOffset)\n    endOffset := weekday(endTime)\n    endTime = endTime.AddDate(0, 0, -endOffset)\n\n    // Calculate weeks and days\n    dif := endTime.Sub(startTime)\n    weeks := int(math.Round((dif.Hours() / 24) / 7))\n    days := -min(startOffset, 5) + min(endOffset, 5)\n\n    // Calculate total days\n    return weeks*5 + days\n}\n\nfunc weekday(d time.Time) int {\n    wd := d.Weekday()\n    if wd == time.Sunday {\n        return 6\n    }\n    return int(wd) - 1\n}\n\nfunc min(a int, b int) int {\n    if a &lt; b {\n        return a\n    }\n    return b\n}\n</code></pre>\n\n<p>First, the weekday offset of the start and end date are calculated and both dates are reduced to the previous Monday. Then, the number of full weeks and loose days are calculated. (If a offset it larger than 5(Friday), only 5 days are used.) Finally, the total days are calculated.</p>\n"}], "owner": {"reputation": 43, "user_id": 5004338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b541cd7ed93acf0654bc8a4ef220001c?s=128&d=identicon&r=PG&f=1", "display_name": "sekhelmet", "link": "https://stackoverflow.com/users/5004338/sekhelmet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3879, "favorite_count": 0, "accepted_answer_id": 31327554, "answer_count": 7, "score": 4, "last_activity_date": 1586217124, "creation_date": 1436472119, "last_edit_date": 1586217124, "question_id": 31327124, "link": "https://stackoverflow.com/questions/31327124/how-to-calculate-number-of-business-days-in-golang", "title": "How to calculate number of business days in Golang", "body": "<p>I have this so far to count the number of days using <a href=\"http://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">http://golang.org/pkg/time/</a> but I don't know how to exclude weekends and only count business days.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.Now()\n    f := time.Date(2015, time.August, 21, 24, 0, 0, 0, time.UTC)\n    diff := f.Sub(t)\n\n    // convert diff to days\n    days := int(diff.Hours() / 24)\n\n    fmt.Printf(\"days  %d\\n\", days)\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "csv", "go"], "comments": [{"owner": {"reputation": 10170, "user_id": 1916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/487430ca3c1389e98a3c39c3910de8ef?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/1916/greg"}, "edited": false, "score": 0, "creation_date": 1436472552, "post_id": 31326659, "comment_id": 50640648, "body": "Without sharing your code, helping will be tricky. A sample of the file that&#39;s causing the problem would likely help as well."}], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 4722740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/88dc974951ed17593f37537b582783a8?s=128&d=identicon&r=PG&f=1", "display_name": "JackS", "link": "https://stackoverflow.com/users/4722740/jacks"}, "is_accepted": false, "score": 1, "last_activity_date": 1436475658, "creation_date": 1436475658, "answer_id": 31328140, "question_id": 31326659, "link": "https://stackoverflow.com/questions/31326659/golang-csv-error-bare-in-non-quoted-field/31328140#31328140", "title": "Golang CSV error bare &quot; in non-quoted-field", "body": "<p>After much ado I determined that the hosting company had updated DotDefender which introduced a rule to block .csv/.tsv     arg</p>\n"}, {"tags": [], "owner": {"reputation": 198, "user_id": 6822592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UgHii.jpg?s=128&g=1", "display_name": "Anderson Lira", "link": "https://stackoverflow.com/users/6822592/anderson-lira"}, "is_accepted": false, "score": 4, "last_activity_date": 1533492223, "last_edit_date": 1533492223, "creation_date": 1533401523, "answer_id": 51687729, "question_id": 31326659, "link": "https://stackoverflow.com/questions/31326659/golang-csv-error-bare-in-non-quoted-field/51687729#51687729", "title": "Golang CSV error bare &quot; in non-quoted-field", "body": "<p>This happens when we have on CSV file de <code>\"</code> (double quotes) value.<br>\nTo avoid this error we should use LazyQuotes Parameter like that:</p>\n\n<pre><code>csvFile, _ := os.Open(\"file.csv\")\nreader := csv.NewReader(bufio.NewReader(csvFile))\nreader.Comma = ';'\nreader.LazyQuotes = true\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 4722740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/88dc974951ed17593f37537b582783a8?s=128&d=identicon&r=PG&f=1", "display_name": "JackS", "link": "https://stackoverflow.com/users/4722740/jacks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4086, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1533492223, "creation_date": 1436470426, "last_edit_date": 1436470738, "question_id": 31326659, "link": "https://stackoverflow.com/questions/31326659/golang-csv-error-bare-in-non-quoted-field", "title": "Golang CSV error bare &quot; in non-quoted-field", "body": "<p>I haven't had trouble parsing csv files for my GAE golang app until this week (I updated to appengine 1.9.23 last week).  Now, regardless of file content I am getting this error:</p>\n\n<p>2015/07/09 15:25:34 http: panic serving 127.0.0.1:50352: line 1, column 22: bare \" in non-quoted-field</p>\n\n<p>Even when the file content doesn't contain any \" characters at all the error occurs.  </p>\n\n<p>Anyone know why my files can no longer be parsed?  Something changed or I'm doing something super-stupid.  </p>\n\n<p>PS using urlfetch to obtain the csv file</p>\n"}, {"tags": ["windows", "process", "go", "handle"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436472252, "post_id": 31325722, "comment_id": 50640495, "body": "Simple high utility Bash command; nightmare to execute on Windows. Cygwin ftw?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2675699"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436473298, "post_id": 31325722, "comment_id": 50641044, "body": "@evanmcdonnal lol, hmmm...not sure if Cygwin is an option...I may have to rethink my approach if it is too complex to implement"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2675699"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436478271, "post_id": 31325722, "comment_id": 50643650, "body": "How about something like this from a cgo test: <a href=\"https://github.com/golang/go/blob/master/misc/cgo/test/issue8517_windows.go#L18-L31\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/misc/cgo/test/&hellip;</a>? Is there a way I could combine this with <code>os.Getpid()</code> to get the handle count for the currently executing Go program?"}], "owner": {"user_type": "does_not_exist", "display_name": "user2675699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1436467372, "creation_date": 1436467372, "question_id": 31325722, "link": "https://stackoverflow.com/questions/31325722/return-open-files-in-process-in-go-on-windows", "title": "Return Open Files in Process in Go on Windows", "body": "<p>What is the best way to get the number of files open by a process in Go on Windows? I'm trying to avoid using a wrapper around <a href=\"https://technet.microsoft.com/en-us/sysinternals/bb896655.aspx\" rel=\"nofollow\">Handle</a> since it cannot be redistributed. On Linux/Mac, one could use the <code>os/exec</code> package to call the <code>lsof</code> command, but there doesn't seem to be a native <code>lsof</code> equivalent in Windows.</p>\n"}, {"tags": ["go", "error-handling", "try-catch"], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "edited": false, "score": 0, "creation_date": 1436463751, "post_id": 31324550, "comment_id": 50635671, "body": "Thanks. That&#39;s fine if I design my own library. But what if I already use some library? Should I just admit, that the library is poorly designed and fix it by myself?  The problem, is that such code is VERY common in Go world."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "edited": false, "score": 1, "creation_date": 1436463968, "post_id": 31324550, "comment_id": 50635832, "body": "@edio yep, you&#39;re gonna have to get used it. If libraries in C# just threw <code>new Exception(&quot;error string goes here&quot;)</code> then it would be the same situation, the authors just choose to use things like <code>InvaidOperationException</code> instead. Usually people use <code>string.contains</code> to identify errors in Go. It is convention, not enforced, most libraries follow it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1436467968, "post_id": 31324550, "comment_id": 50638145, "body": "See <a href=\"http://stackoverflow.com/a/30178766/55504\">my answer to another question</a> for some more error techniques. IMO if a library/package doesn&#39;t do something sensible for errors it produces (at least the ones that it&#39;s reasonable code may want to check/handle) then its API is at best incomplete and you should file an issue against the library."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1436469222, "post_id": 31324550, "comment_id": 50638819, "body": "Note that in <code>BadCredsError.Error()</code> method you can&#39;t convert <code>e</code> to <code>string</code> as <code>e</code> is a pointer. You have to do: <code>string(*e)</code>."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1436471820, "post_id": 31324550, "comment_id": 50640254, "body": "@icza true. I changed the receiving type. Edio - Ultimately, where the error data is contained doesn&#39;t matter. All that matters is that it&#39;s consistent. Communicating that information with the type itself does nothing to guarantee consistency. If your library has bad errors, you&#39;re stuck. If it doesn&#39;t then you should just get over the notion that you need a different type to identify a different error and do some basic string matching. Honestly, strongly typed errors is just over-engineering to try and compensate for poor/inconsistent developers. They add no real value."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436539382, "post_id": 31324550, "comment_id": 50671251, "body": "@evanmcdonnal &quot;and do some basic string matching&quot;.  Groking around in error strings is fragile and broken. It&#39;s not a sane way to determine the source/reason of an error."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1436471345, "last_edit_date": 1436471345, "creation_date": 1436463490, "answer_id": 31324550, "question_id": 31324477, "link": "https://stackoverflow.com/questions/31324477/finegrained-error-handling-based-on-error-type-in-go/31324550#31324550", "title": "Finegrained error handling based on error type in Go", "body": "<p>Anything implementing this minimal interface is an error;</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n\n<p>The easy solution is;</p>\n\n<pre><code>type BadCredsError string\n\nfunc (e BadCredsError) Error() string {\n      return string(e)\n} \n</code></pre>\n\n<p>Basically, just define your own types and then you can use a type switch or type assertion to determine the specific error types like you see in more OO languages such as C# and Java.</p>\n\n<p>By the way, my sample is like a 2 seconds pseudo code snippet. The go blog discusses far more in depth here; <a href=\"http://blog.golang.org/error-handling-and-go\" rel=\"nofollow\">http://blog.golang.org/error-handling-and-go</a></p>\n"}], "owner": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436471345, "creation_date": 1436463255, "question_id": 31324477, "link": "https://stackoverflow.com/questions/31324477/finegrained-error-handling-based-on-error-type-in-go", "title": "Finegrained error handling based on error type in Go", "body": "<p>TLDR: There is a function in some library, which does something over network and may fail with error. Error may indicate bad input parameter, invalid credentials, network failure... And... I don't know what else. And that's the question.</p>\n\n<p>How do I know, what errors to expect, to handle, say, network failures properly.</p>\n\n<p>Long version:\nIt is a very common way to handle errors like that in Go code</p>\n\n<pre><code>function f0() (v Value, err Error) {\n  v2, err := f3()\n  if err != nil {\n    return\n  }\n\n  v1, err := f2(v2)\n  if err != nil {\n    return\n  }\n\n  v, err = f1(v1)\n  return\n}\n</code></pre>\n\n<p>It is also very common in Go code to not document type of error returned. \nLet's not forget about another common idiom in Go</p>\n\n<pre><code>err = errors.New(\"Boo! I failed\") // returns trivial errorString\n</code></pre>\n\n<p>This leads to the situation where caller of <code>f0()</code> can get dozens of errors (if <code>f3()</code> to <code>f1()</code> in my example also do some calls) which represent conceptually different issues.</p>\n\n<p>How to differentiate between all those errors?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436464058, "post_id": 31324397, "comment_id": 50635878, "body": "Stop treating them as unit tests and just define methods and call those methods since you&#39;re already doing exactly that either way."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 3, "creation_date": 1436464220, "post_id": 31324397, "comment_id": 50635981, "body": "Or maybe just use <code>os&#47;exec</code> to execute <code>go test</code> and capture output."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1436464805, "post_id": 31324397, "comment_id": 50636297, "body": "Or <code>go test</code> and any one of the multitude of available bash commands. Either way, choose the right tool for the job. Clearly you don&#39;t have that right now."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1436466968, "post_id": 31324397, "comment_id": 50637542, "body": "i noticed  <code>go-koans</code> just had a single test that called a number of functions that made assertions and exited: <a href=\"https://github.com/cdarwin/go-koans/blob/master/setup_koans_test.go\" rel=\"nofollow noreferrer\">github.com/cdarwin/go-koans/blob/master/setup_koans_test.go</a> not sure if that&#39;s what you had in mind"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436475209, "post_id": 31324397, "comment_id": 50642120, "body": "take a look at the testing package, it looks like you can run tests from a main entry point but I don&#39;t see the point in that IMO."}, {"owner": {"reputation": 874, "user_id": 1592901, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09688668c0aeac78df901bd5725282dd?s=128&d=identicon&r=PG", "display_name": "jlonganecker", "link": "https://stackoverflow.com/users/1592901/jlonganecker"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436475945, "post_id": 31324397, "comment_id": 50642511, "body": "I think you are right @Not_a_Golfer I am going to have to dig into <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/test.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/cmd/go/test.go</a> and <a href=\"https://github.com/golang/go/tree/master/src/testing\" rel=\"nofollow noreferrer\">github.com/golang/go/tree/master/src/testing</a> and make sense of it. I will share my findings if no one gives a better answer :)"}], "answers": [{"tags": [], "owner": {"reputation": 874, "user_id": 1592901, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09688668c0aeac78df901bd5725282dd?s=128&d=identicon&r=PG", "display_name": "jlonganecker", "link": "https://stackoverflow.com/users/1592901/jlonganecker"}, "is_accepted": true, "score": 1, "last_activity_date": 1437051753, "creation_date": 1437051753, "answer_id": 31454958, "question_id": 31324397, "link": "https://stackoverflow.com/questions/31324397/programmatically-call-go-tests/31454958#31454958", "title": "Programmatically Call go tests", "body": "<p>For now I decided to use exec to parse the output of the command to determine if the test passed or failed.</p>\n\n<p>I am guessing one can look through the source code of some go testing framework like <a href=\"http://goconvey.co/%20%22GoConvey\" rel=\"nofollow\">GoConvey</a> and maybe programmatically call a test and post the results. I will try this sometime in the future when I have more time HA.</p>\n"}], "owner": {"reputation": 874, "user_id": 1592901, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09688668c0aeac78df901bd5725282dd?s=128&d=identicon&r=PG", "display_name": "jlonganecker", "link": "https://stackoverflow.com/users/1592901/jlonganecker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 0, "accepted_answer_id": 31454958, "answer_count": 1, "score": 2, "last_activity_date": 1437051753, "creation_date": 1436462996, "last_edit_date": 1436463897, "question_id": 31324397, "link": "https://stackoverflow.com/questions/31324397/programmatically-call-go-tests", "title": "Programmatically Call go tests", "body": "<p>I want to run specific go tests that send http requests to a server with details on how the tests ran.</p>\n\n<p>Is there a way to programmatically call go test [flags] within a go program?</p>\n\n<p><strong>Super simplified example:</strong></p>\n\n<pre><code>func main() {\n    results := runTests(identifier - packagename or testname)\n    //send post request with results\n}\n</code></pre>\n\n<p>perhaps I need to look into this <a href=\"http://golang.org/pkg/testing/#RunTests\" rel=\"nofollow\">http://golang.org/pkg/testing/#RunTests</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1436460196, "post_id": 31323201, "comment_id": 50633499, "body": "<code>time.Second * time.Duration(1&#47;N)</code> is 0, it should be <code>time.Duration(1e9 &#47; N)</code>"}, {"owner": {"reputation": 16775, "user_id": 442945, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TovHM.png?s=128&g=1", "display_name": "Nathaniel Ford", "link": "https://stackoverflow.com/users/442945/nathaniel-ford"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436460255, "post_id": 31323201, "comment_id": 50633536, "body": "Ah, good point! I&#39;m pretty new to Go: my apologies. Thank you for the pointer!"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1436460979, "post_id": 31323201, "comment_id": 50634013, "body": "Sorry, you&#39;ve got it wrong again. Please read the docs ;) <code>time.Duration(1)</code> is 1 nano second. In the second example it should be <code>time.Sleep(time.Second)</code>"}, {"owner": {"reputation": 16775, "user_id": 442945, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TovHM.png?s=128&g=1", "display_name": "Nathaniel Ford", "link": "https://stackoverflow.com/users/442945/nathaniel-ford"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1436461044, "post_id": 31323201, "comment_id": 50634048, "body": "I think I caught that already: I realized pretty fast that edit was erroneous. :)"}, {"owner": {"reputation": 45401, "user_id": 20481, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc41c338d8a89f8cec603f65f6fd0c89?s=128&d=identicon&r=PG", "display_name": "plinth", "link": "https://stackoverflow.com/users/20481/plinth"}, "edited": false, "score": 0, "creation_date": 1436461264, "post_id": 31323201, "comment_id": 50634194, "body": "I think you want to measure the amount of time &quot;Do something&quot; takes and sleep for 1/30s - that time, otherwise, your overall frequency is guaranteed to be less than 30Hz."}, {"owner": {"reputation": 16775, "user_id": 442945, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TovHM.png?s=128&g=1", "display_name": "Nathaniel Ford", "link": "https://stackoverflow.com/users/442945/nathaniel-ford"}, "edited": false, "score": 0, "creation_date": 1436462170, "post_id": 31323201, "comment_id": 50634742, "body": "I assumed that tuning was beyond the scope of the question. Certainly it&#39;s not specified if it needs to happen &#39;about&#39; 30 times a second, exactly 30 times a second (nearly impossible) or &#39;at least&#39; 30 times a second."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436467519, "post_id": 31323201, "comment_id": 50637871, "body": "@NathanielFord it&#39;s not nearly impossible (to get <i>extremely</i> close to 30 times a second), it&#39;s trivially easy with a <code>time.Ticker</code>. See my answer."}], "tags": [], "owner": {"reputation": 16775, "user_id": 442945, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TovHM.png?s=128&g=1", "display_name": "Nathaniel Ford", "link": "https://stackoverflow.com/users/442945/nathaniel-ford"}, "is_accepted": true, "score": 5, "last_activity_date": 1436461066, "last_edit_date": 1436461066, "creation_date": 1436459234, "answer_id": 31323201, "question_id": 31323118, "link": "https://stackoverflow.com/questions/31323118/how-to-repeat-the-function-n-times-per-second/31323201#31323201", "title": "How to repeat the function N times per second?", "body": "<p>There are two options, neither will get you a guaranteed x times per second.</p>\n\n<ul>\n<li>Set N not to <code>30</code> but <code>1/30</code>. Thus the sleep will be for 1/30th of a second.</li>\n<li>Have an internal for-loop that loops 30 times and executes your 'do something', and then on exit you hit the statement that sleeps for a second.</li>\n</ul>\n\n<p>Option One:</p>\n\n<pre><code>N := 30 //Repeat 30 times per second\nfor {\n    //Do something\n    time.Sleep(time.Duration(1e9 / N))  //time.second constant unnecessary (see kostya comments)\n}\n</code></pre>\n\n<p>Option Two:</p>\n\n<pre><code>N := 1  //Sleep duration of one second\nfor {\n    for i := 1;  i&lt;=30; i++ {\n        //Do something\n    }\n    time.Sleep(time.Second * time.Duration(N))\n}\n</code></pre>\n\n<p>Note that in option two, everything happens all at once, and then you wait a second. The first option will space out the do something across the second. Because of timing in computers this won't be precise: sleep cannot guarantee it will wake up precisely when you expect.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1436467190, "post_id": 31325584, "comment_id": 50637667, "body": "Note that this works correctly no matter if the operation takes &lt;1 nanosecond or 33 milliseconds or anywhere in between. (Except that <code>time.Second</code> doesn&#39;t exactly divide into 30 so it&#39;ll do ~30.0000003/sec)."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 4, "last_activity_date": 1436466961, "creation_date": 1436466961, "answer_id": 31325584, "question_id": 31323118, "link": "https://stackoverflow.com/questions/31323118/how-to-repeat-the-function-n-times-per-second/31325584#31325584", "title": "How to repeat the function N times per second?", "body": "<p>You can use a <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow\"><code>time.Ticker</code></a> to handle all the book-keeping for you. The only \"issue\" is that if your operation takes longer than expected you'll loose ticks (and thus run fewer than N per second).</p>\n\n<pre><code>func doSomething() {\n    const N = 30\n    ticker := time.NewTicker(time.Second / N)\n    for range ticker.C {\n        fmt.Println(\"Do anything that takes no longer than 1/Nth of a second\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Gq-tWMvxIk\" rel=\"nofollow\">https://play.golang.org/p/Gq-tWMvxIk</a></p>\n"}], "owner": {"reputation": 153, "user_id": 4489257, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/755572e35afde5bf222b3096a3b9d36b?s=128&d=identicon&r=PG&f=1", "display_name": "Maxim Lis", "link": "https://stackoverflow.com/users/4489257/maxim-lis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1154, "favorite_count": 1, "accepted_answer_id": 31323201, "answer_count": 2, "score": 4, "last_activity_date": 1436466961, "creation_date": 1436459017, "question_id": 31323118, "link": "https://stackoverflow.com/questions/31323118/how-to-repeat-the-function-n-times-per-second", "title": "How to repeat the function N times per second?", "body": "<p>How to repeat the function N times per second in Go?</p>\n\n<p>I can:</p>\n\n<pre><code>N := 30 //Repeat 30 times per second\nfor {\n    //Do something\n    time.Sleep(time.Second * time.Duration(N))\n}\n</code></pre>\n\n<p>But that just makes the intervals between repetitions</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1436459861, "post_id": 31323298, "comment_id": 50633287, "body": "What is the correct way to deal with JSON&#39;s which are really dynamic?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 2, "creation_date": 1436461155, "post_id": 31323298, "comment_id": 50634126, "body": "@Thellimist <code>map[string]interface{}</code> is probably the most popular way. Personally I&#39;ve always avoided dynamic forms of unmarshalling. I&#39;m pretty confident in saying no json is &#39;really dynamic&#39;. There is always a schema, it just may be flexible. Reflection is never necessary in your code, only in the actual unmarshaller (in this case encoding/json but that same is true of other libraries in Go and other languages). Also, if the json is variant I can try <code>TypeA</code> then <code>B</code> then <code>C</code> to exhaust possible schemas, worst case I would do that. Get my errors out of the way up front."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1436459466, "creation_date": 1436459466, "answer_id": 31323298, "question_id": 31323087, "link": "https://stackoverflow.com/questions/31323087/golang-cant-reflect-to-mapinterfaceinterface/31323298#31323298", "title": "golang can&#39;t reflect to map[interface{}]interface{}", "body": "<p><code>content, err := i.(map[interface{}]interface{})</code>, this isn't a cast, it's a type assertion. You're saying (asserting) that interface is of type <code>map[interface{}]interface{}</code>, it's not. It's of type <code>map[string][]string</code>. You get <code>null</code> as the value because it fails. I highly doubt <code>error</code> is false.</p>\n\n<p>Are you thinking too generic? Of course you are. I can't think of any reason why the collections type needs to change... Append what you want to it, write it to your db. There's nothing preventing that afaik?</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 31323298, "answer_count": 1, "score": -1, "last_activity_date": 1436459466, "creation_date": 1436458940, "question_id": 31323087, "link": "https://stackoverflow.com/questions/31323087/golang-cant-reflect-to-mapinterfaceinterface", "title": "golang can&#39;t reflect to map[interface{}]interface{}", "body": "<p>My original problem is I want to parse <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow\">URL.Values</a> to a generic type (map[interface{}]interface{}) edit/add some values then convert it to JSON string and put it to PostgreSQL JSON column.</p>\n\n<p>I tried this code to parse it but <code>content</code> seems to be null whereas <code>err</code> is false. <code>request.URL.Query()</code> prints a nice map object.</p>\n\n<pre><code>v := reflect.ValueOf(request.URL.Query())\ni := v.Interface()\ncontent, err := i.(map[interface{}]interface{})\n\n// Do some operations\n\njsonString, _ := json.Marshal(content)\n\n// Add to DB\n</code></pre>\n\n<p>Why is it null? Also am I thinking too generic? </p>\n"}, {"tags": ["go", "martini", "gorp"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 5, "last_activity_date": 1436458932, "creation_date": 1436458932, "answer_id": 31323084, "question_id": 31322945, "link": "https://stackoverflow.com/questions/31322945/golang-gorp-insert-panic/31323084#31323084", "title": "golang gorp insert panic", "body": "<p>This error; <code>reflect.Value.Interface: cannot return value obtained from unexported field or method</code> is most likey due to <code>status   int64</code> being unexported (at least I see no other unexported fields that could cause it). The fix is as simple as upper casing <code>Status</code>.</p>\n\n<p>In Go, fields on a struct with upper cased names are exported while those with lower case names are not. An unexported field is the nearest thing the language has to a 'private' field. In this case, gorp or whatever threw the error has reflected your type, found the status field and attempted to return it which is when you errored because the field is unexported.</p>\n"}], "owner": {"reputation": 68, "user_id": 4806291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91628882bb0152f3402bfa7a48dbc050?s=128&d=identicon&r=PG&f=1", "display_name": "jen6", "link": "https://stackoverflow.com/users/4806291/jen6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 0, "accepted_answer_id": 31323084, "answer_count": 1, "score": 2, "last_activity_date": 1436458932, "creation_date": 1436458574, "question_id": 31322945, "link": "https://stackoverflow.com/questions/31322945/golang-gorp-insert-panic", "title": "golang gorp insert panic", "body": "<p>Hi I'm using gorp and mysql.\nwhen insert struct gorp return </p>\n\n<p>reflect.Value.Interface: cannot return value obtained from unexported field or method</p>\n\n<p>In gorp docs says <code>Panics if any interface in the list has not been registered with AddTable</code>but I added this struct</p>\n\n<p>Is this problem BUS struct has method?? My program and i panic help me</p>\n\n<pre><code> type BUS struct {\n        Id       int64    `db:\"Idx\"`\n        Created  int64\n        Writer   string    `db:\"Writer\"`\n        WriterId int64\n        Title    string    `db:\"Title\"`\n        Content  string    `db:\"Content\"`\n        Want     int64\n        status   int64\n    }\nfunc (b BUS) search(bf Board_find) []BUS {\n    var arr []BUS\n    query, query_map := bf.Prepare()\n    _, err := dbmap.Select(&amp;arr, query, query_map)\n    if err != nil {\n        log.Print(err)\n    }\n    return arr\n}\n\nfunc (b* BUS) write() {\n    log.Print(reflect.TypeOf(b)) //just test code\n    err := dbmap.Insert(b)\n    check_err(err, \"error in bus write\")\n}\n\n\nfunc make_dbmap() *gorp.DbMap {\n    db, err := sql.Open(\"mysql\", \"tester:tester@tcp(127.0.0.1:3306)/TEST\")\n    check_err(err, \"db connection error\")\n    log.Println(\"db connection Ok\")\n\n    dialect := gorp.MySQLDialect{\"InnoDB\", \"UTF8\"}\n    dbmap := &amp;gorp.DbMap{Db: db, Dialect: dialect}\n\n    AddTable(dbmap, USER_DB{}, \"USER\")\n    table := AddTable(dbmap, BUS{}, \"BUSBOARD\")\n    table.ColMap(\"Writer\").SetMaxSize(10)\n    table.ColMap(\"Title\").SetMaxSize(25)\n    table.ColMap(\"Content\").SetMaxSize(50)\n    log.Println(\"Add Table in gorp Ok\")\n    return dbmap\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1436458401, "last_edit_date": 1436458401, "creation_date": 1436458029, "answer_id": 31322761, "question_id": 31322541, "link": "https://stackoverflow.com/questions/31322541/how-do-i-make-an-interface-that-just-allows-integers/31322761#31322761", "title": "How do I make an Interface that just allows integers?", "body": "<blockquote>\n  <p>How do I guarantee that my argument is an integer, while still allowing integer aliases?</p>\n</blockquote>\n\n<p>You rely on type conversion. </p>\n\n<pre><code>func MyFunc(arg int) {\n    fmt.Println(arg)\n}\n\ntype Token int\nvar t Token\nt = 3\nMyFunc(int(t))\n\ns := \"This is a string, obviously\"\nMyFunc(int(s)) // throws a compiler error\n</code></pre>\n\n<p>There's really no need to define an interface for just the type <code>int</code> because you can rely on the languages type conversion behavior to enforce compile time type safety in these types of scenarios.</p>\n\n<p>One thing to note is this is slightly more accepting than an int only interface would be. For example, an <code>int64</code> will convert to a <code>int</code>, even a <code>float</code> will using typical rounding conventions. Invalid conversions will produce the following error; <code>cannot convert s (type string) to type int</code>. From what I can tell only native numeric types or aliases for them will convert.</p>\n"}], "owner": {"reputation": 1020, "user_id": 2752850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e7ea3ae5dd4eb7dea7aa992aa970287?s=128&d=identicon&r=PG", "display_name": "Kites", "link": "https://stackoverflow.com/users/2752850/kites"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 31322761, "answer_count": 1, "score": 1, "last_activity_date": 1436458401, "creation_date": 1436457333, "question_id": 31322541, "link": "https://stackoverflow.com/questions/31322541/how-do-i-make-an-interface-that-just-allows-integers", "title": "How do I make an Interface that just allows integers?", "body": "<p>I want to make a function that can take any int-like variable.</p>\n\n<p>For example: </p>\n\n<pre><code>type IntegerType interface {\n    int \n}\n\nfunc MyFunc(arg IntegerType) {\n    fmt.Println(arg)\n}\n</code></pre>\n\n<p>This won't compile because I can't base interface inheritance on a non-interface type, but that's exactly what I want to do!</p>\n\n<p>The end goal is this:</p>\n\n<pre><code>type Token int\nvar t Token\nt = 3\nMyFunc(t)\n</code></pre>\n\n<p>How do I guarantee that my argument is an integer, while still allowing integer aliases?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": false, "score": 3, "last_activity_date": 1436458264, "creation_date": 1436458264, "answer_id": 31322837, "question_id": 31321805, "link": "https://stackoverflow.com/questions/31321805/make-all-properties-lower-case-or-upper-case-using-reflect/31322837#31322837", "title": "Make all properties lower case or upper case using reflect?", "body": "<p>It will be <code>map[string]interface{}</code> so go over it and simply convert keys to lowercase.</p>\n\n<pre><code>var f map[string]interface{}\n...\n\nconverted := make(map[string]interface{}, len(f))\nfor k, v := range f {\n    converted[strings.ToLower(k)] = v\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 231, "user_id": 1864039, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0900dcec393ae1c13b1f3e461b270e84?s=128&d=identicon&r=PG", "display_name": "borrel", "link": "https://stackoverflow.com/users/1864039/borrel"}, "edited": false, "score": 0, "creation_date": 1521802673, "post_id": 31322926, "comment_id": 85897845, "body": "In the second case, you would want to recursively iterate over the map value as well:  <code>for k, v := range f { lf[strings.ToLower(k)] = lower(v) }</code>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1521830962, "last_edit_date": 1521830962, "creation_date": 1436458524, "answer_id": 31322926, "question_id": 31321805, "link": "https://stackoverflow.com/questions/31321805/make-all-properties-lower-case-or-upper-case-using-reflect/31322926#31322926", "title": "Make all properties lower case or upper case using reflect?", "body": "<p>Here's one way to do it:</p>\n\n<pre><code>var f interface{}\nerr := json.Unmarshal(b, &amp;f)\nf = lower(f)\n</code></pre>\n\n<p>where lower is:</p>\n\n<pre><code>func lower(f interface{}) interface{} {\n  switch f := f.(type) {\n  case []interface{}:\n    for i := range f {\n        f[i] = lower(f[i])\n    }\n    return f\n  case map[string]interface{}:\n    lf := make(map[string]interface{}, len(f))\n    for k, v := range f {\n        lf[strings.ToLower(k)] = lower(v)\n    }\n    return lf\n  default:\n    return f\n  }\n}\n</code></pre>\n\n<p>The function <code>lower</code> is recursive to handle key conversion for nested JSON objects.</p>\n\n<p><a href=\"http://play.golang.org/p/hRdnBryEAG\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>If you know that you are working with an object without nesting, then you can inline the map case from <code>lower</code>:</p>\n\n<pre><code>var f map[string]interface{}\nerr := json.Unmarshal(b, &amp;f)\nlf := make(map[string]interface{}, len(f))\nfor k, v := range f {\n    lf[strings.ToLower(k)] = v\n}\nf = lf\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 5011492, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206978012152158/picture?type=large", "display_name": "Black Obama", "link": "https://stackoverflow.com/users/5011492/black-obama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1241, "favorite_count": 0, "accepted_answer_id": 31322926, "answer_count": 2, "score": 0, "last_activity_date": 1521830962, "creation_date": 1436455466, "question_id": 31321805, "link": "https://stackoverflow.com/questions/31321805/make-all-properties-lower-case-or-upper-case-using-reflect", "title": "Make all properties lower case or upper case using reflect?", "body": "<p>I am receiving unknown json from client and I parse to interface like </p>\n\n<pre><code>var f interface{}\nerr := json.Unmarshal(b, &amp;f)\n</code></pre>\n\n<p>How to make all keys in f to be lower keys ?\nI have to save this f to mongo and I need to make some queries but I want to avoid mistake if somebody send uppercase same json.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1436452378, "post_id": 31320334, "comment_id": 50628135, "body": "Are all your structures identical?"}, {"owner": {"reputation": 225, "user_id": 834875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd5d410288881f37e01491c48c1a6709?s=128&d=identicon&r=PG&f=1", "display_name": "desarrolla2", "link": "https://stackoverflow.com/users/834875/desarrolla2"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1436452505, "post_id": 31320334, "comment_id": 50628247, "body": "not,  i only simplify it for the example, they have common structure but have different fields too."}], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 1, "last_activity_date": 1436452829, "creation_date": 1436452829, "answer_id": 31320780, "question_id": 31320334, "link": "https://stackoverflow.com/questions/31320334/how-pass-different-structures-to-function/31320780#31320780", "title": "How pass different structures to function?", "body": "<p><em>Your code example is somewhat confusing since both structs appear to be identical. I'll assume that they differ somewhere in \"others\".</em></p>\n\n<p>First, I generally recommend creating a wrapper around these kinds of JSON deserializations. Working directly on the JSON structure is fragile. Most of your program should not be aware of the fact that the data comes down in JSON. So for instance, you can wrap this in an <code>Ads</code> struct that contains an <code>AdsResponse</code>, or just copies the pieces it cares about out of it. Doing that will also make some of the below slightly easier to implement and less fragile.</p>\n\n<p>The most common solution is probably to create an interface:</p>\n\n<pre><code>type Response interface {\n    ID() int\n}\n</code></pre>\n\n<p>You make both <code>Ads</code> and <code>Others</code> conform to <code>Response</code>. Then you can return <code>Response</code>. If necessary, you can type-switch later to figure out which one you have and unload other data.</p>\n\n<pre><code>switch response := response.(type) {\ncase Ads:\n    ...\ncase Other:\n    ...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1436453095, "post_id": 31320839, "comment_id": 50628727, "body": "This is a particularly nice approach if the caller of <code>Get()</code> knows what response it expects, which may be correct in this case. If not, this will fail (which is a feature or a bug depending on the use case)."}, {"owner": {"reputation": 608, "user_id": 2742953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b6440a8ea0b00a8259b04bef0d57881?s=128&d=identicon&r=PG", "display_name": "Gerard Abello", "link": "https://stackoverflow.com/users/2742953/gerard-abello"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1436453236, "post_id": 31320839, "comment_id": 50628821, "body": "You are right. I guessed he is using some kind of API and he expects a specific structure from each url."}], "tags": [], "owner": {"reputation": 608, "user_id": 2742953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b6440a8ea0b00a8259b04bef0d57881?s=128&d=identicon&r=PG", "display_name": "Gerard Abello", "link": "https://stackoverflow.com/users/2742953/gerard-abello"}, "is_accepted": false, "score": 1, "last_activity_date": 1436453137, "last_edit_date": 1436453137, "creation_date": 1436452961, "answer_id": 31320839, "question_id": 31320334, "link": "https://stackoverflow.com/questions/31320334/how-pass-different-structures-to-function/31320839#31320839", "title": "How pass different structures to function?", "body": "<p>I don't quite get why you have the reponse as a parameter and as a return. I think you dont need to return it. You should pass a pointer to the reponse and fill it with the data. Also, I'd return an Error instead of a boolean, but that is another topic.</p>\n\n<p>Anyway, the solution is to use interface{} (empty interface).</p>\n\n<p>You are lucky because the function you are using (FromJsonTo) accepts an empty interface as a parameter, so you can safely change your parameter type to interface{} and just pass it to FromJsonTo. Like this:</p>\n\n<pre><code>func Get(url string, response interface{}) bool {\n\n    res, err := goreq.Request{\n        Uri:         url,\n    }.Do()\n\n    // several validations\n\n    res.Body.FromJsonTo(response)\n\n    return true\n}\n</code></pre>\n\n<p>Warning: I did not compile the code.</p>\n\n<p>Then you would call this function with the url and a pointer to one of the reponse structs like this:</p>\n\n<pre><code>var struct1 AdsResponse\nvar struct2 OtherResponse\n\nGet(\"someURL\", &amp;struct1)\nGet(\"someURL\", &amp;struct2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "is_accepted": false, "score": 0, "last_activity_date": 1436461997, "last_edit_date": 1436461997, "creation_date": 1436458684, "answer_id": 31322984, "question_id": 31320334, "link": "https://stackoverflow.com/questions/31320334/how-pass-different-structures-to-function/31322984#31322984", "title": "How pass different structures to function?", "body": "<p>Follow the solution working <a href=\"http://play.golang.org/p/wSTnM_R6pI\" rel=\"nofollow\">at Go Playground</a></p>\n\n<p>Go has no polymorphic or any other OO like behaviour, so, when you try to pass a AdsResponse or OtherResponse struct as an Response (or any interface{}), these values becomes an Response (or other param type specified), and is not possible to Go to infer the real type that originate these interface{} and correctly decode your json to these struct types as expected.</p>\n\n<p>This kind of thing should works perfectly in OO languages, like Java, C# etc. There is no hierarchy generalization/specialization on structs/interfaces in Go.</p>\n\n<p>You would need to do a type assertion in your Rest executor, or a switch case, but it seems that you need a generic REST executor, like a generic lib some thing like that. Would not reasonable create a switch case for each struct in your program. Maybe you have dozens or hundreds of structs soon.</p>\n\n<p>I think that a reasonable solution is the rest client pass a lambda function to do the last step for your, that is just create a correct struct destination type and call json decode.</p>\n\n<p>As i say above, the return type of executeRest() in my example will became an interface{}, but the rest client can securely do the type assertion of returned value after executeRest() call.</p>\n"}, {"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": false, "score": 0, "last_activity_date": 1436459966, "creation_date": 1436459966, "answer_id": 31323489, "question_id": 31320334, "link": "https://stackoverflow.com/questions/31320334/how-pass-different-structures-to-function/31323489#31323489", "title": "How pass different structures to function?", "body": "<p>The way to achieve this is through Go's <a href=\"https://golang.org/doc/effective_go.html#interfaces\" rel=\"nofollow\">interfaces</a>. </p>\n\n<p>Two options:</p>\n\n<p><strong>empty interface</strong></p>\n\n<pre><code>Get(url string, response interface{}) (Response, bool)\n</code></pre>\n\n<p>This option allows any value to be given to this function. </p>\n\n<p><strong>custom interface</strong></p>\n\n<p>Creating a custom interface will allow you to narrow down the types that can be provided as arguments to your function.</p>\n\n<p>In this case you'll have to create an interface that all your Response structs will need to abide by. Any struct really that abides by that interface will be able to be used as an argument of your function. </p>\n\n<p>Something like this:</p>\n\n<pre><code>type MyResponse interface {\n    SomeFunction()\n} \n</code></pre>\n\n<p>Then your function signature could look like </p>\n\n<pre><code>Get(url string, response MyResponse) (MyResponse, bool)\n</code></pre>\n\n<p>As long as <code>AdsResponse</code> and <code>OtherResponse</code> abide by the <code>MyResponse</code> interface, they will be allowed to be used as arguments to the function.</p>\n"}], "owner": {"reputation": 225, "user_id": 834875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd5d410288881f37e01491c48c1a6709?s=128&d=identicon&r=PG&f=1", "display_name": "desarrolla2", "link": "https://stackoverflow.com/users/834875/desarrolla2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1488382623, "creation_date": 1436451780, "last_edit_date": 1488382623, "question_id": 31320334, "link": "https://stackoverflow.com/questions/31320334/how-pass-different-structures-to-function", "title": "How pass different structures to function?", "body": "<p>I have several different structures.</p>\n\n<p>Here show two:</p>\n\n<pre><code>type AdsResponse struct {\n    Body struct {\n        Docs []struct {\n            ID        int  `json:\"ID\"`\n            // others\n\n        } `json:\"docs\"`\n    } `json:\"response\"`\n    Header `json:\"responseHeader\"`\n}\n\ntype OtherResponse struct {\n    Body struct {\n        Docs []struct {\n            ID    int     `json:\"ID\"`\n            // others\n        } `json:\"docs\"`\n    } `json:\"response\"`\n    Header `json:\"responseHeader\"`\n}\n</code></pre>\n\n<p>but i don't know how i can do for this method accepts and return both.</p>\n\n<pre><code>func Get(url string, response Response) (Response, bool) {\n\n    res, err := goreq.Request{\n        Uri:         url,\n    }.Do()\n\n    // several validations\n\n    res.Body.FromJsonTo(&amp;response)\n\n    return response, true\n}\n</code></pre>\n\n<p>And use like this:</p>\n\n<pre><code>var struct1 AdsResponse\nvar struct2 OtherResponse\n\nGet(\"someURL\", struct1)\nGet(\"someURL\", struct2)\n</code></pre>\n\n<p>There are any form?</p>\n"}, {"tags": ["concurrency", "go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1436452263, "post_id": 31319894, "comment_id": 50628050, "body": "Your workers <code>return</code> (stop working) on error. Could it be the problem that  sooner or later they all run into an error, leaving no worker alive? Also, does your program block giving the workers enough time to finish or does main exit before all work can be completed?"}, {"owner": {"reputation": 10901, "user_id": 427992, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/MGeAO.jpg?s=128&g=1", "display_name": "hohner", "link": "https://stackoverflow.com/users/427992/hohner"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1436452433, "post_id": 31319894, "comment_id": 50628188, "body": "Hmm, but if every worker died through that <code>return</code> statement, surely you&#39;d see <code>Error:</code> in the output? In terms of when the program block exits, I thought it automatically finished when the <code>paths</code> channel was empty - is that not right?"}], "answers": [{"comments": [{"owner": {"reputation": 10901, "user_id": 427992, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/MGeAO.jpg?s=128&g=1", "display_name": "hohner", "link": "https://stackoverflow.com/users/427992/hohner"}, "edited": false, "score": 0, "creation_date": 1436453501, "post_id": 31320856, "comment_id": 50629029, "body": "If I want it to block only until the <code>paths</code> channel is empty, how would I do that?"}, {"owner": {"reputation": 10901, "user_id": 427992, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/MGeAO.jpg?s=128&g=1", "display_name": "hohner", "link": "https://stackoverflow.com/users/427992/hohner"}, "edited": false, "score": 1, "creation_date": 1436453659, "post_id": 31320856, "comment_id": 50629163, "body": "I figured it - just use <code>sync.WaitGroup</code>. Thanks for the pointer!"}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 1, "last_activity_date": 1436453034, "creation_date": 1436453034, "answer_id": 31320856, "question_id": 31319894, "link": "https://stackoverflow.com/questions/31319894/processing-a-channel-concurrently-results-in-unexpected-output/31320856#31320856", "title": "Processing a channel concurrently results in unexpected output", "body": "<p>The problem is that after this line:</p>\n\n<pre><code>filepath.Walk(\"/tmp/foo\", walkFn)\n</code></pre>\n\n<p>All paths have been sent through the <code>paths</code> channel, this implies that someone received them. However, it does not imply that those receiving goroutines have finished completely.</p>\n\n<p>So when your program exits after <code>close(paths)</code>, there are still goroutines working and they get killed because <code>main</code> is finished.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow\">https://golang.org/ref/spec#Program_execution</a></p>\n\n<blockquote>\n  <p>Program execution begins by initializing the main package and then invoking the function main. When that function invocation returns, the program exits. <strong>It does not wait for other (non-main) goroutines to complete.</strong></p>\n</blockquote>\n\n<p>One simple solution is to add</p>\n\n<pre><code>select{}\n</code></pre>\n\n<p>at the end of your program. This will make it block forever.</p>\n"}], "owner": {"reputation": 10901, "user_id": 427992, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/MGeAO.jpg?s=128&g=1", "display_name": "hohner", "link": "https://stackoverflow.com/users/427992/hohner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 31320856, "answer_count": 1, "score": 0, "last_activity_date": 1436453034, "creation_date": 1436450712, "last_edit_date": 1436451112, "question_id": 31319894, "link": "https://stackoverflow.com/questions/31319894/processing-a-channel-concurrently-results-in-unexpected-output", "title": "Processing a channel concurrently results in unexpected output", "body": "<p>I have an unbuffered channel that <code>i</code> amount of workers take a value from (a filesystem path) and process it (send the file contents over HTTP). I'm running into problem when I increase <code>i</code>.</p>\n\n<p>When I run this:</p>\n\n<pre><code>paths := make(chan string)\n\nfor i := 0; i &lt; 5; i++ {\n    go func() {\n        for path := range paths {\n            fmt.Println(path)\n        }\n    }()\n}\n\nwalkFn := func(path string, info os.FileInfo, err error) error {\n    if !info.IsDir() {\n        paths &lt;- path\n    }\n    return nil\n}\n\nfilepath.Walk(\"/tmp/foo\", walkFn)\nclose(paths)\n</code></pre>\n\n<p>It works expectedly and outputs all the contents of <code>/tmp/foo</code>:</p>\n\n<pre><code>/tmp/foo/2\n/tmp/foo/file9\n/tmp/foo/file91\n/tmp/foo/file90\n/tmp/foo/file900\n/tmp/foo/file901\n/tmp/foo/file902\n/tmp/foo/file92\n/tmp/foo/file97\n/tmp/foo/file93\n/tmp/foo/file94\n/tmp/foo/file95\n/tmp/foo/file96\n/tmp/foo/file98\n/tmp/foo/file99\n</code></pre>\n\n<p>But when I send the file contents over HTTP, the number of affected files suddenly goes down:</p>\n\n<pre><code>for i := 0; i &lt; 5; i++ {\n    go func() {\n        for path := range paths {\n            resp, err := http.Head(\"https://example.com/\" + strings.TrimPrefix(path, rootDir+\"/\"))\n            if err != nil {\n                fmt.Printf(\"Error: %s\\n\", err)\n                return\n            }\n\n            fmt.Printf(\"%s: %s\\n\", path, resp.Status)\n        }\n    }()\n}\n</code></pre>\n\n<p>the number of affected files reduces from 15 (which is how many exist in the directory), down to 10:</p>\n\n<pre><code>/tmp/foo/2: 404 Not Found\n/tmp/foo/file901: 404 Not Found\n/tmp/foo/file900: 404 Not Found\n/tmp/foo/file9: 404 Not Found\n/tmp/foo/file90: 404 Not Found\n/tmp/foo/file902: 404 Not Found\n/tmp/foo/file91: 404 Not Found\n/tmp/foo/file92: 404 Not Found\n/tmp/foo/file93: 404 Not Found\n/tmp/foo/file94: 404 Not Found\n</code></pre>\n\n<p>Here's a table that relates the value of <code>i</code> to the number of output lines:</p>\n\n<pre><code>+-----+-------+\n| `i` | lines |\n+-----+-------+\n| 1   | 15    |\n| 5   | 10    |\n| 6   | 9     |\n| 15  | 0     |\n+-----+-------+\n</code></pre>\n\n<p>Why does this happen and how can I process <em>all</em> the channel entries concurrently? Is it a problem with <code>http</code> requests?</p>\n"}, {"tags": ["go", "thrift"], "answers": [{"comments": [{"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1436487955, "post_id": 31321066, "comment_id": 50646630, "body": "Appreciate your patch proposal."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1436541382, "post_id": 31321066, "comment_id": 50672661, "body": "@JensG I&#39;m assuming this is sarcastic, but I would be glad to document this stuff, where would you recommend to do it?"}, {"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1436556945, "post_id": 31321066, "comment_id": 50681092, "body": "Not more than <i>Bah</i> ;-) A good place is the <a href=\"https://thrift.apache.org/lib/go\" rel=\"nofollow noreferrer\">language-specific README</a> which can be found in the normal repo under <a href=\"http://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=lib/go/README.md;hb=HEAD\" rel=\"nofollow noreferrer\"><code>&#47;lib&#47;go&#47;README.md</code></a>. We accept <a href=\"http://thrift.apache.org/docs/HowToContribute\" rel=\"nofollow noreferrer\">patches and pull requests</a> - thank you!"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1436565272, "post_id": 31321066, "comment_id": 50684806, "body": "Will do. Oh, and I&#39;ve already contributed a couple of patches to thrift :)"}, {"owner": {"reputation": 326, "user_id": 4241695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29508bab236e6635078f43391a96c5e2?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Artoul", "link": "https://stackoverflow.com/users/4241695/richard-artoul"}, "edited": false, "score": 0, "creation_date": 1469223580, "post_id": 31321066, "comment_id": 64464949, "body": "Did you make a pull request Not_a_Golfer? I ran into the same issue you did, and I didn&#39;t see any documentation in the readme so I made this pull request: <a href=\"https://github.com/apache/thrift/pull/1053\" rel=\"nofollow noreferrer\">github.com/apache/thrift/pull/1053</a>"}, {"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1481331528, "post_id": 31321066, "comment_id": 69349126, "body": "PR merged to master."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1436453546, "creation_date": 1436453546, "answer_id": 31321066, "question_id": 31319534, "link": "https://stackoverflow.com/questions/31319534/control-golang-annotations-in-thrift-generated-code/31321066#31321066", "title": "Control golang annotations in thrift generated code", "body": "<p>Scratch my previous answer - it's undocumented, but it IS possible, I found it by reading the compiler code. <em>Bah</em>.  </p>\n\n<p>But anyway, in thrift's master (1.0-dev), here's how it's done - using a <code>go.tag</code> annotation.</p>\n\n<p>This piece of thrift code:</p>\n\n<pre><code>struct foo {\n  1: string bar (go.tag = \"json:\\\"baz\\\" yo:\\\"dawg\\\"\"),\n  2: string bang\n}\n</code></pre>\n\n<p>Generates the following Go code:</p>\n\n<pre><code>type Foo struct {\n        Bar  string `thrift:\"bar,1\" json:\"baz\" yo:\"dawg\"`\n        Bang string `thrift:\"bang,2\" json:\"bang\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 10611, "user_id": 973810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fc35612d4cb8ba65f31a6d028bcf138e?s=128&d=identicon&r=PG", "display_name": "Darth Egregious", "link": "https://stackoverflow.com/users/973810/darth-egregious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 1, "accepted_answer_id": 31321066, "answer_count": 1, "score": 4, "last_activity_date": 1436453546, "creation_date": 1436449775, "question_id": 31319534, "link": "https://stackoverflow.com/questions/31319534/control-golang-annotations-in-thrift-generated-code", "title": "Control golang annotations in thrift generated code", "body": "<p>I have a message from thrift that I would like to be able to serialize into and out of json, but I don't want the generated json keys to match what is in the generated go code.</p>\n\n<p>Is there a way to control what annotations are attached to the struct in the go code that thrift generates?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1436437634, "post_id": 31314614, "comment_id": 50617232, "body": "<a href=\"https://github.com/mgutz/dat\" rel=\"nofollow noreferrer\">github.com/mgutz/dat</a> can use Redis as a query cache, but I would strongly dig into whether you can optimize those queries. You may have tried some of this already (?) but denormalising tables, better indexes, etc are going to be better long-term. Using Redis may not be a silver bullet."}], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1436452202, "post_id": 31314699, "comment_id": 50628001, "body": "Beware of it for MySQL caching, as it has no built in invalidation mechanism. Things are just cached forever, it&#39;s just a distributed LRU. It doesn&#39;t even have expiration. You can achieve it by key manipulation, but it&#39;s not trivial."}], "tags": [], "owner": {"reputation": 1803, "user_id": 3531912, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/Qh3Y8.png?s=128&g=1", "display_name": "Alessandro Suglia", "link": "https://stackoverflow.com/users/3531912/alessandro-suglia"}, "is_accepted": true, "score": 2, "last_activity_date": 1436437434, "creation_date": 1436437434, "answer_id": 31314699, "question_id": 31314614, "link": "https://stackoverflow.com/questions/31314614/mysql-caching-with-go/31314699#31314699", "title": "MySQL caching with GO", "body": "<p>Apparently exists this well done caching library developed directly by the golang team: <a href=\"https://github.com/golang/groupcache\" rel=\"nofollow\">groupcache</a></p>\n"}], "owner": {"reputation": 261, "user_id": 2636324, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/639550655/picture?type=large", "display_name": "Aaron Kenny", "link": "https://stackoverflow.com/users/2636324/aaron-kenny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2024, "favorite_count": 1, "accepted_answer_id": 31314699, "answer_count": 1, "score": 1, "last_activity_date": 1445875476, "creation_date": 1436437204, "question_id": 31314614, "link": "https://stackoverflow.com/questions/31314614/mysql-caching-with-go", "title": "MySQL caching with GO", "body": "<p>I have a Go app which runs queries with lots of joins (using a legacy DB).</p>\n\n<p>Its  killing the speed of my app. Is there any caching libraries out there that might help speed up the response times?</p>\n\n<p>I've done a bit of searching but can't seem to find anything that fits.</p>\n"}, {"tags": ["sql", "postgresql", "go", "sqlx"], "comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 2, "creation_date": 1436432867, "post_id": 31312886, "comment_id": 50613756, "body": "I don&#39;t know anything about Go, but in SQL you could use this: <code>where (p, m) in ( (1, 2), (3, 4), ... )</code>"}], "answers": [{"comments": [{"owner": {"reputation": 6730, "user_id": 297094, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/08a7e4ec1109264bc3d18a519d15146c?s=128&d=identicon&r=PG", "display_name": "Robert Zaremba", "link": "https://stackoverflow.com/users/297094/robert-zaremba"}, "edited": false, "score": 0, "creation_date": 1436446097, "post_id": 31317931, "comment_id": 50623136, "body": "I  think in production one should use <code>sqlx.In</code>. But this is a detail now."}], "tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": true, "score": 1, "last_activity_date": 1436445896, "creation_date": 1436445896, "answer_id": 31317931, "question_id": 31312886, "link": "https://stackoverflow.com/questions/31312886/how-to-unfold-a-list-of-int-pairs-in-sql-select-query/31317931#31317931", "title": "How to unfold a list of int pairs in SQL select query", "body": "<p>As noted in comments, <code>IN</code> check should satisfy your needs:</p>\n\n<p>Go over params to generate <code>IN</code> part of query:</p>\n\n<pre><code>paramStr := make([]string, len(params), len(params))\nfor i, p := range params {\n    paramStr[i] = fmt.Sprintf(\"(%d, %d)\", p.P, p.M)\n}\n</code></pre>\n\n<p>Then, join params and execute it:</p>\n\n<pre><code>err := dbm.Select(&amp;rows, \"SELECT * FROM X WHERE (p, m) IN (%s)\",\n        strings.Join(paramStr, \",\"))\n</code></pre>\n\n<p>Here, for select, I used <a href=\"https://github.com/jmoiron/modl\" rel=\"nofollow\">modl</a> which is a utility on top of <code>sqlx</code>.</p>\n"}], "owner": {"reputation": 6730, "user_id": 297094, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/08a7e4ec1109264bc3d18a519d15146c?s=128&d=identicon&r=PG", "display_name": "Robert Zaremba", "link": "https://stackoverflow.com/users/297094/robert-zaremba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 31317931, "answer_count": 1, "score": 1, "last_activity_date": 1436445896, "creation_date": 1436432682, "last_edit_date": 1436433157, "question_id": 31312886, "link": "https://stackoverflow.com/questions/31312886/how-to-unfold-a-list-of-int-pairs-in-sql-select-query", "title": "How to unfold a list of int pairs in SQL select query", "body": "<p>I have the following list of parameters:</p>\n\n<pre><code>params := [(p_1, m_1), ..., (p_n, m_n)]  // p_i, m_i : int\n</code></pre>\n\n<p>Now I want to build a query which go trough the list and match parmeters:\n(the part after <em>for</em> is a pseudocode which I want to write in <strong>PostgreSQL</strong> 9.4)</p>\n\n<pre><code>SELECT * FROM X WHERE p = p_i AND m = m_i  for (p_i, m_i) in params\n</code></pre>\n\n<p>How to write this query in Go (using <a href=\"http://jmoiron.github.io/sqlx/\" rel=\"nofollow\">jmoiron.github.io/sqlx</a> or standard <code>database/sql</code>)?</p>\n\n<pre><code>type Param struct {\n    P, M int\n}\nparams := []Param{{1,2}, {3,4}}\n// ???\n</code></pre>\n"}, {"tags": ["go", "websocket", "glassfish", "gorilla"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436432397, "post_id": 31312458, "comment_id": 50613474, "body": "Are you getting the error in the client or in your proxy? Anyway, websockets requires that the sent data be proper utf-8. If <code>message</code> is not valid utf-8, this will fail at least on the client side. Try escaping or converting the message to utf-8 and see if this still happens."}, {"owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436432773, "post_id": 31312458, "comment_id": 50613689, "body": "I&#39;m getting error in my proxy. Also I&#39;m pretty sure message is a valid utf-8. It is just a short test json data with random strings [A-Z0-9]"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436434196, "post_id": 31312458, "comment_id": 50614723, "body": "Then the thing that looks suspicious to me is <code>clients[clientId].WriteMessage(...)</code>. Probably two separate goroutines are writing to the same client at the same time (maybe we have one connection for two client ids somehow? your code doesn&#39;t give enough context). This is not thread safe, and causing mangled data to be written, resulting in this error."}, {"owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436434410, "post_id": 31312458, "comment_id": 50614906, "body": "I&#39;m using concurrent map, I just want to keep the example simple."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1436437886, "post_id": 31312458, "comment_id": 50617415, "body": "Could this be <a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\" rel=\"nofollow noreferrer\">BOM</a> related?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1436439354, "post_id": 31312458, "comment_id": 50618330, "body": "You might be using a concurrent map, but it&#39;s still possible for two goroutines to write at the same time, even if they are not accessing the map at the same time."}, {"owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436439863, "post_id": 31312458, "comment_id": 50618670, "body": "@Not_a_Golfer you are right. Adding RWMutex solved the issue. thx"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1436441385, "post_id": 31312458, "comment_id": 50619614, "body": "@dit so I&#39;ll write it as an answer"}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1436442461, "last_edit_date": 1436442461, "creation_date": 1436441580, "answer_id": 31316230, "question_id": 31312458, "link": "https://stackoverflow.com/questions/31312458/gorilla-websocket-error-close-1007-illegal-utf-8-sequence/31316230#31316230", "title": "Gorilla websocket error: close 1007 Illegal UTF-8 Sequence", "body": "<p>Summing up my comments as an answer:</p>\n\n<p>When you are writing to the client, you are taking the clientId from the GlassFish message, fetching the client from a map, and then writing to it - basically <code>clients[clientId].WriteMessage(...)</code>.</p>\n\n<p>While your map access can be thread safe, writing is not, as this can be seen as:</p>\n\n<pre><code>// map access - can be safe if you're using a concurrent map\nclient := clients[clientId]\n\n// writing to a client, not protected at all\nclient.WriteMessage(...)\n</code></pre>\n\n<p>So what's probably happening is that two separate goroutines are writing to the same client at the same time. You should protect your client from it by adding a mutex in the <code>WriteMessage</code> method implementation. </p>\n\n<p>BTW actually instead of protecting this method with a mutex, a better, more \"go-ish\" approach would be to use a channel to write the message, and a goroutine per client that consumes from the channel and writes to the actual socket.</p>\n\n<p>So in the client struct I'd do something like this:</p>\n\n<pre><code>type message struct {\n   msgtype string\n   msg string\n }\n\ntype client struct {\n    ...\n    msgqueue chan *message\n}\n\n\nfunc (c *client)WriteMessage(messageType, messageText string) {\n   // I'm simplifying here, but you get the idea\n   c.msgqueue &lt;- &amp;message{msgtype: messageType, msg: messageText}\n}\n\nfunc (c *client)writeLoop() {\n   go func() {\n       for msg := ragne c.msgqueue {\n           c.actuallyWriteMessage(msg)\n       }\n   }()\n}\n</code></pre>\n\n<p>and when creating a new client instance, just launch the write loop</p>\n"}], "owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 0, "accepted_answer_id": 31316230, "answer_count": 1, "score": 2, "last_activity_date": 1436442461, "creation_date": 1436431525, "last_edit_date": 1436433587, "question_id": 31312458, "link": "https://stackoverflow.com/questions/31312458/gorilla-websocket-error-close-1007-illegal-utf-8-sequence", "title": "Gorilla websocket error: close 1007 Illegal UTF-8 Sequence", "body": "<p>I'm trying to implement a websocket proxy server for GlassFish. If I try to connect more than one client I'm getting error:</p>\n\n<blockquote>\n  <p>ReadMessage Failed:  websocket: close 1007 Illegal UTF-8 Sequence.</p>\n</blockquote>\n\n<p>I'm sure the GlassFish server sending right data, because the same server works properly with another proxy server implemented with node.js.</p>\n\n<pre><code>func GlassFishHandler(conn *websocket.Conn){\n\n    defer conn.Close()\n\n    conn.SetReadDeadline(time.Now().Add(1000 * time.Second))\n    conn.SetWriteDeadline(time.Now().Add(1000 * time.Second))\n\n    fmt.Println(\"WS-GOLANG PROXY SERVER: Connected to GlassFish\")\n\n    for {\n\n        messageType, reader, err := conn.NextReader()\n\n        if err != nil {\n            fmt.Println(\"ReadMessage Failed: \", err) // &lt;- error here\n        } else {\n\n            message, err := ioutil.ReadAll(reader)\n            if (err == nil &amp;&amp; messageType == websocket.TextMessage){\n\n                var dat map[string]interface{}\n                if err := json.Unmarshal(message, &amp;dat); err != nil {\n                    panic(err)\n                } \n\n                // get client destination id\n                clientId := dat[\"target\"].(string)\n\n                fmt.Println(\"Msg from GlassFish for Client: \", dat);\n\n                // pass through\n                clients[clientId].WriteMessage(websocket.TextMessage, message)\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 95978, "user_id": 1079354, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c17dd9cf3e2322be19639e96da9f3eb3?s=128&d=identicon&r=PG", "display_name": "Makoto", "link": "https://stackoverflow.com/users/1079354/makoto"}, "edited": false, "score": 0, "creation_date": 1436426114, "post_id": 31310489, "comment_id": 50609560, "body": "What does <code>echo $C</code> give you back?  Also, are you on Linux or Windows?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "reply_to_user": {"reputation": 95978, "user_id": 1079354, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c17dd9cf3e2322be19639e96da9f3eb3?s=128&d=identicon&r=PG", "display_name": "Makoto", "link": "https://stackoverflow.com/users/1079354/makoto"}, "edited": false, "score": 0, "creation_date": 1436426281, "post_id": 31310489, "comment_id": 50609688, "body": "@Makoto - Im using windows...I put the C:/ since in the installation its write $GOPATH/bin/cf-console ...this is wrong?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1436426358, "post_id": 31310489, "comment_id": 50609740, "body": "You don&#39;t need the <code>&#39;$&#39;</code> sign, just try <code>C:&#47;Go&#47;bin&#47;cf-console</code>."}, {"owner": {"reputation": 95978, "user_id": 1079354, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c17dd9cf3e2322be19639e96da9f3eb3?s=128&d=identicon&r=PG", "display_name": "Makoto", "link": "https://stackoverflow.com/users/1079354/makoto"}, "edited": false, "score": 0, "creation_date": 1436426364, "post_id": 31310489, "comment_id": 50609743, "body": "You shouldn&#39;t need the $; that is more specific and geared towards Unix-based systems and their terminal variables.  If you just use the path, you should be okay."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436426467, "post_id": 31310489, "comment_id": 50609807, "body": "@icza-Thanks I did what you said and I got error File not found locally, make sure the file exists at given path ...any idea ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "reply_to_user": {"reputation": 95978, "user_id": 1079354, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c17dd9cf3e2322be19639e96da9f3eb3?s=128&d=identicon&r=PG", "display_name": "Makoto", "link": "https://stackoverflow.com/users/1079354/makoto"}, "edited": false, "score": 0, "creation_date": 1436426535, "post_id": 31310489, "comment_id": 50609847, "body": "@Makoto - I put the following cf install-plugin C:/Go/bin/cf-console and I got error File not found locally, make sure the file exists at given path ... what it can be ?Thanks in advance!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436427218, "post_id": 31310489, "comment_id": 50610239, "body": "@Makoto-Do you think I should do pre requisite  step ?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436427963, "post_id": 31311144, "comment_id": 50610683, "body": "Thanks but how should I use the  go get github.com/danhigham/cf-console,im new to go..."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1436428151, "post_id": 31311144, "comment_id": 50610799, "body": "@Mark you just type it in your CMD shell session. But first, make sure your go setup is complete: <a href=\"https://golang.org/doc/install#windows\" rel=\"nofollow noreferrer\">golang.org/doc/install#windows</a>: GOPATH should <i>not</i> be C:\\Go. First check your Go setup, <i>then</i> try to get that package."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436429878, "post_id": 31311144, "comment_id": 50611894, "body": "Thanks von voted up! I&#39;ve install the MSI but im not sure what is setGOPATH to another folder ,do I need to use this command in windows cli?to which path? Thanks in advance~"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436430536, "post_id": 31311144, "comment_id": 50612362, "body": "I saw in the env varible that I&#39;ve GOROOT value C:\\Go\\"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1436430652, "post_id": 31311144, "comment_id": 50612429, "body": "Set <code>GOPATH</code> to the folder you want, like <code>C:\\users\\&lt;mylogin&gt;\\go</code>: follow <a href=\"http://www.computerhope.com/issues/ch000549.htm\" rel=\"nofollow noreferrer\">computerhope.com/issues/ch000549.htm</a>. Then check the output of <code>go env</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436432243, "post_id": 31311144, "comment_id": 50613375, "body": "Thanks I did it and I was able to do the get and the install (I see now in folder C:\\GoPath the bin&amp;pkg&amp;src folder of the console) but now I go to my application path (in cmd) and did cf console appName and I got error cf: &#39;console&#39; is not a registered command. See &#39;cf help&#39; ,any idea?  do I need do additional steps?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1436433035, "post_id": 31311144, "comment_id": 50613882, "body": "@Mark if the go installation is complete, does the <code>go get github.com&#47;danhigham&#47;cf-console</code> work? Do you see <code>%GOPATH%\\src\\github.com\\danhigham\\cf-console</code> (like in, for example, <code>C:\\users\\&lt;mylogin&gt;\\go\\src\\github.com\\danhigham\\cf-console</code>)? Remember, any executable you are building will be in <code>%GOPATH%\\bin</code>, not <code>C:\\Go\\bin</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1436436178, "post_id": 31311144, "comment_id": 50616263, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/82800/discussion-between-mark-and-vonc\">continue this discussion in chat</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "edited": false, "score": 0, "creation_date": 1436436471, "post_id": 31311144, "comment_id": 50616459, "body": "Yes Von I see it its installed currently I guess... in the new folder I see %GOPATH%\\src\\github.com\\danhigham\\cf-console , but what should I do now to make it work?"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1436427968, "last_edit_date": 1436427968, "creation_date": 1436427880, "answer_id": 31311144, "question_id": 31310489, "link": "https://stackoverflow.com/questions/31310489/installing-cf-console-returns-error/31311144#31311144", "title": "Installing cf-console returns error", "body": "<p>In the Windows setup for Go <code>C:\\Go</code> is where Go is installed.</p>\n\n<p>Set GOPATH to another folder, and use <code>%GOPATH%\\bin\\cf-console</code>.<br>\nMake sure <code>go get github.com/danhigham/cf-console</code> works first:</p>\n\n<ul>\n<li>you should see %GOPATH%\\src\\github.com\\danhigham\\cf-console`</li>\n<li>you should be able to do a <code>go install</code> in that folder.</li>\n<li>that would generate the executable you need </li>\n</ul>\n\n<p>On Windows, the actual command mentioned in the <a href=\"https://github.com/danhigham/cf-console/blob/master/README.md\" rel=\"nofollow\"><code>README</code></a> should be:</p>\n\n<pre><code>cf install-plugin %GOPATH%\\bin\\cf-console\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4209821"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 31311144, "answer_count": 1, "score": 1, "last_activity_date": 1436427968, "creation_date": 1436425951, "last_edit_date": 1436426493, "question_id": 31310489, "link": "https://stackoverflow.com/questions/31310489/installing-cf-console-returns-error", "title": "Installing cf-console returns error", "body": "<p>Im fairly new to Git stuff and I need to install the following and I wonder how to do that? </p>\n\n<p><a href=\"https://github.com/danhigham/cf-console\" rel=\"nofollow\">https://github.com/danhigham/cf-console</a></p>\n\n<p>I've installed cloud foundry so in the CLI I can put CF commands and its working...\nI've also installed Go and when I put the following in the command line </p>\n\n<pre><code>cf install-plugin $C:/Go/bin/cf-console\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>Installing plugin $C:/Go/bin/cf-console...\nFAILED\nexec: \"$C:/Go/bin/cf-console\": file does not exist\n</code></pre>\n\n<p>Any idea?</p>\n"}, {"tags": ["import", "go", "interface", "declare"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1436406812, "post_id": 31306506, "comment_id": 50602903, "body": "You introduced another wrinkle in your question, possibly accidentally, by making your method <code>foo()</code> (private) not <code>Foo()</code>. <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/6hpUErAfMHI/X0bHeoZyfz0J\" rel=\"nofollow noreferrer\">Interfaces with private methods can&#39;t be implemented in the usual way by types in packages other than the one where they were defined.</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1436407355, "post_id": 31306506, "comment_id": 50603055, "body": "As I think hobbs was getting at, your third question seems to use &#39;same file&#39; to mean &#39;same package&#39;, but packages are often multiple files."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1436407799, "post_id": 31306506, "comment_id": 50603173, "body": "<a href=\"http://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">The spec on interface types</a> may be useful. You can always try to assign an instance of some concrete <code>T</code> to a variable <code>var i I</code> (or <code>var i pkg.I</code>) to test a theory, or at runtime, use <a href=\"http://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertions</a> or <a href=\"http://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switches</a> to work with an interface variable."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1436407910, "post_id": 31306506, "comment_id": 50603197, "body": "@twotwotwo I just interpreted <code>foo</code> as though it was <code>Foo</code>, didn&#39;t really think about the public/private implication. I think it&#39;s a reasonable assumption that Bruce <i>wasn&#39;t</i> trying to make that particular distinction, although it&#39;s worth noting :)"}, {"owner": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "edited": false, "score": 0, "creation_date": 1436414546, "post_id": 31306506, "comment_id": 50604787, "body": "Yea you are right, it should be Foo instead of foo. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "edited": false, "score": 0, "creation_date": 1436414716, "post_id": 31306670, "comment_id": 50604842, "body": "Thanks, hobbs. While this makes sense, it raise another question. If B, C, or D has more than one method like Foo(), but S only implements Foo(), not the others, then would you still say type B can hold an S? It seems an &quot;incomplete implementation&quot; of an interface."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "edited": false, "score": 0, "creation_date": 1436415152, "post_id": 31306670, "comment_id": 50604955, "body": "@Bruce a type that doesn&#39;t implement all of the methods in an interface doesn&#39;t implement the interface."}, {"owner": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "edited": false, "score": 0, "creation_date": 1436415549, "post_id": 31306670, "comment_id": 50605063, "body": "That makes sense. It seems that I forgot to include that case in my question. So for question 4 if S only implements Foo() method then S only implements B interface, but not D because D has an extra Bar() that is not implemented. Right? I&#39;ll accept the answer once all are justified, very likely soon! Thanks."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "edited": false, "score": 0, "creation_date": 1436486232, "post_id": 31306670, "comment_id": 50646246, "body": "@Bruce: yes, that&#39;s right. This seems like a roundabout way to get to the answer versus reading parts of the spec (linked from a comment on your question) and/or making a few files and seeing if they compile."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 2, "last_activity_date": 1436909046, "last_edit_date": 1436909046, "creation_date": 1436405637, "answer_id": 31306670, "question_id": 31306506, "link": "https://stackoverflow.com/questions/31306506/which-interface-does-this-type-implement/31306670#31306670", "title": "Which interface does this type implement?", "body": "<ol>\n<li><p>No. (But as a side note, you don't import interfaces, you import packages.)</p></li>\n<li><p>All of them. Order doesn't matter. If you declared variables of type <code>B</code>, <code>C</code>, and <code>D</code>, all of them would be able to hold an <code>S</code>.</p></li>\n<li><p>All of them. What you do in the same or different files doesn't matter.</p></li>\n<li><p>All of them. <code>S</code> implements <code>B</code> because <code>S</code> has <code>Foo()</code>. <code>S</code> implements <code>C</code> because <code>S</code> has <code>Bar()</code>. <code>S</code> implements <code>D</code> because <code>S</code> has both <code>Foo()</code> and <code>Bar()</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 1346, "user_id": 2889276, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9a70a4e6a20aedbb8bc298048bdcceeb?s=128&d=identicon&r=PG&f=1", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2889276/bruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1593273244, "creation_date": 1436404427, "last_edit_date": 1593273244, "question_id": 31306506, "link": "https://stackoverflow.com/questions/31306506/which-interface-does-this-type-implement", "title": "Which interface does this type implement?", "body": "<p>In essence, four questions are here for Golang interfaces, with each one slightly harder than the one before it.</p>\n<ol>\n<li>say we imported a lot of interfaces, A, B, C, ..., G \n</ol>\n    import (\n        \"A\",\n        \"B\",\n        \"C\",\n        // more ...\n        \"G\"\n    )\n<p>and we define a type S:</p>\n<pre><code>type S struct {\n    // more ...\n}\n</code></pre>\n<p>now if S &quot;implements&quot; one of the interfaces:</p>\n<pre><code>func (s S) Foo() {\n    // more ...\n}\n</code></pre>\n<p>Up to date, is there any other way to tell which interface of A - G does S implement, except for looking and searching into interface declarations of A - G? If no, is there a way to explicitly tell S to implement which interface? So far, it appears that the which interface S implemented is inferred.</p>\n<ol start=\"2\">\n<li><p>If, for the same example, B, C, D interfaces all have the Foo() method with the same signature. In this case, which interface does S implement? Does it depend on the order those interfaces are imported from B, C, and D?</p>\n</li>\n<li><p>If, rather than importing interfaces, we declare and define interfaces B, C, D in the same file, but those interfaces again all have Foo() method with the same signature, which interface does S implement? Does it depend on the order those interfaces are declared, or defined?</p>\n</li>\n<li><p>If, we declared and defined B, C, D interfaces in the same file, B has Foo() method, C has Bar() method, and D has both Foo() and Bar(). Now if S implement Foo() and Bar(), then does S implement B and C, or S only implements D?</p>\n</li>\n</ol>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1436405754, "last_edit_date": 1436405754, "creation_date": 1436403058, "answer_id": 31306326, "question_id": 31306256, "link": "https://stackoverflow.com/questions/31306256/how-does-go-build-decide-which-subdirectories-to-build-when-it-is-not-given-sp/31306326#31306326", "title": "How does `go build` decide which subdirectories to build when it is not given specific packages to build?", "body": "<p>If no path is specified, the 'go build' command builds the package in the current directory. The documentation is <a href=\"https://golang.org/cmd/go/#hdr-Description_of_package_lists\" rel=\"nofollow\">here</a>.</p>\n\n<p>The 'go build' command also builds any out of date dependencies.</p>\n"}], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1289, "favorite_count": 0, "accepted_answer_id": 31306326, "answer_count": 1, "score": 1, "last_activity_date": 1436405754, "creation_date": 1436402550, "question_id": 31306256, "link": "https://stackoverflow.com/questions/31306256/how-does-go-build-decide-which-subdirectories-to-build-when-it-is-not-given-sp", "title": "How does `go build` decide which subdirectories to build when it is not given specific packages to build?", "body": "<p>I have recently noticed that <code>go build -a</code> will build almost all, but not all packages in the subdirectories of my <code>$GOPATH</code>. </p>\n\n<p>What algorithm does <code>go build</code> use to decide what to build?</p>\n\n<p>The <a href=\"https://golang.org/cmd/go/\" rel=\"nofollow\">documentation</a> for the <code>go</code> command did not specify, or I misread it.</p>\n"}]