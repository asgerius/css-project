[{"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534365163, "post_id": 51865884, "comment_id": 90684215, "body": "You can&#39;t. The default HTTP port is 80. Either you need an external proxy of some kind or you need to modify your app to listen on port 80."}, {"owner": {"reputation": 11, "user_id": 7644825, "user_type": "registered", "profile_image": "https://graph.facebook.com/1293762264049762/picture?type=large", "display_name": "Ashref Haddeji", "link": "https://stackoverflow.com/users/7644825/ashref-haddeji"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534366086, "post_id": 51865884, "comment_id": 90684590, "body": "i modified it to listen directly for 443 for https , i got an error &quot;HTTPS port 443 is not accessible &quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534366166, "post_id": 51865884, "comment_id": 90684623, "body": "Then the port is in use by another process, or you need elevated privileges to use it (eg on Linux, ports below 1024 require root)."}, {"owner": {"reputation": 11, "user_id": 7644825, "user_type": "registered", "profile_image": "https://graph.facebook.com/1293762264049762/picture?type=large", "display_name": "Ashref Haddeji", "link": "https://stackoverflow.com/users/7644825/ashref-haddeji"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534366437, "post_id": 51865884, "comment_id": 90684725, "body": "thanks Adrian that worked for me"}], "answers": [{"tags": [], "owner": {"reputation": 103, "user_id": 8774937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d1ee86f60a99fa9c130c93fa537647?s=128&d=identicon&r=PG", "display_name": "user8774937", "link": "https://stackoverflow.com/users/8774937/user8774937"}, "is_accepted": false, "score": 1, "last_activity_date": 1534366332, "creation_date": 1534366332, "answer_id": 51866260, "question_id": 51865884, "link": "https://stackoverflow.com/questions/51865884/how-to-route-data-from-default-port-to-another4001/51866260#51866260", "title": "How to route data from default port to another[4001]", "body": "<p>You may either use <code>iptables</code> or modify your program to listen on :80 (HTTP) or :443 (HTTPS).</p>\n\n<p>With iptables, these commands will redirect all :80 and :443 traffic on your server to :8080 and :8443 respectively, internally.</p>\n\n<p><code>sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080\nsudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8443</code></p>\n\n<p>You may need to install <code>iptables</code>. Run <code>sudo apt install iptables</code>. </p>\n\n<p>This is a temporal fix. To make it permanent, put those lines in your <code>~/.bashrc</code></p>\n\n<p>If you don't want to use <code>iptables</code>, then modify the ports your program is listening on. However, remember that ports under 1024 need root permissions, so you'll need to run the program as root.</p>\n"}], "owner": {"reputation": 11, "user_id": 7644825, "user_type": "registered", "profile_image": "https://graph.facebook.com/1293762264049762/picture?type=large", "display_name": "Ashref Haddeji", "link": "https://stackoverflow.com/users/7644825/ashref-haddeji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "closed_date": 1534378785, "answer_count": 1, "score": -1, "last_activity_date": 1534403171, "creation_date": 1534364546, "last_edit_date": 1534403171, "question_id": 51865884, "link": "https://stackoverflow.com/questions/51865884/how-to-route-data-from-default-port-to-another4001", "closed_reason": "Not suitable for this site", "title": "How to route data from default port to another[4001]", "body": "<p>currently my go server is running on port 4001 for https request. to access web application i need to type domainname:4001 in browser.</p>\n\n<p>I would like only to type domainname ato make the connection to web server on port 40001.</p>\n"}, {"tags": ["go", "concurrency", "range", "channel"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534360915, "post_id": 51865011, "comment_id": 90682410, "body": "Please post the actual error and the line triggering it. There is no error for &quot;ranging over an empty channel&quot; - it just waits until there is something to receive."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1534361008, "post_id": 51865011, "comment_id": 90682448, "body": "Why could <code>close(channel)</code> as the last statement in <code>main</code> do anything? I think you have some fundamental misunderstanding about channels."}, {"owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1534361209, "post_id": 51865011, "comment_id": 90682531, "body": "@JimB As far as i know, the <code>for range</code> loop would never stop looping unless the channel gets closed."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1534361295, "post_id": 51865011, "comment_id": 90682563, "body": "@Swiftb0y no that&#39;s not it. Closing channel will close the channel in that case you cannot send more value on the channel if it is closed, compiler will throw an error saying cannot send value on closed channel."}, {"owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534361424, "post_id": 51865011, "comment_id": 90682617, "body": "@Himanshu yes, it does that primarily but as <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow noreferrer\">gobyexample.com/range-over-channels</a> suggests it will terminate the for loop as well."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1534361425, "post_id": 51865011, "comment_id": 90682618, "body": "@Swiftb0y: closing the channel will cause a for range loop to exit, but at the end of <code>main</code> the program is exiting, so it doesn&#39;t really matter."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534361575, "post_id": 51865011, "comment_id": 90682682, "body": "@Swiftb0y yes it does will close the for loop. But better is to check if there is a value in the channel using switch with <code>ok</code>. If it has then flush it on the receiver end. But even if you do not close the channel if does not effect your code. One more thing where are you printing your values in the function to check if your code is going correct."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534361790, "post_id": 51865011, "comment_id": 90682767, "body": "It still doesn&#39;t matter. Closing at the end of <code>main</code> is superfluous. When <code>main</code> returns, the program exits. No channels/goroutines/anything else will survive."}, {"owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "edited": false, "score": 0, "creation_date": 1534361811, "post_id": 51865011, "comment_id": 90682776, "body": "Ohhh I think I know what the issue is: The Program is quiting because once the for loop is done, the main routine is done as well and it will kill all the other goroutines as well. So really the question is how I can prevent the main routine from exiting until the first if clause evaluates to true. Is this assumption correct?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534361936, "post_id": 51865011, "comment_id": 90682831, "body": "@Himanshu The compiler does not detect send on a closed channel.  Perhaps you meant to say that send on a closed channel panics."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534361944, "post_id": 51865011, "comment_id": 90682837, "body": "@Swiftb0y somehow the assumption is not upto the mark because the go routine will run on a thread. Main will exit because it is not waiting for the go routine to finish"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1534361975, "post_id": 51865011, "comment_id": 90682850, "body": "@ThunderCat yes I mean to say that it will panic if we try to send on a closed channel."}, {"owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "edited": false, "score": 0, "creation_date": 1534362024, "post_id": 51865011, "comment_id": 90682870, "body": "Ok. I understand the issue now. But how can I prevent the main routine from exiting until the routines finished?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534362071, "post_id": 51865011, "comment_id": 90682886, "body": "@Swiftb0y use <code>wait groups</code> it will wait for all the go routines to finish."}, {"owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "edited": false, "score": 0, "creation_date": 1534362140, "post_id": 51865011, "comment_id": 90682920, "body": "Ok thank you very much."}], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "is_accepted": true, "score": 0, "last_activity_date": 1534362296, "creation_date": 1534362296, "answer_id": 51865410, "question_id": 51865011, "link": "https://stackoverflow.com/questions/51865011/executable-exiting-preemptively-when-ranging-over-an-empty-channel/51865410#51865410", "title": "Executable exiting preemptively when ranging over an empty channel", "body": "<p>So the issue was not actually that the for loop was exiting when it was encountering the closed channel but the main routine exited at that exact time which caused every other goroutine to terminate as well. I was advised to use waitgroups in this case.</p>\n"}], "owner": {"reputation": 25, "user_id": 5456672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f649c9443a602bbc92eb7e4ff2c29b5?s=128&d=identicon&r=PG&f=1", "display_name": "Swiftb0y", "link": "https://stackoverflow.com/users/5456672/swiftb0y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 51865410, "answer_count": 1, "score": -1, "last_activity_date": 1534614297, "creation_date": 1534360457, "last_edit_date": 1534614297, "question_id": 51865011, "link": "https://stackoverflow.com/questions/51865011/executable-exiting-preemptively-when-ranging-over-an-empty-channel", "title": "Executable exiting preemptively when ranging over an empty channel", "body": "<p>I recently encountered a coding exercise which I solved in python in which I had to port an \"algorithm\". I don't know how it is called which is why I am describing it:\nEach new line was a description of the previous line by the amount of the same number printed in sequence and the associated number.\nHere is an example:</p>\n\n<pre><code>1\n11\n21\n1211\n111221\n312211\netc\n</code></pre>\n\n<p>I started learning Go with its channels and concurrency features. So I came back to this exercise to try to solve it more efficiently in parallel with Go.\nThis is what I got so far:</p>\n\n<pre><code>package main\n\nfunc main() {\n    channel := make(chan uint8)\n    go treeCalcRoutine(channel, 0)\n    channel &lt;- 1\n    close(channel) //defer is not an option in this case because the channel has \n    //to be closed before main exits\n}\n\nfunc treeCalcRoutine(in &lt;-chan uint8, generation int) {\n    if generation &gt; 10 {\n        return // return after 10 recursive iterations\n    }\n    out := make(chan uint8)\n    defer close(out)\n    num := uint8(1)\n    previous := &lt;-i\n    go treeCalcRoutine(out, generation+1)\n    for val := range in {\n        switch {\n        case val == previous:\n            num++\n        default:\n            num = uint8(1)\n            out &lt;- num\n            out &lt;- val\n        }\n        previous = val\n    }\n    out &lt;- num\n    out &lt;- previous\n}\n</code></pre>\n\n<p>While trying to debug the program using <a href=\"https://github.com/derekparker/delve/\" rel=\"nofollow noreferrer\">Delve</a>, I figured out the Program quits without an exception (and exit status 0) while trying to range over an empty/closed channel. I expected the program just to skip the for loop altogether in this case.\nI still want to solve this challenge myself so I would appreciate if someone could just point me in the right direction instead of producing a functioning solution. Moreover, please point out any other issues/cases which could be done better (like the <code>generation</code> limit).</p>\n\n<p>EDIT:\nSince people asking me to post the error: There is no error at all for some reason. The program just exits once it reaches the for loop.</p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 7, "creation_date": 1534356172, "post_id": 51863932, "comment_id": 90680251, "body": "No mocks here, sorry. Use a fake server, e.g. net/http/httptest.Server."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534356333, "post_id": 51863932, "comment_id": 90680327, "body": "Can you show me how to do this?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1534356937, "post_id": 51863932, "comment_id": 90680599, "body": "See the example: <a href=\"https://godoc.org/net/http/httptest#example-Server\" rel=\"nofollow noreferrer\">godoc.org/net/http/httptest#example-Server</a>"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534358293, "post_id": 51863932, "comment_id": 90681196, "body": "Is there any way to return error from fake server?"}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1534378861, "post_id": 51863932, "comment_id": 90687931, "body": "You can make your test server return anything you would like. It can send a bad status, an error in the body, etc."}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 2, "creation_date": 1534393309, "post_id": 51863932, "comment_id": 90690641, "body": "you can replace the `  fmt.Fprintln(w, &quot;Hello, client&quot;)` in <a href=\"https://godoc.org/net/http/httptest#example-Server\" rel=\"nofollow noreferrer\">godoc.org/net/http/httptest#example-Server</a> with your own code. so for error status you can use <code>w.WriteHeader(&lt;your HTTP error&gt;)</code>, for return message you will need <code>fmt.Fprint(w,&quot;&lt;your message&gt;&quot;)</code>."}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534355582, "creation_date": 1534355582, "question_id": 51863932, "link": "https://stackoverflow.com/questions/51863932/mocking-a-golang-func-under-test-that-calls-a-server", "title": "Mocking a Golang func under test that calls a server", "body": "<p>I'm not in charge of maintaining the code base under test,  but I have this method to try to test, which hits a real server:</p>\n\n<pre><code>func (a *APICoreSt) CallServer(context interface{}, apiType APIType, apiURL string, header map[string]string, jsonBody []byte) CallResultSt {\n\n    var (\n        Url     = a.BaseURL + apiURL\n        err     error\n        res     *http.Response\n        resBody json.RawMessage\n        hc      = &amp;http.Client{}\n        req     = new(http.Request)\n    )\n\n    req, err = http.NewRequest(string(apiType), Url, bytes.NewBuffer(jsonBody))\n    if err != nil {\n        //Use a map instead of errorSt so that it doesn't create a heavy dependency.\n        errorSt := map[string]string{\n            \"Code\":    \"ez020300007\",\n            \"Message\": \"The request failed to be created.\",\n        }\n        logger.Instance.LogError(err.Error())\n        err, _ := json.Marshal(errorSt)\n        return CallResultSt{DetailObject: err, IsSucceeded: false}\n    }\n\n    for k, v := range header {\n        req.Header.Set(k, v)\n    }\n\n    res, err = hc.Do(req)\n    if res != nil {\n        resBody, err = ioutil.ReadAll(res.Body)\n        res.Body = ioutil.NopCloser(bytes.NewBuffer(resBody))\n    }\n    return CallResultSt{resBody, logger.Instance.CheckAndHandleErr(context, res)}\n\n}\n</code></pre>\n\n<p>Clearly, since this is a unit test, I don't want to be making this call for real, and the test depends on external factors. Is there any way to inject any fakes/mocks, without touching this func itself (it's literally not my job to touch it)?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "is_accepted": false, "score": 1, "last_activity_date": 1534360157, "last_edit_date": 1534360157, "creation_date": 1534357646, "answer_id": 51864387, "question_id": 51863849, "link": "https://stackoverflow.com/questions/51863849/os-mkdirall-and-change-ownership-to-user-with-os-chown-but-how-to-get-uid-gid-o/51864387#51864387", "title": "os.mkdirall and change ownership to user with os.chown but how to get uid, gid of user", "body": "<pre><code>err := os.MkdirAll(dir, os.FileMode(0775))\nif err != nil {\n    return fmt.Errorf(\"error creating tabelspace folders: %v \", err.Error())\n}\nif runtime.GOOS != \"windows\" {\n    group, err := user.Lookup(\"postgres\")\n    if err != nil {\n        return fmt.Errorf(\"error looking up postgres user user info\")\n    }\n    uid, _ := strconv.Atoi(group.Uid)\n    gid, _ := strconv.Atoi(group.Gid)\n\n    err = syscall.Chown(dir, uid, gid)\n}\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1167, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1534360157, "creation_date": 1534355234, "question_id": 51863849, "link": "https://stackoverflow.com/questions/51863849/os-mkdirall-and-change-ownership-to-user-with-os-chown-but-how-to-get-uid-gid-o", "title": "os.mkdirall and change ownership to user with os.chown but how to get uid, gid of user", "body": "<p>I need to mkdir on linux as root, so I run may app elevated with <code>sudo</code>.  But the app making use of this directory runs as a different user, <code>postgres</code>, so it errors out with a permission denied error message.</p>\n\n<pre><code>dir: = \"/srv/tablepspaces/psql96/client\"\nerr := os.MkdirAll(dir, os.FileMode(0775))\n</code></pre>\n\n<p>(for some reason the above results in 755 when i <code>stat</code> the dir on linux)</p>\n\n<p>so I would like to chown the dir:</p>\n\n<p>I need to use <code>os.Chown(name string, uid, gid int) error</code>  </p>\n\n<p>How do I get the uid and gid of a user without shelling out and getting the return and parsing of <code>id</code></p>\n"}, {"tags": ["go", "sdl-2"], "owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555969129, "creation_date": 1534354539, "question_id": 51863687, "link": "https://stackoverflow.com/questions/51863687/running-go-get-sdl2-error-executable-file-not-found-in-path", "title": "Running GO GET SDL2 Error executable file not found in $PATH", "body": "<p>Im simplly trying to install <code>go-sdl2</code> on MACOX from <a href=\"https://github.com/veandco/go-sdl2#installation\" rel=\"nofollow noreferrer\">https://github.com/veandco/go-sdl2#installation</a></p>\n\n<p><code>go get -v github.com/veandco/go-sdl2/{sdl,img,mix,ttf}</code></p>\n\n<p>I get following ERROR:</p>\n\n<pre><code>github.com/veandco/go-sdl2/sdl\n# pkg-config --cflags sdl2\npkg-config: exec: \"pkg-config\": executable file not found in $PATH\n</code></pre>\n"}, {"tags": ["go", "microsoft-cognitive"], "answers": [{"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 1, "last_activity_date": 1534442472, "creation_date": 1534442472, "answer_id": 51882904, "question_id": 51862515, "link": "https://stackoverflow.com/questions/51862515/calling-api-in-golang-error-400-bad-request/51882904#51882904", "title": "calling api in golang error 400 bad request", "body": "<p>While there's something wrong with the Go code (<code>my-key</code> looks weird in particular), the problem is that you need to escape the spaces in the query parameter:</p>\n\n<pre><code>$ curl 'https://api.labs.cognitive.microsoft.com/academic/v1.0/interpret?query=a two level microprogram simulator&amp;complete=0&amp;count=10&amp;model=latest'\n&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\"&gt;\n&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Bad Request&lt;/TITLE&gt;\n&lt;META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"&gt;&lt;/HEAD&gt;\n&lt;BODY&gt;&lt;h2&gt;Bad Request&lt;/h2&gt;\n&lt;hr&gt;&lt;p&gt;HTTP Error 400. The request is badly formed.&lt;/p&gt;\n&lt;/BODY&gt;&lt;/HTML&gt;\n</code></pre>\n\n<p>After escaping the spaces with <code>%20</code>, we get the expected access error:</p>\n\n<pre><code>$ curl 'https://api.labs.cognitive.microsoft.com/academic/v1.0/interpret?query=a%20two%20level%20microprogram%20simulator&amp;complete=0&amp;count=10&amp;model=latest'\n\n{\"error\":{\"code\":\"Unspecified\",\"message\":\"Access denied due to invalid subscription key. Make sure you are subscribed to an API you are trying to call and provide the right key.\"}}\n</code></pre>\n\n<p>It is best to let Go handle this:</p>\n\n<pre><code>import \"net/url\"\n\nbase_url := \"https://api.labs.cognitive.microsoft.com/academic/v1.0/interpret\"\n\nvar v url.Values\nv.Add(\"query\", \"a two level microprogram simulator\")\nv.Add(\"complete\", \"0\")\nv.Add(\"count\", \"10\")\nv.Add(\"model\", \"latest\")\n\nurl := base_url + \"?\" + v.Encode()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 4633130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c027d070796aa4ae4e83b08bacd465da?s=128&d=identicon&r=PG&f=1", "display_name": "user4633130", "link": "https://stackoverflow.com/users/4633130/user4633130"}, "is_accepted": false, "score": 0, "last_activity_date": 1534642263, "creation_date": 1534642263, "answer_id": 51913758, "question_id": 51862515, "link": "https://stackoverflow.com/questions/51862515/calling-api-in-golang-error-400-bad-request/51913758#51913758", "title": "calling api in golang error 400 bad request", "body": "<p>Actually earlier I also figured it out as well. So what I suggest is to simply add fol\nurl.QueryEscape(\"a two level microprogram simulator\")</p>\n"}], "owner": {"reputation": 21, "user_id": 4633130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c027d070796aa4ae4e83b08bacd465da?s=128&d=identicon&r=PG&f=1", "display_name": "user4633130", "link": "https://stackoverflow.com/users/4633130/user4633130"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1257, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1534649450, "creation_date": 1534349828, "last_edit_date": 1534649450, "question_id": 51862515, "link": "https://stackoverflow.com/questions/51862515/calling-api-in-golang-error-400-bad-request", "title": "calling api in golang error 400 bad request", "body": "<p>I am getting the following error. What is wrong the code below written in golang? Any idea?</p>\n\n<blockquote>\n  <p>&amp;{400 Bad Request 400 HTTP/1.1 1 1 map[Content-Type:[text/html;\n  charset=us-ascii] Date:[Wed, 15 Aug 2018 16:14:34 GMT]\n  Content-Length:[311]] 0xc42005c280 311 [] true false map[]\n  0xc4200fe000 0xc4200a62c0}</p>\n</blockquote>\n\n<hr>\n\n<pre><code>url := fmt.Sprintf(\"https://api.labs.cognitive.microsoft.com/academic/v1.0/interpret?query=a two level microprogram simulator&amp;complete=0&amp;count=10&amp;model=latest\")\n</code></pre>\n"}, {"tags": ["docker", "go", "kubernetes", "dockerfile", "go-html-template"], "comments": [{"owner": {"reputation": 34590, "user_id": 150339, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/55fd8ebbdc83c65f2d0fd26b4899df0a?s=128&d=identicon&r=PG", "display_name": "Bruno Reis", "link": "https://stackoverflow.com/users/150339/bruno-reis"}, "edited": false, "score": 0, "creation_date": 1595364174, "post_id": 51860969, "comment_id": 111447926, "body": "That <code>ENV</code> instruction isn&#39;t useful in the Dockerfile shown, as it&#39;s scoped to a build stage, which ends immediately after it (and a new one starts). Also, keep in mind that if you had that <code>ENV</code> instruction in the last stage (i.e., the actual image that is being build), it could be a security problem, as you&#39;d be persisting in the image \u2014 and in every system that stores that image \u2014 the credentials to a database."}], "answers": [{"tags": [], "owner": {"reputation": 428, "user_id": 1208310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efd7449def8a44537d82ca06e1a142ed?s=128&d=identicon&r=PG", "display_name": "jkhedani", "link": "https://stackoverflow.com/users/1208310/jkhedani"}, "is_accepted": true, "score": 2, "last_activity_date": 1534366211, "creation_date": 1534366211, "answer_id": 51866231, "question_id": 51860969, "link": "https://stackoverflow.com/questions/51860969/dockerfile-directory-structure-for-go-webapp/51866231#51866231", "title": "Dockerfile directory structure for Go Webapp", "body": "<p>In the second stage of your Dockerfile, you are only copying your Go binary from the previous stage. You must also copy your <code>templates</code> directory to the second stage as well so the Go binary can reference your HTML templates:</p>\n\n<pre><code>FROM golang:1.8-alpine\nRUN apk add --update go git\nRUN go get github.com/lib/pq/...\nADD . /go/src/hello-app\nRUN go install hello-app\nENV USER=username \\\n    PASSWORD=password \\\n    DB=dbname \\\n    HOST=hostname \\\n    PORT=5432\n\nFROM alpine:latest\nCOPY --from=0 /go/bin/hello-app/ .\nCOPY --from=0 /go/src/hello-app/templates ./templates\nENV PORT 4040\nCMD [\"./hello-app\"]\n</code></pre>\n\n<p>I'm not sure if this is common practice but when I'm confused about what contents are in what folder within the build process, I simply <code>ls</code> the directory in question to get a better understanding of what might be happening during the build process:</p>\n\n<pre><code>RUN ls\n</code></pre>\n\n<p>Obviously you can remove these lines once you've finalized your Dockerfile.</p>\n"}, {"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1534386145, "creation_date": 1534386145, "answer_id": 51868777, "question_id": 51860969, "link": "https://stackoverflow.com/questions/51860969/dockerfile-directory-structure-for-go-webapp/51868777#51868777", "title": "Dockerfile directory structure for Go Webapp", "body": "<p>That error is because, the <code>template.ParseGlob</code> cannot find any matching files in your templates directory. Instead of <code>COPY --from=0 /go/bin/hello-app/ .</code> try copying the entire directory using <code>COPY &lt;YOUR LOCAL GOPATH/src/hello-app&gt; &lt;DOCKER DIR PATH&gt;</code>. Also when you build the app, your templates folder will still be in source folder, so that too might be causing the problem. Solution is to run a <code>go build</code>in the app directory and use the the <code>COPY</code> command I have. </p>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 4172322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2Fqg.jpg?s=128&g=1", "display_name": "jogam5", "link": "https://stackoverflow.com/users/4172322/jogam5"}, "is_accepted": false, "score": 0, "last_activity_date": 1595363397, "creation_date": 1595363397, "answer_id": 63022607, "question_id": 51860969, "link": "https://stackoverflow.com/questions/51860969/dockerfile-directory-structure-for-go-webapp/63022607#63022607", "title": "Dockerfile directory structure for Go Webapp", "body": "<p>I experienced the same error with my templates' folder but solved it by copying all the files from my root folder using this command in my Dockerfile:</p>\n<pre><code>COPY . .\n</code></pre>\n<p>In addition, when you are using an external library you might want to enable the GO111MODULE.</p>\n<p>In your Terminal (MacOS):</p>\n<pre><code>export GO111MODULE=on\ngo mod init\n</code></pre>\n<p>In your Dockerfile:</p>\n<pre><code>COPY go.mod .\nRUN go mod download\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 10228856, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FCexlQmtw7I/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oLW32ssj28XByRqNFWNxnA-YfVbQ/mo/photo.jpg?sz=128", "display_name": "Tristan C", "link": "https://stackoverflow.com/users/10228856/tristan-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1301, "favorite_count": 0, "accepted_answer_id": 51866231, "answer_count": 3, "score": 2, "last_activity_date": 1595363397, "creation_date": 1534344268, "last_edit_date": 1534356276, "question_id": 51860969, "link": "https://stackoverflow.com/questions/51860969/dockerfile-directory-structure-for-go-webapp", "title": "Dockerfile directory structure for Go Webapp", "body": "<p>I'm developing a test hello app in Go, which will have access to a Postgres DB. This will use a statefulset to release in kubernetes and has one pod with two container images (one for pgsql &amp; one for goapp).</p>\n\n<pre><code>\u251c\u2500\u2500 hello-app\n|   \u251c\u2500\u2500 templates\n|       \u251c\u2500\u2500 file1.gohtml\n|       \u251c\u2500\u2500 file2.gohtml\n|       \u2514\u2500\u2500 file3.gohtml\n|   \u251c\u2500\u2500 Dockerfile\n|   \u2514\u2500\u2500 hello-app.go\n\u251c\u2500\u2500 psql\n|   \u251c\u2500\u2500 Dockerfile\n|   \u251c\u2500\u2500 createUser.sh\n|   \u2514\u2500\u2500 createDB.sql\n\u251c\u2500\u2500 yaml\n|   \u2514\u2500\u2500 statefulset.yaml\n</code></pre>\n\n<p>I am stuck getting the Dockerfile and Go app to tie up. In my first bit of Go code I use the 'template.Must' function to reference the 'templates' directory. Obviously when I run this up as a container the directory structure is different. </p>\n\n<p>I've not quite worked out how to do this in the Dockerfile yet and was looking for some guidance.</p>\n\n<p><strong>/app/hello-app.go</strong></p>\n\n<pre><code>package main\n\nimport (\n\n        \"database/sql\"\n        \"fmt\"\n        \"os\"\n        _ \"github.com/lib/pq\"\n        \"html/template\"\n        \"net/http\"\n        \"strconv\"\n)\n\nvar db *sql.DB\nvar tpl *template.Template\n\nfunc init() {\n        host := os.Getenv(\"VARIABLE\")\n        var err error\n        db, err = sql.Open(\"postgres\", \"postgres://user:password@\"+host+\"/dbname?sslmode=disable\")\n        if err != nil {\n                panic(err)\n        }\n\n        if err = db.Ping(); err != nil {\n                panic(err)\n        }\n        fmt.Println(\"You connected to your database.\")\n\n        tpl = template.Must(template.ParseGlob(\"templates/*.gohtml\"))\n</code></pre>\n\n<p><strong>/app/Dockerfile</strong></p>\n\n<pre><code>FROM golang:1.8-alpine\nRUN apk add --update go git\nRUN go get github.com/lib/pq/...\nADD . /go/src/hello-app\nRUN go install hello-app\nAdd templates templates/\nENV USER=username \\\n    PASSWORD=password \\\n    DB=dbname \\\n    HOST=hostname \\\n    PORT=5432\n\nFROM alpine:latest\nCOPY --from=0 /go/bin/hello-app/ .\nENV PORT 4040\nCMD [\"./hello-app\"]\n</code></pre>\n\n<p>When I run this up as is in kubernetes (GCP) I get the following log entry on the hello-app container. </p>\n\n<blockquote>\n  <p>panic: html/template: pattern matches no files: <code>templates/*.gohtml</code>\n  goroutine 1 [running]: html/template.Must</p>\n</blockquote>\n"}, {"tags": ["postgresql", "go", "database-replication"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534338609, "post_id": 51858659, "comment_id": 90670831, "body": "You can force a second connection, by starting a transaction on the first, then opening a second connection, before committing or rolling back the transaction. But that&#39;s only a possible work-around."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534338755, "post_id": 51858659, "comment_id": 90670909, "body": "Out of curiosity, how do you demote a postgres master without restarting it (which breaks connections)? You can&#39;t turn on replication at runtime, right?"}, {"owner": {"reputation": 191, "user_id": 2870681, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/21264df3baa23f3231ee6d8bee1dea46?s=128&d=identicon&r=PG&f=1", "display_name": "borellini", "link": "https://stackoverflow.com/users/2870681/borellini"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1534340117, "post_id": 51858659, "comment_id": 90671681, "body": "@Peter I&#39;m curious, too, since after asking I realised that a TCP connection made to the previous master must have died in the failover - but I nevertheless got a read-only connection hanging in my pool. My best explanation now is that the connection was acquired between the actual failover and the DNS change reflecting the failover. The DB implementation is Amazon Aurora PostgreSQL, if that is interesting."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534339371, "post_id": 51859438, "comment_id": 90671245, "body": "It will be quite unfortunate if the only answer is not to use the standard library, but +1 for a possible alternative."}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 3, "last_activity_date": 1534338802, "last_edit_date": 1592644375, "creation_date": 1534338802, "answer_id": 51859438, "question_id": 51858659, "link": "https://stackoverflow.com/questions/51858659/how-to-safely-discard-golang-database-sql-pooled-connections-for-example-when-t/51859438#51859438", "title": "How to safely discard golang database/sql pooled connections, for example when they point to a read-only replica?", "body": "<p>I believe that when using <code>database/sql</code>, the answer is &quot;no&quot;, though I'd be happy to be corrected.</p>\n<p>A while back, we switched from <code>database/sql</code> with <code>lib/pq</code> to the pure Go <a href=\"https://godoc.org/github.com/jackc/pgx\" rel=\"nofollow noreferrer\">jackc/pgx</a> for similar reasons (the inability to control connections on a low level), and were happy with the result. That module offers <a href=\"https://godoc.org/github.com/jackc/pgx#ConnPool.Reset\" rel=\"nofollow noreferrer\"><code>ConnPool.Reset</code></a> which sounds like what you want here:</p>\n<blockquote>\n<p>Reset closes all open connections, but leaves the pool open. It is intended for use when an error is detected that would disrupt all connections (such as a network interruption or a server state change).</p>\n<p>It is safe to reset a pool while connections are checked out. Those connections will be closed when they are returned to the pool.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1534339906, "creation_date": 1534339906, "answer_id": 51859720, "question_id": 51858659, "link": "https://stackoverflow.com/questions/51858659/how-to-safely-discard-golang-database-sql-pooled-connections-for-example-when-t/51859720#51859720", "title": "How to safely discard golang database/sql pooled connections, for example when they point to a read-only replica?", "body": "<p>Your best bet is probably Postgres's <a href=\"https://www.postgresql.org/docs/9.1/static/ecpg-sql-disconnect.html\" rel=\"nofollow noreferrer\">DISCONNECT</a> command.</p>\n\n<pre><code>_, err := conn.ExecContext(context.Background(), \"DISCONNECT\")\n</code></pre>\n\n<p>will cause the connection to be closed, from the server side.</p>\n"}, {"tags": [], "owner": {"reputation": 3052, "user_id": 169213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64303aa38b35291f94bbd04aa07e9bac?s=128&d=identicon&r=PG", "display_name": "Pomyk", "link": "https://stackoverflow.com/users/169213/pomyk"}, "is_accepted": false, "score": 0, "last_activity_date": 1580159921, "creation_date": 1580159921, "answer_id": 59939039, "question_id": 51858659, "link": "https://stackoverflow.com/questions/51858659/how-to-safely-discard-golang-database-sql-pooled-connections-for-example-when-t/59939039#59939039", "title": "How to safely discard golang database/sql pooled connections, for example when they point to a read-only replica?", "body": "<p>I think you can discard it by using the Raw function and returning a driver.ErrBadConn error:</p>\n\n<pre><code>conn.Raw(func(interface{}) error { return driver.ErrBadConn })\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 2870681, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/21264df3baa23f3231ee6d8bee1dea46?s=128&d=identicon&r=PG&f=1", "display_name": "borellini", "link": "https://stackoverflow.com/users/2870681/borellini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 2, "answer_count": 3, "score": 8, "last_activity_date": 1580159921, "creation_date": 1534335915, "question_id": 51858659, "link": "https://stackoverflow.com/questions/51858659/how-to-safely-discard-golang-database-sql-pooled-connections-for-example-when-t", "title": "How to safely discard golang database/sql pooled connections, for example when they point to a read-only replica?", "body": "<p>We have been using golang's <code>database/sql</code> and <code>github.com/lib/pq</code> with a PostgreSQL cluster, meaning that a certain database server that was a replication master might be a read-only replica after the previous master has failed.</p>\n\n<p>Recently, our low-usage service managed to keep a single connection in its connection pool (there were no concurrent requests that would have opened a second connection), and its target had been demoted to a read-only replica. As a result, each write operation to the service failed until it was restarted. That would not have happened, if a new connection was made to the cluster.</p>\n\n<p>The problem is I can't find a documented way to discard a connection on certain kinds of errors. The only public method in <code>database/sql</code> that sounds correct is <code>Conn.Close</code> which returns the connection to the pool without closing it. Not calling it will cause a resource leak which will eventually make the pool unusable. Is there a sustainable way to get rid of a connection when the application wants to?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 1, "last_activity_date": 1534334679, "creation_date": 1534334679, "answer_id": 51858368, "question_id": 51858329, "link": "https://stackoverflow.com/questions/51858329/confused-about-go-syntax/51858368#51858368", "title": "Confused about go syntax", "body": "<p>This doesn't do anything at runtime, but unless the <code>*selectQuery</code> type satisfies the interface <code>QueryAppender</code>, compilation will fail. It's a kind of static assertion.</p>\n"}], "owner": {"reputation": 1148, "user_id": 1679136, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/820d28838a039319ce40a6ae1fb98fb1?s=128&d=identicon&r=PG", "display_name": "latsha", "link": "https://stackoverflow.com/users/1679136/latsha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "closed_date": 1534334673, "accepted_answer_id": 51858368, "answer_count": 1, "score": -3, "last_activity_date": 1534334679, "creation_date": 1534334545, "question_id": 51858329, "link": "https://stackoverflow.com/questions/51858329/confused-about-go-syntax", "closed_reason": "Duplicate", "title": "Confused about go syntax", "body": "<p>Little bit confused with this code. </p>\n\n<pre><code>var _ QueryAppender = (*selectQuery)(nil)\n</code></pre>\n\n<p>I found this code in <a href=\"https://github.com/go-pg/pg/blob/master/orm/select.go\" rel=\"nofollow noreferrer\">pg-go</a>\n repository and don't know why <code>QueryAppender</code> declared that way. Please explain me what is the use cases when I should declare variables that way. </p>\n"}, {"tags": ["linux", "go", "systemd", "pulseaudio"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1534343557, "post_id": 51857421, "comment_id": 90673702, "body": "PulseAudio generally runs in the context of the logged in user&#39;s session, and audio input/output is only possible for programs running inside that session. It should not be possible for a system service to obtain microphone audio from PulseAudio running in a user&#39;s session, as that would be a serious security breach."}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1534346700, "post_id": 51857421, "comment_id": 90675570, "body": "Hi, Michael. That makes a lot of sense. But it should be possible to run a service in user&#39;s session using <code>systemd</code>..? or do I have to use desktop environment&#39;s autostart mechanism to achieve what I want..?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1534346765, "post_id": 51857421, "comment_id": 90675608, "body": "systemd services never run in a user&#39;s desktop session."}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1534346928, "post_id": 51857421, "comment_id": 90675704, "body": "Thanks, I&#39;ll go for the DE&#39;s autostart mechanism then."}, {"owner": {"reputation": 2206, "user_id": 1420237, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f427f4dce4e8cd75b6154bae65629e88?s=128&d=identicon&r=PG", "display_name": "Lucas Werkmeister", "link": "https://stackoverflow.com/users/1420237/lucas-werkmeister"}, "edited": false, "score": 1, "creation_date": 1534427114, "post_id": 51857421, "comment_id": 90708454, "body": "It sounds like this would make sense to run as a systemd user service (just like PulseAudio itself)."}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "reply_to_user": {"reputation": 2206, "user_id": 1420237, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f427f4dce4e8cd75b6154bae65629e88?s=128&d=identicon&r=PG", "display_name": "Lucas Werkmeister", "link": "https://stackoverflow.com/users/1420237/lucas-werkmeister"}, "edited": false, "score": 0, "creation_date": 1534431124, "post_id": 51857421, "comment_id": 90711304, "body": "Thanks @LucasWerkmeister, I&#39;ll look into it."}, {"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "reply_to_user": {"reputation": 2206, "user_id": 1420237, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f427f4dce4e8cd75b6154bae65629e88?s=128&d=identicon&r=PG", "display_name": "Lucas Werkmeister", "link": "https://stackoverflow.com/users/1420237/lucas-werkmeister"}, "edited": false, "score": 1, "creation_date": 1534582354, "post_id": 51857421, "comment_id": 90764137, "body": "@LucasWerkmeister It worked. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "edited": false, "score": 0, "creation_date": 1534335824, "post_id": 51858210, "comment_id": 90669287, "body": "Hi Scott, thanks for the input but <code>pulseaudio</code> is running. I&#39;m testing the service side-by-side with the binary. The binary is running but the service is giving me problems. I&#39;ll add this check though once this problem is solved."}], "tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": false, "score": 0, "last_activity_date": 1534334074, "creation_date": 1534334074, "answer_id": 51858210, "question_id": 51857421, "link": "https://stackoverflow.com/questions/51857421/failed-to-capture-microphone-input-using-pulseaudio-as-a-systemd-unit/51858210#51858210", "title": "Failed to capture microphone input using pulseaudio as a systemd unit", "body": "<p>pulseaudio is a daemon which probably has yet to get launched ... update your <code>binary.sh</code> with a </p>\n\n<pre><code>sleep 10\necho about to determine whether pulseaudio is up and running\npulseaudio --check\necho if pulseaudio is running above check silently returns\n</code></pre>\n\n<p>prior to launching your golang binary</p>\n"}], "owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534334074, "creation_date": 1534330673, "question_id": 51857421, "link": "https://stackoverflow.com/questions/51857421/failed-to-capture-microphone-input-using-pulseaudio-as-a-systemd-unit", "title": "Failed to capture microphone input using pulseaudio as a systemd unit", "body": "<p>I created a small go program that uses <a href=\"https://github.com/mesilliac/pulse-simple\" rel=\"nofollow noreferrer\">these</a> go bindings to record some commands from the default microphone and act accordingly. It works fine as a standalone binary(both as normal user and root user) but when I tried to convert it into a systemd unit the <code>Capture</code> function in the go bindings failed with error saying <code>connection refused</code>.</p>\n\n<p>The program is failing to capture the microphone input when running as a systemd service. The following is the unit file which is pretty much copy-pasted from <a href=\"https://www.freedesktop.org/software/systemd/man/systemd.service.html#Examples\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>[Unit]\nDescription=Commander service providing voice commands\n\n[Service]\nExecStart=/path/to/binary/binary.sh\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n\n<p>binary.sh is a simple shell script that for providing environment variables to the go binary. The script is below</p>\n\n<pre><code>#!/bin/bash\ncd /path/to/binary\nenv LD_LIBRARY_PATH=/usr/local/lib ./binary &gt; stdout 2&gt; stderr\n</code></pre>\n\n<p>The <code>LD_LIBRARY_PATH</code> is needed for <code>pocketsphinx</code> shared libraries which is being used for recognizing commands from audio.</p>\n\n<p>I think something is wrong with the unit file but I don't know what it is. The whole project can be found <a href=\"https://github.com/farkaskid/commander\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Any insight would be helpful. Thanks.</p>\n"}, {"tags": ["go", "proxy", "smtp", "socks"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534327155, "post_id": 51856084, "comment_id": 90665451, "body": "You shouldn&#39;t ignore errors in your <code>Socks()</code> function"}], "answers": [{"comments": [{"owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1534331021, "post_id": 51856860, "comment_id": 90667086, "body": "Thanks you for help!"}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "reply_to_user": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1542197046, "post_id": 51856860, "comment_id": 93480203, "body": "@\u0410\u043d\u0434\u0440\u0435\u0439\u0410\u043d\u0442\u043e\u043d\u043e\u0432 Did this work for you? were you able to send email using GO smtp client behind proxy?"}, {"owner": {"reputation": 1663, "user_id": 2949840, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b5ea45d4d574deb29d47020a14e1ab21?s=128&d=identicon&r=PG&f=1", "display_name": "WildCat", "link": "https://stackoverflow.com/users/2949840/wildcat"}, "edited": false, "score": 0, "creation_date": 1586692110, "post_id": 51856860, "comment_id": 108215077, "body": "I don&#39;t understand this answer. Both of these two functions require the first parameter to be connection instead of a dialer: <code>tls.Client([connection], conf)</code> and <code>smtp.NewClient([connection],...)</code>. How did you do that?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 1663, "user_id": 2949840, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b5ea45d4d574deb29d47020a14e1ab21?s=128&d=identicon&r=PG&f=1", "display_name": "WildCat", "link": "https://stackoverflow.com/users/2949840/wildcat"}, "edited": false, "score": 0, "creation_date": 1586703532, "post_id": 51856860, "comment_id": 108219505, "body": "@WildCat: don&#39;t let you confuse by the names of the variables. <code>dialer</code> as returned by <code>Socks</code> is a <code>Conn</code> and <code>tlsdialer</code> as returned by <code>tls.Client</code> is a <code>Conn</code> too. I&#39;ve just used the naming scheme for variables from the original question in the answer."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 1, "last_activity_date": 1534328528, "last_edit_date": 1534328528, "creation_date": 1534328088, "answer_id": 51856860, "question_id": 51856084, "link": "https://stackoverflow.com/questions/51856084/custom-dialer-for-smtp-client-in-golang/51856860#51856860", "title": "Custom dialer for smtp client in Golang?", "body": "<p>You are using port 465 which expects TLS from start (implicit TLS) and not the usual TLS after STARTTLS command (explicit TLS). This means that the <code>Conn</code> object you use as <code>dialer</code> should already have been upgraded to TLS. To do this:</p>\n\n<pre><code>import \"crypto/tls\"\n...\nfunc Connect() {\n    dialer, err := Socks(\"127.0.0.1:9050\", \"smtp.gmail.com:465\")\n    ...\n    conf := &amp;tls.Config{ServerName: \"smtp.gmail.com\"}\n    tlsdialer := tls.Client(dialer, conf)\n    client, err := smtp.NewClient(tlsdialer, \"smtp.gmail.com:465\")\n</code></pre>\n\n<p>Alternatively you could use port 587 which requires explicit TLS:</p>\n\n<pre><code>func Connect() {\n    dialer, err := Socks(\"127.0.0.1:9050\", \"smtp.gmail.com:587\")\n    ...\n    conf := &amp;tls.Config{ServerName: \"smtp.gmail.com\"}\n    err = client.StartTLS(conf)\n    ...\n    auth := smtp.PlainAuth(\"\", \"mymailaddr@gmail.com\", \"\", \"smtp.gmail.com:587\")\n    if err = client.Auth(auth); err != nil {\n    ...\n</code></pre>\n"}], "owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1388, "favorite_count": 2, "accepted_answer_id": 51856860, "answer_count": 1, "score": 0, "last_activity_date": 1534328528, "creation_date": 1534324895, "question_id": 51856084, "link": "https://stackoverflow.com/questions/51856084/custom-dialer-for-smtp-client-in-golang", "title": "Custom dialer for smtp client in Golang?", "body": "<p>I'm try connect to smtp server via socks5 proxy</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"net/smtp\"\n\n    \"golang.org/x/net/proxy\"\n)\n\nfunc main() { Connect() }\nfunc Connect() {\n    dialer, err := Socks(\"127.0.0.1:9050\", \"smtp.gmail.com:465\")\n    if err != nil {\n        panic(err)\n    }\n    client, err := smtp.NewClient(dialer, \"smtp.gmail.com:465\")\n    if err != nil {\n        panic(err)\n    }\n    auth := smtp.PlainAuth(\"\", \"mymailaddr@gmail.com\", \"\", \"smtp.gmail.com:465\")\n    if err = client.Auth(auth); err != nil {\n        panic(err)\n    }\n}\n\nfunc Socks(socks, addr string) (r net.Conn, err error) {\n    Dial, err := proxy.SOCKS5(\"tcp\", socks, nil, proxy.Direct)\n    r, err = Dial.Dial(\"tcp\", addr)\n    return\n}\n</code></pre>\n\n<p>And can't it, have error </p>\n\n<pre><code>panic: EOF\n\ngoroutine 1 [running]:\nmain.Connect()\n        main.go:18 +0x1e5\nmain.main()\n        main.go:10 +0x20\nexit status 2\n</code></pre>\n\n<p>Does <code>smtp.Client</code> can any method to connect smtp server with socks proxy? I'm not found answer in Google and not found any library provide this features.</p>\n"}, {"tags": ["windows", "go", "dll", "dllimport", "static-linking"], "comments": [{"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 1, "creation_date": 1534323711, "post_id": 51855473, "comment_id": 90663833, "body": "As a workaround can you extend the startup timeout when you register the service?"}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "reply_to_user": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1534324788, "post_id": 51855473, "comment_id": 90664261, "body": "yes this would be a workaround. but this service runs on many customer machines, and i dont know potential side effects of this :/ as i know, you can edit this just globally and not for a specific service"}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1534364584, "post_id": 51855473, "comment_id": 90683972, "body": "Still, it seems a little surprising that you can&#39;t load a few DLLs before getting timed out. Is there a way for us to reproduce this?"}, {"owner": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 0, "creation_date": 1534423574, "post_id": 51855473, "comment_id": 90706055, "body": "What is the timeframe that we&#39;re talking about here? Are you sure that the problem isn&#39;t elsewhere (e.g. a glitch in your executable - which is also loaded from disk <i>BTW</i>, or when loading a custom <i>.dll</i>)? I don&#39;t know how you build your executable, but check <a href=\"https://msdn.microsoft.com/en-us/library/yx9zd12s.aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/yx9zd12s.aspx</a> (that option will only load a <i>.dll</i> when 1st needed instead of program startup)."}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1534511074, "post_id": 51855473, "comment_id": 90742747, "body": "for reproduce: use <a href=\"https://github.com/shirou/gopsutil\" rel=\"nofollow noreferrer\">github.com/shirou/gopsutil</a> within the service wrapper: <a href=\"https://github.com/kardianos/service\" rel=\"nofollow noreferrer\">github.com/kardianos/service</a> the service works 100% if i remove this repo from my source. and if you scroll through the gopsutil source you will find many dll imports."}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1534340170, "post_id": 51856663, "comment_id": 90671719, "body": "Those dlls which i mean are: kernel32.dll, user32.dll etc. Just official windows dlls, nothing more."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 1, "creation_date": 1534352872, "post_id": 51856663, "comment_id": 90678713, "body": "If yes, I would bet your problem really lies elsewhere: these DLLs do not cause any problem for everyone else&#39;s code."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 2, "last_activity_date": 1534327226, "creation_date": 1534327226, "answer_id": 51856663, "question_id": 51855473, "link": "https://stackoverflow.com/questions/51855473/can-i-build-a-go-program-while-statically-linking-some-dlls-with-it/51856663#51856663", "title": "Can I build a Go program while statically linking some DLLs with it?", "body": "<p>The short answer is \"no\": \"DLL\" stands for \"Dynamically-Linked Library\", and it's impossible to link a DLL statically.</p>\n\n<p>Basically you have two ways to go, I would say:</p>\n\n<ul>\n<li><p>Debug the issue.</p>\n\n<p>The default timeout for a Windows service startup\nis 30000 ms; that is <em>a lot,</em> so I'm inclined to think\nyour issue it not loading of DLLs or at least not with\n<em>locating</em> and linking them in.</p>\n\n<p>The usual approach is two-pronged:</p>\n\n<ul>\n<li><p>Isolate possible cases. First, turn your service into\na simple (say, console) program, and see how it starts up\nwith the cold cache. If the behaviour persists, it will be simpler\nto debug than the service.</p></li>\n<li><p>Study whether some of your DLLs does silly things\nlike performing network requests in their entry-point function\n(colloquially known as \"DllMain\").</p>\n\n<p>If you're loading the DLLs using <code>LoadLibrary[Ex]</code>,\ntheir entry point is called upon those calls.</p>\n\n<p>With that in mind, try adding some tracing to your\nDLL initialization code.</p></li>\n</ul>\n\n<p>If all that fails, try <code>procmon</code> of Sysinternals fame\nor similar tools.</p></li>\n<li><p>Get / produce <em>static</em> builds of those libraries\u2014you will then\nbe able to link them in statically.</p>\n\n<p>But note that if the issue is in fact has something to deal\nwith the initialization of those libs, linking them in statically\nwon't buy you anything\u2014they will be slow already linked, that is.</p></li>\n</ul>\n\n<hr>\n\n<p>I'd also note that if my shot in the dark was correct,\nand one or more of yout libs tries to access some networked\nresource, a simple way to solve the problem might be implementing\nproper dependencies for your service\u2014so that it starts up only\nwhen the services it depends on functioning are up (such as\nnetworking, DNS etc).</p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1536696339, "creation_date": 1536696339, "answer_id": 52283495, "question_id": 51855473, "link": "https://stackoverflow.com/questions/51855473/can-i-build-a-go-program-while-statically-linking-some-dlls-with-it/52283495#52283495", "title": "Can I build a Go program while statically linking some DLLs with it?", "body": "<p>Consider using <a href=\"https://golang.org/pkg/syscall/?GOOS=windows&amp;GOARCH=amd64#LazyDLL\" rel=\"nofollow noreferrer\">LazyDll</a> to speed up your code.</p>\n"}], "owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1536696339, "creation_date": 1534322286, "last_edit_date": 1534332089, "question_id": 51855473, "link": "https://stackoverflow.com/questions/51855473/can-i-build-a-go-program-while-statically-linking-some-dlls-with-it", "title": "Can I build a Go program while statically linking some DLLs with it?", "body": "<p>If you ran a go app with Windows DLL dependencies on a slow hdd disk, it sometimes occurs that Windows takes too long to load those dll.</p>\n\n<p>If you put your go app into a windows service you get serious problems.</p>\n\n<p>Especially on slow hdd disks, this leads to windows service timeouts and the service will not start.</p>\n\n<p>Is it somehow possible to link those DLLs statically to the go app?</p>\n\n<p>Once the DLLs are loaded everything is fine, but it takes two attempts to get the service running.</p>\n\n<p>But after the first failure, Windows won't try to start the service again, so I have to manually start the service by myself.</p>\n\n<p>Anyone got some ideas?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1534325401, "last_edit_date": 1534325401, "creation_date": 1534319535, "answer_id": 51854863, "question_id": 51854815, "link": "https://stackoverflow.com/questions/51854815/how-do-files-in-go-run-go-gain-access-to-functions-without-an-import/51854863#51854863", "title": "How do files in `go run *.go` gain access to functions without an import?", "body": "<p>That example uses a single package, specifically the <code>main</code> package to implement everything.</p>\n\n<p>Every package may consist of multiple files, even the <code>main</code> package. Inside the package you don't import anything, you can access everything from the package. <a href=\"https://golang.org/ref/spec#Packages\" rel=\"nofollow noreferrer\">Spec: Packages:</a></p>\n\n<blockquote>\n  <p>Go programs are constructed by linking together packages. A package in turn is constructed from one or more source files that together declare constants, types, variables and functions belonging to the package and <strong>which are accessible in all files of the same package</strong>. Those elements may be <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a> and used in another package.</p>\n</blockquote>\n\n<p>When the special <code>main</code> package is broken into multiple files, that's when you have to list all when launching the app:</p>\n\n<pre><code>go run app.go auth.go template.go\n</code></pre>\n\n<p>If the example would be separated into multiple packages, only then would you have to import the other packges from <code>main</code> to access them.</p>\n"}], "owner": {"reputation": 3581, "user_id": 95055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b682b7e4db82aaca0ee9da21b7bbc840?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/95055/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 51854863, "answer_count": 1, "score": 2, "last_activity_date": 1534325401, "creation_date": 1534319283, "question_id": 51854815, "link": "https://stackoverflow.com/questions/51854815/how-do-files-in-go-run-go-gain-access-to-functions-without-an-import", "title": "How do files in `go run *.go` gain access to functions without an import?", "body": "<p>I'm following the <a href=\"https://cloud.google.com/go/getting-started/using-cloud-datastore\" rel=\"nofollow noreferrer\">Bookshelf tutorial</a> on building web services on Google App Engine.</p>\n\n<p>To start the app the tutorial runs <code>go run app.go auth.go template.go</code>. I don't understand how this works. For example, how is the <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/getting-started/bookshelf/app/app.go#L36\" rel=\"nofollow noreferrer\">parseTemplate method</a> from <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/getting-started/bookshelf/app/template.go\" rel=\"nofollow noreferrer\">template.go</a> used in <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/getting-started/bookshelf/app/app.go\" rel=\"nofollow noreferrer\">app.go</a> without an import statement for <code>template.go</code>? </p>\n\n<p>My understanding is that in a Go project we have an entry point file that has a main method. That file then imports packages to use them internally. What is the advantage of running these three files at once?</p>\n"}, {"tags": ["selenium", "go"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534315256, "post_id": 51854009, "comment_id": 90660447, "body": "Are you sure that you have something listening on port 4444 on localhost?"}, {"owner": {"reputation": 46, "user_id": 10039525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a201bdeb94a877c8ac552bfcab945eb3?s=128&d=identicon&r=PG&f=1", "display_name": "bad", "link": "https://stackoverflow.com/users/10039525/bad"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534315610, "post_id": 51854009, "comment_id": 90660578, "body": "What do you mean? Using the go-selenium package, I am trying to create a new selenium session, which &quot;resides&quot; at port 4444"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1534316952, "post_id": 51854009, "comment_id": 90661069, "body": "And it could not establish connection. It&#39;s the other side that did not accept the connection. Try telnet manually first."}], "owner": {"reputation": 46, "user_id": 10039525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a201bdeb94a877c8ac552bfcab945eb3?s=128&d=identicon&r=PG&f=1", "display_name": "bad", "link": "https://stackoverflow.com/users/10039525/bad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 591, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534316569, "creation_date": 1534314935, "last_edit_date": 1534316569, "question_id": 51854009, "link": "https://stackoverflow.com/questions/51854009/go-selenium-no-connection-could-be-made-because-the-target-machine-actively-ref", "title": "Go-selenium: No connection could be made because the target machine actively refused it", "body": "<p>I tried going to windows firewall and opening port 4444, however this still does not work. This is the complete error I'm getting: </p>\n\n<pre><code>Failed to open session: Post http://localhost:4444/wd/hub/session: dial tcp [::1]:4444: connectex: No connection could be made because the target machine actively refused it.\n</code></pre>\n\n<p>And lastly this is the package I'm using: \"sourcegraph.com/sourcegraph/go-selenium\". I never ran into this problem in python but I assume the whole application was allowed through the firewall, so if I could do that for go that would be great.</p>\n\n<p>Edit: All my code (stolen from the github example)</p>\n\n<pre><code>package main\n\nimport (\n    \"sourcegraph.com/sourcegraph/go-selenium\"\n    \"fmt\"\n)\n\nfunc ExampleFindElement() {\n    var webDriver selenium.WebDriver\n    var err error\n    caps := selenium.Capabilities(map[string]interface{}{\"browserName\": \"firefox\"})\n    if webDriver, err = selenium.NewRemote(caps, \"http://localhost:4444/wd/hub\"); err != nil {\n        fmt.Printf(\"Failed to open session: %s\\n\", err)\n        return\n    }\n    defer webDriver.Quit()\n\nerr = webDriver.Get(\"https://sourcegraph.com/sourcegraph/go-selenium\")\nif err != nil {\n    fmt.Printf(\"Failed to load page: %s\\n\", err)\n    return\n}\n\nif title, err := webDriver.Title(); err == nil {\n    fmt.Printf(\"Page title: %s\\n\", title)\n} else {\n    fmt.Printf(\"Failed to get page title: %s\", err)\n    return\n}\n\nvar elem selenium.WebElement\nelem, err = webDriver.FindElement(selenium.ByCSSSelector, \".repo .name\")\nif err != nil {\n    fmt.Printf(\"Failed to find element: %s\\n\", err)\n    return\n}\n\nif text, err := elem.Text(); err == nil {\n    fmt.Printf(\"Repository: %s\\n\", text)\n} else {\n    fmt.Printf(\"Failed to get text of element: %s\\n\", err)\n    return\n}\n\n// output:\n// Page title: go-selenium - Sourcegraph\n// Repository: go-selenium\n}\n\nfunc main() {\n    ExampleFindElement()\n}\n</code></pre>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1534312290, "post_id": 51853528, "comment_id": 90659566, "body": "The bash script exit?  Try simple script with <code>echo something</code> for example.  Also check <a href=\"https://golang.org/pkg/os/exec/#CommandContext\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#CommandContext</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1534312367, "post_id": 51853528, "comment_id": 90659581, "body": "Btw, you leave <code>f</code> not closed if <code>io.Copy</code> or <code>cmd.Wait</code> return an error. That&#39;s why <code>defer f.Close()</code> would be preferred."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 7, "last_activity_date": 1534488189, "last_edit_date": 1534488189, "creation_date": 1534313744, "answer_id": 51853792, "question_id": 51853528, "link": "https://stackoverflow.com/questions/51853528/script-command-execution-hung-forever-in-go-program/51853792#51853792", "title": "script command execution hung forever in go program", "body": "<p>From the <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdoutPipe\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>Wait will close the pipe after seeing the command exit.</p>\n</blockquote>\n\n<p>In other words, io.Copy exits when Wait() is called, but Wait is never called because it's blocked by Copy. Either run Copy in a goroutine, or simply assign <code>f</code> to <code>cmd.Stdout</code>:</p>\n\n<pre><code>f, err := os.Create(filepath.Join(\"/opt/log/\", \"execution.log\"))\n// TODO: Handle error\ndefer f.Close()\n\ncmd := exec.Command(\"bash\", \"/opt/AlterKafkaTopic.sh\")\ncmd.Stdout = f\nerr = cmd.Run()\n</code></pre>\n"}], "owner": {"reputation": 122, "user_id": 2728010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf368fa3f6bd958386a88440864b6330?s=128&d=identicon&r=PG&f=1", "display_name": "sks", "link": "https://stackoverflow.com/users/2728010/sks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 51853792, "answer_count": 1, "score": 1, "last_activity_date": 1534488189, "creation_date": 1534311931, "question_id": 51853528, "link": "https://stackoverflow.com/questions/51853528/script-command-execution-hung-forever-in-go-program", "title": "script command execution hung forever in go program", "body": "<pre><code>func Run() error {\n    log.Info(\"In Run Command\")\n    cmd := exec.Command(\"bash\", \"/opt/AlterKafkaTopic.sh\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n            return err\n    }\n    if err = cmd.Start(); err != nil {\n           return err\n    }\n    f, err := os.Create(filepath.Join(\"/opt/log/\", \"execution.log\"))\n    if err != nil {\n            return err\n    }\n    if _, err := io.Copy(f, stdout); err != nil {\n            return err\n    }\n         if err := cmd.Wait(); err != nil {\n            return err\n    }\n     return f.Close()\n</code></pre>\n\n<p>}</p>\n\n<p>I am trying to execute a bash script from go code. The script changes some kafka topic properties. But the execution get hung <code>io.Copy(f, stdout)</code> and does not continue after it. \nThis program is running on RHEL7.2 server.</p>\n\n<p>Could someone suggest where I am going wrong</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1534305386, "post_id": 51852678, "comment_id": 90658015, "body": "It might be something with how the OS operates 32 bytes vs 64. Instead of casting to a uint32 try just an uint and let go decide how to handle, seems like some kind of overflow, uint32 max value is 4294967295 <a href=\"https://goplay.space/#dBEy8OeNk37\" rel=\"nofollow noreferrer\">goplay.space/#dBEy8OeNk37</a>"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 2, "creation_date": 1534310275, "post_id": 51852678, "comment_id": 90659121, "body": "<code>int</code> in Go is equivalent on <code>int64</code> on <code>x64</code> systems and is equivalent of <code>int32</code> on <code>x32</code> systems."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 3, "creation_date": 1534322201, "post_id": 51852678, "comment_id": 90663159, "body": "@KavehShahbazian, a nitpick: please be careful with that <code>x32</code> name: technically it describes a particular <a href=\"https://en.wikipedia.org/wiki/X32_ABI\" rel=\"nofollow noreferrer\">Linux ABI</a> which has 64-bit wide ints while having 32-bit wide pointers. If you want to refer to a &quot;usual&quot; 32-bit system, it&#39;s better to just say 32-bit or something like <code>i386</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 2, "creation_date": 1534316114, "post_id": 51853321, "comment_id": 90660777, "body": "TIL - this is interesting as this makes the code platform dependent (by this I mean int size being dependent on the platform). Thanks for your answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 11, "last_activity_date": 1534313893, "last_edit_date": 1534313893, "creation_date": 1534310227, "answer_id": 51853321, "question_id": 51852678, "link": "https://stackoverflow.com/questions/51852678/int-vs-int32-return-value/51853321#51853321", "title": "int vs int32 return value", "body": "<p>The textbook you are looking for is</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"noreferrer\">Numeric types</a> </p>\n  \n  <p>A numeric type represents sets of integer or floating-point values.\n  The predeclared architecture-independent numeric types are:</p>\n\n<pre><code>uint32 set of all unsigned 32-bit integers (0 to 4294967295)\nuint64 set of all unsigned 64-bit integers (0 to 18446744073709551615)\n\nint32  set of all signed 32-bit integers (-2147483648 to 2147483647)\nint64  set of all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)\n</code></pre>\n  \n  <p>There is also a set of predeclared numeric types with\n  implementation-specific sizes: </p>\n\n<pre><code>uint either 32 or 64 bits\nint  same size as uint\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Check the size of type <code>int</code>. On the Go Playground it's 4 bytes or 32 bits.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"unsafe\"\n)\n\nfunc main() {\n    fmt.Println(\"arch\", runtime.GOARCH)\n    fmt.Println(\"int\", unsafe.Sizeof(int(0)))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/2A6ODvhb1Dx\" rel=\"noreferrer\">https://play.golang.org/p/2A6ODvhb1Dx</a></p>\n\n<p>Output (Playground):</p>\n\n<pre><code>arch amd64p32\nint 4\n</code></pre>\n\n<p>Run the program in your (LeetCode) environment. It's likely 8 bytes or 64 bits.</p>\n\n<p>For example, in my environment,</p>\n\n<p>Output (Local):</p>\n\n<pre><code>arch amd64\nint 8\n</code></pre>\n\n<hr>\n\n<p>Here are some fixes to your code,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n    fmt.Println(runtime.GOARCH)\n    fmt.Printf(\"%v\\n\", singleNumber([]int{-2, -2, 1, 1, -3, 1, -3, -3, -4, -2}))\n}\n\nfunc singleNumber(nums []int) int {\n    sum := make([]int, 64)\n\n    for _, v := range nums {\n        for i := range sum {\n            sum[i] += 1 &amp; (v &gt;&gt; uint(i))\n        }\n    }\n\n    res := 0\n    for k, v := range sum {\n        if (v % 3) != 0 {\n            res |= (v % 3) &lt;&lt; uint(k)\n        }\n    }\n    fmt.Printf(\"res %+v\\n\", res)\n    return res\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/kaoSuesu2Oj\" rel=\"noreferrer\">https://play.golang.org/p/kaoSuesu2Oj</a></p>\n\n<p>Output (Playground):</p>\n\n<pre><code>amd64p32\nres -4\n-4\n</code></pre>\n\n<p>Output (Local):</p>\n\n<pre><code>amd64\nres -4\n-4\n</code></pre>\n"}], "owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5032, "favorite_count": 1, "accepted_answer_id": 51853321, "answer_count": 1, "score": 2, "last_activity_date": 1575702965, "creation_date": 1534304831, "last_edit_date": 1575702965, "question_id": 51852678, "link": "https://stackoverflow.com/questions/51852678/int-vs-int32-return-value", "title": "int vs int32 return value", "body": "<p>I am running into an issue, which seems to be related to <code>int32</code> vs <code>int</code> data type. My program is returning different values on different environments. </p>\n\n<p>For example, on go playground, I notice the value returned is -4 (which is expected value). But the same on Leetcode with same input returns a value of 4294967292. While it returned this value, when I print it, I get -4 (see output added later). </p>\n\n<p>I tried casting to <code>int32(res)</code> but didn't help. Also didn't find any directly related in textbook. Please help me understand why this is different on go playground vs Leetcode.</p>\n\n<p><a href=\"https://play.golang.org/p/qXMd9frlhbe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qXMd9frlhbe</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Printf(\"%v\", singleNumber([]int{-2,-2,1,1,-3,1,-3,-3,-4,-2}))\n}\n\nfunc singleNumber(nums []int) int {\n    sum := make([]int, 32)\n\n    for _, v := range nums {\n        for i := 0; i &lt; 32; i++ {\n            if sum[i] != 0 {\n                sum[i] += 1 &amp; (v &gt;&gt; uint32(i))\n            } else {\n                sum[i] = 1 &amp; (v &gt;&gt; uint32(i))\n            }\n        }\n    }\n\n    res := 0 \n    for k, v := range sum {\n        if (v%3) != 0 {\n            res |= (v%3) &lt;&lt; uint32(k) \n        }\n    }\n    fmt.Printf(\"res %+v\\n\", res)\n    return res\n}\n</code></pre>\n\n<p>Same on Leetcode gives the output: </p>\n\n<pre><code>Input:\n[-2,-2,1,1,-3,1,-3,-3,-4,-2]\nOutput:\n4294967292\nExpected:\n-4\nStdout:\nres -4\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 342, "user_id": 6339960, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nrit3el3TBA/AAAAAAAAAAI/AAAAAAAAAB8/Z4ot0NGedq8/photo.jpg?sz=128", "display_name": "Christian Lim", "link": "https://stackoverflow.com/users/6339960/christian-lim"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1534307230, "post_id": 51852483, "comment_id": 90658421, "body": "Okay so changing the case indeed fixed the issue... I didn&#39;t think of exportable variable. Thanks for the answer! Please put the answer on an answer btw, rather than comment"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1534307831, "post_id": 51852483, "comment_id": 90658555, "body": "I&#39;m pretty sure this is a duplicate (hence the comments) but my search abilities are lacking today."}, {"owner": {"reputation": 342, "user_id": 6339960, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nrit3el3TBA/AAAAAAAAAAI/AAAAAAAAAB8/Z4ot0NGedq8/photo.jpg?sz=128", "display_name": "Christian Lim", "link": "https://stackoverflow.com/users/6339960/christian-lim"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1534316475, "post_id": 51852483, "comment_id": 90660902, "body": "I&#39;ve been searching as well but couldn&#39;t find the answer.  Maybe someone else with totally different problems and different symptoms have the same solution as mine. I guess it&#39;s because the title only says the symptoms and not the solution."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 3, "last_activity_date": 1534307760, "creation_date": 1534307760, "answer_id": 51853031, "question_id": 51852483, "link": "https://stackoverflow.com/questions/51852483/gorm-always-return-structs-with-nil-values/51853031#51853031", "title": "Gorm always return structs with nil values", "body": "<p>All the fields in your <code>gameCenterlog</code> struct are lower case so they're not exported. Non-exported fields are invisible to reflection so they're invisible to Gorm.</p>\n\n<p>If you capitalize the fields:</p>\n\n<pre><code>type gameCenterLog struct {\n    Tm      time.Time\n    Seq     int\n    Uid     int\n    ...\n</code></pre>\n\n<p>then Gorm will be able to see them give values. Gorm should be able to figure out the mapping from the column names in PostgreSQL to the struct fields in Go but you can use <code>gorm:\"column:...\"</code> <a href=\"http://doc.gorm.io/models.html#conventions\" rel=\"nofollow noreferrer\">struct tags</a> if it doesn't.</p>\n"}], "owner": {"reputation": 342, "user_id": 6339960, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nrit3el3TBA/AAAAAAAAAAI/AAAAAAAAAB8/Z4ot0NGedq8/photo.jpg?sz=128", "display_name": "Christian Lim", "link": "https://stackoverflow.com/users/6339960/christian-lim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 0, "accepted_answer_id": 51853031, "answer_count": 1, "score": 0, "last_activity_date": 1534317595, "creation_date": 1534303038, "last_edit_date": 1534317595, "question_id": 51852483, "link": "https://stackoverflow.com/questions/51852483/gorm-always-return-structs-with-nil-values", "title": "Gorm always return structs with nil values", "body": "<p>I'm building a Go web API with Gorm as the ORM for Postgresql databases in Amazon RDS. Problem is Gorm always gives back a slice of structs which values are all nil, although the database is already populated with data. The number of structs in the slice are proper depending on the <code>LIMIT</code> I gave.</p>\n\n<p>I've also tried to directly query the SQL using <code>database/sql</code> builtin package, manually insert the variable inside <code>rows.Next()</code> loop and it works with no problem. I've tried this with 3 different tables with 3 different structs (obviously) and the result are all the same. So I guess it's a problem in the Gorm side. One of the table is given as example below.</p>\n\n<p><strong>Struct structure</strong></p>\n\n<pre><code>type gameCenterLog struct {\n    tm      time.Time\n    seq     int\n    uid     int\n    partner int\n    token   sql.NullString\n    bounty  int\n    path1   sql.NullString\n    path2   sql.NullString\n    path3   sql.NullString\n    action  sql.NullString\n    value1  sql.NullString\n    value2  sql.NullString\n    value3  sql.NullString\n    value4  sql.NullString\n    value5  sql.NullString\n}\nfunc (log *gameCenterLog) TableName() string {\n    return \"gamecenter_log\"\n}\n</code></pre>\n\n<p><strong>Example of the Gorm query</strong></p>\n\n<pre><code>func testGorm() {\n    connString := fmt.Sprintf(\"host=%v port=%v user=%v password=%v dbname=%v\", host, port, user, pass, schema)\n    db, err := gorm.Open(\"postgres\", connString)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n\n    var logs []gameCenterLog\n\n    today := time.Now().UTC()\n    lastWeek := time.Now().Add(-7 * 24 * time.Hour).UTC()\n\n    db.Debug().Where(\"tm BETWEEN ? AND ?\", lastWeek, today).Order(\"tm desc\").Limit(limit).Find(&amp;logs)\n    fmt.Printf(\"Error: %+v\\n\", db.Error)\n    for _, result := range logs {\n        fmt.Printf(\"%+v\\n\", result)\n    }\n}\n</code></pre>\n\n<p><strong>Gorm Result</strong></p>\n\n<pre><code>[2018-08-15 09:57:15]  [1429.58ms]  SELECT * FROM \"gamecenter_log\"  WHERE (tm BETWEEN '2018-08-08 02:57:14' AND '2018-08-15 02:57:14') ORDER BY tm desc LIMIT 10  \n[10 rows affected or returned ] \nError: &lt;nil&gt;\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:0 loc:&lt;nil&gt;} seq:0 uid:0 partner:0 token:{String: Valid:false} bounty:0 path1:{String: Valid:false} path2:{String: Valid:false} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n</code></pre>\n\n<p><em>Notice all results are nill and there are no error in the result...</em></p>\n\n<p><strong>Now with <code>database/sql</code></strong></p>\n\n<pre><code>func testSQL() {\n    connString := fmt.Sprintf(\"host=%v port=%v user=%v password=%v dbname=%v\", host, port, user, pass, schema)\n    db, err := sql.Open(\"postgres\", connString)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n\n    today := time.Now().UTC()\n    lastWeek := time.Now().Add(-7 * 24 * time.Hour).UTC()\n\n    query := fmt.Sprintf(\"SELECT * FROM \\\"%v\\\" WHERE (%v BETWEEN '%d-%02d-%02d %02d:%02d:%02d' AND '%d-%02d-%02d %02d:%02d:%02d') ORDER BY %v LIMIT %v\",\n        \"gamecenter_log\", \"tm\",\n        lastWeek.Year(), lastWeek.Month(), lastWeek.Day(), lastWeek.Hour(), lastWeek.Minute(), lastWeek.Second(),\n        today.Year(), today.Month(), today.Day(), today.Hour(), today.Minute(), today.Second(),\n        \"tm desc\", limit)\n    fmt.Println(query)\n    rows, err := db.Query(query)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    results := []gameCenterLog{}\n    for rows.Next() {\n        result := gameCenterLog{}\n        err := rows.Scan(\n            &amp;result.tm, &amp;result.seq, &amp;result.uid,\n            &amp;result.partner, &amp;result.token, &amp;result.bounty,\n            &amp;result.path1, &amp;result.path2, &amp;result.path3, &amp;result.action,\n            &amp;result.value1, &amp;result.value2, &amp;result.value3, &amp;result.value4, &amp;result.value5,\n        )\n        if err != nil {\n            panic(err.Error())\n        }\n        results = append(results, result)\n    }\n    for _, result := range results {\n        fmt.Printf(\"%+v\\n\", result)\n    }\n}\n</code></pre>\n\n<p><em>Here I manually <code>append</code> the <code>result</code> struct to the <code>results</code> slice</em></p>\n\n<p><strong>Raw SQL Result</strong></p>\n\n<pre><code>SELECT * FROM \"gamecenter_log\" WHERE (tm BETWEEN '2018-08-08 03:03:41' AND '2018-08-15 03:03:41') ORDER BY tm desc LIMIT 10\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846269 uid:16199265 partner:1 token:{String:1534274713356-bb09968a07 Valid:true} bounty:3 path1:{String:result Valid:true} path2:{String:Win Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846278 uid:16060021 partner:15 token:{String:1534272218332-2a6a0a3263 Valid:true} bounty:2 path1:{String:result Valid:true} path2:{String:Win Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String:102012 Valid:true} value2:{String:68368886 Valid:true} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846275 uid:14565958 partner:6 token:{String:1534277021722-d2f5a72098 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:PlayStart Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846279 uid:16060021 partner:15 token:{String:1534272218332-2a6a0a3263 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:PlayEnd Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String:68368886 Valid:true} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846268 uid:16199265 partner:1 token:{String:1534274713356-bb09968a07 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:PlayEnd Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String: Valid:false} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846270 uid:16199265 partner:1 token:{String:1534274713356-bb09968a07 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:Custom Valid:true} path3:{String: Valid:false} action:{String:PemulaGameWin Valid:true} value1:{String:9700600 Valid:true} value2:{String:20000 Valid:true} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846280 uid:7627835 partner:15 token:{String:1534256412228-80b0aacd5b Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:PlayStart Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String:66729274 Valid:true} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899021 loc:0xc420113c20} seq:1534276846277 uid:10212903 partner:4 token:{String:1534270203280-7875331136 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:Custom Valid:true} path3:{String: Valid:false} action:{String:ExpertLose Valid:true} value1:{String:+9.50K Valid:true} value2:{String:5000 Valid:true} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899020 loc:0xc420113c20} seq:1534276846208 uid:13016587 partner:15 token:{String:1534265134142-ed98a488f1 Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:PlayStart Valid:true} path3:{String: Valid:false} action:{String: Valid:false} value1:{String:67935379 Valid:true} value2:{String: Valid:false} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n{tm:{wall:0 ext:63669899020 loc:0xc420113c20} seq:1534276846265 uid:15125780 partner:1 token:{String:1534267652681-cfb8846eae Valid:true} bounty:0 path1:{String:track Valid:true} path2:{String:Custom Valid:true} path3:{String: Valid:false} action:{String:AhliGameLose Valid:true} value1:{String:-1000000 Valid:true} value2:{String:1000000 Valid:true} value3:{String: Valid:false} value4:{String: Valid:false} value5:{String: Valid:false}}\n</code></pre>\n\n<p>The result comes out no problem.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1534298555, "post_id": 51851938, "comment_id": 90656725, "body": "<a href=\"https://stackoverflow.com/questions/24809235/initialize-a-nested-struct-in-golang\" title=\"initialize a nested struct in golang\">stackoverflow.com/questions/24809235/&hellip;</a>"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 4, "creation_date": 1534299041, "post_id": 51851938, "comment_id": 90656815, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24809235/initialize-a-nested-struct-in-golang\">Initialize a nested struct in Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "is_accepted": true, "score": 0, "last_activity_date": 1535601746, "last_edit_date": 1535601746, "creation_date": 1534310513, "answer_id": 51853355, "question_id": 51851938, "link": "https://stackoverflow.com/questions/51851938/golang-mapping-struct-to-map/51853355#51853355", "title": "Golang mapping struct to map", "body": "<p>There are a number of easy to conflate issues going on here.</p>\n\n<h3>Output:</h3>\n\n<p>First and foremost is you're not specifying any particular output formatting. \nUsing fmt.Println to output data structures is really just for easy debugging, the formatting is pretty arbitrary you could get more reliably formatted output in correct Go if you used <code>fmt.Printf(\"%#v\\n\", i)</code>. The default Println outputs the equvelent of Printf's \"%v\".</p>\n\n<p>To get output in a particular format (other then Go itself) you'll need to import a package that can generate that format. Luckily a few popular formats are included in the standard library. But before we can get to that there are a few other things to fix / understand.</p>\n\n<h3>Exports:</h3>\n\n<p>Capitalized members of a struct are exported lower case members are not. This means that \"url\"in your image structure <em>MUST</em> be capitalized or else packages such as <code>encoding/json</code> will be unable to access the member to export it. </p>\n\n<h3>Anonymous Types:</h3>\n\n<p>Others emphasize creating explicit definitions for each of the structured data types in the overall structure, and I think that is generally good advice. However, it is also often silly to have so many one off type definitions floating around, so it is completely acceptable in the language to use inline anonymous structure definitions. Also a nice touch is that identically structured anonymous types are accepted as the same type unlike defined types.</p>\n\n<p>Here's an, admittedly pathological, example of doing the above with anonymous structs.</p>\n\n<pre><code>i := struct{\n    Data interface{} `json:\"data\"`\n}{\n    Data:struct{\n        Image interface{} `json:\"image\"`\n    } {\n        Image:struct{\n            Url string `json:\"url\"`\n        }{\n            Url:\"test.jpg\",\n        },\n    },\n}\n</code></pre>\n\n<p>While this works it's pretty messy. But notice you can even add tags to the fields of anonymous types so json formatting translates as intended.</p>\n\n<p>Another way to do it anonymously and avoid all this <code>type</code> definition crazy is just use a map. Here's that example. Note however, that some Go cargo cultists will yell at you if they see you using <code>map[string]interface{}</code> everywhere. Nevertheless there's actually nothing wrong with it either in practice or in philosophy.</p>\n\n<pre><code>j := map[string]interface{} {\n    \"data\":map[string]interface{}{\n        \"image\":map[string]interface{}{\n            \"url\":\"test.jpg\",\n        },\n    },\n}\n</code></pre>\n\n<p>Generally however, you want to take advantage of what a typed language can give you. Strongly typed languages like Go are very good at finding otherwise subtile bugs early on. </p>\n\n<p>And isn't this better looking:</p>\n\n<pre><code>type Object map[string]interface{}\n\n// ...\n\nj := Object{\n    \"data\": Object{\n        \"image\": Object{\n            \"url\":\"test.jpg\",\n        },\n    },\n}\n</code></pre>\n\n<h3>Once More With Encoding</h3>\n\n<p>Here's your program in a more idiomatic style. Which, not coincidentally, is also more readable in my opinion.</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"encoding/json\"\n    )\n\n    type data struct {\n        Image image `json:\"image\"`\n    }\n\n    type image struct {\n        Url string `json:\"url\"`\n    }\n\n    type images struct {\n        Data data `json:\"data\"`\n    }\n\n\n    func main() {\n        i := images{Data: data{Image: image{Url: \"test.jpg\"}}}\n\n        data, _ := json.Marshal(i)\n        fmt.Println(string(data))\n\n    }\n</code></pre>\n\n<p>Also note that while you must export the members to have them appear in the json, you do not have to export the types themselves. </p>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1876, "favorite_count": 0, "accepted_answer_id": 51853355, "answer_count": 1, "score": 0, "last_activity_date": 1535601746, "creation_date": 1534298261, "last_edit_date": 1534300577, "question_id": 51851938, "link": "https://stackoverflow.com/questions/51851938/golang-mapping-struct-to-map", "title": "Golang mapping struct to map", "body": "<p>Here is my data structure and trying to create a struct for this data but failing within error.</p>\n\n<pre><code>{\n                \"data\": {\n                  \"image\": {\n                    \"url\": \"tests.jpg\"\n                  }\n                }\n              }\n</code></pre>\n\n<p>Error:-</p>\n\n<pre><code>prog.go:16:20: invalid field name \"Data\" in struct initializer\nprog.go:16:22: missing type in composite literal\n</code></pre>\n\n<p>Code:-</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Images struct {\n    Data struct {\n        Image struct {\n            url string\n        }\n    }\n}\n\nfunc main() {\n    i := Images{\"Data\": {\"Image\": {\"url\": \"test.jpg\"}}}\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>After reading the below answer, I tried this - </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n//{ \"data\": {\n//                  \"image\": {\n//                    \"url\": \"tests.jpg\"\n//                  }\n//                }\n//              }\n\ntype Images struct {\n    Data Data\n}\ntype Data struct {\n    Image Image\n}\n\ntype Image struct {\n    url string\n}\n\nfunc main() {\n    i := Images{\n        Data: Data{\n            Image: Image{url: \"test.jpg\"}}}\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Final output:- </p>\n\n<pre><code>{{{test.jpg}}}\n</code></pre>\n"}, {"tags": ["string", "go", "split"], "comments": [{"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 0, "creation_date": 1534295435, "post_id": 51851597, "comment_id": 90656175, "body": "You can try to search for <code>:</code>, and get the sub string via index, without a <code>split()</code> method."}, {"owner": {"reputation": 4059, "user_id": 8763847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k2myi.png?s=128&g=1", "display_name": "sayboras", "link": "https://stackoverflow.com/users/8763847/sayboras"}, "edited": false, "score": 0, "creation_date": 1534295753, "post_id": 51851597, "comment_id": 90656239, "body": "you can use <code>Regex</code> <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllString\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.FindAllString</a>"}], "answers": [{"tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": true, "score": 9, "last_activity_date": 1534299931, "last_edit_date": 1534299931, "creation_date": 1534298728, "answer_id": 51851997, "question_id": 51851597, "link": "https://stackoverflow.com/questions/51851597/how-to-split-golang-strings-without-deleting-separator/51851997#51851997", "title": "How to split Golang strings without deleting separator?", "body": "<p>You are looking for <a href=\"https://golang.org/pkg/strings/#SplitAfter\" rel=\"noreferrer\">SplitAfter</a>.</p>\n\n<pre><code>s := strings.SplitAfter(\"Potato:Salad:Popcorn:Cheese\", \":\")\n  for _, element := range s {\n  fmt.Println(element)\n}\n// Potato:\n// Salad:\n// Popcorn:\n// Cheese\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yPrIyBkEwCD\" rel=\"noreferrer\">Go Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 1, "creation_date": 1534553458, "post_id": 51869048, "comment_id": 90759537, "body": "As golang is open-source, a peek under the hood readily reveals SplitAfter&#39;s implementation. It utilizes the <code>genSplit</code> function: <a href=\"https://go.googlesource.com/go/+/master/src/strings/strings.go#240\" rel=\"nofollow noreferrer\">go.googlesource.com/go/+/master/src/strings/strings.go#240</a>"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1534389163, "last_edit_date": 1534389163, "creation_date": 1534388637, "answer_id": 51869048, "question_id": 51851597, "link": "https://stackoverflow.com/questions/51851597/how-to-split-golang-strings-without-deleting-separator/51869048#51869048", "title": "How to split Golang strings without deleting separator?", "body": "<p>The answer above by daplho great and simple. Sometimes I just like to provide an alternative to remove the magic of a function</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar s = \"Potato:Salad:Popcorn:Cheese\"\n\nfunc main() {\n    a := split(s, ':')\n    fmt.Println(a)\n}\n\nfunc split(s string, sep rune) []string {\n    var a []string\n    var j int\n    for i, r := range s {\n        if r == sep {\n            a = append(a, s[j:i+1])\n            j = i + 1\n        }\n    }\n    a = append(a, s[j:])\n    return a\n}\n</code></pre>\n\n<p><a href=\"https://goplay.space/#h9sDd1gjjZw\" rel=\"nofollow noreferrer\">https://goplay.space/#h9sDd1gjjZw</a></p>\n\n<p>As a side note, the standard lib version is better than the hasty one above </p>\n\n<pre><code>goos: darwin\ngoarch: amd64\nBenchmarkSplit-4             5000000           339 ns/op\nBenchmarkSplitAfter-4       10000000           143 ns/op\n</code></pre>\n\n<p>So go with that lol</p>\n"}, {"tags": [], "owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1559415613, "last_edit_date": 1559415613, "creation_date": 1559413093, "answer_id": 56409300, "question_id": 51851597, "link": "https://stackoverflow.com/questions/51851597/how-to-split-golang-strings-without-deleting-separator/56409300#56409300", "title": "How to split Golang strings without deleting separator?", "body": "<p><strong>Try this to get the proper result</strong>.</p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"strings\"\n    )\n\n    func main() {\n        str := \"Potato:Salad:Popcorn:Cheese\"\n        a := strings.SplitAfter(str, \":\")\n        for i := 0; i &lt; len(a); i++ {\n            fmt.Println(a[i])\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 322870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a52bfb506cf2e8990600163297dc1a8?s=128&d=identicon&r=PG", "display_name": "ASMach", "link": "https://stackoverflow.com/users/322870/asmach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1758, "favorite_count": 2, "accepted_answer_id": 51851997, "answer_count": 3, "score": 3, "last_activity_date": 1559415613, "creation_date": 1534295024, "question_id": 51851597, "link": "https://stackoverflow.com/questions/51851597/how-to-split-golang-strings-without-deleting-separator", "title": "How to split Golang strings without deleting separator?", "body": "<p>According to the answer at <a href=\"https://stackoverflow.com/questions/16551354/how-to-split-a-string-and-assign-it-to-variables-in-golang\">How to split a string and assign it to variables in Golang?</a> splitting a string results in an array of strings where the separator is not present in any of the strings in the array. Is there a way to split strings such that the separator is on the last line of a given string?</p>\n\n<p>e.x.</p>\n\n<pre><code>s := strings.split(\"Potato:Salad:Popcorn:Cheese\", \":\")\nfor _, element := range s {\n    fmt.Printf(element)\n}\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>Potato\nSalad\nPopcorn\nCheese\n</code></pre>\n\n<p>I wish to output the following instead:</p>\n\n<pre><code>Potato:\nSalad:\nPopcorn:\nCheese\n</code></pre>\n\n<p>I know I could theoretically append \":\" to the end of each element except for the last, but I'm looking for a more general, elegant solution if possible.</p>\n"}, {"tags": ["go", "stripe-payments"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534310548, "post_id": 51850927, "comment_id": 90659185, "body": "Your proxy isn&#39;t listening on <code>[::1]:3001</code>, or firewalled, or otherwise unreachable."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534346211, "post_id": 51850927, "comment_id": 90675294, "body": "@Peter The api is for stripe, so not sure what proxy you are referring to."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1534347766, "post_id": 51850927, "comment_id": 90676172, "body": "@Blankman this proxy: &quot;http: proxy error: dial tcp [::1]:3001:&quot;"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1534365940, "post_id": 51850927, "comment_id": 90684527, "body": "@AdamSmith That doesn&#39;t look like a stripe api call to me, it should be like api.stripe.com/v1/customers that is why I am confused."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1534366680, "post_id": 51850927, "comment_id": 90684817, "body": "@Blankman no, it&#39;s clearly not, that&#39;s why no one has responded saying how your code is wrong. Something seems borked about your network config."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1534449984, "post_id": 51850927, "comment_id": 90720719, "body": "@AdamSmith looks like it is because I am using <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">github.com/codegangsta/gin</a> for live reloading."}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534449966, "creation_date": 1534288633, "last_edit_date": 1592644375, "question_id": 51850927, "link": "https://stackoverflow.com/questions/51850927/listing-customers-using-the-go-stripe-api-client", "title": "Listing customers using the go stripe api client", "body": "<p>I am trying to list all my customers in stripe and I am getting this error:</p>\n<blockquote>\n<p>2018/08/14 19:14:21 Requesting GET api.stripe.com/v1/customers\n2018/08/14 19:14:21 http: proxy error: dial tcp [::1]:3001:</p>\n<p>getsockopt: connection refused</p>\n</blockquote>\n<p>The code snippet I am using is:</p>\n<pre><code>stripe.Key = &quot;sk_test_abc123&quot;\n\nparams := &amp;stripe.CustomerListParams{}\nparams.Filters.AddFilter(&quot;limit&quot;, &quot;&quot;, &quot;3&quot;)\ni := customer.List(params)\nfor i.Next() {\n    c := i.Customer()\n    fmt.Printf(&quot;customer is..\\n %v&quot;, c)\n}\n</code></pre>\n<p>I removed my stripe private test key ofcourse in the above snippet.</p>\n<p>Why would I be getting this type of error?  Is it my laptops firewall or something?</p>\n<p><b>Update</b></p>\n<p>It seems the issue is because I am using <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">https://github.com/codegangsta/gin</a> for live reloading.\nIs there a way to get this to work?</p>\n<p>I just ran my go project by doing:</p>\n<pre><code>go build\n./proj-name\n</code></pre>\n<p>And the API called worked fine.</p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "is_accepted": true, "score": 2, "last_activity_date": 1534283281, "creation_date": 1534283281, "answer_id": 51850207, "question_id": 51849954, "link": "https://stackoverflow.com/questions/51849954/programmatically-check-if-docker-container-process-ended-with-non-zero-status/51850207#51850207", "title": "Programmatically check if Docker container process ended with non-zero status", "body": "<p>I think you should use the status channel to get the exit code. The error channel seems to be used to signal if there was an error while talking to the docker daemon, see <a href=\"https://godoc.org/github.com/docker/docker/client#Client.ContainerWait\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/docker/docker/client#Client.ContainerWait</a>.</p>\n\n<p>This works for me:</p>\n\n<pre><code>select {\ncase err := &lt;-errCh:\n    if err != nil {\n        log.Fatal(err)\n    }\ncase status := &lt;-statusCh:\n    log.Printf(\"status.StatusCode: %#+v\\n\", status.StatusCode)\n}\n</code></pre>\n"}], "owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 0, "accepted_answer_id": 51850207, "answer_count": 1, "score": 4, "last_activity_date": 1534283281, "creation_date": 1534281802, "last_edit_date": 1534282104, "question_id": 51849954, "link": "https://stackoverflow.com/questions/51849954/programmatically-check-if-docker-container-process-ended-with-non-zero-status", "title": "Programmatically check if Docker container process ended with non-zero status", "body": "<p>I'm working on a Go application which starts some Docker containers using Go Docker SDK. I need to check if containers' processes exit with zero (success) status code.</p>\n\n<p>Here's the minimal working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"io\"\n    \"log\"\n    \"os\"\n\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/api/types/container\"\n    \"github.com/docker/docker/client\"\n)\n\nfunc main() {\n    ctx := context.Background()\n\n    cli, err := client.NewEnvClient()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    reader, err := cli.ImagePull(\n        ctx,\n        \"docker.io/library/alpine\",\n        types.ImagePullOptions{},\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n    io.Copy(os.Stdout, reader)\n\n    resp, err := cli.ContainerCreate(ctx, &amp;container.Config{\n        Image: \"alpine\",\n        Cmd:   []string{\"sh\", \"-c\", \"echo hello world; return 1\"},\n        Tty:   true,\n    }, nil, nil, \"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = cli.ContainerStart(\n        ctx,\n        resp.ID,\n        types.ContainerStartOptions{},\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    statusCh, errCh := cli.ContainerWait(\n        ctx,\n        resp.ID,\n        container.WaitConditionNotRunning,\n    )\n    select {\n    case err := &lt;-errCh:\n        if err != nil {\n            log.Fatal(err)\n        }\n    case &lt;-statusCh:\n    }\n\n    out, err := cli.ContainerLogs(\n        ctx,\n        resp.ID,\n        types.ContainerLogsOptions{ShowStdout: true},\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    io.Copy(os.Stdout, out)\n}\n</code></pre>\n\n<p>As you can see, the process in the container ends with non-zero status (<code>sh -c \"echo hello world; return 1\"</code>). However, it doesn't log any fatal errors and simply displays <code>hello world</code> when built and executed:</p>\n\n<pre><code>{\"status\":\"Pulling from library/alpine\",\"id\":\"latest\"}\n{\"status\":\"Digest: sha256:7043076348bf5040220df6ad703798fd8593a0918d06d3ce30c6c93be117e430\"}\n{\"status\":\"Status: Image is up to date for alpine:latest\"}\nhello world\n</code></pre>\n\n<p>How can I check that container process exited with non-zero status using Docker Go SDK?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 710, "user_id": 7636035, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QWgbB9_NIBc/AAAAAAAAAAI/AAAAAAAAZS4/HFMS7E9VfBw/photo.jpg?sz=128", "display_name": "Sergi Nadal", "link": "https://stackoverflow.com/users/7636035/sergi-nadal"}, "is_accepted": false, "score": 0, "last_activity_date": 1534313935, "creation_date": 1534313935, "answer_id": 51853826, "question_id": 51849941, "link": "https://stackoverflow.com/questions/51849941/unable-to-update-a-property-of-a-child-element-in-mongo-using-golang/51853826#51853826", "title": "Unable to update a property of a child element in Mongo using golang", "body": "<p>I think you are not usign correctly $set, check this example and adapt it to your language:</p>\n\n<pre><code>getCollection('collectionName').findOneAndUpdate(\n   {\"children.jiraId\":100}, //Search the subdocument\n   {$set:{\"children.$.isBloqued\":false}}}, //update the subdocument\n)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1534315772, "post_id": 51854028, "comment_id": 90660629, "body": "<code>mgo.v2</code> has been discontinued, but it lives on and is improved in <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">github.com/globalsign/mgo</a>."}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 2, "last_activity_date": 1534315066, "creation_date": 1534315066, "answer_id": 51854028, "question_id": 51849941, "link": "https://stackoverflow.com/questions/51849941/unable-to-update-a-property-of-a-child-element-in-mongo-using-golang/51854028#51854028", "title": "Unable to update a property of a child element in Mongo using golang", "body": "<blockquote>\n  <p>Update(repository.MongoSpec{Selector: bson.M{\"children\": bson.M{\"$elemMatch\": bson.M{\"jid\": \"100\"}}}, Query: bson.M{\"children\": bson.M{\"$set\": fields}}})</p>\n</blockquote>\n\n<p>If you specify only a single query condition in the <a href=\"https://docs.mongodb.com/manual/reference/operator/query/elemMatch/\" rel=\"nofollow noreferrer\">$elemMatch</a> expression, you do not need to use <code>$elemMatch</code>. Just use <a href=\"https://docs.mongodb.com/manual/core/document/#document-dot-notation\" rel=\"nofollow noreferrer\">dot notation</a> to access the elements of an array or embedded document. For example in <a href=\"https://docs.mongodb.com/manual/mongo/\" rel=\"nofollow noreferrer\">mongo</a> shell:</p>\n\n<pre><code>db.collection.update(\n      {\"children.jid\": \"100\"}, \n      {\"$set\":{\"children.$.field\":\"foobar\"}})\n</code></pre>\n\n<p>Notice that the update operator <a href=\"https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set\" rel=\"nofollow noreferrer\">$set</a> is specified first before any fields. See also <a href=\"https://docs.mongodb.com/manual/reference/operator/update/set/#set-fields-in-embedded-documents\" rel=\"nofollow noreferrer\">Set Fields in Embedded Documents</a>. </p>\n\n<p>Also, please note the additional <code>$</code> between the array field <code>children</code> and <code>field</code>. This is a <a href=\"https://docs.mongodb.com/manual/reference/operator/update/positional/#up._S_\" rel=\"nofollow noreferrer\">positional $ operator</a> to identifies an element in an array to update without explicitly specifying with position of the element in the array. For example, if you have two elements in <code>children</code> only apply the update operator to the element matching <code>jid=\"100\"</code>. </p>\n\n<p>Similarly using <code>mgo.v2</code>, you can specify: </p>\n\n<pre><code>err = c.Update(\n         bson.M{\"children.jid\":\"100\"}, \n         bson.M{\"$set\":bson.M{\"children.$.field\":\"foobar\"}}\n      )\n</code></pre>\n\n<p>Worth mentioning that <code>mgo.v2</code> has been discontinued, if you're starting a new project use <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> to support MongoDB v3.2 and above. </p>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534315066, "creation_date": 1534281728, "last_edit_date": 1534314283, "question_id": 51849941, "link": "https://stackoverflow.com/questions/51849941/unable-to-update-a-property-of-a-child-element-in-mongo-using-golang", "title": "Unable to update a property of a child element in Mongo using golang", "body": "<p>I am working on a mongo query in golang using mgo to update a child element property</p>\n\n<pre><code> {\n        \"_id\" : ObjectId(\"5b64a0d3931653c36bcaf0b5\"),\n        \"quantity\" : 2,\n        \"product\" : \"ABC\",   \n        \"children\" : [ \n            {     \"jiraId\":\"100\"      \n                \"isBlocked\" : true,\n                \"blockedMessage\" : \"Error occurred: TRACEID\",\n                \"serialNo\" : \"abc123\",\n                \"token\" : \"\",            \n            }\n        ]\n    }\n</code></pre>\n\n<p>The query I am using in below</p>\n\n<pre><code>Update(repository.MongoSpec{Selector: bson.M{\"children\": bson.M{\"$elemMatch\": bson.M{\"jid\": \"100\"}}}, Query: bson.M{\"children\": bson.M{\"$set\": fields}}})\n</code></pre>\n\n<p>Below is the update function</p>\n\n<pre><code>    s := spec.(MongoSpec).Selector\nq := spec.(MongoSpec).Query\nerr := session.\n    DB(repo.config.databaseName).\n    C(repo.collectionName).\n    Update(s, q)\n</code></pre>\n\n<p>MongoSpec struct </p>\n\n<pre><code>  type MongoSpec struct {\n        Selector interface{}\n        Query    interface{}\n    }\n</code></pre>\n\n<p>The above query throws an error as below </p>\n\n<pre><code>The dollar ($) prefixed field '$set' in 'children.$set' is not valid for storage.\n</code></pre>\n\n<p>May I know what is wrong with the query.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 763, "user_id": 8371811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5028258b8604bc00c96f90ef6ef30ab?s=128&d=identicon&r=PG&f=1", "display_name": "Keveloper", "link": "https://stackoverflow.com/users/8371811/keveloper"}, "edited": false, "score": 3, "creation_date": 1534277170, "post_id": 51848894, "comment_id": 90651282, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39804861/what-is-a-concise-way-to-create-a-2d-slice-in-go\">What is a concise way to create a 2D slice in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "edited": false, "score": 0, "creation_date": 1534277723, "post_id": 51849016, "comment_id": 90651496, "body": "Thanks, How do I add the same element to 2 position(for the last option given). append(matrix,row) by default adds to the first element..."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "edited": false, "score": 0, "creation_date": 1534277919, "post_id": 51849016, "comment_id": 90651565, "body": "@user1050619 initialize your outer matrix first (as in the first example)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534278220, "post_id": 51849016, "comment_id": 90651691, "body": "<code>append(matrix,row)</code> does not add to the first element, it adds the row to the matrix."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1534277142, "creation_date": 1534277142, "answer_id": 51849016, "question_id": 51848894, "link": "https://stackoverflow.com/questions/51848894/create-two-dimensional-string-array-in-golang/51849016#51849016", "title": "create two dimensional string array in golang", "body": "<p>You have a slice of slices, and the outer slice is <code>nil</code> until it's initialized:</p>\n\n<pre><code>matrix := make([][]string, 1)\nmatrix[0] = append(matrix[0],'cat')\nfmt.Println(matrix)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>var matrix [][]string\nmatrix = append(matrix, []string{\"cat\"})\nfmt.Println(matrix)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>var matrix [][]string\nvar row []string\nrow = append(row, \"cat\")\nmatrix = append(matrix, row)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "is_accepted": false, "score": 1, "last_activity_date": 1558141483, "creation_date": 1558141483, "answer_id": 56195169, "question_id": 51848894, "link": "https://stackoverflow.com/questions/51848894/create-two-dimensional-string-array-in-golang/56195169#56195169", "title": "create two dimensional string array in golang", "body": "<p>The problem with doing two-dimensional arrays with Go is that you have to initialise each part individually, e.g., if you have a <code>[][]bool</code>, you gotta allocate <code>[]([]bool)</code> first, and then allocate the individual <code>[]bool</code> afterwards; this is the same logic regardless of whether you're using <code>make()</code> or <code>append()</code> to perform the allocations.</p>\n\n<p>In your example, the <code>matrix[0]</code> doesn't exist yet after a mere <code>var matrix [][]string</code>, hence you're getting the <code>index out of range</code> error.</p>\n\n<p>For example, the code below would create another slice based on the size of an existing slice of a different type:</p>\n\n<pre><code>func solve(board [][]rune, \u2026) {\n\n    x := len(board)\n    y := len(board[0])\n    visited := make([][]bool, x)\n    for i := range visited {\n        visited[i] = make([]bool, y)\n    }\n\u2026\n</code></pre>\n\n<p>If you simply want to initialise the slice based on a static array you have, you can do it directly like this, without even having to use <code>append()</code> or <code>make()</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    matrix := [][]string{{\"cat\", \"cat\", \"cat\"}, {\"dog\", \"dog\"}}\n    fmt.Println(matrix)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iWgts-m7c4u\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iWgts-m7c4u</a></p>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4972, "favorite_count": 1, "accepted_answer_id": 51849016, "answer_count": 2, "score": 1, "last_activity_date": 1558141483, "creation_date": 1534276549, "last_edit_date": 1534300859, "question_id": 51848894, "link": "https://stackoverflow.com/questions/51848894/create-two-dimensional-string-array-in-golang", "title": "create two dimensional string array in golang", "body": "<p>I need to create a 2 dimensional string array as shown below - </p>\n\n<pre><code>matrix = [['cat,'cat','cat'],['dog','dog']]\n</code></pre>\n\n<p>Code:-</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    { // using append\n\n    var matrix [][]string\n    matrix[0] = append(matrix[0],'cat')\n        fmt.Println(matrix)\n    }\n}\n</code></pre>\n\n<p>Error:- </p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox863026592/main.go:11 +0x20\n</code></pre>\n"}, {"tags": ["bash", "go", "sha256"], "comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 2, "creation_date": 1534273924, "post_id": 51848270, "comment_id": 90649928, "body": "<a href=\"https://golang.org/pkg/crypto/sha256/#example_Sum256\" rel=\"nofollow noreferrer\">golang.org/pkg/crypto/sha256/#example_Sum256</a>"}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1534274682, "post_id": 51848270, "comment_id": 90650229, "body": "@nbari i appreciate it i actually realized mid post of question that i was using sha1"}], "answers": [{"comments": [{"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1534273858, "post_id": 51848317, "comment_id": 90649892, "body": "Thats funny you mention that i just figured that out."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1534273930, "last_edit_date": 1534273930, "creation_date": 1534273836, "answer_id": 51848317, "question_id": 51848270, "link": "https://stackoverflow.com/questions/51848270/go-sha256sum-difference-with-bash-sha256sum/51848317#51848317", "title": "Go Sha256Sum Difference with Bash sha256sum", "body": "<p>You say you want to calculate SHA-256 checksum, yet you do:</p>\n\n<pre><code>hasherSha256 := sha1.New()\n</code></pre>\n\n<p>That will be an SHA-1 hasher, not SHA-256. Instead do:</p>\n\n<pre><code>hasherSha256 := sha256.New()\n</code></pre>\n\n<p>Also note that to calculate a \"one-time\" digest of some data (ready in a byte slice), you may use the <a href=\"https://golang.org/pkg/crypto/sha256/#Sum256\" rel=\"nofollow noreferrer\"><code>sha256.Sum256()</code></a> function like this:</p>\n\n<pre><code>digest := sha256.Sum256([]byte(sha256Key))\n</code></pre>\n\n<p>Note that here <code>digest</code> will be an <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">array</a> (not a <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slice</a>, in Go they are quite different), an array of type <code>[32]byte</code>. To obtain a slice \"of it\" (of type <code>[]byte</code>), slice it like this:</p>\n\n<pre><code>digestSlice := digest[:]\n</code></pre>\n"}], "owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "closed_date": 1534300909, "accepted_answer_id": 51848317, "answer_count": 1, "score": -4, "last_activity_date": 1534273930, "creation_date": 1534273596, "question_id": 51848270, "link": "https://stackoverflow.com/questions/51848270/go-sha256sum-difference-with-bash-sha256sum", "closed_reason": "Not suitable for this site", "title": "Go Sha256Sum Difference with Bash sha256sum", "body": "<p>My go code is producing different sha256sum values than bash commandline. <strong>I've read through various questions and answers and they all point to what I've already done, as this community asks me to do before posting</strong></p>\n\n<p>Here's my sha256sum code on <code>go</code></p>\n\n<pre><code>sha256Key:=verifyEmail+\":\"+md5password+\":\"+dateStr\nhasherSha256 := sha1.New()\nhasherSha256.Write([]byte(sha256Key))\nsha256Val:=hex.EncodeToString(hasherSha256.Sum(nil))\n</code></pre>\n\n<p>And here's my <code>bash</code> script code:</p>\n\n<pre><code>key=$( echo -n \"$verifyEmail:$md5PWD:$pwTime\" | sha256sum)\necho $key\n</code></pre>\n\n<p>Ive already validated that the keys are the same. One note, my dateStr variable inside go comes from date formatting:</p>\n\n<pre><code>now := time.Now().Unix()\nrem := now % 3600\ndate := now-rem         \ndateStr:=strconv.FormatInt(date,10)\n</code></pre>\n\n<p>Usually I get downvotes so I tried making this question as clear and concise as possible. </p>\n\n<p>Please let me know if im missing anything.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534279414, "post_id": 51847412, "comment_id": 90652194, "body": "Who voted to close this and why?"}], "answers": [{"comments": [{"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534452952, "post_id": 51874481, "comment_id": 90721969, "body": "I just ran it on an interface I just created called <code>Logger</code> in package <code>logger</code>, which contained the interface. From right outside the package (and folder), I said:  <code>mockery -dir logger -name Logger -inpkg logger -testonly</code>  and the logger was generated, but it was created in the file <code>mock_Logger.go</code>."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 1, "creation_date": 1534493410, "post_id": 51874481, "comment_id": 90732942, "body": "This worked for me: <code>$ mockery -dir logger -name Logger -inpkg -testonly</code>  Generating mock for: Logger in file: /tmp/logger/mock_Logger_test.go"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 1, "creation_date": 1534517533, "post_id": 51874481, "comment_id": 90746875, "body": "That worked, but now Visual Studio Code won&#39;t recognize the mock."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534519224, "post_id": 51874481, "comment_id": 90747843, "body": "The problem with the mock when it&#39;s defined in the _test.go file is that it&#39;s unexported. You can&#39;t use it in other packages as well as you can&#39;t use it from non-test files like main.go. I think your problem is that you defined Logger interface in the logger package. In most cases you have to define interface in the package where it&#39;s being used. So you can define interface in &quot;main&quot; package  while implementation of the logger can reside in &quot;logger&quot; package."}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": true, "score": 2, "last_activity_date": 1534413977, "creation_date": 1534413977, "answer_id": 51874481, "question_id": 51847412, "link": "https://stackoverflow.com/questions/51847412/how-to-exclude-generated-mocks-from-package-coverage-in-visual-studio-code/51874481#51874481", "title": "How to exclude generated mocks from package coverage in Visual Studio Code", "body": "<p>The solution is to use mockery -inpkg and -testonly flags so generated mocks will go to the original package where interface is defined. Also generated files will have _test.go suffix so they will be ignored by the code coverage tool and by the compiler when you build your program.</p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 1, "accepted_answer_id": 51874481, "answer_count": 1, "score": 2, "last_activity_date": 1534413977, "creation_date": 1534270080, "question_id": 51847412, "link": "https://stackoverflow.com/questions/51847412/how-to-exclude-generated-mocks-from-package-coverage-in-visual-studio-code", "title": "How to exclude generated mocks from package coverage in Visual Studio Code", "body": "<p>I'm unit-testing a Golang project, via Visual Studio Code, and one of the dependencies I make use of is called <a href=\"https://github.com/vektra/mockery/\" rel=\"nofollow noreferrer\"><code>mockery</code></a>. It works by creating mocks of the target Golang interfaces, in the package they're found. As consequence, even though I could have sworn to test everything in said package, my test coverage is only at 58%. However, when I remove the mock (turns out that I didn't need it) from the package, my test coverage, sure as rain, shoots up to the 97.9% that I was expecting.</p>\n\n<p>Is there any way to tell Visual Studio Code \"hey, don't include mockery mocks (which start with <code>mock_</code>) in your package coverage calculations\"?</p>\n"}, {"tags": ["go", "proxy", "http-proxy"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534263645, "post_id": 51845690, "comment_id": 90644913, "body": "How are you creating your custom transport? Note the quoted doc says &quot;by default&quot;, but you&#39;re overriding the defaults."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534270135, "post_id": 51845690, "comment_id": 90648259, "body": "<a href=\"https://golang.org/pkg/net/http/#ProxyFromEnvironment\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#ProxyFromEnvironment</a>"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534270407, "post_id": 51845690, "comment_id": 90648380, "body": "@Peter, <i>&quot;ProxyFromEnvironment returns the URL of the proxy&quot;</i>, that should be the same as what I specified in the terminal. I.e., the problem still holds, &quot;<i>The go get itself support the standard proxy environment variables, but i&#39;m talking about the Go program/code itself.</i>&quot;"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534270523, "post_id": 51845690, "comment_id": 90648440, "body": "@xpt, but you are not using it when creating the Transport. You have to assign it to the Proxy field."}], "answers": [{"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1567630910, "post_id": 51848441, "comment_id": 102024297, "body": "Note that <code>DefaultTransport</code> already includes <code>Proxy: ProxyFromEnvironment</code>, so the initial statement is kind of misleading -- if you aren&#39;t constructing a non-default transport, <i>you</i> may not need to set the proxy at all (as demonstrated in the second example).  An even simpler example that will use a proxy: <code>client := &amp;http.Client{}</code>"}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1567632946, "post_id": 51848441, "comment_id": 102024970, "body": "I upvoted this approach because the second example looked smart.  Unfortunately, it doesn&#39;t compile: <code>invalid indirect of http.DefaultTransport (type http.RoundTripper)</code>.  Related: <a href=\"https://github.com/golang/go/issues/26013\" rel=\"nofollow noreferrer\">net/http: add Transport.Clone</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1568329214, "last_edit_date": 1568329214, "creation_date": 1534274431, "answer_id": 51848441, "question_id": 51845690, "link": "https://stackoverflow.com/questions/51845690/how-to-program-go-to-use-a-proxy-when-using-a-custom-transport/51848441#51848441", "title": "How to program Go to use a proxy when using a custom transport?", "body": "<p>Set the <a href=\"https://godoc.org/net/http#Transport.Proxy\" rel=\"nofollow noreferrer\">Transport Proxy</a> field to <a href=\"https://godoc.org/net/http#ProxyFromEnvironment\" rel=\"nofollow noreferrer\">http.ProxyFromEnvironment</a> to use a proxy configured from environment variables:</p>\n\n<pre><code>tr := &amp;http.Transport{\n  Proxy: ProxyFromEnvironment,\n  TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n}\n</code></pre>\n\n<p>It's usually best to clone the <a href=\"https://godoc.org/net/http#DefaultTransport\" rel=\"nofollow noreferrer\">default transport</a> and set your options in that transport:</p>\n\n<pre><code>tr := http.DefaultTransport.(*http.Transport).Clone()\ntr.TLSClientConfig = &amp;tls.Config{InsecureSkipVerify: true}\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Get(url)\n</code></pre>\n\n<p>The default transport includes the correct value for the Proxy field, timeouts and other useful settings.</p>\n\n<p>If the application is not creating a custom transport, then none of this is required to honor the proxy related environment variables.</p>\n"}, {"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 1, "creation_date": 1541702068, "post_id": 53202838, "comment_id": 93315762, "body": "Thanks a lot Chinmay! I wish I could give you more point than the +25."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 1, "creation_date": 1567631056, "post_id": 53202838, "comment_id": 102024342, "body": "<code>Run code snippet</code> does not work for this -- it is setup for JavaScript, not Go."}], "tags": [], "owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "is_accepted": true, "score": 6, "last_activity_date": 1541660539, "creation_date": 1541660539, "answer_id": 53202838, "question_id": 51845690, "link": "https://stackoverflow.com/questions/51845690/how-to-program-go-to-use-a-proxy-when-using-a-custom-transport/53202838#53202838", "title": "How to program Go to use a proxy when using a custom transport?", "body": "<p>You can use <strong>http.ProxyFromEnvironment</strong> method<br></p>\n\n<pre><code>  var PTransport = &amp; http.Transport { Proxy: http.ProxyFromEnvironment }\n  client: = http.Client { Transport: PTransport }\n</code></pre>\n\n<p>ProxyFromEnvironment returns the URL of the proxy to use for a given request, as indicated by the environment variables HTTP_PROXY, HTTPS_PROXY and NO_PROXY (or the lowercase versions thereof). HTTPS_PROXY takes precedence over HTTP_PROXY for https requests.\n<br></p>\n\n<p>I have tried below code, it works, Just add in ur proxy details in terminal.</p>\n\n<pre><code>export http_proxy='http://user:password@prox-server:3128'\nexport https_proxy='http://user:password@prox-server:3128'\nexport HTTP_PROXY='http://user:password@prox-server:3128'\nexport HTTPS_PROXY='http://user:password@prox-server:3128'\n</code></pre>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>package main\r\n\r\nimport (\r\n  \"fmt\"\r\n  \"net/http\"\r\n  \"io/ioutil\"\r\n)\r\n\r\nfunc main() {\r\n\r\n  var PTransport = &amp; http.Transport {\r\n    Proxy: http.ProxyFromEnvironment\r\n  }\r\n  client: = http.Client {\r\n    Transport: PTransport\r\n  }\r\n  req, err: = http.NewRequest(\"GET\", \"https://jsonplaceholder.typicode.com/todos/1\", nil)\r\n  req.Header.Add(\"If-None-Match\", `some value`)\r\n  resp, err: = client.Do(req)\r\n  if err != nil {\r\n    panic(err)\r\n  }\r\n  defer resp.Body.Close()\r\n\r\n  bodyBytes, err: = ioutil.ReadAll(resp.Body)\r\n  if err != nil {\r\n    panic(err)\r\n  }\r\n\r\n  bodyString: = string(bodyBytes)\r\n  fmt.Printf(\"GET Response = %s \\n\", string(bodyString))\r\n\r\n\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5919, "favorite_count": 1, "accepted_answer_id": 53202838, "answer_count": 2, "score": 4, "last_activity_date": 1568329214, "creation_date": 1534263137, "last_edit_date": 1568232222, "question_id": 51845690, "link": "https://stackoverflow.com/questions/51845690/how-to-program-go-to-use-a-proxy-when-using-a-custom-transport", "title": "How to program Go to use a proxy when using a custom transport?", "body": "<p>How to write Go programs that use a proxy automatically according to the <a href=\"https://www.quora.com/How-do-I-set-the-proxy-setting-using-Linux-command-line-on-Ubuntu-14-04#\" rel=\"nofollow noreferrer\">proxy environment variables</a>?</p>\n\n<p>The <code>go get</code> itself <a href=\"https://stackoverflow.com/questions/10383299/how-do-i-configure-go-to-use-a-proxy\">support</a> the standard <a href=\"https://www.quora.com/How-do-I-set-the-proxy-setting-using-Linux-command-line-on-Ubuntu-14-04#\" rel=\"nofollow noreferrer\">proxy environment variables</a>, but i'm talking about the Go program/code itself.</p>\n\n<p>This blog says, </p>\n\n<blockquote>\n  <p>By default http.Client checks the HTTP_PROXY and HTTPS_PROXY variables before processes any http.Request. </p>\n</blockquote>\n\n<p>I tried it, but it doesn't work for my following code:</p>\n\n<pre><code>tr := &amp;http.Transport{\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n}\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Get(url)\n</code></pre>\n"}, {"tags": ["python", "numpy", "go", "ctypes", "ffi"], "comments": [{"owner": {"reputation": 15724, "user_id": 5754656, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/7jfX3.png?s=128&g=1", "display_name": "Artyer", "link": "https://stackoverflow.com/users/5754656/artyer"}, "edited": false, "score": 0, "creation_date": 1534261832, "post_id": 51845092, "comment_id": 90643988, "body": "Try <code>lib.Function.restype = c_double * N</code> (An array of size N) or <code>lib.Function.restype = ctypes.POINTER(c_double)  # Outside the function</code>, and in the function <code>res = lib.Function(stuff..., N); return [res[i] for i in range(N)]</code>"}, {"owner": {"reputation": 676, "user_id": 1927167, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/86466c6ec3eed311a3d5a16e1f61fb66?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Vaknin", "link": "https://stackoverflow.com/users/1927167/yotam-vaknin"}, "reply_to_user": {"reputation": 15724, "user_id": 5754656, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/7jfX3.png?s=128&g=1", "display_name": "Artyer", "link": "https://stackoverflow.com/users/5754656/artyer"}, "edited": false, "score": 0, "creation_date": 1534262771, "post_id": 51845092, "comment_id": 90644478, "body": "sadly it still doesn&#39;t return"}, {"owner": {"reputation": 832, "user_id": 1094587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02ed2da153d349816354af0a4441df21?s=128&d=identicon&r=PG", "display_name": "Ghasem Naddaf", "link": "https://stackoverflow.com/users/1094587/ghasem-naddaf"}, "edited": false, "score": 0, "creation_date": 1534457560, "post_id": 51845092, "comment_id": 90723467, "body": "To clarify, the python function does not return even for a small value of <code>N</code>?"}, {"owner": {"reputation": 676, "user_id": 1927167, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/86466c6ec3eed311a3d5a16e1f61fb66?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Vaknin", "link": "https://stackoverflow.com/users/1927167/yotam-vaknin"}, "edited": false, "score": 0, "creation_date": 1534487337, "post_id": 51845092, "comment_id": 90729953, "body": "Yes, and if I change only the return statement to something else (to the see how long does it take the function to run) everything works fine."}], "answers": [{"comments": [{"owner": {"reputation": 676, "user_id": 1927167, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/86466c6ec3eed311a3d5a16e1f61fb66?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Vaknin", "link": "https://stackoverflow.com/users/1927167/yotam-vaknin"}, "edited": false, "score": 0, "creation_date": 1534626631, "post_id": 51912417, "comment_id": 90775232, "body": "Got bless you! It works! Thank you! (by the way, I see you haven&#39;t pushed the code to the rep, which is a great idea)"}], "tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": true, "score": 4, "last_activity_date": 1534715064, "last_edit_date": 1534715064, "creation_date": 1534625212, "answer_id": 51912417, "question_id": 51845092, "link": "https://stackoverflow.com/questions/51845092/how-to-return-an-array-from-golang-to-python-using-ctypes/51912417#51912417", "title": "How to return an array from Go[lang] to Python using ctypes?", "body": "<p>In your code <code>restype</code> is expecting <code>_ndtpr</code> type, see:</p>\n\n<pre><code>lib.Function.restype = ndpointer(dtype = c_double, shape = (N,))\n</code></pre>\n\n<p>See too in numpy document:</p>\n\n<blockquote>\n  <p><strong>def ndpointer(dtype=None, ndim=None, shape=None, flags=None)</strong> </p>\n  \n  <p><em>[others texts]</em></p>\n  \n  <p>Returns</p>\n  \n  <p>klass : ndpointer type object</p>\n  \n  <blockquote>\n    <p>A type object, which is an <code>_ndtpr</code> instance containing<br>\n    dtype, ndim, shape and flags information.</p>\n  </blockquote>\n  \n  <p><em>[others texts]</em></p>\n</blockquote>\n\n<p>In this way <code>lib.Function.restype</code> is pointer type which appropriated type in Golang must be <code>unsafe.Pointer</code>.</p>\n\n<p>However you want of an slice that need be passed as pointer:</p>\n\n<pre><code>func Function(s0, s1, s2 float64, N int) unsafe.Pointer {\n    result := make([]float64, N)\n    for i := 0; i &lt; N; i++ {\n        result[i] = (s0 + s1 + s2)\n    }\n    return unsafe.Pointer(&amp;result)//&lt;-- pointer of result\n}\n</code></pre>\n\n<p>This cause a problem in <strong>Rules for passing pointers between Go and C</strong>.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>C code may not keep a copy of a Go pointer after the call returns.</li>\n  </ol>\n  \n  <p>Source: <a href=\"https://github.com/golang/proposal/blob/master/design/12416-cgo-pointers.md\" rel=\"nofollow noreferrer\">https://github.com/golang/proposal/blob/master/design/12416-cgo-pointers.md</a></p>\n</blockquote>\n\n<p>So you must convert <code>unsafe.Pointer</code> to <code>uintptr</code> golang type.</p>\n\n<pre><code>func Function(s0, s1, s2 float64, N int) uintptr {\n    result := make([]float64, N)\n    for i := 0; i &lt; N; i++ {\n        result[i] = (s0 + s1 + s2)\n    }\n    return uintptr(unsafe.Pointer(&amp;result[0]))//&lt;-- note: result[0]\n}\n</code></pre>\n\n<p>In this way you will work fine!</p>\n\n<p><strong>Note:</strong> The structure of slice in C is represented by <code>typedef struct { void *data; GoInt len; GoInt cap; } GoSlice;</code>, but C expect only data, for this is need result only <code>void *data</code> (first field, or field[0]). </p>\n\n<p>PoC: <a href=\"https://github.com/ag-studies/stackoverflow-pointers-ref-in-golang\" rel=\"nofollow noreferrer\">https://github.com/ag-studies/stackoverflow-pointers-ref-in-golang</a></p>\n"}], "owner": {"reputation": 676, "user_id": 1927167, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/86466c6ec3eed311a3d5a16e1f61fb66?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Vaknin", "link": "https://stackoverflow.com/users/1927167/yotam-vaknin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1278, "favorite_count": 2, "accepted_answer_id": 51912417, "answer_count": 1, "score": 4, "last_activity_date": 1534715064, "creation_date": 1534261025, "last_edit_date": 1534335296, "question_id": 51845092, "link": "https://stackoverflow.com/questions/51845092/how-to-return-an-array-from-golang-to-python-using-ctypes", "title": "How to return an array from Go[lang] to Python using ctypes?", "body": "<p>I am trying to write some code that creates an array in GoLang, and returns it to a python script ctypes (and some numpy). What I have got so far doesn't work, and I cannot figure out why... I would appreciate any help!</p>\n\n<p>My Go code goes something like this:</p>\n\n<pre><code>func Function(physics_stuff... float64,  N int ) []float64{\n    result := make([]float64, N)\n    for i:= 0; i&lt; N; i++{\n        result[i] =  blah....\n    }\n    return result;\n}\n</code></pre>\n\n<p>and I am currently trying to import this functionality to python using:</p>\n\n<pre><code>from ctypes import c_double, cdll, c_int\nfrom numpy.ctypeslib import ndpointer\n\nlib = cdll.LoadLibrary(\"./go/library.so\")\nlib.Function.argtypes = [c_double]*6 + [c_int]\n\ndef lovely_python_function(stuff..., N):\n    lib.Function.restype = ndpointer(dtype = c_double, shape = (N,))\n    return lib.Function(stuff..., N)\n</code></pre>\n\n<p>This python function never returns. Other functions from the same library work just fine, but they all return a single float64 (c_double in python).</p>\n"}, {"tags": ["bash", "go", "bash-completion", "go-cobra"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534256858, "post_id": 51843740, "comment_id": 90640818, "body": "@Adrian: No, I believe this question is perfectly on-topic here, as the question is how to take advantage of cobra&#39;s bash completion feature, when the argument options are determined dynamically."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8680478"}, "edited": false, "score": 0, "creation_date": 1534257610, "post_id": 51843740, "comment_id": 90641352, "body": "Yes it&#39;s possible. Bash does not care how you get the valid <code>--some-id</code> flags."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1534258839, "post_id": 51843740, "comment_id": 90642202, "body": "@MichaWiedenmann: &quot;man bash&quot; knows nothing about cobra&#39;s bash completion support. The proper starting place is <a href=\"https://github.com/spf13/cobra/blob/master/bash_completions.md\" rel=\"nofollow noreferrer\">here</a>, with your link as a possible additional resource for advanced customizations (probably irrelevant for this particular question, though)."}, {"owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1534259067, "post_id": 51843740, "comment_id": 90642346, "body": "@MichaWiedenmann thanks for the hint, but my question is mostly about using Cobra Go package other than programmable bash completion: <a href=\"https://github.com/spf13/cobra/blob/master/bash_completions.md\" rel=\"nofollow noreferrer\">github.com/spf13/cobra/blob/master/bash_completions.md</a>"}], "owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 490, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534258229, "creation_date": 1534256634, "last_edit_date": 1534258229, "question_id": 51843740, "link": "https://stackoverflow.com/questions/51843740/making-cobra-flag-bash-completion-using-remote-data", "title": "Making Cobra flag bash completion using remote data", "body": "<p>I'm working on a <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">Cobra</a>-based Go app and I want to have a bash completion for command line flags:</p>\n\n<pre><code>$ my-cool-app --some-id=\n</code></pre>\n\n<p>The list of valid values for <code>--some-id</code> flag is available by making some HTTP call. How to make such bash completion available using Cobra?</p>\n"}, {"tags": ["git", "http", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1534257850, "post_id": 51843696, "comment_id": 90641518, "body": "The article is about vgo, not the release candidate. Are you sure it applies? I&#39;ve had no problems downloading modules without changing any meta tags."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534260939, "post_id": 51843696, "comment_id": 90643460, "body": "When I run a <code>go1.11rc1 get ...</code> it says unknown revision for a package inside another repo. The repo has a tag that I can run <code>go1.11rc1 get</code> for but for the package in a sub-folder in the repo, it doesn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1534259974, "last_edit_date": 1592644375, "creation_date": 1534259974, "answer_id": 51844768, "question_id": 51843696, "link": "https://stackoverflow.com/questions/51843696/determine-vcs-for-incoming-http-request/51844768#51844768", "title": "Determine VCS for incoming HTTP Request", "body": "<p>Don't bother. Just use same old format as always. It's still supported, and 'mod' was only for vgo.</p>\n<p>See the official (albeit DRAFT) <a href=\"https://tip.golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">Go 1.11 Release Notes</a> for details:</p>\n<blockquote>\n<p>The meta tag has the form:</p>\n<pre><code>&lt;meta name=&quot;go-import&quot; content=&quot;import-prefix vcs repo-root&quot;&gt;\n</code></pre>\n<p><em>snip</em></p>\n<p>The vcs is one of &quot;bzr&quot;, &quot;fossil&quot;, &quot;git&quot;, &quot;hg&quot;, &quot;svn&quot;.</p>\n</blockquote>\n"}], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534259974, "creation_date": 1534256484, "last_edit_date": 1534256531, "question_id": 51843696, "link": "https://stackoverflow.com/questions/51843696/determine-vcs-for-incoming-http-request", "title": "Determine VCS for incoming HTTP Request", "body": "<p>I have a custom import domain, that is routed to the correct place when the <code>go get</code> command is executed as defined by this meta tag: <code>&lt;meta name=\"go-import\" content=\"{{.BaseURL}}{{.RouterKey}} git {{.RouterValue}}\"&gt;</code>. I am trying to test out the new module stuff in <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/UmbvkJmdEP0/xvwo9ukKDgAJ\" rel=\"nofollow noreferrer\">go1.11rc1</a>. It specifies <a href=\"https://research.swtch.com/vgo-module#Publishing\" rel=\"nofollow noreferrer\">here</a> that this <code>meta</code> tag needs to change from the vcs of <code>git</code> to <code>mod</code>. </p>\n\n<p>Is there anyway to determine which vcs is being used (git or mod) for an incoming request so I can then serve the right html as we test out new modules in Go1.11?</p>\n"}, {"tags": ["json", "string", "go", "marshalling"], "comments": [{"owner": {"reputation": 321, "user_id": 2553277, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4cd61059f891489c3567a70115e82a88?s=128&d=identicon&r=PG", "display_name": "fr05t1k", "link": "https://stackoverflow.com/users/2553277/fr05t1k"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534256080, "post_id": 51843500, "comment_id": 90640208, "body": "@Adrian I don&#39;t think that&#39;s a good idea to manipulate with JSON as a string"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534256357, "post_id": 51843500, "comment_id": 90640412, "body": "@Adrian: That obviously doesn&#39;t work. The JSON marshaling doesn&#39;t care how you &quot;think&quot; about strings."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534256559, "post_id": 51843500, "comment_id": 90640566, "body": "It obviously <i>does</i> work. You can manipulate the totally normal string that JSON data is <i>after you&#39;ve marshalled it</i>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534260269, "post_id": 51843500, "comment_id": 90643086, "body": "LOL. That&#39;s nothing like what you said. And anything but obvious. Also, an absolutely terrible answer to the question."}], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 2553277, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4cd61059f891489c3567a70115e82a88?s=128&d=identicon&r=PG", "display_name": "fr05t1k", "link": "https://stackoverflow.com/users/2553277/fr05t1k"}, "edited": false, "score": 0, "creation_date": 1534318379, "post_id": 51843566, "comment_id": 90661569, "body": "Great! That\u2019s what I need! Thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1534319081, "last_edit_date": 1534319081, "creation_date": 1534256038, "answer_id": 51843566, "question_id": 51843500, "link": "https://stackoverflow.com/questions/51843500/is-it-possible-to-add-a-nested-json-as-is-in-go/51843566#51843566", "title": "Is it possible to add a nested json &quot;as is&quot; in Go?", "body": "<p>Yes, it's possible. Use the <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a> type which implements custom marshaling / unmarshaling, which \"renders\" it as-is into the JSON output. It's just a plain byte slice:</p>\n\n<pre><code>type RawMessage []byte\n</code></pre>\n\n<p>Its value should be the <code>UTF-8</code> encoded byte sequence of the raw JSON text (exactly what you get when you do a conversion, e.g. <code>[]byte(\"someText\")</code>).</p>\n\n<pre><code>type RootJson struct {\n    NestedJson      json.RawMessage\n    AdditionalField string\n}\n</code></pre>\n\n<p>With this, the output will be (try it on the <a href=\"https://play.golang.org/p/w7FxE6JwKTC\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"NestedJson\":{\"number\":1,\"string\":\"string\",\"float\":6.56},\n    \"AdditionalField\":\"additionalField\"}\n</code></pre>\n\n<p><sub>(Indentation added by me.)</sub></p>\n"}], "owner": {"reputation": 321, "user_id": 2553277, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4cd61059f891489c3567a70115e82a88?s=128&d=identicon&r=PG", "display_name": "fr05t1k", "link": "https://stackoverflow.com/users/2553277/fr05t1k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 51843566, "answer_count": 1, "score": 2, "last_activity_date": 1534319081, "creation_date": 1534255847, "last_edit_date": 1534256483, "question_id": 51843500, "link": "https://stackoverflow.com/questions/51843500/is-it-possible-to-add-a-nested-json-as-is-in-go", "title": "Is it possible to add a nested json &quot;as is&quot; in Go?", "body": "<p>Is this possible way to add nested json \"as is\". The nested json doesn't have any structure and might be different. I need to put the nested json data directly to the root node. </p>\n\n<p><a href=\"https://play.golang.org/p/MzBt7DLQEpD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MzBt7DLQEpD</a></p>\n\n<pre><code>type RootJson struct {\n    NestedJson []byte\n    AdditionalField string\n}\n\nfunc main() {\n    nestedJson := []byte(\"{\\\"number\\\": 1, \\\"string\\\": \\\"string\\\", \\\"float\\\": 6.56}\")\n\n    rootJson := RootJson{nestedJson, \"additionalField\"}\n    payload, _ := json.Marshal(&amp;rootJson)\n\n    fmt.Println(string(payload))\n\n}\n</code></pre>\n"}, {"tags": ["go", "gobot.io"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534250510, "post_id": 51841167, "comment_id": 90636364, "body": "The error seems to indicate that stty is not on your PATH. Make sure it is. Finde which stty you use and what your PATH is and fix one or the other."}, {"owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534311102, "post_id": 51841167, "comment_id": 90659311, "body": "I am using windows 10. I can not find the stty path."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1534314131, "post_id": 51841167, "comment_id": 90660055, "body": "Are you sure gobot works on windows? To use package keyboard you <i>must</i> <i>have</i> stty. Maybe through cygwin."}, {"owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534321594, "post_id": 51841167, "comment_id": 90662944, "body": "gobot is working on windows and my drone is flying. Problem is i can not controll the drone using the keyboard. stty file was found and replace to the path and now it is showing exit status 3221225781 error."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534328954, "post_id": 51841167, "comment_id": 90666292, "body": "Seems you either need a gobot comaptible stty (the normal Linux variant) or you must use an other way of reading the keyboard than gobots package keyboard."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1534342692, "post_id": 51841167, "comment_id": 90673169, "body": "AFAIK gobot is only developed and tested on Linux and you should not expect all of its functionality to work on other platforms."}, {"owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "edited": false, "score": 0, "creation_date": 1534392202, "post_id": 51841167, "comment_id": 90690418, "body": "When I run the project on git bash it works perfectly..Thank you very much for your comments."}, {"owner": {"reputation": 508, "user_id": 6874531, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tKs0WJTpN5U/AAAAAAAAAAI/AAAAAAAAABU/evA61jYST_E/photo.jpg?sz=128", "display_name": "Chamod Pathirana", "link": "https://stackoverflow.com/users/6874531/chamod-pathirana"}, "edited": false, "score": 1, "creation_date": 1534481336, "post_id": 51841167, "comment_id": 90728127, "body": "install <a href=\"https://www.cygwin.com/setup-x86_64.exe\" rel=\"nofollow noreferrer\">Cygwin</a> and add bin path to system path. then it can be run in the command prompt of window 10."}, {"owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "reply_to_user": {"reputation": 508, "user_id": 6874531, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tKs0WJTpN5U/AAAAAAAAAAI/AAAAAAAAABU/evA61jYST_E/photo.jpg?sz=128", "display_name": "Chamod Pathirana", "link": "https://stackoverflow.com/users/6874531/chamod-pathirana"}, "edited": false, "score": 0, "creation_date": 1535368768, "post_id": 51841167, "comment_id": 91026513, "body": "@ChamodPathirana Thanks man. It works fine."}], "answers": [{"tags": [], "owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "is_accepted": true, "score": 1, "last_activity_date": 1535030819, "last_edit_date": 1535030819, "creation_date": 1534392339, "answer_id": 51869460, "question_id": 51841167, "link": "https://stackoverflow.com/questions/51841167/an-error-occurs-when-i-execute-go-file-which-controls-dji-tello-drone-with-keybo/51869460#51869460", "title": "An error occurs when I execute go file which controls dji tello drone with keyboard in windows 10", "body": "<p>gobot is only developed and tested on Linux and we should not expect all of its functionality to work on other platforms like windows. Hence I tried using git bash instead of windows command prompt and It works perfectly there.</p>\n"}], "owner": {"reputation": 1934, "user_id": 8194089, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBWEjMZm7G0/AAAAAAAAAAI/AAAAAAAAAEw/rf8j8HUnqlc/photo.jpg?sz=128", "display_name": "Chamila Maddumage", "link": "https://stackoverflow.com/users/8194089/chamila-maddumage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 2, "accepted_answer_id": 51869460, "answer_count": 1, "score": 0, "last_activity_date": 1535030819, "creation_date": 1534248799, "last_edit_date": 1534321901, "question_id": 51841167, "link": "https://stackoverflow.com/questions/51841167/an-error-occurs-when-i-execute-go-file-which-controls-dji-tello-drone-with-keybo", "title": "An error occurs when I execute go file which controls dji tello drone with keyboard in windows 10", "body": "<p>I have a go file named as drone_control.go which controls dji tello drone with keyboard button clicks. When I try to execute this file using the command prompt it shows an error  * exec: \"stty\": executable file not found in %PATH%</p>\n\n<p>I am using windows 10 and gobot framework to control the drone.</p>\n\n<p>following is the content of my drone_control.go file.</p>\n\n<pre><code>    package main\n\n  import (\n      \"time\"\n      \"gobot.io/x/gobot\"\n      \"gobot.io/x/gobot/platforms/dji/tello\"\n      \"gobot.io/x/gobot/platforms/keyboard\"\n  )\n\n  func main() {\n      drone := tello.NewDriver(\"8888\")\n      keys := keyboard.NewDriver()\n\n      work := func() {\n                        drone.TakeOff()\n          keys.On(keyboard.Key, func(data interface{}) {\n                        key := data.(keyboard.KeyEvent)\n                        if key.Key == keyboard.A {\n                        drone.FrontFlip()\n                        }\n                        })\n\n          gobot.After(10*time.Second, func() {\n              drone.BackFlip()\n          })\n\n          gobot.After(15*time.Second, func() {\n              drone.Land()\n          })\n      }//work end\n\n      robot := gobot.NewRobot(\"tello\",\n          []gobot.Connection{},\n          []gobot.Device{keys},\n          []gobot.Device{drone},\n          work,\n      )\n\n      robot.Start()\n  }//main end\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 2, "creation_date": 1534248883, "post_id": 51841131, "comment_id": 90635374, "body": "You can&#39;t access your <code>receivers</code> structure using the <code>[]</code> operator."}, {"owner": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534248951, "post_id": 51841131, "comment_id": 90635411, "body": "Yeah I know..But how can I do it in other way..the idea is that the client needs to be dynamic"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534248962, "post_id": 51841131, "comment_id": 90635415, "body": "Because receivers is not a slice it is a struct."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1534249172, "post_id": 51841131, "comment_id": 90635553, "body": "If it should be dynamic, a map would be great, you don&#39;t want to define a type for that if you want it to be able to have new clients added without changing your code. See my answer below."}], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 4, "last_activity_date": 1534248943, "creation_date": 1534248943, "answer_id": 51841216, "question_id": 51841131, "link": "https://stackoverflow.com/questions/51841131/how-to-get-the-nested-struct-from-variable-from-a-string-representation/51841216#51841216", "title": "How to get the nested struct from variable from a string representation?", "body": "<p>The problem is that your type <code>receivers</code> shouldn't have named fields. It should be a <code>map[string][]string</code> instead.</p>\n\n<p>Here is a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Config struct {\n    ReportType string              `json:\"type\"`\n    Clients    []string            `json:\"clients\"`\n    Sender     string              `json:\"sender\"`\n    Recipients map[string][]string `json:\"recipients\"`\n    Cloning    []string            `json:\"dbCloning\"`\n}\n\nvar data = []byte(`{\n    \"type\": \"Weekly\",\n    \"clients\": [\n        \"gozo\",\n        \"dva\"\n    ],\n    \"sender\": \"no-reply@flowace.in\",\n    \"recipients\": {\n        \"gozo\": [\n            \"a@gmail.com\",\n            \"b@hotmail.com\"\n        ],\n        \"dva\": [\n            \"c@gmail.com\",\n            \"d@hotmail.com\"\n        ]\n    },\n    \"features\": [\n        \"Top5UsedApps\",\n        \"TimeSpentOnEachL3\",\n        \"NewlyAssignedL3\",\n        \"HoursLogged\"\n    ],\n    \"dbCloning\": [\n        \"dva\"\n    ] \n}`)\n\nfunc main() {\n    var conf Config\n    json.Unmarshal(data, &amp;conf)\n\n    for _, client := range conf.Clients {\n        fmt.Println(conf.Recipients[client])\n    }\n}\n</code></pre>\n\n<p>Gives the output</p>\n\n<pre><code>[a@gmail.com b@hotmail.com]\n[c@gmail.com d@hotmail.com]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534251412, "last_edit_date": 1534251412, "creation_date": 1534249093, "answer_id": 51841267, "question_id": 51841131, "link": "https://stackoverflow.com/questions/51841131/how-to-get-the-nested-struct-from-variable-from-a-string-representation/51841267#51841267", "title": "How to get the nested struct from variable from a string representation?", "body": "<p>A range clause provides a way to iterate over an array, slice, string, map, or channel. So you cannot range over struct until you convert it into one of the above types.</p>\n\n<p>To loop over struct fields you can go for reflection by creating a slice of reflect value for struct. </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\ntype receivers struct {\n    Gozo []string `json:\"gozo\"`\n    Dva  []string `json:\"dva\"`\n    // Add more recievers\n}\n\n// Config -- The config object parsed from the JSON file\ntype Config struct {\n    ReportType string    `json:\"type\"`\n    Clients    []string  `json:\"clients\"`\n    Sender     string    `json:\"sender\"`\n    Recipients receivers `json:\"recipients\"`\n    Cloning    []string  `json:\"dbCloning\"`\n}\n\nvar data = []byte(`{\n    \"type\": \"Weekly\",\n    \"clients\": [\n        \"gozo\",\n        \"dva\"\n    ],\n    \"sender\": \"no-reply@flowace.in\",\n    \"recipients\": {\n        \"gozo\": [\n            \"a@gmail.com\",\n            \"b@hotmail.com\"\n        ],\n        \"dva\": [\n            \"c@gmail.com\",\n            \"d@hotmail.com\"\n        ]\n    },\n    \"features\": [\n        \"Top5UsedApps\",\n        \"TimeSpentOnEachL3\",\n        \"NewlyAssignedL3\",\n        \"HoursLogged\"\n    ],\n    \"dbCloning\": [\n        \"dva\"\n    ] \n}`)\n\nfunc main() {\n    var conf Config\n    if err := json.Unmarshal(data, &amp;conf); err != nil{\n        fmt.Println(err)\n    }\n\n    v := reflect.ValueOf(conf.Recipients)\n\n    values := make([]interface{}, v.NumField())\n\n    for i := 0; i &lt; v.NumField(); i++ {\n        values[i] = v.Field(i).Interface()\n    }\n\n    fmt.Println(values)\n}\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/Ht3vDwUkgse\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<blockquote>\n  <p><code>NumField</code> returns the number of fields in the struct v. It panics if\n  v's Kind is not Struct. </p>\n</blockquote>\n\n<pre><code>func (v Value) NumField() int\n</code></pre>\n\n<blockquote>\n  <p><code>Field</code> returns the i'th field of the struct\n  v. It panics if v's Kind is not Struct or i is out of range.</p>\n</blockquote>\n\n<pre><code>func (v Value) Field(i int) Value\n</code></pre>\n\n<p>Interface returns v's current value as an interface{}. </p>\n\n<pre><code>func (v Value) Interface() (i interface{})\n</code></pre>\n"}], "owner": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534251412, "creation_date": 1534248699, "last_edit_date": 1534250082, "question_id": 51841131, "link": "https://stackoverflow.com/questions/51841131/how-to-get-the-nested-struct-from-variable-from-a-string-representation", "title": "How to get the nested struct from variable from a string representation?", "body": "<p>I have a JSON file looks like following somehow</p>\n\n<pre><code>{\n    \"type\": \"Weekly\",\n    \"clients\": [\n        \"gozo\",\n        \"dva\"\n    ],\n    \"sender\": \"no-reply@flowace.in\",\n    \"recipients\": {\n        \"gozo\": [\n            \"a@gmail.com\",\n            \"b@hotmail.com\"\n        ],\n        \"dva\": [\n            \"c@gmail.com\",\n            \"d@hotmail.com\"\n        ]\n    },\n    \"features\": [\n        \"Top5UsedApps\",\n        \"TimeSpentOnEachL3\",\n        \"NewlyAssignedL3\",\n        \"HoursLogged\"\n    ],\n    \"dbCloning\": [\n        \"dva\"\n    ] \n}\n</code></pre>\n\n<p>I have mapped structs like the following.</p>\n\n<pre><code>type receivers struct {\n    Gozo []string `json:\"gozo\"`\n    Dva  []string `json:\"dva\"`\n    // Add more recievers\n}\n\n// Config -- The config object parsed from the JSON file\ntype Config struct {\n    ReportType string    `json:\"type\"`\n    Clients    []string  `json:\"clients\"`\n    Sender     string    `json:\"sender\"`\n    Recipients receivers `json:\"recipients\"`\n    Cloning    []string  `json:\"dbCloning\"`\n}\n</code></pre>\n\n<p>Then somewhere in the another source file, I do the following,</p>\n\n<pre><code>func main() {\n    conf := LoadConfig(os.Args[1])\n    for _, client := range conf.Clients {\n\n        // Use the client variable of some other function calls\n\n        fmt.Println(conf.Recipients[client]) // This will not work\n}\n</code></pre>\n\n<p>Now my question is how can I make it work. I can not loop over <code>conf.Recipients</code> directly. </p>\n\n<p>PS: Consider that <code>LoadConfig</code> function unmarshal the JSON and returns a <code>conf</code> object.</p>\n\n<p><strong>Edit 1:</strong> It looks like it was design decision error. Now going with the solution of <code>map[string][]string</code>. But not marking it as an answer because the need to know how it is easily done for all the cases where there was no other choices.</p>\n"}, {"tags": ["go", "gradle", "gcloud"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534251316, "post_id": 51840889, "comment_id": 90636903, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/13214029/go-build-cannot-find-package-even-though-gopath-is-set\">Go build: &quot;Cannot find package&quot; (even though GOPATH is set)</a>"}], "answers": [{"tags": [], "owner": {"reputation": 548, "user_id": 3465651, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/2ebc2c8a8d4f8614deb0664a45fdb0b2?s=128&d=identicon&r=PG&f=1", "display_name": "user3465651", "link": "https://stackoverflow.com/users/3465651/user3465651"}, "is_accepted": false, "score": 1, "last_activity_date": 1534315955, "creation_date": 1534315955, "answer_id": 51854175, "question_id": 51840889, "link": "https://stackoverflow.com/questions/51840889/struggling-to-compile-go-project-with-gogradle/51854175#51854175", "title": "struggling to compile go project with gogradle", "body": "<p>I've added the 2 offending libs to the dependencies which seemed to fix it. Tho I am not sure why...</p>\n\n<pre><code>plugins {\n    id 'com.github.blindpirate.gogradle' version '0.10'\n}\n\ngolang {\n    goVersion = '1.9.7'\n    packagePath = 'com.misc/notifications'\n}\n\ndependencies {\n    golang {\n        build name: 'google.golang.org/appengine', tag: 'v1.1.0'\n        build name: 'github.com/golang/protobuf', tag: 'v1.1.0'\n        build name: 'github.com/golang/mock', tag: 'v1.1.0'\n        build name: 'cloud.google.com/go', tag: 'v0.24.0'\n        build name: 'github.com/googleapis/gax-go', tag: '1.0.0'\n        build name: 'github.com/golang/protobuf', tag: 'v1.1.0'\n        build name: 'golang.org/x/sync/errgroup', tag: ''\n        build name: 'google.golang.org/grpc/credentials/oauth', tag: ''\n    }\n}\n\nbuild {\n    outputLocation = './bin/notifications'\n}\n</code></pre>\n"}], "owner": {"reputation": 548, "user_id": 3465651, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/2ebc2c8a8d4f8614deb0664a45fdb0b2?s=128&d=identicon&r=PG&f=1", "display_name": "user3465651", "link": "https://stackoverflow.com/users/3465651/user3465651"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534315955, "creation_date": 1534247898, "question_id": 51840889, "link": "https://stackoverflow.com/questions/51840889/struggling-to-compile-go-project-with-gogradle", "title": "struggling to compile go project with gogradle", "body": "<p>I had this working in another vm. I have the same versions of the tooling being used:</p>\n\n<ul>\n<li>Gradle 4.9</li>\n<li>Java 8 Update 181</li>\n<li>golang 1.9.7</li>\n<li>gogradle pluging 0.10</li>\n</ul>\n\n<p>I receive the following error:</p>\n\n<p>13:44 $ gradle build</p>\n\n<pre><code>&gt; Configure project :\nFound go 1.9.7 in /home/phil/dev/tools/go/current/bin/go, use it.\n\n&gt; Task :prepare\nUse project GOPATH: /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath\n.gogradle/project_gopath/src/com.misc/notifications/vendor/cloud.google.com/go/pubsub/subscription.go:30:2: cannot find package \"golang.org/x/sync/errgroup\" in any of:\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/com.misc/notifications/vendor/golang.org/x/sync/errgroup (vendor tree)\n        /home/phil/dev/tools/go/go1.9.7/src/golang.org/x/sync/errgroup (from $GOROOT)\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/golang.org/x/sync/errgroup (from $GOPATH)\n.gogradle/project_gopath/src/com.misc/notifications/vendor/cloud.google.com/go/pubsub/flow_controller.go:19:2: cannot find package \"golang.org/x/sync/semaphore\" in any of:\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/com.misc/notifications/vendor/golang.org/x/sync/semaphore (vendor tree)\n        /home/phil/dev/tools/go/go1.9.7/src/golang.org/x/sync/semaphore (from $GOROOT)\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/golang.org/x/sync/semaphore (from $GOPATH)\n.gogradle/project_gopath/src/com.misc/notifications/vendor/google.golang.org/api/transport/grpc/dial.go:29:2: cannot find package \"google.golang.org/grpc/credentials/oauth\" in any of:\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/com.misc/notifications/vendor/google.golang.org/grpc/credentials/oauth (vendor tree)\n        /home/phil/dev/tools/go/go1.9.7/src/google.golang.org/grpc/credentials/oauth (from $GOROOT)\n        /home/phil/dev/projects/misc/go/Notification_System_GO/.gogradle/project_gopath/src/google.golang.org/grpc/credentials/oauth (from $GOPATH)\n</code></pre>\n\n<p>the build.gradle is as follows:</p>\n\n<pre><code>plugins {\n    id 'com.github.blindpirate.gogradle' version '0.10'\n}\n\ngolang {\n    packagePath = 'com.misc/notifications'\n}\n\ndependencies {\n    golang {\n        build name: 'google.golang.org/appengine', tag: 'v1.1.0'\n        build name: 'github.com/golang/protobuf'\n        build name: 'github.com/golang/mock'\n        build name: 'cloud.google.com/go', tag: 'v0.22.0'\n        build name: 'github.com/googleapis/gax-go', tag: '1.0.0'\n    }\n}\n\nbuild {\n    outputLocation = './bin/notifications'\n}\n</code></pre>\n\n<p>Any assistance would be greatly appreciated</p>\n"}, {"tags": ["java", "string", "go", "hash", "md5"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534246657, "post_id": 51840459, "comment_id": 90633929, "body": "You are printing <code>output[i]</code> instead of <code>digest[j]</code> in the <code>go</code> code. Isn&#39;t that what makes the difference in the logs you see?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1534246715, "post_id": 51840459, "comment_id": 90633973, "body": "You should make clear what input you use and what the output is."}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 6839616, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/57a337923dd1961f73bc8bbc5d3f23df?s=128&d=identicon&r=PG&f=1", "display_name": "Yoda", "link": "https://stackoverflow.com/users/6839616/yoda"}, "edited": false, "score": 0, "creation_date": 1534247312, "post_id": 51840549, "comment_id": 90634338, "body": "Ok for hex representation, I mistakenly added md.Sum(nil). However, in actual it is returning the hex representation of output only. Let me try the first correction though. However, the bytes in array digest in java and array data in go are different."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 303, "user_id": 6839616, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/57a337923dd1961f73bc8bbc5d3f23df?s=128&d=identicon&r=PG&f=1", "display_name": "Yoda", "link": "https://stackoverflow.com/users/6839616/yoda"}, "edited": false, "score": 1, "creation_date": 1534248872, "post_id": 51840549, "comment_id": 90635365, "body": "@Yoda See edited answer. <code>byte</code> in Java is signed and has a valid range of <code>-128..127</code>, while <code>byte</code> in Go is unsigned and has a valid range of <code>0..255</code>. Read more about it in <a href=\"https://stackoverflow.com/questions/47797100/java-vs-golang-for-hotp-rfc-4226/47797161#47797161\">this answer</a>. But the hex representation is the same."}, {"owner": {"reputation": 303, "user_id": 6839616, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/57a337923dd1961f73bc8bbc5d3f23df?s=128&d=identicon&r=PG&f=1", "display_name": "Yoda", "link": "https://stackoverflow.com/users/6839616/yoda"}, "edited": false, "score": 0, "creation_date": 1534302918, "post_id": 51840549, "comment_id": 90657529, "body": "corrected the error in inner loop which fixed it.  Thanks for your reply and suggestions which I will help me later."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1534248651, "last_edit_date": 1534248651, "creation_date": 1534246792, "answer_id": 51840549, "question_id": 51840459, "link": "https://stackoverflow.com/questions/51840459/md5-digest-of-string-in-go-is-different-from-that-of-java/51840549#51840549", "title": "MD5 digest of String in Go is different from that of Java", "body": "<h3>1. Different loops</h3>\n\n<p>Your inner loops are different.</p>\n\n<p>In Java:</p>\n\n<pre><code>for (int j = 0; j &lt; digest.length; j += 4) {\n    System.out.print(digest[j]);\n    output[i] ^= digest[i + j];\n}\n</code></pre>\n\n<p>In Go:</p>\n\n<pre><code>for j:=0; j &lt; len(data); j++ {\n    output[i] ^= data[i + j]\n    fmt.Print(output[i])\n}\n</code></pre>\n\n<p>Notice in Java you increment the loop variable by 4, and in Go only by 1. Use:</p>\n\n<pre><code>for j:=0; j &lt; len(data); j += 4 {\n    output[i] ^= data[i + j]\n    fmt.Print(output[i])\n}\n</code></pre>\n\n<h3>2. Different returned data</h3>\n\n<p><em><strong>UPDATE:</strong> Asker clarified that this was just a typo in the posted code and since then was removed (edited out).</em></p>\n\n<p>Also your Java solution returns the hex representation of the output:</p>\n\n<pre><code>return getHexString(output);\n</code></pre>\n\n<p>But in Go you return the hex representation of the (full) MD5 digest:</p>\n\n<pre><code>return getHexString(md.Sum(nil))\n</code></pre>\n\n<p>So in Go also do:</p>\n\n<pre><code>return getHexString(output)\n</code></pre>\n\n<h3>3. Input string => byte sequence conversion</h3>\n\n<p>One last note. In Java you convert your input string to a sequence of bytes using <code>US-ASCII</code> encoding, and in Go you are using the <code>UTF-8</code> encoded sequence of your input string, because this is how Go stores strings naturally (so you get the UTF-8 byte sequence when you do <code>[]byte(\"some text\")</code>).</p>\n\n<p>This will result in the same input data for texts using only characters of the ASCII table (whose code is less than 128), but will result in different data for texts that contain characters above that (as they will translate into multi-byte sequences in UTF-8). Something to keep in mind!</p>\n\n<hr>\n\n<h3>Simplification</h3>\n\n<p>Also note that to calculate the MD5 digest of some data, you may simply use the <a href=\"https://golang.org/pkg/crypto/md5/#Sum\" rel=\"nofollow noreferrer\"><code>md5.Sum()</code></a> function since you're throwing away the created <a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\"><code>hash.Hash</code></a> anyway:</p>\n\n<pre><code>func hashString(s string) string {\n    dataArr := md5.Sum([]byte(s))\n    data := dataArr[:]\n    fmt.Println(data)\n    output := make([]byte, len(data)/4)\n    for i := 0; i &lt; len(output); i += 4 {\n        for j := 0; j &lt; len(data); j++ {\n            output[i] ^= data[i+j]\n            fmt.Print(output[i])\n        }\n    }\n    return getHexString(output)\n}\n</code></pre>\n\n<h3>Byte representation differences</h3>\n\n<p>You said the content of the result arrays are different. This is due to the fact that the <code>byte</code> type in Java is signed, it has a range of <code>-128..127</code>, while in Go <code>byte</code> is an alias of <code>uint8</code> and has a range of <code>0..255</code>. So if you want to compare the results, you have to shift negative Java values by 256 (add 256).</p>\n\n<p>If you convert the byte arrays (or slices) to a hex representation, it will be the same (hex representation has no \"signness\" property).</p>\n\n<p>You can read more about this here: <a href=\"https://stackoverflow.com/questions/47797100/java-vs-golang-for-hotp-rfc-4226/47797161#47797161\">Java vs. Golang for HOTP (rfc-4226)</a></p>\n"}], "owner": {"reputation": 303, "user_id": 6839616, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/57a337923dd1961f73bc8bbc5d3f23df?s=128&d=identicon&r=PG&f=1", "display_name": "Yoda", "link": "https://stackoverflow.com/users/6839616/yoda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 0, "accepted_answer_id": 51840549, "answer_count": 1, "score": -3, "last_activity_date": 1534256648, "creation_date": 1534246454, "last_edit_date": 1534256648, "question_id": 51840459, "link": "https://stackoverflow.com/questions/51840459/md5-digest-of-string-in-go-is-different-from-that-of-java", "title": "MD5 digest of String in Go is different from that of Java", "body": "<p>I am creating MD5 digest in Java which is needed to calculate 4-byte hex hash of the input string. Following is the code in Java:</p>\n\n<pre><code>public static String hashString(String s) {\n        MessageDigest md;\n        try {\n            md = MessageDigest.getInstance(\"MD5\");\n            byte[] digest = md.digest(s.getBytes(\"US-ASCII\"));\n            byte[] output = new byte[digest.length / 4];\n            for (int i = 0; i &lt; output.length; i++) {\n                for (int j = 0; j &lt; digest.length; j += 4) {\n                    System.out.print(digest[j]);\n                    output[i] ^= digest[i + j];\n                }\n            }\n            return getHexString(output);\n        } catch (NoSuchAlgorithmException | UnsupportedEncodingException e) {\n           return null;\n        }\n    }\n</code></pre>\n\n<p>I wanted to use the same code in Golang, however, the MD5 output is different than what I am getting in Java. Below is the code in Go:</p>\n\n<pre><code>func hashString(s string) string {\n    md := md5.New()\n    md.Write([]byte(s))\n    data := md.Sum(nil)\n    fmt.Println(data)\n    output := make([]byte, len(data)/4)\n    for i := 0; i &lt; len(output); i++ {\n        for j:=0 ;j &lt; len(data); j++ {\n            output[i] ^= data[i + j]\n            fmt.Print(output[i])\n        }\n    }\n    return getHexString(output)\n}\n</code></pre>\n\n<p>I have added print statements in both code samples. As I am new in Go, I am not aware if there are any other libraries or way available to do so. I just followed what I found on internet. It would be really great if someone can help with this.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534252757, "post_id": 51839132, "comment_id": 90637917, "body": "This is covered on page 3 of the &quot;basics&quot; section of the Tour of Go: <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">tour.golang.org/basics/3</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534260770, "post_id": 51839132, "comment_id": 90643347, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24487943/invoke-golang-struct-function-gives-cannot-refer-to-unexported-field-or-method\">Invoke golang struct function gives &quot;cannot refer to unexported field or method&quot;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1534242254, "creation_date": 1534242254, "answer_id": 51839208, "question_id": 51839132, "link": "https://stackoverflow.com/questions/51839132/return-value-of-struct-in-function-and-use-it-in-another-package/51839208#51839208", "title": "Return value of struct in function and use it in another package", "body": "<p>It is a compile-time error to refer to unexported identifiers from other packages (other than the declaring package).</p>\n\n<p>Export the identifiers (start them with an uppercase letter), and it will work.</p>\n\n<pre><code>type Config struct {\n    DB       map[string]string\n    User     string\n    Password string\n}\n\nfunc GetConf() *Config {\n    config := Config{\n        DB: map[string]string{\n            \"dev\": \"database.url\",\n        },\n        User:     \"root\",\n        Password: \"pass\",\n    }\n\n    return &amp;config\n}\n</code></pre>\n\n<p>And in your main:</p>\n\n<pre><code>func main() {\n    conf := config.GetConf()\n\n    db := dbConn{\n        schemas:  map[string]*sql.DB{},\n        url:      fmt.Sprintf(\"tcp(%s)\", conf.DB['dev']),\n        username: conf.User,\n        password: conf.Password,\n    }\n    db.create()\n}\n</code></pre>\n"}], "owner": {"reputation": 126, "user_id": 3556049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a14564f6cc0e08649235bc4bd22d92d0?s=128&d=identicon&r=PG", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/3556049/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 51839208, "answer_count": 1, "score": -1, "last_activity_date": 1534260716, "creation_date": 1534242032, "last_edit_date": 1534260716, "question_id": 51839132, "link": "https://stackoverflow.com/questions/51839132/return-value-of-struct-in-function-and-use-it-in-another-package", "title": "Return value of struct in function and use it in another package", "body": "<p>I try create package config in my example project but something doesn't work as I expected, I have folder structure:</p>\n\n<pre><code>config/config.go // package config\nmain.go  // package main\n</code></pre>\n\n<p>and I want use config in my main file:</p>\n\n<pre><code>func main() {\n    conf := config.GetConf()\n\n    db := dbConn{\n        schemas:  map[string]*sql.DB{},\n        url:      fmt.Sprintf(\"tcp(%s)\", conf.db['dev']),\n        username: db.user,\n        password: db.password,\n    }\n    db.create()\n}\n</code></pre>\n\n<p>my config file:</p>\n\n<pre><code>type Config struct {\n    db         map[string]string\n    user     string\n    password string\n}\n\nfunc GetConf() *Config {\n    config := Config{\n        db: map[string]string{\n            \"dev\": \"database.url\",\n        },\n        user: \"root\",\n        password: \"pass\",\n    }\n\n    return &amp;config\n}\n</code></pre>\n\n<p>compiler return error: conf.db undefined (cannot refer to unexported field or method db)</p>\n"}, {"tags": ["c", "go", "dll"], "answers": [{"tags": [], "owner": {"reputation": 4031, "user_id": 7640269, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/szGUJ.png?s=128&g=1", "display_name": "danglingpointer", "link": "https://stackoverflow.com/users/7640269/danglingpointer"}, "is_accepted": true, "score": 0, "last_activity_date": 1534242673, "creation_date": 1534242673, "answer_id": 51839354, "question_id": 51838685, "link": "https://stackoverflow.com/questions/51838685/how-to-use-c-dll/51839354#51839354", "title": "How to use C .dll", "body": "<blockquote>\n  <p>Is there any way to use custom C dll in golang?</p>\n</blockquote>\n\n<p>The answer to your question, yes</p>\n\n<p>You have to import the C that you commented in your code. In order to call the c function, you need to import \"C\".</p>\n\n<pre><code>import \"C\"\n</code></pre>\n\n<p>The cgo way allows you to call the function this way:</p>\n\n<pre><code>import (\"C\")\n...\nC.yourDllFunc(...)\n</code></pre>\n\n<hr>\n\n<p>Reference and more information about <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo</a></p>\n\n<p>Very generic example <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">cgo</a>.</p>\n\n<pre><code>package cgoexample\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid myprint(char* s) {\n    printf(\"%s\\n\", s);\n}\n*/\nimport \"C\"\n\nimport \"unsafe\"\n\nfunc Example() {\n    cs := C.CString(\"Hello from stdio\\n\")\n    C.myprint(cs)\n    C.free(unsafe.Pointer(cs))\n}\n</code></pre>\n"}], "owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "closed_date": 1534498729, "accepted_answer_id": 51839354, "answer_count": 1, "score": 2, "last_activity_date": 1534242673, "creation_date": 1534240445, "last_edit_date": 1534242330, "question_id": 51838685, "link": "https://stackoverflow.com/questions/51838685/how-to-use-c-dll", "closed_reason": "Duplicate", "title": "How to use C .dll", "body": "<p>Is there any way to use custom C dll in golang?\nI have my dll written in C (goDLL.dll)\nand i want to use it inside go</p>\n\n<p>Here is little example what i want to get:</p>\n\n<pre><code>package main\n\n    //#import \"goDLL.dll\"\n    //extern void add(int * A, int * B, int * C)\n    //{\n    //      *C = *A + *B;\n    //}\n    //\n    // import \"C\"\n     import (\n     \"fmt\"\n     ) \n\nfunc main() {\n\n    var AA *C.int = new(C.int)\n    var BB *C.int = new(C.int)\n    var CC *C.int = new(C.int)\n\n    *AA = 5\n    *BB = 4\n\n    C.add(AA, BB, CC)\n    fmt.Println(*CC)\n\n}\n</code></pre>\n"}, {"tags": ["sqlite", "docker", "go", "dynamic-library", "spatialite"], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 10223243, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1dcb66b6ad2842cc4be2dd7a673f462?s=128&d=identicon&r=PG&f=1", "display_name": "mich", "link": "https://stackoverflow.com/users/10223243/mich"}, "edited": false, "score": 0, "creation_date": 1534409622, "post_id": 51844710, "comment_id": 90697749, "body": "With the 4.3.0 version, I had libspatialite.so.7 in my usr/local/bin. Even by replacing the version of libspatialite to 5, it still was libspatialite.so.7. I&#39;ll try to figure why it is .7 version."}], "tags": [], "owner": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "is_accepted": false, "score": 0, "last_activity_date": 1534259713, "creation_date": 1534259713, "answer_id": 51844710, "question_id": 51837129, "link": "https://stackoverflow.com/questions/51837129/spatialite-extension-not-found-when-running-go-binary-in-docker-container/51844710#51844710", "title": "Spatialite extension not found when running go binary in docker container", "body": "<p>That <code>Dockerfile</code> sets up a container with <code>libspatialite</code> version <code>4.3.0a</code>. </p>\n\n<pre><code>...\n\nRUN wget \"http://www.gaia-gis.it/gaia-sins/freexl-1.0.4.tar.gz\" &amp;&amp; tar zxvf freexl-1.0.4.tar.gz &amp;&amp; cd freexl-1.0.4 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install\n\nRUN wget \"http://www.gaia-gis.it/gaia-sins/libspatialite-4.3.0a.tar.gz\" &amp;&amp; tar zxvf libspatialite-4.3.0a.tar.gz &amp;&amp; cd libspatialite-4.3.0a &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install\n\nRUN wget \"http://www.gaia-gis.it/gaia-sins/readosm-1.1.0.tar.gz\" &amp;&amp; tar zxvf readosm-1.1.0.tar.gz &amp;&amp; cd readosm-1.1.0 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install\n\nRUN wget \"http://www.gaia-gis.it/gaia-sins/spatialite-tools-4.3.0.tar.gz\" &amp;&amp; tar zxvf spatialite-tools-4.3.0.tar.gz &amp;&amp; cd spatialite-tools-4.3.0 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install\n...\n</code></pre>\n\n<p>From one of the recent commits to <code>go-spatialite</code>, we can see that the required version is <code>5</code>.</p>\n\n<pre><code>var LibNames = []entrypoint{\n    {\"mod_spatialite\", \"sqlite3_modspatialite_init\"},\n    {\"libspatialite.so\", \"sqlite3_modspatialite_init\"},\n    {\"libspatialite.so.5\", \"spatialite_init_ex\"},\n    {\"libspatialite.so\", \"spatialite_init_ex\"},\n}\n</code></pre>\n\n<p>(<a href=\"https://github.com/shaxbee/go-spatialite/commit/c92bcfa4f45590b0c3e31befa41b5ed11d0adb49#diff-294f8f825075a5feb41d6f183cbd30d9\" rel=\"nofollow noreferrer\">spatialite.go</a>)</p>\n\n<p>Use a container with version 5 of <code>libspatialite</code> to resolve your issue.</p>\n"}], "owner": {"reputation": 127, "user_id": 10223243, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1dcb66b6ad2842cc4be2dd7a673f462?s=128&d=identicon&r=PG&f=1", "display_name": "mich", "link": "https://stackoverflow.com/users/10223243/mich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534259713, "creation_date": 1534235718, "last_edit_date": 1534237773, "question_id": 51837129, "link": "https://stackoverflow.com/questions/51837129/spatialite-extension-not-found-when-running-go-binary-in-docker-container", "title": "Spatialite extension not found when running go binary in docker container", "body": "<p>I am setting up a Spatialite database (SQLite + Spatialite extension) and an associated Go program running in a docker container that queries the database and returns data.</p>\n\n<p>Go-spatialite, in my understanding will dynamically load the spatialite library at runtime in order to query the database. Everything runs fine when running the Go program locally and querying the service with Postman.</p>\n\n<p>However, when using the container, the Go program fails to find the spatialite extension:</p>\n\n<pre><code>\"error\":\"shaxbee/go-spatialite: spatialite extension not found.\"\n</code></pre>\n\n<p>I use <a href=\"https://github.com/shaxbee/go-spatialite\" rel=\"nofollow noreferrer\">go-spatialite (shaxbee) package</a> and <code>database/sql</code> package. I have installed Spatialite locally.</p>\n\n<p>I open the database connection like this:</p>\n\n<pre><code>db, err := sql.Open(\"spatialite\", \"path/to/my/db\")\nif err != nil {\n    logVar.WithError(err).Fatal(\"Impossible to open database\")\n}\nif err := db.Ping(); err != nil {\n    logVar.WithError(err).Fatal(\"Cannot connect to database\")\n}\n</code></pre>\n\n<p>I used this <a href=\"https://github.com/terranodo/spatialite-docker/blob/master/Dockerfile\" rel=\"nofollow noreferrer\">Dockerfile</a> to adapt mine (that is based on alpine-glibc) in order to install the Spatialite library during image building. According to the <a href=\"https://github.com/shaxbee/go-spatialite/blob/master/spatialite.go\" rel=\"nofollow noreferrer\">Spatialite package</a>, it looks for different for spatialite library and load it.</p>\n\n<p>When checking <code>/usr/local/lib/</code> in the container, the libraries are there:</p>\n\n<pre><code>libspatialite.a\nlibspatialite.la\nlibspatialite.so\nlibspatialite.so.7\nlibspatialite.so.7.1.0\nlibsqlite3.so\nlibsqlite3.so.0\nlibsqlite3.so.0.8.6\n</code></pre>\n\n<p>It seems to me that the program does not know where to get the libraries. Do you have any ideas ? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "jwt", "jwt-go"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534225865, "post_id": 51834234, "comment_id": 90622703, "body": "There is no public or private key, when you work with JWT. There is just a secrect. <a href=\"https://jwt.io/\" rel=\"nofollow noreferrer\">jwt.io</a>"}, {"owner": {"reputation": 291, "user_id": 8682336, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kl_8cldQJU8/AAAAAAAAAAI/AAAAAAAAB2M/x2CIyLdAbu0/photo.jpg?sz=128", "display_name": "Nguyen Dang Minh", "link": "https://stackoverflow.com/users/8682336/nguyen-dang-minh"}, "edited": false, "score": 1, "creation_date": 1534234565, "post_id": 51834234, "comment_id": 90626771, "body": "No. You could use RSA algorithm to sign, it needs a pair of private key and public key to sign and verify."}], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 5, "last_activity_date": 1534224577, "last_edit_date": 1592644375, "creation_date": 1534224577, "answer_id": 51834275, "question_id": 51834234, "link": "https://stackoverflow.com/questions/51834234/i-have-a-public-key-and-a-jwt-how-do-i-check-if-its-valid-in-go/51834275#51834275", "title": "I have a public key and a JWT, how do I check if it&#39;s valid in Go?", "body": "<p>Using <code>jwt-go</code>, you can do this</p>\n<pre><code>token, err := p.Parse(IDToken, func(*jwt.Token) (interface{}, error) {\n    return []byte(signingKey), nil\n})\n</code></pre>\n<p>And it will verify the token against the key.</p>\n<p>Quoting the <a href=\"https://godoc.org/github.com/dgrijalva/jwt-go#Keyfunc\" rel=\"noreferrer\">documentation</a>,</p>\n<blockquote>\n<p>type Keyfunc func(*Token) (interface{}, error)</p>\n<p>Parse methods use this callback function to supply the key for verification. The function receives the parsed, but unverified Token. This allows you to use properties in the Header of the token (such as <code>kid</code>) to identify which key to use.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 291, "user_id": 8682336, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kl_8cldQJU8/AAAAAAAAAAI/AAAAAAAAB2M/x2CIyLdAbu0/photo.jpg?sz=128", "display_name": "Nguyen Dang Minh", "link": "https://stackoverflow.com/users/8682336/nguyen-dang-minh"}, "is_accepted": false, "score": 7, "last_activity_date": 1534234457, "creation_date": 1534234457, "answer_id": 51836745, "question_id": 51834234, "link": "https://stackoverflow.com/questions/51834234/i-have-a-public-key-and-a-jwt-how-do-i-check-if-its-valid-in-go/51836745#51836745", "title": "I have a public key and a JWT, how do I check if it&#39;s valid in Go?", "body": "<p>The token was signed by RSA algorithm that uses a private key to sign and a public key to verify. Store your public key to the files system and use <code>jwt.SigningMethodRS256.Verify()</code> to verify. As the following snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"log\"\n    \"io/ioutil\"\n    jwt \"github.com/dgrijalva/jwt-go\"\n)\n\nfunc main() {\n    publicKeyPath := \"~/public_key.key\"\n    token := \"your_jwt_token_here\"\n\n    if isValid, err := verifyToken(token, publicKeyPath)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if isValid {\n        fmt.Println(\"The token is valid\")\n    } else {\n        fmt.Println(\"The token is invalid\")\n    }\n}\n\nfunc verifyToken(token, publicKeyPath string) (bool, error) {\n    keyData, err := ioutil.ReadFile(publicKeyPath)\n    if err != nil {\n        return false, err\n    }\n    key, err := jwt.ParseRSAPublicKeyFromPEM(keyData)\n    if err != nil {\n        return false, err\n    }\n\n    parts := strings.Split(token, \".\")\n    err = jwt.SigningMethodRS256.Verify(strings.Join(parts[0:2], \".\"), parts[2], key)\n    if err != nil {\n        return false, nil\n    }\n    return true, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2397, "favorite_count": 0, "answer_count": 2, "score": 8, "last_activity_date": 1615754450, "creation_date": 1534224346, "last_edit_date": 1588058221, "question_id": 51834234, "link": "https://stackoverflow.com/questions/51834234/i-have-a-public-key-and-a-jwt-how-do-i-check-if-its-valid-in-go", "title": "I have a public key and a JWT, how do I check if it&#39;s valid in Go?", "body": "<p>I have a public key from my identity provider </p>\n\n<pre><code>-----BEGIN PUBLIC KEY-----\nTHIS\n-----END PUBLIC KEY-----\n</code></pre>\n\n<p>And a JWT token from my client.</p>\n\n<p>How do I check the token against the key?\nI'm having difficulty with <code>jwt-go</code> because the Parse function takes the token string and a <code>getKey</code> function.</p>\n\n<p>Not sure how exactly to proceed </p>\n"}, {"tags": ["arrays", "go", "struct", "field"], "comments": [{"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 1, "creation_date": 1534220436, "post_id": 51833393, "comment_id": 90621174, "body": "Did you make sure to initialize the array?"}, {"owner": {"reputation": 1670, "user_id": 188256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cXJkr.png?s=128&g=1", "display_name": "snipsnipsnip", "link": "https://stackoverflow.com/users/188256/snipsnipsnip"}, "edited": false, "score": 2, "creation_date": 1534220455, "post_id": 51833393, "comment_id": 90621181, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33892599/how-to-initialize-values-for-nested-struct-array-in-golang\">How to initialize values for nested struct array in golang</a>"}, {"owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "edited": false, "score": 2, "creation_date": 1534220556, "post_id": 51833393, "comment_id": 90621207, "body": "I think this is what you want: Car.Type = []int{12,15,11}"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1534221595, "post_id": 51833393, "comment_id": 90621469, "body": "Take the Tour of Go which explains slices in detail."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1534224121, "post_id": 51833393, "comment_id": 90622148, "body": "You are using a slice and not a array. I would also recomend the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Tour of Go</a> these things are explained there."}], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 2, "creation_date": 1534269800, "post_id": 51834202, "comment_id": 90648092, "body": "You only very, very rarely need to use an array in golang. You use a slice, but OP needs to initialise it before using it"}], "tags": [], "owner": {"reputation": 291, "user_id": 8682336, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kl_8cldQJU8/AAAAAAAAAAI/AAAAAAAAB2M/x2CIyLdAbu0/photo.jpg?sz=128", "display_name": "Nguyen Dang Minh", "link": "https://stackoverflow.com/users/8682336/nguyen-dang-minh"}, "is_accepted": false, "score": 4, "last_activity_date": 1534224150, "creation_date": 1534224150, "answer_id": 51834202, "question_id": 51833393, "link": "https://stackoverflow.com/questions/51833393/how-to-access-a-slice-in-struct-in-golang/51834202#51834202", "title": "How to access a slice in struct in golang", "body": "<p>You mistake <code>slice</code> for <code>array</code>. It must be:</p>\n\n<pre><code>type Car struct {\n    Year int\n    Name string\n    Type [3]int // &lt;---\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/iCMgV1oYT-2\" rel=\"noreferrer\">running code</a></p>\n\n<p>You should read this tour: <a href=\"https://tour.golang.org/moretypes/6\" rel=\"noreferrer\">https://tour.golang.org/moretypes/6</a></p>\n"}, {"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534230297, "post_id": 51835376, "comment_id": 90624557, "body": "<code>They have not defined index until they are appended.</code> is not true. Slices point to underlying array. you are confusing with nil slices."}, {"owner": {"reputation": 95, "user_id": 8774650, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-v89qZfm8_YQ/AAAAAAAAAAI/AAAAAAAAEQU/BDO9LcdTJ_Y/photo.jpg?sz=128", "display_name": "luffy", "link": "https://stackoverflow.com/users/8774650/luffy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534241896, "post_id": 51835376, "comment_id": 90631138, "body": "Yeah! I was saying with respect to the way he has defined his slice. Edited and corrected it."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534342886, "post_id": 51835376, "comment_id": 90673294, "body": "@Himanshu: If the slice field of the struct wasn&#39;t initialised, the OP is trying to set values on a nil slice. Also <code>append</code> is variadic, so no reason to call it three times, just <code>car.Type = append(car.Type, 12, 15, 11)</code> will do"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1534344420, "post_id": 51835376, "comment_id": 90674234, "body": "@EliasVanOotegem yes I know it is variadic  function but this is not my answer and the answer is wrong."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534344964, "post_id": 51835376, "comment_id": 90674549, "body": "@Himanshu: I know it&#39;s not your answer, and the answer isn&#39;t 100%, hence I provided my quite verbose answer, because the current highest scoring one is advising to use an array instead of a slice, which is also wrong (as slices and arrays are not the same thing)"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1534345281, "post_id": 51835376, "comment_id": 90674723, "body": "@EliasVanOotegem what you want from me friend. Create a chat room. If you have any thing to discuss."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534352659, "post_id": 51835376, "comment_id": 90678611, "body": "@Himanshu steady on... wasn&#39;t trying to argue. Just trying to dot the I&#39;s and cross the T&#39;s. No need to get all defensive"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1534355992, "post_id": 51835376, "comment_id": 90680137, "body": "@EliasVanOotegem I am not arguing. I am supporting your reasons. you are correct."}], "tags": [], "owner": {"reputation": 95, "user_id": 8774650, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-v89qZfm8_YQ/AAAAAAAAAAI/AAAAAAAAEQU/BDO9LcdTJ_Y/photo.jpg?sz=128", "display_name": "luffy", "link": "https://stackoverflow.com/users/8774650/luffy"}, "is_accepted": false, "score": -1, "last_activity_date": 1534241826, "last_edit_date": 1534241826, "creation_date": 1534229655, "answer_id": 51835376, "question_id": 51833393, "link": "https://stackoverflow.com/questions/51833393/how-to-access-a-slice-in-struct-in-golang/51835376#51835376", "title": "How to access a slice in struct in golang", "body": "<p>You are confusing Slices and Array. Slices are like dynamic arrays. The way you have defined the slice, their index is not defined until they are appended. For the above code:</p>\n\n<pre><code>type Car struct {\nType []int\n}\nvar car Car\ncar.Type = append(car.Type, 12)\ncar.Type = append(car.Type, 15)\ncar.Type = append(car.Type, 11)\n</code></pre>\n\n<p>Also, <em>Car</em> in your case is a <em>type</em> of object not a object itself. I have declared object <em>car</em> of type <em>Car</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 37, "user_id": 8844167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166faf4f2a85b07fdad06eaccf6e9cbe?s=128&d=identicon&r=PG&f=1", "display_name": "leo888", "link": "https://stackoverflow.com/users/8844167/leo888"}, "edited": false, "score": 0, "creation_date": 1534377774, "post_id": 51847446, "comment_id": 90687725, "body": "Thanks Elias for detail explanation. I used append() to initialize Type field and it fixed my issue."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 37, "user_id": 8844167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166faf4f2a85b07fdad06eaccf6e9cbe?s=128&d=identicon&r=PG&f=1", "display_name": "leo888", "link": "https://stackoverflow.com/users/8844167/leo888"}, "edited": false, "score": 0, "creation_date": 1534419493, "post_id": 51847446, "comment_id": 90703498, "body": "@leo888 No worries, please upvote/accept this answer if it helped. That&#39;s the correct way to mark the question as answered"}, {"owner": {"reputation": 552, "user_id": 3368420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3cc00fa27c8b4224cd6ccf961bcda2e?s=128&d=identicon&r=PG", "display_name": "Juan Jos&#233; Ram&#237;rez", "link": "https://stackoverflow.com/users/3368420/juan-jos%c3%a9-ram%c3%adrez"}, "edited": false, "score": 0, "creation_date": 1549480547, "post_id": 51847446, "comment_id": 95921075, "body": "this is the correct answer. Very detailed explanation, thanks!"}, {"owner": {"reputation": 552, "user_id": 3368420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3cc00fa27c8b4224cd6ccf961bcda2e?s=128&d=identicon&r=PG", "display_name": "Juan Jos&#233; Ram&#237;rez", "link": "https://stackoverflow.com/users/3368420/juan-jos%c3%a9-ram%c3%adrez"}, "edited": false, "score": 1, "creation_date": 1549480703, "post_id": 51847446, "comment_id": 95921155, "body": "@EliasVanOotegem is the <code>c.Type := make(...</code> in the examples correct? I think it should be <code>c.Type = make(...</code>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 552, "user_id": 3368420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3cc00fa27c8b4224cd6ccf961bcda2e?s=128&d=identicon&r=PG", "display_name": "Juan Jos&#233; Ram&#237;rez", "link": "https://stackoverflow.com/users/3368420/juan-jos%c3%a9-ram%c3%adrez"}, "edited": false, "score": 1, "creation_date": 1549555878, "post_id": 51847446, "comment_id": 95952600, "body": "@JuanJos&#233;Ram&#237;rez: well spotted, made the edit. Thanks for saying this is the correct answer, can&#39;t believe someone saying to use an array gets +3 on a golang question. A language where you&#39;re being told time and again to use slices instead of arrays in most cases."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 2, "last_activity_date": 1549555704, "last_edit_date": 1549555704, "creation_date": 1534270233, "answer_id": 51847446, "question_id": 51833393, "link": "https://stackoverflow.com/questions/51833393/how-to-access-a-slice-in-struct-in-golang/51847446#51847446", "title": "How to access a slice in struct in golang", "body": "<p>You can't directly access a slice field if it's not been initialised. You're defining a struct to have 3 fields: <code>Year</code> of type int, this is a simple value that is part of the struct. Same goes for <code>Name</code>. The <code>Type</code> field, however, is a slice. A slice is a <em>reference type</em>. That means it's essentially a hidden struct (called the slice header) with underlying pointer to an array that is allocated dynamically for you. This underlying pointer is, at the time you initialise your variable, <code>nil</code>.</p>\n\n<pre><code>type Car struct {\n    Year int\n    Name string\n    Type []int\n}\n</code></pre>\n\n<p>Can be seen as:</p>\n\n<pre><code>type Car struct {\n    Year int\n    Name string\n    Type struct{\n        type: \"int\",\n        array *[]T\n    }\n}\n</code></pre>\n\n<p>Not exactly, but you get the idea. When you write:</p>\n\n<pre><code>c := Car{}\n</code></pre>\n\n<p>All you've allocated is the int, string and the slice <em>header</em>. You must, therefore initialise the slice first:</p>\n\n<pre><code>c := Car{\n    Year: 2018,\n    Name: \"vroom\",\n    Type: []int{\n        1, 2, 3,\n    },\n}\n</code></pre>\n\n<p>There are many ways to initialise the slice, of course. You don't have to set the values just yet, but you could, for example, allocate and initialise the memory you need in one go:</p>\n\n<pre><code>c.Type = make([]int, 3) // allocates an initialised 3 elements in the slice to 0\n</code></pre>\n\n<p>you can also allocate but not initialise the slice by specifying the capacity (this is useful to avoid reallocating and moving the slice around too often):</p>\n\n<pre><code>c.Type = make([]int, 0, 3)\n</code></pre>\n\n<p>Alternatively, you can have the runtime do it all for you, using append:</p>\n\n<pre><code>c.Type = append(c.Type, 1, 2, 3)\n</code></pre>\n\n<h2>Some examples <a href=\"https://play.golang.org/p/hP1_YDpRiQd\" rel=\"nofollow noreferrer\">here</a></h2>\n\n<hr>\n\n<p>A bit more background. Slices and maps work similarly, broadly speaking. Because they are reference types, that rely on pointers internally, it's possible for functions that have a slice as a return type to return <code>nil</code> for example. This doesn't work for functions returning an <code>int</code>:</p>\n\n<pre><code>func nilSlice() []int {\n    return nil\n}\n</code></pre>\n\n<p>Because the return type is a slice, what this function will return is, essentially, an empty slice. Accessing it will result in the same error you occurred: index out of range.</p>\n\n<p>Trying to return nil from a function like this won't even compile:</p>\n\n<pre><code>func nilInt() int {\n    nil\n}\n</code></pre>\n\n<p>The resulting error will say something like <em>\"Can't use nil as type int\"</em>. Treat slices as pointer types: they need to be safely initialised before use. Always check their length, and if you need to optimise, look at how the builtin <code>append</code> function is implemented. It'll just exponentially grow the capacity of the underlying array. Something that you may not always want. It's trivial to optimise this sort of stuff</p>\n"}], "owner": {"reputation": 37, "user_id": 8844167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166faf4f2a85b07fdad06eaccf6e9cbe?s=128&d=identicon&r=PG&f=1", "display_name": "leo888", "link": "https://stackoverflow.com/users/8844167/leo888"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8024, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1549555704, "creation_date": 1534218014, "last_edit_date": 1534228804, "question_id": 51833393, "link": "https://stackoverflow.com/questions/51833393/how-to-access-a-slice-in-struct-in-golang", "title": "How to access a slice in struct in golang", "body": "<p>How can I access a slice defined inside the struct?</p>\n\n<pre><code>type Car struct {\n    Year int\n    Name string\n    Type []int\n}\n</code></pre>\n\n<p>//Accessing \"Type\" array field as below causes error: array out of range.</p>\n\n<pre><code>Car.Type[0] = 12\nCar.Type[1] = 15\nCar.Type[2] = 11\n</code></pre>\n"}, {"tags": ["go", "web-scraping", "queue"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534217478, "post_id": 51832493, "comment_id": 90620508, "body": "And you are certain that rows contains multiple distinct values? What does ReadInput do?"}, {"owner": {"reputation": 31, "user_id": 7362078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1e0e69f3615fa73e3742dbded013ce?s=128&d=identicon&r=PG&f=1", "display_name": "0xTanvir", "link": "https://stackoverflow.com/users/7362078/0xtanvir"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534228802, "post_id": 51832493, "comment_id": 90623858, "body": "ReadInput just read some url from a txt file. rows will be contain some slice of string(url)."}], "owner": {"reputation": 31, "user_id": 7362078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1e0e69f3615fa73e3742dbded013ce?s=128&d=identicon&r=PG&f=1", "display_name": "0xTanvir", "link": "https://stackoverflow.com/users/7362078/0xtanvir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 547, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534211739, "creation_date": 1534209571, "last_edit_date": 1534211739, "question_id": 51832493, "link": "https://stackoverflow.com/questions/51832493/how-to-add-list-of-url-to-gocolly-queue", "title": "How to add list of url to gocolly Queue?", "body": "<p>I want to scrape a list of url to using gocolly</p>\n\n<pre><code>func main() {\n    fileName := \"output.txt\"\n    var result string\n\n    f, err := os.Create(fileName)\n    if err != nil {\n        panic(err)\n    }\n    defer func() {\n        if err := f.Close(); err != nil {\n            panic(err)\n        }\n    }()\n\n    rows := ReadInput()\n    q := AddUrl(rows)\n\n    // Instantiate default collector\n    c := colly.NewCollector()\n\n    c.OnHTML(\"body\", func(e *colly.HTMLElement) {\n        result = result + e.Text +\"\\n\"\n    })\n\n    c.OnRequest(func(r *colly.Request) {\n        fmt.Println(\"visiting\", r.URL)\n    })\n\n    // Set error handler\n    c.OnError(func(r *colly.Response, err error) {\n        fmt.Println(\"Request URL:\", r.Request.URL, \"failed with response:\", r, \"\\nError:\", err)\n    })\n\n    q.Run(c)\n\n    f.WriteString(result)\n\n    log.Printf(\"Scraping done, Please check file %q for results\\n\", fileName)\n}\n\nfunc ReadInput() []string{\n    // Read from file\n    b, err := ioutil.ReadFile(\"input.txt\") // just pass the file name\n    if err != nil {\n        fmt.Print(err)\n    }\n    str := string(b) // convert content to a 'string'\n\n    // split each row\n    rows := strings.Split(str,\"\\n\")\n    return rows\n}\n</code></pre>\n\n<p>But when I am trying to add url from slice of string(url) to gocolly queue it doesn't add all url, just added the last url.</p>\n\n<pre><code>func AddUrl(rows []string) *queue.Queue {\n    Q, _ := queue.New(\n        2, // Number of consumer threads\n        &amp;queue.InMemoryQueueStorage{MaxSize: 10000},\n    )\n    for _,url:=range rows{\n        Q.AddURL(url)\n    }\n    return Q\n}\n</code></pre>\n\n<p>instead of loop if I add url maually then it's work perfectly, but with loop it just add the last element.</p>\n\n<pre><code>func AddUrl(rows []string) *queue.Queue {\n    Q, _ := queue.New(\n        2, // Number of consumer threads\n        &amp;queue.InMemoryQueueStorage{MaxSize: 10000},\n    )\n    Q.AddURL(\"http://bakeshopva.com\") \n    Q.AddURL(\"http://zekescoffeedc.com\")\n    return Q\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534190825, "post_id": 51829829, "comment_id": 90613983, "body": "Correct. <code>v</code> is the same variable in each iteration, only its value changes."}, {"owner": {"reputation": 85, "user_id": 6434929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-khtDb2bMEHo/AAAAAAAAAAI/AAAAAAAABI4/NtwwH8HAODs/photo.jpg?sz=128", "display_name": "Ali Dabour", "link": "https://stackoverflow.com/users/6434929/ali-dabour"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534191185, "post_id": 51829829, "comment_id": 90614134, "body": "So go does this to save memory allocations?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534191287, "post_id": 51829829, "comment_id": 90614176, "body": "Does what save memory allocations? Comparing the memory allocations of working code vs incorrect code seems irrelevant, so I&#39;m not sure what you&#39;re asking."}, {"owner": {"reputation": 85, "user_id": 6434929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-khtDb2bMEHo/AAAAAAAAAAI/AAAAAAAABI4/NtwwH8HAODs/photo.jpg?sz=128", "display_name": "Ali Dabour", "link": "https://stackoverflow.com/users/6434929/ali-dabour"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534191639, "post_id": 51829829, "comment_id": 90614326, "body": "I mean that in every iteration in for loop <code>v.Number</code> will have the same pointer value but with different variable value .. so in every iteration go will update the pointer with new value ... instead of creating new pointer and assign new value to it.( So this save memory allocation)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534191700, "post_id": 51829829, "comment_id": 90614347, "body": "If you&#39;re asking if that&#39;s why it works that way, I&#39;m guessing it has more to do with simplicity than memory efficiency, but that&#39;s just a guess. If you really want to know you&#39;d have to ask the Go creators."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1534196595, "last_edit_date": 1534196595, "creation_date": 1534195715, "answer_id": 51830823, "question_id": 51829829, "link": "https://stackoverflow.com/questions/51829829/value-generated-from-range-have-same-pointer-value/51830823#51830823", "title": "Value generated from range have same pointer value", "body": "<p>As @Adrian stated This has nothing to do with memory. The <code>A</code> struct is actually contains a pointer to integer value. </p>\n\n<pre><code>type A struct {\n    Number *int\n}\n</code></pre>\n\n<p>So when you are assigning the value from <code>bSlice</code> to <code>A</code> struct and then appending the <code>A</code> struct in <code>aSlice</code> which is of <code>A</code> struct type. It will append the values as it is supposed to do inside Golang. </p>\n\n<p>But you are changing the value at address pointed by <code>A</code> struct. And initialed with a new value in each iteration which changes the value at that address. </p>\n\n<pre><code>a.Number = &amp;v.Number // here a.Number points to the same address \n</code></pre>\n\n<p>Hence the aSlice contains the value of last updated integer which is <code>3</code>. Since aSlice is a slice of A struct it contains the value inside A struct which is <code>3</code>. </p>\n\n<p>But if you do not create a pointer to <code>int</code> inside <code>A</code> struct </p>\n\n<pre><code>type A struct {\n    Number int\n}\n</code></pre>\n\n<p>you will get the output as expected with different address now as.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    Number int\n}\n\ntype B struct {\n    Number int\n}\n\nfunc main() {\n    aSlice := []A{}\n    bSlice := []B{B{1}, B{2}, B{3}}\n    fmt.Println(\"----Assignment Loop----\")\n    for _, v := range bSlice {\n        a := A{}\n        a.Number = v.Number\n        aSlice = append(aSlice, a)\n        fmt.Printf(\"bSlice Value %v Pointer %v\\n\", v.Number, &amp;v.Number)\n        fmt.Printf(\"  a    Value %v Pointer %v\\n\", a.Number, &amp;a.Number)\n    }\n    fmt.Println(\"\\n----After Assignment----\")\n    fmt.Printf(\"%+v\\n\", aSlice)\n    for i, _ := range aSlice {\n        fmt.Println(aSlice[i].Number)\n    }\n}\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/uNyFjHsjga7\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p>In Golang spec It is defined for composite Literals as :</p>\n\n<blockquote>\n  <p>Taking the address of a composite literal generates a pointer to a\n  unique variable initialized with the literal's value.</p>\n</blockquote>\n\n<pre><code>type Point3D struct { x, y, z float64 }\nvar pointer *Point3D = &amp;Point3D{y: 1000}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 10219365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bbc1ed5c64993e4bda90fa6cefb99c?s=128&d=identicon&r=PG&f=1", "display_name": "PhyZiK", "link": "https://stackoverflow.com/users/10219365/phyzik"}, "is_accepted": true, "score": 4, "last_activity_date": 1534196920, "creation_date": 1534196920, "answer_id": 51831051, "question_id": 51829829, "link": "https://stackoverflow.com/questions/51829829/value-generated-from-range-have-same-pointer-value/51831051#51831051", "title": "Value generated from range have same pointer value", "body": "<p>It occurred because variable <code>v</code> is created at the beginning of the loop and doesn't change. So,  every element in <code>aSlice</code> has a pointer to the same variable. You should write this:</p>\n\n<pre><code>for _, v := range bSlice {\n    a := A{}\n    v := v\n    a.Number = &amp;v.Number\n    aSlice = append(aSlice, a)\n}\n</code></pre>\n\n<p>Here you create at every iteration new variable with its own pointer.</p>\n"}], "owner": {"reputation": 85, "user_id": 6434929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-khtDb2bMEHo/AAAAAAAAAAI/AAAAAAAABI4/NtwwH8HAODs/photo.jpg?sz=128", "display_name": "Ali Dabour", "link": "https://stackoverflow.com/users/6434929/ali-dabour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "closed_date": 1534221678, "accepted_answer_id": 51831051, "answer_count": 2, "score": 0, "last_activity_date": 1534196920, "creation_date": 1534190766, "question_id": 51829829, "link": "https://stackoverflow.com/questions/51829829/value-generated-from-range-have-same-pointer-value", "closed_reason": "Duplicate", "title": "Value generated from range have same pointer value", "body": "<p>For these two struct </p>\n\n<pre><code>type A struct {\n    Number *int\n}\n\ntype B struct {\n    Number int\n}\n</code></pre>\n\n<p>If I want to loop on slice of B and assign the value of B.Number to new A.Number </p>\n\n<pre><code>func main() {\n    aSlice := []A{}\n    bSlice := []B{B{1}, B{2}, B{3}}\n    for _, v := range bSlice {\n        a := A{}\n        a.Number = &amp;v.Number\n        aSlice = append(aSlice, a)\n    }\n}  \n</code></pre>\n\n<p>I will found that all aSlice a.Number is the same value and same pointer.</p>\n\n<pre><code>for _, v := range aSlice {\n        fmt.Printf(\"aSlice Value %v Pointer %v\\n\", *v.Number,v.Number)\n    }\n</code></pre>\n\n<p>Will print<br>\naSlice Value 3 Pointer 0x10414020<br>\naSlice Value 3 Pointer 0x10414020<br>\naSlice Value 3 Pointer 0x10414020  </p>\n\n<p>So does range only update the value of <strong>_,v</strong> in for loop and doesn't change the pointer ?</p>\n\n<p>Full Code : <a href=\"https://play.golang.org/p/2wopH9HOjwj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2wopH9HOjwj</a></p>\n"}, {"tags": ["arrays", "for-loop", "go", "slice"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 2, "creation_date": 1534189117, "post_id": 51829414, "comment_id": 90613252, "body": "You&#39;ve declared the array inside the loop. Therefore you&#39;re re-declaring it each iteration. Declare it outside of the for loop."}], "answers": [{"comments": [{"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189419, "post_id": 51829464, "comment_id": 90613365, "body": "Thanks for this Tried it in the play ground doesnt work. Originally had it like this, but put it in the loop out of desperation / trial and error"}, {"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189427, "post_id": 51829464, "comment_id": 90613370, "body": "it gives me the same output"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189439, "post_id": 51829464, "comment_id": 90613378, "body": "@Data_Kid check the link inside my answer. I have tried on go playground."}, {"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189645, "post_id": 51829464, "comment_id": 90613451, "body": "Then I must be clicking the wrong link. Mine its not an array of numbers. Its the same output as I have in my terminal i.e <code>[0],[3],[5],[9]........[999]</code>. what I want to <code>[0,3,5,9....999]</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189702, "post_id": 51829464, "comment_id": 90613474, "body": "@Data_Kid Check the answer again in the link. It is working now you are printing the slice inside the for loop. I have edited my answer"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1534189751, "post_id": 51829464, "comment_id": 90613504, "body": "<a href=\"https://play.golang.org/p/L81kt-rmU87\" rel=\"nofollow noreferrer\">Link to optimal working example</a>"}, {"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1534189862, "post_id": 51829464, "comment_id": 90613559, "body": "the link you added initially was my dodgy code. Thanks its been a very good thought exercise. The problem was where I was printing the value"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 3, "creation_date": 1534189976, "post_id": 51829464, "comment_id": 90613612, "body": "@Data_Kid The problem was included in my answer. The slice you are creating is new everytime you loop through the code. This was wrong so if you print the len and capacity of the slice you will surely know. Always check the length and capacity of slice when you are increasing its size"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 5, "last_activity_date": 1534190111, "last_edit_date": 1534190111, "creation_date": 1534189091, "answer_id": 51829464, "question_id": 51829414, "link": "https://stackoverflow.com/questions/51829414/why-is-my-array-not-growing/51829464#51829464", "title": "Why is my array not growing?", "body": "<p>This is because you are creating a new variable of <code>[]int</code> slice rather than appending to the created one outside if condition. Create the <code>[]int</code> slice outside for loop and don't create a new variable using short declaration inside if condition.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    i := 0\n    var nums []int\n    for i &lt; 1000 {\n        if i%3 == 0 || i%5 == 0 {\n            nums = append(nums, i)\n        }\n        i++\n    }\n    fmt.Println(nums)\n    fmt.Println(len(nums), cap(nums)) // check for length and capacity of slice to know the size of slice after appending all data\n}\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/5OJLH9Knwzn\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 51829464, "answer_count": 1, "score": -2, "last_activity_date": 1534190452, "creation_date": 1534188906, "last_edit_date": 1534190452, "question_id": 51829414, "link": "https://stackoverflow.com/questions/51829414/why-is-my-array-not-growing", "title": "Why is my array not growing?", "body": "<p>I am trying to generate numbers that are factors of 3 || 5  in an array. </p>\n\n<p>Here is a copy of my code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    i := 0\n\n    for i &lt; 1000 {\n        var nums []int\n\n        if i%3 == 0 || i%5 == 0 {\n            nums := append(nums, i)\n            fmt.Println(nums)\n        }\n\n        i++\n\n    }\n}\n</code></pre>\n\n<p>Unfortunately, this isnt going as planned as it appears to by over writing the value at nums[0]. Here a the last few values of my terminal output. </p>\n\n<pre><code>[981]\n[984]\n[985]\n[987]\n[990]\n[993]\n[995]\n[996]\n[999]\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Also tried this:</p>\n\n<pre><code>var nums []int // initialize the slice outside for loop\nfor i &lt; 1000 {\n    if i%3 == 0 || i%5 == 0 {\n        nums = append(nums, i) // append to the slice outside loop not create a new one using short variable declaration\n        fmt.Println(nums)\n    }\n    i++\n}\n</code></pre>\n\n<p>But got Same result</p>\n"}, {"tags": ["go", "internationalization"], "comments": [{"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "edited": false, "score": 1, "creation_date": 1534189963, "post_id": 51829386, "comment_id": 90613605, "body": "You should clarify what the underlying system is. (E.g., is this a Windows desktop application, a Linux command line tool, a web application?)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1534198587, "post_id": 51829386, "comment_id": 90616727, "body": "On Windows you could execute the <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-culture?view=powershell-6\" rel=\"nofollow noreferrer\"><code>Get-Culture</code> powershell command</a>."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 6689012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kebt7myALUM/AAAAAAAAAAI/AAAAAAAAC6k/tNwr32kVRrA/photo.jpg?sz=128", "display_name": "mark kopenga", "link": "https://stackoverflow.com/users/6689012/mark-kopenga"}, "edited": false, "score": 0, "creation_date": 1534191958, "post_id": 51829886, "comment_id": 90614441, "body": "thx that helped me somewhat for linux and mac but it also needs to work on windows"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 2, "last_activity_date": 1534192361, "last_edit_date": 1534192361, "creation_date": 1534191032, "answer_id": 51829886, "question_id": 51829386, "link": "https://stackoverflow.com/questions/51829386/golang-get-system-language/51829886#51829886", "title": "Golang get system language", "body": "<p>On unix-like systems (Mac OS, Linux) you can use the os package to get environment variables with <a href=\"https://golang.org/pkg/os/#LookupEnv\" rel=\"nofollow noreferrer\">LookupEnv</a>. So for example you could get the system language/encoding with: </p>\n\n<pre><code>s, ok := os.LookupEnv(\"LANG\")\nprintln(s, err)\n=&gt; en_US.UTF-8 true\n</code></pre>\n\n<p>There's also a blog article which may be of interest to you on the golang.org blog (more about choosing languages once you know the system language setting): </p>\n\n<p><a href=\"https://blog.golang.org/matchlang\" rel=\"nofollow noreferrer\">https://blog.golang.org/matchlang</a></p>\n\n<p>On windows you might be able to use this package to get the language from the registry if the above doesn't work (I'd try os.LookupEnv first). </p>\n\n<p><a href=\"https://godoc.org/golang.org/x/sys/windows/registry\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/sys/windows/registry</a></p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 3, "last_activity_date": 1534207681, "last_edit_date": 1534207681, "creation_date": 1534200740, "answer_id": 51831590, "question_id": 51829386, "link": "https://stackoverflow.com/questions/51829386/golang-get-system-language/51831590#51831590", "title": "Golang get system language", "body": "<p>One approach would be to try the following strategies in sequence:</p>\n\n<ol>\n<li>See if the <code>LANG</code> environment variable is set and use that value (common on UNIX systems).</li>\n<li>Execute powershell on Windows and extract the <a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-culture?view=powershell-6\" rel=\"nofollow noreferrer\"><code>Get-Culture</code> \"Name\" property</a>.</li>\n</ol>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n  locale, err := GetLocale()\n  fmt.Printf(\"OK: locale=%q, err=%v\\n\", locale, err)\n  // OK: locale=\"en-US\", err=nil\n}\n\nfunc GetLocale() (string, error) {\n  // Check the LANG environment variable, common on UNIX.\n  // XXX: we can easily override as a nice feature/bug.\n  envlang, ok := os.LookupEnv(\"LANG\")\n  if ok {\n    return strings.Split(envlang, \".\")[0], nil\n  }\n\n  // Exec powershell Get-Culture on Windows.\n  cmd := exec.Command(\"powershell\", \"Get-Culture | select -exp Name\")\n  output, err := cmd.Output()\n  if err == nil {\n    return strings.Trim(string(output), \"\\r\\n\"), nil\n  }\n\n  return \"\", fmt.Errorf(\"cannot determine locale\")\n}\n</code></pre>\n\n<p>Doing these actions in this sequence is convenient because it lets you easily change the locale (e.g. for testing) and should work on both UNIX and Windows operating systems.</p>\n"}, {"comments": [{"owner": {"reputation": 153, "user_id": 6689012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kebt7myALUM/AAAAAAAAAAI/AAAAAAAAC6k/tNwr32kVRrA/photo.jpg?sz=128", "display_name": "mark kopenga", "link": "https://stackoverflow.com/users/6689012/mark-kopenga"}, "edited": false, "score": 0, "creation_date": 1534239822, "post_id": 51838303, "comment_id": 90629924, "body": "Thx that package did the job"}], "tags": [], "owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "is_accepted": true, "score": 4, "last_activity_date": 1538573104, "last_edit_date": 1538573104, "creation_date": 1534239344, "answer_id": 51838303, "question_id": 51829386, "link": "https://stackoverflow.com/questions/51829386/golang-get-system-language/51838303#51838303", "title": "Golang get system language", "body": "<p>There is a nice cross-platform library called\n<a href=\"https://godoc.org/github.com/cloudfoundry-attic/jibber_jabber\" rel=\"nofollow noreferrer\">jibber_jabber</a>\nwhich looks up for <code>$LC_ALL</code> or <code>$LANG</code> env variables in Unix systems and, for Windows, loads <strong>Kernel32</strong> and calls some procedures like <code>GetUserDefaultLocaleName</code> or <code>GetSystemDefaultLocaleName</code> inside.\nFor Windows, all is done in the\n<a href=\"https://github.com/cloudfoundry-attic/jibber_jabber/blob/bcc4c8345a21301bf47c032ff42dd1aae2fe3027/jibber_jabber_windows.go#L63\" rel=\"nofollow noreferrer\"><code>getWindowsLocale()</code></a>\nfunction.\nBe advised that Kernel32 library comes built-in in Windows OS kernel.</p>\n\n<p>By the way, should you need to convert locale-format'd language strings like <code>en_US</code> and <code>fr_FR</code>, you can utilize the\n<a href=\"https://godoc.org/golang.org/x/text/language\" rel=\"nofollow noreferrer\">x/text/language</a> and <a href=\"https://godoc.org/golang.org/x/text/language/display\" rel=\"nofollow noreferrer\">x/text/language/display</a>\npackages to get fully qualified name of the language.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>lang := \"ru_RU\"\ntag := language.MustParse(lang)\n\ninEng := display.English.Languages()\ninTur := display.Turkish.Languages()\ninSelf := display.Self\n\nfmt.Println(inEng.Name(tag))\nfmt.Println(inSelf.Name(tag))\nfmt.Println(inTur.Name(tag))\n\n   // Output:\n   // Russian\n   // \u0440\u0443\u0441\u0441\u043a\u0438\u0439\n   // Rus\u00e7a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2191, "user_id": 6846888, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dA5MWv3kEHQ/AAAAAAAAAAI/AAAAAAAABCU/J1Ma_4RBDbY/photo.jpg?sz=128", "display_name": "&#194;ngelo Polotto", "link": "https://stackoverflow.com/users/6846888/%c3%82ngelo-polotto"}, "is_accepted": false, "score": 0, "last_activity_date": 1603822879, "creation_date": 1603822879, "answer_id": 64560642, "question_id": 51829386, "link": "https://stackoverflow.com/questions/51829386/golang-get-system-language/64560642#64560642", "title": "Golang get system language", "body": "<p>I improved the @maerics answer to support MacOS too:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func getLocale() (string, string) {\n    osHost := runtime.GOOS\n    defaultLang := &quot;en&quot;\n    defaultLoc := &quot;US&quot;\n    switch osHost {\n    case &quot;windows&quot;:\n        // Exec powershell Get-Culture on Windows.\n        cmd := exec.Command(&quot;powershell&quot;, &quot;Get-Culture | select -exp Name&quot;)\n        output, err := cmd.Output()\n        if err == nil {\n            langLocRaw := strings.TrimSpace(string(output))\n            langLoc := strings.Split(langLocRaw, &quot;-&quot;)\n            lang := langLoc[0]\n            loc := langLoc[1]\n            return lang, loc\n        }\n    case &quot;darwin&quot;:\n        // Exec powershell Get-Culture on Windows.\n        cmd := exec.Command(&quot;sh&quot;, &quot;osascript -e 'user locale of (get system info)'&quot;)\n        output, err := cmd.Output()\n        if err == nil {\n            langLocRaw := strings.TrimSpace(string(output))\n            langLoc := strings.Split(langLocRaw, &quot;_&quot;)\n            lang := langLoc[0]\n            loc := langLoc[1]\n            return lang, loc\n        }\n    case &quot;linux&quot;:\n        envlang, ok := os.LookupEnv(&quot;LANG&quot;)\n        if ok {\n            langLocRaw := strings.TrimSpace(envlang)\n            langLocRaw = strings.Split(envlang, &quot;.&quot;)[0]\n            langLoc := strings.Split(langLocRaw, &quot;_&quot;)\n            lang := langLoc[0]\n            loc := langLoc[1]\n            return lang, loc\n        }\n    }\n    return defaultLang, defaultLoc\n}\n\nfunc main() {\n    lang, loc := getLocale()\n    fmt.Printf(&quot;OK: language=%s, locale=%s&quot;, lang, loc)\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 6689012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kebt7myALUM/AAAAAAAAAAI/AAAAAAAAC6k/tNwr32kVRrA/photo.jpg?sz=128", "display_name": "mark kopenga", "link": "https://stackoverflow.com/users/6689012/mark-kopenga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2255, "favorite_count": 0, "accepted_answer_id": 51838303, "answer_count": 4, "score": 8, "last_activity_date": 1603822879, "creation_date": 1534188780, "last_edit_date": 1534191709, "question_id": 51829386, "link": "https://stackoverflow.com/questions/51829386/golang-get-system-language", "title": "Golang get system language", "body": "<p>Is there a function for getting the user's system language I can't find it anywhere on the Go site.  </p>\n\n<p>To clarify my question i want the current user's system language that means when everything is for example dutch on the system i want to get \"dutch\" or \"nl\"</p>\n\n<p>note: the program is made to run on linux, mac and windows</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "edited": false, "score": 2, "creation_date": 1534292194, "post_id": 51836178, "comment_id": 90655660, "body": "I have tried this, the compiled struct field will then have the following tags: <code>Number       string   </code>protobuf:&quot;bytes,5,opt,name=no,json=com,proto3&quot; json:&quot;number,omitempty&quot;``"}, {"owner": {"reputation": 198, "user_id": 5989625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UgpQM.jpg?s=128&g=1", "display_name": "Mehran Prs", "link": "https://stackoverflow.com/users/5989625/mehran-prs"}, "edited": false, "score": 1, "creation_date": 1591622430, "post_id": 51836178, "comment_id": 110117258, "body": "The <code>json_name</code> option in the .proto file has nothing to do with the generated json tag, but rather with the name used in the official protobuf-to-JSON mapping: <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#json\" rel=\"nofollow noreferrer\">developers.google.com/protocol-buffers/docs/proto3#json</a>, which is implemented in the <a href=\"https://godoc.org/github.com/golang/protobuf/jsonpb\" rel=\"nofollow noreferrer\">jsonpb</a> package.   <a href=\"https://github.com/golang/protobuf/issues/998\" rel=\"nofollow noreferrer\">reference</a>"}, {"owner": {"reputation": 1434, "user_id": 801426, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7e4a92cd142e59829350dc0f2a021cc4?s=128&d=identicon&r=PG", "display_name": "bullgare", "link": "https://stackoverflow.com/users/801426/bullgare"}, "edited": false, "score": 0, "creation_date": 1591720522, "post_id": 51836178, "comment_id": 110160647, "body": "Man, you made my week! Thank you so much."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 12, "last_activity_date": 1534232540, "creation_date": 1534232540, "answer_id": 51836178, "question_id": 51828804, "link": "https://stackoverflow.com/questions/51828804/defining-custom-go-struct-tags-for-protobuf-message-fields/51836178#51836178", "title": "Defining custom go struct tags for protobuf message fields", "body": "<p>You can set a proto3 field option on the proto message definition with a <code>json_name</code></p>\n\n<pre><code>message Post {\n    int64 number = 1 [json_name=\"no\"];\n    string now = 2;\n    string name = 3;\n}\n</code></pre>\n\n<p><a href=\"https://developers.google.com/protocol-buffers/docs/proto3#json\" rel=\"noreferrer\">link to the docs</a></p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 4566994, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7tQMAXJAieo/AAAAAAAAAAI/AAAAAAAAAAA/90YuP0cBdRs/photo.jpg?sz=128", "display_name": "Jack", "link": "https://stackoverflow.com/users/4566994/jack"}, "is_accepted": false, "score": 8, "last_activity_date": 1552988102, "creation_date": 1552988102, "answer_id": 55237676, "question_id": 51828804, "link": "https://stackoverflow.com/questions/51828804/defining-custom-go-struct-tags-for-protobuf-message-fields/55237676#55237676", "title": "Defining custom go struct tags for protobuf message fields", "body": "<pre><code>import \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\n\n// Result example:\n// type Post struct {\n//    Number int64 `protobuf:\"bytes,1,opt,name=number,json=no1,proto3\" json:\"no2\"`\n// }\nmessage Post {\n    int64 number = 1 [json_name=\"no1\", (gogoproto.jsontag) = \"no2\"];\n}\n</code></pre>\n\n<p>,where:</p>\n\n<ul>\n<li><strong>no1</strong> - new name for <strong>jsonpb</strong> marshal/unmarshal</li>\n<li><strong>no2</strong> - new name for <strong>json</strong> marshal/unmarshal</li>\n</ul>\n\n<p>jsonpb example:</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"testing\"\n    \"encoding/json\"\n\n    \"github.com/golang/protobuf/jsonpb\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestJSON(t *testing.T) {\n    msg := &amp;Post{\n        Number: 1,\n    }\n\n    buf := bytes.NewBuffer(nil)\n\n    require.NoError(t, (&amp;jsonpb.Marshaler{}).Marshal(buf, msg))\n    require.Equal(t, `{\"no1\":1}`, buf.String())\n\n    buf.Truncate(0)\n\n    require.NoError(t, json.NewEncoder(buf).Encode(msg))\n    require.Equal(t, `{\"no2\":1}`, buf.String())\n}\n</code></pre>\n\n<p>More information about protobuf <a href=\"https://github.com/gogo/protobuf/blob/master/extensions.md\" rel=\"noreferrer\">extensions</a></p>\n"}], "owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8693, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1552988102, "creation_date": 1534186307, "question_id": 51828804, "link": "https://stackoverflow.com/questions/51828804/defining-custom-go-struct-tags-for-protobuf-message-fields", "title": "Defining custom go struct tags for protobuf message fields", "body": "<p>I am new to <code>grpc</code> and have been trying to just fetch a <code>json</code> response from a webserver. The stub can then request the <code>json</code> from the <code>rpc</code> server.</p>\n\n<p>In my <code>.proto</code> file, I created a message type:</p>\n\n<pre><code>message Post {\n    int64 number = 1;\n    string now = 2;\n    string name = 3;\n}\n</code></pre>\n\n<p>But I am not able to marshal the <code>number</code> field, since <code>protoc</code> produces the struct <code>pb.go</code> file with a <code>number</code> tag:</p>\n\n<pre><code>{\n        \"no\": \"23\",\n        \"now\": \"12:06:46\",\n        \"name\": \"bob\"\n}\n</code></pre>\n\n<p>How can I force the <code>Message</code> to be 'converted' with a tag other than the lowercase name of the message field? Such as using the <code>json</code> tag <code>no</code>, even if the field name in the <code>Message</code> is <code>number</code>.</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1534184659, "post_id": 51828236, "comment_id": 90611203, "body": "They are exactly the same. Use whichever name you like more. Git blame didn&#39;t lead me to much insight on why it happened."}, {"owner": {"reputation": 83, "user_id": 10173417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69c5625397dd32ee103094bd823601df?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/10173417/felix"}, "reply_to_user": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1534195322, "post_id": 51828236, "comment_id": 90615765, "body": "thanks Alex. I&#39;m just curious."}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 1542778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3fc3444375d06a3f970671917ffdb42?s=128&d=identicon&r=PG", "display_name": "jesusnoseq", "link": "https://stackoverflow.com/users/1542778/jesusnoseq"}, "is_accepted": true, "score": 2, "last_activity_date": 1534184778, "creation_date": 1534184778, "answer_id": 51828462, "question_id": 51828236, "link": "https://stackoverflow.com/questions/51828236/is-there-any-difference-between-warning-and-warn-in-golangs-logrus/51828462#51828462", "title": "Is there any difference between warning and warn in Golang&#39;s logrus?", "body": "<p>Both Warn and Warning are the same.</p>\n\n<p>Check this\n<a href=\"https://github.com/sirupsen/logrus/blob/e4b0c6d7829bcf64435536c4a88f4088a3c76203/logrus.go#L44\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus/blob/e4b0c6d7829bcf64435536c4a88f4088a3c76203/logrus.go#L44</a></p>\n\n<p>Either of that two are ok but be consistent and use the same each time.</p>\n\n<p>I use Warn because is shorter :)</p>\n"}], "owner": {"reputation": 83, "user_id": 10173417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69c5625397dd32ee103094bd823601df?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/10173417/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 51828462, "answer_count": 1, "score": 2, "last_activity_date": 1534184778, "creation_date": 1534183859, "question_id": 51828236, "link": "https://stackoverflow.com/questions/51828236/is-there-any-difference-between-warning-and-warn-in-golangs-logrus", "title": "Is there any difference between warning and warn in Golang&#39;s logrus?", "body": "<p>In logrus official doc, it just says below:</p>\n\n<pre><code>func Warn\nfunc Warn(args ...interface{})\nWarn logs a message at level Warn on the standard logger.\n\nfunc Warning\nfunc Warning(args ...interface{})\nWarning logs a message at level Warn on the standard logger.\n</code></pre>\n\n<p>It looks like it's almost the same. Which one should I prefer to use?</p>\n"}, {"tags": ["arrays", "postgresql", "go", "graphql"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534183968, "post_id": 51828107, "comment_id": 90610852, "body": "Post the values inside <code>roleArray</code> and <code>resultUser</code> along with there types or the code snippete where you are creating those variables in your question"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1534184137, "post_id": 51828107, "comment_id": 90610928, "body": "ok, i add the values that are contained in roleArray, they&#39;re at the bottom of the question"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1534184413, "post_id": 51828107, "comment_id": 90611073, "body": "Can you print the type of resultUser using <code>fmt.Println(%T, resultUser)</code> because the error is in column index <code>0</code>"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1534184552, "post_id": 51828107, "comment_id": 90611148, "body": "i added another explanation about resultUser"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534184707, "post_id": 51828107, "comment_id": 90611227, "body": "The value that the sql function returns is an array of ints and so is the scan <code>resultRole</code>. If I am guessing it correct. What is <code>.Scan(&amp;resultRole, &amp;int)</code>. It should be <code>.Scan(&amp;resultRole)</code>. Why you are giving address  the primitive type."}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534184880, "post_id": 51828107, "comment_id": 90611298, "body": "the value that the sql function return is just an int, the IN is an <code>array of string</code>, however when i set the array to return as you said i got this:         <code>sql: Scan error on column index 0: pq: destination *int is not a pointer to array or slice</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 0, "creation_date": 1534184941, "post_id": 51828107, "comment_id": 90611330, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/177964/discussion-between-himanshu-and-luis-cardoza-bird\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1534186313, "post_id": 51828792, "comment_id": 90612035, "body": "Works like a charm! Thank you so much!! :)"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534187574, "last_edit_date": 1534187574, "creation_date": 1534186221, "answer_id": 51828792, "question_id": 51828107, "link": "https://stackoverflow.com/questions/51828107/golang-obtain-value-from-postgresql-function-that-returns-an-int-but-also-receiv/51828792#51828792", "title": "Golang obtain value from postgresql function that returns an int but also receive an array of string", "body": "<p>As the error says:</p>\n\n<blockquote>\n  <p>\"message\": \"sql: Scan error on column index 0: converting driver.Value\n  type  (\\\"\\\") to a int: invalid syntax\",</p>\n</blockquote>\n\n<p>The error is when scanning the result coming from the function when the value is returned from it.</p>\n\n<p>Remove the pointer to int primitive type, Since only single value is returned form the function which is of <code>int</code> type. </p>\n\n<p>Scan the value into int type variable as</p>\n\n<pre><code>var resultRole int \nerr = database.QueryRow(\"Select fnRegisterUserRoleArray($1, $2);\", resultUser, pq.Array(roleArray)).Scan(&amp;resultRole)\n</code></pre>\n\n<p>For handling these types of situations it will be better if you handle scanning the result separately from the query as:</p>\n\n<pre><code>sqlStatement := `Select fnRegisterUserRoleArray($1, $2);`\nvar resultRole int \n// Replace 3 with an ID from your database or another random\n// value to test the no rows use case.\nrow := db.QueryRow(sqlStatement, resultUser, pq.Array(roleArray))\nswitch err := row.Scan(&amp;resultRole); err {\ncase sql.ErrNoRows:\n  fmt.Println(\"No rows were returned!\")\ncase nil:\n  fmt.Println(resultRole)\ndefault:\n  panic(err)\n}\n</code></pre>\n\n<p>Using above approach of separating queryRow with Scan help you to analyze more about the result and returned errors.</p>\n"}], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1216, "favorite_count": 0, "accepted_answer_id": 51828792, "answer_count": 1, "score": 1, "last_activity_date": 1534187574, "creation_date": 1534183328, "last_edit_date": 1534187414, "question_id": 51828107, "link": "https://stackoverflow.com/questions/51828107/golang-obtain-value-from-postgresql-function-that-returns-an-int-but-also-receiv", "title": "Golang obtain value from postgresql function that returns an int but also receive an array of string", "body": "<p>I have a postgresql function that basically <strong>returns</strong> a <strong>number</strong>, but also as you can see the function receive an array of string.</p>\n\n<pre><code>Create Or Replace Function fnRegisterUserRoleArray(idUserFather int, rolesArray Text[]) returns int language plpgsql\nas\n$body$\ndeclare ids INT;\ndeclare roleID INT;\ndeclare sanitazedRole TEXT;\ndeclare counter int = 0;\nbegin\nif(empty2null(idUserFather::text) is null) then\n    ids := 0;\nelsif exists( select 1 from win_users where id_user = idUserFather limit 1) then\n    for counter in 1 .. array_upper(rolesArray, 1)\n    loop\n        select id_role from win_roles where rolename = rolesArray[counter] into roleID;\n        insert into win_user_role(id_user, id_role) values (idUserFather, roleID);\n        ids := ids + 1;\n    end loop;\nelse\n    ids := 0;\nend if;\nreturn ids;\nend $body$;\n</code></pre>\n\n<p>and in my Go Function I have my variable database that receive the connection with the postgresql database,</p>\n\n<pre><code>database, err := getConnection()\n</code></pre>\n\n<p>however when I call the function <strong>fnRegisterUserViewsPermission</strong> and send the values I receive an error.</p>\n\n<p>This is how I set the values:</p>\n\n<pre><code>var resultRole int \nerr = database.QueryRow(\"Select fnRegisterUserRoleArray($1, $2);\", resultUser, pq.Array(roleArray)).Scan(&amp;resultRole, &amp;int)\n    fmt.Println(resultRole)\n    if err != nil {\n        fmt.Println(resultRole)\n        return nil, err\n    }\n    if resultRole != 0 &amp;&amp; resultRole != 1 {\n        response = response + \"their roles has been assigned correctly \"\n    } else {\n            response = response + \"however there was an error during the assignation of the role.\"\n    }\n</code></pre>\n\n<p>and the output that I receive is this:</p>\n\n<blockquote>\n  <p>\"message\": \"sql: Scan error on column index 0: converting driver.Value\n  type  (\\\"\\\") to a int: invalid syntax\",</p>\n</blockquote>\n\n<p>But the values get stored in my database, so the function receives in a good way the values, but the return is where it goes bam :(</p>\n\n<p>This only occurs when i send an Array but if i send anything rather than an array the Scanner return the Id obtained from the postgresql function.</p>\n\n<p>Is there any way to obtain the result id but also send the array in a more elegant way?</p>\n\n<p>this is the values that contains role array:  </p>\n\n<blockquote>\n  <p>[Carrier Brand]</p>\n</blockquote>\n\n<p>And the value that contains resultUser is just a number, that represent the id of the user that has been registered in the database, in this case the registered user has an ID of...</p>\n\n<blockquote>\n  <p>result user:  63</p>\n</blockquote>\n\n<p>Thanks! :)</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534180207, "post_id": 51827365, "comment_id": 90609052, "body": "You know you can only mock interfaces, and you have an interface type already, is there some reason you aren&#39;t mocking that?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534180335, "post_id": 51827365, "comment_id": 90609130, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51272973/golang-database-unit-test\">Golang Database unit test</a>"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534180347, "post_id": 51827365, "comment_id": 90609136, "body": "I just tried, but it gets me no test coverage. I tried it with defining what <code>GetDB()</code> should return for the test"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534180408, "post_id": 51827365, "comment_id": 90609169, "body": "Mine is not a duplicate of that, @Flimzy , as that one is about database <b>entries</b>, whereas mine is about the business method to get the connection itself."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534180505, "post_id": 51827365, "comment_id": 90609209, "body": "@MikeWarren: The answer is the same in both cases, so yes, it is a duplicate."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534180552, "post_id": 51827365, "comment_id": 90609225, "body": "In short, the answer is: &quot;there are many ways to do this. You need a mock of some sort.&quot;"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534185208, "post_id": 51827365, "comment_id": 90611478, "body": "I just said &quot;I just tried, but it gets me no test coverage. I tried it with defining what <code>GetDB()</code> should return for the test, and it got no test coverage.   I just came up with something upon further inspection of the code under test (it depends on more functions inside that same file, and ultimately one outside, which hits a third party method that I&#39;m about to stub."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534187300, "post_id": 51827365, "comment_id": 90612500, "body": "Even worse, when I use <code>mockery</code> to generate the mocks, it puts them in package <code>mocks</code> and then refers back to the package the test and the code are in, causing circular dependency issues because of Golang&#39;s compiler weakness."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1534188010, "post_id": 51827365, "comment_id": 90612781, "body": "You actually can tell mockery where to put the mocks..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534188520, "post_id": 51827365, "comment_id": 90613019, "body": "Do you want to test GetDB, or do you want to test something that uses GetDB?"}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534188556, "post_id": 51827365, "comment_id": 90613034, "body": "I want to test <code>GetDB</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534188792, "post_id": 51827365, "comment_id": 90613147, "body": "In that case creating a mock for <code>DatabaseContextIntf</code> makes no sense, so your &quot;Fortunately&quot; might throw people of, as there is no fortune in that..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534189251, "post_id": 51827365, "comment_id": 90613300, "body": "And you seem to be connecting to the db through a single point namely <code>db.OpenConnection</code>, which appears to be either a global variable <code>db</code> or a globally accessible function <code>OpenConnection</code>... In my opinion globals are not good candidates for test doubles but whatever, you could mock a func like <code>OpenConnection</code> if it is a func variable, e.g. <code>var OpenConnection = func(...</code>, then during testing you would just reassign the variable to a mock func for example."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534189402, "post_id": 51827365, "comment_id": 90613356, "body": "... if, however, <code>OpenConnection</code> is a normal func and not a variable, then you can&#39;t mock it, you&#39;ll have to introduce an extra level of indirection if you want to test your GetDB without hitting the db."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534189527, "post_id": 51827365, "comment_id": 90613408, "body": "hope that makes sense, let me know if not and i&#39;ll provide an example."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1534192770, "post_id": 51827365, "comment_id": 90614790, "body": "It is a function in our <code>db</code> package, in which I just discovered an unreachable line of code"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534194061, "post_id": 51827365, "comment_id": 90615333, "body": "@MikeWarren here&#39;s what i meant by the extra indirection in my previous comment: <a href=\"https://play.golang.org/p/E4Y9Hiwmk_-\" rel=\"nofollow noreferrer\">play.golang.org/p/E4Y9Hiwmk_-</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "is_accepted": false, "score": 0, "last_activity_date": 1534255087, "creation_date": 1534255087, "answer_id": 51843249, "question_id": 51827365, "link": "https://stackoverflow.com/questions/51827365/unit-testing-strategy-for-database-connection-get/51843249#51843249", "title": "Unit testing strategy for database connection get", "body": "<p>I ended up making the package of the test the same as that of the code under test (this allows the test generator in Visual Studio Code to place the generated test right in the test file, and not get confused, as well as give me access to unexported fields, which I used), and just straight up made a fake <code>DatabaseContext</code></p>\n\n<p>My test case looks like this: </p>\n\n<pre><code>t.Run(\"SanityTest\", func(t *testing.T) {\n    c := new(DatabaseContext)\n    assert.Nil(t, c.Database.dbConnection)\n    database, err := c.GetDB()\n    defer database.Close()\n    assert.NotNil(t, database)\n    if !assert.Nil(t, err) {\n        t.Error(err.ToString(false))\n    }\n})\n</code></pre>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 875, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562621620, "creation_date": 1534180068, "last_edit_date": 1562621620, "question_id": 51827365, "link": "https://stackoverflow.com/questions/51827365/unit-testing-strategy-for-database-connection-get", "title": "Unit testing strategy for database connection get", "body": "<p>There's a method in the code under test, that simply tries to get database connection, or returns error if unable to. </p>\n\n<p>It, and the structs involved are defined as follows: </p>\n\n<pre><code>type DatabaseContext struct {\n    Context\n    Database DatabaseSt\n}\n\n\n// //GetInfo Returns the context.\n// func (c *DatabaseContext) GetInfo() *Context {\n//  return &amp;c.Context\n// }\n\n//GetDB Gets the database connection from the connection string.\nfunc (c *DatabaseContext) GetDB() (*sql.DB, *errors.ErrorSt) {\n    var errSt *errors.ErrorSt\n    if c.Database.dbConnection == nil {\n        c.Database.dbConnection, errSt = c.openDB()\n        if errSt != nil {\n            return nil, errSt\n        }\n        c.Database.dbConnection.SetMaxOpenConns(50)\n    }\n    return c.Database.dbConnection, nil\n}\n</code></pre>\n\n<p>The other methods, in the same file, which it may hit, are as follows: </p>\n\n<pre><code>//openDB opens the database with the connection string.\nfunc (c *DatabaseContext) openDB() (*sql.DB, *errors.ErrorSt) {\n    if c.Database.DBConnectionStr == \"\" {\n        c.GetDatabase()\n    }\n    return db.OpenConnection(c.Database.DBConnectionStr, c.Database.InterpolateParams)\n\n}\n\n//CloseDB Closes the database.\nfunc (c *DatabaseContext) CloseDB() {\n    if c.Database.dbConnection != nil {\n        c.Database.dbConnection.Close()\n    }\n}\n\n//SetDatabaseString Sets the database string into the session.\nfunc (c *DatabaseContext) SetDatabaseString(str string) {\n    c.Database.DBConnectionStr = str\n    i := strings.Index(str, \")/\") + 2\n    c.Database.DBName = str[i:]\n    c.SetDatabase()\n}\n\n//GetDatabaseString Gets the database string from the session.\nfunc (c *DatabaseContext) GetDatabase() {\n    if dbIntf := c.GetFromSession(\"Database\"); dbIntf != nil {\n        c.Database = dbIntf.(DatabaseSt)\n    }\n}\n\n//SetDatabaseString Sets the database string into the session.\nfunc (c *DatabaseContext) SetDatabase() {\n    c.SetToSession(\"Database\", c.Database)\n}\n</code></pre>\n\n<p>Fortunately, <code>DatabaseContext</code> implements <code>DatabaseContextIntf</code>, which I want to use for testing. My instinct is to straight up mock <code>DatabaseContext</code>, but that won't work because it's not an interface (in Golang, you can only mock interfaces). </p>\n\n<p>How would I go about testing this, without hitting a real database, which can fail beyond my control (thus creating false fails in the test)?</p>\n\n<p><strong>UPDATE</strong> My question differs from the suspected duplicate as their question is about database <strong>entries</strong>, and not connections. The flagged duplicate refers to <a href=\"https://godoc.org/github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">this library</a> as the answer, however, there is no method in it to return a \"connection\" that is nil, for the sake of the test. The best it has is <a href=\"https://godoc.org/github.com/DATA-DOG/go-sqlmock#New\" rel=\"nofollow noreferrer\"><code>New</code></a> which creates a test double connection, and there's no way to control the state of the returned value (I need it to be <code>nil</code> in one test (\"No Connection\") and non-nil in another (\"Sanity Test\"))</p>\n"}, {"tags": ["go", "go-echo"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534179560, "post_id": 51827190, "comment_id": 90608710, "body": "On which line you are getting the error. Add comment to that line in your posted question"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1534180242, "post_id": 51827190, "comment_id": 90609072, "body": "First, don&#39;t use a custom context. Instead, use a standard <code>context.Context</code>, and store your values there."}, {"owner": {"reputation": 51, "user_id": 1589841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/228ca07cc3d2d34dc71d065522dd4c11?s=128&d=identicon&r=PG", "display_name": "happy_yar", "link": "https://stackoverflow.com/users/1589841/happy-yar"}, "edited": false, "score": 0, "creation_date": 1534180859, "post_id": 51827190, "comment_id": 90609392, "body": "context.WithValue ?"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 1589841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/228ca07cc3d2d34dc71d065522dd4c11?s=128&d=identicon&r=PG", "display_name": "happy_yar", "link": "https://stackoverflow.com/users/1589841/happy-yar"}, "edited": false, "score": 0, "creation_date": 1534199394, "post_id": 51829311, "comment_id": 90616944, "body": "passed his context in the tests - works! why use custom context is bad practice?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 51, "user_id": 1589841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/228ca07cc3d2d34dc71d065522dd4c11?s=128&d=identicon&r=PG", "display_name": "happy_yar", "link": "https://stackoverflow.com/users/1589841/happy-yar"}, "edited": false, "score": 0, "creation_date": 1534222780, "post_id": 51829311, "comment_id": 90621774, "body": "It try to answer it as comment: Code should be readable, you read code more often then writing it. The <code>echo.Context</code> is the standard and when reading the code everybody expects that this part is the standard. Maybe only you knows that in some cases that thing is also something different. Maybe after 2 months also you don&#39;t know this anymore."}, {"owner": {"reputation": 203, "user_id": 709452, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/MO7rz.png?s=128&g=1", "display_name": "mr-karan", "link": "https://stackoverflow.com/users/709452/mr-karan"}, "reply_to_user": {"reputation": 51, "user_id": 1589841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/228ca07cc3d2d34dc71d065522dd4c11?s=128&d=identicon&r=PG", "display_name": "happy_yar", "link": "https://stackoverflow.com/users/1589841/happy-yar"}, "edited": false, "score": 0, "creation_date": 1535559202, "post_id": 51829311, "comment_id": 91114168, "body": "I am stuck with the same problem @happy_yar can you tell how did you pass the custom context in the test function?"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 2, "last_activity_date": 1534188468, "creation_date": 1534188468, "answer_id": 51829311, "question_id": 51827190, "link": "https://stackoverflow.com/questions/51827190/how-to-properly-test-handler-with-custom-context-in-echo/51829311#51829311", "title": "How to properly test handler with custom context in echo?", "body": "<p>So the method is not really fine, when it can panic. You could catch that error very simple:</p>\n\n<pre><code>ctx, ok := c.(*ApiContext) \nif !ok {\n  // do something when you have a different type\n  // return an error here\n}\n</code></pre>\n\n<p>I think you should not use a different context then <code>echo.Context</code>, because just with that context the testing is supported.</p>\n\n<p>But back to your question. If you want to test it with your context you need to pass your context into the test and not the <code>echo.Context</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 678, "user_id": 2158788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vxUxp.jpg?s=128&g=1", "display_name": "snassr", "link": "https://stackoverflow.com/users/2158788/snassr"}, "is_accepted": false, "score": 0, "last_activity_date": 1576725278, "creation_date": 1576725278, "answer_id": 59402846, "question_id": 51827190, "link": "https://stackoverflow.com/questions/51827190/how-to-properly-test-handler-with-custom-context-in-echo/59402846#59402846", "title": "How to properly test handler with custom context in echo?", "body": "<p>Before:</p>\n\n<pre><code>if assert.NoError(t, EntityList(c)) {\n    assert.Equal(t, http.StatusOK rec.Code)\n}\n</code></pre>\n\n<p>After (Literally put in your custom context):</p>\n\n<pre><code>if assert.NoError(t, EntityList(&amp;common.ApiContext{c, 0, \"\"})) {\n    assert.Equal(t, http.StatusOK rec.Code)\n}\n</code></pre>\n\n<p>However, using the standard <code>context.Context</code> is better practice.</p>\n"}], "owner": {"reputation": 51, "user_id": 1589841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/228ca07cc3d2d34dc71d065522dd4c11?s=128&d=identicon&r=PG", "display_name": "happy_yar", "link": "https://stackoverflow.com/users/1589841/happy-yar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 0, "accepted_answer_id": 51829311, "answer_count": 2, "score": 0, "last_activity_date": 1576725278, "creation_date": 1534179399, "last_edit_date": 1553996294, "question_id": 51827190, "link": "https://stackoverflow.com/questions/51827190/how-to-properly-test-handler-with-custom-context-in-echo", "title": "How to properly test handler with custom context in echo?", "body": "<p>I use <strong>echo</strong> framework with Custom Context:</p>\n\n<pre><code>ApiContext struct {\n    echo.Context\n    UserID   int64\n    UserRole string\n}\n</code></pre>\n\n<p>my middleware:</p>\n\n<pre><code>e.Use(func(h echo.HandlerFunc) echo.HandlerFunc {\n    return func(c echo.Context) error {\n        cc := &amp;common.ApiContext{c, 0, \"\"}\n        return h(cc)\n    }\n})\n</code></pre>\n\n<p>my handler:</p>\n\n<pre><code>func (app *App) listEntity(c echo.Context) error {\n\n    ctx := c.(*ApiContext) // error!\n....\n}\n</code></pre>\n\n<p>my test:</p>\n\n<pre><code>func TestlistEntity(t *testing.T){\n\n    e := echo.New()\n\n    req := httptest.NewRequest(echo.GET, \"/\", nil)\n    rec := httptest.NewRecorder()\n    c := e.NewContext(req, rec)\n    c.SetPath(\"/api/v1/entity/list\")\n\n\n    if assert.NoError(t, EntityList(c)) {\n        assert.Equal(t, http.StatusOK rec.Code)\n    }\n}\n</code></pre>\n\n<p>i got this error:</p>\n\n<blockquote>\n  <p>panic: interface conversion: echo.Context is *echo.context, not\n  *common.ApiContext</p>\n</blockquote>\n\n<p>in handler function type assertion</p>\n\n<p>How correctly to write the test?\nps. this method working fine.</p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534176693, "post_id": 51826510, "comment_id": 90607326, "body": "In what way is it more complicated?"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534177100, "post_id": 51826510, "comment_id": 90607555, "body": "Of course it&#39;s nothing oppressive, but you have to remember to take the address of all your errors when you return them. It&#39;s just not the first way I would think of setting things up. Am I missing a benefit?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1534179886, "post_id": 51826510, "comment_id": 90608868, "body": "I think there is no <i>direct</i> benefit, but please think of the imaginary reverse case: if the <code>Error() string</code> method\u2014which is the sole method comprising the <code>error</code> interface\u2014was defined on a non-pointer type, in order to call that method, you&#39;d need to actually copy the whole value to the method\u2014as its receiver. Since you cannot know the size of user-defined error values, such decision would potentially incur unneeded hidden costs when processing error values."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1534180152, "post_id": 51826510, "comment_id": 90609017, "body": "You might be tempted to counter this with the point that requiring error values are to be passed by pointer forces them to be heap-allocated most of the time. This is indeed true but then consider that any interface\u2014including <code>error</code>\u2014is internally a <code>struct</code> containing two pointers\u2014one to the original value, and another one\u2014to its real (called &quot;dynamic&quot;) type. So, to return an error value of your custom type as <code>error</code>, you need to have a pointer to that value anyway. As follows, with the implemented approach, you lose nothing in 99.9% of the real-world cases."}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1534178494, "answer_count": 0, "score": 1, "last_activity_date": 1534176527, "creation_date": 1534176527, "question_id": 51826510, "link": "https://stackoverflow.com/questions/51826510/go-custom-error-types-why-return-pointer-to-error", "closed_reason": "Duplicate", "title": "Go custom error types: why return pointer to error?", "body": "<p>Custom error types allow the caller to inspect the category of error with a type assertion:</p>\n\n<pre><code>type MyError struct {\n    Message string\n}\n\nfunc (e MyError) Error() string {\n    return e.Message\n}\n\nfunc GenerateError() error {\n    return MyError{\"example text\"}\n}\n\nfunc main() {\n    err := GenerateError()\n    _, ok := err.(MyError)\n    fmt.Printf(\"%t\\n\", ok)\n}\n</code></pre>\n\n<p>prints \"true\".</p>\n\n<p>However, in all examples I've seen explaining this technique, people don't write the code this way. Instead they pass around <em>pointers</em> to the custom error type:</p>\n\n<pre><code>type MyError struct {\n    Message string\n}\n\nfunc (e *MyError) Error() string {\n    return e.Message\n}\n\nfunc GenerateError() error {\n    return &amp;MyError{\"example text\"}\n}\n\nfunc main() {\n    err := GenerateError()\n    _, ok := err.(*MyError)\n    fmt.Printf(\"%t\\n\", ok)\n}\n</code></pre>\n\n<p>Examples:\n<a href=\"https://gobyexample.com/errors\" rel=\"nofollow noreferrer\">gobyexample.com</a>, <a href=\"https://medium.com/@sebdah/go-best-practices-error-handling-2d15e1f0c5ee\" rel=\"nofollow noreferrer\">this Medium article</a>.</p>\n\n<p>Is there any advantage to the extra indirection? Why is it more common if it's merely more complicated?</p>\n"}, {"tags": ["go", "struct", "yaml"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1534175270, "post_id": 51825622, "comment_id": 90606476, "body": "Most likely the identaiton is incorrect. If you remove one space from the beginning of the <code>models:</code> lines, it becomes clear and parsable."}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1534232262, "post_id": 51825622, "comment_id": 90625563, "body": "codebeautify uses the deficient PHP YAML parser. Using that site, in general, gives you no guarantee that your YAML is valid if it parses there, and not if it doesn&#39;t. There is also no reason to not just include that small YAML document here in your question. Once the codebeautify site goes down, your question becomes useless for visitors here."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1534178027, "last_edit_date": 1534178027, "creation_date": 1534175920, "answer_id": 51826331, "question_id": 51825622, "link": "https://stackoverflow.com/questions/51825622/parse-yaml-structs-error/51826331#51826331", "title": "parse yaml structs error", "body": "<p>According to the error:</p>\n\n<blockquote>\n  <p>error in model extConfigYaml: *yaml: line 4: mapping values are not\n  allowed in this context</p>\n</blockquote>\n\n<p>There is an error in the indentation of your provided yaml content in which the <code>models</code> indent level should match the <code>zone</code> indent level. Along with that there is no need to create a struct for <code>zone</code> since it is a string value but you have assigned it a <code>model</code> struct which contains <code>models</code> data. Also you should export the structs using uppercase letters. </p>\n\n<p>Modify your code to the code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\ntype ExternalConfig struct {\n    Landscape Zone `yaml:\"Landscape\"`\n}\n\ntype Zone struct {\n    Zone   string  `yaml:\"zone\"`\n    Models []Model `yaml:\"models\"`\n}\n\ntype Model struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\nvar external_config = []byte(`\nLandscape:\n  zone: zone1\n  models:\n    - app-type: app1\n      service-type: GCP\n    - app-type: app2\n      service-type: AMAZON\n  zone: zone2\n  models:\n    - app-type: app3\n      service-type: AZURE\n    - app-type: app4\u00cd\n      service-type: HEROKU\n`)\n\nfunc main() {\n\n    extConfigYaml := ExternalConfig{}\n\n    err := yaml.Unmarshal(external_config, &amp;extConfigYaml)\n    if err != nil {\n        log.Fatalln(\"error in model extConfigYaml: %v\", err)\n    }\n    fmt.Printf(\"%+v\\n\", extConfigYaml)\n}\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/brUqNpyYhYP\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 51826331, "answer_count": 1, "score": -1, "last_activity_date": 1534179404, "creation_date": 1534173616, "last_edit_date": 1534179404, "question_id": 51825622, "link": "https://stackoverflow.com/questions/51825622/parse-yaml-structs-error", "title": "parse yaml structs error", "body": "<p>I'm having the following yaml , when I try to parse it I got error, any idea what could be missing here?  im not sure how to struct the zone property.</p>\n\n<p>T<strong>his is the valid yaml</strong></p>\n\n<p><a href=\"https://codebeautify.org/yaml-validator/cb42f23a\" rel=\"nofollow noreferrer\">https://codebeautify.org/yaml-validator/cb42f23a</a></p>\n\n<p><strong>Error:</strong> </p>\n\n<blockquote>\n  <p>error in model extConfigYaml: *yaml: line 4: mapping values are not\n  allowed in this context</p>\n</blockquote>\n\n<pre><code>type ExternalConfig struct {\n    Landscape zone `yaml:\"Landscape\"`\n}\n\n\ntype zone struct {\n    zone models `yaml:\"zone\"`\n}\n\ntype models struct {\n    models []Model `yaml:\"models\"`\n}\n\ntype Model struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\nvar external_config = []byte(`\nLandscape:\n  zone: zone1\n   models:\n    - app-type: app1\n      service-type: GCP\n\n    - app-type: app2\n      service-type: AMAZON\n\n  zone: zone2\n   models:\n    - app-type: app3\n      service-type: AZURE\n    - app-type: app4\u00cd\n      service-type: HEROKU\n`)\n\n\nextConfigYaml := ExternalConfig{}\n\nerr = yaml.Unmarshal([]byte(external_config), &amp;extConfigYaml)\nif err != nil {\n    log.Fatalf(\"error in model extConfigYaml: %v\", err)\n}\nfmt.Printf(\"%+v\\n\", extConfigYaml)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534173385, "post_id": 51825482, "comment_id": 90605308, "body": "In your example code, <code>events</code> is not an object (that would be unmarshalled into a <code>map[string]interface{}</code>), it&#39;s an array (that would be unmarshalled into a <code>[]interface{}</code>)."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1534173837, "post_id": 51825482, "comment_id": 90605569, "body": "I posted an answer below, just realized you have a note at the bottom about a struct, why would you not want to use a struct?"}], "answers": [{"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 1, "last_activity_date": 1534173634, "creation_date": 1534173634, "answer_id": 51825630, "question_id": 51825482, "link": "https://stackoverflow.com/questions/51825482/avoid-typecasting-a-slice-value-in-loop/51825630#51825630", "title": "Avoid typecasting a slice value in loop", "body": "<p>You could define a struct that has both the error values and non error values in your struct. </p>\n\n<pre><code>type Response struct {\n    ErrorMessage string `json:\"message\"`\n    Error string `json:\"error\"`\n    Events []map[string]interface{} `json:\"events\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534173634, "creation_date": 1534173167, "question_id": 51825482, "link": "https://stackoverflow.com/questions/51825482/avoid-typecasting-a-slice-value-in-loop", "title": "Avoid typecasting a slice value in loop", "body": "<p>I'm reading an API (JSON) response from a server and I'm supposed to get(if the status is 200 ok) the following responses back.</p>\n\n<pre><code>// If I sent a wrong data ..\n{ \n  error: \"some value\",\n  message: \"... description of the error\"\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>// if all is good \n{\n  events: [{key1: 1}, {key2: \"two\"} ... ]\n}\n</code></pre>\n\n<p>because I'm not sure about the type of response. \nI'm decoding the response as a <code>map[string]interface{}</code>. </p>\n\n<pre><code>resp := make(map[string]interface{}, 0)\njson.NewDecoder(response.Body).Decode(&amp;resp)\n</code></pre>\n\n<p>Later in the code flows I reach a stage where I know that response is an all good one. I need to typecast the <code>interface{}</code> back to  <code>[]map[string]interface{}</code>. </p>\n\n<p>but I think this does not work .. </p>\n\n<pre><code>// This does not work I guess. \n// events := resp[\"events\"].([]map[string]interface{})\n</code></pre>\n\n<p>The only sane way I manage to do this is using.</p>\n\n<pre><code>interFace := resp[\"events\"].([]interface{})\nfor mapInterface := range interFace {\n  row := MapInterface.(map[string]interface{})\n  // now use the row hence forth\n} \n</code></pre>\n\n<p>Can this be done in any other way or any Other approach<sup>1</sup> that would avoid the casting in inside the loop. </p>\n\n<p><em>1: Maybe creating a Response struct over here can work. But I would really like to hear any other approaches that I can try before forward with a <code>struct</code> approach.</em></p>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1534172710, "post_id": 51825311, "comment_id": 90604896, "body": "You can&#39;t. If something accepts a concrete type, that&#39;s the only type you can use, not a mock type. You can only mock/stub if it accepts an interface you can implement."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534172939, "post_id": 51825311, "comment_id": 90605039, "body": "Poorly-written Java code is also difficult to test. The dynamic classloader that lets you pull all sorts of runtime hijinks in Java comes with a significant runtime complexity and memory cost. There are always tradeoffs."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534174754, "post_id": 51825311, "comment_id": 90606149, "body": "Would it then be acceptable to &quot;mock&quot; (by this, I mean &#39;stub&#39;) the <code>Session.Store</code> that the code under test relies on under the hood, and then use it?"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1061, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534172618, "creation_date": 1534172618, "question_id": 51825311, "link": "https://stackoverflow.com/questions/51825311/mocking-a-struct-with-dependencies-in-golang", "title": "Mocking a struct with dependencies in Golang", "body": "<p>I saw that <a href=\"https://medium.com/agrea-technogies/mocking-dependencies-in-go-bb9739fef008\" rel=\"nofollow noreferrer\">on here</a>, you can have a framework called Mockery generate mocks for interfaces for you. This is close to a big deal, because I am already using testify, which has built-in mock API (which, until now, I have not used yet). </p>\n\n<p>The drawback, however, is that it requires interfaces, whereas the code under test is a struct, with nested dependencies, both business logic and third-party code. I am not in charge of refactoring the code base (thank God), and am looking to mock this</p>\n\n<pre><code>package context\n\n//ApplicationContext The context to use if the use of an application is needed.\ntype ApplicationContext struct {\n    DatabaseContext\n}\n\n//GetAppId Gets the application id from the session.\nfunc (c *ApplicationContext) GetAppId() int {\n    if str := c.GetFromSession(\"ApplicationId\"); str != nil {\n        return str.(int)\n    }\n    return -1\n}\n\n//SetAppId Sets the application id into the session.\nfunc (c *ApplicationContext) SetAppId(id int) {\n    c.SetToSession(\"ApplicationId\", id)\n}\n</code></pre>\n\n<p>which extends <code>DatabaseContext</code>, which has <code>Session.Store</code> (third-party dependency that is used by those two functions) along with some other dependencies that are none of my concern.</p>\n\n<p>How could I mock this struct?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534172332, "post_id": 51825180, "comment_id": 90604647, "body": "Check if you have the permissions to change the credentials for a bucket and you can access bucket before changing the credentials and access grants on the bucket."}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1534172462, "post_id": 51825180, "comment_id": 90604729, "body": "use <code>GetCallerIdentity</code> under the sts service to verify your credentials&#39; accounts"}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "edited": false, "score": 0, "creation_date": 1534174278, "post_id": 51825320, "comment_id": 90605832, "body": "Perfect thank you! And yes I was thinking about doing it with with cross account roles like that but I was advised against it for security reasons. Having to go get new credentials in the middle of running the program isn&#39;t ideal but it should work for the time being. Thanks again for the answer!"}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "reply_to_user": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "edited": false, "score": 1, "creation_date": 1534174870, "post_id": 51825320, "comment_id": 90606215, "body": "you could accept it , if you think it&#39;s a right answer, to help others find it too"}], "tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": true, "score": 1, "last_activity_date": 1534172642, "creation_date": 1534172642, "answer_id": 51825320, "question_id": 51825180, "link": "https://stackoverflow.com/questions/51825180/updating-aws-credentials-from-a-running-cli-go-program-in-order-to-access-a-diff/51825320#51825320", "title": "Updating AWS Credentials from a running CLI Go program in order to access a different account", "body": "<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials</a> suggests that you instantiate like this :</p>\n\n<pre><code>sess, err := session.NewSession(&amp;aws.Config{\n    Region:      aws.String(\"us-west-2\"),\n    Credentials: credentials.NewStaticCredentials(\"AKID\", \"SECRET_KEY\", \"TOKEN\"),\n})\n</code></pre>\n\n<p>If I were trying to do this, I would have the accounts share a trust relationship by allowing one to assume a role in the other, rather than passing credentials.  </p>\n\n<p><a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html</a></p>\n\n<p>It's wonderfully convenient in go:</p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/stscreds/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/stscreds/</a></p>\n"}], "owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "accepted_answer_id": 51825320, "answer_count": 1, "score": 1, "last_activity_date": 1534172642, "creation_date": 1534172136, "last_edit_date": 1534172391, "question_id": 51825180, "link": "https://stackoverflow.com/questions/51825180/updating-aws-credentials-from-a-running-cli-go-program-in-order-to-access-a-diff", "title": "Updating AWS Credentials from a running CLI Go program in order to access a different account", "body": "<p>Sorry if this is a very basic question, but I am new to AWS and have not found an answer in my research online. I am creating a CLI tool in Go that will pull down all the contents from an s3 bucket locally, then allow you to input new credentials, and then push those contents to a bucket in the new environment.</p>\n\n<p>I am running into an issue where I am to input the new credentials. Here is the code: </p>\n\n<pre><code>type MyProvider struct{\n    creds        credentials.Value\n}\n\nfunc getNewCredentials() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Copy new AWS Access Key: \")\n    AK, _ := reader.ReadString('\\n')\n    fmt.Print(\"Copy new AWS Secret Access Key: \")\n    SAK, _ := reader.ReadString('\\n')\n    fmt.Print(\"Copy new AWS session token: \")\n    ST, _ := reader.ReadString('\\n')\n    fmt.Print(\"New stage name(poc, dev, qa, prod): \")\n    lib.Stage, _ = reader.ReadString('\\n')\n\n    provider := MyProvider{\n        creds: credentials.Value{AK, SAK, ST, \"\"},\n    }\n\n    creds := credentials.NewCredentials(&amp;provider)\n\n}\n</code></pre>\n\n<p>I am using a custom provider, and I have overwritten the provider functions Retrieve() and isExpired() (not shown in code snippet). </p>\n\n<p>When I try and access the new bucket, it says the bucket does not exist, leading me to believe the credentials did not properly update. My guess is this has to do with the blank providername at the end of the Value struct. I am not sure what to put there.</p>\n\n<p>Any guidance on how to fix this would be very helpful. The program is not throwing any errors, but rather just not actually updating the credentials. </p>\n"}, {"tags": ["http", "go", "http-headers"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534169334, "post_id": 51823904, "comment_id": 90602650, "body": "Wrap your router in a handler type that sets the header and then invokes the original router. E.g. <a href=\"https://play.golang.org/p/JRFXsvUmFmP\" rel=\"nofollow noreferrer\">play.golang.org/p/JRFXsvUmFmP</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534170701, "post_id": 51824371, "comment_id": 90603557, "body": "Definitely the way to go. This is generically a wrapper function, but in the specific case of HTTP handlers this is commonly referred to as a middleware."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1534173076, "post_id": 51824371, "comment_id": 90605124, "body": "Thanks so much for your response. It works flawlessly and its really clever. the only problem I have is that the routes I don&#39;t define, for instance, when I give an invalid path and get a 404, the response I get of course it does not have this."}], "tags": [], "owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "is_accepted": false, "score": 2, "last_activity_date": 1534170670, "last_edit_date": 1534170670, "creation_date": 1534169481, "answer_id": 51824371, "question_id": 51823904, "link": "https://stackoverflow.com/questions/51823904/default-http-header-in-web-api-responses/51824371#51824371", "title": "Default HTTP header in web API responses", "body": "<p>Create a wrapper function. Something like:</p>\n\n<pre><code>package main\n\nimport \"net/http\"\n\nfunc SetDefaultHeaders(handler func(w http.ResponseWriter, r *http.Request)) func(w http.ResponseWriter, r *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        // Set default headers\n        handler(w, r)\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", SetDefaultHeaders(func(w http.ResponseWriter, r *http.Request) {\n        // ...\n    }))\n}\n</code></pre>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1538380164, "creation_date": 1534168036, "last_edit_date": 1534168818, "question_id": 51823904, "link": "https://stackoverflow.com/questions/51823904/default-http-header-in-web-api-responses", "title": "Default HTTP header in web API responses", "body": "<p>Im attempting to set a default header in my Golang web api. I am using the net/http router that comes with Go. I can find many examples of how to do this :</p>\n\n<ul>\n<li>Using some other routers.</li>\n<li>Doing it for every response ( I am already doing it )</li>\n</ul>\n\n<p>Is it there a way in which I can set a default header for all responses using net/http?</p>\n"}, {"tags": ["go", "angular5"], "comments": [{"owner": {"reputation": 559, "user_id": 6843968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/837570a6eefe9402a0ea7df116184025?s=128&d=identicon&r=PG&f=1", "display_name": "MounirOnGithub", "link": "https://stackoverflow.com/users/6843968/mounirongithub"}, "edited": false, "score": 0, "creation_date": 1534163858, "post_id": 51822516, "comment_id": 90598983, "body": "You should log the request to watch what&#39;s going on, in your golang application"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 2, "creation_date": 1534164169, "post_id": 51822516, "comment_id": 90599200, "body": "Please do not add a screenshot of the returned json. Please add it as source code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534170994, "post_id": 51822516, "comment_id": 90603756, "body": "Have you checked the console &amp; request logs in the browser to see if the call is being made and what the failure is?"}], "answers": [{"comments": [{"owner": {"reputation": 559, "user_id": 6843968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/837570a6eefe9402a0ea7df116184025?s=128&d=identicon&r=PG&f=1", "display_name": "MounirOnGithub", "link": "https://stackoverflow.com/users/6843968/mounirongithub"}, "edited": false, "score": 1, "creation_date": 1534164268, "post_id": 51822619, "comment_id": 90599269, "body": "I think he did it. Watch the screenshot"}], "tags": [], "owner": {"reputation": 6070, "user_id": 3612327, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/GBshE.jpg?s=128&g=1", "display_name": "clevertension", "link": "https://stackoverflow.com/users/3612327/clevertension"}, "is_accepted": false, "score": 0, "last_activity_date": 1534164037, "creation_date": 1534164037, "answer_id": 51822619, "question_id": 51822516, "link": "https://stackoverflow.com/questions/51822516/angular-client-is-not-calling-backend-service/51822619#51822619", "title": "Angular client is not calling backend service", "body": "<p>you should import and inject the HttpClient,</p>\n\n<pre><code>import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\n\n@Injectable()\nexport class TestServiceService {\n\nprivate url2 ='http://localhost:8000/api/books/';\n\nconstructor(private http : HttpClient) { }\n\ngetValues() \n{\n    debugger;\n    return this.http.get(this.url2);\n};\n\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 440, "user_id": 9304999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3970fc1fd87d29ff362f86310cce7b06?s=128&d=identicon&r=PG&f=1", "display_name": "jinbeom hong", "link": "https://stackoverflow.com/users/9304999/jinbeom-hong"}, "is_accepted": false, "score": 0, "last_activity_date": 1534164603, "creation_date": 1534164603, "answer_id": 51822800, "question_id": 51822516, "link": "https://stackoverflow.com/questions/51822516/angular-client-is-not-calling-backend-service/51822800#51822800", "title": "Angular client is not calling backend service", "body": "<p>How did you call services' method in angular component?</p>\n\n<p>Refer to angular guide HttpClient section. <a href=\"https://angular.io/guide/http#getting-json-data\" rel=\"nofollow noreferrer\">https://angular.io/guide/http#getting-json-data</a></p>\n\n<p>Because you didn't show the code for Angular component, I don't know a root cause of your ploblem. I presume you may subscribe a <code>Observable</code>, which is return value of <code>getValues</code> method. It should be like below(refer to the docs):</p>\n\n<pre><code>showConfig() {\n  this.configService.getConfig()\n    .subscribe((data: Config) =&gt; this.config = {\n        heroesUrl: data['heroesUrl'],\n        textfile:  data['textfile']\n    });\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10219309, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pKVqefiTy7k/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pkpFVNxl5TCfFHyeXal4Q1qdnxsQ/mo/photo.jpg?sz=128", "display_name": "Ravi Reddy", "link": "https://stackoverflow.com/users/10219309/ravi-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1534165016, "creation_date": 1534163691, "last_edit_date": 1534165016, "question_id": 51822516, "link": "https://stackoverflow.com/questions/51822516/angular-client-is-not-calling-backend-service", "title": "Angular client is not calling backend service", "body": "<p>I am developing Sample application where I am using Angular 5 for front end and Go Lang for rest services(web services). Here my angular is not calling service, but those services are working fine when I run from google by pasting url and I have added CORS in Go. Here is my angular code:</p>\n\n<pre><code>export class TestServiceService {\n\nprivate url2 ='http://localhost:8000/api/books/';\n\n  constructor(private http : HttpClient) { }\n\n  getValues() \n  {\n    debugger;\n     return this.http.get(this.url2);\n  };\n\n}\n</code></pre>\n\n<p>Here is my Go code <code>package</code> main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\n//Book struct\ntype Book struct {\n    RollNo    string `json:\"rollNo\"`\n    FirstName string `json:\"firstName\"`\n    Author    string `json:\"author\"`\n}\n\nvar books []Book\n\nfunc getBooks(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"Method hit\")\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(books)\n}\n\nfunc main() {\n    r := mux.NewRouter()\n\n    fmt.Println(\"started service\")\n\n    books = append(books, Book{RollNo: \"1\", FirstName: \"Ravi\", Author: \"Dan\"})\n\n    r.HandleFunc(\"/api/books/\", getBooks).Methods(\"GET\")\n\n    log.Fatal(http.ListenAndServe(\":8000\", r))\n}\n</code></pre>\n\n<p>Here is the screenshot proof where the service is working fine:</p>\n\n<p><a href=\"https://i.stack.imgur.com/AQfDS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AQfDS.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here the service method is not called with angular and there is no errors</p>\n"}, {"tags": ["go", "dns"], "comments": [{"owner": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "edited": false, "score": 0, "creation_date": 1534175357, "post_id": 51819599, "comment_id": 90606529, "body": "<i>This case, TCP protocol is not considered</i>  you will get problems... even more so if you do not implement EDNS."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1534163362, "last_edit_date": 1534163362, "creation_date": 1534158348, "answer_id": 51820906, "question_id": 51819599, "link": "https://stackoverflow.com/questions/51819599/how-can-i-get-client-dns-ip-using-go/51820906#51820906", "title": "How can I get client DNS IP using Go", "body": "<p>UDP is stateless. There is no single client address for a connection. Each packet can be sent from a different address, so <code>RemoteAddr</code> is only useful on the client, but not the server.</p>\n\n<p>Use one of <a href=\"https://golang.org/pkg/net/#UDPConn.ReadFrom\" rel=\"nofollow noreferrer\"><code>*UDPConn.ReadFrom</code></a>, <a href=\"https://golang.org/pkg/net/#UDPConn.ReadFromUDP\" rel=\"nofollow noreferrer\"><code>*UDPConn.ReadFromUDP</code></a>, or <a href=\"https://golang.org/pkg/net/#UDPConn.ReadMsgUDP\" rel=\"nofollow noreferrer\"><code>*UDPConn.ReadMsgUDP</code></a> instead of <code>Read</code>. All of them return the client address for the read packet.</p>\n"}], "owner": {"reputation": 13, "user_id": 10218497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5eaa41a9ea3437d638ae2d2fe53e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/10218497/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 51820906, "answer_count": 1, "score": -2, "last_activity_date": 1534163362, "creation_date": 1534153845, "question_id": 51819599, "link": "https://stackoverflow.com/questions/51819599/how-can-i-get-client-dns-ip-using-go", "title": "How can I get client DNS IP using Go", "body": "<p>I want Get Client Cache DNS IP using Go</p>\n\n<p>Look at the code I tried below</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    // Usually DNS Server using 53 port number\n    // This case, TCP protocol is not considered\n    port := \":53\"\n    protocol := \"udp\"\n\n    var buf [2048]byte\n\n    //Build the address\n    udpAddr, err := net.ResolveUDPAddr(protocol, port)\n    if err != nil {\n        fmt.Println(\"Wrong Address\")\n        return\n    }\n\n    fmt.Println(\"Listened \" + protocol + \" from \" + udpAddr.String())\n\n    //Create the connection\n    udpConn, err := net.ListenUDP(protocol, udpAddr)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // Listening 53 Port Like DNS Server\n    for {\n\n        // If get request,\n        _, err := udpConn.Read(buf[0:])\n        if err != nil {\n            fmt.Println(\"Error Reading\")\n            return\n        } else {\n            // Print Remote Address,\n            // I Guess this is the Client Cache DNS IP, but this is print &lt;nil&gt;\n            fmt.Println(udpConn.RemoteAddr())\n        }\n    }\n}\n</code></pre>\n\n<p>How do I get the Client Cache DNS IP in this case? Pleas Help me\nI Want to Build Client DNS IP Collector, seem whoami</p>\n\n<p>I also refer to this as <a href=\"https://github.com/miekg/exdns/blob/master/reflect/reflect.go\" rel=\"nofollow noreferrer\">https://github.com/miekg/exdns/blob/master/reflect/reflect.go</a>\nbut this is not answer for me</p>\n\n<p>I want simple server</p>\n"}, {"tags": ["testing", "go", "integration-testing", "grpc", "goland"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 3477206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d434863359909b34ef9e202eb318395f?s=128&d=identicon&r=PG&f=1", "display_name": "lyuxuan", "link": "https://stackoverflow.com/users/3477206/lyuxuan"}, "is_accepted": true, "score": 0, "last_activity_date": 1534363481, "creation_date": 1534363481, "answer_id": 51865669, "question_id": 51819159, "link": "https://stackoverflow.com/questions/51819159/go-grpc-server-make-integration-tests-fail/51865669#51865669", "title": "Go gRPC server make integration tests fail", "body": "<p><code>grpcServer.Serve(lis)</code> is a blocking call. So like what you did with HTTP server <code>go server.ListenAndServe()</code>, you need to run it in a goroutine. Could you please try if <code>go grpcServer.Serve(lis)</code> will make the test pass?</p>\n\n<p>I am not sure about your new EDIT which indicates the problem is abut the listener. You can check whether <code>net.Listen(\"tcp\", fmt.Sprintf(\":%d\", serverPort))</code> returns or blocks.</p>\n"}], "owner": {"reputation": 53, "user_id": 4110451, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZY8hyLRV1EE/AAAAAAAAAAI/AAAAAAAAAd4/KnZOqFmdduU/photo.jpg?sz=128", "display_name": "Marco Vignati", "link": "https://stackoverflow.com/users/4110451/marco-vignati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 51865669, "answer_count": 1, "score": 0, "last_activity_date": 1534363481, "creation_date": 1534152383, "last_edit_date": 1534160935, "question_id": 51819159, "link": "https://stackoverflow.com/questions/51819159/go-grpc-server-make-integration-tests-fail", "title": "Go gRPC server make integration tests fail", "body": "<p>I recently started to play again with go, and my task at the moment is to implement a service (that will run on k8s) that should act as a gRPC server.</p>\n\n<p>As per requirements, at the moment, to satisfy the readinessProbe on k8s, I need to implement an healthcheck endpoint for my service, and this should be tested: what I've done is:</p>\n\n<pre><code>func main() {\n    server := startHTTPServer()\n    defer server.Close()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt, syscall.SIGTERM, syscall.SIGINT)\n\n    &lt;-c\n    log.Println(\"Stopped\")\n}\n\nfunc startHTTPServer() *http.Server {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n    })\n\n    server := &amp;http.Server{\n        Addr: net.JoinHostPort(\"\", strconv.Itoa(livelinessPort)),\n    }\n\n    go server.ListenAndServe()\n\n    return server\n}\n</code></pre>\n\n<p>and I tested in this way, following <a href=\"http://cs-guy.com/blog/2015/01/test-main/\" rel=\"nofollow noreferrer\">this article</a>:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    flag.Parse()\n\n    wg := setup()\n\n    result := m.Run()\n\n    shutdown(wg)\n\n    os.Exit(result)\n}\n\nfunc shutdown(wg *sync.WaitGroup) {\n    syscall.Kill(syscall.Getpid(), syscall.SIGINT)\n    wg.Wait()\n}\n\nfunc setup() *sync.WaitGroup{\n    os.Setenv(\"APP_ENV\", EnvTest)\n\n    wg := &amp;sync.WaitGroup{}\n    startMainProcess(wg)\n    return wg\n}\n\nfunc startMainProcess(wg *sync.WaitGroup) {\n    go func() {\n        wg.Add(1)\n        defer wg.Done()\n        main()\n    }()\n}\n\nfunc TestK8SHealth(t *testing.T) {\n    res, err := http.Get(\"http://:8080/\")\n    if err != nil {\n        t.Errorf(\"Unexpected API error: %s\", err)\n        return\n    }\n\n    defer res.Body.Close()\n\n    if res.StatusCode != http.StatusOK {\n        t.Errorf(\"Unexpected status code: %d\", res.StatusCode)\n        return\n    }\n}\n</code></pre>\n\n<p>and so far so good:</p>\n\n<pre><code>$ go test\nPASS\n2018/08/13 09:23:16 Stopped\nok      github.com/...        0.015s\n</code></pre>\n\n<p>Te problem is when I try to add the gRPC server in the main application, following <a href=\"https://grpc.io/docs/tutorials/basic/go.html\" rel=\"nofollow noreferrer\">gPRC go examples</a>. I've added this to my main file</p>\n\n<pre><code>func main() {\n    [...]\n\n    startChecksServiceServer()\n\n    [...]\n}\n\nfunc startChecksServiceServer() *grpc.Server {\n    flag.Parse()\n    lis, err := net.Listen(\"tcp\", fmt.Sprintf(\":%d\", serverPort))\n    if err != nil {\n        log.Fatalf(\"Starting gPRC server error: failed to listen port %d: %v\", serverPort, err)\n    }\n\n    grpcServer := grpc.NewServer()\n\n    pb.RegisterChecksServiceServer(grpcServer, &amp;checksServiceServer{})\n\n    grpcServer.Serve(lis)\n    log.Println(\"Started grpc server\")\n    return grpcServer\n}\n</code></pre>\n\n<p>but now when I run the test, it fails after the actual test was run, when the interrupt signal is sent.</p>\n\n<pre><code>$  go test \nPASS\nsignal: interrupt\nFAIL    github.com/...        0.016s\n</code></pre>\n\n<p>I made some tests and this is not depending by the actual test (as it pass with a test function that just <code>return</code>, and it's working while running the test suite using goLand:</p>\n\n<pre><code>GOROOT=/usr/local/go #gosetup\nGOPATH=/Users/marco/Documents/projects/go #gosetup\n/usr/local/go/bin/go test -c -i -o /private/var/folders/jh/znhv9f090yb7y390dckb23s00000gn/T/[...] #gosetup\n/usr/local/go/bin/go tool test2json -t /private/var/folders/jh/znhv9f090yb7y390dckb23s00000gn/T/[...] -test.v -test.run\n^TestK8SHealth$ #gosetup\n=== RUN   TestK8SHealth\n--- PASS: TestK8SHealth (0.00s)\nPASS\n\nProcess finished with exit code 1\n</code></pre>\n\n<p>--- <strong>EDIT</strong></p>\n\n<p>I found that the problem is around the listener. Having in the main function:</p>\n\n<pre><code>func main() {\n    net.Listen(\"tcp\", fmt.Sprintf(\":%d\", serverPort))\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt, syscall.SIGTERM, syscall.SIGINT)\n\n    &lt;-c\n    log.Println(\"Stopped\")\n}\n</code></pre>\n\n<p>and a test with just a return (with the same setup of the previous one) will cause the test to fail: </p>\n\n<pre><code>$ go test -v\n=== RUN   Test2\n--- PASS: Test2 (0.00s)\nPASS\nsignal: interrupt\nFAIL    github.com/[...]        0.014s\n</code></pre>\n"}, {"tags": ["go", "methods", "struct", "interface", "embedding"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1534142443, "post_id": 51816393, "comment_id": 90587112, "body": "I don&#39;t understand what you&#39;re trying to do. But the behavior you describe makes perfect sense, since you&#39;re checking the underlying type in SomeFunction. To avoid the behavior you see, probably just don&#39;t do that--rely on the interface instead. But again, I don&#39;t know your goal, so I can&#39;t really say how to achieve it."}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 1772128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e03a5c568f53ca620fae857cd70db60b?s=128&d=identicon&r=PG", "display_name": "David M", "link": "https://stackoverflow.com/users/1772128/david-m"}, "edited": false, "score": 0, "creation_date": 1534153659, "post_id": 51816536, "comment_id": 90592761, "body": "Thanks for the long explanation. Very educational. I still have a question. Apparently even if not for aliasing it&#39;s still possible for a struct to include an interface for whatever reason. Then in which case is <code>SomeFunction(myStruct)</code> making sense? This is obvious some extra labor for the compiler - it has to be smart enough to recognize that <code>myStruct</code> is actually similar (if not equal) to an instance of <code>ParentInterface </code> so it let <code>SomeFunction()</code> go. What&#39;s the benefit of doing so (for the compiler) if this is just a wrong practice?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 123, "user_id": 1772128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e03a5c568f53ca620fae857cd70db60b?s=128&d=identicon&r=PG", "display_name": "David M", "link": "https://stackoverflow.com/users/1772128/david-m"}, "edited": false, "score": 1, "creation_date": 1534153870, "post_id": 51816536, "comment_id": 90592890, "body": "@DavidM <code>SomeFunction()</code> expects a value that implements the <code>ParentInterface</code>. Any value that implements it is valid, accepted, and is checked at compile time. Type of <code>mystruct</code> implements that interface, this is the only thing that matters to make the function call. The concrete type of the passed value is irrelevant at the time of the call, the only thing that matters is that it implements the interface type of the param."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1534147909, "last_edit_date": 1534147909, "creation_date": 1534142732, "answer_id": 51816536, "question_id": 51816393, "link": "https://stackoverflow.com/questions/51816393/how-to-avoid-a-golang-function-having-different-behaviors-between-calling-the-em/51816536#51816536", "title": "How to avoid a golang function having different behaviors between calling the embedding and embedded types?", "body": "<p>There is no compiler mistake here and your experienced result is the expected one.</p>\n\n<p>Your <code>SomeFunction()</code> function explicitly states it wants to do different things based on the dynamic type of the passed interface value, and that is exactly what happens.</p>\n\n<p>We introduce interfaces in the first place so we don't have to care about the dynamic type that implements it. The interface gives us guarantees about existing methods, and those are the only things you should rely on, you should only call those methods and not do some type-switch or assertion kung-fu.</p>\n\n<p>Of course this is the ideal world, but you should stick to it as much as possible.</p>\n\n<p>Even if in some cases you can't fit everything into the interface, you can again type assert another interface and not a concrete type out of it if you need additional functionality.</p>\n\n<p>A typical example of this is writing an <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>http.Handler</code></a> where you get the response writer as an interface: <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a>.  It's quite minimalistic, but the actual type passed can do a lot more. To access that \"more\", you may use additional type assertions to obtain that extra interface, such as <a href=\"https://golang.org/pkg/net/http/#Pusher\" rel=\"nofollow noreferrer\"><code>http.Pusher</code></a> or <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"nofollow noreferrer\"><code>http.Flusher</code></a>.</p>\n\n<p>In Go, there is no inheritance and polymorphism. Go favors composition. When you embed a type into another type (struct), the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of the embedded type will be part of the embedder type. This means any interfaces the embedded type implemented, the embedder will also implement those. And calling methods of those implemented interfaces will \"forward\" the call to the embedded type, that is, the receiver of those method calls will be the embedded value. This is unless you \"override\" those methods by providing your own implementation with the receiver type being the embedder type. But even in this case virtual routing will not happen. Meaning if the embedded type has methods <code>A()</code> and <code>B()</code>, and implementation of <code>A()</code> calls <code>B()</code>, if you provide your own <code>B()</code> on the embedder, calling <code>A()</code> (which is of the embedded type) will not call <em>your</em> <code>B()</code> but that of the embedded type.</p>\n\n<p>This is not something to avoid (you can't avoid it), this is something to know about (something to live with). If you know how this works, you just have to take this into consideration and count with it.</p>\n\n<blockquote>\n  <p>Because I'm happily use <code>MyStruct</code> as an alias of <code>ParentInterface</code> in my code (which is why I define it in the first place)</p>\n</blockquote>\n\n<p>You shouldn't use embedding to create aliases, that is a misuse of embedding. Embedding a type in your own will not be an alias. Implementations of existing methods that check concrete types will \"fail\" as you experienced (meaning they will not find a match to their expected concrete type).</p>\n\n<p>Unless you want to \"override\" some methods or implement certain interfaces this way, you shouldn't use embedding. Just use the original type. Simplest, cleanest. If you need aliases, <a href=\"https://golang.org/doc/go1.9\" rel=\"nofollow noreferrer\">Go 1.9 introduced the type alias feature</a> whose syntax is:</p>\n\n<pre><code>type NewType = ExistingType\n</code></pre>\n\n<p>After the above declaration <code>NewType</code> will be identical to <code>ExistingType</code>, they will be completely interchangeable (and thus have identical method sets). But know that this does not add any new \"real\" feature to the language, anything that is possible with type aliases is doable without them. It is mainly to support easier, gradual code refactoring.</p>\n"}], "owner": {"reputation": 123, "user_id": 1772128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e03a5c568f53ca620fae857cd70db60b?s=128&d=identicon&r=PG", "display_name": "David M", "link": "https://stackoverflow.com/users/1772128/david-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1534147909, "creation_date": 1534142131, "last_edit_date": 1534144316, "question_id": 51816393, "link": "https://stackoverflow.com/questions/51816393/how-to-avoid-a-golang-function-having-different-behaviors-between-calling-the-em", "title": "How to avoid a golang function having different behaviors between calling the embedding and embedded types?", "body": "<p>Let's say in a 3rd party library we have an interface and a struct implementing this interface. Let's also assume there is a function that takes ParentInterface as argument, which have different behavior for different types.</p>\n\n<pre><code>type ParentInterface interface {\n    SomeMethod()\n}\n\ntype ParentStruct struct {\n    ...\n}\n\nfunc SomeFunction(p ParentInterface) {\n    switch x := p.Type {\n    case ParentStruct:\n        return 1\n    }\n    return 0\n}\n</code></pre>\n\n<p>In our code we want to use this interface, but with our augmented behavior, so we embed it in our own struct. The compiler actually allows us to call functions about <code>ParentInterface</code> on my struct directly: </p>\n\n<pre><code>type MyStruct struct {\n    ParentInterface\n}\n\nparentStruct := ParentStruct{...}\nmyStruct := MyStruct{parentStruct}\n\nparentStruct.SomeMethod()  // Compiler OK.\nmyStruct.SomeMethod()  // Compiler OK. Result is same. Great.\n\nSomeFunction(parentStruct)  // Compiler OK. Result is 1.\nSomeFunction(myStruct.ParentInterface)  // Compiler OK. Result is 1.\nSomeFunction(myStruct)  // Compiler OK. Result is 0. (!)\n</code></pre>\n\n<p>Isn't the last case a problem? I've encountered this kind of bugs more than once. Because I'm happily use <code>MyStruct</code> as an alias of <code>ParentInterface</code> in my code (which is why I define it in the first place), it's so hard to always remember that we cannot call <code>SomeFunction</code> on <code>MyStruct</code> directly (the compiler says we can!). </p>\n\n<p>So what's the best practice to avoid this kind of mistake? Or it's actually a flaw of the compiler, which is supposed to forbid the use of <code>SomeFunction(myStruct)</code> at all since the result is untrustable anyway?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1534148949, "post_id": 51815109, "comment_id": 90590132, "body": "I&#39;m afraid you cannot as you actually picked a correct way of doing that but the <code>net.FileConn</code> is indeed explicitly documented as being not supported on Windows: &#171;On NaCl and Windows, the <code>FileConn</code>, <code>FileListener</code> and <code>FilePacketConn</code> functions are not implemented.&#187;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1534149177, "post_id": 51815109, "comment_id": 90590231, "body": "One way to tackle this I might think of is that since, I think, v1.10, access to any <i>pollable</i> file descriptor/handle is now handled via the netpoller, so you might do two things: 1) write your custom type around your handle which would implement <code>net.Conn</code> (remember it&#39;s merely an interface); 2) make sure the handles your syscall returns are &quot;pollable&quot; as far as the Go runtime is concerned. Ensuring this might require additional trickery so it&#39;s better to come up with a more concrete question on <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">the mailing list</a>."}], "owner": {"reputation": 19, "user_id": 10109646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbf70577165367febc2e0a81c0330ff0?s=128&d=identicon&r=PG&f=1", "display_name": "weiyxcc", "link": "https://stackoverflow.com/users/10109646/weiyxcc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1534145009, "creation_date": 1534133518, "last_edit_date": 1534145009, "question_id": 51815109, "link": "https://stackoverflow.com/questions/51815109/how-to-transform-syscall-handle-to-net-conn-on-windows", "title": "How to transform syscall.Handle to net.Conn on windows?", "body": "<p>Consider the following:</p>\n\n<pre><code>if fd, err = syscall.Socket(family, syscall.SOCK_STREAM, syscall.IPPROTO_TCP); err != nil {\n    return\n}\n\n// do something on fd like bind ...\n\nif err = os.NewSyscallError(\"connect\", syscall.Connect(fd, sockaddr)); err != nil {\n    syscall.Close(fd)\n    return\n}\n\nf := os.NewFile(uintptr(fd), \"socket\")\nconn, err = net.FileConn(f)\nif err != nil {\n    fmt.Println(err)\n    f.Close()\n    syscall.Close(fd)\n}\n</code></pre>\n\n<p>result: <code>file file+net socket: not supported by windows</code></p>\n\n<p>Is there any way to transfrom the <code>syscall.Handle</code> to a <code>net.Conn</code> on Windows ?</p>\n\n<p>I use Windows 10 and go version 1.10.3 windows/amd64</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 0, "creation_date": 1534131066, "post_id": 51814804, "comment_id": 90584115, "body": "your json is invalid."}, {"owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "reply_to_user": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 0, "creation_date": 1534132628, "post_id": 51814804, "comment_id": 90584384, "body": "oops.fixed the data and the code. Need to know if there is a better way to iterate."}], "answers": [{"tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": true, "score": 3, "last_activity_date": 1534133285, "creation_date": 1534133285, "answer_id": 51815078, "question_id": 51814804, "link": "https://stackoverflow.com/questions/51814804/iterating-list-json-object-in-golang/51815078#51815078", "title": "Iterating list json object in golang", "body": "<p>the best way will be to Unmarshal the JSON into an struct and iterate over the values, </p>\n\n<pre><code>func main() {\n\n        var output StructName\n\n\nerr := json.Unmarshal([]byte(jsonBytes), &amp;output)\n    if err != nil {\n        print(err)\n    }\n    for _, value := range output.Outputs {\n        for _, val := range value.Data.Concepts {\n            fmt.Printf(\"AppId:%s\\nID:%s\\nname:%s\\nvalue:%f\", val.AppID, val.ID, val.Name, val.Value)\n        }\n    }\n}\n\ntype StructName struct {\n    Outputs []struct {\n        Data struct {\n            Concepts []struct {\n                AppID string  `json:\"app_id\"`\n                ID    string  `json:\"id\"`\n                Name  string  `json:\"name\"`\n                Value float64 `json:\"value\"`\n            } `json:\"concepts\"`\n        } `json:\"data\"`\n    } `json:\"outputs\"`\n    Status struct {\n        Code        int    `json:\"code\"`\n        Description string `json:\"description\"`\n    } `json:\"status\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1832, "favorite_count": 0, "accepted_answer_id": 51815078, "answer_count": 1, "score": 1, "last_activity_date": 1610217110, "creation_date": 1534130564, "last_edit_date": 1610217110, "question_id": 51814804, "link": "https://stackoverflow.com/questions/51814804/iterating-list-json-object-in-golang", "title": "Iterating list json object in golang", "body": "<p>I have this piece of code to read a JSON object. I need to easily iterate over all the elements in the 'outputs'/data/concepts key.</p>\n<p>Is there a better way to do it?</p>\n<p>Also, how can I access the attributes of value:\nvalue.app_id, value.id..etc</p>\n<p>Code:</p>\n<pre><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n)\n\nvar jsonBytes = []byte(`\n{&quot;outputs&quot;: [{\n          &quot;data&quot;: {&quot;concepts&quot;: \n                                 [{&quot;app_id&quot;: &quot;main&quot;,\n                                     &quot;id&quot;: &quot;ai_GTvMbVGh&quot;,\n                                     &quot;name&quot;: &quot;ancient&quot;,\n                                     &quot;value&quot;: 0.99875855}]\n              }}\n              ],\n &quot;status&quot;: {&quot;code&quot;: 10000, &quot;description&quot;: &quot;Ok&quot;}}`)\n\n\nfunc main() {\n    var output map[string]interface{}\n    err := json.Unmarshal([]byte(jsonBytes), &amp;output)\n    if err != nil {\n        print(err)\n    }\n    for _, value := range output[&quot;outputs&quot;].([]interface{}) {\n        //fmt.Println(value.(map[string]interface{})[&quot;data&quot;].(map[string]interface{})[&quot;concepts&quot;]).([]interface{})\n        //fmt.Println(value.(map[string]interface{})[&quot;data&quot;].(map[string]interface{})[&quot;concepts&quot;])\n        for _, value := range value.(map[string]interface{})[&quot;data&quot;].(map[string]interface{})[&quot;concepts&quot;].([]interface{}){\n            fmt.Println(value)\n        }\n    }\n    //fmt.Printf(&quot;%+v\\n&quot;, output)\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk"], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 6031948, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nW0RvlDi2rA/AAAAAAAAAAI/AAAAAAAAAww/LYw7gFx44nk/photo.jpg?sz=128", "display_name": "Brian Wagner", "link": "https://stackoverflow.com/users/6031948/brian-wagner"}, "edited": false, "score": 1, "creation_date": 1599847907, "post_id": 51825114, "comment_id": 112912271, "body": "As of Sep. 2020, I believe the SDK has changed to expect passing <code>aws.String(...)</code> in many cases. So here it would be <code>aws.String(&quot;public-read&quot;)</code>"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 371, "user_id": 6031948, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-nW0RvlDi2rA/AAAAAAAAAAI/AAAAAAAAAww/LYw7gFx44nk/photo.jpg?sz=128", "display_name": "Brian Wagner", "link": "https://stackoverflow.com/users/6031948/brian-wagner"}, "edited": false, "score": 0, "creation_date": 1599898271, "post_id": 51825114, "comment_id": 112922616, "body": "thanks Brian.  I don&#39;t have time to test this (I&#39;m sure you are correct) so I&#39;ll just leave it as an upvoted comment"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 11, "last_activity_date": 1534171911, "creation_date": 1534171911, "answer_id": 51825114, "question_id": 51814499, "link": "https://stackoverflow.com/questions/51814499/aws-go-sdk-s3-upload-with-public-access/51825114#51825114", "title": "AWS go SDK S3 upload with public access", "body": "<p>Try ACL : \"public-read\" instead</p>\n\n<pre><code>bucketName := \"test-bucket\"\nkey2 := \"test.zip\"\nupParams := &amp;s3manager.UploadInput{\n    Bucket: &amp;bucketName,\n    Key:    &amp;key2,\n    Body:   response.Body,\n    ACL: \"public-read\",\n}\n\nsess := session.Must(session.NewSession())\n\nuploader := s3manager.NewUploader(sess)\n\n_, err = uploader.Upload(upParams)\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 8877403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9e2dac233cffad94a8e94d7cf9b3d?s=128&d=identicon&r=PG&f=1", "display_name": "NewDev", "link": "https://stackoverflow.com/users/8877403/newdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1719, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1534171911, "creation_date": 1534127523, "last_edit_date": 1534143829, "question_id": 51814499, "link": "https://stackoverflow.com/questions/51814499/aws-go-sdk-s3-upload-with-public-access", "title": "AWS go SDK S3 upload with public access", "body": "<p>I've been trying to upload an object to S3 with public access but I haven't been able to do it.</p>\n\n<p>I am getting this error: <code>InvalidArgument: Argument format not recognized status code: 400</code></p>\n\n<p>Here is my code:</p>\n\n<pre><code>bucketName := \"test-bucket\"\nkey2 := \"test.zip\"\nupParams := &amp;s3manager.UploadInput{\n    Bucket: &amp;bucketName,\n    Key:    &amp;key2,\n    Body:   response.Body,\n    GrantRead: aws.String(\"uri:http://acs.amazonaws.com/groups/global/AllUsers\"),\n}\n\nsess := session.Must(session.NewSession())\n\nuploader := s3manager.NewUploader(sess)\n\n_, err = uploader.Upload(upParams)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534116937, "post_id": 51813649, "comment_id": 90582109, "body": "Thank You much. I&#39;m reading a JSON file and unmarshalling to the interface. I get a slice of interfaces, then I loop through the slice and convert to map[string]interface using y: = s.Index(i).Interface().(map[string]interface{}). I think I&#39;m losing structure when I do that. Is there a better way to do it."}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "reply_to_user": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534117640, "post_id": 51813649, "comment_id": 90582220, "body": "Not sure I understood this. What exactly are you un-marshaling to and how can it be a slice of interfaces? (the input is a JSON object, so it cannot unmarshal to a slice)."}, {"owner": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534118028, "post_id": 51813649, "comment_id": 90582286, "body": "okay here is the code for reading from file <code>plan:=ioutil.ReadFile(fileName) \tvar data interface{} \terr := json.Unmarshal(plan, &amp;data) s := reflect.ValueOf(data) for i := 0; i &lt; s.Len(); i++ { y := s.Index(i).Interface().(map[string]interface{}) ...</code>  Above is the code I&#39;m using to read from file and converting to map"}, {"owner": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534118366, "post_id": 51813649, "comment_id": 90582339, "body": "Also, file has an array of JSON objects."}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "reply_to_user": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534119242, "post_id": 51813649, "comment_id": 90582466, "body": "This should work, then. But... keep in mind that the decoder (that of mapstructure <b>as well</b> as that of <code>encoding&#47;json</code>!!) will not clean up the data structure that you decode to. if you re-use the same &#39;BusinessAddRequest&#39; variable to decode into, the results might not be what you expect. Also, best not to use <code>reflect</code> unless there&#39;s no other way - e.g., if you know the input data is an array, json-decode it into <code>[]interface{}</code> or (if the array elements are maps for sure), straight into <code>[]map[string]interface{}</code>. I&#39;ll update the answer to show how to avoid using the same variable twice."}, {"owner": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "edited": false, "score": 0, "creation_date": 1534123822, "post_id": 51813649, "comment_id": 90583052, "body": "Thank You. This worked :) I think Unmarshalling to an interface{} instead of []interface{} might be the problem."}], "tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": true, "score": 7, "last_activity_date": 1534120296, "last_edit_date": 1534120296, "creation_date": 1534116112, "answer_id": 51813649, "question_id": 51813411, "link": "https://stackoverflow.com/questions/51813411/golang-mapstructure-not-working-as-expected/51813649#51813649", "title": "Golang mapstructure not working as expected", "body": "<p>It could be that you're decoding multiple times into the same <code>BusinessAddRequest</code> variable. Note this doesn't work well when you have structure elements that are slices or maps (this applies BOTH to the <code>mapstructure</code> package and to <code>encoding/json</code> as well!). Always use an empty new variable. If the repetition happens in a loop, declare the variable that you decode to in the loop body (it will be a new copy every time you run through the loop).</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"fmt\"\nimport \"github.com/mitchellh/mapstructure\"\n\n/* (your struct declaration not quoting it to save space) */\n\nfunc main() {\n    var i map[string]interface{}\n\n    config := &amp;mapstructure.DecoderConfig{\n        TagName: \"json\",\n    }\n\n    plan, _ := ioutil.ReadFile(\"zzz\")\n    var data []interface{}\n    /*err :=*/ json.Unmarshal(plan, &amp;data)\n    for j := 0; j &lt; len(data); j++ {\n        i = data[j].(map[string]interface{})\n        var x BusinessAddRequest /* declared here, so it is clean on every loop */\n        config.Result = &amp;x\n        decoder, _ := mapstructure.NewDecoder(config)\n        decoder.Decode(i)\n        fmt.Printf(\"%+v\\n\", x)\n    }\n}\n</code></pre>\n\n<p>(note I had to use a DecoderConfig with <code>TagName=\"json\"</code> to be able to use your structure definition, which is tagged with <code>\"json:\"</code> and not <code>\"mapstructure:\"</code>).</p>\n\n<p>If this doesn't help, please check your own code and try to find a minimal example similar to what I posted here that reproduces your problem and add it to the question.</p>\n"}], "owner": {"reputation": 891, "user_id": 7495321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Go0zmWTKK88/AAAAAAAAAAI/AAAAAAAAHWs/MajAsM4ECDs/photo.jpg?sz=128", "display_name": "Pramod Shashidhara", "link": "https://stackoverflow.com/users/7495321/pramod-shashidhara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5915, "favorite_count": 0, "accepted_answer_id": 51813649, "answer_count": 1, "score": 2, "last_activity_date": 1534120296, "creation_date": 1534113336, "last_edit_date": 1534116393, "question_id": 51813411, "link": "https://stackoverflow.com/questions/51813411/golang-mapstructure-not-working-as-expected", "title": "Golang mapstructure not working as expected", "body": "<p>I am trying to decode a <code>map[string]interface{}</code> to a struct, but the \"hours\" field is not getting populated. I am using <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/mapstructure</a> for decoding. This is the struct: </p>\n\n<pre><code>BusinessAddRequest struct {\n        Name       string `json:\"name\"`\n        Phone      string `json:\"phone\"`\n        Website    string `json:\"website,omitempty\"`\n        Street     string `json:\"street\"`\n        City       string `json:\"city\"`\n        PostalCode string `json:\"postalCode\"`\n        State      string `json:\"state\"`\n        Hours []struct {\n            Day                 string `json:\"day\"`\n            OpenTimeSessionOne  string `json:\"open_time_session_one,omitempty\"`\n            CloseTimeSessionOne string `json:\"close_time_session_one,omitempty\"`\n            OpenTimeSessionTwo  string `json:\"open_time_session_two,omitempty\"`\n            CloseTimeSessionTwo string `json:\"close_time_session_two,omitempty\"`\n        } `json:\"hours\"`\n        Cuisine []string `json:\"cuisine,omitempty\"`\n        BusinessID int `json:\"businessId,omitempty\"`\n        AddressID  int `json:\"addressId,omitempty\"`\n        UserID     int `json:\"userId,omitempty\"`\n}\n</code></pre>\n\n<p>And this is the example data:</p>\n\n<pre><code>{\n    \"name\": \"Agave ...\",\n    \"phone\": \"(408) 000-000\",\n    \"street\": \"Abcd\",\n    \"city\": \"San\",\n    \"postalCode\": \"90000\",\n    \"state\": \"CA\",\n    \"hours\": [\n      {\n        \"day\": \"monday\",\n        \"open_time_session_one\": \"10:00\",\n        \"close_time_session_one\": \"21:00\"\n      }\n    ],\n    \"cuisine\": [\n      \"Mexican, tacos, drinks\"\n    ],\n    \"userId\": 1\n}\n</code></pre>\n\n<p>All fields are getting populated except \"hours\".</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15290, "user_id": 1913824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7793dc1a1117c0583651f716630e2403?s=128&d=identicon&r=PG", "display_name": "Andrea Corbellini", "link": "https://stackoverflow.com/users/1913824/andrea-corbellini"}, "edited": false, "score": 3, "creation_date": 1534106422, "post_id": 51812596, "comment_id": 90580233, "body": "<code>UnmarhalJSON</code> is a method of <code>MarketList</code>. See: <a href=\"https://gobyexample.com/methods\" rel=\"nofollow noreferrer\">gobyexample.com/methods</a>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1534106760, "post_id": 51812596, "comment_id": 90580313, "body": "Also described in <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_declarations</a>; the language spec is very approachable and is pretty much required reading for Go programmers."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534136119, "post_id": 51812596, "comment_id": 90585063, "body": "Duplicate. Duplicate."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 3, "creation_date": 1534138940, "post_id": 51812596, "comment_id": 90585807, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8263546/whats-the-difference-of-functions-and-methods-in-go\">Whats the difference of functions and methods in Go?</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534171277, "post_id": 51812596, "comment_id": 90603942, "body": "This is covered in the Tour of Go: <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 0, "last_activity_date": 1534144187, "creation_date": 1534144187, "answer_id": 51816881, "question_id": 51812596, "link": "https://stackoverflow.com/questions/51812596/go-functions-with-return-values/51816881#51816881", "title": "go functions with return values", "body": "<p>This is the way how you define a pointer Type. For example:</p>\n\n<pre><code>var a string \nvar b *string // pointer to a string\nb = &amp;a\n</code></pre>\n\n<p>In your case <code>*MarketList</code> is the type pointer to a MarketList.</p>\n\n<p>At all I would recommend you to make the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour of Go</a> these things are explained there.</p>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 51816881, "answer_count": 1, "score": -5, "last_activity_date": 1534144187, "creation_date": 1534105829, "question_id": 51812596, "link": "https://stackoverflow.com/questions/51812596/go-functions-with-return-values", "title": "go functions with return values", "body": "<p>I saw this piece of code and trying to understand this line </p>\n\n<pre><code>func (ml *MarketList) UnmarshalJSON(b []byte) error \n</code></pre>\n\n<p>In the above line, I believe the function name is UnmarshallJSON that takes a byte array as input and return error as output. What does  </p>\n\n<pre><code>func (ml *MarketList)\n</code></pre>\n\n<p>I know * as a dereferenced operator but don't understand what is the context here. If someone can explain that would be great.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar jsonBytes = []byte(`\n  {\"MS\": {\n     \"last\":\"25\",\n  \"highestBid\":\"20\"},\n  \"GE\": {\n      \"last\": \"24\",\n      \"highestBid\": \"22\"}\n  }`)\n\ntype Market struct {\n    MarketName string\n    Last       string\n    HighestBid string\n}\n\ntype MarketList []Market\n\nfunc (ml *MarketList) UnmarshalJSON(b []byte) error {\n    tmp := map[string]Market{}\n    err := json.Unmarshal(b, &amp;tmp)\n    if err != nil {\n        return err\n    }\n\n    var l MarketList\n    for k, v := range tmp {\n        v.MarketName = k\n        l = append(l, v)\n    }\n\n    *ml = l\n    return nil\n}\n\nfunc main() {\n    ml := MarketList{}\n    // Unmarshal directly into a []Market alias\n    _ = json.Unmarshal(jsonBytes, &amp;ml)\n\n    fmt.Printf(\"%+v\\n\", ml)\n}\n</code></pre>\n"}, {"tags": ["go", "go-interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1534101527, "post_id": 51811693, "comment_id": 90579081, "body": "Go offers no inheritance bases object orientation and trying to simulate it is doomed to fail. Don&#39;t try, you&#39;ll hurt yourself."}, {"owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1534102149, "post_id": 51811693, "comment_id": 90579228, "body": "@Volker May I know the idiomatic way to implement this in Go?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534136275, "post_id": 51811693, "comment_id": 90585098, "body": "Well, you redesign. You pack common functionality into an interface. You use normal functions."}, {"owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1534161699, "post_id": 51811693, "comment_id": 90597581, "body": "After reading this <a href=\"http://spf13.com/post/is-go-object-oriented/\" rel=\"nofollow noreferrer\">spf13.com/post/is-go-object-oriented</a>, it seems that inheritance is the only thing that needs to be avoided."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "edited": false, "score": 0, "creation_date": 1534103351, "post_id": 51811930, "comment_id": 90579493, "body": "I would really like to keep the <code>CatToy</code> and <code>DogToy</code> interfaces, because I&#39;m planning to extract <code>Cat</code> and <code>Dog</code> to separate packages/projects. Is there another alternative?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "edited": false, "score": 2, "creation_date": 1534105164, "post_id": 51811930, "comment_id": 90579941, "body": "I&#39;m afraid not, as Volker mentioned in his comment, Go does not support inheritance and what you are trying to do it clearly translating your object-oriented habits into Go code."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 3, "last_activity_date": 1534128920, "last_edit_date": 1534128920, "creation_date": 1534100348, "answer_id": 51811930, "question_id": 51811693, "link": "https://stackoverflow.com/questions/51811693/does-not-implement-wrong-type-for-method/51811930#51811930", "title": "Does not implement, wrong type for method", "body": "<p>I get what you are trying to do, but it's impossible: your <code>Cat</code> and <code>Dog</code> types do not implement the <code>Pet</code> interface, as their <code>Play</code> methods take different types, so you won't be able to just call <code>Play</code> on them with your <code>SuperToy</code>.</p>\n\n<p>To fix this, you would need to create a <code>Toy</code> interface that has both the <code>Roll</code> and the <code>Rattle</code> methods, and make <code>Pet.Play</code>, <code>Cat.Play</code> and <code>Dog.Play</code> take this interface as an argument.</p>\n\n<pre><code>package main\n\ntype Cat struct {\n}\n\nfunc (cat *Cat) Play(catToy Toy) {\n    println(\"The cat is playing!\", catToy.Rattle())\n}\n\ntype Dog struct {\n}\n\nfunc (dog *Dog) Play(dogToy Toy) {\n    println(\"The dog is playing!\", dogToy.Roll())\n}\n\ntype Toy interface {\n    Roll() string\n    Rattle() string\n}\n\ntype SuperToy struct {\n}\n\nfunc (toy *SuperToy) Rattle() string {\n    return \"Rattle!!!\"\n}\n\nfunc (toy *SuperToy) Roll() string {\n    return \"Rolling...\"\n}\n\ntype Pet interface {\n    Play(toy Toy)\n}\n\nfunc main() {\n    cat := &amp;Cat{}\n    dog := &amp;Dog{}\n    superToy := &amp;SuperToy{}\n\n    // Working\n    cat.Play(superToy)\n    dog.Play(superToy)\n\n    // Not Working\n    pets := []Pet{cat, dog}\n    for _, pet := range pets {\n        pet.Play(superToy)\n    }\n}\n</code></pre>\n\n<p>Gives the output</p>\n\n<pre><code>The cat is playing! Rattle!!!\nThe dog is playing! Rolling...\nThe cat is playing! Rattle!!!\nThe dog is playing! Rolling...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "edited": false, "score": 0, "creation_date": 1534112816, "post_id": 51812567, "comment_id": 90581509, "body": "Thanks for the alternative solution! However, <code>type checking</code> is commonly a code smell so I want to avoid using it."}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 0, "last_activity_date": 1534105615, "creation_date": 1534105615, "answer_id": 51812567, "question_id": 51811693, "link": "https://stackoverflow.com/questions/51811693/does-not-implement-wrong-type-for-method/51812567#51812567", "title": "Does not implement, wrong type for method", "body": "<p>You could get the Play methods to take an <code>interface{}</code> and then do a type assertion inside the method:</p>\n\n<pre><code>func (dog *Dog) Play(toy interface{}) {\n    dogToy, isDogToy := toy.(DogToy)\n    if !isDogToy {\n        println(\"The dog does not know what to do with this toy!\")\n        return\n    }\n    println(\"The dog is playing!\", dogToy.Roll())\n}\n</code></pre>\n\n<p>Full executable example on Go Playground:</p>\n\n<p><a href=\"https://play.golang.org/p/LZZ-HqpzR-Z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LZZ-HqpzR-Z</a></p>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "is_accepted": false, "score": 0, "last_activity_date": 1534159359, "last_edit_date": 1534159359, "creation_date": 1534112378, "answer_id": 51813312, "question_id": 51811693, "link": "https://stackoverflow.com/questions/51811693/does-not-implement-wrong-type-for-method/51813312#51813312", "title": "Does not implement, wrong type for method", "body": "<p>Here's another working solution:</p>\n\n<pre><code>package main\n\ntype CatToy interface {\n    Rattle() string\n}\n\ntype Cat struct {\n    Toy CatToy\n}\n\nfunc (cat *Cat) Play() {\n    println(\"The cat is playing!\", cat.Toy.Rattle())\n}\n\ntype DogToy interface {\n    Roll() string\n}\n\ntype Dog struct {\n    Toy DogToy\n}\n\nfunc (dog *Dog) Play() {\n    println(\"The dog is playing!\", dog.Toy.Roll())\n}\n\ntype SuperToy struct {\n}\n\nfunc (toy *SuperToy) Rattle() string {\n    return \"Rattle!!!\"\n}\n\nfunc (toy *SuperToy) Roll() string {\n    return \"Rolling...\"\n}\n\ntype Pet interface {\n    Play()\n}\n\nfunc main() {\n    superToy := &amp;SuperToy{}\n    cat := &amp;Cat{superToy}\n    dog := &amp;Dog{superToy}\n\n    // Working\n    cat.Play()\n    dog.Play()\n\n    // Working also\n    pets := []Pet{cat, dog}\n    for _, pet := range pets {\n        pet.Play()\n    }\n}\n</code></pre>\n\n<p>This solution keeps the <code>Cat + CatToy</code> and <code>Dog + DogToy</code> independent from the <code>main + SuperToy</code>. This allows extraction to separate packages.</p>\n\n<p>However, I do somewhat agree with @Volker and @Ullaakut. This solution seems not idiomatic for Go. I'm still not sure about the proper solution.</p>\n"}], "owner": {"reputation": 141, "user_id": 3907500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9eb736499dbd0fc0290bbb1b982a398?s=128&d=identicon&r=PG&f=1", "display_name": "Abakada", "link": "https://stackoverflow.com/users/3907500/abakada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3632, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1534159359, "creation_date": 1534098644, "last_edit_date": 1534118756, "question_id": 51811693, "link": "https://stackoverflow.com/questions/51811693/does-not-implement-wrong-type-for-method", "title": "Does not implement, wrong type for method", "body": "<p>Given the following Go code:</p>\n\n<pre><code>package main\n\ntype CatToy interface {\n    Rattle() string\n}\n\ntype Cat struct {\n}\n\nfunc (cat *Cat) Play(catToy CatToy) {\n    println(\"The cat is playing!\", catToy.Rattle())\n}\n\ntype DogToy interface {\n    Roll() string\n}\n\ntype Dog struct {\n}\n\nfunc (dog *Dog) Play(dogToy DogToy) {\n    println(\"The dog is playing!\", dogToy.Roll())\n}\n\ntype SuperToy struct {\n}\n\nfunc (toy *SuperToy) Rattle() string {\n    return \"Rattle!!!\"\n}\n\nfunc (toy *SuperToy) Roll() string {\n    return \"Rolling...\"\n}\n\ntype Pet interface {\n    Play(toy interface{})\n}\n\nfunc main() {\n    cat := &amp;Cat{}\n    dog := &amp;Dog{}\n    superToy := &amp;SuperToy{}\n\n    // Working\n    cat.Play(superToy)\n    dog.Play(superToy)\n\n    // Not Working\n    pets := []Pet{cat, dog}\n    for _, pet := range pets {\n        pet.Play(superToy)\n    }\n}\n</code></pre>\n\n<p>I am getting these errors:</p>\n\n<pre><code># command-line-arguments\n./main.go:65:16: cannot use cat (type *Cat) as type Pet in array or slice literal:\n    *Cat does not implement Pet (wrong type for Play method)\n        have Play(CatToy)\n        want Play(interface {})\n./main.go:65:21: cannot use dog (type *Dog) as type Pet in array or slice literal:\n    *Dog does not implement Pet (wrong type for Play method)\n        have Play(DogToy)\n        want Play(interface {})\n</code></pre>\n\n<p>The <code>SuperToy</code> implements both <code>CatToy</code> and <code>DogToy</code>. However, when I create an interface <code>Pet</code> with interface as an argument, I get an error. May I know how I'll be able to get an array/slice with a cat and dog inside? I want to iterate through this slice and call a function for each one. I also want to keep the <code>CatToy</code> and <code>DogToy</code> interfaces. I'm also ok with removing the <code>Pet</code> interface.</p>\n\n<p>More info:\nIn the future, it's more likely that I'll add more <code>pets</code>. I don't think that I'll add more actions such as <code>Play</code>.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6282278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cca3fc20301ecad3d5f93ba9f29331a?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Baker", "link": "https://stackoverflow.com/users/6282278/ian-baker"}, "edited": false, "score": 0, "creation_date": 1534099886, "post_id": 51811750, "comment_id": 90578694, "body": "I am using operators as a global variable, so I cannot declare the variable that way."}, {"owner": {"reputation": 484, "user_id": 5826540, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0ea9d7911377881cf7a69ce177143cd9?s=128&d=identicon&r=PG&f=1", "display_name": "nagrom97", "link": "https://stackoverflow.com/users/5826540/nagrom97"}, "reply_to_user": {"reputation": 23, "user_id": 6282278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cca3fc20301ecad3d5f93ba9f29331a?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Baker", "link": "https://stackoverflow.com/users/6282278/ian-baker"}, "edited": false, "score": 0, "creation_date": 1534100180, "post_id": 51811750, "comment_id": 90578764, "body": "Sorry, in my haste I didn&#39;t notice as I just tried to provide a quick example, but the type conversion still stands"}], "tags": [], "owner": {"reputation": 484, "user_id": 5826540, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0ea9d7911377881cf7a69ce177143cd9?s=128&d=identicon&r=PG&f=1", "display_name": "nagrom97", "link": "https://stackoverflow.com/users/5826540/nagrom97"}, "is_accepted": false, "score": 1, "last_activity_date": 1534100151, "last_edit_date": 1534100151, "creation_date": 1534098972, "answer_id": 51811750, "question_id": 51811686, "link": "https://stackoverflow.com/questions/51811686/go-cannot-create-global-byte-slice-from-string/51811750#51811750", "title": "Go cannot create global byte slice from string", "body": "<p>Try doing something like this instead</p>\n\n<pre><code>var operators = []byte(\"Hello World\")\n</code></pre>\n\n<p>In your code you are trying to literally put a string inside of a byte array as a member, you cannot do that. The error helps you out a bit here by saying it can't use your string as type byte (because it isn't a byte, it is a string).</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1534099909, "creation_date": 1534099909, "answer_id": 51811878, "question_id": 51811686, "link": "https://stackoverflow.com/questions/51811686/go-cannot-create-global-byte-slice-from-string/51811878#51811878", "title": "Go cannot create global byte slice from string", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a> to convert a string to a slice of bytes. Note the use of <code>()</code> instead of <code>{}</code>.</p>\n\n<pre><code> var operators = []byte(\"+-*/%\")\n</code></pre>\n\n<p>The code in the question is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>.  </p>\n"}], "owner": {"reputation": 23, "user_id": 6282278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cca3fc20301ecad3d5f93ba9f29331a?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Baker", "link": "https://stackoverflow.com/users/6282278/ian-baker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "accepted_answer_id": 51811878, "answer_count": 2, "score": -2, "last_activity_date": 1534100151, "creation_date": 1534098595, "question_id": 51811686, "link": "https://stackoverflow.com/questions/51811686/go-cannot-create-global-byte-slice-from-string", "title": "Go cannot create global byte slice from string", "body": "<p>I am trying to make a global byte array from a string with: </p>\n\n<pre><code>var operators = []byte {\"+-*/%\"}\n</code></pre>\n\n<p>however, I am getting the error </p>\n\n<pre><code>cannot use string(\"+-*/\") (type untyped string) as type byte in array or slice literal\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4778178"}, "edited": false, "score": 0, "creation_date": 1534087006, "post_id": 51810067, "comment_id": 90575154, "body": "This is the solution I was looking for, I&#39;ve been trying to figure this out for hours. Thank you!"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534087960, "last_edit_date": 1534087960, "creation_date": 1534086370, "answer_id": 51810067, "question_id": 51809934, "link": "https://stackoverflow.com/questions/51809934/building-a-golang-struct-to-store-data-from-parsed-json-file/51810067#51810067", "title": "Building a golang struct to store data from parsed JSON file", "body": "<p>Go for <code>map[string]interface{}</code> to store the nodes data. For unknown json data with dynamic keys Interfaces are best which will help you to store any type of data.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype MyJsonName struct {\n    LatestHeight int `json:\"latest_height\"`\n    Timestamp    int `json:\"timestamp\"`\n    TotalNodes   int `json:\"total_nodes\"`\n    Nodes  map[string]interface{}\n}\n\nvar byteValue string = `{\n  \"timestamp\": 1533397325,\n  \"total_nodes\": 9522,\n  \"latest_height\": 535196,\n  \"nodes\": {\n    \"220.75.229.130:3927\": [\n      70015,\n      \"/Satoshi:0.13.2/\",\n      1530858117,\n      13,\n      165277,\n      \"220.75.229.130\",\n      \"Seoul\",\n      \"KR\",\n      37.5985,\n      126.9783,\n      \"Asia/Seoul\",\n      \"AS4766\",\n      \"Korea Telecom\"\n    ],\n    \"192.162.102.68:8333\": [\n      70015,\n      \"/Satoshi:0.15.1/\",\n      1533061934,\n      13,\n      535196,\n      \"192.162.102.68\",\n      null,\n      \"RU\",\n      55.7386,\n      37.6068,\n      null,\n      \"AS50113\",\n      \"MediaServicePlus LLC\"\n    ]\n  }\n}`\n\nfunc main() {\n    var MyJSONANE MyJsonName\n    err := json.Unmarshal([]byte(byteValue), &amp;MyJSONANE)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Printf(\"%+v\",MyJSONANE)\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/xLUlT5c4SK7\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p>To fetch the underlying value from the <code>interface{}</code>, you require type assertion for each type. You can go for switch to get the value from interface recursively.</p>\n\n<pre><code>func fetchValue(value interface{}) {\n    switch value.(type) {\n    case string:\n        fmt.Printf(\"%v is an string \\n \", value.(string))\n    case bool:\n        fmt.Printf(\"%v is bool \\n \", value.(bool))\n    case float64:\n        fmt.Printf(\"%v is float64 \\n \", value.(float64))\n    case []interface{}:\n        fmt.Printf(\"%v is a slice of interface \\n \", value)\n        for _, v := range value.([]interface{}) {\n            fetchValue(v)\n        }\n    case map[string]interface{}:\n        fmt.Printf(\"%v is a map \\n \", value)\n        for _, v := range value.(map[string]interface{}) {\n            fetchValue(v)\n        }\n    default:\n        fmt.Printf(\"%v is unknown \\n \", value)\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4778178"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 888, "favorite_count": 0, "accepted_answer_id": 51810067, "answer_count": 1, "score": 1, "last_activity_date": 1534087960, "creation_date": 1534085434, "last_edit_date": 1534087252, "question_id": 51809934, "link": "https://stackoverflow.com/questions/51809934/building-a-golang-struct-to-store-data-from-parsed-json-file", "title": "Building a golang struct to store data from parsed JSON file", "body": "<p>I'm trying to load a rather large JSON file that has x amount of JSON arrays. The issue I'm having is the fact that the each node in the data below has a unique name, so I'm not sure how to build the struct to store them.</p>\n\n<p>Here is snippet of the data from the JSON file (This file can have many more nodes that just two below)</p>\n\n<pre><code>       {\n            \"timestamp\": 1533397325,\n            \"total_nodes\": 9522,\n            \"latest_height\": 535196,\n            \"nodes\": {\n                \"220.75.229.130:3927\": [\n                    70015,\n                    \"/Satoshi:0.13.2/\",\n                    1530858117,\n                    13,\n                    165277,\n                    \"220.75.229.130\",\n                    \"Seoul\",\n                    \"KR\",\n                    37.5985,\n                    126.9783,\n                    \"Asia/Seoul\",\n                    \"AS4766\",\n                    \"Korea Telecom\"\n                ],\n                \"192.162.102.68:8333\": [\n                    70015,\n                    \"/Satoshi:0.15.1/\",\n                    1533061934,\n                    13,\n                    535196,\n                    \"192.162.102.68\",\n                    null,\n                    \"RU\",\n                    55.7386,\n                    37.6068,\n                    null,\n                    \"AS50113\",\n                    \"MediaServicePlus LLC\"\n                ]        \n          }\n}\n</code></pre>\n\n<p>So far, this is my code, and JSON objects in Go:</p>\n\n<pre><code>type MyJsonName struct {\n    LatestHeight int `json:\"latest_height\"`\n    Timestamp    int `json:\"timestamp\"`\n    TotalNodes   int `json:\"total_nodes\"`\n    Nodes        struct {\n        Data string\n    } `json:\"nodes\"`\n}\n\nfunc main() {\n    jsonFile, err := os.Open(\"someFile\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    byteValue, _ := ioutil.ReadAll(jsonFile)\n    var MyJSONANE MyJsonName\n    err = json.Unmarshal(byteValue, &amp;MyJSONANE)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(MyJSONANE)\n}\n</code></pre>\n\n<p>This code works great, my issue is the fact that Data in nodes in never populated with the JSON arrays and their contents. </p>\n\n<p>This is the output: <code>{535196 1533397325 9522 {}}</code></p>\n\n<p>Any help adjusting my struct to read in the JSON arrays will be greatly appreciated. I would just like to draw emphasis to the names of the JSON arrays in nodes being unique, and there can be <code>total_nodes</code> amount of them.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1534076461, "post_id": 51808730, "comment_id": 90572573, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26866879/initialize-nested-struct-definition-in-golang\">Initialize nested struct definition in Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 14, "last_activity_date": 1534078383, "last_edit_date": 1534078383, "creation_date": 1534076244, "answer_id": 51808746, "question_id": 51808730, "link": "https://stackoverflow.com/questions/51808730/adding-anonymous-struct-element-to-slice/51808746#51808746", "title": "Adding anonymous struct element to slice", "body": "<p>Since you're using an anonymous struct, you have to again use an anonymous struct, with identical declaration, in the append statement:</p>\n\n<pre><code>data = append(data, struct{a string, b string}{a: \"foo\", b: \"bar\"})\n</code></pre>\n\n<p>Much easier would be to use a named type:</p>\n\n<pre><code>type myStruct struct {\n    a string\n    b string\n}\n\ndata := []myStruct{}\n\ndata = append(data, myStruct{a: \"foo\", b: \"bar\"})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 371, "user_id": 1235411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54fcb839c0fbe45cb4f9837359b97028?s=128&d=identicon&r=PG", "display_name": "Alexus1024", "link": "https://stackoverflow.com/users/1235411/alexus1024"}, "is_accepted": false, "score": 0, "last_activity_date": 1599931210, "creation_date": 1599931210, "answer_id": 63862958, "question_id": 51808730, "link": "https://stackoverflow.com/questions/51808730/adding-anonymous-struct-element-to-slice/63862958#63862958", "title": "Adding anonymous struct element to slice", "body": "<p>Actually, I found a way to add elements to array without repeated type declaration.\nBut it is dirty.</p>\n<pre><code>    slice := []struct {\n        v, p string\n    }{{}} // here we init first element to copy it later\n\n    el := slice[0]\n\n    el2 := el   // here we copy this element\n    el2.p = &quot;1&quot; // and fill it with data\n    el2.v = &quot;2&quot;\n\n    // repeat - copy el as match as you want\n\n    slice = append(slice[1:], el2 /* el3, el4 ...*/) // skip first, fake, element and add actual\n</code></pre>\n<p>Slice of pointers to struct is more conventional. At that case coping will slightly differ</p>\n<pre><code>    slice := []*struct { ... }{{}}\n    el := slice[0]\n    el2 := *el\n</code></pre>\n<p>All this is far from any good practices. Use carefully.</p>\n"}], "owner": {"reputation": 101, "user_id": 4396613, "user_type": "registered", "profile_image": "https://graph.facebook.com/734451955/picture?type=large", "display_name": "Yuri Dosovitsky", "link": "https://stackoverflow.com/users/4396613/yuri-dosovitsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2796, "favorite_count": 2, "accepted_answer_id": 51808746, "answer_count": 2, "score": 6, "last_activity_date": 1599931210, "creation_date": 1534076069, "last_edit_date": 1534102281, "question_id": 51808730, "link": "https://stackoverflow.com/questions/51808730/adding-anonymous-struct-element-to-slice", "title": "Adding anonymous struct element to slice", "body": "<p>let's say I have a slice of anonymous structs</p>\n\n<pre><code>data := []struct{a string, b string}{}\n</code></pre>\n\n<p>Now, I would like to append a new item to this slice. </p>\n\n<pre><code>data = append(data, ???)\n</code></pre>\n\n<p>How do I do that? Any ideas? </p>\n"}, {"tags": ["go", "interface", "contains"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10214899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489a3884773a9134fc285c468fd36709?s=128&d=identicon&r=PG&f=1", "display_name": "ndhd", "link": "https://stackoverflow.com/users/10214899/ndhd"}, "edited": false, "score": 0, "creation_date": 1534099650, "post_id": 51808071, "comment_id": 90578636, "body": "Invalid type assertion (non-interface type map[string]interface {} on left), how is this possible?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1, "user_id": 10214899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489a3884773a9134fc285c468fd36709?s=128&d=identicon&r=PG&f=1", "display_name": "ndhd", "link": "https://stackoverflow.com/users/10214899/ndhd"}, "edited": false, "score": 0, "creation_date": 1534100904, "post_id": 51808071, "comment_id": 90578938, "body": "Apparently you are doing an invalid type assertion. You can only do <code>.(type)</code> on an <code>interface{}</code> and you are apparently trying to do it on a <code>map[string]interface{}</code>"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1, "user_id": 10214899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489a3884773a9134fc285c468fd36709?s=128&d=identicon&r=PG&f=1", "display_name": "ndhd", "link": "https://stackoverflow.com/users/10214899/ndhd"}, "edited": false, "score": 0, "creation_date": 1534101029, "post_id": 51808071, "comment_id": 90578973, "body": "If that&#39;s the case, you should do <code>interf, ok := mapInterface[key]</code> followed by <code>value, ok := interf.(string)</code> if the value you want to get from the <code>interface{}</code> is a string. If it can contain multiple values, you can do a switch on the interface type: <code>switch interf.(type)</code>"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1, "user_id": 10214899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489a3884773a9134fc285c468fd36709?s=128&d=identicon&r=PG&f=1", "display_name": "ndhd", "link": "https://stackoverflow.com/users/10214899/ndhd"}, "edited": false, "score": 0, "creation_date": 1534101036, "post_id": 51808071, "comment_id": 90578975, "body": "Let me know if that helps!"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 2, "last_activity_date": 1534074002, "last_edit_date": 1534074002, "creation_date": 1534070717, "answer_id": 51808071, "question_id": 51807857, "link": "https://stackoverflow.com/questions/51807857/how-to-use-strings-contains-on-an-interface/51808071#51808071", "title": "How to use strings.Contains on an interface", "body": "<p>Here your type assertion is wrong, you are trying to access a value from a key on your interface, which hasn't been accessed as a map, so this can't work as the <code>interface{}</code> isn't indexible.</p>\n\n<p>What you have to do instead is to cast your whole interface to a <code>map[string]string</code> like such</p>\n\n<pre><code>stringMap, ok := interfaceArg.(map[string]string)\nif !ok {\n    return errors.New(\"cast failed\")\n}\n\nif strings.Contains(stringMap[\"figure1\"], \"one\") {\n    // your code here\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10214899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489a3884773a9134fc285c468fd36709?s=128&d=identicon&r=PG&f=1", "display_name": "ndhd", "link": "https://stackoverflow.com/users/10214899/ndhd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 51808071, "answer_count": 1, "score": -2, "last_activity_date": 1534074002, "creation_date": 1534068911, "last_edit_date": 1534073981, "question_id": 51807857, "link": "https://stackoverflow.com/questions/51807857/how-to-use-strings-contains-on-an-interface", "title": "How to use strings.Contains on an interface", "body": "<p>I am receiving a panic on the following line of code. <code>interface conversion: interface {} is []string, not string</code></p>\n\n<p>My interface is a map of strings. What is the best method to find whether the figure interface contains a specific string.</p>\n\n<pre><code>if strings.Contains(figure[\"figure1\"].(string), \"one\"){\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "arm", "drone"], "comments": [{"owner": {"reputation": 1085, "user_id": 3169138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wSAPm.jpg?s=128&g=1", "display_name": "byrnedo", "link": "https://stackoverflow.com/users/3169138/byrnedo"}, "edited": false, "score": 2, "creation_date": 1534071597, "post_id": 51807676, "comment_id": 90571384, "body": "So the go binary is arm7 but I&#39;m assuming that the docker image was built on amd64 arch? AFAIK that isn&#39;t going to work, instead you need an arm base docker image (like <a href=\"https://hub.docker.com/r/janeczku/armhf-drone/\" rel=\"nofollow noreferrer\">hub.docker.com/r/janeczku/armhf-drone</a>) and you&#39;ll need to build the custom image on arm too."}, {"owner": {"reputation": 2383, "user_id": 160454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c58a0be77ee441bb8f8595b7f1b4e87?s=128&d=identicon&r=PG", "display_name": "Brad Rydzewski", "link": "https://stackoverflow.com/users/160454/brad-rydzewski"}, "edited": false, "score": 0, "creation_date": 1534143547, "post_id": 51807676, "comment_id": 90587621, "body": "I notice the op is using <code>GOARM=7</code> but what is the GOOS and GOARCH? You must compile the code on a linux arm64 machine. The server cannot be cross-compiled. FWIW the docker image is built FROM scratch, with only ca-cert files, and will work with any architecture."}], "owner": {"reputation": 1440, "user_id": 7973906, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/54a6d0e27146b174dd6a6c3cb5e54392?s=128&d=identicon&r=PG&f=1", "display_name": "j3141592653589793238", "link": "https://stackoverflow.com/users/7973906/j3141592653589793238"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 310, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534067480, "creation_date": 1534067480, "question_id": 51807676, "link": "https://stackoverflow.com/questions/51807676/how-to-build-drone-image-for-armv7", "title": "How to build drone image for ARMv7?", "body": "<p>First, I downloaded the drone image: </p>\n\n<pre><code>go get github.com/drone/drone/cmd/...\n</code></pre>\n\n<p>Second, I built the image for arm: </p>\n\n<pre><code>GOARM=7 go build -o release/drone-server github.com/drone/drone/cmd/drone-server\n</code></pre>\n\n<p>After that, I built the image for docker: </p>\n\n<pre><code>docker -f ./go-workspace/src/github.com/drone/drone/Dockerfile build -t drone/drone .\n</code></pre>\n\n<p>The docker file looks like so: </p>\n\n<pre><code># docker build --rm -t drone/drone .\n\nFROM drone/ca-certs\nEXPOSE 8000 9000 80 443\n\nENV DATABASE_DRIVER=sqlite3\nENV DATABASE_CONFIG=/var/lib/drone/drone.sqlite\nENV GODEBUG=netdns=go\nENV XDG_CACHE_HOME /var/lib/drone\n\nADD release/drone-server /bin/\n\nENTRYPOINT [\"/bin/drone-server\"]\n</code></pre>\n\n<p>That's my docker-compose.yml: </p>\n\n<pre><code>version: '2'\n\nservices: \n    drone-server: \n        image: drone/drone:latest\n        ports: \n            - 8000:8000\n            - 9000:9000\n        volumes: \n            - /var/lib/drone:/var/lib/drone\n        restart: always\n        env_file: \n            - /etc/drone/server.env\n\n    drone-agent: \n        image: drone/agent:linux-arm\n        command: agent\n        depends_on: \n            - drone-server\n        volumes: \n            - /var/run/docker.sock:/var/run/docker.sock\n        restart: always\n        env_file: \n            - /etc/drone/agent.env\n</code></pre>\n\n<p>The agent.env file: </p>\n\n<pre><code>DRONE_SECRET=xxx\nDRONE_SERVER=[server-hostname]:9000\nDOCKER_ARCH=arm\n</code></pre>\n\n<p>The server.env file: </p>\n\n<pre><code># Service settings\nDRONE_SECRET=xxx \nDRONE_HOST=https://[server-hostname]/drone\nDRONE_OPEN=false\n\nDRONE_GOGS=true\nDRONE_GOGS_URL=https://[server-hostname]/git\nDRONE_GOGS_PRIVATE_MODE=true\n</code></pre>\n\n<p>However, when running <code>docker-compose -f /etc/drone/docker-compose.yml up</code>, I get the following error: </p>\n\n<pre><code>drone-server_1  | standard_init_linux.go:190: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>And the drone-server exits with code 1.</p>\n\n<p>I configured Apache to reach drone trough a proxy as described here: <a href=\"http://readme.drone.io/0.5/install/setup/apache/\" rel=\"nofollow noreferrer\">http://readme.drone.io/0.5/install/setup/apache/</a></p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 8, "last_activity_date": 1534153097, "creation_date": 1534153097, "answer_id": 51819373, "question_id": 51807078, "link": "https://stackoverflow.com/questions/51807078/grpc-server-failed-to-encode-response-rpc-error-code-internal-desc-grpc/51819373#51819373", "title": "grpc: server failed to encode response: rpc error: code = Internal desc = grpc: error while marshaling: proto: Marshal called with nil", "body": "<p>The error is probably not caused by the marshallers in this code block</p>\n\n<p>When you do <code>var empty *pb.Empty</code> you are creating an uninitialised variable <code>*pb.Empty</code> which is <code>nil</code>. It's very likely that something upstream that tries to marshal this <code>empty</code> is causing the error.</p>\n\n<p>Runnable example here:\n<a href=\"https://play.golang.org/p/QsNCWXM615Q\" rel=\"noreferrer\">https://play.golang.org/p/QsNCWXM615Q</a></p>\n\n<p>If you want to initialise empty, then you should do <code>return new(pb.Empty), nil</code></p>\n"}], "owner": {"reputation": 839, "user_id": 1707888, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ece56039559956ffaa0c67698c0598cf?s=128&d=identicon&r=PG", "display_name": "Jaipradeesh", "link": "https://stackoverflow.com/users/1707888/jaipradeesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6784, "favorite_count": 1, "accepted_answer_id": 51819373, "answer_count": 1, "score": 3, "last_activity_date": 1534153097, "creation_date": 1534062369, "last_edit_date": 1534077616, "question_id": 51807078, "link": "https://stackoverflow.com/questions/51807078/grpc-server-failed-to-encode-response-rpc-error-code-internal-desc-grpc", "title": "grpc: server failed to encode response: rpc error: code = Internal desc = grpc: error while marshaling: proto: Marshal called with nil", "body": "<p>The following RPC should ideally receive a message and marshal to JSON. But, the following error is encountered: <code>ERROR: 2018/08/12 13:43:07 grpc: server failed to encode response:  rpc error: code = Internal desc = grpc: error while marshaling: proto: Marshal called with nil</code></p>\n\n<pre><code>func (s *beaconServer) Transmit(ctx context.Context, batch *pb.Batch) (*pb.Empty, error) {\n    var empty *pb.Empty\n\n    var messageJSON bytes.Buffer\n    marshaler := &amp;jsonpb.Marshaler{\n        OrigName: true,\n    }\n    err := marshaler.Marshal(&amp;messageJSON, batch)\n    if err != nil {\n        return empty, err\n    }\n\n    log.Println(string(messageJSON.Bytes()))\n    return empty, nil\n}\n</code></pre>\n\n<p>.. returns</p>\n\n<pre><code>2018/08/12 14:24:09 beacon.go:34: {\"stream_id\":\"abc11\",\"event_type\":\"e\",\"events\":[{\"file_path\":\"/tmp/python.py\",\"location\":\"256\",\"count\":\"30\"},{\"file_path\":\"/tmp/temp.py\",\"location\":\"253\",\"count\":\"305\"}],\"start_time\":\"2038-01-19 03:14:07\",\"end_time\":\"2038-01-19 03:14:27\"}\nERROR: 2018/08/12 14:24:09 grpc: server failed to encode response:  rpc error: code = Internal desc = grpc: error while marshaling: proto: Marshal called with nil\n</code></pre>\n"}, {"tags": ["go", "channel", "fifo", "lifo"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1534078959, "post_id": 51806826, "comment_id": 90573233, "body": "Note that the two goroutines could execute in either order: there&#39;s no particular reason to expect that 10 will be sent first."}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7415288, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YuSYGCmX1uQ/AAAAAAAAAAI/AAAAAAAAAHw/R-tlnuQVc0Q/photo.jpg?sz=128", "display_name": "Marat Mkhitaryan", "link": "https://stackoverflow.com/users/7415288/marat-mkhitaryan"}, "edited": false, "score": 0, "creation_date": 1576259663, "post_id": 51806915, "comment_id": 104854509, "body": "Why do you need ok? Something wrong could happen to chan?"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 6, "last_activity_date": 1534079237, "last_edit_date": 1534079237, "creation_date": 1534060886, "answer_id": 51806915, "question_id": 51806826, "link": "https://stackoverflow.com/questions/51806826/are-golang-channels-based-on-lifo/51806915#51806915", "title": "Are golang channels based on LIFO?", "body": "<p>Golang channels are not LIFO. </p>\n\n<blockquote>\n  <p>Channels act as first-in-first-out queues. For example, if one\n  goroutine sends values on a channel and a second goroutine receives\n  them, the values are received in the order sent.</p>\n</blockquote>\n\n<p>Values sent on the channel will be received whenever the receiver of the channel is ready. And if not then it will block. For managing that you can go for buffered channels.</p>\n\n<p>Below code will check if the values are available to be received from the channel.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc multiply(c chan int, num int) {\n    c &lt;- num * 10\n}\n\nfunc main() {\n    c := make(chan int, 3)\n\n    go multiply(c, 1)\n    go multiply(c, 2)\n    go multiply(c, 3)\n\n    for i:=0;i&lt;3;i++{\n         foo, ok := &lt;- c\n         if !ok {\n                fmt.Println(\"done\")\n                return\n         }\n         fmt.Println(foo)\n    }\n\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/89K3sVSlue3\" rel=\"noreferrer\">Go playground</a></p>\n\n<p><strong>Buffered Channels</strong></p>\n\n<p>Channels can be buffered. Provide the buffer length as the second argument to make to initialize a buffered channel: </p>\n\n<pre><code>make(chan int, 100)\n</code></pre>\n\n<blockquote>\n  <p>The capacity, in number of elements, sets the size of the buffer in\n  the channel. If the capacity is zero or absent, the channel is\n  unbuffered and communication succeeds only when both a sender and\n  receiver are ready. Otherwise, the channel is buffered and\n  communication succeeds without blocking if the buffer is not full\n  (sends) or not empty (receives). A nil channel is never ready for\n  communication.</p>\n</blockquote>\n\n<p>In your case, it depends on which go routine will send the value on the channel first. The values that you are printing completely depends on the go routines.</p>\n\n<p>For more information go through <a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"noreferrer\">Golang Channels</a></p>\n"}], "owner": {"reputation": 181, "user_id": 5556365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4660fb9830aab225da5fa7d39147aae9?s=128&d=identicon&r=PG&f=1", "display_name": "Amid", "link": "https://stackoverflow.com/users/5556365/amid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 0, "closed_date": 1534102280, "accepted_answer_id": 51806915, "answer_count": 1, "score": 0, "last_activity_date": 1534079237, "creation_date": 1534060166, "last_edit_date": 1534062554, "question_id": 51806826, "link": "https://stackoverflow.com/questions/51806826/are-golang-channels-based-on-lifo", "closed_reason": "Duplicate", "title": "Are golang channels based on LIFO?", "body": "<p>I was wondering regarding the order of elements in golang channels. After running a few examples, it seems that the order in which the elements come off the channel is \"last in first out\". Am I right?</p>\n\n<p>The following snippet is the example which I used. After running the code, the output is 20 10, while 10 was sent to the channel first and 20 last.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc multiply(c chan int, num int) {\n    c &lt;- num * 10\n}\n\nfunc main() {\n    c := make(chan int)\n\n    go multiply(c, 1)\n    go multiply(c, 2)\n\n    v1 := &lt;-c\n    v2 := &lt;-c\n    fmt.Println(v1, v2)\n}\n</code></pre>\n"}, {"tags": ["java", "go"], "comments": [{"owner": {"reputation": 80989, "user_id": 466862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=128&d=identicon&r=PG", "display_name": "Mark Rotteveel", "link": "https://stackoverflow.com/users/466862/mark-rotteveel"}, "edited": false, "score": 7, "creation_date": 1534055198, "post_id": 51806224, "comment_id": 90568088, "body": "Java optimizes using a JIT (Just In Time) compiler, which means that it will generate machine code specifically targeted for the machine it&#39;s running on, so don&#39;t just assume that Java is slow(er)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1534172617, "post_id": 51806224, "comment_id": 90604828, "body": "Unless the majority of your program&#39;s execution time is spent calculating exponents, this is a wild goose chase. Write an actual program, benchmark it, profile to find the hot spots, optimize those, re-run benchmarks, rinse, repeat. Microbenchmarks like this are not indicative of any real-world scenario."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3403807"}, "edited": false, "score": 10, "creation_date": 1534056364, "post_id": 51806357, "comment_id": 90568293, "body": "&quot;don&#39;t translate from other language&quot; - Good answer! \ud83d\udc4d"}, {"owner": {"reputation": 85, "user_id": 10201139, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gytRVjfnGLM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlrpHDAFXymzy-vveh-k1vq1YhtA/mo/photo.jpg?sz=128", "display_name": "ankur agrawal", "link": "https://stackoverflow.com/users/10201139/ankur-agrawal"}, "edited": false, "score": 0, "creation_date": 1534058501, "post_id": 51806357, "comment_id": 90568733, "body": "It means calculating x^n for large integer n in go requires own Power function implementation rather than using math.Pow function if n is not of float type?"}, {"owner": {"reputation": 1462, "user_id": 988175, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/cb69696ada13fd415125cc89ef1f4b09?s=128&d=identicon&r=PG", "display_name": "Raffaello", "link": "https://stackoverflow.com/users/988175/raffaello"}, "edited": false, "score": 0, "creation_date": 1574199088, "post_id": 51806357, "comment_id": 104144648, "body": "well for that kind of example is the same for everylanguage. In that benchmark, actually is honest to use the same &quot;math.Pow&quot; function, instead of <code>x*x-x</code> expression. So it is irrelevant"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 7, "last_activity_date": 1534105609, "last_edit_date": 1534105609, "creation_date": 1534055726, "answer_id": 51806357, "question_id": 51806224, "link": "https://stackoverflow.com/questions/51806224/speed-of-golang-vs-java/51806357#51806357", "title": "Speed of Golang Vs Java", "body": "<p>Don't translate from another language. Write the Go version of your program in Go. For example, <code>x*x - x</code>,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    start := time.Now()\n    v := testFun(10, 16666611, 1000000000)\n    since := time.Since(start)\n    fmt.Printf(\"value is %v\\ntime is %v\\n\", v, since)\n}\n\nfunc fun(x float64) float64 {\n    return x*x - x\n}\n\nfunc testFun(first float64, second float64, times int) float64 {\n    sum := float64(0)\n    dx := (second - first) / float64(times)\n    for i := 0; i &lt; times; i++ {\n        sum += fun(first + float64(i)*dx)\n    }\n    return sum * dx\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +5c11480631 Fri Aug 10 20:02:31 2018 +0000 linux/amd64\n$ go run speed.go\nvalue is 1.543194272428967e+21\ntime is 1.011965238s\n$\n</code></pre>\n\n<p>What results do you get?</p>\n"}, {"comments": [{"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 1, "creation_date": 1534058044, "post_id": 51806437, "comment_id": 90568633, "body": "It seems <code>math.Pow()</code> is slow in go, when both Java &amp; Go use component <code>2.4</code>, go is a bit slower than Java, but when avoid <code>math.Pow()</code>, go is much faster than Java."}, {"owner": {"reputation": 85, "user_id": 10201139, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gytRVjfnGLM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlrpHDAFXymzy-vveh-k1vq1YhtA/mo/photo.jpg?sz=128", "display_name": "ankur agrawal", "link": "https://stackoverflow.com/users/10201139/ankur-agrawal"}, "edited": false, "score": 0, "creation_date": 1534058399, "post_id": 51806437, "comment_id": 90568709, "body": "It means calculating x^n for large integer n in go requires own Power function implementation rather than using math.Pow function if n is not of float type?"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 8, "last_activity_date": 1534056564, "creation_date": 1534056564, "answer_id": 51806437, "question_id": 51806224, "link": "https://stackoverflow.com/questions/51806224/speed-of-golang-vs-java/51806437#51806437", "title": "Speed of Golang Vs Java", "body": "<p>I would suggest that <code>math.Pow(x,y)</code> in Go actually does <code>x^y</code> without any optimization for integer values of <code>y</code> while <code>Math.pow(x,y)</code> simply does <code>x*x</code> for <code>y==2</code>. At least when replacing <code>pow</code> with a simple <code>x*x</code> in both programs I get 6.5 seconds for Java vs. 1.4 seconds for Go. Using <code>pow</code> instead I still get 6.5 seconds for Java while 29.4 seconds for Go.</p>\n"}, {"comments": [{"owner": {"reputation": 3142, "user_id": 1583598, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9322bff86c672e97212b0f349d2c8e59?s=128&d=identicon&r=PG", "display_name": "Kevin Thibedeau", "link": "https://stackoverflow.com/users/1583598/kevin-thibedeau"}, "edited": false, "score": 1, "creation_date": 1557435862, "post_id": 51806701, "comment_id": 98774804, "body": "Go is automatically inlining fun() and unrolling the core loop. Gcc might be. Explicitly using C11 inlining, -O3, and -funroll-all-loops would speed up C and offer a more accurate comparison. The multiplication by <code>dx</code> in the loop can also be replaced with iterative addition."}, {"owner": {"reputation": 546, "user_id": 1648429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/539c2455b9f9cc516f1e5f339acdc7c1?s=128&d=identicon&r=PG", "display_name": "Robula", "link": "https://stackoverflow.com/users/1648429/robula"}, "edited": false, "score": 1, "creation_date": 1561553149, "post_id": 51806701, "comment_id": 100101801, "body": "It&#39;s surprising to see C lose a Go compiler written in C."}, {"owner": {"reputation": 1462, "user_id": 988175, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/cb69696ada13fd415125cc89ef1f4b09?s=128&d=identicon&r=PG", "display_name": "Raffaello", "link": "https://stackoverflow.com/users/988175/raffaello"}, "edited": false, "score": 1, "creation_date": 1574199400, "post_id": 51806701, "comment_id": 104144791, "body": "You should have compiled the C code with <code>-o2</code> parameter for optimization (or even <code>-o3</code>). would be nice to have the updated benchmark result with the proper C compilation flag. :)"}, {"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "reply_to_user": {"reputation": 1462, "user_id": 988175, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/cb69696ada13fd415125cc89ef1f4b09?s=128&d=identicon&r=PG", "display_name": "Raffaello", "link": "https://stackoverflow.com/users/988175/raffaello"}, "edited": false, "score": 1, "creation_date": 1574266223, "post_id": 51806701, "comment_id": 104172844, "body": "@Raffaello Thanks for the tip, indeed the <code>-O2</code> or <code>-O3</code> would speed up the C program above, I have updated the answer with result of additional tests. BTW, the options seems should be upper <code>O</code>, not lower."}], "tags": [], "owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "is_accepted": false, "score": 11, "last_activity_date": 1574266468, "last_edit_date": 1574266468, "creation_date": 1534059065, "answer_id": 51806701, "question_id": 51806224, "link": "https://stackoverflow.com/questions/51806224/speed-of-golang-vs-java/51806701#51806701", "title": "Speed of Golang Vs Java", "body": "<p><em>(With tips from above answers, I did more test, with an additional <code>C</code> version)</em></p>\n\n<p>On my linux machine, with times = <strong>100000000</strong>.</p>\n\n<p><strong>Testing result:</strong></p>\n\n<ul>\n<li>When exponent = <strong>2.4</strong></li>\n</ul>\n\n<blockquote>\n<pre><code> Java: result: 1.053906e+24, during: 7432 ms\n    C: result: 1.053906e+24, during: 5544 ms\n   Go: result: 1.053906e+24, during: 8.716807708s\n</code></pre>\n</blockquote>\n\n<ul>\n<li>When exponent = <strong>2</strong>, still use <code>pow()</code> or <code>Pow()</code>.</li>\n</ul>\n\n<blockquote>\n<pre><code> Java: result: 1.543194e+21, during: 630 ms\n    C: result: 1.543194e+21, during: 852 ms\n   Go: result: 1.543194e+21, during: 3.336549272s\n</code></pre>\n</blockquote>\n\n<ul>\n<li>When exponent = <strong>2</strong>, but use <code>x * x</code> instead.</li>\n</ul>\n\n<blockquote>\n<pre><code> Java: result: 1.543194e+21, during: 636 ms\n    C: result: 1.543194e+21, during: 340 ms\n   Go: result: 1.543194e+21, during: 115.491272ms\n</code></pre>\n</blockquote>\n\n<p><strong>Summary:</strong></p>\n\n<ul>\n<li>In general, <code>go</code> is really fast, according to the last test, faster than <code>Java</code>, or even <code>C</code>.</li>\n<li>But, <code>Java</code> really have a good <code>pow()</code> implementation, according to the first 2 test.</li>\n</ul>\n\n<hr>\n\n<h2>Code</h2>\n\n<p><strong>Test.java:</strong></p>\n\n<pre><code>/**\n * Compile:\n *  javac Test.java\n * Run:\n *  java Test\n */ \npublic class Test {\n    public static void main(String[] args) {\n        Test test = new Test();\n    long startAt = System.currentTimeMillis();\n        double re = test.testFun(10, 16666611, 100000000);\n    long during = System.currentTimeMillis() - startAt;\n        System.out.printf(\"%10s: result: %e, during: %d ms\\n\", \"Java\", re, during);\n    }\n\n    private double testFun(double first, double second, long times) {\n        int i = 0;\n        double result = 0;\n        double dx = (second - first) / times;\n        for (; i &lt; times; i++) {\n            result += fun(first + i * dx);\n        }\n        return result * dx;\n    }\n\n    private double fun(double v) {\n        return v * v - v;\n        // return Math.pow(v, 2) - v;\n        // return Math.pow(v, 2.4) - v;\n    }\n}\n</code></pre>\n\n<p><strong>test.c:</strong></p>\n\n<pre><code>/**\n * compile with:\n *  gcc test.c -lm\n */\n#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/time.h&gt;\n\ndouble fun(double v) {\n    return v * v - v;\n    // return pow(v, 2) - v;\n    // return pow(v, 2.4) - v;\n}\n\ndouble testFun(double first, double second, long times) {\n    int i;\n    double result = 0;\n    double dx = (second - first) / times;\n    for (i = 0; i &lt; times; i++) {\n        result += fun(first + i * dx);\n    }\n    return result * dx;\n}\n\nlong long current_timestamp() {\n    struct timeval te;\n    gettimeofday(&amp;te, NULL); // get current time\n    long long milliseconds =\n        te.tv_sec * 1000LL + te.tv_usec / 1000; // calculate milliseconds\n    // printf(\"milliseconds: %lld\\n\", milliseconds);\n    return milliseconds;\n}\n\nint main(int argc, char *argv[]) {\n    long long startAt = current_timestamp();\n    double re = testFun(10, 16666611, 100000000);\n    long long during = current_timestamp() - startAt;\n    printf(\"%10s: result: %e, during: %lld ms\\n\", \"C\", re, during);\n    return 0;\n}\n</code></pre>\n\n<p><strong>test.go:</strong></p>\n\n<pre><code>/**\n * How to run:\n *  go run test.go\n */\npackage main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    startAt := time.Now()\n    result := testFun(10, 16666611, 100000000)\n    during := time.Since(startAt)\n    fmt.Printf(\"%10s: result: %e, during: %v\\n\", \"Go\", result, during)\n\n    _ = math.Pow\n}\n\nfunc fun(x float64) float64 {\n    return x*x - x\n    // return math.Pow(x, 2) - x\n    // return math.Pow(x, 2.4) - x\n}\n\nfunc testFun(first float64, second float64, times int) float64 {\n    var i = 0\n    var result float64 = 0\n    var dx float64\n    dx = (second - first) / float64(times)\n    for ; i &lt; times; i++ {\n        result += fun(first + float64(i)*dx)\n    }\n    return result * dx\n}\n</code></pre>\n\n<p><strong>Compile:</strong></p>\n\n<pre><code>javac Test.java; gcc test.c -lm; go build test.go\n</code></pre>\n\n<p><strong>Run:</strong></p>\n\n<pre><code>java Test; ./a.out ; ./test\n</code></pre>\n\n<hr>\n\n<h2>@Update - C program with <code>-O2</code> or <code>-O3</code> option</h2>\n\n<p>As suggested by <code>Raffaello</code> in the comment, when compiling C program, could use <code>-O2</code> or <code>-O3</code> to further optimize the program.</p>\n\n<p>And, following are the test result for <code>C</code> program:</p>\n\n<ul>\n<li>When exponent = <strong>2.4</strong>.</li>\n</ul>\n\n<blockquote>\n<pre><code>            C: result: 1.543194e+21, during: 5805 ms\n C with `-O2`: result: 1.543194e+21, during: 5324 ms\n C with `-O3`: result: 1.543194e+21, during: 5326 ms\n</code></pre>\n</blockquote>\n\n<ul>\n<li>When exponent = <strong>2</strong>, still use <code>pow()</code> or <code>Pow()</code>.</li>\n</ul>\n\n<blockquote>\n<pre><code>            C: result: 1.543194e+21, during: 897 ms\n C with `-O2`: result: 1.543194e+21, during: 119 ms\n C with `-O3`: result: 1.543194e+21, during: 121 ms\n</code></pre>\n</blockquote>\n\n<ul>\n<li>When exponent = <strong>2</strong>, but use <code>x * x</code> instead.</li>\n</ul>\n\n<blockquote>\n<pre><code>            C: result: 1.543194e+21, during: 353 ms\n C with `-O2`: result: 1.543194e+21, during: 122 ms\n C with `-O3`: result: 1.543194e+21, during: 119 ms\n</code></pre>\n</blockquote>\n\n<p><strong>Summary</strong> - (<code>-O2</code> and <code>-O3</code> option):  </p>\n\n<ul>\n<li>With <code>-O2</code> and <code>-O3</code> option  \n\n<ul>\n<li>When base is integer <em>(e.g 2)</em>, would make c program quicker, by several times.</li>\n<li>When base is floating point number <em>(e.g 2.4)</em>, it's also quicker, but very minimal.</li>\n</ul></li>\n<li>Comparing between <code>-O2</code> and <code>-O3</code>, they are quite close in above tests.</li>\n</ul>\n"}], "owner": {"reputation": 85, "user_id": 10201139, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gytRVjfnGLM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlrpHDAFXymzy-vveh-k1vq1YhtA/mo/photo.jpg?sz=128", "display_name": "ankur agrawal", "link": "https://stackoverflow.com/users/10201139/ankur-agrawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15674, "favorite_count": 4, "answer_count": 3, "score": 4, "last_activity_date": 1574266468, "creation_date": 1534054389, "last_edit_date": 1534054900, "question_id": 51806224, "link": "https://stackoverflow.com/questions/51806224/speed-of-golang-vs-java", "title": "Speed of Golang Vs Java", "body": "<p>I have written a program in Java and equivalent in Go. My java program is taking around 5.95 seconds to execute while Go program is taking around 41.675789791 seconds. While speed of Go is comparable to C or C++ as it is compiled like C then Why this much of performance difference exists? Programs are as follows:</p>\n\n<p><strong>Go Program</strong></p>\n\n<pre><code>package main\n\n\nimport (\n    \"math\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Printf(\"vvalue is %v\", testFun(10, 16666611, 1000000000))\n}\n\nfunc fun(x float64) float64 {\n    return math.Pow(x, 2) - x\n}\n\nfunc testFun(first float64, second float64, times int) float64 {\n    var i = 0\n    var result float64 = 0\n    var dx float64\n    dx = (second - first) / float64(times)\n    for ; i &lt; times; i++ {\n        result += fun(first + float64(i) * dx)\n    }\n    return result * dx\n}   \n</code></pre>\n\n<p><strong>Java Program</strong></p>\n\n<pre><code>public class Test {\npublic static void main(String[] args) {\n    Test test = new Test();\n    double re = test.testFun(10, 16666611, 1000000000);\n    System.out.println(re);\n}\n\nprivate double testFun(double first, double second, long times) {\n    int i = 0;\n    double result = 0;\n    double dx = (second - first) / times;\n    for (; i &lt; times; i++) {\n        result += fun(first + i * dx);\n    }\n    return result * dx;\n}\n\nprivate double fun(double v) {\n    return Math.pow(v, 2) - v;\n}\n}\n</code></pre>\n"}, {"tags": ["go", "sha1"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1534051686, "post_id": 51805913, "comment_id": 90567484, "body": "Did you already try the <a href=\"https://golang.org/pkg/crypto/hmac/\" rel=\"nofollow noreferrer\">hmac package</a>?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1534051786, "post_id": 51805913, "comment_id": 90567499, "body": "For sha1 encoding: <code>hmac.New(sha1.New, key)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2715, "user_id": 2347084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/801659d4522ed90c3259445617c1f31f?s=128&d=identicon&r=PG&f=1", "display_name": "yagger", "link": "https://stackoverflow.com/users/2347084/yagger"}, "edited": false, "score": 0, "creation_date": 1534082677, "post_id": 51806452, "comment_id": 90574166, "body": "Thanks Leo, this is what I was looking for."}], "tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": false, "score": 2, "last_activity_date": 1534056755, "creation_date": 1534056755, "answer_id": 51806452, "question_id": 51805913, "link": "https://stackoverflow.com/questions/51805913/sha1-encoding-with-secret-equivalent-to-php-hash-hmac/51806452#51806452", "title": "SHA1 encoding with secret, equivalent to PHP hash_hmac", "body": "<p>Something like this:</p>\n\n<pre><code>import \"crypto/sha1\"\nimport \"crypto/hmac\"\n\nfunc hash_hmac_sha1(password, salt, key []byte) []byte {\n    h := hmac.New(sha1.New, key)\n    h.Write(password)\n    h.Write(salt)\n    return h.Sum(nil)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 10590989, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WsmPdrVyeXc/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbC3RxN0WrkI0dveV3jWlBmI-4tVeg/mo/photo.jpg?sz=128", "display_name": "googol GL", "link": "https://stackoverflow.com/users/10590989/googol-gl"}, "is_accepted": false, "score": 1, "last_activity_date": 1541076828, "creation_date": 1541076828, "answer_id": 53101704, "question_id": 51805913, "link": "https://stackoverflow.com/questions/51805913/sha1-encoding-with-secret-equivalent-to-php-hash-hmac/53101704#53101704", "title": "SHA1 encoding with secret, equivalent to PHP hash_hmac", "body": "<p>Like this function:</p>\n\n<pre><code>func decriptSign(message string, key string) string {\n    h := hmac.New(sha1.New, []byte(key))\n    h.Write([]byte(message))        \n    return hex.EncodeToString(h.Sum(nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 2715, "user_id": 2347084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/801659d4522ed90c3259445617c1f31f?s=128&d=identicon&r=PG&f=1", "display_name": "yagger", "link": "https://stackoverflow.com/users/2347084/yagger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1541076828, "creation_date": 1534050901, "last_edit_date": 1534082786, "question_id": 51805913, "link": "https://stackoverflow.com/questions/51805913/sha1-encoding-with-secret-equivalent-to-php-hash-hmac", "title": "SHA1 encoding with secret, equivalent to PHP hash_hmac", "body": "<p>I have the following PHP function</p>\n\n<pre><code>public function encodePassword($raw, $salt)\n    {\n        return hash_hmac('sha1', $raw . $salt, $this-&gt;secret);\n    }\n</code></pre>\n\n<p>which I need to translate to Go. I found the following example, but it doesn't involve secret key.\n<a href=\"https://gobyexample.com/sha1-hashes\" rel=\"nofollow noreferrer\">https://gobyexample.com/sha1-hashes</a></p>\n\n<p>How can I create a function in Go, that produces exactly same result as PHP's hash_hmac?</p>\n\n<blockquote>\n  <p>Update: After Leo's answer, found this resource with hmac examples in\n  many languages: <a href=\"https://github.com/danharper/hmac-examples\" rel=\"nofollow noreferrer\">https://github.com/danharper/hmac-examples</a>. Can be\n  useful to somebody.</p>\n</blockquote>\n"}, {"tags": ["go", "telegram", "chatbot"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1534077213, "post_id": 51805696, "comment_id": 90572793, "body": "You can disable it using the <code>BotFather</code> bot. It is a bot setting - there is no need to solve this using programming."}, {"owner": {"reputation": 37, "user_id": 9826173, "user_type": "registered", "profile_image": "https://graph.facebook.com/1096150927200415/picture?type=large", "display_name": "T&#237;n Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9826173/t%c3%adn-hu%e1%bb%b3nh"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1534127285, "post_id": 51805696, "comment_id": 90583561, "body": "I can handle it now, by using the properties of message. Anyway, thanks for your answer"}], "owner": {"reputation": 37, "user_id": 9826173, "user_type": "registered", "profile_image": "https://graph.facebook.com/1096150927200415/picture?type=large", "display_name": "T&#237;n Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9826173/t%c3%adn-hu%e1%bb%b3nh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1534048326, "creation_date": 1534048326, "question_id": 51805696, "link": "https://stackoverflow.com/questions/51805696/how-to-avoid-telegram-chatbot-to-receive-and-answer-in-a-channel-chat", "title": "How to avoid telegram chatbot to receive and answer in a channel chat?", "body": "<p>I'm writing an telegram bot with golang and I have some troubles. I receive chat table from user by updates. But my bot is also in a channel chat, so if someone chat in this channel, the bot will also rep to them. How can I avoid this?</p>\n\n<p>my code:</p>\n\n<pre><code>bot, err := tgbotapi.NewBotAPI(\"BOT_TOKEN\")\nif err != nil {\n    log.Panic(err)\n}\nvar client Client\n///////\n//bot.Debug = true\n///////\nlog.Printf(\"Authorized on account %s\", bot.Self.UserName)\noffset := rand.Intn(10000)\nfmt.Println(offset)\nu := tgbotapi.NewUpdate(offset)\nu.Timeout = 360\n//var IDSender int64\nupdates, err := bot.GetUpdatesChan(u)\nfor update := range updates {\n    if update.Message == nil {\n        continue\n    }\n    _IdSender := update.Message.Chat.ID\n    Greeting := tgbotapi.NewMessage(_IdSender, \"Hello!\")\n    bot.Send(Greeting)\n}\n</code></pre>\n"}, {"tags": ["go", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10213806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P0YaixJ2KPE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7olTEo69nUfxao3IIF3oc37pruOfA/mo/photo.jpg?sz=128", "display_name": "tangle", "link": "https://stackoverflow.com/users/10213806/tangle"}, "edited": false, "score": 0, "creation_date": 1534036494, "post_id": 51804894, "comment_id": 90565685, "body": "Thanks. @bronze man. But I think this method works only if I have a few functions. I manually write a new functions for each function. But if I have plenty of functions and I want to use wrappers, I need the function name not changed after wrapped. I want to use the function as key at runtime."}, {"owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "reply_to_user": {"reputation": 11, "user_id": 10213806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P0YaixJ2KPE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7olTEo69nUfxao3IIF3oc37pruOfA/mo/photo.jpg?sz=128", "display_name": "tangle", "link": "https://stackoverflow.com/users/10213806/tangle"}, "edited": false, "score": 0, "creation_date": 1534036788, "post_id": 51804894, "comment_id": 90565719, "body": "If you want to change the function content but use the same function name, you can use global function variable, see my code example in the post."}, {"owner": {"reputation": 11, "user_id": 10213806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P0YaixJ2KPE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7olTEo69nUfxao3IIF3oc37pruOfA/mo/photo.jpg?sz=128", "display_name": "tangle", "link": "https://stackoverflow.com/users/10213806/tangle"}, "edited": false, "score": 0, "creation_date": 1534037931, "post_id": 51804894, "comment_id": 90565847, "body": "Thanks. Seems to work if gV2 is simple. But I just check my code, the gV2 is a function with about 30 lines of code, which is a little complex. Not easy to write a gV2 for each function. So I think I still need to use wrappers."}, {"owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "reply_to_user": {"reputation": 11, "user_id": 10213806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P0YaixJ2KPE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7olTEo69nUfxao3IIF3oc37pruOfA/mo/photo.jpg?sz=128", "display_name": "tangle", "link": "https://stackoverflow.com/users/10213806/tangle"}, "edited": false, "score": 0, "creation_date": 1534038370, "post_id": 51804894, "comment_id": 90565897, "body": "If you have a lot of functions to have the same wrap logic, you can pass in the origin function and return the new function, see my code example in the post."}], "tags": [], "owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "is_accepted": false, "score": 1, "last_activity_date": 1534038304, "last_edit_date": 1534038304, "creation_date": 1534035244, "answer_id": 51804894, "question_id": 51804831, "link": "https://stackoverflow.com/questions/51804831/how-to-implement-python-functools-wraps-equivalent/51804894#51804894", "title": "How to implement Python functools.wraps equivalent?", "body": "<blockquote>\n  <p>How to attach attribute to functions in Go?</p>\n</blockquote>\n\n<p>No, You can not attach attribute to functions in Go.</p>\n\n<blockquote>\n  <p>How to implement the job that d_wraps does in Go?</p>\n</blockquote>\n\n<p>You can implement another function call your functions, and call the function with the new name.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n   g_warp(\"abc\")\n}\n\nfunc g(a string){\n   fmt.Println(a);\n}\n\nfunc g_warp(a string){\n   g(a+\"_mysuffix\");\n}\n</code></pre>\n\n<p>If you want to change the function content but use the same function name, you can use global function variable:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    g = gV2\n    g(\"hello\")\n}\n\nvar g = gV1;\n\nfunc gV1(a string){\n    fmt.Println(a)\n}\nfunc gV2(a string){\n    gV1(a+\"_suffix\")\n}\n</code></pre>\n\n<p>If you have a lot of functions to have the same wrap logic, you can pass in the origin function and return the new function:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    g = wrap(g)\n    g(\"hello\")\n    f = wrap(f)\n    f(\"hello\")\n}\n\nvar g = gV1;\n\nfunc gV1(a string){\n    fmt.Println(a)\n}\nvar f = fV1;\n\nfunc fV1(a string){\n    fmt.Println(a+\" \"+a)\n}\nfunc wrap(originFn func(a string)) func(a string){\n    return func(a string){\n         originFn(a+\"_suffix\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10213806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P0YaixJ2KPE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7olTEo69nUfxao3IIF3oc37pruOfA/mo/photo.jpg?sz=128", "display_name": "tangle", "link": "https://stackoverflow.com/users/10213806/tangle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555934419, "creation_date": 1534034333, "last_edit_date": 1555934419, "question_id": 51804831, "link": "https://stackoverflow.com/questions/51804831/how-to-implement-python-functools-wraps-equivalent", "title": "How to implement Python functools.wraps equivalent?", "body": "<p>I know I can wrap functions in Go through returning function, bug how to implement Python functools.wraps equivalent in Go? How to attach attribute to functions in Go? Like the code below in Python.</p>\n\n<pre><code>from functools import wraps\n\ndef d(f):\n    def wrapper(*args):\n        f(*args)\n\n    return wrapper\n\ndef d_wraps(f):\n    @wraps(f)\n    def wrapper(*args):\n        f(*args)\n\n    return wrapper\n\n@d\ndef f(a=''):\n    print a\n\n@d_wraps\ndef g(a=''):\n    print a\n\nif __name__ == '__main__':\n    print 'function name: ', f.__name__\n    f('abc')\n\n    print 'function name: ', g.__name__\n    g('abc')\n</code></pre>\n\n<p><code>d</code> does not change function name, <code>d_wraps</code> changes function name. The result is</p>\n\n<pre><code>function name:  wrapper\nabc\nfunction name:  g\nabc\n</code></pre>\n\n<p>I want to use the wrapped function as key at runtime. So I want to keep the function name unchanged after wrapped. How to implement the job that <code>d_wraps</code> does in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1534033973, "post_id": 51804674, "comment_id": 90565369, "body": "I would suggest examining the documentation for <code>os.File</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1534076906, "post_id": 51804674, "comment_id": 90572692, "body": "See also <a href=\"https://golang.org/pkg/io/ioutil/\" rel=\"nofollow noreferrer\">io/ioutil</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "is_accepted": true, "score": 1, "last_activity_date": 1534035697, "creation_date": 1534035697, "answer_id": 51804924, "question_id": 51804674, "link": "https://stackoverflow.com/questions/51804674/phps-fopen-fread-fwrite-equivalent-in-golang/51804924#51804924", "title": "PHP&#39;s fopen/fread/fwrite equivalent in golang", "body": "<blockquote>\n  <p>fopen</p>\n</blockquote>\n\n<p>os.OpenFile <a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#OpenFile</a></p>\n\n<blockquote>\n  <p>fread</p>\n</blockquote>\n\n<p>No identical match, but similer (*os.File)Read <a href=\"https://golang.org/pkg/os/#File.Read\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#File.Read</a></p>\n\n<blockquote>\n  <p>fwrite</p>\n</blockquote>\n\n<p>(*os.File)Write <a href=\"https://golang.org/pkg/os/#File.Write\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#File.Write</a></p>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "accepted_answer_id": 51804924, "answer_count": 1, "score": -2, "last_activity_date": 1534035697, "creation_date": 1534032132, "question_id": 51804674, "link": "https://stackoverflow.com/questions/51804674/phps-fopen-fread-fwrite-equivalent-in-golang", "title": "PHP&#39;s fopen/fread/fwrite equivalent in golang", "body": "<p>Is there an equivalent Php's fopen/fread/fwrite method in golang?</p>\n\n<p>At the moment, I currently move, write and append to []byte with an offset, then write all thru os.File.Write(). But I'm wondering if there's a method that I can do directly to and from a file. </p>\n"}, {"tags": ["reactjs", "go"], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 8682336, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kl_8cldQJU8/AAAAAAAAAAI/AAAAAAAAB2M/x2CIyLdAbu0/photo.jpg?sz=128", "display_name": "Nguyen Dang Minh", "link": "https://stackoverflow.com/users/8682336/nguyen-dang-minh"}, "is_accepted": true, "score": 3, "last_activity_date": 1534058809, "creation_date": 1534058809, "answer_id": 51806677, "question_id": 51804258, "link": "https://stackoverflow.com/questions/51804258/how-do-i-deliver-my-bundle-js-file-with-my-html-in-go-using-gorilla-mux/51806677#51806677", "title": "How do I deliver my bundle.js file with my html in GO using gorilla/mux", "body": "<p>You should use <code>PathPrefix</code> for serving files in the <code>public</code> directory:  </p>\n\n<pre><code>r := mux.NewRouter()\n\nbs := http.FileServer(http.Dir(\"public\"))\nr.PathPrefix(\"/public/\").Handler(http.StripPrefix(\"/public/\", bs))\n\nfs := http.FileServer(http.Dir(\"./static\"))\nr.Handle(\"/\", fs)\n\nhttp.Handle(\"/\", r)\n</code></pre>\n\n<p>Refer to <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow noreferrer\">Gorilla mux document</a></p>\n"}], "owner": {"reputation": 3, "user_id": 10210869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-harsgErAmng/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pF78GdGKoQuduRiyXwT0zIhZrYMA/mo/photo.jpg?sz=128", "display_name": "Khachatur Mirijanyan", "link": "https://stackoverflow.com/users/10210869/khachatur-mirijanyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 51806677, "answer_count": 1, "score": 0, "last_activity_date": 1534058809, "creation_date": 1534026565, "question_id": 51804258, "link": "https://stackoverflow.com/questions/51804258/how-do-i-deliver-my-bundle-js-file-with-my-html-in-go-using-gorilla-mux", "title": "How do I deliver my bundle.js file with my html in GO using gorilla/mux", "body": "<p>I am trying to make a simple server with a Go backend and React frontend. To do this, I need to send my static html and bundle.js file. Her's the html</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://cdn.rawgit.com/twbs/bootstrap/48938155eb24b4ccdde09426066869504c6dab3c/dist/css/bootstrap.min.css\"&gt;\n     &lt;title&gt;Mern Gen&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n&lt;main id='root'&gt;\n  App has crashed\n&lt;/main&gt;\n&lt;script src=\"../public/bundle.js\" \ntype=\"text/javascript\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Currently I am doing this to deliver both files to the '/' url</p>\n\n<pre><code>bs := http.FileServer(http.Dir(\"public\"))\nhttp.Handle(\"/public/\", http.StripPrefix(\"/public/\", bs))\n\nfs := http.FileServer(http.Dir(\"./static\"))\nhttp.Handle(\"/\", fs)\n</code></pre>\n\n<p>I now need to use gorilla/mux to match variable parameters like this</p>\n\n<pre><code>r.HandleFunc(\"/loc/{id}\", getLoc)\n</code></pre>\n\n<p>But if I do that I have to also change from the default mux to the gorilla router </p>\n\n<pre><code>r := mux.NewRouter()\nbs := http.FileServer(http.Dir(\"public\"))\nr.Handle(\"/public/\", http.StripPrefix(\"/public/\", bs))\n\nfs := http.FileServer(http.Dir(\"./static\"))\nr.Handle(\"/\", fs)\n</code></pre>\n\n<p>And this does not work. I get an error saying that my bundle.js is not found. How do I do this with gorilla mux?</p>\n"}, {"tags": ["go", "struct", "channel"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534023782, "post_id": 51803864, "comment_id": 90563928, "body": "is the <code>MessageHandler</code> executed in a goroutine? or is <code>client.Subscribe</code> executed in a goroutine?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534023909, "post_id": 51803864, "comment_id": 90563946, "body": "... because if not, then  <code>c &lt;- data</code> will block <code>client.Subscribe</code> from ever exiting. So the lines of code after it won&#39;t be executed."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534024014, "post_id": 51803864, "comment_id": 90563970, "body": "... try it with a buffered channel, e.g. <code>make(chan []byte, 1)</code>, they block only when full, so sending one piece of data should be ok for your purpose."}, {"owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534026316, "post_id": 51803864, "comment_id": 90564392, "body": "@mkopriva It doesn&#39;t seem to work. This is running in a loop, so I constantly receive data. All I really want to do is be able to return the data I receive, so I tried using a channel, but if there are other ways then I&#39;d love some help with that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534026482, "post_id": 51803864, "comment_id": 90564419, "body": "what is running in a loop?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534026786, "post_id": 51803864, "comment_id": 90564452, "body": "... also your example unnecessarily unmarshals bytes into a struct and then marshal that struct back into bytes, just pass the payload to the channel."}, {"owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1534029446, "post_id": 51803864, "comment_id": 90564856, "body": "@mkopriva I edited my code to serve another purpose. Basically I want to return a pointer to an <b>instance</b> of the struct. And the purpose of my marshalling it is just to see the contents of what is in that struct. However, it&#39;s not printing out anything :( Any ideas on why?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1534047261, "post_id": 51803864, "comment_id": 90566870, "body": "i haven&#39;t used the mqtt package so I&#39;m not 100% sure, but I think the messages are being sent to the handler concurrently, which means that <code>json.Marshal</code> and <code>return</code> are executed before the client receives a message and passes it to the handler. But looking at their documentation it seems to me that you might be able to &quot;wait&quot; for the message by using the token that&#39;s returned from the <code>Subscribe</code> method. Try experimenting with that if that doesn&#39;t work make sure to add mqtt tag to your question and maybe someone with more knowledge about the package can chime in."}], "owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534031028, "creation_date": 1534022631, "last_edit_date": 1534031028, "question_id": 51803864, "link": "https://stackoverflow.com/questions/51803864/cannot-print-out-byte-data-mqtt", "title": "Cannot print out []byte data MQTT", "body": "<p>I have a function that takes in JSON data sent using MQTT and unmarshalls it into a struct. I then marshal the struct into a JSON for the purpose of checking whether it holds the desired values. My issue is that I am unable to print out the data after I marshalled it.  </p>\n\n<p>Here is my code: </p>\n\n<pre><code>func VirtualDevice(client MQTT.Client, deviceID string) *VD {\n\nvar data []byte\n\nsensorData := new(VD)\n\nvar g MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\n    err := json.Unmarshal(msg.Payload(), &amp;sensorData)\n    if err != nil {\n        panic(err)\n    } else {\n\n        //fmt.Printf(\"%+v\\n\", *sensorData) \n\n    }\n}\nclient.Subscribe(\"data-update/\"+deviceID, 0, g)\ndata, _ = json.Marshal(*sensorData)\nfmt.Println(string(data)) //not printing anything\nreturn sensorData\n}\n</code></pre>\n\n<p>Does anyone have any ideas on why this isn't printing out? Thank you. </p>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1534034036, "post_id": 51803734, "comment_id": 90565377, "body": "This isn&#39;t permissions-related.  Something is wrong with the actual format of the URL.  Can you share one of them with us?"}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1534035422, "post_id": 51803734, "comment_id": 90565548, "body": "I added an edit with one of the URLs."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1534040850, "post_id": 51803734, "comment_id": 90566159, "body": "I see what the problem is, the &amp; are being replaced with \\u.  I just don&#39;t have any idea why."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1534041576, "post_id": 51803734, "comment_id": 90566247, "body": "It&#39;s something to do with go&#39;s byte to string conversion.  I unmarshaled the json object into a struct and everything looks correct when I log it now."}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1534077153, "post_id": 51803734, "comment_id": 90572769, "body": "Unrelated, but <code>s3.amazonaws.com&#47;&lt;--this--&gt;&#47;CFDMP_ServoGear.gcode?X-</code> is going to cause you problems at some point.  S3 object keys should not have a leading slash, but <code>&#47;&#47;</code> appearing in the URL suggests that you are adding them.  This can eventually cause unexpected/strange/confusing behavior or compatibility issues.  A correct object key is <code>cat.jpg</code> or <code>pics&#47;cat.jpg</code>, <b>not</b>  <code>&#47;cat.jpg</code> or <code>&#47;pics&#47;cat.jpg</code>... but you need to fix this on the upload side as well as the download side. Better to fix it now than to have to fix it later."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 1805241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ce4b85dd1ea270bf52d77bea5701646?s=128&d=identicon&r=PG", "display_name": "user1805241", "link": "https://stackoverflow.com/users/1805241/user1805241"}, "is_accepted": false, "score": 7, "last_activity_date": 1571042368, "creation_date": 1571042368, "answer_id": 58372970, "question_id": 51803734, "link": "https://stackoverflow.com/questions/51803734/s3-signedurl-fails/58372970#58372970", "title": "S3 SignedURL fails", "body": "<p>Such issues occur when you are not correctly specifying the algorithm. For me, I was using this url: <a href=\"https://s3_endpoint?X-Amz-Algorithm=AWS4-HMAC-SHA256\" rel=\"noreferrer\">https://s3_endpoint?X-Amz-Algorithm=AWS4-HMAC-SHA256</a>\\u0026 \nwhich returned to me the same error. I replaced the \\u0026 with &amp; and it worked fine.</p>\n"}], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2298, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1571042368, "creation_date": 1534021393, "last_edit_date": 1534035399, "question_id": 51803734, "link": "https://stackoverflow.com/questions/51803734/s3-signedurl-fails", "title": "S3 SignedURL fails", "body": "<p>I'm trying to create a signed URL for a GET object request in S3.  I have this code working flawlessly for putting objects in S3 but I can't seem to get it to work for GET.  I sign the URL with this code</p>\n\n<pre><code>    //Create the signed url using the company id\nfunc (user *User) signURLForUser(sess *session.Session) (*URLSign, error) {\n    svc := s3.New(sess)\n    svc.Config.Region = aws.String(os.Getenv(\"REGION\"))\n    req, _ := svc.GetObjectRequest(&amp;s3.GetObjectInput{\n        Bucket: aws.String(\"bucket\"),\n        Key:    aws.String(user.CompanyID + \"/\" + user.FileRequest),\n    })\n    var urlSign URLSign\n    //urlSign.Size = *out.ContentLength\n    str, err := req.Presign(time.Minute * 60 * 24 * 5) //Expire in 5 days\n    if err != nil {\n        log.Println(\"Error signing URL Request\")\n        return nil, err\n    }\n    urlSign.URL = str\n    return &amp;urlSign, nil\n}\n</code></pre>\n\n<p>But when I try to use the URL it returns I get this error:</p>\n\n<pre><code> &lt;Error&gt;\n&lt;Code&gt;AuthorizationQueryParametersError&lt;/Code&gt;\n&lt;Message&gt;X-Amz-Algorithm only supports \"AWS4-HMAC-SHA256\"&lt;/Message&gt;\n&lt;RequestId&gt;9D7CFB14B195A260&lt;/RequestId&gt;\n&lt;HostId&gt;\nDgh+SqrHbrdKcbkCYrAj3nObLMAwS7k5+VR1zwC/8ZMS3S4++IAAEXXh3zMZ3CpOAyxX1Kc7Opg=\n&lt;/HostId&gt;\n&lt;/Error&gt;\n</code></pre>\n\n<p>I've check the IAM permissions, they're set for GetObject.  I can't think of what else I'm doing wrong.</p>\n\n<p>EDIT: Here's an example of the URL\nFor sure:\n<a href=\"https://rsmachiner-user-code.s3.amazonaws.com/\" rel=\"nofollow noreferrer\">https://rsmachiner-user-code.s3.amazonaws.com/</a>/CFDMP_ServoGear.gcode?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;X-Amz-Credential=ASIAVEENPDKJRUDZKEVM%2F20180812%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20180812T005443Z&amp;X-Amz-Expires=432000&amp;X-Amz-Security-Token=FQoGZXIvYXdzEBoaDIVdv9t408gWWi9vvSLjAaa0pZNA%2BXu83%2FFSyng4XvFdv5%2B7nRB%2FQydMLyi%2BBS84yXqwP6VYn7VlInw4ip1M0lkjHRXQf8OAvQLPrIl%2FQZoTe%2Fy3N6bqhLDOnFVJ3UZzYDQ4%2FbX%2Brc6mvVbkhRsQPiarKBuLYDiOD%2FNoSaItMwI9FsMDknw1qX0Pf%2BZ5La0GmanHrTt9YUI01cIUKJ40No5mKJIwcXw3%2F5QOpUc59rZ2zEzlWP9OXeEwWKp%2Bog5P0v7ABX1lRPsCx4HGEstKhw3ZWmJfQhAcAvhrjmXIMqGNKkaCI5L0ap23jf4GvPMGd4%2BcKIKKvtsF&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=82dfb9b392b5e1ef44c7140259ad884e696b48f8094bdd2d223b8650ebdf59f7</p>\n"}, {"tags": ["google-app-engine", "go", "algolia"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 3583739, "user_type": "registered", "accept_rate": 29, "profile_image": "https://graph.facebook.com/693211910/picture?type=large", "display_name": "Alberto Cantu", "link": "https://stackoverflow.com/users/3583739/alberto-cantu"}, "is_accepted": false, "score": 1, "last_activity_date": 1561966293, "last_edit_date": 1561966293, "creation_date": 1534141534, "answer_id": 51816277, "question_id": 51803269, "link": "https://stackoverflow.com/questions/51803269/google-app-engine-algolia-indexing-error/51816277#51816277", "title": "Google App Engine Algolia Indexing Error", "body": "<p>I struggled with setting up algolia with app engine in production, you have to set up a different transport for the algolia client... here is it:</p>\n\n<pre><code>client := algoliasearch.NewClient(ALGOLIA_APP_ID, ALGOLIA_API_KEY)\n    transport := &amp;http.Client{\n        Transport: &amp;urlfetch.Transport{\n            AllowInvalidServerCertificate: true,\n            Context: appengine.NewContext(r), // r *http.Request\n        },\n    }\nclient.SetHTTPClient(transport)\n\nclient.initIndex(INDEX_NAME)\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>This is now fixed by golang 1.11 release, you can simply use algolia golang as is</p>\n"}], "owner": {"reputation": 71, "user_id": 3583739, "user_type": "registered", "accept_rate": 29, "profile_image": "https://graph.facebook.com/693211910/picture?type=large", "display_name": "Alberto Cantu", "link": "https://stackoverflow.com/users/3583739/alberto-cantu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561966293, "creation_date": 1534017564, "question_id": 51803269, "link": "https://stackoverflow.com/questions/51803269/google-app-engine-algolia-indexing-error", "title": "Google App Engine Algolia Indexing Error", "body": "<p>I\u2019m using Google App Engine for a golang api with algolia and I\u2019ve been working (indexing records) without any issue in localhost, today I deployed to test it live and I got this error for all my indexing operations</p>\n\n<p>Cannot perform request [POST] /1/indexes/INDEXNAME/batch (APPID.algolianet.com): Post <a href=\"https://APPID.algolianet.com/1/indexes/INDEXNAME/batch\" rel=\"nofollow noreferrer\">https://APPID.algolianet.com/1/indexes/INDEXNAME/batch</a>: dial tcp: lookup APPID.algolianet.com on [::1]:53: dial udp [::1]:53: socket: operation not permitted</p>\n\n<p>Any solution ideas?</p>\n"}, {"tags": ["loops", "go", "recursion", "struct", "yaml"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1534099050, "post_id": 51803219, "comment_id": 90578480, "body": "I think that you &quot;didn&#39;t explain myself well&quot; because I have re-read your question and if I didn&#39;t answer it, then I have no idea what you want to know."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1534099370, "post_id": 51803219, "comment_id": 90578573, "body": "@ZanLynx please see my update, is it more clear now?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534190879, "post_id": 51803219, "comment_id": 90614006, "body": "@JhonD so actually you want to update the values of intconfig according to the type you have defined in the switch right."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534191582, "post_id": 51803219, "comment_id": 90614293, "body": "@Himanshu - yes exactly, it should be at the end like <code>internal_config_after_changes</code> and should get the value from <code>external_config</code> yaml file content when there is a match of the values like <code>app1</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534192028, "post_id": 51803219, "comment_id": 90614463, "body": "@JhonD check the answer with change inside <code>ConvertType</code> function with slice indexing to fetch the underlying array."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534099209, "post_id": 51811647, "comment_id": 90578527, "body": "Thanks!  I&#39;ve two structs, how do I match the values from the yaml <code>parsed </code>(byte) to the <code>xtr</code> struct ? the <code>user1</code> &amp; <code>user2</code> should come from the <code>&amp;y</code> parsed data and should be filled just when the value <code>app1</code> is match in <code>both</code> structs"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 0, "last_activity_date": 1534098194, "creation_date": 1534098194, "answer_id": 51811647, "question_id": 51803219, "link": "https://stackoverflow.com/questions/51803219/how-to-update-value-of-two-struct-efficiently/51811647#51811647", "title": "How to update value of two struct efficiently", "body": "<p>This question is definitely a duplicate but I can't find one to link right now.</p>\n\n<p>Your problem is that the for loop is creating a copy of each struct. Writing into <code>element</code> which is just a copy of <code>xtr[i]</code> never changes the original <code>xtr[i]</code>. What you do to fix it is to use the slice index instead.</p>\n\n<p>Change</p>\n\n<pre><code>for _, element := range xtr {\n    switch element.vType {\n    case \"app1\":\n        //user1 value is coming from the &amp;y parsed data of the yaml\n        element.vType = \"user1\"\n    case \"app2\":\n         //user2 value is coming from the &amp;y parsed data\n        element.vType = \"user2\"\n\n    }\n}\n</code></pre>\n\n<p>Into</p>\n\n<pre><code>for i := range xtr {\n    switch xtr[i].vType {\n    case \"app1\":\n        //user1 value is coming from the &amp;y parsed data of the yaml\n        xtr[i].vType = \"user1\"\n    case \"app2\":\n         //user2 value is coming from the &amp;y parsed data\n        xtr[i].vType = \"user2\"\n\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534192457, "post_id": 51830065, "comment_id": 90614664, "body": "Sorry but I dont understand how you solve the issue ? the properties values which needs to be modified is still hard-coded like  <code>GCP</code> and <code>amazon</code> which should come from the external config when there is a match"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534192609, "post_id": 51830065, "comment_id": 90614715, "body": "see my comments inside the switch, I&#39;ve hard-coded the value but it should come from the <code>extrnal_config</code> yaml file when there is a match"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534192613, "post_id": 51830065, "comment_id": 90614719, "body": "@JhonD I have solved the issue in which you are unable to change the value of internalConfig struct. from app1 to GCP"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534192659, "post_id": 51830065, "comment_id": 90614738, "body": "@JhonD I am updating my code by looping over external config. Just wait for a while."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534192747, "post_id": 51830065, "comment_id": 90614780, "body": "Sure this is the real issue here :) , take your time, I need to leave the office and connect again in few hours, Thanks. please it should be efficient as much as possible"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534192818, "post_id": 51830065, "comment_id": 90614817, "body": "@JhonD I will resolve it no issue, just tell me in external config model array <code>Models:[{AppType:app3 ServiceType:AZURE} {AppType:app4&#205; ServiceType:HEROKU}]</code> with which type you wants to check in switch to change the value.  <code>AppType</code> or <code>ServiceType</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534193378, "post_id": 51830065, "comment_id": 90615043, "body": "@JhonD I have edited my answer to loop though <code>extrnal_config</code> yaml to get the <code>AppType</code> in switch to change the value of <code>internal_config</code>. Please check the code."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534193542, "post_id": 51830065, "comment_id": 90615115, "body": "well,  it shouldnt be <code>int_cfg.Models[i].Type = &quot;GCP&quot;</code> , the &#39;GCP` value should come from <code>extrnal_config </code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534193669, "post_id": 51830065, "comment_id": 90615172, "body": "Sorry I really need to leave now for few hours, see that this <code>int_cfg.Models[i].Type = &quot;GCP&quot;</code> should changed to something like <code>int_cfg.Models[i].Type = ext_config.models.app-type</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534193725, "post_id": 51830065, "comment_id": 90615197, "body": "i&#39;ll ping you in few hours :)  I need to leave, see my last comment, it will be great if you can add some unit test that we can verify , i&#39;ll check the secnrio and i&#39;ll close the question with bounty . bye for now and thank you"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534234558, "post_id": 51830065, "comment_id": 90626766, "body": "HI thanks 1+ , I&#39;ve checked it and first 1. we should update for <code>zone1</code> as this is the value for the landscape 2. is should be the <code>service-type</code> value but this not a problem I just change the name 3. it will be great if you can provide a <code>unit test</code> for the convert function that we can validate all the use cases according to the <code>in</code> and <code>out</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534832219, "post_id": 51830065, "comment_id": 90834735, "body": "Done :) thank you for the quick response and support"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1534785213, "last_edit_date": 1534785213, "creation_date": 1534191976, "answer_id": 51830065, "question_id": 51803219, "link": "https://stackoverflow.com/questions/51803219/how-to-update-value-of-two-struct-efficiently/51830065#51830065", "title": "How to update value of two struct efficiently", "body": "<p>Golang FAQ described regarding pointers to maps and slice:</p>\n\n<blockquote>\n  <p>Map and slice values behave like pointers: they are descriptors that\n  contain pointers to the underlying map or slice data. Copying a map or\n  slice value doesn't copy the data it points to. Copying an interface\n  value makes a copy of the thing stored in the interface value. If the\n  interface value holds a struct, copying the interface value makes a\n  copy of the struct. If the interface value holds a pointer, copying\n  the interface value makes a copy of the pointer, but again not the\n  data it points to.</p>\n</blockquote>\n\n<p>On iterating through the slice of model inside <code>ConvertType</code> you are actually creating a copy of <code>[]Models</code> slice whose value.Type is not changing the value of original struct due that reason. </p>\n\n<pre><code>for _, module := range int_cfg.models{}\n</code></pre>\n\n<p>Above code snippet is creating a copy of <code>int_cfg.models{}</code>.</p>\n\n<p>Index the slice model to point to the exact underlying array of slice Model to change the value as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\n//internal config model for parsing\n\ntype InternalModel struct {\n    Models []Model2 `yaml:\"models\"`\n}\n\ntype Model2 struct {\n    Name   string `yaml:\"name\"`\n    Type   string `yaml:\"type\"`\n    Target string `yaml:\"target\"`\n}\n\nvar internal_config = []byte(`\n  models:\n    - name: myapp\n      type: app1\n      target: ./\n\n    - name: myapp2\n      type: app2\n      target: ./\n`)\n\ntype ExternalConfig struct {\n    Landscape []Zone `yaml:\"Landscape\"`\n}\n\ntype Zone struct {\n    Zone   string  `yaml:\"zone\"`\n    Models []Model `yaml:\"models\"`\n}\n\ntype Model struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\nvar external_config = []byte(`\nLandscape:\n  - zone: zone1\n    models:\n     - app-type: app1\n       service-type: GCP\n     - app-type: app2\n       service-type: AMAZON\n  - zone: zone2\n    models:\n     - app-type: app3\n       service-type: AZURE\n     - app-type: app4\u00cd\n       service-type: HEROKU\n`)\n\nfunc main() {\n\n    //This is the internal config which needs to be update\n\n    internalConfiglYaml := InternalModel{}\n\n    err := yaml.Unmarshal(internal_config, &amp;internalConfiglYaml)\n    if err != nil {\n        log.Fatalf(\"error in model internalConfiglYaml: %v\", err)\n    }\n    fmt.Printf(\"%+v\\n\", internalConfiglYaml)\n\n    //--------------------------Second config file-----------------------//\n    //This is the external config yaml\n\n    extConfigYaml := ExternalConfig{}\n    // var response interface{}\n\n    err = yaml.Unmarshal(external_config, &amp;extConfigYaml)\n    if err != nil {\n        log.Fatalf(\"error in model extConfigYaml: %v\", err)\n    }\n    fmt.Printf(\"%+v\\n\", extConfigYaml)\n\n    landscape := \"zone1\"\n\n    modifiedConfig := ConvertTypes(&amp;internalConfiglYaml, extConfigYaml, landscape)\n\n    fmt.Printf(\"%+v\\n\", modifiedConfig)\n\n}\n\n// ConvertTypes for changing the intConfig struct types\nfunc ConvertTypes(int_cfg *InternalModel, ext_config ExternalConfig, landscape string) (out_cfg *InternalModel) {\n\n    for _, module := range ext_config.Landscape {\n        if module.Zone == landscape {\n            for i, value := range module.Models {\n                switch strings.Compare(value.AppType, int_cfg.Models[i].Type) {\n                case 0:\n                    //here I hard-coded the value \"GCP\" but it should come from the yaml struct after parsing\n                    int_cfg.Models[i].Type = value.ServiceType // should be something like ext_config.models.service-type when the key in the struct\n                default:\n                }\n            }\n        }\n    }\n\n    return int_cfg\n}\n</code></pre>\n\n<p>If you check above code snippet, you will also recognize that I have changed the struct.</p>\n\n<pre><code>type InternalModel struct {\n    models []Model2 `yaml:\"models\"`\n}\n</code></pre>\n\n<p>to first letter uppercase to make it exportable as:</p>\n\n<pre><code>type InternalModel struct {\n    Models []Model2 `yaml:\"models\"`\n}\n</code></pre>\n\n<p>Because of the struct <code>InternalModel</code> is unexportable field <code>model</code> was unable to parse the provided <code>internal_config</code> yaml which leads to empty []slice data after unmarshal yaml.</p>\n\n<p>One more thing that I have noticed is you are converting bytes into bytes again. There is no need for that.</p>\n\n<pre><code>err := yaml.Unmarshal([]byte(internal_config), &amp;internalConfiglYaml)\n</code></pre>\n\n<p>So I have changed it to just:</p>\n\n<pre><code>err := yaml.Unmarshal(internal_config, &amp;internalConfiglYaml)\n</code></pre>\n\n<p>Since <code>internal_config</code> is already declared as byte using <code>[]byte</code> in global variable.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1534747218, "post_id": 51913116, "comment_id": 90799867, "body": "HI, can you please elaborate on <code>fixed the pass-by-pointer and range loop assignment problems</code>  , ? why it&#39;s bad using it like @Himanshu suggested"}], "tags": [], "owner": {"reputation": 846, "user_id": 855419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SnXQL.jpg?s=128&g=1", "display_name": "Matthew D.", "link": "https://stackoverflow.com/users/855419/matthew-d"}, "is_accepted": false, "score": 2, "last_activity_date": 1534632877, "creation_date": 1534632877, "answer_id": 51913116, "question_id": 51803219, "link": "https://stackoverflow.com/questions/51803219/how-to-update-value-of-two-struct-efficiently/51913116#51913116", "title": "How to update value of two struct efficiently", "body": "<p>If you're looking for how to apply the <strong>app-type</strong> to <strong>service-type</strong> mapping from the <code>ExternalConfig</code>, I suggest converting the array into a map and using it to look up the mapping:</p>\n\n<pre><code>func ConvertTypes(intCfg *InternalModel, extCfg ExternalConfig, landscape string) {\n    // Make an app-type to service-type map.\n    appToSvc := make(map[string]string, len(extCfg.Landscape.Models))\n    for _, m := range extCfg.Landscape.Models {\n        appToSvc[m.AppType] = m.ServiceType\n    }\n\n    // For each InternalModel model, check if there's an app-type to service-type\n    // mapping. If so, use the service-type instead of the app-type.\n    for i, model := range intCfg.Models {\n        if t, ok := appToSvc[model.Name]; ok {\n            intCfg.Models[i].Type = t\n        }\n    }\n}\n</code></pre>\n\n<p>I've also fixed the pass-by-pointer and range loop assignment problems as suggested by @Himanshu and @Zan Lynx.</p>\n"}, {"tags": [], "owner": {"reputation": 104, "user_id": 10070765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G9ZAN.png?s=128&g=1", "display_name": "Zanicar", "link": "https://stackoverflow.com/users/10070765/zanicar"}, "is_accepted": false, "score": 1, "last_activity_date": 1534764141, "creation_date": 1534764141, "answer_id": 51929692, "question_id": 51803219, "link": "https://stackoverflow.com/questions/51803219/how-to-update-value-of-two-struct-efficiently/51929692#51929692", "title": "How to update value of two struct efficiently", "body": "<p>The first thing to consider is that you are working with two structures that are defined at run-time, thus you will not be able to use a single loop to match them. The next thing to consider is that your InternalConfig is the one least likely to change and should thus be the first structure to parse, where after the ExternalConfig is parsed and matched with it.</p>\n\n<p>From reading your question, comments and the provided answers it also seems that there are a number of assumptions on the board which few have alluded to. I will attempt to address these if possible.</p>\n\n<p>So let's give it a go:</p>\n\n<pre><code>package main\n\nimport (\n    // import standard library packages first (alphabetically)\n    \"fmt\"\n    \"log\"\n\n    // import third party packages next (also alphabetically)\n    \"gopkg.in/yaml.v2\"\n\n    // finally import your own packages here\n)\n\n// InternalConfig\n//   - Let's call it InternalConfig so as to ensure consistent naming standards\ntype InternalConfig struct {\n    Models []Imodel `yaml:\"models\"`\n    // Exported to ensure access to external packages (such as yaml)\n}\n\n// Imodel - The internal model struct\ntype Imodel struct {\n    Name   string `yaml:\"name\"`\n    Type   string `yaml:\"type\"`\n    Target string `yaml:\"target\"`\n}\n\nvar iCfgb = []byte(`\nmodels:\n   - name: myapp\n     type: app1\n     target: ./\n\n   - name: myapp2\n     type: app2\n     target: ./\n`)\n\ntype ExternalConfig struct {\n    Landscape Zone `yaml:\"Landscape\"`\n}\n\ntype Zone struct {\n    Zone   string  `yaml:\"zone\"`\n    Models []Emodel `yaml:\"models\"`\n}\n\ntype Emodel struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\n\nvar eCfgb = []byte(`\nLandscape:\n  zone: zone1\n  models:\n    - app-type: app1\n      service-type: GCP\n    - app-type: app2\n      service-type: AMAZON\n  zone: zone2\n  models:\n    - app-type: app3\n      service-type: AZURE\n    - app-type: app4\u00cd\n      service-type: HEROKU\n`)\n\nfunction main() {\n    iCfgYaml := InternalConfig{}\n    // don't need []byte(iCfgb) as iCfgb is already a byte slice\n    // We are also using a shorthand if statement as we will only use err in the\n    // if scope, this is because our config is passed by reference and not value\n    if err := yaml.Unmarshal(iCfgb, &amp;iCfgYaml); err != nil {\n        log.Fatalf(\"error in model InternalConfig: %v\", err)\n    }\n\n    eCfgYaml := ExternalConfig{}\n    if err := yaml.Unmarshal(eCfgb, &amp;eCfgYaml); err != nil {\n        log.Fatalf(\"error in model ExternalConfig: %v\", err)\n    }\n\n    // From here there are clearly some assumptions made, here is my take:\n    //   1. I do not see any purpose in the landscape variable, the value \"zone1\"\n    //      can be obtained from eCfgYaml.Landscape.Zone;\n    //   2. From the question it seems you want to update the InternalConfig\n    //      values with values from the ExternalConfig. However, from the code you\n    //      created a modified copy. I will assume this was for debugging purposes\n    //      and skip the creating of another copy;\n\n    // I have renamed ConvertTypes to UpdateInternalState to accurately reflect\n    // the behavior of the function. It now returns an error instead of a copy of\n    // InternalConfig (any state altering functions should most likely return an\n    // error). It receives a pointer of InternalConfig and a value copy of\n    // ExternalConfig. This is because we will be altering the state of\n    // InternalConfig\n    if err := UpdateInternalState(&amp;iCfgYaml, eCfgConfig); err != nil {\n        log.Fatalf(\"Error updating internal config: %v\", err)\n    }\n\n    // Assume the print is for debugging, thus I denote it with DBG. Makes it easy\n    // to find and remove from production code.\n    fmt.Printf(\"DBG: %+v\\n\", iCfgYaml)\n}\n\nfunc UpdateInternalState(iCfg *InternalConfig, eCfg ExternalConfig) error {\n    // Firstly, we need to track the internal config models. We will create an\n    // index lookup map (ilm) for it.\n    ilm := make(map[string]int)\n\n    // Now we iterate through our internal models and update the index:\n    for i, v := range iCfg.Models {\n        ilm[v] = i\n    }\n\n    // Now we iterate through the external config and update the internal config\n    // state accordingly:\n    for _, em := range eCfg.Landscape.Models {\n        // We find the index of the specified app type in the index lookup\n        // We use a shorthand if statement as we will only use i and ok within\n        // the scope of the if (if you need it outside you can't use shorthand)\n        // If there is no match nothing happens, but if found it will update to\n        // the corresponding specified value in the external config.\n        if i, ok := ilm[em.AppType]; ok {\n            iCfg.Models[i].Type = em.ServiceType\n        }\n    }\n\n    // At any point within this function you are able to do more robust error\n    // checking, such as ensuring the index lookup map must have a corresponding\n    // entry, and return any errors encountered.\n    return nil\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 672, "favorite_count": 1, "accepted_answer_id": 51830065, "answer_count": 4, "score": 7, "last_activity_date": 1534833382, "creation_date": 1534017190, "last_edit_date": 1534833382, "question_id": 51803219, "link": "https://stackoverflow.com/questions/51803219/how-to-update-value-of-two-struct-efficiently", "title": "How to update value of two struct efficiently", "body": "<p>I have the following code which parses YAML files and needs to match values from one struct <code>external</code> and update the <code>internal</code> struct's <code>type</code> property.</p>\n\n<p>For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n    \"log\"\n)\n\n//internal config model for parsing\n\ntype InternalModel struct {\n    models []Model2 `yaml:\"models\"`\n}\n\ntype Model2 struct {\n    Name   string `yaml:\"name\"`\n    Type   string `yaml:\"type\"`\n    Target string `yaml:\"target\"`\n}\n\nvar internal_config = []byte(`\n models:\n   - name: myapp\n     type: app1\n     target: ./\n\n   - name: myapp2\n     type: app2\n     target: ./\n`)\n\ntype ExternalConfig struct {\n    Landscape Zone `yaml:\"Landscape\"`\n}\n\ntype Zone struct {\n    Zone   string  `yaml:\"zone\"`\n    Models []Model `yaml:\"models\"`\n}\n\ntype Model struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\n\nvar external_config = []byte(`\nLandscape:\n  zone: zone1\n  models:\n    - app-type: app1\n      service-type: GCP\n    - app-type: app2\n      service-type: AMAZON\n  zone: zone2\n  models:\n    - app-type: app3\n      service-type: AZURE\n    - app-type: app4\u00cd\n      service-type: HEROKU\n`)\n\nfunc main() {\n\n    // This is the internal config which needs updated\n\n    internalConfiglYaml := InternalModel{}\n\n    err := yaml.Unmarshal([]byte(internal_config), &amp;internalConfiglYaml)\n    if err != nil {\n        log.Fatalf(\"error in model internalConfiglYaml: %v\", err)\n    }\n    //fmt.Printf(\"%+v\\n\", internalConfiglYaml)\n\n    //--------------------------Second config file-----------------------//\n    //This is the external config yaml\n\n    extConfigYaml := ExternalConfig{}\n\n    err = yaml.Unmarshal([]byte(external_config), &amp;extConfigYaml)\n    if err != nil {\n        log.Fatalf(\"error in model extConfigYaml: %v\", err)\n    }\n    fmt.Printf(\"%+v\\n\", extConfigYaml)\n\n    landscape := \"zone1\"\n\n    modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape)\n\n    fmt.Printf(\"%+v\\n\", modifiedConfig)\n\n}\n\nfunc ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) {\n\n    for _, module := range int_cfg.models {\n\n        switch module.Type {\n        case \"app1\":\n            //here I hard-coded the value \"GCP\" but it should come from the yaml struct after parsing\n            module.Type = \"GCP\" // should be something like ext_config.models.service-type when the key in the struct\n        case \"app2\":\n            //here I hard-coded the value \"AMAZON\" but it should come from the yaml struct after parsing\n            module.Type = \"AMAZON\"\n\n        }\n    }\n\n    return int_cfg\n}\n\n//At the end what I need to do is to get the internal yaml file to be changed to the following struct\n//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby\n\n//internal_config_after_changes := []byte(`\n//\n//\n//models:\n// - name: myapp\n//   type: GCP\n//   target: ./\n//\n// - name: myapp2\n//   type: AMAZON\n//   target: ./\n//\n//\n//`)\n</code></pre>\n\n<p>At the end what I need to do is to get the internal yaml file to be changed to the struct above <code>internal_config_after_changes</code> \n    <strong>The changes are</strong> when the <code>type=app-type</code> I need to <strong>modify</strong> the <code>type</code> value in the <code>internal_config</code>, here from <code>app1</code> to <code>GCP</code> and <code>app2</code> to <code>amazon</code></p>\n\n<p>The problem is with the second loop which I should use to iterate on the <code>external_config</code> and the matching values, I'm not sure how to combine them both with efficient way...</p>\n"}, {"tags": ["dictionary", "go", "slice", "type-assertion"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534173136, "post_id": 51803215, "comment_id": 90605163, "body": "Can you show the code you used to get the undesired result?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1534018433, "creation_date": 1534018433, "answer_id": 51803401, "question_id": 51803215, "link": "https://stackoverflow.com/questions/51803215/golang-type-assertion-for-list-of-items/51803401#51803401", "title": "Golang type assertion for list of items", "body": "<p>You wrote the type of the value is <code>[]interface{}</code>, so then do a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> asserting that type.</p>\n\n<p>Also note that you first have to type assert, and index later, e.g.:</p>\n\n<pre><code>outputs := result[\"outputs\"].([]interface{})\n\nfirstOutput := outputs[0]\n</code></pre>\n\n<p>Also note that the (static) type of <code>firstOutput</code> will again be <code>interface{}</code>. To access its content, you will need another type assertion, most likely a <code>map[string]interface{}</code> or a <code>map[interface{}]interface{}</code>.</p>\n\n<p>If you can, model your data with structs so you don't have to do this \"type assertion nonsense\".</p>\n\n<p>Also note that there are 3rd party libs that support easy \"navigation\" inside dynamic objects such as yours. For one, there's <a href=\"https://github.com/icza/dyno\" rel=\"nofollow noreferrer\"><code>github.com/icza/dyno</code></a> (disclosure: I'm the author).</p>\n\n<p>Using <code>dyno</code>, getting the first output would be like:</p>\n\n<pre><code>firstOutput, err := dyno.Get(result, \"outputs\", 0)\n</code></pre>\n\n<p>To get the country of the first output:</p>\n\n<pre><code>country, err := dyno.Get(result, \"outputs\", 0, \"country\")\n</code></pre>\n\n<p>You can also \"reuse\" previously looked up values, like this:</p>\n\n<pre><code>firstOutput, err := dyno.Get(result, \"outputs\", 0)\n// check error\ncountry, err := dyno.Get(firstOutput, \"country\")\n// check error\n</code></pre>\n"}], "owner": {"reputation": 16594, "user_id": 1050619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/784ade8d4151295e24765ffc4fcd60b4?s=128&d=identicon&r=PG", "display_name": "user1050619", "link": "https://stackoverflow.com/users/1050619/user1050619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1877, "favorite_count": 0, "accepted_answer_id": 51803401, "answer_count": 1, "score": 0, "last_activity_date": 1534018680, "creation_date": 1534017178, "last_edit_date": 1534018680, "question_id": 51803215, "link": "https://stackoverflow.com/questions/51803215/golang-type-assertion-for-list-of-items", "title": "Golang type assertion for list of items", "body": "<p>Im calling a API and it returns a dictionary(map) with a list of items as values.</p>\n\n<p>For ex:-</p>\n\n<pre><code>result= {'outputs':[{'state':'md','country':'us'}, {'state':'ny','country':'ny'}]}\n</code></pre>\n\n<p>The above data is how the data represented in python.</p>\n\n<p>In Python, I directly use result['outputs'][0] to access the list of elements in the list.</p>\n\n<p>In Golang, the same API returns the data but when I try to access the data as result['outputs'][0]</p>\n\n<p>Get this error:-</p>\n\n<pre><code>invalid operation: result[\"outputs\"][0] (type interface {} does not support indexing)\n</code></pre>\n\n<p>Looks like I need to do a type conversion, what should I use to type convert, \nI tried this </p>\n\n<pre><code>result[\"outputs\"][0].(List)\nresult[\"outputs\"][0].([])\n</code></pre>\n\n<p>but both throws me an error.</p>\n\n<p>I checked the type of the returned item and this is it  - []interface {}</p>\n\n<p>What should be my type conversion?</p>\n"}, {"tags": ["templates", "go", "menu", "nested"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534173182, "post_id": 51802806, "comment_id": 90605190, "body": "What is the issue you&#39;re having?"}, {"owner": {"reputation": 29, "user_id": 4763271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TLRyuGrfBic/AAAAAAAAAAI/AAAAAAAAAEo/HdUXQxvp2l0/photo.jpg?sz=128", "display_name": "bajro lisi\u0107", "link": "https://stackoverflow.com/users/4763271/bajro-lisi%c4%87"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534177833, "post_id": 51802806, "comment_id": 90607905, "body": "You see from this picture I get repeated output I dont know how to prevent it"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534177979, "post_id": 51802806, "comment_id": 90607976, "body": "Can you show the go code that&#39;s used to build the model and execute the template? The template by itself didn&#39;t give much insight."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534267212, "post_id": 51802806, "comment_id": 90646743, "body": "OK, but we will need to see the code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1534267370, "post_id": 51802806, "comment_id": 90646818, "body": "That&#39;s really difficult to read in a comment, can you edit your question to add the code necessary to reproduce the issue?"}, {"owner": {"reputation": 29, "user_id": 4763271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TLRyuGrfBic/AAAAAAAAAAI/AAAAAAAAAEo/HdUXQxvp2l0/photo.jpg?sz=128", "display_name": "bajro lisi\u0107", "link": "https://stackoverflow.com/users/4763271/bajro-lisi%c4%87"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1534267518, "post_id": 51802806, "comment_id": 90646898, "body": "I update now my post I hope it help @Adrian"}], "owner": {"reputation": 29, "user_id": 4763271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TLRyuGrfBic/AAAAAAAAAAI/AAAAAAAAAEo/HdUXQxvp2l0/photo.jpg?sz=128", "display_name": "bajro lisi\u0107", "link": "https://stackoverflow.com/users/4763271/bajro-lisi%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534267474, "creation_date": 1534013805, "last_edit_date": 1534267474, "question_id": 51802806, "link": "https://stackoverflow.com/questions/51802806/golang-nested-menu-repeat", "title": "Golang nested menu repeat", "body": "<p>I have problem with printing nested menu to template. This is what I get\n<a href=\"https://i.stack.imgur.com/mxRwR.png\" rel=\"nofollow noreferrer\">how look right now</a> </p>\n\n<pre><code>  {{range $cat := .}}\n  {{if eq $cat.Parent 0}}\n  &lt;p&gt;{{$cat.Name}}&lt;/p&gt;\n  {{end}}\n\n  {{ $a := ima $cat.ID}}\n    {{template \"childs\" $a}}\n  {{end}}\n   {{define \"childs\"}}\n    {{if .}}\n  &lt;ul&gt;\n    {{range . }}\n    &lt;li class=\"post\"&gt;\n      &lt;div class=\"postHead\"&gt;\n        &lt;div class=\"postTitle\"&gt;\n          &lt;b&gt;{{.Name}}&lt;/b&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n\n      {{ $a := ima .ID}}\n    {{template \"childs\" $a}}\n  {{end}}\n    &lt;/li&gt;\n    {{end}}\n  &lt;/ul&gt;\n  {{end}}\n</code></pre>\n\n<p>I just don't know how to skip duplicate, I try with every if condition what come to my mind but no success, function ima just return categories with parent id I pass</p>\n\n<p>this is function ima </p>\n\n<pre><code>func ima(id uint) []*Category {\n    categories := []Category{}\n    db.Where(\"parent = ?\", id).Find(&amp;categories)\nreturn categories\n}\n</code></pre>\n\n<p>and this is function who render my template </p>\n\n<pre><code>func omg(w http.ResponseWriter, r *http.Request) {\n    categories := []Category{}\n    db.Find(&amp;categories)\n    t, err := template.New(\"omg.html\").Funcs(template.FuncMap{\n        \"ima\": ima,\n\n    }).ParseFiles(\"templates/omg.html\")\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n    if err := t.Execute(w ,categories); err != nil {\n        fmt.Println(err)\n    }\n\n\n}\n</code></pre>\n"}, {"tags": ["json", "go", "stack-overflow", "unmarshalling"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1534014921, "post_id": 51802518, "comment_id": 90562137, "body": "It is the proper way to handle the json in between before unmarshalling into main struct. Another way is to try with <code>interface{}</code> but that will require type assertion"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1534077518, "post_id": 51802518, "comment_id": 90572884, "body": "Since both structs are the same (they have same fields), <code>*p = p2</code> should work."}, {"owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1534081359, "post_id": 51802518, "comment_id": 90573839, "body": "@KavehShahbazian Yeah! You seem right. But it&#39;s somehow disturbing to me to define nearly same struct twice."}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 1, "last_activity_date": 1534153724, "creation_date": 1534153724, "answer_id": 51819558, "question_id": 51802518, "link": "https://stackoverflow.com/questions/51802518/implementing-unmarshaller-without-using-a-temp-struct/51819558#51819558", "title": "implementing Unmarshaller without using a temp struct", "body": "<p>You could compose the fields that the marshaller can handle as an anonymous struct inside the <code>Platform</code> struct, something like:</p>\n\n<pre><code>type platformInner struct {\n    Status                CampaignStatus `json:\"status\" bson:\"status\"`\n    TotalBudget           int            `json:\"total_budget\" bson:\"totalBudget\"`\n    RemainingBudget       int            `json:\"remaining_budget\" bson:\"remainingBudget\"`\n    MillisecondsStartDate int64          `json:\"start_date\"`\n\n    MillisecondsEndDate   int64          `json:\"end_date\"`\n\n    Audiance              Audiance       `json:\"target_audiance\" bson:\"targetAudiance\"` //typo?\n    Creatives             Creatives      `json:\"creatives\" bson:\"Creatives\"`\n    Insights              Insights       `json:\"insights\" bson:\"insights\"`\n}\n\ntype Platform struct {\n    platformInner\n    StartDate             time.Time      `bson:\"startDate\"`\n    EndDate               time.Time      `bson:\"endDate\"`\n}\n</code></pre>\n\n<p>And then in the custom unmarshaller, unmarshal into the nested struct, and set the other values.</p>\n\n<pre><code>func (p *Platform) UnmarshalJSON(b []byte) (err error) {\n    var inner platformInner\n    err = json.Unmarshal(b, &amp;inner)\n    if err != nil {\n        return\n    }\n\n    tmp := &amp;Platform{\n        innerPlatform: inner,\n        StartDate:     time.Unix(0, inner.MillisecondsStartDate*int64(time.Millisecond/time.Nanosecond))\n        EndDate:       time.Unix(0, inner.MillisecondsEndDate*int64(time.Nanosecond/time.Microsecond))\n    }\n\n    *p = tmp\n\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1534176389, "creation_date": 1534176389, "answer_id": 51826476, "question_id": 51802518, "link": "https://stackoverflow.com/questions/51802518/implementing-unmarshaller-without-using-a-temp-struct/51826476#51826476", "title": "implementing Unmarshaller without using a temp struct", "body": "<p>Instead of duplicating the struct definition for the anonymous \"p2\" struct type you could alias it under a new name, such as \"PlatformTemp\" like so:</p>\n\n<pre><code>func (p *Platform) UnmarshalJSON(b []byte) (err error) {\n  type PlatformTemp Platform\n  var p2 PlatformTemp\n\n  err = json.Unmarshal(b, &amp;p2)\n  // ...\n\n  *p = Platform(p2)\n  return nil\n}\n</code></pre>\n\n<p>Since the types \"Platform\" and \"PlatformTemp\" have the same fields they can be assigned to each other with a simple cast; however, since \"PlatformTemp\" has no \"UnmarshalJSON\" method defined it will use the default unmarshaler.</p>\n"}], "owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 51819558, "answer_count": 2, "score": 0, "last_activity_date": 1534176389, "creation_date": 1534011412, "last_edit_date": 1534096125, "question_id": 51802518, "link": "https://stackoverflow.com/questions/51802518/implementing-unmarshaller-without-using-a-temp-struct", "title": "implementing Unmarshaller without using a temp struct", "body": "<p>There is an Unmarshaller implementation down below because of <code>time.Unix</code> does only accepts seconds or nanoseconds but my data source is in milliseconds. Before asking my questions here is some code</p>\n\n<p>Code:</p>\n\n<pre><code>type Platform struct {\n    Status                CampaignStatus `json:\"status\" bson:\"status\"`\n    TotalBudget           int            `json:\"total_budget\" bson:\"totalBudget\"`\n    RemainingBudget       int            `json:\"remaining_budget\" bson:\"remainingBudget\"`\n    MillisecondsStartDate int64          `json:\"start_date\"`\n    StartDate             time.Time      `bson:\"startDate\"`\n    MillisecondsEndDate   int64          `json:\"end_date\"`\n    EndDate               time.Time      `bson:\"endDate\"`\n    Audiance              Audiance       `json:\"target_audiance\" bson:\"targetAudiance\"` //typo?\n    Creatives             Creatives      `json:\"creatives\" bson:\"Creatives\"`\n    Insights              Insights       `json:\"insights\" bson:\"insights\"`\n}\n\nfunc (p *Platform) UnmarshalJSON(b []byte) (err error) {\n\n    p2 := struct {\n        Status                CampaignStatus `json:\"status\" bson:\"status\"`\n        TotalBudget           int            `json:\"total_budget\" bson:\"totalBudget\"`\n        RemainingBudget       int            `json:\"remaining_budget\" bson:\"remainingBudget\"`\n        MillisecondsStartDate int64          `json:\"start_date\"`\n        StartDate             time.Time      `bson:\"startDate\"`\n        MillisecondsEndDate   int64          `json:\"end_date\"`\n        EndDate               time.Time      `bson:\"endDate\"`\n        Audiance              Audiance       `json:\"target_audiance\" bson:\"targetAudiance\"` //typo?\n        Creatives             Creatives      `json:\"creatives\" bson:\"Creatives\"`\n        Insights              Insights       `json:\"insights\" bson:\"insights\"`\n    }{}\n\n    err = json.Unmarshal(b, &amp;p2)\n    if err != nil {\n        return\n    }\n\n    p2.StartDate = time.Unix(0, p2.MillisecondsStartDate*int64(time.Millisecond/time.Nanosecond))\n    p2.EndDate = time.Unix(0, p2.MillisecondsEndDate*int64(time.Nanosecond/time.Microsecond))\n\n    *p = p2\n\n    return\n}\n</code></pre>\n\n<p>My questions are </p>\n\n<ol>\n<li>Is there a way to implement Unmarshaller without creating a middle struct in this scenario? As you may see if I use the Platform type isntead of middle struct I get stack overflow error.  </li>\n<li>Could this approach ends up with memory leaks?</li>\n</ol>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1534047986, "post_id": 51801895, "comment_id": 90566966, "body": "args := []interface{&quot;TEST&quot;} Gives me an error  unexpected literal &quot;TEST&quot;, expecting method or interface name"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1534051820, "post_id": 51801895, "comment_id": 90567505, "body": "@ThunderCat yeah wasn&#39;t sure about that. In the end then, he just needs to add his <code>TEST</code> value to the <code>arr</code> string as well. Editing the answer, thanks"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1534051838, "last_edit_date": 1534051838, "creation_date": 1534006862, "answer_id": 51801895, "question_id": 51801744, "link": "https://stackoverflow.com/questions/51801744/gomodule-redigo-how-can-i-push-multiple-keys-to-redis/51801895#51801895", "title": "gomodule/redigo how can I push multiple keys to redis", "body": "<p>I don't have the library but from what I saw on their documentation, I guess that this should work:</p>\n\n<pre><code>conn.Do(\"RPUSH\", arr...)\n</code></pre>\n\n<p><code>...</code> is a parameter operator that unpacks the elements of your slice and passes as them separate arguments to a variadic function, which would be the same as this:</p>\n\n<pre><code>arr := []string{\"TEST\", \"a\", \"b\", \"c\", \"d\"}\n\nconn.Do(\"RPUSH\", \"TEST\", arr[0], arr[1], arr[2], arr[3])\n</code></pre>\n\n<p>More information can be found on variadic function in go <a href=\"https://blog.learngoprogramming.com/golang-variadic-funcs-how-to-patterns-369408f19085\" rel=\"nofollow noreferrer\">in this very complete article</a></p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1534034238, "creation_date": 1534034238, "answer_id": 51804820, "question_id": 51801744, "link": "https://stackoverflow.com/questions/51801744/gomodule-redigo-how-can-i-push-multiple-keys-to-redis/51804820#51804820", "title": "gomodule/redigo how can I push multiple keys to redis", "body": "<p>Build a slice of the arguments and call the variadic function with those arguments:</p>\n\n<pre><code> args := []interface{\"TEST\")\n for _, v := range arr {\n   args = append(args, v)\n }\n conn.Do(\"RPUSH\", args...)\n</code></pre>\n\n<p>The <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#Args\" rel=\"nofollow noreferrer\">Args</a> helper does the same thing with a single line of application code:</p>\n\n<pre><code> conn.Do(\"RPUSH\", edis.Args{}.Add(\"TEST\").AddFlat(arr)...)\n</code></pre>\n"}], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1450, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1534051838, "creation_date": 1534005612, "question_id": 51801744, "link": "https://stackoverflow.com/questions/51801744/gomodule-redigo-how-can-i-push-multiple-keys-to-redis", "title": "gomodule/redigo how can I push multiple keys to redis", "body": "<p>I am trying to rpush multiple elements to a redis key. Currently using a redis pool connection using <a href=\"https://github.com/gomodule/redigo\" rel=\"nofollow noreferrer\">https://github.com/gomodule/redigo</a>. </p>\n\n<p>If I try to put an array into rpush , a string with the array concatenated is pushed. How can I push individual elements instead</p>\n\n<pre><code>conn := Pool.Get() // A redigo redis pool \narr := []string{\"a\", \"b\", \"c\", \"d\"}\nconn.Do(\"RPUSH\",\"TEST\",\"x\",\"y\") // This works\nconn.Do(\"RPUSH\", \"TEST\", arr) //This does not work\n</code></pre>\n"}, {"tags": ["javascript", "jquery", "ajax", "go", "fetch"], "comments": [{"owner": {"reputation": 8252, "user_id": 6634591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eHVdG.jpg?s=128&g=1", "display_name": "Luca Kiebel", "link": "https://stackoverflow.com/users/6634591/luca-kiebel"}, "edited": false, "score": 2, "creation_date": 1534003439, "post_id": 51801429, "comment_id": 90559205, "body": "Why do you have the <code>body: JSON.stringify(postData)</code> commented out? That should work"}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 8252, "user_id": 6634591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eHVdG.jpg?s=128&g=1", "display_name": "Luca Kiebel", "link": "https://stackoverflow.com/users/6634591/luca-kiebel"}, "edited": false, "score": 0, "creation_date": 1534003562, "post_id": 51801429, "comment_id": 90559231, "body": "@Luca haha! ok yes it did!   I wonder why it didn&#39;t work before...must have been tired and didn&#39;t notice the success response."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 8252, "user_id": 6634591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eHVdG.jpg?s=128&g=1", "display_name": "Luca Kiebel", "link": "https://stackoverflow.com/users/6634591/luca-kiebel"}, "edited": false, "score": 0, "creation_date": 1534004004, "post_id": 51801429, "comment_id": 90559380, "body": "Actually, looks like I needed <code>&#39;Content-Type&#39;: &#39;application&#47;x-www-form-urlencoded&#39;</code> along with <code>body: JSON.stringify(postData)</code> together"}], "answers": [{"comments": [{"owner": {"reputation": 5056, "user_id": 1196988, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/Ih3Vl.jpg?s=128&g=1", "display_name": "Chris Nevill", "link": "https://stackoverflow.com/users/1196988/chris-nevill"}, "edited": false, "score": 1, "creation_date": 1570007098, "post_id": 51801525, "comment_id": 102774976, "body": "Minor note - you seem to define sendType but not use it."}], "tags": [], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "is_accepted": true, "score": 1, "last_activity_date": 1534004329, "last_edit_date": 1534004329, "creation_date": 1534003967, "answer_id": 51801525, "question_id": 51801429, "link": "https://stackoverflow.com/questions/51801429/replacing-jquery-ajax-with-fetch-to-a-go-rest-api-endpoint-empty-payload/51801525#51801525", "title": "Replacing jQuery.ajax() with fetch() to a Go REST API endpoint - empty payload", "body": "<p>Ok, I found the right combination of settings for my fetch() call to be this:</p>\n\n<pre><code>let sendUrl = \"http://192.168.11.241:8000/user\";\nlet sendType = \"POST\";\n\nlet data = {\"userid\":1};\nconst postData = \"data=\"+JSON.stringify(data);\nfetch(sendUrl, {\n  method: \"POST\",\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n  },\n  body: postData\n});\n</code></pre>\n\n<p>I had to re-work the structure of my <code>postData</code> object and also change the <code>content-type</code></p>\n"}, {"tags": [], "owner": {"reputation": 54, "user_id": 9033449, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-s7xcgrqJSTM/AAAAAAAAAAI/AAAAAAAAABc/GHg-nz_Wjhw/photo.jpg?sz=128", "display_name": "Vishal Bondre", "link": "https://stackoverflow.com/users/9033449/vishal-bondre"}, "is_accepted": false, "score": 0, "last_activity_date": 1534016207, "creation_date": 1534016207, "answer_id": 51803109, "question_id": 51801429, "link": "https://stackoverflow.com/questions/51801429/replacing-jquery-ajax-with-fetch-to-a-go-rest-api-endpoint-empty-payload/51803109#51803109", "title": "Replacing jQuery.ajax() with fetch() to a Go REST API endpoint - empty payload", "body": "<p>remove quotes userid </p>\n\n<pre><code>let data = {userid:1};\n</code></pre>\n\n<p>and declare dataType in ajax function</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1743, "favorite_count": 1, "accepted_answer_id": 51801525, "answer_count": 2, "score": 1, "last_activity_date": 1534016207, "creation_date": 1534003279, "question_id": 51801429, "link": "https://stackoverflow.com/questions/51801429/replacing-jquery-ajax-with-fetch-to-a-go-rest-api-endpoint-empty-payload", "title": "Replacing jQuery.ajax() with fetch() to a Go REST API endpoint - empty payload", "body": "<p>I currently have a ReactJS web application that creates a POST or PUT request to a REST API endpoint.  The REST API is built with golang.</p>\n\n<p>Everything works fine when I use jQuery to make the Ajax POST request.  Here's a demonstration of the code:</p>\n\n<pre><code>// my jquery attempt\n\nlet sendUrl = \"http://192.168.11.241:8000/user\";\nlet sendType = \"POST\";\n\nlet data = {\"userid\":1};\nconst postData = [{name:\"data\",value:JSON.stringify(data)}];\n\nlet result = $.ajax({\n  type: \"POST\",\n  dataType: 'json',\n  cache: false,\n  url: sendUrl,\n  data: postData\n});\n</code></pre>\n\n<p>And here's what my REST API code looks like</p>\n\n<pre><code>// main.go\npackage main\n\nimport (\n  \"user\"\n  \"github.com/gorilla/mux\"\n  \"log\"\n  \"net/http\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/payment/{payment_type}\", user.Post).Methods(\"POST\",\"OPTIONS\")\n     log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n\n// user.go\nfunc Post(w http.ResponseWriter, r *http.Request) {\n  w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n  w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n  url := mux.Vars(r)\n  r.ParseForm()\n  qs := r.Form\n  fmt.Println(qs)\n}\n</code></pre>\n\n<p>When I run the JS and Go API code, I successfully see the <code>userid 1</code> content output to bash.</p>\n\n<p>Now I replace my javascript code with fetch call like this:</p>\n\n<pre><code>let sendUrl = \"http://192.168.11.241:8000/user\";\nlet sendType = \"POST\";\n\nlet data = {\"userid\":1};\nconst postData = [{name:\"data\",value:JSON.stringify(data)}];\n\nfetch(sendUrl, {\n  method: \"POST\",\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n  },\n  //body: JSON.stringify(postData)\n  body: {\"data\":JSON.stringify(data)}\n});\n</code></pre>\n\n<p>My Go API acknowledges a POST request is being made, but the post data is empty and I don't see the <code>userid 1</code>.  I tried different types of input for the body like with and without json.stringify, I tried different header information like <code>'Content-Type': 'application/x-www-form-urlencoded'</code>, or removing the headers all together, but the data continues to be empty when receiving with my go api.</p>\n\n<p>Anyone know what I'm doing wrong?</p>\n"}, {"tags": ["go", "types", "interface", "go-map"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1533998795, "post_id": 51800637, "comment_id": 90557932, "body": "I don&#39;t think there is a way to avoid using <code>reflect</code> if you want a map of types. By the way, when you make a map like this where only keys actually matter, I&#39;d recommend using <code>struct{}</code> as the value type instead of using <code>interface{}</code>. In go, the idiomatic way to represent an empty and useless value is <code>struct{}{}</code>."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1533998953, "post_id": 51800637, "comment_id": 90557980, "body": "IMO, the cleanest solution to your problem here is to simply call <code>Process</code> from <code>Handle</code> if the type is supported. You already know the type in <code>Handle</code> since you already are switching over it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 3, "creation_date": 1533999221, "post_id": 51800637, "comment_id": 90558068, "body": "I&#39;m still a bit of a noob at Go, but <i>&quot;some messages ... need post-processing&quot;</i> makes me think you should make <code>Postprocessor</code> an interface requiring a <code>Postprocess</code> method and only satisfy the interface on the types that need postprocessing. You&#39;d then use something like <code>if p, ok := message.(Postprocessor); ok { p.Postprocess(...) }</code> to avoid the need for another type switch. This choice also allows you to customize post-processing behavior for specific types, so you need not deal with a concrete &quot;registration&quot; type. Satisfying the interface = registration of the type for postprocessing."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1534000380, "post_id": 51800637, "comment_id": 90558397, "body": "Very good thinking @ChronoKitsune! You should probably post this as an answer, pretty sure this is a good solution to his/her problem."}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1534002942, "post_id": 51800637, "comment_id": 90559094, "body": "Indeed I have already thought of @ChronoKitsune &#39;s proposal as well. But it would be totally overkill to implement the <code>Process</code> method itself on every message type needed. Of course, I could just use a &quot;marker&quot; interface, e.g.  <code>type Postprocess interface {      NeedsPostprocess() bool }</code>  This looks a bit silly to me, as every msg type would implement just the same <code>func (c *ConcreteMsg) NeedsPostprocess() bool { return true}</code>, but I think that&#39;s the best we can aim for"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1534003237, "post_id": 51800637, "comment_id": 90559162, "body": "Would that work if I just embedded an implementation of <code>NeedsPostproces()</code> to every Msg type which needs postprocessing? I&#39;ll try a simple test to check."}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1534004221, "post_id": 51800637, "comment_id": 90559432, "body": "That seems to be working! @ChronoKitsune please provide your comment as an answer, I will accept it, but also add the solution I came up with based on yours. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 55899, "user_id": 58961, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5be12a5a883043ee47443e93217504b6?s=128&d=identicon&r=PG", "display_name": "John Leidegren", "link": "https://stackoverflow.com/users/58961/john-leidegren"}, "edited": false, "score": 0, "creation_date": 1553414224, "post_id": 51801640, "comment_id": 97370004, "body": "There is very much a way to use a Go type as a key in a map but you can&#39;t directly use an interface as a key. See my answer below <a href=\"https://stackoverflow.com/a/55321744/58961\">stackoverflow.com/a/55321744/58961</a> with that said, I think you should stick with your solution as-is right now, it seems more reasonable in your case, but this was the first thing I stumbled upon when I googled, Go type as map key, so I fixed it."}], "tags": [], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "is_accepted": false, "score": 3, "last_activity_date": 1534005224, "last_edit_date": 1534005224, "creation_date": 1534004825, "answer_id": 51801640, "question_id": 51800637, "link": "https://stackoverflow.com/questions/51800637/struct-type-as-map-key/51801640#51801640", "title": "struct type as map key", "body": "<p>As there is no possibility to set a type as the map key, I finally decided to implement the following solution, which is based on @Chrono Kitsune 's solution:</p>\n\n<pre><code>type Postprocess interface {\n    NeedsPostprocess() bool\n}\n\ntype MsgWithPostProcess struct {}\n\nfunc (p *MsgWithPostProcess) NeedsPostprocess() bool {\n  return true\n}\n\ntype Msg1 struct {\n   MsgWithPostProcess\n   //other stuff\n}\n\ntype Msg2 struct {\n    MsgWithPostProcess\n    //other stuff\n}\n\ntype Msg3 struct {\n    //no postprocessing needed\n}\n\nfunc (p *Postprocessor) Process(msgtype interface{}) error {\n     if _, ok := msgtype.(Postprocess); ok {\n        //do postprocessing\n     }         \n}\n</code></pre>\n\n<p>As of my simple test I did, only <code>Msg1</code> and <code>Msg2</code> will be postprocessed, but not <code>Msg3</code>, which is what I wanted.</p>\n"}, {"tags": [], "owner": {"reputation": 55899, "user_id": 58961, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5be12a5a883043ee47443e93217504b6?s=128&d=identicon&r=PG", "display_name": "John Leidegren", "link": "https://stackoverflow.com/users/58961/john-leidegren"}, "is_accepted": false, "score": 1, "last_activity_date": 1553414007, "creation_date": 1553414007, "answer_id": 55321744, "question_id": 51800637, "link": "https://stackoverflow.com/questions/51800637/struct-type-as-map-key/55321744#55321744", "title": "struct type as map key", "body": "<p>This question was the first hit I found on Google but the title is somewhat misleading. So I'll leave this here to add some food for thought with the title of the question in mind.</p>\n\n<p>First, the issue with maps is that its key must be an immutable value. This is why for example a slice cannot be used is a map key. A slice is a pointer of sorts to mutable data and it is therefore not allowed. You can use an array (fixed sized slice) but not a pointer to an array for the same reason.</p>\n\n<p>Second, you have in the <code>reflect.TypeOf(...).String()</code>a way to get a canonical string representation for types. Though it is not unambiguous unless you include the package path, as you can see here.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    s2 \"go/scanner\"\n    \"reflect\"\n    s1 \"text/scanner\"\n)\n\ntype X struct{}\n\nfunc main() {\n    fmt.Println(reflect.TypeOf(1).String())\n    fmt.Println(reflect.TypeOf(X{}).String())\n    fmt.Println(reflect.TypeOf(&amp;X{}).String())\n    fmt.Println(reflect.TypeOf(s1.Scanner{}).String())\n    fmt.Println(reflect.TypeOf(s2.Scanner{}).String())\n    fmt.Println(reflect.TypeOf(s1.Scanner{}).PkgPath(), reflect.TypeOf(s1.Scanner{}).String())\n    fmt.Println(reflect.TypeOf(s2.Scanner{}).PkgPath(), reflect.TypeOf(s2.Scanner{}).String())\n}\n</code></pre>\n\n<pre><code>int\nmain.X\n*main.X\nscanner.Scanner\nscanner.Scanner\ntext/scanner scanner.Scanner\ngo/scanner scanner.Scanner\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/NLODZNdik6r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NLODZNdik6r</a></p>\n\n<p>With this information, you can (if you feel so inclined) create a map which let's go from a <code>reflect.Type</code> to a key and back again, like this.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    s2 \"go/scanner\"\n    \"reflect\"\n    s1 \"text/scanner\"\n)\n\ntype TypeMap struct {\n    m []reflect.Type\n}\n\nfunc (m *TypeMap) Get(t reflect.Type) int {\n    for i, x := range m.m {\n        if x == t {\n            return i\n        }\n    }\n    m.m = append(m.m, t)\n    return len(m.m) - 1\n}\n\nfunc (m *TypeMap) Reverse(t int) reflect.Type {\n    return m.m[t]\n}\n\ntype X struct{}\n\nfunc main() {\n    var m TypeMap\n\n    fmt.Println(m.Get(reflect.TypeOf(1)))\n    fmt.Println(m.Reverse(0))\n\n    fmt.Println(m.Get(reflect.TypeOf(1)))\n    fmt.Println(m.Reverse(0))\n\n    fmt.Println(m.Get(reflect.TypeOf(1)))\n    fmt.Println(m.Reverse(0))\n\n    fmt.Println(m.Get(reflect.TypeOf(X{})))\n    fmt.Println(m.Reverse(1))\n\n    fmt.Println(m.Get(reflect.TypeOf(&amp;X{})))\n    fmt.Println(m.Reverse(2))\n\n    fmt.Println(m.Get(reflect.TypeOf(s1.Scanner{})))\n    fmt.Println(m.Reverse(3).PkgPath(), m.Reverse(3))\n\n    fmt.Println(m.Get(reflect.TypeOf(s2.Scanner{})))\n    fmt.Println(m.Reverse(4).PkgPath(), m.Reverse(4))\n}\n</code></pre>\n\n<pre><code>0\nint\n0\nint\n0\nint\n1\nmain.X\n2\n*main.X\n3\ntext/scanner scanner.Scanner\n4\ngo/scanner scanner.Scanner\n</code></pre>\n\n<p>In the above case I'm assuming that <code>N</code> is small. Also note the use of the identity of <code>reflect.TypeOf</code>, it will return the same pointer for the same type on subsequent calls.</p>\n\n<p>If N is not small, you may want to do something a bit more complex.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    s2 \"go/scanner\"\n    \"reflect\"\n    s1 \"text/scanner\"\n)\n\ntype PkgPathNum struct {\n    PkgPath string\n    Num     int\n}\n\ntype TypeMap struct {\n    m map[string][]PkgPathNum\n    r []reflect.Type\n}\n\nfunc (m *TypeMap) Get(t reflect.Type) int {\n    k := t.String()\n\n    xs := m.m[k]\n\n    pkgPath := t.PkgPath()\n    for _, x := range xs {\n        if x.PkgPath == pkgPath {\n            return x.Num\n        }\n    }\n\n    n := len(m.r)\n    m.r = append(m.r, t)\n    xs = append(xs, PkgPathNum{pkgPath, n})\n\n    if m.m == nil {\n        m.m = make(map[string][]PkgPathNum)\n    }\n    m.m[k] = xs\n\n    return n\n}\n\nfunc (m *TypeMap) Reverse(t int) reflect.Type {\n    return m.r[t]\n}\n\ntype X struct{}\n\nfunc main() {\n    var m TypeMap\n\n    fmt.Println(m.Get(reflect.TypeOf(1)))\n    fmt.Println(m.Reverse(0))\n\n    fmt.Println(m.Get(reflect.TypeOf(X{})))\n    fmt.Println(m.Reverse(1))\n\n    fmt.Println(m.Get(reflect.TypeOf(&amp;X{})))\n    fmt.Println(m.Reverse(2))\n\n    fmt.Println(m.Get(reflect.TypeOf(s1.Scanner{})))\n    fmt.Println(m.Reverse(3).PkgPath(), m.Reverse(3))\n\n    fmt.Println(m.Get(reflect.TypeOf(s2.Scanner{})))\n    fmt.Println(m.Reverse(4).PkgPath(), m.Reverse(4))\n}\n</code></pre>\n\n<pre><code>0\nint\n1\nmain.X\n2\n*main.X\n3\ntext/scanner scanner.Scanner\n4\ngo/scanner scanner.Scanner\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/2fiMZ8qCQtY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2fiMZ8qCQtY</a></p>\n\n<p>Note the subtitles of pointer to type, that, <code>X</code> and <code>*X</code> actually are different types.</p>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3718, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1553414007, "creation_date": 1533997780, "last_edit_date": 1534074223, "question_id": 51800637, "link": "https://stackoverflow.com/questions/51800637/struct-type-as-map-key", "title": "struct type as map key", "body": "<p>We have a following function:</p>\n\n<pre><code>func (h *Handler) Handle(message interface{}) error {\n    //here there is a switch for different messages\n    switch m := message.(type) {\n    }\n}\n</code></pre>\n\n<p>This signature is given and can't be changed. There are around 20 different message types the handler processes.</p>\n\n<p>Now, there are some of these messages (around 4) which need special post-processing. In a different package.</p>\n\n<p>Thus, I am thinking to do this like this:</p>\n\n<pre><code> func (h *Handler) Handle(message interface{}) error {\n        //here there is a switch for different messages\n\n        switch m := message.(type) {\n        }\n        //only post-process if original message processing succeeds\n        postProcessorPkg.Process(message)\n    }\n</code></pre>\n\n<p>Now, in the <code>Process</code> function, I want to quickly lookup if the message type is indeed of the ones we need postprocessing for. I don't want to do a <code>switch</code> again here. There are many handlers, in different packages, with varying amount of message types, and it should be generic.</p>\n\n<p>So I was thinking of registering the message type in the postprocessor and then just do a lookup:</p>\n\n<pre><code>func (p *Postprocessor) Register(msgtype interface{}) {\n     registeredTypes[msgtype] = msgtype\n}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>func (p *Postprocessor) Process(msgtype interface{}) error {\n     if ok := registeredTypes[msgtype]; !ok {\n        return errors.New(\"Unsupported message type\")\n     }\n     prop := GetProp(registeredTypes[msgtype])\n     doSmthWithProp(prop)\n}\n</code></pre>\n\n<p>This will all not work now because I can only \"register\" instances of the message, not the message type itself, as far as I know. Thus the map would only match a specific instance of a message, not its type, which is what I need.</p>\n\n<p>So I guess this needs redesign. I can completely ditch the registering and the map lookup, but</p>\n\n<ul>\n<li>I can't change the <code>Handle</code> function to a specific type (signature will need to remain <code>message interface{}</code></li>\n<li>I would like to avoid to have to use <code>reflect</code>, just because I will have a hard time defending such a solution with some colleagues.</li>\n</ul>\n"}, {"tags": ["go", "json-deserialization"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1533997203, "post_id": 51800506, "comment_id": 90557473, "body": "The json is an array, a Go struct is treated by the json package as an object. <code>[ ... ]</code> and <code>type SearchResponse struct { ... }</code> does not compute."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1533997663, "post_id": 51800506, "comment_id": 90557601, "body": "If your json is an array use Go slices, if it&#39;s an object use structs, or maps... <a href=\"https://play.golang.org/p/EYE4m76ngj7\" rel=\"nofollow noreferrer\">play.golang.org/p/EYE4m76ngj7</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1533997909, "post_id": 51800506, "comment_id": 90557668, "body": "Another option would be to have <code>SearchResponse</code> implement the <code>json.Unmarshaler</code> interface, then it could, for example, remove the surrounding angle brackets, split the array of results from the meta object and the unmarshal then two jsons separately into the two fields."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1533999170, "post_id": 51800506, "comment_id": 90558054, "body": "Small fix on the playground example, to actually unmarshal all fields &amp; log them in a clearer way: <a href=\"https://play.golang.org/p/IA6-QpeWDW5\" rel=\"nofollow noreferrer\">play.golang.org/p/IA6-QpeWDW5</a>"}, {"owner": {"reputation": 6255, "user_id": 163757, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/01b44077976666b4de7a7f252248419b?s=128&d=identicon&r=PG", "display_name": "user163757", "link": "https://stackoverflow.com/users/163757/user163757"}, "edited": false, "score": 1, "creation_date": 1534021649, "post_id": 51800506, "comment_id": 90563579, "body": "i appreciate both of your playground examples - they both are legitimate answers.  i would gladly accept either as the final answer - post as an answer instead of comment."}], "answers": [{"tags": [], "owner": {"reputation": 34, "user_id": 10267414, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--oDl9PaS9UQ/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOPpEgTOyrtaBHSJa3MS4_S_o1Q2Q/mo/photo.jpg?sz=128", "display_name": "Anderson lu", "link": "https://stackoverflow.com/users/10267414/anderson-lu"}, "is_accepted": false, "score": 1, "last_activity_date": 1535075442, "creation_date": 1535075442, "answer_id": 51996443, "question_id": 51800506, "link": "https://stackoverflow.com/questions/51800506/unmarshalling-a-tuple-that-has-no-keys-at-the-root-level/51996443#51996443", "title": "Unmarshalling a tuple that has no keys at the root level", "body": "<p>Just use this one <a href=\"https://github.com/Anderson-Lu/gofasion\" rel=\"nofollow noreferrer\">https://github.com/Anderson-Lu/gofasion</a>. It's easy.</p>\n\n<p>Gofasion is a lightweight parsing library that facilitates the parsing of interface JSON data during development. Its biggest feature is to support chained calls, which means that the target key name and key value can be directly obtained without pre-defining the structure of the data.</p>\n"}], "owner": {"reputation": 6255, "user_id": 163757, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/01b44077976666b4de7a7f252248419b?s=128&d=identicon&r=PG", "display_name": "user163757", "link": "https://stackoverflow.com/users/163757/user163757"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535075442, "creation_date": 1533996923, "last_edit_date": 1534074236, "question_id": 51800506, "link": "https://stackoverflow.com/questions/51800506/unmarshalling-a-tuple-that-has-no-keys-at-the-root-level", "title": "Unmarshalling a tuple that has no keys at the root level", "body": "<p>I'm trying to cut my teeth with golang, and figured parsing some json from a rest api is a good use case.  It looked to be as simple as defining a struct and unmarshaling the api response into that.</p>\n\n<p>Naturally the api response I am playing with is not exactly a great candidate for this.  I am playing with craigslist jsonsearch - and the response is an array of 2 objects. The first object is an array of results, the second object is misc. metadata.</p>\n\n<pre><code>[  \n   [  \n      {  \n         \"Ask\":6000,\n         \"CategoryID\":145,\n         \"ImageThumb\":\"https:\\/\\/images.craigslist.org\\/01212_dZ9PfxSmjEH_50x50c.jpg\",\n         \"Latitude\":39.591784,\n         \"Longitude\":-105.083209,\n         \"PostedDate\":1533949799,\n         \"PostingID\":6642987803,\n         \"PostingTitle\":\"1991 Jeep Wrangler YJ 4.0 4X4 $6000 OBO\",\n         \"PostingURL\":\"https:\\/\\/denver.craigslist.org\\/cto\\/d\\/1991-jeep-wrangler-yj-40-4xobo\\/6642987803.html\"\n      }\n   ],\n   {  \n      \"NonGeocoded\":2,\n      \"baseurl\":\"\\/\\/denver.craigslist.org\",\n      \"clat\":41.2077284889441,\n      \"clng\":-101.993919320865,\n      \"clustered\":0,\n      \"geocoded\":118,\n      \"zoom\":7\n   }\n]\n</code></pre>\n\n<p>The fact that neither of these objects have keys is where I am getting lost.</p>\n\n<p>I have created a struct that I believe should map to this response.  Without keys to as field tags, I am lost...  If there was only some way to say the first element in the response should map the the Results[] struct and the second item to the Metadata struct.</p>\n\n<pre><code>type SearchResponse struct {\n    Results []struct {\n        Ask int\n        CategoryID int\n        ImageThumb string\n        Latitude float32\n        Longitude float32\n        PostedDate int64\n        PostingID int64\n        PostingTitle string\n        PostingURL string\n    }`json:\"??first element??\"`\n    Metadata struct{\n        NonGeocoded int\n        baseurl string\n        clat float32\n        clng float32\n        clustered int\n        geocoded int\n        zoom int\n    }`json:\"??second element??\"`\n}\n\n\nfunc main() {\n\n    searchUrl := \"https://denver.craigslist.org/jsonsearch/cta?query=jeep+wrangler&amp;sort=rel&amp;max_price=15000&amp;auto_transmission=1\"\n    resp, _ := http.Get(searchUrl)\n    bytes, _ := ioutil.ReadAll(resp.Body)\n\n    var searchResp SearchResponse\n    if err := json.Unmarshal(bytes, &amp;searchResp); err != nil {\n        panic(err)\n    }\n\n    fmt.Print(\"it worked!\")\n    resp.Body.Close()\n\n}\n</code></pre>\n\n<p>Is there a easier/better way to do this?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 4, "creation_date": 1533987666, "post_id": 51799126, "comment_id": 90555026, "body": "If I look at your code I don&#39;t know what logic you want to test there.  The general solution in Go would be to take an interface as input. Then you would pass the dependency in your code and the mock in your test to that function."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1533989955, "post_id": 51799126, "comment_id": 90555555, "body": "This function offers nothing to &quot;test&quot;, so why bother."}, {"owner": {"reputation": 125, "user_id": 1306251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51a33e61874bf25461b46069cddbc359?s=128&d=identicon&r=PG", "display_name": "Sync", "link": "https://stackoverflow.com/users/1306251/sync"}, "edited": false, "score": 1, "creation_date": 1534011290, "post_id": 51799126, "comment_id": 90561304, "body": "You&#39;re right this code doesn&#39;t have much to test. Mine was probably a more generic question like: &quot;what are the best practices when unit testing with Go?&quot; In ruby you could use doubles, does go need something similar or there&#39;s a more straightforward way?"}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 1306251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51a33e61874bf25461b46069cddbc359?s=128&d=identicon&r=PG", "display_name": "Sync", "link": "https://stackoverflow.com/users/1306251/sync"}, "edited": false, "score": 0, "creation_date": 1534011229, "post_id": 51799286, "comment_id": 90561276, "body": "Thank you, this could be one way to test it, even though as other people have said this specific snippet doesn&#39;t really require any real test as there&#39;s pretty much no logic."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 125, "user_id": 1306251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51a33e61874bf25461b46069cddbc359?s=128&d=identicon&r=PG", "display_name": "Sync", "link": "https://stackoverflow.com/users/1306251/sync"}, "edited": false, "score": 0, "creation_date": 1534014966, "post_id": 51799286, "comment_id": 90562143, "body": "Yes, but this approach isn&#39;t specific to your code, it&#39;s a general way to be able to test something that depends on external dependencies :) Let me know if I can help more!"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 5, "last_activity_date": 1533988280, "last_edit_date": 1533988280, "creation_date": 1533987653, "answer_id": 51799286, "question_id": 51799126, "link": "https://stackoverflow.com/questions/51799126/mock-external-dependencies-in-golang/51799286#51799286", "title": "Mock external dependencies in golang", "body": "<p>One way to do it is to inject the dependencies in your structure, like such:</p>\n\n<pre><code>type S3Inputer interface {\n    NewWriteAtBuffer(buf []byte) *aws.WriteAtBuffer\n    String(v string) *string\n}\n\ntype S3Input struct {\n    newWriteAtBufferFunc func(buf []byte) *aws.WriteAtBuffer\n    stringFunc           func(v string) *string\n}\n\nfunc (s *S3Input) NewWriteAtBuffer(buf []byte) *WriteAtBuffer {\n    return s.newWriteAtBufferFunc(buf)\n}\n\nfunc (s *S3Input) String(v string) *string {\n    return s.stringFunc(v)\n}\n\nfunc (s S3Input) Sample(key string) ([]byte, error) {\n    var buf []byte\n    waBuf := s.NewWriteAtBuffer(buf)\n\n    _, err := s.Downloader.Download(\n        waBuf,\n        &amp;s3.GetObjectInput{\n            Bucket: s.String(s.Bucket),\n            Key:    s.String(key),\n        },\n    )\n    if err != nil {\n        return nil, err\n    }\n\n    return buf, nil\n}\n\nfunc main() {\n    s := &amp;S3Input{\n        StringFunc:           aws.String,\n        NewWriteAtBufferFunc: aws.NewWriteAtBuffer,\n    }\n\n    // ...\n}\n</code></pre>\n\n<p>This allows you to replace those functions with whatever you want for testing, without the need of any testing framework.</p>\n\n<p>Then, the testing function would look something like this:</p>\n\n<pre><code>func (s S3Input) TestSample(t *testing.T) {\n    s3Mock := &amp;S3Input{\n        StringFunc:           (func (v string) *string {\n            return nil\n        }),\n        NewWriteAtBufferFunc: (func (buf []byte) *aws.WriteAtBuffer {\n            return nil\n        }),\n    }\n\n    res, err := s3Mock.Sample(...) //\n    // asserts &amp; error checks\n}\n</code></pre>\n\n<p>You could improve it by creating a <code>S3InputMock</code> type instead of reusing the base one, both would implement the <code>S3Inputer</code> interface and your mock could have attributes allowing it to help you with testing. For example, it could count the number of times a function is called, store the arguments it received, have its methods behave differently depending on the attributes you set for easier testing, etc.</p>\n"}], "owner": {"reputation": 125, "user_id": 1306251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51a33e61874bf25461b46069cddbc359?s=128&d=identicon&r=PG", "display_name": "Sync", "link": "https://stackoverflow.com/users/1306251/sync"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2855, "favorite_count": 1, "accepted_answer_id": 51799286, "answer_count": 1, "score": 4, "last_activity_date": 1533988280, "creation_date": 1533986300, "question_id": 51799126, "link": "https://stackoverflow.com/questions/51799126/mock-external-dependencies-in-golang", "title": "Mock external dependencies in golang", "body": "<p>I have a program in go that connects to AWS S3 and gets a file.\nI'd like to write some tests for it, but I'd like to know, more generally, how to do these mocks in Golang. I know there are some libraries to create mocks but if I remember correctly I read someone suggesting using only standard libraries for unit tests was the best way to go.</p>\n\n<p>So, how would you test a function like this?</p>\n\n<pre><code>func (s S3Input) Sample(key string) ([]byte, error) {\n    var buf []byte\n    waBuf := aws.NewWriteAtBuffer(buf)\n\n    _, err := s.Downloader.Download(\n        waBuf,\n        &amp;s3.GetObjectInput{\n            Bucket: aws.String(s.Bucket),\n            Key:    aws.String(key),\n        },\n    )\n    if err != nil {\n        return nil, err\n    }\n\n    return buf, nil\n}\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1533985728, "post_id": 51799025, "comment_id": 90554649, "body": "Add the Golang code where you are handling the queries result returning from database."}, {"owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533988094, "post_id": 51799025, "comment_id": 90555117, "body": "@Himanshu, updated post"}, {"owner": {"reputation": 10047, "user_id": 2421277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/f5hX1.jpg?s=128&g=1", "display_name": "pim", "link": "https://stackoverflow.com/users/2421277/pim"}, "edited": false, "score": 0, "creation_date": 1533989812, "post_id": 51799025, "comment_id": 90555513, "body": "You need to provide the sproc code as well."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533990973, "post_id": 51799025, "comment_id": 90555787, "body": "@iamnp Can you post the output of <code>fmt.Println(evaluations)</code> which will show the returned data."}, {"owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534005750, "post_id": 51799025, "comment_id": 90559803, "body": "@Himanshu, <code>fmt.Println(evaluations)</code> prints raw data: <code>&amp;{0xc042336000 0x889bb0 0xc0423061e0 0x53f460 0xc042036440 {{0 0} 0 0 0 0} false &lt;nil&gt; []}</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534008270, "post_id": 51799025, "comment_id": 90560426, "body": "@iamnp convert it into string. so that we can read"}, {"owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534156102, "post_id": 51799025, "comment_id": 90594191, "body": "@Himanshu, it doesn&#39;t work like that :("}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1534160760, "post_id": 51799025, "comment_id": 90597012, "body": "@iamnp donnot skip the errors print them and check them. Because there is no problem seems inside the golang code."}], "answers": [{"comments": [{"owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "edited": false, "score": 0, "creation_date": 1533987764, "post_id": 51799088, "comment_id": 90555050, "body": "Renaming one value didn&#39;t help. First read if the value is the last one also fails - see original question"}], "tags": [], "owner": {"reputation": 10047, "user_id": 2421277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/f5hX1.jpg?s=128&g=1", "display_name": "pim", "link": "https://stackoverflow.com/users/2421277/pim"}, "is_accepted": false, "score": 0, "last_activity_date": 1533986004, "creation_date": 1533986004, "answer_id": 51799088, "question_id": 51799025, "link": "https://stackoverflow.com/questions/51799025/go-cannot-read-last-nvarcharmax-value-from-ms-sql-2014/51799088#51799088", "title": "Go cannot read last nvarchar(max) value from MS SQL 2014", "body": "<p>I'm not a go programmer. But you need to name those fields differently. How could your code possible discern between the first and second <code>[grade]</code>?</p>\n\n<pre><code>SELECT ... ,\n    grade as [grade],\n    grade as [grade2]\n    FROM dbo.[qc_runs] r\n\n    JOIN ...\nWHERE ...\n</code></pre>\n\n<p>Given that you're getting an empty value on the second read, I suspect that the go driver (and the data reader you're using from it) is <strong>one-way</strong> only.</p>\n"}, {"tags": [], "owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "is_accepted": true, "score": 0, "last_activity_date": 1534005905, "creation_date": 1534005905, "answer_id": 51801778, "question_id": 51799025, "link": "https://stackoverflow.com/questions/51799025/go-cannot-read-last-nvarcharmax-value-from-ms-sql-2014/51801778#51801778", "title": "Go cannot read last nvarchar(max) value from MS SQL 2014", "body": "<p>Problem solved, <code>evaluations.Scan(readCols...)</code> returned error <code>err sql: Scan error on column index 3: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string</code>, and left the rest of array blank</p>\n"}], "owner": {"reputation": 502, "user_id": 1389883, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e39b27de7a67b60e63cee3769e454569?s=128&d=identicon&r=PG", "display_name": "iamnp", "link": "https://stackoverflow.com/users/1389883/iamnp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51801778, "answer_count": 2, "score": 0, "last_activity_date": 1534005905, "creation_date": 1533985530, "last_edit_date": 1533988446, "question_id": 51799025, "link": "https://stackoverflow.com/questions/51799025/go-cannot-read-last-nvarcharmax-value-from-ms-sql-2014", "title": "Go cannot read last nvarchar(max) value from MS SQL 2014", "body": "<p>I have the following query:</p>\n\n<pre><code>SELECT ... ,\n    grade as [grade],\n    grade as [grade2]\n    FROM dbo.[qc_runs] r\n\n    JOIN ...\nWHERE ...\n</code></pre>\n\n<p>I send it to MS SQL Server 2014 from my Go code and want to get back data (I am using <code>github.com/denisenkom/go-mssqldb</code> driver). However, I can read first <code>grade</code> value (type <code>nvarchar(max)</code>), but second one arrives empty! These are the same table fields, just duplicated. <strong>If I delete first grade value from query and leave just one, it will still arrive empty!</strong> The column is described as following:</p>\n\n<pre><code>[grade] [nvarchar](max) NULL,\n</code></pre>\n\n<p>SQL Management Studio executes this query just fine, both <code>grade</code> values are not empty, but Go code doesn't!</p>\n\n<p>UPDATE #1\nGo code:</p>\n\n<pre><code>evaluations, err := db.Query(\"EXEC qa.dbo.sp_get_evaluation_list ?\", uid)\nif err != nil {\n    if err == sql.ErrNoRows {\n        return list, nil\n    }\n    return list, err\n}\n\n// Get column names\ncolNames, err := evaluations.Columns()\nif err != nil {\n    log.Logf(\"Failed to get columns: %v\", err)\n    return list, err\n}\n\n// Result is your slice string.\nreadCols := make([]interface{}, len(colNames))\n\n// Read data\nfor evaluations.Next() {\n\n    writeCols := make([]string, len(colNames))\n    for i := range writeCols {\n        readCols[i] = &amp;writeCols[i]\n    }\n\n    evaluations.Scan(readCols...)\n\n    for i := range writeCols {\n        fmt.Println(colNames[i], \": \", writeCols[i])\n    }\n    ...\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>...\ngrade :  &lt;some text from DB&gt;\ngrade2 :  \n</code></pre>\n"}, {"tags": ["linux", "go", "tcp"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534013695, "post_id": 51798935, "comment_id": 90561857, "body": "please post a full reproducible example so we can talk about your attempts. As of now it is hardly possible to make sense of it."}, {"owner": {"reputation": 415, "user_id": 2044233, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/6s2Oy.jpg?s=128&g=1", "display_name": "Alireza Sanaee", "link": "https://stackoverflow.com/users/2044233/alireza-sanaee"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534061249, "post_id": 51798935, "comment_id": 90569270, "body": "<a href=\"https://github.com/sarsanaee/GoWorkloadGenerator\" rel=\"nofollow noreferrer\">github.com/sarsanaee/GoWorkloadGenerator</a>, There are two branches there that are related to both approaches I described here! Thanks :) @mh-cbon"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534109760, "post_id": 51798935, "comment_id": 90580932, "body": "thanks, the code you have posted seems able to send 300k/qps, at one detail, the call to fmt.* kills its performance. That is easy to find using profiling (<a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>), and this is well-known (<a href=\"https://stackoverflow.com/questions/40104727/improve-the-speed-of-fmt-println\" title=\"improve the speed of fmt println\">stackoverflow.com/questions/40104727/&hellip;</a>). I m also adding a slight rewrite below for sharing purposes, in no case this is close to production ready."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534110433, "post_id": 51798935, "comment_id": 90581065, "body": "one thing to note about your sleep and the duration computation system remains totally obscure to me, it did not return anything relevant during my tests."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1534180464, "post_id": 51798935, "comment_id": 90609191, "body": "You are only reading 8 bytes at a time with an unbuffered connection -- it&#39;s a TCP stream, there&#39;s no reason to not buffer that. There is also an empty <code>for</code> loop in your code, which is always a programming error. It&#39;s consuming 100% of a CPU core for no reason, and blocking the scheduler."}, {"owner": {"reputation": 415, "user_id": 2044233, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/6s2Oy.jpg?s=128&g=1", "display_name": "Alireza Sanaee", "link": "https://stackoverflow.com/users/2044233/alireza-sanaee"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1534188426, "post_id": 51798935, "comment_id": 90612981, "body": "io.ReadFull() syscall is a blocking one, so it is not EMPTY for loop that consumes entire CPU utilization. I don&#39;t think there is any problem with it! @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1534189018, "post_id": 51798935, "comment_id": 90613221, "body": "@SeyedAlirezaSanaeeKohroudi: the last line of your <code>main</code> function is simply <code>for true {}</code>. <code>ReadFull</code> is blocking, but it&#39;s translating to a syscall every time because of the small read size, where as a buffered reader would be much more efficient."}, {"owner": {"reputation": 415, "user_id": 2044233, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/6s2Oy.jpg?s=128&g=1", "display_name": "Alireza Sanaee", "link": "https://stackoverflow.com/users/2044233/alireza-sanaee"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1534189623, "post_id": 51798935, "comment_id": 90613437, "body": "Ohh yes! That one really hurts the performance, however, I monitored the CPU utilization but interestingly the utilization was low!!!! WHY?! @JimB"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534019061, "post_id": 51802800, "comment_id": 90562998, "body": "i don t quiet understand why you d start go routines on every second, that will add lots of works on gc, and probably other things. Also, having one routine for each write does not seem a good way imho, you should block if the conn can t be written anymore. In current code you are accumulating routines at runtime, making this code harzadous."}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534019577, "post_id": 51802800, "comment_id": 90563107, "body": "Indeed, the danger of accumulating write routines is clear, and that is the error I was having. Including a blocker for concurrent writes includes making the code too complex to write it here, but I usually use a <code>sync.Mutex</code> with the number of available resources and substract one while I&#39;m using that resource, adding one once the resource is no longer needed. Regarding the go routine for every second, is to ensure that it takes exactly one second. Since I don&#39;t know how long will the loop take, I send it to a goroutine, and then wait an actual 1 second."}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534019795, "post_id": 51802800, "comment_id": 90563151, "body": "I could use a <code>time.Ticker</code> to count the seconds, but again, it would make the code more complex. AFAIK, launching a ton of goroutines, as long as you don&#39;t need to copy data into the routine itself (notice that I don&#39;t pass any param into the functions), and as long as you&#39;re careful to not access anything not concurrency-protected, it does not take that many resources, and simplifies the code."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1534020491, "post_id": 51802800, "comment_id": 90563323, "body": "take care in <code>for err==nil</code> it is referencing a shadowed and concurrently written variable. Also, it is not certain to me that writing the same tcp conn concurrently really adds up speed, I suspect somewhere down line something is synchronizing things, so at best it might filling the underlying buffer faster, not sure. <a href=\"https://golang.org/src/net/net.go#L184\" rel=\"nofollow noreferrer\">golang.org/src/net/net.go#L184</a>. I would not use time.Ticker, i d have to deal with the case where a write &gt; 1s. I d rather use a token bucket <a href=\"https://github.com/golang/go/wiki/RateLimiting\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/RateLimiting</a>."}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1534021954, "post_id": 51802800, "comment_id": 90563635, "body": "Damn, the error. True! I didn&#39;t think about that. I didn&#39;t know about the bucket wiki page, but I&#39;m surprised about the ticker limit to tens of ops per second. With the simple <code>for ;;time.Sleep(time.Second){go func (){}()}</code> I&#39;ve managed to control the rate precisely up to hundreds of thousands of ops per second, although using libraries that control concurrency on the background..."}], "tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": false, "score": 1, "last_activity_date": 1534055651, "last_edit_date": 1534055651, "creation_date": 1534013753, "answer_id": 51802800, "question_id": 51798935, "link": "https://stackoverflow.com/questions/51798935/achieving-high-throughput-with-go-tcp-client-server/51802800#51802800", "title": "Achieving high throughput with Go TCP client-server", "body": "<p><strong>Edit</strong> This is a pretty bad answer. Check mh-cbon comments for the reasons.</p>\n\n<hr>\n\n<p>I don't fully understand how you're trying to do so, but if I want to control the rate on Go, I usually do 2 nested for loops:</p>\n\n<pre><code>for ;; time.Sleep(time.Second) {\n  go func (){\n    for i:=0; i&lt;rate; i++ {\n      go func (){\n        // Do whatever\n      }()\n    }\n  }()\n}\n</code></pre>\n\n<p>I'm starting a goroutine inside each loop to:</p>\n\n<ul>\n<li>on the outer loop, to ensure it's only 1 second between iterations</li>\n<li>on the inner loop, to ensure I can start all the requests I want</li>\n</ul>\n\n<p>Putting this on a problem like yours, it would look something like:</p>\n\n<pre><code>package main\n\nimport (\n        \"net\"\n        \"os\"\n        \"time\"\n)\n\nconst (\n        rate    = 100000\n        address = \"localhost:8090\"\n)\n\nfunc main() {\n        conn, err := net.Dial(\"tcp\", address)\n        if err != nil {\n                os.Stderr.Write([]byte(err.Error() + \"\\n\"))\n                os.Exit(1)\n        }\n\n        for ; err == nil; time.Sleep(time.Second) {\n                go func() {\n                        for i := 0; i &lt; rate; i++ {\n                                go func(conn net.Conn) {\n                                        if _, err := conn.Write([]byte(\"01234567\")); err != nil {\n                                                os.Stderr.Write([]byte(\"\\nConnection closed: \" + err.Error() + \"\\n\"))\n                                        }\n                                }(conn)\n                        }\n                }()\n        }\n}\n</code></pre>\n\n<p>To verify that this is actually sending the target request rate, you can have a test TCP listener like this:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"net\"\n        \"os\"\n        \"time\"\n)\n\nconst (\n        address = \":8090\"\n        payloadSize = 8\n)\nfunc main() {\n        count := 0\n        b := make([]byte, payloadSize)\n        l, err := net.Listen(\"tcp\", address)\n        if err != nil {\n                fmt.Fprintf(os.Stdout, \"\\nCan't listen to address %v: %v\\n\", address, err)\n                return\n        }\n\n\n   defer l.Close()\n    go func() {\n            for ; ; time.Sleep(time.Second) {\n                    fmt.Fprintf(os.Stdout, \"\\rRate: %v/s       \", count)\n                    count = 0\n            }\n    }()\n    for {\n            conn, err := l.Accept()\n            if err != nil {\n                    fmt.Fprintf(os.Stderr, \"\\nFailed to accept connection: %v\\n\", err)\n            }\n            for {\n                    _, err := conn.Read(b)\n                    if err != nil {\n                            fmt.Fprintf(os.Stderr, \"\\nConnection closed: %v\\n\", err)\n                            break\n                    }\n                    count = count + 1\n            }\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>I found some issues due to not being able to write concurrently into the connection with an error <code>inconsistent fdMutex</code>. This is due to reaching over <code>0xfffff</code> concurrent writes, which fdMutex does not support. To mitigate this issue, make sure you don't go over that number of concurrent writes. In my system, it was >100k/s. This is not the 300k/s you're expecting, but my system is not prepared for that.</p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1534110696, "creation_date": 1534110696, "answer_id": 51813143, "question_id": 51798935, "link": "https://stackoverflow.com/questions/51798935/achieving-high-throughput-with-go-tcp-client-server/51813143#51813143", "title": "Achieving high throughput with Go TCP client-server", "body": "<p>this is a quick rework of the op code.\nAs the original source code is working, it does not provide a solution, however it illustrates bucket token usage, and few other small go tips.</p>\n\n<p>It does re use similar default values as op source code.</p>\n\n<p>It demonstrates you do not need two files / programs, to provide both client and server.</p>\n\n<p>It demonstrates usage of flag package.</p>\n\n<p>It shows how to parse unix nano timestamp appropriately using time.Unix(x,y)</p>\n\n<p>It shows how to take advantage of io.Copy to write-what-you-read on the same net.Conn. Rather than manual writing.</p>\n\n<p>Still, this is improper for production delivery.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"math\"\n    \"math/rand\"\n    \"net\"\n    \"os\"\n    \"sync/atomic\"\n    \"time\"\n\n    \"github.com/juju/ratelimit\"\n)\n\nvar total_rcv int64\n\nfunc main() {\n\n    var cmd_rate_int float64\n    var cmd_port string\n    var client_size int\n\n    flag.Float64Var(&amp;cmd_rate_int, \"rate\", 400000, \"change rate of message reading\")\n    flag.StringVar(&amp;cmd_port, \"port\", \":9090\", \"port to listen\")\n    flag.IntVar(&amp;client_size, \"size\", 20, \"number of clients\")\n\n    flag.Parse()\n\n    t := flag.Arg(0)\n\n    if t == \"server\" {\n        server(cmd_port)\n\n    } else if t == \"client\" {\n        for i := 0; i &lt; client_size; i++ {\n            go client(cmd_rate_int, cmd_port)\n        }\n        // &lt;-make(chan bool) // infinite wait.\n        &lt;-time.After(time.Second * 2)\n        fmt.Println(\"total exchanged\", total_rcv)\n\n    } else if t == \"client_ratelimit\" {\n        bucket := ratelimit.NewBucketWithQuantum(time.Second, int64(cmd_rate_int), int64(cmd_rate_int))\n        for i := 0; i &lt; client_size; i++ {\n            go clientRateLimite(bucket, cmd_port)\n        }\n        // &lt;-make(chan bool) // infinite wait.\n        &lt;-time.After(time.Second * 3)\n        fmt.Println(\"total exchanged\", total_rcv)\n    }\n}\n\nfunc server(cmd_port string) {\n    ln, err := net.Listen(\"tcp\", cmd_port)\n    if err != nil {\n        panic(err)\n    }\n\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            panic(err)\n        }\n        go io.Copy(conn, conn)\n    }\n}\n\nfunc client(cmd_rate_int float64, cmd_port string) {\n\n    conn, err := net.Dial(\"tcp\", cmd_port)\n    if err != nil {\n        log.Println(\"ERROR\", err)\n        os.Exit(1)\n    }\n    defer conn.Close()\n\n    go func(conn net.Conn) {\n        buf := make([]byte, 8)\n        for {\n            _, err := io.ReadFull(conn, buf)\n            if err != nil {\n                break\n            }\n            // int_message := int64(binary.LittleEndian.Uint64(buf))\n            // t2 := time.Unix(0, int_message)\n            // fmt.Println(\"ROUDNTRIP\", time.Now().Sub(t2))\n            atomic.AddInt64(&amp;total_rcv, 1)\n        }\n        return\n    }(conn)\n\n    byte_message := make([]byte, 8)\n    for {\n        wait := time.Microsecond * time.Duration(nextTime(cmd_rate_int))\n        if wait &gt; 0 {\n            time.Sleep(wait)\n            fmt.Println(\"WAIT\", wait)\n        }\n        int_message := time.Now().UnixNano()\n        binary.LittleEndian.PutUint64(byte_message, uint64(int_message))\n        _, err := conn.Write(byte_message)\n        if err != nil {\n            log.Println(\"ERROR\", err)\n            return\n        }\n    }\n}\n\nfunc clientRateLimite(bucket *ratelimit.Bucket, cmd_port string) {\n\n    conn, err := net.Dial(\"tcp\", cmd_port)\n    if err != nil {\n        log.Println(\"ERROR\", err)\n        os.Exit(1)\n    }\n    defer conn.Close()\n\n    go func(conn net.Conn) {\n        buf := make([]byte, 8)\n        for {\n            _, err := io.ReadFull(conn, buf)\n            if err != nil {\n                break\n            }\n            // int_message := int64(binary.LittleEndian.Uint64(buf))\n            // t2 := time.Unix(0, int_message)\n            // fmt.Println(\"ROUDNTRIP\", time.Now().Sub(t2))\n            atomic.AddInt64(&amp;total_rcv, 1)\n        }\n        return\n    }(conn)\n\n    byte_message := make([]byte, 8)\n    for {\n        bucket.Wait(1)\n        int_message := time.Now().UnixNano()\n        binary.LittleEndian.PutUint64(byte_message, uint64(int_message))\n        _, err := conn.Write(byte_message)\n        if err != nil {\n            log.Println(\"ERROR\", err)\n            return\n        }\n    }\n}\n\nfunc nextTime(rate float64) float64 {\n    return -1 * math.Log(1.0-rand.Float64()) / rate\n}\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 2044233, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/6s2Oy.jpg?s=128&g=1", "display_name": "Alireza Sanaee", "link": "https://stackoverflow.com/users/2044233/alireza-sanaee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2216, "favorite_count": 1, "accepted_answer_id": 51813143, "answer_count": 2, "score": 0, "last_activity_date": 1534110696, "creation_date": 1533984767, "last_edit_date": 1534029829, "question_id": 51798935, "link": "https://stackoverflow.com/questions/51798935/achieving-high-throughput-with-go-tcp-client-server", "title": "Achieving high throughput with Go TCP client-server", "body": "<p>I'm going to develop a simple TCP client and server and I want to achieve high throughput (300000 Requests/Second) which is easy to reach with Cpp or C TCP client and server on a server hardware. I mean a server with 48 Cores and 64G Memory.</p>\n\n<p>On my testbed, both client and server have 10G network interface card and I have receive-side-scaling at server side and transmit-packet-steering enabled at the client.</p>\n\n<p>I configure the client to send 10 thousand requests per second. I just run multiple instances of Go <code>go run client.go</code> from a bash script to increase the throughput. However, in this way, Go is going to create lots of threads at the operating systems and a large number of threads results in high context switching cost, and I could not approach such throughputs. I suspected the number of Go instances I'm running from the command line. The code below is the code snippet for the client in the approach:</p>\n\n<pre><code>func Main(cmd_rate_int int, cmd_port string) {\n\n   //runtime.GOMAXPROCS(2) // set maximum number of processes to be used by this applications\n\n   //var rate float64 = float64(rate_int)\n\n   rate := float64(cmd_rate_int)\n\n   port = cmd_port\n\n   conn, err := net.Dial(\"tcp\", port)\n   if err != nil {\n       fmt.Println(\"ERROR\", err)\n       os.Exit(1)\n   }\n\n   var my_random_number float64 = nextTime(rate) * 1000000\n   var my_random_int int = int(my_random_number)\n   var int_message int64 = time.Now().UnixNano()\n   byte_message := make([]byte, 8)\n\n   go func(conn net.Conn) {\n       buf := make([]byte, 8)\n\n       for true {\n           _, err = io.ReadFull(conn, buf)\n           now := time.Now().UnixNano()\n\n           if err != nil {\n               return\n           }\n\n           last := int64(binary.LittleEndian.Uint64(buf))\n           fmt.Println((now - last) / 1000)\n       }\n       return\n\n   }(conn)\n\n   for true {\n       my_random_number = nextTime(rate) * 1000000\n       my_random_int = int(my_random_number)\n       time.Sleep(time.Microsecond * time.Duration(my_random_int))\n       int_message = time.Now().UnixNano()\n       binary.LittleEndian.PutUint64(byte_message, uint64(int_message))\n       conn.Write(byte_message)\n   }\n}\n</code></pre>\n\n<p>So I try to run all my Go threads by calling <code>go client()</code> in the <code>main</code> so I do not run multiple instances in the Linux command line. I thought it may be a better idea. And it is really a better idea basically and the number of threads doesn't increase toward 700 or so in the operating system. But the throughput still is low and it seems it doesn't employ all capability of the underlying hardware. Actually, you may want to see the code I have run in the second approach:</p>\n\n<pre><code>func main() {\n\n   //runtime.GOMAXPROCS(2) // set maximum number of processes to be used by this applications\n   args := os.Args[1:]\n   rate_int, _ := strconv.Atoi(args[0])\n   client_size, _ := strconv.Atoi(args[1])\n   port := args[2]\n\n   i := 0\n   for i &lt;= client_size {\n       go client.Main(rate_int, port)\n       i = i + 1\n   }\n\n   for true {\n\n   }\n}\n</code></pre>\n\n<p>I was wondering what is the best practice for in order to reach high throughput? I have always heard that Go is lightweight and performant and pretty comparable with C/Cpp pthread. However, I think in terms of performance still C/Cpp is far far better than Go. I might do something really wrong on this issue, so I would be happy if anybody can help to achieve high throughput with Go.</p>\n"}, {"tags": ["go", "memory", "concurrency", "parallel-processing", "synchronization"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533960761, "post_id": 51796289, "comment_id": 90549953, "body": "<a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1533967241, "post_id": 51796289, "comment_id": 90550843, "body": "BTW you don&#39;t need syncing when no two goroutines update the same array element. IOW it is safe to concurrently init diffirent array elements."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533968192, "post_id": 51796289, "comment_id": 90551027, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879469#49879469\">Can I concurrently write different slice elements</a>."}, {"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1533972179, "post_id": 51796289, "comment_id": 90551872, "body": "Besides the question, which already has been answered: Consider using a waitgroup for waiting for all init coroutines to complete instead of the channels."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4390558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v9br9flryqA/AAAAAAAAAAI/AAAAAAAAEvI/8dh8xvUA8ek/photo.jpg?sz=128", "display_name": "Ruomu", "link": "https://stackoverflow.com/users/4390558/ruomu"}, "edited": false, "score": 0, "creation_date": 1533964132, "post_id": 51796371, "comment_id": 90550376, "body": "Thank you very much! glad the issue is not with the synchronization part but with the closure property."}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 2, "last_activity_date": 1533961517, "last_edit_date": 1533961517, "creation_date": 1533960414, "answer_id": 51796371, "question_id": 51796289, "link": "https://stackoverflow.com/questions/51796289/how-to-synchronize-the-go-routines-for-initializing-a-slice-concurrently/51796371#51796371", "title": "How to synchronize the go routines for initializing a slice concurrently?", "body": "<p>Because the code is run concurrently, your variable <code>i</code> is modified each time a goroutine is called because they all keep a reference to the same variable <code>i</code> </p>\n\n<p>To prevent that to happen, pass the index parameter to your anonymous function.                                 </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  toInit := make([]int, 10)\n  syncLock := make(chan bool)\n\nfor i := range toInit{\n    go func(i int){\n      toInit[i] = i; \n      syncLock &lt;- true}(i)\n}\n\nfor range toInit{\n    &lt;-syncLock\n}\n\nfor i := range toInit{\n    if toInit[i] != i{\n        fmt.Println(\"error\")\n    }\n}\n}\n</code></pre>\n\n<p>The other way would be to use a declaration style using the following </p>\n\n<pre><code>for i := range toInit{\n        i := i\n        go func(){\n          toInit[i] = i; \n          syncLock &lt;- true}()\n }\n</code></pre>\n\n<p>Here is a nice documentation about <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">closures and goroutines</a></p>\n"}], "owner": {"reputation": 19, "user_id": 4390558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v9br9flryqA/AAAAAAAAAAI/AAAAAAAAEvI/8dh8xvUA8ek/photo.jpg?sz=128", "display_name": "Ruomu", "link": "https://stackoverflow.com/users/4390558/ruomu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1533961517, "creation_date": 1533959175, "question_id": 51796289, "link": "https://stackoverflow.com/questions/51796289/how-to-synchronize-the-go-routines-for-initializing-a-slice-concurrently", "title": "How to synchronize the go routines for initializing a slice concurrently?", "body": "<p>I am trying to initialize an array of items in concurrently manner using go routines. However, the strange memory behavior of Go prevents me from doing so even I used the suggested primitives (channel). Below is the minimal reproduce:</p>\n\n<pre><code>func TestSliceInit(t *testing.T){\ntoInit := make([]int, 10)\nsyncLock := make(chan bool)\n\nfor i := range toInit{\n    go func(){toInit[i] = i; syncLock &lt;- true}()\n}\n\nfor range toInit{\n    &lt;-syncLock\n}\n\nfor i := range toInit{\n    if toInit[i] != i{\n        t.Error(\"fail to init\")\n    }\n}\n}\n</code></pre>\n\n<p>The code is supposed to initialize the <code>toInit</code> array to 0-9 but it does not. Instead, error will be produced. I tried this code on Goland 2018.1</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1533956046, "post_id": 51796062, "comment_id": 90549428, "body": "How are you printing or otherwise communicating the string? (In other words, where do you see <code>&quot;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a054%&quot;</code>?)"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1533956073, "post_id": 51796062, "comment_id": 90549433, "body": "What makes you think there&#39;s quotes on the string?"}, {"owner": {"reputation": 79, "user_id": 7447794, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gMJzNGupnvo/AAAAAAAAAAI/AAAAAAAAEUs/UNLT_zAU4Zk/photo.jpg?sz=128", "display_name": "Isaiah", "link": "https://stackoverflow.com/users/7447794/isaiah"}, "edited": false, "score": 0, "creation_date": 1533956247, "post_id": 51796062, "comment_id": 90549450, "body": "I&#39;m printing it out as so: <code>fmt.Println(strings.Trim(s[0], &quot;\\&quot;&quot;))</code>"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1533956900, "post_id": 51796062, "comment_id": 90549519, "body": "Please be in front of the code and copy it verbatim, don\u2019t retype. The output too. (If it\u2019s retyped, very hard to know if the <code>&quot;</code> is actually <code>\u201d</code>.)"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 7447794, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gMJzNGupnvo/AAAAAAAAAAI/AAAAAAAAEUs/UNLT_zAU4Zk/photo.jpg?sz=128", "display_name": "Isaiah", "link": "https://stackoverflow.com/users/7447794/isaiah"}, "edited": false, "score": 0, "creation_date": 1534022371, "post_id": 51796196, "comment_id": 90563703, "body": "It for whatever reason isn&#39;t stripping the quotes. Also it&#39;s an array so I can&#39;t just use <code>s</code>, gives me the following error <code>cannot use s (type []string) as type string in argument to strings.Trim</code>"}], "tags": [], "owner": {"reputation": 1033, "user_id": 3665475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/338064c8d93a358fa0fc62557e19d2f0?s=128&d=identicon&r=PG&f=1", "display_name": "Justice O.", "link": "https://stackoverflow.com/users/3665475/justice-o"}, "is_accepted": false, "score": 3, "last_activity_date": 1533958114, "last_edit_date": 1533958114, "creation_date": 1533957917, "answer_id": 51796196, "question_id": 51796062, "link": "https://stackoverflow.com/questions/51796062/how-to-remove-double-quotes-from-string/51796196#51796196", "title": "How to remove double quotes from string", "body": "<pre><code>s := \"\\\"  hello\\\"\"\n\nfmt.Println(\"Without trim: \" + s) \n// Without trim: \"  hello\"\n\nfmt.Println(\"Trim double quotes: \" + strings.Trim(s, \"\\\"\")) \n// Trim double quotes:   hello\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/0I2BtS6b_mO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0I2BtS6b_mO</a></p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1533971677, "creation_date": 1533971677, "answer_id": 51797406, "question_id": 51796062, "link": "https://stackoverflow.com/questions/51796062/how-to-remove-double-quotes-from-string/51797406#51797406", "title": "How to remove double quotes from string", "body": "<p>Please give working code. Things that could be wrong:</p>\n\n<ul>\n<li>You're using s[0] that means the first byte of s, did you mean to use s or is this an array of strings?</li>\n<li>Your string may have trailing or leading whitespace</li>\n<li>Your string may use smart quotes</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1534178790, "last_edit_date": 1534178790, "creation_date": 1534178317, "answer_id": 51826916, "question_id": 51796062, "link": "https://stackoverflow.com/questions/51796062/how-to-remove-double-quotes-from-string/51826916#51826916", "title": "How to remove double quotes from string", "body": "<p>Your code should work fine, perhaps you are misinterpreting some printed results or storing the wrong value?</p>\n\n<pre><code>ss := []string{\"foo\", `\"\"`, `\"bar\"`, `\"        54%\"`}\nfor _, s := range ss {\n  t := strings.Trim(s, `\"`)\n  fmt.Printf(\"OK:    [%s] --&gt; [%s]\\n\", s, t)\n}\n// OK:    [foo] --&gt; [foo]\n// OK:    [\"\"] --&gt; []\n// OK:    [\"bar\"] --&gt; [bar]\n// OK:    [\"        54%\"] --&gt; [        54%]\n//         \u2502           \u2502       \u2502         \u2502\n// quotes \u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502         \u2502\n// no quotes \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 7447794, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gMJzNGupnvo/AAAAAAAAAAI/AAAAAAAAEUs/UNLT_zAU4Zk/photo.jpg?sz=128", "display_name": "Isaiah", "link": "https://stackoverflow.com/users/7447794/isaiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5474, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1534178790, "creation_date": 1533955972, "last_edit_date": 1534147895, "question_id": 51796062, "link": "https://stackoverflow.com/questions/51796062/how-to-remove-double-quotes-from-string", "title": "How to remove double quotes from string", "body": "<p>I have a string that I'm pulling from a website, however, it has double quotes surrounding it and I'm trying to remove them. The string is for example: </p>\n\n<p><code>\"        54%\"</code></p>\n\n<p>I've tried: </p>\n\n<p><code>strings.Trim(s[0], \"\\\"\")</code></p>\n\n<p>But it's not removing the quotes. </p>\n\n<p>Any help is much appreciated. </p>\n"}, {"tags": ["javascript", "reactjs", "go"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1533975608, "post_id": 51795845, "comment_id": 90552588, "body": "I dont know about anxios library but shouldn&#39;t be a place you set the port and address of server ?"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10210869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-harsgErAmng/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pF78GdGKoQuduRiyXwT0zIhZrYMA/mo/photo.jpg?sz=128", "display_name": "Khachatur Mirijanyan", "link": "https://stackoverflow.com/users/10210869/khachatur-mirijanyan"}, "edited": false, "score": 0, "creation_date": 1533956918, "post_id": 51795880, "comment_id": 90549525, "body": "The issue is that if I do it that way, then the bundle.js file in my public directory is now not found. I&#39;m trying to do react with a go backend. I need to be able to serve both by static html and JavaScript file to the &#39;/&#39; web adress, which I can&#39;t seem to do without http default router"}], "tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": false, "score": 0, "last_activity_date": 1533953480, "creation_date": 1533953480, "answer_id": 51795880, "question_id": 51795845, "link": "https://stackoverflow.com/questions/51795845/i-cant-get-golang-to-recognize-my-get-request-with-parameters/51795880#51795880", "title": "I can&#39;t get golang to recognize my get request with parameters", "body": "<p>You haven't used your mux router. Since you passed in <code>nil</code> to <code>ListenAndServe</code>, it's using the default router, which has all of your other handlers attached. Instead, register all your handlers with your mux router and then pass it as the second argument to <code>ListenAndServe</code>. </p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n\n    fs := http.FileServer(http.Dir(\"static\"))\n    r.Handle(\"/\", fs)\n\n    bs := http.FileServer(http.Dir(\"public\"))\n    r.Handle(\"/public/\", http.StripPrefix(\"/public/\", bs))\n\n    r.HandleFunc(\"/show\", show)\n    r.HandleFunc(\"/db\", getDB)\n\n    r.HandleFunc(\"/loc/{id}\", getLoc)\n\n    log.Println(\"Listening 3000\")\n    if err := http.ListenAndServe(\":3000\", r); err != nil {\n        panic(err)\n    }\n}\n\nfunc getLoc(w http.ResponseWriter, r *http.Request) {\n    if r.Method != \"GET\" {\n        http.Error(w, http.StatusText(405), http.StatusMethodNotAllowed)\n        return\n    }\n\n    id := r\n    fmt.Println(\"URL\")\n    fmt.Println(id)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10210869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-harsgErAmng/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pF78GdGKoQuduRiyXwT0zIhZrYMA/mo/photo.jpg?sz=128", "display_name": "Khachatur Mirijanyan", "link": "https://stackoverflow.com/users/10210869/khachatur-mirijanyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 406, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533953480, "creation_date": 1533953075, "last_edit_date": 1533953357, "question_id": 51795845, "link": "https://stackoverflow.com/questions/51795845/i-cant-get-golang-to-recognize-my-get-request-with-parameters", "title": "I can&#39;t get golang to recognize my get request with parameters", "body": "<p>I am trying to get create a simple axios get request with parameters in React to work with Go. No matter what I do, keep getting the GET URL path not found (404) error.\nHere is the JS</p>\n\n<pre><code>import React, {Component} from 'react'\nimport axios from \"axios\"\n\nclass ShowLoc extends Component {\n    constructor(props){\n        super(props)\n    }\n\n    componentDidMount(){\n        const {id} = this.props.match.params\n        axios.get(`/loc/${id}`)\n    }\n\n    render() {\n        return(\n            &lt;div&gt;\n                Specific Location\n            &lt;/div&gt;\n        )\n    }\n}\n\nexport default ShowLoc\n</code></pre>\n\n<p>And here are the relevant parts of my server.go file. I am using gorilla/mux to recognize the parameters</p>\n\n<pre><code>func main() {\n\n    fs := http.FileServer(http.Dir(\"static\"))\n    http.Handle(\"/\", fs)\n\n    bs := http.FileServer(http.Dir(\"public\"))\n    http.Handle(\"/public/\", http.StripPrefix(\"/public/\", bs))\n\n    http.HandleFunc(\"/show\", show)\n    http.HandleFunc(\"/db\", getDB)\n\n    r := mux.NewRouter()\n    r.HandleFunc(\"/loc/{id}\", getLoc)\n\n    log.Println(\"Listening 3000\")\n    if err := http.ListenAndServe(\":3000\", nil); err != nil {\n        panic(err)\n    }\n}\n\nfunc getLoc(w http.ResponseWriter, r *http.Request) {\n    if r.Method != \"GET\" {\n        http.Error(w, http.StatusText(405), http.StatusMethodNotAllowed)\n        return\n    }\n    id := r\n    fmt.Println(\"URL\")\n    fmt.Println(id)\n}\n</code></pre>\n\n<p>I never hit my getLoc function since my get request is not found. What should I do get the params from my get request?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1533952681, "post_id": 51795678, "comment_id": 90549007, "body": "What&#39;s your question?"}, {"owner": {"reputation": 250, "user_id": 3264185, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ef85f80e21c4c5cc7e4cf375817c6920?s=128&d=identicon&r=PG&f=1", "display_name": "Biff", "link": "https://stackoverflow.com/users/3264185/biff"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1533955572, "post_id": 51795678, "comment_id": 90549367, "body": "@AndySchweig Given a json structure in type byte array. How can I add a key and value to it?"}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 2, "last_activity_date": 1533958908, "last_edit_date": 1533958908, "creation_date": 1533958390, "answer_id": 51796231, "question_id": 51795678, "link": "https://stackoverflow.com/questions/51795678/add-a-new-key-value-pair-to-a-json-object/51796231#51796231", "title": "Add a new key-value pair to a JSON object", "body": "<p>Since you have a byte data, you need to parse it and store the result in a variable that has your json structure using <a href=\"https://golang.org/src/encoding/json/decode.go?s=4062:4110#L87\" rel=\"nofollow noreferrer\">json.Marshal</a>.</p>\n\n<p>Then after, to add a new key value pair, you can define a new <code>struct</code> with the key and its data type</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var variable type1\n// Unmarshal the byte data in a variable\njson.Unmarshall(data, &amp;variable)\n// to add a new key value you can define a new type\ntype type2 struct {\ntype1\nkey type\n}\n// and you can add\nvariable2 := type2{variable, newValueToAdd}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 779, "user_id": 10160865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VDix.jpg?s=128&g=1", "display_name": "Dennis Glot", "link": "https://stackoverflow.com/users/10160865/dennis-glot"}, "edited": false, "score": 0, "creation_date": 1580925558, "post_id": 51802505, "comment_id": 106261375, "body": "Interesting. I wasn&#39;t aware that it did that. I took a look at the code and there is an explicit sort when encoding a map. I assume that&#39;s done to ensure that the results are deterministic, since iterating over a map does not always produce the same key order."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 8, "last_activity_date": 1534011304, "creation_date": 1534011304, "answer_id": 51802505, "question_id": 51795678, "link": "https://stackoverflow.com/questions/51795678/add-a-new-key-value-pair-to-a-json-object/51802505#51802505", "title": "Add a new key-value pair to a JSON object", "body": "<p>If all you want to do is add a key and value to the root object and produce new JSON, and you don't care about having the data in a structure, you can unmarshal into <code>map[string]interface{}</code>, add your value, and then marshal again:</p>\n\n<pre><code>var m map[string]interface{}\nerr := json.Unmarshal(data, &amp;m)\nm[\"new_key\"] = newValue\nnewData, err := json.Marshal(m)\n</code></pre>\n\n<p>(I'm not checking for errors, but you should do that of course.) Take a look at <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/</a> for more information about how to deal with JSON in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1534170463, "creation_date": 1534170463, "answer_id": 51824673, "question_id": 51795678, "link": "https://stackoverflow.com/questions/51795678/add-a-new-key-value-pair-to-a-json-object/51824673#51824673", "title": "Add a new key-value pair to a JSON object", "body": "<p>While deserializing &amp; reserializing is the more \"correct\" approach, it may be overkill for just adding a value at the root, which can be done with simple string manipulation (really byte slice manipulation, but the semantics are similar and it's arguably easier):</p>\n\n<pre><code>data := []byte(`{\"foo\": 1, \"bar\": true}`)\nins := []byte(`, \"baz\": \"hello\"`)    // Note the leading comma.\nclosingBraceIdx := bytes.LastIndexByte(data, '}')\ndata = append(data[:closingBraceIdx], ins...)\ndata = append(data, '}')\n</code></pre>\n\n<p>This is more error-prone, because it is unaware of JSON syntax entirely, but it's safe enough for most cases and for large JSON documents it is more efficient than a parse, insert, and reserialize.</p>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/h8kL4Zzp7rq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h8kL4Zzp7rq</a></p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 14313575, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pv5hyjjW9Fc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucneqjEn-pG1vvW79Agi2kCFVXbpCg/photo.jpg?sz=128", "display_name": "YangXingf", "link": "https://stackoverflow.com/users/14313575/yangxingf"}, "is_accepted": false, "score": 1, "last_activity_date": 1600684862, "last_edit_date": 1600684862, "creation_date": 1600677974, "answer_id": 63988933, "question_id": 51795678, "link": "https://stackoverflow.com/questions/51795678/add-a-new-key-value-pair-to-a-json-object/63988933#63988933", "title": "Add a new key-value pair to a JSON object", "body": "<p>if you want to add key-value of json bytes to new json object, you can use json.RawMessage.</p>\n<pre><code>    type Res struct {\n        Data interface{}\n        Message string\n    }\n\n    var row  json.RawMessage\n    row = []byte(`{&quot;Name&quot;:&quot;xxx&quot;,&quot;Sex&quot;:1}`)\n    res := Res{Data:row,Message:&quot;user&quot;}\n\n   \n    resBytes ,err := json.Marshal(res)\n    println(string(resBytes))\n    //print result\uff1a&quot;Data&quot;:{&quot;Name&quot;:&quot;xxx&quot;,&quot;Sex&quot;:1},&quot;Message&quot;:&quot;user&quot;}\n   \n</code></pre>\n"}], "owner": {"reputation": 250, "user_id": 3264185, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ef85f80e21c4c5cc7e4cf375817c6920?s=128&d=identicon&r=PG&f=1", "display_name": "Biff", "link": "https://stackoverflow.com/users/3264185/biff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6658, "favorite_count": 0, "accepted_answer_id": 51802505, "answer_count": 4, "score": 1, "last_activity_date": 1600684862, "creation_date": 1533950758, "last_edit_date": 1534109131, "question_id": 51795678, "link": "https://stackoverflow.com/questions/51795678/add-a-new-key-value-pair-to-a-json-object", "title": "Add a new key-value pair to a JSON object", "body": "<p>I am connecting to an API which gives a rather large json payload. I need to add a key and value to the root object.Once I do <code>ioutil.Readall</code> from the package \"net/http\" the JSON is a byte array. </p>\n\n<p>My goal is to just simply add to the structure and move on. As an example, the following the pretty similar to what I am doing:  <a href=\"https://tutorialedge.net/golang/consuming-restful-api-with-go/\" rel=\"nofollow noreferrer\">https://tutorialedge.net/golang/consuming-restful-api-with-go/</a></p>\n\n<p>So how can I simply add to a JSON structure another element (key: value)?</p>\n"}, {"tags": ["go", "mattermost"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533962424, "post_id": 51795115, "comment_id": 90550144, "body": "Judging from the code, simply set the client&#39;s <code>AuthToken</code> field to the token and <code>AuthType</code> to <code>&quot;Bearer&quot;</code>. I would assume that <code>SetOAuthToken</code> is supposed to do that, but it sets <code>AuthType</code> to <code>&quot;token&quot;</code>. That&#39;s a bug if you ask me."}, {"owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534045620, "post_id": 51795115, "comment_id": 90566651, "body": "That&#39;s pretty much what I ended up doing and then made a call to client.GetMe()"}], "answers": [{"tags": [], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "is_accepted": true, "score": 0, "last_activity_date": 1534045530, "creation_date": 1534045530, "answer_id": 51805514, "question_id": 51795115, "link": "https://stackoverflow.com/questions/51795115/whats-the-official-way-of-logging-in-with-a-personal-access-token-using-the-cli/51805514#51805514", "title": "What&#39;s the official way of logging in with a personal access token using the client4 go driver for mattermost?", "body": "<p>The key is <em>not</em> logging in, setting the personal access token and calling client.GetMe.\nThis became clear after looking through the python driver source code.\nThe relevant fragment is.</p>\n\n<pre><code>    fmt.Println(\"LoginAsTheBotUser\", \"Using personal access token\")\n    client.AuthToken = mattermost_personal_access_token\n    client.AuthType = model.HEADER_TOKEN\n    if user, resp := client.GetMe(\"\"); resp.Error != nil {\n        println(\"There was a problem logging into the Mattermost server.  Are you sure the access token is valid?\")\n        PrintError(resp.Error)\n    } else {\n        fmt.Println(client)\n        botUser = user\n        result = true\n    }\n</code></pre>\n\n<p>Context.</p>\n\n<pre><code>/* \n    mattermost_user_email, mattermost_user_password and mattermost_personal_access_token\n    are globals set from reading a .env file on startup\n    */\nfunc LoginAsTheBotUser() bool {\n    fmt.Println(\"LoginAsTheBotUser\")\n    fmt.Println(\"LoginAsTheBotUser\", time.Now())\n    var result bool = false\n    if mattermost_personal_access_token == \"\" {\n        fmt.Println(\"LoginAsTheBotUser\", \"Getting access token from login with username and password\")\n        if user, resp := client.Login(mattermost_user_email, mattermost_user_password); resp.Error != nil {\n            println(\"There was a problem logging into the Mattermost server.  Are you sure ran the setup steps from the README.md?\")\n            PrintError(resp.Error)\n        } else {\n            fmt.Println(client)\n            botUser = user\n            result = true\n        }\n    } else {\n        fmt.Println(\"LoginAsTheBotUser\", \"Using personal access token\")\n        client.AuthToken = mattermost_personal_access_token\n        client.AuthType = model.HEADER_TOKEN\n        if user, resp := client.GetMe(\"\"); resp.Error != nil {\n            //if user, resp := client.Login(mattermost_personal_access_token); resp.Error != nil {\n            println(\"There was a problem logging into the Mattermost server.  Are you sure the access token is valid?\")\n            PrintError(resp.Error)\n        } else {\n            fmt.Println(client)\n            botUser = user\n            result = true\n        }\n    }\n    fmt.Println(\"LoginAsTheBotUser\", time.Now())\n    fmt.Println(\"LoginAsTheBotUser\")\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 0, "accepted_answer_id": 51805514, "answer_count": 1, "score": 0, "last_activity_date": 1534045530, "creation_date": 1533943578, "last_edit_date": 1533957817, "question_id": 51795115, "link": "https://stackoverflow.com/questions/51795115/whats-the-official-way-of-logging-in-with-a-personal-access-token-using-the-cli", "title": "What&#39;s the official way of logging in with a personal access token using the client4 go driver for mattermost?", "body": "<p>We're running two mattermost servers.</p>\n\n<p>One we have a python process logging in with <a href=\"https://github.com/Vaelor/python-mattermost-driver\" rel=\"nofollow noreferrer\">https://github.com/Vaelor/python-mattermost-driver</a> using a personal access token with the community Python driver. \nThis process has a session that doesn't time out which is one of the benefits of using a personal access token to login.\n<a href=\"https://docs.mattermost.com/developer/personal-access-tokens.html\" rel=\"nofollow noreferrer\">https://docs.mattermost.com/developer/personal-access-tokens.html</a> .</p>\n\n<p>We log in using a username and password with the client4 go driver and this works however it times out after a while. It appears there is no way of using a personal access token to log in with the official client 4 driver.</p>\n\n<p>The documentation for the Mattermost Client4 code is at\n<a href=\"https://godoc.org/github.com/mattermost/platform/model#Client\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/mattermost/platform/model#Client</a></p>\n\n<p>The source for client4 is at <a href=\"https://github.com/mattermost/mattermost-server/blob/master/model/client4.go\" rel=\"nofollow noreferrer\">https://github.com/mattermost/mattermost-server/blob/master/model/client4.go</a></p>\n\n<p>The closest thing that looks like it would work is logging in under with a username and password and then setting the authentication token via client.MockSession which failed on testing.</p>\n\n<p>What's the official way of logging in with a personal access token using the client4 go driver for mattermost?</p>\n"}, {"tags": ["go", "delve"], "comments": [{"owner": {"reputation": 114, "user_id": 3575156, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0290f16a90041d732926c5e6ca7e898b?s=128&d=identicon&r=PG&f=1", "display_name": "psk", "link": "https://stackoverflow.com/users/3575156/psk"}, "edited": false, "score": 0, "creation_date": 1537968455, "post_id": 51795022, "comment_id": 91977374, "body": "I am facing same issue. Have u revolved it?"}, {"owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "reply_to_user": {"reputation": 114, "user_id": 3575156, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0290f16a90041d732926c5e6ca7e898b?s=128&d=identicon&r=PG&f=1", "display_name": "psk", "link": "https://stackoverflow.com/users/3575156/psk"}, "edited": false, "score": 0, "creation_date": 1537977076, "post_id": 51795022, "comment_id": 91982990, "body": "After switching to go1.11(release), I never met this problem any more."}, {"owner": {"reputation": 114, "user_id": 3575156, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0290f16a90041d732926c5e6ca7e898b?s=128&d=identicon&r=PG&f=1", "display_name": "psk", "link": "https://stackoverflow.com/users/3575156/psk"}, "edited": false, "score": 0, "creation_date": 1538028825, "post_id": 51795022, "comment_id": 92000318, "body": "Thanks, Issue resolved after update go1.11"}], "answers": [{"comments": [{"owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "edited": false, "score": 1, "creation_date": 1539197472, "post_id": 52540848, "comment_id": 92418456, "body": "If you installed go via homebrew, do <code>brew update</code> then <code>brew upgrade go</code>"}, {"owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "reply_to_user": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "edited": false, "score": 1, "creation_date": 1539713002, "post_id": 52540848, "comment_id": 92598813, "body": "Thanks, @PaulRBerg"}, {"owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "edited": false, "score": 0, "creation_date": 1541878632, "post_id": 52540848, "comment_id": 93370833, "body": "I have this issue with <code>go1.9</code> <code>Mojave Version 10.14</code>. The only way to solve this is by updating to go1.11?"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1544196483, "post_id": 52540848, "comment_id": 94202311, "body": "Yes! Only installing golang 10.4+"}], "tags": [], "owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "is_accepted": true, "score": 6, "last_activity_date": 1553655955, "last_edit_date": 1553655955, "creation_date": 1538063675, "answer_id": 52540848, "question_id": 51795022, "link": "https://stackoverflow.com/questions/51795022/debug-go-with-delve-on-my-mac-combining-dwarf-failed-unknown-load-command-0x3/52540848#52540848", "title": "Debug GO with Delve on my Mac: &quot;combining dwarf failed: Unknown load command 0x32&quot;", "body": "<p>After upgrading GoLang to go1.11 release, I never met this problem any more.</p>\n"}, {"tags": [], "owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "is_accepted": false, "score": 2, "last_activity_date": 1539713070, "creation_date": 1539713070, "answer_id": 52841492, "question_id": 51795022, "link": "https://stackoverflow.com/questions/51795022/debug-go-with-delve-on-my-mac-combining-dwarf-failed-unknown-load-command-0x3/52841492#52841492", "title": "Debug GO with Delve on my Mac: &quot;combining dwarf failed: Unknown load command 0x32&quot;", "body": "<p>If you installed go via homebrew, do:</p>\n\n<pre><code>brew update\nbrew upgrade go\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1812, "favorite_count": 0, "accepted_answer_id": 52540848, "answer_count": 2, "score": 5, "last_activity_date": 1553655955, "creation_date": 1533942686, "last_edit_date": 1533944963, "question_id": 51795022, "link": "https://stackoverflow.com/questions/51795022/debug-go-with-delve-on-my-mac-combining-dwarf-failed-unknown-load-command-0x3", "title": "Debug GO with Delve on my Mac: &quot;combining dwarf failed: Unknown load command 0x32&quot;", "body": "<p>The IDE is Visual Studio Code. Here is the log when I switching on the debugger:</p>\n\n<pre><code># _/Users/leon/Documents/Projects/GoLang/TutorialLearningGoForWebDevelopment\n/usr/local/go/pkg/tool/darwin_amd64/link: /usr/local/go/pkg/tool/darwin_amd64/link: combining dwarf failed: Unknown load command 0x32 (50)\nexit status 2\nProcess exiting with code: 1\n</code></pre>\n\n<p>Go version:</p>\n\n<pre><code>go version go1.10.3 darwin/amd64\n</code></pre>\n\n<p>MacOS version:</p>\n\n<pre><code>Mojave Version 10.14 Beta (18A353d)\n</code></pre>\n\n<p>Delve version:</p>\n\n<pre><code>Delve Debugger\nVersion: 1.0.0\nBuild: $Id: c98a142125d0b17bb11ec0513bde346229b5f533 $\n</code></pre>\n\n<p>Visual Studio Code Version:</p>\n\n<pre><code>  Version 1.26.0-insider (1.26.0-insider)\n</code></pre>\n\n<p>The <code>launch.json</code> was nearly automatically generated, with port changed only:</p>\n\n<pre><code>{\n    // Use IntelliSense to learn about possible attributes.\n    // Hover to view descriptions of existing attributes.\n    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 8080,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${fileDirname}\",\n            \"env\": {},\n            \"args\": [],\n            \"showLog\": true,\n            \"trace\": \"verbose\"\n        }\n    ]\n}\n</code></pre>\n\n<p>Finding out some similar problem threads <a href=\"https://github.com/golang/go/issues/25908\" rel=\"noreferrer\">here</a>, I did not find a solution.<br/>\nI also installed <code>go1.11beta3</code>, but I do not know how to make it default in terms of VSCode debugging.<br/><br/><br/></p>\n\n<p>One more accurate description of the symptom:<br/>\nthe error was NOT caused on <code>Delve</code> side, but originated from the very first line of the <code>go</code> program: <code>package main</code></p>\n\n<p>Just in case some one might need to read the code, I am including the whole file below:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"html/template\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/url\"\n\n    _ \"github.com/mattn/go-sqlite3\"\n\n    \"encoding/xml\"\n)\n\ntype Page struct {\n    Name     string\n    DBStatus bool\n}\n\ntype SearchResult struct {\n    Title  string `xml:\"title,attr\"`\n    Author string `xml:\"author,attr\"`\n    Year   string `xml:\"hyr,attr\"`\n    ID     string `xml:\"owi,attr\"`\n}\n\ntype ClassifySearchResponse struct {\n    Results []SearchResult `xml:\"works&gt;work\"`\n}\n\ntype ClassifyBookResponse struct {\n    BookData struct {\n        Title  string `xml:\"title,attr\"`\n        Author string `xml:\"author,attr\"`\n        ID     string `xml:\"owi,attr\"`\n    } `xml:\"work\"`\n    Classification struct {\n        MostPopular string `xml:\"sft,attr\"`\n    } `xml:\"recommendations&gt;ddc&gt;mostPopular\"`\n}\n\nfunc main() {\n    templates := template.Must(template.ParseFiles(\"templates/index.html\"))\n\n    db, _ := sql.Open(\"sqlite3\", \"dev_golang.db\")\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        p := Page{Name: \"Gopher\"}\n        if name := r.FormValue(\"name\"); name != \"\" {\n            p.Name = name\n        }\n        p.DBStatus = db.Ping() == nil\n\n        if err := templates.ExecuteTemplate(w, \"index.html\", p); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n    })\n\n    http.HandleFunc(\"/search\", func(w http.ResponseWriter, r *http.Request) {\n        var results []SearchResult\n        var err error\n\n        if results, err = search(r.FormValue(\"search\")); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n\n        encoder := json.NewEncoder(w)\n        if err := encoder.Encode(results); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n    })\n\n    http.HandleFunc(\"/books/add\", func(w http.ResponseWriter, r *http.Request) {\n        var book ClassifyBookResponse\n        var err error\n\n        if book, err = find(r.FormValue(\"id\")); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n\n        if err = db.Ping(); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n\n        _, err = db.Exec(\"insert into books (pk, title, author, id, classification) values (?,?,?,?,?)\",\n            nil,\n            book.BookData.Title,\n            book.BookData.Author,\n            book.BookData.Author,\n            book.BookData.ID,\n            book.Classification.MostPopular)\n\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n    })\n\n    fmt.Println(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc find(id string) (ClassifyBookResponse, error) {\n    var c ClassifyBookResponse\n    body, err := classifyAPI(\"http://classify.oclc.org/classify2/Classify?summary=true&amp;owi=\" + url.QueryEscape(id))\n\n    if err != nil {\n        return ClassifyBookResponse{}, err\n    }\n\n    err = xml.Unmarshal(body, &amp;c)\n    return c, err\n}\n\nfunc search(query string) ([]SearchResult, error) {\n    var c ClassifySearchResponse\n    fmt.Println(\"query, search(): \" + query)\n    body, err := classifyAPI(\"http://classify.oclc.org/classify2/Classify?summary=true&amp;title=\" + url.QueryEscape(query))\n\n    if err != nil {\n        fmt.Println(err.Error())\n        return []SearchResult{}, err\n    }\n\n    err = xml.Unmarshal(body, &amp;c)\n    fmt.Println(c.Results)\n    return c.Results, err\n}\n\nfunc classifyAPI(url string) ([]byte, error) {\n    var resp *http.Response\n    var err error\n\n    if resp, err = http.Get(url); err != nil {\n        return []byte{}, err\n    }\n\n    defer resp.Body.Close()\n\n    return ioutil.ReadAll(resp.Body)\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-storage", "named-pipes"], "comments": [{"owner": {"reputation": 57152, "user_id": 624900, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dd56da509c21eebb967777a9dbcce437?s=128&d=identicon&r=PG", "display_name": "jterrace", "link": "https://stackoverflow.com/users/624900/jterrace"}, "edited": false, "score": 0, "creation_date": 1533939073, "post_id": 51794496, "comment_id": 90546790, "body": "Can you using gsutil to pipe? gsutil cat command can print multiple objects to stdout."}, {"owner": {"reputation": 23, "user_id": 4018752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iKoZ_9L69fU/AAAAAAAAAAI/AAAAAAAAAJc/_gwUtVREeCA/photo.jpg?sz=128", "display_name": "Tyler Mace", "link": "https://stackoverflow.com/users/4018752/tyler-mace"}, "reply_to_user": {"reputation": 57152, "user_id": 624900, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dd56da509c21eebb967777a9dbcce437?s=128&d=identicon&r=PG", "display_name": "jterrace", "link": "https://stackoverflow.com/users/624900/jterrace"}, "edited": false, "score": 0, "creation_date": 1534052871, "post_id": 51794496, "comment_id": 90567708, "body": "I&#39;ll investigate this option. I&#39;m not entirely sure off the bat."}, {"owner": {"reputation": 2936, "user_id": 3058302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9E2mA.jpg?s=128&g=1", "display_name": "amport", "link": "https://stackoverflow.com/users/3058302/amport"}, "edited": false, "score": 0, "creation_date": 1534323643, "post_id": 51794496, "comment_id": 90663800, "body": "Were you able to test that last bit? @TylerMace"}], "owner": {"reputation": 23, "user_id": 4018752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iKoZ_9L69fU/AAAAAAAAAAI/AAAAAAAAAJc/_gwUtVREeCA/photo.jpg?sz=128", "display_name": "Tyler Mace", "link": "https://stackoverflow.com/users/4018752/tyler-mace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1533938397, "creation_date": 1533938397, "question_id": 51794496, "link": "https://stackoverflow.com/questions/51794496/how-can-i-use-named-pipes-to-stream-a-gcp-cloud-storage-object-to-an-executable", "title": "How can I use named pipes to stream a GCP Cloud Storage object to an executable that wants input files?", "body": "<p>I have a third-party executable that takes a directory path as an argument and in turn looks there for a collection of .db files. I have said collection of files stored in a Google Cloud Storage bucket and would like to stream the content of those files into some local named pipes that can be used as input to the executable.</p>\n\n<p>I'm writing an application to perform the above in Go and am using the <code>\"cloud.google.com/go/storage\"</code> package to work with cloud storage objects.</p>\n\n<p>As a note, I need all pipes/files to be available for reading at the time I run the executable.</p>\n\n<p>What is the best way to go about this? I'm looking to essentially used the named pipe as a proxy of sorts to make remote files look local to this executable. Possible?</p>\n"}, {"tags": ["go", "memory", "cryptography", "ethereum", "go-ethereum"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1533924478, "post_id": 51791869, "comment_id": 90541182, "body": "Duplicate of <a href=\"https://ethereum.stackexchange.com/questions/9833/is-it-possible-to-decrease-ram-usage-of-go-ethereumgeth\" title=\"is it possible to decrease ram usage of go ethereumgeth\">ethereum.stackexchange.com/questions/9833/&hellip;</a> ?"}, {"owner": {"reputation": 99, "user_id": 6201109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ivnXY.jpg?s=128&g=1", "display_name": "Q. Betti", "link": "https://stackoverflow.com/users/6201109/q-betti"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1533924961, "post_id": 51791869, "comment_id": 90541413, "body": "@Ullaakut Thanks for the link. However, as I said, I am not talking about the geth node, I am just talking about running the code I posted. Plus, I am not trying to send any transactions so far. Actually, the ethclient connection part of the code above can be removed and still the memory consumption is very high..."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1533930059, "post_id": 51791869, "comment_id": 90543765, "body": "Try <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">memory profiling</a> it."}, {"owner": {"reputation": 78952, "user_id": 1069068, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vw9qZ.png?s=128&g=1", "display_name": "Raghav Sood", "link": "https://stackoverflow.com/users/1069068/raghav-sood"}, "edited": false, "score": 0, "creation_date": 1533931732, "post_id": 51791869, "comment_id": 90544468, "body": "Geth is a fairly large program, and the internal code is quite interlinked. Using even a subset of geth can require running a lot of code."}, {"owner": {"reputation": 99, "user_id": 6201109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ivnXY.jpg?s=128&g=1", "display_name": "Q. Betti", "link": "https://stackoverflow.com/users/6201109/q-betti"}, "reply_to_user": {"reputation": 78952, "user_id": 1069068, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vw9qZ.png?s=128&g=1", "display_name": "Raghav Sood", "link": "https://stackoverflow.com/users/1069068/raghav-sood"}, "edited": false, "score": 0, "creation_date": 1534363200, "post_id": 51791869, "comment_id": 90683357, "body": "@RaghavSood Indeed. Please have a look at my edited question and my answer, you&#39;ll see that I am only dealing with cryptographic implementation issues so I do not think that Geth&#39;s size is involved howsoever."}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 6201109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ivnXY.jpg?s=128&g=1", "display_name": "Q. Betti", "link": "https://stackoverflow.com/users/6201109/q-betti"}, "is_accepted": false, "score": 0, "last_activity_date": 1534365102, "last_edit_date": 1534365102, "creation_date": 1534362648, "answer_id": 51865493, "question_id": 51791869, "link": "https://stackoverflow.com/questions/51791869/huge-persisting-memory-allocation-with-go-ethereum-bind-newtransactor/51865493#51865493", "title": "Huge persisting memory allocation with go-ethereum `bind.NewTransactor()`?", "body": "<p>Ok so, I did not <em>really</em> found the answer to my question, but as I did find a workaround I'll share it anyway.</p>\n\n<h2>Memory profiling</h2>\n\n<p>As @MichaelHampton suggested, I memory profiled my program. <code>top 10</code> command revealed the following:</p>\n\n<pre><code>(pprof) top 10\nShowing nodes accounting for 256MB, 99.88% of 256.30MB total\nDropped 15 nodes (cum &lt;= 1.28MB)\n    flat  flat%   sum%        cum   cum%\n    256MB 99.88% 99.88%      256MB 99.88%  github.com/ethereum/go-ethereum/vendor/golang.org/x/crypto/scrypt.Key\n        0     0% 99.88%      256MB 99.88%  github.com/ethereum/go-ethereum/accounts/abi/bind.NewTransactor\n        0     0% 99.88%      256MB 99.88%  github.com/ethereum/go-ethereum/accounts/keystore.DecryptKey\n        0     0% 99.88%      256MB 99.88%  github.com/ethereum/go-ethereum/accounts/keystore.decryptKeyV3\n        0     0% 99.88%      256MB 99.88%  github.com/ethereum/go-ethereum/accounts/keystore.getKDFKey\n        0     0% 99.88%   256.01MB 99.88%  main.main\n        0     0% 99.88%   256.30MB   100%  runtime.main\n</code></pre>\n\n<p>As you can see, the memory consumption comes from the <code>Key</code> function in package <code>scrypt</code>, which is called indirectly by <code>bind.NewTransactor(...)</code>. From the doc: </p>\n\n<blockquote>\n  <p>Key derives a key from the password, salt, and cost parameters, returning a byte slice of length keyLen that can be used as cryptographic key.</p>\n</blockquote>\n\n<p>In particular, this corresponds to how a private key is generated from a JSON wallet file. Indeed, the function itself allocates a lot of memory for cryptographic computations. What I do not understand though is why this huge memory allocation <strong>seems to persist once the key has been generated</strong> (the persistence is observed when I start the server with <code>log.Fatal(http.ListenAndServe(\":8080\", nil))</code> just after). </p>\n\n<h2>Workaround</h2>\n\n<p>To confirm my suspicion, I used another way to generate my <code>*TransactOpts</code>, which consists in getting the key directly form its hexadecimal representation instead of generating it from a wallet file:</p>\n\n<pre><code>func main() {\n    privateKey, err := crypto.HexToECDSA(\"myKeyInHex\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    auth := bind.NewKeyedTransactor(privateKey)\n\n    _ = auth\n}\n</code></pre>\n\n<p>Although <code>bind.NewTransactor</code> and <code>bind.NewKeyedTransactor</code> return exactly the same object (the only difference being how the key was generated), using <code>bind.NewTransactor</code> results in a 256MB <strong>persisting</strong> memory allocation, instead of a few KB for <code>bind.NewKeyedTransactor</code> as shown below:</p>\n\n<pre><code>(pprof) top 10\nShowing nodes accounting for 11.04kB, 100% of 11.04kB total\nShowing top 10 nodes out of 19\n    flat  flat%   sum%        cum   cum%\n  6.83kB 61.90% 61.90%     6.83kB 61.90%  time.initLocalFromTZI\n  4.21kB 38.10%   100%     4.21kB 38.10%  github.com/ethereum/go-ethereum/crypto/sha3.(*state).clone (inline)\n       0     0%   100%     4.21kB 38.10%  github.com/ethereum/go-ethereum/accounts/abi/bind.NewKeyedTransactor\n       0     0%   100%     4.21kB 38.10%  github.com/ethereum/go-ethereum/crypto.Keccak256\n       0     0%   100%     4.21kB 38.10%  github.com/ethereum/go-ethereum/crypto.PubkeyToAddress\n       0     0%   100%     4.21kB 38.10%  github.com/ethereum/go-ethereum/crypto/sha3.(*state).Sum\n       0     0%   100%     6.83kB 61.90%  github.com/pkg/profile.Start\n       0     0%   100%     6.83kB 61.90%  github.com/pkg/profile.Start.func2\n       0     0%   100%     6.83kB 61.90%  log.(*Logger).Output\n       0     0%   100%     6.83kB 61.90%  log.(*Logger).formatHeader\n</code></pre>\n\n<p>Thus, for my simulation I will generate my private keys from my JSON wallets and store them in text files upstream, and then use <code>bind.NewKeyedTransactor(...)</code>. I know this is not safe howsoever but for my simulation purpose it will be sufficient.</p>\n\n<p>However, I'm pretty sure <code>bind.NewTransactor</code> does not have the expected behavior concerning memory consumption, so I am going to open an <a href=\"https://github.com/ethereum/go-ethereum/issues/17411\" rel=\"nofollow noreferrer\">issue on the <code>go-ethereum</code> repository</a>.</p>\n"}], "owner": {"reputation": 99, "user_id": 6201109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ivnXY.jpg?s=128&g=1", "display_name": "Q. Betti", "link": "https://stackoverflow.com/users/6201109/q-betti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1534365102, "creation_date": 1533924229, "last_edit_date": 1534362930, "question_id": 51791869, "link": "https://stackoverflow.com/questions/51791869/huge-persisting-memory-allocation-with-go-ethereum-bind-newtransactor", "title": "Huge persisting memory allocation with go-ethereum `bind.NewTransactor()`?", "body": "<p>I am developing a REST service that interacts with a private Ethereum blockhain network. First, I used Java with the Web3j library and Jersey. Everything worked as expected but a single instance of the service (not the geth client) <strong>was taking up to 500MB of RAM!</strong> As I need several instances (~40) running at the same time for simulation purpose, I wanted something lighter.</p>\n\n<p>Thus I switched to Go (32-bit version, Windows 10) and the original go-ethereum package. However, I was very surprised to find out that the memory consumption of the program <strong>rises up to ~250MB</strong> as soon as I call and store the result of <code>bind.NewTransactor()</code>, which returns a <code>*TransactOpts</code>. I took a look at the sources but I could not explain such behavior.</p>\n\n<p>Is that normal (and if yes, why?) or am I missing something?</p>\n\n<p>Here is my code:</p>\n\n<pre><code>import (\n    \"github.com/ethereum/go-ethereum/accounts/abi/bind\"\n    \"strings\"\n)\n\nconst WALLET_PATH string = \"path/to/json/wallet\"\n\nfunc main() {\n\n    data, _ := ioutil.ReadFile(WALLET_PATH)\n    // up to this point, the program only takes a few MBs of RAM \n\n    auth, _ := bind.NewTransactor(strings.NewReader(string(data)), \"mypassphrase\")\n    // and here the allocated memory rises up to ~270MB\n    _ = auth\n}\n</code></pre>\n"}, {"tags": ["arrays", "json", "go", "struct", "graphql"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533924513, "post_id": 51791799, "comment_id": 90541198, "body": "The <code>child</code> is not a map its a slice of integer values. You can loop through them, it is unclear from the question you have asked what actually you want."}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533924678, "post_id": 51791799, "comment_id": 90541271, "body": "alright what i actually want is to obtain each value that is sended in the Mutation and saved it in a array of Cell (is the type Cell struct at the end)"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533924867, "post_id": 51791799, "comment_id": 90541363, "body": "i hope that my comment make it a little more clear @Himanshu"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533925860, "post_id": 51791799, "comment_id": 90541851, "body": "I edit the question so now it&#39;ll be more clear"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533969412, "post_id": 51791799, "comment_id": 90551290, "body": "Yeah we can do that just print the output of <code>cellsInterface</code> and <code>resolvedCells</code> in your question."}], "answers": [{"comments": [{"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1534005319, "post_id": 51797211, "comment_id": 90559692, "body": "Now i receive an error:   cannot use value (type interface {}) as type *Cell in append: need type assertion"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 0, "creation_date": 1534009026, "post_id": 51797211, "comment_id": 90560663, "body": "@LuisCardozaBird Please check edited code you need type assertion to get the underlying value"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1534009525, "post_id": 51797211, "comment_id": 90560793, "body": "I checked with this: <a href=\"https://stackoverflow.com/questions/14289256/cannot-convert-data-type-interface-to-type-string-need-type-assertion\" title=\"cannot convert data type interface to type string need type assertion\">stackoverflow.com/questions/14289256/&hellip;</a> but they take in consideration just one type of value (string), in this case is String and an Array :/ @Himanshu"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 0, "creation_date": 1534010136, "post_id": 51797211, "comment_id": 90560956, "body": "@LuisCardozaBird Its ok just provide me the output of json bytes <code>fmt.Println(string(cellsByte))</code>"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 0, "creation_date": 1534010228, "post_id": 51797211, "comment_id": 90560984, "body": "this is:  cells byte output:  [{&quot;child&quot;:[&quot;sasaa&quot;,&quot;sasa&quot;],&quot;name&quot;:&quot;lero&quot;},{&quot;child&quot;:[&quot;xzxz&quot;,&quot;&zwnj;&#8203;ffafa&quot;],&quot;name&quot;:&quot;lero&zwnj;&#8203;2&quot;}]"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1534010262, "post_id": 51797211, "comment_id": 90560996, "body": "@LuisCardozaBird that&#39;s what I needed give me sometime."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1534011026, "post_id": 51797211, "comment_id": 90561213, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/177878/discussion-between-himanshu-and-luis-cardoza-bird\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1534013883, "last_edit_date": 1534013883, "creation_date": 1533970058, "answer_id": 51797211, "question_id": 51791799, "link": "https://stackoverflow.com/questions/51791799/golang-graphql-iterate-over-map-with-submap/51797211#51797211", "title": "Golang graphql iterate over map with submap", "body": "<p>Range through the map values in the result and append those values to Cell slice. If you are getting an object from json. Then you can unmarshall the bytes into Cell.</p>\n\n<p>The result when unmarshalling should be a slice of Cell struct as</p>\n\n<pre><code>var resolvedCells []Cell\nif err := json.Unmarshal(cellsByte, &amp;resolvedCells); err != nil {\n                fmt.Println(\"unmarshal the input json to Data.Cells\", err)\n    }\nfmt.Println(resolvedCells)\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/aRXD9FGn1d4\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p>Or if you want to use pointers loop over the resolvedCell as</p>\n\n<pre><code>type Cells []*Cell\n\nfunc main() {\n    var resolvedCells Cells\n    if err := json.Unmarshal(cellsByte, &amp;resolvedCells); err != nil {\n                    fmt.Println(\"unmarshal the input json to Data.Cells\", err)\n        }\n    fmt.Println(*resolvedCells[1])\n    for _, value := range resolvedCells{\n        fmt.Println(value)\n        fmt.Printf(\"%+v\",value.Child) // access child struct value of array\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cHJrNy2XrA_f\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 51797211, "answer_count": 1, "score": 1, "last_activity_date": 1534014247, "creation_date": 1533923902, "last_edit_date": 1534014247, "question_id": 51791799, "link": "https://stackoverflow.com/questions/51791799/golang-graphql-iterate-over-map-with-submap", "title": "Golang graphql iterate over map with submap", "body": "<p>Recently I was trying to an implementation of a Mutation Request using GoLang as a Graphql Server, Basically this is the query that i send: As you can see its an array of object that contains <strong>name</strong> and an <strong>array of strings</strong></p>\n\n<pre><code>mutation{\n    CellTest(cells:[{name:\"lero\",child:[\"1\",\"2\"]},{name:\"lero2\",child:[\"12\",\"22\"]}]){\n            querybody\n    }\n}\n</code></pre>\n\n<p>In my Go code I have a type object that is gonna set the values sent</p>\n\n<pre><code>type Cell struct {\n    name  string   `json:\"name\"`\n    child []string `json:\"child\"`\n}\n</code></pre>\n\n<p>and a custom array that is gonna be []Cell</p>\n\n<pre><code>type Cells []*Cell\n</code></pre>\n\n<p>However when the request is received by GO I get this:\nNote that this is the print of <strong>cellsInterface</strong></p>\n\n<blockquote>\n  <p>[map[child:[1 2] name:lero] map[child:[12 22] name:lero2]]</p>\n</blockquote>\n\n<p>How can i get each value and assign those in my <strong>Array Cells</strong>\nsomething like this:</p>\n\n<blockquote>\n  <p>Cells[0] = {name=\"first\",child={\"1\",\"2\"}}</p>\n  \n  <p>Cells[1] = {name=\"second\",child={\"hello\",\"good\"}}</p>\n</blockquote>\n\n<p>this is my current attempt:</p>\n\n<pre><code>var resolvedCells Cells\ncellsInterface := params.Args[\"cells\"].([]interface{})\ncellsByte, err := json.Marshal(cellsInterface)\nif err != nil {\n    fmt.Println(\"marshal the input json\", err)\n    return resolvedCells, err\n}\n\nif err := json.Unmarshal(cellsByte, &amp;resolvedCells); err != nil {\n    fmt.Println(\"unmarshal the input json to Data.Cells\", err)\n    return resolvedCells, err\n}\n\nfor cell := range resolvedCells {\n    fmt.Println(cellsInterface[cell].([]interface{}))\n}\n</code></pre>\n\n<p>However this only split the cells array into 0 and 1.</p>\n"}]