[{"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1535570699, "post_id": 52084687, "comment_id": 91119751, "body": "<code>:=</code> is the shortcut operator to declare and initialize a variable at the same time. You cannot &quot;declare&quot; a field of a struct."}], "answers": [{"tags": [], "owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "is_accepted": false, "score": 4, "last_activity_date": 1535572211, "last_edit_date": 1535572211, "creation_date": 1535571330, "answer_id": 52084904, "question_id": 52084687, "link": "https://stackoverflow.com/questions/52084687/why-does-initializing-just-one-variable-in-a-definition-fail-in-golang/52084904#52084904", "title": "Why does initializing just one variable in a definition fail, in golang", "body": "<p><code>:=</code> declares a new variable \"identifier\".  This means you are adding a named thing in your program that can be assigned a value.  A struct's fields already are named, as in the golang parser knows they exist so using <code>:=</code> makes no sense to golang in this case.</p>\n\n<blockquote>\n  <p>Why does declaring k &lt; n variables in a := assignment fail?!</p>\n</blockquote>\n\n<p>I'm not sure what \"k &lt; n\" means, but I think you mean \"why does having multiple variables on the left side of <code>:=</code> fail?\".  If that's what you mean, that's not true.</p>\n\n<pre><code>x, y, z := func() (int,int,int) {return 1,2,3}()\nfmt.Println(x, y, z)\n</code></pre>\n\n<p>works just fine.  The issue is that golang cannot create an \"identifier\" (aka a newly named variable) for a struct field since that struct field already exists.</p>\n\n<p>EDIT:\nI just had a brainwave that you might have mean \"why does having only <em>some</em> new identifiers to declare on the left side of <code>:=</code> not work?\".  This also is not true.</p>\n\n<pre><code>x, y := 5, 6\nfmt.Println(x, y)\nx, y, z := 1, 2, 3\nfmt.Println(x, y, z)\n</code></pre>\n\n<p>The above works just fine as well.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1535572957, "last_edit_date": 1535572957, "creation_date": 1535572146, "answer_id": 52085092, "question_id": 52084687, "link": "https://stackoverflow.com/questions/52084687/why-does-initializing-just-one-variable-in-a-definition-fail-in-golang/52085092#52085092", "title": "Why does initializing just one variable in a definition fail, in golang", "body": "<p><code>:=</code> is not <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assignment</a>, it is a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable <em>declaration</em></a>. Assignment uses e.g. the simple <code>=</code> operator.</p>\n\n<p>As its name says: it is to <em>declare</em> variables. <code>suite.db</code> is not a variable, it is an <a href=\"https://golang.org/ref/spec#Expressions\" rel=\"noreferrer\">expression</a>, more specifically a <a href=\"https://golang.org/ref/spec#Primary_expressions\" rel=\"noreferrer\">primary expression</a>; a <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"noreferrer\">selector</a> to be exact.</p>\n\n<p>The short variable declaration uses the syntax:</p>\n\n<blockquote>\n<pre><code>ShortVarDecl = IdentifierList \":=\" ExpressionList .\n</code></pre>\n</blockquote>\n\n<p>Where <a href=\"https://golang.org/ref/spec#IdentifierList\" rel=\"noreferrer\"><code>IdentifierList</code></a> is:</p>\n\n<blockquote>\n<pre><code>IdentifierList = identifier { \",\" identifier } .\n</code></pre>\n</blockquote>\n\n<p>So you must list <a href=\"https://golang.org/ref/spec#Identifiers\" rel=\"noreferrer\">identifiers</a>. One \"exception\" to this \"declare new variables rule\" is the <em>redeclaration</em>:</p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may <em>redeclare</em> variables provided they were originally declared earlier in the same block (or the parameter lists if the block is the function body) with the same type, and at least one of the non-<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"noreferrer\">blank</a> variables is new. As a consequence, redeclaration can only appear in a multi-variable short declaration. Redeclaration does not introduce a new variable; it just assigns a new value to the original.</p>\n</blockquote>\n\n<p>So you are allowed to use existing variables in a short variable declaration if they were declared in the same block, and you also provide new identifiers (not just existing ones\u2013in which case you would have to use assignment instead).</p>\n\n<p>See related: <a href=\"https://stackoverflow.com/questions/27919359/why-there-are-two-ways-of-declaring-variables-in-go-whats-the-difference-and-w/27919847#27919847\">Why there are two ways of declaring variables in Go, what&#39;s the difference and which to use?</a></p>\n\n<p>When you declare <code>err</code> prior and change <code>:=</code> to <code>=</code> it works, because the assignment does not require identifiers on the left of the assignment operator, but expressions:</p>\n\n<blockquote>\n<pre><code>Assignment = ExpressionList assign_op ExpressionList .\n</code></pre>\n</blockquote>\n\n<p>And as detailed above, <code>suite.db</code> is an expression, just like existing variables (identifiers).</p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2765, "favorite_count": 0, "accepted_answer_id": 52085092, "answer_count": 2, "score": 3, "last_activity_date": 1535572957, "creation_date": 1535570449, "question_id": 52084687, "link": "https://stackoverflow.com/questions/52084687/why-does-initializing-just-one-variable-in-a-definition-fail-in-golang", "title": "Why does initializing just one variable in a definition fail, in golang", "body": "<p>In calling a library function with the following signature: </p>\n\n<pre><code>func New() (*sql.DB, Sqlmock, error)\n</code></pre>\n\n<p>like this:</p>\n\n<pre><code>suite.db, suite.mock, err := sqlmock.New() // inside a suite method\n</code></pre>\n\n<p>I get error</p>\n\n<pre><code>expected identifier on left side of :=\n</code></pre>\n\n<p>However, when I change to this </p>\n\n<pre><code>var err error\nsuite.db, suite.mock, err = sqlmock.New()\n</code></pre>\n\n<p>the error disappears! <strong>Why does declaring k &lt; n variables in a <code>:=</code> assignment fail?!</strong></p>\n"}, {"tags": ["database", "go", "clickhouse"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1535570556, "post_id": 52084504, "comment_id": 91119694, "body": "<code>resp.Body</code> isn&#39;t the response body; it&#39;s an <code>io.Reader</code>, from which you can read the response body."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1535570610, "post_id": 52084504, "comment_id": 91119719, "body": "Take a look at e.g. <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\">golang.org/pkg/io/ioutil/#ReadAll</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535618522, "post_id": 52084504, "comment_id": 91135233, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38807903/how-do-i-handle-plain-text-http-get-response-in-golang\">How do I handle plain text HTTP Get response in Golang?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "is_accepted": false, "score": 0, "last_activity_date": 1535648777, "creation_date": 1535648777, "answer_id": 52102239, "question_id": 52084504, "link": "https://stackoverflow.com/questions/52084504/how-to-make-an-http-request-to-get-data-from-clickhouse-database/52102239#52102239", "title": "How to make an HTTP request to get data from clickhouse database", "body": "<p>I had to add an extra line</p>\n\n<pre><code>message, _ := ioutil.ReadAll(resp.Body)\n\nfmt.Println(string(message))\n</code></pre>\n\n<p>That helped me to get what I wanted.</p>\n"}], "owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1535648777, "creation_date": 1535569616, "last_edit_date": 1535571998, "question_id": 52084504, "link": "https://stackoverflow.com/questions/52084504/how-to-make-an-http-request-to-get-data-from-clickhouse-database", "title": "How to make an HTTP request to get data from clickhouse database", "body": "<p>I'm trying to make an HTTP request to get data from clickhouse database using  Go. I don't have too much experience with it and not sure how to get the returned value by the query</p>\n\n<p>This is what I have:</p>\n\n<pre><code>reader := strings.NewReader(\"SELECT COUNT(*) FROM system.tables WHERE database = 'local' AND name = 'persons'\")\nrequest, err := http.NewRequest(\"GET\", \"http://localhost:8123\", reader)\nif err != nil {\n    fmt.Println(err)\n}\n\nclient := &amp;http.Client{}\nresp, err := client.Do(request)\nif err != nil {\n    fmt.Println(err)\n}\n\nfmt.Println(\"The answer is: \", resp.Body)\n</code></pre>\n\n<p>The expected output should be a number (1 means table exist and 0 means that doesn't exist) but I'm getting in <code>resp.Body</code> this output:</p>\n\n<pre><code>The answer is:  &amp;{0xc4201741c0 {0 0} false &lt;nil&gt; 0x6a9bb0 0x6a9b20}\n</code></pre>\n\n<p>Any idea to get just the value of the query?</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 0, "last_activity_date": 1535652942, "last_edit_date": 1535652942, "creation_date": 1535645214, "answer_id": 52101330, "question_id": 52084230, "link": "https://stackoverflow.com/questions/52084230/soft-delete-cascade-not-working/52101330#52101330", "title": "Soft delete cascade not working", "body": "<p>A soft delete means gorm do not remove your data. It only mark a non-zero <code>DeleteAt</code> timestamp. That is not supported by database directly. So foreign key has no effect here.</p>\n\n<p>That means you need to manually implement the cascaded delete yourself, like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func DeleteUser(db *gorm.DB, id int) error {\n  tx := db.Begin()\n  if tx.Where(\"id = ?\", id).Delete(&amp;User{}); tx.Error != nil {\n    tx.Rollback()\n    return tx.Error\n  }\n  // Changed this line\n  // if tx.Where(\"user_id = id\", 3).Delete(&amp;Calendar{}); tx.Error != nil {\n     if tx.Where(\"user_id = ?\", id).Delete(&amp;Calendar{}); tx.Error != nil {\n    tx.Rollback()\n    return tx.Error\n  }\n  return tx.Commit().Error\n}\n</code></pre>\n"}], "owner": {"reputation": 164, "user_id": 1069875, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/35be8a640697bc1315634303decc7b6e?s=128&d=identicon&r=PG", "display_name": "aaa", "link": "https://stackoverflow.com/users/1069875/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 52101330, "answer_count": 1, "score": 0, "last_activity_date": 1539070321, "creation_date": 1535568343, "last_edit_date": 1539070321, "question_id": 52084230, "link": "https://stackoverflow.com/questions/52084230/soft-delete-cascade-not-working", "title": "Soft delete cascade not working", "body": "<p>Objective: If a User is marked deleted in a soft delete, his calendar should also be marked deleted.</p>\n\n<p><strong>structs:</strong></p>\n\n<pre><code>type User struct {\n    gorm.Model\n    Username  string\n    FirstName string\n    LastName  string\n    Calendar  Calendar\n}\n\ntype Calendar struct {\n    gorm.Model\n    Name   string\n    UserID uint\n}\n</code></pre>\n\n<p><strong>constraint:</strong></p>\n\n<pre><code>db.Model(&amp;Calendar{}).AddForeignKey(\"user_id\", \"users(id)\", \"CASCADE\",\"CASCADE\")\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<p><em>A hard delete works: Both the user and his calendar are deleted (records are gone)</em></p>\n\n<pre><code>db.Exec(\"Delete from users where id=3\")\n</code></pre>\n\n<p><em>A soft delete does not work as anticpated:</em></p>\n\n<pre><code>db.Where(\"id = ?\", 3).Delete(&amp;User{})\n</code></pre>\n\n<p>With a soft delete, </p>\n\n<ol>\n<li>the user table field => deleted_at is dated.</li>\n<li>the calendar table =? deleted_at is blank</li>\n</ol>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 5, "creation_date": 1535567263, "post_id": 52083388, "comment_id": 91118224, "body": "always check for all errors to avoid this kind of situation. Please check the expression <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\">Tmpl.ExecuteTemplate(w, &quot;page&quot;, p)</a>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1535567292, "post_id": 52083388, "comment_id": 91118238, "body": "That console error is unrelated to your problem, so I removed it from the question."}, {"owner": {"reputation": 162, "user_id": 10029758, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nhzV8.jpg?s=128&g=1", "display_name": "MarcusOuelletus", "link": "https://stackoverflow.com/users/10029758/marcusouelletus"}, "edited": false, "score": 0, "creation_date": 1535568353, "post_id": 52083388, "comment_id": 91118727, "body": "Check ExecuteTemplate for errors. The page struct is defined somewhere right? Also, you show the gohtml file as being in template/ but in parseglob you&#39;re checking in templates, not template"}, {"owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "edited": false, "score": 0, "creation_date": 1535594757, "post_id": 52083388, "comment_id": 91126815, "body": "I will check for errors. Yes templates is plural. I will update the results again. Sorry, but I just started Golang few weeks back."}], "answers": [{"tags": [], "owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "is_accepted": true, "score": 0, "last_activity_date": 1535596139, "creation_date": 1535596139, "answer_id": 52088443, "question_id": 52083388, "link": "https://stackoverflow.com/questions/52083388/executetemplate-template-parseglob-loads-blank-page/52088443#52088443", "title": "ExecuteTemplate (template.ParseGlob) loads Blank page", "body": "<p>I found the issue when I used error handling.</p>\n\n<pre><code>if err := Tmpl.ExecuteTemplate(w, \"page\", p); err != nil {\n        log.Printf(\"Template error: %v\", err)\n        w.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n</code></pre>\n\n<p>Which printed \"no such template comments\" while I was using <code>defined \"comment\"</code> inside <strong>comment.gohtml</strong></p>\n\n<p>Sorry for posting this question, I recently started GoLang.</p>\n"}], "owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 52088443, "answer_count": 1, "score": -2, "last_activity_date": 1535596139, "creation_date": 1535564681, "last_edit_date": 1535594708, "question_id": 52083388, "link": "https://stackoverflow.com/questions/52083388/executetemplate-template-parseglob-loads-blank-page", "title": "ExecuteTemplate (template.ParseGlob) loads Blank page", "body": "<p>I'm trying to load template <code>page.gohtml</code> from folder <code>cms/template</code>. When trying to view in Firefox browser it load Blank.</p>\n\n<p><strong>handler.go</strong> file</p>\n\n<pre><code>var Tmpl = template.Must(template.ParseGlob(\"../templates/*\"))\n\nfunc ServeIndex(w http.ResponseWriter, r *http.Request) {\n    p := &amp;Page{\n        Title:   \"Go Projects CMS\",\n        Content: \"Welcome to the Home Page!\",\n        Posts: []*Post{\n            {\n                Title:         \"Hello World!\",\n                Content:       \"Hey y'all, Thanks for coming\",\n                DatePublished: time.Now(),\n            },\n            {\n                Title:         \"This Has Comments\",\n                Content:       \"Atlassian Just Bought Trello...GO!\",\n                DatePublished: time.Now().Add(-time.Hour),\n                Comments: []*Comment{\n                    {\n                        Author:        \"Davy Jones\",\n                        Content:       \"This is something to say about something\",\n                        DatePublished: time.Now().Add(-time.Hour / 2),\n                    },\n                },\n            },\n        },\n    }\n    Tmpl.ExecuteTemplate(w, \"page\", p)\n}\n</code></pre>\n\n<p><strong>cmd/main.go</strong> file</p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", cms.ServeIndex)\n\n    fmt.Println(\"Server running at port 3000\")\n    go http.ListenAndServe(\":3000\", r)\n    fmt.Scanln()\n}\n</code></pre>\n\n<p><strong>templates/page.gohtml</strong></p>\n\n<pre><code>{{ define \"page\" }}\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n    &lt;title&gt;{{ .Title }}&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css\"/&gt;\n&lt;/head&gt;\n&lt;body class=\"w-100 sans-serif bg-white\"&gt;\n    &lt;h1&gt;Welcome&lt;/h1&gt;\n    &lt;div class=\"baskerville pb5\"&gt;\n    {{ .Content }}\n    {{if .Posts}}\n        {{range .Posts}}\n            {{template \"post\" .}}\n        {{end}}\n    {{end}}\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n"}, {"tags": ["templates", "go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 1, "last_activity_date": 1535567482, "last_edit_date": 1535567482, "creation_date": 1535563874, "answer_id": 52083212, "question_id": 52082977, "link": "https://stackoverflow.com/questions/52082977/simplify-template-usage-by-removing-array/52083212#52083212", "title": "Simplify template usage by removing array", "body": "<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\nfunc main() {\n    // Define a template.\n    const tmpl = `\necho &amp;1\n\n{{range $i,$a := .Command}}{{if gt $i 0 }} &amp;&amp; {{end}}{{.}}{{end}}\n\necho 2\n`\n\n    // Prepare some data\n    type App struct {\n        Data    string\n        Command []string\n    }\n    data := App{\"test data\", []string{\"app1\", \"app2\", \"app3\"}}\n\n    // Create a new template and parse into it.\n    t := template.Must(template.New(\"tmpl\").Parse(tmpl))\n\n    // Execute the template with data\n    err := t.Execute(os.Stdout, data)\n    if err != nil {\n        log.Println(\"executing template:\", err)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/OwysCnIhhOV\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>Gives the output</p>\n\n<pre><code>echo &amp;1\n\napp1 &amp;&amp; app2 &amp;&amp; app3\n\necho 2\n\nProgram exited.\n</code></pre>\n\n<p>If you remove the <code>[]App</code> from your code, you also need to remove the <code>range</code> used in the template.</p>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 52083212, "answer_count": 1, "score": 1, "last_activity_date": 1535567482, "creation_date": 1535563113, "last_edit_date": 1535566993, "question_id": 52082977, "link": "https://stackoverflow.com/questions/52082977/simplify-template-usage-by-removing-array", "title": "Simplify template usage by removing array", "body": "<p>I am trying to simplify the template which I use to make it use a flatter data structure:</p>\n\n<p>from </p>\n\n<pre><code>data := []App{App{\"test data\", []string{\"app1\", \"app2\", \"app3\"}}}\n</code></pre>\n\n<p>To: </p>\n\n<pre><code>data := App{App{\"test data\", []string{\"app1\", \"app2\", \"app3\"}}}\n</code></pre>\n\n<p>i.e. Remove the array of <code>App</code>, but when I try it I get an error.</p>\n\n<p>Here is the working version: <a href=\"https://play.golang.org/p/2THGtDvlu01\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2THGtDvlu01</a></p>\n\n<p>I tried to change the template to</p>\n\n<pre><code>{{ range . -}}\n{range $i,$a := .Command}{{if gt $i 0 }} &amp;&amp; {{end}}{{.}}{{end}}\n{{end}}\n</code></pre>\n\n<p>But I got an error of <code>type mismatched</code>, any idea how to fix it?</p>\n"}, {"tags": ["go", "circleci", "go-modules"], "comments": [{"owner": {"reputation": 925, "user_id": 1328019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ORfk5.jpg?s=128&g=1", "display_name": "amcelwee", "link": "https://stackoverflow.com/users/1328019/amcelwee"}, "edited": false, "score": 0, "creation_date": 1535562462, "post_id": 52082783, "comment_id": 91115816, "body": "Are you using CircleCI 2.0? I&#39;d assume so, since 1.0 is at end of life on August 31."}, {"owner": {"reputation": 223, "user_id": 455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MwoTZ.jpg?s=128&g=1", "display_name": "Rob G.", "link": "https://stackoverflow.com/users/455/rob-g"}, "reply_to_user": {"reputation": 925, "user_id": 1328019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ORfk5.jpg?s=128&g=1", "display_name": "amcelwee", "link": "https://stackoverflow.com/users/1328019/amcelwee"}, "edited": false, "score": 0, "creation_date": 1535562476, "post_id": 52082783, "comment_id": 91115824, "body": "Yeah, CircleCI 2.0"}], "answers": [{"tags": [], "owner": {"reputation": 925, "user_id": 1328019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ORfk5.jpg?s=128&g=1", "display_name": "amcelwee", "link": "https://stackoverflow.com/users/1328019/amcelwee"}, "is_accepted": true, "score": 36, "last_activity_date": 1535648779, "last_edit_date": 1535648779, "creation_date": 1535562703, "answer_id": 52082860, "question_id": 52082783, "link": "https://stackoverflow.com/questions/52082783/how-do-i-find-the-go-module-source-cache/52082860#52082860", "title": "How do I find the Go module source cache?", "body": "<p>As of the final 1.11 release, the go <em>module cache</em> (used for storing downloaded modules and source code), is in the <code>$GOPATH/pkg/mod</code> location (see the docs <a href=\"https://golang.org/cmd/go/#hdr-GOPATH_and_Modules\" rel=\"noreferrer\">here</a>). For clarification, the go <em>build cache</em> (used for storing recent compilation results) is in a different location.</p>\n\n<p><a href=\"https://dave.cheney.net/2018/07/14/taking-go-modules-for-a-spin\" rel=\"noreferrer\">This article</a>, indicated that it's in the <code>$GOPATH/src/mod</code>, but in the timespan of the recent ~40 days, the golang team must have changed that target location. <a href=\"https://groups.google.com/forum/#!msg/golang-dev/RjSj4bGSmsw/KMHhU8fmAwAJ\" rel=\"noreferrer\">This message thread</a> has some discussion on why the downloaded items ended up in <code>$GOPATH/pkg</code>.</p>\n\n<p>You can also use the <code>go mod download -json</code> command to see the downloaded modules/source metadata and their location on your local disk. Example output below:</p>\n\n<pre><code>$ go mod download -json\ngo: finding github.com/aws/aws-sdk-go v1.14.5\ngo: finding github.com/aws/aws-lambda-go v1.2.0\n{\n    \"Path\": \"github.com/aws/aws-lambda-go\",\n    \"Version\": \"v1.2.0\",\n    \"Info\": \"/go/pkg/mod/cache/download/github.com/aws/aws-lambda-go/@v/v1.2.0.info\",\n    \"GoMod\": \"/go/pkg/mod/cache/download/github.com/aws/aws-lambda-go/@v/v1.2.0.mod\",\n    \"Zip\": \"/go/pkg/mod/cache/download/github.com/aws/aws-lambda-go/@v/v1.2.0.zip\",\n    \"Dir\": \"/go/pkg/mod/github.com/aws/aws-lambda-go@v1.2.0\",\n    \"Sum\": \"h1:2f0pbAKMNNhvOkjI9BCrwoeIiduSTlYpD0iKEN1neuQ=\",\n    \"GoModSum\": \"h1:zUsUQhAUjYzR8AuduJPCfhBuKWUaDbQiPOG+ouzmE1A=\"\n}\n{\n    \"Path\": \"github.com/aws/aws-sdk-go\",\n    \"Version\": \"v1.14.5\",\n    \"Info\": \"/go/pkg/mod/cache/download/github.com/aws/aws-sdk-go/@v/v1.14.5.info\",\n    \"GoMod\": \"/go/pkg/mod/cache/download/github.com/aws/aws-sdk-go/@v/v1.14.5.mod\",\n    \"Zip\": \"/go/pkg/mod/cache/download/github.com/aws/aws-sdk-go/@v/v1.14.5.zip\",\n    \"Dir\": \"/go/pkg/mod/github.com/aws/aws-sdk-go@v1.14.5\",\n    \"Sum\": \"h1:+l1m6QH6LypE2kL0p/G0Oh7ceCv+IVQ1h5UEBt2xjjU=\",\n    \"GoModSum\": \"h1:ZRmQr0FajVIyZ4ZzBYKG5P3ZqPz9IHG41ZoMu1ADI3k=\"\n}\n</code></pre>\n\n<p>That output is from a build on CircleCI 2.0, using their official <code>circleci/golang:1.11</code> image. This is a contrived example to show how you would include the <code>restore_cache</code> and <code>save_cache</code> steps for the new golang module cache location:</p>\n\n<pre><code>steps:\n    - checkout\n    - restore_cache:\n       keys:\n         - gomod-cache-{{ checksum \"go.sum\" }}\n    - run: go vet ./...\n    - save_cache:\n        key: gomod-cache-{{ checksum \"go.sum\" }}\n        paths:\n          - /go/pkg/mod\n</code></pre>\n"}], "owner": {"reputation": 223, "user_id": 455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MwoTZ.jpg?s=128&g=1", "display_name": "Rob G.", "link": "https://stackoverflow.com/users/455/rob-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14765, "favorite_count": 6, "accepted_answer_id": 52082860, "answer_count": 1, "score": 20, "last_activity_date": 1535648779, "creation_date": 1535562413, "last_edit_date": 1535562764, "question_id": 52082783, "link": "https://stackoverflow.com/questions/52082783/how-do-i-find-the-go-module-source-cache", "title": "How do I find the Go module source cache?", "body": "<p>I've upgraded a project to Go 1.11 and enabled module support for my project, but it seems that CircleCI is re-downloading the dependencies on every build. I know CircleCI allows caching between rebuilds, so I've looked at the documentation for Go modules, and while it mentions a cache, I can't seem to find where it actually exists.</p>\n\n<p>Where is the source cache for Go modules?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1535560016, "post_id": 52081995, "comment_id": 91114590, "body": "If it helps, the offending error is in the go source here: <a href=\"https://golang.org/src/database/sql/sql.go#L1232\" rel=\"nofollow noreferrer\">golang.org/src/database/sql/sql.go#L1232</a> Which translates to, somehow something is returning a connection to the database connection pool that was never out (given out). Or perhaps it was given out, but never put to use."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1535560561, "post_id": 52081995, "comment_id": 91114862, "body": "Now that you mention that, I&#39;m trying to do the following :  - setup two distinct row states as members of <code>suite</code>, in setup. To do this, and to avoid shallow-copy later on, I saved them as <code>sql.Row</code> instead of <code>*sql.Row</code> - in test, I try to deep-copy one of them (the one I want) via setting up a new pointer, and setting what it points to to the original state.   <i>This may decouple the <code>*sql.Row</code> that operations are happening on from any stub connection in the suite</i>, thus causing the panic"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1535561454, "post_id": 52081995, "comment_id": 91115272, "body": "That&#39;s probably it. I wouldn&#39;t recommend trying to clone those resources that way, due to the behind-the-scenes resource management that <code>sql</code> is trying to do."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1535562039, "post_id": 52081995, "comment_id": 91115564, "body": "Is there alternative, for this situation?"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1535577500, "post_id": 52083984, "comment_id": 91122719, "body": "Aha, by manually creating <code>new(sql.Rows)</code> it was creating it with zero values and would trip that panic. Guess you can&#39;t just go about creating another packages structs without proper initialization, which stands to reason, but is something possible to forget."}], "tags": [], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "is_accepted": false, "score": 0, "last_activity_date": 1535567294, "creation_date": 1535567294, "answer_id": 52083984, "question_id": 52081995, "link": "https://stackoverflow.com/questions/52081995/from-test-panic-sql-connection-returned-that-was-never-out/52083984#52083984", "title": "from test, panic: sql: connection returned that was never out", "body": "<p>Turns out that I was overthinking this situation. </p>\n\n<p>I fixed it by storing the two row states <em>as pointers</em>, and then setting them in <code>RowsSuite.SetupTest</code> (at the test level, not the suite level). From there, I just fetch one of the states in the test, and I was good to go. Namely, instead of this (which would work fine in C++):</p>\n\n<pre><code>func (suite *RowsSuite) TestReadFrom_SanityTest() {\n    t := suite.T()\n\n    rows := new(sql.Rows)\n    *rows = suite.nonEmptyRows\n\n    assert.True(t, rows.Next())\n    // hit the function like it's supposed to be hit\n    err := ReadFrom(rows,\n        suite.fnStubFalse,\n        suite.spots[0],\n        suite.spots[1],\n        suite.spots[2])\n\n    // There better be no error\n    if !assert.Nil(t, err) {\n        t.Error(err.ToString(false))\n    }\n\n}\n</code></pre>\n\n<p>I did this: </p>\n\n<pre><code>func (suite *RowsSuite) TestReadFrom_SanityTest() {\n    t := suite.T()\n\n    rows := suite.nonEmptyRows\n\n    // hit the function like it's supposed to be hit\n    errSt := ReadFrom(rows,\n        suite.fnStubFalse,\n        suite.spots[0],\n        suite.spots[1],\n        suite.spots[2])\n\n    // There better be no error\n    if !assert.Nil(t, errSt) {\n        t.Error(errSt.ToString(false))\n    }\n\n}\n</code></pre>\n\n<p>where <code>nonEmptyRows</code> is one of the states set just before the test is run</p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535567294, "creation_date": 1535559383, "question_id": 52081995, "link": "https://stackoverflow.com/questions/52081995/from-test-panic-sql-connection-returned-that-was-never-out", "title": "from test, panic: sql: connection returned that was never out", "body": "<p>I get the following panic at run time of my test: </p>\n\n<pre><code>panic: sql: connection returned that was never out\n</code></pre>\n\n<p><strong>The test</strong></p>\n\n<p>The actual test is part of a <a href=\"https://godoc.org/github.com/stretchr/testify/suite\" rel=\"nofollow noreferrer\">test suite</a>, and is defined thus: </p>\n\n<pre><code>func (suite *RowsSuite) TestReadFrom_SanityTest() {\n    t := suite.T()\n\n    rows := new(sql.Rows)\n    *rows = suite.nonEmptyRows\n\n    assert.True(t, rows.Next())\n    // hit the function like it's supposed to be hit\n    err := ReadFrom(rows,\n        suite.fnStubFalse,\n        suite.spots[0],\n        suite.spots[1],\n        suite.spots[2])\n\n    // There better be no error\n    if !assert.Nil(t, err) {\n        t.Error(err.ToString(false))\n    }\n\n}\n</code></pre>\n\n<p><strong>The code under test</strong></p>\n\n<p>I'm responsible for testing this function: </p>\n\n<pre><code>// ReadFrom reads values from `rows` into `valuePlaceholders`\nfunc ReadFrom(rows *sql.Rows,\n    readerFunc func(rowIndex int, readValues ...interface{}) (bool, *errors.ErrorSt),\n    valuePlaceholders ...interface{}) (err *errors.ErrorSt) {\n\n    rowLine := 1\n    for rows.Next() {\n        if err := rows.Scan(valuePlaceholders...); err != nil {\n            return errors.Database().AddDetails(err.Error(), valuePlaceholders)\n        }\n        if readerFunc != nil {\n            skipRest, err := readerFunc(rowLine, valuePlaceholders...)\n            if err != nil {\n                return err\n            }\n            if skipRest {\n                break\n            }\n        }\n        rowLine++\n    }\n    if rowLine == 1 {\n        return errors.Get(appErrors.ACNoRows)\n    }\n    return nil\n}\n</code></pre>\n\n<p><strong>Setup</strong></p>\n\n<p><code>suite.fnStubFalse</code> is simply a function stub that returns <code>false,nil</code>\n<code>suite.spots</code> is simply an <code>[]*interface{}</code> of size 3. Simply put, it's three spots to <code>Scan</code> to. </p>\n\n<p>The rest of the definitions relevant to the test are defined in this helper method which is invoked on suite setup:</p>\n\n<pre><code>func (suite *RowsSuite) setupRowStates() {\n    // for throwing fatal error right away\n    t := suite.T()\n    // fire up the mock\n    suite.db, suite.mock, suite.err = sqlmock.New()\n    // if there's an error, fatally throw it right away!\n    if !assert.Nilf(t,\n        suite.err,\n        \"Error with initializing a stub database connection\") {\n        t.Fatal()\n    }\n\n    // define the possible expectant result sets\n    noRows := sqlmock.NewRows(suite.columns)\n    nonEmptyRows := sqlmock.NewRows(suite.columns).\n        AddRow(381, \"Beans\", 1.59).\n        AddRow(34981, \"Frozen Pizza\", 5.49)\n\n    // define our sql behavior\n    regex := \"^SELECT (.+) FROM items$\"\n    sql := \"SELECT (item_id, item_name, item_price) FROM items\"\n\n    specificRegex := \"^SELECT (.+) FROM items (.+)$\"\n    specificSQL := `\n    SELECT (item_id, item_name, item_price) FROM items i\n    INNER JOIN stock s\n    ON s.item_id = i.item_id\n    WHERE TIME_TO_SEC(s.stock_time) &gt; TIME_TO_SEC(NOW())`\n\n    // setup general query to return non-empty rows\n    suite.mock.ExpectQuery(regex).\n        WillReturnRows(nonEmptyRows)\n    // setup specific query to return empty rows\n    suite.mock.ExpectQuery(specificRegex).\n        WillReturnRows(noRows)\n\n    // hit both queries right now and store the state of their\n    //  return values, terminating right away on any errors\n    var err error\n    rows, err := suite.db.Query(sql)\n    if err != nil {\n        t.Fatal(err.Error())\n    }\n    suite.nonEmptyRows = *rows\n    emptyRows, err := suite.db.Query(specificSQL)\n    if err != nil {\n        t.Fatal(err.Error())\n    }\n    suite.noRows = *emptyRows\n\n}\n</code></pre>\n\n<p><strong>The full error</strong></p>\n\n<p>This monstrosity: </p>\n\n<pre><code>Running tool: C:\\Go\\bin\\go.exe test -timeout 30s ezsoft\\apiserver_sdk\\db -run ^TestRowsSuite$\n\npanic: sql: connection returned that was never out\n\ngoroutine 22 [running]:\ndatabase/sql.(*DB).putConn(0xc04204d400, 0xc04212a080, 0x0, 0x0, 0xc04213de01)\n    C:/Go/src/database/sql/sql.go:1158 +0x351\ndatabase/sql.(*driverConn).releaseConn(0xc04212a080, 0x0, 0x0)\n    C:/Go/src/database/sql/sql.go:383 +0x53\ndatabase/sql.(*driverConn).(database/sql.releaseConn)-fm(0x0, 0x0)\n    C:/Go/src/database/sql/sql.go:706 +0x45\ndatabase/sql.(*Rows).close(0xc04212a100, 0x899be0, 0xc042048380, 0x0, 0x0)\n    C:/Go/src/database/sql/sql.go:2932 +0x159\ndatabase/sql.(*Rows).awaitDone(0xc04212a100, 0x89d260, 0xc042050b00, 0x0, 0x0)\n    C:/Go/src/database/sql/sql.go:2588 +0x12f\ncreated by database/sql.(*Rows).initContextClose\n    C:/Go/src/database/sql/sql.go:2572 +0xa3\nFAIL    ezsoft/apiserver_sdk/db 0.429s\nError: Tests failed.\n</code></pre>\n\n<p><strong>Third-party libraries used</strong></p>\n\n<p>I use <a href=\"https://godoc.org/github.com/stretchr/testify\" rel=\"nofollow noreferrer\"><code>testify</code></a> and <a href=\"https://github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\"><code>go-sqlmock</code></a> (I'm probably shooting myself in the foot by using it to simply stub queries, because I'm having to jump through hoops in the setup.)</p>\n\n<p>I have no idea what's causing this fail. <em>When I delete the test, and run the suite itself, everything works</em></p>\n"}, {"tags": ["c", "go", "system-calls"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1535565165, "post_id": 52081841, "comment_id": 91117244, "body": "One thing to note here is that <i>the library functions</i> will never <i>reset/clear</i> <code>errno</code> - it is the caller&#39;s responsibility to do that."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1535646820, "post_id": 52081841, "comment_id": 91154331, "body": "@Antti: Additionally, in Go, library funtions don\u2019t touch errno at all."}], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1535568185, "post_id": 52082560, "comment_id": 91118654, "body": "Thank you so much for your decent answer, it solves all my doubts regarding write call :)"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1535635023, "post_id": 52082560, "comment_id": 91146427, "body": "Maybe a follow-up question, what if the <code>writeAll</code>&#39;s <code>write</code> call is interrupted by CPU and another syscall get scheduled (maybe called in another goroutine) and failed, is it possible to receive the <code>errno</code> triggered from the other goroutine in the next <code>write</code> call?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1535646700, "post_id": 52082560, "comment_id": 91154264, "body": "No, that is not possible."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1536571172, "post_id": 52082560, "comment_id": 91456620, "body": "Are you checking that the read is complete? Without source code there is not much for me to say."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 6, "last_activity_date": 1535562109, "last_edit_date": 1535562109, "creation_date": 1535561636, "answer_id": 52082560, "question_id": 52081841, "link": "https://stackoverflow.com/questions/52081841/differences-between-c-write-call-and-go-syscall-write/52082560#52082560", "title": "Differences between C write call and Go syscall.Write", "body": "<p>With <code>write</code>, there are only two cases to consider:</p>\n\n<ol>\n<li>If it fails, the result is -1 and <code>errno</code> is set.</li>\n<li>If it succeeds, the result is 0 or larger and <code>errno</code> is not set.</li>\n</ol>\n\n<p>There are no other cases to consider, unless you are interested in historical Unix implementations (see: <a href=\"https://stackoverflow.com/questions/2176443/is-a-return-value-of-0-from-write2-in-c-an-error\">Is a return value of 0 from write(2) in C an error?</a>).</p>\n\n<p>The reason that <code>write</code> may return 0 is because the input buffer may be empty.</p>\n\n<blockquote>\n  <p>However, the man page of C <code>write</code> call roughly describes <code>errno</code> <strong>may</strong> also be set but unspecified if we write zero length buffer without explaining any detail.</p>\n</blockquote>\n\n<p>All this means is that it's possible for a 0-length write to fail. If it fails, it returns -1 and sets <code>errno</code>. If it succeeds, it returns 0 and does not set <code>errno</code>. This is the same behavior for any other write, it's just mentioned in the man page because people may find it surprising that a 0-length write could fail.</p>\n\n<blockquote>\n  <p>What is the status of <code>errno</code> if <code>write</code> call returning 0 for a file, a non-blocking socket, or a blocking socket?</p>\n</blockquote>\n\n<p>In this case, <code>errno</code> is not set, because <code>write</code> did not fail. This will only happen if the input buffer is zero bytes.</p>\n\n<blockquote>\n  <p>When and how <code>write</code> call returning 0 and <code>errno</code> is not 0?</p>\n</blockquote>\n\n<p>This does not happen. Either <code>errno</code> is set and the return is -1, or <code>errno</code> is not set and the return is 0 or larger.</p>\n\n<blockquote>\n  <p>What is the status of <code>errno</code> if <code>write</code> call returning positive? Will it be negative?</p>\n</blockquote>\n\n<p>The <code>errno</code> value will not be set. It will have the same value as it did before the <code>write</code> call.</p>\n\n<blockquote>\n  <p>Is there any other syscall may encounter the same situation?</p>\n</blockquote>\n\n<p>In general, system calls will either return an error <em>or</em> they will succeed. They won't do some mixture of both. Look at the Return Value section of other man pages and you will see that they are mostly the same as <code>write</code>.</p>\n\n<h2>Code</h2>\n\n<p>This code is safe.</p>\n\n<pre><code>func writeAll(fd int, buffer []byte) bool {\n    length := len(buffer)\n    for length &gt; 0 {\n        written, err := syscall.Write(fd, buffer)\n        if err != nil { // here\n            return false\n        }\n        length -= written\n        buffer = buffer[written:]\n    }\n    return true\n}\n</code></pre>\n\n<p>Note that it's a bit redundant, we can just do this:</p>\n\n<pre><code>func writeAll(fd int, buf []byte) bool {\n    for len(buf) &gt; 0 {\n        n, err := syscall.Write(fd, buf)\n        if err != nil {\n            return false\n        }\n        buf = buf[n:]\n    }\n    return true\n}\n</code></pre>\n\n<h2>A note about C</h2>\n\n<p>Technically, <code>write</code> is both a system call and a C function (at least on many systems). However, the C function is just a stub which invokes the system call. Go does not call this stub, it invokes the system call directly, which means that C is not involved here (well, not until you get into the kernel).</p>\n\n<p>The man page shows the calling conventions and behavior of the C stub, <code>write</code>. Go chooses to copy that behavior in its own stub, <code>syscall.Write</code>. The actual system call itself only has an assembly language interface.</p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 1, "accepted_answer_id": 52082560, "answer_count": 1, "score": 1, "last_activity_date": 1535562109, "creation_date": 1535558781, "question_id": 52081841, "link": "https://stackoverflow.com/questions/52081841/differences-between-c-write-call-and-go-syscall-write", "title": "Differences between C write call and Go syscall.Write", "body": "<p>syscall <code>write</code> returns -1 and set <code>errno</code> is a trivial case. I am interested in the status of <code>errno</code> if C <code>write</code> call returning zero or positive. The wrapper <code>syscall.Write</code> in Go simply returns <code>err</code> if <code>errno</code> is not zero for any case, which also includes the case of <code>write</code> call returns positive.</p>\n\n<p><a href=\"https://github.com/golang/go/blob/3cb64ea39e0d71fe2af554cbf4e99d14bc08d41b/src/syscall/zsyscall_linux_386.go#L1007\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/3cb64ea39e0d71fe2af554cbf4e99d14bc08d41b/src/syscall/zsyscall_linux_386.go#L1007</a></p>\n\n<p>However, the <a href=\"http://man7.org/linux/man-pages/man2/write.2.html\" rel=\"nofollow noreferrer\">man page of C <code>write</code> call</a> roughly describes <code>errno</code> <strong>may</strong> also be set but unspecified if we write zero length buffer without explaining any detail.</p>\n\n<p>Thus, the following cases seem unclear:</p>\n\n<ol>\n<li>What is the status of <code>errno</code> if <code>write</code> call returning 0 for a file, a non-blocking socket, or a blocking socket?</li>\n<li>When and how <code>write</code> call returning 0 and <code>errno</code> is not 0?</li>\n<li>What is the status of <code>errno</code> if <code>write</code> call returning positive? Will it be negative?</li>\n<li>Is there any other syscall may encounter the same situation?</li>\n</ol>\n\n<p>I think the above description points to the difference between C <code>write</code> call and Go <code>syscall.Write</code>, which is unclear for developers, here are my thoughts:</p>\n\n<p>According to the man page, returning zero is clearly defined in C <code>write</code> call for to files and for non-blocking sockets, but it's unclear whether there are non-error conditions for a blocking socket which would result in a <code>write()</code> not blocking, returning 0, and (presumably) possibly succeeding later if retried.</p>\n\n<p>Indeed Go directly wraps system call <code>write</code>. However, the following code snippet seems not safe because <code>written</code> equals to zero is a case that may trigger <code>err</code> but we don't want to break the loop:</p>\n\n<pre><code>func writeAll(fd int, buffer []byte) bool {\n    length := len(buffer)\n    for length &gt; 0 {\n        written, err := syscall.Write(fd, buffer)\n        if err != nil { // here\n            return false\n        }\n        length -= written\n        buffer = buffer[written:]\n    }\n    return true\n}\n</code></pre>\n\n<p>Is there any wrong in my suspicion?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-compute-engine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1535554706, "post_id": 52080213, "comment_id": 91111120, "body": "Deploy the assets to the machine that needs them."}, {"owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535560286, "post_id": 52080213, "comment_id": 91114731, "body": "Hi @ThunderCat :) There is no other way to do it with the back and the front of my app stored on two separate machines ??"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535560287, "post_id": 52080213, "comment_id": 91114732, "body": "How did the Go templates get into some other VM? They should all be on the same VM as your Go program."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535562558, "post_id": 52080213, "comment_id": 91115864, "body": "Is there a reason why you don&#39;t want to store the application&#39;s assets on the machine that runs the application?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535567956, "post_id": 52080213, "comment_id": 91118539, "body": "There are literally an infinite number of ways to serve a file from one computer to another. In fact, that&#39;s essentially the only thing... the <i>only thing</i> the Internet does. So asking how it can be done is a bit like asking &quot;Explain how everything on the Internet works.&quot;"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1535610200, "post_id": 52080213, "comment_id": 91130611, "body": "You could also use a forward proxy, that serves (depending on the url) the assets from the react instance and the websocket from the go app. There are many possibilities. You should consider your options, try one out, and come back if you still have problems with a specific solution."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1535624256, "post_id": 52080213, "comment_id": 91139148, "body": "Your architecture of 3 separate servers with different roles seems like a bad idea.  But as everyone else has pointed out this question has too many answers"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1535645473, "post_id": 52080213, "comment_id": 91153548, "body": "I don&#39;t uderstand. Why you have 2 different instance for React and Go? It seems you want to serve the React application with your Go application. If so, they should be on the same instance."}], "owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1535553637, "creation_date": 1535553637, "question_id": 52080213, "link": "https://stackoverflow.com/questions/52080213/how-can-i-open-serve-a-file-locate-on-another-computer-in-go", "title": "How can i open/serve a file locate on another computer in Go?", "body": "<p>I work on an web application written in Go and React. I am deploying that app on Google Cloud Platform, for which I chose the Compute Engine service.</p>\n\n<p>I created 3 instances: an instance for running the Go part of the application, an other for the database server and the last for the React part. The OS of the three instances is Ubuntu 18.04.</p>\n\n<p>I want my Go program to retrieve data from my database (that part works well) and serve them to the client (React) using websocket.</p>\n\n<p>When I test my app locally, everything runs as expected but it's because html/css/js files are on the same computer that my Go files. But on GCE they are on two differents VMs. Actually this is how I serve a html file with Go:</p>\n\n<pre><code>indexFile, err := os.Open(\"views/index.html\")\nif err != nil {\n    fmt.Println(err)\n}\nindex, err := ioutil.ReadAll(indexFile)\nif err != nil {\n    fmt.Println(err)\n}\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, string(index))\n})\nhttp.ListenAndServe(\":8080\", nil)\n</code></pre>\n\n<p>Does someone knows how I can make my app work with Go code on a VM and html/css/js on an other ?</p>\n\n<p>Thanks :)</p>\n"}, {"tags": ["go", "module", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 0, "creation_date": 1555532702, "post_id": 52302389, "comment_id": 98149170, "body": "This is one possible solution, but it is a more complex solution than the more common approach of one module per repository, which avoids this error and problem."}, {"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 0, "creation_date": 1564686592, "post_id": 52302389, "comment_id": 101123015, "body": "Note that there are definitely some <a href=\"https://github.com/ugorji/go/issues/299\" rel=\"nofollow noreferrer\">footguns</a> with a multi-module repo approach, so anyone considering a <code>replace</code> + multi-module repo approach as outlined in this answer should carefully evaluate other options before going down that path. Some more details in this <a href=\"https://stackoverflow.com/a/55735453/11210494\">answer</a>."}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1614214614, "post_id": 52302389, "comment_id": 117320671, "body": "it doesn&#39;t seem to work properly"}], "tags": [], "owner": {"reputation": 1075, "user_id": 34615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0033495ca50ec1a53d088ba8ba40ffc9?s=128&d=identicon&r=PG", "display_name": "Jostein Stuhaug", "link": "https://stackoverflow.com/users/34615/jostein-stuhaug"}, "is_accepted": true, "score": 45, "last_activity_date": 1536781612, "creation_date": 1536781612, "answer_id": 52302389, "question_id": 52079662, "link": "https://stackoverflow.com/questions/52079662/go-get-cannot-find-local-packages-when-using-multiple-modules-in-a-repo/52302389#52302389", "title": "Go get cannot find local packages when using multiple modules in a repo", "body": "<p>You can have local \"sub\" modules like you ask for by adding a require statement and a matching replace statement with a relative file path in go.mod.</p>\n\n<p><em>In the \"root\" ./go.mod:</em></p>\n\n<pre><code>module example.com/localModule\n\nrequire example.com/localModule/model v0.0.0\n\nreplace example.com/localModule/model v0.0.0 =&gt; ./model\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 6, "last_activity_date": 1564687118, "last_edit_date": 1564687118, "creation_date": 1555532634, "answer_id": 55735453, "question_id": 52079662, "link": "https://stackoverflow.com/questions/52079662/go-get-cannot-find-local-packages-when-using-multiple-modules-in-a-repo/55735453#55735453", "title": "Go get cannot find local packages when using multiple modules in a repo", "body": "<h3>Root problem</h3>\n\n<p>The reason you are getting this error is because you have defined two modules that do not know how to find each other on your local disk.</p>\n\n<pre><code>$ go build\nmain.go:4:8: unknown import path \"example.com/localModule/model\": \n cannot find module providing package example.com/localModule/model\n</code></pre>\n\n<h3>Solution 1: <code>replace</code></h3>\n\n<p>You can add a <code>replace</code> directive to the top module's <code>go.mod</code> file, such as:</p>\n\n<p><code>replace example.com/localModule/model v0.0.0 =&gt; ./model</code></p>\n\n<p>which lets the top module find the other module on disk. This is covered in more detail in the <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">replace FAQ</a> and <a href=\"https://github.com/golang/go/wiki/Modules#faqs--multi-module-repositories\" rel=\"nofollow noreferrer\">\"Multi-module repositories\"</a> section on the Modules wiki. </p>\n\n<p>However, this is a more complex solution, can be hard to get right, is usually more on-going work, and has some limitations like <code>replace</code> is ignored for all modules except the current module. For most people, a multi-module repo is probably is not what they want. It is relatively rare at this point to really need to have multiple modules in a single repository.</p>\n\n<h3>Solution 2: one repo == one module</h3>\n\n<p>While it is possible to use a <code>replace</code> directive, the more common and straightforward solution is:</p>\n\n<ul>\n<li>Have a single <code>go.mod</code> file in your repository, and </li>\n<li>Place that single <code>go.mod</code> file in the root of your repository.  </li>\n</ul>\n\n<p>This is a very simple solution, and it means your two packages within the repository will be able to find each other automatically without needing any <code>replace</code>, and which avoids the error message you reported.</p>\n\n<h3><code>replace</code> with multi-module repo, vs. single module repo?</h3>\n\n<p>Russ Cox commented in <a href=\"https://github.com/golang/go/issues/26664#issuecomment-455232444\" rel=\"nofollow noreferrer\">#26664</a>:</p>\n\n<blockquote>\n  <p>For all but power users, you probably want to adopt the usual convention that one repo = one module. It's important for long-term evolution of code storage options that a repo <em>can</em> contain multiple modules, but it's almost certainly not something you want to do by default.</p>\n</blockquote>\n\n<p>If you instead want to have multiple modules defined within a single repository, there is a fair amount of nuance about how to do so properly, and there is an <a href=\"https://github.com/golang/go/wiki/Modules#faqs--multi-module-repositories\" rel=\"nofollow noreferrer\">entire section</a> of the Modules wiki that should be read about how to manage the complexity associated with multiple modules in a single repository, including this advice:</p>\n\n<blockquote>\n  <p>Adding modules, removing modules, and versioning modules with multiple modules in a single repository <em>requires considerable care and deliberation, so it is almost always easier and simpler to manage a single-module repository</em> rather than multiple modules in an existing repository.</p>\n</blockquote>\n"}], "owner": {"reputation": 623, "user_id": 1513178, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tV1vY.jpg?s=128&g=1", "display_name": "Tobs.Core", "link": "https://stackoverflow.com/users/1513178/tobs-core"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31140, "favorite_count": 13, "accepted_answer_id": 52302389, "answer_count": 2, "score": 38, "last_activity_date": 1564729825, "creation_date": 1535552207, "last_edit_date": 1564729825, "question_id": 52079662, "link": "https://stackoverflow.com/questions/52079662/go-get-cannot-find-local-packages-when-using-multiple-modules-in-a-repo", "title": "Go get cannot find local packages when using multiple modules in a repo", "body": "<p>I'm having issues with go's new module system, as I'd like to define a local module and import it in the main program. The local package resides in a folder of the main package/root folder. Imagine the following project structure outside the <code>$GOPATH</code>.</p>\n\n<h2>Project structure</h2>\n\n<p>./main.go\n</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"example.com/localModule/model\"\n\nfunc main() {\n    var p = model.Person{name: \"Dieter\", age:25}\n    fmt.Printf(\"Hello %s\\n\", p.name)\n}\n</code></pre>\n\n<p>./model/person.go\n</p>\n\n<pre><code>package model\n\ntype Person struct {\n    name string\n    age int\n}\n</code></pre>\n\n<p>In the root folder I initialized a module by calling</p>\n\n<pre><code>go mod init example.com/localModule\n</code></pre>\n\n<p>In the <code>model/</code> folder I then initialized the submodule by calling</p>\n\n<pre><code>go mod init example.com/localModule/model\n</code></pre>\n\n<h2>The error</h2>\n\n<p>In the root folder calling the following commands fail. </p>\n\n<pre><code>$ go get\ngo build example.com/localModule/model: no Go files in\n\n$ go build\nmain.go:4:8: unknown import path \"example.com/localModule/model\": cannot find module providing package example.com/localModule/model\n</code></pre>\n\n<p>The error message for go get is cut off, I din't parse it wrongly.</p>\n\n<p>I do not plan on pushing the module to a server and and just needed a way of referencing the local package <code>model</code>, so I chose <code>example.com/localModule/</code> and <code>example.com/localModule/model</code> respectively.</p>\n\n<p>I'm using <code>go1.11 darwin/amd64</code> on a Macbook running MacOS 10.13.6.</p>\n"}, {"tags": ["go", "sqlite", "go-sqlite3"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535547981, "post_id": 52077914, "comment_id": 91106288, "body": "I know SQLite itself supports this. I don&#39;t see that functionality exposed in the Go driver. But if you know CGO, I&#39;m sure you could hack the Go driver to expose it."}], "answers": [{"comments": [{"owner": {"reputation": 1322, "user_id": 7533177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YtNtF.jpg?s=128&g=1", "display_name": "Simon Frey", "link": "https://stackoverflow.com/users/7533177/simon-frey"}, "edited": false, "score": 0, "creation_date": 1535550063, "post_id": 52078608, "comment_id": 91107736, "body": "Thanks for your answer. Do you maybe have a clue how to do that? (Or another go vfs package to orient on - maybe even fork it)"}, {"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "reply_to_user": {"reputation": 1322, "user_id": 7533177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YtNtF.jpg?s=128&g=1", "display_name": "Simon Frey", "link": "https://stackoverflow.com/users/7533177/simon-frey"}, "edited": false, "score": 0, "creation_date": 1535550152, "post_id": 52078608, "comment_id": 91107796, "body": "Sorry, I know C and a little Go, but my knowledge of CGo is lacking in a lot of ways."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1535645978, "post_id": 52078608, "comment_id": 91153829, "body": "sqlite3 is a C library. Every Go implementation that provides full read-write functionality are only calling the C library with C binding. There is no way that C library can directly use a filesystem emulated written in Go and for Go."}, {"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 0, "creation_date": 1535651569, "post_id": 52078608, "comment_id": 91156507, "body": "That&#39;s why I suggested using a VFS, take a look at this neat VFS that allows you to append a SQLite database to <a href=\"https://www.sqlite.org/src/file/ext/misc/appendvfs.c\" rel=\"nofollow noreferrer\">an existing file</a>. You could do the same with, let&#39;s say a memory buffer or something"}], "tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": false, "score": 2, "last_activity_date": 1535549175, "creation_date": 1535549175, "answer_id": 52078608, "question_id": 52077914, "link": "https://stackoverflow.com/questions/52077914/load-sqlite3-database-from-virtual-filesystem-afero/52078608#52078608", "title": "Load SQLite3 database from virtual filesystem (afero)", "body": "<p>After a little source diving I see this in <a href=\"https://github.com/mattn/go-sqlite3/blob/master/sqlite3.go\" rel=\"nofollow noreferrer\">sqlite3.go</a></p>\n\n<pre><code>name := C.CString(dsn)\ndefer C.free(unsafe.Pointer(name))\nrv := C._sqlite3_open_v2(name, &amp;db,\n    mutex|C.SQLITE_OPEN_READWRITE|C.SQLITE_OPEN_CREATE,\n     nil)\n</code></pre>\n\n<p>So this answers your question, the actual opening of the database happens \"outside\" Go and \"inside\" the <code>sqlite3</code> library. If we check the function <code>sqlite3_open_v2</code> we can see that it requires a file name:</p>\n\n<pre><code>int sqlite3_open_v2(\n  const char *filename,   /* Database filename (UTF-8) */\n  sqlite3 **ppDb,         /* OUT: SQLite db handle */\n  int flags,              /* Flags */\n  const char *zVfs        /* Name of VFS module to use */\n);\n</code></pre>\n\n<p>I think the only way here is to implement your own <a href=\"https://www.sqlite.org/vfs.html\" rel=\"nofollow noreferrer\">Sqlite VFS</a> that somehow interacts with the <code>afero</code> abstractions.</p>\n"}], "owner": {"reputation": 1322, "user_id": 7533177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YtNtF.jpg?s=128&g=1", "display_name": "Simon Frey", "link": "https://stackoverflow.com/users/7533177/simon-frey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1535549175, "creation_date": 1535546958, "last_edit_date": 1535547834, "question_id": 52077914, "link": "https://stackoverflow.com/questions/52077914/load-sqlite3-database-from-virtual-filesystem-afero", "title": "Load SQLite3 database from virtual filesystem (afero)", "body": "<p><strong>Setting:</strong></p>\n\n<p>1) SQLite3 database file gets uploaded to a fileserver</p>\n\n<p>2) Files get stored into virtual filesystem</p>\n\n<p>3) I want to execute sql queries on that database</p>\n\n<p>Currently I am using <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">go-sqlite3</a> with a database file located in <a href=\"https://github.com/spf13/afero\" rel=\"nofollow noreferrer\">afero</a>.</p>\n\n<hr>\n\n<p><strong>Question:</strong></p>\n\n<p><strong>Is there are possbility to load a database file into go-sqlite3 with another source than a file from the os filesystem.</strong></p>\n\n<hr>\n\n<p><strong>Current approach:</strong></p>\n\n<p>My current solution is to copy the file from afero into the os.TempDir() directory, but that fails with our ci and is no actual solution as it does not use the dedicated filesystem anymore.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9146, "user_id": 292230, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5NyjH.png?s=128&g=1", "display_name": "Prutswonder", "link": "https://stackoverflow.com/users/292230/prutswonder"}, "edited": false, "score": 6, "creation_date": 1552401722, "post_id": 52076747, "comment_id": 96989866, "body": "FYI: this question has been marked as duplicate, but it&#39;s in fact a different question. The answer to both questions is the same though, but that&#39;s not a reason to mark the question as a duplicate. ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1535549512, "post_id": 52076748, "comment_id": 91107363, "body": "The above is my question and I couldn&#39;t find the answer in StackOverflow. I found it buried in some forum posts and I thought it might be nice to share.  The &quot;Answer your own question&quot; checkbox does state &quot;share your knowledge, Q&amp;A-style&quot;. What&#39;s disingenuous about that?"}, {"owner": {"reputation": 148592, "user_id": 24545, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/omB1R.jpg?s=128&g=1", "display_name": "Yuval Adam", "link": "https://stackoverflow.com/users/24545/yuval-adam"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1535550284, "post_id": 52076748, "comment_id": 91107888, "body": "@Adrian as someone who&#39;s been around SO for 10 years, you ought to be aware that this community is perfectly fine with answering your own questions."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1535550300, "post_id": 52076748, "comment_id": 91107899, "body": "First result searching SO for <code>reader readcloser</code>: <a href=\"https://stackoverflow.com/questions/28158990/golang-io-ioutil-nopcloser\" title=\"golang io ioutil nopcloser\">stackoverflow.com/questions/28158990/golang-io-ioutil-nopclo&zwnj;&#8203;ser</a>"}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 1, "creation_date": 1602898878, "post_id": 52076748, "comment_id": 113874081, "body": "everything was already on the internet more than once <i>before</i> SO.  so be it.  long live closing duplicates.  long live duplicates.  Thanks, @noamt"}, {"owner": {"reputation": 844, "user_id": 598878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8720539223ef5ef0b996bf253c0b4c6f?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/598878/nick"}, "edited": false, "score": 1, "creation_date": 1614877965, "post_id": 52076748, "comment_id": 117526250, "body": "Whats the way to do this without <code>iotuil</code> it is deprecated as of 1.16 golang"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 844, "user_id": 598878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8720539223ef5ef0b996bf253c0b4c6f?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/598878/nick"}, "edited": false, "score": 1, "creation_date": 1614968142, "post_id": 52076748, "comment_id": 117556484, "body": "@Nick I&#39;ve updated my answer"}], "tags": [], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "is_accepted": true, "score": 51, "last_activity_date": 1614968112, "last_edit_date": 1614968112, "creation_date": 1535543373, "answer_id": 52076748, "question_id": 52076747, "link": "https://stackoverflow.com/questions/52076747/how-do-i-turn-an-io-reader-into-a-io-readcloser/52076748#52076748", "title": "How do I turn an io.Reader into a io.ReadCloser?", "body": "<p>If you're certain that your <code>io.Reader</code> doesn't require any actual closing, you can wrap it with an <a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"nofollow noreferrer\"><code>ioutil.NopCloser</code></a>.</p>\n<h3>Go 1.16 Update</h3>\n<p>As of version 1.16 <code>ioutil.NopCloser</code> is <a href=\"https://golang.org/doc/go1.16#ioutil\" rel=\"nofollow noreferrer\">deprecated</a>.</p>\n<p><code>NopCloser</code> has been moved to <a href=\"https://golang.org/pkg/io/#NopCloser\" rel=\"nofollow noreferrer\"><code>io</code></a>:</p>\n<pre><code>stringReader := strings.NewReader(&quot;shiny!&quot;)\nstringReadCloser := io.NopCloser(stringReader)\n</code></pre>\n<h3>Go 1.15 and older</h3>\n<p>From the godoc:</p>\n<blockquote>\n<p>NopCloser returns a ReadCloser with a no-op Close method wrapping the provided Reader r.</p>\n</blockquote>\n<p>So we can apply it like:</p>\n<pre><code>stringReader := strings.NewReader(&quot;shiny!&quot;)\nstringReadCloser := ioutil.NopCloser(stringReader)\n</code></pre>\n"}], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12285, "favorite_count": 0, "closed_date": 1535551958, "accepted_answer_id": 52076748, "answer_count": 1, "score": 30, "last_activity_date": 1614968112, "creation_date": 1535543373, "question_id": 52076747, "link": "https://stackoverflow.com/questions/52076747/how-do-i-turn-an-io-reader-into-a-io-readcloser", "closed_reason": "Duplicate", "title": "How do I turn an io.Reader into a io.ReadCloser?", "body": "<p>I have an <code>io.Reader</code> that doesn't require closing:</p>\n\n<pre><code>stringReader := strings.NewReader(\"shiny!\")\n</code></pre>\n\n<p>And I want to pass it to a method that receives an <code>io.ReadCloser</code> </p>\n\n<pre><code>func readAndClose(source io.ReadCloser) {\n    ...\n}\n</code></pre>\n\n<p>How do I turn the <code>io.Reader</code> into a <code>io.ReadCloser</code> without specially creating a struct that implements the <code>Close</code> method?</p>\n"}, {"tags": ["go", "memory", "integer", "int", "uint"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535543603, "post_id": 52076575, "comment_id": 91103241, "body": "Only arrays / slices benefit from small types. And please: Do not store age in an unsigned. Unsigneds are bitpatterns, not numbers."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535549018, "post_id": 52076575, "comment_id": 91107008, "body": "And structs. And maps. And channels. And anything being sent over the wire or written to disk in binary format. Or mapped to a database table."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536013625, "post_id": 52076575, "comment_id": 91263776, "body": "@Volker Where can I find out more about why not to use unsigned ints?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536032670, "post_id": 52076575, "comment_id": 91267067, "body": "@MichaelHampton Just try some simple math with unsigned numbers and experience lots of over/underflows around 0 for innocent looking code. Not sure what you are looking for. Uints are fine and you should use them but not to do arithmetic with what people commonly think of as &quot;natural number&quot;."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536062872, "post_id": 52076575, "comment_id": 91281483, "body": "@Volker I was looking for whatever motivated your comment: &quot;Do not store age in an unsigned. Unsigneds are bitpatterns, not numbers.&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536065808, "post_id": 52076575, "comment_id": 91283391, "body": "@MichaelHampton. Well, unsigned ints <i>are</i> bitpatterns and signed ints <i>are</i> numbers. Bit-operations work natural on unsigned and arithmetic works natural on signed ints while the converse is not true. My motivation was to sensibilize the OP to <i>not</i> store age in an unsigned because age is not a bit pattern."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1536006512, "last_edit_date": 1536006512, "creation_date": 1535544722, "answer_id": 52077161, "question_id": 52076575, "link": "https://stackoverflow.com/questions/52076575/what-is-the-implication-of-using-a-specific-numeric-type-over-another/52077161#52077161", "title": "What is the implication of using a specific numeric type over another", "body": "<h2>Fixed size integers</h2>\n\n<p>Fixed size integers require exact amount of memory. Using a smaller integer type \"here and there\" for single variables, you will only gain a tiny amount of memory, if any. Also when used as types of struct fields, you again might not gain anything due to implicit paddings.</p>\n\n<p>The memory gain may be noticeable and considerable when you use fixed size integers as the element type of (big) slices or arrays.</p>\n\n<p>Another (maybe more important) reason to use fixed size integers may be to communicate what you store in them. You could just as well use <code>int32</code> or <code>int64</code> type to store bytes, but being an obvious waste, they don't communicate the <em>valid range</em> of the data stored in them.</p>\n\n<p>Another point is efficiency. You could always use <code>int64</code> in place of other signed integer types, but on certain architectures performing operations on <code>int64</code> might require multiple register operations and thus being considerably slower. Also the <code>rune</code> type (alias for <code>int32</code>) clearly communicates that you intend to use it for unicode codepoints.</p>\n\n<p>Another point is consistency. If you use <code>int32</code> to model something in one place, you should stick to it and use the same type everywhere. This is more important in Go than in other languages, because Go's type system is strict (stricter than most other language's), meaning if you have a value of type <code>int32</code>, you can't assign it to a variable of <code>int64</code> type and vice versa without explicit conversion.</p>\n\n<h2><code>int</code> vs fixed size integers</h2>\n\n<p>The types <code>int</code> and <code>uint</code> are not fixed sizes, but according to <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">Spec: Numeric types:</a></p>\n\n<blockquote>\n<pre><code>uint     either 32 or 64 bits\nint      same size as uint\n</code></pre>\n</blockquote>\n\n<p>When you use <code>int</code>, the compiler may produce more optimized code when targeting different architectures. <em>Usually</em> <code>int</code> is 32-bit when targeting 32-bit architectures, and 64-bit when targeting 64-bit architectures. What this means is that the size of <code>int</code> will match the target architecture's register size, so integer operations can be efficiently carried out with single register operations. If you use <code>int64</code> for example, that may require to perform multiple (register) operations to carry out a single integer operation on a 32-bit architecture.</p>\n\n<p>I like to think of <code>int</code> being an integer type that is used to describe and communicate certain parts or components of Go's runtime data structures in the best way it sees fits. For example to index arrays or slices, or to describe their sizes, <code>int</code> is the \"natural\" type to use.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"nofollow noreferrer\">Spec: Length and capactiy:</a></p>\n\n<blockquote>\n  <p>The built-in functions <code>len</code> and <code>cap</code> take arguments of various types and return a result of type <code>int</code>. The implementation guarantees that the result always fits into an <code>int</code>. For example indexing slices or array, or to describe their length and capacity, <code>int</code> is the \"natural\" type recommended or enforced.</p>\n</blockquote>\n\n<p>When using the <code>for range</code> statement with at least one iteration variable on arrays, slices or <code>string</code> values, the iteration variable (the \"index\") will be of type <code>int</code>.</p>\n\n<p>Also note that a proposal has been presented by Rob Pike for Go 2 to change <code>int</code> to arbitrary precision. <a href=\"https://github.com/golang/go/issues/19623\" rel=\"nofollow noreferrer\">proposal: spec: change int to be arbitrary precision</a> </p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 2, "last_activity_date": 1535546601, "last_edit_date": 1535546601, "creation_date": 1535546256, "answer_id": 52077656, "question_id": 52076575, "link": "https://stackoverflow.com/questions/52076575/what-is-the-implication-of-using-a-specific-numeric-type-over-another/52077656#52077656", "title": "What is the implication of using a specific numeric type over another", "body": "<p>1) Fixed size integers can be used to reduce the memory used by your application. In a 3D app for example it can make more sense to use <code>float32</code> rather than <code>float64</code> because the graphics card wants <code>float32</code>s anyway and to use <code>uint16</code> rather than <code>uint32</code> for draw indices for example.</p>\n\n<p>That said, for single variables it makes no difference, only if you have a large number of values and can trade precision for memory.</p>\n\n<p>2) When writing to disk, e.g. using the <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">encoding/binary</a> package, you cannot use <code>int</code> or <code>uint</code> because their size changes between operating systems. You have to use values of known size to make the file format unambiguous.</p>\n\n<p>3) When interfacing with the operating system's API it is often required to use fixed-size variables. For example, the Windows API is a 32 bit API which means that when you load a Windows DLL you often need to use 32 bit unsigned integers for flags etc.</p>\n"}], "owner": {"reputation": 93, "user_id": 9269433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14d5a987bee009f9ddd2521fb7c98476?s=128&d=identicon&r=PG", "display_name": "user9269433", "link": "https://stackoverflow.com/users/9269433/user9269433"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1536006512, "creation_date": 1535542752, "question_id": 52076575, "link": "https://stackoverflow.com/questions/52076575/what-is-the-implication-of-using-a-specific-numeric-type-over-another", "title": "What is the implication of using a specific numeric type over another", "body": "<p>What is the memory implication of storing an integer as a particular numeric type (uint8, int16, uint32, int64, etc)? I know the range of integers each of the types can take, but is there some memory efficiency that can be achieved by using an appropriate type?</p>\n\n<p>For example, in Golang, it \"seems\" more efficient to store someone's age as an uint8 rather than unit (which is equivalent to uint32 or uint64 according to its specification <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Numeric_types</a>)  </p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions", "serverless", "faas"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1535540383, "post_id": 52075778, "comment_id": 91101170, "body": "It depends on what it does (or what it should do). This question is too broad."}, {"owner": {"reputation": 411025, "user_id": 209103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/12d378e6a9788ab9c94bbafe242b82b4?s=128&d=identicon&r=PG", "display_name": "Frank van Puffelen", "link": "https://stackoverflow.com/users/209103/frank-van-puffelen"}, "edited": false, "score": 3, "creation_date": 1535563376, "post_id": 52075778, "comment_id": 91116337, "body": "I do agree that the question is too broad. But from looking at the answer, there is some great information in there that other developers might also be looking for. @KelseyHightower: is there a way you can phrase the problem into a more concrete question? I.e. there is much more to a production-ready Cloud Function than what you shared in your answer, but it might be the perfect answer to &quot;Can I log to Stack Driver from Cloud Functions?&quot;."}, {"owner": {"reputation": 4509, "user_id": 39446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdbfb34e95280764b6a70c8b8e98081e?s=128&d=identicon&r=PG", "display_name": "Suraj", "link": "https://stackoverflow.com/users/39446/suraj"}, "edited": false, "score": 1, "creation_date": 1536884169, "post_id": 52075778, "comment_id": 91593992, "body": "This question is part of GopherCon 2018 Keynote - Going Serverless <a href=\"https://www.youtube.com/watch?v=laz6ghZv-ZU\" rel=\"nofollow noreferrer\">youtube.com/watch?v=laz6ghZv-ZU</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1194, "user_id": 867786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6d059c1c0e24de78b23bcd44398f02?s=128&d=identicon&r=PG", "display_name": "Nuno Cruces", "link": "https://stackoverflow.com/users/867786/nuno-cruces"}, "edited": false, "score": 0, "creation_date": 1557931552, "post_id": 52076413, "comment_id": 98933586, "body": "This library implements the logging bits: <a href=\"https://godoc.org/github.com/ncruces/go-gcf/logging\" rel=\"nofollow noreferrer\">godoc.org/github.com/ncruces/go-gcf/logging</a>"}], "tags": [], "owner": {"reputation": 651, "user_id": 10137272, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GA89zHCW25o/AAAAAAAAAAI/AAAAAAAAAWU/kKPnYnKK4Eo/photo.jpg?sz=128", "display_name": "Kelsey Hightower", "link": "https://stackoverflow.com/users/10137272/kelsey-hightower"}, "is_accepted": false, "score": 21, "last_activity_date": 1535542813, "last_edit_date": 1535542813, "creation_date": 1535542218, "answer_id": 52076413, "question_id": 52075778, "link": "https://stackoverflow.com/questions/52075778/what-does-a-production-ready-google-cloud-function-look-like/52076413#52076413", "title": "What does a production ready Google Cloud Function look like?", "body": "<p>Given the provider takes care of things like scaling for you the first thing I would do is focus on observability. You don't know what you don't know. I like to add my own tracing and structured logging; logging to stdout falls short in many ways.</p>\n\n<pre><code>package function\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"sync\"\n\n    \"cloud.google.com/go/logging\"\n    \"contrib.go.opencensus.io/exporter/stackdriver\"\n    \"contrib.go.opencensus.io/exporter/stackdriver/propagation\"\n    \"go.opencensus.io/trace\"\n    \"google.golang.org/genproto/googleapis/api/monitoredres\"\n)\n\nvar (\n    logger *logging.Logger\n    once   sync.Once\n)\n\n// configFunc sets the global configuration; it's overridden in tests.\nvar configFunc = defaultConfigFunc\n\nfunc F(w http.ResponseWriter, r *http.Request) {\n    once.Do(func() {\n        if err := configFunc(); err != nil {\n           panic(err)\n        }\n    })\n\n    defer logger.Flush()\n\n    ctx := r.Context()\n    var span *trace.Span\n\n    httpFormat := &amp;propagation.HTTPFormat{}\n    sc, ok := httpFormat.SpanContextFromRequest(r)\n    if ok {\n        ctx, span = trace.StartSpanWithRemoteParent(ctx, \"helloworld\", sc,\n            trace.WithSampler(trace.AlwaysSample()),\n            trace.WithSpanKind(trace.SpanKindServer),\n        )\n        defer span.End()\n    }\n\n    logger.Log(logging.Entry{\n        Payload:  \"Handling new HTTP request\",\n        Severity: logging.Info,\n    })\n\n    w.Write([]byte(\"Hello, World!\\n\"))\n}\n\nfunc defaultConfigFunc() error {\n    var err error\n\n    projectId := os.Getenv(\"GCP_PROJECT\")\n    if projectId == \"\" {\n            return fmt.Errorf(\"GCP_PROJECT environment variable unset or missing\")\n    }\n\n    functionName := os.Getenv(\"FUNCTION_NAME\")\n    if functionName == \"\" {\n            return fmt.Errorf(\"FUNCTION_NAME environment variable unset or missing\")\n    }\n\n    region := os.Getenv(\"FUNCTION_REGION\")\n    if region == \"\" {\n        return fmt.Errorf(\"FUNCTION_REGION environment variable unset or missing\")\n    }\n\n    stackdriverExporter, err := stackdriver.NewExporter(stackdriver.Options{ProjectID: projectId})\n    if err != nil {\n        return err\n    }\n\n    trace.RegisterExporter(stackdriverExporter)\n    trace.ApplyConfig(trace.Config{DefaultSampler: trace.AlwaysSample()})\n\n    client, err := logging.NewClient(context.Background(), projectId)\n    if err != nil {\n        return err\n    }\n\n    monitoredResource := monitoredres.MonitoredResource{\n        Type: \"cloud_function\",\n        Labels: map[string]string{\n            \"function_name\": functionName,\n            \"region\":        region,\n        },\n    }\n\n    commonResource := logging.CommonResource(&amp;monitoredResource)\n    logger = client.Logger(functionName, commonResource)\n\n    return nil\n}\n</code></pre>\n\n<p>Also, make sure you vendor all your dependencies, you really want your build to be reproducible. I'm using Go 1.11 these days, and the following works for me:</p>\n\n<pre><code>$ mkdir helloworld\n$ cd helloworld\n$ vim function.go\n$ echo \"module github.com/kelseyhightower/helloworld\" &gt; go.mod\n$ go mod vendor  \n</code></pre>\n"}], "owner": {"reputation": 651, "user_id": 10137272, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GA89zHCW25o/AAAAAAAAAAI/AAAAAAAAAWU/kKPnYnKK4Eo/photo.jpg?sz=128", "display_name": "Kelsey Hightower", "link": "https://stackoverflow.com/users/10137272/kelsey-hightower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1129, "favorite_count": 9, "closed_date": 1535559778, "answer_count": 1, "score": 11, "last_activity_date": 1574105062, "creation_date": 1535540267, "last_edit_date": 1574105062, "question_id": 52075778, "link": "https://stackoverflow.com/questions/52075778/what-does-a-production-ready-google-cloud-function-look-like", "closed_reason": "Needs details or clarity", "title": "What does a production ready Google Cloud Function look like?", "body": "<p>I'm just getting started with this whole Serverless thing using Google Cloud Functions and all the examples are basically \"Helloworld\".</p>\n\n<pre><code>package function\n\nimport (\n    \"net/http\"\n)\n\nfunc F(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello, World!\\n\"))\n}\n</code></pre>\n\n<p>What does a production ready function look like?</p>\n"}, {"tags": ["mysql", "docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540369, "post_id": 52075739, "comment_id": 91101157, "body": "Try adding <code>dbConfig.Net = &quot;tcp&quot;</code> ?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540409, "post_id": 52075739, "comment_id": 91101184, "body": "Also the port should be added to the address, so it should be <code>mysql:3306</code> instead of just <code>mysql</code>"}, {"owner": {"reputation": 2370, "user_id": 5453049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e2c00b88d6175b93b0360c8057a15a?s=128&d=identicon&r=PG&f=1", "display_name": "Fabio Venturi Pastor", "link": "https://stackoverflow.com/users/5453049/fabio-venturi-pastor"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540566, "post_id": 52075739, "comment_id": 91101290, "body": "First of all thank you for response, I tried dbConfig.net = &quot;tcp&quot; and now i got this error: dial tcp: lookup mysql: no such host, adding port to mysql does not work :S"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540654, "post_id": 52075739, "comment_id": 91101349, "body": "Ah, just realized that your go app isn&#39;t in your compose file. This means it won&#39;t be able to resolve <code>mysql</code>. If you don&#39;t want your go app to be in the compose file, you&#39;ll have to expose the ports of the mysql container (by adding <code>ports: 3306:3306</code>) and use <code>localhost:3306</code> as the address in your go app."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540825, "post_id": 52075739, "comment_id": 91101469, "body": "What do you mean? Did you try what I suggested?"}, {"owner": {"reputation": 2370, "user_id": 5453049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e2c00b88d6175b93b0360c8057a15a?s=128&d=identicon&r=PG&f=1", "display_name": "Fabio Venturi Pastor", "link": "https://stackoverflow.com/users/5453049/fabio-venturi-pastor"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540903, "post_id": 52075739, "comment_id": 91101524, "body": "I mean I deleted the ports by mistake when I paste the code in SO"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535540922, "post_id": 52075739, "comment_id": 91101538, "body": "I&#39;ll post a detailed answer, it should help better."}], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 3, "last_activity_date": 1535540985, "creation_date": 1535540985, "answer_id": 52076021, "question_id": 52075739, "link": "https://stackoverflow.com/questions/52075739/can-not-connect-to-mysql-docker-image-connection-refused/52076021#52076021", "title": "Can not connect to mysql docker image connection refused", "body": "<p>The problem is that your go code can't resolve the <code>mysql</code> address, as it's not being deployed in the compose file.</p>\n\n<p>To fix that, you have two solutions:</p>\n\n<ol>\n<li>Add your app to your docker-compose file by Dockerizing your code if it isn't already done, then it should be able to connect to your mysql container.</li>\n<li>Expose your mysql container's ports and change the address used in your go code from <code>mysql</code> to <code>localhost:3306</code> (I see that you edited your compose and the ports are exposed, so you just need to change the address in your code)</li>\n</ol>\n\n<p>For the first solution, you can build a simple Go app into a Docker image like this:</p>\n\n<pre><code># Build stage\nFROM golang:alpine AS build-env\n\nCOPY . /go/src/your/project/path\nWORKDIR /go/src/your/project/path\n\nRUN apk update &amp;&amp; \\\n    apk upgrade &amp;&amp; \\\n    &lt;install your deps here if needed&gt;\n\n# Install dep if needed\nENV DEP_VERSION=\"0.4.1\"\nRUN curl -L -s https://github.com/golang/dep/releases/download/v${DEP_VERSION}/dep-linux-amd64 -o $GOPATH/bin/dep\nRUN chmod +x $GOPATH/bin/dep\nRUN dep ensure\n\n# Build your app\nRUN go build -o myapp\n\n# Final stage\nFROM alpine\n\nWORKDIR /app/myapp\nCOPY --from=build-env /go/src/your/project/path /app/myapp\nENTRYPOINT [\"/app/myapp/myapp\"]\n</code></pre>\n\n<p>Then add it to your compose file:</p>\n\n<pre><code>version: \"3\"\nservices:\n  mysql:\n    image: mysql:5.6\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - mysql-data:/var/lib/mysql\n      - ./docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d\n    environment:\n      MYSQL_ROOT_PASSWORD: a\n      LANG: C.UTF-8\n  adminer:\n    image: adminer\n    ports:\n      - 8082:8080\n  myapp:\n    build: .\n    depends_on:\n      - mysql\n  nginx:\n    build: ../docker-shared/nginx\n    ports:\n      - 443:443\n    volumes:\n      - \"./nginx_proxy_settings.conf:/etc/nginx/conf.d/nginx_proxy_settings.conf\"\nvolumes:\n  mysql-data:\n</code></pre>\n\n<p>And add the port and the transport to your app's code:</p>\n\n<pre><code>func main() {\n\n    dbConfig := mysql.NewConfig()\n    dbConfig.User = \"root\"\n    dbConfig.Passwd = \"a\"\n    dbConfig.Addr = \"mysql:3306\"\n    dbConfig.DBName = \"websays_prod\"\n    dbConfig.Net = \"tcp\"\n\n    db, err := sql.Open(\"mysql\", dbConfig.FormatDSN())\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<p>Second solution if you don't want to dockerize your app is to just change your code to:</p>\n\n<pre><code>func main() {\n\n    dbConfig := mysql.NewConfig()\n    dbConfig.User = \"root\"\n    dbConfig.Passwd = \"a\"\n    dbConfig.Addr = \"localhost:3306\"\n    dbConfig.DBName = \"websays_prod\"\n    dbConfig.Net = \"tcp\"\n\n    db, err := sql.Open(\"mysql\", dbConfig.FormatDSN())\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n}\n</code></pre>\n"}], "owner": {"reputation": 2370, "user_id": 5453049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e2c00b88d6175b93b0360c8057a15a?s=128&d=identicon&r=PG&f=1", "display_name": "Fabio Venturi Pastor", "link": "https://stackoverflow.com/users/5453049/fabio-venturi-pastor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7021, "favorite_count": 0, "accepted_answer_id": 52076021, "answer_count": 1, "score": 1, "last_activity_date": 1535758315, "creation_date": 1535540167, "last_edit_date": 1535758315, "question_id": 52075739, "link": "https://stackoverflow.com/questions/52075739/can-not-connect-to-mysql-docker-image-connection-refused", "title": "Can not connect to mysql docker image connection refused", "body": "<p>I just replaced my old company computer for a new one(MACOS), download the projects and now Im trying to connect to mysql docker image but I always get </p>\n\n<blockquote>\n  <p>dial tcp 127.0.0.1:3306: connect: connection refused</p>\n</blockquote>\n\n<p>In my old computer everything worked correctly but now I've this problem.</p>\n\n<p>My docker compose(Not showing all the content):</p>\n\n<pre><code>version: \"3\"\nservices:\n  mysql:\n    image: mysql:5.6\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - mysql-data:/var/lib/mysql\n      - ./docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d\n    environment:\n      MYSQL_ROOT_PASSWORD: a\n      LANG: C.UTF-8\n  adminer:\n    image: adminer\n    ports:\n      - 8082:8080\n  nginx:\n    build: ../docker-shared/nginx\n    ports:\n      - 443:443\n    volumes:\n      - \"./nginx_proxy_settings.conf:/etc/nginx/conf.d/nginx_proxy_settings.conf\"\nvolumes:\n  mysql-data:\n</code></pre>\n\n<p>So if I do a <code>docker-compose up</code> everything works, you can check in the next image the Adminer is working with data:\n<a href=\"https://i.stack.imgur.com/gph2d.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gph2d.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/yMGRe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yMGRe.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/nKFrY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nKFrY.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is my Golang code to connect to mysql:</p>\n\n<pre><code>func main() {\n\n    dbConfig := mysql.NewConfig()\n    dbConfig.User = \"root\"\n    dbConfig.Passwd = \"a\"\n    dbConfig.Addr = \"mysql\"\n    dbConfig.DBName = \"company_prod\"\n\n    db, err := sql.Open(\"mysql\", dbConfig.FormatDSN())\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<p>Do you know what Im doing wrong??</p>\n\n<p>Thank you</p>\n"}, {"tags": ["html", "loops", "templates", "go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1535538383, "last_edit_date": 1592644375, "creation_date": 1535538383, "answer_id": 52075186, "question_id": 52075151, "link": "https://stackoverflow.com/questions/52075151/get-index-number-from-range/52075186#52075186", "title": "Get index number from range", "body": "<p><a href=\"https://golang.org/pkg/text/template/#hdr-Variables\" rel=\"nofollow noreferrer\"><code>text/template</code> Variables:</a></p>\n<blockquote>\n<p>If a &quot;range&quot; action initializes a variable, the variable is set to the successive elements of the iteration. Also, a &quot;range&quot; may declare two variables, separated by a comma:</p>\n<pre><code>range $index, $element := pipeline\n</code></pre>\n</blockquote>\n<p>So in your example:</p>\n<pre><code>{{ range $i, $e := .post }}\n   Index: {{ $i }}\n   {{ .Id }}\n   {{ .Name}}\n{{ end}}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 8770092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56619c2e5e56d98ec34c633316e1e031?s=128&d=identicon&r=PG", "display_name": "Edwin Widhiyanto", "link": "https://stackoverflow.com/users/8770092/edwin-widhiyanto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 0, "accepted_answer_id": 52075186, "answer_count": 1, "score": 5, "last_activity_date": 1535544512, "creation_date": 1535538254, "last_edit_date": 1535544512, "question_id": 52075151, "link": "https://stackoverflow.com/questions/52075151/get-index-number-from-range", "title": "Get index number from range", "body": "<p>In to get the index number php:</p>\n\n<pre><code>foreach much as index =&gt; each{\n //get index number from index\n}\n</code></pre>\n\n<p>How can I get the index number in go?</p>\n\n<pre><code>{{ range .post }}\n   {{ // how can i get index number? }}\n   {{ .Id }}\n   {{ .Name}}\n{{ end}}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1535536651, "post_id": 52074553, "comment_id": 91098830, "body": "Which queue are you referencing?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1535536734, "creation_date": 1535536734, "answer_id": 52074650, "question_id": 52074553, "link": "https://stackoverflow.com/questions/52074553/why-this-code-about-golang-goruntine-running-order-is-2-first/52074650#52074650", "title": "why this code about golang goruntine running order is &quot;2&quot; first", "body": "<p>You're not synchronizing your 2 launched goroutines <em>to each other</em>, so there is no guarantee in what order they run. The only thing you synchronize is the main goroutine to wait for the other 2 to complete, but their order will be undefined.</p>\n\n<p>Here's an example that also synchronizes order using another <code>sync.WaitGroup</code>:</p>\n\n<pre><code>w := &amp;sync.WaitGroup{}\nw.Add(2)\n\nw2 := &amp;sync.WaitGroup{}\nw2.Add(1)\ngo func() {\n    fmt.Println(\"1\")\n    w.Done()\n    w2.Done()\n}()\ngo func() {\n    w2.Wait()\n    fmt.Println(\"2\")\n    w.Done()\n}()\nw.Wait()\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/gM_WW602nrQ\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1\n2\n</code></pre>\n\n<p>Basically the 2nd goroutine waits for <code>w2</code>, which is called in the 1st goroutine once it's done.</p>\n\n<p>Note that since the 2nd goroutine waits for the first, it is enough for the main goroutine to only wait for the 2nd goroutine (which transitively means to wait for both). So the above example can be written like this:</p>\n\n<pre><code>w2 := &amp;sync.WaitGroup{}\nw2.Add(1)\ngo func() {\n    fmt.Println(\"1\")\n    w2.Done()\n}()\n\nw := &amp;sync.WaitGroup{}\nw.Add(1)\ngo func() {\n    w2.Wait()\n    fmt.Println(\"2\")\n    w.Done()\n}()\nw.Wait()\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/jVFk2HLQRGC\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 2, "accepted_answer_id": 52074650, "answer_count": 1, "score": 1, "last_activity_date": 1535536734, "creation_date": 1535536441, "question_id": 52074553, "link": "https://stackoverflow.com/questions/52074553/why-this-code-about-golang-goruntine-running-order-is-2-first", "title": "why this code about golang goruntine running order is &quot;2&quot; first", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    w := &amp;sync.WaitGroup{}\n    w.Add(2)\n    go func() {\n        fmt.Println(\"1\")\n        w.Done()\n    }()\n    go func() {\n        fmt.Println(\"2\")\n        w.Done()\n    }()\n    w.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ESi1mKAo1x_S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ESi1mKAo1x_S</a></p>\n\n<p>eh,I don't know why the \"2\" is print first.</p>\n\n<p>I want to check the information.But I don't know what's information should I check.So I post the question there for help.</p>\n\n<p>I think the first goroutine is the first one push in queue\u3002The it should be print first.</p>\n"}, {"tags": ["oracle", "go"], "comments": [{"owner": {"reputation": 136706, "user_id": 146325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09939a1d3bd9c1af199a948bdc68cb71?s=128&d=identicon&r=PG", "display_name": "APC", "link": "https://stackoverflow.com/users/146325/apc"}, "edited": false, "score": 2, "creation_date": 1535534123, "post_id": 52073106, "comment_id": 91097219, "body": "That syntax was introduced in Oracle 12c. So maybe Golang is using an older Oracle client? I&#39;m afraid I don&#39;t know anything about Golang so I can&#39;t help you further, but with luck this might be enough of a clue for you to diagnose your Golang configuration."}, {"owner": {"reputation": 160176, "user_id": 266304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdb6217d08dcea7d67ff75f5f255081?s=128&d=identicon&r=PG", "display_name": "Alex Poole", "link": "https://stackoverflow.com/users/266304/alex-poole"}, "edited": false, "score": 1, "creation_date": 1535537597, "post_id": 52073106, "comment_id": 91099401, "body": "Not familiar with that client, but is it possible you just need to remove the semicolon?"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1535554586, "post_id": 52073106, "comment_id": 91111029, "body": "Try to remove the <code>;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 136706, "user_id": 146325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09939a1d3bd9c1af199a948bdc68cb71?s=128&d=identicon&r=PG", "display_name": "APC", "link": "https://stackoverflow.com/users/146325/apc"}, "edited": false, "score": 1, "creation_date": 1535534229, "post_id": 52073742, "comment_id": 91097286, "body": "Imagine the offset wasn&#39;t zero. The OP&#39;s actual problem is that a statement which runs in SQL*Plus doesn&#39;t run in golang. So that&#39;s what they need help in fixing."}, {"owner": {"reputation": 75434, "user_id": 9097906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RmIqt.jpg?s=128&g=1", "display_name": "Littlefoot", "link": "https://stackoverflow.com/users/9097906/littlefoot"}, "reply_to_user": {"reputation": 136706, "user_id": 146325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09939a1d3bd9c1af199a948bdc68cb71?s=128&d=identicon&r=PG", "display_name": "APC", "link": "https://stackoverflow.com/users/146325/apc"}, "edited": false, "score": 0, "creation_date": 1535534458, "post_id": 52073742, "comment_id": 91097409, "body": "My suggestion is right on the track of your commend under the OP&#39;s question, @APC - golang he uses doesn&#39;t recognize 12c syntax. If offset wasn&#39;t zero (well, <i>if</i> ... but it <i>is</i> zero), then omitting that clause might help in running a query."}], "tags": [], "owner": {"reputation": 75434, "user_id": 9097906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RmIqt.jpg?s=128&g=1", "display_name": "Littlefoot", "link": "https://stackoverflow.com/users/9097906/littlefoot"}, "is_accepted": false, "score": 0, "last_activity_date": 1535534049, "creation_date": 1535534049, "answer_id": 52073742, "question_id": 52073106, "link": "https://stackoverflow.com/questions/52073106/oracle-ora-00933-sql-command-not-properly-ended/52073742#52073742", "title": "Oracle ORA-00933: SQL command not properly ended", "body": "<p>If the offset is not specified, it is assumed that it is 0 (zero). So, remove that clause (as it does nothing in your case), i.e.</p>\n\n<pre><code>select * from table1\n</code></pre>\n\n<p>and use that query in golang.</p>\n"}, {"tags": [], "owner": {"reputation": 2748, "user_id": 10223147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcc6c1be6c30ab2aad3e134d07809d99?s=128&d=identicon&r=PG&f=1", "display_name": "Radagast81", "link": "https://stackoverflow.com/users/10223147/radagast81"}, "is_accepted": false, "score": 0, "last_activity_date": 1535545286, "creation_date": 1535545286, "answer_id": 52077357, "question_id": 52073106, "link": "https://stackoverflow.com/questions/52073106/oracle-ora-00933-sql-command-not-properly-ended/52077357#52077357", "title": "Oracle ORA-00933: SQL command not properly ended", "body": "<p>I am pretty sure that just your closing semicolon is to much. The semicolon is a character to separate several SQL statements or to close a pl/sql block. So when you write it at the end of a SQL statement the parser doesn't know how to handle it, cause he only awaits a single SQL statement.</p>\n"}, {"tags": [], "owner": {"reputation": 2918, "user_id": 1035663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/138e6b64e01318f07a1c0ee4ec708b94?s=128&d=identicon&r=PG", "display_name": "Max Lambertini", "link": "https://stackoverflow.com/users/1035663/max-lambertini"}, "is_accepted": false, "score": 3, "last_activity_date": 1535553218, "creation_date": 1535553218, "answer_id": 52080071, "question_id": 52073106, "link": "https://stackoverflow.com/questions/52073106/oracle-ora-00933-sql-command-not-properly-ended/52080071#52080071", "title": "Oracle ORA-00933: SQL command not properly ended", "body": "<p>I'd try running the query <strong>without</strong> the terminating semicolon, as Alex Poole pointed out. A lot of Oracle client libraries (i.e. <code>cx_Oracle</code> in python, ADO.NET Oracle Libraries) do complain if you try to execute a query ending with the semicolon (which is perfectly legal in SQL/Plus)</p>\n"}], "owner": {"reputation": 41, "user_id": 9118457, "user_type": "registered", "profile_image": "https://graph.facebook.com/611598582338529/picture?type=large", "display_name": "V&#245; Ho&#224;i Danh", "link": "https://stackoverflow.com/users/9118457/v%c3%b5-ho%c3%a0i-danh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3790, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1535625822, "creation_date": 1535532032, "last_edit_date": 1535625822, "question_id": 52073106, "link": "https://stackoverflow.com/questions/52073106/oracle-ora-00933-sql-command-not-properly-ended", "title": "Oracle ORA-00933: SQL command not properly ended", "body": "<p>I try to use golang and query data from Oracle. My SQL query is:</p>\n\n<pre><code>SELECT * FROM TABLE1 OFFSET 10 ROWS;\n</code></pre>\n\n<p>But it gives an error:</p>\n\n<pre><code>EXTRA *errors.withStack=dpiStmt_execute: ORA-00933: SQL command not properly ended\n</code></pre>\n\n<p>My SQL query works fine when I query in SQL*Plus, but errors when I use golang.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1535522852, "post_id": 52070424, "comment_id": 91090723, "body": "&quot;a const literal&quot;: To be precise: an untyped const literal."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 5, "last_activity_date": 1535522403, "creation_date": 1535522403, "answer_id": 52070424, "question_id": 52070356, "link": "https://stackoverflow.com/questions/52070356/why-do-you-need-to-convert-a-variable-to-duration-but-not-a-raw-integer/52070424#52070424", "title": "Why do you need to convert a variable to duration but not a raw integer?", "body": "<p>The difference is that you pass a <code>const</code> in the first case of <code>2 * time.Second</code> and a <code>var</code> in the second case where you declare <code>test := 2</code>. Read <a href=\"https://blog.golang.org/constants\" rel=\"noreferrer\">this blog post about constants in Go</a> for more details.</p>\n\n<p>Basically, a const literal in the code will be converted to the type that makes sense for the surrounding expression. In the first case <code>2 * time.Duration</code> this means that the <code>2</code> is converted to a <code>time.Duration</code> while in the second case <code>test := 2</code> the <code>2</code> is assigned to the <code>test</code> variable. This means that the type inference happens at that point, giving <code>test</code> the type <code>int</code> which is the default type for the literal <code>2</code>. If you used the literal <code>2.0</code> instead, the <code>test</code> variable would have type <code>float64</code> instead. However, the expression <code>test * time.Second</code> has the type of <code>test</code> already set and it is different from the type of <code>time.Duration</code> which is why you get that compiler error.</p>\n"}], "owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1535523030, "accepted_answer_id": 52070424, "answer_count": 1, "score": 4, "last_activity_date": 1535522403, "creation_date": 1535522083, "question_id": 52070356, "link": "https://stackoverflow.com/questions/52070356/why-do-you-need-to-convert-a-variable-to-duration-but-not-a-raw-integer", "closed_reason": "Duplicate", "title": "Why do you need to convert a variable to duration but not a raw integer?", "body": "<p>If I want to sleep for 2 seconds I can do the following:</p>\n\n<pre><code>time.Sleep(2 * time.Second)\n</code></pre>\n\n<p>but when I do:</p>\n\n<pre><code>test := 2\ntime.Sleep(test * time.Second)\n</code></pre>\n\n<p>It throws the error </p>\n\n<blockquote>\n  <p>invalid operation: test * time.Second (mismatched types int and\n  time.Duration)</p>\n</blockquote>\n\n<p>I can fix this by casting <code>test</code> like so: <code>time.Sleep(time.Duration(rand.Intn(5)) * time.Second)</code> but i'm wondering why it is that I need to wrap it in <code>time.Duration</code> when it's a variable and not when it's a raw value?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535522115, "post_id": 52070077, "comment_id": 91090432, "body": "are you looking for chunked reader? <a href=\"https://golang.org/pkg/net/http/httputil/#NewChunkedReader\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httputil/#NewChunkedReader</a>."}, {"owner": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535523554, "post_id": 52070077, "comment_id": 91091057, "body": "Can I use NewChunkedReader even when the http header has Content-Length?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535528973, "post_id": 52070077, "comment_id": 91093978, "body": "Why can you not read the header?"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "edited": false, "score": 0, "creation_date": 1535527336, "post_id": 52070667, "comment_id": 91093031, "body": "<code>resp, err := client.Do(req)</code> This process can not proceed to the next process until it receives all responses, right?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "edited": false, "score": 3, "creation_date": 1535527788, "post_id": 52070667, "comment_id": 91093290, "body": "@hr20k_, Do returns after the header has been read. The stdlib doesn&#39;t read the body, except perhaps a few kb into some sort of buffer, but certainly not gigabytes."}, {"owner": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535528906, "post_id": 52070667, "comment_id": 91093941, "body": "@Peter Wow. I don&#39;t know about that. I&#39;ll try it. thanks."}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "reply_to_user": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "edited": false, "score": 0, "creation_date": 1535529491, "post_id": 52070667, "comment_id": 91094296, "body": "@hr20k_ try putting a <code>time.Sleep(5 * time.Second)</code> after the <code>w.Write(buf)</code> statement and see :)"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1577050484, "post_id": 52070667, "comment_id": 105078952, "body": "The stdlib roundtrippers are not that efficient and they may read KBs or MBs of data without you knowing. Always check your network traffic and decide."}], "tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 6, "last_activity_date": 1535524620, "last_edit_date": 1535524620, "creation_date": 1535523510, "answer_id": 52070667, "question_id": 52070077, "link": "https://stackoverflow.com/questions/52070077/how-to-receive-http-response-for-streaming/52070667#52070667", "title": "How to receive HTTP Response for streaming", "body": "<p>(Edit: If you're unable to get the \"Content-length\" header from the response, it is possible that the web service you're hitting doesn't return that header. In such a case, there's no way to know the length of the response body without reading it completely. You can simulate that in the following example by removing the line that sets the Content-length header in the response.)</p>\n\n<p>The standard Go <code>net/http</code> package handles large responses very well. Here's a self contained example to demonstrate:</p>\n\n<pre><code>// Start a mock HTTP server that returns 2GB of data in the response. Make a\n// HTTP request to this server and print the amount of data read from the\n// response.\npackage main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"time\"\n)\n\nconst oneMB = 1024 * 1024\nconst oneGB = 1024 * oneMB\nconst responseSize = 2 * oneGB\n\nconst serverAddr = \"localhost:9999\"\n\nfunc startServer() {\n    // Mock HTTP server that always returns 2GB of data\n    go http.ListenAndServe(serverAddr, http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n        w.Header().Set(\"Content-length\", fmt.Sprintf(\"%d\", responseSize))\n\n        // 1MB buffer that'll be copied multiple times to the response\n        buf := []byte(strings.Repeat(\"x\", oneMB))\n\n        for i := 0; i &lt; responseSize/len(buf); i++ {\n            if _, err := w.Write(buf); err != nil {\n                log.Fatal(\"Failed to write to response. Error: \", err.Error())\n            }\n        }\n    }))\n\n    // Some grace period for the server to start\n    time.Sleep(100 * time.Millisecond)\n}\n\nfunc main() {\n    startServer()\n\n    // HTTP client\n    req, err := http.NewRequest(\"GET\", \"http://\"+serverAddr, nil)\n    if err != nil {\n        log.Fatal(\"Error creating HTTP request: \", err.Error())\n    }\n\n    client := http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatal(\"Error making HTTP request: \", err.Error())\n    }\n\n    // Read the response header\n    fmt.Println(\"Response: Content-length:\", resp.Header.Get(\"Content-length\"))\n\n    bytesRead := 0\n    buf := make([]byte, oneMB)\n\n    // Read the response body\n    for {\n        n, err := resp.Body.Read(buf)\n        bytesRead += n\n\n        if err == io.EOF {\n            break\n        }\n\n        if err != nil {\n            log.Fatal(\"Error reading HTTP response: \", err.Error())\n        }\n    }\n\n    fmt.Println(\"Response: Read\", bytesRead, \"bytes\")\n}\n</code></pre>\n\n<p>You wouldn't want to read the entire response in memory if it's too large. Write it to a temporary file instead and then process that.</p>\n\n<p>If instead you're looking for options to do this reliably when the network isn't very reliable, look for \"HTTP range requests\" using which you can resume partially downloaded data.</p>\n"}], "owner": {"reputation": 41, "user_id": 8829805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4fe6f949f43850a9eaf857ae0c157d4?s=128&d=identicon&r=PG&f=1", "display_name": "hr20k_", "link": "https://stackoverflow.com/users/8829805/hr20k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3710, "favorite_count": 1, "accepted_answer_id": 52070667, "answer_count": 1, "score": 3, "last_activity_date": 1535599389, "creation_date": 1535520836, "last_edit_date": 1535599389, "question_id": 52070077, "link": "https://stackoverflow.com/questions/52070077/how-to-receive-http-response-for-streaming", "title": "How to receive HTTP Response for streaming", "body": "<p>When throwing an HTTP Request with Go and receiving a Response, I want to receive a response while streaming, considering the case where the ResponseBody is huge (1 GB or more).</p>\n\n<pre><code>resp, err: = http.Client.Do(req)\n</code></pre>\n\n<p>In this case, if the body is huge, I can not read the Header and I do not know the state of Response.\nIs there any solution?</p>\n"}, {"tags": ["go", "timer", "cron", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1535528320, "post_id": 52069703, "comment_id": 91093626, "body": "time.Sleep is not equivalent to time.Ticker. If ExecuteFunctionA takes one minute to complete, one iteration takes six minutes with Sleep, and five minutes with a Ticker: <a href=\"https://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#NewTicker</a>"}, {"owner": {"reputation": 1005, "user_id": 277524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ddda66fe6045967d2011af4a0e9d8fe?s=128&d=identicon&r=PG", "display_name": "canerbalci", "link": "https://stackoverflow.com/users/277524/canerbalci"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535536171, "post_id": 52069703, "comment_id": 91098502, "body": "Good catch. Sure you can run the <code>ExecuteFunctionA()</code> in a separate goroutine if the execution time is significant. I updated the code example."}, {"owner": {"reputation": 610, "user_id": 3041388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvK4n.jpg?s=128&g=1", "display_name": "pfctgeorge", "link": "https://stackoverflow.com/users/3041388/pfctgeorge"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535550972, "post_id": 52069703, "comment_id": 91108399, "body": "IMHO, updated code couldn&#39;t resolve the problem proposed by @Peter. Consider that, if one iteration takes six minutes, there are two goroutines which will running the <code>ExecuteFunctionA</code>. There may be some concurrent problem which will put your program into a mess."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535553219, "post_id": 52069703, "comment_id": 91110016, "body": "Just use <a href=\"https://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\">time.NewTicker</a> instead of time.Tick and call Stop when breaking the loop."}], "tags": [], "owner": {"reputation": 1005, "user_id": 277524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ddda66fe6045967d2011af4a0e9d8fe?s=128&d=identicon&r=PG", "display_name": "canerbalci", "link": "https://stackoverflow.com/users/277524/canerbalci"}, "is_accepted": false, "score": 2, "last_activity_date": 1535536199, "last_edit_date": 1535536199, "creation_date": 1535518336, "answer_id": 52069703, "question_id": 52069533, "link": "https://stackoverflow.com/questions/52069533/should-we-stop-this-kind-of-ticker/52069703#52069703", "title": "Should we stop this kind of Ticker?", "body": "<p>Nothing will leak if the 'app stopped'. The <a href=\"https://golang.org/pkg/time/#Tick\" rel=\"nofollow noreferrer\">warning in the documentation</a> refers to the fact that the garbage collector will not be able to reclaim the channel once it is created (<code>time.Tick()</code> initializes and returns a chan) and it will sit in memory even if you decide to <code>break</code> out of your <code>for</code> loop.\nBased on your description in the question, this shouldn't be an issue for you since you want the ticker running as long as the app is running. But if you decide otherwise, you can use an alternative way like:</p>\n\n<pre><code>go func() {\n  for {\n    time.Sleep(time.Duration(5) * time.Minute)\n    go ExecuteFunctionA()\n    if someConditionIsMet {\n      break // nothing leaks in this case\n    }\n  }\n}()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1535536326, "post_id": 52072524, "comment_id": 91098612, "body": "consider using a context."}], "tags": [], "owner": {"reputation": 610, "user_id": 3041388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvK4n.jpg?s=128&g=1", "display_name": "pfctgeorge", "link": "https://stackoverflow.com/users/3041388/pfctgeorge"}, "is_accepted": false, "score": 4, "last_activity_date": 1535530041, "creation_date": 1535530041, "answer_id": 52072524, "question_id": 52069533, "link": "https://stackoverflow.com/questions/52069533/should-we-stop-this-kind-of-ticker/52072524#52072524", "title": "Should we stop this kind of Ticker?", "body": "<p>You can use a channel as a intermediary to stop the ticker properly.</p>\n\n<p>Usually, I did it as the following:</p>\n\n<pre><code>var stopChan chan bool = make(chan bool)\n\nfunc Stop() {\n    stopChan &lt;- true\n}\n\nfunc Run() {\n    go func() {\n       ticker := time.NewTicker(5 * time.Minute)\n       for {\n           select {\n               case &lt;- c.stopChan:\n                   ticker.Stop()\n                   return\n               case &lt;- ticker.C:\n                   ExecuteFunctionA()\n           } \n       }\n    }()\n}\n</code></pre>\n\n<p>And you can invoke <code>Stop</code> function at the time you want to stop the ticker safely.</p>\n"}], "owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1535536199, "creation_date": 1535517196, "last_edit_date": 1535520414, "question_id": 52069533, "link": "https://stackoverflow.com/questions/52069533/should-we-stop-this-kind-of-ticker", "title": "Should we stop this kind of Ticker?", "body": "<p>I have a time ticker that will execute a function within time interval(eg every 5 minutes, 10 minutes). I create this time ticker within a goroutine. I heard that this kind of ticker could leak the memory even if the app stopped. This ticker will keep running as long as the app running. Should it stop? how to stop it properly? Here is my implementation:</p>\n\n<pre><code>go func() {\n    for range time.Tick(5 * time.Minute) {\n        ExecuteFunctionA()\n    }\n}()\n</code></pre>\n\n<p>What is the proper implementation for time ticker like this?</p>\n"}, {"tags": ["loops", "dictionary", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535505440, "post_id": 52068065, "comment_id": 91086425, "body": "What is not expected in this output: <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> ?"}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1535528738, "post_id": 52068065, "comment_id": 91093848, "body": "@zerkms I think you mean <a href=\"https://play.golang.org/p/xVOVKJD0f2p\" rel=\"nofollow noreferrer\">play.golang.org/p/xVOVKJD0f2p</a>"}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "edited": false, "score": 3, "creation_date": 1535528849, "post_id": 52068065, "comment_id": 91093902, "body": "@davi-sousa You should provide some more information as what the expected result is. Or what you want to optimize. That is not exactly clear"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "edited": false, "score": 0, "creation_date": 1535530668, "post_id": 52068065, "comment_id": 91095045, "body": "@Sascha oops, thanks :-)"}], "answers": [{"tags": [], "owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "is_accepted": true, "score": 0, "last_activity_date": 1535725328, "creation_date": 1535725328, "answer_id": 52117481, "question_id": 52068065, "link": "https://stackoverflow.com/questions/52068065/how-to-populate-a-map/52117481#52117481", "title": "How to populate a map", "body": "<p>In your code, if you change <code>for i &lt; 6</code> to <code>for i &lt; 7</code>, it should work fine.</p>\n\n<p>But you don't need to loop for this. You can use one of the following:</p>\n\n<p><a href=\"https://play.golang.org/p/M8-HJR7sFLW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/M8-HJR7sFLW</a></p>\n\n<p><a href=\"https://play.golang.org/p/zWUyeGuIDf5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zWUyeGuIDf5</a></p>\n"}], "owner": {"reputation": 3, "user_id": 5298243, "user_type": "registered", "profile_image": "https://graph.facebook.com/935043516541641/picture?type=large", "display_name": "Davi Sousa", "link": "https://stackoverflow.com/users/5298243/davi-sousa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 52117481, "answer_count": 1, "score": -2, "last_activity_date": 1535725328, "creation_date": 1535504221, "last_edit_date": 1535531008, "question_id": 52068065, "link": "https://stackoverflow.com/questions/52068065/how-to-populate-a-map", "title": "How to populate a map", "body": "<p>How can I populate this map on Golang?\nI try two for, but not add news key. I want to create a matrix mult, some help is welcome. My code (<a href=\"https://play.golang.org/p/xVOVKJD0f2p\" rel=\"nofollow noreferrer\">Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    ProgPorLetra := map[string]map[string]string{\n        \"Seg\": {},\n        \"Ter\": {},\n        \"Qua\": {},\n        \"Qui\": {},\n        \"Sex\": {},\n        \"Sab\": {},\n        \"Dom\": {},\n    }\n    i := 0\n    for i &lt; 6 {\n        switch i {\n        case 1:\n            ProgPorLetra[\"Seg\"][\"Valor\"] = \"Segunda\"\n        case 2:\n            ProgPorLetra[\"Ter\"][\"Valor\"] = \"Ter\u00e7a\"\n        case 3:\n            ProgPorLetra[\"Qua\"][\"Valor\"] = \"Quarta\"\n        case 4:\n            ProgPorLetra[\"Qui\"][\"Valor\"] = \"Quinta\"\n        case 5:\n            ProgPorLetra[\"Sex\"][\"Valor\"] = \"Sexta\"\n        case 6:\n            ProgPorLetra[\"Sab\"][\"Valor\"] = \"Sabado\"\n        case 0:\n            ProgPorLetra[\"Dom\"][\"Valor\"] = \"Domingo\"\n        }\n        i++\n    }\n    fmt.Println(ProgPorLetra)\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 4393811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b90c6cff81de2e462625ddbbdc83fd27?s=128&d=identicon&r=PG&f=1", "display_name": "norshtein", "link": "https://stackoverflow.com/users/4393811/norshtein"}, "is_accepted": false, "score": 0, "last_activity_date": 1535514119, "creation_date": 1535514119, "answer_id": 52069128, "question_id": 52067892, "link": "https://stackoverflow.com/questions/52067892/how-to-prevent-my-entire-table-from-being-deleted/52069128#52069128", "title": "How to prevent my entire table from being deleted", "body": "<p>According to the <a href=\"http://gorm.io/docs/delete.html#Delete-Record\" rel=\"nofollow noreferrer\">doc</a>, you need to check whether the primary id is blank. I'm not sure what your model looks like but I guess you should check <code>modle.ID</code> is not blank.</p>\n"}, {"tags": [], "owner": {"reputation": 10920, "user_id": 60580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b03012df2fca279ed49526f5433fd0c?s=128&d=identicon&r=PG", "display_name": "Jimmy Stenke", "link": "https://stackoverflow.com/users/60580/jimmy-stenke"}, "is_accepted": false, "score": 2, "last_activity_date": 1535532382, "last_edit_date": 1535532382, "creation_date": 1535514528, "answer_id": 52069178, "question_id": 52067892, "link": "https://stackoverflow.com/questions/52067892/how-to-prevent-my-entire-table-from-being-deleted/52069178#52069178", "title": "How to prevent my entire table from being deleted", "body": "<p>As you have surmised, it deletes the entire table because the record was not found, i.e. there is nothing in the model that it can use as a criteria, and therefore leaves the criteria blank and removes the entire table.</p>\n\n<p>You can check if the record was found, without checking the model itself.</p>\n\n<p>For instance:</p>\n\n<pre><code>if !db.Where(\"some_id = ? and other_id = ?\", someModel.UserId, someModel.Id).First(&amp;someModel).RecordNotFound {\n    db.Delete(&amp;someModel)\n}\n\nif err := db.Where(\"some_id = ? and other_id = ?\", someModel.UserId, someModel.Id).First(&amp;someModel).Error; err != nil {\n    if gorm.IsRecordNotFoundError(err) {\n        // record not found\n    } else {\n        // something else went wrong\n    }\n} else {\n    db.Delete(&amp;someModel)\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "closed_date": 1535540853, "answer_count": 2, "score": -3, "last_activity_date": 1539070333, "creation_date": 1535502807, "last_edit_date": 1539070333, "question_id": 52067892, "link": "https://stackoverflow.com/questions/52067892/how-to-prevent-my-entire-table-from-being-deleted", "closed_reason": "Needs details or clarity", "title": "How to prevent my entire table from being deleted", "body": "<p>If for whatever readon my someModel is not found in my first query below, <strong>the delete statement then deletes the entire table</strong>.</p>\n\n<pre><code>delete from somemodels\n</code></pre>\n\n<p>What is the best way to prevent this?</p>\n\n<pre><code>someModel := &amp;SomeModel{}\n\ndb.Where(\"some_id = ? and other_id = ?\", someModel.UserId, someModel.Id).First(&amp;someModel)\n\ndb.Delete(&amp;someModel)\n</code></pre>\n\n<p>Currently I am not checking if the model actually was found and returned from the database, and I know I should be checking but what is the best way to do this?</p>\n\n<p>Just check if it is not nil?  model.Id > 0 ?</p>\n"}, {"tags": ["go", "server", "broadcast", "channel", "goroutine"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535493483, "post_id": 52066623, "comment_id": 91083833, "body": "Don&#39;t think this is gonna solve your problem, but <code>defer conn.Close()</code> is never gonna execute from inside an infinite loop, you should call that defer in the handleConn func."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1535494118, "post_id": 52066623, "comment_id": 91084007, "body": "The broadcaster will block when a single connection blocks on write.  To debug, I suggest dumping the goroutine stacks by sending the process a SIGQUIT."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535497128, "post_id": 52066623, "comment_id": 91084816, "body": "Thanks for the ideas. Will try it tomorrow. You think of <code>cli &lt;- string(msg)</code> as the culprit? Tried adding <code>break</code> to the loop to no effect."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535501891, "post_id": 52066623, "comment_id": 91085756, "body": "The stack trace will probably lead you right to the problem.  Dump the stacks before peppering the code with debug code."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535550974, "post_id": 52066623, "comment_id": 91108401, "body": "Ok, please see my updated post."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535496319, "post_id": 52066832, "comment_id": 91084586, "body": "Thanks for the comments! Makes sense and I changed my code accordingly. Unfortunately it won&#39;t solve the above problem."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535496873, "post_id": 52066832, "comment_id": 91084731, "body": "I added another possibility in my answer."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535497545, "post_id": 52066832, "comment_id": 91084929, "body": "Thanks! Added error checking and this seems to run smoothly or at least won&#39;t produce an error."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535531529, "post_id": 52066832, "comment_id": 91095567, "body": "Next I would dump the stack as ThunderCat suggested. If you implement <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">http/pprof</a> you can check the stack via the browser while executing it to see exactly what each goroutine is currently doing / or not doing."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535551451, "post_id": 52066832, "comment_id": 91108737, "body": "Thanks, I used http/pprof and please see my updated question. The braodcaster goroutine seems to be number 22 and is working?"}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535653788, "post_id": 52066832, "comment_id": 91157551, "body": "Can&#39;t edit my answer -&gt; so it seems goroutine 9 is stuck &quot;runtime_pollWait&quot;. Do you have any ideas what may cause it? Thanks a lot for your help!"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535701977, "post_id": 52066832, "comment_id": 91172187, "body": "I don&#39;t think that is the problem. Are you sure it is not stuck already in the first heap you posted? Goroutine 22 ist already in the broadcaster and that is where I think it gets stuck. You need a heap before any messages are exchanged and then compare that to the ones you have now."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535718890, "post_id": 52066832, "comment_id": 91181682, "body": "I just ran it again and updated my post. First heap is before any message is broadcasted, so one message from one client will be broadcasted. Second heap is after the first message and broadcast isn&#39;t working. Is also added the goroutine profiles for each state. Do you have any idea why and where exactly this goroutine (in the new heap it&#39;s N&#176; 11) could get stuck? Thanks!"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535725729, "post_id": 52066832, "comment_id": 91186072, "body": "I don&#39;t think I can help you further. The heaps are the same and line numbers don&#39;t match with the code. I think that for some reason the broadcaster is stuck on this line, but since I have no runnable test environment I can&#39;t tell: <code>cli &lt;- string(msg)</code>"}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1535839861, "post_id": 52066832, "comment_id": 91215545, "body": "Thanks for sticking with me this long! I&#39;ll try to find another way. Sorry for the line numbers, if forgot to update the code after adding the ` go func() {         log.Println(http.ListenAndServe(&quot;localhost:6060&quot;, nil))     }()` (now updated)"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 0, "last_activity_date": 1535531776, "last_edit_date": 1535531776, "creation_date": 1535494091, "answer_id": 52066832, "question_id": 52066623, "link": "https://stackoverflow.com/questions/52066623/goroutines-broadcaster-stops-working-after-first-message/52066832#52066832", "title": "Goroutines: Broadcaster stops working after first message", "body": "<p>Just a few comments on your code. You will have to test if that solves the problem:</p>\n\n<p>Having a defer in a for loop is never(?) a good idea. Move the defer into the <code>handleConn</code> function:</p>\n\n<pre><code>for {\n    conn, err := listener.Accept()\n    if err != nil {\n        log.Print(err)\n        continue\n    }\n    defer conn.Close() // Not good!\n    go handleConn(conn)\n}\n</code></pre>\n\n<p>Next I would play with the outgoing channel and make it a buffered channel:</p>\n\n<pre><code>ch := make(chan string, 10) // outgoing client messages\n</code></pre>\n\n<p>This has 2 effects:</p>\n\n<ul>\n<li>Things will run faster/smoother as goroutines don't have to wait for the other side to be ready</li>\n<li>This might solve your <em>being stuck</em> problem if there is a complex loop of <em>goroutines each waiting on the other side</em> that causes your issue.</li>\n</ul>\n\n<p>Do the same with all the other channels though I assume <code>entering</code> and <code>leaving</code> don't need it.</p>\n\n<p>EDIT:</p>\n\n<p>There is some error checking missing when writing to the connection. Maybe something goes wrong there:</p>\n\n<pre><code>func clientWriter(conn net.Conn, ch &lt;-chan string) {\n    for msg := range ch {\n        fmt.Fprintln(conn, msg) // add error checking here\n    }\n}\n</code></pre>\n\n<p>EDIT 2:</p>\n\n<p>Implement <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">net/http/pprof</a> server in your client and check the heap endpoint of the webserver it starts to see where the goroutines are <em>hanging</em>.</p>\n"}], "owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535839714, "creation_date": 1535492803, "last_edit_date": 1535839714, "question_id": 52066623, "link": "https://stackoverflow.com/questions/52066623/goroutines-broadcaster-stops-working-after-first-message", "title": "Goroutines: Broadcaster stops working after first message", "body": "<p>I use a server to broadcast / echo messages from clients to all connected clients. The server only broadcasts the first message it receives, although it still receives messages - as fmt.Println([]byte(buf)) still prints new messages from the clients - and new clients can connect (but their messages also won't be broadcasted).</p>\n\n<p>After some feedback, it looks like one goroutine is stuck. But so far I've been unable to find which one. Help is really appreciated.</p>\n\n<p>The server:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    _ \"net/http/pprof\"\n)\n\ntype client chan&lt;- string // an outgoing message channel\n\nvar (\n    entering = make(chan client, 10)\n    leaving  = make(chan client, 10)\n    messages = make(chan string, 10) // all incoming client messages\n)\n\nfunc broadcaster() {\n    clients := make(map[client]bool) // all connected clients\n    for {\n        select {\n        case msg := &lt;-messages:\n            // Broadcast incoming message to all clients' outgoing message channels.\n            for cli := range clients {\n                cli &lt;- string(msg)\n            }\n        case cli := &lt;-entering:\n            clients[cli] = true\n\n        case cli := &lt;-leaving:\n            delete(clients, cli)\n            close(cli)\n\n        }\n\n    }\n}\n\nfunc handleConn(conn net.Conn) {\n\n    ch := make(chan string) // outgoing client messages\n    go clientWriter(conn, ch)\n    defer conn.Close()\n    entering &lt;- ch\n\n    buf := make([]byte, 0, 2+64*1024)\n    for {\n        n, err := io.ReadFull(conn, buf[:2])\n        if err != nil {\n            fmt.Println(n, err)\n            leaving &lt;- ch\n            return\n        }\n        msgLen := binary.BigEndian.Uint16(buf[0:2])\n        buf = buf[0 : 2+msgLen]\n        n, err = io.ReadFull(conn, buf[2:2+msgLen])\n        if err != nil {\n            fmt.Println(err)\n            leaving &lt;- ch\n            return\n        }\n        messages &lt;- string(buf)\n        fmt.Println([]byte(buf))\n\n    }\n}\n\nfunc clientWriter(conn net.Conn, ch &lt;-chan string) {\n    for msg := range ch {\n        _, err := fmt.Fprintln(conn, msg)\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n\nfunc main() {\n    go func() {\n        log.Println(http.ListenAndServe(\"localhost:6060\", nil))\n    }()\n\n    cer, err := tls.LoadX509KeyPair(\"cert.pem\", \"key.pem\")\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    config := &amp;tls.Config{\n        Certificates: []tls.Certificate{cer},\n        // Reject any TLS certificate that cannot be validated\n        //ClientAuth: tls.RequireAndVerifyClientCert,\n        // PFS, this will reject client with RSA certificates\n        CipherSuites: []uint16{tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384},\n        // Force it server side\n        PreferServerCipherSuites: true,\n        // TLS 1.2\n        MinVersion: tls.VersionTLS12}\n\n    listener, err := tls.Listen(\"tcp\", \"localhost:443\", config)\n    if err != nil {\n        log.Fatal(err)\n    }\n    go broadcaster()\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            log.Print(err)\n            continue\n        }\n\n        go handleConn(conn)\n    }\n}\n</code></pre>\n\n<p>My best guess is that the message channel is stuck - but I can't identify where. Help is really appreciated. </p>\n\n<p>The client sends []bytes with [0, encrypted-message-length, encrypted-message], e.g. [0 52 155 84 146 8 228 90 28 41 88 33 178 143 243 243 160 255 180 73 20 43 129 155 132 255 207 10 9 130 54 216 44 38 141 101 17 125 101 4 62 228 221 158 196 41 163 227 253 71 179 172 143 225]</p>\n\n<p><strong>Update1:</strong>\nSorry, I'm not good in debugging. Here are the full goroutine stack dumps (working and not working). The difference seems to me, that goroutine 8 was \"runnable\", while goroutine 9 is \"IO wait\" with \"runtime_pollWait\". Any ideas how to resolve it?</p>\n\n<p><strong>After server starts:</strong>\nWithout any prior input from client (except connecting). In this state, the broadcast will work once.</p>\n\n<pre><code>   goroutine 12 [running]:\nruntime/pprof.writeGoroutineStacks(0x7da840, 0xc42035e0e0, 0x411a69, 0xc420150570)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:650 +0xa7\nruntime/pprof.writeGoroutine(0x7da840, 0xc42035e0e0, 0x2, 0xc42006c000, 0x7da640)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:639 +0x44\nruntime/pprof.(*Profile).WriteTo(0x980840, 0x7da840, 0xc42035e0e0, 0x2, 0xc42035e0e0, 0x7998f5)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:310 +0x3e4\nnet/http/pprof.handler.ServeHTTP(0xc42001a0a1, 0x9, 0x7dd620, 0xc42035e0e0, 0xc420254200)\n    /usr/lib/go-1.10/src/net/http/pprof/pprof.go:243 +0x20d\nnet/http/pprof.Index(0x7dd620, 0xc42035e0e0, 0xc420254200)\n    /usr/lib/go-1.10/src/net/http/pprof/pprof.go:254 +0x1d1\nnet/http.HandlerFunc.ServeHTTP(0x7b02a8, 0x7dd620, 0xc42035e0e0, 0xc420254200)\n    /usr/lib/go-1.10/src/net/http/server.go:1947 +0x44\nnet/http.(*ServeMux).ServeHTTP(0x98dda0, 0x7dd620, 0xc42035e0e0, 0xc420254200)\n    /usr/lib/go-1.10/src/net/http/server.go:2337 +0x130\nnet/http.serverHandler.ServeHTTP(0xc42016c000, 0x7dd620, 0xc42035e0e0, 0xc420254200)\n    /usr/lib/go-1.10/src/net/http/server.go:2694 +0xbc\nnet/http.(*conn).serve(0xc4201640a0, 0x7dd8e0, 0xc42014c300)\n    /usr/lib/go-1.10/src/net/http/server.go:1830 +0x651\ncreated by net/http.(*Server).Serve\n    /usr/lib/go-1.10/src/net/http/server.go:2795 +0x27b\n\ngoroutine 1 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8e30, 0x72, 0x0)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc4201b0118, 0x72, 0xc4200a2000, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc4201b0118, 0xffffffffffffff00, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Accept(0xc4201b0100, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372 +0x1a8\nnet.(*netFD).accept(0xc4201b0100, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/fd_unix.go:238 +0x42\nnet.(*TCPListener).accept(0xc42000e018, 0x4122b8, 0x380, 0x78f260)\n    /usr/lib/go-1.10/src/net/tcpsock_posix.go:136 +0x2e\nnet.(*TCPListener).Accept(0xc42000e018, 0x4356c4, 0xc420181da0, 0x457610, 0xc420181de0)\n    /usr/lib/go-1.10/src/net/tcpsock.go:259 +0x49\ncrypto/tls.(*listener).Accept(0xc42010cd80, 0x7afee0, 0x7ded20, 0xc4200e6000, 0x0)\n    /usr/lib/go-1.10/src/crypto/tls/tls.go:52 +0x37\nmain.main()\n    /home/hendrik/Dropbox/go/chat/server/server.go:109 +0x2ca\n\ngoroutine 20 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8d60, 0x72, 0xc42020baa8)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc42015c098, 0x72, 0xffffffffffffff00, 0x7db3a0, 0x9515e0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc42015c098, 0xc4200d6400, 0x400, 0x400)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Read(0xc42015c080, 0xc4200d6400, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:157 +0x17d\nnet.(*netFD).Read(0xc42015c080, 0xc4200d6400, 0x400, 0x400, 0x57515a, 0xc42015c080, 0xc420202180)\n    /usr/lib/go-1.10/src/net/fd_unix.go:202 +0x4f\nnet.(*conn).Read(0xc420156020, 0xc4200d6400, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/net.go:176 +0x6a\ncrypto/tls.(*block).readFromUntil(0xc420150330, 0x7f84564feae0, 0xc420156020, 0x5, 0xc420156020, 0x5d626a)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:493 +0x96\ncrypto/tls.(*Conn).readRecord(0xc4200e6000, 0x7b0717, 0xc4200e6120, 0x98b7c0)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:595 +0xe0\ncrypto/tls.(*Conn).Read(0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:1156 +0x100\nio.ReadAtLeast(0x7f84564feac0, 0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x2, 0x786f60, 0x6d8e00, 0x7f84564feac0)\n    /usr/lib/go-1.10/src/io/io.go:309 +0x86\nio.ReadFull(0x7f84564feac0, 0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x10002, 0x6863ee, 0x1)\n    /usr/lib/go-1.10/src/io/io.go:327 +0x58\nmain.handleConn(0x7ded20, 0xc4200e6000)\n    /home/hendrik/Dropbox/go/chat/server/server.go:52 +0x27d\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:115 +0x350\n\ngoroutine 4 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8f00, 0x72, 0x0)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc4201b0098, 0x72, 0xc42014c000, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc4201b0098, 0xffffffffffffff00, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Accept(0xc4201b0080, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372 +0x1a8\nnet.(*netFD).accept(0xc4201b0080, 0xc420164120, 0xc42003edf0, 0x402b98)\n    /usr/lib/go-1.10/src/net/fd_unix.go:238 +0x42\nnet.(*TCPListener).accept(0xc420156048, 0xc42003ee20, 0x401af7, 0xc420164120)\n    /usr/lib/go-1.10/src/net/tcpsock_posix.go:136 +0x2e\nnet.(*TCPListener).AcceptTCP(0xc420156048, 0xc42003ee68, 0xc42003ee70, 0x18)\n    /usr/lib/go-1.10/src/net/tcpsock.go:246 +0x49\nnet/http.tcpKeepAliveListener.Accept(0xc420156048, 0x7b00a8, 0xc4201640a0, 0x7dd9a0, 0xc420150750)\n    /usr/lib/go-1.10/src/net/http/server.go:3216 +0x2f\nnet/http.(*Server).Serve(0xc42016c000, 0x7dd820, 0xc420156048, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2770 +0x1a5\nnet/http.(*Server).ListenAndServe(0xc42016c000, 0xc42016c000, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2711 +0xa9\nnet/http.ListenAndServe(0x79a39f, 0xe, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2969 +0x7a\nmain.main.func1()\n    /home/hendrik/Dropbox/go/chat/server/server.go:83 +0x3e\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:82 +0x4a\n\ngoroutine 36 [runnable]:\nnet/http.(*connReader).backgroundRead(0xc4201508d0)\n    /usr/lib/go-1.10/src/net/http/server.go:667\ncreated by net/http.(*connReader).startBackgroundRead\n    /usr/lib/go-1.10/src/net/http/server.go:664 +0xce\n\ngoroutine 11 [select]:\nmain.broadcaster()\n    /home/hendrik/Dropbox/go/chat/server/server.go:25 +0x193\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:107 +0x2b0\n\ngoroutine 21 [chan receive]:\nmain.clientWriter(0x7ded20, 0xc4200e6000, 0xc42007a120)\n    /home/hendrik/Dropbox/go/chat/server/server.go:73 +0x52\ncreated by main.handleConn\n    /home/hendrik/Dropbox/go/chat/server/server.go:46 +0x89\n</code></pre>\n\n<p><strong>after one broadcast (broadcast won't work):</strong>\nThis is the state after one broadcast. Server won't broadcast any more messages. </p>\n\n<pre><code> goroutine 12 [running]:\nruntime/pprof.writeGoroutineStacks(0x7da840, 0xc42035e1c0, 0x411a69, 0xc4201507e0)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:650 +0xa7\nruntime/pprof.writeGoroutine(0x7da840, 0xc42035e1c0, 0x2, 0xc420468000, 0x7da640)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:639 +0x44\nruntime/pprof.(*Profile).WriteTo(0x980840, 0x7da840, 0xc42035e1c0, 0x2, 0xc42035e1c0, 0x7998f5)\n    /usr/lib/go-1.10/src/runtime/pprof/pprof.go:310 +0x3e4\nnet/http/pprof.handler.ServeHTTP(0xc42001a2e1, 0x9, 0x7dd620, 0xc42035e1c0, 0xc420146100)\n    /usr/lib/go-1.10/src/net/http/pprof/pprof.go:243 +0x20d\nnet/http/pprof.Index(0x7dd620, 0xc42035e1c0, 0xc420146100)\n    /usr/lib/go-1.10/src/net/http/pprof/pprof.go:254 +0x1d1\nnet/http.HandlerFunc.ServeHTTP(0x7b02a8, 0x7dd620, 0xc42035e1c0, 0xc420146100)\n    /usr/lib/go-1.10/src/net/http/server.go:1947 +0x44\nnet/http.(*ServeMux).ServeHTTP(0x98dda0, 0x7dd620, 0xc42035e1c0, 0xc420146100)\n    /usr/lib/go-1.10/src/net/http/server.go:2337 +0x130\nnet/http.serverHandler.ServeHTTP(0xc42016c000, 0x7dd620, 0xc42035e1c0, 0xc420146100)\n    /usr/lib/go-1.10/src/net/http/server.go:2694 +0xbc\nnet/http.(*conn).serve(0xc4201640a0, 0x7dd8e0, 0xc42014c300)\n    /usr/lib/go-1.10/src/net/http/server.go:1830 +0x651\ncreated by net/http.(*Server).Serve\n    /usr/lib/go-1.10/src/net/http/server.go:2795 +0x27b\n\ngoroutine 1 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8e30, 0x72, 0x0)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc4201b0118, 0x72, 0xc4200a2000, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc4201b0118, 0xffffffffffffff00, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Accept(0xc4201b0100, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372 +0x1a8\nnet.(*netFD).accept(0xc4201b0100, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/fd_unix.go:238 +0x42\nnet.(*TCPListener).accept(0xc42000e018, 0x4122b8, 0x380, 0x78f260)\n    /usr/lib/go-1.10/src/net/tcpsock_posix.go:136 +0x2e\nnet.(*TCPListener).Accept(0xc42000e018, 0x4356c4, 0xc420181da0, 0x457610, 0xc420181de0)\n    /usr/lib/go-1.10/src/net/tcpsock.go:259 +0x49\ncrypto/tls.(*listener).Accept(0xc42010cd80, 0x7afee0, 0x7ded20, 0xc4200e6000, 0x0)\n    /usr/lib/go-1.10/src/crypto/tls/tls.go:52 +0x37\nmain.main()\n    /home/hendrik/Dropbox/go/chat/server/server.go:109 +0x2ca\n\ngoroutine 20 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8d60, 0x72, 0xc42020baa8)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc42015c098, 0x72, 0xffffffffffffff00, 0x7db3a0, 0x9515e0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc42015c098, 0xc4200d6400, 0x400, 0x400)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Read(0xc42015c080, 0xc4200d6400, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:157 +0x17d\nnet.(*netFD).Read(0xc42015c080, 0xc4200d6400, 0x400, 0x400, 0x2, 0x80, 0x82)\n    /usr/lib/go-1.10/src/net/fd_unix.go:202 +0x4f\nnet.(*conn).Read(0xc420156020, 0xc4200d6400, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/net.go:176 +0x6a\ncrypto/tls.(*block).readFromUntil(0xc420150330, 0x7f84564feae0, 0xc420156020, 0x5, 0xc420156020, 0x1)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:493 +0x96\ncrypto/tls.(*Conn).readRecord(0xc4200e6000, 0x7b0717, 0xc4200e6120, 0x0)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:595 +0xe0\ncrypto/tls.(*Conn).Read(0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/crypto/tls/conn.go:1156 +0x100\nio.ReadAtLeast(0x7f84564feac0, 0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x2, 0x786f60, 0x0, 0x7f84564feac0)\n    /usr/lib/go-1.10/src/io/io.go:309 +0x86\nio.ReadFull(0x7f84564feac0, 0xc4200e6000, 0xc4201e6000, 0x2, 0x10002, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/io/io.go:327 +0x58\nmain.handleConn(0x7ded20, 0xc4200e6000)\n    /home/hendrik/Dropbox/go/chat/server/server.go:52 +0x27d\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:115 +0x350\n\ngoroutine 4 [IO wait]:\ninternal/poll.runtime_pollWait(0x7f84564f8f00, 0x72, 0x0)\n    /usr/lib/go-1.10/src/runtime/netpoll.go:173 +0x57\ninternal/poll.(*pollDesc).wait(0xc4201b0098, 0x72, 0xc42014c000, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85 +0x9b\ninternal/poll.(*pollDesc).waitRead(0xc4201b0098, 0xffffffffffffff00, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Accept(0xc4201b0080, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372 +0x1a8\nnet.(*netFD).accept(0xc4201b0080, 0xc420164120, 0xc42003edf0, 0x402b98)\n    /usr/lib/go-1.10/src/net/fd_unix.go:238 +0x42\nnet.(*TCPListener).accept(0xc420156048, 0xc42003ee20, 0x401af7, 0xc420164120)\n    /usr/lib/go-1.10/src/net/tcpsock_posix.go:136 +0x2e\nnet.(*TCPListener).AcceptTCP(0xc420156048, 0xc42003ee68, 0xc42003ee70, 0x18)\n    /usr/lib/go-1.10/src/net/tcpsock.go:246 +0x49\nnet/http.tcpKeepAliveListener.Accept(0xc420156048, 0x7b00a8, 0xc4201640a0, 0x7dd9a0, 0xc420150750)\n    /usr/lib/go-1.10/src/net/http/server.go:3216 +0x2f\nnet/http.(*Server).Serve(0xc42016c000, 0x7dd820, 0xc420156048, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2770 +0x1a5\nnet/http.(*Server).ListenAndServe(0xc42016c000, 0xc42016c000, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2711 +0xa9\nnet/http.ListenAndServe(0x79a39f, 0xe, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.10/src/net/http/server.go:2969 +0x7a\nmain.main.func1()\n    /home/hendrik/Dropbox/go/chat/server/server.go:83 +0x3e\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:82 +0x4a\n\ngoroutine 37 [runnable]:\nnet/http.(*connReader).backgroundRead(0xc4201508d0)\n    /usr/lib/go-1.10/src/net/http/server.go:667\ncreated by net/http.(*connReader).startBackgroundRead\n    /usr/lib/go-1.10/src/net/http/server.go:664 +0xce\n\ngoroutine 11 [select]:\nmain.broadcaster()\n    /home/hendrik/Dropbox/go/chat/server/server.go:25 +0x193\ncreated by main.main\n    /home/hendrik/Dropbox/go/chat/server/server.go:107 +0x2b0\n\ngoroutine 21 [chan receive]:\nmain.clientWriter(0x7ded20, 0xc4200e6000, 0xc42007a120)\n    /home/hendrik/Dropbox/go/chat/server/server.go:73 +0x52\ncreated by main.handleConn\n    /home/hendrik/Dropbox/go/chat/server/server.go:46 +0x89\n</code></pre>\n\n<p><strong>goroutine profile: total 7 - before any messages</strong></p>\n\n<pre><code>1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d7e5d 0x563dcf 0x574eda 0x5c5096 0x5c55a0 0x5c8b40 0x471196 0x471308 0x6d907d 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56 /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d7e5c    internal/poll.(*FD).Read+0x17c      /usr/lib/go-1.10/src/internal/poll/fd_unix.go:157\n#   0x563dce    net.(*netFD).Read+0x4e          /usr/lib/go-1.10/src/net/fd_unix.go:202\n#   0x574ed9    net.(*conn).Read+0x69           /usr/lib/go-1.10/src/net/net.go:176\n#   0x5c5095    crypto/tls.(*block).readFromUntil+0x95  /usr/lib/go-1.10/src/crypto/tls/conn.go:493\n#   0x5c559f    crypto/tls.(*Conn).readRecord+0xdf  /usr/lib/go-1.10/src/crypto/tls/conn.go:595\n#   0x5c8b3f    crypto/tls.(*Conn).Read+0xff        /usr/lib/go-1.10/src/crypto/tls/conn.go:1156\n#   0x471195    io.ReadAtLeast+0x85         /usr/lib/go-1.10/src/io/io.go:309\n#   0x471307    io.ReadFull+0x57            /usr/lib/go-1.10/src/io/io.go:327\n#   0x6d907c    main.handleConn+0x27c           /home/hendrik/Dropbox/go/chat/server/server.go:52\n\n1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d93f8 0x5646e2 0x57e85e 0x57ce39 0x66271f 0x6614b5 0x661209 0x66224a 0x6d98ae 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56     /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a     /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c     /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d93f7    internal/poll.(*FD).Accept+0x1a7        /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372\n#   0x5646e1    net.(*netFD).accept+0x41            /usr/lib/go-1.10/src/net/fd_unix.go:238\n#   0x57e85d    net.(*TCPListener).accept+0x2d          /usr/lib/go-1.10/src/net/tcpsock_posix.go:136\n#   0x57ce38    net.(*TCPListener).AcceptTCP+0x48       /usr/lib/go-1.10/src/net/tcpsock.go:246\n#   0x66271e    net/http.tcpKeepAliveListener.Accept+0x2e   /usr/lib/go-1.10/src/net/http/server.go:3216\n#   0x6614b4    net/http.(*Server).Serve+0x1a4          /usr/lib/go-1.10/src/net/http/server.go:2770\n#   0x661208    net/http.(*Server).ListenAndServe+0xa8      /usr/lib/go-1.10/src/net/http/server.go:2711\n#   0x662249    net/http.ListenAndServe+0x79            /usr/lib/go-1.10/src/net/http/server.go:2969\n#   0x6d98ad    main.main.func1+0x3d                /home/hendrik/Dropbox/go/chat/server/server.go:83\n\n1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d93f8 0x5646e2 0x57e85e 0x57d049 0x5e2bd7 0x6d973a 0x42dcf2 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56 /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d93f7    internal/poll.(*FD).Accept+0x1a7    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372\n#   0x5646e1    net.(*netFD).accept+0x41        /usr/lib/go-1.10/src/net/fd_unix.go:238\n#   0x57e85d    net.(*TCPListener).accept+0x2d      /usr/lib/go-1.10/src/net/tcpsock_posix.go:136\n#   0x57d048    net.(*TCPListener).Accept+0x48      /usr/lib/go-1.10/src/net/tcpsock.go:259\n#   0x5e2bd6    crypto/tls.(*listener).Accept+0x36  /usr/lib/go-1.10/src/crypto/tls/tls.go:52\n#   0x6d9739    main.main+0x2c9             /home/hendrik/Dropbox/go/chat/server/server.go:109\n#   0x42dcf1    runtime.main+0x211          /usr/lib/go-1.10/src/runtime/proc.go:198\n\n1 @ 0x42e14a 0x42e1fe 0x405f92 0x405c8b 0x6d9342 0x45ab71\n#   0x6d9341    main.clientWriter+0x51  /home/hendrik/Dropbox/go/chat/server/server.go:73\n\n1 @ 0x42e14a 0x43db50 0x6d8cb3 0x45ab71\n#   0x6d8cb2    main.broadcaster+0x192  /home/hendrik/Dropbox/go/chat/server/server.go:25\n\n1 @ 0x657e40 0x45ab71\n#   0x657e40    net/http.(*connReader).backgroundRead+0x0   /usr/lib/go-1.10/src/net/http/server.go:667\n\n1 @ 0x6d0408 0x6d0210 0x6ccd54 0x6d851d 0x6d88a1 0x65e444 0x6600b0 0x6610ec 0x65d461 0x45ab71\n#   0x6d0407    runtime/pprof.writeRuntimeProfile+0x97  /usr/lib/go-1.10/src/runtime/pprof/pprof.go:679\n#   0x6d020f    runtime/pprof.writeGoroutine+0x9f   /usr/lib/go-1.10/src/runtime/pprof/pprof.go:641\n#   0x6ccd53    runtime/pprof.(*Profile).WriteTo+0x3e3  /usr/lib/go-1.10/src/runtime/pprof/pprof.go:310\n#   0x6d851c    net/http/pprof.handler.ServeHTTP+0x20c  /usr/lib/go-1.10/src/net/http/pprof/pprof.go:243\n#   0x6d88a0    net/http/pprof.Index+0x1d0      /usr/lib/go-1.10/src/net/http/pprof/pprof.go:254\n#   0x65e443    net/http.HandlerFunc.ServeHTTP+0x43 /usr/lib/go-1.10/src/net/http/server.go:1947\n#   0x6600af    net/http.(*ServeMux).ServeHTTP+0x12f    /usr/lib/go-1.10/src/net/http/server.go:2337\n#   0x6610eb    net/http.serverHandler.ServeHTTP+0xbb   /usr/lib/go-1.10/src/net/http/server.go:2694\n#   0x65d460    net/http.(*conn).serve+0x650        /usr/lib/go-1.10/src/net/http/server.go:1830\n</code></pre>\n\n<p><strong>goroutine profile: total 7 - after first broadcast - not broadcasting any more</strong></p>\n\n<pre><code>1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d7e5d 0x563dcf 0x574eda 0x5c5096 0x5c55a0 0x5c8b40 0x471196 0x471308 0x6d907d 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56 /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d7e5c    internal/poll.(*FD).Read+0x17c      /usr/lib/go-1.10/src/internal/poll/fd_unix.go:157\n#   0x563dce    net.(*netFD).Read+0x4e          /usr/lib/go-1.10/src/net/fd_unix.go:202\n#   0x574ed9    net.(*conn).Read+0x69           /usr/lib/go-1.10/src/net/net.go:176\n#   0x5c5095    crypto/tls.(*block).readFromUntil+0x95  /usr/lib/go-1.10/src/crypto/tls/conn.go:493\n#   0x5c559f    crypto/tls.(*Conn).readRecord+0xdf  /usr/lib/go-1.10/src/crypto/tls/conn.go:595\n#   0x5c8b3f    crypto/tls.(*Conn).Read+0xff        /usr/lib/go-1.10/src/crypto/tls/conn.go:1156\n#   0x471195    io.ReadAtLeast+0x85         /usr/lib/go-1.10/src/io/io.go:309\n#   0x471307    io.ReadFull+0x57            /usr/lib/go-1.10/src/io/io.go:327\n#   0x6d907c    main.handleConn+0x27c           /home/hendrik/Dropbox/go/chat/server/server.go:52\n\n1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d93f8 0x5646e2 0x57e85e 0x57ce39 0x66271f 0x6614b5 0x661209 0x66224a 0x6d98ae 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56     /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a     /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c     /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d93f7    internal/poll.(*FD).Accept+0x1a7        /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372\n#   0x5646e1    net.(*netFD).accept+0x41            /usr/lib/go-1.10/src/net/fd_unix.go:238\n#   0x57e85d    net.(*TCPListener).accept+0x2d          /usr/lib/go-1.10/src/net/tcpsock_posix.go:136\n#   0x57ce38    net.(*TCPListener).AcceptTCP+0x48       /usr/lib/go-1.10/src/net/tcpsock.go:246\n#   0x66271e    net/http.tcpKeepAliveListener.Accept+0x2e   /usr/lib/go-1.10/src/net/http/server.go:3216\n#   0x6614b4    net/http.(*Server).Serve+0x1a4          /usr/lib/go-1.10/src/net/http/server.go:2770\n#   0x661208    net/http.(*Server).ListenAndServe+0xa8      /usr/lib/go-1.10/src/net/http/server.go:2711\n#   0x662249    net/http.ListenAndServe+0x79            /usr/lib/go-1.10/src/net/http/server.go:2969\n#   0x6d98ad    main.main.func1+0x3d                /home/hendrik/Dropbox/go/chat/server/server.go:83\n\n1 @ 0x42e14a 0x42946a 0x428ae7 0x4d6f7b 0x4d6ffd 0x4d93f8 0x5646e2 0x57e85e 0x57d049 0x5e2bd7 0x6d973a 0x42dcf2 0x45ab71\n#   0x428ae6    internal/poll.runtime_pollWait+0x56 /usr/lib/go-1.10/src/runtime/netpoll.go:173\n#   0x4d6f7a    internal/poll.(*pollDesc).wait+0x9a /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:85\n#   0x4d6ffc    internal/poll.(*pollDesc).waitRead+0x3c /usr/lib/go-1.10/src/internal/poll/fd_poll_runtime.go:90\n#   0x4d93f7    internal/poll.(*FD).Accept+0x1a7    /usr/lib/go-1.10/src/internal/poll/fd_unix.go:372\n#   0x5646e1    net.(*netFD).accept+0x41        /usr/lib/go-1.10/src/net/fd_unix.go:238\n#   0x57e85d    net.(*TCPListener).accept+0x2d      /usr/lib/go-1.10/src/net/tcpsock_posix.go:136\n#   0x57d048    net.(*TCPListener).Accept+0x48      /usr/lib/go-1.10/src/net/tcpsock.go:259\n#   0x5e2bd6    crypto/tls.(*listener).Accept+0x36  /usr/lib/go-1.10/src/crypto/tls/tls.go:52\n#   0x6d9739    main.main+0x2c9             /home/hendrik/Dropbox/go/chat/server/server.go:109\n#   0x42dcf1    runtime.main+0x211          /usr/lib/go-1.10/src/runtime/proc.go:198\n\n1 @ 0x42e14a 0x42e1fe 0x405f92 0x405c8b 0x6d9342 0x45ab71\n#   0x6d9341    main.clientWriter+0x51  /home/hendrik/Dropbox/go/chat/server/server.go:73\n\n1 @ 0x42e14a 0x43db50 0x6d8cb3 0x45ab71\n#   0x6d8cb2    main.broadcaster+0x192  /home/hendrik/Dropbox/go/chat/server/server.go:25\n\n1 @ 0x4c3195 0x4c10df 0x4bfa29 0x4d7df8 0x563dcf 0x574eda 0x657e9a 0x45ab71\n#   0x4c3194    syscall.Syscall+0x4             /usr/lib/go-1.10/src/syscall/asm_linux_amd64.s:18\n#   0x4c10de    syscall.read+0x5e               /usr/lib/go-1.10/src/syscall/zsyscall_linux_amd64.go:749\n#   0x4bfa28    syscall.Read+0x48               /usr/lib/go-1.10/src/syscall/syscall_unix.go:162\n#   0x4d7df7    internal/poll.(*FD).Read+0x117          /usr/lib/go-1.10/src/internal/poll/fd_unix.go:153\n#   0x563dce    net.(*netFD).Read+0x4e              /usr/lib/go-1.10/src/net/fd_unix.go:202\n#   0x574ed9    net.(*conn).Read+0x69               /usr/lib/go-1.10/src/net/net.go:176\n#   0x657e99    net/http.(*connReader).backgroundRead+0x59  /usr/lib/go-1.10/src/net/http/server.go:668\n\n1 @ 0x6d0408 0x6d0210 0x6ccd54 0x6d851d 0x6d88a1 0x65e444 0x6600b0 0x6610ec 0x65d461 0x45ab71\n#   0x6d0407    runtime/pprof.writeRuntimeProfile+0x97  /usr/lib/go-1.10/src/runtime/pprof/pprof.go:679\n#   0x6d020f    runtime/pprof.writeGoroutine+0x9f   /usr/lib/go-1.10/src/runtime/pprof/pprof.go:641\n#   0x6ccd53    runtime/pprof.(*Profile).WriteTo+0x3e3  /usr/lib/go-1.10/src/runtime/pprof/pprof.go:310\n#   0x6d851c    net/http/pprof.handler.ServeHTTP+0x20c  /usr/lib/go-1.10/src/net/http/pprof/pprof.go:243\n#   0x6d88a0    net/http/pprof.Index+0x1d0      /usr/lib/go-1.10/src/net/http/pprof/pprof.go:254\n#   0x65e443    net/http.HandlerFunc.ServeHTTP+0x43 /usr/lib/go-1.10/src/net/http/server.go:1947\n#   0x6600af    net/http.(*ServeMux).ServeHTTP+0x12f    /usr/lib/go-1.10/src/net/http/server.go:2337\n#   0x6610eb    net/http.serverHandler.ServeHTTP+0xbb   /usr/lib/go-1.10/src/net/http/server.go:2694\n#   0x65d460    net/http.(*conn).serve+0x650        /usr/lib/go-1.10/src/net/http/server.go:1830\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1535491226, "post_id": 52066153, "comment_id": 91083088, "body": "From the docs of the error: <i>&quot;ErrRecordNotFound record not found error, happens when only haven&#39;t find any matched data when looking up with a struct, <b>finding a slice won&#39;t return this error</b>&quot;</i> (emphasis mine) <a href=\"https://godoc.org/github.com/jinzhu/gorm#pkg-variables\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1535491388, "post_id": 52066153, "comment_id": 91083136, "body": "Hey @Jeffrey, do you expect to have multiple users with the same username in your database (a bad idea)?"}], "answers": [{"comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1535495658, "post_id": 52066464, "comment_id": 91084397, "body": "@Jeffrey Anderson, since you&#39;re new. If you find this answer acceptable, and it has solved your problem. Make sure you <a href=\"https://stackoverflow.com/help/someone-answers\">accept this answer</a>, this way other users can find a solution more easily."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 1, "creation_date": 1535533394, "post_id": 52066464, "comment_id": 91096718, "body": "Thank you, I did not know about that. It was still returning user found if the string was empty but I managed to fix that myself!"}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1535534958, "post_id": 52066464, "comment_id": 91097709, "body": "There is just one problem with this, it is not case sensitive. If user &quot;MyUser&quot; exists but the input is &quot;myUser&quot;, then it will return true. I&#39;m also doing the same for checking emails, and emails MUST be case sensitive, so I can&#39;t <code>ToLower()</code> them. How can this be fixed?"}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": false, "score": 5, "last_activity_date": 1595702242, "last_edit_date": 1595702242, "creation_date": 1535491922, "answer_id": 52066464, "question_id": 52066153, "link": "https://stackoverflow.com/questions/52066153/recordnotfound-returns-false-when-there-are-no-rows/52066464#52066464", "title": "RecordNotFound returns false when there are no rows", "body": "<p>The following code should work as you expect it:</p>\n<pre><code>// We want an empty struct\nuser := User{} // We expect to have one (or no) user returned.\n\n// Check if the username is taken\n// Notice the use of First() instead of Find()\nif !db.Where(&quot;username = ?&quot;, &quot;MyUsername&quot;).First(&amp;user).RecordNotFound() {\n    fmt.Println(&quot;Username found, here's the user:&quot;, user)\n} else {\n    fmt.Println(&quot;Username not found&quot;)\n}\n</code></pre>\n<p>As <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a> already mentioned the <code>ErrRecordNotFound</code> will not trigger when you're working with slices.</p>\n<p>Since you don't need slices <em>(your username should be unique)</em> we can:</p>\n<ol>\n<li><p>Reference <strong>not a slice of Users but a single User</strong> <code>User{}</code> instead of <code>[]User{}</code>.</p>\n</li>\n<li><p>Use <code>gorms</code> <code>First()</code> method instead of <code>Find()</code>.</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2168, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1595702242, "creation_date": 1535490113, "last_edit_date": 1535491116, "question_id": 52066153, "link": "https://stackoverflow.com/questions/52066153/recordnotfound-returns-false-when-there-are-no-rows", "title": "RecordNotFound returns false when there are no rows", "body": "<p>I am having a problem with <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.RecordNotFound\" rel=\"nofollow noreferrer\">this library</a> because this function returns false even when the given input is not in the database, when in fact it should return true.</p>\n\n<pre><code>type User struct {\n    ID          uint      `gorm:\"primary_key\"`\n    Username    string    `json:\",omitempty\"`\n    Password    string    `json:\",omitempty\"`\n    CreatedAt   time.Time `json:\",omitempty\"`\n}\n\nb, err := db.Con()\nif err != nil {\n    log.Panic(err)\n}\n\ndefer db.Close()\n\n// We want an empty struct\n// Otherwise it will trigger the unique key constraint\nuser := []User{}\n\n// Check if the username is taken\n// BUX, MUST FIX: This always returns false for some reason\nif db.Where(&amp;User{Username: \"MyUsername\"}).Find(&amp;user).RecordNotFound() == false {\n    fmt.Println(\"Username found\")\n}\n</code></pre>\n\n<p>Why is it always returning false, even when the string is empty?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535486528, "post_id": 52065405, "comment_id": 91081348, "body": "There&#39;s nothing in the standard library to do this for you."}, {"owner": {"reputation": 227, "user_id": 6843746, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8330f5109894790a12c118251c9c77bf?s=128&d=identicon&r=PG&f=1", "display_name": "B.Li", "link": "https://stackoverflow.com/users/6843746/b-li"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535486659, "post_id": 52065405, "comment_id": 91081415, "body": "@Adrian, added the question, sorry for not being clear."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535486699, "post_id": 52065405, "comment_id": 91081441, "body": "<i>Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.</i>"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1535487873, "post_id": 52065405, "comment_id": 91081893, "body": "I am wondering very much, why you would want to do that. You would loose all information about the type the data has and when working with the data further you will loose all that the go type system offers in type safety and type checking. If it is json you want maerics has the answer you are seeking below."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1535487280, "creation_date": 1535487280, "answer_id": 52065579, "question_id": 52065405, "link": "https://stackoverflow.com/questions/52065405/flatten-a-struct-and-convert-it-to-a-mapstringstring/52065579#52065579", "title": "Flatten a struct and convert it to a map[string]string", "body": "<p>There are a number of ways you can convert those types (or similarly shaped types) into your desired JSON.</p>\n\n<p>The easiest would be to redefine your structs as below, then the default JSON marshaler will do what you want:</p>\n\n<pre><code>type MyInnerType int\n\ntype MyType struct {\n  Foo string      `json:\"foo\"`\n  Bar MyInnerType `json:\"hello\"`\n}\n</code></pre>\n\n<p>If you really want to keep the structs you defined then you can implement a custom JSON marshaler via a <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>MarshalJSON(...)</code></a> method like so:</p>\n\n<pre><code>type MyInnerType struct {\n  hello int\n}\n\nfunc (mit MyInnerType) MarshalJSON() ([]byte, error) {\n  return []byte(strconv.Itoa(mit.hello)), nil\n}\n\ntype MyType struct {\n  Foo string      `json:\"foo\"`\n  Bar MyInnerType `json:\"hello\"`\n}\n\nfunc main() {\n  x := &amp;MyType{\n    Foo: \"hi\",\n    Bar: MyInnerType{hello: 1},\n  }\n  bs, err := json.Marshal(x)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Println(string(bs))\n  // {\"foo\":\"hi\",\"hello\":1}\n}\n</code></pre>\n"}], "owner": {"reputation": 227, "user_id": 6843746, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8330f5109894790a12c118251c9c77bf?s=128&d=identicon&r=PG&f=1", "display_name": "B.Li", "link": "https://stackoverflow.com/users/6843746/b-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1305, "favorite_count": 0, "closed_date": 1535536021, "answer_count": 1, "score": -1, "last_activity_date": 1535487280, "creation_date": 1535486481, "last_edit_date": 1535486542, "question_id": 52065405, "link": "https://stackoverflow.com/questions/52065405/flatten-a-struct-and-convert-it-to-a-mapstringstring", "closed_reason": "Not suitable for this site", "title": "Flatten a struct and convert it to a map[string]string", "body": "<p>I have various different nested <code>struct</code>, for example:</p>\n\n<pre><code>type MyInnerType struct {\n    hello int\n}\n\ntype MyType struct {\n    foo   string\n    bar   MyInnerType\n}\n</code></pre>\n\n<p>with a declaration like this, for example:</p>\n\n<pre><code>x = &amp;MyType{\n    foo: \"hi\"\n    bar: MyInnerType{hello: 1}\n}\n</code></pre>\n\n<p>I would like to convert it into flattened map of <code>map[string]string</code> like this:</p>\n\n<pre><code>{\"foo\":\"hi\", \"hello\":\"1\"}\n</code></pre>\n\n<p>I imagine this has to be done recursively, but also converting various values into <code>string</code> is an issue. I've found this <a href=\"https://github.com/fatih/structs\" rel=\"nofollow noreferrer\">library</a> to help with it, but have not found any solution.</p>\n\n<p>Is there any library that does this? If not, what can I do for myself to solve this?</p>\n"}, {"tags": ["go", "yocto", "influxdb"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1535477962, "post_id": 52062775, "comment_id": 91077476, "body": "It is necessary to have <code>golang</code> installed in the host machine and as you have not installed it , that&#39;s why you are getting the error while getting the repo using <code>go get</code>"}, {"owner": {"reputation": 5198, "user_id": 186580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51af0a007f1bdc7134c0f02d3a156abb?s=128&d=identicon&r=PG", "display_name": "Oleksandr Kravchuk", "link": "https://stackoverflow.com/users/186580/oleksandr-kravchuk"}, "edited": false, "score": 0, "creation_date": 1535494499, "post_id": 52062775, "comment_id": 91084128, "body": "who us the exact log"}, {"owner": {"reputation": 2299, "user_id": 4851126, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/02d0041271b0178482aee8a36237e09e?s=128&d=identicon&r=PG", "display_name": "Shan-Desai", "link": "https://stackoverflow.com/users/4851126/shan-desai"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1535533343, "post_id": 52062775, "comment_id": 91096687, "body": "@HamzaAnis Hi i just found out that the <code>gdm</code> package was in fact downloaded in my <code>&#47;home&#47;&lt;user&gt;&#47;</code> folder without <code>golang</code> installed on the machine. Is there anyway I could change the path of the download to <code>${B}</code> variable correctly in the recipe?"}, {"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1535567722, "post_id": 52062775, "comment_id": 91118454, "body": "Install go in the user where you are running the bakefile and update the environment variables accordingly."}], "owner": {"reputation": 2299, "user_id": 4851126, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/02d0041271b0178482aee8a36237e09e?s=128&d=identicon&r=PG", "display_name": "Shan-Desai", "link": "https://stackoverflow.com/users/4851126/shan-desai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 243, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535533477, "creation_date": 1535474604, "last_edit_date": 1535533477, "question_id": 52062775, "link": "https://stackoverflow.com/questions/52062775/yocto-build-fails-to-at-go-get-command-within-bitbake-recipe-for-influxdb", "title": "Yocto Build fails to at `go get` command within Bitbake Recipe for InfluxDB", "body": "<p>I have cloned <a href=\"https://github.com/kraj/meta-influx/tree/kraj/develop\" rel=\"nofollow noreferrer\">this meta-influx fork</a> and added to my layers folder in my Yocto directory.</p>\n\n<p>I have also added it to my <code>bblayers.conf</code> and tried baking it using:</p>\n\n<pre><code>bitbake -k github.com-influxdata-influxdb\n</code></pre>\n\n<p>which provides me the following error logs:</p>\n\n<pre><code>ERROR: github.com-influxdata-influxdb-1.0-r0 do_configure: Function failed: do_configure (log file is located at /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/temp/log.do_configure.29201)\nERROR: Logfile of failure stored in: /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/temp/log.do_configure.29201\nLog data follows:\n| DEBUG: Executing python function sysroot_cleansstate\n| DEBUG: Python function sysroot_cleansstate finished\n| DEBUG: Executing shell function do_configure\n| /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/temp/run.do_configure.29201: line 120: /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/github.com-influxdata-influxdb-1.0/bin/gdm: No such file or directory\n| WARNING: /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/temp/run.do_configure.29201:1 exit 1 from 'go get github.com/sparrc/gdm'\n| ERROR: Function failed: do_configure (log file is located at /opt/PHYTEC_BSPs/yocto_fsl/build/tmp/work/cortexa9hf-neon-phytec-linux-gnueabi/github.com-influxdata-influxdb/1.0-r0/temp/log.do_configure.29201)\nERROR: Task 392 (/opt/PHYTEC_BSPs/yocto_fsl/sources/poky/../meta-influx/recipes-go/go/github.com-influxdata-influxdb.bb, do_configure) failed with exit code '1' \n</code></pre>\n\n<p>The code says fails at the <code>go get sparrc gdm</code> within the <a href=\"https://github.com/kraj/meta-influx/blob/kraj/develop/recipes-go/go/github.com-influxdata-influxdb.bb#L17\" rel=\"nofollow noreferrer\">recipe file for influxdb</a>.</p>\n\n<p>On the host machine I do not have <code>golang</code> installed. Is it necessary to have go on the build machine?</p>\n\n<p>(Target board is a PhyTec Mira Board with i.MX6 processor on it)</p>\n\n<p>How do I resolve this issue? I am using <code>krogoth</code> branch (because the board providers have documentation in accordance with the branch)</p>\n\n<h3>Update</h3>\n\n<p>Even without <code>golang</code> being installed on the machine, the <code>gdm</code> is installed in my <code>/home/&lt;user&gt;/</code> folder under the directory <code>go</code> which has the <code>src/ bin/</code> folders. I still can't figure out how to download it to the appropriate <code>${B}</code> variable in the recipe mentioned above </p>\n"}, {"tags": ["database", "mongodb", "go", "time"], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 3, "last_activity_date": 1535473607, "last_edit_date": 1535473607, "creation_date": 1535472409, "answer_id": 52062140, "question_id": 52061986, "link": "https://stackoverflow.com/questions/52061986/time-precision-issue-on-comparison-in-mongodb-driver-in-go-and-possibly-in-other/52062140#52062140", "title": "Time precision issue on comparison in mongodb driver in Go and possibly in other language and other database", "body": "<p>You've correctly identified that the issue is one of <em>precision</em>.</p>\n\n<p><a href=\"https://docs.mongodb.com/manual/reference/bson-types/#document-bson-type-date\" rel=\"nofollow noreferrer\">MongoDB's <code>Date</code> type is</a> \"a 64-bit integer that represents the number of <strong>milliseconds</strong>...\".</p>\n\n<p><a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\">Golang's <code>time.Time</code> type</a> \"represents an instant in time with <strong>nanosecond</strong> precision\".</p>\n\n<p>As such, if you compare these respective values as golang types you will only get equivalence if the golang Time has millisecond resolution (e.g. zeroes for micro- and nanosecond places).</p>\n\n<p>For example:</p>\n\n<pre><code>gotime := time.Now() // Nanosecond precision\njstime := gotime.Truncate(time.Millisecond) // Milliseconds\ngotime == jstime // =&gt; likely false (different precision)\n\nisoMillis := \"2006-01-02T15:04:05.000-0700Z\"\ngomillis := gotime.Format(isoMillis)\njsmillis := jstime.Format(isoMillis)\ngomillis == jsmillis // =&gt; true (same precision)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 1, "creation_date": 1535472964, "post_id": 52062145, "comment_id": 91074941, "body": "this works, also, there&#39;s a time.Truncate(time.Millisecond) function, <a href=\"https://godoc.org/time#Time.Truncate\" rel=\"nofollow noreferrer\">godoc.org/time#Time.Truncate</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535473269, "post_id": 52062145, "comment_id": 91075097, "body": "Times in go have nanosecond <i>precision</i>. Time <i>accuracy</i> is dependent upon the system the program is running on."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1612561895, "last_edit_date": 1612561895, "creation_date": 1535472422, "answer_id": 52062145, "question_id": 52061986, "link": "https://stackoverflow.com/questions/52061986/time-precision-issue-on-comparison-in-mongodb-driver-in-go-and-possibly-in-other/52062145#52062145", "title": "Time precision issue on comparison in mongodb driver in Go and possibly in other language and other database", "body": "<p>Times in BSON are represented as UTC milliseconds since the Unix epoch (<a href=\"http://bsonspec.org/spec.html\" rel=\"nofollow noreferrer\">spec</a>). Time values in Go have nanosecond precision.</p>\n<p>To round trip time.Time values through BSON marshalling, use times truncated to milliseconds since the Unix epoch:</p>\n<pre><code>func truncate(t time.Time) time.Time {\n    return time.Unix(0, t.UnixNano()/1e6*1e6)\n}\n\n...\n\nu := user{\n    Username:          &quot;test_bson_username&quot;,\n    Password:          &quot;1234&quot;,\n    UserAccessibility: &quot;normal&quot;,\n    RegisterationTime: truncate(time.Now()), \n}\n</code></pre>\n<p>You can also use the <a href=\"https://godoc.org/time#Time.Truncate\" rel=\"nofollow noreferrer\">Time.Truncate</a> method:</p>\n<pre><code>u := user{\n    Username:          &quot;test_bson_username&quot;,\n    Password:          &quot;1234&quot;,\n    UserAccessibility: &quot;normal&quot;,\n    RegisterationTime:  time.Now().Truncate(time.Millisecond),\n}\n</code></pre>\n<p>This approach relies on the fact that Unix epoch and Go zero time differ by a whole number of milliseconds.</p>\n"}], "owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 757, "favorite_count": 0, "accepted_answer_id": 52062145, "answer_count": 2, "score": -2, "last_activity_date": 1612561895, "creation_date": 1535471896, "question_id": 52061986, "link": "https://stackoverflow.com/questions/52061986/time-precision-issue-on-comparison-in-mongodb-driver-in-go-and-possibly-in-other", "title": "Time precision issue on comparison in mongodb driver in Go and possibly in other language and other database", "body": "<p>I was learning Go and Mongodb, currently using the <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">alpha official mongodb driver</a>. Although it is in alpha, it is quite functional for basic usage I think. \nBut I got an interesting issue on time conversion in this db driver.</p>\n\n<p>Basically, I created a custom typed struct object, and marshaled it to bson document, and then convert the bson document back to struct object.</p>\n\n<pre><code>//check github.com/mongodb/mongo-go-driver/blob/master/bson/marshal_test.go\nfunc TestUserStructToBsonAndBackwards(t *testing.T) {\nu := user{\n    Username:          \"test_bson_username\",\n    Password:          \"1234\",\n    UserAccessibility: \"normal\",\n    RegisterationTime: time.Now(), //.Format(time.RFC3339), adding format result a string\n}\n\n//Struct To Bson\nbsonByteArray, err := bson.Marshal(u)\nif err != nil {\n    t.Error(err)\n}\n//.UnmarshalDocument is the same as ReadDocument\nbDoc, err := bson.UnmarshalDocument(bsonByteArray)\nif err != nil {\n    t.Error(err)\n}\nunameFromBson, err := bDoc.LookupErr(\"username\")\n//so here the binding is working for bson object too, the bind field named username ratherthan Username\nif err != nil {\n    t.Error(err)\n}\nif unameFromBson.StringValue() != \"test_bson_username\" {\n    t.Error(\"bson from user struct Error\")\n}\n\n//Bson Doc to User struct\nbsonByteArrayFromDoc, err := bDoc.MarshalBSON()\nif err != nil {\n    t.Error(err)\n}\n\nvar newU user\nerr = bson.Unmarshal(bsonByteArrayFromDoc, &amp;newU)\nif err != nil {\n    t.Error(err)\n}\n\nif newU.Username != u.Username {\n    t.Error(\"bson Doc to user struct Error\")\n}\n\n//here we have an issue about time format.\nif newU != u {\n    log.Println(newU)\n    log.Println(u)\n    t.Error(\"bson Doc to user struct time Error\")\n}\n}\n</code></pre>\n\n<p>However since my struct object has a time field, the result struct object contains a less accurate time value than the original. Then the comparison is failed. </p>\n\n<pre><code>=== RUN   TestUserStructToBsonAndBackwards\n{test_bson_username 1234     0001-01-01 00:00:00 +0000 UTC   2018-08-28 23:56:50.006 +0800 CST 0001-01-01 00:00:00 +0000 UTC normal }\n{test_bson_username 1234     0001-01-01 00:00:00 +0000 UTC   2018-08-28 23:56:50.006395949 +0800 CST m=+0.111119920 0001-01-01 00:00:00 +0000 UTC normal }\n--- FAIL: TestUserStructToBsonAndBackwards (0.00s)\n    model.user_test.go:67: bson Doc to user struct time Error\n</code></pre>\n\n<p>So I would like to ask many questions from this. </p>\n\n<ol>\n<li><p>How to compare time properly in this case ?</p></li>\n<li><p>What's the best way to store time in database to avoid such precision issue ? I think the time in database should not be a string.</p></li>\n<li><p>is this a db driver bug ?</p></li>\n</ol>\n"}, {"tags": ["pointers", "go", "interface", "pass-by-reference", "pass-by-value"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1535469655, "post_id": 52061348, "comment_id": 91072866, "body": "<code>bytes.Buffer</code> is a concrete type, <code>http.ResponseWriter</code> is an interface type. The note on pointer/value receivers for methods is unrelated."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535469754, "post_id": 52061348, "comment_id": 91072941, "body": "The function <code>http.Error</code> takes, specifically, a <code>http.ResponseWriter</code>, but you&#39;re passing a <code>*http.ResponseWriter</code> (as the error says). It&#39;s the wrong type for the function argument (not method receiver)."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1535469776, "post_id": 52061348, "comment_id": 91072954, "body": "If you see the definition <code>func Error(w ResponseWriter, error string, code int)</code> it requires <code>ResponseWriter</code> not a pointer to it. This is the reason behind error not the one you are considering."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535470485, "post_id": 52061348, "comment_id": 91073433, "body": "@Adrian from my understand what&#39;s you said, interface don&#39;t have &amp;interface, right? when use interface, we just pass it directly?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1535470912, "post_id": 52061348, "comment_id": 91073714, "body": "@toffee no that is not what it means, it means that if a function has a type other than a interface you have to satisfy that."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535471240, "post_id": 52061348, "comment_id": 91073917, "body": "You really should dig into Go&#39;s type system. It is not about magically or randomly putting &amp; and * before stuff. You have to understand the different types like struct types (bytes.Buffer) and interface types (http.ResponseWriter) and understand method sets. SO is not the right place to get this answers. You might try reddit or golang-nuts."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535471812, "post_id": 52061348, "comment_id": 91074297, "body": "Both are <code>io.Writer</code>s, yes, but both are <i>not</i> <code>http.ResponseWriter</code>s."}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1535491508, "last_edit_date": 1535491508, "creation_date": 1535491178, "answer_id": 52066350, "question_id": 52061348, "link": "https://stackoverflow.com/questions/52061348/golang-address-of-interface-and-interface-difference/52066350#52066350", "title": "golang address of interface and interface difference", "body": "<p>Maybe I can try to explain more detailed what all the very good comments are already saying:</p>\n\n<h2>Interfaces are (mostly) pointers in go</h2>\n\n<p>Interfaces in go are implemented (satisfied) if another type implements all the methods an interface defines. Usually that is done by adding the methods on the <em>pointer</em> of the type, <em>not</em> the type directly.</p>\n\n<pre><code>type SomeInterface interface {\n    SomeMethod string\n}\n\ntype SomeStruct struct {} // often is a struct but does not have to be\n\n// a method on the structs pointer\nfunc (s *SomeStruct) SomeMethod string {\n    return \"\"\n}\n</code></pre>\n\n<p><strong>The results of this:</strong></p>\n\n<ol>\n<li><code>SomeStruct</code> does NOT implement SomeInterface, <code>*SomeStruct</code> does!</li>\n<li>An Interface is (usually) already a pointer.</li>\n</ol>\n\n<h2>Your example</h2>\n\n<pre><code>var b bytes.Buffer\nfmt.Fprintf(&amp;b, \"some text\")\n\nvar w http.ResponseWriter\nhttp.Error(w, \"some error\", 1)\n</code></pre>\n\n<p>Variable <code>b</code> of type <code>bytes.Buffer</code> is a <code>struct</code> as you can see from the source code:</p>\n\n<pre><code>type Buffer struct {\n    buf       []byte   // contents are the bytes buf[off : len(buf)]\n    off       int      // read at &amp;buf[off], write at &amp;buf[len(buf)]\n    bootstrap [64]byte // memory to hold first slice; helps small buffers avoid allocation.\n    lastRead  readOp   // last read operation, so that Unread* can work correctly.\n\n    // FIXME: it would be advisable to align Buffer to cachelines to avoid false\n    // sharing.\n}\n</code></pre>\n\n<p>If you want to use it as type io.Writer (interface) you need to get a pointer of <code>bytes.Buffer</code> as (usually) pointer methods are used in go: <code>fmt.Fprintf(&amp;b, \"some text\")</code></p>\n\n<p>Variable <code>w</code> of type http.ResponseWriter is an <code>interface</code>:</p>\n\n<pre><code>type ResponseWriter interface {\n    Header() Header\n    Write([]byte) (int, error)\n    WriteHeader(statusCode int)\n}\n</code></pre>\n\n<p>Since interfaces are (usually) already pointers to some underlying implementation we can use it without taking a pointer: <code>http.Error(w, \"some error\", 1)</code>.</p>\n\n<h2>Interface initialisation</h2>\n\n<p>An interface itself cannot be initialised and used! You always need a struct or other type to implement the interface and then you can initialise that and use it as type <code>SomeInterface</code>.\nFor example <a href=\"https://github.com/gin-gonic/gin/blob/master/response_writer.go\" rel=\"nofollow noreferrer\">here is the implementation of gin</a> for a <code>http.ResponseWriter</code>. As you can see from the code it uses pointer receivers for its methods. So http.ResponseWriter is already a pointer to a struct.</p>\n\n<h2>Disclaimer</h2>\n\n<p>This is just one way of trying to make this complex topic sound simple (hopefully). This is not a technically complete or completely accurate explanation. Trying to stay simple and yet as accurate as possible.</p>\n"}], "owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1157, "favorite_count": 1, "accepted_answer_id": 52066350, "answer_count": 1, "score": -2, "last_activity_date": 1535491508, "creation_date": 1535469551, "question_id": 52061348, "link": "https://stackoverflow.com/questions/52061348/golang-address-of-interface-and-interface-difference", "title": "golang address of interface and interface difference", "body": "<p>I have found many similar problem, but not what I want\nplease see following codes.</p>\n\n<p>(1)</p>\n\n<pre><code>var buf bytes.Buffer\nfmt.Fprint(&amp;buf,\"test\")\n</code></pre>\n\n<p>(2)                         </p>\n\n<pre><code>var w http.ResponseWriter\nhttp.Error(w,http.StatusText(http.StatusBadRequest),http.StatusBadRequest)\n</code></pre>\n\n<p>both http.ResponseWriter and bytes.Buffer implement io.Writer interface, so I think they should have same behavior.</p>\n\n<p>when I change to </p>\n\n<pre><code>http.Error(&amp;w,http.StatusText(http.StatusBadRequest),http.StatusBadRequest)\n</code></pre>\n\n<p>jetbrains goland tell me</p>\n\n<pre><code>Cannot use '&amp;w' (type *http.ResponseWriter) as type ResponseWriter\n</code></pre>\n\n<p>I wonder why <code>buf</code> have '&amp;' can works, but another don't work?</p>\n\n<p>I googled, somebody say when pass value to function, it can reference to <code>&amp;w</code></p>\n\n<p>but another say if you pass a pointer, it can deference to value</p>\n\n<p>from <a href=\"https://github.com/golang/go/wiki/MethodSets#variables\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/MethodSets#variables</a></p>\n\n<blockquote>\n  <p>To make it easier to remember these rules, it may be helpful to simply consider the pointer- and value-receiver methods separately from the method set. It is legal to call a pointer-valued method on anything that is already a pointer or whose address can be taken (as is the case in the above example). It is legal to call a value method on anything which is a value or whose value can be dereferenced (as is the case with any pointer; this case is specified explicitly in the spec).</p>\n</blockquote>\n\n<p>I am totally confused, I can't understand by myself.\nI wish you can help me, thank you!</p>\n"}, {"tags": ["go", "ldflags"], "answers": [{"comments": [{"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "edited": false, "score": 1, "creation_date": 1535470753, "post_id": 52061457, "comment_id": 91073608, "body": "Awesome, that works and I appreciate the suggestion to use bash command substitution. I will give others a chance in case there is a better answer before I mark this as the right answer."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "edited": false, "score": 1, "creation_date": 1535474517, "post_id": 52061457, "comment_id": 91075740, "body": "@MarkusTenghamn glad to hear it, feel free to upvote if this answer helped solve your problem, regardless of whether or not you think it&#39;s the &quot;best&quot; answer."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "edited": false, "score": 1, "creation_date": 1535483585, "post_id": 52061457, "comment_id": 91080065, "body": "@MarkusTenghamn Use <code>time.Format()</code> instead?"}, {"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535491161, "post_id": 52061457, "comment_id": 91083067, "body": "@MichaelHampton thanks! Always looking to improve my code"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1535475770, "last_edit_date": 1535475770, "creation_date": 1535469953, "answer_id": 52061457, "question_id": 52061318, "link": "https://stackoverflow.com/questions/52061318/how-do-i-pass-ldflags-to-exec-command-with-multiple-arguments/52061457#52061457", "title": "How do I pass -ldflags to exec.Command with multiple arguments", "body": "<p>The issue is likely with the <a href=\"http://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html\" rel=\"nofollow noreferrer\">command substitution (backticks)</a>; it's not doing what you expect because it's a feature of the shell, not the \"go build\" command.</p>\n\n<pre><code>[]flagarg{\n    {Flag:\"-X main.buildstamp=`date -u '+%Y-%m-%d_%I:%M:%S%p'`\"},\n    // Bash command subst ----^------------------------------^\n</code></pre>\n\n<p>Try executing your printed command line as a single string argument to \"bash -c\", e.g.:</p>\n\n<pre><code>cmd = exec.Command(\"bash\", \"-c\", \"go build -v -a ...\")\n</code></pre>\n\n<p>You also might want to consider using the <code>$(...)</code> form of bash command substitution (I think it's easier to read), here's a simple example to demonstrate:</p>\n\n<pre><code>cmdline := \"echo \\\"The time is now '$(date)'!\\\"\"\nout, err := exec.Command(\"bash\", \"-c\", cmdline).Output()\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(out))\n// The time is now 'Tue Aug 28 09:33:34 MDT 2018'!\n</code></pre>\n"}], "owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1053, "favorite_count": 0, "accepted_answer_id": 52061457, "answer_count": 1, "score": 3, "last_activity_date": 1535475770, "creation_date": 1535469480, "question_id": 52061318, "link": "https://stackoverflow.com/questions/52061318/how-do-i-pass-ldflags-to-exec-command-with-multiple-arguments", "title": "How do I pass -ldflags to exec.Command with multiple arguments", "body": "<p>I have a fairly simple go file which builds several internal tools written in go. It worked well until I decided to add -ldflags to my build command. The following is the snippet which formats the <code>go build</code> command.</p>\n\n<pre><code>var cmd *exec.Cmd\nfile := fmt.Sprintf(\"%s.%s.%s\", p.Bin, e.OS, e.Arch)\nif len(p.Flags) &gt; 0 {\n    ldflags := \"\"\n    for _, f := range p.Flags {\n        if len(ldflags) &gt; 0 {\n            ldflags = ldflags + \" \"\n        }\n        ldflags = ldflags + f.Flag\n    }\n    ldflags = \"\\\"\" + ldflags + \"\\\"\"\n    fmt.Println(\"go\", \"build\", \"-v\", \"-a\", \"-ldflags\", ldflags, \"-o\", fmt.Sprintf(\"/tmp/bin/%s\", file), \".\")\n    cmd = exec.Command(\"go\", \"build\", \"-a\", \"-ldflags\", ldflags, \"-o\", fmt.Sprintf(\"/tmp/bin/%s\", file), \".\")\n} else {\n    fmt.Println(\"go\", \"build\", \"-v\", \"-a\", \"-o\", fmt.Sprintf(\"/tmp/bin/%s\", file), \".\")\n    cmd = exec.Command(\"go\", \"build\", \"-a\", \"-o\", fmt.Sprintf(\"/tmp/bin/%s\", file), \".\")\n        }\ncmd.Dir = p.Pkg\ncmd.Stdout = ioutil.Discard\ncmd.Stderr = os.Stdout\ncmd.Env = append(cleanEnv(),\n    fmt.Sprintf(\"GOOS=%s\", e.OS),\n    fmt.Sprintf(\"GOARCH=%s\", e.Arch),\n)\n\nif err := cmd.Run(); err != nil {\n    return err\n}\n</code></pre>\n\n<p>My flags are defined as simple strings like so</p>\n\n<pre><code>[]flagarg{\n    {Flag:\"-X main.buildstamp=`date -u '+%Y-%m-%d_%I:%M:%S%p'`\"},\n    {Flag:\"-X main.githash=`git rev-parse --short HEAD`\"},\n}\n</code></pre>\n\n<p>The following is the output when I print</p>\n\n<pre><code>go build -v -a -ldflags \"-X main.buildstamp=`date -u\n'+%Y-%m-%d_%I:%M:%S%p'` -X main.githash=`git rev-parse --short HEAD`\"\n-o /tmp/bin/bro.linux.amd64 .\n</code></pre>\n\n<p>The above command works when I paste it into my CLI but fails when I run this <code>go build</code> via my go script. When I say fail I mean that it's not setting my variables <code>githash</code> and <code>buildstamp</code>. Copying and pasting the command does set these variables as expected.</p>\n\n<p>I figured it must be something with the quotes and I have tried changing them around but I am unable to get things to work. I am starting to think I am heading down the wrong path and that it must be a better way to get this working.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 141, "user_id": 7065873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d3e590d3beb994e151d8134eab709c1?s=128&d=identicon&r=PG&f=1", "display_name": "apeter", "link": "https://stackoverflow.com/users/7065873/apeter"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535472859, "post_id": 52060982, "comment_id": 91074880, "body": "no I need an array of interfaces. What I need data is to hold an array of struct values."}, {"owner": {"reputation": 141, "user_id": 7065873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d3e590d3beb994e151d8134eab709c1?s=128&d=identicon&r=PG&f=1", "display_name": "apeter", "link": "https://stackoverflow.com/users/7065873/apeter"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535473211, "post_id": 52060982, "comment_id": 91075070, "body": "CreateRegTable creates a struct and returns it. There is another function then would add into data array. Posted the full code implemented below."}, {"owner": {"reputation": 141, "user_id": 7065873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d3e590d3beb994e151d8134eab709c1?s=128&d=identicon&r=PG&f=1", "display_name": "apeter", "link": "https://stackoverflow.com/users/7065873/apeter"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535478372, "post_id": 52060982, "comment_id": 91077645, "body": "RegAppDB contains an element data for which the data type is not known at compile time, so its declared as []interface{}.  What I want function CreateRegTable to do is to use the run time type of function parameter rec to create a variable of RegAppDB with field data as an array of run time type of rec. What I undersatnd from comments is this is not possible in go?"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1535468854, "creation_date": 1535468854, "answer_id": 52061099, "question_id": 52060982, "link": "https://stackoverflow.com/questions/52060982/creating-array-of-struct-dynamically-in-golang/52061099#52061099", "title": "Creating array of struct dynamically in golang", "body": "<p>Go does not support generics, and any attempt to do something like that is not going to work out well. In your specific case, there are a couple of key problems:</p>\n\n<ul>\n<li>You cannot use a variable as a type. Go is compile-time static typed, so anything that gets type information at runtime (i.e. <code>reflect.TypeOf</code>) happens too late to use the way you're trying to do it.</li>\n<li>Equally important, your struct's field is of type <code>[]interface{}</code>, which means <em>the only type you can use for that field</em> is <code>[]interface{}</code>. <code>[]string</code>, for example, is a different type, and cannot be assigned to that field.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 7065873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d3e590d3beb994e151d8134eab709c1?s=128&d=identicon&r=PG&f=1", "display_name": "apeter", "link": "https://stackoverflow.com/users/7065873/apeter"}, "is_accepted": false, "score": 0, "last_activity_date": 1535472574, "creation_date": 1535472574, "answer_id": 52062191, "question_id": 52060982, "link": "https://stackoverflow.com/questions/52060982/creating-array-of-struct-dynamically-in-golang/52062191#52062191", "title": "Creating array of struct dynamically in golang", "body": "<p>I took another route. Need some beautification. But this works. So now data is an array of interface and from calling function I pass pointer to structure variables to Save function. </p>\n\n<pre><code>    type RegAppDB struct {\n    nm   string\n    data []interface{}\n    cnt  int\n}\n\n// CreateRegTable creates a data structure to hold the regression result\nfunc CreateRegTable(tbl string) *RegAppDB {\n    return &amp;RegAppDB{tbl, make([]interface{}, 20), 0}\n}\n\n// Save implements saving a record Regression application DB\nfunc (rga *RegAppDB) Save(rec interface{}) error {\n    rga.data[rga.cnt] = rec\n    rga.cnt++\n    return nil\n}\n\n// Show implements showing the regression table\nfunc (rga *RegAppDB) Show() error {\n    fmt.Println(rga.cnt)\n    for i := 0; i &lt;= rga.cnt; i++ {\n        fmt.Println(rga.data[i])\n    }\n    return nil\n}\n\n// Compare compares two regression table for equality\nfunc (rga *RegAppDB) Compare(rgt *RegAppDB) bool {\n    return reflect.DeepEqual(rga, rgt)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "is_accepted": false, "score": 0, "last_activity_date": 1535724006, "creation_date": 1535724006, "answer_id": 52117123, "question_id": 52060982, "link": "https://stackoverflow.com/questions/52060982/creating-array-of-struct-dynamically-in-golang/52117123#52117123", "title": "Creating array of struct dynamically in golang", "body": "<p>It cannot be done for a generic type. If there are a fixed number of possible types, then you can do something like the following:</p>\n\n<pre><code>type RegAppDB struct {\n    nm   string\n    data interface{}\n}\n\nfunc CreateRegTable(rec interface{}) RegAppDB {\n    switch rec.(type) {\n    case int:\n        return &amp;RegAppDB{\"log\", []int{}}\n    case string:\n        return &amp;RegAppDB{\"log\", []string{}}\n    }\n    return nil\n}\n</code></pre>\n\n<p>Note: Your <code>data</code> in <code>RegAppDB</code> should be of type <code>interface{}</code> since <code>[]int</code> implements <code>interface{}</code> but not <code>[]interface{}</code></p>\n"}], "owner": {"reputation": 141, "user_id": 7065873, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d3e590d3beb994e151d8134eab709c1?s=128&d=identicon&r=PG&f=1", "display_name": "apeter", "link": "https://stackoverflow.com/users/7065873/apeter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1331, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1535724006, "creation_date": 1535468514, "question_id": 52060982, "link": "https://stackoverflow.com/questions/52060982/creating-array-of-struct-dynamically-in-golang", "title": "Creating array of struct dynamically in golang", "body": "<p>I try to create a generic function that accepts any struct value and create a array of that struct type. Here is the code I tried. But I get the error \"t is not a type\". How can I implement this.</p>\n\n<pre><code>    type RegAppDB struct {\n    nm   string\n    data []interface{}\n}\n\nfunc CreateRegTable(tbl string, rec interface{}) RegAppDB {\n    t := reflect.TypeOf(rec)\n    fmt.Println(t)\n    return RegAppDB{\"log\", []t}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535468286, "post_id": 52060812, "comment_id": 91071977, "body": "It will be whatever port the server was started on. A server instance only listens on one port."}, {"owner": {"reputation": 580, "user_id": 1365365, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/055d0f6ffe233d86ebe186ccad2656d8?s=128&d=identicon&r=PG", "display_name": "Jamie H", "link": "https://stackoverflow.com/users/1365365/jamie-h"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1535468527, "post_id": 52060812, "comment_id": 91072133, "body": "Yes, but what if I&#39;m using the same handler for multiple HTTP servers?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1535470664, "creation_date": 1535470664, "answer_id": 52061671, "question_id": 52060812, "link": "https://stackoverflow.com/questions/52060812/get-the-port-of-the-local-http-server-without-hijacking-the-connection/52061671#52061671", "title": "Get the port of the local HTTP server without hijacking the connection", "body": "<p>Get the local address from the <a href=\"https://godoc.org/net/http#Request.Context\" rel=\"nofollow noreferrer\">request context</a> using <a href=\"https://godoc.org/net/http#LocalAddrContextKey\" rel=\"nofollow noreferrer\">http.LocalAddrContextKey</a>.</p>\n\n<pre><code>a, ok := req.Context().Value(http.LocalAddrContextKey).(net.Addr)\nif !ok {\n    // handle address not found\n}\n</code></pre>\n\n<p>Get the TCP port from the address:</p>\n\n<pre><code>ta, ok := a.(*net.TCPAddr)\nif !ok {\n    // handle unknown address type\n}\nport := ta.Port\n</code></pre>\n"}], "owner": {"reputation": 580, "user_id": 1365365, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/055d0f6ffe233d86ebe186ccad2656d8?s=128&d=identicon&r=PG", "display_name": "Jamie H", "link": "https://stackoverflow.com/users/1365365/jamie-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 52061671, "answer_count": 1, "score": 2, "last_activity_date": 1535470664, "creation_date": 1535468021, "last_edit_date": 1535468590, "question_id": 52060812, "link": "https://stackoverflow.com/questions/52060812/get-the-port-of-the-local-http-server-without-hijacking-the-connection", "title": "Get the port of the local HTTP server without hijacking the connection", "body": "<p>In a http handler is there a way to get the port of the server that received the request without using <code>http.Hijacker</code> to get the TCP connection, if there isn't is there a way to hijack the connection but still use the provided <code>http.ResponseWriter</code></p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1535465469, "creation_date": 1535465469, "answer_id": 52059956, "question_id": 52059791, "link": "https://stackoverflow.com/questions/52059791/how-to-add-more-items-to-a-slice-of-various-types/52059956#52059956", "title": "How to add more items to a slice of various types", "body": "<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package to append elements to a slice of any type.</p>\n\n<pre><code>func createThings(slicep interface{}, num int) {\n    // Get reflect value for the slice. \n    // The call to Elem() deferences the pointer.\n    v := reflect.ValueOf(slicep).Elem()\n\n    // Create a zero value using the slice element type.\n    z := reflect.Zero(v.Type().Elem())\n\n    for c := 0; c &lt; num; c++ {\n        // Append zero value to slice.\n        v.Set(reflect.Append(v, z))\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/88gneoQsyUV\" rel=\"nofollow noreferrer\">Run it on the playground.</a></p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 52059956, "answer_count": 1, "score": -1, "last_activity_date": 1535465469, "creation_date": 1535464987, "question_id": 52059791, "link": "https://stackoverflow.com/questions/52059791/how-to-add-more-items-to-a-slice-of-various-types", "title": "How to add more items to a slice of various types", "body": "<p>I want to be able to pass a slice of a particular type into a function that will populate it with more items of that type.  Here is an example of code does not compile, but describes what I want to achieve:</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"reflect\"\n  \"strings\"\n)\ntype Person struct {\n  Name,Hobbies string\n}\ntype Cat struct {\n  Name,FurColor string\n}\nfunc main() {\n\n  people := []Person{}\n  createThings(&amp;people,10)\n  log.Println(people)\n\n  cats := []Cat{}\n  createThigns(&amp;cats,5)\n  log.Println(cats)\n}\nfunc createThings(slice interface{},num int) {\n  b := strings.Replace(reflect.TypeOf(slice).String(),\"*[]main.\",\"\",-1)\n  log.Println(b)\n  for c:=0;c&lt;num;c++ {\n    eval(\"item := \"+b+\"{}\")\n    *slice = append(*slice,item)\n  }\n}\n</code></pre>\n\n<p>Essentially, the statement <code>eval(\"item := \"+b+\"{}\")</code> is what I would have done in other programming languages that allow it, but from what I understand, it's not something idomatic to golang.</p>\n\n<p>I've seen something similar in the documentation for <a href=\"http://gorm.io\" rel=\"nofollow noreferrer\">http://gorm.io</a> where you can do something like this:</p>\n\n<pre><code>cats := []Cat{}\ndb.Find(&amp;cats)\npeople :=[]Person{}\ndb.Find(&amp;people)\n</code></pre>\n\n<p>The gorm object will add more records to <code>cats</code> or <code>people</code> even though they are completely different types.  I had a hard time digging into the gorm code to see how they do this.</p>\n\n<p>I wanted to know how I can change my <code>createThings</code> function so that it can take a slice of anything, and then add more empty records to it.  (Later, I'll use reflection to determine what fields are available in the structs, and populate with random data for the purposes of a game I'm making.)</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535464585, "post_id": 52059587, "comment_id": 91069530, "body": "What do you mean &quot;reflect package doesn&#39;t look inside the nested structs&quot;? You can get the type of a field and reflect on it exactly like you did with the outer struct."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1535465033, "creation_date": 1535465033, "answer_id": 52059808, "question_id": 52059587, "link": "https://stackoverflow.com/questions/52059587/how-to-fill-a-struct-that-has-lots-of-nested-structs-in-go/52059808#52059808", "title": "How to fill a struct that has lots of nested structs in Go", "body": "<p>The best way to do this is with a constructor method.  This will be more readable, and much faster, than using tags plus reflection. Something like:</p>\n\n<pre><code>func NewSchema() *Schema {\n    return &amp;Schema{\n        Schema: \"http://json-schema.org/draft-04/schema#\",\n        ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 4435867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tAryb.jpg?s=128&g=1", "display_name": "Erfan Besharat", "link": "https://stackoverflow.com/users/4435867/erfan-besharat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1591614916, "creation_date": 1535464407, "last_edit_date": 1535465007, "question_id": 52059587, "link": "https://stackoverflow.com/questions/52059587/how-to-fill-a-struct-that-has-lots-of-nested-structs-in-go", "title": "How to fill a struct that has lots of nested structs in Go", "body": "<p>What is the best way to fill a struct that has lots of nested structs inside it?\nI made a struct to generate a json schema file from it that looks like this:</p>\n\n<pre><code>type Schema struct {\n  Schema               string `default:\"http://json-schema.org/draft-04/schema#\"`\n  Title                string `default:\"Test Schema\"`\n  Type                 string `default:\"object\"`\n  AdditionalProperties bool   `default:false`\n  Properties           struct {\n    Core struct {\n      Type                 string\n      AdditionalProperties bool\n      Properties           struct{}\n    }\n    Work struct {\n      Type                 string\n      AdditionalProperties bool\n      Properties           struct{}\n    }\n  }\n}\n</code></pre>\n\n<p>At first, I wanted to put the default data in tags and fill the struct from that, but <code>reflect</code> package doesn't look inside the nested structs.</p>\n\n<p>Here is what I did using <code>reflect</code>:</p>\n\n<pre><code>t := reflect.TypeOf(Schema{})\nfor i := 0; i &lt; t.NumField(); i++ {\n    field := t.Field(i)\n    tag := field.Tag.Get(\"default\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 3, "creation_date": 1535461317, "post_id": 52058567, "comment_id": 91067355, "body": "Have a look here: <a href=\"https://golang.org/cmd/go/#hdr-Build_modes\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Build_modes</a>"}, {"owner": {"reputation": 2646, "user_id": 245418, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ctkz8.jpg?s=128&g=1", "display_name": "kopper", "link": "https://stackoverflow.com/users/245418/kopper"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1535463857, "post_id": 52058567, "comment_id": 91069027, "body": "&quot;When compiling multiple packages or a single non-main package, build compiles the packages but discards the resulting object, serving only as a check that the packages can be built.&quot;"}, {"owner": {"reputation": 2646, "user_id": 245418, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ctkz8.jpg?s=128&g=1", "display_name": "kopper", "link": "https://stackoverflow.com/users/245418/kopper"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535463895, "post_id": 52058567, "comment_id": 91069052, "body": "Also &quot;When compiling packages, build ignores files that end in &#39;_test.go&#39;.&quot;"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1535482516, "post_id": 52058567, "comment_id": 91079590, "body": "That quote applies if you are naming packages explicitly. It&#39;s not how you normally build a project. In this case if you&#39;re just running <code>go test</code> then you&#39;re already getting cached objects and your speed problem is probably elsewhere."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1535494670, "post_id": 52058567, "comment_id": 91084190, "body": "There is <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">golang plugins</a> but not sure you want to wrap your depencies into a prebuilt plugin!? Also: Which version of Go are you using? The new version(s) of Go have caching mechanisms for tests and for built depencies."}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1535534574, "post_id": 52058567, "comment_id": 91097478, "body": "What version of Go are you using?"}], "owner": {"reputation": 2646, "user_id": 245418, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ctkz8.jpg?s=128&g=1", "display_name": "kopper", "link": "https://stackoverflow.com/users/245418/kopper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 709, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1535461954, "creation_date": 1535461221, "last_edit_date": 1535461954, "question_id": 52058567, "link": "https://stackoverflow.com/questions/52058567/is-there-equivalent-of-static-library-in-go", "title": "Is there equivalent of static library in Go?", "body": "<h2>The problem</h2>\n\n<p>Linking of our tests is slow. We link ~400 packages every time which takes ~4s. </p>\n\n<h2>Possible solution</h2>\n\n<p>Most of the packages come from vendor directory, which changes rarely. It would be awesome to pre-link them into static library and use that (cached) library to speed up linking process.</p>\n\n<p>Not that shared library is not available on Mac's, which is an issue in our case.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 1, "creation_date": 1535458401, "post_id": 52057355, "comment_id": 91065379, "body": "FWIW, in python non-ancestor queries aren&#39;t even allowed inside transactions (exception is raised), maybe what you see is the go-specific behaviour in such case. See <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/transactions#what_can_be_done_in_a_transaction\" rel=\"nofollow noreferrer\">What can be done in a transaction</a>"}, {"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1535458787, "post_id": 52057355, "comment_id": 91065641, "body": "@DanCornilescu turns out that&#39;s the answer.  I wasn&#39;t checking the returned error value.  Added a log statement to print it out, and it gives this response: <code>existingKeys, err := existingRemoteURLQuery.GetAll(ctx, new(models.RepoStats)) \t\tif err != nil { \t\t\tlog.Errorf(ctx, &quot;Issue running in transaction: %v&quot;, err) \t\t}</code>"}], "answers": [{"tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": true, "score": 6, "last_activity_date": 1535459313, "creation_date": 1535459313, "answer_id": 52057939, "question_id": 52057355, "link": "https://stackoverflow.com/questions/52057355/appengine-datastore-query-returns-different-result-inside-transaction/52057939#52057939", "title": "Appengine Datastore query returns different result inside transaction", "body": "<p>Converting a comment into an answer</p>\n\n<p>Turns out this is the go-specific behaviour when attempting to perform non-ancestor queries inside transactions (FWIW, in python attempting to do so actually raises an exception).</p>\n\n<p>Ancestor queries are the only queries allowed inside transactions. From <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/transactions#what_can_be_done_in_a_transaction\" rel=\"noreferrer\">What can be done in a transaction</a> (not very explicit, tho, IMHO implicit as queries could return entities not meeting the transaction restrictions):</p>\n\n<blockquote>\n  <p>All Cloud Datastore operations in a transaction must operate on\n  entities in the same entity group if the transaction is a single-group\n  transaction, or on entities in a maximum of twenty-five entity groups\n  if the transaction is a cross-group transaction. This includes\n  querying for entities by ancestor, retrieving entities by key,\n  updating entities, and deleting entities. Notice that each root entity\n  belongs to a separate entity group, so a single transaction cannot\n  create or operate on more than one root entity unless it is a\n  cross-group transaction.</p>\n</blockquote>\n"}], "owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 52057939, "answer_count": 1, "score": 4, "last_activity_date": 1535459313, "creation_date": 1535457570, "last_edit_date": 1535458880, "question_id": 52057355, "link": "https://stackoverflow.com/questions/52057355/appengine-datastore-query-returns-different-result-inside-transaction", "title": "Appengine Datastore query returns different result inside transaction", "body": "<p>Hoping someone can help point out the issue in my code.</p>\n\n<p>I have a query defined outside a transaction, and when it's executed, it correctly matches an existing record in the database.</p>\n\n<p>However, the moment that query is executed inside a transaction, it fails to match the existing records in the database, despite the fact that they exist.</p>\n\n<p>Here's the code, with output below:</p>\n\n<pre><code>// Query for URL to see if any already exist\nexistingRemoteURLQuery := datastore.NewQuery(\"RepoStats\").\n    Filter(\"RepoURL =\", statsToSave.RepoURL).\n    KeysOnly().Limit(1)\n\ntestKey, _ := existingRemoteURLQuery.GetAll(ctx, new(models.RepoStats))\nif len(testKey) &gt; 0 {\n    log.Infof(ctx, \"TEST Update existing record vice new key\")\n} else {\n    log.Infof(ctx, \"TEST No existing key found, use new key\")\n}\n\n// Check if we already have a record with this remote URL\nvar key *datastore.Key\n\nerr := datastore.RunInTransaction(ctx, func(ctx context.Context) error {\n    // This function's argument ctx shadows the variable ctx from the surrounding function.\n\n    // last parameter is ignored because it's a keys-only query\n    existingKeys, err := existingRemoteURLQuery.GetAll(ctx, new(models.RepoStats))\n    if len(existingKeys) &gt; 0 {\n        log.Infof(ctx, \"Update existing record vice new key\")\n        // use existing key\n        key = existingKeys[0]\n\n    } else {\n        log.Infof(ctx, \"No existing key found, use new key\")\n        key = datastore.NewIncompleteKey(ctx, \"RepoStats\", nil)\n    }\n\n    return err\n}, nil)\n</code></pre>\n\n<p>As you can see in the output, the first query outside the transaction correctly matches the existing record.  But inside the transaction, it doesn't recognize the existing record:</p>\n\n<pre><code>2018/08/28 11:50:47 INFO: TEST Update existing record vice new key\n2018/08/28 11:50:47 INFO: No existing key found, use new key\n</code></pre>\n\n<p>Thanks for any help in advance</p>\n\n<p><strong>Updated</strong></p>\n\n<p>Dan's comment lead to printing out the error message on the query inside the transaction:</p>\n\n<pre><code>    if err != nil {\n        log.Errorf(ctx, \"Issue running in transaction: %v\", err)\n    }\n</code></pre>\n\n<p>Which prints:</p>\n\n<blockquote>\n  <p>ERROR: Issue running in transaction: API error 1 (datastore_v3: BAD_REQUEST): Only ancestor queries are allowed inside transactions.</p>\n</blockquote>\n"}, {"tags": ["go", "memcpy", "unsafe-pointers"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10284494, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X3Ula2yNHzY/AAAAAAAAAAI/AAAAAAAAjK0/AvDSChTuo_Y/photo.jpg?sz=128", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10284494/chiara"}, "edited": false, "score": 0, "creation_date": 1535540176, "post_id": 52057477, "comment_id": 91101044, "body": "this code writes all the the mem string into the first char of the [30]string (Field1) expanding the length of Field1 of len(mem). instead, the desired result it to spread mem into the final struct"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 17, "user_id": 10284494, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X3Ula2yNHzY/AAAAAAAAAAI/AAAAAAAAjK0/AvDSChTuo_Y/photo.jpg?sz=128", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10284494/chiara"}, "edited": false, "score": 0, "creation_date": 1535551040, "post_id": 52057477, "comment_id": 91108452, "body": "Not sure how you come to that conclusion. The size of Field1 does not change: <a href=\"https://play.golang.org/p/TWa3ROOV9LD\" rel=\"nofollow noreferrer\">play.golang.org/p/TWa3ROOV9LD</a>. And the <i>length</i> of the field is immutable anyway (30), because it&#39;s part of its type. I feel I misunderstand your goal here. If the output of the code isn&#39;t what you expect, could you add the expected result to the question?"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 3, "last_activity_date": 1535527409, "last_edit_date": 1535527409, "creation_date": 1535457943, "answer_id": 52057477, "question_id": 52056873, "link": "https://stackoverflow.com/questions/52056873/copy-a-string-into-a-struct-of-strings/52057477#52057477", "title": "Copy a string into a struct of strings", "body": "<p>You are not reserving enough memory for your struct value. The struct value is 38 strings longs, but you \"copy\" only one string. Consequently the remaining 37 strings reflect random memory after your first string, and it happens to be copies of the first string.</p>\n\n<p>Reserve enough space for the struct and it works as expected:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"unsafe\"\n)\n\ntype myMessage struct {\n        Field1 [30]string\n        Field2 [2]string\n        Field3 [4]string\n        Field4 [1]string\n        Field5 [1]string\n}\n\nfunc main() {\n        var mem [38]string\n        mem[0] = \"Abcdefghi\"\n\n        fmt.Println(\"Sizeof(string) =\", unsafe.Sizeof(\"\"))\n        fmt.Println(\"Sizeof(myMessage) =\", unsafe.Sizeof(myMessage{}))\n        fmt.Println(\"Sizeof(mem) =\", unsafe.Sizeof(mem))\n\n        unsafePtr := unsafe.Pointer(&amp;mem)\n        messPtr := (*myMessage)(unsafePtr)\n\n        var messageString myMessage = *messPtr\n        fmt.Println(messageString)\n}\n\n// Output:\n// Sizeof(string) = 16\n// Sizeof(myMessage) = 608\n// Sizeof(mem) = 608\n// {[Abcdefghi                             ] [ ] [   ] [] []}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/K3N-TnBbaLP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/K3N-TnBbaLP</a></p>\n"}], "owner": {"reputation": 17, "user_id": 10284494, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X3Ula2yNHzY/AAAAAAAAAAI/AAAAAAAAjK0/AvDSChTuo_Y/photo.jpg?sz=128", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10284494/chiara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535527409, "creation_date": 1535456075, "last_edit_date": 1535457197, "question_id": 52056873, "link": "https://stackoverflow.com/questions/52056873/copy-a-string-into-a-struct-of-strings", "title": "Copy a string into a struct of strings", "body": "<p>I am trying to simulate the memcpy from C in Go using <code>unsafe.Pointer</code>.\nI have to map a string into a struct of strings in the following way:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype myMessage struct {\n    Field1 [30]string\n    Field2 [2]string\n    Field3 [4]string\n    Field4 [1]string\n    Field5 [1]string\n}\n\nfunc main() {\n\n    var inputString string = \"Abcdefghi\"\n\n    inputPtr := &amp;inputString\n\n    unsafePtr := unsafe.Pointer(inputPtr)\n\n    messPtr := (*myMessage)(unsafePtr)\n\n    var messageString myMessage = *messPtr\n\n    fmt.Println(messageString)\n}\n</code></pre>\n\n<p>The result is as following:</p>\n\n<pre><code>./test\n{[Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi  Abcdefghi ] [Abcdefghi ] [Abcdefghi  Abcdefghi ] [Abcdefghi] []}\n</code></pre>\n\n<p>i.e. the code is copying <code>inputString</code> in each position of the final struct.</p>\n\n<p>Why is the <code>inputString</code> duplicated?</p>\n"}, {"tags": ["docker", "go", "dockerfile", "tar", "alpine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454648, "post_id": 52056387, "comment_id": 91063003, "body": "What does <code>echo $PATH</code> tell you?"}, {"owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454703, "post_id": 52056387, "comment_id": 91063035, "body": "<code>&#47;usr&#47;local&#47;go&#47;bin # echo $PATH    &#47;usr&#47;local&#47;sbin:&#47;usr&#47;local&#47;bin:&#47;usr&#47;sbin:&#47;usr&#47;bin:&#47;sbin:&#47;bin&zwnj;&#8203;:&#47;usr&#47;local&#47;go&#47;bin</code>"}, {"owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454731, "post_id": 52056387, "comment_id": 91063056, "body": "It has added PATH in it.."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535454957, "post_id": 52056387, "comment_id": 91063181, "body": "Not an answer to your direct question, but you could just use one of the <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">official Golang alpine docker images</a>. You can also use the official Dockerfile as a guide to setting up your own."}, {"owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535455077, "post_id": 52056387, "comment_id": 91063238, "body": "You are right..but I ahve some specific requirements for my project"}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1535463080, "post_id": 52056387, "comment_id": 91068563, "body": "to execute a go binary inside a container does not require an install of the golang compiler which you show above ... to simplify I suggest you compile elsewhere (perhaps in another container) then mount the golang binary as a volume in your container ... this separation will make updates to both the golang compiler and your source code easier to maintain"}, {"owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "edited": false, "score": 0, "creation_date": 1535524525, "post_id": 52056387, "comment_id": 91091496, "body": "Not installing anything..If you look at the steps I am just extracting tar file and using Go binary."}], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": false, "score": 14, "last_activity_date": 1535457933, "creation_date": 1535457933, "answer_id": 52057474, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/52057474#52057474", "title": "How to install Go in alpine linux", "body": "<p>With Alpine, you have libmusl instead of glibc. Alpine's libmusl is not a 1 for 1 replacement. Code linked against glibc will show a not found error which is actually from the dynamic linker. You can see what libraries are linked to the binary with ldd:</p>\n\n<pre><code>/ # ldd /usr/local/go/bin/go\n        /lib64/ld-linux-x86-64.so.2 (0x7f63ceed1000)\n        libpthread.so.0 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7f63ceed1000)\n        libc.so.6 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7f63ceed1000)\n</code></pre>\n\n<p>There are two options. The preferred option, and one used by docker's go images on Alpine, is to compile the go binaries on Alpine. You can see this in the Dockerfile for the golang image: <a href=\"https://github.com/docker-library/golang/blob/69f2d2a132565bf60afc91813801a3bdcc981526/1.10/alpine3.8/Dockerfile\" rel=\"noreferrer\">https://github.com/docker-library/golang/blob/69f2d2a132565bf60afc91813801a3bdcc981526/1.10/alpine3.8/Dockerfile</a></p>\n\n<p>The other option is to install glibc on Alpine, but once you start doing things like that, I'd question why use Alpine at all, and whether Debian or CentOS would be a more appropriate base image for you. Alpine has a <a href=\"https://wiki.alpinelinux.org/wiki/Running_glibc_programs\" rel=\"noreferrer\">wiki topic on this</a> and there are <a href=\"https://github.com/sgerrand/alpine-pkg-glibc/issues/1\" rel=\"noreferrer\">third parties that have created glibc packages for alpine</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1937, "user_id": 1920536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c6b474d8624ada97946f2c368ac1a52?s=128&d=identicon&r=PG", "display_name": "biolinh", "link": "https://stackoverflow.com/users/1920536/biolinh"}, "edited": false, "score": 2, "creation_date": 1550479155, "post_id": 52474413, "comment_id": 96268720, "body": "when you run &quot;apk add --no-cache --virtual .build-deps bash gcc musl-dev openssl go &quot;, you can run go version after that. Why do you need those lines between them ?"}, {"owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "reply_to_user": {"reputation": 1937, "user_id": 1920536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c6b474d8624ada97946f2c368ac1a52?s=128&d=identicon&r=PG", "display_name": "biolinh", "link": "https://stackoverflow.com/users/1920536/biolinh"}, "edited": false, "score": 0, "creation_date": 1551419955, "post_id": 52474413, "comment_id": 96640964, "body": "You can do that also. However, I focused more on installing specific version of go"}], "tags": [], "owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "is_accepted": true, "score": 22, "last_activity_date": 1537773719, "creation_date": 1537773719, "answer_id": 52474413, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/52474413#52474413", "title": "How to install Go in alpine linux", "body": "<p>Thanks BMitch.</p>\n\n<p>I compiled the go source code and performed the below steps inside alpine image container.  </p>\n\n<pre><code>echo \"installing go version 1.10.3...\" \napk add --no-cache --virtual .build-deps bash gcc musl-dev openssl go \nwget -O go.tgz https://dl.google.com/go/go1.10.3.src.tar.gz \ntar -C /usr/local -xzf go.tgz \ncd /usr/local/go/src/ \n./make.bash \nexport PATH=\"/usr/local/go/bin:$PATH\"\nexport GOPATH=/opt/go/ \nexport PATH=$PATH:$GOPATH/bin \napk del .build-deps \ngo version\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4825, "user_id": 1810391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oKbkA.png?s=128&g=1", "display_name": "John Siu", "link": "https://stackoverflow.com/users/1810391/john-siu"}, "edited": false, "score": 1, "creation_date": 1568493774, "post_id": 53405005, "comment_id": 102293638, "body": "Yes, this should be the better answer."}], "tags": [], "owner": {"reputation": 520, "user_id": 2929576, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8fd9b698c3137c24ba066f1e8e8717ac?s=128&d=identicon&r=PG&f=1", "display_name": "Bevilaqua", "link": "https://stackoverflow.com/users/2929576/bevilaqua"}, "is_accepted": false, "score": 24, "last_activity_date": 1560816249, "last_edit_date": 1560816249, "creation_date": 1542772169, "answer_id": 53405005, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/53405005#53405005", "title": "How to install Go in alpine linux", "body": "<p>The following Dockerfile worked for me. Simpler and more abstract.</p>\n\n<pre><code>FROM alpine:latest\n\nRUN apk add --no-cache git make musl-dev go\n\n# Configure Go\nENV GOROOT /usr/lib/go\nENV GOPATH /go\nENV PATH /go/bin:$PATH\n\nRUN mkdir -p ${GOPATH}/src ${GOPATH}/bin\n\n# Install Glide\nRUN go get -u github.com/Masterminds/glide/...\n\nWORKDIR $GOPATH\n\nCMD [\"make\"]\n</code></pre>\n\n<p>source: <a href=\"https://raw.githubusercontent.com/mickep76/alpine-golang/master/Dockerfile\" rel=\"noreferrer\">https://raw.githubusercontent.com/mickep76/alpine-golang/master/Dockerfile</a></p>\n"}, {"tags": [], "owner": {"reputation": 6631, "user_id": 6790948, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/w18wK.png?s=128&g=1", "display_name": "mchawre", "link": "https://stackoverflow.com/users/6790948/mchawre"}, "is_accepted": false, "score": 6, "last_activity_date": 1560588471, "creation_date": 1560588471, "answer_id": 56608863, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/56608863#56608863", "title": "How to install Go in alpine linux", "body": "<p>If the basic requirement is to have specific go version installed inside alpine based docker image then refer these <a href=\"https://hub.docker.com/_/golang\" rel=\"noreferrer\">images</a> available on official golang dockerhub account.</p>\n\n<pre><code>docker pull golang:1.12-alpine\ndocker pull golang:1.11-alpine\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2604, "user_id": 3385948, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/YJIjJ.png?s=128&g=1", "display_name": "Sean McCarthy", "link": "https://stackoverflow.com/users/3385948/sean-mccarthy"}, "edited": false, "score": 1, "creation_date": 1610149547, "post_id": 59485924, "comment_id": 116050675, "body": "+1 Love this answer! I didn&#39;t realize one could combine two Docker images like that. Previously if I wanted two main programs in a container, I thought I had to get one FROM an image, and install the other one in a RUN command. Brilliant!"}], "tags": [], "owner": {"reputation": 39969, "user_id": 1385845, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8c83a83d31eb49749a3ed04ecdf41c7?s=128&d=identicon&r=PG", "display_name": "Chad Grant", "link": "https://stackoverflow.com/users/1385845/chad-grant"}, "is_accepted": false, "score": 19, "last_activity_date": 1593688485, "last_edit_date": 1593688485, "creation_date": 1577349836, "answer_id": 59485924, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/59485924#59485924", "title": "How to install Go in alpine linux", "body": "<p>I just copied it over using multi stage builds, seems to be ok so far</p>\n<pre><code>FROM XXX\n \nCOPY --from=golang:1.13-alpine /usr/local/go/ /usr/local/go/\n \nENV PATH=&quot;/usr/local/go/bin:${PATH}&quot;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "is_accepted": false, "score": 7, "last_activity_date": 1590863507, "creation_date": 1590863507, "answer_id": 62106997, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux/62106997#62106997", "title": "How to install Go in alpine linux", "body": "<p>I found the best way to get <code>golang</code> up running in alpine linux is to install it from source. This is also way followed in the official alpine go docker images. </p>\n\n<pre><code>FROM alpine:3.12\n\nARG GOLANG_VERSION=1.14.3\n\n#we need the go version installed from apk to bootstrap the custom version built from source\nRUN apk update &amp;&amp; apk add go gcc bash musl-dev openssl-dev ca-certificates &amp;&amp; update-ca-certificates\n\nRUN wget https://dl.google.com/go/go$GOLANG_VERSION.src.tar.gz &amp;&amp; tar -C /usr/local -xzf go$GOLANG_VERSION.src.tar.gz\n\nRUN cd /usr/local/go/src &amp;&amp; ./make.bash\n\nENV PATH=$PATH:/usr/local/go/bin\n\nRUN rm go$GOLANG_VERSION.src.tar.gz\n\n#we delete the apk installed version to avoid conflict\nRUN apk del go\n\nRUN go version\n\n</code></pre>\n"}], "owner": {"reputation": 3409, "user_id": 4886861, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-slVOeDBqQ3I/AAAAAAAAAAI/AAAAAAAAAHw/vg0TVHkB0AQ/photo.jpg?sz=128", "display_name": "Yogesh Jilhawar", "link": "https://stackoverflow.com/users/4886861/yogesh-jilhawar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39975, "favorite_count": 6, "accepted_answer_id": 52474413, "answer_count": 6, "score": 26, "last_activity_date": 1593688485, "creation_date": 1535454407, "last_edit_date": 1535455015, "question_id": 52056387, "link": "https://stackoverflow.com/questions/52056387/how-to-install-go-in-alpine-linux", "title": "How to install Go in alpine linux", "body": "<p>I am trying to install Go inside an Alpine Docker image. For that I downloaded tar file from <a href=\"https://golang.org/doc/install?download=go1.10.3.linux-amd64.tar.gz\" rel=\"noreferrer\">here</a> inside my alpine docker image, untar it using following command:</p>\n\n<blockquote>\n  <p>tar -C /usr/local -xzf go1.10.3.linux-amd64.tar.gz</p>\n</blockquote>\n\n<p>exported PATH to have go binary as:</p>\n\n<blockquote>\n  <p>export PATH=$PATH:/usr/local/go/bin   </p>\n</blockquote>\n\n<p>However, when I say <code>go version</code>  then it says that <code>sh: go: not found</code>. I am quite new to alpine. Does anyone know, what I am missing here?</p>\n\n<p>Steps to reproduce-</p>\n\n<pre><code>$ docker run -it alpine sh\n$ wget https://dl.google.com/go/go1.10.3.linux-amd64.tar.gz\n$ tar -C /usr/local -xzf go1.10.3.linux-amd64.tar.gz\n$ export PATH=$PATH:/usr/local/go/bin\n$ go version\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1535455600, "post_id": 52056286, "comment_id": 91063548, "body": "Can you explain why <code>[:1]</code> prints the data, where <code>[0]</code> panics ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535455817, "post_id": 52056286, "comment_id": 91063680, "body": "I mean, mp[0][0] panics, and this is expected, its len is equal to 0. But its unclear why <code>mp[0][:1]</code> worked, where <code>mp[0][:2]</code> panics as expected."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1535456711, "post_id": 52056286, "comment_id": 91064260, "body": "@mh-cbon I see how that can appear un-intuitive. I have updated my answer, to include the relevant rules for slicing and accessing and my guess as to why these rules are this way."}], "tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": false, "score": 2, "last_activity_date": 1535456304, "last_edit_date": 1535456304, "creation_date": 1535454107, "answer_id": 52056286, "question_id": 52056098, "link": "https://stackoverflow.com/questions/52056098/append-a-slice-from-a-map-value-does-not-affect-the-map/52056286#52056286", "title": "Append a slice from a map value does not affect the map", "body": "<p>This is caused by the fact, that multiple slices can be backed by the same data but use different \"sections\" of the data. This means, that yes, an element is added to the data backing <code>mp[0]</code>, but the length of the slice in <code>mp</code> is not changed. You can do that manually:</p>\n\n<pre><code>fmt.Println(mp[0][:1])\n</code></pre>\n\n<p>which does print <code>[1]</code>.</p>\n\n<p>You can grow any slice to it's capacity without changing the underlying data by using <code>slice[:cap(slice)]</code>. <code>slice[:n]</code> will panic if <code>cap(slice) &lt; n</code>.\n<code>slice[n]</code> on the other hand will panic when <code>len(slice) &lt;= n</code>. I assume that the former is possible to allow the growing of slices without changing the underlying data (as far as that is possible). The latter, I would say, is \"normal\" behavior.</p>\n\n<p>This also explains why <code>mp[0][:2]</code> panics, as <code>cap(mp[0])</code> is <code>1</code>.</p>\n\n<p>For more details you might want to read <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this official blog post</a>, as suggested by Flimzy.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 3, "last_activity_date": 1535454759, "last_edit_date": 1535454759, "creation_date": 1535454114, "answer_id": 52056289, "question_id": 52056098, "link": "https://stackoverflow.com/questions/52056098/append-a-slice-from-a-map-value-does-not-affect-the-map/52056289#52056289", "title": "Append a slice from a map value does not affect the map", "body": "<p>In Golang it is mentioned in blog on <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a></p>\n\n<blockquote>\n  <p>Slicing does not copy the slice's data. It creates a new slice value\n  that points to the original array. This makes slice operations as\n  efficient as manipulating array indices. Therefore, modifying the\n  elements (not the slice itself) of a re-slice modifies the elements of\n  the original slice:</p>\n</blockquote>\n\n<pre><code>slice = append(slice, 1)\n</code></pre>\n\n<p>So in the above case it is creating a new slice with pointing to the same original underlying array. That is the reason it is showing the same address.</p>\n\n<p>To get the data of underlying array pointed by slice use <code>reflect</code> with <code>unsafe</code>:</p>\n\n<pre><code>hdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;slice))\ndata := *(*[1]int)(unsafe.Pointer(hdr.Data)) \n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/meGuaiNEMSb\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1535454890, "last_edit_date": 1535454890, "creation_date": 1535454150, "answer_id": 52056297, "question_id": 52056098, "link": "https://stackoverflow.com/questions/52056098/append-a-slice-from-a-map-value-does-not-affect-the-map/52056297#52056297", "title": "Append a slice from a map value does not affect the map", "body": "<p>As explained in <a href=\"https://blog.golang.org/go-slices-usage-and-internals#TOC_4.\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a>, two slices may point to the same memory location, but may have different <code>len</code> and <code>cap</code> attributes.</p>\n"}], "owner": {"reputation": 537, "user_id": 4870436, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90fb4f2c2d1c83a590ec6c466a0c4191?s=128&d=identicon&r=PG&f=1", "display_name": "tottishi05", "link": "https://stackoverflow.com/users/4870436/tottishi05"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1535456304, "creation_date": 1535453494, "last_edit_date": 1535453739, "question_id": 52056098, "link": "https://stackoverflow.com/questions/52056098/append-a-slice-from-a-map-value-does-not-affect-the-map", "title": "Append a slice from a map value does not affect the map", "body": "<pre><code>mp := map[int][]int{}\nslice := make([]int, 0, 1)\nfmt.Printf(\"slice address:%p\\n\", slice)\nmp[0] = slice\nslice = append(slice, 1)\nfmt.Println(\"after append\")\nfmt.Printf(\"slice address:%p\\n\", slice)\nfmt.Println(\"slice:\", slice)\nfmt.Println(\"mp[0]:\", mp[0])\nfmt.Printf(\"mp[0] address:%p\\n\", mp[0])  \n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>slice address:0xc042008f78  \nafter append  \nslice address:0xc042008f78  \nslice: [1]  \nmp[0]: []  \nmp[0] address:0xc042008f78\n</code></pre>\n\n<p>The address of the slice does not change as its cap is large enough during append. So why the map value does not take effect?</p>\n"}, {"tags": ["oracle", "go", "last-insert-id", "lastinsertid"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1535451868, "last_edit_date": 1592644375, "creation_date": 1535451868, "answer_id": 52055608, "question_id": 52055461, "link": "https://stackoverflow.com/questions/52055461/lastinsertid-is-returning-0-when-using-database-sql-package-with-oracle-driver/52055608#52055608", "title": "LastInsertId is returning 0, when using database/sql package with oracle driver", "body": "<p>From <a href=\"https://godoc.org/gopkg.in/rana/ora.v4#hdr-LastInsertId\" rel=\"nofollow noreferrer\">the documentation</a> (emphasis added):</p>\n<blockquote>\n<h1>LastInsertId</h1>\n<p>The <code>database/sql</code> package provides a LastInsertId method to return the last inserted row's id. <strong>Oracle does not provide such functionality, but if you append <code>... RETURNING col /*LastInsertId*/</code> to your SQL, then it will be presented as LastInsertId.</strong> Note that you have to mark with a <code>/*LastInsertId*/</code> (case insensitive) your <code>RETURNING</code> part, to allow ora to return the last column as <code>LastInsertId()</code>. That column must fit in <code>int64</code>, though!</p>\n</blockquote>\n"}], "owner": {"reputation": 1, "user_id": 6676281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/583ad46c8175c7a868fcc9b898ed70e8?s=128&d=identicon&r=PG&f=1", "display_name": "Nimish gupta", "link": "https://stackoverflow.com/users/6676281/nimish-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1535451868, "creation_date": 1535451433, "question_id": 52055461, "link": "https://stackoverflow.com/questions/52055461/lastinsertid-is-returning-0-when-using-database-sql-package-with-oracle-driver", "title": "LastInsertId is returning 0, when using database/sql package with oracle driver", "body": "<p>I am using database/sql package with oracle driver (\u201cgopkg.in/rana/ora.v4\u201d), when I am inserting the data, it\u2019s LastInsertId Method is returning 0, while data is successfully inserted.\nAttaching code.</p>\n\n<pre><code>package main\n\nimport (\n    \u201cdatabase/sql\u201d\n    \u201cfmt\u201d\n\n    _ \"gopkg.in/rana/ora.v4\"\n)\n\nfunc main() {\n    conn, err = sql.Open(\u201cora\u201d, \n    username+\"/\"+password+\"@\"+host+\":\"+port+\"/\"+sid)\n    query := \u201cINSERT INTO Table (C2) VALUES (:C2)\u201d\n    result, err := conn.Exec(query, \u201cTest\u201d)\n    if err!= nil {\n        panic(err)\n    }\n    lastId := result.LastInsertId() // returning 0\n    fmt.Println(lastId)\n}\n</code></pre>\n\n<p>Please tell me why this is happening?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 52, "user_id": 10219768, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IXwKHXAXwl8/AAAAAAAAAAI/AAAAAAAAABM/PfPe4PXdh9o/photo.jpg?sz=128", "display_name": "ETDeveloper", "link": "https://stackoverflow.com/users/10219768/etdeveloper"}, "is_accepted": false, "score": 1, "last_activity_date": 1535474776, "creation_date": 1535474776, "answer_id": 52062817, "question_id": 52055347, "link": "https://stackoverflow.com/questions/52055347/dynamic-indexing-in-go-app-engine-datastore/52062817#52062817", "title": "Dynamic indexing in Go app engine datastore", "body": "<p>Unfortunately, at this moment there is no way to add dynamic indexes. The documentations says [1]: \u201c These indexes are updated whenever an entity changes, so the results can be returned quickly when the app makes a query. To do this, the datastore needs to know in advance which queries the application will make. \u201d, So the indexes needs to be set previously and aren\u2019t dynamic.</p>\n\n<p>[1] <a href=\"https://cloud.google.com/appengine/docs/flexible/go/configuring-datastore-indexes-with-index-yaml\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/flexible/go/configuring-datastore-indexes-with-index-yaml</a></p>\n"}], "owner": {"reputation": 271, "user_id": 3490726, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/jtXDx.jpg?s=128&g=1", "display_name": "ZINDA ROBOT", "link": "https://stackoverflow.com/users/3490726/zinda-robot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535474776, "creation_date": 1535451065, "question_id": 52055347, "link": "https://stackoverflow.com/questions/52055347/dynamic-indexing-in-go-app-engine-datastore", "title": "Dynamic indexing in Go app engine datastore", "body": "<p>I am working with Google App Engine with GoLang. I am using datastore to keep data. On my app the no of requests on datastore was high, so explored on the solutions and implement sharding.</p>\n\n<p>For each entity, I kept 5 shards and while inserting I got a no between 0-4 and insert in the entityname_no. While reading the data, I read it from all the four entities and process.</p>\n\n<p>The problem I faced is I had two get queries, in the first query I had two filters(String, bool) and in the second query(String, bool and date) I had three filters. The first query is running fine but in second query it is expecting the index for all the 5 entities where in the index.yaml the index was related to the entity only.</p>\n\n<p>Is there a way to add dynamic indexing without udating the index.yaml every time?</p>\n"}, {"tags": ["if-statement", "go", "scope"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535449868, "post_id": 52054808, "comment_id": 91060003, "body": "1) because you&#39;re declaring new ones 2) this is actually interesting - I cannot find one easily as well 3) you return a value - it&#39;s a default value for the <code>error</code> type - <code>nil</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1535451882, "last_edit_date": 1535451882, "creation_date": 1535449966, "answer_id": 52054961, "question_id": 52054808, "link": "https://stackoverflow.com/questions/52054808/golang-if-initialization-statement-scoped-to-inner-if-block-why/52054961#52054961", "title": "golang if initialization statement scoped to inner if block. Why?", "body": "<blockquote>\n  <p>A compiler may disallow an empty expression list in a \"return\"\n  statement if a different entity (constant, type, or variable) with the\n  same name as a result parameter is in scope at the place of the\n  return.</p>\n</blockquote>\n\n<p>Try to return the value inside if scope and you will get to know that the err variable is shadowed inside the if scope.</p>\n\n<pre><code>func receive1() (err error) {\n    if v, err := produce(); err != nil {\n        fmt.Println(\"value2: \", v)\n        return // err is shadowed during return\n    }   \n    return\n}\n</code></pre>\n\n<p>Above code will show an error as:</p>\n\n<blockquote>\n  <p>err is shadowed during return</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/c-8EWdV6TLr\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>while in the second function the err declared in the return statement is assigned with local variable scope:</p>\n\n<pre><code>// err is the return value. It's OK\nfunc receive2() (err error) {\n    v, err := produce()\n    if err != nil {\n        fmt.Println(\"value2: \", v)\n        return\n    }\n    return\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/Pq9KpriwHWf\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>The expression list may be empty if the function's result type specifies names for its result parameters. The result parameters act as ordinary local variables and the function may assign values to them as necessary. The \"return\" statement returns the values of these variables. </p>\n\n<pre><code>func complexF3() (re float64, im float64) {\n    re = 7.0\n    im = 4.0\n    return\n}\n</code></pre>\n\n<blockquote>\n  <p>Regardless of how they are declared, all the result values are\n  initialized to the zero values for their type upon entry to the\n  function. A \"return\" statement that specifies results sets the result\n  parameters before any deferred functions are executed.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "edited": false, "score": 1, "creation_date": 1535972655, "post_id": 52054985, "comment_id": 91246598, "body": "Seems like named return values are bad idea at all( Now I removed all empty return statements in the end of functions and use explicit returns in all places. The only case where named return values are useful - is defer functions handling the panic and returning error"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 6, "last_activity_date": 1535450009, "creation_date": 1535450009, "answer_id": 52054985, "question_id": 52054808, "link": "https://stackoverflow.com/questions/52054808/golang-if-initialization-statement-scoped-to-inner-if-block-why/52054985#52054985", "title": "golang if initialization statement scoped to inner if block. Why?", "body": "<p>1) Because the language spec says so.</p>\n\n<p>2) It is:</p>\n\n<blockquote>\n  <p>Each \"if\", \"for\", and \"switch\" statement is considered to be in its own implicit block\"</p>\n</blockquote>\n\n<p>3) You did return at the end of your function. Do not use named return values.</p>\n"}], "owner": {"reputation": 1399, "user_id": 1349649, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/23f93637afe443b216d52f30276d120a?s=128&d=identicon&r=PG", "display_name": "porfirion", "link": "https://stackoverflow.com/users/1349649/porfirion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 0, "closed_date": 1535972779, "accepted_answer_id": 52054985, "answer_count": 2, "score": -6, "last_activity_date": 1535451882, "creation_date": 1535449467, "question_id": 52054808, "link": "https://stackoverflow.com/questions/52054808/golang-if-initialization-statement-scoped-to-inner-if-block-why", "closed_reason": "Duplicate", "title": "golang if initialization statement scoped to inner if block. Why?", "body": "<p>I've found a bug in my code</p>\n\n<pre><code>func receive() (err error) {\n    if v, err := produce(); err == nil {\n        fmt.Println(\"value: \", v)\n    }\n    return\n}\n</code></pre>\n\n<p>Error is never returning from this function, but I was absolutely sure it should.</p>\n\n<p>After some testing I understood that <code>err</code> is redeclared in the if statement. More than that - all variables are always redeclared in short variable assignment inside <code>if</code> statement, despite they were declared before.</p>\n\n<p>This is working code</p>\n\n<pre><code>func receive() (err error) {\n    v, err := produce()\n    if err == nil {\n        fmt.Println(\"value: \", v)\n    }\n    return\n}\n</code></pre>\n\n<p>Here is an example: <a href=\"https://play.golang.org/p/1AWBsPbLiI1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1AWBsPbLiI1</a></p>\n\n<p>Seems like if statement </p>\n\n<pre><code>//some code\nif &lt;init_statement&gt;; &lt;expression&gt; {}\n//more code\n</code></pre>\n\n<p>is equivalent to </p>\n\n<pre><code>//some code\n{\n    &lt;init_statement&gt;\n    if expression {}\n}\n//more code\n</code></pre>\n\n<p>So, my questions:</p>\n\n<p>1) why existing variables are not used</p>\n\n<p>2) why such scoping is not mentioned in documentation/language spec</p>\n\n<p>3) why compiler doesn't say that no one returns a value</p>\n"}, {"tags": ["mysql", "sql", "go", "sql-update"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535452623, "post_id": 52054801, "comment_id": 91061708, "body": "What does the error tell you?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535452717, "post_id": 52054801, "comment_id": 91061771, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35879772/passing-column-name-as-parameter-in-mysql\">Passing column name as parameter in MySQL</a>"}, {"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535453977, "post_id": 52054801, "comment_id": 91062589, "body": "@Flimzy It&#39;s too long!!  2018/08/28 15:24:54 http: panic serving 127.0.0.1:21801: Error 1064: You have an  error in your SQL syntax; check the manual that corresponds to your MySQL serve r version for the right syntax to use near &#39;? = ? WHERE id = ?&#39; at line 1 goroutine 5 [running]: net/http.(*conn).serve.func1(0xc04204c960)         C:/Go/src/net/http/server.go:1726 +0xd7 panic(0x67cae0, 0xc0420c2920)         C:/Go/src/runtime/panic.go:502 +0x237 main.CheckErr(0x70e940, 0xc0420c2920)         G:/Codes/GO/src/aHTTP/main.go:138 +0x51 main.MySQL()         ............"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454016, "post_id": 52054801, "comment_id": 91062616, "body": "What&#39;s too long?"}, {"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454530, "post_id": 52054801, "comment_id": 91062917, "body": "@Flimzy an error!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535454567, "post_id": 52054801, "comment_id": 91062948, "body": "Include the error in your question. And also read it--amazingly, it actually explains the problem."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535450106, "post_id": 52054951, "comment_id": 91060149, "body": "Am I should write for any update a func? Is there any way  to I write column name in stmt.Exec(&quot;score&quot;, value, id)"}], "tags": [], "owner": {"reputation": 1059, "user_id": 5336439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8V0P0.jpg?s=128&g=1", "display_name": "JERRY", "link": "https://stackoverflow.com/users/5336439/jerry"}, "is_accepted": false, "score": 0, "last_activity_date": 1535449923, "creation_date": 1535449923, "answer_id": 52054951, "question_id": 52054801, "link": "https://stackoverflow.com/questions/52054801/error-mysql-in-go/52054951#52054951", "title": "Error MySQL in Go", "body": "<p>You must need to mention column name in database update statement. without column name in set line of update query, it will not be prepared.</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535454185, "post_id": 52056002, "comment_id": 91062715, "body": "What I should doing now?"}, {"owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1535456216, "post_id": 52056002, "comment_id": 91063941, "body": "@Kaedys . . . Thank you."}], "tags": [], "owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "is_accepted": true, "score": 1, "last_activity_date": 1535456173, "last_edit_date": 1535456173, "creation_date": 1535453159, "answer_id": 52056002, "question_id": 52054801, "link": "https://stackoverflow.com/questions/52054801/error-mysql-in-go/52056002#52056002", "title": "Error MySQL in Go", "body": "<p>For better or worse, parameters can only be used for literal constants inside a query.  These are generally comparison values in the <code>where</code> clause, sometimes constants in the <code>select</code> or <code>set</code> clauses -- and less often in other parts of the query.</p>\n\n<p>Identifiers are not literal constants.  In fact, none of the following are:</p>\n\n<ul>\n<li>database, table, and column names</li>\n<li>function names</li>\n<li>operators (such as <code>+</code>)</li>\n<li>keywords (such as <code>asc</code>/<code>desc</code> in <code>order by</code>)</li>\n</ul>\n\n<p>Unfortunately, to implement these \"dynamically\", you need to munge the query string, by directly modifying the string.  That is rather yucky, but there no alternatively.</p>\n\n<p>One of the benefits of this approach is that it allows the database to store and then re-use the query plan.  Eliminating the compilation phase can be an important performance gain for very fast queries.</p>\n\n<p>EDIT:</p>\n\n<p>I do not really know go, but the idea is:</p>\n\n<pre><code>sql := \"UPDATE `test` SET [col] = ? WHERE id = ?\"\n\nsql = strings.replace(sql, \"[col]\", \"score\")\n\nstmt, err := db.Prepare(sql)\nCheckErr(err)\n_, err = stmt.Exec(value, id)\n</code></pre>\n\n<p>In other words, directly change the query string for identifiers.  Continue to use parameters for values.</p>\n"}], "owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 1, "accepted_answer_id": 52056002, "answer_count": 2, "score": 0, "last_activity_date": 1588118484, "creation_date": 1535449429, "last_edit_date": 1588118484, "question_id": 52054801, "link": "https://stackoverflow.com/questions/52054801/error-mysql-in-go", "title": "Error MySQL in Go", "body": "<p>This code is working:</p>\n\n<pre><code>stmt, err := db.Prepare(\"UPDATE `test` SET `score` = ? WHERE id = ?\")\nCheckErr(err)\n_, err = stmt.Exec(value, id)\n</code></pre>\n\n<p>But when I change my code, it doesn't work:</p>\n\n<pre><code>stmt, err := db.Prepare(\"UPDATE `test` SET ? = ? WHERE id = ?\")\nCheckErr(err)\n_, err = stmt.Exec(\"score\", value, id)\n</code></pre>\n\n<p>What's the problem?</p>\n"}, {"tags": ["sockets", "go", "telnet"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535464377, "post_id": 52054441, "comment_id": 91069396, "body": "you want something to interrupt the input other than the <code>enter</code> key?"}, {"owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535634564, "post_id": 52054441, "comment_id": 91146104, "body": "Exactly, i want to send something to telnet, that forces it to send me every char pressed not only enter interrupt. I tried this:  IAC WILL ECHO IAC WILL SUPPRESS_GO_AHEAD IAC WONT LINEMODE 255  251    1 255  251                 3 255  252       34  But it doesn&#39;t works, it doesn&#39;t send any char.  Maybe i sent it wrong because i send to telnet some bytes like [255, 251... etc]"}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 2, "last_activity_date": 1535730831, "creation_date": 1535730831, "answer_id": 52119034, "question_id": 52054441, "link": "https://stackoverflow.com/questions/52054441/golang-telnet-autocomplete-commands-with-tabs/52119034#52119034", "title": "Golang telnet autocomplete commands with tabs", "body": "<p>I think you need something like <code>termbox-go</code> <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">https://github.com/nsf/termbox-go</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    termbox \"github.com/nsf/termbox-go\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"os\"\n)\n\n/*\n   this is a simple cli program, this keeps polling the command line argument\n   until tab or Esc is pressed,\n   if TAB is pressed it does a google search of the word previous to that\n   and exists incase someone presses enter\n*/\nfunc main() {\n    termbox.Init()\n    defer termbox.Close()\n    var searchString string\n    for {\n        ev := termbox.PollEvent()\n        switch ev.Type {\n\n        case termbox.EventKey:\n            switch ev.Key {\n            case termbox.KeyTab:\n                meaning := getMeaningFromWeb(searchString)\n                fmt.Println(meaning)\n                searchString = \"\"\n                continue\n\n            case termbox.KeyEsc:\n                panic(1)\n            default:\n                searchString = searchString + string(ev.Ch)\n            }\n        case termbox.EventError:\n            os.Exit(1)\n        default:\n            continue\n        }\n    }\n\n}\n\nfunc getMeaningFromWeb(a string) string {\n\n    cl := &amp;http.Client{}\n    req, err := http.NewRequest(\"GET\", \"https://www.reddit.com/r/wallpaper/search.json?q=\"+a, nil)\n    req.Header.Set(\"User-Agent\", \"whitespace\")\n    req.Header.Set(\"Host\", \"reddit.com\")\n    resp, err := cl.Do(req)\n    defer resp.Body.Close()\n    response, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return fmt.Sprintf(\"%v\", response)\n    }\n    return fmt.Sprintf(\"%s\", string(response))\n}\n</code></pre>\n\n<p>this is an example of using this in commandline application, if you run this application, it will accept words(on press of tab) and quit(on pressing escape). this application searches a sub reddit for wallpaper. I am printing the response to terminal. Its not perfect, there is some config( I will update as soon as I can) that needs to be set for user input to appear. Plus there is no filter as of yet to use <code>backspace</code>. You won't see what you type and you can't use backspace, but the rest of functionality does as I described.</p>\n"}], "owner": {"reputation": 118, "user_id": 10133070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mNX6XKY4Cmk/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rlq-bCi8oI1hyUPD_XqB1StwOBWA/mo/photo.jpg?sz=128", "display_name": "Frnk Wdl", "link": "https://stackoverflow.com/users/10133070/frnk-wdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535730831, "creation_date": 1535448336, "question_id": 52054441, "link": "https://stackoverflow.com/questions/52054441/golang-telnet-autocomplete-commands-with-tabs", "title": "Golang telnet autocomplete commands with tabs", "body": "<p>How can i implement autocomplete commands with tab in telnet client (for example puTTy).</p>\n\n<p>I have socket server written in go:</p>\n\n<pre><code>server := tcp_server.New(\"localhost:9999\")\n...\nserver.Listen()\n</code></pre>\n\n<p>But telnet client puTTy send me char only when i press enter, so i can't check every character to find if it match \"\\t\" and do autocomplete commands.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4477, "user_id": 4673475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ff3c47715605701025a89d68849d6c?s=128&d=identicon&r=PG", "display_name": "kucing_terbang", "link": "https://stackoverflow.com/users/4673475/kucing-terbang"}, "edited": false, "score": 2, "creation_date": 1535441449, "post_id": 52052346, "comment_id": 91054924, "body": "one is a map with a string as a key and the value is a string array. And the second one, is an array of Value. umm.... maybe, could you explain more on what you want to ask?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1535441718, "post_id": 52052346, "comment_id": 91055085, "body": "These are different data structures. Mathematically: One is a tuple of pairs of strings and the other a function from string to a tuple of strings."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535442250, "post_id": 52052346, "comment_id": 91055368, "body": "map is unordered, slices are retains their orders of insertion."}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 4477, "user_id": 4673475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ff3c47715605701025a89d68849d6c?s=128&d=identicon&r=PG", "display_name": "kucing_terbang", "link": "https://stackoverflow.com/users/4673475/kucing-terbang"}, "edited": false, "score": 0, "creation_date": 1535444733, "post_id": 52052346, "comment_id": 91056732, "body": "thank you for replaying @kucing_terbang I update my question."}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535444742, "post_id": 52052346, "comment_id": 91056741, "body": "thank you for replaying @Volker I update my question."}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535444749, "post_id": 52052346, "comment_id": 91056747, "body": "thank you for replaying @mh-cbon I update my question."}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1535445003, "creation_date": 1535445003, "answer_id": 52053399, "question_id": 52052346, "link": "https://stackoverflow.com/questions/52052346/how-use-mapstringstring-or-custom-struct-with-go-golang/52053399#52053399", "title": "How use map[string]string or custom struct with Go/Golang?", "body": "<p>The maps are unordered, slices retains the order of insertion.</p>\n"}], "owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "closed_date": 1535530286, "answer_count": 1, "score": -2, "last_activity_date": 1535445003, "creation_date": 1535441310, "last_edit_date": 1535444917, "question_id": 52052346, "link": "https://stackoverflow.com/questions/52052346/how-use-mapstringstring-or-custom-struct-with-go-golang", "closed_reason": "Needs details or clarity", "title": "How use map[string]string or custom struct with Go/Golang?", "body": "<p>While reading some open source, I found the following code:</p>\n\n<pre><code>type Values map[string]string\n</code></pre>\n\n<p>But also:</p>\n\n<pre><code>type Value struct {\n    key string\n    value string\n}\ntype Values []Value\n</code></pre>\n\n<p>So, are those two different? Thanks!</p>\n"}, {"tags": ["mongodb", "go", "mgo", "mongodb-atlas"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1535441985, "post_id": 52052311, "comment_id": 91055224, "body": "<i>&quot;I am not getting an error not getting connected.&quot;</i> This is contradictory. If you can&#39;t connect, the <code>c.Insert()</code> operation would surely return an error. If you truly don&#39;t get any errors, then my guess is that you connect just fine, you insert just fine, but when you want to verify, you&#39;re looking in the wrong db/collection?"}, {"owner": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1535469790, "post_id": 52052311, "comment_id": 91072963, "body": "I could only see that the code started, then nothing.. My assumption is it is not getting connection itself. What i need to know is that if mgo supports new connection string"}], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "edited": false, "score": 2, "creation_date": 1535559091, "post_id": 52068597, "comment_id": 91114107, "body": "Thanks for your help. I tried it now I am getting a new error &quot; cannot unmarshal DNS message&quot;. I checked online and I found that this was a bug that was already fixed long back. Is there anything I am missing here. Thanks in advance"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "edited": false, "score": 0, "creation_date": 1535561825, "post_id": 52068597, "comment_id": 91115457, "body": "Which driver and which version are you using?"}, {"owner": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "edited": false, "score": 0, "creation_date": 1535910441, "post_id": 52068597, "comment_id": 91228809, "body": "I used Mongodb 3.4 or below type of string connection and it works. As you told the new string style connections are still in dev. Again thanks for your help."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "edited": false, "score": 0, "creation_date": 1535938582, "post_id": 52068597, "comment_id": 91234394, "body": "To clarify, the SRV string style is not in development however the <code>mongo-go-driver</code> version currently is."}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 4, "last_activity_date": 1555481562, "last_edit_date": 1555481562, "creation_date": 1535509396, "answer_id": 52068597, "question_id": 52052311, "link": "https://stackoverflow.com/questions/52052311/how-to-use-new-url-from-mongodb-3-6-to-connect-from-golang/52068597#52068597", "title": "How to use new URL from mongodb 3.6 to connect from golang", "body": "<blockquote>\n  <p>I could only see that the code started, then nothing</p>\n</blockquote>\n\n<p>As you have figured out, this is because <a href=\"https://godoc.org/github.com/globalsign/mgo#DialInfo\" rel=\"nofollow noreferrer\">DialInfo</a> by default has a zero timeout. The call will block forever waiting for a connection to be established. You can also specify a timeout with: </p>\n\n<pre><code>dialInfo.Timeout = time.Duration(30)\nsession, err := mgo.DialWithInfo(dialInfo)\n</code></pre>\n\n<blockquote>\n  <p>Now I am getting no reachable servers</p>\n</blockquote>\n\n<p>This is because <a href=\"https://godoc.org/github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">globalsign/mgo</a> does not currently support SRV <a href=\"https://docs.mongodb.com/manual/reference/connection-string/\" rel=\"nofollow noreferrer\">connection string URI</a> yet. See <a href=\"https://github.com/globalsign/mgo/issues/112\" rel=\"nofollow noreferrer\">issues 112</a>.\nYou can use the non-srv connection URI format (MongoDB v3.4), see a related question <a href=\"https://stackoverflow.com/questions/41173720/connecting-to-mongodb-atlas-using-golang-mgo-persistent-no-reachable-server-to\">StackOverflow: 41173720</a>.</p>\n\n<p>You can use <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo\" rel=\"nofollow noreferrer\">mongo-go-driver</a> instead if you would like to connect using the SRV connection URI, for example: </p>\n\n<pre><code>mongoURI := \"mongodb+srv://admin:password@prefix.mongodb.net/dbname?ssl=true&amp;retryWrites=true\"\n\nclient, err := mongo.NewClient(options.Client().ApplyURI(mongoURI))\nif err != nil {\n    log.Fatal(err)\n}\nctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)\ndefer cancel()\nerr = client.Connect(ctx)\ndefer client.Disconnect(ctx)\n\nif err != nil {\n    log.Fatal(err)\n}\ndatabase := client.Database(\"go\")\ncollection := database.Collection(\"atlas\")\n</code></pre>\n\n<p>The above example is compatible with the current version v1.0.0 </p>\n"}], "owner": {"reputation": 387, "user_id": 3483651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4696da86099066b2e0b8c480a9edcebc?s=128&d=identicon&r=PG&f=1", "display_name": "joss", "link": "https://stackoverflow.com/users/3483651/joss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4057, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1555481562, "creation_date": 1535441198, "last_edit_date": 1535491525, "question_id": 52052311, "link": "https://stackoverflow.com/questions/52052311/how-to-use-new-url-from-mongodb-3-6-to-connect-from-golang", "title": "How to use new URL from mongodb 3.6 to connect from golang", "body": "<p>I tried to connect to mongodb Atlas using golang drivers.</p>\n\n<pre><code>tlsConfig := &amp;tls.Config{}\n\nvar mongoURI = \"mongodb+srv://admin:password@prefix.mongodb.net:27017/dbname\"\ndialInfo, err := mgo.ParseURL(mongoURI)\nif err != nil {\n    panic(err)\n}\ndialInfo.DialServer = func(addr *mgo.ServerAddr) (net.Conn, error) {\n    conn, err := tls.Dial(\"tcp\", addr.String(), tlsConfig)\n    return conn, err\n}\n\nsession, err := mgo.DialWithInfo(dialInfo)\nif err != nil {\n    println(\"error\")\n    log.Fatal(err)\n}\n_ = session\nc := session.DB(\"Token\").C(\"_Users\")\nuser := &amp;User{firstName: \"username\"}\nerr = c.Insert(user)\nif err != nil {\n    println(\"error Again\")\n}\n</code></pre>\n\n<p>I am not getting an error not getting connected.\nI am wondering what could be the reason.'\nAny help is appreciated.</p>\n\n<p>I tried to create DialInfo using below code</p>\n\n<pre><code>    dialInfo := &amp;mgo.DialInfo{\n    Addrs:     []string{\"prefix.mongodb.net:27017\"},\n    Database:  \"dbname\",\n    Mechanism: \"SCRAM\",\n    Timeout:   10 * time.Second,\n    Username:  \"admin\",\n    Password:  \"passwrd\",\n}\n</code></pre>\n\n<p>Now I am getting no reachable servers</p>\n"}, {"tags": ["debugging", "go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 1, "last_activity_date": 1535454801, "creation_date": 1535454801, "answer_id": 52056490, "question_id": 52051593, "link": "https://stackoverflow.com/questions/52051593/goland-cannot-run-debug-on-macos/52056490#52056490", "title": "Goland cannot run debug on macos", "body": "<p>If you include the package \"plugin\" then this is a known issue, see <a href=\"https://golang.org/issues/23733\" rel=\"nofollow noreferrer\">https://golang.org/issues/23733</a></p>\n\n<p>Unfortunately, at the moment there is no known solution for this problem.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5934421, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CSR-xb09JD4/AAAAAAAAAAI/AAAAAAAABPk/faxnkIRZelQ/photo.jpg?sz=128", "display_name": "ekso ekson", "link": "https://stackoverflow.com/users/5934421/ekso-ekson"}, "is_accepted": false, "score": 0, "last_activity_date": 1557482898, "creation_date": 1557482898, "answer_id": 56075382, "question_id": 52051593, "link": "https://stackoverflow.com/questions/52051593/goland-cannot-run-debug-on-macos/56075382#56075382", "title": "Goland cannot run debug on macos", "body": "<p>Use delve for debug with <a href=\"https://github.com/go-delve/delve\" rel=\"nofollow noreferrer\">https://github.com/go-delve/delve</a>. It is recommends by developer:</p>\n\n<blockquote>\n  <p>Note that Delve is a better alternative to GDB when debugging Go\n  programs built with the standard toolchain.</p>\n</blockquote>\n\n<p>For instance it native supports command line, or you can use it with you IDE.  </p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 4425599, "user_type": "registered", "profile_image": "https://graph.facebook.com/677830949/picture?type=large", "display_name": "ChrisS", "link": "https://stackoverflow.com/users/4425599/chriss"}, "is_accepted": false, "score": 1, "last_activity_date": 1563565422, "creation_date": 1563565422, "answer_id": 57118832, "question_id": 52051593, "link": "https://stackoverflow.com/questions/52051593/goland-cannot-run-debug-on-macos/57118832#57118832", "title": "Goland cannot run debug on macos", "body": "<p>Good news!  GoLand has provided an update.  I had this problem with 2018.1 and went away with version 2019.1.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 15170458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db3789bd6c1937f5253ab38385e90f1?s=128&d=identicon&r=PG&f=1", "display_name": "Qzzpunch", "link": "https://stackoverflow.com/users/15170458/qzzpunch"}, "is_accepted": false, "score": 2, "last_activity_date": 1612802278, "creation_date": 1612802278, "answer_id": 66105648, "question_id": 52051593, "link": "https://stackoverflow.com/questions/52051593/goland-cannot-run-debug-on-macos/66105648#66105648", "title": "Goland cannot run debug on macos", "body": "<p>right now, u can update the go sdk to unstable version 1.16 to fix it~</p>\n"}], "owner": {"reputation": 11, "user_id": 10126021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84cf8d49185878c6dcd018ee81f1c38e?s=128&d=identicon&r=PG&f=1", "display_name": "zhaoX", "link": "https://stackoverflow.com/users/10126021/zhaox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1612802278, "creation_date": 1535438456, "last_edit_date": 1535439391, "question_id": 52051593, "link": "https://stackoverflow.com/questions/52051593/goland-cannot-run-debug-on-macos", "title": "Goland cannot run debug on macos", "body": "<p>I use Goland not enter debug mode. Cannot enter breakpoint mode. Can't see real-time parameter changes.</p>\n\n<pre><code>GOROOT=/usr/local/go #gosetup\nGOPATH=/Users/zhaoziqian/Documents/gopath #gosetup\n/usr/local/go/bin/go build -o \n/private/var/folders/4g/l31t9xvs1hz3slt5s90ggtr80000gn/T/___go_run_str_go -gcflags \"all=-N -l\" /Users/zhaoziqian/Documents/gopath/src/goweb/data/str1/str.go #gosetup\n/Applications/GoLand.app/Contents/plugins/go/lib/dlv/mac/dlv --listen=localhost:61746 --headless=true --api-version=2 --backend=default exec /private/var/folders/4g/l31t9xvs1hz3slt5s90ggtr80000gn/T/___go_run_str_go -- #gosetup\n\ncould not launch process: decoding dwarf section info at offset 0x0: too short\n\nDebugger finished with exit code 1\n</code></pre>\n\n<p>Help me,please!</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535431030, "post_id": 52050146, "comment_id": 91050674, "body": "A don&#39;t think the module name should contain the v17 (only the import statements do),"}, {"owner": {"reputation": 48078, "user_id": 279259, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f34f02bafe93e3a3784de74c4d8b7732?s=128&d=identicon&r=PG&f=1", "display_name": "ereOn", "link": "https://stackoverflow.com/users/279259/ereon"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535457514, "post_id": 52050146, "comment_id": 91064763, "body": "@Volker I am not sure about this: <a href=\"https://github.com/golang/go/wiki/Modules#how-to-define-a-module\" rel=\"nofollow noreferrer\">The go modules documentation</a> says: &quot;Update the go.mod file to include a /v2 at the end of the module path. Tag the release with v2.0.0.&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535458041, "post_id": 52050146, "comment_id": 91065141, "body": "You are right, seems I was wrong."}, {"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 0, "creation_date": 1564874629, "post_id": 52050146, "comment_id": 101173674, "body": "That error message is complaining about an import statement or <code>require</code> (or similar) missing the <code>&#47;v17</code> from the module name. See this <a href=\"https://stackoverflow.com/a/57342643/11210494\">answer</a> for a longer explanation, including more about where the <code>&#47;vN</code> is required for a v2+ module, as well as a pointer to a community tool that knows how to automatically update everything that needs to be updated if you are a consumer or author of a v2+ module."}], "answers": [{"comments": [{"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 1, "creation_date": 1544562784, "post_id": 52058348, "comment_id": 94318654, "body": "To add to the above answer, <a href=\"https://github.com/golang/go/wiki/Modules#releasing-modules-v2-or-higher\" rel=\"nofollow noreferrer\">this section</a> in the Go repo wiki hints at the solution too."}], "tags": [], "owner": {"reputation": 48078, "user_id": 279259, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f34f02bafe93e3a3784de74c4d8b7732?s=128&d=identicon&r=PG&f=1", "display_name": "ereOn", "link": "https://stackoverflow.com/users/279259/ereon"}, "is_accepted": false, "score": 12, "last_activity_date": 1575554395, "last_edit_date": 1575554395, "creation_date": 1535460505, "answer_id": 52058348, "question_id": 52050146, "link": "https://stackoverflow.com/questions/52050146/go-build-keeps-complaining-that-go-mod-has-post-v0-module-path/52058348#52058348", "title": "go build keeps complaining that: go.mod has post-v0 module path", "body": "<p>I had make two mistakes:</p>\n\n<ul>\n<li>My initial <code>v17.0.0</code> tag would point to a commit where <code>go.mod</code> did not contain the <code>v17</code> import path suffix. As a result, it seems Go tooling considers the whole v17 major version as a v0/v1 instead, <strong>even if later v17 tags point to a commit with a correct <code>go.mod</code> directive</strong>, hence the commit ID \"translation\".</li>\n<li>In my dependent projects, in the <code>go.mod</code> file, I mistakenly specified<br>\n<code>require my.host/root v17.0.1</code> instead of <br>\n<code>require my.host/root/v17 v17.0.1</code>.</li>\n</ul>\n\n<p>After fixing both those issues, everything seems back to normal and it works perfectly. I wish the documentation had been clearer about this but I guess this is a good opportunity to make a contribution!</p>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 2719085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQHZ5.jpg?s=128&g=1", "display_name": "djsd123", "link": "https://stackoverflow.com/users/2719085/djsd123"}, "is_accepted": false, "score": 6, "last_activity_date": 1550663484, "creation_date": 1550663484, "answer_id": 54785735, "question_id": 52050146, "link": "https://stackoverflow.com/questions/52050146/go-build-keeps-complaining-that-go-mod-has-post-v0-module-path/54785735#54785735", "title": "go build keeps complaining that: go.mod has post-v0 module path", "body": "<p>The error I got was: <code>github.com/emicklei/go-restful@v0.0.0-20180531035034-3658237ded10: go.mod has post-v0 module path \"github.com/emicklei/go-restful/v2\" at revision 3658237ded10</code></p>\n\n<p>Appending  <code>github.com/emicklei/go-restful</code> with <code>v2</code> like so: <code>github.com/emicklei/go-restful/v2</code> in my <code>go.mod</code> file fixed it for me.</p>\n"}], "owner": {"reputation": 48078, "user_id": 279259, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f34f02bafe93e3a3784de74c4d8b7732?s=128&d=identicon&r=PG&f=1", "display_name": "ereOn", "link": "https://stackoverflow.com/users/279259/ereon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6389, "favorite_count": 1, "answer_count": 2, "score": 13, "last_activity_date": 1575554395, "creation_date": 1535430852, "last_edit_date": 1535460327, "question_id": 52050146, "link": "https://stackoverflow.com/questions/52050146/go-build-keeps-complaining-that-go-mod-has-post-v0-module-path", "title": "go build keeps complaining that: go.mod has post-v0 module path", "body": "<p>Following the release of Go 1.11, I have been trying to move my repositories to Go modules, by adding a <code>go.mod</code> file at their root.</p>\n\n<p>One of my root libraries <code>my.host/root</code> is in its version 17.0.1, so I wrote in its <code>go.mod</code> file:</p>\n\n<pre><code>module my.host/root/v17\n</code></pre>\n\n<p>I tagged that version <code>v17.0.1</code> as documented in the Go modules manual.</p>\n\n<p>When I try to make a new Go project that uses my root library, like:</p>\n\n<pre><code>package main\n\nimport root \"my.host/root/v17\"\n\nfunc main() {\n    root.DoSomething()\n}\n</code></pre>\n\n<p>And try to compile it, I get the following error:</p>\n\n<blockquote>\n  <p>go: my.host/root@v0.0.0-20180828034419-6bc78016491a: go.mod has post-v0 module path \"my.host/root/v17\" at revision 6bc78016491a</p>\n</blockquote>\n\n<p>I am at loss figuring out why this happens. I explicitly added <code>v17.0.1</code> in the <code>go.mod</code> file, yet every attempt at <code>go build</code> replaces the entry with a <code>v0.0.0-20180828034419-6bc78016491a</code> version which then fails because at that commit, the <code>go.mod</code> file <code>module</code> entry of my root library indeed ends with a <code>v17</code>, as it should.</p>\n\n<p>For the record, this commit is the same as the tagged <code>v17.0.1</code> version.</p>\n\n<p>What am I doing wrong here? How can I debug this situation?</p>\n"}, {"tags": ["go", "swagger", "swagger-ui", "swagger-2.0", "go-swagger"], "owner": {"reputation": 263, "user_id": 3064140, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fdfd2f285ec16a4b740335d635adcfa6?s=128&d=identicon&r=PG&f=1", "display_name": "rbk", "link": "https://stackoverflow.com/users/3064140/rbk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1535429049, "creation_date": 1535429049, "question_id": 52049891, "link": "https://stackoverflow.com/questions/52049891/how-to-validate-all-properties-of-an-object-in-go-swagger", "title": "How to validate all properties of an object in go-swagger?", "body": "<p>I have a swagger.json which accepts a POST body as an object with some required properties with data types. </p>\n\n<p>I can see the <strong>ServeError()</strong> being invoked when either of the properties is missing or if one is a wrong data type. <em>It stops and gives the first validation which fails</em>.  </p>\n\n<p>Is there any way to validate <strong>ALL</strong> the properties, so when <strong>Serve\nError</strong> is invoked it has details about all the validations which failed? </p>\n\n<p>I'm hoping there's a flag I can put in the swagger.json, haven't been able to find it anywhere it. </p>\n\n<pre><code>\"postResp\": {\n  \"type\": \"object\",\n  \"required\": [ \"RecordId\", \"SomeString\"],\n  \"properties\": {\n\n      \"RecordId\": {\n        \"type\": \"integer\"\n      },\n     \"SomeString\": {\n        \"type\": \"string\"\n      }\n\n  }\n}\n</code></pre>\n"}, {"tags": ["go", "redis", "publish-subscribe", "sharding", "redis-cluster"], "answers": [{"comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1535450729, "post_id": 52054648, "comment_id": 91060530, "body": "So if I\u2019m listening to channel ABC123 on node1 of a 3 node system, and we increase the number of nodes to 17, channel ABC123 will still be on that same machine and the original TCP connection will not break from the event of new nodes being added?"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1535556858, "post_id": 52054648, "comment_id": 91112674, "body": "So if I have 1000 connected TCP subscribers to 1000 different channels, and we increase the number of nodes and slots dramatically, over and over, is there now a bunch of over-head of mapping these old subscribers vs. if we were to shut them all down, reboot with the final number of slots, and have them connect fresh?"}, {"owner": {"reputation": 39563, "user_id": 3160475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8989da0a2c491338617b07df53e60c?s=128&d=identicon&r=PG", "display_name": "Itamar Haber", "link": "https://stackoverflow.com/users/3160475/itamar-haber"}, "reply_to_user": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 4, "creation_date": 1535594744, "post_id": 52054648, "comment_id": 91126808, "body": "Theoretically it should work, but practically I&#39;d test it before believing anything someone writes on SO ;)"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1535648579, "post_id": 52054648, "comment_id": 91155128, "body": "Ok I see you are correct sir! Thank you very much. I finally found the exact line of c code in cluster.c with the comment: \u201cCLUSTER Pub/Sub support  *  * For now we do very little, just propagating PUBLISH messages across the whole  * cluster. In the future we&#39;ll try to get smarter and avoiding propagating those  * messages to hosts without receives for a given channel.\u201c"}, {"owner": {"reputation": 39563, "user_id": 3160475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8989da0a2c491338617b07df53e60c?s=128&d=identicon&r=PG", "display_name": "Itamar Haber", "link": "https://stackoverflow.com/users/3160475/itamar-haber"}, "reply_to_user": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1535663775, "post_id": 52054648, "comment_id": 91161946, "body": "Great - nothing beats deep-diving into the (open) source code :) Please let us know (preferably via the GitHub repo of the project) if you encounter any difficulties with this (so we can learn and prioritize future version accurately)."}], "tags": [], "owner": {"reputation": 39563, "user_id": 3160475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8989da0a2c491338617b07df53e60c?s=128&d=identicon&r=PG", "display_name": "Itamar Haber", "link": "https://stackoverflow.com/users/3160475/itamar-haber"}, "is_accepted": true, "score": 6, "last_activity_date": 1535628285, "last_edit_date": 1535628285, "creation_date": 1535448966, "answer_id": 52054648, "question_id": 52048598, "link": "https://stackoverflow.com/questions/52048598/is-there-a-golang-redis-client-that-auto-detects-new-shards-for-pubsub/52054648#52054648", "title": "Is there a golang redis client that auto detects new shards for pubsub?", "body": "<p>PubSub channels in the Redis cluster are shared among all nodes - messages are passed via the internal bus so you don't need a special client and/or logic.</p>\n\n<blockquote>\n  <p>In a Redis Cluster clients can subscribe to every node, and can also publish to every other node. The cluster will make sure that published messages are forwarded as needed.</p>\n</blockquote>\n\n<p>Source: <a href=\"https://redis.io/topics/cluster-spec\" rel=\"nofollow noreferrer\">Redis Cluster Specification</a></p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 1, "accepted_answer_id": 52054648, "answer_count": 1, "score": 5, "last_activity_date": 1535648770, "creation_date": 1535416870, "last_edit_date": 1535648770, "question_id": 52048598, "link": "https://stackoverflow.com/questions/52048598/is-there-a-golang-redis-client-that-auto-detects-new-shards-for-pubsub", "title": "Is there a golang redis client that auto detects new shards for pubsub?", "body": "<p>[UPDATE]: Current redis sends every published message to every node in entire cluster:</p>\n\n<pre><code>/* -----------------------------------------------------------------------------\n * CLUSTER Pub/Sub support\n *\n * For now we do very little, just propagating PUBLISH messages across the whole\n * cluster. In the future we'll try to get smarter and avoiding propagating those\n * messages to hosts without receives for a given channel.\n * -------------------------------------------------------------------------- */\nvoid clusterPropagatePublish(robj *channel, robj *message) {\n    clusterSendPublish(NULL, channel, message);\n}\n</code></pre>\n\n<p>This is original text of question, which is not correct:</p>\n\n<blockquote>\n  <p>As I understand it I need to:</p>\n  \n  <ol>\n  <li><p>Given a channel, find the the node that owns the hash slot.</p></li>\n  <li><p>Subscribe to that node and also to cluster:slots to detect migrations. </p></li>\n  <li><p>Upon slot migration, subscribe to the channel on the new node and keep the old connection open. </p></li>\n  <li><p>Forward messages to the application from the old connection until it closes and remember those messages. </p></li>\n  <li><p>When migration is complete and the old connection closed, forward messages from the new connection, trimming the remembered messages\n  from the first connection.</p></li>\n  </ol>\n  \n  <p>Do any of the golang redis client library do this? I\u2019ve looked through\n  many and it feels like I need to write this logic myself, constantly\n  polling <code>CLUSTER SLOTS</code> or listening to a pubsub of that info to know\n  when shards increase or decrease and move my existing pubsub\n  scriptions from one server to another.</p>\n  \n  <p>I.e. there lots of golang libs that handle normal GET key with cluster\n  even if the number of shards changes. But pubsub and cluster is a\n  whole other thing right?</p>\n</blockquote>\n"}, {"tags": ["go", "redis", "redis-cluster"], "comments": [{"owner": {"reputation": 36561, "user_id": 2395796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8786484468219bcf403bbdce5eb37c8d?s=128&d=identicon&r=PG", "display_name": "Kevin Christopher Henry", "link": "https://stackoverflow.com/users/2395796/kevin-christopher-henry"}, "edited": false, "score": 0, "creation_date": 1535427953, "post_id": 52048446, "comment_id": 91050021, "body": "You can reduce this to one round-trip per master by using EVAL to run a Lua script to do the same thing. Of course that will block the server while it&#39;s happening, but if it your data set is really so small then maybe that isn&#39;t a problem."}, {"owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "edited": false, "score": 0, "creation_date": 1535455107, "post_id": 52048446, "comment_id": 91063258, "body": "<code>SCAN</code> is the recommended way to do the job. Other options, e.g. <code>KEYS</code> will block Redis until all keys have been retrieved. Since you are using Redis Cluster, you might have many keys in Redis. If not use <code>SCAN</code>, you&#39;ll block Redis for a long time."}], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "edited": false, "score": 1, "creation_date": 1554470568, "post_id": 52051251, "comment_id": 97776180, "body": "Does <code>KEYS</code> retrieve all keys from cluster or just the node you&#39;re in right now?"}, {"owner": {"reputation": 610, "user_id": 3041388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvK4n.jpg?s=128&g=1", "display_name": "pfctgeorge", "link": "https://stackoverflow.com/users/3041388/pfctgeorge"}, "reply_to_user": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "edited": false, "score": 0, "creation_date": 1554647497, "post_id": 52051251, "comment_id": 97820239, "body": "@Asalle <code>KEYS</code> always return all keys. So it depends on what you communicate with."}, {"owner": {"reputation": 94, "user_id": 2485594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cf6b987fc56d8ce7f00fa557031a66?s=128&d=identicon&r=PG", "display_name": "lumos42", "link": "https://stackoverflow.com/users/2485594/lumos42"}, "reply_to_user": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "edited": false, "score": 1, "creation_date": 1587747539, "post_id": 52051251, "comment_id": 108640751, "body": "@Asalle - only a single node, that too randomly"}], "tags": [], "owner": {"reputation": 610, "user_id": 3041388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EvK4n.jpg?s=128&g=1", "display_name": "pfctgeorge", "link": "https://stackoverflow.com/users/3041388/pfctgeorge"}, "is_accepted": true, "score": 2, "last_activity_date": 1535436933, "creation_date": 1535436933, "answer_id": 52051251, "question_id": 52048446, "link": "https://stackoverflow.com/questions/52048446/reading-entire-data-from-redis-golang-client/52051251#52051251", "title": "Reading entire data from Redis / Golang client", "body": "<p>1) You can use KEYS command to get all the keys and then access every key. But that is not a recommended way in some cases since KEYS upon a big set of cache will cause long-blocking in Redis server. But if you just have a tiny cache, KEYS is simple and elegant command you can use.</p>\n\n<p>2) You can also push the relevant keys into a hash using HSET command. So you can use HGETALL to get those key-values at once. This way can help your cache to become good-looking.</p>\n"}], "owner": {"reputation": 365, "user_id": 3285672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e10f45ab0e03f14c15428b4c7b186726?s=128&d=identicon&r=PG&f=1", "display_name": "OCDev", "link": "https://stackoverflow.com/users/3285672/ocdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1698, "favorite_count": 1, "accepted_answer_id": 52051251, "answer_count": 1, "score": 2, "last_activity_date": 1535436933, "creation_date": 1535415241, "question_id": 52048446, "link": "https://stackoverflow.com/questions/52048446/reading-entire-data-from-redis-golang-client", "title": "Reading entire data from Redis / Golang client", "body": "<p>I have a Redis deployment acting as a caching layer. The cache is not very big and we would like to read all the items (key/values) at once from our Golang program. The only solution I found is to iterate through all master servers (it is a Redis cluster), execute a Scan to get all the keys and then iterate the keys to get the values.</p>\n\n<pre><code>err := cch.client.ForEachMaster(func(cl *redis.Client) error {\n    wg.Add(1)\n    defer wg.Done()\n    var cursor uint64\n    var n int\n    numFor := 0\n    for {\n\n        var keys []string\n        var err error\n        keys, cursor, err = cl.Scan(cursor, \"*\", 10).Result()\n        if err != nil {\n            panic(err)\n        }\n        n += len(keys)\n\n        for _, keyval := range keys {\n            var cont Content\n            if err := cch.items.Get(keyval, &amp;cont); err == nil {\n\n            } else {\n                log.Warnf(\"Error getting Key %s from cache: %s from master %s\", keyval, err)\n            }\n        }\n\n        if cursor == 0 {\n            break\n        }\n    }\n    return nil\n})\nwg.Wait()\n</code></pre>\n\n<p>Is there a better way to do this? Cannot believe I need so many roundtrips to Redis to get the values. Thanks!</p>\n"}, {"tags": ["session", "go", "swagger", "go-swagger"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1535421208, "post_id": 52048275, "comment_id": 91048783, "body": "Please share <code>HandleSessionHeaderKey</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "is_accepted": false, "score": 0, "last_activity_date": 1535466471, "creation_date": 1535466471, "answer_id": 52060311, "question_id": 52048275, "link": "https://stackoverflow.com/questions/52048275/go-swagger-not-calling-my-header-check/52060311#52060311", "title": "go-swagger not calling my header check", "body": "<p>So, I was being an idiot...</p>\n\n<p>The issue was that I forgot to add Security to my swagger yaml.  Once I did that then my function was getting called.</p>\n\n<pre><code>operationId: authLogoutUser\n        tags:\n          - auth\n        description:\n          Allow users to log out and their session will be terminated\n        produces:\n          - application/json\n        security:\n          - SessionKeyHeader: []\n</code></pre>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535466471, "creation_date": 1535413531, "question_id": 52048275, "link": "https://stackoverflow.com/questions/52048275/go-swagger-not-calling-my-header-check", "title": "go-swagger not calling my header check", "body": "<p>I have an api generated through go-swagger.   I am trying to put in a session check it is not firing as I expected.   I followed an <a href=\"https://github.com/go-swagger/go-swagger/tree/master/examples/authentication\" rel=\"nofollow noreferrer\">example</a> that I found in github but didn't seem to work for me.</p>\n\n<p>My code:</p>\n\n<pre><code>// Applies when the \"X-Session-Key\" header is set\n    api.SessionKeyHeaderAuth = func(token string) (interface{}, error) {\n    // test the token\n    success := routeHandler.HandleSessionHeaderKey(token)\n    if success{\n        return nil, nil\n    }\n    //We are pessimistic, if they aren't successful then we return a 401\n    api.Logger(\"Access attempt with incorrect api key auth: %s\", token)\n    return nil, errors.New(401, \"incorrect api key auth\")\n    }\n</code></pre>\n\n<p>My Yaml (for the endpoint that I am curling):</p>\n\n<pre><code>/auth/logout:\n  post:\n    summary: Logs in the user\n    consumes:\n      - application/x-www-form-urlencoded\n    operationId: authLogoutUser\n    tags:\n      - auth\n    description:\n      Allow users to log out and their session will be terminated\n    produces:\n      - application/json\n    parameters:\n      - in: header\n        name: X-Session-Key\n        type: string\n        required: true\n      - in: header\n        name: X-Profile-Key\n        type: string\n        required: true\n    responses:\n      200:\n       description: Login Success\n       headers:\n        ProfileKeyHeader:\n          type: string\n          description: The key for the profile data\n        SessionKeyHeader:\n          type: string\n          description: The key for the session data\n      400:\n       description: Whether the user is not found or error while login, decided on a generic login failure error\n       schema:\n        $ref: 'definitions.yaml#/definitions/Error'\n      429:\n       description: Too many requests and being throttled\n       schema:\n        $ref: 'definitions.yaml#/definitions/Error'\n      500:\n        description: Too many requests and being throttled\n        schema:\n          $ref: 'definitions.yaml#/definitions/Error'\n</code></pre>\n\n<p>Any help to see what I did incorrectly would be appreciated.</p>\n"}, {"tags": ["go", "rounding"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1535415852, "post_id": 52048218, "comment_id": 91047774, "body": "What would be a desired result for <code>3.4444444</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535439522, "post_id": 52048218, "comment_id": 91053831, "body": "3.4444444 rounded to a single decimal point is 3.4, not 3.5. Why do you want code that breaks math?  What does 3.644445 &quot;round&quot; to? 3.7?  3.6? 3.65?  If what you&#39;re doing makes sense, you need to describe it in proper detail, and don&#39;t call it &quot;rounding&quot;, since obviously that&#39;s not what it is."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535415744, "post_id": 52048478, "comment_id": 91047752, "body": "I think OP wants to round to the nearest half. (or may be not)"}, {"owner": {"reputation": 103, "user_id": 8774937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d1ee86f60a99fa9c130c93fa537647?s=128&d=identicon&r=PG", "display_name": "user8774937", "link": "https://stackoverflow.com/users/8774937/user8774937"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535415924, "post_id": 52048478, "comment_id": 91047790, "body": "@zerkms Yes. That&#39;s what the code does."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535415981, "post_id": 52048478, "comment_id": 91047806, "body": "Would it be <code>3.4444445 --&gt; 3.5</code> as OP posted? I&#39;m not sure I can run your code on play: <code>invalid operation: n * decimals (mismatched types float64 and uint32)</code>"}, {"owner": {"reputation": 487, "user_id": 1393323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xsi2I.jpg?s=128&g=1", "display_name": "stoffen", "link": "https://stackoverflow.com/users/1393323/stoffen"}, "edited": false, "score": 0, "creation_date": 1596614304, "post_id": 52048478, "comment_id": 111864451, "body": "There is a bug in the helper function. float64(decimals) should be math.Pow(10, float64(decimals))"}], "tags": [], "owner": {"reputation": 103, "user_id": 8774937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d1ee86f60a99fa9c130c93fa537647?s=128&d=identicon&r=PG", "display_name": "user8774937", "link": "https://stackoverflow.com/users/8774937/user8774937"}, "is_accepted": false, "score": 7, "last_activity_date": 1597237140, "last_edit_date": 1597237140, "creation_date": 1535415484, "answer_id": 52048478, "question_id": 52048218, "link": "https://stackoverflow.com/questions/52048218/round-all-decimal-points-in-golang/52048478#52048478", "title": "Round all decimal points in Golang", "body": "<p>Golang's math library provides a <code>Round</code> function. However, it rounds the float64 to an int, meaning decimals are lost.</p>\n<p>A quick workaround around this would be to multiple the number by the number of decimals you want to save, then round, then divide it back again:</p>\n<pre><code>raw := 4.335\nrounded := math.Round(raw * 10) / 10\n</code></pre>\n<p>Will give you the desired result.</p>\n<p>You may want to create a little helper function to round saving any number of digits:</p>\n<pre><code>func roundTo(n float64, decimals uint32) float64 {\n  return math.Round(n*math.Pow(10, float64(decimals))) / math.Pow(10, float64(decimals))\n}\n</code></pre>\n<p>Usage:</p>\n<pre><code>roundTo(4.2655, 1) // 4.3\nroundTo(4.3454, 3) // 4.345\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 3927791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dadbc868b72016c355feabd6b00a6631?s=128&d=identicon&r=PG&f=1", "display_name": "Roger", "link": "https://stackoverflow.com/users/3927791/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3653, "favorite_count": 0, "closed_date": 1535437722, "answer_count": 1, "score": 3, "last_activity_date": 1597237140, "creation_date": 1535413049, "last_edit_date": 1535413454, "question_id": 52048218, "link": "https://stackoverflow.com/questions/52048218/round-all-decimal-points-in-golang", "closed_reason": "Duplicate", "title": "Round all decimal points in Golang", "body": "<p>I'm trying to unconventionally round all the digits in a float64 variable. For example:</p>\n\n<p>3.4444445 --> 3.5</p>\n\n<p>I want to do this without converting it into a string!</p>\n"}, {"tags": ["git", "go", "vim", "git-commit"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1535479010, "post_id": 52050457, "comment_id": 91077932, "body": "The linked thread does not actually explain <i>why</i> this is needed (&quot;stdin is redirected to <code>&#47;dev&#47;null</code> by default&quot; is a statement of a fact, not an explanation). The real reason is that Vim is a so-called full-screen terminal application, and in order to work properly it performs an <code>isatty(3)</code> call at startup on its standard input stream to see whether it&#39;s input is connected to a terminal device\u2014a real TTY or a PTY (as opposed to being connected to a file stream etc)\u2026"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1535479107, "post_id": 52050457, "comment_id": 91077997, "body": "\u2026by assigining <code>os.Stdin</code> to <code>cmd.Stdin</code> you are actually making the spawned process to connect to the same terminal device your Go process is, so that that <code>isatty(3)</code> check passes OK in it, and it has full access to the device."}], "tags": [], "owner": {"reputation": 23592, "user_id": 30636, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4778273746a92044a5bd6b4a751749ae?s=128&d=identicon&r=PG", "display_name": "Setjmp", "link": "https://stackoverflow.com/users/30636/setjmp"}, "is_accepted": false, "score": 0, "last_activity_date": 1535432776, "creation_date": 1535432776, "answer_id": 52050457, "question_id": 52046871, "link": "https://stackoverflow.com/questions/52046871/vim-forgets-how-to-use-left-arrow-key-when-called-as-a-subprocesses-how-to-fix/52050457#52050457", "title": "Vim forgets how to use left arrow key when called as a subprocesses. How to fix?", "body": "<p>The solution was to set cmd.Stdin explictly:</p>\n\n<pre><code>cmd.Stderr = os.Stderr\ncmd.Stdout = os.Stdout\ncmd.Stdin  = os.Stdin\n</code></pre>\n\n<p>I had setup stderr and stdout, but didn't realize it was necessary to also setup stdin.  Some details explaining why this is the case are given <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/pJe7TVb-68w\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 23592, "user_id": 30636, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4778273746a92044a5bd6b4a751749ae?s=128&d=identicon&r=PG", "display_name": "Setjmp", "link": "https://stackoverflow.com/users/30636/setjmp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535432776, "creation_date": 1535403468, "last_edit_date": 1535431017, "question_id": 52046871, "link": "https://stackoverflow.com/questions/52046871/vim-forgets-how-to-use-left-arrow-key-when-called-as-a-subprocesses-how-to-fix", "title": "Vim forgets how to use left arrow key when called as a subprocesses. How to fix?", "body": "<p>I recently wrote some golang code that runs \"git commit\" as a subprocess.  Git in turns calls vim as a subprocess so that I can edit the commit message.  However, I find that when vim is executed in this manner the backspace key does not work as expected. After the commit, the terminal output is corrupted as if some component has lot track of the number of columns per line. This latter behavior is fixed with the reset command.</p>\n\n<p>A very interesting clue appears in the output:</p>\n\n<pre><code>Vim: Warning: Input is not from a terminal\n</code></pre>\n\n<p>So it appears that terminal information is not propagated to the subprocess.</p>\n\n<p>I don't have these issues when I use vim directly or when I run git commit directly on the command line.  Do you have any ideas on how I can troubleshoot and fix this problem?</p>\n\n<p>I am using vim 8.1 on Mac:</p>\n\n<pre><code>VIM - Vi IMproved 8.1 (2018 May 18, compiled Aug  9 2018 16:08:01)\nmacOS version\nIncluded patches: 1-235\nCompiled by Homebrew\nHuge version with MacVim GUI.  Features included (+) or not (-)...\n</code></pre>\n\n<p>My golang program does not modify the Cmd.Env variable of the exec.Cmd object.  When I run \"which vim\" in golang via exec.Command(\"which\", \"vim\") I am able to confirm the same location as on the command line.  However, I realize that git commit won't necessarily find the same location for vim.  </p>\n\n<p>My .gitconfig contains:</p>\n\n<pre><code>[core]\neditor = vim\n</code></pre>\n\n<p>but I see nothing else that looks obviously like it would alter the behavior of the editor.</p>\n"}, {"tags": ["go", "slice", "go-reflect"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1535394672, "post_id": 52044982, "comment_id": 91041057, "body": "<code>reflect.ValueOf(slice).Len()</code>"}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 5, "last_activity_date": 1535394676, "creation_date": 1535394676, "answer_id": 52045088, "question_id": 52044982, "link": "https://stackoverflow.com/questions/52044982/get-the-length-of-a-slice-of-unknown-type/52045088#52045088", "title": "Get the length of a slice of unknown type", "body": "<p>In your current attempt of the refect package usage you are querying for the <code>Len</code> of the <code>Type</code>. So this assumes you are dealing with an <strong>array</strong> not a <strong>slice</strong>. The difference being that a array is a fixed size slice, a slice has unbound length.</p>\n\n<p>Check this code for demonstration</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"reflect\"\n)\nfunc SomeKindOfSlice() interface{} {\n  return []int64{0,1,2,3,4,5,6,7,8,9}\n}\nfunc SomeKindOfArray() interface{} {\n  return [10]int64{0,1,2,3,4,5,6,7,8,9}\n}\nfunc main() {\n  log.Println(reflect.ValueOf(SomeKindOfSlice()).Len())\n  log.Println(reflect.ValueOf(SomeKindOfArray()).Type().Len())\n}\n</code></pre>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 802, "favorite_count": 0, "accepted_answer_id": 52045088, "answer_count": 1, "score": 1, "last_activity_date": 1535394676, "creation_date": 1535394222, "question_id": 52044982, "link": "https://stackoverflow.com/questions/52044982/get-the-length-of-a-slice-of-unknown-type", "title": "Get the length of a slice of unknown type", "body": "<p>Let's say I have a function that returns an <code>interface{}</code>.  But I know that item returns is a slice of some kind.  How can I determine the length of that slice?   Here's sample code of what I tried, but they all cause compilation error.</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"reflect\"\n)\nfunc SomeKindOfSlice() interface{} {\n  return []int64{0,1,2,3,4,5,6,7,8,9}\n}\nfunc main() {\n  slice := SomeKindOfSlice()\n  /*log.Println(reflect.TypeOf(slice).Len())\n  log.Println(reflect.TypeOf(slice).Type().Len())\n  log.Println(reflect.ValueOf(slice).Type().Len())\n  log.Println(reflect.ValueOf(slice).Elem().Type().Len())\n  */\n  log.Println(reflect.ValueOf(slice).Elem().Type().Len())\n}\n</code></pre>\n\n<p>I'd like to avoid the brute force way of specifically type asserting the <code>slice</code> variable just to find the length.</p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1535393851, "post_id": 52043187, "comment_id": 91040700, "body": "consider the GetString<i>s</i> method <a href=\"https://godoc.org/github.com/astaxie/beego#Controller.GetStrings\" rel=\"nofollow noreferrer\">godoc.org/github.com/astaxie/beego#Controller.GetStrings</a>. The second question relates to <a href=\"https://godoc.org/net/url#Values.Get\" rel=\"nofollow noreferrer\">godoc.org/net/url#Values.Get</a>. it does not look like there much of a difference between <code>this.GetString(&quot;foo&quot;)</code> and <code>this.Input().Get(&quot;foo&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1555, "user_id": 1759834, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b1875929629d1cedce0405e41e2fa4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael D.", "link": "https://stackoverflow.com/users/1759834/michael-d"}, "edited": false, "score": 0, "creation_date": 1535444790, "post_id": 52051382, "comment_id": 91056780, "body": "Thanks, that&#39;s what I was looking for."}], "tags": [], "owner": {"reputation": 46, "user_id": 6882114, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YxH-NmrJZdE/AAAAAAAAAAI/AAAAAAAAABI/aUiJgfFRDTw/photo.jpg?sz=128", "display_name": "Zeyit Ba\u015far", "link": "https://stackoverflow.com/users/6882114/zeyit-ba%c5%9far"}, "is_accepted": true, "score": 0, "last_activity_date": 1535437566, "creation_date": 1535437566, "answer_id": 52051382, "question_id": 52043187, "link": "https://stackoverflow.com/questions/52043187/how-to-retrieve-checked-values/52051382#52051382", "title": "How to retrieve checked values", "body": "<p>You can get array parameters like this</p>\n\n<p>bars := this.GetStrings(\"bar\") </p>\n\n<p><a href=\"https://beego.me/docs/mvc/controller/params.md\" rel=\"nofollow noreferrer\">beego params</a></p>\n"}], "owner": {"reputation": 1555, "user_id": 1759834, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b1875929629d1cedce0405e41e2fa4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael D.", "link": "https://stackoverflow.com/users/1759834/michael-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 52051382, "answer_count": 1, "score": 0, "last_activity_date": 1535437566, "creation_date": 1535386173, "last_edit_date": 1535393972, "question_id": 52043187, "link": "https://stackoverflow.com/questions/52043187/how-to-retrieve-checked-values", "title": "How to retrieve checked values", "body": "<p>With this given HTML code I was able to add a simple javascript function to verify that at least one checkbox is checked.</p>\n\n<p>Now it turns out that I only receive the value of the first checked checkbox, even when all three are checked.</p>\n\n<p><strong>HTML</strong>:</p>\n\n<pre><code>&lt;label class=\"foo\"&gt;\n       &lt;input type=\"checkbox\" name=\"bar[]\" value=\"W01\"&gt;\n       &lt;span class=\"label-body\"&gt;Apple&lt;/span&gt;\n&lt;/label&gt;\n&lt;label class=\"foo\"&gt;\n       &lt;input type=\"checkbox\" name=\"bar[]\" value=\"W02\"&gt;\n       &lt;span class=\"label-body\"&gt;Banana&lt;/span&gt;\n&lt;/label&gt;\n&lt;label class=\"foo\"&gt;\n       &lt;input type=\"checkbox\" name=\"bar[]\" value=\"W03\"&gt;\n       &lt;span class=\"label-body\"&gt;Melon&lt;/span&gt;\n&lt;/label&gt;\n</code></pre>\n\n<p><strong>Controller</strong>:</p>\n\n<pre><code>func (this *SendController) Post() {\n\n    beego.Info(this.GetString(\"bar[]\"))\n    // ...\n}\n</code></pre>\n\n<p>How can I get the list of all selected checkboxes, ie. W01 &amp; W03?</p>\n\n<p>Bonus question:\nWhat is the difference between <code>this.GetString(\"foo\")</code> and <code>this.Input().Get(\"foo\")</code> ?</p>\n"}, {"tags": ["rest", "go", "stream", "circuit-breaker"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1535382308, "post_id": 52042111, "comment_id": 91035007, "body": "Because your channel expects values of type <code>[]byte</code>, and the HTTP headers is of type <code>[][]string</code>. Find a way to serialize your headers to <code>[]byte</code>."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1535382338, "post_id": 52042111, "comment_id": 91035031, "body": "<code>output</code> is a <code>chan []byte</code> in your example, and a response&#39;s headers aren&#39;t stored in a <code>[]byte</code>, which is why you can&#39;t send it through your channel. Simply convert them to a <code>[]byte</code> format (by for example marshalling them into a JSON object) and you&#39;ll be able to send them."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1535382866, "post_id": 52042111, "comment_id": 91035381, "body": "Just for reference in your future searches, this isn&#39;t commonly referred to as streaming. Streaming typically refers to processing (reading or writing) a data stream, in Go typically represented as a <code>io.Reader</code>/<code>io.Writer</code>. Use of channels is just standard Go concurrency."}], "answers": [{"comments": [{"owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "edited": false, "score": 0, "creation_date": 1535469249, "post_id": 52044108, "comment_id": 91072607, "body": "Thank you @mh-cbon - your answer was very helpful and clear.   This is exactly what I needed.   I really appreciate it (and the extra assistance you provided)."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1535390252, "creation_date": 1535390252, "answer_id": 52044108, "question_id": 52042111, "link": "https://stackoverflow.com/questions/52042111/golang-channel-streams/52044108#52044108", "title": "Golang Channel Streams", "body": "<p>You are looking for the <a href=\"https://golang.org/pkg/net/http/httputil/#DumpResponse\" rel=\"nofollow noreferrer\">httputil.DumpResponse</a> function. </p>\n\n<p>The code might be changed to something similar to</p>\n\n<pre><code>func CallWithRetries(req *http.Request, output chan []byte) error {\n    r := retrier.New(retrier.ConstantBackoff(RETRIES, 100*time.Millisecond), nil)\n    attempt := 0\n    err := r.Run(func() error {\n        attempt++\n        resp, err := Client.Do(req)\n        if err == nil &amp;&amp; resp.StatusCode &lt; 299 {\n            dump, err := httputil.DumpResponse(resp, true)\n            if err == nil {\n                output &lt;- dump\n                return err\n            }\n            return err\n        } else if err == nil {\n            customLogger.LogDebug(\"Status code was: \", transactionId)\n            err = fmt.Errorf(\"Status was %v\", resp.StatusCode)\n        }\n        return err\n    })\n    return err\n}\n</code></pre>\n\n<p>Side notes, </p>\n\n<ul>\n<li><p>you might want to consider to close the response body as mentioned in the documentation <a href=\"https://golang.org/pkg/net/http/#Client.Get\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Client.Get</a></p></li>\n<li><p>Looks likes the <code>err</code> variable is shadowed, this should be modified to avoid any surprises.</p></li>\n</ul>\n\n<p>This version of the code attempts to return errors early, and to close the response body. It was not tested, only written on the fly, to use with care.</p>\n\n<pre><code>func CallWithRetries(req *http.Request, output chan []byte) error {\n    r := retrier.New(retrier.ConstantBackoff(RETRIES, 100*time.Millisecond), nil)\n    attempt := 0\n    return r.Run(func() error {\n        attempt++\n        var resp *http.Response\n        {\n            r, err := Client.Do(req)\n            if err != nil {\n                return err\n            }\n            defer r.Body.Close()\n            if resp.StatusCode &gt; 299 {\n                customLogger.LogDebug(\"Status code was: \", transactionId)\n                return fmt.Errorf(\"Status was %v\", resp.StatusCode)\n            }\n            resp = r\n        }\n        var out []byte\n        {\n            x, err := httputil.DumpResponse(resp, true)\n            if err != nil {\n                return err\n            }\n            out = x\n        }\n        output &lt;- out\n        return nil\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 52044108, "answer_count": 1, "score": 0, "last_activity_date": 1535390252, "creation_date": 1535382165, "question_id": 52042111, "link": "https://stackoverflow.com/questions/52042111/golang-channel-streams", "title": "Golang Channel Streams", "body": "<p>I am relatively new to Golang and don't fully understand streams.   I have a function (circuit breaker function) that is making Rest calls.  I have it working but it is only streaming the \"responseBody\" back.   I would actually like to stream back the entire request of stream back both the Body and the Header together.   </p>\n\n<p>When I try to use a similar approach on the \"header\" then I get an error that the header is not streamable.</p>\n\n<p>Is there a good/best way to accomplish this?   Thank you.   Below is my function.</p>\n\n<pre><code>func CallWithRetries(req *http.Request, output chan []byte) error {\n    r := retrier.New(retrier.ConstantBackoff(RETRIES, 100 * time.Millisecond), nil)\n    attempt := 0\n    err := r.Run(func() error {\n        attempt++\n        resp, err := Client.Do(req)\n        if err == nil &amp;&amp; resp.StatusCode &lt; 299 {\n            responseBody, err := ioutil.ReadAll(resp.Body)\n            if err == nil {\n                output &lt;- responseBody\n                return err\n            }\n            return err\n        } else if err == nil {\n            customLogger.LogDebug(\"Status code was: \" , transactionId)\n            err = fmt.Errorf(\"Status was %v\", resp.StatusCode)\n        }\n        return err\n    })\n    return err\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-sdk", "amazon-sqs"], "comments": [{"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 0, "creation_date": 1535381168, "post_id": 52041726, "comment_id": 91034316, "body": "Sorry, are you waiting for the same message that triggered the lambda to trigger the lambda again?"}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "reply_to_user": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 0, "creation_date": 1535382599, "post_id": 52041726, "comment_id": 91035204, "body": "Yes. I am assuming that if lambda fails to process a message, then that message should reappear for re-processing as I haven&#39;t yet deleted it. Is it how it supposed to work or not ?!"}, {"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 1, "creation_date": 1535382814, "post_id": 52041726, "comment_id": 91035343, "body": "But your lambda isn&#39;t failing at processing the message. If you want it to fail you can either call <code>panic</code> or return an error from your handler (<code>nil</code> means all went good)"}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "reply_to_user": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 0, "creation_date": 1535383871, "post_id": 52041726, "comment_id": 91035967, "body": "Oh I see, let me try that!"}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "reply_to_user": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 0, "creation_date": 1535384712, "post_id": 52041726, "comment_id": 91036404, "body": "You were right, thank you, 2 times"}], "answers": [{"comments": [{"owner": {"reputation": 323, "user_id": 9339002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4IoPN.jpg?s=128&g=1", "display_name": "Mohan Kurali", "link": "https://stackoverflow.com/users/9339002/mohan-kurali"}, "edited": false, "score": 0, "creation_date": 1594625245, "post_id": 52042968, "comment_id": 111179098, "body": "but won&#39;t this cause lambda function to retry again ?"}, {"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "reply_to_user": {"reputation": 323, "user_id": 9339002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4IoPN.jpg?s=128&g=1", "display_name": "Mohan Kurali", "link": "https://stackoverflow.com/users/9339002/mohan-kurali"}, "edited": false, "score": 0, "creation_date": 1594647513, "post_id": 52042968, "comment_id": 111189903, "body": "I think OP was just experimenting/learning with lambdas using SQS trigger otherwise it wouldn&#39;t be practical to write a function as such"}], "tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": true, "score": 1, "last_activity_date": 1535385282, "creation_date": 1535385282, "answer_id": 52042968, "question_id": 52041726, "link": "https://stackoverflow.com/questions/52041726/aws-sqs-lambda-messages-not-re-appearing/52042968#52042968", "title": "aws sqs lambda: messages not re-appearing", "body": "<p><strong>Making an answer out of the conversation with the OP</strong></p>\n\n<p><strong>Question</strong>: Op wants to check how SQS retries sending events to lambda when events fail. Op provides the code for a lambda function written in Go</p>\n\n<p><strong>Problem</strong>: Provided lambda does not fail so no retry behavior happens.</p>\n\n<p><strong>Solution</strong>: Rewrite lambda so it always fail.</p>\n\n<pre><code>    func handler(ctx context.Context, sqsEvent events.SQSEvent) error {\n\n    for _, message := range sqsEvent.Records {\n        fmt.Println(\"Id\", message.MessageId)\n        fmt.Println(\"Source\", message.EventSource)\n        fmt.Println(\"Body\", message.Body)\n    }\n\n    return error.New(\"Song by B.S.\")\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1465, "user_id": 2840591, "user_type": "registered", "accept_rate": 17, "profile_image": "https://graph.facebook.com/184603367/picture?type=large", "display_name": "Brian McCall", "link": "https://stackoverflow.com/users/2840591/brian-mccall"}, "is_accepted": false, "score": 1, "last_activity_date": 1535390307, "creation_date": 1535390307, "answer_id": 52044126, "question_id": 52041726, "link": "https://stackoverflow.com/questions/52041726/aws-sqs-lambda-messages-not-re-appearing/52044126#52044126", "title": "aws sqs lambda: messages not re-appearing", "body": "<p>By default if your lambda succeeds it will automatically delete the message from the queue. If you want to keep the message in the queue, you would have to explicitly fail the lambda using the callback and an error or context.fail  </p>\n"}], "owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1593, "favorite_count": 0, "accepted_answer_id": 52042968, "answer_count": 2, "score": 0, "last_activity_date": 1535390307, "creation_date": 1535380888, "question_id": 52041726, "link": "https://stackoverflow.com/questions/52041726/aws-sqs-lambda-messages-not-re-appearing", "title": "aws sqs lambda: messages not re-appearing", "body": "<p>I have followed standard aws lambda creation with sqs trigger.\nThen I sent message to sqs queue which then kicks lambda, which in turn writes to stdout. All good.</p>\n\n<p>The issue is: I have not yet deleted receipt of the message and I expect the message to appear again for processing after the visibility period of 60 seconds(default). This is not happening, wonder why.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc handler(ctx context.Context, sqsEvent events.SQSEvent) error {\n\n    for _, message := range sqsEvent.Records {\n        fmt.Println(\"Id\", message.MessageId)\n        fmt.Println(\"Source\", message.EventSource)\n        fmt.Println(\"Body\", message.Body)\n    }\n\n    return nil\n}\n\nfunc main() {\n    lambda.Start(handler)\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "google-cloud-platform", "google-compute-engine"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 1, "creation_date": 1535380437, "post_id": 52041440, "comment_id": 91033886, "body": "No need to give your external IP&#39;s here publicly. Secondly can you <code>ping</code> both instance locally with each other?"}, {"owner": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 0, "creation_date": 1535380585, "post_id": 52041440, "comment_id": 91033977, "body": "What about GCE firewall rules - PostgreSQL port 5432 must be opened at least for your go instance. Plus in postgresql.conf you have to set listening to &#39;*&#39; and allow access from IPs in pg_hba.conf."}, {"owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1535380783, "post_id": 52041440, "comment_id": 91034090, "body": "@HamzaAnis Yes I can ping both instances locally with the other"}, {"owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "reply_to_user": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 0, "creation_date": 1535381032, "post_id": 52041440, "comment_id": 91034231, "body": "@JosMac I made a Firewall rule like this: <a href=\"https://ibb.co/gvDgNp\" rel=\"nofollow noreferrer\">ibb.co/gvDgNp</a>"}, {"owner": {"reputation": 382, "user_id": 9814024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/906d87ad04e73aa06cd26846cd72dbe5?s=128&d=identicon&r=PG&f=1", "display_name": "arp-sunny.", "link": "https://stackoverflow.com/users/9814024/arp-sunny"}, "edited": false, "score": 0, "creation_date": 1535492148, "post_id": 52041440, "comment_id": 91083362, "body": "Could you redact your external IP and send me the output of nmap Internal_IP_ADDR of VM2 [from App -&gt; postgresql instance]. Based on the <a href=\"https://nmap.org/book/man-port-scanning-basics.html\" rel=\"nofollow noreferrer\">output of nmap</a> we can know whether the service is listening.    Could you add the complete error message (if applicable) and  pg_hba.conf to the question. This is an example where the user had a similar error message due to incorrect pg_hba.conf setting."}, {"owner": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 1, "creation_date": 1535547975, "post_id": 52041440, "comment_id": 91106283, "body": "@G.D firewall rule looks generally OK although not exactly safe - for production you definitely do not want to open all protocols and ports :-) - just tcp:5432 for PostgreSQL would be enough. Since you did not specify &quot;target tags&quot; it should work for all instances - for better safety you could specify target tag like &quot;postgresql&quot; and use it for instance with PostgreSQL as &quot;network tag&quot; in VM GCE gui. But any way does it work now?"}, {"owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "edited": false, "score": 0, "creation_date": 1535548341, "post_id": 52041440, "comment_id": 91106533, "body": "Yes it works, thanks a lot to you all :)"}], "owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 325, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1535440313, "creation_date": 1535379794, "last_edit_date": 1535440313, "question_id": 52041440, "link": "https://stackoverflow.com/questions/52041440/google-compute-engine-cant-connect-my-go-app-to-postgresql-base", "title": "Google Compute Engine can&#39;t connect my Go app to PostgreSQL base", "body": "<p>I work on an application written in Go which uses a PostgreSQL database. I am deploying that app on Google Cloud Platform, for which I chose the Compute Engine service.</p>\n\n<p>I created 2 instances: an instance for running the application and another for the database server. The OS of both instances is Ubuntu 18.04.</p>\n\n<p>When I test the application locally, everything works as expected. Specifically, there are no problems connecting the app with the database.</p>\n\n<p>When I try to run the app on Compute Engine, I get this error:</p>\n\n<pre><code>panic: dial tcp 10.132.0.4:5432: connect: connection refused\n    goroutine 1 [running]:\nmain.init.0()\n    /home/gauthier/gocode/sprint0/main.go:29 +0x113\nexit status 2\n</code></pre>\n\n<p>Here's some information about my VMs:</p>\n\n<p>-VM1(go)</p>\n\n<blockquote>\n  <p>Internal IP: 10.132.0.3<br>\n   External IP: 35.205.41.152</p>\n</blockquote>\n\n<p>-VM2(postgreSQL)</p>\n\n<blockquote>\n  <p>Internal IP: 10.132.0.4<br>\n   External IP: 35.241.174.119</p>\n</blockquote>\n\n<p>In my app, I connect to the database like this</p>\n\n<pre><code>var db *sql.DB\n\nfunc init() {\n    var err error\n    db, err =sql.Open(\"postgres\",\"postgres://postgres:postgres@10.132.0.4/quotes?sslmode=disable\")\n    if err != nil {\n        panic(err)\n    }\n\n    if err = db.Ping(); err != nil {\n        panic(err)\n    }\n    fmt.Println(\"You connected to your database\")\n}\n</code></pre>\n\n<p>I cannot find anything in the GCP documentation which fixes this issue.</p>\n"}, {"tags": ["loops", "go", "channel", "goroutine", "go-gorm"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535374473, "post_id": 52038739, "comment_id": 91030050, "body": "&quot;By default, sends and receives block until the other side is ready&quot;: <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/2</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "edited": false, "score": 0, "creation_date": 1535371495, "post_id": 52038820, "comment_id": 91028130, "body": "Thanks for the answer. Also can please tell me also that if this code can be further improved? Like using buffered channel?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "edited": false, "score": 1, "creation_date": 1535371562, "post_id": 52038820, "comment_id": 91028173, "body": "@MayukhSarkar Using buffered channels does not simplify the code. It&#39;s useful if producing or consuming values may take significant time, so if one participant is faster / slower than the other, they won&#39;t slow down each other as well."}, {"owner": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "edited": false, "score": 0, "creation_date": 1535371740, "post_id": 52038820, "comment_id": 91028285, "body": "Oh here producer is the database and consumer would be a csv writer so I don&#39;t think I need any buffed channel I guess. Can I improved the execution of the code in any other way?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1535376518, "last_edit_date": 1535376518, "creation_date": 1535371024, "answer_id": 52038820, "question_id": 52038739, "link": "https://stackoverflow.com/questions/52038739/why-my-go-coroutines-is-stuck-after-processing/52038820#52038820", "title": "Why my go coroutines is stuck after processing?", "body": "<p>Receiving from an unbuffered channel (such as yours) where no one is ready to send a value blocks. This is what you experience. <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">Spec: Receive operator:</a></p>\n\n<blockquote>\n  <p>The expression [<code>&lt;-c</code>] blocks until a value is available.</p>\n</blockquote>\n\n<p>The common way to signal \"EOF\" in case of channels is to close the channel from the sender's side when there are no more values to send, using the builtin <a href=\"https://golang.org/pkg/builtin/#close\" rel=\"nofollow noreferrer\"><code>close()</code></a> function.</p>\n\n<p>Attempting to receive from a closed channel can proceed immediately, yielding the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> of the element type of the channel. To detect this \"closed\" state, use the special comma-ok idiom:</p>\n\n<pre><code>value, ok := &lt;- c\n</code></pre>\n\n<p>If the channel is closed, <code>ok</code> will be <code>false</code> (otherwise it's <code>true</code>).</p>\n\n<p>The easy and proper way to \"drain\" a channel until it is closed is to use the <code>for range</code> loop, like this:</p>\n\n<pre><code>for value := range c {\n    fmt.Println(\"Received:\", value)\n}\n</code></pre>\n\n<p>The <code>for range</code> terminates once all values have been received from channel <code>c</code> that were sent on it before it was closed.</p>\n\n<p>So inside <code>generateRows()</code>, do this:</p>\n\n<pre><code>go func() {\n    // // Use defer so it will be closed no matter how this function call ends\n    defer close(c)\n    // ...\n}()\n</code></pre>\n\n<p>And your <code>main()</code>:</p>\n\n<pre><code>func main() {\n    c := generateRows(\"boring!!\")\n    for v := range c {\n        fmt.Println(v)\n    }\n    fmt.Println(\"Bye\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1593, "user_id": 4037927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1849962973/picture?type=large", "display_name": "Mayukh Sarkar", "link": "https://stackoverflow.com/users/4037927/mayukh-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 52038820, "answer_count": 1, "score": 1, "last_activity_date": 1535376518, "creation_date": 1535370776, "last_edit_date": 1535371484, "question_id": 52038739, "link": "https://stackoverflow.com/questions/52038739/why-my-go-coroutines-is-stuck-after-processing", "title": "Why my go coroutines is stuck after processing?", "body": "<p>I am new to Golang. I have been using GORM and concurrency of go to read a SQLite database and write it into a CSV file. It is working smooth but when the processing is done it is not ending the main program and exiting. I have to print <code>command+c</code> to exit. I don't know what I am doing wrong. May be it is entering into some blocking or deadlock mode or something. Moreover it is not printing a bye message too. Which means it is still trying to read the data from the channel. Please help. Here is the code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\ntype AirQuality struct {\n    // gorm.Model\n    // ID      uint   `gorm:\"column:id\"`\n    Index   string `gorm:\"column:index\"`\n    BEN     string `gorm:\"column:BEN\"`\n    CH4     string `gorm:\"column:CH4\"`\n    CO      string `gorm:\"column:CO\"`\n    EBE     string `gorm:\"column:EBE\"`\n    MXY     string `gorm:\"column:MXY\"`\n    NMHC    string `gorm:\"column:NMHC\"`\n    NO      string `gorm:\"column:NO\"`\n    NO2     string `gorm:\"column:NO_2\"`\n    NOX     string `gorm:\"column:NOx\"`\n    OXY     string `gorm:\"column:OXY\"`\n    O3      string `gorm:\"column:O_3\"`\n    PM10    string `gorm:\"column:PM10\"`\n    PM25    string `gorm:\"column:PM25\"`\n    PXY     string `gorm:\"column:PXY\"`\n    SO2     string `gorm:\"column:SO_2\"`\n    TCH     string `gorm:\"column:TCH\"`\n    TOL     string `gorm:\"column:TOL\"`\n    Time    string `gorm:\"column:date; type:timestamp\"`\n    Station string `gorm:\"column:station\"`\n}\n\nfunc (AirQuality) TableName() string {\n    return \"AQ\"\n}\n\nfunc main() {\n    c := generateRows(\"boring!!\")\n    for {\n        fmt.Println(&lt;-c)\n        if c == nil {\n            fmt.Println(\"Bye\")\n            break\n        }\n    }\n}\n\nfunc generateRows(msg string) &lt;-chan []string {\n    c := make(chan []string)\n    go func() {\n        db, err := gorm.Open(\"sqlite3\", \"./load_testing_7.6m.db\")\n        if err != nil {\n            panic(\"failed to connect database\")\n        }\n        defer db.Close()\n        rows, err := db.Model(&amp;AirQuality{}).Limit(20).Rows()\n        defer rows.Close()\n        if err != nil {\n            panic(err)\n        }\n        for rows.Next() {\n            var aq AirQuality\n            db.ScanRows(rows, &amp;aq)\n            v := reflect.Indirect(reflect.ValueOf(aq))\n            var buf []string\n            for i := 0; i &lt; v.NumField(); i++ {\n                buf = append(buf, v.Field(i).String())\n            }\n            c &lt;- buf\n        }\n    }()\n    return c\n}\n</code></pre>\n"}, {"tags": ["json", "ajax", "go", "go-gin"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535367667, "post_id": 52037791, "comment_id": 91025858, "body": "What exactly are you googling <i>for</i>?  A simple search for &quot;golang json&quot; should give you everything you need to know."}, {"owner": {"reputation": 569, "user_id": 3309645, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/ApXf7.jpg?s=128&g=1", "display_name": "charles.cc.hsu", "link": "https://stackoverflow.com/users/3309645/charles-cc-hsu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536486309, "post_id": 52037791, "comment_id": 91434787, "body": "@Flimzy I&#39;ve got my solution by goggle &quot;golang json&quot;, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535373850, "post_id": 52038712, "comment_id": 91029681, "body": "Struct fields must be exported though."}, {"owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535377234, "post_id": 52038712, "comment_id": 91031879, "body": "@Peter such as this? `   type Person struct {         FirstName  string <code>json:&quot;first_name&quot;</code>         LastName   string    <code>json:&quot;last_name&quot;</code>     }`"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535377599, "post_id": 52038712, "comment_id": 91032130, "body": "Yes, like this."}], "tags": [], "owner": {"reputation": 16730, "user_id": 101095, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9e5c6cdbcebd9b26a264a97465f713ce?s=128&d=identicon&r=PG", "display_name": "Cuga", "link": "https://stackoverflow.com/users/101095/cuga"}, "is_accepted": false, "score": -1, "last_activity_date": 1535378240, "last_edit_date": 1535378240, "creation_date": 1535370708, "answer_id": 52038712, "question_id": 52037791, "link": "https://stackoverflow.com/questions/52037791/how-to-get-the-json-data-sent-from-ajax-and-parsing-to-variable/52038712#52038712", "title": "How to get the JSON data sent from ajax and parsing to variable", "body": "<p>I'm not very familiar with Gin, but to accept <code>application/json</code> data, use <code>gin.Context.BindJSON</code> to bind the values in the request.</p>\n\n<pre><code>router.POST(\"/persons\", func(c *gin.Context) {\n  var jsonData Member\n  if c.BindJSON(&amp;jsonData) == nil {\n    fmt.Println(jsonData.first_name + \" \" + jsonData.last_name)\n  } else {\n    // handle error\n\n  }\n}\n</code></pre>\n\n<p>Updating with Peter's suggestion for exporting the fields:</p>\n\n<pre><code>type Person struct {\n    FirstName  string `json:\"first_name\"`\n    LastName   string    `json:\"last_name\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 569, "user_id": 3309645, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/ApXf7.jpg?s=128&g=1", "display_name": "charles.cc.hsu", "link": "https://stackoverflow.com/users/3309645/charles-cc-hsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1536485923, "creation_date": 1535367557, "last_edit_date": 1536485923, "question_id": 52037791, "link": "https://stackoverflow.com/questions/52037791/how-to-get-the-json-data-sent-from-ajax-and-parsing-to-variable", "title": "How to get the JSON data sent from ajax and parsing to variable", "body": "<p>I use jquery to send ajax json data for golang web restful service. And want to parse the json data in my backend using golang. Here is simple javascript code:</p>\n\n<pre><code>    $.ajax({\n        url: \"http://localhost:8080/persons\",\n        type: \"POST\",\n        dataType: \"json\",\n        data: {\n            \"data\": '{\"firstName\": \"Hello\",\"lastName\": \"World\"}' \n        },\n        success:function (res) {\n            console.log(res)\n        },\n        error: function (err){\n            console.log(err)\n        }\n    })\n</code></pre>\n\n<p>Then use GetRawData() to get the gin.Context information, and a json decoder to parse the json content,</p>\n\n<pre><code>data, _ := c.GetRawData()\njsonStream := string(data)\ndec := json.NewDecoder(strings.NewReader(jsonStream))\n\nt, err := dec.Token()\nif err != nil {\n    log.Fatal(err)\n}\n\nfor dec.More() {\n    var p Person\n    err := dec.Decode(&amp;p)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Hello %s\\n\", p.firstName)\n}\n</code></pre>\n\n<p>Done!</p>\n"}, {"tags": ["c", "go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 11421, "user_id": 7650, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/052338b3d753f00bb7724f2d2ca060a4?s=128&d=identicon&r=PG", "display_name": "lazy1", "link": "https://stackoverflow.com/users/7650/lazy1"}, "is_accepted": false, "score": 1, "last_activity_date": 1535363722, "creation_date": 1535363722, "answer_id": 52036799, "question_id": 52036061, "link": "https://stackoverflow.com/questions/52036061/export-a-variable-when-building-a-shared-object-using-cgo/52036799#52036799", "title": "Export a variable when building a shared object using cgo", "body": "<p>I don't think you can export variables, only functions.</p>\n\n<p>The <a href=\"https://golang.org/cmd/go/#hdr-Build_modes\" rel=\"nofollow noreferrer\">go build</a> documentation says:</p>\n\n<pre><code>-buildmode=c-shared\n    Build the listed main package, plus all packages it imports,\n    into a C shared library. The only callable symbols will\n    be those functions exported using a cgo //export comment.\n    Requires exactly one main package to be listed\n</code></pre>\n\n<p>Where the <a href=\"https://golang.org/cmd/cgo/#hdr-C_references_to_Go\" rel=\"nofollow noreferrer\">cgo docs says</a></p>\n\n<pre><code>Go functions can be exported for use by C code in the following way:\n</code></pre>\n\n<p>I guess you can write a function that returns the variable value.</p>\n"}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535396481, "creation_date": 1535361280, "last_edit_date": 1535396481, "question_id": 52036061, "link": "https://stackoverflow.com/questions/52036061/export-a-variable-when-building-a-shared-object-using-cgo", "title": "Export a variable when building a shared object using cgo", "body": "<p>I want to build a .so library using Go/Cgo with options <code>go build -buildmode=c-shared</code>.\nFunctions exports well, but I cannot export variables. I need to realize an API, which works by calling a void function, which sets up values of various global properties. Something like this:</p>\n\n<pre><code>var (\n    Gval1 int\n    Gval2 string\n    //GvalN\n)\n\nfunc f(){\n    Gval1 = 1\n    Gval2 = \"qwerty\"\n}\n</code></pre>\n\n<p>The client of .so lib will run f(); and after that, it can get variables by addressing their names. How can I export them?\nI had tried to do a trick like this: <a href=\"https://stackoverflow.com/questions/36212246/golang-cgo-cant-export-variables-by-build-mode-c-shared\">golang cgo can&#39;t export variables by build mode c-shared</a>, but there was no success (example returns always 0, not 42).\nHow can I export variables (numbers and strings)?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 27, "last_activity_date": 1535359322, "last_edit_date": 1535359322, "creation_date": 1535358988, "answer_id": 52035455, "question_id": 52035390, "link": "https://stackoverflow.com/questions/52035390/why-using-chan-struct-when-wait-something-done-not-chan-interface/52035455#52035455", "title": "Why using `chan struct{}` when wait something done not `chan interface{}`?", "body": "<p>In your example of a 'done' channel, functionally speaking, the channel can be of literally any type, since no data is actually sent, and the channel is just used as a signaling mechanism. But in the interest of memory utilization, <code>struct{}</code> is the smallest data type available in Go, since it contains literally nothing, so no allocation necessary, which is why it's typically used in such scenarios.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535361284, "post_id": 52035899, "comment_id": 91022145, "body": "I&#39;m confused by your last paragraph. In what sense is <code>struct{}</code> wrong for an unbuffered done channel? And how is <code>chan bool</code> more sensible? <code>chan bool</code> implies that you&#39;ll be sending true or false values over the channel, which is not true, so it seems &quot;wrong&quot; to me. But I&#39;m curious to know your reasoning."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535365407, "post_id": 52035899, "comment_id": 91024564, "body": "@Flimzy Done channels in the stdlib are chan bool and even if you never send false or not even send anything but just close the channel it just is more natural to use a chan bool. E.g. the chan struct{} also does not convey that you never intend to send anything. And strcut {} is more to type and more to read and especially a rare language construct with special semantics as a all instances of struct{} may share the same memory location. Less common, more complicated, more characters, less clear ==&gt; wrong."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535365629, "post_id": 52035899, "comment_id": 91024690, "body": "&quot;Done channels in the stdlib are chan bool&quot; -- this is not a universally true statement. There are many examples of <code>chan struct{}</code> for done channels in the stdlib.  But thank you for your explanation."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1535360651, "creation_date": 1535360651, "answer_id": 52035899, "question_id": 52035390, "link": "https://stackoverflow.com/questions/52035390/why-using-chan-struct-when-wait-something-done-not-chan-interface/52035899#52035899", "title": "Why using `chan struct{}` when wait something done not `chan interface{}`?", "body": "<p>The empty struct <code>struct {}</code> requires no memory. So if you have a channel with a large capacity you can save a few bytes by switching from <code>make(chan bool, 1&lt;&lt;16)</code> to <code>make(struct {}, 1&lt;&lt;16)</code>. Using interface {} requires more space and is really strange here.</p>\n\n<p>For an unbuffered done channel I think using struct {} is <em>wrong</em> as it is unclear. Using a simple <code>chan bool</code> is much more sensible. Using interface {} is completely wrong: It probably uses more space and is even less clear than struct {}.</p>\n"}], "owner": {"reputation": 373, "user_id": 872954, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f1ad4800358292dd53cd5cfc4f54d378?s=128&d=identicon&r=PG", "display_name": "peerxu", "link": "https://stackoverflow.com/users/872954/peerxu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6618, "favorite_count": 1, "answer_count": 2, "score": 14, "last_activity_date": 1574831395, "creation_date": 1535358658, "last_edit_date": 1574831395, "question_id": 52035390, "link": "https://stackoverflow.com/questions/52035390/why-using-chan-struct-when-wait-something-done-not-chan-interface", "title": "Why using `chan struct{}` when wait something done not `chan interface{}`?", "body": "<p>In golang, when we need to wait for something to finish, we will use a channel.</p>\n\n<p>example:</p>\n\n<pre><code>done := make(chan struct{})\ngo func() {\n    // ...\n    close(done)\n}()\n&lt;-done\n</code></pre>\n\n<p>But, in other way, <code>chan interface{}</code> also works in this case.</p>\n\n<p>So, what's the difference between <code>chan struct{}</code> and <code>chan interface{}</code>?</p>\n\n<p>Example2:</p>\n\n<pre><code>done := make(chan struct{})\ngo func() {\n    // ...\n    done &lt;- struct{}{}\n}()\n&lt;- done\n</code></pre>\n\n<p>In other case, if don't close channel in goroutine instead of send object to it.</p>\n\n<p>There will create an object in goroutine, but if using <code>chan interface{}</code>, can be send <code>nil</code> object to channel.</p>\n\n<p>Is it better to use <code>chan struct{}</code>?</p>\n"}, {"tags": ["go", "struct", "initialization", "default-value", "go-map"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1535360773, "post_id": 52035112, "comment_id": 91021859, "body": "<a href=\"https://tour.golang.org/moretypes/22\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/22</a>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535362676, "post_id": 52035112, "comment_id": 91022996, "body": "This is covered in the language spec too: every type has a <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a>, and for an [index expression] <code>mapping[key]</code> the value is the zero value of the type."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 9, "last_activity_date": 1535358229, "last_edit_date": 1535358229, "creation_date": 1535357655, "answer_id": 52035163, "question_id": 52035112, "link": "https://stackoverflow.com/questions/52035112/what-is-the-default-value-of-a-map-of-struct/52035163#52035163", "title": "What is the default value of a map of struct", "body": "<p>Default value of a struct is zero value for each field which is different on basis of its type.</p>\n\n<blockquote>\n  <p>When storage is allocated for a variable, either through a\n  declaration or a call of new, or when a new value is created, either\n  through a composite literal or a call of make, and no explicit\n  initialization is provided, the variable or value is given a default\n  value. Each element of such a variable or value is set to the zero\n  value for its type: false for booleans, 0 for numeric types, \"\" for\n  strings, and nil for pointers, functions, interfaces, slices,\n  channels, and maps. This initialization is done recursively, so for\n  instance each element of an array of structs will have its fields\n  zeroed if no value is specified.</p>\n</blockquote>\n\n<pre><code>type T struct { i int; f float64; next *T }\nt := new(T)\n</code></pre>\n\n<p>the following holds: </p>\n\n<pre><code>t.i == 0\nt.f == 0.0\nt.next == nil\n</code></pre>\n\n<p>But for checking the value of a map based on the key if it exists you can use it as:</p>\n\n<pre><code>i, ok := m[\"route\"]\n</code></pre>\n\n<p>In this statement, the first value (i) is assigned the value stored under the key \"route\". If that key doesn't exist, i is the value type's zero value (0). The second value (ok) is a bool that is true if the key exists in the map, and false if not.</p>\n\n<p>For your question</p>\n\n<blockquote>\n  <p>Should I check against nil or someStruct{} ?</p>\n</blockquote>\n\n<p>To check for initialized empty struct you can check for <code>someStruct{}</code> as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype someStruct struct { \n    field1 int\n    field2 string\n}\nvar mapping map[int]someStruct\n\nfunc main() {\n    var some someStruct\n    fmt.Println(some == (someStruct{}))\n    //mapping := make(map[int]someStruct)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8XuBLB245xu\" rel=\"noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 387, "user_id": 7827687, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-rxdhHmEIL7Q/AAAAAAAAAAI/AAAAAAAABxU/R6XRHvLaoJI/photo.jpg?sz=128", "display_name": "tbraden", "link": "https://stackoverflow.com/users/7827687/tbraden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8829, "favorite_count": 0, "accepted_answer_id": 52035163, "answer_count": 1, "score": 5, "last_activity_date": 1535358229, "creation_date": 1535357399, "last_edit_date": 1535357974, "question_id": 52035112, "link": "https://stackoverflow.com/questions/52035112/what-is-the-default-value-of-a-map-of-struct", "title": "What is the default value of a map of struct", "body": "<p>What is the default value of struct in a map? How to check the map value is initialized?</p>\n\n<pre><code>type someStruct struct { \n    field1 int\n    field2 string\n}\nvar mapping map[int]someStruct\n\nfunc main() {\n    mapping := make(map[int]someStruct)\n}\n\nfunc check(key int) {\n    if mapping[key] == ? {}\n}\n</code></pre>\n\n<p>Should I check against <code>nil</code> or <code>someStruct{}</code>?</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "edited": false, "score": 1, "creation_date": 1535361278, "post_id": 52034195, "comment_id": 91022142, "body": "First the last line in bigfile.txt should be {{template &quot;base_post&quot;}}, second: did you load the template files base_pre.txt and base_post.txt?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535361369, "post_id": 52034195, "comment_id": 91022201, "body": "<a href=\"https://golang.org/pkg/html/template/#Template.ParseFiles\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template/#Template.ParseFiles</a>"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "edited": false, "score": 0, "creation_date": 1535364680, "post_id": 52034195, "comment_id": 91024196, "body": "@VincenzoMaggio - sorry i&#39;ve fixed the typo, it&#39;s <code>template</code> as you mention (same error exist... how should I load them ? i&#39;ve a place <code>template.New(&quot;bigfile.txt&quot;)</code> to load only one template ..."}, {"owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "edited": false, "score": 0, "creation_date": 1535364965, "post_id": 52034195, "comment_id": 91024306, "body": "Sorry no time to answer right now, please refer to <a href=\"https://hackernoon.com/golang-template-2-template-composition-and-how-to-organize-template-files-4cb40bcdf8f6\" rel=\"nofollow noreferrer\">hackernoon.com/&hellip;</a> to have some info"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1535366752, "post_id": 52034195, "comment_id": 91025329, "body": "See an example of this here: <a href=\"https://stackoverflow.com/questions/44979276/the-go-template-parsefiles-func-parsing-multiple-files/44979550#44979550\">The Go Template ParseFiles func parsing multiple files</a>."}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1535364576, "creation_date": 1535353615, "last_edit_date": 1535364576, "question_id": 52034195, "link": "https://stackoverflow.com/questions/52034195/divide-template-to-files-error", "title": "Divide template to files error", "body": "<p>I\u2019ve created a template which works as expected, now when the template is become bigger I want to\nDivide it to several files, what I did is the following for example</p>\n\n<p><strong>bigfile.txt :)</strong> </p>\n\n<pre><code>echo \u201cI\u2019m pre process\u201d\n\necho \u201cprocess\u201d\n\necho \u201cI\u2019m post process\u201d\n\n\n\n\nt := template.Must(template.New(\"bigfile.txt\").Parse(bigfile.txt))\n</code></pre>\n\n<p>\u2026</p>\n\n<p>Now this is <strong>working</strong> without any problem.</p>\n\n<p>What I did now is divide the big file to 3 files</p>\n\n<pre><code>**base_pre.txt**\n</code></pre>\n\n<p>And here is the code inside </p>\n\n<pre><code>{{define \"base_pre\u201d}}\n\necho \u201cI\u2019m pre process\u201d\n\n{{end}}\n</code></pre>\n\n<p><strong>base_pre.txt</strong></p>\n\n<p>And here is the code inside </p>\n\n<pre><code>{{define \"base_post\u201d}}\n\necho \u201cI\u2019m post process\u201d\n\n{{end}}\n</code></pre>\n\n<p>And in the<code>bigfile.txt</code>I\u2019ve changed the </p>\n\n<pre><code>{{template \"base_pre\"}}\n\necho process\n\n{{template \"base_post\u201d}}\n</code></pre>\n\n<p>When I run it I got error </p>\n\n<p><strong>ERROR</strong> template: bigfile.txt:1:11: executing \u201cbigfile.txt\" at &lt;{{template \"base_pre...>: template \"base_pre\" not defined</p>\n"}, {"tags": ["postgresql", "go", "single-page-application"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1535352849, "post_id": 52033926, "comment_id": 91017873, "body": "Use insert with the returning clause. <code>INSERT INTO rules_table (rule) VALUES (&lt;ruleBytes&gt;) RETURNING id;</code>, execute this query with Go&#39;s QueryRow and then call Scan on the resulting row to get the id."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353060, "post_id": 52033926, "comment_id": 91017969, "body": "if I use the on returning clause, that means after inserting the data, I quickly have to update it to put the generated id into the JSON"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353136, "post_id": 52033926, "comment_id": 91018000, "body": "Why would you need it in the json column if it is already in its own column, why duplicate the data?"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353250, "post_id": 52033926, "comment_id": 91018047, "body": "id need to be sent back to SPA user to enable delete and edit for specific <code>rule</code>. I put it inside the Rule model. Or are you suggesting that the model should not contain the id field?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353310, "post_id": 52033926, "comment_id": 91018077, "body": "The model, yes. The json going out to the client, yes. The json column in the db, no."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353332, "post_id": 52033926, "comment_id": 91018090, "body": "if we look at the response to user, a rule object contains its id. In golang the struct contains the id. Yes duplication happens, any alternative?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353409, "post_id": 52033926, "comment_id": 91018139, "body": "I&#39;m not talking about the duplication of the rule&#39;s representation across the languages. I&#39;m talking about the duplication of data in the database."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353537, "post_id": 52033926, "comment_id": 91018196, "body": "oh so I really have to create another struct without the id field, this struct is meant to be json marshalled then inserted to db? or should I just marshal my existing struct with the id field even though the value in that field is not the same as that generated by the db?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535353866, "post_id": 52033926, "comment_id": 91018354, "body": "Something like this is what I had in mind: <a href=\"https://play.golang.org/p/rtenP2c_xph\" rel=\"nofollow noreferrer\">play.golang.org/p/rtenP2c_xph</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535354204, "post_id": 52033926, "comment_id": 91018520, "body": "If, however, you still want the id to be also in the json column, then you can use a <a href=\"https://www.postgresql.org/docs/current/static/queries-with.html\" rel=\"nofollow noreferrer\"><code>CTE</code></a> to get the serial&#39;s next value and then concatenate it with the json in the insert."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535354233, "post_id": 52033926, "comment_id": 91018542, "body": "okay, I got it. I was just thinking too much before that my rule json inside the db has an id field which is not the same as the one generated by the db. I think assigning the id field from the db table to the unmarshalled rule is better"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1535404509, "last_edit_date": 1535404509, "creation_date": 1535384550, "answer_id": 52042766, "question_id": 52033926, "link": "https://stackoverflow.com/questions/52033926/how-to-prevent-duplicate-id-in-creating-objects-from-spa-or-should-i-stay-with/52042766#52042766", "title": "How to prevent duplicate id in creating objects from SPA? Or should I stay with the db?", "body": "<p>Let the database generate the new id since that's exactly <a href=\"https://www.postgresql.org/docs/10/static/datatype-numeric.html#DATATYPE-SERIAL\" rel=\"nofollow noreferrer\"><code>SERIAL</code> types are for in PostgreSQL</a>.</p>\n\n<p>In golang, you can insert a new record and retrieve the generated id by using <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow noreferrer\"><code>sql.DB.QueryRow(...)</code></a> and <code>.Scan()</code> using an <a href=\"https://www.postgresql.org/docs/9.5/static/sql-insert.html\" rel=\"nofollow noreferrer\">insert statement with a <code>RETURNING</code> clause</a>, e.g.:</p>\n\n<pre><code>var newId int\nquery := \"INSERT INTO rules (rule) VALUES ($1) RETURNING id\"\nerr := db.QueryRow(query, newRule).Scan(&amp;newId)\n// TODO: check err\nlog.Printf(\"newId=%d\", newId)\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1535404509, "creation_date": 1535352652, "last_edit_date": 1535352930, "question_id": 52033926, "link": "https://stackoverflow.com/questions/52033926/how-to-prevent-duplicate-id-in-creating-objects-from-spa-or-should-i-stay-with", "title": "How to prevent duplicate id in creating objects from SPA? Or should I stay with the db?", "body": "<p>I have a react app that fetches data from golang api which queries data from postgres database. One of my models is deeply nested JSON so I used JSONB datatype in postgres.</p>\n\n<pre><code>CREATE table rules (\n    id serial primary key,\n    rule jsonb\n);\n</code></pre>\n\n<p>In golang, I have the structure</p>\n\n<pre><code>type Rule struct {\n    ID int `json:\"id\"`\n    Name string `json:\"name\"`\n    ...succeeding fields are deeply nested data\n}\n</code></pre>\n\n<p>And in the SPA I have the model</p>\n\n<pre><code>interface Rule {\n    id number\n    name string\n    ....same as from the golang api model\n}\n</code></pre>\n\n<p>To create a new <code>Rule</code> object in the SPA, I assign <code>0</code> to <code>id</code>. The newly created rule is sent to golang rest api. Then in the api, I first ask the postgres database for the next value for the serial id (using POSTGRES <code>nextval</code>), assign that acquired id into the Rule struct ID field,</p>\n\n<pre><code>nextValidId := &lt;result of nextval&gt;\nrule.ID = nextValidId\n</code></pre>\n\n<p>JSON marshal the rule object then insert to db</p>\n\n<pre><code>ruleBytes, _ := json.Marshal(rule)\nINSERT INTO rules_table VALUES (&lt;nextValidId&gt;, &lt;ruleBytes&gt;);\n</code></pre>\n\n<p>This way I avoided duplicate ids which may happen if an SPA is handling the Id generation. However, I find my method somewhat complicated already. I know I can generate ids from SPA too but how do I avoid duplicated ids without using the method I used above? or am I overthinking things? </p>\n\n<p>Update1:\nI also thought about adding another Rule struct in golang without the <code>ID</code> field so that I don't have to use <code>nextval</code> just to put the id inside the JSON, but is it a good programming design to have multiple models for inserting and retrieving from db and another model for response to the SPA?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 433, "user_id": 6763932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8519ce28a7a59b933ffd5d23aa9db90a?s=128&d=identicon&r=PG&f=1", "display_name": "Luca Brasi", "link": "https://stackoverflow.com/users/6763932/luca-brasi"}, "is_accepted": false, "score": 0, "last_activity_date": 1535346454, "creation_date": 1535346454, "answer_id": 52032843, "question_id": 52032383, "link": "https://stackoverflow.com/questions/52032383/parse-io-readall-to-match-specific-expression/52032843#52032843", "title": "Parse io.ReadAll to match specific expression", "body": "<p>I've used below code, if someone has a better solution let me know:</p>\n\n<pre><code>RegexpMeanTime := regexp.MustCompile(`Mean target scan duration: (.*)`)\nRegexpMeanTimeMatch := RegexpMeanTime.FindStringSubmatch(string(b))\nfmt.Printf(\"Mean Scan Duration per device: %v\\n\", RegexpMeanTimeMatch[1])\n\nRegexpStartTime := regexp.MustCompile(`Scan start time: (.*)`)\nRegexpStartTimeMatch := RegexpStartTime.FindStringSubmatch(string(b))\nfmt.Printf(\"Scan Job Start Time: %v\\n\", RegexpStartTimeMatch[1])\n\nRegexpEndTime := regexp.MustCompile(`Scan end time: (.*)`)\nRegexpEndTimeMatch := RegexpEndTime.FindStringSubmatch(string(b))\nfmt.Printf(\"Scan Job End Time: %v\\n\", RegexpEndTimeMatch[1])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 433, "user_id": 6763932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8519ce28a7a59b933ffd5d23aa9db90a?s=128&d=identicon&r=PG&f=1", "display_name": "Luca Brasi", "link": "https://stackoverflow.com/users/6763932/luca-brasi"}, "edited": false, "score": 0, "creation_date": 1535415694, "post_id": 52044547, "comment_id": 91047743, "body": "Thanks @mh-cbon. I&#39;ll also test with the bufio.Scanner api."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1535392122, "creation_date": 1535392122, "answer_id": 52044547, "question_id": 52032383, "link": "https://stackoverflow.com/questions/52032383/parse-io-readall-to-match-specific-expression/52044547#52044547", "title": "Parse io.ReadAll to match specific expression", "body": "<p>An alternative solution is to use the bufio.Scanner api.</p>\n\n<p>It might be interesting if you are dealing with large output that you don t want to store full in memory for processing.</p>\n\n<p>The scanner is a composition of a reader, the input data, and a split function, to creates meaningful chunks of data.</p>\n\n<p>Using the standard api it is possible to take advantage of the provided <code>bufio.ScanLines</code> function to split the output by lines, then a simple prefix equality will yield the necessary information to identify the researched information.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype result struct {\n    start string\n    end   string\n    mean  string\n}\n\nfunc main() {\n    raw := `\n    Selected XML parser javax.xml.bind.util.JAXBSource$1 does not recognize the feature http://xml.org/sax/features/validation\n    Generated ./reports/CSR1000V_RTR2.json\n    Generated ./reports/CSR1000V_RTR6.json\n    Generated ./reports/CSR1000V_RTR3.json\nScan start time: Mon Aug 27 03:39:24 GMT 2018\nScan end time:   Mon Aug 27 03:39:40 GMT 2018\nMean target scan duration: 3906ms\n`\n    scanner := bufio.NewScanner(strings.NewReader(raw))\n\n    var res result\n    // Create a custom split function by wrapping the existing ScanLines function.\n    split := func(data []byte, atEOF bool) (advance int, token []byte, err error) {\n        advance, token, err = bufio.ScanLines(data, atEOF)\n        if err == nil &amp;&amp; token != nil {\n            if pattern := []byte(\"Scan start time:\"); bytes.HasPrefix(token, pattern) {\n                res.start = strings.TrimSpace(string(token[len(pattern):]))\n            } else if pattern := []byte(\"Scan end time:\"); bytes.HasPrefix(token, pattern) {\n                res.end = strings.TrimSpace(string(token[len(pattern):]))\n            } else if pattern := []byte(\"Mean target scan duration:\"); bytes.HasPrefix(token, pattern) {\n                res.mean = strings.TrimSpace(string(token[len(pattern):]))\n            }\n        }\n        return\n    }\n    // Set the split function for the scanning operation.\n    scanner.Split(split)\n    // drain the source\n    for scanner.Scan() {\n    }\n\n    if err := scanner.Err(); err != nil {\n        fmt.Printf(\"Invalid input: %s\", err)\n    }\n    fmt.Printf(\"%#v\\n\", res)\n}\n</code></pre>\n"}], "owner": {"reputation": 433, "user_id": 6763932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8519ce28a7a59b933ffd5d23aa9db90a?s=128&d=identicon&r=PG&f=1", "display_name": "Luca Brasi", "link": "https://stackoverflow.com/users/6763932/luca-brasi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 52044547, "answer_count": 2, "score": 0, "last_activity_date": 1535392122, "creation_date": 1535342278, "last_edit_date": 1535362174, "question_id": 52032383, "link": "https://stackoverflow.com/questions/52032383/parse-io-readall-to-match-specific-expression", "title": "Parse io.ReadAll to match specific expression", "body": "<p>I'm using the Golang Docker SDK to output container logs. The container is running a scan and outputs specific information about the scan job start time, end time, mean scan duration as below:</p>\n\n<pre><code>    Selected XML parser javax.xml.bind.util.JAXBSource$1 does not recognize the feature http://xml.org/sax/features/validation\n    Generated ./reports/CSR1000V_RTR2.json\n    Generated ./reports/CSR1000V_RTR6.json\n    Generated ./reports/CSR1000V_RTR3.json\nScan start time: Mon Aug 27 03:39:24 GMT 2018\nScan end time:   Mon Aug 27 03:39:40 GMT 2018\nMean target scan duration: 3906ms\n</code></pre>\n\n<p>I use code below to convert the io.Reader into a string:</p>\n\n<pre><code>out, err := cli.ContainerLogs(ctx, resp.ID, types.ContainerLogsOptions{\n    ShowStdout: true,\n    Follow:     true})\nif err != nil {\n    panic(err)\n}\ndefer out.Close()\n//io.Copy(os.Stdout, out)\nb, err := ioutil.ReadAll(out)\n\nfmt.Println(string(b))\n</code></pre>\n\n<p>How in Golang can I parse only the last 3 lines and capture the following values only from the stdout:</p>\n\n<pre><code>fmt.Println(\"The scan has started at: \" +startime)\nfmt.Println(\"The scan has ended at: \" +endtime)\nfmt.Println(\"The scan job took xxx ms to scan each device\")\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1535354346, "last_edit_date": 1535354346, "creation_date": 1535351394, "answer_id": 52033663, "question_id": 52032045, "link": "https://stackoverflow.com/questions/52032045/invalid-value-all-n-l-for-flag-gcflags-when-go-build/52033663#52033663", "title": "&#39;invalid value &quot;all -N -l&quot; for flag -gcflags&#39; when go build", "body": "<blockquote>\n  <p>How to solve this problem?</p>\n\n<pre><code>$ go build -gcflags='all -N -l' main.go\ninvalid value \"all -N -l\" for flag -gcflags: missing =&lt;value&gt; in &lt;pattern&gt;=&lt;value&gt;\nusage: go build [-o output] [-i] [build flags] [packages]\nRun 'go help build' for details.\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Follow the instructions in the error message.</p>\n\n<blockquote>\n  <p><code>Run 'go help build' for details.</code></p>\n</blockquote>\n\n<pre><code>$ go help build\n\n&lt;&lt;SNIP&gt;&gt;\n\nThe -asmflags, -gccgoflags, -gcflags, and -ldflags flags accept a\nspace-separated list of arguments to pass to an underlying tool\nduring the build. To embed spaces in an element in the list, surround\nit with either single or double quotes. The argument list may be\npreceded by a package pattern and an equal sign, which restricts\nthe use of that argument list to the building of packages matching\nthat pattern (see 'go help packages' for a description of package\npatterns). \n\n&lt;&lt;SNIP&gt;&gt;\n</code></pre>\n\n<p>Follow the instructions in the help text precisely.</p>\n\n<blockquote>\n  <p>The argument list may be preceded by a package pattern and an equal\n  sign.</p>\n</blockquote>\n\n<p>For example, for package patterm <code>all</code>: <code>all=</code>.</p>\n\n<pre><code>go build -gcflags='all=-N -l' main.go\n</code></pre>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/cmd/go/\" rel=\"noreferrer\">Command go</a>: <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"noreferrer\">Compile packages and dependencies</a></p>\n"}], "owner": {"reputation": 289, "user_id": 4640107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9de16c66a9eea778d4386419798e795?s=128&d=identicon&r=PG&f=1", "display_name": "Alan42", "link": "https://stackoverflow.com/users/4640107/alan42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2360, "favorite_count": 2, "accepted_answer_id": 52033663, "answer_count": 1, "score": 2, "last_activity_date": 1535354346, "creation_date": 1535339095, "last_edit_date": 1535343735, "question_id": 52032045, "link": "https://stackoverflow.com/questions/52032045/invalid-value-all-n-l-for-flag-gcflags-when-go-build", "title": "&#39;invalid value &quot;all -N -l&quot; for flag -gcflags&#39; when go build", "body": "<p>I want to remote debug Golang bin file with delve. First, I need to compile the .go file:</p>\n\n<p><code>go build -gcflags='all -N -l' main.go\n</code></p>\n\n<p>but the outcome is </p>\n\n<p><code>invalid value \"all -N -l\" for flag -gcflags: missing =&lt;value&gt; in &lt;pattern&gt;=&lt;value&gt;\nusage: build [-o output] [-i] [build flags] [packages]\nRun 'go help build' for details.\n</code></p>\n\n<p>How to solve this problem?</p>\n\n<p>go version: 1.10.3 amd64/linux</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-xray"], "comments": [{"owner": {"reputation": 5464, "user_id": 4779904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XYIDr.jpg?s=128&g=1", "display_name": "Dunedan", "link": "https://stackoverflow.com/users/4779904/dunedan"}, "edited": false, "score": 0, "creation_date": 1535347841, "post_id": 52031957, "comment_id": 91016214, "body": "You probably need to manually begin an X-Ray segment to kick of collection. I can only speak of Pyhton, but there that&#39;s something AWS Lambda does for you and you have to do it yourself everywhere else."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 6780899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bccafa9d283508c31b9fbd7bace4574b?s=128&d=identicon&r=PG&f=1", "display_name": "lulu", "link": "https://stackoverflow.com/users/6780899/lulu"}, "is_accepted": false, "score": 1, "last_activity_date": 1535488372, "creation_date": 1535488372, "answer_id": 52065815, "question_id": 52031957, "link": "https://stackoverflow.com/questions/52031957/aws-xray-and-golang-http-call/52065815#52065815", "title": "aws xray and golang http call", "body": "<p>In Lambda scenario, Lambda is responsible for creating Segments and AWS X-Ray Golang SDK only creates Subsegments and then emits them. Based on your code snippet, you didn't find the code that you instrument your application with X-Ray Go SDK APIs to generate subsegments inside Lambda functions. Here I attached a link where you can find how to instrument your application: <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/go-tracing.html\" rel=\"nofollow noreferrer\">lambdadocs</a></p>\n"}], "owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535488372, "creation_date": 1535338149, "question_id": 52031957, "link": "https://stackoverflow.com/questions/52031957/aws-xray-and-golang-http-call", "title": "aws xray and golang http call", "body": "<p>I'm trying to use awx xray on my go app that makes an http call to service. I simply followed this and am not sure if I missed something, <a href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-httpclients.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-httpclients.html</a></p>\n\n<p>I make the http call like this:</p>\n\n<pre><code>payloadStr, _ := json.Marshal(dxPayload)\n\nfmt.Println(\"size: \", int(unsafe.Sizeof(bytes.NewBuffer(payloadStr))))\n\nclambda = &amp;http.Client{}\n\n//-------ADDED XRAY HERE-------//\nxray.Client(clambda)\n\nreqLambda, errReq := http.NewRequest(\"POST\", lambdaurl, bytes.NewBuffer(payloadStr))\nif errReq != nil {\n    log.Fatal(\"Request Error: \", errReq)\n    return\n}\n\nreqLambda.Header.Add(\"accept\", \"application/json;v=1\")\nreqLambda.Header.Add(\"cach-control\", \"no-cache\")\nreqLambda.Header.Add(\"content-type\", \"application/json\")\nreqLambda.Header.Add(\"authorization\", \"Bearer \" + devexToken.AccessToken)\n\nrespLambda, errResp := clambda.Do(reqLambda)\nif errResp != nil {\n    log.Fatal(\"Status Response Error \", errResp)\n    return\n} else {\n\n}\n</code></pre>\n\n<p>and in my <code>main.go</code> file, I have this in <code>func init()</code></p>\n\n<pre><code>func init() {\n\n    pConfig = createpConfig()\n\n    //aws xray config\n    ss, err := sampling.NewLocalizedStrategyFromFilePath(\"xray.json\")\n\n    if err != nil {\n        panic(err)\n    }\n    xray.Configure(xray.Config{\n        SamplingStrategy: ss,\n    })\n}\n</code></pre>\n\n<p>and my <code>xray.json</code> config looks like this:</p>\n\n<pre><code>{\n  \"version\": 1,\n  \"rules\": [\n    {\n      \"description\": \"ehb\",\n      \"service_name\": \"ehb-kafka-push\",\n      \"http_method\": \"*\",\n      \"url_path\": \"/private/api/calllambda/*\",\n      \"fixed_target\": 0,\n      \"rate\": 0.85\n    }\n  ],\n  \"default\": {\n    \"fixed_target\": 1,\n    \"rate\": 0.1\n  }\n}\n</code></pre>\n\n<p>now when I start my app...my api calls are making it through but I don't see anything in AWS xray and on my xray daemon locally, I only see this in the logs:</p>\n\n<pre><code>2018-08-26T18:45:04-07:00 [Info] Initializing AWS X-Ray daemon 2.1.3\n2018-08-26T18:45:04-07:00 [Debug] Listening on UDP 127.0.0.1:2000\n2018-08-26T18:45:04-07:00 [Info] Using buffer memory limit of 163 MB\n2018-08-26T18:45:04-07:00 [Info] 2608 segment buffers allocated\n2018-08-26T18:45:04-07:00 [Debug] Fetch region us-east-1 from commandline argument\n2018-08-26T18:45:04-07:00 [Info] Using region: us-east-1\n2018-08-26T18:45:04-07:00 [Debug] ARN of the AWS resource running the daemon: \n2018-08-26T18:45:04-07:00 [Debug] No Metadata set for telemetry records\n2018-08-26T18:45:04-07:00 [Debug] Using Endpoint: https://xray.us-east-1.amazonaws.com\n2018-08-26T18:45:04-07:00 [Debug] Telemetry initiated\n2018-08-26T18:45:04-07:00 [Debug] Using Endpoint: https://xray.us-east-1.amazonaws.com\n2018-08-26T18:45:04-07:00 [Debug] Batch size: 50\n2018-08-26T18:46:04-07:00 [Debug] Skipped telemetry data as no segments found\n2018-08-26T18:47:04-07:00 [Debug] Skipped telemetry data as no segments found\n2018-08-26T18:48:04-07:00 [Debug] Skipped telemetry data as no segments found\n</code></pre>\n\n<p>what am I missing here? everything seems to be working except the Xray part, why am I not getting any data or errors?</p>\n"}, {"tags": ["go", "go-interface"], "answers": [{"tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": true, "score": 3, "last_activity_date": 1535336237, "creation_date": 1535336237, "answer_id": 52031792, "question_id": 52031671, "link": "https://stackoverflow.com/questions/52031671/how-to-pass-interface-to-method-that-have-lot-of-arguments/52031792#52031792", "title": "How to pass interface to method that have lot of arguments", "body": "<p>The problem that cause <code>&lt;argument name&gt; used as a value</code> error in your example is that functions that form interface <code>I</code> are declared to have no return value:</p>\n\n<pre><code>type I interface {\n M1(x X)\n M2(x X)\n}\n</code></pre>\n\n<p>Surely you can't pass function-call as argument of <code>Println</code> if the function returns nothing: <code>fmt.println(i.M1(x))</code>. Change the interface declaration in your example to return something (and a few more fixes*):</p>\n\n<pre><code>type Y struct {\n a int\n}\n\ntype X struct {\n a int\n}\n\nfunc(y *Y) M1(x X) int {\n return y.a+x.a\n}\n\nfunc(y *Y) M2(x X) int {\n return y.a*x.a\n}\n\ntype I interface {\n M1(x X) int\n M2(x X) int\n}\n\nfunc M(i I, x X) {\n fmt.Println(i.M1(x))\n fmt.Println(i.M2(x))\n}\n</code></pre>\n\n<p><strong><kbd><a href=\"https://play.golang.org/p/E17V2rSIXs6\" rel=\"nofollow noreferrer\"><code>playground</code></a></kbd></strong></p>\n\n<p>*) change <code>M1</code> &amp; <code>M2</code> to return <code>int</code> instead of <code>struct</code> and fix syntax for function declaration with receiver</p>\n"}], "owner": {"reputation": 99, "user_id": 6333264, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TxrcwjksT2U/AAAAAAAAAAI/AAAAAAAABA8/BE8P960oOgc/photo.jpg?sz=128", "display_name": "supa_command", "link": "https://stackoverflow.com/users/6333264/supa-command"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1598, "favorite_count": 1, "accepted_answer_id": 52031792, "answer_count": 1, "score": -1, "last_activity_date": 1535353949, "creation_date": 1535334693, "last_edit_date": 1535353949, "question_id": 52031671, "link": "https://stackoverflow.com/questions/52031671/how-to-pass-interface-to-method-that-have-lot-of-arguments", "title": "How to pass interface to method that have lot of arguments", "body": "<p>I had written a lazy code to demonstrate the issue I am having to implement interfaces. I have methods M1, M2 that take struct X as an argument and have a type of struct Y. I wanted all these methods to be implemented by a single interface I. The issue is the method M that implements the interface I needs to be aware of the arguments that are required to be passed to the child methods (M1,M2). I get an error: <code>&lt;argument name&gt; used as a value</code> when I pass multiple arguments in M</p>\n\n<pre><code>type Y struct {\n a int\n}\n\ntype X struct {\n a int\n}\n\n(y *Y) func M1(x X) struct {\n return y.a+x.a\n}\n\n(y *Y) func M2(x X) struct {\n return y.a*x.a\n}\n\ntype I interface {\n M1(x X)\n M2(x X)\n}\n\nfunc M(i I, x X) {\n fmt.println(i.M1(x)) //returns an error i.M1(x) used as a value\n fmt.println(i.M2(x)) //returns an error i.M2(x) used as a value\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1535331283, "post_id": 52031332, "comment_id": 91013206, "body": "Take a look at this <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#WaitGroup</a> . As far as understand, you always want running processes to be 8. You can achieve that with wait groups"}, {"owner": {"reputation": 121, "user_id": 6460815, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-rmpykt7vYXM/AAAAAAAAAAI/AAAAAAAAABE/D8JcEJTyDP0/photo.jpg?sz=128", "display_name": "Neil Macneale", "link": "https://stackoverflow.com/users/6460815/neil-macneale"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1535331415, "post_id": 52031332, "comment_id": 91013222, "body": "But if I call <code>waitgroup.wait()</code>, it waits for all goroutines to finish. I just want it to wait for any one of them to complete. The wait methods, shown <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#WaitGroup</a>, waits till running subprocesses is 0. I want to wait till its anything less than 8, which I cannot do with waitgroup."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1535375287, "post_id": 52031332, "comment_id": 91030582, "body": "Technically a waitrgroup waits until its counter is 0. The counter is not based on the number of goroutines, that&#39;s just the suggested usage scenario. It&#39;s just a counter that you can add to with <code>Add</code>, decrement with <code>Done</code>, and block until the counter is 0 with <code>Wait</code>. You have total control over it."}], "answers": [{"tags": [], "owner": {"reputation": 2702, "user_id": 2923336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LmjCO.png?s=128&g=1", "display_name": "Francois", "link": "https://stackoverflow.com/users/2923336/francois"}, "is_accepted": true, "score": 4, "last_activity_date": 1535332450, "last_edit_date": 1535332450, "creation_date": 1535332115, "answer_id": 52031447, "question_id": 52031332, "link": "https://stackoverflow.com/questions/52031332/wait-for-one-goroutine-to-finish/52031447#52031447", "title": "Wait for one goroutine to finish", "body": "<p>You could use a buffered channel to return result of a goroutine and indicate termination, and when you read from this channel you start a new go routine. Something like that: </p>\n\n<pre><code>const maxNRoutine = 8\nvar routineCtr int\nvar resultCh = make(chan int, maxNRoutine)\n\nfor i := 0; i &lt; len(input); i += 1 {\n    if routineCtr &lt; maxNRoutines {\n        go calc_math_and_things(resultCh, input[i])\n        routineCtr++\n        continue\n    }\n    var result = &lt;- resultCh // go routine is done, log result and start a new one\n    println(result)\n    go calc_math_and_things(resultCh, intput[i])\n}\n</code></pre>\n\n<p>Inside your routine: </p>\n\n<pre><code>func calc_math_and_things(resultCh chan&lt;- int, input byte) {\n     // ... do some stuff\n     resultCh &lt;- 1\n}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 6460815, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-rmpykt7vYXM/AAAAAAAAAAI/AAAAAAAAABE/D8JcEJTyDP0/photo.jpg?sz=128", "display_name": "Neil Macneale", "link": "https://stackoverflow.com/users/6460815/neil-macneale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1346, "favorite_count": 0, "closed_date": 1535396849, "accepted_answer_id": 52031447, "answer_count": 1, "score": 0, "last_activity_date": 1535354020, "creation_date": 1535330661, "last_edit_date": 1535354020, "question_id": 52031332, "link": "https://stackoverflow.com/questions/52031332/wait-for-one-goroutine-to-finish", "closed_reason": "Duplicate", "title": "Wait for one goroutine to finish", "body": "<p>I am running a cpu intensive script on 8 different goroutines. Each of these goroutines will take at least a few minutes to complete, and I was wondering if something like this is possible:</p>\n\n<pre><code>for i := 0; i &lt; len(input); i += 1 {\n  wait_for_number_of_processes_running_to_be_less_than_8\n  go calc_math_and_things(input[i])\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 5, "creation_date": 1535333783, "post_id": 52031219, "comment_id": 91013581, "body": "Why do you need channels here at all: why not just use a boolean value? And you probably don&#39;t even need that - an infinite loop that runs <code>rePoll</code> after you started would work identically: <code>for {     poll()     X.Run()     rePoll()     X.cancel() }</code>"}, {"owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "edited": false, "score": 0, "creation_date": 1535346685, "post_id": 52031219, "comment_id": 91015889, "body": "I think you probably want one go routine that is checking X and using a time.Ticker to poll every certain amount of time."}], "owner": {"reputation": 85, "user_id": 3786914, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/acb61d353302b7d843f83cbc95a74de6?s=128&d=identicon&r=PG&f=1", "display_name": "anushjay", "link": "https://stackoverflow.com/users/3786914/anushjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1535329323, "creation_date": 1535329323, "question_id": 52031219, "link": "https://stackoverflow.com/questions/52031219/usage-of-go-channels", "title": "Usage of go channels", "body": "<p>I'm looking for validation/better design for the below functionality using go channels -\nProcess X in main() has to run after a polling process. After starting process X, it needs to be checked every minute if it is running successfully. On a failure, the process needs to restarted after polling again (if required).</p>\n\n<pre><code>startX := make(chan bool)\nstartedX := make(chan bool)\nstartX &lt;- true\n    for {\n        select {\n        case &lt;-startX:\n            //Check if a worked needs to be started\n            poll()\n            // Start process\n            X.Run()\n            // Started X\n            startedX &lt;- true\n        case &lt;-startedX:\n            // keep polling for errors\n            rePoll()\n            // cancel on error\n            X.cancel()\n            // return to startX (To see if the worker needs to be restarted or if another worker has already been started)\n            startX &lt;- true\n        }\n    }\n</code></pre>\n\n<p>This implementation works! But is there a better way of doing the above? Thanks much!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 472, "user_id": 5689112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8218d0d54eb2d0cffcc671894e9f6d63?s=128&d=identicon&r=PG&f=1", "display_name": "kitt", "link": "https://stackoverflow.com/users/5689112/kitt"}, "edited": false, "score": 1, "creation_date": 1535329369, "post_id": 52030591, "comment_id": 91012914, "body": "Definitely, your two <code>New</code> functions have different types. If you want to use some methods which only defined in &#39;my_module.MyModule&#39;, why don&#39;t you change <code>moduleConstructor</code> to make it return a pointer to <code>my_module.MyModule</code> ?"}, {"owner": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "reply_to_user": {"reputation": 472, "user_id": 5689112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8218d0d54eb2d0cffcc671894e9f6d63?s=128&d=identicon&r=PG&f=1", "display_name": "kitt", "link": "https://stackoverflow.com/users/5689112/kitt"}, "edited": false, "score": 0, "creation_date": 1535385723, "post_id": 52030591, "comment_id": 91036934, "body": "Because there are many structs implementing this interface."}], "answers": [{"comments": [{"owner": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "edited": false, "score": 0, "creation_date": 1535407998, "post_id": 52032020, "comment_id": 91046151, "body": "I thought about this, and since I am not getting a lot of answers something is telling me that this is the only realistic way of doing this."}], "tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": false, "score": 0, "last_activity_date": 1535338835, "creation_date": 1535338835, "answer_id": 52032020, "question_id": 52030591, "link": "https://stackoverflow.com/questions/52030591/cannot-use-my-module-new-type-func-my-module-mymodule-error-as-type-func/52032020#52032020", "title": "Cannot use my_module.New (type func() (*my_module.MyModule, error)) as type func() (core.Module, error) in map value", "body": "<p>You can use a simple anonymous function to form compliant function signature for your map without changing <code>my_module.New</code> definition. The anonymous function still call <code>my_module.New</code> in its body:</p>\n\n<pre><code>constructors[\"name\"] = func New() (core.Module, error) {\n    return my_module.New()\n} \n</code></pre>\n"}], "owner": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535338835, "creation_date": 1535321356, "question_id": 52030591, "link": "https://stackoverflow.com/questions/52030591/cannot-use-my-module-new-type-func-my-module-mymodule-error-as-type-func", "title": "Cannot use my_module.New (type func() (*my_module.MyModule, error)) as type func() (core.Module, error) in map value", "body": "<p>In my program I have an interface called <code>core.Module</code> and a struct which implements this interface called <code>my_module.MyModule</code>. Functions creating  those structs implementing my interface are added to a map in order to call them by name later:</p>\n\n<pre><code>type moduleConstructor func() (core.Module, error)\n\nconstructors := make(map[string]moduleConstructor)\nconstructors[\"name\"] = my_module.New\n</code></pre>\n\n<p>Unfortunately the only way to make this work is to create a following <code>New</code> function:</p>\n\n<pre><code>func New() (core.Module, error) {\n} \n</code></pre>\n\n<p>I would very much prefer to use a recommended signature:</p>\n\n<pre><code>func New() (*my_module.MyModule, error) {\n}\n</code></pre>\n\n<p>However that causes the following error: </p>\n\n<pre><code>cannot use my_module.New (type func() (*my_module.MyModule, error)) as type \nfunc() (core.Module, error) in map value\n</code></pre>\n\n<p>Is it possible to somehow make the map accept functions which return structs implementing an interface instead of directly returning that interface?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1535317558, "post_id": 52030137, "comment_id": 91010922, "body": "@J&#246;rgWMittag your comment isn&#39;t unclear. Same as your undervote. And my question is clear. How can I ask the author of benchmark if I don&#39;t know who it is? By the way, have not found <code>go</code> tag inside your top tags."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 3, "creation_date": 1535317765, "post_id": 52030137, "comment_id": 91010969, "body": "You might be better off reading this article by Dave Cheney first <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go</a>"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1535319727, "post_id": 52030137, "comment_id": 91011310, "body": "I am sorry, I am not a native speaker of English, and thus I am having trouble understanding your comment. I have never heard the term &quot;undervote&quot; and I don&#39;t understand why you think that I would have such a thing. Also, I don&#39;t understand what the top tags have to do with your question, especially since I wasn&#39;t able to find <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a> among your top tags either. (Although <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a> <i>is</i> in the top 20% of my tags, so if you didn&#39;t find it, there seems to be some error in the <a href=\"https://stackoverflow.com\">Stack Overflow</a> engine, which explains why I couldn&#39;t find it in yours.) I am assuming that you got that code from somewhere, so you"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1535319801, "post_id": 52030137, "comment_id": 91011328, "body": "might find some documentation there on who wrote it, and why they chose to write it this way. Like I said, 6 repetitions seems <i>much too few</i> to get any meaningful results, so I would really like know the answer also. I would expect at least 10000 repetitions, if not more."}], "answers": [{"tags": [], "owner": {"reputation": 7066, "user_id": 2363517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yCylW.jpg?s=128&g=1", "display_name": "mszalbach", "link": "https://stackoverflow.com/users/2363517/mszalbach"}, "is_accepted": true, "score": 4, "last_activity_date": 1535317736, "creation_date": 1535317736, "answer_id": 52030278, "question_id": 52030137, "link": "https://stackoverflow.com/questions/52030137/why-benchmark-runs-six-times/52030278#52030278", "title": "Why Benchmark runs six(?) times", "body": "<p>You are using a benchmark function. This need to execute code multiple times to get a result which is kinda meaningful.</p>\n\n<p>Also your Benchmark is not implemented like the benchmark should be programmed:</p>\n\n<blockquote>\n  <p>The benchmark function must run the target code b.N times. During benchmark execution, b.N is adjusted until the benchmark function lasts long enough to be timed reliably. \n  -- <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/testing/</a></p>\n</blockquote>\n\n<p>So Benchmark will check the run time and will adjust the b.N to get a good and useful benchmark.</p>\n\n<p>When you just print b.N you get an output like this:</p>\n\n<pre><code>1\n100\n10000\n1000000\n100000000\n2000000000\n2000000000  \n</code></pre>\n\n<p>So in each of the 6 iterations the benchmark is telling you to run a foor loop b.N times.</p>\n\n<p>Sadly you can not use a correct example in the playground because they take to long. But correct would be:</p>\n\n<pre><code>func testThis(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fmt.Println(test)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 52030278, "answer_count": 1, "score": -1, "last_activity_date": 1535317853, "creation_date": 1535316383, "question_id": 52030137, "link": "https://stackoverflow.com/questions/52030137/why-benchmark-runs-six-times", "title": "Why Benchmark runs six(?) times", "body": "<p>This code (<a href=\"https://play.golang.org/p/aRVv38HBaPN\" rel=\"nofollow noreferrer\">playground link</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nvar test = make([]int, 0)\n\nfunc main() {\n    fmt.Println(testing.Benchmark(testThis))\n}\n\nfunc testThis(b *testing.B) {\n    fmt.Println(test)\n}\n</code></pre>\n\n<p>has next output:</p>\n\n<pre><code>[]\n[]\n[]\n[]\n[]\n[]\n2000000000           0.00 ns/op\n\nProgram exited.\n</code></pre>\n\n<p>Why there are six <code>[]</code> inside output?</p>\n\n<p>This code (<a href=\"https://play.golang.org/p/ABUs-IJCwP_G\" rel=\"nofollow noreferrer\">playground link</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar test = make([]int, 0)\n\nfunc main() {\n    fmt.Println(test)\n}\n</code></pre>\n\n<p>has single output (and it's clear for me):</p>\n\n<pre><code>[]\n\nProgram exited.\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "metrics", "heapster"], "comments": [{"owner": {"reputation": 3793, "user_id": 873601, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/16dd69c7d8b13156595bc01387e55224?s=128&d=identicon&r=PG", "display_name": "Vishal Biyani", "link": "https://stackoverflow.com/users/873601/vishal-biyani"}, "edited": false, "score": 0, "creation_date": 1535360820, "post_id": 52029656, "comment_id": 91021888, "body": "Something like: <a href=\"https://stackoverflow.com/questions/49192508/find-the-available-ram-using-go-api\" title=\"find the available ram using go api\">stackoverflow.com/questions/49192508/&hellip;</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 4560203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4d4c4f331c03247522639d26b78e08c?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Schofield", "link": "https://stackoverflow.com/users/4560203/richard-schofield"}, "is_accepted": false, "score": 6, "last_activity_date": 1539083208, "last_edit_date": 1539083208, "creation_date": 1539079216, "answer_id": 52718268, "question_id": 52029656, "link": "https://stackoverflow.com/questions/52029656/how-to-retrieve-kubernetes-metrics-via-client-go-and-golang/52718268#52718268", "title": "How to retrieve kubernetes metrics via client-go and golang", "body": "<p>Here's an example of using the REST API to query node metrics and return a []byte in JSON format. Replace \"nodes\" with \"pods\" to get pod/container metrics.</p>\n\n<pre><code>data, err := clientset.RESTClient().Get().AbsPath(\"apis/metrics.k8s.io/v1beta1/nodes\").DoRaw()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3595, "user_id": 1461060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa9c0cb18948f4573ebe7c81843f52a?s=128&d=identicon&r=PG", "display_name": "gihanchanuka", "link": "https://stackoverflow.com/users/1461060/gihanchanuka"}, "reply_to_user": {"reputation": 121, "user_id": 2911424, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94ca142e5bf28b0a02b46bc5b3a292ec?s=128&d=identicon&r=PG&f=1", "display_name": "mR.aTA", "link": "https://stackoverflow.com/users/2911424/mr-ata"}, "edited": false, "score": 0, "creation_date": 1572703351, "post_id": 54479710, "comment_id": 103645406, "body": "@mR.aTA can you provide more details? Also make sure your client has permission to access the metrics."}, {"owner": {"reputation": 121, "user_id": 2911424, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94ca142e5bf28b0a02b46bc5b3a292ec?s=128&d=identicon&r=PG&f=1", "display_name": "mR.aTA", "link": "https://stackoverflow.com/users/2911424/mr-ata"}, "edited": false, "score": 0, "creation_date": 1572731721, "post_id": 54479710, "comment_id": 103652436, "body": "This is the link to <a href=\"https://paste.ubuntu.com/p/BwYRTDMcfB/\" rel=\"nofollow noreferrer\">the dump of the config</a> Also, the command <code>kubectl get --raw &#47;apis&#47;metrics.k8s.io&#47;v1beta1&#47;pods</code> works well. How can I make sure that my client has enough permission? It panics at <code>data, err := clientset.RESTClient().Get().AbsPath(&quot;apis&#47;metrics.k8s.io&#47;v1&zwnj;&#8203;beta1&#47;pods&quot;).DoRaw()</code> and the <code>err</code> is <code>unknown</code>  I also have these two in my <code>kubelet confi</code>: <code>authenticationTokenWebhook: true</code> and <code>authorizationMode: Webhook</code>."}, {"owner": {"reputation": 121, "user_id": 2911424, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94ca142e5bf28b0a02b46bc5b3a292ec?s=128&d=identicon&r=PG&f=1", "display_name": "mR.aTA", "link": "https://stackoverflow.com/users/2911424/mr-ata"}, "edited": false, "score": 0, "creation_date": 1572806694, "post_id": 54479710, "comment_id": 103666244, "body": "I&#39;ve updated my <code>authenticatioinMode:AlwaysAllow</code> so the <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/in-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">example here</a> to get the list of nodes works fine, but the code for getting the metrics returns the <code>unknown</code> error."}, {"owner": {"reputation": 3595, "user_id": 1461060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa9c0cb18948f4573ebe7c81843f52a?s=128&d=identicon&r=PG", "display_name": "gihanchanuka", "link": "https://stackoverflow.com/users/1461060/gihanchanuka"}, "reply_to_user": {"reputation": 121, "user_id": 2911424, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94ca142e5bf28b0a02b46bc5b3a292ec?s=128&d=identicon&r=PG&f=1", "display_name": "mR.aTA", "link": "https://stackoverflow.com/users/2911424/mr-ata"}, "edited": false, "score": 0, "creation_date": 1572812435, "post_id": 54479710, "comment_id": 103667809, "body": "Make sure you have installed <code>metrics-server</code>. Create a cluster role for default name space with <code>kubectl create clusterrolebinding default-cluster-admin --clusterrole=cluster-admin --serviceaccount=default:default</code>"}, {"owner": {"reputation": 121, "user_id": 2911424, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94ca142e5bf28b0a02b46bc5b3a292ec?s=128&d=identicon&r=PG&f=1", "display_name": "mR.aTA", "link": "https://stackoverflow.com/users/2911424/mr-ata"}, "edited": false, "score": 1, "creation_date": 1572876000, "post_id": 54479710, "comment_id": 103686538, "body": "Thanks @gihanchanuka! However, I didn&#39;t use cluster-admin role, but I wrote a rbca clusterrol/clusterrolbinding with custom permissions and it works now. Thanks again."}], "tags": [], "owner": {"reputation": 3595, "user_id": 1461060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa9c0cb18948f4573ebe7c81843f52a?s=128&d=identicon&r=PG", "display_name": "gihanchanuka", "link": "https://stackoverflow.com/users/1461060/gihanchanuka"}, "is_accepted": false, "score": 4, "last_activity_date": 1549024720, "creation_date": 1549024720, "answer_id": 54479710, "question_id": 52029656, "link": "https://stackoverflow.com/questions/52029656/how-to-retrieve-kubernetes-metrics-via-client-go-and-golang/54479710#54479710", "title": "How to retrieve kubernetes metrics via client-go and golang", "body": "<p>As explained in the question, <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/in-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">the documentations</a> are not clear for a beginner. Even go-client examples retrieve the data, I wanted to get Type support.</p>\n\n<p>As it explained by <a href=\"https://stackoverflow.com/a/52718268/1461060\">above answer</a>, you can get the data in []byte in JSON format. This is how I did it. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/rest\"\n)\n\n// PodMetricsList : PodMetricsList\ntype PodMetricsList struct {\n    Kind       string `json:\"kind\"`\n    APIVersion string `json:\"apiVersion\"`\n    Metadata   struct {\n        SelfLink string `json:\"selfLink\"`\n    } `json:\"metadata\"`\n    Items []struct {\n        Metadata struct {\n            Name              string    `json:\"name\"`\n            Namespace         string    `json:\"namespace\"`\n            SelfLink          string    `json:\"selfLink\"`\n            CreationTimestamp time.Time `json:\"creationTimestamp\"`\n        } `json:\"metadata\"`\n        Timestamp  time.Time `json:\"timestamp\"`\n        Window     string    `json:\"window\"`\n        Containers []struct {\n            Name  string `json:\"name\"`\n            Usage struct {\n                CPU    string `json:\"cpu\"`\n                Memory string `json:\"memory\"`\n            } `json:\"usage\"`\n        } `json:\"containers\"`\n    } `json:\"items\"`\n}\n\nfunc getMetrics(clientset *kubernetes.Clientset, pods *PodMetricsList) error {\n    data, err := clientset.RESTClient().Get().AbsPath(\"apis/metrics.k8s.io/v1beta1/pods\").DoRaw()\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(data, &amp;pods)\n    return err\n}\n\nfunc main() {\n    // creates the in-cluster config\n    // https://github.com/kubernetes/client-go/tree/master/examples#configuration\n    config, err := rest.InClusterConfig()\n    if err != nil {\n        panic(err.Error())\n    }\n    // creates the clientset\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n    var pods PodMetricsList\n    err = getMetrics(clientset, &amp;pods)\n    if err != nil {\n        panic(err.Error())\n    }\n    for _, m := range pods.Items {\n        fmt.Println(m.Metadata.Name, m.Metadata.Namespace, m.Timestamp.String())\n    }\n}\n</code></pre>\n\n<p>Install following Go packages: <code>go get -u k8s.io/client-go/kubernetes k8s.io/client-go/rest</code></p>\n\n<p>You can use following endpoints to retrieve the data as you want;</p>\n\n<ul>\n<li>Nodes: <code>apis/metrics.k8s.io/v1beta1/nodes</code></li>\n<li>Pods: <code>apis/metrics.k8s.io/v1beta1/pods</code></li>\n<li>Pods of <code>default</code> namespace: <code>apis/metrics.k8s.io/v1beta1/namespaces/default/pods</code></li>\n<li>Specific Pod: <code>/apis/metrics.k8s.io/v1beta1/namespaces/default/pods/&lt;POD-NAME&gt;</code></li>\n</ul>\n\n<p><strong>NOTE</strong>: You may need to change the Type before <code>json.Unmarshal</code>. You can define the Type only for the field which you are interested with.</p>\n"}, {"comments": [{"owner": {"reputation": 7649, "user_id": 90674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8cd97d8886e879ca6eb61040a9bfa22?s=128&d=identicon&r=PG", "display_name": "sshow", "link": "https://stackoverflow.com/users/90674/sshow"}, "edited": false, "score": 0, "creation_date": 1616884436, "post_id": 58112978, "comment_id": 118144327, "body": "Now, <code>.List()</code> takes a <code>context.Context</code> argument: <code>clientset.MetricsV1beta1().PodMetricses(&quot;&quot;).List(context.TOD&zwnj;&#8203;O(), metav1.ListOptions{})</code>"}], "tags": [], "owner": {"reputation": 1011, "user_id": 2609640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/790a2433ad5c793fe5bcd5b8db79df11?s=128&d=identicon&r=PG", "display_name": "gnvk", "link": "https://stackoverflow.com/users/2609640/gnvk"}, "is_accepted": false, "score": 6, "last_activity_date": 1569487799, "creation_date": 1569487799, "answer_id": 58112978, "question_id": 52029656, "link": "https://stackoverflow.com/questions/52029656/how-to-retrieve-kubernetes-metrics-via-client-go-and-golang/58112978#58112978", "title": "How to retrieve kubernetes metrics via client-go and golang", "body": "<p>There's a much better API for this: <a href=\"https://github.com/kubernetes/metrics\" rel=\"noreferrer\">https://github.com/kubernetes/metrics</a>. Using this, you don't have to create the data structs or handle row byte slices.</p>\n\n<pre><code>import (\n  metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n  metricsv \"k8s.io/metrics/pkg/client/clientset/versioned\"\n  ...\n)\n\n...\nclientset, err := metricsv.NewForConfig(config)\npodMetricsList, err := clientset.MetricsV1beta1().PodMetricses(\"\").List(metav1.ListOptions{})\n</code></pre>\n"}], "owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4331, "favorite_count": 4, "answer_count": 3, "score": 9, "last_activity_date": 1569487799, "creation_date": 1535312181, "question_id": 52029656, "link": "https://stackoverflow.com/questions/52029656/how-to-retrieve-kubernetes-metrics-via-client-go-and-golang", "title": "How to retrieve kubernetes metrics via client-go and golang", "body": "<p>I want to access metrics from kubernetes with golang. Something like cpu and memory per node as well as the same for pods and/or namespaces.</p>\n\n<p>I am kind of lost here because the documentation is not as clear as it could be.</p>\n\n<p>I have learned that there is <code>heapster</code> (which is deprecated according to the github repo). There is also <code>metric server</code> and a rest api.</p>\n\n<p>Where can I find some examples to get started? I do not want to install another app, package or service in kubernetes. I'd like to get the information as native as possible. \nWhat is the preferred way to access these information with client-go and golang?</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 2552, "user_id": 610051, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c90269c460cc6593f56823abb0c9cf39?s=128&d=identicon&r=PG", "display_name": "Roshambo", "link": "https://stackoverflow.com/users/610051/roshambo"}, "edited": false, "score": 1, "creation_date": 1606770536, "post_id": 52029483, "comment_id": 115057675, "body": "Beware: ranging over a string will range over the number of bytes, which isn&#39;t always the same as the number of characters (<code>Hi</code> is 2 bytes long while <code>\u4e16\u754c</code> is 6 bytes long). To range over the number of characters, use <code>i, c := range []rune(str)</code>. And, if you&#39;re targeting a terminal as the final output, consider <a href=\"https://github.com/mattn/go-runewidth\" rel=\"nofollow noreferrer\">go-runewidth</a> when measuring the width of monospaced characters."}], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 2074215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971e6dd9ef5ba7ed36f174f7452abc78?s=128&d=identicon&r=PG&f=1", "display_name": "eenblam", "link": "https://stackoverflow.com/users/2074215/eenblam"}, "is_accepted": false, "score": 4, "last_activity_date": 1535311558, "creation_date": 1535311558, "answer_id": 52029586, "question_id": 52029483, "link": "https://stackoverflow.com/questions/52029483/finding-longest-word-in-golang/52029586#52029586", "title": "Finding longest word in golang", "body": "<p>That totally works! You <em>could</em> make it a bit shorter, while also using longer variable names that explain a bit more about your intention.</p>\n\n<pre><code>func longestWord(s string) string {\n    words := strings.Split(s, \" \")\n    if len(words) == 0 {\n        return \"\"\n    }\n    best := words[0]\n    best_length := 0\n    for _, word := range words {\n        if len(word) &gt; best_length {\n            best = word\n            best_length = len(word)\n        }\n    }\n    return best\n}\n</code></pre>\n\n<p>You could change this to track a pointer instead of the word itself if you like.</p>\n"}, {"comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 1, "creation_date": 1535315347, "post_id": 52029637, "comment_id": 91010421, "body": "No need to check if array is not empty (<code>if len(newArr) &gt; 0</code>) as in that case the range loop is just not entered. IOW it is safe to have range loop over empty array."}], "tags": [], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "is_accepted": false, "score": 1, "last_activity_date": 1535316123, "last_edit_date": 1535316123, "creation_date": 1535312079, "answer_id": 52029637, "question_id": 52029483, "link": "https://stackoverflow.com/questions/52029483/finding-longest-word-in-golang/52029637#52029637", "title": "Finding longest word in golang", "body": "<p>I would do it like this:</p>\n\n<pre><code>func longestWord(s string) string {\n\nnewArr := strings.Split(s, \" \")\n\nlongestWord := \"\"\nlongestLength := 0\n\n    // loop through the array\n    for _, word := range newArr {\n        // save length of word in the actual iteration\n        length := len(word)\n\n        // if length is larger, than longest\n        if length &gt; longestLength {\n            // save the new longest word\n            longestWord = word\n            longestLength = length\n        }\n    }\n\n\n// return the longest word\nreturn longestWord\n}\n</code></pre>\n\n<p>Implementation can be found on the <a href=\"https://play.golang.org/p/pMAO4Tmezn9\" rel=\"nofollow noreferrer\">go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1535444213, "last_edit_date": 1535444213, "creation_date": 1535315414, "answer_id": 52030033, "question_id": 52029483, "link": "https://stackoverflow.com/questions/52029483/finding-longest-word-in-golang/52030033#52030033", "title": "Finding longest word in golang", "body": "<h2>\"Best\" solution</h2>\n\n<p>We can even write it more compact than the other answers by taking advantage of the following:</p>\n\n<ul>\n<li>using tuple assignments</li>\n<li>initializing the <code>best</code> and its length with the zero values (<code>\"\"</code> and <code>0</code>) and omitting the check for 0 words as the <code>for range</code> handles that properly</li>\n<li>no need to store <code>words</code> as a local variable as it is only used in the loop</li>\n</ul>\n\n<p>We lose nothing from readability:</p>\n\n<pre><code>func longestWord(s string) string {\n    best, length := \"\", 0\n    for _, word := range strings.Split(s, \" \") {\n        if len(word) &gt; length {\n            best, length = word, len(word)\n        }\n    }\n    return best\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Printf(\"%q\\n\", longestWord(\"\"))\nargs := \"Monday Tuesday Friday Sunday Wednesday\"\nfmt.Printf(\"%q\\n\", longestWord(args))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/fPMo_9LXG1G\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\"\"\n\"Wednesday\"\n</code></pre>\n\n<h2>Most compact solution</h2>\n\n<p>Note that storing the length of the <code>best</code> is optional and is purely for optimization purposes, since if we have <code>best</code>, its length is always <code>len(best)</code>.</p>\n\n<p>Taking advantage of this, and that we can use named result parameters (and that all variables are initialized to the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> of their types unless an initial value is provided\u2013which for <code>string</code> is <code>\"\"</code>), we can even write it more compact, again losing nothing from readability:</p>\n\n<pre><code>func longestWord(s string) (best string) {\n    for _, word := range strings.Split(s, \" \") {\n        if len(word) &gt; len(best) {\n            best = word\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>Testing and output is the same, try it on the <a href=\"https://play.golang.org/p/GuFvtsoqZFV\" rel=\"nofollow noreferrer\">Go Playground</a>. Again, in most cases this is probably slightly slower compared to when we stored the length too.</p>\n"}], "owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 0, "accepted_answer_id": 52030033, "answer_count": 3, "score": 5, "last_activity_date": 1535444213, "creation_date": 1535310792, "last_edit_date": 1535315545, "question_id": 52029483, "link": "https://stackoverflow.com/questions/52029483/finding-longest-word-in-golang", "title": "Finding longest word in golang", "body": "<p>Trying to find the longest word using Go from a sentence.</p>\n\n<p>At the moment I am using this method:</p>\n\n<pre><code>func longestWord(s string) string {\n\n    newArr := strings.Split(s, \" \")\n\n    l := len(newArr[0])\n    long := newArr[0]\n    var result string\n    // fmt.Println(long)\n    for _, lenString := range newArr {\n\n        if len(lenString) &gt; l {\n            // ll := len(lenString)\n            // l := len(lenString)\n            d := &amp;l\n            p := &amp;long\n            c := &amp;result\n            *d = len(lenString)\n            *p = lenString\n            *c = lenString\n            // fmt.Println(lenString)\n        } else {\n            c := &amp;result\n            *c = newArr[0]\n        }\n\n    }\n    return result\n}\n\nfunc main() {\n    args := \"Monday Tuesday Friday Sunday Wednesday\"\n    fmt.Println(longestWord(args))\n}\n</code></pre>\n\n<p>But I'm not sure that this is the best method to achieve that. Is there any other elegant way to do that? I know that there is one more method by using sort, but I would prefer more using the way with iteration between words.</p>\n"}, {"tags": ["postgresql", "go", "cookies", "server", "runtime-error"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1535306945, "creation_date": 1535306945, "answer_id": 52029005, "question_id": 52028198, "link": "https://stackoverflow.com/questions/52028198/golang-panic-crash-on-searching-postgres/52029005#52029005", "title": "Golang Panic Crash on Searching Postgres", "body": "<p>You're missing the required <code>defer rows.Close()</code>.</p>\n\n<p>Each instance of <code>*sql.Rows</code> has a connection associated with it. When you close a rows instance the associated connection gets released and put back into the pool (<code>*DB</code>).</p>\n\n<p>Not closing a rows instance, on the other hand, will cause its connection not to be <a href=\"https://github.com/golang/go/blob/4cc09cd5320a2bea4f27a1db59970d4b715f6522/src/database/sql/sql.go#L2978\" rel=\"nofollow noreferrer\">released</a>. And not releasing connections will in turn lead to the connection pool to attempt to open one too many new connections.</p>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "accepted_answer_id": 52029005, "answer_count": 1, "score": 0, "last_activity_date": 1535306945, "creation_date": 1535301067, "last_edit_date": 1535301910, "question_id": 52028198, "link": "https://stackoverflow.com/questions/52028198/golang-panic-crash-on-searching-postgres", "title": "Golang Panic Crash on Searching Postgres", "body": "<p>So I have a feature that I want to add in a program I'm writing. Basically, if a user has cookies that say what his username and password are it will look up username and the hashed value of the cookie in a stored postgres database and return a positive response and JWT token if I get a match (made as secure as I can with bcrypt hashing - whether storing hashed passwords is a good idea is maybe another question). </p>\n\n<p>This request is made to the server every time a user goes to a page that requires a saved password. </p>\n\n<p>My problem is that every now and then I get the following</p>\n\n<pre><code>inside CookieLogin\napp_1  | search_userinfo_table started\ndb_1   | FATAL:  sorry, too many clients already\napp_1  | 2018/08/26 16:22:25 pq: sorry, too many clients already\napp_1  | 2018/08/26 16:22:25 http: panic serving 172.21.0.1:37304: pq: sorry, too many clients already\napp_1  | goroutine 704 [running]:\napp_1  | net/http.(*conn).serve.func1(0xc420156f00)\napp_1  |    /usr/local/go/src/net/http/server.go:1721 +0xd0\napp_1  | panic(0x6d63e0, 0xc420102c20)\napp_1  |    /usr/local/go/src/runtime/panic.go:489 +0x2cf\napp_1  | log.Panic(0xc4200438c0, 0x1, 0x1)\napp_1  |    /usr/local/go/src/log/log.go:322 +0xc0\napp_1  | github.com/patientplatypus/webserver/database.Search_userinfo_table(0xc42017f29d, 0xb, 0xc4201500c0, 0xc4200c22e0, 0xc420043a10)\napp_1  |    /go/src/github.com/patientplatypus/webserver/database/search.go:18 +0x169\napp_1  | github.com/patientplatypus/webserver/authentication.loginHandler(0xc42017f29d, 0xb, 0xc42017f2ba, 0x3, 0x899a80, 0xc420148460)\napp_1  |    /go/src/github.com/patientplatypus/webserver/authentication/login.go:53 +0x39\napp_1  | github.com/patientplatypus/webserver/authentication.CookieLogin(0x899a80, 0xc420148460, 0xc4203fc800)\napp_1  |    /go/src/github.com/patientplatypus/webserver/authentication/login.go:35 +0x279\napp_1  | net/http.HandlerFunc.ServeHTTP(0x75c658, 0x899a80, 0xc420148460, 0xc4203fc800)\napp_1  |    /usr/local/go/src/net/http/server.go:1942 +0x44\napp_1  | github.com/gorilla/mux.(*Router).ServeHTTP(0xc420052460, 0x899a80, 0xc420148460, 0xc4203fc800)\napp_1  |    /go/src/github.com/gorilla/mux/mux.go:162 +0x101\napp_1  | main.JWTHandler.func1(0x899a80, 0xc420148460, 0xc4203fc600)\napp_1  |    /go/src/github.com/patientplatypus/webserver/main.go:34 +0x342\napp_1  | net/http.HandlerFunc.ServeHTTP(0xc4200b12a0, 0x899a80, 0xc420148460, 0xc4203fc600)\napp_1  |    /usr/local/go/src/net/http/server.go:1942 +0x44\napp_1  | github.com/rs/cors.(*Cors).Handler.func1(0x899a80, 0xc420148460, 0xc4203fc600)\napp_1  |    /go/src/github.com/rs/cors/cors.go:200 +0xe9\napp_1  | net/http.HandlerFunc.ServeHTTP(0xc4200b12c0, 0x899a80, 0xc420148460, 0xc4203fc600)\napp_1  |    /usr/local/go/src/net/http/server.go:1942 +0x44\napp_1  | net/http.serverHandler.ServeHTTP(0xc42008a630, 0x899a80, 0xc420148460, 0xc4203fc600)\napp_1  |    /usr/local/go/src/net/http/server.go:2568 +0x92\napp_1  | net/http.(*conn).serve(0xc420156f00, 0x899fc0, 0xc4200506c0)\napp_1  |    /usr/local/go/src/net/http/server.go:1825 +0x612\napp_1  | created by net/http.(*Server).Serve\napp_1  |    /usr/local/go/src/net/http/server.go:2668 +0x2ce\n</code></pre>\n\n<p>...and then the golang client will crash and I will have to manually restart. This is an error that happens only <em>sometimes</em> which is incredibly frustrating as it makes debugging difficult (sorry for the verbose terminal log - I'm not sure when the error will fire again).</p>\n\n<p>Does anyone have any advice or suggestions? Is this a common problem with a no-duh solution?</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: </p>\n\n<p>As far as I can tell, here is the offending postgres search query: </p>\n\n<pre><code>package data\n\nimport(\n    \"fmt\"\n    \"log\"\n    _ \"github.com/lib/pq\"\n)\n\n\nfunc Search_userinfo_table(searchEmail string)(bool, string) {\n    fmt.Println(\"search_userinfo_table started\")\n    rows, err1 := db.Query(\"SELECT * FROM userinfo\")\n    if err1 != nil {\n        log.Panic(err1)\n    }\n    for rows.Next() {\n        var email string\n        var password string\n        var regString string\n        var regBool bool\n        var uid int\n        err2 := rows.Scan(&amp;email, &amp;password, &amp;regString, &amp;regBool, &amp;uid)\n        if err2 != nil {\n            log.Panic(err2)\n        }\n        fmt.Println(\"email | password\")\n        fmt.Printf(\"%s | %s\", email, password)\n        if email == searchEmail{\n            return false, password\n        }\n    }\n    return true, \"\"\n}\n</code></pre>\n\n<p>Which returns the whether the user is in the database or not as well as the hashed password. Talking with a few people the answer appears to be that postgres adds a new connection every time it makes this read and then eventually crashes, but I want it to reuse connections (although I thought that this happened automagically?). Anyway, more information.</p>\n"}, {"tags": ["json", "go", "unmarshalling", "go-reflect"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1535296708, "post_id": 52027531, "comment_id": 91005390, "body": "How did you determine that this approach was inefficient and uses too much memory? What performance problems are you facing? Or is this just a guess?"}, {"owner": {"reputation": 1866, "user_id": 5405453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Me0YP.jpg?s=128&g=1", "display_name": "nijm", "link": "https://stackoverflow.com/users/5405453/nijm"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535297111, "post_id": 52027531, "comment_id": 91005488, "body": "@Flimzy Well if I made this method just for a single entity (ie Unmarshalling it directly into a response with correct Entities) it peeks at less than half of the memory in comparison to this sample above (for the time these requests last). Actually by watching the Activity Monitor on my mac."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535297204, "post_id": 52027531, "comment_id": 91005513, "body": "I&#39;m not really sure what you&#39;re saying. In any case, trying to avoid reflection while using json is a bit of a lost cause, as json uses reflection internally."}, {"owner": {"reputation": 1866, "user_id": 5405453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Me0YP.jpg?s=128&g=1", "display_name": "nijm", "link": "https://stackoverflow.com/users/5405453/nijm"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535620970, "post_id": 52027531, "comment_id": 91136855, "body": "@Flimzy I agree that doing some profiling and/or having some benchmarks would make the problem description easier and more abstract, however IMO the approach above has obvious flaws, aside from the actual results. Also I shouldn&#39;t have mentioned reflection as I don&#39;t think this should be used here and Joshua&#39;s approach below much better suits my needs ;) Anyway thanks for your input!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535621056, "post_id": 52027531, "comment_id": 91136900, "body": "Joshua&#39;s result below uses reflection, just to be clear."}, {"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535656330, "post_id": 52027531, "comment_id": 91158846, "body": "@Flimzy My solution implicitly uses reflection via <code>encoding&#47;json</code> but does not require the <code>reflect</code> package to be imported, and requires no explicit type assertions."}], "answers": [{"comments": [{"owner": {"reputation": 1866, "user_id": 5405453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Me0YP.jpg?s=128&g=1", "display_name": "nijm", "link": "https://stackoverflow.com/users/5405453/nijm"}, "edited": false, "score": 0, "creation_date": 1535620190, "post_id": 52090792, "comment_id": 91136327, "body": "Joshua, this is awesome! In the end I did opt for the <code>json.RawMessage</code>. However the <code>PagedReader</code> is a really interesting approach and some food for thought in refactoring."}], "tags": [], "owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "is_accepted": true, "score": 1, "last_activity_date": 1535612092, "last_edit_date": 1535612092, "creation_date": 1535611750, "answer_id": 52090792, "question_id": 52027531, "link": "https://stackoverflow.com/questions/52027531/unmarshalling-entities-from-multiple-json-arrays-without-using-reflect-or-duplic/52090792#52090792", "title": "Unmarshalling Entities from multiple JSON arrays without using reflect or duplicating code", "body": "<p>Take a look at the <code>RawMessage</code> type in the <code>encoding/json</code> package. It allows you to defer the decoding of json values until later.  For example:</p>\n\n<pre><code>Results []json.RawMessage `json:\"results\"`\n</code></pre>\n\n<p>or even...</p>\n\n<pre><code>Results json.RawMessage `json:\"results\"`\n</code></pre>\n\n<p>Since <code>json.RawMessage</code> is just a slice of bytes this will be much more efficient then the intermediate <code>[]interface{}</code> you are unmarshalling to. </p>\n\n<p>As for the second part on how to assemble these into a single slice given multiple page reads you could punt that question to the caller by making the caller use a slice of slices type.</p>\n\n<pre><code>// Then in a method requesting all results for a single entity\nvar entityPages [][]Entity1\nclient.ListRequestAll(\"https://foo.bar/entities1.json\", &amp;entityPages)\n</code></pre>\n\n<p>This still has the unbounded memory consumption problem your general design has, however, since you have to load all of the pages / items at once. You might want to consider changing to an Open/Read abstraction like working with files. You'd have some <code>Open</code> method that returns another type that, like <code>os.File</code>, provides a method for reading a subset of data at a time, while internally requesting pages and buffering as needed.</p>\n\n<p>Perhaps something like this (untested):</p>\n\n<pre><code>type PagedReader struct {\n  c *Client\n\n  buffer []json.RawMessage\n\n  next string\n}\n\nfunc (r *PagedReader) getPage() {\n  f := r.c.ListRequest(r.next)\n  r.next = f.Data.Next\n  r.buffer = append(r.buffer, f.Data.Results...)\n}\n\nfunc (r *PagedReader) ReadItems(output []interface{}) int {\n  for len(output) &gt; len(buffer) &amp;&amp; r.next != \"\" {\n    r.getPage()\n  }\n\n  n := 0\n  for i:=0;i&lt;len(output)&amp;&amp;i&lt; len(r.buffer);i++ {\n    json.Unmarshal(r.buffer[i], output[i] )\n    n++\n  }\n  r.buffer = r.buffer[n:]\n  return n\n}\n</code></pre>\n"}], "owner": {"reputation": 1866, "user_id": 5405453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Me0YP.jpg?s=128&g=1", "display_name": "nijm", "link": "https://stackoverflow.com/users/5405453/nijm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 52090792, "answer_count": 1, "score": 2, "last_activity_date": 1535612092, "creation_date": 1535296005, "last_edit_date": 1535296398, "question_id": 52027531, "link": "https://stackoverflow.com/questions/52027531/unmarshalling-entities-from-multiple-json-arrays-without-using-reflect-or-duplic", "title": "Unmarshalling Entities from multiple JSON arrays without using reflect or duplicating code", "body": "<p>I'm making an JSON API wrapper client that needs to fetch paginated results, where the URL to the next page is provided by the previous page. To reduce code duplication for the 100+ entities that share the same response format, I would like to have a single client method that fetches and unmarshalls the different entities from all paginated pages.</p>\n\n<p>My current approach in a simplified (pseudo) version (without errors etc):</p>\n\n<pre><code>type ListResponse struct {\n    Data struct {\n        Results []interface{} `json:\"results\"`\n        Next    string        `json:\"__next\"`\n    } `json:\"d\"`\n}\n\nfunc (c *Client) ListRequest(uri string) listResponse ListResponse {\n    // Do a http request to uri and get the body\n    body := []byte(`{ \"d\": { \"__next\": \"URL\", \"results\": []}}`)\n    json.NewDecoder(body).Decode(&amp;listResponse)\n}\n\nfunc (c *Client) ListRequestAll(uri string, v interface{}) {\n    a := []interface{}\n    f := c.ListRequest(uri)\n    a = append(a, f.Data.Results...)\n\n    var next = f.Data.Next\n    for next != \"\" {\n        r := c.ListRequest(next)\n        a = append(a, r.Data.Results...)\n        next = r.Data.Next\n    }\n\n    b, _ := json.Marshal(a)\n    json.Unmarshal(b, v)\n}\n\n// Then in a method requesting all results for a single entity\nvar entities []Entity1\nclient.ListRequestAll(\"https://foo.bar/entities1.json\", &amp;entities)\n\n// and somewehere else\nvar entities []Entity2\nclient.ListRequestAll(\"https://foo.bar/entities2.json\", &amp;entities)\n</code></pre>\n\n<p>The problem however is that this approach is inefficient and uses too much memory etc, ie first Unmarshalling in a general <code>ListResponse</code> with results as <code>[]interface{}</code> (to see the next URL and concat the results into a single slice), then marshalling the <code>[]interface{}</code> for unmarshalling it directly aftwards in the destination slice of <code>[]Entity1</code>.</p>\n\n<p>I might be able to use the <code>reflect</code> package to dynamically make new slices of these entities, directly unmarshal into them and concat/append them afterwards, however if I understand correctly I better not use <code>reflect</code> unless strictly necessary...</p>\n"}, {"tags": ["go", "vgo"], "comments": [{"owner": {"reputation": 1670, "user_id": 811008, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5f9c1a97dc5daf7a7590bd38933d3229?s=128&d=identicon&r=PG", "display_name": "Halil Kaskavalci", "link": "https://stackoverflow.com/users/811008/halil-kaskavalci"}, "edited": false, "score": 2, "creation_date": 1540450878, "post_id": 52026284, "comment_id": 92872147, "body": "Hi David, if you believe my response answers your question please consider marking it as the answer. Thanks!"}, {"owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "edited": false, "score": 0, "creation_date": 1564557329, "post_id": 52026284, "comment_id": 101065418, "body": "maven golang plugin since 2.3.3 also allows to work with local modules (it automatically add local paths during build), you can take a look at some example <a href=\"https://github.com/raydac/mvn-golang/tree/master/mvn-golang-examples/mvn-golang-example-maven-module-mix\" rel=\"nofollow noreferrer\">github.com/raydac/mvn-golang/tree/master/mvn-golang-examples&zwnj;&#8203;/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "edited": false, "score": 0, "creation_date": 1540869532, "post_id": 52026558, "comment_id": 93012886, "body": "This was bang on - in the case of go modules - I have to follow vgo&#39;s pattern, where I start the path of the import statement with the module&#39;s name. Thanks!"}, {"owner": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "edited": false, "score": 17, "creation_date": 1554227509, "post_id": 52026558, "comment_id": 97671619, "body": "Wait, I&#39;m confused. If my module is just somewhere on my file system, how does the module system find it?"}, {"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 1, "creation_date": 1564688299, "post_id": 52026558, "comment_id": 101123641, "body": "If you are inside a module, it finds packages in the same module using the package import path &amp; the location of the <code>go.mod</code> file on disk, as long as the import paths are full import paths that start with the module name (e.g., <code>import &quot;github.com&#47;my&#47;module&#47;pkg</code>&quot;`). If you want to find packages in other modules that are located elsewhere on your disk, then that is where a <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">replace</a> directive comes in. This <a href=\"https://stackoverflow.com/a/57314494/11210494\">answer</a> covers more on module structure and import paths."}, {"owner": {"reputation": 7443, "user_id": 310662, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ce57d6e4ca826a201cb5cf1e8595cdb?s=128&d=identicon&r=PG", "display_name": "holms", "link": "https://stackoverflow.com/users/310662/holms"}, "edited": false, "score": 8, "creation_date": 1582905867, "post_id": 52026558, "comment_id": 106949689, "body": "Why everyone keep using url formats? Question was very clear: localmodule/localmodule.go that&#39;s it. Why there&#39;s githubs and example.com&#39;s in here?"}, {"owner": {"reputation": 485, "user_id": 4893106, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-D59LRZ5jwr4/AAAAAAAAAAI/AAAAAAAAAFo/4U_1kHzqng0/photo.jpg?sz=128", "display_name": "user4893106", "link": "https://stackoverflow.com/users/4893106/user4893106"}, "reply_to_user": {"reputation": 7443, "user_id": 310662, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ce57d6e4ca826a201cb5cf1e8595cdb?s=128&d=identicon&r=PG", "display_name": "holms", "link": "https://stackoverflow.com/users/310662/holms"}, "edited": false, "score": 1, "creation_date": 1588889266, "post_id": 52026558, "comment_id": 109082845, "body": "@holms the answer and the comment above yours explain it, but to clarify, the language has no mechanism to locate internal packages, only the go tool does. the go tool depends on either GOPATH or the module configuration (go.mod). you are, in essence, using the go tools ability to treat your local packages the same as <i>any other kind of package</i>. see also some of the other answers on this question."}, {"owner": {"reputation": 1776, "user_id": 5442187, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ebca55bf5db19f6d491777f5420b0dfe?s=128&d=identicon&r=PG&f=1", "display_name": "uberrebu", "link": "https://stackoverflow.com/users/5442187/uberrebu"}, "edited": false, "score": 0, "creation_date": 1619131296, "post_id": 52026558, "comment_id": 118819696, "body": "my issue is why must module have <code>github.com</code>...the question is talking about local files, why must answer contain a url??? that is my issue here...is it difficult to use file path like other programming languages? or must we treat everything like external url?"}], "tags": [], "owner": {"reputation": 1670, "user_id": 811008, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5f9c1a97dc5daf7a7590bd38933d3229?s=128&d=identicon&r=PG", "display_name": "Halil Kaskavalci", "link": "https://stackoverflow.com/users/811008/halil-kaskavalci"}, "is_accepted": true, "score": 54, "last_activity_date": 1535290294, "last_edit_date": 1535290294, "creation_date": 1535288926, "answer_id": 52026558, "question_id": 52026284, "link": "https://stackoverflow.com/questions/52026284/accessing-local-packages-within-a-go-module-go-1-11/52026558#52026558", "title": "Accessing local packages within a go module (go 1.11)", "body": "<p>I would strongly suggest you to use go toolchain which takes care of these issues out of the box. Visual Studio Code with vscode-go plugin is really useful.</p>\n\n<p>Problem here is that Go requires relative paths with respect to your <code>$GOPATH/src</code> or <code>module</code> in import statement. Depending on where you are in your <code>GOPATH</code>, import path should include that as well. In this case, import statement must include go module path in <code>go.mod</code></p>\n\n<p><strong>GOPATH</strong></p>\n\n<p>Assume your project resides here:</p>\n\n<pre><code>$GOPATH/src/github.com/myuser/myproject\n</code></pre>\n\n<p>Your import path should be:</p>\n\n<pre><code>import \"github.com/myuser/myproject/platform\"\n</code></pre>\n\n<p><strong>VGO</strong></p>\n\n<p>Assume your go.mod file is:</p>\n\n<pre><code>module example.com/myuser/myproject\n</code></pre>\n\n<p>Your import path should be:</p>\n\n<pre><code>import \"example.com/myuser/myproject/platform\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 827, "user_id": 8501960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XInru.jpg?s=128&g=1", "display_name": "Adis Azhar", "link": "https://stackoverflow.com/users/8501960/adis-azhar"}, "edited": false, "score": 4, "creation_date": 1566139760, "post_id": 55347424, "comment_id": 101554458, "body": "OMG this answer helped me so much. Thanks :)"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1569492069, "post_id": 55347424, "comment_id": 102617954, "body": "I have used a go.mod containing only the replace directive, the require directive was not required to build the project."}, {"owner": {"reputation": 430, "user_id": 1573889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df58ff513ead62a997e1fed052f7a39c?s=128&d=identicon&r=PG&f=1", "display_name": "kokemomuke", "link": "https://stackoverflow.com/users/1573889/kokemomuke"}, "edited": false, "score": 1, "creation_date": 1581498093, "post_id": 55347424, "comment_id": 106450356, "body": "also good example: <a href=\"https://forum.golangbridge.org/t/go-module-and-importing-local-package/11649\" rel=\"nofollow noreferrer\">forum.golangbridge.org/t/go-module-and-importing-local-packa&zwnj;&#8203;ge/&hellip;</a>"}, {"owner": {"reputation": 1776, "user_id": 5442187, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ebca55bf5db19f6d491777f5420b0dfe?s=128&d=identicon&r=PG&f=1", "display_name": "uberrebu", "link": "https://stackoverflow.com/users/5442187/uberrebu"}, "edited": false, "score": 0, "creation_date": 1619131324, "post_id": 55347424, "comment_id": 118819702, "body": "my issue is why must module have github.com...the question is talking about local files, why must answer contain a url??? that is my issue here...is it difficult to use file path like other programming languages? or must we treat everything like external url?"}], "tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 135, "last_activity_date": 1553553691, "creation_date": 1553553691, "answer_id": 55347424, "question_id": 52026284, "link": "https://stackoverflow.com/questions/52026284/accessing-local-packages-within-a-go-module-go-1-11/55347424#55347424", "title": "Accessing local packages within a go module (go 1.11)", "body": "<p>Let me define this first <code>modules</code> are collections of <code>packages</code>. In Go 11, I use <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"noreferrer\">go modules</a> like the following: </p>\n\n<p>If both packages are in the same project, you could just do the following: \nIn <code>go.mod</code>: </p>\n\n<p><code>module github.com/userName/moduleName</code></p>\n\n<p>and inside your <code>main.go</code></p>\n\n<p><code>import \"github.com/userName/moduleName/platform\"</code></p>\n\n<p>However, if they are separate modules, i.e different physical paths and you still want to import local <code>packages</code> without publishing this remotely to github for example, you could achieve this by using <code>replace</code> directive.</p>\n\n<p>Given the module name <code>github.com/otherModule</code> and <code>platform</code>, as you've called it, is the only package inside there. In your main module's <code>go.mod</code> add the following lines:</p>\n\n<pre><code>module github.com/userName/mainModule\n\nrequire \"github.com/userName/otherModule\" v0.0.0\nreplace \"github.com/userName/otherModule\" v0.0.0 =&gt; \"local physical path to the otherModule\"\n</code></pre>\n\n<p>Note: The path should point to the root directory of the module, and can be absolute or relative.</p>\n\n<p>Inside <code>main.go</code>, to import a specific package like <code>platform</code> from <code>otherModule</code>:</p>\n\n<pre><code>import \"github.com/userName/otherModule/platform\"\n</code></pre>\n\n<p>Here's a <a href=\"https://ukiahsmith.com/blog/a-gentle-introduction-to-golang-modules/\" rel=\"noreferrer\">gentle introduction</a> to Golang Modules</p>\n"}], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68918, "favorite_count": 37, "accepted_answer_id": 52026558, "answer_count": 2, "score": 87, "last_activity_date": 1594975102, "creation_date": 1535286724, "question_id": 52026284, "link": "https://stackoverflow.com/questions/52026284/accessing-local-packages-within-a-go-module-go-1-11", "title": "Accessing local packages within a go module (go 1.11)", "body": "<p>I'm trying out Go's new modules system and am having trouble accessing local packages. The following project is in a folder on my desktop outside my gopath.</p>\n\n<p>My project structure looks like:</p>\n\n<pre><code>/\n  - /platform\n      - platform.go\n  - main.go\n  - go.mod\n</code></pre>\n\n<hr>\n\n<pre><code>// platform.go\npackage platform\n\nimport \"fmt\"\n\nfunc Print() {\n    fmt.Println(\"Hi\")\n}\n</code></pre>\n\n<hr>\n\n<pre><code>// main.go\npackage main\n\nimport \"platform\"\n\nfunc main() {\n    platform.Print()\n}\n</code></pre>\n\n<p><code>go build main.go</code> tells me</p>\n\n<pre><code>cannot find module for path platform\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose", "vgo", "go-modules"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1537834309, "post_id": 52026177, "comment_id": 91918925, "body": "you can always perform the go build up on host then just supply the binary to your container ... in my case the compile happens inside a different container"}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1542382577, "post_id": 52026177, "comment_id": 93560828, "body": "Note that you are using go1.11rc2, which is a release candidate, not the final go1.11 release."}], "answers": [{"comments": [{"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 1, "creation_date": 1537764434, "post_id": 52027560, "comment_id": 91887351, "body": "You also can create a new volume to keep an isolate gopath inside the docker container"}, {"owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "reply_to_user": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1537777030, "post_id": 52027560, "comment_id": 91891798, "body": "@Motakjuq How would that look like in the docker-compose file?"}], "tags": [], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "is_accepted": true, "score": 5, "last_activity_date": 1535296321, "creation_date": 1535296321, "answer_id": 52027560, "question_id": 52026177, "link": "https://stackoverflow.com/questions/52026177/how-can-i-persist-go-1-11-modules-in-a-docker-container/52027560#52027560", "title": "How can I persist go 1.11 modules in a Docker container?", "body": "<p>This is not mentioned in the wiki article on modules, but from reading the updated docs on the <a href=\"https://golang.org/cmd/go/#hdr-GOPATH_and_Modules\" rel=\"noreferrer\">go tool</a>, I found out that when using Go modules, the <code>go</code> tool will still use <code>GOPATH</code> to store the available sources, namely <code>$GOPATH/pkg/mod</code>.</p>\n\n<p>This means that for my local dev setup, I can 1. define the <code>GOPATH</code> in the container and 2. mount the local <code>$GOPATH/pkg/mod</code> into the container's GOPATH.</p>\n\n<pre><code>web:\n  image: golang:1.11rc2\n  working_dir: /app\n  volumes:\n    - .:/app\n    - $GOPATH/pkg/mod:/go/pkg/mod\n  environment:\n    - GOPATH=/go\n    - PORT=9999\n  command: go run cmd/my-project/main.go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "is_accepted": false, "score": 3, "last_activity_date": 1537810458, "creation_date": 1537810458, "answer_id": 52484542, "question_id": 52026177, "link": "https://stackoverflow.com/questions/52026177/how-can-i-persist-go-1-11-modules-in-a-docker-container/52484542#52484542", "title": "How can I persist go 1.11 modules in a Docker container?", "body": "<p>You can use a volume instead of your local <code>GOPATH</code>. the docker-compose.yml is like:</p>\n\n<pre><code>version: '3'\n\nservices:\n  web:\n    image: golang:1.11\n    working_dir: /app\n    volumes:\n        - .:/app\n        - cache:/go\n    environment:\n        - PORT=9999\n    command: go run cmd/my-project/main.go\n\nvolumes:\n  cache:\n</code></pre>\n\n<p>The volume <code>cache</code> is going to persist all the changes on the GOPATH for the container.</p>\n"}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2625, "favorite_count": 1, "accepted_answer_id": 52027560, "answer_count": 2, "score": 7, "last_activity_date": 1537810458, "creation_date": 1535285934, "last_edit_date": 1535290190, "question_id": 52026177, "link": "https://stackoverflow.com/questions/52026177/how-can-i-persist-go-1-11-modules-in-a-docker-container", "title": "How can I persist go 1.11 modules in a Docker container?", "body": "<p>I am migrating a Go 1.10 app to Go 1.11. This also includes migrating from <a href=\"https://golang.github.io/dep/\" rel=\"noreferrer\"><code>dep</code></a> to <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"noreferrer\"><code>mod</code></a> for managing dependencies.</p>\n\n<p>As the application depends on a database, I am using a <code>docker-compose</code> to set up the local development environment. With Go 1.10 I simply mounted the local repository (including the <code>vendor</code> folder) into the correct location in the container's <code>GOPATH</code>:</p>\n\n<pre><code>web:\n  image: golang:1.10\n  working_dir: /go/src/github.com/me/my-project\n  volumes:\n    - .:/go/src/github.com/me/my-project\n  environment:\n    - GOPATH=/go\n    - PORT=9999\n  command: go run cmd/my-project/main.go\n</code></pre>\n\n<p>Since Go 1.11 ditches <code>GOPATH</code> (when using modules that is) I thought I could just do the following:</p>\n\n<pre><code>web:\n  image: golang:1.11rc2\n  working_dir: /app\n  volumes:\n    - .:/app\n  environment:\n    - PORT=9999\n  command: go run cmd/my-project/main.go\n</code></pre>\n\n<p>This works, but every time I <code>docker-compose up</code> (or any other command that calls through to the Go tool) it will resolve and re-download the dependency tree from scratch. This does not happen (rather only once) when I run the command outside of the container (i.e. on my local OS).</p>\n\n<p>How can I improve the setup so that the Docker container persists the modules being downloaded by the <code>go</code> tool?</p>\n"}, {"tags": ["go", "slice", "channel"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 5, "creation_date": 1535280172, "post_id": 52025354, "comment_id": 91001083, "body": "channelsMap = make(map[string](chan *TestStruct)) in main function and you are done. := means declaration in short form. Doing this you shadow channelsMap declared in the global scope."}, {"owner": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1535280600, "post_id": 52025354, "comment_id": 91001159, "body": "@Uvelichitel OMG :D Thanks! You should post that answer so I can choose it."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1535281624, "post_id": 52025354, "comment_id": 91001382, "body": "you should update your question&#39;s title to something more concise"}, {"owner": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1535290863, "post_id": 52025354, "comment_id": 91003790, "body": "Any suggestions, @ScottStensland ?"}], "answers": [{"tags": [], "owner": {"reputation": 138, "user_id": 922019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be72b4785934e0aee445550e393e82ab?s=128&d=identicon&r=PG", "display_name": "jecolon", "link": "https://stackoverflow.com/users/922019/jecolon"}, "is_accepted": false, "score": 0, "last_activity_date": 1535287485, "creation_date": 1535287485, "answer_id": 52026370, "question_id": 52025354, "link": "https://stackoverflow.com/questions/52025354/cant-get-map-of-channels-to-work/52026370#52026370", "title": "Can&#39;t get map of channels to work", "body": "<p>The shadowing in main of channelsMap mentioned above was a critical bug, but aside from that, the program was playing \"Russian roulette\" with the calls to time.After so that main wouldn't finish before the watcher goroutines did. This is unstable and unreliable, so I recommend the following approach using a channel to signal when all watcher goroutines are done:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype TestStruct struct {\n    Test string\n}\n\nvar channelsMap map[string](chan *TestStruct)\n\nfunc main() {\n    stringsSlice := []string{\"value1\", \"value2\", \"value3\"}\n    structsSlice := []TestStruct{\n        {\"Hello1\"},\n        {\"Hello2\"},\n        {\"Hello3\"},\n    }\n    channelsMap = make(map[string](chan *TestStruct))\n    // Signal channel to wait for watcher goroutines.\n    done := make(chan struct{})\n\n    for _, s := range stringsSlice {\n        channelsMap[s] = make(chan *TestStruct)\n        // Give watcher goroutines the signal channel.\n        go watchChannel(s, done)\n    }\n\n    for _, ts := range structsSlice {\n        for _, s := range stringsSlice {\n            channelsMap[s] &lt;- &amp;ts\n        }\n    }\n\n    // Close the channels so watcher goroutines can finish.\n    for _, s := range stringsSlice {\n        close(channelsMap[s])\n    }\n\n    // Wait for all watcher goroutines to finish.\n    for range stringsSlice {\n        &lt;-done\n    }\n    // Now we're really done!\n    fmt.Println(\"Program ended\")\n}\n\nfunc watchChannel(channelMapKey string, done chan&lt;- struct{}) {\n    fmt.Println(\"Watching channel: \" + channelMapKey)\n    for channelValue := range channelsMap[channelMapKey] {\n        fmt.Printf(\"Channel '%s' used. Passed value: '%s'\\n\", channelMapKey, channelValue.Test)\n    }\n    done &lt;- struct{}{}\n}\n</code></pre>\n\n<p>(Go Playground link: <a href=\"https://play.golang.org/p/eP57Ru44-NW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eP57Ru44-NW</a>)</p>\n\n<p>Of importance is the use of the done channel to let watcher goroutines signal that they're finished to main. Another critical part is the closing of the channels once you're done with them. If you don't close them, the range loops in the watcher goroutines will never end, waiting forever. Once you close the channel, the range loop exits and the watcher goruoutine can send on the done channel, signaling that it has finished working.</p>\n\n<p>Finally, back in main, you have to receive on the done channel once for each watcher goroutine you created. Since the number of watcher goroutines is equal to the number of items in stringsSlice, you simply range over stringsSlice to receive the correct amount of times from the done channel. Once that's finished, the main function can exit with a guarantee that all watchers have finished.</p>\n"}, {"comments": [{"owner": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "edited": false, "score": 0, "creation_date": 1535290811, "post_id": 52026514, "comment_id": 91003767, "body": "Thank you for the descriptive answer. Just for info: I only used the &quot;sleeps&quot; because I wanted to make sure the prototype worked similarly to my actual code. Having a signal sent in a later time so i could ask about the problem I was having."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "edited": false, "score": 1, "creation_date": 1535293693, "post_id": 52026514, "comment_id": 91004539, "body": "I do not want to sound harsh, but let me have this straight: sleeps should never ever be used for anything in Go code except rare cases of implementing something like &quot;retrying an action after a random delay&quot; (akin to exponential backoff in Ethernet). Using sleeping for synchronization is asking for trouble\u2014you might have evaded possible problems in this particular case but in another it will bite you in the neck. Just structure your concurrent code correctly up front, and there will never be any reasons for sleeping. This is a crucial skill to gain."}, {"owner": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "edited": false, "score": 0, "creation_date": 1535293961, "post_id": 52026514, "comment_id": 91004624, "body": "As I said, I only used them to write this little example prototype so the main problem could be reproduced easily. I&#39;ll keep your advice in mind, thank you!"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "edited": false, "score": 1, "creation_date": 1535294300, "post_id": 52026514, "comment_id": 91004710, "body": "My message seems to not coming across. To make it extra clear, it&#39;s absolutely possible for any number (including all) of your &quot;waiter&quot; goroutines to not even begin executing by the time the second calls to <code>time.After</code> terminates. Your common sense tells you it&#39;s impossible, but anyone working with Go in production sooner or later will see that it <i>is</i> possible. So my point is not to solicit any sort of excuse from you, but rather is to make you (and whoever happening to read this thread) unlearn this approach completely. I&#39;m not <i>blaming</i> you for anything, so there&#39;s no point in defending."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 3, "last_activity_date": 1535289399, "last_edit_date": 1535289399, "creation_date": 1535288622, "answer_id": 52026514, "question_id": 52025354, "link": "https://stackoverflow.com/questions/52025354/cant-get-map-of-channels-to-work/52026514#52026514", "title": "Can&#39;t get map of channels to work", "body": "<p>There are many problems with your approach.</p>\n\n<p>The first one is that you're redeclaring (\"shadowing\") the global\nvariable <code>channelsMap</code> in your <code>main</code> function.\n(Had you completed at least some\n<a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">most basic intro to Go</a>, you should have had no such problem.)</p>\n\n<p>This means that your <code>watchChannel</code> (actually, all the goroutines which execute that function) read the global <code>channelsMap</code> while your <code>main</code> function writes to its local <code>channelsMap</code>.</p>\n\n<p>What happens next, is as follows:</p>\n\n<ol>\n<li><p><a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">The <code>range</code> statement</a>\nin the <code>watchChannel</code> has a simple\nmap lookup expression as its source\u2014<code>channelsMap[channelMapKey]</code>.</p>\n\n<p>In Go, this form of <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">map lookup</a>\n<em>never fails,</em> but if the map has no such key (or if the map is not initialized, that is, it's <code>nil</code>), the so-called\n<a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">\"zero value\"</a>\nof the appropriate type is returned.</p></li>\n<li><p>Since the global <code>channelsMap</code> is always empty, any call to <code>watchChannel</code> performs a map lookup which always returns\nthe zero value of type <code>chan *TestStruct</code>.\nThe zero value for any channel is <code>nil</code>.</p></li>\n<li><p>The <code>range</code> statement executed over a <code>nil</code> channel\n<a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">produces zero iterations</a>.\nIn other words, the <code>for</code> loop in <code>watchChannel</code> always executes\nzero times.</p></li>\n</ol>\n\n<p>The more complex problem, still, is not shadowing of the global variable but rather the complete absense of synchronization between the goroutines. You're using \"sleeping\" as a sort of band-aid in an attempt to perform <em>implicit</em> synchronization between goroutines\nbut while this does appear to be okay judged by so-called\n\"common sense\", it's not going to work in practice for two\nreasons:</p>\n\n<ul>\n<li>Sleeping is <em>always</em> a na\u00efve approach to synchronization as it solely depens of the fact all the goroutines will run relatively freely and uncontended. This is far from being true in many (if not most) production settings and hence is always the reason for subtle bugs. Don't ever do that again, please.</li>\n<li>Nothing in the <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">Go memory model</a>\nsays that waiting against wall-clock timing is considered by the runtime as establishing the order on how execution of different goroutines relate to each other.</li>\n</ul>\n\n<p>There exist various ways to synchronize execution between goroutines. Basically they amount to sends and receives over channels and using the types provided by the <code>sync</code> package.\nIn your particular case the simplest approach is probably using the <code>sync.WaitGroup</code> type.</p>\n\n<p><a href=\"https://play.golang.org/p/d-UGXVDXoTz\" rel=\"nofollow noreferrer\">Here</a> is what we would\nhave after fixing the problems explained above:\n- Initialize the map variable right at the point of its\ndefinition and not mess with it in <code>main</code>.\n- Use <code>sync.WaitGroup</code> to make <code>main</code> properly wait for all\nthe goroutines it spawned to singal they're done:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype TestStruct struct {\n    Test string\n}\n\nvar channelsMap = make(map[string](chan *TestStruct))\n\nfunc main() {\n    stringsSlice := []string{\"value1\"}\n\n    var wg sync.WaitGroup\n\n    wg.Add(len(stringsSlice))\n    for _, value := range stringsSlice {\n        channelsMap[value] = make(chan *TestStruct, 1)\n\n        go watchChannel(value, &amp;wg)\n    }\n\n    testStruct := new(TestStruct)\n    testStruct.Test = \"Hello!\"\n    channelsMap[\"value1\"] &lt;- testStruct\n\n    wg.Wait()\n    fmt.Println(\"Program ended\")\n}\n\nfunc watchChannel(channelMapKey string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Watching channel: \" + channelMapKey)\n\n    for channelValue := range channelsMap[channelMapKey] {\n        fmt.Printf(\"Channel '%s' used. Passed value: '%s'\\n\", channelMapKey, channelValue.Test)\n    }\n\n}\n</code></pre>\n\n<hr>\n\n<p>The next two problems with your code become apparent once we will\nhave fixed the former two\u2014after you make the \"watcher\" goroutines\nuse the same map variable as the goroutine running <code>main</code>, and\nmake the latter properly wait for the watchers:</p>\n\n<ul>\n<li><p>There is a <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">data race</a>\nover the map variable between the\ncode which updates the map after the <code>for</code> loop spawning the\nwatcher goroutines ended and the code which accesses this\nvariable in all the watcher goroutines.</p></li>\n<li><p>There is a <a href=\"https://en.wikipedia.org/wiki/Deadlock\" rel=\"nofollow noreferrer\">deadlock</a>\nbetween the watcher goroutines and the main goroutine which waits for them to complete.</p>\n\n<p>The reason for the deadlock is that the watcher goroutines\nnever receive any signal they have to quit processing and\nhence are stuck forever trying to read from their respective\nchannels.</p></li>\n</ul>\n\n<p>The ways to fix these two new problems are simple but they\nmight actually \"break\" your original idea of structuring\nyour code.</p>\n\n<p>First, I'd remove the data race by simply making the watchers\n<em>not access the map variable.</em> As you can see, each call to\n<code>watchChannel</code> receives a single value to use as the key to\nread a value off the shared map, and hence each watcher always\nreads a single value exactly once during its run time.\nThe code would become much clearer if we remove this extra\nmap access altogether and instead pass the appropriate channel\nvalue directly to each watcher.\nA nice byproduct of this is that we do not need a global\nmap variable anymore.</p>\n\n<p><a href=\"https://play.golang.org/p/ysB3h37k1d4\" rel=\"nofollow noreferrer\">Here</a>'s what we'll get:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype TestStruct struct {\n    Test string\n}\n\nfunc main() {\n    stringsSlice := []string{\"value1\"}\n    channelsMap := make(map[string](chan *TestStruct))\n\n    var wg sync.WaitGroup\n\n    wg.Add(len(stringsSlice))\n    for _, value := range stringsSlice {\n        channelsMap[value] = make(chan *TestStruct, 1)\n\n        go watchChannel(value, channelsMap[value], &amp;wg)\n    }\n\n    testStruct := new(TestStruct)\n    testStruct.Test = \"Hello!\"\n    channelsMap[\"value1\"] &lt;- testStruct\n\n    wg.Wait()\n    fmt.Println(\"Program ended\")\n}\n\nfunc watchChannel(channelMapKey string, ch &lt;-chan *TestStruct, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Watching channel: \" + channelMapKey)\n\n    for channelValue := range ch {\n        fmt.Printf(\"Channel '%s' used. Passed value: '%s'\\n\", channelMapKey, channelValue.Test)\n    }\n\n}\n</code></pre>\n\n<p>Okay, we still have the deadlock.</p>\n\n<p>There are multiple approaches to solving this but they depend\non the actual circumstances, and with this toy example, any\nattempt to iterate over at least a subset of them would just\nmuddle the waters.\nInstead, let's employ the simplest one for this case: closing\na channel makes any pending receive operation on it immediately\nunblock and produce the zero value for the channel's type.\nFor a channel being iterated over using the <code>range</code> statement\nit simply means the stamement terminates without producing any\nvalue from the channel.</p>\n\n<p>In other words, let's just close all the channels to unblock\nthe <code>range</code> statements being run by the watcher goroutines\nand then wait for these goroutines to report their completion via the wait group.</p>\n\n<p>To not make the answer overly long, I also added programmatic initialization of the string slice to make the example more interesting by having multiple watchers\u2014not just a single one\u2014actually do useful work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype TestStruct struct {\n    Test string\n}\n\nfunc main() {\n    var stringsSlice []string\n    channelsMap := make(map[string](chan *TestStruct))\n\n    for i := 1; i &lt;= 10; i++ {\n        stringsSlice = append(stringsSlice, fmt.Sprintf(\"value%d\", i))\n    }\n\n    var wg sync.WaitGroup\n\n    wg.Add(len(stringsSlice))\n    for _, value := range stringsSlice {\n        channelsMap[value] = make(chan *TestStruct, 1)\n\n        go watchChannel(value, channelsMap[value], &amp;wg)\n    }\n\n    for _, value := range stringsSlice {\n        testStruct := new(TestStruct)\n        testStruct.Test = fmt.Sprint(\"Hello! \", value)\n        channelsMap[value] &lt;- testStruct\n    }\n\n    for _, ch := range channelsMap {\n        close(ch)\n    }\n\n    wg.Wait()\n    fmt.Println(\"Program ended\")\n}\n\nfunc watchChannel(channelMapKey string, ch &lt;-chan *TestStruct, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Watching channel: \" + channelMapKey)\n\n    for channelValue := range ch {\n        fmt.Printf(\"Channel '%s' used. Passed value: '%s'\\n\", channelMapKey, channelValue.Test)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/urOoixhmYkj\" rel=\"nofollow noreferrer\">Playground link</a>.</p>\n\n<hr>\n\n<p>As you can see, there are things you should actually learn\nabout in way more greater detail before embarking on working with\nconcurrency.</p>\n\n<p>I'd recommend to proceed in the following order:</p>\n\n<ol>\n<li><a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">The Go tour</a> would make you accustomed with the bare bones of concurrency.</li>\n<li><a href=\"http://www.gopl.io\" rel=\"nofollow noreferrer\">The Go Programming Language</a> has two chapters dedicated to providing the readers with a gentle introduction with tackling concurrency both using channels and the types from the <code>sync</code> package.</li>\n<li><a href=\"https://katherine.cox-buday.com/concurrency-in-go/\" rel=\"nofollow noreferrer\">Concurrency In Go</a> goes on with presenting more hard-core details of how one deals with concurrency in Go, including advanced topics approaching the real-world problems concurrent programs face in production\u2014such as ways to rate-limit incoming requests.</li>\n</ol>\n"}], "owner": {"reputation": 713, "user_id": 1932856, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f08a608883c7171eca9f0fc6ea42b380?s=128&d=identicon&r=PG", "display_name": "Th3B0Y", "link": "https://stackoverflow.com/users/1932856/th3b0y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1132, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1535289399, "creation_date": 1535279373, "last_edit_date": 1535279691, "question_id": 52025354, "link": "https://stackoverflow.com/questions/52025354/cant-get-map-of-channels-to-work", "title": "Can&#39;t get map of channels to work", "body": "<p>This might be a rookies mistake. I have a slice with a string value and a map of channels. For each string in the slice, a channel is created and a map entry is created for it, with the string as key.</p>\n\n<p>I watch the channels and pass a value to one of them, which is never found.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype TestStruct struct {\n    Test string\n}\n\nvar channelsMap map[string](chan *TestStruct)\n\nfunc main() {\n    stringsSlice := []string{\"value1\"}\n    channelsMap := make(map[string](chan *TestStruct))\n\n    for _, value := range stringsSlice {\n        channelsMap[value] = make(chan *TestStruct, 1)\n\n        go watchChannel(value)\n    }\n\n    &lt;-time.After(3 * time.Second)\n\n    testStruct := new(TestStruct)\n    testStruct.Test = \"Hello!\"\n    channelsMap[\"value1\"] &lt;- testStruct\n\n    &lt;-time.After(3 * time.Second)\n    fmt.Println(\"Program ended\")\n}\n\nfunc watchChannel(channelMapKey string) {\n    fmt.Println(\"Watching channel: \" + channelMapKey)\n\n    for channelValue := range channelsMap[channelMapKey] {\n        fmt.Printf(\"Channel '%s' used. Passed value: '%s'\\n\", channelMapKey, channelValue.Test)\n    }\n\n}\n</code></pre>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/IbucTqMjdGO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IbucTqMjdGO</a></p>\n\n<p>Output:</p>\n\n<pre><code>Watching channel: value1\nProgram ended\n</code></pre>\n\n<p>How do I execute something when the message is fed into the channel?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535277262, "post_id": 52025064, "comment_id": 91000415, "body": "Put your Go code in the question directly. Links tend to go stale, and nobody should have to follow a link to understand your question."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 1854347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c818c59c72a0f78b55d5a83544a92c29?s=128&d=identicon&r=PG", "display_name": "teejays", "link": "https://stackoverflow.com/users/1854347/teejays"}, "is_accepted": true, "score": 0, "last_activity_date": 1535294482, "creation_date": 1535294482, "answer_id": 52027322, "question_id": 52025064, "link": "https://stackoverflow.com/questions/52025064/golang-connect-to-ssh-using-ssh-and-print-error-exceptions/52027322#52027322", "title": "golang connect to ssh using ssh and print error exceptions", "body": "<p>First of all, I feel the approach you're taking is a little odd. Python and Go are two distinct programming languages, with different coding paradigms and totally different ways of handling error/exceptions. Hence, starting with a piece of Python code and converting it to Go might not always be straightforward. </p>\n\n<p>Since your question is eventually about handling exceptions, this is a simple article on how Go handles errors: <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/error-handling-and-go</a>\n(In summary, functions deliberately return errors as values, and anyone who calls the functions checks if an error has been returned and then does whatever it wants e.g. panic, print the error, or return the error upstream, etc.)</p>\n\n<p>In the Go Playground link you provided, a lot of things can be discussed - the use of ssh package, handling or errors etc. Here is a quick code focusing on the exception handling (and not the ssh package and logic). </p>\n\n<p><strong>NOTE</strong>: This is NOT a demonstartion of how to use the ssh package to authenticate, so please don't use it for such. This is just an example of how I would introduce custom standardized exceptions/errors in the logic.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"golang.org/x/crypto/ssh\"\n)\n\nvar ErrInvalidUsername error = fmt.Errorf(\"Invalid Username\")\nvar ErrAuthenticationFailed error = fmt.Errorf(\"Authentication Failure\")\nvar ErrPublicKeyNotParsed error = fmt.Errorf(\"Could not parse the public key\")\n\nfunc AuthenticateExample(username string, publicKey []byte) error {\n    // let's assume there is a function isValidUsername that takes a username and returns bool \n    if !isValidUsername(username) { \n        return ErrInvalidUsername\n    }\n\n    // do your ssh auth logic here, call ssh package functions which will return an error\n    // such as...\n    pubKey, err := ssh.ParseKey(publicKey)\n    if err != nil {\n        return ErrPublicKeyNotParsed \n        // OR you could simple also return the err variable itself by using:\n        // return err\n    }\n\n    // do more logic, and return ErrAuthenticationFailure is needed\n    // ... \n\n    return nil // since there is no error if we reach this line\n}\n</code></pre>\n\n<p>I hope this helps explain Go's exception handling a little. Good luck!</p>\n"}], "owner": {"reputation": 33, "user_id": 9952873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/332034dd6a3629a2a170f962ec0829c7?s=128&d=identicon&r=PG&f=1", "display_name": "Bello Daniel", "link": "https://stackoverflow.com/users/9952873/bello-daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 52027322, "answer_count": 1, "score": -2, "last_activity_date": 1535294482, "creation_date": 1535276988, "last_edit_date": 1535277237, "question_id": 52025064, "link": "https://stackoverflow.com/questions/52025064/golang-connect-to-ssh-using-ssh-and-print-error-exceptions", "title": "golang connect to ssh using ssh and print error exceptions", "body": "<p>I want to convert python code in golang version, this is my python code:</p>\n\n<pre><code>#!/usr/bin/env python\n\nimport argparse\nimport logging\nimport paramiko\nimport socket\nimport sys\n\n\nclass InvalidUsername(Exception):\n    pass\n\n\ndef add_boolean(*args, **kwargs):\n    pass\n\n\nold_service_accept = paramiko.auth_handler.AuthHandler._handler_table[\n        paramiko.common.MSG_SERVICE_ACCEPT]\n\ndef service_accept(*args, **kwargs):\n    paramiko.message.Message.add_boolean = add_boolean\n    return old_service_accept(*args, **kwargs)\n\n\ndef userauth_failure(*args, **kwargs):\n    raise InvalidUsername()\n\n\nparamiko.auth_handler.AuthHandler._handler_table.update({\n    paramiko.common.MSG_SERVICE_ACCEPT: service_accept,\n    paramiko.common.MSG_USERAUTH_FAILURE: userauth_failure\n})\n\n#logging.getLogger('paramiko.transport').addHandler(logging.NullHandler())\n\nsock = socket.socket()\nsock.connect((\"206.189.86.110\", 22))\n\ntransport = paramiko.transport.Transport(sock)\ntransport.start_client()\n\ntry:\n    transport.auth_publickey(\"root\", paramiko.RSAKey.generate(2048))\nexcept InvalidUsername:\n    print '[*] Invalid username'\n    sys.exit(3)\nexcept paramiko.ssh_exception.AuthenticationException:\n    print '[+] Valid username'\n</code></pre>\n\n<p>this is my curent golang code : <a href=\"https://play.golang.org/p/rzZ7f_if7Wk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rzZ7f_if7Wk</a> , I want to create same exception like python code version <code>except InvalidUsername:</code> and <code>paramiko.ssh_exception.AuthenticationException</code> , how I can do this?</p>\n"}, {"tags": ["go", "jwt", "auth0", "jwk"], "answers": [{"comments": [{"owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1535298727, "post_id": 52025767, "comment_id": 91005993, "body": "Thanks!  I think in that case I will add a <code>expAt</code> key to the struct of 6 hours or something and hope that works."}, {"owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1535302063, "post_id": 52025767, "comment_id": 91006941, "body": "hey i updated above since i realized that there is indeed a client with cache option :)"}, {"owner": {"reputation": 1058, "user_id": 991875, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/adbdc4188db5bc3c8bb70ede5296e3a3?s=128&d=identicon&r=PG", "display_name": "Yuriy", "link": "https://stackoverflow.com/users/991875/yuriy"}, "edited": false, "score": 1, "creation_date": 1614944306, "post_id": 52025767, "comment_id": 117546177, "body": "Take into account that when the keys are compromised - they might be regenerated in your Identity Provider. You will be still using your old compromised cached keys for token verification."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 2, "last_activity_date": 1535282769, "creation_date": 1535282769, "answer_id": 52025767, "question_id": 52024874, "link": "https://stackoverflow.com/questions/52024874/is-it-a-bad-idea-to-cache-auth0-jwk/52025767#52025767", "title": "Is it a bad idea to cache auth0 JWK", "body": "<p>It should almost definitely be safe to cache the client object, and doing so tends to be a good idea in general.  (\"Create one client and reuse it\" is a good general rule.)</p>\n\n<p>My understanding is that the signing keys for JWTs are typically valid for months if not longer.  (<a href=\"https://auth0.com/docs/jwks\" rel=\"nofollow noreferrer\">Auth0's documentation notes</a> that its JWKS documents only ever have a single key, but it will issue signed tokens all the time, so the keys must be valid for \"a while\".)  <a href=\"https://tools.ietf.org/html/rfc7517\" rel=\"nofollow noreferrer\">RFC 7517</a> doesn't define any expiration-related parameters on either a JWKS or an individual JWK, and I think the best practice is to use ordinary HTTP caching controls on the JWKS endpoint to refresh it occasionally, but not that often.</p>\n"}], "owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1750, "favorite_count": 1, "accepted_answer_id": 52025767, "answer_count": 1, "score": 1, "last_activity_date": 1535302040, "creation_date": 1535275220, "last_edit_date": 1535302040, "question_id": 52024874, "link": "https://stackoverflow.com/questions/52024874/is-it-a-bad-idea-to-cache-auth0-jwk", "title": "Is it a bad idea to cache auth0 JWK", "body": "<p>I am using auth0, and I have two clients (ios, react) and a Go backend API using <a href=\"https://github.com/auth0-community/go-auth0\" rel=\"nofollow noreferrer\">go-auth0</a>.</p>\n\n<p>I followed the documentation and made a <code>Verify</code> method that looks like this:</p>\n\n<pre><code>func Verify(handle httprouter.Handle) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n        auth0Domain := viper.GetString(\"auth0.issuer\")\n        audience := []string{viper.GetString(\"auth0.audience\")}\n\n        client := auth0.NewJWKClient(auth0.JWKClientOptions{URI: auth0Domain + \".well-known/jwks.json\"}, nil)\n        configuration := auth0.NewConfiguration(client, audience, auth0Domain, jose.RS256)\n        validator := auth0.NewValidator(configuration, nil)\n        _, err := validator.ValidateRequest(r)\n        if err != nil {\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.WriteHeader(http.StatusUnauthorized)\n            json.NewEncoder(w).Encode(map[string]string{\"error\": \"Unauthorized\"})\n            return\n        }\n\n        handle(w, r, p)\n    }\n}\n</code></pre>\n\n<p>Unfortunately I notice that it takes ~400ms for the first verify, and subsequent ones take ~50ms.</p>\n\n<p>However, if I initialize a struct with a field for the validator, move all the setup code into an <code>Initialize()</code>, then it takes only ~1ms:</p>\n\n<pre><code>func Verify(handle httprouter.Handle) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n\n        _, err := a.validator.ValidateRequest(r)\n        if err != nil {\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.WriteHeader(http.StatusUnauthorized)\n            json.NewEncoder(w).Encode(map[string]string{\"error\": \"Unauthorized\"})\n            return\n        }\n\n        handle(w, r, p)\n    }\n}\n</code></pre>\n\n<p>Is this a bad idea to do?  I am just learning about JWK today and looking at the auth0 code it seems they do construct a cache but I'm not entirely understanding how it works.</p>\n\n<p>Can someone please let me know if moving the config into a struct and using its validator is a good idea?</p>\n\n<p><em>UPDATE</em></p>\n\n<p>auth0 has a builtin method to do this!  Here's an example:</p>\n\n<p><code>auth0.NewJWKClientWithCache(auth0.JWKClientOptions{URI: a.issuer + \".well-known/jwks.json\"}, nil, auth0.NewMemoryKeyCacher(time.Duration(10)*time.Second, 5))</code></p>\n\n<p>Use this method so it caches for you! :)</p>\n"}, {"tags": ["mongodb", "go", "unmarshalling", "bson", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5181640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb519174762fa2074e1d8690bd1f8031?s=128&d=identicon&r=PG&f=1", "display_name": "amz", "link": "https://stackoverflow.com/users/5181640/amz"}, "edited": false, "score": 0, "creation_date": 1535486708, "post_id": 52035783, "comment_id": 91081443, "body": "Thanks a lot. I actually worked around the problem by implementing a <code>UnmarshallBSON</code> function for the struct&#39;s Type pointer. func <code>decode</code> will then call it, and inside I defined a similar struct, only with a <code>string</code>, so I could unmarshall the document into it well. Then I used the new defined struct to init the original struct with some casting. Worked well. Thanks again!"}, {"owner": {"reputation": 823, "user_id": 236719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab9270d01b5ff0263ffea992bc22480?s=128&d=identicon&r=PG", "display_name": "Alexej Kubarev", "link": "https://stackoverflow.com/users/236719/alexej-kubarev"}, "edited": false, "score": 0, "creation_date": 1584439408, "post_id": 52035783, "comment_id": 107430278, "body": "This is no longer required with 1.x versions of the driver and encode/decode works as expected out of the box"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 823, "user_id": 236719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab9270d01b5ff0263ffea992bc22480?s=128&d=identicon&r=PG", "display_name": "Alexej Kubarev", "link": "https://stackoverflow.com/users/236719/alexej-kubarev"}, "edited": false, "score": 0, "creation_date": 1584439542, "post_id": 52035783, "comment_id": 107430332, "body": "@AlexejK Thanks, I update the answer to reflect that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1584439595, "last_edit_date": 1584439595, "creation_date": 1535360215, "answer_id": 52035783, "question_id": 52024532, "link": "https://stackoverflow.com/questions/52024532/using-mongodb-go-driver-for-decoding-documents-into-structs-with-custom-type-fie/52035783#52035783", "title": "Using mongodb go driver for decoding documents into structs with custom type fields", "body": "<p><strong>Foreword:</strong> Custom types having <code>string</code> as their underlying types are now handled automatically by the driver. This answer predates the driver <code>1.x</code> versions where this was necessary.</p>\n\n<hr>\n\n<p>Unfortunately you're out of luck. The current state of the official mongo go driver does not support unmarshaling <code>string</code> values from BSON to a Go value whose type is a custom type having <code>string</code> as its underlying type. This may change in the future, but for now this is not supported.</p>\n\n<p>The way decoding into a struct field is handled is implemented in <a href=\"https://github.com/mongodb/mongo-go-driver/blob/3e1dd84368c1f4bab3dc5bd1d059ac558c4d90dd/bson/decode.go#L387\" rel=\"nofollow noreferrer\"><code>bson/decode.go</code>, currently line #387</a>:</p>\n\n<pre><code>case 0x2:\n    str := v.StringValue()\n    switch containerType {\n    case tString, tEmpty:\n        val = reflect.ValueOf(str)\n    case tJSONNumber:\n        _, err := strconv.ParseFloat(str, 64)\n        if err != nil {\n            return val, err\n        }\n        val = reflect.ValueOf(str).Convert(tJSONNumber)\n\n    case tURL:\n        u, err := url.Parse(str)\n        if err != nil {\n            return val, err\n        }\n        val = reflect.ValueOf(u).Elem()\n    default:\n        return val, nil\n    }\n</code></pre>\n\n<p><code>0x02</code> is the BSON string type. It is only attempted to decode into the struct field if the struct field's type is any of the following: <code>string</code>, <code>interface{}</code>, <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\"><code>json.Number</code></a> or <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\"><code>url.URL</code></a> (or a pointer to these).</p>\n\n<p>Unfortunately implementing <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#Unmarshaler\" rel=\"nofollow noreferrer\"><code>bson.Unmarshaler</code></a> on your custom type does not help either, as it is not checked in case of struct fields, only if the struct itself implements it. But implementing on the struct itself, you would have to duplicate the struct with the field being one of the above listed supported types (or use a map or a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#Document\" rel=\"nofollow noreferrer\"><code>bson.Document</code></a> type).</p>\n\n<p>This is a serious limitation on the library's part which can very easily be solved, so let's hope for the best that they add support for this in the near future.</p>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 3, "last_activity_date": 1535529372, "last_edit_date": 1535529372, "creation_date": 1535528688, "answer_id": 52072140, "question_id": 52024532, "link": "https://stackoverflow.com/questions/52024532/using-mongodb-go-driver-for-decoding-documents-into-structs-with-custom-type-fie/52072140#52072140", "title": "Using mongodb go driver for decoding documents into structs with custom type fields", "body": "<blockquote>\n  <p>I try to decode a DocumentResult into a struct using bson tags, and it does not work for a custom type wrapping a string</p>\n</blockquote>\n\n<p>With your current <code>MyType</code>, the document that would be stored in MongoDB would be as below: </p>\n\n<pre><code>{\n  \"_id\": ObjectId(\"...\"),\n  \"some_int\": NumberLong(\"42\"),\n  \"some_string\": \"The Answer\",\n  \"custom_type\": \"ABCD\"\n}\n</code></pre>\n\n<p>Even though the underlying type is a <code>string</code>, this could be tricky to decode with the current version of <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> (v0.0.12) due to the type wrapping. </p>\n\n<p>However, if you would like to have a custom type as such, you could change the struct into <a href=\"https://docs.mongodb.com/manual/core/data-model-design/#embedded-data-models\" rel=\"nofollow noreferrer\">an embedded field</a> instead. For example: </p>\n\n<pre><code>type MyDoc struct {\n    SomeInt    int    `bson:\"some_int\"`\n    SomeString string `bson:\"some_string,omitempty\"`\n    CustomType MyType `bson:\"custom_type,omitempty\"`\n}\n\ntype MyType struct {\n    Value string `bson:\"value,omitempty\"`\n}\n\nvar myType = MyType{Value: \"ABCD\"}\n\ndocToInsert := MyDoc{42, \"The Answer\", \"ABCD\"}\n\ninsertResult, err := collection.InsertOne(nil, docToInsert)\n\nresultDoc := collection.FindOne(context.Background(), nil)\nif err != nil {\n    log.Fatal(err)\n}\nelem := &amp;MyDoc{}\nerr = resultDoc.Decode(elem)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(elem.SomeInt, elem.SomeString, elem.CustomType.Value)\n// 42 The Answer ABCD\n</code></pre>\n\n<p>The document would be stored in MongoDB as below: </p>\n\n<pre><code>{\n  \"_id\": ObjectId(\"...\"),\n  \"some_int\": NumberLong(\"42\"),\n  \"some_string\": \"The Answer\",\n  \"custom_type\": {\n    \"value\": \"ABCD\"\n  }\n}\n</code></pre>\n\n<p>Otherwise just use <code>string</code> type directly because the resulting document in the database would be the same as the type wrapping version:</p>\n\n<pre><code>type MyDoc struct {\n    SomeInt    int    `bson:\"some_int\"`\n    SomeString string `bson:\"some_string,omitempty\"`\n    CustomType string `bson:\"custom_type,omitempty\"`\n} \n</code></pre>\n\n<p>You may also find <a href=\"https://docs.mongodb.com/manual/core/data-modeling-introduction/#data-modeling-introduction\" rel=\"nofollow noreferrer\">MongoDB Data Modeling</a> a useful reference. </p>\n"}, {"tags": [], "owner": {"reputation": 823, "user_id": 236719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab9270d01b5ff0263ffea992bc22480?s=128&d=identicon&r=PG", "display_name": "Alexej Kubarev", "link": "https://stackoverflow.com/users/236719/alexej-kubarev"}, "is_accepted": false, "score": 1, "last_activity_date": 1584439331, "creation_date": 1584439331, "answer_id": 60720032, "question_id": 52024532, "link": "https://stackoverflow.com/questions/52024532/using-mongodb-go-driver-for-decoding-documents-into-structs-with-custom-type-fie/60720032#60720032", "title": "Using mongodb go driver for decoding documents into structs with custom type fields", "body": "<p>With the 1.x versions of MongoDB driver for Go (latest version at the time of writing is 1.3.1) it is fully possible to encode and decode aliased types.</p>\n\n<p>Your example now works as expected, given one adjusts the <code>mongo.Connect</code> to match new <code>1.x</code> API.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\ntype MyDoc struct {\n    SomeInt    int    `bson:\"some_int\"`\n    SomeString string `bson:\"some_string,omitempty\"`\n    CustomType MyType `bson:\"custom_type,omitempty\"`\n}\n\ntype MyType string\n\nconst myType MyType = \"ABCD\"\n\nfunc main() {\n\n    // Connect to db\n    clientOpts := options.Client().\n        ApplyURI(\"mongodb://localhost/example_db\")\n    client, _ := mongo.Connect(context.Background(), clientOpts)\n    db := client.Database(\"example_db\")\n    collection := db.Collection(\"col\")\n\n    // Insert document\n    docToInsert := MyDoc{42, \"The Answer\", myType}\n    collection.InsertOne(nil, docToInsert)\n\n    // Retrieve document\n    filterDoc := MyDoc{SomeInt: 42}\n    resultDoc := &amp;MyDoc{}\n    result := collection.FindOne(nil, filterDoc)\n    result.Decode(resultDoc)\n\n    println(resultDoc.SomeInt, resultDoc.SomeString, resultDoc.CustomType)\n}\n</code></pre>\n\n<p>This returns: <code>42 The Answer ABCD</code> as expected</p>\n"}], "owner": {"reputation": 53, "user_id": 5181640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb519174762fa2074e1d8690bd1f8031?s=128&d=identicon&r=PG&f=1", "display_name": "amz", "link": "https://stackoverflow.com/users/5181640/amz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12467, "favorite_count": 1, "accepted_answer_id": 52035783, "answer_count": 3, "score": 5, "last_activity_date": 1584439595, "creation_date": 1535272209, "last_edit_date": 1535459145, "question_id": 52024532, "link": "https://stackoverflow.com/questions/52024532/using-mongodb-go-driver-for-decoding-documents-into-structs-with-custom-type-fie", "title": "Using mongodb go driver for decoding documents into structs with custom type fields", "body": "<p>I'm a beginner in both go and mongodb.\nI try to decode a <code>DocumentResult</code> into a struct using bson tags, and it does not work for a custom type wrapping a string.\nCan it be done without changing the field's type to a string?</p>\n\n<pre><code>    import (\n    \"context\"\n    \"github.com/mongodb/mongo-go-driver/mongo\"\n)\n\ntype MyDoc struct {\n    SomeInt int `bson:\"some_int\"`\n    SomeString string `bson:\"some_string,omitempty\"`\n    CustomType MyType `bson:\"custom_type,omitempty\"`\n}\n\ntype MyType string\n\nconst myType MyType = \"ABCD\"\n\nfunc main() {\n\n    //Connect to db\n    client, _ := mongo.Connect(context.Background(), \"mongodb://localhost:27017\", nil)\n    db := client.Database(\"example_db\")\n    collection := db.Collection(\"col\")\n\n    //Insert document\n    docToInsert := MyDoc{42, \"The Answer\", myType}\n    collection.InsertOne(nil, docToInsert)\n\n    //Retrieve document\n    filterDoc := MyDoc{SomeInt: 42}\n    resultDoc := &amp;MyDoc{}\n    result := collection.FindOne(nil, filterDoc)\n    result.Decode(resultDoc)\n\n    println(resultDoc.SomeInt, resultDoc.SomeString, resultDoc.CustomType)\n</code></pre>\n\n<blockquote>\n  <p>PRINTED RESULT: \"42 The Answer\" //\"ABCD\" is missing</p>\n</blockquote>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1535271896, "post_id": 52024338, "comment_id": 90999229, "body": "If <code>path</code> is, for example, <code>&quot;&#47;foo&#47;bar&#47;&quot;</code> then <code>c+&quot;&#47;&quot;</code> is <code>&quot;&#47;foo&#47;bar&#47;&#47;&quot;</code>. So the check means: don&#39;t redirect to <code>path+&quot;&#47;&quot;</code> if <code>path</code> already has a slash at the end."}, {"owner": {"reputation": 23, "user_id": 10177303, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PmXK6aq2ouk/AAAAAAAAAAI/AAAAAAAAEDs/AE-0NEWqIrk/photo.jpg?sz=128", "display_name": "Lighfer", "link": "https://stackoverflow.com/users/10177303/lighfer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535272963, "post_id": 52024338, "comment_id": 90999464, "body": "@mkopriva Thank you for your reply! But in the fact I can have a handler with pattern &quot;/foo/bar//&quot;, and when I try to access &quot;<a href=\"http://localhost:3000/foo/bar//\" rel=\"nofollow noreferrer\">localhost:3000/foo/bar/</a>&quot;, the browser(Chrome 68)   will delete the last slash, and becasur of the check, the shouldRedirectRLocked method return false, so I cannot access this handler anymore, is that means the path end with two slash is not a valid path?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535273179, "post_id": 52024338, "comment_id": 90999524, "body": "I don&#39;t know whether it&#39;s valid or not, try googling &quot;url rfc&quot; and you should find your answer. Also try <code>curl localhost:3000&#47;foo&#47;bar&#47;&#47;</code>, maybe curl doesn&#39;t remove the slash."}], "owner": {"reputation": 23, "user_id": 10177303, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PmXK6aq2ouk/AAAAAAAAAAI/AAAAAAAAEDs/AE-0NEWqIrk/photo.jpg?sz=128", "display_name": "Lighfer", "link": "https://stackoverflow.com/users/10177303/lighfer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1535283431, "creation_date": 1535270550, "last_edit_date": 1535283431, "question_id": 52024338, "link": "https://stackoverflow.com/questions/52024338/confusion-about-the-shouldredirectrlocked-method-go1-11-src-net-http-server-go", "title": "Confusion about the shouldRedirectRLocked method (go1.11 src/net/http/server.go:2259)", "body": "<p>I'm reading the source code about http module, and following code confused me:</p>\n\n<pre><code>func (mux *ServeMux) shouldRedirectRLocked(host, path string) bool {\n    p := []string{path, host + path}\n\n    for _, c := range p {\n        if _, exist := mux.m[c]; exist {\n            return false\n        }\n    }\n\n    n := len(path)\n    if n == 0 {\n        return false\n    }\n    for _, c := range p {\n        if _, exist := mux.m[c+\"/\"]; exist {\n            return path[n-1] != '/' &lt;&lt;- why not return true directly\n        }\n    }\n\n    return false\n}\n</code></pre>\n\n<p>As the comment above this method: <strong>shouldRedirectRLocked reports whether the given path and host should be redirected to path+\"/\". This should happen if a handler is registered for path+\"/\" but not path -- see comments at ServeMux.</strong></p>\n\n<p><strong>c+\"/\"</strong> already registered, and <strong>c</strong> didn't , so I think it should return true directly, but why we have to check <strong>path[n - 1] != '/'</strong>? Is this a question about the http protocol?</p>\n"}, {"tags": ["inheritance", "go", "interface", "embedding"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535236738, "post_id": 52021441, "comment_id": 90993952, "body": "<b>1.</b> Yes, attempting to &quot;implement&quot; inheritance is the incorrect way to write Go code. The correct approach is to use composition."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535237191, "post_id": 52021441, "comment_id": 90994022, "body": "<b>2.</b> Both the types still implement the interface because they embed LivingThing which embeds LivingThingProvider which is unset and therefore nil and so you get the panic. If a struct type embeds another type, the methods of the embedded type become directly accessible through the embedding type which is why the two types still implement the interface even after you removed their methods."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1535237342, "post_id": 52021441, "comment_id": 90994037, "body": "... also note that, interfaces are satisfied <i>implicitly</i>. You do not need to embed the interface to have the embedding type implement it. You implement an interface by declaring methods on the desired implementer with the same signature as the ones declared on the interface."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535237665, "post_id": 52021441, "comment_id": 90994086, "body": "... fixed: <a href=\"https://play.golang.org/p/dZCzoUo0gRg\" rel=\"nofollow noreferrer\">play.golang.org/p/dZCzoUo0gRg</a>"}, {"owner": {"reputation": 19, "user_id": 10274364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b70dbfd562b833634e4802b4bd2f4da?s=128&d=identicon&r=PG&f=1", "display_name": "Altus Demens", "link": "https://stackoverflow.com/users/10274364/altus-demens"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535243292, "post_id": 52021441, "comment_id": 90994849, "body": "@mkopriva, thank you very much! It appears to be so simple and clear after your explanation. Thank you again."}], "answers": [{"tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 1, "last_activity_date": 1535350615, "creation_date": 1535350615, "answer_id": 52033503, "question_id": 52021441, "link": "https://stackoverflow.com/questions/52021441/correct-implementation-of-inheritance-in-go-with-embedded-interface-fields/52033503#52033503", "title": "Correct implementation of inheritance in Go with embedded interface fields", "body": "<p>@mkopriva answer it and should get the credit but it looks like some explanation needed for classical inheritance programmers.</p>\n\n<p>Interface define behavior like Name and Birthday, (In Go its idiomatic to omit the Get). Structs implement these interface behavior. Not embedding them.</p>\n\n<p>Implementing an interface is all you need to do in order to \"be\" this interface. AKA duck type.</p>\n\n<p>When struct T implement <code>String() string</code> T become a Stringer.</p>\n\n<p>In this particular example we can see why In Golang a one method interface and interface embedding is so common.</p>\n\n<p>Since RobotMan do not have a birthday really it whould be better in my opinion to create three interfaces Namer: <code>Name() string</code>, Burner:<code>Birthday() time.Time</code> and </p>\n\n<pre><code>type LivingThingProvider interface {\n    Namer\n    Burner\n}\n</code></pre>\n\n<p>Struct composition is not a replacement for inheritance its a different way to reuse code.</p>\n"}], "owner": {"reputation": 19, "user_id": 10274364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b70dbfd562b833634e4802b4bd2f4da?s=128&d=identicon&r=PG&f=1", "display_name": "Altus Demens", "link": "https://stackoverflow.com/users/10274364/altus-demens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 756, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1535350615, "creation_date": 1535233186, "question_id": 52021441, "link": "https://stackoverflow.com/questions/52021441/correct-implementation-of-inheritance-in-go-with-embedded-interface-fields", "title": "Correct implementation of inheritance in Go with embedded interface fields", "body": "<p>I've been playing with interfaces and structures in Golang in an attempt to implement \"inheritance\", but I am confident that I've done it in a wrong way. It would be easier to explain with an example.</p>\n\n<p>I want to create structures of different living things. I want them to have the GetName() method:</p>\n\n<pre><code>type LivingThingProvider interface {\n    GetName() string\n}\n</code></pre>\n\n<p>Now, all of them should have names and birthdays. For that, I am creating a structure and embedding the interface to it:</p>\n\n<pre><code>type LivingThing struct {\n    birthday string\n    name     string\n    LivingThingProvider\n}\n</code></pre>\n\n<p>I want to add a couple of methods which would be the same for all living beings:</p>\n\n<pre><code>func (this *LivingThing) Initialize() {\n    this.birthday = time.Now().Format(\"02.01.2006\")\n}\n\nfunc (this LivingThing) GetBirthday() string {\n    return this.birthday\n}\n</code></pre>\n\n<p>Now, here are the structures that are supposed to \"implement\" LivingThing:</p>\n\n<pre><code>type Frog struct {\n    insectsEaten int\n    LivingThing\n}\n\nfunc (this Frog) GetName() string {\n    return fmt.Sprintf(\"%s-the-Frog-proud-eater-of-%d-insects\", this.name, this.insectsEaten)\n}\n\ntype RobotMan struct {\n    LivingThing\n}\n\nfunc (this RobotMan) GetName() string {\n    h := sha256.New()\n    h.Write([]byte(this.birthday))\n    return fmt.Sprintf(\"%s-%X\", this.name, h.Sum(nil))\n}\n</code></pre>\n\n<p>In the main function, I am creating and adding a frog and a robotman to a slice, after that I loop over it:</p>\n\n<pre><code>func main() {\n    fr := Frog{}\n    fr.name = \"Dizzy\"\n    fr.insectsEaten = 586\n    fr.LivingThingProvider = fr\n\n    rm := RobotMan{}\n    rm.name = \"Bender\"\n    rm.LivingThingProvider = rm\n\n    fr.Initialize()\n    rm.Initialize()\n\n    entities := []LivingThing{fr.LivingThing, rm.LivingThing}\n\n    for _, ent := range entities {\n        fmt.Printf(\"Hi, I am %s!\\n\", ent.GetName())\n        fmt.Printf(\"I was born on the %s.\\n\", ent.GetBirthday())\n    }\n}\n</code></pre>\n\n<p>Everything works as expected, but if I remove the GetName() method from the Frog or RobotMan structure, it will compile and panic after run:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>Here's the playground link: <a href=\"https://play.golang.org/p/h2VgvdcXJQA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h2VgvdcXJQA</a></p>\n\n<p>My questions are the following:</p>\n\n<p><strong>1.</strong> Is what I've done \"dirty\" in terms of Go? If so, how to do it in a correct way?</p>\n\n<p><strong>1a.</strong> Especially, is it fine to assign the structure itself to its embedded interface field (fr.LivingThingProvider = fr)?</p>\n\n<p><strong>2.</strong> Why doesn't Go compiler check if Frog and RobotMan implement the LivingThingProvider interface?</p>\n\n<p>Thank you very much in advance!</p>\n"}, {"tags": ["python", "go", "encryption"], "comments": [{"owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "edited": false, "score": 1, "creation_date": 1535232869, "post_id": 52021391, "comment_id": 90993197, "body": "Why not? What do you get?"}], "answers": [{"tags": [], "owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "is_accepted": true, "score": 3, "last_activity_date": 1535238128, "creation_date": 1535238128, "answer_id": 52021892, "question_id": 52021391, "link": "https://stackoverflow.com/questions/52021391/aes-gcm-decryption-in-python/52021892#52021892", "title": "AES-GCM decryption in python", "body": "<p>Worked like a charm for me.</p>\n\n<pre><code>from Crypto.Cipher import AES\nimport binascii\n\nkey = binascii.unhexlify('e629ed98829a893899ddda67f582ede72e2a187dd1ddd5ada54f49cfe2c8675f')\ndata = binascii.unhexlify('9012a33bfb0a51dec4f96404cdd7300ec6afca1fa0d6679a7c036652d014a38faf909e9c44d08dffac121aa85d48b7256fa74542e2545e27dc070adfc03af26f2a32f50c2c311d5c91ff6de2ca3b4347da70669575c9b198f4')\nnonce, tag = data[:12], data[-16:]\ncipher = AES.new(key, AES.MODE_GCM, nonce)\ncipher.decrypt_and_verify(data[12:-16], tag)\n</code></pre>\n\n<p>displays</p>\n\n<pre><code>b'I will become what I deserve, Is there anything like freewil?'\n</code></pre>\n"}], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6304, "favorite_count": 0, "accepted_answer_id": 52021892, "answer_count": 1, "score": 1, "last_activity_date": 1535238128, "creation_date": 1535232666, "question_id": 52021391, "link": "https://stackoverflow.com/questions/52021391/aes-gcm-decryption-in-python", "title": "AES-GCM decryption in python", "body": "<p>I am trying to decrypt cipher text generated from AES_GCM. The cipher text was generated from \"crypto/aes\" library in golang. Now, I am trying to decipher the encrypted text in python using cryptodome library.</p>\n\n<pre><code>func AESEncryption(key []byte, plaintext []byte)([]byte, error){\n   c, err := aes.NewCipher(key)\n   if err != nil {\n      log.Printf(\"Error ocurred in generating AES key %s\", err)\n      return nil,  err\n   }\n\n   gcm, err := cipher.NewGCM(c)\n   if err != nil {\n      return nil,  err\n   }\n\n  nonce := make([]byte, gcm.NonceSize())\n  if _, err = io.ReadFull(rand.Reader, nonce); err != nil {\n    log.Printf(\"Error ocurred in generating AES key %s\", err)\n      return nil, err\n  }\n\n  return gcm.Seal(nonce, nonce, plaintext, nil), nil\n\n}\n</code></pre>\n\n<p>plainText := \"I will become what I deserve, Is there anything like freewil?\"</p>\n\n<p>Hex encoded key : \ne629ed98829a893899ddda67f582ede72e2a187dd1ddd5ada54f49cfe2c8675f</p>\n\n<p>hex encoded encypted text = \n9012a33bfb0a51dec4f96404cdd7300ec6afca1fa0d6679a7c036652d014a38faf909e9c44d08dffac121aa85d48b7256fa74542e2545e27dc070adfc03af26f2a32f50c2c311d5c91ff6de2ca3b4347da70669575c9b198f4\nDeciphering the encrypted text in golang executes successfully but not in python.</p>\n\n<p>Code for decryption in python.</p>\n\n<pre><code>cipher = AES.new(binascii.unhexlify(key), AES.MODE_GCM)\ncipher.nonce = binascii.unhexlify(nonce)\ncipher.decrypt(binascii.unhexlify(hex_encoded_encrypted_hex))\n</code></pre>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1535225401, "post_id": 52020546, "comment_id": 90991550, "body": "Take a look at the reflect package. It is possible to read out fields and tags of a struct."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1535225945, "post_id": 52020546, "comment_id": 90991679, "body": "You cannot, at least not from the field only since its type, e.g. <code>AltField</code>, may have a different tag while being a field of another struct type. You can get tags of fields of a given struct, but not tags of a field when given the type of the field."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535226192, "post_id": 52020546, "comment_id": 90991730, "body": "@mkopriva ok right, so this is a scope issue....I thought I&#39;d ask in case there are options"}], "answers": [{"comments": [{"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 0, "creation_date": 1535225894, "post_id": 52020622, "comment_id": 90991664, "body": "Because my problem is potentially a scope issue. I want to grab the tags within the <code>func (af *AltField) UnmarshalJSON(b []byte) error</code> function.  Not in the scope of the <code>main</code> function."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 0, "creation_date": 1535227914, "post_id": 52020622, "comment_id": 90992137, "body": "Your code prints <code>json:&quot;val&quot;</code>.  What I&#39;m trying to achieve is for the code to print <code>json:&quot;profile_name&quot;</code> from within the unmarshaling function.  Ie. I need to grab the tag of the &quot;parent&quot; struct that the af field was originally attached to. @mkopriva says this is not possible because of scope restrictions."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 1, "creation_date": 1535227989, "post_id": 52020622, "comment_id": 90992158, "body": "@John yes he is absolutely right it is not possible. I have mentioned in the answer also that you need to create a reflect object of the struct whose tag you want to get."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1535226775, "last_edit_date": 1535226775, "creation_date": 1535225500, "answer_id": 52020622, "question_id": 52020546, "link": "https://stackoverflow.com/questions/52020546/print-struct-field-tags-while-unmarshalling-json-content-for-a-field/52020622#52020622", "title": "Print struct field tags while unmarshalling JSON content for a field?", "body": "<p>Use reflection to get the value of struct field tag. The <code>reflect</code> package provides functions to work with tags including to get the value of tag</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"encoding/json\"\n  \"reflect\"\n)\ntype Person struct {\n  ProfileName AltField `json:\"profile_name\"`\n}\n\ntype AltField struct {\n  Val string `json:\"val\"`\n}\n\nfunc (af *AltField) UnmarshalJSON(b []byte) error {\n  field, ok := reflect.TypeOf(*af).FieldByName(\"Val\")\n  if !ok {\n    panic(\"Field not found\")\n  }\n  log.Println(string(field.Tag))\n\n  if e := json.Unmarshal(b,&amp;af.Val); e != nil {\n    return e\n  }\n  return nil\n}\n\nfunc main() {\n  p := Person{}\n  _ = json.Unmarshal([]byte(`{\"profile_name\":\"Af\"}`),&amp;p)\n\n}\n</code></pre>\n\n<p>You can only get the value of those field tags which has them. The struct field reflect object should be created for fetching the tags of its fields.</p>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/bwiyqWZfA1y\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535226775, "creation_date": 1535224896, "question_id": 52020546, "link": "https://stackoverflow.com/questions/52020546/print-struct-field-tags-while-unmarshalling-json-content-for-a-field", "title": "Print struct field tags while unmarshalling JSON content for a field?", "body": "<p>In Go, Is it possible to get the tags from a struct field while I'm unmarshaling JSON content to it? Here's my failed attempt at doing so:</p>\n\n<pre><code>package main\nimport (\n  \"log\"\n  \"encoding/json\"\n)\ntype Person struct {\n  ProfileName AltField `json:\"profile_name\"`\n}\n\ntype AltField struct {\n  Val string\n}\n\nfunc (af *AltField) UnmarshalJSON(b []byte) error {\n  log.Println(\"Show tags\")\n  //log.Println(af.Tag) // I want to see `json:\"profile_name\"`\n  if e := json.Unmarshal(b,&amp;af.Val); e != nil {\n    return e\n  }\n  return nil\n}\nfunc main() {\n  p := Person{}\n  _ = json.Unmarshal([]byte(`{\"profile_name\":\"Af\"}`),&amp;p)\n\n}\n</code></pre>\n\n<p>I commented out the line <code>log.Println(af.Tag)</code> because it causes compilation errors.  If I can get a handle on the tags from the Person struct, that will allow me to develop some other conditional logic.</p>\n\n<p>Is this possible?</p>\n"}, {"tags": ["debugging", "go"], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 0, "last_activity_date": 1535223282, "creation_date": 1535223282, "answer_id": 52020342, "question_id": 52019787, "link": "https://stackoverflow.com/questions/52019787/how-to-run-a-go-binary-in-a-debugger-while-passing-arguments/52020342#52020342", "title": "How to run a Go binary in a debugger while passing arguments?", "body": "<p>I assume dlv is already installed?  If not, it's a simple go get, see <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">https://github.com/derekparker/delve</a></p>\n\n<pre><code>dlv exec ./abc -- import --src_type=redis --src_uri=\"redis://localhost:6379/0\" redis-test \n</code></pre>\n\n<p>-- in the debugger means take the rest as arguments to the program being run</p>\n"}], "owner": {"reputation": 3, "user_id": 10273909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f5bb0b63c18fc7934932857dec1c8a?s=128&d=identicon&r=PG&f=1", "display_name": "ffdg", "link": "https://stackoverflow.com/users/10273909/ffdg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 52020342, "answer_count": 1, "score": 0, "last_activity_date": 1535223282, "creation_date": 1535219215, "question_id": 52019787, "link": "https://stackoverflow.com/questions/52019787/how-to-run-a-go-binary-in-a-debugger-while-passing-arguments", "title": "How to run a Go binary in a debugger while passing arguments?", "body": "<p>I have a precompiled Go binary called abc which I run like this <code>./abc import --src_type=redis --src_uri=\"redis://localhost:6379/0\" redis-test</code> </p>\n\n<p>I also want to print a few values in certain packages of this application for debugging purposes. How do I run this binary with the arguments in a debugger?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1535214881, "post_id": 52019213, "comment_id": 90988747, "body": "A ran it on MacOs and received the same output with the windows one. Just an addition to the diagnosis"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1535215085, "post_id": 52019213, "comment_id": 90988799, "body": "It is not about operating system. It is about goroutines which run depending on the priority queue of OS if the go routines return first, then it will print."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535215542, "post_id": 52019213, "comment_id": 90988921, "body": "Did you try to use a debugger? How?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1535216111, "post_id": 52019213, "comment_id": 90989071, "body": "You don&#39;t have any explicit synchronization between your goroutines, thus you cannot have any expectation about their execution order. Your main goroutine is a &quot;busy loop&quot;, which does not give any yielding points to the goroutine scheduler."}, {"owner": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1535216415, "post_id": 52019213, "comment_id": 90989153, "body": "@icza regardless of the order, the 2A goroutine was never executed. I couldn&#39;t reproduce the issue in my debian box though. Stan are you running the same go version on windows?"}, {"owner": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "edited": false, "score": 0, "creation_date": 1535216637, "post_id": 52019213, "comment_id": 90989221, "body": "But the main will never exit in his code."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "edited": false, "score": 0, "creation_date": 1535217110, "post_id": 52019213, "comment_id": 90989371, "body": "@RafaelAlmeida the main will never exit because of never ending for loop."}, {"owner": {"reputation": 21, "user_id": 7923256, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-oK4iOysPVnM/AAAAAAAAAAI/AAAAAAAAAJY/Dh3X1neXhT0/photo.jpg?sz=128", "display_name": "stan", "link": "https://stackoverflow.com/users/7923256/stan"}, "reply_to_user": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "edited": false, "score": 0, "creation_date": 1535248609, "post_id": 52019213, "comment_id": 90995493, "body": "@Rafael, yes i run the same go version on Windows."}, {"owner": {"reputation": 21, "user_id": 7923256, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-oK4iOysPVnM/AAAAAAAAAAI/AAAAAAAAAJY/Dh3X1neXhT0/photo.jpg?sz=128", "display_name": "stan", "link": "https://stackoverflow.com/users/7923256/stan"}, "reply_to_user": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "edited": false, "score": 0, "creation_date": 1535248742, "post_id": 52019213, "comment_id": 90995511, "body": "@Rafael yes i&#39;m aware of that. the problem is the goroutine never executed. These code is a minimized version of the real code. In the real code, the exit will be set true from another function"}], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1535277478, "post_id": 52019407, "comment_id": 91000476, "body": "Downvoter my answer is absolutely correct. Please comment if you are downvoting with a reason."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1535218099, "last_edit_date": 1535218099, "creation_date": 1535216142, "answer_id": 52019407, "question_id": 52019213, "link": "https://stackoverflow.com/questions/52019213/goroutine-never-executed-on-linux-but-work-normally-on-windows/52019407#52019407", "title": "Goroutine never executed on Linux but work normally on Windows", "body": "<p>Try to run the same program on Go Playground. It will show the process took so long because of the never ending for loop.</p>\n\n<pre><code>for { // It is never ending for loop which never exit.\n     if exit {\n         break\n     }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iCC6f6A4M1G\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>But you cannot rely on the order of go routines. It is random. Also one thing you need to notice is that if you remove the for loop, The main will exit before your go routine will return the result.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar exit bool = false\n\nfunc main() {\n    fmt.Println(\"0\")\n    fmt.Println(\"2\")\n    go func() {\n        fmt.Println(\"2A\")\n    }()\n    fmt.Println(\"3\")\n    fmt.Println(\"4\")\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>0\n2\n3\n4\n</code></pre>\n\n<p>Check it on <a href=\"https://play.golang.org/p/VkpUF06tXlP\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>As an advice it is always better to use wait groups in such situation where you want to wait for the go routine to finish before the main exit. Take for an example.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nvar exit bool = false\n\nfunc main() {\n    fmt.Println(\"0\")\n    fmt.Println(\"2\")\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        fmt.Println(\"2A\")\n    }()\n    fmt.Println(\"3\")\n    fmt.Println(\"4\")\n    wg.Wait()\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>0\n2\n3\n4\n2A\n</code></pre>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/us418wYFxUZ\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "is_accepted": false, "score": 0, "last_activity_date": 1535217466, "creation_date": 1535217466, "answer_id": 52019566, "question_id": 52019213, "link": "https://stackoverflow.com/questions/52019213/goroutine-never-executed-on-linux-but-work-normally-on-windows/52019566#52019566", "title": "Goroutine never executed on Linux but work normally on Windows", "body": "<p>I believe that if you add a print statement inside of your for loop (or even a sleep),  you'll eventually see 2A being printed.</p>\n\n<p>Go routines do not necessarily map each to a different CPU. Moreover, when they are both assigned to the same CPU, the execution will only be interrupted at certain library calls (such as Println).</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1535232071, "last_edit_date": 1535232071, "creation_date": 1535226688, "answer_id": 52020753, "question_id": 52019213, "link": "https://stackoverflow.com/questions/52019213/goroutine-never-executed-on-linux-but-work-normally-on-windows/52020753#52020753", "title": "Goroutine never executed on Linux but work normally on Windows", "body": "<p>There is a simple explanation. It has nothing to do with operating systems. The behavior is the same on Linux and Windows.</p>\n\n<pre><code>$ go version\ngo version devel +f2ed3e1da1 Sat Aug 25 18:36:22 2018 +0000 linux/amd64\n$\n\n&gt;go version\ngo version devel +e03220a594 Sat Aug 25 02:39:49 2018 +0000 windows/amd64\n&gt;\n</code></pre>\n\n<p>The <code>main</code> goroutine will effectively stop when it encounters the busy-wait spin loop:</p>\n\n<pre><code>for {\n    if exit {\n        break\n    }\n}\n</code></pre>\n\n<p>If we are only using one core then the entire program will stop. Otherwise, other goroutines can continue to run. The number of cores used is controlled by GOMAXPROCs up to a usable maximum of NumCPU.</p>\n\n<p><code>cores.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nvar exit bool = false\n\nfunc main() {\n    fmt.Println(\"NumCPU:    \", runtime.NumCPU())\n    if runtime.GOMAXPROCS(0) &gt; runtime.NumCPU() {\n        runtime.GOMAXPROCS(runtime.NumCPU())\n    }\n    fmt.Println(\"GOMAXPROCS:\", runtime.GOMAXPROCS(0))\n\n    fmt.Println(\"0\")\n    fmt.Println(\"2\")\n    go func() {\n        fmt.Println(\"2A\")\n    }()\n    fmt.Println(\"3\")\n    for {\n        if exit {\n            break\n        }\n    }\n    fmt.Println(\"4\")\n}\n</code></pre>\n\n<p>Using one core, the Go scheduler ran the main goroutine. It didn't get a chance to run the 2A goroutine.</p>\n\n<pre><code>$ env GOMAXPROCS=1 go run cores.go\nNumCPU:     4\nGOMAXPROCS: 1\n0\n2\n3\n^Csignal: interrupt\n$ \n</code></pre>\n\n<p>Using more than one core, the Go scheduler ran the main and 2A goroutines.</p>\n\n<pre><code>$ env GOMAXPROCS=2 go run cores.go\nNumCPU:     4\nGOMAXPROCS: 2\n0\n2\n3\n2A\n^Csignal: interrupt\n$ \n</code></pre>\n\n<p>Now, let's surrender the main goroutine with a Gosched() just before the spin loop to give other goroutines a chance to run.</p>\n\n<p><code>gosched.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nvar exit bool = false\n\nfunc main() {\n    fmt.Println(\"NumCPU:    \", runtime.NumCPU())\n    if runtime.GOMAXPROCS(0) &gt; runtime.NumCPU() {\n        runtime.GOMAXPROCS(runtime.NumCPU())\n    }\n    fmt.Println(\"GOMAXPROCS:\", runtime.GOMAXPROCS(0))\n\n    fmt.Println(\"0\")\n    fmt.Println(\"2\")\n    go func() {\n        fmt.Println(\"2A\")\n    }()\n    fmt.Println(\"3\")\n    runtime.Gosched()\n    for {\n        if exit {\n            break\n        }\n    }\n    fmt.Println(\"4\")\n}\n</code></pre>\n\n<p>Sharing one core, the main and 2A goroutines ran.</p>\n\n<pre><code>$ env GOMAXPROCS=1 go run gosched.go\nNumCPU:     4\nGOMAXPROCS: 1\n0\n2\n3\n2A\n^Csignal: interrupt\n$\n</code></pre>\n\n<p>Sharing two cores, the main and 2A goutines ran.</p>\n\n<pre><code>$ env GOMAXPROCS=2 go run gosched.go\nNumCPU:     4\nGOMAXPROCS: 2\n0\n2\n3\n2A\n^Csignal: interrupt\n$ \n</code></pre>\n\n<hr>\n\n<p>NOTE: The Go scheduler behavior will likely change as the Go runtime is improved. For example, spin locks may not be allowed to monopolize a core.</p>\n"}], "owner": {"reputation": 21, "user_id": 7923256, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-oK4iOysPVnM/AAAAAAAAAAI/AAAAAAAAAJY/Dh3X1neXhT0/photo.jpg?sz=128", "display_name": "stan", "link": "https://stackoverflow.com/users/7923256/stan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 1, "accepted_answer_id": 52020753, "answer_count": 3, "score": 0, "last_activity_date": 1535232071, "creation_date": 1535214629, "last_edit_date": 1535217777, "question_id": 52019213, "link": "https://stackoverflow.com/questions/52019213/goroutine-never-executed-on-linux-but-work-normally-on-windows", "title": "Goroutine never executed on Linux but work normally on Windows", "body": "<p>I am new to Go. After hours on google still could not find the explanation of this problem.\nThe code below run normally on Windows.\nIt run:</p>\n\n<pre><code>0\n2\n3\n2A\n</code></pre>\n\n<p>and it wait forever, but the same code not working on Linux (Ubuntu), the goroutine never executed:</p>\n\n<pre><code>0\n2\n3\n</code></pre>\n\n<p>and it wait forever.</p>\n\n<pre><code>package main\n\nimport (\"fmt\")\nvar exit bool=false\n\nfunc main(){\n   fmt.Println(\"0\")\n   fmt.Println(\"2\")\n   go func() {\n      fmt.Println(\"2A\");\n   }()\n   fmt.Println(\"3\")\n   for {\n        if exit {\n           break\n        }\n   }\n   fmt.Println(\"4\")\n}\n</code></pre>\n\n<p>Environment: Linux Ubuntu, go1.10.3 linux/amd64</p>\n"}, {"tags": ["go", "sqlx"], "comments": [{"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "edited": false, "score": 0, "creation_date": 1535211657, "post_id": 52018701, "comment_id": 90987754, "body": "Second one is coming from postgreSQL saying relation &quot;category&quot; does not exist."}, {"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "reply_to_user": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "edited": false, "score": 0, "creation_date": 1535217441, "post_id": 52018701, "comment_id": 90989458, "body": "@CetinBasoz - yay thanks! adding the name of the schema helped there. still trying to figure out why Get() doesn&#39;t work the way it should"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1535219916, "post_id": 52018701, "comment_id": 90990067, "body": "You&#39;re passing in a &quot;pointer to a pointer to a struct&quot;. Change <code>Psqldb.Get(&amp;product, QUE...</code> to <code>Psqldb.Get(product, QUE</code>. <code>product</code> is already a pointer because that&#39;s what <code>new</code> returns."}, {"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535220230, "post_id": 52018701, "comment_id": 90990160, "body": "@mkopriva - yay thanks. that&#39;s resolved my problem. please post it as an answer"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1535220554, "creation_date": 1535220554, "answer_id": 52019968, "question_id": 52018701, "link": "https://stackoverflow.com/questions/52018701/select-and-get-usage-with-sqlx/52019968#52019968", "title": "Select and Get usage with sqlx", "body": "<p>The problem arises because you're passing <code>**PsqlProduct</code> to <code>Get</code> which thinks that you want to scan the query result into the pointed to pointer, hence <code>\"... dest type ptr with &gt;1 columns ...\"</code>.</p>\n\n<p>Just change:</p>\n\n<pre><code>err := Psqldb.Get(&amp;product, QUERY_SELECT_PRODUCT,productId)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>err := Psqldb.Get(product, QUERY_SELECT_PRODUCT,productId)\n</code></pre>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3833, "favorite_count": 1, "accepted_answer_id": 52019968, "answer_count": 1, "score": 1, "last_activity_date": 1535220554, "creation_date": 1535211017, "last_edit_date": 1535217673, "question_id": 52018701, "link": "https://stackoverflow.com/questions/52018701/select-and-get-usage-with-sqlx", "title": "Select and Get usage with sqlx", "body": "<p>I'm using go 1.10.3 and I'm trying to use the sqlx package to get one row and enter it to a struct with <code>Get()</code>, or get several rows and enter them to a slice with <code>Select()</code>.</p>\n\n<p>lets start with getting one row into a struct.</p>\n\n<p>I created the following struct:</p>\n\n<pre><code>type PsqlProduct struct {\n    Id              int64          `db:\"product_id\"`\n    Name            string         `db:\"product_name\"`\n    Desc            sql.NullString `db:\"product_desc\"`\n    YearManufacture sql.NullInt64  `db:\"year_manufacture\"`\n    Quantity        sql.NullInt64  `db:\"quantity\"`\n}\n</code></pre>\n\n<p>for the query:</p>\n\n<pre><code>QUERY_SELECT_PRODUCT = `select wd.product.id as product_id,\ntrans_p_name.text as product_name,\ntrans_p_desc.text as product_desc,\nwd.product.year_manufacture, wd.product.quantity\nfrom wd.product\njoin wd.text_translation as trans_p_name \n    on trans_p_name.text_id = wd.product.product_name_trans_id and trans_p_name.lang_id=1\nleft join wd.text_translation as trans_p_desc \n    on trans_p_desc.text_id = wd.product.product_desc_trans_id and trans_p_desc.lang_id=1\nwhere wd.product.id = $1 \n`\n</code></pre>\n\n<p>and I created the following function to get product by id:</p>\n\n<pre><code>func PsqlGetProductById(productId int) *Product {\n    product := new(PsqlProduct)\n    err := Psqldb.Get(&amp;product, QUERY_SELECT_PRODUCT,productId)\n    if err != nil {\n        log.Fatalf(\"error: %v\",err)\n        return nil\n    } else {\n\n        newp := Product{\n            ID:   uint(product.Id),\n            Name: product.Name,\n        }\n        if product.Quantity.Valid {\n            newp.Quantity = uint16(product.Quantity.Int64)\n        }\n        if product.YearManufacture.Valid {\n            newp.YearManufacture = uint16(product.YearManufacture.Int64)\n        }\n        if product.Desc.Valid {\n            newp.Desc = product.Desc.String\n        }\n        return &amp;newp\n    }\n}\n</code></pre>\n\n<p>and I got the error </p>\n\n<pre><code>error: scannable dest type ptr with &gt;1 columns (5) in result\n</code></pre>\n\n<p>it's as if <code>Get()</code> function is only for one column.. but the documentation clearly states it's not!</p>\n\n<p>if I change the <code>Get()</code> function call to <code>Psqldb.QueryRowx(QUERY_SELECT_PRODUCT, productId).StructScan(product)</code></p>\n\n<p>then it does work.. but still.. trying to find out why <code>Get()</code> doesn't work.</p>\n\n<p>next.. <code>Select()</code></p>\n\n<p>so this is the struct</p>\n\n<pre><code>type PsqlCategory struct {\n    Id               int64         `db:\"category_id\"`\n    Name             string        `db:\"category_name\"`\n    ParentCategoryId sql.NullInt64 `db:\"parent_category_id\"`\n}\n</code></pre>\n\n<p>sql query:</p>\n\n<pre><code>QUERY_SELECT_CATEGORIES = `\nselect category.id as category_id,\n       text_translation.text as category_name,\n       category.parent_category_id\nfrom category\njoin text_translation on text_translation.text_id=category.category_name_trans_id\nand text_translation.lang_id = 1`\n</code></pre>\n\n<p>and the function</p>\n\n<pre><code>func PsqlGetCategories() []Category {\n    categories := []PsqlCategory{}\n    err := Psqldb.Select(&amp;categories, QUERY_SELECT_CATEGORIES)\n    if err != nil {\n        log.Fatalf(\"could not parse categories: %v\", err)\n        return nil\n    }\n    var nCategories []Category\n    for _, cat := range categories {\n        newCat := Category{\n            Id:   cat.Id,\n            Name: cat.Name,\n        }\n        if cat.ParentCategoryId.Valid {\n            newCat.ParentCategoryId = cat.ParentCategoryId.Int64\n        }\n        nCategories = append(nCategories, newCat)\n    }\n    return nCategories\n}\n</code></pre>\n\n<p>and this is the error</p>\n\n<pre><code>could not parse categories: pq: relation \"category\" does not exist\n</code></pre>\n\n<p>it's like I totally misunderstood the usage of the sqlx library or I'm missing something.. </p>\n\n<p>any information regarding the issue would be greatly appreciated.</p>\n"}, {"tags": ["http", "go", "network-programming", "go-http"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1535205942, "post_id": 52017133, "comment_id": 90986270, "body": "You are making all requests with http.DefaultClient. What happens when you distribute the requests over a few independent http clients? Perhaps the connection pool is limited to some number of connections."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535210751, "post_id": 52017133, "comment_id": 90987523, "body": "reworked your code (<a href=\"https://play.golang.org/p/HnKdFG5roj-\" rel=\"nofollow noreferrer\">play.golang.org/p/HnKdFG5roj-</a>) and yes i also find some results rather suspicious. Not sure why it would not resolve web.mit.edu / fda.gov / geocities.jp / clickbank.net. However imho it is not related to concurrency rate."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535210802, "post_id": 52017133, "comment_id": 90987538, "body": "Also found this along the road, <code>2018&#47;08&#47;25 17:24:53 Unsolicited response received on idle HTTP channel starting with &quot;HTTP&#47;1.0 408 Request Time-out\\r\\nServer: AkamaiGHost\\r\\nMime-Version: 1.0\\r\\nDate: Sat, 25 Aug 2018 15:24:53 GMT\\r\\nContent-Type: text&#47;html\\r\\nContent-Length: 218\\r\\nExpires: Sat, 25 Aug 2018 15:24:53 GMT\\r\\n\\r\\n&lt;HTML&gt;&lt;HEAD&gt;\\n&lt;TITLE&gt;Request Timeout&lt;&#47;TITLE&gt;\\n&lt;&#47;HEAD&gt;&lt;BODY&gt;\\n&lt;H1&gt;Request Timeout&lt;&#47;H1&gt;\\nThe server timed out while waiting for the browser&#39;s request.&lt;P&gt;\\nReference&amp;#32;&amp;#35;2&amp;#46;3ff90a17&amp;#46;153521069&zwnj;&#8203;3&amp;#46;0\\n&lt;&#47;BODY&gt;&lt;&#47;HT&zwnj;&#8203;ML&gt;\\n&quot;; err=&lt;nil&gt;</code>"}, {"owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535295112, "post_id": 52017133, "comment_id": 91004941, "body": "@Peter see the update, it does not make a difference"}, {"owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535295183, "post_id": 52017133, "comment_id": 91004960, "body": "@mh-cbon have you tried to lower the concurrency, because with ~5-10 concurrent requests its running without problems"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1535302359, "post_id": 52017133, "comment_id": 91007029, "body": "yes, it is very similar to my previous tests, 40 failures or so. Still some i dont quiet because dig resolves them. Even <code>googleusercontent.com</code> constantly fails. See also <a href=\"https://github.com/golang/go/issues/18588\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/18588</a>. I ran it on 1.10, i have not took time to switch to 1.11 yet, might worth the test."}, {"owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535373551, "post_id": 52017133, "comment_id": 91029519, "body": "@mh-cbon that issue seems pretty much like what is happening here, thank you"}, {"owner": {"reputation": 63, "user_id": 10756743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gwne3.png?s=128&g=1", "display_name": "CriticalRebel", "link": "https://stackoverflow.com/users/10756743/criticalrebel"}, "edited": false, "score": 0, "creation_date": 1582826111, "post_id": 52017133, "comment_id": 106919705, "body": "@Neverbolt Hey did you solve your problem?"}, {"owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "reply_to_user": {"reputation": 63, "user_id": 10756743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gwne3.png?s=128&g=1", "display_name": "CriticalRebel", "link": "https://stackoverflow.com/users/10756743/criticalrebel"}, "edited": false, "score": 0, "creation_date": 1585303030, "post_id": 52017133, "comment_id": 107717330, "body": "@CriticalRebel no I did not, I have reduced the amount of parallel requests and chose to work with multiple instances of the same program, which seems to point to the open file limit that is mentioned in the issue mh-cbon mentioned and is not yet resolved from a go standard library standpoint."}], "owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 8202, "favorite_count": 2, "answer_count": 0, "score": 8, "last_activity_date": 1535295078, "creation_date": 1535198639, "last_edit_date": 1535295078, "question_id": 52017133, "link": "https://stackoverflow.com/questions/52017133/dial-tcp-i-o-timeout-on-simultaneous-requests", "title": "Dial tcp I/O timeout on simultaneous requests", "body": "<p>I am building a tool in Go that needs to make a very large number of simultaneous HTTP requests to many different servers. My initial prototype in Python had no problem doing a few hundred simultaneous requests.</p>\n\n<p>However, I have found that in Go this almost always results in a <code>Get http://www.google.com: dial tcp 216.58.205.228:80: i/o timeout</code> for some if the number of simultaneous requests exceeds ~30-40.</p>\n\n<p>I've tested on macOS, openSUSE, different hardware, in different networks and with different domain lists, and changing the DNS server as described in other Stackoverflow answers does not work either.</p>\n\n<p>The interesting thing is that the failed requests do not even produce a packet, as can be seen when checking with Wireshark.</p>\n\n<p>Is there anything that I am doing wrong or is that a bug in Go?</p>\n\n<p>Minimum reproducible program below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n)\n\nfunc main() {\n    domains := []string{/* large domain list here, eg from https://moz.com/top500 */}\n\n    limiter := make(chan string, 50) // Limits simultaneous requests\n\n    wg := sync.WaitGroup{} // Needed to not prematurely exit before all requests have been finished\n\n    for i, domain := range domains {\n        wg.Add(1)\n        limiter &lt;- domain\n\n        go func(i int, domain string) {\n            defer func() { &lt;-limiter }()\n            defer wg.Done()\n\n            resp, err := http.Get(\"http://\"+domain)\n            if err != nil {\n                fmt.Printf(\"%d %s failed: %s\\n\", i, domain, err)\n                return\n            }\n\n            fmt.Printf(\"%d %s: %s\\n\", i, domain, resp.Status)\n        }(i, domain)\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Two particular error messages are happening, a <code>net.DNSError</code> that does not make any sense and a non-descript <code>poll.TimeoutError</code>:</p>\n\n<pre><code>&amp;url.Error{Op:\"Get\", URL:\"http://harvard.edu\", Err:(*net.OpError)(0xc00022a460)}\n&amp;net.OpError{Op:\"dial\", Net:\"tcp\", Source:net.Addr(nil), Addr:net.Addr(nil), Err:(*net.DNSError)(0xc000aca200)}\n&amp;net.DNSError{Err:\"no such host\", Name:\"harvard.edu\", Server:\"\", IsTimeout:false, IsTemporary:false}\n\n&amp;url.Error{Op:\"Get\", URL:\"http://latimes.com\", Err:(*net.OpError)(0xc000d92730)}\n&amp;net.OpError{Op:\"dial\", Net:\"tcp\", Source:net.Addr(nil), Addr:net.Addr(nil), Err:(*poll.TimeoutError)(0x14779a0)}\n&amp;poll.TimeoutError{}\n</code></pre>\n\n<p>Update:</p>\n\n<p>Running the requests with a seperate <code>http.Client</code> as well as <code>http.Transport</code> and <code>net.Dialer</code> does not make any difference as can be seen when running code from <a href=\"https://play.golang.org/p/T6TUJSTEyAy\" rel=\"noreferrer\">this playground</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1535195461, "post_id": 52016699, "comment_id": 90983406, "body": "<a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a>"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535195556, "post_id": 52016699, "comment_id": 90983437, "body": "You should use a method and not a function, then you&#39;ll be able to do <code>s.CheckSomething</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535196367, "post_id": 52016699, "comment_id": 90983664, "body": "<code>ChedkSomething()</code> is not a method receiver, so you obviously cannot call it on <code>s</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8965828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95690d80446b4836ad000167d8fcd737?s=128&d=identicon&r=PG&f=1", "display_name": "M.Key", "link": "https://stackoverflow.com/users/8965828/m-key"}, "edited": false, "score": 0, "creation_date": 1535196603, "post_id": 52016770, "comment_id": 90983726, "body": "My bad, I didn&#39;t differentiate between methods and functions in Golang yet. It works now, thanks"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1535196229, "last_edit_date": 1535196229, "creation_date": 1535195902, "answer_id": 52016770, "question_id": 52016699, "link": "https://stackoverflow.com/questions/52016699/cant-access-method-from-another-package-by-var-methodname/52016770#52016770", "title": "Can&#39;t access method from another package by var.MethodName()", "body": "<p>In Golang a Method set is defined as:</p>\n\n<blockquote>\n  <p>A type may have a method set associated with it. The method set of an\n  interface type is its interface. The method set of any other type T\n  consists of all methods declared with receiver type T. The method set\n  of the corresponding pointer type *T is the set of all methods\n  declared with receiver *T or T (that is, it also contains the method\n  set of T). Further rules apply to structs containing embedded fields,\n  as described in the section on struct types. Any other type has an\n  empty method set. In a method set, each method must have a unique\n  non-blank method name.</p>\n</blockquote>\n\n<p>There is a mistake because you are using the pointer receiver with method when calling the function. So change the function when defining to method as:</p>\n\n<pre><code>func init() {\n    // some operations\n}\n\nfunc(s *SampleStruct) CheckSomething() bool {\n    // check something\n}\n</code></pre>\n\n<p>Or when calling the method it should be function with argument <code>SampleStruct</code> which will be like</p>\n\n<pre><code>import (\n    \"MyProject/samplepkg\"\n)\n\nfunc testFunc() {\n    var s = &amp;samplepkg.SampleStruct{\"a\", \"b\"}\n    if CheckSomething(s) {\n        // do some operations\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8965828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95690d80446b4836ad000167d8fcd737?s=128&d=identicon&r=PG&f=1", "display_name": "M.Key", "link": "https://stackoverflow.com/users/8965828/m-key"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 52016770, "answer_count": 1, "score": 1, "last_activity_date": 1535196229, "creation_date": 1535195302, "question_id": 52016699, "link": "https://stackoverflow.com/questions/52016699/cant-access-method-from-another-package-by-var-methodname", "title": "Can&#39;t access method from another package by var.MethodName()", "body": "<p>I have a package containing some structure and functions associated with it:</p>\n\n<pre><code>package samplepkg\n\ntype SampleStruct struct {\n    FirstString string\n    SecondString string\n}\n\nfunc init() {\n    // some operations\n}\n\nfunc CheckSomething(s *SampleStruct) bool {\n    // check something\n}\n</code></pre>\n\n<p>Now I'm trying to run this function in another package:</p>\n\n<pre><code>import (\n    \"MyProject/samplepkg\"\n)\n\nfunc testFunc() {\n    var s = samplepkg.SampleStruct{\"a\", \"b\"}\n    if s.CheckSomething() {\n        // do some operations\n    }\n}\n</code></pre>\n\n<p>But I get an error that s.CheckSomething is undefined. (&amp;s).CheckSomething gives the same result. I can access s.FirstString and s.SecondString as well as use this method by calling</p>\n\n<pre><code>if samplepkg.CheckSomething(&amp;s) {\n    // do some operations\n}\n</code></pre>\n\n<p>But I feel it could be written in a better way. I'm aware that Go is not object-oriented language but is method invocation like this possible?</p>\n"}, {"tags": ["validation", "http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1535187867, "post_id": 52015579, "comment_id": 90981541, "body": "Usually you would use pointers for this: if no value is passed in the request then the fields will remain <code>nil</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535192675, "post_id": 52015579, "comment_id": 90982708, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/31048557/assigning-null-to-json-fields-instead-of-empty-strings-in-golang\">Assigning null to JSON fields instead of empty strings in Golang</a>"}, {"owner": {"reputation": 43, "user_id": 8823680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ce2f70b3456c580ce72e6dd16a0b866?s=128&d=identicon&r=PG&f=1", "display_name": "Learnerng", "link": "https://stackoverflow.com/users/8823680/learnerng"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1535194234, "post_id": 52015579, "comment_id": 90983135, "body": "Thanks, @mkopriva and zaky had the answer I was looking for. The other answers used external libraries which may not be so idiomatic. Could either of you make an answer and I will flag it as the accepted answer?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535209693, "post_id": 52015579, "comment_id": 90987241, "body": "Note the question actually has nothing to do with HTTP at all. It&#39;s only about detecting the absence of a JSON value."}], "answers": [{"comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535191227, "post_id": 52015838, "comment_id": 90982330, "body": "As @mkopriva mentioned, the idiomatic way is to use a pointer, not to use a library. By using a pointer, the value will be <code>nil</code> instead of set to 0 when not specified."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 2, "creation_date": 1535192808, "post_id": 52015838, "comment_id": 90982747, "body": "Pointer may be the idiomatic way when you want to set a default value when a value is not provided. When you want to validate it may be the wrong way. Let&#39;s say you have a big list of properties, by using pointer you unmarshal the entire struct just to find out it&#39;s not valid.  Lets also assum you have several fields to validate, in this case you can check first for the most likely fields that may be missing and return much faster"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535195660, "post_id": 52015838, "comment_id": 90983462, "body": "Ah my bad, I misunderstood the question in the first place, using a validator library is better for this yeah. Sorry about that :p"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1535199215, "post_id": 52015838, "comment_id": 90984321, "body": "@Ullaakut Then revert your vote down :) If its you of course. Thank you."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 0, "last_activity_date": 1535199492, "last_edit_date": 1535199492, "creation_date": 1535189208, "answer_id": 52015838, "question_id": 52015579, "link": "https://stackoverflow.com/questions/52015579/idiomatic-way-to-validate-http-request-in-go/52015838#52015838", "title": "Idiomatic way to validate http request in go", "body": "<p>You can use <a href=\"https://github.com/buger/jsonparser\" rel=\"nofollow noreferrer\">https://github.com/buger/jsonparser</a> getInt.\nYou'll get an error if the json is missing the expected key.</p>\n\n<p>I recommend using benchmark and not decided by the code beauty or any other hunch </p>\n"}, {"tags": [], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "is_accepted": false, "score": 3, "last_activity_date": 1535191966, "creation_date": 1535191966, "answer_id": 52016218, "question_id": 52015579, "link": "https://stackoverflow.com/questions/52015579/idiomatic-way-to-validate-http-request-in-go/52016218#52016218", "title": "Idiomatic way to validate http request in go", "body": "<p>You can use <a href=\"https://github.com/asaskevich/govalidator\" rel=\"nofollow noreferrer\">https://github.com/asaskevich/govalidator</a> for basic way of validating the request. But in case you want something more sophisticated, you need to write your own custom validator function. e.g.</p>\n\n<pre><code>type Request struct {\n    Start int `json: \"start\"`\n    End int `json: \"end\"`\n}\n\nfunc (a *Request) validate() url.Values {\n    err := url.Values{}\n\n    // Write your own validation rules\n    if a.Start &lt; 0 {\n        err.Add(\"Start\", \"Start cannot be less than 0\");\n    }\n\n    return err;\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    requestBody := &amp;Request{}\n\n    defer r.Body.Close()\n    if err := json.NewDecoder(r.Body).Decode(requestBody); err != nil {\n        panic(err)\n    }\n\n    if errors := requestBody.validate(); len(errors) &gt; 0 {\n        err := map[string]interface{}{\"validationError\": errors}\n        w.Header().Set(\"Content-type\", \"application/json\")\n        w.WriteHeader(http.StatusBadRequest)\n        json.NewEncoder(w).Encode(err)\n    }\n\n    fmt.Fprint(w, \"success request scenario!\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 0, "last_activity_date": 1535327707, "last_edit_date": 1535327707, "creation_date": 1535318397, "answer_id": 52030349, "question_id": 52015579, "link": "https://stackoverflow.com/questions/52015579/idiomatic-way-to-validate-http-request-in-go/52030349#52030349", "title": "Idiomatic way to validate http request in go", "body": "<p>Here's another way to validate structures using struct tags and pointers. Note that if 0 is a valid thing to pass, then this solution will not work.\nomitempty considers the 0 value to be empty. If you want this to work will considering 0 to be valid remove the pointers and modify the IsValid method</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Request struct {\n    Start *int `json: \"start,omitempty\"`\n    End   *int `json: \"end,omitempty\"`\n}\n\nfunc (r Request) IsValid() (bool, error) {\n    if r.Start == nil {\n        return false, fmt.Errorf(\"start is missing\")\n    }\n\n    if r.End == nil {\n        return false, fmt.Errorf(\"end is missing\")\n    }\n\n    return true, nil\n}\n\nvar (\n    invalidStartb = `{\"end\": 1}`\n    invalidEndb   = `{\"start\": 1}`\n    valid         = `{\"start\": 1, \"end\": 1}`\n)\n\nfunc main() {\n    var r Request\n\n    _ = json.Unmarshal([]byte(invalidStartb), &amp;r)\n    fmt.Println(r.IsValid())\n\n    r = Request{}\n    _ = json.Unmarshal([]byte(invalidEndb), &amp;r)\n    fmt.Println(r.IsValid())\n\n    r = Request{}\n    _ = json.Unmarshal([]byte(valid), &amp;r)\n    fmt.Println(r.IsValid())\n\n}\n</code></pre>\n\n<p>runnable version here <a href=\"https://goplay.space/#Z0eqLpEHO37\" rel=\"nofollow noreferrer\">https://goplay.space/#Z0eqLpEHO37</a></p>\n"}], "owner": {"reputation": 43, "user_id": 8823680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ce2f70b3456c580ce72e6dd16a0b866?s=128&d=identicon&r=PG&f=1", "display_name": "Learnerng", "link": "https://stackoverflow.com/users/8823680/learnerng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5963, "favorite_count": 0, "accepted_answer_id": 52030349, "answer_count": 3, "score": 3, "last_activity_date": 1595762588, "creation_date": 1535187285, "question_id": 52015579, "link": "https://stackoverflow.com/questions/52015579/idiomatic-way-to-validate-http-request-in-go", "title": "Idiomatic way to validate http request in go", "body": "<p>I need to validate that my http request has two parameters, Start and End. Currently, I set a default value that should not appear as either of the parameters and check for it along with other invalid values. However, this feels like a hack. What should be the proper way to do this?</p>\n\n<p>Here is my code:</p>\n\n<pre><code>type Request struct {\n    Start int `json: \"start\"`\n    End int `json: \"end\"`\n}\n\n\nfunc HandlePost(w http.ResponseWriter, r *http.Request) {\n    body , _ := ioutil.ReadAll(r.Body)\n    reqData := Request{Start: -1, End: -1} // &lt; whats the correct way to do this\n    json.Unmarshal(body, &amp;reqData)  \n\n    if reqData.Start &lt; 0 &amp;&amp; reqData.End &lt; 0 {\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n    // rest of the logic\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2315, "user_id": 704916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/28ab1b239a5e81ff9714dcb8b1c006a5?s=128&d=identicon&r=PG", "display_name": "ianaz", "link": "https://stackoverflow.com/users/704916/ianaz"}, "edited": false, "score": 0, "creation_date": 1547814376, "post_id": 52014719, "comment_id": 95331837, "body": "Hey Bruno, how did you solve in the end? I have the same problem and it seem the last resort would be to pass up the context"}], "answers": [{"comments": [{"owner": {"reputation": 158, "user_id": 1148129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a16ba391469a4d46f4ed13fd4f4c992b?s=128&d=identicon&r=PG", "display_name": "Bruno Luiz", "link": "https://stackoverflow.com/users/1148129/bruno-luiz"}, "edited": false, "score": 0, "creation_date": 1535211778, "post_id": 52015285, "comment_id": 90987785, "body": "But in this way you will have cyclic dependencies. Today the models are in the pkg/models folder and the repository and service in the pkg/jobs and pkg/headers folders.  About the way you said to create the repository, injecting the database instance: I did exactly this before and I had an implementation of the Add() on each Repository (which was better). But then I had issues with the transaction."}, {"owner": {"reputation": 158, "user_id": 1148129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a16ba391469a4d46f4ed13fd4f4c992b?s=128&d=identicon&r=PG", "display_name": "Bruno Luiz", "link": "https://stackoverflow.com/users/1148129/bruno-luiz"}, "edited": false, "score": 0, "creation_date": 1535212193, "post_id": 52015285, "comment_id": 90987903, "body": "I added a small snipped of how it was before I passed the DB instance through the method"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 158, "user_id": 1148129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a16ba391469a4d46f4ed13fd4f4c992b?s=128&d=identicon&r=PG", "display_name": "Bruno Luiz", "link": "https://stackoverflow.com/users/1148129/bruno-luiz"}, "edited": false, "score": 0, "creation_date": 1535282564, "post_id": 52015285, "comment_id": 91001593, "body": "This is why I added the comment next to <code>GetByUser</code> deceleration. The next things I am going to write is my own opinion. In Go its idiomatic to have the entire application in the root folder. Specially if we are talking about less then 50 files or so. I guess you have less then that. Also I never found <code>models</code> nemaspace to be practical. A data structures is usually part of one of the logic components. In this case the Job should be part of Users component. Do not think about the database when coding logic."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 1, "last_activity_date": 1535184693, "creation_date": 1535184693, "answer_id": 52015285, "question_id": 52014719, "link": "https://stackoverflow.com/questions/52014719/how-to-properly-pass-database-reference-for-transaction-usage/52015285#52015285", "title": "How to properly pass database reference for transaction usage", "body": "<p>I don't know about the Tx problem but I'll try to address the repository injection issue. </p>\n\n<p>The users logic component should ask the caller component to implement the users repository interface in order to function properly.</p>\n\n<p>The calle, main() for example should implement the repository and inject it to the users component, when the caller is Test(t *testing.T) a mock repository will be injected.</p>\n\n<p>Anyway the users component is not aware of the repository interface implementation.</p>\n\n<p>I hope the attached code explain the idea.</p>\n\n<pre><code>package main\n\nfunc main() {\n    //Create the repository\n    userrep := &amp;DbService{make(map[int]*Job), make(map[int]*Job)}\n    //Injecting the repository\n    users := Users{userrep}\n    job := users.Do(2)\n    _ = job\n\n}\n\n//mapdb.go imlement db as map\n//Reimplement it for Gorm or anything that apply to the interface.\ntype DbService struct {\n    dbid   map[int]*Job\n    dbName map[int]*Job\n}\ntype Job struct {\n    name string\n}\n\nfunc (db *DbService) GetByUser(userID int) (*Job, error) {\n    return db.dbName[userID], nil\n}\nfunc (db *DbService) GetByID(userID int, id int) (*Job, error) {\n    return db.dbid[id], nil\n}\n\n//users.go\n\n//this interface is part of the users logic.\n//The logic component say by that to the caller,\n//\"If you give me something that implement this interface I will be able to function properly\"\ntype UsersRep interface {\n    GetByUser(userID int) (*Job, error) // I think its better to avoid the reference to model.Job here\n    GetByID(userID int, id int) (*Job, error)\n}\n\n//usersLogic.go\ntype Users struct {\n    UsersRep\n}\n\nfunc (users *Users) Do(id int) *Job {\n    //do...\n    j, _ := users.GetByUser(id)\n    return j\n}\n</code></pre>\n\n<p>Do the same for headers.</p>\n\n<p>The Gorm repository can implement Users and Headers interfaces.\nIn tests the mock will implement only one of them.</p>\n"}], "owner": {"reputation": 158, "user_id": 1148129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a16ba391469a4d46f4ed13fd4f4c992b?s=128&d=identicon&r=PG", "display_name": "Bruno Luiz", "link": "https://stackoverflow.com/users/1148129/bruno-luiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1555, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1535221889, "creation_date": 1535179494, "last_edit_date": 1535221889, "question_id": 52014719, "link": "https://stackoverflow.com/questions/52014719/how-to-properly-pass-database-reference-for-transaction-usage", "title": "How to properly pass database reference for transaction usage", "body": "<p>Usually I split my web projects in domains and each domain has a service (business layers) and repository (data access layer). I am creating a project where I have two domains (Jobs and Headers).</p>\n\n<p>When creating or updating an job, eventually, headers will be updated as well. The process is orchestrated by the job/service, which internally calls header/service. As multiple insert/updates happen, a transaction is used to control the process.</p>\n\n<p>Usually, when creating a transaction in Go, a \"Tx\" instance is returned and should be used in the further queries, until committed. The only problem is that the DB is injected on the repository creation and it cannot be changed later on as multiple requests will be using the same repository through reference. What are the options in cases like this?</p>\n\n<p>The only option I figured out is to pass the db as a parameter of repositories methods.</p>\n\n<p>pkg/storage/database.go</p>\n\n<pre><code>package storage\n\nimport (\n    \"chronos/pkg/errors\"\n    \"github.com/jinzhu/gorm\"\n)\n\n// DB Database storage interface\ntype DB interface {\n    Add(interface{}) error\n    Delete(interface{}) error\n\n    Begin() (DB, error)\n    Rollback() (DB, error)\n    Commit() (DB, error)\n}\n\n\n// Gorm Database implementation using GORM\ntype Gorm struct {\n    *gorm.DB\n    SQL *gorm.DB\n}\n\n// NewGorm Return new gorm storage instance\nfunc NewGorm(db *gorm.DB) *Gorm {\n    db = db.\n        Set(\"gorm:association_autocreate\", false).\n        Set(\"gorm:association_autoupdate\", false).\n        Set(\"gorm:save_associations\", false).\n        Set(\"gorm:association_save_reference\", false)\n\n    return &amp;Gorm{db, db}\n}\n\n// Begin Begin transaction\nfunc (s *Gorm) Begin() (DB, error) {\n    t := s.SQL.Begin()\n    if err := t.Error; err != nil {\n        return s, errors.Database(err)\n    }\n\n    return NewGorm(t), nil\n}\n</code></pre>\n\n<p>cmd/app/main.go</p>\n\n<pre><code>db, err := gorm.Open(\"mysql\", config)\nst = storage.NewGorm(db)\n\nrJob := job.NewMySQLRepository(log)\nsJob := job.NewService(log, st, rJob)\n\njob.Register(log, router, sJob) // register routes\n</code></pre>\n\n<p>pkg/jobs/interface.go:\nAll methods receive a st.DB interface. Inside the function a type assert is done to get the storage.Gorm implementation</p>\n\n<pre><code>type Repository interface {\n    GetByUser(db st.DB, userID int) ([]*model.Job, error)\n    GetByID(db st.DB, userID int, id int) (*model.Job, error)\n    AddHeaders(db st.DB, job *model.Job, headers []*model.Header) (err error)\n    UpdateHeaders(db st.DB, job *model.Job, headers []*model.Header) (err error) // extract this to headers repository\n}\n</code></pre>\n\n<p>Another option suggested in <a href=\"https://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">this article</a> is to use a context (or maybe a struct?) down the methods, with the sql DB in it. But it doesn't feel right either. Some people told me that the repository and service patterns are not used in Golang, but for me is weird to have database and business logic mixed together.</p>\n\n<p>What is the best option to pass the database reference through the project?</p>\n\n<p>EDIT 1:</p>\n\n<p>How it was organized before the above solution</p>\n\n<p>cmd/app/main.go</p>\n\n<pre><code>db, err := gorm.Open(\"mysql\", config)\n\nrHeader := header.NewMySQLRepository(log, db)\nsHeader := header.NewService(log, rJob)\n\nrJob := job.NewMySQLRepository(log, db) // Inject db in the repository\nsJob := job.NewService(log, rJob, sHeader) // Inject the repository here and other related services\n\njob.Register(log, router, sJob) // register routes\n</code></pre>\n\n<p>pkg/jobs/interface.go:</p>\n\n<pre><code>type Repository interface {\n    Add(user *model.Job) (error)\n    Delete(user *model.Job) (error)\n    GetByUser(userID int) ([]*model.Job, error)\n    GetByID(userID int, id int) (*model.Job, error)\n    AddHeaders(job *model.Job, headers []*model.Header) (err error)\n    UpdateHeaders(job *model.Job, headers []*model.Header) (err error) // extract this to headers repository\n}\n</code></pre>\n"}, {"tags": ["testing", "go", "benchmarking"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1535173566, "post_id": 52013803, "comment_id": 90978833, "body": "Your code is not correct. You say that <code>The 93&#39;th Fibonacci number is : -6246583658587674878.</code> Overflow!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535183862, "post_id": 52013803, "comment_id": 90980636, "body": "Not sure, but the k loop outside of b.Run looks fishy."}], "answers": [{"tags": [], "owner": {"reputation": 1076, "user_id": 1536539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f74fbc2d462470f2c20142c0392f01d?s=128&d=identicon&r=PG", "display_name": "jlovison", "link": "https://stackoverflow.com/users/1536539/jlovison"}, "is_accepted": true, "score": 4, "last_activity_date": 1535200084, "creation_date": 1535200084, "answer_id": 52017314, "question_id": 52013803, "link": "https://stackoverflow.com/questions/52013803/how-to-properly-starttime-and-stoptime-in-golang-benchmark/52017314#52017314", "title": "How to properly StartTime and StopTime in golang benchmark?", "body": "<p>What's happening is that your functions are <strong>really</strong> fast, particularly in the case of the iterative function, and your map reset (as well as the <code>StartTimer</code> and <code>StopTimer</code> functions themselves with the runtime stat allocation) are much, much slower.</p>\n\n<p>So what's happening is that when you call <code>StopTimer</code> it's setting the internally tracked duration of the benchmark to only the time it took to run the function. Well guess how it estimates how many iterations to run within the designated benchmark time? Yep, you guessed it - the internal duration.</p>\n\n<p>So basically, your iterative function takes about 10ns to run, the map reset takes about 250ns, and the Timer functions take considerably longer - but the benchmark is estimating that each run takes only 20ns and is setting the number of iterations accordingly.</p>\n\n<p>My suggestion - don't use the <code>StartTimer/StopTimer</code> functions in this case, and simply add a third run to your tests that's a non-op -- basically: </p>\n\n<pre><code>{\"baseline\", func(int) int {return 0}},\n</code></pre>\n\n<p>Then just subtract the times from this function from the other two sets to estimate how much of the ns/op was from the allocation vs the functions themselves.</p>\n\n<p>Here's the results when I ran this:</p>\n\n<pre><code>BenchmarkFib/baseline_Fib_10-2           5000000           357 ns/op\nBenchmarkFib/baseline_Fib_100-2          5000000           327 ns/op\nBenchmarkFib/baseline_Fib_1000-2         5000000           310 ns/op\nBenchmarkFib/recursive_Fib_10-2          1000000          1659 ns/op\nBenchmarkFib/recursive_Fib_100-2           50000         24898 ns/op\nBenchmarkFib/recursive_Fib_1000-2           5000        301771 ns/op\nBenchmarkFib/iterative_Fib_10-2          5000000           333 ns/op\nBenchmarkFib/iterative_Fib_100-2         3000000           394 ns/op\nBenchmarkFib/iterative_Fib_1000-2        1000000          1052 ns/op\nPASS\nok      _/tmp/dynamicP/fibonacci    15.305s\n</code></pre>\n"}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 1, "accepted_answer_id": 52017314, "answer_count": 1, "score": 4, "last_activity_date": 1535600875, "creation_date": 1535167916, "last_edit_date": 1535600875, "question_id": 52013803, "link": "https://stackoverflow.com/questions/52013803/how-to-properly-starttime-and-stoptime-in-golang-benchmark", "title": "How to properly StartTime and StopTime in golang benchmark?", "body": "<p>I wrote a benchmark to test the speed of two Fibonacci number generators, and the source code is <a href=\"https://github.com/nosarthur/dp/blob/master/fibonacci/fib_test.go\" rel=\"nofollow noreferrer\">here on github</a>.</p>\n\n<pre><code>func BenchmarkFib(b *testing.B) {\n    fibFuncs := []struct {\n        name string\n        f    func(int) int\n    }{\n        {\"recursive\", fibRecu},\n        {\"iterative\", fibIter},\n    }\n    for _, fibFunc := range fibFuncs {\n        // calculate k'th Fibonacci number\n        for k := 10; k &lt; 1001; k *= 10 {\n            b.Run(fmt.Sprintf(\"%s Fib %v\", fibFunc.name, k), func(b *testing.B) {\n                for n := 0; n &lt; b.N; n++ {\n                    //                  b.StopTimer()\n                    // reset the memo\n                    memo = map[int]int{0: 0, 1: 1, 2: 1}\n                    //                  b.StartTimer()\n                    fibFunc.f(k)\n                }\n            })\n        }\n    }\n}\n</code></pre>\n\n<p>As it is, the benchmark works and the output is </p>\n\n<pre><code>nos (master) fibonacci $ go test -bench .\ngoos: linux\ngoarch: amd64\npkg: github.com/nosarthur/dynamicP/fibonacci\nBenchmarkFib/recursive_Fib_10-4                  1000000              1256 ns/op\nBenchmarkFib/recursive_Fib_100-4                  100000             18256 ns/op\nBenchmarkFib/recursive_Fib_1000-4                  10000            206109 ns/op\nBenchmarkFib/iterative_Fib_10-4                 10000000               218 ns/op\nBenchmarkFib/iterative_Fib_100-4                 5000000               292 ns/op\nBenchmarkFib/iterative_Fib_1000-4                2000000               881 ns/op\nPASS\nok      github.com/nosarthur/dynamicP/fibonacci 12.208s\n</code></pre>\n\n<p>However, I added <code>b.StopTime()</code> and <code>b.StartTime()</code> to exclude the time for resetting the memo. With these two lines un-commented, the benchmark hangs, and the partial output is</p>\n\n<pre><code>nos (master *) fibonacci $ go test -bench .\ngoos: linux\ngoarch: amd64\npkg: github.com/nosarthur/dynamicP/fibonacci\nBenchmarkFib/recursive_Fib_10-4                  1000000              2139 ns/op\nBenchmarkFib/recursive_Fib_100-4                  100000             24775 ns/op\nBenchmarkFib/recursive_Fib_1000-4                   5000            239197 ns/op\nBenchmarkFib/iterative_Fib_10-4                 ^Csignal: interrupt\nFAIL    github.com/nosarthur/dynamicP/fibonacci 269.067s\n</code></pre>\n\n<p>What is the proper way to exclude the memo resetting? My go version is 1.10.1</p>\n"}, {"tags": ["json", "rest", "go", "go-gin"], "comments": [{"owner": {"reputation": 881, "user_id": 6442149, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sZt5FQmFYNQ/AAAAAAAAAAI/AAAAAAAAAG8/rKfd2_chNr0/photo.jpg?sz=128", "display_name": "Parijat Purohit", "link": "https://stackoverflow.com/users/6442149/parijat-purohit"}, "edited": false, "score": 0, "creation_date": 1535189369, "post_id": 52013719, "comment_id": 90981920, "body": "<code>{ [ {&quot;id&quot;:&quot;1&quot; &quot;value&quot;: &quot;10&quot;}, {&quot;id&quot;:&quot;2&quot; &quot;value&quot;: &quot;20&quot;}] }</code> Is this a valid json? I doubt that"}], "answers": [{"tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 1, "last_activity_date": 1535190057, "creation_date": 1535190057, "answer_id": 52015954, "question_id": 52013719, "link": "https://stackoverflow.com/questions/52013719/using-put-to-update-several-json-data-in-one-request/52015954#52015954", "title": "Using PUT to update several JSON data in one request", "body": "<p>first of all, you json is invalid.\nI guess that this is what you wanted:</p>\n\n<blockquote>\n  <p>[{\"id\":\"1\" ,\"value\": \"10\"}, {\"id\":\"2\" ,\"value\": \"20\"}]</p>\n</blockquote>\n\n<p>an easier solution will be to add an struct that match your json:</p>\n\n<p>and then add the json.Unmarshal to parse the json:</p>\n\n<pre><code>jsn := `[{\"id\":\"1\" ,\"value\": \"10\"}, {\"id\":\"2\" ,\"value\": \"20\"}]`\nvar data yourSturctName\njson.Unmarshal([]byte(jsn), &amp;data)\nfor _, r := range data {\n    fmt.Printf(\"ID:%s Value:%s\", r.ID, r.Value)\n}\n</code></pre>\n\n<p>then add that into your logic.</p>\n"}], "owner": {"reputation": 569, "user_id": 3309645, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/ApXf7.jpg?s=128&g=1", "display_name": "charles.cc.hsu", "link": "https://stackoverflow.com/users/3309645/charles-cc-hsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535310896, "creation_date": 1535166812, "last_edit_date": 1535310896, "question_id": 52013719, "link": "https://stackoverflow.com/questions/52013719/using-put-to-update-several-json-data-in-one-request", "title": "Using PUT to update several JSON data in one request", "body": "<p>I followed this guide <a href=\"https://medium.com/@cgrant/developing-a-simple-crud-api-with-go-gin-and-gorm-df87d98e6ed1\" rel=\"nofollow noreferrer\">Developing a simple CRUD API with Go, Gin and Gorm</a> to build my first RESTful service in golang, I can read parameter(s) from my web service, and update one value of parameter, But how to parse the JSON to update several values of parameters at one PUT request. </p>\n\n<p>The CURL command I intend to use for my test as bellow</p>\n\n<pre><code>$ curl -i -X PUT http://localhost:8080/params -d '{ [ {\"id\":\"1\",\"value\": \"10\"}, {\"id\":\"2\",\"value\": \"20\"}] }'\n</code></pre>\n\n<p>Following is my code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/gin-contrib/cors\"\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype Param struct {\n    ID    int    `json:\"id\" `\n    Name  string `json:\"name\"`\n    Title string `json:\"title\"`\n    Value string `json:\"value\"`\n}\n\ntype ParamValue struct {\n    ID int `json:\"id\" `\n    // Name  string `json:\"name\"`\n    // Title string `json:\"title\"`\n    Value string `json:\"value\"`\n}\n\nvar db *gorm.DB\nvar err error\n\nfunc main() {\n\n    db, err = gorm.Open(\"mysql\", \"user:password@tcp(127.0.0.1:3306)/test?charset=utf8&amp;parseTime=True&amp;loc=Local\")\n\n    defer db.Close()\n\n    if err != nil {\n        log.Panic(err.Error())\n    }\n\n    db.AutoMigrate(&amp;Param{})\n\n    r := gin.Default()\n\n    r.GET(\"/params\", GetParams)\n    r.GET(\"/params/:id\", GetParam)\n    r.PUT(\"/params/:id\", UpdateParam)\n    r.PUT(\"/params\", UpdateParams) // How to implement this one\n\n    r.Use(cors.Default())\n    r.Run()\n}\n\nfunc GetParams(c *gin.Context) {\n    var params []Param\n    if err := db.Find(&amp;params).Error; err != nil {\n        c.AbortWithStatus(404)\n    } else {\n        c.JSON(200, params)\n    }\n}\n\nfunc GetParam(c *gin.Context) {\n    id := c.Params.ByName(\"id\")\n    var param Param\n    if err := db.Where(\"id = ?\", id).First(&amp;param).Error; err != nil {\n        c.AbortWithStatus(404)\n    } else {\n        c.JSON(200, param)\n    }\n}\n\nfunc UpdateParams(c *gin.Context) {\n    // Debug info\n    fmt.Println(\"c.Request.Method &gt;&gt; \" + c.Request.Method)\n    fmt.Println(\"c.Request.URL.String() &gt;&gt; \" + c.Request.URL.String())\n    // command for testing\n    // $ curl -i -X PUT http://localhost:8080/params -d '{ [ {\"id\":\"1\",\"value\": \"10\"}, {\"id\":\"2\",\"value\": \"20\"}] }'\n}\n\nfunc UpdateParam(c *gin.Context) {\n    var param Param\n    id := c.Params.ByName(\"id\")\n\n    if err := db.Where(\"id = ?\", id).First(&amp;param).Error; err != nil {\n        c.AbortWithStatus(404)\n    } else {\n        name := param.Name // readonly\n        c.BindJSON(&amp;param)\n        if param.Name != name { // if changed\n            param.Name = name   // restore the origin\n        }\n        db.Save(&amp;param)\n        c.JSON(200, param)\n    }\n\n    // $ curl -i -X PUT http://localhost:8080/params/63 -d '{ \"name\": \"recharge\", \"title\": \"switch 0/1:on/off\", \"value\": \"1\"}'\n}\n</code></pre>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["go", "mocking", "tdd"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535184251, "post_id": 52013000, "comment_id": 90980715, "body": "IMHO the problem lies in mocking itself. You asked: &quot;how else am I supposed to verify that DoFoo() was A) invoked, B) invoked with the correct parameters&quot; and my opinion about this question is: &quot;I don&#39;t give a shit. I&#39;m not interested in <i>how</i> the function/method WhichLib comes up with a correct answer, only <i>that</i> it yields proper result.&quot; Whether it calls into ThirdPartyFoo or some some mock or an oracle does not matter. If it behave correct it is correct. So: do not mock."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535184301, "post_id": 52013000, "comment_id": 90980724, "body": "If the function under test calls into stuff which is low, not idempotent or not available: Provide a fake."}, {"owner": {"reputation": 778, "user_id": 2125795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7EreQ.jpg?s=128&g=1", "display_name": "Billy Kimble", "link": "https://stackoverflow.com/users/2125795/billy-kimble"}, "edited": false, "score": 0, "creation_date": 1535222669, "post_id": 52013000, "comment_id": 90990846, "body": "Can you pass in a real mux.Router that has the behavior you&#39;re trying to test? Such as routes with handlers to endpoints you create via httptest.NewServer ? Then you can hit them to verify cases like  when r.router.Path(userRegistration.Path) is called, it goes to a specific URL which fires a handler you have an assert on."}, {"owner": {"reputation": 448, "user_id": 2784641, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ab0ef8f8e87403a4f4fcc8f601c4e839?s=128&d=identicon&r=PG&f=1", "display_name": "DavidZemon", "link": "https://stackoverflow.com/users/2784641/davidzemon"}, "reply_to_user": {"reputation": 778, "user_id": 2125795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7EreQ.jpg?s=128&g=1", "display_name": "Billy Kimble", "link": "https://stackoverflow.com/users/2125795/billy-kimble"}, "edited": false, "score": 0, "creation_date": 1535384880, "post_id": 52013000, "comment_id": 91036496, "body": "@bkimble, thanks for the push. I guess I was just too exhausted Friday to actually <i>look</i> at the mux.Route API to see what options I had. By change my function signature from <code>func (r *ServiceRegistrar) Register(userRegistration Registration, f func(http.ResponseWriter, *http.Request)) error</code> to <code>func (r *ServiceRegistrar) Register(userRegistration Registration, f func(http.ResponseWriter, *http.Request)) (*mux.Route, error)</code>, I can actually run assertions on the created Route. And the Route has &quot;getter&quot; methods on it which I can run assertions against."}], "owner": {"reputation": 448, "user_id": 2784641, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ab0ef8f8e87403a4f4fcc8f601c4e839?s=128&d=identicon&r=PG&f=1", "display_name": "DavidZemon", "link": "https://stackoverflow.com/users/2784641/davidzemon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535155464, "creation_date": 1535155464, "question_id": 52013000, "link": "https://stackoverflow.com/questions/52013000/mocking-complex-methods-on-structs-used-in-a-void-function", "title": "Mocking complex methods on structs used in a void function", "body": "<p>My problem isn't terribly complex. I'll write a simple example first, and then show the real code after in case I missed any subtleties.</p>\n\n<p>So I have a third-party library:</p>\n\n<pre><code>// Third party library\ntype ThirdPartyFoo struct {}    \nfunc (t *ThirdPartyFoo) DoFoo () *ThirdPartyFoo {\n    println(\"I'm a third party library!\")\n    return t\n}\n</code></pre>\n\n<p>And I want to use that library to invoke <code>DoFoo()</code>:</p>\n\n<pre><code>type MyThing struct {\n    TheFoo ThirdPartyFoo\n}\n\nfunc (myThing *MyThing) WhichLib () {\n    myThing.TheFoo.DoFoo()\n}\n</code></pre>\n\n<p>And I want to test it with a mocked version of <code>ThirdPartyFoo</code> because, how else am I supposed to verify that <code>DoFoo()</code> was A) invoked, B) invoked with the correct parameters, and C) <code>MyThing</code> responds correctly based on different return values?</p>\n\n<p>I tried using an interface inside <code>MyThing</code> instead of directly depending on <code>ThirdPartyFoo</code>...</p>\n\n<pre><code>type IThirdPartyFoo interface {\n    DoFoo() *IThirdPartyFoo\n}\n\ntype MyThingWithI struct {\n    TheFoo IThirdPartyFoo\n}\n\nfunc (myThing *MyThingWithI) WhichLib () {\n    myThing.TheFoo.DoFoo()\n}\n</code></pre>\n\n<p>And then invoking the function...</p>\n\n<pre><code>func main() {\n    realFoo := ThirdPartyFoo{}\n    realThing := MyThingWithI{\n        TheFoo: &amp;realFoo,\n    }\n    realThing.WhichLib()\n}\n</code></pre>\n\n<p>But it fails at runtime:</p>\n\n<pre><code>proxyutils/serviceregistrar.go:44:9: cannot use &amp;realFoo (type *ThirdPartyFoo) as type IThirdPartyFoo in field value:\n        *ThirdPartyFoo does not implement IThirdPartyFoo (wrong type for DoFoo method)\n                have DoFoo() *ThirdPartyFoo\n                want DoFoo() IThirdPartyFoo\n</code></pre>\n\n<p>So... I've spent a couple hours trying to figure this out, and another hour writing up this post... and I'm still lost. The only solution I can come up with is to completely wrap the third party library, like so:</p>\n\n<pre><code>type IThirdPartyFooWrapper interface {\n    DoFoo() IThirdPartyFooWrapper\n}\n\ntype ThirdPartyFooWrapper struct {\n    IThirdPartyFooWrapper\n\n    ThirdPartyFoo ThirdPartyFoo\n}\n\nfunc (w *ThirdPartyFooWrapper) DoFoo () IThirdPartyFooWrapper {\n    w.ThirdPartyFoo.DoFoo()\n    return w\n}\n\ntype MyThingWithI struct {\n    TheFooWrapper IThirdPartyFooWrapper\n}\n\nfunc (myThing *MyThingWithI) WhichLib() {\n    myThing.TheFooWrapper.DoFoo()\n}\n</code></pre>\n\n<p>But there are SO MANY levels of indirection already that I really hate to add this one. This is what mocking was made for, but it seems the Go language has completely screwed over any poor schmuck unfortunate enough to have started using a third-party library that isn't making use of interfaces.</p>\n\n<p>And finally, here's my real code. It's the <code>*mux.Router</code> as part of <code>ServiceRegistrar</code> that is being problematic.</p>\n\n<pre><code>package proxyutils\n\nimport (\n    \"errors\"\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\ntype IProxyRegistrar interface {\n    Register(input Registration) error\n}\n\ntype ServiceRegistrarFactory struct{}\n\nfunc (_ *ServiceRegistrarFactory) Build(proxyRegistrar IProxyRegistrar, router *mux.Router) (*ServiceRegistrar, error) {\n    if nil == proxyRegistrar {\n        return nil, errors.New(\"cannot create ServiceRegistrar with nil IProxyRegistrar\")\n    }\n    if nil == router {\n        return nil, errors.New(\"cannot create ServiceRegistrar with nil mux.Router\")\n    }\n    return &amp;ServiceRegistrar{\n        proxyRegistrar: proxyRegistrar,\n        router:         router,\n    }, nil\n}\n\ntype ServiceRegistrar struct {\n    proxyRegistrar IProxyRegistrar\n    router         *mux.Router\n}\n\nfunc (r *ServiceRegistrar) Register(userRegistration Registration, f func(http.ResponseWriter, *http.Request)) error {\n    err := r.proxyRegistrar.Register(userRegistration)\n    if nil == err {\n        var route *mux.Route\n        if userRegistration.PathIsPrefix {\n            route = r.router.PathPrefix(userRegistration.Path)\n        } else {\n            route = r.router.Path(userRegistration.Path)\n        }\n        route.Methods(userRegistration.Methods...).HandlerFunc(f)\n        return nil\n    } else {\n        return err\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "math"], "comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1535161703, "post_id": 52012782, "comment_id": 90977526, "body": "Why don&#39;t just use <code>BigInteger.valueOf(1 &lt;&lt; 8)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1535165316, "last_edit_date": 1535165316, "creation_date": 1535161871, "answer_id": 52013418, "question_id": 52012782, "link": "https://stackoverflow.com/questions/52012782/convert-a-28-bit-representation-to-a-biginteger-on-go/52013418#52013418", "title": "Convert a 2^8 bit representation to a BigInteger on Go", "body": "<p>Attempting to convert code from one language to another is rarely a good idea. Write the function in Go. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"math/big\"\n)\n\nfunc BytesToBigInteger(b []byte) *big.Int {\n    return new(big.Int).SetBytes(b)\n}\n\nfunc main() {\n    b := []byte{1, 1}\n    i := BytesToBigInteger(b)\n    fmt.Println(i, uint16(1&lt;&lt;8+1))\n    b = []byte{255, 255, 255, 255}\n    i = BytesToBigInteger(b)\n    fmt.Println(i, uint32(math.MaxUint32))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/LWzDtr2pkom\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LWzDtr2pkom</a></p>\n\n<p>Output:</p>\n\n<pre><code>257 257\n4294967295 4294967295\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10271651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zZIyGzsP5HM/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaORPORxw0HhuM1XhSN6u-uuaeGdaw/mo/photo.jpg?sz=128", "display_name": "Quiet Question", "link": "https://stackoverflow.com/users/10271651/quiet-question"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535192955, "creation_date": 1535152995, "last_edit_date": 1535192955, "question_id": 52012782, "link": "https://stackoverflow.com/questions/52012782/convert-a-28-bit-representation-to-a-biginteger-on-go", "title": "Convert a 2^8 bit representation to a BigInteger on Go", "body": "<p>I have the following code snippet here that I want to convert to Go.</p>\n\n<pre><code>    BigInteger b = BigInteger.ZERO;\n    for (int i = 0; i &lt; bytes.length; i++) {\n        b = b.add(BigInteger.ONE.multiply(BigInteger.valueOf(bytes[i] &amp; 0xff)).shiftLeft(i * 8));\n    }\n    return b;\n</code></pre>\n\n<p>My converted code to Go below:</p>\n\n<pre><code>//return utils.BytesToBigInteger(bytes)\nb := BigInteger_ZERO()\nfor i, val := range bytes {\n    el := (&amp;big.Int{}).SetUint64(uint64(uint8(val &amp; 0xff))) // &amp; 0xff)\n    one := BigInteger_ONE()\n    one = one.Mul(one, el)\n    b = b.Add(b, el.Lsh(el, uint(i*8)))\n}\n\nreturn b\n</code></pre>\n\n<p>It seems that the result is still not consistent though. Am I missing something?</p>\n"}, {"tags": ["go", "smtp"], "answers": [{"tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 1, "last_activity_date": 1535170464, "creation_date": 1535170464, "answer_id": 52013992, "question_id": 52012522, "link": "https://stackoverflow.com/questions/52012522/how-to-send-custom-hello-to-server/52013992#52013992", "title": "How to send custom hello to server", "body": "<p>Setting the name used within the EHLO/HELO command can simply be done with <code>Hello(name)</code>. From <a href=\"https://godoc.org/net/smtp#Client.Hello\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n\n<blockquote>\n  <p>func (c *Client) Hello(localName string) error<br>\n  Hello sends a HELO or EHLO to the server as the given host name. Calling this method is only necessary if the <strong>client needs control over the host name used</strong>. The client will introduce itself as \"localhost\" automatically otherwise. If Hello is called, <strong>it must be called before any of the other methods</strong>.</p>\n</blockquote>\n\n<p>Thus, all you need to do is something like this:</p>\n\n<pre><code>client, err := smtp.NewClient(remote, smtpServer.Host)\n...\nclient.Hello(\"foobar.example.com\")\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9952873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/332034dd6a3629a2a170f962ec0829c7?s=128&d=identicon&r=PG&f=1", "display_name": "Bello Daniel", "link": "https://stackoverflow.com/users/9952873/bello-daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 52013992, "answer_count": 1, "score": 0, "last_activity_date": 1535192921, "creation_date": 1535150500, "last_edit_date": 1535192921, "question_id": 52012522, "link": "https://stackoverflow.com/questions/52012522/how-to-send-custom-hello-to-server", "title": "How to send custom hello to server", "body": "<p>I try create an SMTP sender in Go. This is part of code:</p>\n\n<pre><code>client, err := smtp.NewClient(remote, smtpServer.Host)\nif err != nil {\n    return err\n}\ndefer client.Close()\n\nauth := SmtpLoginAuth(smtpServer.Username, smtpServer.Password)\nauthErr := client.Auth(auth)\nif authErr != nil {\n    fmt.Println(\"login error\", authErr)\n    return authErr\n}\n\n\nclient.Mail(data.From())\nclient.Rcpt(data.To())\nbodyWriter, err := client.Data()\nif err != nil {\n    fmt.Println(\"body error\", err)\n    return err\n}\n</code></pre>\n\n<p>My problem is: I want to change hello message for server, in this moment my app send from localhost, i want to send DNS domain of my server but I don't know how I can do this in go.</p>\n\n<p>example place where I want to change localhost string : <a href=\"https://jmp.sh/sugc8Ax\" rel=\"nofollow noreferrer\">https://jmp.sh/sugc8Ax</a></p>\n"}]