[{"tags": ["function", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 10, "creation_date": 1542233759, "post_id": 53309537, "comment_id": 93499894, "body": "<code>math.Sqrt2</code> is a constant <a href=\"https://golang.org/pkg/math/#pkg-constants\" rel=\"nofollow noreferrer\">golang.org/pkg/math/#pkg-constants</a> <a href=\"https://golang.org/src/math/const.go\" rel=\"nofollow noreferrer\">golang.org/src/math/const.go</a>"}, {"owner": {"reputation": 69, "user_id": 4942649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2oeXW.jpg?s=128&g=1", "display_name": "Harpagornis", "link": "https://stackoverflow.com/users/4942649/harpagornis"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542309948, "post_id": 53309537, "comment_id": 93533608, "body": "Ahh, I see. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4942649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2oeXW.jpg?s=128&g=1", "display_name": "Harpagornis", "link": "https://stackoverflow.com/users/4942649/harpagornis"}, "edited": false, "score": 0, "creation_date": 1542309964, "post_id": 53309769, "comment_id": 93533615, "body": "Got it! I was overthinking it! Thanks a lot!"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542312417, "post_id": 53309769, "comment_id": 93534705, "body": "&quot;go doesn&#39;t really have any &quot;magic&quot;&quot; --- unless it does: expressions may behave differently depending on the context. Eg: as a part of a composite expression vs as a part of <code>return</code> (multiple value returns). To me - that&#39;s totally counter-intuitive magic"}], "tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": false, "score": 9, "last_activity_date": 1542235018, "creation_date": 1542235018, "answer_id": 53309769, "question_id": 53309537, "link": "https://stackoverflow.com/questions/53309537/golang-function-call-without-parentheses/53309769#53309769", "title": "Golang Function Call Without Parentheses", "body": "<p>There is nothing special happening here. <code>math.Sqrt2</code> is a constant. You can find the other constants in the <code>math</code> package in the <a href=\"https://golang.org/pkg/math/#pkg-constants\" rel=\"noreferrer\">docs</a>.</p>\n\n<p>In general, go doesn't really have any \"magic\". So if something feels a bit magical, its more than likely just a misunderstanding.</p>\n"}], "owner": {"reputation": 69, "user_id": 4942649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2oeXW.jpg?s=128&g=1", "display_name": "Harpagornis", "link": "https://stackoverflow.com/users/4942649/harpagornis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1542235018, "creation_date": 1542233669, "question_id": 53309537, "link": "https://stackoverflow.com/questions/53309537/golang-function-call-without-parentheses", "title": "Golang Function Call Without Parentheses", "body": "<p>I am going through the Golang tutorials on their website and am confused by code similar to this that I've simplified and reproduced here:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    a := math.Sqrt2\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>This prints <code>1.4142135623730951</code> in the sandbox. Replacing <code>a := math.Sqrt2</code> with <code>a := math.Sqrt(2)</code> does the same thing but I'm confused how the function can be called without parentheses. <code>math.Sqrt</code> is not a function pointer here (there is no <code>math.Sqrt2</code> function anyway, it's a function being passed without any parentheses. The function in the Go documentation <a href=\"https://golang.org/pkg/math/#Sqrt\" rel=\"nofollow noreferrer\">here</a> is listed as: <code>func Sqrt(x float64) float64</code> i.e. with the parameter. So how does that work? Is it just because <code>math.Sqrt()</code> is a simplistic function that Go can assume it's a <code>float64</code> without the parentheses passed? Am I missing something? </p>\n\n<p>If it helps, I found this phenomenon <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">here</a> in the tutorials on line 14, originally. If anyone could explain this feature to me, that would be awesome. I'd love to learn about it. </p>\n"}, {"tags": ["go", "go-micro"], "answers": [{"comments": [{"owner": {"reputation": 1544, "user_id": 5315089, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/IzLfL.jpg?s=128&g=1", "display_name": "patreu22", "link": "https://stackoverflow.com/users/5315089/patreu22"}, "edited": false, "score": 0, "creation_date": 1542224777, "post_id": 53307394, "comment_id": 93496057, "body": "Thanks Keith, I was able to make it work :) I updated my answer for anyone interested in the concrete use-case"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542224825, "post_id": 53307394, "comment_id": 93496082, "body": "&quot;the signature of your anonymous function matches that of the handler type declaration&quot; No it doesn&#39;t. The anonymous function has no return, the parameter takes a function that returns <code>error</code>."}, {"owner": {"reputation": 64, "user_id": 846498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab71ac96eb5b41c228a4faa85bfb8651?s=128&d=identicon&r=PG", "display_name": "Keith", "link": "https://stackoverflow.com/users/846498/keith"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542228278, "post_id": 53307394, "comment_id": 93497630, "body": "Oh you&#39;re right @Adrian, I missed that. I have updated the answer, thanks."}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1599810212, "post_id": 53307394, "comment_id": 112894882, "body": "A compilable answer +1"}], "tags": [], "owner": {"reputation": 64, "user_id": 846498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab71ac96eb5b41c228a4faa85bfb8651?s=128&d=identicon&r=PG", "display_name": "Keith", "link": "https://stackoverflow.com/users/846498/keith"}, "is_accepted": false, "score": 2, "last_activity_date": 1542228113, "last_edit_date": 1542228113, "creation_date": 1542223275, "answer_id": 53307394, "question_id": 53307233, "link": "https://stackoverflow.com/questions/53307233/call-function-of-specific-type-in-go/53307394#53307394", "title": "Call function of specific type in Go", "body": "<p>If your signature of your anonymous function matched that of the handler type declaration (Adrian correctly points out you're missing the error return), you should be able to just do a <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">type conversion</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Handler func(int) error\n\nvar a Handler\n\nfunc main() {\n    a = Handler(func(i int) error {\n        return nil\n    })\n\n    fmt.Println(isHandler(a))\n}\n\nfunc isHandler(h Handler) bool {\n    return true\n}\n</code></pre>\n\n<p>Since the the compiler knows at compiler-time that the types match, there's no need to do additional checking, like you might in the case of, say, <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">a type assertion</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1544, "user_id": 5315089, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/IzLfL.jpg?s=128&g=1", "display_name": "patreu22", "link": "https://stackoverflow.com/users/5315089/patreu22"}, "edited": false, "score": 0, "creation_date": 1542224973, "post_id": 53307751, "comment_id": 93496132, "body": "Thanks Adrian, as you can see I already updated my question, because that was the critical point :)"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1542224900, "creation_date": 1542224900, "answer_id": 53307751, "question_id": 53307233, "link": "https://stackoverflow.com/questions/53307233/call-function-of-specific-type-in-go/53307751#53307751", "title": "Call function of specific type in Go", "body": "<p>As the error indicates, the parameter and what you're passing don't match:</p>\n\n<pre><code>type Handler func(Publication) error\n\n             func(p broker.Publication)\n</code></pre>\n\n<p>You have no return value. If you add a return value (even if you always return <code>nil</code>), it will work fine.</p>\n"}], "owner": {"reputation": 1544, "user_id": 5315089, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/IzLfL.jpg?s=128&g=1", "display_name": "patreu22", "link": "https://stackoverflow.com/users/5315089/patreu22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "accepted_answer_id": 53307751, "answer_count": 2, "score": 2, "last_activity_date": 1542228113, "creation_date": 1542222706, "last_edit_date": 1542224852, "question_id": 53307233, "link": "https://stackoverflow.com/questions/53307233/call-function-of-specific-type-in-go", "title": "Call function of specific type in Go", "body": "<p>I'm a complete Go newbie, so sorry for the question in advance.  </p>\n\n<p>I'm trying to work with a so-defined interface to connect to a message broker:  </p>\n\n<pre><code>// Broker is an interface used for asynchronous messaging.\ntype Broker interface {\n    Options() Options\n    Address() string\n    Connect() error\n    Disconnect() error\n    Init(...Option) error\n    Publish(string, *Message, ...PublishOption) error\n    Subscribe(string, Handler, ...SubscribeOption) (Subscriber, error)\n    String() string\n}\n\n// Handler is used to process messages via a subscription of a topic.\n// The handler is passed a publication interface which contains the\n// message and optional Ack method to acknowledge receipt of the message.\ntype Handler func(Publication) error\n\n// Publication is given to a subscription handler for processing\ntype Publication interface {\n    Topic() string\n    Message() *Message\n    Ack() error\n}\n</code></pre>\n\n<p>I'm trying to use the <code>Subscribe</code>-function to subscribe to a channel and thats the point where I'm struggeling right now.\nMy current approach is the following one:  </p>\n\n<pre><code>natsBroker.Subscribe(\n        \"QueueName\",\n        func(p broker.Publication) {\n            fmt.Printf(p.Message)\n        },\n    )\n</code></pre>\n\n<p>The error output is <code>cannot use func literal (type func(broker.Publication)) as type broker.Handler in argument to natsBroker.Subscribe</code>.<br>\nBut how do I ensure that the function type actually is a <code>broker.Handler</code>?  </p>\n\n<p>Thx for your time in advance!</p>\n\n<h2>Update</h2>\n\n<p>In case anybody is interested, the error return type was missing which caused the error, so it should look similar to that:  </p>\n\n<p>natsBroker.Subscribe(\n    \"QueueName\",\n    broker.Handler(func(p broker.Publication) error {\n        fmt.Printf(p.Topic())\n        return nil\n    }),\n)</p>\n"}, {"tags": ["go", "reverse-proxy", "socks", "ssh-tunnel"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1542227969, "post_id": 53306676, "comment_id": 93497505, "body": "Your <code>defer listener.Close()</code> statement before you start the goroutine is going to close your listener, possibly before your goroutine even executes anything. You only need the deferred call that you have in the <code>acceptSLoop</code> function."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1542229463, "post_id": 53306676, "comment_id": 93498124, "body": "Actually the problem with the posted code is not the defer, but rather that nothing is preventing main() from exiting immediately, taking all running goroutines with it."}, {"owner": {"reputation": 1, "user_id": 10653564, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kbeUsOnEWrI/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDli3102waOgMoSRyyxw4LIbjXAig/mo/photo.jpg?sz=128", "display_name": "pb17", "link": "https://stackoverflow.com/users/10653564/pb17"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1542233813, "post_id": 53306676, "comment_id": 93499916, "body": "UPDATE: I don&#39;t seem to be able to modify the post. @MadWombat this is a mistake on my part, the code i have has 2 port listeners: one blocking, the other has <code>go</code> routine so main effectively is blocked in a listen loop. I dropped the idea of dialing out in SSH <code>dialer</code> and just did a <code>remote, err := net.Dial(&quot;tcp4&quot;, addr.String())</code> and it seems to work on the right side. I don&#39;t know if this is fragile or how it is supposed to work with the tunnel."}], "owner": {"reputation": 1, "user_id": 10653564, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kbeUsOnEWrI/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDli3102waOgMoSRyyxw4LIbjXAig/mo/photo.jpg?sz=128", "display_name": "pb17", "link": "https://stackoverflow.com/users/10653564/pb17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 693, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1542234588, "creation_date": 1542220357, "last_edit_date": 1542234588, "question_id": 53306676, "link": "https://stackoverflow.com/questions/53306676/dynamic-port-forward-tcp-traffic-over-reverse-ssh-tunnel", "title": "Dynamic port forward TCP traffic over reverse SSH tunnel", "body": "<p>I have an SSH tunnel which dial into the server endpoint and starts up a remote listener on a port <code>1080</code>. My goal is to dynamically forward any TCP traffic from that port to the client side of the tunnel. While I am able to accept TCP stream I am not able to find a way to <code>Dial</code> out on the client side of the SSH tunnel. It looks like the <code>dialer</code> I am passing is the <code>serverConn</code> server SSH end of the tunnel. And when I am attempting to <code>remote, err := dialer.DialTCP(\"tcp4\", local.RemoteAddr().(*net.TCPAddr), addr)</code> I get the traffic dial on the remote end. I want to find a way to dial out at the client side over a reverse tunnel. </p>\n\n<p>I am not looking to forward specific ports to a specific destination on local, but looking to do more dynamic port forwarding similar to <code>ssh -D</code> option. I am managing destination of TCP traffic myself, this is not a concern. </p>\n\n<p>I have tried to create <code>ssh.NewClient</code> from the passed <code>serverConn</code> but it needs to perform an SSH handshake, and Iam only receiving raw TCP on the port <code>1080</code> so it's not a valid SSH client. Thanks.</p>\n\n<pre><code>func main(){\n\n    type Dialer interface {\n       DialTCP(net string, laddr, raddr *net.TCPAddr) (net.Conn, error)\n    }\n\n    // SSH server connection\n    sshConfig := &amp;ssh.ClientConfig{\n         User: \"tester\",\n         Auth: []ssh.AuthMethod{\n         ssh.PublicKeys(signer),\n         },\n         HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    }\n    // Connect to SSH remote server using serverEndpoint (port 22)\n    serverConn, err := ssh.Dial(\"tcp\", serverEndpoint.String(), sshConfig)\n\n    if err != nil {\n        log.Fatalln(fmt.Printf(\"Dial INTO remote server error: %s\", err))\n    }\n\n    // Listen on remote server port (port 1080)\n    listener, err := serverConn.Listen(\"tcp\", \n                     remoteEndpoint.String())\n    if err != nil {\n        log.Fatalln(fmt.Printf(\"Listen open port ON remote server error: %s\", err))\n    }\n    defer listener.Close()\n\n    acceptSLoop(listener, serverConn)\n}\n\nfunc acceptSLoop(listener net.Listener, sshClient *ssh.Client) {\n\n    fmt.Printf(\"Listener: %s\\n\", listener.Addr().String())\n    defer listener.Close()\n    for {\n        clientConn, err := listener.Accept()\n        fmt.Printf(\"local addr %s\\n\", clientConn.LocalAddr())\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"New connection found on %s\\n\", listener.Addr().String())\n        listenSConnection(clientConn, sshClient, config)\n     }\n }\n\nfunc listenSConnection(SClientConn net.Conn, sshClient \n  *ssh.Client) {\n     // In a regular SSH I need to do\n     // sshConn, chans, reqs, err := \n     ssh.NewServerConn(SClientConn, // config will be \n         passed in ..)\n     //\n     // But since it's TCP handoff I am passing socket data \n        directly\n     handleSConn(SClientConn, sshClient)\n }\n\nfunc handleSConn(local net.Conn, dialer Dialer) {\n       defer local.Close()\n\n       // Both of those establish socket from \"remote\" ssh side (Server) not \"local\" ssh side (client)\n       remote, err := dialer.DialTCP(\"tcp4\", local.RemoteAddr().(*net.TCPAddr), addr)\n       //remote, err := net.Dial(\"tcp4\", addr.String())\n\n       // transfer bytes from local SOCKS to remote desired endpoint over SSH\n       transfer(local, remote)\n}\n\n// in - local SOCKS conn, out - remote desired endpoint\nfunc transfer(in, out net.Conn) {\n     //.... working\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "command-prompt"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542220340, "post_id": 53306447, "comment_id": 93494017, "body": "Why would you unit test an external package? It should have its own tests already."}, {"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542220479, "post_id": 53306447, "comment_id": 93494084, "body": "Well I want to test my function that uses that package."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542221290, "post_id": 53306447, "comment_id": 93494491, "body": "Your function that uses it doesn&#39;t do anything itself, unit testing it delivers no value."}, {"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542221886, "post_id": 53306447, "comment_id": 93494751, "body": "It returns the email string.  The function is used a few times throughout.  I guess I could just reuse the same promptui code block throughout but thought that would go against DRY best practices."}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542226401, "post_id": 53306447, "comment_id": 93496788, "body": "I agree that there is a value in testing code that calls <code>promptui</code>. Tests create a <code>safety net</code> that reduce regression errors. You never know how you have to refactor/extend that code in the future."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "edited": false, "score": 0, "creation_date": 1542221635, "post_id": 53306841, "comment_id": 93494637, "body": "Thanks for your help."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 2, "last_activity_date": 1542230147, "last_edit_date": 1542230147, "creation_date": 1542221050, "answer_id": 53306841, "question_id": 53306447, "link": "https://stackoverflow.com/questions/53306447/how-do-i-unit-test-this-promptui-package-written-in-golang/53306841#53306841", "title": "How do I unit test this promptui package written in golang?", "body": "<p>For whatever reason, they don't export their <code>stdin</code> interface (<a href=\"https://github.com/manifoldco/promptui/blob/master/prompt.go#L49\" rel=\"nofollow noreferrer\">https://github.com/manifoldco/promptui/blob/master/prompt.go#L49</a>), so you can't mock it out, but you can directly mock <code>os.Stdin</code> and prefill it with whatever you need for testing. Though I agree with @Adrian, it has its own tests, so this shouldn't be necessary.</p>\n\n<p>Extracted and refactored/simplified from source: <a href=\"https://stackoverflow.com/questions/46365221/fill-os-stdin-for-function-that-reads-from-it\">Fill os.Stdin for function that reads from it</a></p>\n\n<p>Refactored this way, it can be used for any function that reads from <code>os.Stdin</code> and expects a specific string.</p>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/rjgcGIaftBK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rjgcGIaftBK</a></p>\n\n<pre><code>func TestSetEmail(t *testing.T) {\n    if err := TestExpectedStdinFunc(\"email@test.com\", setEmail); err != nil {\n        t.Error(err)\n        return\n    }\n    fmt.Println(\"success\")\n}\n\nfunc TestExpectedStdinFunc(expected string, f func() string) error {\n    content := []byte(expected)\n    tmpfile, err := ioutil.TempFile(\"\", \"example\")\n    if err != nil {\n        return err\n    }\n\n    defer os.Remove(tmpfile.Name()) // clean up\n\n    if _, err := tmpfile.Write(content); err != nil {\n        return err\n    }\n\n    if _, err := tmpfile.Seek(0, 0); err != nil {\n        return err\n    }\n\n    oldStdin := os.Stdin\n    defer func() { os.Stdin = oldStdin }() // Restore original Stdin\n\n    os.Stdin = tmpfile\n    actual := f()\n    if actual != expected {\n        return errors.New(fmt.Sprintf(\"test failed, exptected: %s actual: %s\", expected, actual))\n    }\n\n    if err := tmpfile.Close(); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "edited": false, "score": 0, "creation_date": 1542222175, "post_id": 53306990, "comment_id": 93494908, "body": "Thank you for your help."}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 3, "last_activity_date": 1542221683, "creation_date": 1542221683, "answer_id": 53306990, "question_id": 53306447, "link": "https://stackoverflow.com/questions/53306447/how-do-i-unit-test-this-promptui-package-written-in-golang/53306990#53306990", "title": "How do I unit test this promptui package written in golang?", "body": "<p>You should not try to test <code>promptui</code> as it is expected to be tested by its author.</p>\n\n<p>What you can test:</p>\n\n<ol>\n<li>You send correct parameters when you create <code>promptui.Prompt</code></li>\n<li>You use that <code>promptui.Prompt</code> in your code</li>\n<li>You properly handle <code>promptui.Prompt</code> results</li>\n</ol>\n\n<p>As you can see, all these tests does not verify if <code>promptui.Prompt</code> works correctly inside. </p>\n\n<p>Tests #2 and #3 could be combined. You need to run you code against mock and if you got correct result, you can believe that both #2 and #3 are correct.</p>\n\n<p>Create mock:</p>\n\n<pre><code>type Runner interface {\n    Run() (int, string, error)\n}\n\ntype promptMock struct {\n    // t is not required for this test, but it is would be helpful to assert input parameters if we have it in Run()\n    t *testing.T\n}\n\nfunc (p promptMock) Run() (int, string, error) {\n    // return expected result\n    return 1, \"\", nil\n}\n</code></pre>\n\n<p>You will need separate mock for testing error flow.</p>\n\n<p>Update your code to inject mock:</p>\n\n<pre><code>func setEmail(runner Runner) string {\n    email, err := runner.Run()\n    if err != nil {\n      color.red(\"failed getting email\")\n      os.exit(3)\n    }\n    return email\n}\n</code></pre>\n\n<p>Now it is testable.</p>\n\n<p>Create function that creates <code>prompt</code>:</p>\n\n<pre><code>func getRunner() promptui.Prompt {\n  return promptui.Prompt{Label: \"Input your Email\",\n     Validate: emailValidations,\n  }\n} \n</code></pre>\n\n<p>Write simple assert test to verify that we create correct structure.</p>\n\n<p>The only not tested line will be <code>setEmail(getRunner())</code> but it is trivial and can be covered by other types of tests.</p>\n"}], "owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1542230147, "creation_date": 1542219259, "question_id": 53306447, "link": "https://stackoverflow.com/questions/53306447/how-do-i-unit-test-this-promptui-package-written-in-golang", "title": "How do I unit test this promptui package written in golang?", "body": "<p>I am new to golang and I am using an interactive prompt called promptui (<a href=\"https://github.com/manifoldco/promptui\" rel=\"nofollow noreferrer\">https://github.com/manifoldco/promptui</a>) in a project of mine. I have written several unit tests for this project already but I am struggling with how I would unit test this particular package that requires an input.</p>\n\n<p>For example, How would I go about testing the following lines of code (encapsulated in a function):</p>\n\n<pre><code>func setEmail() string {\n  prompt := promptui.Prompt{Label: \"Input your Email\",\n     Validate: emailValidations,\n  }\n\n  email, err := prompt.Run()\n  if err != nil {\n    color.red(\"failed getting email\")\n    os.exit(3)\n  }\n  return email\n}\n</code></pre>\n\n<p>I think I need to somehow mock stdin but can't figure out the best way to do that within a test.</p>\n"}, {"tags": ["go", "multiple-return-values"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1542218315, "post_id": 53306152, "comment_id": 93493123, "body": "There&#39;s no concurrency here and therefore absolutely no reason to use a channel. Just return a slice of values."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1542219268, "post_id": 53306152, "comment_id": 93493519, "body": "You&#39;re calling <code>return</code> unconditionally within your scanner loop.  It&#39;s never going to loop more than once, it&#39;s just going to scan the first item, sleep for 2 seconds, and then return that first item and discard the rest."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1542223927, "post_id": 53306152, "comment_id": 93495688, "body": "Please, please <i>DON&#39;T PANIC</i>. that <code>check</code> function is not idiomatic golang <i>at all</i>"}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1542291903, "post_id": 53306152, "comment_id": 93523227, "body": "@Kaedys And this is what I am trying to solve."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542292200, "post_id": 53306152, "comment_id": 93523420, "body": "@Adrian In the long term, their will be concurrency. But, I will attempt to use slices to fix this. Thanks for your input!"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1542390515, "post_id": 53306152, "comment_id": 93564779, "body": "@EliasVanOotegem that type of check function is fairly commonly used in the &quot;hacking&quot; phase of putting code together, or in scripts that really should just die if an error occurs.  And to be honest, if I want to kill an app, I <i>vastly</i> prefer <code>panic()</code> to <code>log.Fatal()</code> or <code>os.Exit(1)</code>, because panics can be caught, and they run deferred calls and such before they die."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1542643797, "post_id": 53306152, "comment_id": 93632763, "body": "@Kaedys: <code>panic</code>&#39;s can&#39;t be caught, there&#39;s a <code>recover</code> mechanism. You really shouldn&#39;t think of panics as exceptiosn. The term <i>&quot;caught&quot;</i> suggests you are treating them as exceptions. A <code>panic</code> should be used in rare occasions, where something completely left-field has happened. The last thing you want in those cases is for a deferred call to be invoked. It might attempt to close a resource that doesn&#39;t exist (yet) etc..."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1542650889, "post_id": 53306152, "comment_id": 93636404, "body": "I meant &quot;caught&quot; in the sense of recovery, yes.  I use it specifically as a replacement for os.Exit or log.Fatal, <i>not</i> a replacement for proper error return and handling, and I use it as a replacement for those because unlike os.Exit or log.Fatal (which calls os.Exit), a panic can be intercepted via <code>recover()</code> before the program terminates, while os.Exit cannot.  And whether a defer runs things it shouldn&#39;t or not is purely on the engineer coding them.  A defer to clean up something should <i>not</i> be made before that something is there to clean up."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1542651019, "post_id": 53306152, "comment_id": 93636467, "body": "Defers by design run when the function returns regardless of how it does so.  So you should never ever schedule a deferred call unless you&#39;re at a point in the function where running that call will <i>always</i> be the correct thing to do at the end of the function regardless of how the function returns.  Cleaning up something that doesn&#39;t exist yet does not fit that requirement, and thus reflects a code design error, not a problem with using <code>panic</code> or <code>defer</code>."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542735309, "post_id": 53306152, "comment_id": 93672169, "body": "Is it possible that system that control domain names in file will push data to you directly? This is the end scenario. Their will be a function pushing domain names directly to me. (GO-Colly) But, I can&#39;t capture the domains crawled using [ e.Request.Visit(e.Attr(&quot;href&quot;)) ] &lt;-- Requires basic understanding of Go-Colly."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1542740979, "post_id": 53306152, "comment_id": 93674908, "body": "@EliasVanOotegem You are correct and I do see what you mean now: I&#39;ve updated the code. Still unsure how to go about what I am trying to do here though.  A Function will push a domain the one described in my comment above."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1542219528, "post_id": 53306394, "comment_id": 93493653, "body": "Unless said file is enormous, this pattern makes little sense (and OP said it&#39;s 3 lines long). You want to read in the file and get it closed. Returning a slice is far more pragmatic and you could use it concurrently from there"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1542229122, "post_id": 53306394, "comment_id": 93497985, "body": "OP also said the file is 3 sites but will expand as it visits more sites.  If they read the file and close it, they obviously won&#39;t be able to read new lines as they get added."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1542229970, "post_id": 53306394, "comment_id": 93498315, "body": "Makes sense... but not to argue (sorry), but then it would make even more sense to read the entire file of original entries, close the file, then modify it as necessary, or even write to a different file. Leaving the file open might not be the best approach, especially with concurrent r/w access."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542292109, "post_id": 53306394, "comment_id": 93523353, "body": "Yes. The file will concurrently expand. For the sake of the CURRENT issue at hand. Iterating through the domains.txt with 3 SITES in it is the issue. I&#39;ve also realized using this code will not pass EACH domain into the next function due to the type so a conversion will be necessary."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1542292482, "post_id": 53306394, "comment_id": 93523621, "body": "@RayfenWindspear Your the second to suggest slices. I will be attempting this right now."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542304086, "post_id": 53306394, "comment_id": 93530857, "body": "I am attempting to use this example but the channel itself is of TYPE Chan String. When attempting to use StackOverflow examples to convert, it&#39;s returning errors that seems to be pointing to ALL of the stored information and not iterating one of each to be used as an argument in the bannergrab function. Example I Used(and adjusted): <a href=\"https://stackoverflow.com/questions/30860644/convert-chan-to-non-chan-in-golang\" title=\"convert chan to non chan in golang\">stackoverflow.com/questions/30860644/&hellip;</a>"}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542304283, "post_id": 53306394, "comment_id": 93530957, "body": "Also, I did adjust BannerGrab to accept Chan Strings but still can&#39;t be used in a http request. I&#39;d hate to constantly creating new questions. What is the best way to solve this issue or convert Chan Strings to string so that it can&#39;t be used in the http request. Side Note: I am still not sure if this will iterate through each word of the text file. I do understand by definition it should."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1542219053, "creation_date": 1542219053, "answer_id": 53306394, "question_id": 53306152, "link": "https://stackoverflow.com/questions/53306152/iterating-over-multiple-returns-in-golang/53306394#53306394", "title": "Iterating over multiple returns in golang", "body": "<p>If you wanted to do it \"concurrently\", you would return a channel through which you will send the multiple things you want to return:</p>\n\n<p><a href=\"https://play.golang.org/p/iYBGPwfYLYR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iYBGPwfYLYR</a></p>\n\n<pre><code>func DomainGrab() &lt;-chan string {\n    ch := make(chan string, 1)\n    f, _ := os.Open(\"domains.txt\")\n    defer f.Close()\n    scanner := bufio.NewScanner(f)\n    go func() {\n    // Loop over all lines in the file and print them.\n        for scanner.Scan() {\n            line := scanner.Text()\n            time.Sleep(2 * time.Second)\n            ch &lt;- line\n        }\n        close(ch)\n    }()\n    return ch\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1542221963, "post_id": 53306639, "comment_id": 93494792, "body": "@RayfenWindspear I made that conclusion from these statements <code>take input from a text file containing domains</code> and <code>since the domain list ... will CONCURRENTLY expand</code>. Hopefully author can clarify."}, {"owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542291966, "post_id": 53306639, "comment_id": 93523274, "body": "I apologize for the confusion. The main issue is returning EACH WORD in the text file to be passed as an argument for the next function to use. I&#39;ve been able to return ALL which results in error or just ONE which doesn&#39;t solve the issue."}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "reply_to_user": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "edited": false, "score": 0, "creation_date": 1542294536, "post_id": 53306639, "comment_id": 93524950, "body": "@Authac No problem :)"}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 1, "last_activity_date": 1542220172, "creation_date": 1542220172, "answer_id": 53306639, "question_id": 53306152, "link": "https://stackoverflow.com/questions/53306152/iterating-over-multiple-returns-in-golang/53306639#53306639", "title": "Iterating over multiple returns in golang", "body": "<p>If I understand your question, you want to read the file, somehow detect that file was modified and have a method that will emit these modifications to client code.</p>\n\n<p>That is not how files work. </p>\n\n<p>you have two options:</p>\n\n<ol>\n<li><p>Listen for file changes using some OS specific API - <a href=\"https://www.linuxjournal.com/content/linux-filesystem-events-inotify\" rel=\"nofollow noreferrer\">https://www.linuxjournal.com/content/linux-filesystem-events-inotify</a> </p></li>\n<li><p>Read file using infinite loop. Read the file once. Save the copy into memory.  Read the same file again and again in loop till new file is different from copy and calculate the delta.</p></li>\n</ol>\n\n<p>Check if that is possible to use <code>push</code> instead of <code>pull</code> for getting new domains. Is it possible that system that control domain names in file will push data to you directly?</p>\n\n<p>If <code>loop</code> is the only possible option, set up some pause time between file reads to reduce system load.</p>\n\n<p>Use channels as @dave <a href=\"https://stackoverflow.com/a/53306394/1420332\">suggested</a> when you managed to get new domains and need to process them concurrently.</p>\n"}, {"tags": [], "owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "is_accepted": false, "score": 0, "last_activity_date": 1542742602, "creation_date": 1542742602, "answer_id": 53400335, "question_id": 53306152, "link": "https://stackoverflow.com/questions/53306152/iterating-over-multiple-returns-in-golang/53400335#53400335", "title": "Iterating over multiple returns in golang", "body": "<p>Probably not the BEST solution. But, I decided to get rid of a separate function all together just cover more ground. I'll post below the code of what I expect. Now, I need to parse the domains so that Root URL's and Subdomains are only scanned once. </p>\n\n<pre><code>// Main\npackage main\n\nimport (\n    \"log\"\n    \"fmt\"\n    \"time\"\n    \"net/http\"\n    \"github.com/gocolly/colly\"\n)\n\n//var Domain string\nvar Target string\n\n\nfunc main() {\n    c := colly.NewCollector()\n\n    c.OnError(func(r *colly.Response, err error) {\n        fmt.Println(\"Request URL:\", r.Request.URL, \"\\n Failed with response:\", r.StatusCode)\n    })\n\n    // Find and visit all links\n    c.OnHTML(\"a\", func(e *colly.HTMLElement) {\n        e.Request.Visit(e.Attr(\"href\"))\n    })\n\n    c.OnRequest(func(r *colly.Request) {\n        Domain := r.URL.String()\n        Target := BannerGrab(Domain)\n        fmt.Println(Domain)\n        fmt.Println(Target)\n        fmt.Println(\"Dropping By.. \", r.URL)\n        time.Sleep(1000 * time.Millisecond)\n    })\n\n    c.Visit(\"http://www.milliondollarhomepage.com/\")\n    }\n\n    //CheckDB if not listed else add\n    //RiskDB\n    //Email\n\n\nfunc BannerGrab(s string) string {\n\n    client := &amp;http.Client{}\n    req, err := http.NewRequest(\"GET\", s, nil)\n        if err != nil {\n        log.Fatalln(err)\n    }\n    req.Header.Set(\"User-Agent\", \"Authac/0.1\")\n    resp, _ := client.Do(req)\n    serverEntry := resp.Header.Get(\"Server\")\n    return serverEntry\n\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 5411134, "user_type": "registered", "profile_image": "https://graph.facebook.com/509381419230952/picture?type=large", "display_name": "Naval", "link": "https://stackoverflow.com/users/5411134/naval"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1542742602, "creation_date": 1542218043, "last_edit_date": 1542738911, "question_id": 53306152, "link": "https://stackoverflow.com/questions/53306152/iterating-over-multiple-returns-in-golang", "title": "Iterating over multiple returns in golang", "body": "<p>I am trying to take input from a text file containing domains(unknown amount) to then use each as an argument and get their server type. As expected, this only returns the last domain. How do I iterating multiple return values? \nBelow is the code.\n    // Test\n    package main</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"time\"\n    \"os\"\n    \"fmt\"\n    \"net/http\"\n    //\"github.com/gocolly/colly\"\n)\n\nvar Domain string\nvar Target string\n\nfunc main() {\n    Domain := DomainGrab()\n    Target := BannerGrab(Domain)\n    //CheckDB if not listed then add else skip\n    //RiskDB\n    //Email\n    fmt.Println(Domain)\n    fmt.Println(Target)\n}\n\nfunc BannerGrab(s string) string {\n\n    client := &amp;http.Client{}\n    req, err := http.NewRequest(\"GET\", s, nil)\n    if err != nil {\n    log.Fatalln(err)\n    }\n    req.Header.Set(\"User-Agent\", \"Authac/0.1\")\n    resp, _ := client.Do(req)\n    serverEntry := resp.Header.Get(\"Server\")\n    return serverEntry\n\n}\nfunc DomainGrab() string {\n\n    //c := colly.NewCollector()\n// Open the file.\n    f, _ := os.Open(\"domains.txt\")\n    defer f.Close()\n    // Create a new Scanner for the file.\n    scanner := bufio.NewScanner(f)\n    // Loop over all lines in the file and print them.\n    for scanner.Scan() {\n        line := scanner.Text()\n        time.Sleep(2 * time.Second)\n        //fmt.Println(line)\n        return line\n    }\n    return Domain\n}\n</code></pre>\n"}, {"tags": ["xml", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1542224051, "post_id": 53305826, "comment_id": 93495743, "body": "Have you <i>tried</i> anything so far? The XML <code>struct</code>ure kind of maps onto <code>struct</code>s quite easily. You have 1 <code>struct</code>ure containing several <code>person</code> structures, which you want to map on a slice of <code>People</code>type. Why not wrap <code>[]People</code> in a <code>File</code> type?"}, {"owner": {"reputation": 117, "user_id": 5264794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a6b8757abac5a24c483e69dce450157?s=128&d=identicon&r=PG&f=1", "display_name": "Taavi", "link": "https://stackoverflow.com/users/5264794/taavi"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1542240451, "post_id": 53305826, "comment_id": 93502037, "body": "@EliasVanOotegem Yes, I tried several things. One thing I tried I also gave as an answer a few hours  before your comment. Is your proposed solution any different to the answer I gave?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1542368756, "post_id": 53305826, "comment_id": 93553183, "body": "Didn&#39;t spot that you authored the answer, it&#39;s pretty much what I suggested. Usually not a huge fan of anonymous structs, but when (un)marshalling XML, they have their place"}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1542217479, "post_id": 53305827, "comment_id": 93492761, "body": "You don&#39;t need these to be separate types.  You can easily include the &#39;Person&#39; struct as a nested struct directly within the definition of File.  You also should avoid empty literals, <code>file := File{}</code> has the exact same effect and is less readable than <code>var file File</code> (golint will complain about it, too).  <a href=\"https://play.golang.org/p/pCtSsx7LbZD\" rel=\"nofollow noreferrer\">play.golang.org/p/pCtSsx7LbZD</a>"}], "tags": [], "owner": {"reputation": 117, "user_id": 5264794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a6b8757abac5a24c483e69dce450157?s=128&d=identicon&r=PG&f=1", "display_name": "Taavi", "link": "https://stackoverflow.com/users/5264794/taavi"}, "is_accepted": true, "score": 2, "last_activity_date": 1542832165, "last_edit_date": 1542832165, "creation_date": 1542216770, "answer_id": 53305827, "question_id": 53305826, "link": "https://stackoverflow.com/questions/53305826/how-to-unmarshal-simple-xml-with-multiple-items-in-go/53305827#53305827", "title": "How to Unmarshal simple xml with multiple items in Go?", "body": "<p>You need to create two structs:</p>\n\n<ul>\n<li>one to represent the <code>&lt;file&gt;</code> <code>&lt;/file&gt;</code></li>\n<li>one for the repeating record <code>&lt;person&gt;</code> <code>&lt;/person&gt;</code></li>\n</ul>\n\n<p>Please see the comments inside the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nvar sourceXML = []byte(`&lt;file&gt;\n    &lt;person&gt;\n        &lt;name&gt;John Doe&lt;/name&gt;\n        &lt;age&gt;18&lt;/age&gt;\n    &lt;/person&gt;\n    &lt;person&gt;\n        &lt;name&gt;Jane Doe&lt;/name&gt;\n        &lt;age&gt;20&lt;/age&gt;\n    &lt;/person&gt;\n&lt;/file&gt;`)\n\n// Define a structure for each record\ntype Person struct {\n    Name string `xml:\"name\"`\n    Age  int    `xml:\"age\"`\n}\n\n// There needs to be a single struct to unmarshal into\n// File acts like that one root struct\ntype File struct {\n    People []Person `xml:\"person\"`\n}\n\nfunc main() {\n    // Initialize an empty struct\n    var file File\n\n    err := xml.Unmarshal(sourceXML, &amp;file)\n    if err != nil {\n        fmt.Println(err)\n    }\n    // file.People returns only the []Person rather than the root\n    // file struct with it's contents\n    fmt.Printf(\"%+v\", file.People)\n}\n// output:\n// [{Name:John Doe Age:18} {Name:Jane Doe Age:20}]\n</code></pre>\n\n<p>Edit. Kaedys said the File and Person structures can also be nested (using anonymous structs) as follows:</p>\n\n<pre><code>type File struct {\n    People []struct {\n        Name string `xml:\"name\"`\n        Age  int    `xml:\"age\"`\n    } `xml:\"person\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 5264794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a6b8757abac5a24c483e69dce450157?s=128&d=identicon&r=PG&f=1", "display_name": "Taavi", "link": "https://stackoverflow.com/users/5264794/taavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 0, "accepted_answer_id": 53305827, "answer_count": 1, "score": 0, "last_activity_date": 1542832165, "creation_date": 1542216770, "last_edit_date": 1542238820, "question_id": 53305826, "link": "https://stackoverflow.com/questions/53305826/how-to-unmarshal-simple-xml-with-multiple-items-in-go", "title": "How to Unmarshal simple xml with multiple items in Go?", "body": "<p>I would like to get a slice of people ([]People) from the following xml:</p>\n\n<pre><code>&lt;file&gt;\n    &lt;person&gt;\n        &lt;name&gt;John Doe&lt;/name&gt;\n        &lt;age&gt;18&lt;/age&gt;\n    &lt;/person&gt;\n    &lt;person&gt;\n        &lt;name&gt;Jane Doe&lt;/name&gt;\n        &lt;age&gt;20&lt;/age&gt;\n    &lt;/person&gt;\n&lt;/file&gt;\n</code></pre>\n\n<p>(All other similar questions were too specific and verbose)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542213291, "post_id": 53304243, "comment_id": 93490517, "body": "I don&#39;t know anything about chi, but my guess is that it&#39;s writing to the hijacked connection. Separate from this issue, the application should read from the connection.  See the <a href=\"https://godoc.org/github.com/gorilla/websocket#hdr-Control_Messages\" rel=\"nofollow noreferrer\">last paragraph in section of control message doc</a> for information on this. If the application is panicking, then please share the stack trace fro the panic. The stack trace will likely point directly to the problem."}], "owner": {"reputation": 1977, "user_id": 3461985, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/7117984bdaa3bbb4167960100304734e?s=128&d=identicon&r=PG&f=1", "display_name": "Kravitz", "link": "https://stackoverflow.com/users/3461985/kravitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1542240428, "creation_date": 1542211240, "last_edit_date": 1542240428, "question_id": 53304243, "link": "https://stackoverflow.com/questions/53304243/poll-api-pass-result-to-chan-pass-from-chan-to-websocket-panic", "title": "Poll API, pass result to chan, pass from chan to Websocket. Panic", "body": "<p>I'm writing a small package which does a <code>GET</code> request to an external API every 2 seconds. It takes the value from this request and passes it into a channel. I have made this channel available to a http.handler (chi router) which upgrades to a websocket where the front-end will grab the value in realtime. the panic error is a lot of lines but i guess the most important is this:</p>\n\n<pre><code>2018/11/14 16:47:55 http: response.WriteHeader on hijacked connection\n2018/11/14 16:47:55 http: response.Write on hijacked connection\n</code></pre>\n\n<p>Aside from that I'm sure there is a better way of doing this. Any experienced Gophers out there have any pointers to help a noob such as myself improve this?</p>\n\n<pre><code>package currencyticker\n\nimport (\n    \"bitbucket.org/special/api/config\"\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/go-chi/chi\"\n    \"github.com/go-chi/render\"\n    \"github.com/gorilla/websocket\"\n    \"github.com/leekchan/accounting\"\n    \"io/ioutil\"\n    \"log\"\n    \"math/big\"\n    \"net/http\"\n    \"time\"\n)\n\nvar (\n    ac       = accounting.Accounting{Precision: 2}\n    from     = \"USD\"\n    to       = \"EUR,SWK\"\n    url      = \"https://min-api.currencyapi.com/data/price?fsym=\" + from + \"&amp;tsyms=\" + to\n    messages = make(chan float64)\n)\n\nvar wsupgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n    CheckOrigin: func(r *http.Request) bool {\n        return true // Disable CORS for testing\n    },\n}\n\n// Config - init\ntype Config struct {\n    *config.Config\n}\n\ntype result map[string]float64\n\n// New - init the configs\nfunc New(configuration *config.Config) *Config {\n    return &amp;Config{configuration}\n}\n\n// Routes - api urls\nfunc (config *Config) Routes() *chi.Mux {\n    router := chi.NewRouter()\n    router.Use(\n        render.SetContentType(render.ContentTypeHTML), // Set content-Type headers as application/json\n    )\n    router.Get(\"/\", config.GetPrice) // subscribe to new tweets\n\n    return router\n}\n\nfunc (config *Config) GetPrice(w http.ResponseWriter, r *http.Request) {\n\n    conn, err := wsupgrader.Upgrade(w, r, nil)\n    if err != nil {\n        fmt.Println(fmt.Printf(\"Failed to set websocket upgrade: %+v \", err))\n        return\n    }\n\n    for {\n        time.Sleep(1 * time.Second)\n\n        price := &lt;-messages\n\n        w, err := conn.NextWriter(websocket.TextMessage)\n        if err != nil {\n            fmt.Println(\"ws error\", err)\n        }\n        currVal := ac.FormatMoneyBigFloat(big.NewFloat(price))\n\n        if _, err := w.Write([]byte(currVal)); err != nil {\n            fmt.Printf(\"w.Write() returned %v\", err)\n        }\n\n        w.Close()\n\n    }\n\n}\n\n// start getting the price of ether as soon as they ap starts\nfunc init() {\n    go startPollingPriceAPI()\n}\n\n// Go Routine to start polling\nfunc startPollingPriceAPI() {\n    for {\n        time.Sleep(2 * time.Second)\n        go getPriceFromAPI()\n    }\n}\n\nfunc getPriceFromAPI() {\n\n    w := http.Client{\n        // Timeout: time.Second * 3,\n    }\n\n    req, _ := http.NewRequest(http.MethodGet, url, nil)\n\n    res, err := w.Do(req)\n\n    if err != nil {\n        log.Println(\"err getting price [req]: \", err)\n    }\n\n    body, err := ioutil.ReadAll(res.Body)\n\n    if err != nil {\n        log.Println(\"err getting price [io-read]: \", err)\n    }\n\n    r := result{}\n\n    if jsonErr := json.Unmarshal(body, &amp;r); jsonErr != nil {\n        log.Println(\"err getting price [json]: \", jsonErr)\n    }\n    fmt.Println(\"1 Dollar = \u20ac\", r[\"EUR\"])\n\n    messages &lt;- r[\"EUR\"]\n\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "concurrency", "parallel-processing", "mutex"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1542210599, "post_id": 53303965, "comment_id": 93488820, "body": "You can&#39;t lock only a single entry of a map, because writing another may cause an internal restructuring that may effect other entries as well, including the one you intend to lock."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1542210839, "post_id": 53303965, "comment_id": 93488970, "body": "And in fact you can&#39;t lock the whole map either. You lock the mutex. What that mutex controls access to is entirely determined by how you use it. You <i>could</i> create a mutex for every key in the map, which would allow you per-entry granularity of locking, but as icza noted, that wouldn&#39;t actually prevent data races."}, {"owner": {"reputation": 137, "user_id": 10485416, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Gs1iVHY4do0/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DXQTSNnkyySA4dnV_FXzxtHOWNJBg/mo/photo.jpg?sz=128", "display_name": "Dylan", "link": "https://stackoverflow.com/users/10485416/dylan"}, "edited": false, "score": 0, "creation_date": 1542211447, "post_id": 53303965, "comment_id": 93489366, "body": "Thanks ! Your replies helped me a lot!"}], "answers": [{"tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": false, "score": 1, "last_activity_date": 1542215814, "creation_date": 1542215814, "answer_id": 53305565, "question_id": 53303965, "link": "https://stackoverflow.com/questions/53303965/how-to-lock-a-specific-maps-index-for-concurent-read-write-in-golang/53305565#53305565", "title": "How to lock a specific map&#39;s index for concurent Read/Write in Golang", "body": "<p>Maps themselves do not take care of locks, therefore any manipulation of them on multiple go routines (or reading while they are being manipulated) will require some for of syncing (e.g., <code>sync.Mutex</code>). There are fancier things you can do though.</p>\n\n<h1>RW Mutex</h1>\n\n<p>You can get a little fancier depending on your use case and use a <code>sync.RWMutex</code>. This will allow concurrent reads while safely blocking for any write. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    m := map[int]int{}\n    lock := sync.RWMutex{}\n\n    go func() {\n        // Writer\n        for range time.Tick(250 * time.Millisecond) {\n            // Notice that this uses Lock and NOT RLock\n            lock.Lock()\n            m[5]++\n            m[6] += 2\n            lock.Unlock()\n        }\n    }()\n\n    go func() {\n        for range time.Tick(250 * time.Millisecond) {\n            lock.RLock()\n            println(m[5])\n            lock.RUnlock()\n        }\n    }()\n\n    for range time.Tick(250 * time.Millisecond) {\n        lock.RLock()\n        println(m[6])\n        lock.RUnlock()\n    }\n}\n</code></pre>\n\n<p>This does not give you a key by key locking mechanism though. </p>\n\n<h1>sync.Map</h1>\n\n<p>The <code>sync.Map</code> is provided by the standard library and is robust. It has more fine grained locking.</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    m := sync.Map{}\n\n    go func() {\n        // Writer\n        for range time.Tick(250 * time.Millisecond) {\n            value, _ := m.LoadOrStore(5, 0)\n            m.Store(5, value.(int)+1)\n            value, _ = m.LoadOrStore(6, 0)\n            m.Store(6, value.(int)+2)\n        }\n    }()\n\n    go func() {\n        for range time.Tick(250 * time.Millisecond) {\n            value, _ := m.LoadOrStore(5, 0)\n            println(value.(int))\n        }\n    }()\n\n    for range time.Tick(250 * time.Millisecond) {\n        value, _ := m.LoadOrStore(6, 0)\n        println(value.(int))\n    }\n}\n</code></pre>\n\n<p>Notice that the code doesn't have any mutexes. Also notice that you get to deal with empty interfaces...</p>\n"}, {"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 3, "last_activity_date": 1542216614, "creation_date": 1542216614, "answer_id": 53305782, "question_id": 53303965, "link": "https://stackoverflow.com/questions/53303965/how-to-lock-a-specific-maps-index-for-concurent-read-write-in-golang/53305782#53305782", "title": "How to lock a specific map&#39;s index for concurent Read/Write in Golang", "body": "<p>From <a href=\"https://golang.org/doc/go1.9#sync-map\" rel=\"nofollow noreferrer\">GO 1.9 Release notes</a></p>\n\n<h1>Concurrent Map</h1>\n\n<p>The new Map type in the sync package is a concurrent map with amortized-constant-time loads, stores, and deletes. It is safe for multiple goroutines to call a Map's methods concurrently.</p>\n\n<p>GO Team built one for you!</p>\n"}], "owner": {"reputation": 137, "user_id": 10485416, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Gs1iVHY4do0/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DXQTSNnkyySA4dnV_FXzxtHOWNJBg/mo/photo.jpg?sz=128", "display_name": "Dylan", "link": "https://stackoverflow.com/users/10485416/dylan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2474, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1542219915, "creation_date": 1542210433, "last_edit_date": 1542219915, "question_id": 53303965, "link": "https://stackoverflow.com/questions/53303965/how-to-lock-a-specific-maps-index-for-concurent-read-write-in-golang", "title": "How to lock a specific map&#39;s index for concurent Read/Write in Golang", "body": "<p>I wanted to know if there is a way to lock only an index in a map during concurrent read/write. I am pretty new to Golang and parallelism sorry if the answer is obvious.</p>\n\n<pre><code>func Check(a, b []string) map[string]int {\n    var res = make(map[string]int)\n    go func() {\n        for _, v := range a {\n            res[v]++\n        }\n    }()\n    go func() {\n        for _, v := range b {\n            res[v]++\n        }\n    }()\n    return res\n}\n</code></pre>\n\n<p>Eventually this piece of code is going to panic due to concurrent map Read/Write. So we should add mutex to lock the map.</p>\n\n<pre><code>var m sync.Mutex\ngo func() {\n    for _, v := range a {\n        m.Lock()\n        res[v]++\n        m.Unlock()\n    }\n}()\ngo func() {\n    for _, v := range b {\n        m.Lock()\n        res[v]++\n        m.Unlock()\n    }\n}()\n</code></pre>\n\n<p>But from my understanding <code>m.lock()</code> will lock my whole map? Isn't this too much overhead by locking everything? This bugged me as i thought this piece of code may not be faster than running linearly. Can I possibly lock only the map at <code>map[\"some key\"]</code>, so that my second goroutine can still write in <code>map[\"some other key\"]</code>?</p>\n"}, {"tags": ["go", "hugo"], "answers": [{"comments": [{"owner": {"reputation": 3954, "user_id": 275119, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bc9794842b05b74f8d6eb5c1d1b2f746?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/275119/adi"}, "edited": false, "score": 0, "creation_date": 1543222186, "post_id": 53462937, "comment_id": 93824935, "body": "Hey @mshjri thanks for the code but this doesnt help as we ARE looking for the context to be at the top folder level (see example image above)."}, {"owner": {"reputation": 91, "user_id": 6192135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ELmvu.jpg?s=128&g=1", "display_name": "mshjri", "link": "https://stackoverflow.com/users/6192135/mshjri"}, "reply_to_user": {"reputation": 3954, "user_id": 275119, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bc9794842b05b74f8d6eb5c1d1b2f746?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/275119/adi"}, "edited": false, "score": 0, "creation_date": 1543572932, "post_id": 53462937, "comment_id": 93976267, "body": "hi @Adi, please check the update i posted. If I got you right, it should work."}], "tags": [], "owner": {"reputation": 91, "user_id": 6192135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ELmvu.jpg?s=128&g=1", "display_name": "mshjri", "link": "https://stackoverflow.com/users/6192135/mshjri"}, "is_accepted": false, "score": 0, "last_activity_date": 1555082693, "last_edit_date": 1555082693, "creation_date": 1543098891, "answer_id": 53462937, "question_id": 53302290, "link": "https://stackoverflow.com/questions/53302290/hugo-static-site-issue-trying-to-loop-through-multiple-sub-sub-folders-and-ret/53462937#53462937", "title": "Hugo static site - issue trying to loop through multiple sub sub folders and returning one sorted list", "body": "<p>if what you are looking for is listing 12 pages from each 'main' section, this should work:</p>\n\n<pre><code>&lt;ul&gt;\n    {{ range .Site.Sections }}\n        {{ range first 12 .Pages }}\n            &lt;li&gt;&lt;a href=\"{{ .RelPermalink}}\"&gt;{{ .Title }}&lt;/a&gt;&lt;/li&gt;\n        {{ end }}\n    {{ end }}\n&lt;/ul&gt;\n</code></pre>\n\n<p><a href=\"https://gohugo.io/variables/site/#site-variables-list\" rel=\"nofollow noreferrer\">Reference</a></p>\n"}], "owner": {"reputation": 3954, "user_id": 275119, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bc9794842b05b74f8d6eb5c1d1b2f746?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/275119/adi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 896, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555082693, "creation_date": 1542204993, "question_id": 53302290, "link": "https://stackoverflow.com/questions/53302290/hugo-static-site-issue-trying-to-loop-through-multiple-sub-sub-folders-and-ret", "title": "Hugo static site - issue trying to loop through multiple sub sub folders and returning one sorted list", "body": "<p>I have a folder in \u201ccontent\u201d called \u201cprojects\u201d which has sub folders and also sub-sub folders. I\u2019m trying to get the latest 12 pages content of all the sub-sub folders to show in a single list by date order. (see illustration below)</p>\n\n<p><a href=\"https://i.stack.imgur.com/rtJG7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rtJG7.png\" alt=\"enter image description here\"></a></p>\n\n<p>My current code (that doesn\u2019t quite work):</p>\n\n<pre><code>&lt;ul&gt;\n    {{ range .Sections }}\n        &lt;li&gt;&lt;a href=\"{{ .RelPermalink }}\"&gt;{{ .Title }}&lt;/a&gt;\n            {{ range .Sections }}\n                {{ range first 12 .Pages }}\n                    &lt;ul&gt;\n                        &lt;li&gt;&lt;a href=\"{{ .RelPermalink}}\"&gt;{{ .Title }}&lt;/a&gt;&lt;/li&gt;\n                    &lt;/ul&gt;\n                {{ end }}\n            {{ end }}\n        &lt;/li&gt;\n    {{ end }}\n&lt;/ul&gt;\n</code></pre>\n\n<p>This shows the first 12 pages from each sub-sub section. I need to get them all in one list and only show the latest 12 regardless or which sub-sub section they are in.</p>\n\n<p>(This is on a list.html template and needs to be dynamic if it makes a difference - the folders could be called anything)</p>\n\n<p>Cheers,\nA.</p>\n"}, {"tags": ["go", "aws-codecommit", "go-get"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1542195505, "post_id": 53299355, "comment_id": 93479299, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27500861/whats-the-proper-way-to-go-get-a-private-repository\">What&#39;s the proper way to &quot;go get&quot; a private repository?</a>"}, {"owner": {"reputation": 390, "user_id": 2481981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6b557fbb677f7cc2fd8647f723195ffb?s=128&d=identicon&r=PG", "display_name": "Sreenath", "link": "https://stackoverflow.com/users/2481981/sreenath"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542195950, "post_id": 53299355, "comment_id": 93479538, "body": "Tried this already, <a href=\"https://stackoverflow.com/questions/38668444/go-get-private-repo-from-bitbucket/38672481#38672481\" title=\"go get private repo from bitbucket\">stackoverflow.com/questions/38668444/&hellip;</a> I&#39;m getting above error"}, {"owner": {"reputation": 482, "user_id": 4760674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tMvVK.jpg?s=128&g=1", "display_name": "Major", "link": "https://stackoverflow.com/users/4760674/major"}, "edited": false, "score": 0, "creation_date": 1542220093, "post_id": 53299355, "comment_id": 93493915, "body": "it looks like go-get is automatically using https:// instead of ssh://"}], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 7396035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e83dcb158d7991defd1633995e5cd18f?s=128&d=identicon&r=PG", "display_name": "R70YNS", "link": "https://stackoverflow.com/users/7396035/r70yns"}, "is_accepted": false, "score": 0, "last_activity_date": 1575890390, "creation_date": 1575890390, "answer_id": 59247770, "question_id": 53299355, "link": "https://stackoverflow.com/questions/53299355/go-get-a-private-repo-from-codecommit/59247770#59247770", "title": "go get a private repo from codecommit", "body": "<p>Your second command looks fine, </p>\n\n<p><code>go get git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package</code></p>\n\n<p>You just need to add <code>.git</code> to the end of it i.e. </p>\n\n<p><code>go get git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package.git</code></p>\n"}], "owner": {"reputation": 390, "user_id": 2481981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6b557fbb677f7cc2fd8647f723195ffb?s=128&d=identicon&r=PG", "display_name": "Sreenath", "link": "https://stackoverflow.com/users/2481981/sreenath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1176, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1575890390, "creation_date": 1542195444, "last_edit_date": 1542218580, "question_id": 53299355, "link": "https://stackoverflow.com/questions/53299355/go-get-a-private-repo-from-codecommit", "title": "go get a private repo from codecommit", "body": "<p>I'm new to golang, we are trying to create a package in go and use across all the services we wanted to use.</p>\n\n<p>I tried to create a repo in github and tried to do go get; I didn't get any issue.</p>\n\n<p>Now I wanted to create the same package in codecommit of amazon. I add my ssh in iam of aws, and I'm able to clone.</p>\n\n<p>I ran these commands:</p>\n\n<pre><code>$ git config --global url.\"ssh://git-codecommit.us-east-2.amazonaws.com:\".insteadOf \"https://git-codecommit.us-east-2.amazonaws.com/\"\n$ go get git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package\n</code></pre>\n\n<p>And I got below error:</p>\n\n<pre><code>package git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package: unrecognized import path \"git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package\" (parse https://git-codecommit.us-east-2.amazonaws.com/v1/repos/my-package?go-get=1: no go-import meta tags ())\n</code></pre>\n\n<p>Could someone solve my issue with codecommit?</p>\n\n<p>I'm able to do this in github, but I'm getting issue in codecommit.</p>\n"}, {"tags": ["go", "axios"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1542193571, "post_id": 53298478, "comment_id": 93478206, "body": "<code>(*w).Header().Set(&quot;Access-Control-Allow-Origin&quot;, req.Header.Get(&quot;Origin&quot;))</code>"}, {"owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1542196005, "post_id": 53298478, "comment_id": 93479569, "body": "@mkopriva does not work("}, {"owner": {"reputation": 233, "user_id": 2071477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3aca91713de9862114ac0b7af87785a1?s=128&d=identicon&r=PG&f=1", "display_name": "Ramesh Roddam", "link": "https://stackoverflow.com/users/2071477/ramesh-roddam"}, "edited": false, "score": 0, "creation_date": 1543443040, "post_id": 53298478, "comment_id": 93926451, "body": "Please refer to this post for answer nd how to solve this problem <a href=\"https://stackoverflow.com/questions/53528643/cross-origin-resource-sharing-cors-in-angular-or-angular-6-problem-while-you/53528644#53528644\" title=\"cross origin resource sharing cors in angular or angular 6 problem while you\">stackoverflow.com/questions/53528643/&hellip;</a>"}, {"owner": {"reputation": 63, "user_id": 4525434, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xdLzAE4-so8/AAAAAAAAAAI/AAAAAAAAALY/VYcZ7V8Fmdc/photo.jpg?sz=128", "display_name": "Chris Wood", "link": "https://stackoverflow.com/users/4525434/chris-wood"}, "edited": false, "score": 0, "creation_date": 1575277167, "post_id": 53298478, "comment_id": 104498342, "body": "Hi Ramesh that link may not be the one you meant to paste it seems to be your response for a question relating to spring and the framework&#39;s particular CrossOrigin filters. For what it is worth, I think for this question if you are seeing the prefilght request but it is griping about not having ok status then from my experience you either have another error that is happening prior to the response, or OPTIONS is not an allowed verb."}], "answers": [{"comments": [{"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1615952383, "post_id": 53304135, "comment_id": 117849180, "body": "seems like the gorillamux CORS middleware is broken"}, {"owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "reply_to_user": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1615982455, "post_id": 53304135, "comment_id": 117859000, "body": "@Madeo What gives you that impression?  I actually link to gorilla/handlers, not gorilla/mux anyway..."}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1615987432, "post_id": 53304135, "comment_id": 117861457, "body": "because with the Gorillamux middleware and the headers set was not working, however with the code you showed it was. I just ended up building my own middleware (10 lines of code) and remove the Gorillamux one"}], "tags": [], "owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "is_accepted": true, "score": 42, "last_activity_date": 1563460962, "last_edit_date": 1563460962, "creation_date": 1542210912, "answer_id": 53304135, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/53304135#53304135", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>I believe this is the simplest example:</p>\n\n<pre><code>header := w.Header()\nheader.Add(\"Access-Control-Allow-Origin\", \"*\")\nheader.Add(\"Access-Control-Allow-Methods\", \"DELETE, POST, GET, OPTIONS\")\nheader.Add(\"Access-Control-Allow-Headers\", \"Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With\")\n</code></pre>\n\n<p>You can also add a header for <code>Access-Control-Max-Age</code> and of course you can allow any headers and methods that you wish.</p>\n\n<p>Finally you want to respond to the initial request:</p>\n\n<pre><code>if r.Method == \"OPTIONS\" {\n    w.WriteHeader(http.StatusOK)\n    return\n}\n</code></pre>\n\n<p>Edit (June 2019):  We now use <a href=\"https://github.com/gorilla/handlers\" rel=\"noreferrer\">gorilla</a> for this.  Their stuff is more actively maintained and they have been doing this for a really long time.  Leaving the link to the old one, just in case.</p>\n\n<p><em>Old Middleware Recommendation below:</em>\nOf course it would probably be easier to just use middleware for this.  I don't think I've used it, but <a href=\"https://github.com/rs/cors\" rel=\"noreferrer\">this one</a> seems to come highly recommended.</p>\n"}, {"comments": [{"owner": {"reputation": 4336, "user_id": 819651, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b3b2801b397b45b57b784c83b6274e22?s=128&d=identicon&r=PG", "display_name": "Lu&#237;s Soares", "link": "https://stackoverflow.com/users/819651/lu%c3%ads-soares"}, "edited": false, "score": 0, "creation_date": 1553296809, "post_id": 53995502, "comment_id": 97346044, "body": "op specified Go lang"}, {"owner": {"reputation": 2024, "user_id": 5297386, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Rpsj8FfsdNA/AAAAAAAAAAI/AAAAAAAAA_A/nWVIuZCFj_g/photo.jpg?sz=128", "display_name": "Morlo Mbakop", "link": "https://stackoverflow.com/users/5297386/morlo-mbakop"}, "edited": false, "score": 0, "creation_date": 1559729155, "post_id": 53995502, "comment_id": 99508434, "body": "Go lang or axios not C#"}, {"owner": {"reputation": 154, "user_id": 1659792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4e9a6bf48f52174f82bab40334bec89?s=128&d=identicon&r=PG", "display_name": "mamashare", "link": "https://stackoverflow.com/users/1659792/mamashare"}, "edited": false, "score": 3, "creation_date": 1560229822, "post_id": 53995502, "comment_id": 99655886, "body": "+1 true, the OP specified Go lang, but I landed here and needed a solution for aspnet and this helped me"}], "tags": [], "owner": {"reputation": 177, "user_id": 4587832, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152845555793725/picture?type=large", "display_name": "Usman Mahmood", "link": "https://stackoverflow.com/users/4587832/usman-mahmood"}, "is_accepted": false, "score": 8, "last_activity_date": 1546346392, "creation_date": 1546346392, "answer_id": 53995502, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/53995502#53995502", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p><a href=\"https://docs.microsoft.com/en-us/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api\" rel=\"noreferrer\">Enable cross-origin requests in ASP.NET Web API</a> click for more info</p>\n\n<p>Enable CORS in the WebService app. First, add the CORS NuGet package. In Visual Studio, from the Tools menu, select NuGet Package Manager, then select Package Manager Console. In the Package Manager Console window, type the following command:</p>\n\n<pre><code>Install-Package Microsoft.AspNet.WebApi.Cors\n</code></pre>\n\n<p>This command installs the latest package and updates all dependencies, including the core Web API libraries. Use the -Version flag to target a specific version. The CORS package requires Web API 2.0 or later.</p>\n\n<p>Open the file App_Start/WebApiConfig.cs. Add the following code to the WebApiConfig.Register method:</p>\n\n<pre><code>using System.Web.Http;\nnamespace WebService\n{\n    public static class WebApiConfig\n    {\n        public static void Register(HttpConfiguration config)\n        {\n            // New code\n            config.EnableCors();\n\n            config.Routes.MapHttpRoute(\n                name: \"DefaultApi\",\n                routeTemplate: \"api/{controller}/{id}\",\n                defaults: new { id = RouteParameter.Optional }\n            );\n        }\n    }\n}\n</code></pre>\n\n<p>Next, add the [EnableCors] attribute to your controller/ controller methods</p>\n\n<pre><code>using System.Net.Http;\nusing System.Web.Http;\nusing System.Web.Http.Cors;\n\nnamespace WebService.Controllers\n{\n    [EnableCors(origins: \"http://mywebclient.azurewebsites.net\", headers: \"*\", methods: \"*\")]\n    public class TestController : ApiController\n    {\n        // Controller methods not shown...\n    }\n}\n</code></pre>\n\n<p><a href=\"https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-2.2\" rel=\"noreferrer\">Enable Cross-Origin Requests (CORS) in ASP.NET Core</a></p>\n"}, {"tags": [], "owner": {"reputation": 722, "user_id": 5372188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbfff41eb0a6508a8ead35f6eb9c339a?s=128&d=identicon&r=PG&f=1", "display_name": "JAD", "link": "https://stackoverflow.com/users/5372188/jad"}, "is_accepted": false, "score": 2, "last_activity_date": 1586678494, "last_edit_date": 1586678494, "creation_date": 1553969620, "answer_id": 55434353, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/55434353#55434353", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>The provided solution here is correct. However, the same error can also occur from a user error, where your endpoint request method is NOT matching the method your using when making the request.</p>\n\n<p>For example, the server endpoint is defined with \"RequestMethod.PUT\" while you are requesting the method as POST.</p>\n"}, {"comments": [{"owner": {"reputation": 522, "user_id": 1309582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e557660fd1785dde3469137d12e31d1d?s=128&d=identicon&r=PG", "display_name": "clayRay", "link": "https://stackoverflow.com/users/1309582/clayray"}, "edited": false, "score": 0, "creation_date": 1584003406, "post_id": 58219953, "comment_id": 107303557, "body": "Actually, going to the Network tab will tell you nothing. The GET apparently succeeds even though the Console tab says that there is a cross-origin-header error. That&#39;s explained in <a href=\"https://stackoverflow.com/a/46738706/1309582\">this answer</a>."}, {"owner": {"reputation": 15013, "user_id": 491553, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/gh31e.jpg?s=128&g=1", "display_name": "Ryan Shillington", "link": "https://stackoverflow.com/users/491553/ryan-shillington"}, "reply_to_user": {"reputation": 522, "user_id": 1309582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e557660fd1785dde3469137d12e31d1d?s=128&d=identicon&r=PG", "display_name": "clayRay", "link": "https://stackoverflow.com/users/1309582/clayray"}, "edited": false, "score": 0, "creation_date": 1592584405, "post_id": 58219953, "comment_id": 110487700, "body": "I think you&#39;re looking at the OPTIONS request, not the GET request. There should be 2 requests in Chrome&#39;s Network tab for every GET request you do in your code."}], "tags": [], "owner": {"reputation": 15013, "user_id": 491553, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/gh31e.jpg?s=128&g=1", "display_name": "Ryan Shillington", "link": "https://stackoverflow.com/users/491553/ryan-shillington"}, "is_accepted": false, "score": 17, "last_activity_date": 1570108466, "creation_date": 1570108466, "answer_id": 58219953, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/58219953#58219953", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>This answer explains what's going on behind the scenes, and the basics of how to solve this problem in any language.  For reference, see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Preflighted_requests\" rel=\"noreferrer\">the MDN docs on this topic</a>.</p>\n\n<p>You are making a request for a URL from JavaScript running on one domain (say domain-a.com) to an API running on another domain (domain-b.com).  When you do that, the browser has to ask domain-b.com if it's okay to allow requests from domain-a.com.  It does that with an HTTP <code>OPTIONS</code> request.  Then, in the response, the server on domain-b.com has to give (at least) the following HTTP headers that say \"Yeah, that's okay\":</p>\n\n<pre><code>HTTP/1.1 204 No Content                            // or 200 OK\nAccess-Control-Allow-Origin: https://domain-a.com  // or * for allowing anybody\nAccess-Control-Allow-Methods: POST, GET, OPTIONS   // What kind of methods are allowed\n...                                                // other headers\n</code></pre>\n\n<p>If you're in Chrome, you can see what the response looks like by pressing F12 and going to the \"Network\" tab to see the response the server on domain-b.com is giving.</p>\n\n<p>So, back to the bare minimum from @threeve's original answer:</p>\n\n<pre><code>header := w.Header()\nheader.Add(\"Access-Control-Allow-Origin\", \"*\")\n\nif r.Method == \"OPTIONS\" {\n    w.WriteHeader(http.StatusOK)\n    return\n}\n</code></pre>\n\n<p>This will allow anybody from anywhere to access this data.  The other headers he's included are necessary for other reasons, but these headers are the bare minimum to get past the CORS (Cross Origin Resource Sharing) requirements.</p>\n"}, {"comments": [{"owner": {"reputation": 1323, "user_id": 1698509, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edf0ad119c6130a8f08ce129c3d67f1c?s=128&d=identicon&r=PG", "display_name": "Guilherme", "link": "https://stackoverflow.com/users/1698509/guilherme"}, "edited": false, "score": 0, "creation_date": 1607287681, "post_id": 61184977, "comment_id": 115218753, "body": "I had just spent 1 hour with this (Vue.js + Django Rest Framework)"}], "tags": [], "owner": {"reputation": 1246, "user_id": 8047262, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qM3k1.png?s=128&g=1", "display_name": "7guyo", "link": "https://stackoverflow.com/users/8047262/7guyo"}, "is_accepted": false, "score": 3, "last_activity_date": 1586770366, "creation_date": 1586770366, "answer_id": 61184977, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/61184977#61184977", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p><strong>Angular and Django Rest Framework.</strong></p>\n\n<p>I encountered similar error while making post request to my DRF api.\nIt happened that all I was missing was <strong>trailing slash</strong> for endpoint.</p>\n"}, {"tags": [], "owner": {"reputation": 1003, "user_id": 3631521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QZReB.jpg?s=128&g=1", "display_name": "Oranit Dar", "link": "https://stackoverflow.com/users/3631521/oranit-dar"}, "is_accepted": false, "score": 0, "last_activity_date": 1595336602, "creation_date": 1595336602, "answer_id": 63015150, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/63015150#63015150", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>The only thing that worked for me was creating a new application in the IIS, mapping it to exactly the same physical path, and changing only the authentication to be Anonymous.</p>\n"}, {"tags": [], "owner": {"reputation": 1833, "user_id": 1862590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EX6Kb.png?s=128&g=1", "display_name": "Sathia", "link": "https://stackoverflow.com/users/1862590/sathia"}, "is_accepted": false, "score": 4, "last_activity_date": 1606450123, "last_edit_date": 1606450123, "creation_date": 1605198230, "answer_id": 64807721, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/64807721#64807721", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>The CORS issue should be fixed in the backend. <strong>Temporary workaround</strong> uses this option.</p>\n<ol>\n<li><p>Go to <code>C:\\Program Files\\Google\\Chrome\\Application</code></p>\n</li>\n<li><p>Open command prompt</p>\n</li>\n<li><p>Execute the command <code>chrome.exe --disable-web-security --user-data-dir=&quot;c:/ChromeDevSession&quot;</code></p>\n</li>\n</ol>\n<p>Using the above option, you can able to open <strong>new chrome without security</strong>. this chrome will not throw any cors issue.</p>\n<p><a href=\"https://i.stack.imgur.com/xPm9K.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xPm9K.png\" alt=\"enter image description here\" /></a></p>\n"}, {"tags": [], "owner": {"reputation": 138, "user_id": 5296288, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/1pLZi.png?s=128&g=1", "display_name": "e11en", "link": "https://stackoverflow.com/users/5296288/e11en"}, "is_accepted": false, "score": 0, "last_activity_date": 1606316372, "creation_date": 1606316372, "answer_id": 65007227, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce/65007227#65007227", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>For anyone looking at this and had no result with adding the <code>Access-Control-Allow-Origin</code> try also adding the <code>Access-Control-Allow-Headers</code>. May safe somebody from a headache.</p>\n"}], "owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304572, "favorite_count": 8, "accepted_answer_id": 53304135, "answer_count": 8, "score": 59, "last_activity_date": 1606450123, "creation_date": 1542192750, "last_edit_date": 1542211874, "question_id": 53298478, "link": "https://stackoverflow.com/questions/53298478/has-been-blocked-by-cors-policy-response-to-preflight-request-doesn-t-pass-acce", "title": "Has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check", "body": "<p>I have created trip server. It works fine and we are able to make <code>POST</code> request by Insomnia but when we make <code>POST</code> request by axios on our front-end, it sends an error:</p>\n\n<pre><code>has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check: It does not have HTTP ok status.\n</code></pre>\n\n<p>Our request on axios:</p>\n\n<pre><code>let config = {\nheaders: {\n  \"Content-Type\": \"application/json\",\n  'Access-Control-Allow-Origin': '*',\n  }\n}\n\nlet data = {\n  \"id\": 4\n }\n\n axios.post('http://196.121.147.69:9777/twirp/route.FRoute/GetLists', data, config)\n   .then((res) =&gt; {\n      console.log(res)\n     })\n    .catch((err) =&gt; {\n      console.log(err)\n   });\n} \n</code></pre>\n\n<p>My go file:</p>\n\n<pre><code>func setupResponse(w *http.ResponseWriter, req *http.Request) {\n    (*w).Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    (*w).Header().Set(\"Access-Control-Allow-Methods\", \"POST,GET,OPTIONS, PUT, DELETE\")\n\n    (*w).Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n}\n\n\nfunc WithUserAgent(base http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n    ctx := r.Context()\n    ua := r.Header.Get(\"Jwt\")\n    ctx = context.WithValue(ctx, \"jwt\", ua)\n\n    r = r.WithContext(ctx)\n\n    setupResponse(&amp;w, r)\n     base.ServeHTTP(w, r)\n  })\n}\n\nconst (\n    host     = \"localhost\"\n    port     = 5432\n    user     = \"postgres\"\n    password = \"postgres\"\n    dbname   = \"postgres\"\n)\n\nfunc main() {\n\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n           \"password=%s dbname=%s sslmode=disable\",\n               host, port, user, password, dbname)\n\n    server := &amp;s.Server{psqlInfo}\n\n    twirpHandler := p.NewFinanceServiceServer(server, nil)\n\n    wrap := WithUserAgent(twirpHandler)\n      log.Fatalln(http.ListenAndServe(\":9707\", wrap))\n}\n</code></pre>\n\n<p>As I said before on Insomnia it works great, but when we make an axios <code>POST</code> request, on browser's console following appears: </p>\n\n<blockquote>\n  <p>has been blocked by CORS policy: Response to preflight request doesn\u2019t pass access control check: It does not have HTTP ok status.</p>\n</blockquote>\n"}, {"tags": ["mongodb", "rest", "api", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1542191348, "post_id": 53297918, "comment_id": 93476846, "body": "Also related / possible duplicate: <a href=\"https://stackoverflow.com/questions/53110020/mongodb-go-driver-bson-struct-to-bson-document-encoding/53157611#53157611\">mongodb-go-driver/bson struct to bson.Document encoding</a>."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1542191404, "post_id": 53297918, "comment_id": 93476874, "body": "You want <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.FindOneAndReplace\" rel=\"nofollow noreferrer\"><code>FindOneAndReplace()</code></a> if your intention is to &quot;replace&quot; the matched document. This is now &quot;hardened&quot; in all API across all drivers where the two methods work differently. The &quot;Update&quot; varieties use <a href=\"https://docs.mongodb.com/manual/reference/operator/update/\" rel=\"nofollow noreferrer\">atomic operators</a> as mandatory."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542191455, "post_id": 53297918, "comment_id": 93476903, "body": "@icza That would possibly be the next error thrown. But <code>update document must contain key beginning with &#39;$</code> is pretty specific."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1542191576, "post_id": 53297918, "comment_id": 93476985, "body": "@NeilLunn Yes, I just wanted to give a heads-up where to go from there (when he corrects to use <code>$set</code>)."}, {"owner": {"reputation": 191, "user_id": 10127894, "user_type": "registered", "profile_image": "https://graph.facebook.com/2250569851623866/picture?type=large", "display_name": "Marius", "link": "https://stackoverflow.com/users/10127894/marius"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542192492, "post_id": 53297918, "comment_id": 93477579, "body": "@icza So you&#39;re suggesting me to make a helper function which would convert my struct into a bson document and then try it using this: <code>bson.NewDocument(bson.EC.SubDocument(&quot;$set&quot;, doc))</code> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542192733, "post_id": 53297918, "comment_id": 93477697, "body": "@Marius If you want to update just some fields, prepared as a struct value. This also requires you to specify the <code>,omitempty</code> option in the <code>bson</code> tags. If you want to replace the complete document, <code>FindAndReplace()</code> might be a better option as Neil suggested."}, {"owner": {"reputation": 191, "user_id": 10127894, "user_type": "registered", "profile_image": "https://graph.facebook.com/2250569851623866/picture?type=large", "display_name": "Marius", "link": "https://stackoverflow.com/users/10127894/marius"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542195282, "post_id": 53297918, "comment_id": 93479170, "body": "@icza, Thank you for your help, I created the converter to bson function and now everything works exactly as i wanted to!"}], "owner": {"reputation": 191, "user_id": 10127894, "user_type": "registered", "profile_image": "https://graph.facebook.com/2250569851623866/picture?type=large", "display_name": "Marius", "link": "https://stackoverflow.com/users/10127894/marius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3108, "favorite_count": 0, "closed_date": 1542191210, "answer_count": 0, "score": 2, "last_activity_date": 1542191835, "creation_date": 1542191037, "last_edit_date": 1592644375, "question_id": 53297918, "link": "https://stackoverflow.com/questions/53297918/official-mongo-go-driver-findoneandupdate-using-struct", "closed_reason": "Duplicate", "title": "Official mongo-go-driver findOneAndUpdate using struct", "body": "<p>I'm creating a simple <code>todo</code> rest API using <code>golang</code> and <code>mongodb</code>. I'm also using the <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> library.</p>\n<p>Basically, I managed to upload my data to <code>mongodb</code> and I'm able to retrieve the information, but I encounter some problems when I try to use the <code>findOneAndUpdate</code> function. I'm able to update my data using <code>findOneAndReplace</code>, However, I want to update the information using a struct and the <code>findOneAndUpdate</code> function</p>\n<p>Here is my struct:</p>\n<pre><code>type Todo struct {\n   ObjectId string\n   ID       string `json:&quot;ID,omitempty&quot;`\n   Title    string `json:&quot;Title,omitempty&quot; bson:&quot;Title&quot;`\n   Category string `json:&quot;Category,omitempty&quot; bson:&quot;Category&quot;`\n   Content  string `json:&quot;Content,omitempty&quot; bson:&quot;Content&quot;`\n   Created  string `json:&quot;Creation_time,omitempty&quot; bson:&quot;Creation_time&quot;`\n   Modified string `json:&quot;Modification_time,omitempty&quot; bson:&quot;Modification_time&quot;`\n   State    string `json:&quot;State,omitempty&quot; bson:&quot;State&quot;`\n</code></pre>\n<p>}</p>\n<p>Here is the function that decodes my request body into a struct:</p>\n<pre><code>func UpdateTodo (w http.ResponseWriter, r *http.Request){\nvar todo models.Todo\n_ = json.NewDecoder(r.Body).Decode(&amp;todo)\nurlTodoId := chi.URLParam(r, &quot;id&quot;)\nUpdateTodoById(todo, urlTodoId)\n</code></pre>\n<p>}</p>\n<p>And finally here is the function that updates the data:</p>\n<pre><code>func UpdateTodoById(todo m.Todo, todoId string) interface{}{\n\nvar todoUpdated m.Todo\n\nobjId, err := objectid.FromHex(todoId)\nhelpers.PanicErr(err)\nfilter := bson.NewDocument(bson.EC.ObjectID(&quot;_id&quot;, objId))\nfmt.Println(filter)\n\nerr = db.Collection(COLLNAME).FindOneAndUpdate(context.Background(), filter, todo).Decode(&amp;todoUpdated)\nfmt.Println(todoUpdated)\nhelpers.PanicErr(err)\n\nreturn  todoUpdated}\n</code></pre>\n<p>When I send the request I receive an error: <code>update document must contain key beginning with '$</code></p>\n<p>So can anyone help? Is there a way to solve this? and use a struct to update the data find the function <code>findOneAndUpdate</code>? Or is this driver not developed enough to do that yet?</p>\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1542185459, "post_id": 53296126, "comment_id": 93473190, "body": "<code>Looks like go is sanitizing the string somehow so the $HOME is not expanded.</code> No, its not expanded because nobody expanded them. The shell does expansion, you&#39;re not invoking a shell, you&#39;re calling the command directly."}, {"owner": {"reputation": 2408, "user_id": 81328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a1a853094a29f01f7dcf078d361a5bae?s=128&d=identicon&r=PG", "display_name": "Rafa de Castro", "link": "https://stackoverflow.com/users/81328/rafa-de-castro"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1542186245, "post_id": 53296126, "comment_id": 93473644, "body": "Ok, true, makes sense. But then I guess I cannot run the command in the current executing shell unless I save it to a script file or some dirty trick like that."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1542187142, "post_id": 53296126, "comment_id": 93474201, "body": "Is <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"nofollow noreferrer\">os.Getenv()</a> of use to you?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1542187532, "post_id": 53296126, "comment_id": 93474456, "body": "BTW, <code>exec.Command(args[0], args[1:len(args)]...)</code> can be shortened to: <code>exec.Command(args...)</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190768, "post_id": 53296126, "comment_id": 93476484, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable\">exec.Command() in Go with environment variable</a>"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1542190922, "post_id": 53296126, "comment_id": 93476578, "body": "It is a possible duplicate of <a href=\"https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable\" title=\"exec command in go with environment variable\">stackoverflow.com/questions/51015569/&hellip;</a>"}, {"owner": {"reputation": 2408, "user_id": 81328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a1a853094a29f01f7dcf078d361a5bae?s=128&d=identicon&r=PG", "display_name": "Rafa de Castro", "link": "https://stackoverflow.com/users/81328/rafa-de-castro"}, "edited": false, "score": 0, "creation_date": 1542192572, "post_id": 53296126, "comment_id": 93477615, "body": "Added an edit since the solution below only solves my particular example and doesn&#39;t cover all cases. I tried to clarify a bit. Thanks for all the answers anyway."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1542219629, "post_id": 53296126, "comment_id": 93493691, "body": "And even if you couldn&#39;t do <code>exec.Command(args...)</code>, the <code>len</code> part is not needed.  If <code>a</code> is a slice or array, then the statement <code>a[n:len(a)]</code> is identical to the statement <code>a[n:]</code>, just as <code>a[0:n]</code> is identical to <code>a[:n]</code> (and <code>a[:]</code> is equivalent to <code>a[0:len(a)]</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1542189753, "last_edit_date": 1542189753, "creation_date": 1542187339, "answer_id": 53296721, "question_id": 53296126, "link": "https://stackoverflow.com/questions/53296126/running-a-command-from-a-string-with-parameters-in-go/53296721#53296721", "title": "Running a command from a string with parameters in go", "body": "<p><code>$HOME</code> (and all other env variables) are expanded by the shell. You're not executing a shell, so they don't get expanded.</p>\n\n<p>You need to look up the env variable directly in go, with something like:</p>\n\n<pre><code>command := exec.Command(\"echo\", os.Getenv(\"HOME\"))\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>commandToRun := os.ExpandEnv(\"echo $HOME\")\ncommand := exec.Command(strings.Fields(commandToRun)...)\n</code></pre>\n\n<p>Note that this last approach won't work if <code>$HOME</code> expands to a string containing whitespace, so the <code>os.Getenv</code> method is generally safer/preferred for this use case.</p>\n"}, {"tags": [], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "is_accepted": true, "score": 3, "last_activity_date": 1542188206, "creation_date": 1542188206, "answer_id": 53297002, "question_id": 53296126, "link": "https://stackoverflow.com/questions/53296126/running-a-command-from-a-string-with-parameters-in-go/53297002#53297002", "title": "Running a command from a string with parameters in go", "body": "<p>Before executing the command, you can actively expand all env vars in the string using <code>os.ExpandEnv</code>:</p>\n\n<pre><code>os.ExpandEnv(\"echo $HOME\")\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/pkg/os/#ExpandEnv\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>ExpandEnv replaces ${var} or $var in the string according to the values of the current environment variables. References to undefined variables are replaced by the empty string. </p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542189922, "post_id": 53297501, "comment_id": 93475971, "body": "I would assume that <code>echo $HOME</code> is just an example, not the actual behavior the OP is aiming for."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190640, "post_id": 53297501, "comment_id": 93476395, "body": "If so, then the OP already know how to use <code>exec.Command()</code>. But he asked for help because in that way it is not giving the expected result. That&#39;s why I answered this way. Isn&#39;t it helpful?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190685, "post_id": 53297501, "comment_id": 93476425, "body": "I interpret the question broadly as &quot;How do expand environment variables when execing a command&quot;."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190753, "post_id": 53297501, "comment_id": 93476477, "body": "You see, in that case my answer isn&#39;t appropriate."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190866, "post_id": 53297501, "comment_id": 93476551, "body": "Then it is a possible duplicate of <a href=\"https://stackoverflow.com/questions/51015569/exec-command-in-go-with-environment-variable\" title=\"exec command in go with environment variable\">stackoverflow.com/questions/51015569/&hellip;</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542190910, "post_id": 53297501, "comment_id": 93476571, "body": "Yes, which is why I have already voted to close as a duplicate :)"}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 1, "last_activity_date": 1542189780, "last_edit_date": 1542189780, "creation_date": 1542189720, "answer_id": 53297501, "question_id": 53296126, "link": "https://stackoverflow.com/questions/53296126/running-a-command-from-a-string-with-parameters-in-go/53297501#53297501", "title": "Running a command from a string with parameters in go", "body": "<p>If you want to get the output of <code>$ echo $HOME</code>, the minimal code you need is</p>\n\n<pre><code>fmt.Println(os.Getenv(\"HOME\"))\n</code></pre>\n\n<p>Nothing more is needed.</p>\n\n<ul>\n<li>If you use <code>os.ExpandEnv(\"echo $HOME\")</code>, then first <code>$HOME</code> var will be expanded and then it will give you a string like <code>echo /home/&lt;user&gt;</code></li>\n<li>If you use <code>command := exec.Command(\"echo\", os.Getenv(\"HOME\"))</code>, then it will be resolved as <code>command := exec.Command(\"echo\", \"/home/&lt;user&gt;\")</code> and finally which will give output <code>/home/&lt;user&gt;</code></li>\n<li><p>If you use</p>\n\n<p><code>commandToRun := os.ExpandEnv(\"echo $HOME\")\ncommand := exec.Command(strings.Fields(commandToRun)...)</code></p>\n\n<p>then it will be process like previous cases.</p></li>\n</ul>\n\n<p>So better way is using only <code>fmt.Println(os.Getenv(\"HOME\"))</code>.</p>\n"}], "owner": {"reputation": 2408, "user_id": 81328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a1a853094a29f01f7dcf078d361a5bae?s=128&d=identicon&r=PG", "display_name": "Rafa de Castro", "link": "https://stackoverflow.com/users/81328/rafa-de-castro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 0, "accepted_answer_id": 53297002, "answer_count": 3, "score": 7, "last_activity_date": 1542253849, "creation_date": 1542185243, "last_edit_date": 1542253849, "question_id": 53296126, "link": "https://stackoverflow.com/questions/53296126/running-a-command-from-a-string-with-parameters-in-go", "title": "Running a command from a string with parameters in go", "body": "<p>I am trying to run a command with go. The command is in a string.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"strings\"\n\n    \"github.com/davecgh/go-spew/spew\"\n)\n\nfunc main() {\n    commandToRun := `echo $HOME`\n\n    log.Printf(\"Running %s\\n\", commandToRun)\n\n    args := strings.Fields(commandToRun)\n    spew.Dump(args[1:len(args)])\n    command := exec.Command(args[0], args[1:len(args)]...)\n    command.Stdout = os.Stdout\n    command.Stdin = os.Stdin\n    command.Stderr = os.Stderr\n    err := command.Run()\n\n    if err != nil {\n        log.Printf(\"Command finished with error: %v\", err)\n    }\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>2018/11/14 09:41:22 Running echo $HOME\n([]string) (len=1 cap=1) {\n (string) (len=5) \"$HOME\"\n}\n$HOME\n</code></pre>\n\n<p>What I'd like to have is:</p>\n\n<pre><code>2018/11/14 09:41:22 Running echo $HOME\n([]string) (len=1 cap=1) {\n (string) (len=5) \"$HOME\"\n}\n/home/whatever\n</code></pre>\n\n<p>Looks like go is sanitizing the string somehow. So the <code>$HOME</code> is not expanded. Is there any way of running the string exactly as if it was typed into the shell?</p>\n\n<p>This is the important part. Ideally I'd like to turn from string to type in the current shell.</p>\n\n<p>EDIT: The example below solve the simplest scenario but doesn't cover the \"running the string exactly as if it was typed into the shell\" part.</p>\n\n<p>If I switch to <code>expandenv</code>:</p>\n\n<pre><code>commandToRun := os.ExpandEnv(`echo \"$HOME\"`)\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>2018/11/14 11:45:44 Running echo \"/Users/rafael\"\n([]string) (len=1 cap=1) {\n (string) (len=15) \"\\\"/home/whatever\\\"\"\n}\n\"/home/whatever\"\n</code></pre>\n\n<p>What I'd get in the shell is:</p>\n\n<pre><code>$ &gt; echo \"$HOME\"\n/home/whatever\n</code></pre>\n\n<p>without the quotes. </p>\n\n<p>This is close to what I want but not exactly it.</p>\n"}, {"tags": ["json", "string", "go", "string-literals"], "comments": [{"owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "edited": false, "score": 0, "creation_date": 1542192694, "post_id": 53295953, "comment_id": 93477681, "body": "What is the output you expect in your sample? If it makes it clearer, I&#39;ve added a couple of extra <code>Println</code>s that show the strings being encoded in the go playground <a href=\"https://play.golang.org/p/Kk4wtaUBW9A\" rel=\"nofollow noreferrer\">here</a>. Note the first has an actual new line, the second has a \\n which will be encoded as \\\\n in json to prevent it being interpreted as a new line."}], "answers": [{"comments": [{"owner": {"reputation": 1769, "user_id": 3260750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B3QZmmS59_M/AAAAAAAAAAI/AAAAAAAAABk/Bu619V1aS8I/photo.jpg?sz=128", "display_name": "LauriK", "link": "https://stackoverflow.com/users/3260750/laurik"}, "edited": false, "score": 0, "creation_date": 1542185178, "post_id": 53296000, "comment_id": 93473038, "body": "Right, that makes sense.How can I make it work though?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1769, "user_id": 3260750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B3QZmmS59_M/AAAAAAAAAAI/AAAAAAAAABk/Bu619V1aS8I/photo.jpg?sz=128", "display_name": "LauriK", "link": "https://stackoverflow.com/users/3260750/laurik"}, "edited": false, "score": 0, "creation_date": 1542185855, "post_id": 53296000, "comment_id": 93473413, "body": "@LauriK: What&#39;s not working?  You demonstrated that it works with <code>&quot;</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1769, "user_id": 3260750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B3QZmmS59_M/AAAAAAAAAAI/AAAAAAAAABk/Bu619V1aS8I/photo.jpg?sz=128", "display_name": "LauriK", "link": "https://stackoverflow.com/users/3260750/laurik"}, "edited": false, "score": 0, "creation_date": 1542186372, "post_id": 53296000, "comment_id": 93473729, "body": "@LauriK Yes, it <i>is</i> working. If you want the string to contain a newline, use a string value that contains a newline and not a backslash followed by an <code>n</code> character."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1769, "user_id": 3260750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B3QZmmS59_M/AAAAAAAAAAI/AAAAAAAAABk/Bu619V1aS8I/photo.jpg?sz=128", "display_name": "LauriK", "link": "https://stackoverflow.com/users/3260750/laurik"}, "edited": false, "score": 1, "creation_date": 1542187379, "post_id": 53296000, "comment_id": 93474357, "body": "@LauriK Added examples how you can include newline in a raw string literal."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1542187359, "last_edit_date": 1542187359, "creation_date": 1542184760, "answer_id": 53296000, "question_id": 53295953, "link": "https://stackoverflow.com/questions/53295953/how-to-convert-newlines-to-proper-json-in-go/53296000#53296000", "title": "How to convert newlines to proper JSON in GO?", "body": "<p>The <code>encoding/json</code> properly encodes all string values.</p>\n\n<p>Your first example works as you expect it because you use an <em>interpreted string literal</em>, and if that contains a <code>\\n</code> sequence, the compiler will replace that with a newline character.</p>\n\n<p>Your second example doesn't work as you expect it because you used a <em>raw string literal</em>, which if contains a <code>\\n</code> sequence, that will not be replaced, but those 2 characters will remain in the string. And that will be escaped by <code>encoding/json</code> properly to remain that in the JSON outpupt.</p>\n\n<p>So basically </p>\n\n<pre><code>\"asd\\nqwe\"`\n</code></pre>\n\n<p>and</p>\n\n<pre><code>`asd\\nqwe`\n</code></pre>\n\n<p>are 2 different strings, they are not equal, hence their JSON escaped values are also different.</p>\n\n<p>Check <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">Spec: String literals</a> for more details.</p>\n\n<p>Note that if you want to create a string value using a raw string literal, you can't use escape sequences in it. To have a newline in a raw string literal, simply break the line, like this:</p>\n\n<pre><code>s := `asd\nqwe`\n</code></pre>\n\n<p>Another option is to \"break\" the string literal, and insert the newline using an interpreted string literal (and concatenate the parts):</p>\n\n<pre><code>s := `asd` + \"\\n\" + `qwe`\n</code></pre>\n"}], "owner": {"reputation": 1769, "user_id": 3260750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B3QZmmS59_M/AAAAAAAAAAI/AAAAAAAAABk/Bu619V1aS8I/photo.jpg?sz=128", "display_name": "LauriK", "link": "https://stackoverflow.com/users/3260750/laurik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3479, "favorite_count": 0, "closed_date": 1542185653, "answer_count": 1, "score": 1, "last_activity_date": 1542187359, "creation_date": 1542184537, "last_edit_date": 1542185500, "question_id": 53295953, "link": "https://stackoverflow.com/questions/53295953/how-to-convert-newlines-to-proper-json-in-go", "closed_reason": "Duplicate", "title": "How to convert newlines to proper JSON in GO?", "body": "<p>I have some strings that I'd like to convert to JSON. Using encoding/json here, haven't tried other packages.</p>\n\n<p>The strings may contain newlines and other stuff that breaks JSON if saved as-is.</p>\n\n<p>It works if I pass a string literal - it adds backslashes in front of backslashes. It doesn't work if I just pass a regular string. I can't seem to figure out if there is a way to use variables that contain string literals.</p>\n\n<p>edit: as pointed out, these are not the same values and I kind of understand that, but it doesn't help me solve my problem.</p>\n\n<p>The sample code: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    type Test struct {\n        Input string\n    }\n    regularString := Test{\"asd\\nqwe\"}\n    out, err := json.Marshal(regularString)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(out))\n\n    literalString := Test{`asd\\nqwe`}\n    out, err = json.Marshal(literalString )\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(out))\n}\n</code></pre>\n"}, {"tags": ["go", "grpc", "goroutine"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1542183259, "post_id": 53295249, "comment_id": 93472109, "body": "The request context is cancelled to let you know that the client is no longer interested in a response, so you can stop working on it. Best practice is to only store request scoped data in the context. The next best thing is to copy values you care about into a new context."}, {"owner": {"reputation": 1015, "user_id": 740997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42906a3e6d031337e7bc7e7285057627?s=128&d=identicon&r=PG", "display_name": "adamc", "link": "https://stackoverflow.com/users/740997/adamc"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542184215, "post_id": 53295249, "comment_id": 93472574, "body": "Thanks for the response Peter, I guess I&#39;ll just stick with extracting the correlation id and inserting it into the new <code>context.Background()</code> inside the goroutine"}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 7952766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064d043ec47bcbe400f476d4c0cf6ab0?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Scherffenberg-M&#248;ller", "link": "https://stackoverflow.com/users/7952766/jacob-scherffenberg-m%c3%b8ller"}, "is_accepted": false, "score": 2, "last_activity_date": 1567428507, "creation_date": 1567428507, "answer_id": 57757218, "question_id": 53295249, "link": "https://stackoverflow.com/questions/53295249/passing-context-from-grpc-endpoint-to-goroutine-receives-context-canceled-error/57757218#57757218", "title": "Passing context from gRPC endpoint to goroutine receives context canceled error", "body": "<p>@adamc if you did not find any other ways yet. </p>\n\n<p>I ended up with this solution(Which is also not perfect) \nTo just get the full context copied. But i prefered this to manually adding the values from my original context to a <code>context.Background</code></p>\n\n<pre><code>md, _ := metadata.FromIncomingContext(ctx)\ncopiedCtx := metadata.NewOutgoingContext(context.Background(), md)\n</code></pre>\n"}], "owner": {"reputation": 1015, "user_id": 740997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42906a3e6d031337e7bc7e7285057627?s=128&d=identicon&r=PG", "display_name": "adamc", "link": "https://stackoverflow.com/users/740997/adamc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2208, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1567428507, "creation_date": 1542181458, "question_id": 53295249, "link": "https://stackoverflow.com/questions/53295249/passing-context-from-grpc-endpoint-to-goroutine-receives-context-canceled-error", "title": "Passing context from gRPC endpoint to goroutine receives context canceled error", "body": "<p>I'm attempting to pass the context from an incoming gRPC endpoint to a goroutine which is responsible for sending another request to an external service, but I'm receiving <code>Error occurred: context canceled</code> from the <code>ctxhttp.Get</code> function call within the goroutine:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net\"\n  \"net/http\"\n  \"os\"\n  \"sync\"\n\n  \"golang.org/x/net/context/ctxhttp\"\n\n  dummy_service \"github.com/myorg/testing-apps/dummy-proto/gogenproto/dummy/service\"\n  \"github.com/myorg/testing-apps/dummy-proto/gogenproto/dummy/service/status\"\n  \"golang.org/x/net/context\"\n\n  \"google.golang.org/grpc\"\n  \"google.golang.org/grpc/reflection\"\n)\n\nfunc main() {\n  var err error\n\n  grpcServer := grpc.NewServer()\n\n  server := NewServer()\n  dummy_service.RegisterDummyServer(grpcServer, server)\n  reflection.Register(grpcServer)\n\n  lis, err := net.Listen(\"tcp\", \":9020\")\n  if err != nil {\n    fmt.Printf(\"Failed to listen: %+v\", err)\n    os.Exit(-1)\n  }\n  defer lis.Close()\n\n  wg := sync.WaitGroup{}\n\n  wg.Add(1)\n  go func() {\n    defer wg.Done()\n    fmt.Println(\"Starting gRPC Server\")\n    if err := grpcServer.Serve(lis); err != nil {\n      fmt.Printf(\"Failed to serve gRPC: %+v\", err)\n      os.Exit(-1)\n    }\n  }()\n\n  wg.Wait()\n}\n\ntype server struct{}\n\nfunc NewServer() server {\n  return server{}\n}\n\nfunc (s server) Status(ctx context.Context, in *status.StatusRequest) (*status.StatusResponse, error) {\n  go func(ctx context.Context) {\n    client := http.Client{}\n\n    // it's important to send the ctx from the parent function here because it contains\n    // a correlation-id which was inserted using grpc middleware, and the external service\n    // prints this value in the logs to tie everything together\n    if _, err := ctxhttp.Get(ctx, &amp;client, \"http://localhost:4567\"); err != nil {\n      fmt.Println(\"Error encountered:\", err)\n      return\n    }\n\n    fmt.Println(\"No error encountered\")\n  }(ctx)\n\n  response := status.StatusResponse{\n    Status: status.StatusResponse_SUCCESS,\n  }\n\n\n  // if I enable the following, everything works, and I get \"No error encountered\"\n  // time.Sleep(10 * time.Millisecond)\n\n  return &amp;response, nil\n}\n</code></pre>\n\n<p>If I add a <code>time.Sleep()</code> inside the calling function, the goroutine succeeds as expected and doesn't receive any error. It seems that the context of the parent function becomes canceled as soon as it returns, and since the parent is ending before the goroutine, the context passed to the goroutine is receiving the <code>context canceled</code> error.</p>\n\n<p>I realize I could solve this by having the calling function wait for the goroutine to finish, which would prevent the context from being canceled, but I don't want to do this since I want the function to return immediately so that the client hitting the endpoint gets a response as soon as possible, while the goroutine continues processing in the background.</p>\n\n<p>I can also solve this by not using the passed in <code>ctx</code> and instead using <code>context.Background()</code> in my goroutine, however, I want to use the incoming <code>ctx</code> because it contains a <code>correlation-id</code> value which was inserted by grpc middleware and needs to be passed along as part of the outgoing request that the goroutine makes, so that the next server can print this <code>correlation-id</code> in its log messages to tie the requests together.</p>\n\n<p>I've ended up solving the issue by extracting the <code>correlation-id</code> from the incoming context and inserting it into a new <code>context.Background()</code> in the goroutine, but I wanted to avoid this since it adds a bunch of boilerplate code around every outgoing request that a goroutine makes, instead of just being able to pass along the context.</p>\n\n<p>Can anyone explain to me exactly why the context is getting canceled and let me know if there's a \"best practices\" solution for this type of situation?  Is it not possible to use the context passed in from the calling function in a goroutine with gRPC?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 26649, "user_id": 188702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9257dbb2fdd9d164711aa191420ef621?s=128&d=identicon&r=PG", "display_name": "Dominic Barnes", "link": "https://stackoverflow.com/users/188702/dominic-barnes"}, "is_accepted": true, "score": 6, "last_activity_date": 1542180339, "creation_date": 1542180339, "answer_id": 53295026, "question_id": 53294768, "link": "https://stackoverflow.com/questions/53294768/value-object-to-json-in-go/53295026#53295026", "title": "Value object to json in go", "body": "<p>It sounds like you need <code>valueobject.Email</code> to implement the <code>json.Marshaler</code> interface:</p>\n\n<pre><code>func (e *Email) MarshalJSON() ([]byte, error) {\n  return json.Marshal(e.Value())\n}\n</code></pre>\n\n<p>That is the bare-minimum to implement what you are asking for. By implementing the <code>json.Marshaler</code> interface, it allows you to customize how <code>json.Marshal</code> renders your value.</p>\n\n<p>Another option is to simplify <code>Email</code> into just a wrapper for <code>string</code>, instead of a struct:</p>\n\n<pre><code>type Email string\n\nfunc (e Email) Value() string {\n  return e\n}\n</code></pre>\n\n<p>Since strings are already handled by <code>json.Marshal</code>, it should just work.</p>\n"}, {"tags": [], "owner": {"reputation": 326, "user_id": 5416787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7b72c5d0141460b41d247bc63fd530b?s=128&d=identicon&r=PG&f=1", "display_name": "Snake14", "link": "https://stackoverflow.com/users/5416787/snake14"}, "is_accepted": false, "score": 0, "last_activity_date": 1542181413, "last_edit_date": 1542181413, "creation_date": 1542180740, "answer_id": 53295100, "question_id": 53294768, "link": "https://stackoverflow.com/questions/53294768/value-object-to-json-in-go/53295100#53295100", "title": "Value object to json in go", "body": "<p>To make your Email type marshal the way you'd like, you'll need to make it implement the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">json.marshaler</a> interface. <a href=\"https://blog.gopheracademy.com/advent-2016/advanced-encoding-decoding/\" rel=\"nofollow noreferrer\">GopherAcademy</a> uses the following example: </p>\n\n<pre><code>func (d Dog) MarshalJSON() ([]byte, error) {\nreturn json.Marshal(NewJSONDog(d)) }\n</code></pre>\n"}], "owner": {"reputation": 919, "user_id": 3544524, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/db1b08a462baf39134ade1bace3da4fa?s=128&d=identicon&r=PG", "display_name": "Marvin Caspar", "link": "https://stackoverflow.com/users/3544524/marvin-caspar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 53295026, "answer_count": 2, "score": 3, "last_activity_date": 1542181413, "creation_date": 1542179203, "question_id": 53294768, "link": "https://stackoverflow.com/questions/53294768/value-object-to-json-in-go", "title": "Value object to json in go", "body": "<p>I have a struct which contains an other struct as value object.</p>\n\n<pre><code>type User struct {\n    Name  string            `json:\"name\"``\n    Email valueobject.Email `json:\"email\"`\n}\n</code></pre>\n\n<p>The <code>valueobject.Email</code> looks like this:</p>\n\n<pre><code>type Email struct {\n    value string\n}\nfunc (e *Email) Value() string {\n    return e.Value\n}\n</code></pre>\n\n<p>I want the value object as an immutable object, there is also a \"factory\" method in this is not necessary for my problem.</p>\n\n<p>Now I want to return the User struct as json and therefor I use</p>\n\n<pre><code>response := map[string]interface{}{\"user\": User}\njson.NewEncoder(w).Encode(response)\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>{\n    \"user\": {\n        \"name\": \"John Doe\",\n        \"email\": {\n            \"Email: \"johndoe@example.com\"\n        }\n    }\n}\n</code></pre>\n\n<p>But I want something link this:</p>\n\n<pre><code>{\n    \"user\": {\n        \"name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\"\n    }\n}\n</code></pre>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 101, "user_id": 10441175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kRVCauU-iC4/AAAAAAAAAAI/AAAAAAAAAOQ/8tSn6FbPoQA/photo.jpg?sz=128", "display_name": "iHelos", "link": "https://stackoverflow.com/users/10441175/ihelos"}, "edited": false, "score": 5, "creation_date": 1542174503, "post_id": 53293862, "comment_id": 93468818, "body": "<code>panic: reflect: reflect.Value.SetUint using value obtained using unexported field</code>: try to make your fields public (like magicValue [8]byte -&gt; MagicValue [8]byte)"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 5, "creation_date": 1542174584, "post_id": 53293862, "comment_id": 93468838, "body": "Capitalize the first letter of your fields."}], "answers": [{"tags": [], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "is_accepted": true, "score": 9, "last_activity_date": 1542183904, "creation_date": 1542183904, "answer_id": 53295797, "question_id": 53293862, "link": "https://stackoverflow.com/questions/53293862/panic-setuint-using-value-obtained-using-unexported-field/53295797#53295797", "title": "panic: SetUint using value obtained using unexported field", "body": "<p>The issue is that none of <code>HeaderT</code>'s fields are \"public\".</p>\n\n<p>Notice that all the fields start with a lowercase letter - that means the fields are unreachable to any code outside of your package.</p>\n\n<p>From the <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p><strong>Exported identifiers</strong></p>\n  \n  <p>An identifier may be exported to permit access to it from another package. An identifier is exported if both:</p>\n  \n  <ul>\n  <li>the first character of the identifier's name is a Unicode upper case letter (Unicode class \"Lu\"); and</li>\n  <li>the identifier is declared in the package block or it is a field name or method name.</li>\n  </ul>\n  \n  <p>All other identifiers are not exported. </p>\n</blockquote>\n\n<p>Try Exporting them by capitalizing their names:</p>\n\n<pre><code>type HeaderT struct {\n    MagicValue [8]byte\n    BodyLength [4]byte\n    BodyVersion [1]byte\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 1568, "user_id": 5865556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nSrTp.png?s=128&g=1", "display_name": "sungyong", "link": "https://stackoverflow.com/users/5865556/sungyong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2622, "favorite_count": 0, "accepted_answer_id": 53295797, "answer_count": 1, "score": 3, "last_activity_date": 1542185668, "creation_date": 1542174349, "last_edit_date": 1542185668, "question_id": 53293862, "link": "https://stackoverflow.com/questions/53293862/panic-setuint-using-value-obtained-using-unexported-field", "title": "panic: SetUint using value obtained using unexported field", "body": "<p>From byte buffer received server, I want to copy struct.  </p>\n\n<p>The format of buffer is fixed size bytes as below.  </p>\n\n<pre><code>00000000  83 27 48 12 6c 00 00 00  01 02 00 00 01 01 00 02  |.'H.l...........|\n00000010  10 01 d2 02 96 49 00 00  00 00 87 d6 12 00 00 00  |.....I..........|\n00000020  00 00 01 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000030  00 02 01 02 3c 01 01 00  00 00 01 01 01 01 18 10  |....&lt;...........|\n00000040  2c 01 90 01 01 6c 07 03  c8 02 01 02 03 9c 0a 0b  |,....l..........|\n00000050  0c 00 00 00 01 01 00 00  00 00 00 00 00 01 01 01  |................|\n00000060  01 01 01 01 01 01 01 01  01 00 01 01 01 00 00 00  |................|\n</code></pre>\n\n<p>My struct is below.</p>\n\n<pre><code>type HeaderT struct {\n    magicValue [8]byte\n    bodyLength [4]byte\n    bodyVersion [1]byte\n    ...\n}\n</code></pre>\n\n<p>My implementation is at below.</p>\n\n<pre><code>func onMessageReceived(client MQTT.Client, message MQTT.Message) {\n    payload := message.Payload()\n    fmt.Printf(\"Received message on topic: %s\\nMessage: \\n%s\\n\", message.Topic(), hex.Dump(payload))\n\n    header := HeaderT {}\n    err := binary.Read(bytes.NewBuffer(payload[:]), binary.LittleEndian, &amp;header)  // &lt;-- error occurred at this line\n    ...\n}\n</code></pre>\n\n<p>My code make panic as below.</p>\n\n<blockquote>\n  <p>panic: reflect: reflect.Value.SetUint using value obtained using\n  unexported field</p>\n  \n  <p>goroutine 38 [running]: reflect.flag.mustBeAssignable(0x1a8)\n          /usr/local/go/src/reflect/value.go:231 +0x1ee reflect.Value.SetUint(0x12540e0, 0xc0001a2000, 0x1a8, 0x83)\n          /usr/local/go/src/reflect/value.go:1551 +0x2f encoding/binary.(*decoder).value(0xc000148d88, 0x12540e0,\n  0xc0001a2000, 0x1a8)\n          /usr/local/go/src/encoding/binary/binary.go:548 +0x7c6 encoding/binary.(*decoder).value(0xc000148d88, 0x125cfc0,\n  0xc0001a2000, 0x1b1)\n          /usr/local/go/src/encoding/binary/binary.go:510 +0x104 encoding/binary.(*decoder).value(0xc000148d88, 0x129fa00,\n  0xc0001a2000, 0x199)\n          /usr/local/go/src/encoding/binary/binary.go:523 +0x2c5 encoding/binary.Read(0x12fcf80, 0xc00018a150, 0x1300c60, 0x14d76d0,\n  0x1248040, 0xc0001a2000, 0x0, 0x0)\n          /usr/local/go/src/encoding/binary/binary.go:248 +0x342 main.onMessageReceived(0x13012a0, 0xc000140000, 0x1300c00,\n  0xc000192000)</p>\n</blockquote>\n"}, {"tags": ["http", "go", "http-headers"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542181171, "post_id": 53293642, "comment_id": 93471250, "body": "The <a href=\"https://godoc.org/net/textproto#Reader.ReadMIMEHeader\" rel=\"nofollow noreferrer\">ReadMIMEHeader</a> documentation describes how multiple headers and headers with continuation lines are handled."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1542180820, "post_id": 53294317, "comment_id": 93471123, "body": "The net/http server appends to the slice. It does not replace the slice."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1542182112, "post_id": 53294317, "comment_id": 93471609, "body": "It&#39;s a map to <i>slice</i> of strings precisely to support repeated keys: <a href=\"https://play.golang.org/p/jdCBw2fIXHF\" rel=\"nofollow noreferrer\">play.golang.org/p/jdCBw2fIXHF</a>."}, {"owner": {"reputation": 428, "user_id": 8092543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOOdr.png?s=128&g=1", "display_name": "sebito91", "link": "https://stackoverflow.com/users/8092543/sebito91"}, "edited": false, "score": 0, "creation_date": 1542303268, "post_id": 53294317, "comment_id": 93530435, "body": "Gah, sorry folks. :/"}], "tags": [], "owner": {"reputation": 428, "user_id": 8092543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOOdr.png?s=128&g=1", "display_name": "sebito91", "link": "https://stackoverflow.com/users/8092543/sebito91"}, "is_accepted": false, "score": -3, "last_activity_date": 1542177060, "creation_date": 1542177060, "answer_id": 53294317, "question_id": 53293642, "link": "https://stackoverflow.com/questions/53293642/is-splitting-http-request-header-meaningful-in-golang-http-package/53294317#53294317", "title": "Is splitting http request header meaningful in golang http package?", "body": "<p>Hmm, I'm not sure that's quite valid. The <code>Headers</code> object is actually a map of string keys pointing to string slices.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Header\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Header</a></p>\n\n<p>As such, if you try to set the same key it <em>will</em> be overwritten as per standard golang map functionality.</p>\n"}], "owner": {"reputation": 47, "user_id": 6913948, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/711474e71d7bc7a47274a59bda951d68?s=128&d=identicon&r=PG&f=1", "display_name": "JoyceLee", "link": "https://stackoverflow.com/users/6913948/joycelee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542177060, "creation_date": 1542172872, "question_id": 53293642, "link": "https://stackoverflow.com/questions/53293642/is-splitting-http-request-header-meaningful-in-golang-http-package", "title": "Is splitting http request header meaningful in golang http package?", "body": "<p>Most servers have the http request header length limit(4k~8k).\nUsually we split the long headers into several parts.\nFor golang http package, I remember that it combines headers with the same key value into one giant header. Is this correct?</p>\n\n<p>Like if I have a token which length exceeds the 8k limit. I'd like to split into several parts with the same header key Authorization.\nThen send request using http package. \nDoes this split make sense or not?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1542172606, "post_id": 53293506, "comment_id": 93468306, "body": "Just unmarshall to a interface. And format/handle it from there."}, {"owner": {"reputation": 1119, "user_id": 193584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58bf89ba2dfa037971b05d1afb0480a3?s=128&d=identicon&r=PG", "display_name": "xds2000", "link": "https://stackoverflow.com/users/193584/xds2000"}, "reply_to_user": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1542173918, "post_id": 53293506, "comment_id": 93468652, "body": "@majidarif i just update the question and add more backgroud concerns to this question. welcome give some advise."}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1542174224, "post_id": 53293506, "comment_id": 93468741, "body": "There is no point in trying to unmarshall this directly to a struct because the key could and does start with a number. Unmarshall it to a string map with the value as an object of struct."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 10441175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kRVCauU-iC4/AAAAAAAAAAI/AAAAAAAAAOQ/8tSn6FbPoQA/photo.jpg?sz=128", "display_name": "iHelos", "link": "https://stackoverflow.com/users/10441175/ihelos"}, "is_accepted": true, "score": 0, "last_activity_date": 1542173921, "creation_date": 1542173921, "answer_id": 53293807, "question_id": 53293506, "link": "https://stackoverflow.com/questions/53293506/how-to-handle-response-json-have-custom-field-with-out-key/53293807#53293807", "title": "How to handle Response JSON have custom field with out key?", "body": "<p>you can unmarshal it into map, so you can get generated key as a key of map\n<a href=\"https://play.golang.org/p/IfEjjvKakpu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IfEjjvKakpu</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nvar input = `{\"14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu\": {\n\"final_balance\": 61914248289,\n\"n_tx\": 3472,\n\"total_received\": 3479994002972\n}}`\n\ntype object struct {\n    FinalBalance uint64 `json:\"final_balance\"`\n    NTX uint64 `json:\"n_tx\"`\n    TotalReceived uint64 `json:\"total_received\"`\n}\n\nfunc main() {\n    var result map[string]object;\n    err := json.Unmarshal([]byte(input), &amp;result);\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"result: %+v\", result)\n    // result: map[14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu:{FinalBalance:61914248289 NTX:3472 TotalReceived:3479994002972}]\n}\n</code></pre>\n"}], "owner": {"reputation": 1119, "user_id": 193584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58bf89ba2dfa037971b05d1afb0480a3?s=128&d=identicon&r=PG", "display_name": "xds2000", "link": "https://stackoverflow.com/users/193584/xds2000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 53293807, "answer_count": 1, "score": -1, "last_activity_date": 1542184565, "creation_date": 1542171980, "last_edit_date": 1542184565, "question_id": 53293506, "link": "https://stackoverflow.com/questions/53293506/how-to-handle-response-json-have-custom-field-with-out-key", "title": "How to handle Response JSON have custom field with out key?", "body": "<p>Query Api and response a custom JSON, how to Unmarshal it. the sample JSON:</p>\n\n<pre><code>{\"14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu\": {\n\"final_balance\": 61914248289,\n\"n_tx\": 3472,\n\"total_received\": 3479994002972\n}}\n</code></pre>\n\n<p>The key is a hex string. So how to handle it with golang convention, anyone can help me?</p>\n\n<p>Below is my try test code:</p>\n\n<pre><code>c.OnResponse(func(r *colly.Response) {\n    jsonData := r.Body\n\n    fmt.Println(string(jsonData))\n    fmt.Println(\"==================\")\n\n    //parse bitcoin json\n    jsonMap := make(map[string]interface{})\n    err := json.Unmarshal([]byte(jsonData), &amp;jsonMap)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(jsonMap)\n\n    dumpMap(\"\", jsonMap)\n})\n\nfunc dumpMap(space string, m map[string]interface{}) {\n    for k, v := range m {\n        if mv, ok := v.(map[string]interface{}); ok {\n            fmt.Printf(\"{ \\\"%v\\\": \\n\", k)\n            dumpMap(space+\"\\t\", mv)\n            fmt.Printf(\"}\\n\")\n        } else {\n            fmt.Printf(\"%v %v : %v\\n\", space, k, v)\n        }\n    }\n}\n</code></pre>\n\n<p>and go run <code>cmd/main.go</code>, the console is print here:</p>\n\n<pre><code>{\"14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu\": {\n    \"final_balance\": 75494521080,\n    \"n_tx\": 3493,\n    \"total_received\": 3493574275763\n}}\n==================\nmap[14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu:map[n_tx:3493 total_received:3.493574275763e+12 final_balance:7.549452108e+10]]\n{ \"14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu\":\n         final_balance : 7.549452108e+10\n         n_tx : 3493\n         total_received : 3.493574275763e+12\n}\n</code></pre>\n\n<p>Do I need customised <code>unmarshal func</code> to get string key? If I use <code>14AcKEr19gHJvgwQhK7sfFm6YJGmoZZoqu</code> as key I can't easily to access. I just want to know how handle it.</p>\n"}, {"tags": ["string", "go", "text", "types"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 6, "last_activity_date": 1542171222, "creation_date": 1542171222, "answer_id": 53293383, "question_id": 53293358, "link": "https://stackoverflow.com/questions/53293358/is-there-text-data-type-available-in-golang/53293383#53293383", "title": "Is there Text Data Type available in Golang?", "body": "<blockquote>\n  <p>Is there any Text data type in golang?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>Use string.</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1542182748, "creation_date": 1542182748, "answer_id": 53295534, "question_id": 53293358, "link": "https://stackoverflow.com/questions/53293358/is-there-text-data-type-available-in-golang/53295534#53295534", "title": "Is there Text Data Type available in Golang?", "body": "<p>That article is about mapping types, not data types. It's about how ES processes JSON strings (as in \"a string of bytes\"). </p>\n\n<p>You still send and receive the same bytes when transmitting documents.</p>\n"}], "owner": {"reputation": 47, "user_id": 10579479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04dcf977649e5fdf638914172fe91c0e?s=128&d=identicon&r=PG&f=1", "display_name": "Jond", "link": "https://stackoverflow.com/users/10579479/jond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1542182748, "creation_date": 1542170975, "question_id": 53293358, "link": "https://stackoverflow.com/questions/53293358/is-there-text-data-type-available-in-golang", "title": "Is there Text Data Type available in Golang?", "body": "<p>I am working with elasticsearch where I use the latest elasticsearch. The problem is that the latest elasticsearch uses text to replace string </p>\n\n<p><a href=\"https://www.elastic.co/blog/strings-are-dead-long-live-strings\" rel=\"nofollow noreferrer\">https://www.elastic.co/blog/strings-are-dead-long-live-strings</a></p>\n\n<p>My question is, how can I convert string to text for my golang program? </p>\n\n<p>Is there any Text data type in golang? </p>\n"}, {"tags": ["go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 1, "last_activity_date": 1542169339, "creation_date": 1542169339, "answer_id": 53293157, "question_id": 53292963, "link": "https://stackoverflow.com/questions/53292963/using-beego-captcha-invalid-memory-address-or-nil-pointer-dereference/53293157#53293157", "title": "Using beego captcha: invalid memory address or nil pointer dereference", "body": "<p>Just tested your code in my local. The error is coming from cache creation part. </p>\n\n<pre><code>store, err := cache.NewCache(CacheProvider, CacheConnection)\nif err != nil {\n    log.Fatal(err.Error())\n    os.Exit(0)\n}\n</code></pre>\n\n<p>To get the detailed error, check the <code>err</code> variable returned from <code>cache.NewCache()</code>. Also it's a best practice to always log any possible error coming from error object, don't ignore it.</p>\n\n<p>Here is the error log:</p>\n\n<blockquote>\n  <p>2018/11/14 11:13:24 cache: unknown adapter name \"redis\" (forgot to import?)</p>\n</blockquote>\n\n<p>The error above is occurred because cache package not able to find <code>redis</code> adapter. It's because you haven't imported the package. So let's try to import it, then your problem will be solved.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"github.com/astaxie/beego\"\n    \"github.com/astaxie/beego/cache\"\n    \"github.com/astaxie/beego/utils/captcha\"\n\n    _ \"github.com/astaxie/beego/cache/redis\" // &lt;----- this one\n)\n</code></pre>\n\n<p>Since we don't interact with the cache redis package directly, import it with <code>_</code>.</p>\n"}], "owner": {"reputation": 393, "user_id": 906919, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/65fcdc060c41ad5b42495dc131b71e6e?s=128&d=identicon&r=PG", "display_name": "user906919", "link": "https://stackoverflow.com/users/906919/user906919"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 53293157, "answer_count": 1, "score": 0, "last_activity_date": 1542169339, "creation_date": 1542167601, "question_id": 53292963, "link": "https://stackoverflow.com/questions/53292963/using-beego-captcha-invalid-memory-address-or-nil-pointer-dereference", "title": "Using beego captcha: invalid memory address or nil pointer dereference", "body": "<p>I want to use captcha to generate a verification code under Beego. But it has the error <strong>invalid memory address or nil pointer dereference</strong>.Does anyone know how to solve this problem? Thank you.</p>\n\n<pre><code>Request Method: GET\nRequest URL:    /accounts/forgotpassword\nRemoteAddr: 127.0.0.1\nStack\nC:/Go/src/runtime/asm_amd64.s:573\nC:/Go/src/runtime/panic.go:505\nC:/Go/src/text/template/exec.go:137\nC:/Go/src/runtime/asm_amd64.s:573\nC:/Go/src/runtime/panic.go:505\nC:/Go/src/runtime/panic.go:63\nC:/Go/src/runtime/signal_windows.go:167\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/utils/captcha/captcha.go:186\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/utils/captcha/captcha.go:164\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/utils/captcha/captcha.go:267\nC:/Go/src/runtime/asm_amd64.s:573\nC:/Go/src/reflect/value.go:447\nC:/Go/src/reflect/value.go:308\nC:/Go/src/text/template/exec.go:667\nC:/Go/src/text/template/exec.go:535\nC:/Go/src/text/template/exec.go:432\nC:/Go/src/text/template/exec.go:405\nC:/Go/src/text/template/exec.go:231\nC:/Go/src/text/template/exec.go:239\nC:/Go/src/text/template/exec.go:194\nC:/Go/src/text/template/exec.go:177\nC:/Go/src/html/template/template.go:137\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/template.go:66\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/controller.go:283\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/controller.go:234\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/controller.go:214\nD:/Google Drive/Work/GoWorkspace/src/github.com/astaxie/beego/router.go:863\nC:/Go/src/net/http/server.go:2694\nC:/Go/src/net/http/server.go:1830\nC:/Go/src/runtime/asm_amd64.s:2361\n</code></pre>\n\n<hr>\n\n<p>My Code:\n<strong>conf\\app.conf</strong></p>\n\n<pre><code># Cache Provider\nCacheProvider = redis\nCacheConnection = {\"conn\":\"127.0.0.1:6379\"}\n</code></pre>\n\n<p><strong>controllers\\main.go</strong></p>\n\n<pre><code>package controllers\n\nimport (\n\"github.com/astaxie/beego\"\n\"github.com/astaxie/beego/cache\"\n  \"github.com/astaxie/beego/utils/captcha\"\n)\n\n\nvar(\n    cpt *captcha.Captcha\n    CacheProvider string = beego.AppConfig.String(\"CacheProvider\")\n    CacheConnection string = beego.AppConfig.String(\"CacheConnection\")\n)\n\n\nfunc init() {\n  store, _ := cache.NewCache(CacheProvider, CacheConnection)\n  cpt = captcha.NewWithFilter(\"/accounts/captca/\", store)\n}\n</code></pre>\n\n<p><strong>views\\forgotpasswordcontroller\\get.tpl</strong></p>\n\n<pre><code>&lt;div class=\"w3-container w3-center\"&gt;\n      &lt;form method=\"post\" id=\"mainForm\"class=\"w3-container\" style=\"margin-top:90px\"&gt;\n        &lt;div class=\"w3-card \" style=\"    padding-left: 0px;\n        padding-right: 0px;    margin-top: 30px;\"&gt;\n            &lt;div class=\"w3-container\"&gt;\n                &lt;h1&gt;Reset password&lt;/h1&gt;\n            &lt;/div&gt;&lt;div class=\"w3-container\" style=\"    padding-bottom: 16px;\"&gt;\n            {{create_captcha}}\n                &lt;input type=\"text\"  class=\"w3-input   \"name=\"captcha\"style=\"outline: none;\"&gt;\n            &lt;p style=\"text-align: left;margin-top: 0px;color:red\"&gt;\n            {{if .Errors.Captcha}}\n                {{.Errors.Captcha}}{{else}}&amp;zwnj;{{end}}&lt;/p&gt;\n                &lt;input type=\"submit\" value=\"Request reset password\" onclick=\"login()\" class=\"w3-button w3-indigo w3-block w3-round-large\"&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/form&gt;\n  &lt;/div&gt;\n</code></pre>\n\n<p><strong>controllers\\forgotpassword.go</strong></p>\n\n<pre><code>package controllers\n\nimport (\n  \"github.com/astaxie/beego\"\n)\n\n\ntype ForgotPasswordController struct {\n  beego.Controller\n}\n\n\nfunc (c *ForgotPasswordController) Get() {\n  beego.Debug(\"In ForgotPasswordController:Get - Start\")\n  c.Layout = \"shared/layout.tpl\"\n}//end ForgotPasswordController:Get()\n\n\nfunc (this *ForgotPasswordController) Post() {\n\n  beego.Debug(\"In ForgotPasswordController:Post - Start\")\n\n  captchaVerification := cpt.VerifyReq(this.Ctx.Request)\n\n  if !captchaVerification {\n    errormap := make(map[string]string)\n    beego.Debug(\"In ForgotPasswordController:Post - captchaVerification Got wrong captcha\")\n    errormap[\"Captcha\"] = \"Sorry but the characters you endered didn't match. Please try again\"\n    this.Data[\"Errors\"] = errormap\n    return\n  }\n\n} //end ForgotPassword() func\n</code></pre>\n\n<hr>\n\n<p>Environment</p>\n\n<ul>\n<li>go version go1.10 windows/amd64 </li>\n<li>Beego : 1.10.1</li>\n</ul>\n"}, {"tags": ["elasticsearch", "go"], "comments": [{"owner": {"reputation": 688, "user_id": 5610348, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VVSjg.jpg?s=128&g=1", "display_name": "pcgben", "link": "https://stackoverflow.com/users/5610348/pcgben"}, "edited": false, "score": 0, "creation_date": 1542166182, "post_id": 53292754, "comment_id": 93466886, "body": "It looks to me like <code>student</code> is an array.  I am unfamiliar with go, but is there an array access operator <code>[]</code> or similar such as you might find in C or php etc?"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 688, "user_id": 5610348, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VVSjg.jpg?s=128&g=1", "display_name": "pcgben", "link": "https://stackoverflow.com/users/5610348/pcgben"}, "edited": false, "score": 0, "creation_date": 1542166238, "post_id": 53292754, "comment_id": 93466893, "body": "<code>student</code> is not an array.. it&#39;s just an object"}], "answers": [{"comments": [{"owner": {"reputation": 211, "user_id": 9518451, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155762241119934/picture?type=large", "display_name": "Nirit Levi", "link": "https://stackoverflow.com/users/9518451/nirit-levi"}, "edited": false, "score": 0, "creation_date": 1542186948, "post_id": 53292874, "comment_id": 93474099, "body": "The keyword field needs to be set in the mapping of the field (unless its a dynamic text field in which elastic produces a mapping with &#39;keyword&#39; field and limits it to 256 chars , or something like that). The reason you cannot sort on a simple text field without a keyword-field or a fielddata=true , is because it is not a doc_value type of field, and its indexed values are produced from the standard text analyzer (like array with multiple words) rather than a single value."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 211, "user_id": 9518451, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155762241119934/picture?type=large", "display_name": "Nirit Levi", "link": "https://stackoverflow.com/users/9518451/nirit-levi"}, "edited": false, "score": 0, "creation_date": 1542232895, "post_id": 53292874, "comment_id": 93499582, "body": "@NiritLevi yes! thanks so much! I need to dive deeper in to Elasticsearch&#39;s documentation!"}], "tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 1, "last_activity_date": 1542166845, "creation_date": 1542166845, "answer_id": 53292874, "question_id": 53292754, "link": "https://stackoverflow.com/questions/53292754/how-can-you-sort-documents-by-nested-object-in-elastic-search-using-go/53292874#53292874", "title": "How can you sort documents by nested object in elastic search using go?", "body": "<p>It turns out that this is a beginner mistake.. You can't sort by text fields. I got it from here <a href=\"https://stackoverflow.com/questions/45220352/elasticsearch-dsl-py-sorting-by-text-field\">elasticsearch-dsl-py Sorting by Text() field</a></p>\n\n<p>What you can do though, if you don't specify mappings, you can sort by the keyword property of the field.</p>\n\n<p><code>searchSvc = searchSvc.SortBy(elastic.NewFieldSort(\"student.first_name.keyword\").Asc())</code></p>\n\n<p>And it works!</p>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 926, "favorite_count": 0, "accepted_answer_id": 53292874, "answer_count": 1, "score": 1, "last_activity_date": 1542210635, "creation_date": 1542165990, "last_edit_date": 1542210635, "question_id": 53292754, "link": "https://stackoverflow.com/questions/53292754/how-can-you-sort-documents-by-nested-object-in-elastic-search-using-go", "title": "How can you sort documents by nested object in elastic search using go?", "body": "<p>I'm new to Elasticsearch.</p>\n\n<p>I have documents and each of them has a structure like this:</p>\n\n<pre><code>{\n    \"created_at\": \"2018-01-01 01:01:01\",\n    \"student\": {\n        \"first_name\": \"john\",\n        \"last_name\": \"doe\"\n    },\n    \"parent\": {\n        \"first_name\": \"susan\",\n        \"last_name\": \"smile\"\n    }\n}\n</code></pre>\n\n<p>I just want to sort those documents based on <code>student.first_name</code> using <code>olivere/elastic</code> package for <code>go</code>.</p>\n\n<p>This is my query at the moment:</p>\n\n<p><code>searchSvc = searchSvc.SortBy(elastic.NewFieldSort(\"student.first_name\").Asc())</code></p>\n\n<p>and I'm getting this error:</p>\n\n<blockquote>\n  <p>elastic: Error 400 (Bad Request): all shards failed\n  [type=search_phase_execution_exception]</p>\n</blockquote>\n\n<p>However when I tried sorting it by <code>created_at</code>, it's working.</p>\n\n<p><code>searchSvc = searchSvc.SortBy(elastic.NewFieldSort(\"created_at\").Asc())</code></p>\n\n<p>I don't have any mapping in the index. (is this the problem?)</p>\n\n<p>I tried searching for something like \"Elasticsearch sort by nested object\", but I always got questions that need to sort an array in the nested object.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542155466, "post_id": 53291368, "comment_id": 93464538, "body": "can you post code around this line <code>&#47;home&#47;anhthi&#47;go&#47;src&#47;github.com&#47;anhthii&#47;go-echo&#47;db&#47;models&#47;pla&zwnj;&#8203;ylist.go:35</code>?"}, {"owner": {"reputation": 31, "user_id": 6877466, "user_type": "registered", "profile_image": "https://graph.facebook.com/1799951810251994/picture?type=large", "display_name": "Anh Thi", "link": "https://stackoverflow.com/users/6877466/anh-thi"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542155581, "post_id": 53291368, "comment_id": 93464571, "body": "this line: <code>if err := db.GetDB().Where(query, field...).First(model).Error; gorm.IsRecordNotFoundError(err) { \t\treturn false \t}</code>"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542155927, "post_id": 53291368, "comment_id": 93464650, "body": "did you try <code>user := &amp;User{}</code>?"}, {"owner": {"reputation": 31, "user_id": 6877466, "user_type": "registered", "profile_image": "https://graph.facebook.com/1799951810251994/picture?type=large", "display_name": "Anh Thi", "link": "https://stackoverflow.com/users/6877466/anh-thi"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542156218, "post_id": 53291368, "comment_id": 93464717, "body": "I&#39;m so dumb for not realizing this thank you @DmitryHarnitski"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1542156354, "post_id": 53291368, "comment_id": 93464743, "body": "Funny, your question topic contains an answer :)"}], "answers": [{"tags": [], "owner": {"reputation": 472, "user_id": 5689112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8218d0d54eb2d0cffcc671894e9f6d63?s=128&d=identicon&r=PG&f=1", "display_name": "kitt", "link": "https://stackoverflow.com/users/5689112/kitt"}, "is_accepted": false, "score": 3, "last_activity_date": 1542156051, "creation_date": 1542156051, "answer_id": 53291538, "question_id": 53291368, "link": "https://stackoverflow.com/questions/53291368/passing-pointer-as-interface-type/53291538#53291538", "title": "Passing pointer as interface type", "body": "<p>According to <a href=\"https://github.com/jinzhu/gorm/issues/394\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/issues/394</a>, parameter <code>model</code> should be a pointer. I think the code below would work.</p>\n\n<pre><code>if exist := checkRecordExistence(&amp;user, \"username = ?\", username); !exist {\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6877466, "user_type": "registered", "profile_image": "https://graph.facebook.com/1799951810251994/picture?type=large", "display_name": "Anh Thi", "link": "https://stackoverflow.com/users/6877466/anh-thi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1542156051, "creation_date": 1542154681, "question_id": 53291368, "link": "https://stackoverflow.com/questions/53291368/passing-pointer-as-interface-type", "title": "Passing pointer as interface type", "body": "<p>Help me. I'm stuck at this, I make a checkRecordExistence to check for the existence of a record.This function take a model as an interface type, i pass the model down to the First function which also take model as an interface type but it doesnt work </p>\n\n<pre><code>    func checkRecordExistence(model interface{}, query string, field ...interface{}) bool {\n        if err := db.GetDB().Where(query, field...).First(model).Error; gorm.IsRecordNotFoundError(err) {\n            return false\n        }\n        return true\n    }\n\n    // GetPlaylists of a specific user\n    func GetPlaylists(username string) (playlists []Playlist) {\n        playlists = []Playlist{}\n        user := User{}\n        if exist := checkRecordExistence(user, \"username = ?\", username); !exist {\n            return\n        }\n        db.GetDB().Preload(\"Songs.Artists\").Preload(\"Songs\").Model(&amp;user).Related(&amp;playlists, \"UserRefer\")\n        return\n    }\n</code></pre>\n\n<p>When i call the GetPlaylists function it crashed </p>\n\n<pre><code>        eflect.Value.Addr of unaddressable value\n    /usr/lib/go/src/runtime/panic.go:513 (0x42c4d8)\n            gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))\n    /usr/lib/go/src/reflect/value.go:245 (0x4ae0c5)\n            Value.Addr: panic(\"reflect.Value.Addr of unaddressable value\")\n    /home/anhthi/go/src/github.com/anhthii/go-echo/vendor/github.com/jinzhu/gorm/callback_query.go:74 (0x54f1b4)\n            queryCallback: scope.scan(rows, columns, scope.New(elem.Addr().Interface()).Fields())\n    /home/anhthi/go/src/github.com/anhthii/go-echo/vendor/github.com/jinzhu/gorm/scope.go:857 (0x5767a4)\n            (*Scope).callCallbacks: (*f)(scope)\n    /home/anhthi/go/src/github.com/anhthii/go-echo/vendor/github.com/jinzhu/gorm/main.go:289 (0x56528e)\n            (*DB).First: inlineCondition(where...).callCallbacks(s.parent.callbacks.queries).db\n    /home/anhthi/go/src/github.com/anhthii/go-echo/db/models/playlist.go:35 (0x676c06)\n            checkRecordExistence: if err := db.GetDB().Where(query, field...).First(model).Error; gorm.IsRecordNotFoundError(err) {\n    /home/anhthi/go/src/github.com/anhthii/go-echo/db/models/playlist.go:45 (0x676dfc)\n            GetPlaylists: if exist := checkRecordExistence(user, \"username = ?\", username); !exist {\n</code></pre>\n\n<p>I think the problem is here: <strong>.Where(query, field...).First(model)</strong> but i can't find any solution, thanks if anyone can help me.</p>\n"}, {"tags": ["firebase", "go", "server", "firebase-cloud-messaging"], "comments": [{"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1542148618, "post_id": 53290224, "comment_id": 93462851, "body": "*Firewall is disabled in my server."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542149951, "post_id": 53290224, "comment_id": 93463209, "body": "Please, show you the operational sequence of your elements (app, nginx, gcm, etc)"}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542150212, "post_id": 53290224, "comment_id": 93463273, "body": "I updated the code"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542181057, "post_id": 53290224, "comment_id": 93471205, "body": "I dont understand your work. You are forwarding fcm by nginx or you are receiving fcm response by nginx?"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542181136, "post_id": 53290224, "comment_id": 93471237, "body": "Like jack, let go by parts: error 499 in nginx is configuration fail. Check <a href=\"https://stackoverflow.com/questions/15613452/nginx-issues-http-499-error-after-60-seconds-despite-config-php-and-aws/15621223#15621223\" title=\"nginx issues http 499 error after 60 seconds despite config php and aws\">stackoverflow.com/questions/15613452/&hellip;</a>"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542181169, "post_id": 53290224, "comment_id": 93471247, "body": "If you are trying forward by proxy between https to http, in this case check: <a href=\"https://serverfault.com/questions/145383/proxy-https-requests-to-a-http-backend-with-nginx\" title=\"proxy https requests to a http backend with nginx\">serverfault.com/questions/145383/&hellip;</a>."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1542181971, "post_id": 53290224, "comment_id": 93471549, "body": "Similar errors: <a href=\"https://github.com/docker/kitematic/issues/2353\" rel=\"nofollow noreferrer\">github.com/docker/kitematic/issues/2353</a> or <a href=\"https://github.com/xenolf/lego/issues/179\" rel=\"nofollow noreferrer\">github.com/xenolf/lego/issues/179</a>"}], "owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 447, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1542182713, "creation_date": 1542146777, "last_edit_date": 1542182713, "question_id": 53290224, "link": "https://stackoverflow.com/questions/53290224/i-o-timeout-connecting-to-firebase", "title": "i/o timeout connecting to firebase", "body": "<p>Yesterday everything was worked as expected in my Go application. I didn't change anything related to firewalls/configurations. Today when I'm trying to send a request to \"<a href=\"https://fcm.googleapis.com/fcm/send\" rel=\"nofollow noreferrer\">https://fcm.googleapis.com/fcm/send</a>\" I got the next errors:</p>\n\n<blockquote>\n  <p>Post <a href=\"https://fcm.googleapis.com/fcm/send\" rel=\"nofollow noreferrer\">https://fcm.googleapis.com/fcm/send</a>: dial tcp: lookup\n  fcm.googleapis.com on IP:53: read udp IP:37987->IP:53: i/o timeout</p>\n</blockquote>\n\n<p>I don't know how this error happen. Firewall configuration still the same. The weird is that If I test locally then it works fine but when I upload to my server I got that error.</p>\n\n<p>NGINX Configuration under Plesk:</p>\n\n<pre><code>server_name mydomain.com;\n\nlocation /api/v1 {\n\n    proxy_set_header        Host $host;\n    proxy_set_header        X-Real-IP $remote_addr;\n    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header        X-Forwarded-Proto $scheme;\n\n    fastcgi_read_timeout 2500;\n    proxy_connect_timeout      2500;\n    proxy_send_timeout         2500;\n    proxy_read_timeout         2500;\n    send_timeout               2500;\n    proxy_pass          http://localhost:8082/api/v1;\n}\n</code></pre>\n\n<p>UPDATE\nChecking the logs I got this from NGINX</p>\n\n<pre><code>499 POST /api/v1/notifications HTTP/1.1\n</code></pre>\n\n<p>My domain doesnt have a SSL Certificate, can this be the cause of timeout?</p>\n\n<p>UPDATE Code:</p>\n\n<pre><code>client, err := fcm.NewClient(\"KEY\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    handler.FirebaseClient = client\nfirebaseNotification := &amp;fcm.Message{\n        Notification: &amp;fcm.Notification{\n            Title: notificationData.Title,\n            Body:  notificationData.Body,\n        },\n    }\nfirebaseNotification.RegistrationIDs = notificationData.Tokens\n\n        fmt.Println(firebaseNotification)\n        _, err := FirebaseClient.Send(firebaseNotification)\nif err != nil {\n            fmt.Println(err)\n            return\n        }\n</code></pre>\n\n<p>Send function from the library github.com/appleboy/go-fcm</p>\n\n<pre><code>func (c *Client) send(data []byte) (*Response, error) {\n    // create request\n    req, err := http.NewRequest(\"POST\", c.endpoint, bytes.NewBuffer(data))\n    if err != nil {\n        return nil, err\n    }\n\n    // add headers\n    req.Header.Add(\"Authorization\", fmt.Sprintf(\"key=%s\", c.apiKey))\n    req.Header.Add(\"Content-Type\", \"application/json\")\n\n    // execute request\n    resp, err := c.client.Do(req)\n    if err != nil {\n        return nil, connectionError(err.Error())\n    }\n    defer resp.Body.Close()\n\n    // check response status\n    if resp.StatusCode != http.StatusOK {\n        if resp.StatusCode &gt;= http.StatusInternalServerError {\n            return nil, serverError(fmt.Sprintf(\"%d error: %s\", resp.StatusCode, resp.Status))\n        }\n        return nil, fmt.Errorf(\"%d error: %s\", resp.StatusCode, resp.Status)\n    }\n\n    // build return\n    response := new(Response)\n    if err := json.NewDecoder(resp.Body).Decode(response); err != nil {\n        return nil, err\n    }\n\n    return response, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 0, "last_activity_date": 1542148633, "creation_date": 1542148633, "answer_id": 53290553, "question_id": 53290173, "link": "https://stackoverflow.com/questions/53290173/is-there-a-safetemplatevariable-kind-of-function-for-golang/53290553#53290553", "title": "Is there a &quot;safeTemplateVariable&quot; kind of function for Golang?", "body": "<p>You can do</p>\n\n<pre><code> {{ $var2 := (printf \"hey guys, %v\" $var1) }}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/D_OOE7LqOrw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/D_OOE7LqOrw</a></p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1542182881, "creation_date": 1542182881, "answer_id": 53295555, "question_id": 53290173, "link": "https://stackoverflow.com/questions/53290173/is-there-a-safetemplatevariable-kind-of-function-for-golang/53295555#53295555", "title": "Is there a &quot;safeTemplateVariable&quot; kind of function for Golang?", "body": "<p>\"Safe\" is the default mode for HTML templates in Go.</p>\n\n<p>If you have a variable with special HTML characters, they are escaped on output, rendering them completely safe.  This is different than stripping HTML tags, though, which your example seems to do. If you want to strip HTML tags, rather than escaping HTML characters, you'll need to write your own function.</p>\n\n<p>If you want to disable safe behavior, and output raw HTML, use the <a href=\"https://golang.org/pkg/html/template/#HTML\" rel=\"nofollow noreferrer\"><code>template.HTML</code></a> type.</p>\n"}], "owner": {"reputation": 13, "user_id": 6389157, "user_type": "registered", "profile_image": "https://graph.facebook.com/1293495137331533/picture?type=large", "display_name": "Fernando Salaroli", "link": "https://stackoverflow.com/users/6389157/fernando-salaroli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 53290553, "answer_count": 2, "score": 0, "last_activity_date": 1542182881, "creation_date": 1542146536, "question_id": 53290173, "link": "https://stackoverflow.com/questions/53290173/is-there-a-safetemplatevariable-kind-of-function-for-golang", "title": "Is there a &quot;safeTemplateVariable&quot; kind of function for Golang?", "body": "<p>It is better to ask this question with an example:</p>\n\n<p>First, lets declare a variable in Golang:</p>\n\n<p><code>{{ $html := \"&lt;b&gt;hi!&lt;/b&gt;\" }}</code></p>\n\n<p>If we try to output <code>{{ $html }}</code> the output would be:</p>\n\n<p>input:<br>\n<code>{{ $html }}</code><br>\noutput:<br>\n<code>&lt;b&gt;hi!&lt;/b&gt;</code></p>\n\n<p>If you pass the <code>safeHTML</code> function, the html will evaluate and the output would be:</p>\n\n<p>input:<br>\n<code>{{ $html | safeHTML }}</code><br>\noutput:<br>\n<code>hi!</code></p>\n\n<p>Is there a way to parse a Golang variable? Like this:<br>\nIf I try this:<br>\n<code>{{ $var1 := \"it's me!\" }}</code><br>\n<code>{{ $var2 := \"hey guys, {{ $var1 }}\" }}</code>  </p>\n\n<p>This would happen:<br>\ninput:<br>\n<code>{{ $var2 }}</code><br>\noutput:<br>\n<code>\"hey guys, {{ $var 1 }}\"</code>  </p>\n\n<p>But I want the <code>$var1</code> value to be evaluated, like this:<br>\n<code>\"hey guys, it's me!\"</code></p>\n\n<p>Sorry if I wasn't clear enough, I'm not a native english speaker</p>\n\n<p>Thanks for the help!</p>\n"}, {"tags": ["go", "ftp", "gzip"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1542143361, "post_id": 53289246, "comment_id": 93460802, "body": "unclear because you don t provide enough details. This might give you some clues <a href=\"https://unix.stackexchange.com/questions/429197/reading-partially-downloaded-gzip-with-an-offset\" title=\"reading partially downloaded gzip with an offset\">unix.stackexchange.com/questions/429197/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 65, "user_id": 2132939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5776b39c2ca2d2a98997241477b0e37d?s=128&d=identicon&r=PG", "display_name": "Tamer", "link": "https://stackoverflow.com/users/2132939/tamer"}, "edited": false, "score": 0, "creation_date": 1564686462, "post_id": 53289520, "comment_id": 101122951, "body": "@Tamer: Unfortunately you only claim that this is not correct without providing proof of your claim. If you think that the project and paper you refer to is such a proof then you are wrong. This paper does not claim at all that it can get some arbitrary chunk from the middle of an arbitrary gzip file and decompress it. It is instead about reconstructing such data after reading lots of data starting with a random position (i.e. no arbitrary chunk of data) and under the assumption that the basic structure and content of the original data is known - in this case that these are DNA sequences."}, {"owner": {"reputation": 65, "user_id": 2132939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5776b39c2ca2d2a98997241477b0e37d?s=128&d=identicon&r=PG", "display_name": "Tamer", "link": "https://stackoverflow.com/users/2132939/tamer"}, "edited": false, "score": 0, "creation_date": 1564777277, "post_id": 53289520, "comment_id": 101155917, "body": "For sure i know that the project i have sent is not answering my question. For this reason I didn&#39;t sent as an answer and reply only your answer by saying your answer is not completely correct. Because your answer sounds like there is only one way of decompressing gzip data and no other alternative could exist. I just pointed this project this is not the case, and in case people who search about this subject can see this as an alternative."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 65, "user_id": 2132939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5776b39c2ca2d2a98997241477b0e37d?s=128&d=identicon&r=PG", "display_name": "Tamer", "link": "https://stackoverflow.com/users/2132939/tamer"}, "edited": false, "score": 0, "creation_date": 1564778432, "post_id": 53289520, "comment_id": 101156259, "body": "@Tamer: In this case it would be better not to just claim that I&#39;m not fully correct and then point to some external site as the only additional information - this way expecting everybody who wants to understand what you are talking about to invest lots of time in reading and understanding the paper. Instead you should point out where I&#39;m exactly not correct and provide a summary of what the external site shows. This way your comment could have been a valuable contribution. As for others: the actually interesting paper is <a href=\"https://github.com/Piezoid/pugz/blob/master/paper/paper.pdf\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 65, "user_id": 2132939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5776b39c2ca2d2a98997241477b0e37d?s=128&d=identicon&r=PG", "display_name": "Tamer", "link": "https://stackoverflow.com/users/2132939/tamer"}, "edited": false, "score": 0, "creation_date": 1564780348, "post_id": 53289520, "comment_id": 101156804, "body": "Steffen thank you for your suggestions, next time i will reply more informative way instead of just pointing a link. And for sure this area is interesting and important in bioinformatics."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 2, "last_activity_date": 1542143365, "creation_date": 1542143365, "answer_id": 53289520, "question_id": 53289246, "link": "https://stackoverflow.com/questions/53289246/decompressing-portion-of-gz-file-from-ftp-server-with-go/53289520#53289520", "title": "decompressing portion of gz file from ftp server with go", "body": "<p>You cannot take something from the middle of a gzip file and decompress it. gzip files need to be decompressed from the start unless there are explicit flush points in the file (usually not) in which case data can be decompressed by starting at these flush points.</p>\n"}], "owner": {"reputation": 65, "user_id": 2132939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5776b39c2ca2d2a98997241477b0e37d?s=128&d=identicon&r=PG", "display_name": "Tamer", "link": "https://stackoverflow.com/users/2132939/tamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1542143365, "creation_date": 1542141971, "question_id": 53289246, "link": "https://stackoverflow.com/questions/53289246/decompressing-portion-of-gz-file-from-ftp-server-with-go", "title": "decompressing portion of gz file from ftp server with go", "body": "<p>I am processing large gz file from ftp server without downloading to disk with go.</p>\n\n<p>I am able to fetched any portion of file via <a href=\"https://github.com/jlaffaye/ftp\" rel=\"nofollow noreferrer\">this</a> ftp go library </p>\n\n<p>how can i decompress the portion that i fetched?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1542140572, "post_id": 53288885, "comment_id": 93459763, "body": "No one can answer that for your application with your data running at idea of &quot;large scale&quot;. Just run it, measure it, and see if performance is acceptable, and if not, profile it to find out why."}, {"owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542140693, "post_id": 53288885, "comment_id": 93459825, "body": "I don&#39;t want the performance exactly. I want to know is it right way to using this @Adrian"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1542140824, "post_id": 53288885, "comment_id": 93459877, "body": "There is no &quot;right way&quot; as this depends on your workload and nobody can tell you. You have to measure yourself."}, {"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 2, "creation_date": 1542140898, "post_id": 53288885, "comment_id": 93459903, "body": "Sure, using pointers is a fine way, and will almost certainly not be a performance problem for you. Just write it, measure, and see."}, {"owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "reply_to_user": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1542143485, "post_id": 53288885, "comment_id": 93460851, "body": "thanks @AlexGuerra"}], "answers": [{"tags": [], "owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "is_accepted": false, "score": 1, "last_activity_date": 1542156706, "last_edit_date": 1542156706, "creation_date": 1542156342, "answer_id": 53291582, "question_id": 53288885, "link": "https://stackoverflow.com/questions/53288885/do-map-of-pointers-is-different-with-common-way-of-using-maps/53291582#53291582", "title": "Do map of pointers is different with common way of using maps", "body": "<p>You can accomplish this and still have a <code>map</code> of non-pointers, with a <em>pointer receiver</em> on the struct:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Cache struct {\n    name    string\n    counter int\n}\n\nfunc (c *Cache) incr() {    // the '(c *Cache)' is the receiver;\n    c.counter += 1          // it makes incr() a method, not just a function\n}\n\nfunc main() {\n    m := make(map[string]Cache)\n    m[\"james\"] = Cache{name: \"James\", counter: 10}\n\n    c := m[\"james\"]\n    c.incr()\n    fmt.Println(c.name, c.counter)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>James 11\n</code></pre>\n\n<p>If <em>receivers</em> and <em>methods</em> are new to you, here is where they are mentioned in the Tour of Go:  <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/1</a></p>\n\n<p>Note the page about <em>pointer receivers</em> a few steps later in the Tour:  <a href=\"https://tour.golang.org/methods/4\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/4</a></p>\n"}], "owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1542182890, "creation_date": 1542140380, "last_edit_date": 1542182890, "question_id": 53288885, "link": "https://stackoverflow.com/questions/53288885/do-map-of-pointers-is-different-with-common-way-of-using-maps", "title": "Do map of pointers is different with common way of using maps", "body": "<p>I want to create cache with map. As map doesn't allow reference to its value, so it's not possible to change values in called functions.</p>\n\n<p>After some search, I found, it's possible with creating map of pointer (of struct). It Almost solve problem and can work like variable by reference\nBut as i found a few using of this method for map. I worry about using it to be safe. \nIs anyone has experience of using map of pointer? and is it right way to use it?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Cache struct {\n    name    string\n    counter int\n}\n\nfunc incr(c Cache) {\n    c.counter += 1\n}\nfunc incrp(c *Cache) {\n    c.counter += 2\n}\n\nfunc main() {\n    m := make(map[string]Cache)\n    m[\"james\"] = Cache{name: \"James\", counter: 10}\n\n    c := m[\"james\"]\n    incr(c)\n    fmt.Println(c.name, c.counter) // James 10\n\n    mp := make(map[string]*Cache)\n    mp[\"james\"] = &amp;Cache{name: \"James\", counter: 10}\n    cp := mp[\"james\"]\n    incrp(cp)\n    fmt.Println(cp.name, cp.counter) // James 12\n\n}\n</code></pre>\n\n<blockquote>\n  <p>edited: My text had some confusing words and sentences, that caused to misunderstanding, so i tried to fixed it</p>\n</blockquote>\n"}, {"tags": ["go", "encoding", "ascii"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 2, "creation_date": 1542140226, "post_id": 53287230, "comment_id": 93459650, "body": "What do you expect to happen if the string contains a byte outside the range <code>[0,127]</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 5, "last_activity_date": 1542133785, "creation_date": 1542133785, "answer_id": 53287389, "question_id": 53287230, "link": "https://stackoverflow.com/questions/53287230/ascii-encoding-for-string-in-go/53287389#53287389", "title": "ASCII encoding for string in GO", "body": "<pre><code>strconv.QuoteToASCII\n</code></pre>\n\n<blockquote>\n  <p>QuoteToASCII returns a double-quoted Go string literal representing s. The returned string uses Go escape sequences (\\t, \\n, \\xFF, \\u0100) for non-ASCII characters and non-printable characters as defined by IsPrint.</p>\n</blockquote>\n\n<p>Or if you want an array of ascii codes, you could do</p>\n\n<pre><code>import \"encoding/ascii85\"\ndst := make([]byte, 25, 25)\ndst2 := make([]byte, 25, 25)\nascii85.Encode(dst, []byte(\"Hello, playground\"))\nfmt.Println(dst) \nascii85.Decode(dst2, dst, false)\nfmt.Println(string(dst2))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/gLEuWAGglJV\" rel=\"noreferrer\">https://play.golang.org/p/gLEuWAGglJV</a></p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1542148386, "last_edit_date": 1542148386, "creation_date": 1542146209, "answer_id": 53290123, "question_id": 53287230, "link": "https://stackoverflow.com/questions/53287230/ascii-encoding-for-string-in-go/53290123#53290123", "title": "ASCII encoding for string in GO", "body": "<p>A simple version that omits invalid runes could look like this:</p>\n\n<pre><code>func forceASCII(s string) string {\n  rs := make([]rune, 0, len(s))\n  for _, r := range s {\n    if r &lt;= 127 {\n      rs = append(rs, r)\n    }\n  }\n  return string(rs)\n}\n// forceASCII(\"Hello, World!\") // =&gt; \"Hello, World!\"\n// forceASCII(\"Hello, \u4e16\u754c!\") // =&gt; \"Hello, !\"\n// forceASCII(\"\u041f\u0440\u0438\u0432\u0435\u0442\") // =&gt; \"\"\n</code></pre>\n\n<p>But what if you want special behavior if the target UTF-8 string contains any characters outside the ASCII character range of <code>[0,127]</code>?</p>\n\n<p>You could write a function that handles various cases by extracting a function argument which takes the invalid-ASCII rune and returns a string replacement or error.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/946sLYku0o2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func forceASCII(s string, replacer func(rune) (string, error)) (string, error) {\n  rs := make([]rune, 0, len(s))\n  for _, r := range s {\n    if r &lt;= 127 {\n      rs = append(rs, r)\n    } else {\n      replacement, err := replacer(r)\n      if err != nil {\n        return \"\", err\n      }\n      rs = append(rs, []rune(replacement)...)\n    }\n  }\n  return string(rs), nil\n}\n\nfunc main() {\n  replacers := []func(r rune) (string, error){\n    // omit invalid runes\n    func(_ rune) (string, error) { return \"\", nil },\n    // replace with question marks\n    func(_ rune) (string, error) { return \"?\", nil },\n    // abort with error */\n    func(r rune) (string, error) { return \"\", fmt.Errorf(\"invalid rune 0x%x\", r) },\n  }\n\n  ss := []string{\"Hello, World!\", \"Hello, \u4e16\u754c!\"}\n  for _, s := range ss {\n    for _, r := range replacers {\n      ascii, err := forceASCII(s, r)\n      fmt.Printf(\"OK: %q \u2192 %q, err=%v\\n\", s, ascii, err)\n    }\n  }\n  // OK: \"Hello, World!\" \u2192 \"Hello, World!\", err=&lt;nil&gt;\n  // OK: \"Hello, World!\" \u2192 \"Hello, World!\", err=&lt;nil&gt;\n  // OK: \"Hello, World!\" \u2192 \"Hello, World!\", err=&lt;nil&gt;\n  // OK: \"Hello, \u4e16\u754c!\" \u2192 \"Hello, !\", err=&lt;nil&gt;\n  // OK: \"Hello, \u4e16\u754c!\" \u2192 \"Hello, ??!\", err=&lt;nil&gt;\n  // OK: \"Hello, \u4e16\u754c!\" \u2192 \"\", err=invalid rune 0x4e16\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 79, "user_id": 2801676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8uPt5.jpg?s=128&g=1", "display_name": "qasem", "link": "https://stackoverflow.com/users/2801676/qasem"}, "is_accepted": false, "score": -1, "last_activity_date": 1584532118, "creation_date": 1584532118, "answer_id": 60738947, "question_id": 53287230, "link": "https://stackoverflow.com/questions/53287230/ascii-encoding-for-string-in-go/60738947#60738947", "title": "ASCII encoding for string in GO", "body": "<p>check this function</p>\n\n<pre><code>func UtftoAscii(s string) []byte {\n    t := make([]byte, utf8.RuneCountInString(s))\n    i := 0\n    for _, r := range s {\n        t[i] = byte(r)\n        i++\n    }\n    return t\n}\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 2125563, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/208dbbc87fc9e14048d9f97b7b4b8d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Pritish Shah", "link": "https://stackoverflow.com/users/2125563/pritish-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6471, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1584532118, "creation_date": 1542133072, "last_edit_date": 1542133777, "question_id": 53287230, "link": "https://stackoverflow.com/questions/53287230/ascii-encoding-for-string-in-go", "title": "ASCII encoding for string in GO", "body": "<p>In Ruby, you can encode string to ASCII as follows:</p>\n\n<pre><code>str.force_encoding('ASCII')\n</code></pre>\n\n<p>How can we achieve the same in Go?</p>\n"}, {"tags": ["c", "go", "inline-assembly", "calling-convention"], "comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1542837503, "post_id": 53287194, "comment_id": 93716446, "body": "Post your answer as an answer, not an edit to the question.  And BTW, you can use <code>push</code> if you simply change the number that you <code>sub</code> from RSP to account for it.  Your &quot;answer&quot; has multiple bugs that I warned about in my answer: you don&#39;t tell the compiler that the call-clobbered registers are clobbered, and you step on the red-zone because you don&#39;t <code>sub</code> enough stack space to go past it."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542154259, "post_id": 53287291, "comment_id": 93464233, "body": "Dude, you are a lifesaver! I learn so much from your responses. Thanks again! edit: will accept once I tested it tomorrow. Not sure if my way of calling the function is the best way, but I&#39;m trying to emulate what Golang does when calling a function."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 1, "creation_date": 1542286224, "post_id": 53287291, "comment_id": 93519720, "body": "@reijin: updated with an example of clobbers + register inputs that should allow inputs to be in call-clobbered registers, at the compiler&#39;s option."}, {"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542291514, "post_id": 53287291, "comment_id": 93522972, "body": "Thanks for the update, right now my code crashes the allocation of a golang object (in a subroutine), so I guess I&#39;m somehow killing an important register in my other code that is required for context when I call the golang function. I have to find out what exactly goes wrong here. Go clobbers rbp in that sense as it creates a new stack frame and adds its position to rbp. The runtime always has a list of all the called functions with their stack frames in rbp. Right now I&#39;m having problems successfully going past the <code>call</code> instruction. Afterwards I&#39;ll figure out what clubbers I have to set."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 1, "creation_date": 1542292182, "post_id": 53287291, "comment_id": 93523398, "body": "@reijin: I don&#39;t know what registers Go treats as call-clobbered, but I just updated my answer with the complete set of call-clobbered x86-64 System V registers."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 1, "creation_date": 1542292335, "post_id": 53287291, "comment_id": 93523515, "body": "@reijin: Are you sure Go doesn&#39;t restore the caller&#39;s RBP before returning?  Part of making a traditional stack frame is <i>saving</i> the caller&#39;s RBP so you can restore it with <code>leave</code> or <code>pop rbp</code>."}, {"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542292549, "post_id": 53287291, "comment_id": 93523662, "body": "Sorry, I was unclear. What I meant was temporarily add its stack frame. Golang does not actually clubber rbp, it restores it before going back to the caller."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 1, "creation_date": 1542292768, "post_id": 53287291, "comment_id": 93523786, "body": "@reijin: Then there&#39;s no reason to save/restore <code>rbp</code> inside your inline asm.  It&#39;s just like RBX or R15 as far as the compiler is concerned."}, {"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542293034, "post_id": 53287291, "comment_id": 93523949, "body": "yeah... I was so caught up in imitating a golang function call by looking at the disassembly of a different function call as a template that I didn&#39;t think about that it&#39;s actually part of the x86-64 cc.  Thanks!"}, {"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542836399, "post_id": 53287291, "comment_id": 93716059, "body": "I edited my question to include the final code I needed to call into golang. I had to use <code>mov</code> as it doesn&#39;t move <code>rsp</code>. Still: thank you for your support :)"}], "tags": [], "owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 2, "last_activity_date": 1542292989, "last_edit_date": 1542292989, "creation_date": 1542133314, "answer_id": 53287291, "question_id": 53287194, "link": "https://stackoverflow.com/questions/53287194/too-many-memory-references-for-mov-when-calling-a-golang-function-with-c-by-us/53287291#53287291", "title": "too many memory references for `mov&#39; when calling a golang function with C by using inline assembly", "body": "<p>A <code>\"g\"</code> constraint allows the compiler to pick memory or register, so obviously you'll end up with <code>mov mem,mem</code> if that happens.  <code>mov</code> can have at most 1 memory operand.  (Like all x86 instructions, at most one explicit memory operand is possible.)</p>\n\n<p>Use <code>\"ri\"</code> constraints for the inputs that will be moved to a memory destination, to allow register or immediate but not memory.</p>\n\n<p>Also, you're modifying RSP so you can't safely use memory source operands.  The compiler is going to assume it can use addressing modes like <code>[rsp+16]</code> or <code>[rsp-4]</code>.  So you can't use <code>push</code> instead of <code>mov</code>.</p>\n\n<hr>\n\n<p>You also need to declare clobbers on all the call-clobbered registers, because the function call will do that.  (Or better, maybe ask for the inputs in those call-clobbered registers so the compiler doesn't have to bounce them through call-preserved regs like RBX.  But you need to make those operands read/write or declare separate output operands for the same registers to let the compiler know they'll be modified.)</p>\n\n<p>So probably your best bet for efficiency is something like</p>\n\n<pre><code>int ecx, edx, edi, esi; // dummy outputs as clobbers\nregister int r8 asm(\"r8d\");  // for all the call-clobbered regs in the calling convention\nregister int r9 asm(\"r9d\");\nregister int r10 asm(\"r10d\");\nregister int r11 asm(\"r11d\");\n// These are the regs for x86-64 System V.\n//  **I don't know what Go actually clobbers.**\n\nasm(\"sub  rsp, 0xe0\\n\\t\"    // adjust as necessary to align the stack before a call\n    // \"push args in reverse order\"\n    \"push  %[fn_len] \\n\\t\"\n    \"push  %[fn_str] \\n\\t\"\n    \"call \\n\\t\"\n    \"add   rsp, 0xe0 + 3*8 \\n\\t\"  // pop red-zone skip space + pushed args\n\n       // real output in RAX, and dummy outputs in call-clobbered regs\n    : \"=a\"(retval), \"=c\"(ecx), \"=d\"(edx), \"=D\"(edi), \"=S\"(esi), \"=r\"(r8), \"=r\"(r9), \"=r\"(r10), \"=r\"(r11)\n    : [fn_str] \"ri\" (filename.str), [fn_len] \"ri\" (filename.len), etc.  // inputs can use the same regs as dummy outputs\n    :  \"xmm0\", \"xmm1\", \"xmm2\", \"xmm3\", \"xmm4\", \"xmm5\", \"xmm6\", \"xmm7\",  // All vector regs are call-clobbered\n       \"xmm8\", \"xmm9\", \"xmm10\", \"xmm11\", \"xmm12\", \"xmm13\", \"xmm14\", \"xmm15\",\n       \"memory\"  // if you're passing any pointers (even read-only), or the function accesses any globals,\n                 // best to make this a compiler memory barrier\n    );\n</code></pre>\n\n<p><strong>Notice that the output are <em>not</em> early-clobber, so the compiler <em>can</em> (at its option) use those registers for inputs, but we're not forcing it so the compiler is still free to use some other register or an immediate.</strong></p>\n\n<p>Upon further discussion, Go functions don't clobber RBP, so there's no reason to save/restore it manually.  The only reason you might have wanted to is that locals might use RBP-relative addressing modes, and older GCC made it an error to declare a clobber on RBP when compiling without <code>-fomit-frame-pointer</code>.  (I think.  Or maybe I'm thinking of EBX in 32-bit PIC code.)</p>\n\n<hr>\n\n<p>Also, if you're using the x86-64 System V ABI, beware that inline asm must not clobber the red-zone.  The compiler assumes that doesn't happen and there's no way to declare a clobber on the red zone or even set <code>-mno-redzone</code> on a per-function basis.  So you probably need to <code>sub rsp, 128 +  0xe0</code>.  Or <code>0xe0</code> already includes enough space to skip the red-zone if that's not part of the callee's args.</p>\n"}, {"comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1542841301, "post_id": 53421307, "comment_id": 93717674, "body": "This &quot;answer&quot; has multiple bugs that I warned about in my answer: you don&#39;t tell the compiler about the call-clobbered registers, and you step on the red-zone because you don&#39;t sub enough stack space to go past it.   <code>sub rsp, 0x80</code> / 4x push / call / <code>add rsp, 0x80 + 4*8</code> should do the trick, along with clobbers as shown in my answer.  There&#39;s no need to use <code>mov</code> to put args on the stack, push works perfectly fine.  (@michael: I know this will ping you, but I&#39;m posting for the benefit of future readers.)"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "reply_to_user": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1542844900, "post_id": 53421307, "comment_id": 93718760, "body": "@PeterCordes :Understood. For other readers - my intent of posting this was to capture the OP&#39;s late edit, and I was taking no technical responsibility for it ;-). It was marked a community Wiki as I felt it was probably at least reasonable to move his update to an answer whether it be a good or bad answer. What I forgot to do was remove his solution from the question.Oops."}, {"owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "reply_to_user": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1542906000, "post_id": 53421307, "comment_id": 93744708, "body": "@PeterCordes: Okok, I get it. I prefer the <code>mov</code> way, as it doesn&#39;t force me to do the additional <code>sub</code> call. But I guess it&#39;s clearer to use <code>push</code>. Regarding your point on redzone and clubbered registers: I&#39;m aware of it, it&#39;s just that I didn&#39;t run into any errors (yet), so this works fine for now. Your answer is still the better and more fleshed-out one!"}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 0, "creation_date": 1542909317, "post_id": 53421307, "comment_id": 93746049, "body": "@reijin: If you ignore the red-zone, it&#39;s <code>mov</code> that needs a <code>sub rsp, offset</code>.  With <code>push</code> you can just start pushing to move RSP for free.  But since you need to skip over the red-zone, both ways need one <code>sub</code> and one <code>add</code>.  The only advantage to <code>mov</code> is that you can see explicitly which offset you&#39;re storing what, instead of having to push in reverse order of args.  (right-most arg first, so it&#39;s at the highest address)."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "edited": false, "score": 2, "creation_date": 1542909495, "post_id": 53421307, "comment_id": 93746106, "body": "@reijin: it&#39;s common to write inline asm that happens to work in one test, but is actually broken and will cause hard-to-debug problems down the road after changes to some <i>unrelated</i> code.  Or just with a new compiler version and/or build options (especially link-time optimization enabling inlining across source files.)"}], "tags": [], "owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "is_accepted": false, "score": 0, "last_activity_date": 1542839198, "creation_date": 1542839198, "answer_id": 53421307, "question_id": 53287194, "link": "https://stackoverflow.com/questions/53287194/too-many-memory-references-for-mov-when-calling-a-golang-function-with-c-by-us/53421307#53421307", "title": "too many memory references for `mov&#39; when calling a golang function with C by using inline assembly", "body": "<p>The original poster added this solution as an edit to their question:</p>\n\n<p>If someone ever finds this, the accepted answer does not help you when you try to call golang code with inline asm! The accepted answer only helps with my initial problem, which helped me to fix the golangcall. Use something like this:**</p>\n\n<pre><code>void* __cdecl go_call(void* func, __int64 p1, __int64 p2, __int64 p3, __int64 p4){\n    void* ret;\n    asm volatile(\"  sub     rsp, 0x28;             \\t\\n\\\n                    mov     [rsp], %[p1];                      \\t\\n\\\n                    mov     [rsp+0x8], %[p2];                      \\t\\n\\\n                    mov     [rsp+0x10], %[p3];                      \\t\\n\\\n                    mov     [rsp+0x18], %[p4];                      \\t\\n\\      \n                    call    %[func_addr];               \\t\\n\\\n                    add     rsp, 0x28; \"     \n                    :\n                    : [p1] \"ri\"(p1), [p2] \"ri\"(p2), \n                    [p3] \"ri\"(p3), [p4] \"ri\"(p4), [func_addr] \"ri\"(func)\n                    : );\n    return ret;\n}\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 8488000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c22b2b93a34820f8dde5eec9faae5f6?s=128&d=identicon&r=PG&f=1", "display_name": "reijin", "link": "https://stackoverflow.com/users/8488000/reijin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 53287291, "answer_count": 2, "score": 2, "last_activity_date": 1542844996, "creation_date": 1542132918, "last_edit_date": 1542844996, "question_id": 53287194, "link": "https://stackoverflow.com/questions/53287194/too-many-memory-references-for-mov-when-calling-a-golang-function-with-c-by-us", "title": "too many memory references for `mov&#39; when calling a golang function with C by using inline assembly", "body": "<p>I'm trying to call a golang function from my C code. Golang does not use the standard x86_64 calling convention, so I have to resort to implementing the transition myself. As gcc does not want to mix cdecl with the x86_64 convention,\nI'm trying to call the function using inline assembly:</p>\n\n<pre><code>void go_func(struct go_String filename, void* key, int error){\n    void* f_address = (void*)SAVEECDSA;\n    asm volatile(\"  sub     rsp, 0xe0;           \\t\\n\\\n                    mov     [rsp+0xe0], rbp;   \\t\\n\\\n                    mov     [rsp], %0;            \\t\\n\\\n                    mov     [rsp+0x8], %1;       \\t\\n\\\n                    mov    [rsp+0x18], %2;       \\t\\n\\\n                    call    %3;                     \\t\\n\\\n                    mov     rbp, [rsp+0xe0];   \\t\\n\\\n                    add     rsp, 0xe0;\"          \n                    :\n                    : \"g\"(filename.str), \"g\"(filename.len), \"g\"(key), \"g\"(f_address)\n                    : );\n    return;\n}\n</code></pre>\n\n<p>Sadly the compiler always throws an error at me that I dont understand:</p>\n\n<pre><code>./code.c:241: Error: too many memory references for `mov'\n</code></pre>\n\n<p>This corresponds to this line: <code>mov     [rsp+0x18], %2;       \\t\\n\\</code> If I delete it, the compilation works. I don't understand what my mistake is...</p>\n\n<p>I'm compiling with the -masm=intel flag so I use Intel syntax. Can someone please help me?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542131156, "post_id": 53286606, "comment_id": 93455551, "body": "Use a separate context for cancelling separate operations, and try to store less data in the context. Context&#39;s primary purpose is cancellation, and it is suboptimal as a general-purpose key-value store."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1542132610, "post_id": 53286606, "comment_id": 93456202, "body": "Context values are intended for request scoped data. If you have stuff in there that you need after the request ends it&#39;s obviously not request scoped and a big red flag. Consider passing these things around separately."}, {"owner": {"reputation": 931, "user_id": 1111555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d4405d620371f5f7b600849c04a372?s=128&d=identicon&r=PG", "display_name": "nickform", "link": "https://stackoverflow.com/users/1111555/nickform"}, "edited": false, "score": 0, "creation_date": 1542297339, "post_id": 53286606, "comment_id": 93526913, "body": "Thanks both for the comments."}], "answers": [{"comments": [{"owner": {"reputation": 931, "user_id": 1111555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d4405d620371f5f7b600849c04a372?s=128&d=identicon&r=PG", "display_name": "nickform", "link": "https://stackoverflow.com/users/1111555/nickform"}, "edited": false, "score": 0, "creation_date": 1542298167, "post_id": 53286809, "comment_id": 93527483, "body": "Thanks for the prompt answer @Flimzy. I had already gone for option 2 but it&#39;s nice to get a second opinion from a more authoritative source (going on SO rep!).  In case anyone&#39;s interested, to try to keep my traces working (I am using <a href=\"https://godoc.org/go.opencensus.io/trace\" rel=\"nofollow noreferrer\">godoc.org/go.opencensus.io/trace</a>), I will be exploring just manually starting a span as the async operation is started."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1542131281, "creation_date": 1542131281, "answer_id": 53286809, "question_id": 53286606, "link": "https://stackoverflow.com/questions/53286606/how-to-derive-a-context-which-can-be-used-after-an-inbound-request-has-ended/53286809#53286809", "title": "How to derive a context which can be used after an inbound request has ended?", "body": "<blockquote>\n  <p>Is there an easy way to derive just the values?</p>\n</blockquote>\n\n<p>Out of the box, no.  There are two possibilities I can imagine:</p>\n\n<ol>\n<li><p>You could make a custom context, that swallows/ignores cancellations. Such a type would need a custom implementation of <code>Done()</code> and <code>Err()</code>, which detected a timeout/cancellation, and ignored it.</p>\n\n<p>This approach has a possible drawback, that you may be referencing values which are expected to go out of scope at the end of a request. This could lead to race conditions or other data integrity issues.</p>\n\n<p>I would advise against this method, although it's probably the closest to what you're asking for. Contexts should be used primarily for cancellation, so heavy use of values in context is an anti-pattern.</p></li>\n<li><p>Probably the safer and easier solution, to which you eluded in your question, would be to explicitly copy any values you still care about to a new context created with <code>context.Background()</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 931, "user_id": 1111555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d4405d620371f5f7b600849c04a372?s=128&d=identicon&r=PG", "display_name": "nickform", "link": "https://stackoverflow.com/users/1111555/nickform"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 53286809, "answer_count": 1, "score": 0, "last_activity_date": 1542131281, "creation_date": 1542130444, "question_id": 53286606, "link": "https://stackoverflow.com/questions/53286606/how-to-derive-a-context-which-can-be-used-after-an-inbound-request-has-ended", "title": "How to derive a context which can be used after an inbound request has ended?", "body": "<p>From the documentation of <code>func (r *Request) Context() context.Context</code> in the <code>net/http</code> package:</p>\n\n<blockquote>\n  <p>For incoming server requests, the context is canceled when the client's connection closes, the request is canceled (with HTTP/2), or when the ServeHTTP method returns.</p>\n</blockquote>\n\n<p>What is the correct thing to do if I want to complete work related to the request after the <code>ServeHTTP</code> method has returned, for example emitting notifications? I'd like to preserve the context chain in terms of values but simply passing the context originally returned by the above method to the message queue submission API doesn't work as the context may be cancelled before it completes.</p>\n\n<p>Is there an easy way to derive just the values in a context chain without deadline or cancellation? I can manually copy values I have the keys for, but other things that rely on context continuity, like trace, will be absent.</p>\n\n<p>Thanks in advance for any answers.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 4833, "user_id": 4934937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EQFIL.jpg?s=128&g=1", "display_name": "maio290", "link": "https://stackoverflow.com/users/4934937/maio290"}, "edited": false, "score": 2, "creation_date": 1542129684, "post_id": 53285928, "comment_id": 93454835, "body": "Would you mind to show the PHP code as well?"}, {"owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "reply_to_user": {"reputation": 4833, "user_id": 4934937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EQFIL.jpg?s=128&g=1", "display_name": "maio290", "link": "https://stackoverflow.com/users/4934937/maio290"}, "edited": false, "score": 0, "creation_date": 1542132009, "post_id": 53285928, "comment_id": 93455948, "body": "maio290 - No prob, added it. For some reason the last curly brace doesn&#39;t go into the code though. Someone fixed my go func for me with the same prob."}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "edited": false, "score": 0, "creation_date": 1542132767, "post_id": 53285928, "comment_id": 93456278, "body": "Fixed the last curly brace. In Stack Overflow, just indent the line by at least 4 spaces to make it code-formatted. You might like to read <a href=\"https://stackoverflow.com/editing-help\">stackoverflow.com/editing-help</a>"}, {"owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "edited": false, "score": 0, "creation_date": 1542133440, "post_id": 53285928, "comment_id": 93456591, "body": "Thanks Bill Karwin"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1542133944, "post_id": 53285928, "comment_id": 93456822, "body": "You are using a single transaction in Go but not in PHP. Also, in PHP bind_param is only called once and not for each row. What happens if you do the same in both languages in this regard?"}, {"owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "edited": false, "score": 0, "creation_date": 1542135723, "post_id": 53285928, "comment_id": 93457643, "body": "Peter - I from what I can tell I think i&#39;m using a single transaction in PHP too because the transaction starts with $mysqli-&gt;autocommit(FALSE); and ends with $mysqli-&gt;commit();. Also, in go I was able to do an initial stmt.Exec(vars) outside the loop to bind the variables and then just a stmt.Exec() inside the loop and it actually seems to have worked besides there not being any documentation that it should work. It did not help the times at all though. If there is another way in golang to bind vars to a statement then change the vars and execute the statement w/out rebinding let me know."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1542138841, "post_id": 53285928, "comment_id": 93459043, "body": "You should take advantage of go capabilities to distribute the work among many routines and achieve parallelism. Literally, this is the way to go. I do believe you ll get good results."}, {"owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "edited": false, "score": 1, "creation_date": 1542160265, "post_id": 53285928, "comment_id": 93465579, "body": "mh-cbon - You were right. Running 10 go routines to accomplish the job does seem to reduce the execution time to 2.6s. That&#39;s nice but it&#39;s odd and messy having to spawn so many go routines to do something like this IMO. While experimenting, there might have been an error in my code that led me to think the number of operations in a transaction had something to do with execution time. But never-mind that - I can&#39;t reproduce it."}], "answers": [{"tags": [], "owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "is_accepted": true, "score": 0, "last_activity_date": 1542507282, "creation_date": 1542507282, "answer_id": 53357316, "question_id": 53285928, "link": "https://stackoverflow.com/questions/53285928/bulk-mysql-inserts-are-2x-slower-than-php/53357316#53357316", "title": "Bulk MySQL Inserts are 2x Slower than PHP", "body": "<p>In my testing to find what language I want to use for my new website I experimented with php, golang, and java. I don't have much experience with any of the languages so anything I say here could be corrected by someone in the future.</p>\n\n<p>My main test was batch inserts into the mysql database because I'll be needing it for an app.</p>\n\n<p>I wanted to move away from php because it's a non-compiled old scripting language which is slower at many things than golang and java. It's also an awkward syntax for many things. However php mysqli is actually 2x faster than golang for large \"transactions\" unless you awkwardly spawn many go-routines to divide the work up.</p>\n\n<p>During my testing and research I found out a few things.</p>\n\n<p>The PHP mysqli \"transactions\" api are probably using some kind of batch operations to get a \"transaction\" done because mysqli has no separate batch functions and the transactions are quicker than single inserts. But in most other languages transactions don't auto-batch everything and don't even increase the execution time. They are just a mechanism to roll back everything in the transaction if something goes wrong. What increases execution time in other languages is using batches.</p>\n\n<p>But one of the big problems with go mysql interface right now appears to be no real support for batch operations. The closest I got was to jerry rig one and make my own batch operation as pointed out by this post (<a href=\"https://stackoverflow.com/questions/21108084/golang-mysql-insert-multiple-data-at-once\">golang - mysql Insert multiple data at once?</a>). Doing this I was able to get the execution time in go from 9.2s to 3.9s without spawning other go routines. But since there's no real support for it the  batch operation only returns a single result set for the first operation of the batch. This is worthless to me because I need to return autoinc Ids for my inserted rows. There were other problems with this setup too that I wont go into. </p>\n\n<p>So lastly I tried java on a tomcat server. Tomcat/java installation is a bit more involved than go but programming in java was so much easier and natural. JDBC is an excellent driver with fulls support for easy batch operations with prepared statements. It did 100k inserts in only 1 sec. It's the clear winner in my book. Plus java syntax is much more natural than golang IMO.</p>\n"}], "owner": {"reputation": 103, "user_id": 9206030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8651bd15ff1eb981dc9642c81c453340?s=128&d=identicon&r=PG&f=1", "display_name": "user223304", "link": "https://stackoverflow.com/users/9206030/user223304"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 53357316, "answer_count": 1, "score": 2, "last_activity_date": 1580046269, "creation_date": 1542128048, "last_edit_date": 1542507479, "question_id": 53285928, "link": "https://stackoverflow.com/questions/53285928/bulk-mysql-inserts-are-2x-slower-than-php", "title": "Bulk MySQL Inserts are 2x Slower than PHP", "body": "<p>I've been testing Go in hopes to use it for a new site and wanted to make sure it was as fast or faster than PHP. So I ran a basic test doing bulk inserts in Go and PHP because I'll need bulk inserts.</p>\n\n<p>My tests used transactions, prepared statements, the same machine, the exact same table definition, no index but the PK, and the same logic in the function.</p>\n\n<p>Results:</p>\n\n<ul>\n<li>100k Inserts in PHP (mysqli) was 4.42 seconds</li>\n<li>100k Inserts in Go (Go-MySQL-Driver) was 9.2 seconds</li>\n</ul>\n\n<p>The go mysql driver i'm using is the most popular one 'Go-MySQL-Driver' found here: <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql</a></p>\n\n<p>I'm wondering if anyone can tell me if my code in go is not set up right or if this is just how go is. </p>\n\n<p>The functions add a bit of variability to a few of the row variables just so every row isnt the same.</p>\n\n<p>Go Function:</p>\n\n<pre><code>func fill_table(w http.ResponseWriter, r *http.Request, result_string *string, num_entries_to_add int) {\n    defer recover_show_error(result_string)\n\n    db := getDBConn()\n    defer db.Close()\n\n    var int_a int = 9  \n    var int_b int = 4  \n\n    var int_01 int = 1           \n    var int_02 int = 1451628000 // Date Entered  (2016-1-1, 1am)\n    var int_03 int = 11         \n    var int_04 int = 0\n    var int_05 int = 0\n\n    var float_01 float32 = 90.0 // Value\n    var float_02 float32 = 0\n    var float_03 float32 = 0\n\n    var text_01 string = \"\" \n    var text_02 string = \"\"\n    var text_03 string = \"\"\n\n    start_time := time.Now()\n\n    tx, err := db.Begin()\n    if err != nil {\n        panic(err)\n    }\n\n    stmt, err := tx.Prepare(\"INSERT INTO \" + TABLE_NAME +\n        \"(`int_a`,`int_b`,`int_01`,`int_02`,`int_03`,`int_04`,`int_05`,`float_01`,`float_02`,`float_03`,`text_01`,`text_02`,`text_03`) \" +\n        \"VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)\")\n\n    if err != nil {\n        panic(err)\n    }\n    defer stmt.Close()\n\n    var flip int = 0\n    for i := 0; i &lt; num_entries_to_add; i++ {\n\n        flip = ((int)(i / 500)) % 2\n        if flip == 0 {\n            float_01 += .1 // add to Value\n        } else {\n            float_01 -= .1 // sub from Value\n        }\n\n        int_02 += 1 // add a second to date.\n\n        _, err = stmt.Exec(int_a, int_b, int_01, int_02, int_03, int_04, int_05, float_01, float_02, float_03, text_01, text_02, text_03)\n        if err != nil {\n            panic(err)\n        }\n    }\n\n    err = tx.Commit()\n    if err != nil {\n        panic(err)\n    }\n\n    elapsed := time.Since(start_time)\n    *result_string += fmt.Sprintf(\"Fill Table Time = %s&lt;/br&gt;\\n\", elapsed)\n}\n</code></pre>\n\n<p>PHP Function:</p>\n\n<pre><code>function FillTable($num_entries_to_add){ \n\n    $mysqli= new mysqli(\"localhost\", $GLOBALS['db_username'], $GLOBALS['db_userpass'], $GLOBALS['database_name']);\n    if ($mysqli-&gt;connect_errno == 0) {\n\n        $int_a = 9; \n        $int_b = 4; \n\n        $int_01 = 1; \n        $int_02 = 1451628000; // Date Entered  (2016-1-1, 1am)\n        $int_03 = 11; \n        $int_04 = 0;         \n        $int_05 = 0;         \n\n        $float_01 = 90.0; // Value\n        $float_02 = 0;\n        $float_03 = 0;\n\n        $text_01 = \"\"; \n        $text_02 = \"\";\n        $text_03 = \"\";\n\n\n        $mysqli-&gt;autocommit(FALSE);     // This Starts Transaction mode. It will end when you use mysqli-&gt;commit();         \n\n        $sql = \"INSERT INTO \" . $GLOBALS['table_name'] . \n            \"(`int_a`,`int_b`,`int_01`,`int_02`,`int_03`,`int_04`,`int_05`,`float_01`,`float_02`,`float_03`,`text_01`,`text_02`,`text_03`) \" . \n            \"VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)\";\n\n        $start_time = microtime(true);\n\n        if($stmt = $mysqli-&gt;prepare($sql)) {\n            $stmt-&gt;bind_param('iiiiiiidddsss', $int_a, $int_b, $int_01, $int_02, $int_03, $int_04, $int_05, $float_01, $float_02, $float_03, $text_01, $text_02, $text_03);\n\n            $flip = 0;\n            for ($i = 1; $i &lt;= $num_entries_to_add; $i++) {\n                $flip = ((int)($i / 500)) % 2;\n                if ($flip == 0) {\n                    $float_01 += .1;    // add Value\n                }\n                else {\n                    $float_01 -= .1;    // sub Value\n                }\n\n                $int_02 += 1;       // add a second to date.\n\n                $stmt-&gt;execute(); //Executes a prepared Update \n            }\n\n            $mysqli-&gt;commit();  // Transaction mode ends now    \n            $stmt-&gt;close();  //Close statement\n        }\n\n        $execute_time = microtime(true) - $start_time;\n        echo $GLOBALS['html_newline'] . $GLOBALS['html_newline'] . \n            'FillDataEntryTable Speed: '.$execute_time.' sec' . $GLOBALS['html_newline'] . $GLOBALS['html_newline'];\n\n        $thread_id = $mysqli-&gt;thread_id;    // Get MySQL thread ID\n        $mysqli-&gt;kill($thread_id);          // Kill MySQL Server connection\n        $mysqli-&gt;close();                   // Close MySQL Server connection\n    }        \n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1542121799, "post_id": 53283917, "comment_id": 93449649, "body": "Sure, if you write it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1542122422, "post_id": 53283917, "comment_id": 93450110, "body": "Of course it&#39;s possible. What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 0, "creation_date": 1542126981, "post_id": 53283917, "comment_id": 93453133, "body": "Well, it&#39;s obviously not simply <code>Foo *Foo resolveFooById(json:&quot;fooReferenceId&quot;)</code> and I&#39;m missing the necessary keywords to find a solution on google - which is why I was turning to SO for some guidance."}], "answers": [{"comments": [{"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 0, "creation_date": 1542172696, "post_id": 53290394, "comment_id": 93468329, "body": "Thanks a lot Iain, exactly the info I was missing. Much appreciated!"}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 2, "last_activity_date": 1542147653, "creation_date": 1542147653, "answer_id": 53290394, "question_id": 53283917, "link": "https://stackoverflow.com/questions/53283917/how-to-resolve-references-in-unmarshaled-struct/53290394#53290394", "title": "How to resolve references in Unmarshaled struct", "body": "<p>You need to use a custom unmarshaler like the example at the bottom of this post:</p>\n\n<p><a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">http://choly.ca/post/go-json-marshalling/</a></p>\n\n<p>For your example this would look like:</p>\n\n<pre><code>func (b *Bar) UnmarshalJSON(input []byte) error {\n    type Alias Bar\n    aux := &amp;struct {\n        FooReferenceID int `json:\"fooReferenceId\"`\n        *Alias\n    }{\n        Alias: (*Alias)(b),\n    }\n    if err := json.Unmarshal(input, &amp;aux); err != nil {\n        return err\n    }\n    for index, foo := range foos {\n        if foo.ID == aux.FooReferenceID {\n            b.Foo = &amp;foos[index]\n            break\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Full executable example here:</p>\n\n<p><a href=\"https://play.golang.org/p/SCpsVCgnSSK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SCpsVCgnSSK</a></p>\n"}], "owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 53290394, "answer_count": 1, "score": -2, "last_activity_date": 1542162282, "creation_date": 1542121609, "last_edit_date": 1542162282, "question_id": 53283917, "link": "https://stackoverflow.com/questions/53283917/how-to-resolve-references-in-unmarshaled-struct", "title": "How to resolve references in Unmarshaled struct", "body": "<p>I have two json files that I unmarshal in Go.</p>\n\n<p>The first one includes a certain type of object that is referenced by ID in the second set.</p>\n\n<pre><code>// Foo\n{\n  \"id\": 5,\n  \"key\": \"value\"\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>// Bar\n{\n  \"name\": \"bar\",\n  \"fooReferenceId\": 5\n}\n</code></pre>\n\n<p>I want to end up with a <code>struct</code> like</p>\n\n<pre><code>type Bar struct {\n  Name string\n  Foo *Foo\n}\n</code></pre>\n\n<p>Is there a way to achieve this directly similar to how we provide <code>json:\"...\"</code> key resolver?</p>\n\n<p>Something like </p>\n\n<pre><code>type Bar struct {\n  Name string `json:\"name\"`\n  Foo  *Foo   resolveFooById(`json:\"fooReferenceId\"`)\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 561, "user_id": 3564720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KiSNg.jpg?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/3564720/max"}, "is_accepted": false, "score": 4, "last_activity_date": 1542120948, "creation_date": 1542120948, "answer_id": 53283744, "question_id": 53283572, "link": "https://stackoverflow.com/questions/53283572/how-to-trace-sql-query-in-postgresql/53283744#53283744", "title": "How to trace sql query in postgresql", "body": "<p>The second argument of <code>sql.Open()</code> expects a connection string. It has the following form:</p>\n\n<pre><code>fmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s sslmode=disable\",\n            host, port, user, password, dbname)\n</code></pre>\n\n<p>It contains the needed information to open a connection to Postgres.</p>\n"}, {"tags": [], "owner": {"reputation": 50, "user_id": 2673802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01176a9398bec0fb3fa17cb955fe44a3?s=128&d=identicon&r=PG", "display_name": "Roshan", "link": "https://stackoverflow.com/users/2673802/roshan"}, "is_accepted": true, "score": 0, "last_activity_date": 1542137673, "creation_date": 1542137673, "answer_id": 53288302, "question_id": 53283572, "link": "https://stackoverflow.com/questions/53283572/how-to-trace-sql-query-in-postgresql/53288302#53288302", "title": "How to trace sql query in postgresql", "body": "<p>sql.Open() expects 2 things 'driverName' and 'dataSourceName'. In case of <a href=\"https://github.com/gchaincl/sqlhooks\" rel=\"nofollow noreferrer\">sqlhooks</a> example, they used sqlite as database. Apart from that, they have used <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">go-sqlite3</a> and if you look closely to file <a href=\"https://github.com/mattn/go-sqlite3/blob/1fc3fd346d3cc4c610f432d8bc938bb952733873/sqlite3.go\" rel=\"nofollow noreferrer\">sqlite3.go</a> at line number 886. You would see datasourcename ':memory:' that means we are opting for in-memory utilization of sqlite db. </p>\n\n<p>'dataSourceName' will vary as per the database opted. Its basically means connection string in Data Source Name format.</p>\n\n<p>Reason why this worked\nfmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s sslmode=disable\",\n            host, port, user, password, dbname)</p>\n"}], "owner": {"reputation": 15, "user_id": 10518568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf1796ffe644dd03034c7d014b4585ed?s=128&d=identicon&r=PG&f=1", "display_name": "aswathy", "link": "https://stackoverflow.com/users/10518568/aswathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 53288302, "answer_count": 2, "score": 1, "last_activity_date": 1583475548, "creation_date": 1542120437, "last_edit_date": 1583475548, "question_id": 53283572, "link": "https://stackoverflow.com/questions/53283572/how-to-trace-sql-query-in-postgresql", "title": "How to trace sql query in postgresql", "body": "<pre><code>sql.Register(\"sqlWithHooks\", sqlhooks.Wrap(r.Driver(), &amp;Hooks{}))\n\n// Connect to the registered wrapped driver\ndb, err := sql.Open(\"sqlWithHooks\", \":memory:\")\nif err != nil {\n    fmt.Println(\"error\",err)\n\n}\n\nrows, err := db.Query(\"SELECT id,name,cid,dimension,price FROM   table_name \")\n\nif err != nil {\n    fmt.Println(\"inside the error .........................\",err)\n\n}\n</code></pre>\n\n<p>After running this code I am getting an error missing \"=\" after \":memory:\" in connection info string. Can anyone tell me what's wrong with what I've done here?</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 613, "user_id": 8626871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fba1c684c3181597d9009ba99ad5b2ee?s=128&d=identicon&r=PG&f=1", "display_name": "gkgkgkgk", "link": "https://stackoverflow.com/users/8626871/gkgkgkgk"}, "edited": false, "score": 5, "creation_date": 1542633943, "post_id": 53284075, "comment_id": 93626818, "body": "Sorry for such a late response- im using a kubernetes.Clientset object, not a kubeconfig, as I am running the service inside a cluster. Not sure if this answer applies, thanks!"}, {"owner": {"reputation": 876, "user_id": 2784039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GQcqz.jpg?s=128&g=1", "display_name": "Fabrice Jammes", "link": "https://stackoverflow.com/users/2784039/fabrice-jammes"}, "edited": false, "score": 0, "creation_date": 1610344869, "post_id": 53284075, "comment_id": 116093203, "body": "Here is a more accurate snippet of code which fit the same feature than the code above: <a href=\"https://stackoverflow.com/a/65661997/2784039\">stackoverflow.com/a/65661997/2784039</a>"}], "tags": [], "owner": {"reputation": 8272, "user_id": 6843187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8RyG.jpg?s=128&g=1", "display_name": "Prafull Ladha", "link": "https://stackoverflow.com/users/6843187/prafull-ladha"}, "is_accepted": false, "score": 4, "last_activity_date": 1542122163, "creation_date": 1542122163, "answer_id": 53284075, "question_id": 53283347, "link": "https://stackoverflow.com/questions/53283347/how-to-get-current-namespace-of-an-in-cluster-go-kubernetes-client/53284075#53284075", "title": "How to get current namespace of an in-cluster go Kubernetes client", "body": "<p>You can always set the context for each namespace and then read from kubeconfig on which context you are currently on:</p>\n\n<p>Use the following code to find out on which namespace you are on:</p>\n\n<pre><code>namespace, _, err := kubeconfig.Namespace()\n    if err != nil {\n            panic(err)\n    }\n</code></pre>\n\n<p>This will return the namespace in which you're.</p>\n\n<p>For more information refer : </p>\n\n<p><a href=\"https://github.com/kubernetes/client-go/blob/master/tools/clientcmd/client_config.go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/blob/master/tools/clientcmd/client_config.go</a></p>\n"}, {"comments": [{"owner": {"reputation": 188, "user_id": 9749861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9dabca17e5dcffafb873bb17b4527c?s=128&d=identicon&r=PG&f=1", "display_name": "B.Z.", "link": "https://stackoverflow.com/users/9749861/b-z"}, "edited": false, "score": 0, "creation_date": 1575924934, "post_id": 54374832, "comment_id": 104722321, "body": "If you are using operator-sdk, there is a utility method k8sutil.GetOperatorNamespace() in package: &quot;github.com/operator-framework/operator-sdk/pkg/k8sutil&quot;. The implementation just reads the above file."}], "tags": [], "owner": {"reputation": 21872, "user_id": 12916, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/53ab525063e3831bc781fa56af4181a5?s=128&d=identicon&r=PG", "display_name": "Jesse Glick", "link": "https://stackoverflow.com/users/12916/jesse-glick"}, "is_accepted": false, "score": 7, "last_activity_date": 1548465646, "creation_date": 1548465646, "answer_id": 54374832, "question_id": 53283347, "link": "https://stackoverflow.com/questions/53283347/how-to-get-current-namespace-of-an-in-cluster-go-kubernetes-client/54374832#54374832", "title": "How to get current namespace of an in-cluster go Kubernetes client", "body": "<p>Using</p>\n\n<pre><code>ioutil.ReadFile(\"/var/run/secrets/kubernetes.io/serviceaccount/namespace\")\n</code></pre>\n\n<p>works but is ugly, when the desired implementation is present in the <code>Namespace()</code> method of <code>inClusterClientConfig</code>. But how would you get that object starting from  <code>rest.InClusterConfig()</code>? It is only instantiable from outside the package via <code>NewNonInteractiveDeferredLoadingClientConfig</code>.</p>\n\n<p>I see <a href=\"https://github.com/kubernetes/kubernetes/pull/63707\" rel=\"noreferrer\">kubernetes #63707</a> which looks related but was abandoned.</p>\n"}, {"tags": [], "owner": {"reputation": 95, "user_id": 5683655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rF2WL.png?s=128&g=1", "display_name": "bappr", "link": "https://stackoverflow.com/users/5683655/bappr"}, "is_accepted": false, "score": 0, "last_activity_date": 1588291258, "creation_date": 1588291258, "answer_id": 61534815, "question_id": 53283347, "link": "https://stackoverflow.com/questions/53283347/how-to-get-current-namespace-of-an-in-cluster-go-kubernetes-client/61534815#61534815", "title": "How to get current namespace of an in-cluster go Kubernetes client", "body": "<p>Add this environment variable in your deployment config.</p>\n\n<pre><code> - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n</code></pre>\n\n<p>This is using the <a href=\"https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#capabilities-of-the-downward-api\" rel=\"nofollow noreferrer\">kubernetes downward api</a></p>\n"}], "owner": {"reputation": 613, "user_id": 8626871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fba1c684c3181597d9009ba99ad5b2ee?s=128&d=identicon&r=PG&f=1", "display_name": "gkgkgkgk", "link": "https://stackoverflow.com/users/8626871/gkgkgkgk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5970, "favorite_count": 1, "answer_count": 3, "score": 12, "last_activity_date": 1588291258, "creation_date": 1542119727, "last_edit_date": 1542634272, "question_id": 53283347, "link": "https://stackoverflow.com/questions/53283347/how-to-get-current-namespace-of-an-in-cluster-go-kubernetes-client", "title": "How to get current namespace of an in-cluster go Kubernetes client", "body": "<p>How do I get the current namespace of a deployment/service using the kubernetes client-go API? It doesn't seem to be in the client object or in the config.</p>\n"}, {"tags": ["go", "package"], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 5333616, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PGUDA8SH-yA/AAAAAAAAAAI/AAAAAAAAACI/3lqTNI5j8jA/photo.jpg?sz=128", "display_name": "Maxim Panfilov", "link": "https://stackoverflow.com/users/5333616/maxim-panfilov"}, "is_accepted": false, "score": 2, "last_activity_date": 1542120746, "creation_date": 1542120746, "answer_id": 53283672, "question_id": 53280394, "link": "https://stackoverflow.com/questions/53280394/how-to-write-nice-and-clean-go-package/53283672#53283672", "title": "How to write nice and clean Go package?", "body": "<p>You can use <code>k... int</code> as parameter.</p>\n\n<pre><code>func (sparse Sparse) Insert(k... int) error {\n    if len(k) == 0 {\n        // first case\n        return nil\n    } else if len(k) == 1 {\n        // second case\n        return nil\n    } else {\n        return errors.New(\"Too many arguments\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "closed_date": 1600773680, "answer_count": 1, "score": 0, "last_activity_date": 1542120746, "creation_date": 1542109681, "last_edit_date": 1542115903, "question_id": 53280394, "link": "https://stackoverflow.com/questions/53280394/how-to-write-nice-and-clean-go-package", "closed_reason": "Opinion-based", "title": "How to write nice and clean Go package?", "body": "<p>I try to implement Sparse sets from this <a href=\"https://programmingpraxis.com/2012/03/09/sparse-sets/\" rel=\"nofollow noreferrer\">article</a> in Go and make it into a package. In early implementation, the API is clean and minimal with only exported type <code>Sparse</code> and exported method <code>Insert</code>, <code>Delete</code>, <code>Has</code>, <code>Union</code>, <code>Intersection</code>, <code>Clear</code>, and <code>Len</code>, pretty much only basic sets operation.</p>\n\n<p>Later on, I want to add new functionality, sets that can reserve an element automatically (lets call it <code>AutoSparse</code>). If <code>Sparse</code> have <code>Insert(k int)</code> which insert k into sets, <code>AutoSparse</code> have <code>Reserved()</code> reserved an available element. If I have <code>{0 1 2 4 5}</code> in <code>AutoSparse</code>, when i call <code>Reserve()</code> it must add 3, not 6 so now it become <code>{0 1 2 4 5 3}</code>. Here's the implementation at <a href=\"https://play.golang.org/p/HlHEMakEgat\" rel=\"nofollow noreferrer\">playground</a>.</p>\n\n<p>As you can see, in order to maintain which element to added into sets, it doesn't add new field in the <code>struct</code> and I want to keep it like that.</p>\n\n<p>My Question is how to add that new functionality to my package without adding new exported type <code>AutoSparse</code> to keep the API clean and minimal? </p>\n\n<p>This is what i already try:</p>\n\n<ol>\n<li>I can use <code>interface</code> to hide implementation but function signature is different, one use <code>Insert(k int)</code>, the other use <code>Reserve()</code>, even if I use name <code>Insert()</code> it still different, or should I use <code>Insert(k int)</code> but didn't use <code>k</code> at all? it can but it's awkward.</li>\n<li>I can't use the same <code>struct</code> to implement this because once you Use <code>Reserve()</code> to add element, you can't use <code>Insert(k int)</code> because it will messed up the reserved element, even <code>Delete</code> and <code>Clear</code> is different.</li>\n</ol>\n"}, {"tags": ["arrays", "pointers", "go", "memory", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1542110092, "post_id": 53280378, "comment_id": 93442649, "body": "You must compare the addresses of their elements. Check if the ranges overlap."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542119844, "post_id": 53280835, "comment_id": 93448309, "body": "b, c and d are all backed by the same array, so <code>overlap(b, c)</code> should return true as well; as shown in the question (and the name is misleading). Unless I&#39;m missing something, it should be enough to compare the addresses of <code>x[cap(x)-1]</code>: <a href=\"https://play.golang.org/p/ULB3RJhz07i\" rel=\"nofollow noreferrer\">play.golang.org/p/ULB3RJhz07i</a>"}, {"owner": {"reputation": 9032, "user_id": 1037407, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9053cc1a060bd52936e92c59a35eca?s=128&d=identicon&r=PG", "display_name": "Ecir Hana", "link": "https://stackoverflow.com/users/1037407/ecir-hana"}, "edited": false, "score": 0, "creation_date": 1542120466, "post_id": 53280835, "comment_id": 93448734, "body": "Thanks but the question is whether the backing array is the same (and not whether the slices overlap)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542121158, "post_id": 53280835, "comment_id": 93449239, "body": "@Peter I&#39;ve misunderstood the question. Editing now."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9032, "user_id": 1037407, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9053cc1a060bd52936e92c59a35eca?s=128&d=identicon&r=PG", "display_name": "Ecir Hana", "link": "https://stackoverflow.com/users/1037407/ecir-hana"}, "edited": false, "score": 0, "creation_date": 1542121547, "post_id": 53280835, "comment_id": 93449494, "body": "@EcirHana Misunderstood, edited the question to answer that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1542121304, "last_edit_date": 1542121304, "creation_date": 1542111392, "answer_id": 53280835, "question_id": 53280378, "link": "https://stackoverflow.com/questions/53280378/aliasing-of-slices/53280835#53280835", "title": "Aliasing of slices", "body": "<p>In general you can't tell if the backing array is shared between 2 slices, because using a <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">full slice expression</a>, one might control the capacity of the resulting slice, and then there will be no overlap even when checking the capacity.</p>\n\n<p>As an example, if you have a backing array with 10 elements, a slice may be created that only contains the first 2 elements, and its capacity might be 2. And another slice may be create that only holds its last 2 elements, its capacity again being 2.</p>\n\n<p>See this example:</p>\n\n<pre><code>a := [10]int{}\n\nx := a[0:2:2]\ny := a[8:10:10]\n\nfmt.Println(\"len(x) = \", len(x), \", cap(x) = \", cap(x))\nfmt.Println(\"len(y) = \", len(y), \", cap(y) = \", cap(y))\n</code></pre>\n\n<p>The above will print that both lengths and capcities of <code>x</code> and <code>y</code> are 2. They obviously have the same backing array, but you won't have any means to tell that.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> I've misunderstood the question, and the following describes how to tell if (elements of) 2 slices overlap.</p>\n\n<p>There is no language support for this, but since slices have a contiguous section of some backing array, we can check if the address range of their elements overlap.</p>\n\n<p>Unfortunately pointers are not ordered in the sense that we can't apply the <code>&lt;</code> and <code>&gt;</code> operators on them (there are pointers in Go, but there is no pointer arithmetic). And checking if all the addresses of the elements of the first slice matches any from the second, that's not feasible.</p>\n\n<p>But we can obtain a pointer value (an address) as a type of <code>uintptr</code> using the reflect package, more specifically the <a href=\"https://golang.org/pkg/reflect/#Value.Pointer\" rel=\"nofollow noreferrer\"><code>Value.Pointer()</code></a> method (or we could also do that using package <code>unsafe</code>, but <code>reflect</code> is \"safer\"), and <code>uintptr</code> values are integers, they are ordered, so we can compare them.</p>\n\n<p>So what we can do is obtain the addresses of the first and last elements of the slices, and by comparing them, we can tell if they overlap.</p>\n\n<p>Here's a simple implementation:</p>\n\n<pre><code>func overlap(a, b []int) bool {\n    if len(a) == 0 || len(b) == 0 {\n        return false\n    }\n\n    amin := reflect.ValueOf(&amp;a[0]).Pointer()\n    amax := reflect.ValueOf(&amp;a[len(a)-1]).Pointer()\n    bmin := reflect.ValueOf(&amp;b[0]).Pointer()\n    bmax := reflect.ValueOf(&amp;b[len(b)-1]).Pointer()\n\n    return !(amax &lt; bmin || amin &gt; bmax)\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>a := []int{0, 1, 2, 3}\nb := a[0:2]\nc := a[2:4]\nd := a[0:3]\n\nfmt.Println(overlap(a, b)) // true\nfmt.Println(overlap(b, c)) // false\nfmt.Println(overlap(c, d)) // true\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/B-tCtOeJsb4\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 9032, "user_id": 1037407, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9053cc1a060bd52936e92c59a35eca?s=128&d=identicon&r=PG", "display_name": "Ecir Hana", "link": "https://stackoverflow.com/users/1037407/ecir-hana"}, "is_accepted": false, "score": 0, "last_activity_date": 1542120343, "creation_date": 1542120343, "answer_id": 53283542, "question_id": 53280378, "link": "https://stackoverflow.com/questions/53280378/aliasing-of-slices/53283542#53283542", "title": "Aliasing of slices", "body": "<p>Found one way of this <a href=\"https://golang.org/src/math/big/nat.go\" rel=\"nofollow noreferrer\">here</a>. The idea is that while I don't think there's a way of finding the beginning of the backing array, <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">ptr + cap</a> of a slice should[*] point to the end of it. So then one compares the last pointer for equality, like:</p>\n\n<pre><code>func alias(x, y nat) bool {\n    return cap(x) &gt; 0 &amp;&amp; cap(y) &gt; 0 &amp;&amp; &amp;x[0:cap(x)][cap(x)-1] == &amp;y[0:cap(y)][cap(y)-1]\n}\n</code></pre>\n\n<p>[*] The code includes the following note:</p>\n\n<blockquote>\n  <p>Note: alias assumes that the capacity of underlying arrays is never changed for nat values; i.e. that there are no 3-operand slice expressions in this code (or worse, reflect-based operations to the same effect).</p>\n</blockquote>\n"}], "owner": {"reputation": 9032, "user_id": 1037407, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9053cc1a060bd52936e92c59a35eca?s=128&d=identicon&r=PG", "display_name": "Ecir Hana", "link": "https://stackoverflow.com/users/1037407/ecir-hana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53280835, "answer_count": 2, "score": 2, "last_activity_date": 1542121304, "creation_date": 1542109634, "last_edit_date": 1542111507, "question_id": 53280378, "link": "https://stackoverflow.com/questions/53280378/aliasing-of-slices", "title": "Aliasing of slices", "body": "<p>How to check whether two slices are backed up by the same array?</p>\n\n<p>For example:</p>\n\n<pre><code>a := []int{1, 2, 3}\nb := a[0:1]\nc := a[2:3]\n\nalias(b, c) == true\n</code></pre>\n\n<p>How should <code>alias</code> look like?</p>\n"}, {"tags": ["go", "syntax"], "comments": [{"owner": {"reputation": 1373, "user_id": 5121457, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LL7q6xBDBlM/AAAAAAAAAAI/AAAAAAAAAB8/qRvPE3tHKk4/photo.jpg?sz=128", "display_name": "Gabriel M", "link": "https://stackoverflow.com/users/5121457/gabriel-m"}, "edited": false, "score": 0, "creation_date": 1542106187, "post_id": 53279199, "comment_id": 93440455, "body": "I thing this is a choice of the creators so the code is more readable"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542108187, "post_id": 53279524, "comment_id": 93441640, "body": "&quot;You usually have two ways..&quot;  usually?  Except for when?"}, {"owner": {"reputation": 3913, "user_id": 3710800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b06275b7ae4d1d759875b312db2102f?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Barr&#233;", "link": "https://stackoverflow.com/users/3710800/guillaume-barr%c3%a9"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542108552, "post_id": 53279524, "comment_id": 93441847, "body": "Except for the first example given by the OP where he has an ugly mix of both... But even if it&#39;s ugly it compiles."}], "tags": [], "owner": {"reputation": 3913, "user_id": 3710800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b06275b7ae4d1d759875b312db2102f?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Barr&#233;", "link": "https://stackoverflow.com/users/3710800/guillaume-barr%c3%a9"}, "is_accepted": false, "score": 1, "last_activity_date": 1542107277, "last_edit_date": 1542107277, "creation_date": 1542106769, "answer_id": 53279524, "question_id": 53279199, "link": "https://stackoverflow.com/questions/53279199/unable-to-import-after-declarations/53279524#53279524", "title": "Unable to import after declarations", "body": "<p>You usually have two ways to import packages in Go:</p>\n\n<pre><code>import \"fmt\"\nimport \"time\" \n</code></pre>\n\n<p>Or</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n)\n</code></pre>\n\n<p>The trick is that you cannot have a mix of <code>import</code> and something else like in your second example.</p>\n\n<pre><code>package main\n\nimport (\n       \"fmt\"\n)\n\nvar test = \"testing\" //&lt;-- This does not comply with the definition of a Go file\nimport \"time\"\n\nfunc main() {\n    currtime := time.Now()\n\n    fmt.Println(test) \n    fmt.Println(currtime)//Output: 16:44:53\n\n}\n</code></pre>\n\n<blockquote>\n  <p>Here you can find a well done documentation of the <a href=\"https://medium.com/golangspec/import-declarations-in-go-8de0fd3ae8ff\" rel=\"nofollow noreferrer\">Anatomy</a> of .go file.</p>\n  \n  <p>Structure of every .go file is the same. </p>\n  \n  <ul>\n  <li><p>First is package clause optionally preceded with comments usually describing the purpose of the package. </p></li>\n  <li><p>Then zero or more import declarations. </p></li>\n  <li><p>3rd section contains zero or more top-level declarations</p></li>\n  </ul>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1542107404, "creation_date": 1542107404, "answer_id": 53279709, "question_id": 53279199, "link": "https://stackoverflow.com/questions/53279199/unable-to-import-after-declarations/53279709#53279709", "title": "Unable to import after declarations", "body": "<blockquote>\n  <p>why does that happen in go lang ?</p>\n</blockquote>\n\n<p>Because it is disallowed by the language spec. Pretty simple, or?</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1542108051, "creation_date": 1542108051, "answer_id": 53279922, "question_id": 53279199, "link": "https://stackoverflow.com/questions/53279199/unable-to-import-after-declarations/53279922#53279922", "title": "Unable to import after declarations", "body": "<blockquote>\n  <p>The error is \"non-declaration statement outside function body\". Why does that happen in Go?</p>\n</blockquote>\n\n<p>Because this is how Go is defined to work.  From <a href=\"https://golang.org/ref/spec#Source_file_organization\" rel=\"nofollow noreferrer\">the spec</a>:</p>\n\n<blockquote>\n  <p>Each source file consists of a package clause defining the package to which it belongs, followed by a possibly empty set of import declarations that declare packages whose contents it wishes to use, followed by a possibly empty set of declarations of functions, types, variables, and constants.</p>\n</blockquote>\n\n<p>This means that the <em>only</em> valid place for import statements is between the <code>package</code> clause, and declarations of functions, types, variables, and constants.</p>\n\n<p>In your case, you have a variable declaration, so the Go compiler knows there will be no more import statements. Then it sees your erroneous import statement, sees that it is a non-declaration, and correctly generates the error you observe.</p>\n"}], "owner": {"reputation": 78, "user_id": 9227927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3a18282e99b2441076d821abea54d8c?s=128&d=identicon&r=PG&f=1", "display_name": "Uddhav Mishra", "link": "https://stackoverflow.com/users/9227927/uddhav-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 53279922, "answer_count": 3, "score": -2, "last_activity_date": 1542108093, "creation_date": 1542105678, "last_edit_date": 1542108093, "question_id": 53279199, "link": "https://stackoverflow.com/questions/53279199/unable-to-import-after-declarations", "title": "Unable to import after declarations", "body": "<p>I'm trying to import some modules after the declarations in Go.</p>\n\n<p>For instance, I've tried importing the time time after declaring a variable but that doesn't work , can someone please tell me why that happens in Go?</p>\n\n<p>This works:</p>\n\n<pre><code>package main\n\nimport (\n       \"fmt\"\n)\nimport \"time\";\n\nvar test = \"testing\"\n\nfunc main() {\n    currtime := time.Now()\n\n    fmt.Println(test) \n    fmt.Println(currtime)//Output: 16:44:53\n</code></pre>\n\n<p>}</p>\n\n<p>But thid doesn't:</p>\n\n<pre><code>package main\n\nimport (\n       \"fmt\"\n)\n\nvar test = \"testing\"\nimport \"time\"\n\nfunc main() {\n    currtime := time.Now()\n\n    fmt.Println(test) \n    fmt.Println(currtime)//Output: 16:44:53\n\n}\n</code></pre>\n\n<p>The error is \"non-declaration statement outside function body\". \nWhy does that happen in Go?</p>\n"}, {"tags": ["http", "go", "import", "parameters"], "comments": [{"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 3, "creation_date": 1542104376, "post_id": 53278488, "comment_id": 93439421, "body": "A better approach for your problem would be to have <code>AddFriend</code> return a success or error and evaluate that in your handler routine and respond appropriately to the client. Passing the responseWriter around for no reason creates unnecessary coupling for no reward."}, {"owner": {"reputation": 218, "user_id": 2648117, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f972b0539cd556bb0693bf068704817e?s=128&d=identicon&r=PG", "display_name": "user2648117", "link": "https://stackoverflow.com/users/2648117/user2648117"}, "edited": false, "score": 0, "creation_date": 1542107772, "post_id": 53278488, "comment_id": 93441349, "body": "TommyF, you are right. I&#39;m still figuring things out. I should probably get some books on design principles."}], "answers": [{"comments": [{"owner": {"reputation": 218, "user_id": 2648117, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f972b0539cd556bb0693bf068704817e?s=128&d=identicon&r=PG", "display_name": "user2648117", "link": "https://stackoverflow.com/users/2648117/user2648117"}, "edited": false, "score": 0, "creation_date": 1542107310, "post_id": 53278722, "comment_id": 93441044, "body": "I see. But what if a 10000 users activate func bla at the same time, wouldn&#39;t that cause a delay cause everything is synchronous and that a goroutine makes it asycn like a callback function in nodejs?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 218, "user_id": 2648117, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f972b0539cd556bb0693bf068704817e?s=128&d=identicon&r=PG", "display_name": "user2648117", "link": "https://stackoverflow.com/users/2648117/user2648117"}, "edited": false, "score": 3, "creation_date": 1542107418, "post_id": 53278722, "comment_id": 93441109, "body": "The <code>http</code> package already handles every request in a separate goroutine."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542121099, "post_id": 53278722, "comment_id": 93449188, "body": "Forget everything you&#39;re used to in nodejs and learn Go from fundamentals, not as it compares to NodeJS. Go has none of the train wreck of concurrency problems that Node has."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1542104278, "creation_date": 1542104278, "answer_id": 53278722, "question_id": 53278488, "link": "https://stackoverflow.com/questions/53278488/http-response-is-always-empty/53278722#53278722", "title": "HTTP response is always empty", "body": "<p>Don't call <code>database.AddFriend</code> in a goroutine. This is most likely the cause of your problem. By using a goroutine, your connection is closed and response sent, before the output is written to the HTTP response.</p>\n\n<pre><code>func bla (w http.ResponseWriter, r *http.Request) {\n   database.AddFriend(\"bob\", w) \n}\n</code></pre>\n"}], "owner": {"reputation": 218, "user_id": 2648117, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f972b0539cd556bb0693bf068704817e?s=128&d=identicon&r=PG", "display_name": "user2648117", "link": "https://stackoverflow.com/users/2648117/user2648117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 53278722, "answer_count": 1, "score": -3, "last_activity_date": 1542116642, "creation_date": 1542103551, "last_edit_date": 1542116642, "question_id": 53278488, "link": "https://stackoverflow.com/questions/53278488/http-response-is-always-empty", "title": "HTTP response is always empty", "body": "<p>How do I pass http.ResponseWriter in a parameter?\nI'm coming from nodejs and would really like to learn Go.</p>\n\n<p>Here is the main file:</p>\n\n<pre><code>import (\n    \"net/http\" \n    \"./libs/database\"\n)\n\nfunc bla (w http.ResponseWriter, r *http.Request) {\n   go database.AddFriend(\"bob\", w) \n}\n</code></pre>\n\n<p>Here is database file:</p>\n\n<pre><code>import (\n    \"net/http\"\n)\n\n func AddFriend (friendName string, w http.ResponseWriter){\n    fmt.Println(friendName)\n    w.Write([]byte(\"Yoooooooo\"))    \n }\n</code></pre>\n\n<p>Everything works but the w.Write returns nothing to my ajax post.\nI'm keep thinking its like nodejs where I can pass an\nobject then use it. I know its probably something simple but I just can't seem to figure it out.</p>\n"}, {"tags": ["go", "random", "floating-point"], "comments": [{"owner": {"reputation": 782, "user_id": 7071577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b816a812978bc140df497f0fbdd49c0?s=128&d=identicon&r=PG&f=1", "display_name": "Carlos Gonzalez", "link": "https://stackoverflow.com/users/7071577/carlos-gonzalez"}, "edited": false, "score": 0, "creation_date": 1542099647, "post_id": 53277105, "comment_id": 93436518, "body": "<code>rand.Float64()</code> is probably the closest in-built way of doing it <a href=\"https://golang.org/pkg/math/rand/#Rand.Float64\" rel=\"nofollow noreferrer\">golang.org/pkg/math/rand/#Rand.Float64</a>"}, {"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "reply_to_user": {"reputation": 782, "user_id": 7071577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b816a812978bc140df497f0fbdd49c0?s=128&d=identicon&r=PG&f=1", "display_name": "Carlos Gonzalez", "link": "https://stackoverflow.com/users/7071577/carlos-gonzalez"}, "edited": false, "score": 1, "creation_date": 1542100110, "post_id": 53277105, "comment_id": 93436779, "body": "No, <code>rand.Float64()</code> does it the naive way and doesn&#39;t return every possible value. I edited the question to add a link."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1542100381, "post_id": 53277105, "comment_id": 93436952, "body": "with the chance of getting 1 being 1/2\u2075&#179; i don&#39;t think you need to worry about it, if you do worry about it the docs you linked under cincenzo&#39;s answer explain how to fix it. so you can implement rand float 64 yourself"}, {"owner": {"reputation": 24192, "user_id": 8416610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cmim3CrZ9Wo/AAAAAAAAAAI/AAAAAAAAAjs/hnKTOHALc6M/photo.jpg?sz=128", "display_name": "Ralf Stubner", "link": "https://stackoverflow.com/users/8416610/ralf-stubner"}, "edited": false, "score": 1, "creation_date": 1542100383, "post_id": 53277105, "comment_id": 93436953, "body": "You probably have to implement this yourself. <a href=\"https://mumble.net/~campbell/2014/04/28/\" rel=\"nofollow noreferrer\">mumble.net/~campbell/2014/04/28</a> might be a starting point."}, {"owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "edited": false, "score": 0, "creation_date": 1542101606, "post_id": 53277105, "comment_id": 93437693, "body": "Are you sure the paper you posted is correct? I don&#39;t understand the math but your quoted sentence is not in there. Besides, edit the question afterwards changing the topic is not the more polite (or correct) thing to do."}, {"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1542101857, "post_id": 53277105, "comment_id": 93437853, "body": "The paper denotes D the set of real numbers representable as float64, and much of the reasoning is based on this assumption (ctrl+f &quot;their ulps vary between&quot;). I think the paper is correct, although I haven&#39;t checked every calculation."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542115851, "post_id": 53277105, "comment_id": 93445825, "body": "<i>&quot; if the value is lower than 2\u207b\u2074 for example, the 4 last bits of the significand are always going to be 0&quot;</i> Where are you getting this from?"}, {"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542122477, "post_id": 53277105, "comment_id": 93450152, "body": "@icza If the exponent is -4 (or less), the last 4 bits of the significant correspond to precision strictly lower than 2\u207b\u2075&#179;, and you&#39;re only generating multiples of 2\u207b\u2075&#179;."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1542248023, "post_id": 53277105, "comment_id": 93503732, "body": "The paper tells you what to generate: \u201cA uniform distribution over D \u2229 (0, 1) can be generated by independently sampling an exponent (from the geometric distribution with parameter .5) and a significand (by drawing a uniform string from {0, 1}\u2075&#178;).\u201d That omits discussion of subnormals. I suspect covering the normals suffices for their purposes, but completing the geometric distribution by duplicating the probability for the least normal exponent and the subnormal values would fit nicely. (The probability of each floating-point number in [0, 1) would be proportional to its ULP.)"}], "answers": [{"comments": [{"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1542121743, "post_id": 53278046, "comment_id": 93449617, "body": "I don&#39;t understand this comment. Essentially, I want do as if I were selecting a real number uniformly randomly between 0 and 1 and rounding it to the next float. I think Severin&#39;s answer is what I&#39;m looking for. I&#39;ll implement it in Go."}, {"owner": {"reputation": 1091, "user_id": 2160562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CcQEn.png?s=128&g=1", "display_name": "gammatester", "link": "https://stackoverflow.com/users/2160562/gammatester"}, "reply_to_user": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1542123602, "post_id": 53278046, "comment_id": 93450900, "body": "You should add this to your question, but be aware that your mapping can generate 1 for values in the interval (1-2^(-53), 1)"}], "tags": [], "owner": {"reputation": 1091, "user_id": 2160562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CcQEn.png?s=128&g=1", "display_name": "gammatester", "link": "https://stackoverflow.com/users/2160562/gammatester"}, "is_accepted": false, "score": 1, "last_activity_date": 1542102178, "creation_date": 1542102178, "answer_id": 53278046, "question_id": 53277105, "link": "https://stackoverflow.com/questions/53277105/generate-uniformly-random-float-which-can-return-all-possible-values/53278046#53278046", "title": "Generate uniformly random float which can return all possible values", "body": "<p>Because the binary64 floating point numbers are not uniformly spaced, you cannot generate a uniform distribution which can return all possible values less that 1.</p>\n\n<p>If you omit the requirement <em>uniform</em> you have to generate all representable multiples of the smallest positive denormal number <code>2^(-1074)</code>and zero.</p>\n"}, {"comments": [{"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1542126928, "post_id": 53283274, "comment_id": 93453098, "body": "(a) That is a way, not \u201cthe standard\u201d way. (b) Its range is [0, 1], but the question asks for [0, 1). It does mention the range can be reduced by rejection sampling (retry if the result is 1). (c) It generates 1074 only conceptually; in practice it uses many smaller bits in almost all cases."}, {"owner": {"reputation": 15136, "user_id": 4044696, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/54xyv.jpg?s=128&g=1", "display_name": "Severin Pappadeux", "link": "https://stackoverflow.com/users/4044696/severin-pappadeux"}, "reply_to_user": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1542132981, "post_id": 53283274, "comment_id": 93456387, "body": "@EricPostpischil <code>(a)</code> Doesn&#39;t seems to be a better way. <code>(b)</code> yep, rejection comes to rescue, I believe it is mention in comments. <code>(c)</code> yes, thank you, I corrected the answer."}], "tags": [], "owner": {"reputation": 15136, "user_id": 4044696, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/54xyv.jpg?s=128&g=1", "display_name": "Severin Pappadeux", "link": "https://stackoverflow.com/users/4044696/severin-pappadeux"}, "is_accepted": false, "score": 2, "last_activity_date": 1543854426, "last_edit_date": 1543854426, "creation_date": 1542119453, "answer_id": 53283274, "question_id": 53277105, "link": "https://stackoverflow.com/questions/53277105/generate-uniformly-random-float-which-can-return-all-possible-values/53283274#53283274", "title": "Generate uniformly random float which can return all possible values", "body": "<p>Well, standard way, I believe, is to generate up to 1074bits integer and map it to the double. Beware, that your RNG should have internal state at least 1074bits long.</p>\n\n<p>Reference implementation: <a href=\"http://xoshiro.di.unimi.it/random_real.c\" rel=\"nofollow noreferrer\">http://xoshiro.di.unimi.it/random_real.c</a></p>\n\n<p>Discussion about it: <a href=\"http://xoshiro.di.unimi.it/\" rel=\"nofollow noreferrer\">http://xoshiro.di.unimi.it/</a></p>\n\n<p>Another good link: <a href=\"https://lemire.me/blog/2017/02/28/how-many-floating-point-numbers-are-in-the-interval-01/\" rel=\"nofollow noreferrer\">https://lemire.me/blog/2017/02/28/how-many-floating-point-numbers-are-in-the-interval-01/</a></p>\n"}, {"comments": [{"owner": {"reputation": 15136, "user_id": 4044696, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/54xyv.jpg?s=128&g=1", "display_name": "Severin Pappadeux", "link": "https://stackoverflow.com/users/4044696/severin-pappadeux"}, "edited": false, "score": 0, "creation_date": 1542156649, "post_id": 53286653, "comment_id": 93464818, "body": "If you&#39;re going to port code directly, things would depend on ldexp() implementation. I quickly looked through Go runtime and glibc implementation, and there are quite some differences to my surprise."}, {"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "reply_to_user": {"reputation": 15136, "user_id": 4044696, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/54xyv.jpg?s=128&g=1", "display_name": "Severin Pappadeux", "link": "https://stackoverflow.com/users/4044696/severin-pappadeux"}, "edited": false, "score": 0, "creation_date": 1542180685, "post_id": 53286653, "comment_id": 93471080, "body": "Yes, that&#39;s why I&#39;m taking another approach for the implementation. I think both are conceptually equivalent (but would be happy to be proven wrong)."}], "tags": [], "owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "is_accepted": true, "score": 2, "last_activity_date": 1542130666, "creation_date": 1542130666, "answer_id": 53286653, "question_id": 53277105, "link": "https://stackoverflow.com/questions/53277105/generate-uniformly-random-float-which-can-return-all-possible-values/53286653#53286653", "title": "Generate uniformly random float which can return all possible values", "body": "<p>Porting <a href=\"http://xoshiro.di.unimi.it/random_real.c\" rel=\"nofollow noreferrer\">this code</a> (suggested in Severin's answer) is a possible option.</p>\n\n<p>I think that it is equivalent to first generate the significand bits (by generating a random float in [1,2)), and then choose the exponent from a geometric distribution (it has a 0.5 chance of being -1, 0.25 of being -2, etc.).</p>\n\n<pre><code>// uniform returns a uniformly random float in [0,1).\nfunc uniform() float64 {\n  sig := rand.Uint64() % (1 &lt;&lt; 52)\n  return (1 + float64(i)/(1&lt;&lt;52)) / math.Pow(2, geometric())\n}\n\n// geometric returns a number picked from a geometric\n// distribution of parameter 0.5.\nfunc geometric() float64 {\n  b := 1\n  for rand.Uint64()%2 == 0 {\n     b++\n  }\n  return b\n}\n</code></pre>\n\n<p>We can probably make geometric() faster by using one of the <code>LeadingZeros*</code> functions from the <a href=\"https://golang.org/pkg/math/bits/#LeadingZeros\" rel=\"nofollow noreferrer\"><code>bits</code></a> package instead of doing one coin flip per bit.</p>\n"}, {"comments": [{"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1542180906, "post_id": 53287144, "comment_id": 93471168, "body": "Thanks \u2014 but this generates a uniform distribution over the possible elements, not over the real interval. I clarified the question."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1598406674, "last_edit_date": 1598406674, "creation_date": 1542132735, "answer_id": 53287144, "question_id": 53277105, "link": "https://stackoverflow.com/questions/53277105/generate-uniformly-random-float-which-can-return-all-possible-values/53287144#53287144", "title": "Generate uniformly random float which can return all possible values", "body": "<p>You could use brute-force rejection sampling by generating 16 random bytes and using it only if it's a valid float64 in <code>[0,1)</code>. This approach should give you a uniform distribution of all values in that range with performance not much worse than other strategies based on simple benchmarking.</p>\n<p>For example (<a href=\"https://play.golang.com/p/eP94aRi0zV4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>import &quot;math/rand&quot;\n\nfunc randFloat64() float64 {\n  for {\n    f := math.Float64frombits(rand.Uint64())\n    if f &gt;= 0 &amp;&amp; f &lt; 1.0 {\n      return f\n    }\n  }\n}\n</code></pre>\n<p>If performance is critical then you could build an enormous lookup table containing only the valid numbers and choose a random location in the table. The table could be generated ahead of time in a similar fashion as above, by enumerating the bitfield and storing only valid numbers.</p>\n"}], "owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1294, "favorite_count": 1, "accepted_answer_id": 53286653, "answer_count": 4, "score": 9, "last_activity_date": 1598406674, "creation_date": 1542099139, "last_edit_date": 1542180812, "question_id": 53277105, "link": "https://stackoverflow.com/questions/53277105/generate-uniformly-random-float-which-can-return-all-possible-values", "title": "Generate uniformly random float which can return all possible values", "body": "<p>An easy way to generate a random float64 in [0,1) is by generating a uniformly random int in [0,2\u2075\u00b3) and dividing it by 2\u2075\u00b3. This is essentially what <a href=\"https://golang.org/src/math/rand/rand.go?s=5359:5391#L168\" rel=\"nofollow noreferrer\"><code>rand.Float64()</code></a> is doing.\nHowever, not all possible float64 values between 0 and 1 can be generated this way: if the value is lower than 2\u207b\u2074 for example, the 4 last bits of the significand are always going to be 0. Or, put more simply, the naive method always returns multiples of 2\u207b\u2075\u00b3, and not all floating point numbers between 0 and 1 are multiples of 2\u207b\u2075\u00b3. </p>\n\n<p>How do you generate a uniformly random float64 such as every possible value has a chance of being returned? (Here, uniformly random means over the <em>real interval</em> [0,1): conceptually, I want to pick a uniformly random real number between 0 and 1 and return the closest float.)</p>\n\n<p>For context, I need this because I'm implementing <a href=\"https://crysp.uwaterloo.ca/courses/pet/F18/cache/Mironov.pdf\" rel=\"nofollow noreferrer\">this paper</a> and the assumption \"all possible values between 0 and 1 are represented\" is essential for the result to hold.</p>\n"}, {"tags": ["go", "floating-point", "binary"], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "edited": false, "score": 0, "creation_date": 1542117420, "post_id": 53280459, "comment_id": 93446842, "body": "Would <code>Math.Ldexp</code> help here?  <code>func Ldexp(frac float64, exp int) float64</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "edited": false, "score": 0, "creation_date": 1542117531, "post_id": 53280459, "comment_id": 93446918, "body": "@aMike I was considering it, but it takes the fraction as a <code>float64</code> value, and it does something similar under the hood."}, {"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1542120884, "post_id": 53280459, "comment_id": 93449039, "body": "I see, so if I want the actual exponent to be <code>exp</code>, I have to do <code>bits := (exp+1023)&lt;&lt;52 | sig</code>, correct?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1542121104, "last_edit_date": 1542121104, "creation_date": 1542109913, "answer_id": 53280459, "question_id": 53276811, "link": "https://stackoverflow.com/questions/53276811/create-float-from-exponent-and-significand/53280459#53280459", "title": "Create float from exponent and significand", "body": "<p>The <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE-754 standard</a> defines the floating point arithmetics which Go uses for floating point numbers such as <code>float32</code> and <code>float64</code> (just like almost any other language).</p>\n\n<p>Since your significand may be up to 52 bits, obviously it can only be represented using a <code>float64</code> value.</p>\n\n<p>The memory layout (bits) of a <code>float64</code> value is described in <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\">Double-precision floating-point format</a>.</p>\n\n<p>Here's a picture of the bits of a <code>float64</code> value (taken from Wikipedia):</p>\n\n<p><a href=\"https://i.stack.imgur.com/K6Izx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/K6Izx.png\" alt=\"enter image description here\"></a></p>\n\n<p>You claim you have the exponent value and the significand (which is the fraction part).</p>\n\n<p>You may use simple bitwise arithmetic to construct the 64-bit value of the floating point like this:</p>\n\n<pre><code>bits := exp&lt;&lt;52 | sig\n</code></pre>\n\n<p>(Note: <code>exp</code> and <code>sig</code> should be of type <code>uint64</code>. If not, use a type conversion.)</p>\n\n<p>Once you have the bits, you may use the <a href=\"https://golang.org/pkg/math/#Float64frombits\" rel=\"nofollow noreferrer\"><code>math.Float64frombits()</code></a> function to get it as a <code>float64</code> value:</p>\n\n<pre><code>f := math.Float64frombits(bits)\n</code></pre>\n\n<p>Note that the exponent value of the memory layout is not the \"direct\" number you have to use when calculating the value of the number, but:</p>\n\n<blockquote>\n  <p>The double-precision binary floating-point exponent is encoded using an <a href=\"https://en.wikipedia.org/wiki/Offset-binary\" rel=\"nofollow noreferrer\">offset-binary</a> representation, with the zero offset being 1023; also known as exponent bias in the IEEE 754 standard.</p>\n</blockquote>\n\n<p>So the number encoded in the above double-precision format is calculated like:</p>\n\n<blockquote>\n  <p>(-1)<sup>sign</sup> x 2<sup>e-1023</sup> x 1.fraction</p>\n</blockquote>\n"}], "owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 53280459, "answer_count": 1, "score": 1, "last_activity_date": 1542121104, "creation_date": 1542097939, "question_id": 53276811, "link": "https://stackoverflow.com/questions/53276811/create-float-from-exponent-and-significand", "title": "Create float from exponent and significand", "body": "<p>Given integers <code>exp</code> and <code>0&lt;=sig&lt;2^52</code>, how can I create the float64 with <code>exp</code> as exponent and whose significand bits are the same as the binary representation of <code>sig</code> (in Go)?</p>\n"}, {"tags": ["ssl", "go", "tls1.2"], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 1, "last_activity_date": 1542100157, "creation_date": 1542100157, "answer_id": 53277405, "question_id": 53276769, "link": "https://stackoverflow.com/questions/53276769/understanding-on-mutual-tls-client-config-with-servername/53277405#53277405", "title": "Understanding on Mutual TLS , client config with servername", "body": "<p>Since <strong>x509: certificate is valid for svc.example.test.cloud</strong>, so <code>transport.TLSClientConfig.ServerName = \"svc.example.test.cloud\"</code></p>\n\n<p>From <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/tls/#Config</a></p>\n\n<blockquote>\n  <p>VerifyPeerCertificate, if not nil, is called after normal<br>\n   certificate verification by either a TLS client or server. It<br>\n   receives the raw ASN.1 certificates provided by the peer and also<br>\n   any verified chains that normal processing found. If it returns a<br>\n   non-nil error, the handshake is aborted and that error results.  </p>\n  \n  <p>If normal verification fails then the handshake will abort before<br>\n   considering this callback. If normal verification is disabled by<br>\n   setting InsecureSkipVerify, or (for a server) when ClientAuth is<br>\n   RequestClientCert or RequireAnyClientCert, then this callback will<br>\n   be considered but the verifiedChains argument will always be nil.    </p>\n</blockquote>\n\n<p><strong>VerifyPeerCertificate func(rawCerts [][]byte, verifiedChains [][]*x509.Certificate) error</strong></p>\n\n<p>So if normal verification fails, then <code>VerifyPeerCertificate</code> won't get called. Also if normal verification is passed, i don't think you need this extra check <code>VerifyPeerCertificate</code>.</p>\n"}], "owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 824, "favorite_count": 0, "accepted_answer_id": 53277405, "answer_count": 1, "score": 0, "last_activity_date": 1542100157, "creation_date": 1542097785, "question_id": 53276769, "link": "https://stackoverflow.com/questions/53276769/understanding-on-mutual-tls-client-config-with-servername", "title": "Understanding on Mutual TLS , client config with servername", "body": "<p>I am trying to understand the mutual TLS working, I have the following example:</p>\n\n<blockquote>\n  <p>I have a client who wants to connect to server  \"svc1.example.com\"</p>\n</blockquote>\n\n<p>but the server has a </p>\n\n<blockquote>\n  <p>server certificate with a commonName as \"svc1.example.cloud\" and a SAN\n  as \"svc.example.test.cloud\".</p>\n</blockquote>\n\n<p>Now when I make a GET request, I get the following:</p>\n\n<p><strong><em>x509: certificate is valid for svc.example.test.cloud, not svc1.example.com.</em></strong></p>\n\n<p>So, my question is should I make a the TLS clientConfig changes to include the servername? or should I add a custom verifyPeerCertificate function in the TLS client config, something like below?</p>\n\n<p><strong>Please, let me know, what should be the Servername and what should I check for in the verifyPeerCertificate function.</strong></p>\n\n<pre><code>func customverify(customCName func(*x509.Certificate) bool) func(rawCerts [][]byte, verifiedChains [][]*x509.Certificate) error {\n    if customCName == nil {\n        return nil\n    }\n    return func(_ [][]byte, verifiedChains [][]*x509.Certificate) error {\n        for _, certs := range verifiedChains {\n            leaf := certs[0]\n            if customCName(leaf) {\n                return nil\n            }\n        }\n        return fmt.Errorf(\"client identity verification failed\")\n    }\n}\n\n\n\n\nfunc configureClient(certFile, keyFile string) (*http.Client, error) {\n    certpool, err := addRootCA()\n    if err != nil {\n        return nil, err\n    }\n\ncert, err := tls.LoadX509KeyPair(certFile, keyFile)\nif err != nil {\n    return nil, err\n}\ntransport := ytls.NewClientTransport()\ntransport.TLSClientConfig.Certificates = []tls.Certificate{cert}\ntransport.TLSClientConfig.RootCAs = certpool\n//transport.TLSClientConfig.ServerName = expectedCName\ntransport.TLSClientConfig.VerifyPeerCertificate = customverify(func(cert *x509.Certificate) bool {\n    return cert.Subject.CommonName == \"svc1.example.cloud\"\n})\n\nhttpClient := &amp;http.Client{Transport: transport}\nreturn httpClient, nil\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "swagger", "protocol-buffers", "grpc-gateway"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 1599436, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4281ff3cefc0b6ac70a86d7080c51a4e?s=128&d=identicon&r=PG", "display_name": "pinkstone", "link": "https://stackoverflow.com/users/1599436/pinkstone"}, "edited": false, "score": 0, "creation_date": 1542666729, "post_id": 53307589, "comment_id": 93643154, "body": "Hey @DougFawley, you are right, that seems to be the way it is. Code in protoc-gen-swagger literally checks for &quot;google.protobuf.Timestamp&quot; type and builds a string. It&#39;s great to have a consistent rfc3339-type string, but from the code efficiency point of view, it&#39;s a conversion of a string back and forth from secs/nanosecs format. But again, what am I talking about when discussing REST and json payload anyways - everything is a string! our sdk on the other side is C++, so the conversion back is not as straightforward, so I ended up defining my own &quot;Timestamp&quot; message and that helped."}], "tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": true, "score": 1, "last_activity_date": 1542224141, "creation_date": 1542224141, "answer_id": 53307589, "question_id": 53276555, "link": "https://stackoverflow.com/questions/53276555/grpc-and-swagger-annotation-differences/53307589#53307589", "title": "gRPC and Swagger annotation differences", "body": "<p>I am not that familiar with protoc-gen-swagger itself, but I believe this is happening because of the json-proto format defined here:</p>\n\n<p><a href=\"https://developers.google.com/protocol-buffers/docs/proto3#json\" rel=\"nofollow noreferrer\">https://developers.google.com/protocol-buffers/docs/proto3#json</a></p>\n\n<p>It's done this way to make it more \"natural\" for JSON-based APIs. \nI don't know of any way to avoid this except by using your own type to hold the timestamp instead of <code>google.protobuf.Timestamp</code>.  However, JSON conversion is expected to work correctly in both directions, so when the JSON is converted back to a proto message by the library, it should not cause any problems.</p>\n"}], "owner": {"reputation": 91, "user_id": 1599436, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4281ff3cefc0b6ac70a86d7080c51a4e?s=128&d=identicon&r=PG", "display_name": "pinkstone", "link": "https://stackoverflow.com/users/1599436/pinkstone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 0, "accepted_answer_id": 53307589, "answer_count": 1, "score": 1, "last_activity_date": 1542224141, "creation_date": 1542096892, "last_edit_date": 1542099372, "question_id": 53276555, "link": "https://stackoverflow.com/questions/53276555/grpc-and-swagger-annotation-differences", "title": "gRPC and Swagger annotation differences", "body": "<p>I have a protocol buffer definition, which includes <code>google.protobuf.Timestamp</code> as part of a message. The Timestamp message is pretty simple and has the following definition:</p>\n\n<pre class=\"lang-proto prettyprint-override\"><code>message Timestamp {\n  int64 seconds = 1;\n  int32 nanos = 2;\n}\n</code></pre>\n\n<p>So the gRPC payload comes out as a simple tuple of values as expected. However I also wanted to generate some swagger annotations for REST API for the same message, but it seems to convert the Timestamp into an RFC 3339 style string:</p>\n\n<pre class=\"lang-json prettyprint-override\"><code>\"timestamp\": {\n  \"type\": \"string\",\n  \"format\": \"date-time\",\n  \"title\": \"timestamp\"\n}\n</code></pre>\n\n<p>I recently started working with protocol buffers and gRPC, so I am not sure if I am missing something here, but it seems to be an inconsistency with grpc-gateway implementation. Why would REST be a different format than the gRPC payload? Or am I missing some way to tell protoc-gen-swagger not to convert the message into a string? </p>\n"}, {"tags": ["go", "jwt", "go-gin"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542094650, "post_id": 53275636, "comment_id": 93434134, "body": "What is your question? If a token has expired - it only means that it has expired, the expiration time is in the past."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542097505, "post_id": 53275636, "comment_id": 93435401, "body": "@zerkms I have set the expiration time to 1 year. The point is it expires when I re-install my go app, which is wrong because neither expiration time is in the past nor the user logged out."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542101161, "post_id": 53275636, "comment_id": 93437414, "body": "&quot;The point is it expires&quot; --- if you set expiration time of a JWT token to one year then it would expire in one year. Otherwise please define what you mean &quot;it expires&quot;."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1542104326, "post_id": 53275636, "comment_id": 93439386, "body": "Actually it is not expired but it is not validated after installing the app."}, {"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 0, "creation_date": 1542104634, "post_id": 53275636, "comment_id": 93439554, "body": "What does &quot;not validated&quot; mean? Which error do you get, which line of code is or is not executed?"}, {"owner": {"reputation": 4798, "user_id": 6503654, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f792c5e792abca7970df2dd0b75a562c?s=128&d=identicon&r=PG&f=1", "display_name": "TommyF", "link": "https://stackoverflow.com/users/6503654/tommyf"}, "edited": false, "score": 0, "creation_date": 1542104747, "post_id": 53275636, "comment_id": 93439605, "body": "<code>_, err := merchantDb.GetSession(bson.M{&quot;token&quot;: bearerToken})</code> is this causing the error? Is your <code>merchantDb.GetSession</code> persistent?"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 240, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1597430966, "creation_date": 1542093003, "last_edit_date": 1597430966, "question_id": 53275636, "link": "https://stackoverflow.com/questions/53275636/jwt-token-expired-when-go-app-is-installed", "title": "JWT token expired when Go app is installed", "body": "<p>I am working on a SAAS based product. I am using JWT method to authenticate the logged in users in the system. The product is developed on Go on the backend with gin framework for routing.</p>\n\n<p><strong>Problem</strong></p>\n\n<p>When a user log in then its JWT token is generated and works well. Now the user did not logged out but closed the browser tab or window. Before he is back, the go app is re-installed with install command. Now the user come back and access his account, the token is expired and he could not see any of his details.</p>\n\n<p>Following is the code to generate token while login:</p>\n\n<pre><code>func CreateToken(user models.User, c *gin.Context) (string, error){\nvar ip, userAgent string\nkeyError := InitKeys()\nif keyError != nil{\n    return \"\", keyError\n}\n\nif values, _ := c.Request.Header[\"Ip\"]; len(values) &gt; 0 {\n    ip = values[0]\n}\n\nif values, _ := c.Request.Header[\"User-Agent\"]; len(values) &gt; 0{\n    userAgent = values[0]\n}\n\ntoken := jwt.NewWithClaims(jwt.SigningMethodHS256, &amp;jwt.MapClaims{\n    \"email\": user.EmailId,\n    \"exp\": time.Now().Add(time.Hour * 8760).Unix(),\n    \"role\": user.Role,\n    \"name\": user.FirstName+\" \"+user.LastName,\n    \"ip\": ip,\n    \"user_agent\": userAgent,\n    \"id\": user.Id,\n})\nconfig.CurrentUserId    = user.Id\nmodels.CurrentUser      = user\n\n/* Sign and get the complete encoded token as a string */\ntokenString, err := token.SignedString([]byte(config.SignKey))\nreturn tokenString, err\n</code></pre>\n\n<p>}</p>\n\n<pre><code>func InitKeys()(err error){\n    SignKey, err = ioutil.ReadFile(GetBasePath()+PrivateKeyPath)\n    if err != nil {\n        return err\n    }\n    VerifyKey, err = ioutil.ReadFile(GetBasePath()+PublicKeyPath)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now to decode and match the token following function is used:</p>\n\n<pre><code>func ParseJWTToken(c *gin.Context){\nmerchantDb  := models.MerchantDatabase{ c.Keys[\"merchant_db\"].(string) }\nmerchantDatabase := make(map[string]interface{})\nif values, _ := c.Request.Header[\"Authorization\"]; len(values) &gt; 0 {\n    bearer := strings.Split(c.Request.Header[\"Authorization\"][0], \"Bearer\")\n    bearerToken := strings.TrimSpace(bearer[1])\n    _, err := merchantDb.GetSession(bson.M{\"token\": bearerToken})\n    if err != nil{\n        errMsg := \"Failed: Unauthorized Access.\"\n        response := controllers.ResponseController{\n            config.FailureCode,\n            config.FailureFlag,\n            errMsg,\n            err,\n        }\n        controllers.GetResponse(c, response)\n        c.Abort()\n    }else{\n\n        var userAgent string\n        var userAgentCheck bool\n\n        if values, _ := c.Request.Header[\"User-Agent\"]; len(values) &gt; 0 {\n            userAgent = values[0]\n        }\n        _ = config.InitKeys()\n        token, err := jwt.Parse(bearerToken, func(token *jwt.Token) (interface{}, error) {\n            return config.SignKey, nil\n        })\n        if len (token.Claims.(jwt.MapClaims)) &gt; 0{\n            for key, claim := range token.Claims.(jwt.MapClaims) {\n                if key == \"user_agent\"{\n                    if claim == userAgent{\n                        userAgentCheck = true\n                    }\n                }   \n\n                if key == \"role\"{\n                    role = claim.(string)\n                }\n\n                if key == \"id\"{\n                    userId = claim.(float64)\n                }\n                if key == \"name\"{\n                    userName = claim.(string)\n                }\n            }\n        }\n        merchantDatabase[\"userid\"] = userId\n        merchantDatabase[\"role\"] = role\n        merchantDatabase[\"username\"] = userName\n        c.Keys = merchantDatabase\n        if err == nil &amp;&amp; token.Valid &amp;&amp; userAgentCheck == true {\n            c.Next()\n        } else {\n            errMsg := \"Failed: Invalid Token.\"\n            response := controllers.ResponseController{\n                config.FailureCode,\n                config.FailureFlag,\n                errMsg,\n                nil,\n            }\n            controllers.GetResponse(c, response)\n            c.Abort()\n        }\n    }\n}else{\n    errMsg := \"Failed: Unauthorized Access.\"\n    response := controllers.ResponseController{\n        config.FailureCode,\n        config.FailureFlag,\n        errMsg,\n        \"Missing Authorization Header\",\n    }\n    controllers.GetResponse(c, response)\n    c.Abort()\n}   \n</code></pre>\n\n<p>}</p>\n\n<p>I am not able to detect what I am missing. Please look into the code and guide me what should I do in this case.</p>\n"}, {"tags": ["go", "vim", "vim-plugin"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1542093473, "post_id": 53275602, "comment_id": 93433586, "body": "Unless you ran sudo with the -E option, the GOPATH environment variable was not passed to the executed command.  You can try using the sudo -E flag to fix the problem, but it&#39;s probably better to not use sudo at all."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1542121591, "post_id": 53275602, "comment_id": 93449520, "body": "Is your GOPATH env variable exported ? Can you run <code>env | grep GOPATH</code> to verify if it shows any output ? Does the <code>:GoPath</code> command within vim show what you expect ?"}, {"owner": {"reputation": 61, "user_id": 7209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02ffc42f044fa1e945bd9bdab4714289?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/7209003/fred"}, "edited": false, "score": 0, "creation_date": 1542160633, "post_id": 53275602, "comment_id": 93465662, "body": "I can print value of GOPATH by <code>:GoPath</code> in vim."}, {"owner": {"reputation": 61, "user_id": 7209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02ffc42f044fa1e945bd9bdab4714289?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/7209003/fred"}, "edited": false, "score": 0, "creation_date": 1542161077, "post_id": 53275602, "comment_id": 93465750, "body": "I know the way how to pass $GOPATH from myuser to root. <code>sudo env &quot;PATH=$PATH&quot; go get -u github.com&#47;derekparker&#47;delve&#47;cmd&#47;dlv</code>, and problem is not the root can not get gopath, is myuser have no permisson access some system folder and Seemingly I can not use sudo in vim command line. iIt&#39;s not convenient to use sudo in some situation but always has no choice."}], "answers": [{"comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1542121368, "post_id": 53283768, "comment_id": 93449388, "body": "This is the sledgehammer approach. Don&#39;t do it, normal users shouldn&#39;t own stuff in that location."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1542123194, "post_id": 53283768, "comment_id": 93450640, "body": "Actually, it&#39;s /usr/local, it&#39;s my laptop, I am the normal user why would I need root privs?  root means the owner of / not /usr/local.  Sorry @nos I can&#39;t agree"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1542123317, "post_id": 53283768, "comment_id": 93450707, "body": "The root user is  normally the default owner of / , /usr/ /usr/local /etc. and other places in the filesystem hierarchy. Once you start messing with the default ownerships within these standard directories, you&#39; can easily create a mess."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1570441275, "post_id": 53283768, "comment_id": 102901337, "body": "/usr/local is traditionally controlled by the local machine and so it&#39;s fine to change the permissions to whatever you want.  The bad assumption is to assume that /usr/local will have perms and layout that matches some kind of &quot;standard&quot; because there is none.  If you want to do it &quot;properly&quot; then make the software into a package, put it through acceptance and add it to your system with all the correct paths.  For stuff in /usr/local that is under development IT DOESNT MATTER."}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": -2, "last_activity_date": 1542121042, "creation_date": 1542121042, "answer_id": 53283768, "question_id": 53275602, "link": "https://stackoverflow.com/questions/53275602/vim-go-can-not-find-correct-gopath/53283768#53283768", "title": "vim-go can not find correct GOPATH", "body": "<pre><code>sudo chown $LOGNAME /usr/local/go/bin\n</code></pre>\n\n<p>And try again</p>\n\n<p>That will fix the permissions</p>\n"}, {"tags": [], "owner": {"reputation": 2051, "user_id": 474002, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Oqy8c.jpg?s=128&g=1", "display_name": "Browny Lin", "link": "https://stackoverflow.com/users/474002/browny-lin"}, "is_accepted": true, "score": 1, "last_activity_date": 1542322450, "creation_date": 1542322450, "answer_id": 53329016, "question_id": 53275602, "link": "https://stackoverflow.com/questions/53275602/vim-go-can-not-find-correct-gopath/53329016#53329016", "title": "vim-go can not find correct GOPATH", "body": "<p>I met the same problem.</p>\n\n<p>I set the <code>go_bin_path</code> as below in ~./vimrc to fix this</p>\n\n<p><code>let g:go_bin_path = $HOME.\"/go/bin\"</code></p>\n"}], "owner": {"reputation": 61, "user_id": 7209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02ffc42f044fa1e945bd9bdab4714289?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/7209003/fred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2350, "favorite_count": 0, "accepted_answer_id": 53329016, "answer_count": 2, "score": 1, "last_activity_date": 1542322450, "creation_date": 1542092852, "question_id": 53275602, "link": "https://stackoverflow.com/questions/53275602/vim-go-can-not-find-correct-gopath", "title": "vim-go can not find correct GOPATH", "body": "<p>When I install vim-go under sudo user in Vim</p>\n\n<pre><code>:GoInstallBinaries\n</code></pre>\n\n<p>It report errors:</p>\n\n<pre><code>vim-go: gogetdoc not found. Installing github.com/zmb3/gogetdoc to folder /usr/local/go/bin\nError installing github.com/zmb3/gogetdoc: go build github.com/zmb3/gogetdoc: open /usr/local/go/bin/gogetdoc: permission denied^@\nvim-go: guru not found. Installing golang.org/x/tools/cmd/guru to folder /usr/local/go/bin\nError installing golang.org/x/tools/cmd/guru: go build golang.org/x/tools/cmd/guru: open /usr/local/go/bin/guru: permission denied^@\nvim-go: golint not found. Installing golang.org/x/lint/golint to folder /usr/local/go/bin\nError installing golang.org/x/lint/golint: go build golang.org/x/lint/golint: open /usr/local/go/bin/golint: permission denied^@\nvim-go: fillstruct not found. Installing github.com/davidrjenni/reftools/cmd/fillstruct to folder /usr/local/go/bin\nError installing github.com/davidrjenni/reftools/cmd/fillstruct: go build github.com/davidrjenni/reftools/cmd/fillstruct: open /usr/local/go/bin/fillstruct: permission d\nenied^@\nvim-go: godef not found. Installing github.com/rogpeppe/godef to folder /usr/local/go/bin\nError installing github.com/rogpeppe/godef: go build github.com/rogpeppe/godef: open /usr/local/go/bin/godef: permission denied^@\nvim-go: motion not found. Installing github.com/fatih/motion to folder /usr/local/go/bin\nError installing github.com/fatih/motion: go build github.com/fatih/motion: open /usr/local/go/bin/motion: permission denied^@\nvim-go: errcheck not found. Installing github.com/kisielk/errcheck to folder /usr/local/go/bin\nError installing github.com/kisielk/errcheck: go build github.com/kisielk/errcheck: open /usr/local/go/bin/errcheck: permission denied^@\nvim-go: dlv not found. Installing github.com/derekparker/delve/cmd/dlv to folder /usr/local/go/bin\nError downloading github.com/derekparker/delve/cmd/dlv: github.com/derekparker/delve (download)^@# cd /home/fred/go/src/github.com/derekparker/delve; git pull --ff-only^\n@error: cannot open .git/FETCH_HEAD: Permission denied^@^@package github.com/derekparker/delve/cmd/dlv: exit status 1^@\nError installing github.com/derekparker/delve/cmd/dlv: go build github.com/derekparker/delve/cmd/dlv: open /usr/local/go/bin/dlv: permission denied^@\nvim-go: gocode not found. Installing github.com/mdempsky/gocode to folder /usr/local/go/bin\nError installing github.com/mdempsky/gocode: go build github.com/mdempsky/gocode: open /usr/local/go/bin/gocode: permission denied^@\nvim-go: impl not found. Installing github.com/josharian/impl to folder /usr/local/go/bin\nError installing github.com/josharian/impl: go build github.com/josharian/impl: open /usr/local/go/bin/impl: permission denied^@\nvim-go: iferr not found. Installing github.com/koron/iferr to folder /usr/local/go/bin\nError installing github.com/koron/iferr: go build github.com/koron/iferr: open /usr/local/go/bin/iferr: permission denied^@\nvim-go: gotags not found. Installing github.com/jstemmer/gotags to folder /usr/local/go/bin\nError installing github.com/jstemmer/gotags: go build github.com/jstemmer/gotags: open /usr/local/go/bin/gotags: permission denied^@\nvim-go: gorename not found. Installing golang.org/x/tools/cmd/gorename to folder /usr/local/go/bin\nError installing golang.org/x/tools/cmd/gorename: go build golang.org/x/tools/cmd/gorename: open /usr/local/go/bin/gorename: permission denied^@\nvim-go: goimports not found. Installing golang.org/x/tools/cmd/goimports to folder /usr/local/go/bin\nError installing golang.org/x/tools/cmd/goimports: go build golang.org/x/tools/cmd/goimports: open /usr/local/go/bin/goimports: permission denied^@\nvim-go: gocode-gomod not found. Installing github.com/stamblerre/gocode to folder /usr/local/go/bin\nError installing github.com/stamblerre/gocode: go build github.com/stamblerre/gocode: open /usr/local/go/bin/gocode-gomod: permission denied^@\nvim-go: gomodifytags not found. Installing github.com/fatih/gomodifytags to folder /usr/local/go/bin\nError installing github.com/fatih/gomodifytags: go build github.com/fatih/gomodifytags: open /usr/local/go/bin/gomodifytags: permission denied^@\nvim-go: keyify not found. Installing honnef.co/go/tools/cmd/keyify to folder /usr/local/go/bin\nError installing honnef.co/go/tools/cmd/keyify: go build honnef.co/go/tools/cmd/keyify: open /usr/local/go/bin/keyify: permission denied^@\nvim-go: asmfmt not found. Installing github.com/klauspost/asmfmt/cmd/asmfmt to folder /usr/local/go/bin\nError installing github.com/klauspost/asmfmt/cmd/asmfmt: go build github.com/klauspost/asmfmt/cmd/asmfmt: open /usr/local/go/bin/asmfmt: permission denied^@\nvim-go: gometalinter not found. Installing github.com/alecthomas/gometalinter to folder /usr/local/go/bin\nError installing github.com/alecthomas/gometalinter: go build github.com/alecthomas/gometalinter: open /usr/local/go/bin/gometalinter: permission denied^@\nvim-go: installing finished!\n</code></pre>\n\n<p>and $GOPATH is:</p>\n\n<pre><code>/home/fred/go:/home/fred/folder1:/home/fred/folder2\n</code></pre>\n\n<p>Why vim-go install binaries to </p>\n\n<blockquote>\n  <p>/usr/local/go/bin<br>\n  # sudo user permisson denied.</p>\n</blockquote>\n\n<p>not the first path in $GOPATH:</p>\n\n<blockquote>\n  <p>/home/fred/go</p>\n</blockquote>\n"}, {"tags": ["go", "blockchain", "xdr", "stellar"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1542097700, "post_id": 53275299, "comment_id": 93435506, "body": "&quot;not working&quot; isn&#39;t a helpful problem description. Be specific."}, {"owner": {"reputation": 39, "user_id": 9515080, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxYyK.jpg?s=128&g=1", "display_name": "Thanan_Jaje", "link": "https://stackoverflow.com/users/9515080/thanan-jaje"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542258275, "post_id": 53275299, "comment_id": 93505875, "body": "I am using <code>SafeUnmarshalBase64</code> to unmarshal the XDR which is in base 64 format and it gives an byte stream output shown above as <code>&#47;&#47;Output</code>. But what i actually want is something (set of operations performed under that public key) which is readable like <code>&#47;&#47;Expected Output</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542274647, "post_id": 53275299, "comment_id": 93512934, "body": "It seems that you can decode the transaction just fine, but your expectation makes no sense. <a href=\"https://godoc.org/github.com/stellar/go/xdr#Transaction\" rel=\"nofollow noreferrer\">xdr.Transaction</a> has none of the fields shown in the expected output. Also Println produces <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">the standard format</a> for structs and that&#39;s not something resembling JavaScript."}], "owner": {"reputation": 39, "user_id": 9515080, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxYyK.jpg?s=128&g=1", "display_name": "Thanan_Jaje", "link": "https://stackoverflow.com/users/9515080/thanan-jaje"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1542258753, "creation_date": 1542091666, "last_edit_date": 1542258753, "question_id": 53275299, "link": "https://stackoverflow.com/questions/53275299/how-to-decode-stellar-xdr", "title": "How to decode stellar XDR", "body": "<p>I am working on stellar blockchain and need to decode stellar XDR which is in GO language. I know how to decode using JavaScript but couldn't find a way to do it in GO.   </p>\n\n<pre><code> //JS code\n\n const {Transaction} = require('stellar-base')\n\n const parsedTx = new Transaction('tx_envelope_encoded_as_XDR')\n console.log(parsedTx)\n</code></pre>\n\n<p>This works fine. what i have tried and not working...</p>\n\n<pre><code>//GO code\n\nimport (\n\n   \"bytes\"\n   \"encoding/json\"\n   \"fmt\"\n   \"net/http\"\n   \"github.com/stellar/go/xdr\"\n   \"github.com/gorilla/mux\"\n\n )\n\nfunc DecodeXDR(w http.ResponseWriter, r *http.Request) {\n\n    var OBJ model.TransactionCollectionBody\n    err := json.NewDecoder(r.Body).Decode(&amp;OBJ)\n    if err != nil {\n      w.WriteHeader(http.StatusBadRequest)\n      json.NewEncoder(w).Encode(\"Error while Decoding the body\")\n      fmt.Println(err)\n\n      return\n    }\n\n    // fmt.Println(OBJ)\n\n    // lol:=xdr.Value(OBJ.XDR)\n\n    var txe xdr.Transaction\n    err = xdr.SafeUnmarshalBase64(XDRB64, &amp;txe)\n    if err != nil {\n      fmt.Println(err)\n    }\n\n    fmt.Println(txe)\n\n}\n\n//Output\n{{PublicKeyTypePublicKeyTypeEd25519 0xc042055d20} 200 2800572080062465 &lt;nil&gt; {MemoTypeMemoNone &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt;} [{&lt;nil&gt; {OperationTypeManageData &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc042174040 &lt;nil&gt;}} {&lt;nil&gt; {OperationTypeManageData &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc042174080 &lt;nil&gt;}}] {0}}\n</code></pre>\n\n<p><strong>//Expected Output</strong></p>\n\n<p><strong>{ type: 'payment',\ndestination: 'GCKUXI3JRJANYOF3AM35Z22FGUGYYUIEBPE5TTZ7P3G6XAEFGYZC2POM',\n  asset:\n   Asset {\n     code: 'Blog',\n     issuer: 'GDOPTRADBVWJR6BMB6H5ACQTAVUS6XMT53CDNAJZLOSTIUICIW57ISMF' },\n  amount: '10' }</strong></p>\n\n<p><strong>{ type: 'payment',\n  destination: 'GCKUXI3JRJANYOF3AM35Z22FGUGYYUIEBPE5TTZ7P3G6XAEFGYZC2POM',\n  asset:\n   Asset {\n     code: 'Blog',\n     issuer: 'GDOPTRADBVWJR6BMB6H5ACQTAVUS6XMT53CDNAJZLOSTIUICIW57ISMF' },\n  amount: '10' }</strong></p>\n\n<p><strong>{ type: 'payment',\n  destination: 'GCKUXI3JRJANYOF3AM35Z22FGUGYYUIEBPE5TTZ7P3G6XAEFGYZC2POM',\n  asset:\n   Asset {\n     code: 'Blog',\n     issuer: 'GDOPTRADBVWJR6BMB6H5ACQTAVUS6XMT53CDNAJZLOSTIUICIW57ISMF' },\n  amount: '10' }</strong></p>\n\n<p>Can anyone help me to solve this?</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings"], "comments": [{"owner": {"reputation": 1248, "user_id": 2178599, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/lwyJC.jpg?s=128&g=1", "display_name": "23k", "link": "https://stackoverflow.com/users/2178599/23k"}, "edited": false, "score": 0, "creation_date": 1542081438, "post_id": 53273523, "comment_id": 93429977, "body": "<a href=\"https://github.com/Microsoft/vscode-go/wiki/GOPATH-in-the-VS-Code-Go-extension\" rel=\"nofollow noreferrer\">github.com/Microsoft/vscode-go/wiki/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 606880, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/f0039481cbb27fea7ef2a47764e5335f?s=128&d=identicon&r=PG", "display_name": "viggy", "link": "https://stackoverflow.com/users/606880/viggy"}, "is_accepted": true, "score": 0, "last_activity_date": 1542087272, "creation_date": 1542087272, "answer_id": 53274446, "question_id": 53273523, "link": "https://stackoverflow.com/questions/53273523/vscode-go-extension-debugs-example-c-c-file-instead-of-actual-file/53274446#53274446", "title": "VsCode Go extension debugs Example_c.c file instead of actual file", "body": "<p>Your GOPATH should point to \"C:\\Scripts\". Then point the \"program\" variable in launch.json to \"C:\\Scripts\" to run it in Debug Mode.</p>\n"}], "owner": {"reputation": 1342, "user_id": 869097, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e8d491b25ac2c7de99e85ed57bfabd7?s=128&d=identicon&r=PG", "display_name": "user869097", "link": "https://stackoverflow.com/users/869097/user869097"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 53274446, "answer_count": 1, "score": 0, "last_activity_date": 1542137943, "creation_date": 1542081119, "last_edit_date": 1542137943, "question_id": 53273523, "link": "https://stackoverflow.com/questions/53273523/vscode-go-extension-debugs-example-c-c-file-instead-of-actual-file", "title": "VsCode Go extension debugs Example_c.c file instead of actual file", "body": "<p>I just tried to execute a Hello World from VSCode 1.28.2 (Windows 8.1) in a C:\\Scripts\\hello_world.go file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, Gopher!\")\n}\n</code></pre>\n\n<p>My environment is as follows:</p>\n\n<ul>\n<li>I installed Go from scratch using the Windows installer:</li>\n</ul>\n\n<blockquote>\n<pre><code>$ go version\ngo version go1.11.2 windows/amd64\n</code></pre>\n</blockquote>\n\n<ul>\n<li>Installed on C:\\Go</li>\n<li>Installed VSCode Go Extension: <a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode.Go\" rel=\"nofollow noreferrer\">https://marketplace.visualstudio.com/items?itemName=ms-vscode.Go</a></li>\n<li>Installed debugger: </li>\n</ul>\n\n<blockquote>\n  <p>go get -u github.com/derekparker/delve/cmd/dlv</p>\n</blockquote>\n\n<ul>\n<li>Checked with SystemPropertiesAdvanced:\n\n<ul>\n<li>Local Variable GOPATH = %USERPROFILE%\\go</li>\n<li>Local Variable PATH adds %USERPROFILE%\\go\\bin</li>\n<li>System Variable PATH adds C:\\Go\\bin</li>\n<li>System Variable GOROOT = C:\\Go\\</li>\n</ul></li>\n<li>I have MinGW64, GitBash and MinGW 1.0 (However I don't see how that could affect running Go from VSCode)</li>\n<li>Running from cmd.exe runs the program without problems at all:</li>\n</ul>\n\n<blockquote>\n<pre><code>C:\\Scripts&gt;go run hello_world.go\nHello, Gopher!\n</code></pre>\n</blockquote>\n\n<p>In VSCode settings my global go.gopath and go.goroot settings are:</p>\n\n<pre><code>  // Specify GOPATH here to override the one that is set as environment variable. The inferred GOPATH from workspace root overrides this, if go.inferGopath is set to true.\n  \"go.gopath\": null\n\n  // Specifies the GOROOT to use when no environment variable is set.\n  \"go.goroot\": null\n</code></pre>\n\n<p>So I customized the variables from VSCode as follows:</p>\n\n<pre><code>{\n    \"editor.renderControlCharacters\": false,\n    \"go.inferGopath\": true,\n    \"go.goroot\": \"C:\\\\go\",\n}\n</code></pre>\n\n<p>Now this is the weird part. When I hit Ctrl+F5 compilation takes a \"Example_c.c\" file (?) and reports errors with that file (which I never created or even knew that existed):</p>\n\n<pre><code># _/c_/Scripts\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_x003.o: In function `main':\n./Example_c.c:1: multiple definition of `main'\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_cgo_main.o:/tmp/go-build/_cgo_main.c:1: first defined here\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_x004.o: In function `main':\n./Test_C-01.c:3: multiple definition of `main'\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_cgo_main.o:/tmp/go-build/_cgo_main.c:1: first defined here\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_x005.o: In function `main':\n./Test_C-02.c:3: multiple definition of `main'\nC:\\Users\\Mike\\AppData\\Local\\Temp\\go-build530760830\\b001\\_cgo_main.o:/tmp/go-build/_cgo_main.c:1: first defined here\ncollect2: ld returned 1 exit status\n# _/c_/Scripts\nExample_c.c: In function 'main':\nExample_c.c:2:3: warning: incompatible implicit declaration of built-in function 'printf'\nExample_c.c:4:19: warning: incompatible implicit declaration of built-in function 'malloc'\nExample_c.c:9:3: warning: incompatible implicit declaration of built-in function 'free'\nexit status 2\nProcess exiting with code: 1\n</code></pre>\n\n<p>I already tried deleting all my temporary files and restarted VsCode multiple times. The whole experience to setup a Go environment to debug a hello world is really dissapointing. </p>\n\n<p>What else can I check? Any hints?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1542075824, "post_id": 53272804, "comment_id": 93428790, "body": "Don&#39;t post images. Post text."}], "answers": [{"comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 1, "creation_date": 1542079300, "post_id": 53273308, "comment_id": 93429540, "body": "Also, please edit your question to help other people who might answer this by putting text rather than images."}, {"owner": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "edited": false, "score": 0, "creation_date": 1542083183, "post_id": 53273308, "comment_id": 93430357, "body": "hi my xml is huge files xml , if code xml short is run with your way , but if  code is huge files xml, cannot run why ?"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "edited": false, "score": 1, "creation_date": 1542087830, "post_id": 53273308, "comment_id": 93431595, "body": "I cannot check this without a view of your input file."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1542107020, "post_id": 53273308, "comment_id": 93440904, "body": "I&#39;d add that when needed, it&#39;s possible to specify XML namespaces on field tags but the namespaces must be spelled in full and separated from the node name by a single space character."}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1542106975, "last_edit_date": 1542106975, "creation_date": 1542079226, "answer_id": 53273308, "question_id": 53272804, "link": "https://stackoverflow.com/questions/53272804/what-happen-my-code-cannot-display-result-after-parse-xml-in-go-lang/53273308#53273308", "title": "what happen, my code cannot display result after parse XML in Go Lang?", "body": "<p>When unmarshal-ing, remove the XML namespace (<code>xmlns</code>) prefixes. e.g.</p>\n\n<pre><code>type CustomerAndy struct {\n    XMLName      xml.Name      `xml:\"RelatedPartyList\"`\n    CustomerAndy []DataLengkap `xml:\"RelatedParty\"`\n}\n</code></pre>\n\n<p><code>xml.Unmarshal</code> already handles the namespaces.</p>\n"}], "owner": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 53273308, "answer_count": 1, "score": 0, "last_activity_date": 1542106975, "creation_date": 1542075347, "last_edit_date": 1542075765, "question_id": 53272804, "link": "https://stackoverflow.com/questions/53272804/what-happen-my-code-cannot-display-result-after-parse-xml-in-go-lang", "title": "what happen, my code cannot display result after parse XML in Go Lang?", "body": "<p>I have XML like this </p>\n\n<p><a href=\"https://i.stack.imgur.com/sQWPu.png\" rel=\"nofollow noreferrer\">here my code XML</a></p>\n\n<p>my description is correct or not  with my code below :</p>\n\n<pre><code>type CustomerAndy struct {\n    XMLName         xml.Name    `xml:\"b:RelatedPartyList\"`\n    CustomerAndy    []DataLengkap   `xml:\"b:RelatedParty\"`\n}\n\ntype DataLengkap struct {\n    XMLNAME   xml.Name `xml:\"b:RelatedParty\"`\n    FullName    string  `xml:\"b:FullName\"`\n    Ktp         string  `xml:\"b:IDNumber\"`\n    PefindoId   string  `xml:\"b:CreditinfoId\"`\n    Address     string  `xml:\"c:AddressLine\"`\n\n}\n</code></pre>\n\n<p>and this my full code go lang  to parse XML :</p>\n\n<p><a href=\"https://i.stack.imgur.com/s6F0l.png\" rel=\"nofollow noreferrer\">here my full code go lang</a></p>\n\n<p>why my code , I have change any way ,without looping, with looping, but not display result from parse XML , what wrong with my code ?                                                                                                                                      </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1309, "user_id": 7613702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oyAB4.png?s=128&g=1", "display_name": "pale bone", "link": "https://stackoverflow.com/users/7613702/pale-bone"}, "edited": false, "score": 0, "creation_date": 1542073581, "post_id": 53272536, "comment_id": 93428367, "body": "You just have a method like returnWith etc. that you use instead of using middleware"}, {"owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "reply_to_user": {"reputation": 1309, "user_id": 7613702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oyAB4.png?s=128&g=1", "display_name": "pale bone", "link": "https://stackoverflow.com/users/7613702/pale-bone"}, "edited": false, "score": 0, "creation_date": 1542074972, "post_id": 53272536, "comment_id": 93428625, "body": "so, it is can&#39;t get in golang middleware?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542075460, "post_id": 53272536, "comment_id": 93428718, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35528330/overriding-responsewriter-interface-to-catch-http-errors\" title=\"overriding responsewriter interface to catch http errors\">stackoverflow.com/questions/35528330/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/42162211/gorilla-mux-best-way-to-catch-response-codes\" title=\"gorilla mux best way to catch response codes\">stackoverflow.com/questions/42162211/&hellip;</a> and others."}, {"owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "edited": false, "score": 0, "creation_date": 1542076044, "post_id": 53272536, "comment_id": 93428847, "body": "I get, think you"}, {"owner": {"reputation": 1309, "user_id": 7613702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oyAB4.png?s=128&g=1", "display_name": "pale bone", "link": "https://stackoverflow.com/users/7613702/pale-bone"}, "edited": false, "score": 0, "creation_date": 1542076264, "post_id": 53272536, "comment_id": 93428890, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/42162211/gorilla-mux-best-way-to-catch-response-codes\">Gorilla mux, best way to &#39;catch&#39; response codes</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1542092718, "post_id": 53272536, "comment_id": 93433243, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35528330/overriding-responsewriter-interface-to-catch-http-errors\">Overriding ResponseWriter interface to catch HTTP errors</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542120636, "post_id": 53272925, "comment_id": 93448873, "body": "This method does have some issues though. It will break use of all the extra interfaces - Flusher, Pusher, CloseNotifier, and Hijacker."}, {"owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542211819, "post_id": 53272925, "comment_id": 93489576, "body": "Yes, do you have any suggestions?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542212126, "post_id": 53272925, "comment_id": 93489782, "body": "This is the easiest/simplest method, just should be noted it breaks all the other interfaces. If those are needed as is status code logging, there are other options, like writing a <code>func WriteHeader(w http.ResponseWriter, status int)</code> that will call <code>w.WriteHeader(status)</code> and do the logging. But that requires making sure none of your code calls <code>w.WriteHeader</code> directly and uses the utility func instead. Have to weigh the pros/cons in each use case."}, {"owner": {"reputation": 5381, "user_id": 3958148, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/1d13082f7803e52dd98b2808509976c2?s=128&d=identicon&r=PG", "display_name": "Sung Cho", "link": "https://stackoverflow.com/users/3958148/sung-cho"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1564127386, "post_id": 53272925, "comment_id": 100935747, "body": "@Adrian thanks for weighing in. Could you please clarify what you mean by &quot;it breaks all other interfaces&quot;?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1564148649, "post_id": 53272925, "comment_id": 100946851, "body": "Yes - the <code>loggingResponseWriter</code> will not support <code>CloseNotifier</code>, <code>Flusher</code>, <code>Hijacker</code>, or <code>Pusher</code>, even if the original <code>ResponseWriter</code> did."}, {"owner": {"reputation": 923, "user_id": 2511892, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/378315f8cf1daaf1641ac2ff7dc1adc1?s=128&d=identicon&r=PG", "display_name": "Steven Eckhoff", "link": "https://stackoverflow.com/users/2511892/steven-eckhoff"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1591481027, "post_id": 53272925, "comment_id": 110074163, "body": "@Adrian I must be missing something. The loggingResponseWriter will satisfy the only needed interface which is ResponseWriter. Where are these other interfaces used? ServeHTTP specifies it only needs ResponseWriter."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 923, "user_id": 2511892, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/378315f8cf1daaf1641ac2ff7dc1adc1?s=128&d=identicon&r=PG", "display_name": "Steven Eckhoff", "link": "https://stackoverflow.com/users/2511892/steven-eckhoff"}, "edited": false, "score": 0, "creation_date": 1591619378, "post_id": 53272925, "comment_id": 110115615, "body": "@StevenEckhoff there are additional interfaces that a response writer <i>may</i> support (which I listed, and you can look up for more info), and handlers may use that functionality when it&#39;s available, and if they do, this method will not allow exercising that functionality under test."}, {"owner": {"reputation": 923, "user_id": 2511892, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/378315f8cf1daaf1641ac2ff7dc1adc1?s=128&d=identicon&r=PG", "display_name": "Steven Eckhoff", "link": "https://stackoverflow.com/users/2511892/steven-eckhoff"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1591636817, "post_id": 53272925, "comment_id": 110125494, "body": "@Adrian okay so I guess what everyone is left wondering about is how these interfaces are reached. The only way I can see this happening is through a type assertion down the ServeHTTP chain (i.e. <code>w.(http.Hijacker)</code>). Of course this will panic and you&#39;ll learn you have an issue fairly quickly. I was not aware that this is done. A solution to this would be to use the second form of type assertion to test whether a particular interface is supported and then make sure your wrapped type also supports it. This is a good idea for a robust library, but may be overkill for a one-off middleware."}], "tags": [], "owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "is_accepted": false, "score": 4, "last_activity_date": 1542076281, "creation_date": 1542076281, "answer_id": 53272925, "question_id": 53272536, "link": "https://stackoverflow.com/questions/53272536/how-do-i-get-response-statuscode-in-golang-middleware/53272925#53272925", "title": "How do I get Response statusCode in golang middleware?", "body": "<p>This method is feasible.</p>\n\n<pre><code>    type loggingResponseWriter struct {\n        http.ResponseWriter\n        statusCode int\n    }\n\n    func NewLoggingResponseWriter(w http.ResponseWriter) *loggingResponseWriter {\n        return &amp;loggingResponseWriter{w, http.StatusOK}\n    }\n\n    func (lrw *loggingResponseWriter) WriteHeader(code int) {\n        lrw.statusCode = code\n        lrw.ResponseWriter.WriteHeader(code)\n    }\n\n    func wrapHandlerWithLogging(wrappedHandler http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n            log.Printf(\"--&gt; %s %s\", req.Method, req.URL.Path)\n\n            lrw := NewLoggingResponseWriter(w)\n            wrappedHandler.ServeHTTP(lrw, req)\n\n            statusCode := lrw.statusCode\n            log.Printf(\"&lt;-- %d %s\", statusCode, http.StatusText(statusCode))\n        })\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 484, "user_id": 8628159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0635a91a7a6d2320001909da60e657f?s=128&d=identicon&r=PG&f=1", "display_name": "Olegs", "link": "https://stackoverflow.com/users/8628159/olegs"}, "is_accepted": false, "score": 2, "last_activity_date": 1580904750, "last_edit_date": 1580904750, "creation_date": 1580901147, "answer_id": 60074527, "question_id": 53272536, "link": "https://stackoverflow.com/questions/53272536/how-do-i-get-response-statuscode-in-golang-middleware/60074527#60074527", "title": "How do I get Response statusCode in golang middleware?", "body": "<p>Long story short, you should wrap http.ResponseWriter by yourself or using libraries. If you want to implement it by yourself you can find some hints from <a href=\"https://github.com/urfave/negroni/blob/master/response_writer.go\" rel=\"nofollow noreferrer\">Negroni</a> source code</p>\n"}, {"tags": [], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "is_accepted": false, "score": 2, "last_activity_date": 1600154944, "last_edit_date": 1600154944, "creation_date": 1600154474, "answer_id": 63896952, "question_id": 53272536, "link": "https://stackoverflow.com/questions/53272536/how-do-i-get-response-statuscode-in-golang-middleware/63896952#63896952", "title": "How do I get Response statusCode in golang middleware?", "body": "<p>Use negroni. It works the same as @huangapple answer, but with the handler actually implementing all the interfaces.</p>\n<pre><code>import (\n    &quot;github.com/urfave/negroni&quot;\n)\n\nfunc wrapHandlerWithLogging(wrappedHandler http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n        log.Printf(&quot;--&gt; %s %s&quot;, req.Method, req.URL.Path)\n\n        lrw := negroni.NewResponseWriter(w)\n        wrappedHandler.ServeHTTP(lrw, req)\n\n        statusCode := lrw.Status()\n        log.Printf(&quot;&lt;-- %d %s&quot;, statusCode, http.StatusText(statusCode))\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3623, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1600154944, "creation_date": 1542073154, "last_edit_date": 1542073338, "question_id": 53272536, "link": "https://stackoverflow.com/questions/53272536/how-do-i-get-response-statuscode-in-golang-middleware", "title": "How do I get Response statusCode in golang middleware?", "body": "<p>How do I get Response statusCode in golang middleware?</p>\n\n<p>ResponseWriter have only WriteHeader interface, I can't find get interface.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1542067935, "post_id": 53271818, "comment_id": 93427270, "body": "You mean like <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#Array.Append\" rel=\"nofollow noreferrer\"><code>Append()</code></a>? It&#39;s a little broad a question since you don&#39;t actually say &quot;which parts&quot; you want to &quot;dynamically&quot; construct. So I&#39;m a little unsure how to interpret your question other than you appear to not be aware of where the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">API documentation</a> is. As you can see by visiting the links, there&#39;s quite a bit of it. Perhaps you coul be more descriptive in your question about what &quot;dynamic construction&quot; you actually intend to do here."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9215737, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3gQOU-YMH4A/AAAAAAAAAAI/AAAAAAAAACY/dlr223F0Q6M/photo.jpg?sz=128", "display_name": "carsomyrxp", "link": "https://stackoverflow.com/users/9215737/carsomyrxp"}, "edited": false, "score": 0, "creation_date": 1542073830, "post_id": 53272334, "comment_id": 93428412, "body": "This works for me. I totally forgot about passing a slice on a variadic function. Thank you!"}], "tags": [], "owner": {"reputation": 522, "user_id": 10257494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4795f00374ede4e7c37faa2c740c1deb?s=128&d=identicon&r=PG&f=1", "display_name": "Leesa", "link": "https://stackoverflow.com/users/10257494/leesa"}, "is_accepted": true, "score": 2, "last_activity_date": 1542071415, "creation_date": 1542071415, "answer_id": 53272334, "question_id": 53271818, "link": "https://stackoverflow.com/questions/53271818/dynamically-create-aggregate-pipeline-for-mongo-go-driver/53272334#53272334", "title": "Dynamically create Aggregate pipeline for mongo-go-driver", "body": "<p>I thought the question was pretty clear, not sure if the first commentor was actually reading the statement carefully.</p>\n\n<p>What this person was asking was to dynamically insert data given a list of data into the pipeline.</p>\n\n<p>I had the same issue on a vue app my team and I are working on. Using your provided data, here is the general template:</p>\n\n<p>Given a slice of string of oceans</p>\n\n<pre><code>a := []string{\"Pacific Ocean\", \"Indian Ocean\"}\n</code></pre>\n\n<p>Make a slice of size 0 of type *bson.Value </p>\n\n<pre><code>b := make([]*bson.Value, 0)\n</code></pre>\n\n<p>Loop through the slice of oceans and append bson converted values to slice b</p>\n\n<pre><code>for _, v := range a {\n    b = append(b, bson.VC.String(v))\n}\n</code></pre>\n\n<p>Then create key-value pair so that mongo can look for matches</p>\n\n<pre><code>c := bson.EC.ArrayFromElements(\"$in\", b...)\n</code></pre>\n\n<p>Then pass c into the pipeline</p>\n\n<pre><code>pipeline := bson.NewArray(\n    bson.VC.DocumentFromElements(\n        bson.EC.SubDocumentFromElements(\n            \"$match\",\n            bson.EC.SubDocumentFromElements(\"ocean\", c),\n        ),\n    ),\n)\n</code></pre>\n\n<p>This should give you an idea on how to dynamically pipeline for callTypeNames</p>\n"}], "owner": {"reputation": 13, "user_id": 9215737, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3gQOU-YMH4A/AAAAAAAAAAI/AAAAAAAAACY/dlr223F0Q6M/photo.jpg?sz=128", "display_name": "carsomyrxp", "link": "https://stackoverflow.com/users/9215737/carsomyrxp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 0, "accepted_answer_id": 53272334, "answer_count": 1, "score": 1, "last_activity_date": 1542071415, "creation_date": 1542066970, "question_id": 53271818, "link": "https://stackoverflow.com/questions/53271818/dynamically-create-aggregate-pipeline-for-mongo-go-driver", "title": "Dynamically create Aggregate pipeline for mongo-go-driver", "body": "<p><a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/mongodb/mongo-go-driver</a></p>\n\n<p>I am trying to create an Aggregate pipeline dynamically. For example, I want to read a slice of string containing the oceans. I tried breaking these apart to pieces, but I could not find any methods to append elements.</p>\n\n<pre><code>pipeline := bson.NewArray(\n    bson.VC.DocumentFromElements(\n        bson.EC.SubDocumentFromElements(\n            \"$match\",\n            bson.EC.SubDocumentFromElements(\"ocean\",\n                bson.EC.ArrayFromElements(\"$in\",\n                    bson.VC.String(\"Pacific Ocean\"),\n                    //bson.VC.String(\"Indian Ocean\"),\n                ),\n            ),\n            bson.EC.SubDocumentFromElements(\"callTypeName\",\n                    bson.EC.ArrayFromElements(\"$in\",\n                        bson.VC.String(\"Wookie\"),\n                        bson.VC.String(\"Unknown 13\"),\n                    ),\n            ),\n        ),\n    ),\n)\ncur, err := collection.Aggregate(context.Background(), pipeline)\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "jwt"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4059474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98d602c3f98ceb32aa60a125a7d92e4?s=128&d=identicon&r=PG&f=1", "display_name": "AJ.", "link": "https://stackoverflow.com/users/4059474/aj"}, "edited": false, "score": 0, "creation_date": 1542070342, "post_id": 53272081, "comment_id": 93427781, "body": "Thanks for the reply, is there any way to configure it so that it copies from a local file so that anyone spinning up can just generate the pub key and be good to go rather than having to dump the file contents into the yaml file?"}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "reply_to_user": {"reputation": 11, "user_id": 4059474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98d602c3f98ceb32aa60a125a7d92e4?s=128&d=identicon&r=PG&f=1", "display_name": "AJ.", "link": "https://stackoverflow.com/users/4059474/aj"}, "edited": false, "score": 0, "creation_date": 1542071750, "post_id": 53272081, "comment_id": 93428032, "body": "I\u2019m not sure I understood correctly. Do you want kubernetes to access to your local file system automatically ? That\u2019s not possible. You have to deploy your contents to the cloud one way or another, or use an endpoint that writes uploaded keys to a database."}, {"owner": {"reputation": 6049, "user_id": 3156333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e6084bd9e856704d12ac4afe7b45a0?s=128&d=identicon&r=PG&f=1", "display_name": "Crou", "link": "https://stackoverflow.com/users/3156333/crou"}, "edited": false, "score": 0, "creation_date": 1542108228, "post_id": 53272081, "comment_id": 93441666, "body": "You can use a <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" rel=\"nofollow noreferrer\">secret</a> to hold the key. Or if you want to generate it each time you create a new pod, you can look into <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/\" rel=\"nofollow noreferrer\">init containers</a>"}, {"owner": {"reputation": 11, "user_id": 4059474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98d602c3f98ceb32aa60a125a7d92e4?s=128&d=identicon&r=PG&f=1", "display_name": "AJ.", "link": "https://stackoverflow.com/users/4059474/aj"}, "edited": false, "score": 0, "creation_date": 1542124380, "post_id": 53272081, "comment_id": 93451455, "body": "@atayenel I don&#39;t want to manually copy/paste a key into a configmap file every time someone locally wants to spin up."}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": false, "score": 1, "last_activity_date": 1542069046, "creation_date": 1542069046, "answer_id": 53272081, "question_id": 53271724, "link": "https://stackoverflow.com/questions/53271724/how-can-i-serve-a-static-file-to-my-local-kubernetes-deployed-service-from-my-co/53272081#53272081", "title": "How can I serve a static file to my local Kubernetes deployed service from my controller file?", "body": "<p>You can do it with <code>configmaps</code>. Config maps are resources that are used to deploy single files (basically). I'm currently using one for my clusters nginx configuration. </p>\n\n<p>In your config file , write the contents of your public key to your data field and then tell your deployment to use that config file and read from it. It's very similar to mounting a volume for a single file only. You may need to update your deployed image to read from the mounted location though.</p>\n\n<p>Search for <code>nginx in kubernetes</code> for examples of how people use configmaps to deploy their configurations (in your case public key) to the clusters.</p>\n\n<p>For testing you can create your config map with this command <code>kubectl create configmap public-conf --from-file=./your-public-key</code>. This will create a configmap called public-conf. You can run <code>kubectl get configmap</code> to see your newly created configmap.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4059474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98d602c3f98ceb32aa60a125a7d92e4?s=128&d=identicon&r=PG&f=1", "display_name": "AJ.", "link": "https://stackoverflow.com/users/4059474/aj"}, "is_accepted": true, "score": 0, "last_activity_date": 1542225036, "creation_date": 1542225036, "answer_id": 53307787, "question_id": 53271724, "link": "https://stackoverflow.com/questions/53271724/how-can-i-serve-a-static-file-to-my-local-kubernetes-deployed-service-from-my-co/53307787#53307787", "title": "How can I serve a static file to my local Kubernetes deployed service from my controller file?", "body": "<p>I ended up using <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" rel=\"nofollow noreferrer\">secrets</a> suggested by @Crou to create the key:</p>\n\n<pre><code>$ kubectl create secret generic pub-key --from-file=./jwt-key.pub\n</code></pre>\n\n<p>and then mounted it to a volume in my deployment yaml:</p>\n\n<pre><code>spec:\n  volumes:\n    - name: secret\n      secret:\n        secretName: pub-key\n        defaultMode: 256\n...\n  containers:\n      volumeMounts:\n        - name: secret\n          readOnly: true\n          mountPath: /secret\n</code></pre>\n\n<p>and was able to access my key at <code>/secret/jwt-key.pub</code></p>\n"}], "owner": {"reputation": 11, "user_id": 4059474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98d602c3f98ceb32aa60a125a7d92e4?s=128&d=identicon&r=PG&f=1", "display_name": "AJ.", "link": "https://stackoverflow.com/users/4059474/aj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 53307787, "answer_count": 2, "score": 0, "last_activity_date": 1542225036, "creation_date": 1542066280, "question_id": 53271724, "link": "https://stackoverflow.com/questions/53271724/how-can-i-serve-a-static-file-to-my-local-kubernetes-deployed-service-from-my-co", "title": "How can I serve a static file to my local Kubernetes deployed service from my controller file?", "body": "<p>I have defined a deployment file:</p>\n\n<pre><code>---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ ... }}\n  labels:\n    app.kubernetes.io/name: {{ ... }}\n    helm.sh/chart: {{ ... }}\n    app.kubernetes.io/instance: {{ .Release.Name }}\n    app.kubernetes.io/managed-by: {{ .Release.Service }}\nspec:\n    ...\n</code></pre>\n\n<p>My service implements JWT validation and thus requires a public key. Can I somehow specify in the deployment file to serve a locally generated pub key file to my service?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1542069312, "post_id": 53271803, "comment_id": 93427592, "body": "You&#39;re awesome, sir! I spent most of the day on this. Bashing my head against the wall..."}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1542069789, "post_id": 53271803, "comment_id": 93427678, "body": "Quick question, I tried your Middleware example, but the compiler balks at handler:      ./main.go:188:17: undefined: handler"}, {"owner": {"reputation": 341, "user_id": 3038881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ffcebb8897dbdc464f30527a8b2aeeb?s=128&d=identicon&r=PG", "display_name": "bentranter", "link": "https://stackoverflow.com/users/3038881/bentranter"}, "reply_to_user": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1542127633, "post_id": 53271803, "comment_id": 93453565, "body": "Hm, that&#39;s odd. The <code>handler</code> is defined as the first and only argument on the <code>protectionMiddleware</code> function, so I&#39;m surprised it&#39;s saying that <code>handler</code> is undefined. That <code>handler</code> variable will only exist within the scope of the <code>protectionMiddleware</code> though -- maybe you&#39;ve got an extra closing brace somewhere that&#39;s taking it out of scope?"}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1542128642, "post_id": 53271803, "comment_id": 93454196, "body": "Upon second look, I mustve been tired yesterday. In my Mw func, I define the http.Handler as next. So all is well. Thanks for your help!!! When things don&#39;t make sense, and you can&#39;t read right, take a break or sleep on it."}], "tags": [], "owner": {"reputation": 341, "user_id": 3038881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ffcebb8897dbdc464f30527a8b2aeeb?s=128&d=identicon&r=PG", "display_name": "bentranter", "link": "https://stackoverflow.com/users/3038881/bentranter"}, "is_accepted": true, "score": 3, "last_activity_date": 1542066905, "creation_date": 1542066905, "answer_id": 53271803, "question_id": 53271241, "link": "https://stackoverflow.com/questions/53271241/disable-csrf-on-json-api-calls/53271803#53271803", "title": "Disable CSRF on JSON API Calls", "body": "<p>One option is to only use the CSRF protection on specific HTTP handlers, rather than protecting the entire router. Note that this will require you to perform a type conversion on your <code>myApp.IndexHandler</code> in order to satisfy the type signature for the function returned by <code>csrf.Protect()</code>.</p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(false)\n\n// Instead of protecting your entire router, you can protect specific HTTP\n// handlers.\nrouter.Path(\"/\").Handler(\n    csrf.Protect(\n        []byte(\"my-long-key-here-redacted\"),\n        csrf.Secure(false),\n    )(http.HandlerFunc(myApp.IndexHandler)),\n).Methods(\"GET\")\n\napiRouter := router.PathPrefix(\"/api\").Subrouter()\napiRouter.Path(\"/dosomething\").HandlerFunc(myApp.DoSomethingAPIHandler).Methods(\"POST\", \"OPTIONS\")\n\nhttp.ListenAndServe(\n    \":8000\",\n    router,\n)\n</code></pre>\n\n<p>Alternatively, you can use the function returned from <code>csrf.Protect()</code> to create your own middleware, with logic to only add the CSRF protection on certain requests. You could use this approach to only add protection on endpoints with the prefix <code>/api</code> for example, as I've done in the code below.</p>\n\n<pre><code>protectionMiddleware := func(handler http.Handler) http.Handler {\n    protectionFn := csrf.Protect(\n        []byte(\"my-long-key-here-redacted\"),\n        csrf.Secure(false),\n    )\n\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // Use some kind of condition here to see if the router should use\n        // the CSRF protection. For the sake of this example, we'll check\n        // the path prefix.\n        if !strings.HasPrefix(r.URL.Path, \"/api\") {\n            protectionFn(handler).ServeHTTP(w, r)\n            return\n        }\n\n        handler.ServeHTTP(w, r)\n    })\n}\n\nrouter := mux.NewRouter().StrictSlash(false)\nrouter.Path(\"/\").HandlerFunc(myApp.IndexHandler).Methods(\"GET\")\n\napiRouter := router.PathPrefix(\"/api\").Subrouter()\napiRouter.Path(\"/dosomething\").HandlerFunc(myApp.DoSomethingAPIHandler).Methods(\"POST\", \"OPTIONS\")\n\nhttp.ListenAndServe(\n    \":8000\",\n    protectionMiddleware(router),\n)\n</code></pre>\n"}], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 1, "accepted_answer_id": 53271803, "answer_count": 1, "score": 1, "last_activity_date": 1542066905, "creation_date": 1542063083, "question_id": 53271241, "link": "https://stackoverflow.com/questions/53271241/disable-csrf-on-json-api-calls", "title": "Disable CSRF on JSON API Calls", "body": "<p>I have a website project. It uses Go and the Gorilla and it's CSRF packages to protect against CSRF. I also have a JSON API that authenticates using a JWT like token provider (internal), so a user must authenticate with that before issuing a JSON request each time. So the CSRF is not an issue on the JSON side. At least I don't think so.</p>\n\n<p>Here's my code, where I am using a NewRouter for web Paths, and a Subrouter for the /api/v1/[endpoint]s. If I call a JSON endpoint that does a POST, the CSRF is engaged and I get a Forbidden - CSRF token invalid. I was under the assume, that perhaps a Sub Router would not have the middleware for the CSRF check associated with.</p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(false)\nrouter.Path(\"/\").HandlerFunc(myApp.IndexHandler).Methods(\"GET\")\n\napiRouter := router.PathPrefix(\"/api\").Subrouter()\napiRouter.Path(\"/dosomething\").HandlerFunc(myApp.DoSomethingAPIHandler).Methods(\"POST\", \"OPTIONS\")\n\nhttp.ListenAndServe(\":8000\",\n    csrf.Protect(\n        []byte(\"my-long-key-here-redacted\"),\n        csrf.Secure(false), // Set to false as we offload SSL elsewhere\n    )(router)))\n</code></pre>\n\n<p>Question:\nHow do I get my API to work with or without CSRF protection? Obviously, the web paths will need to be protected to protect form posts.</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1542061111, "post_id": 53270670, "comment_id": 93425444, "body": "What is the relationship between cmd/myapp and otherstuff with regard to versioning?  If they are always versioned together, than put go.mod in the root of the repo.  If not, put go.mod in each package.  This will require more effort to maintain.  The path of least resistance is go.mod in root."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1542069509, "creation_date": 1542069509, "answer_id": 53272126, "question_id": 53270670, "link": "https://stackoverflow.com/questions/53270670/package-layout-for-go-projects-using-modules-to-track-dependencies/53272126#53272126", "title": "Package layout for Go projects using modules to track dependencies?", "body": "<p><a href=\"https://github.com/golang/go/wiki/Modules#modules\" rel=\"nofollow noreferrer\">From the wiki</a>:</p>\n\n<blockquote>\n  <p>A module is a collection of related Go packages that are versioned together as a single unit. Most often, a single version-control repository corresponds exactly to a single module, but alternatively, a single version-control repository can hold multiple modules.</p>\n</blockquote>\n\n<p>So putting <code>go.mod</code> right next to <code>.git</code> (or equivalent for some other VCS) is almost always the right thing to do. You would only create multiple modules in a single repository if the code in each module is truly independent from the other modules, so that the version of one module does not effect the other modules in any way.</p>\n"}], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1542069509, "creation_date": 1542059723, "question_id": 53270670, "link": "https://stackoverflow.com/questions/53270670/package-layout-for-go-projects-using-modules-to-track-dependencies", "title": "Package layout for Go projects using modules to track dependencies?", "body": "<p>Go now provides <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">modules</a> for dependency management, and I'm a little bit confused as to how I should organize my projects.</p>\n\n<p>In traditional <code>$GOPATH</code> mode, I would organize an application as follows:</p>\n\n<pre><code>\u251c\u2500 cmd/\n|  \u2514\u2500 myapp/\n|     \u2514\u2500 main.go\n\u251c\u2500 otherstuff/\n|  \u2514\u2500 file.go\n\u2514\u2500 README.md, etc.\n</code></pre>\n\n<p>This is what I see most projects on GitHub doing.</p>\n\n<p>However, now that we have modules, I'm not sure where to put <code>go.mod</code>. Does it go in the project's root directory? Does it go in <code>cmd/[whatever]/</code>? Should I still be putting <code>main.go</code> in the <code>cmd/[whatever]</code> directory or should it be in the project's root directory now?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542059272, "post_id": 53270533, "comment_id": 93424815, "body": "Can you also post <code>a.Quit()</code>? Or is that <code>a.Stop()</code>?"}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542059512, "post_id": 53270533, "comment_id": 93424885, "body": "@icza It&#39;s a.Stop(), thanks. I updated the question"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1542059985, "post_id": 53270533, "comment_id": 93425074, "body": "When you close <code>a.QuitChan</code>, that will terminate <code>a</code>&#39;s goroutine (sooner or later), but the goroutine in the <code>b</code> package has no termination condition, that will run forever. Also, the app will not terminate just because some &quot;random&quot; goroutine ended, the app terminates when the <code>main</code> goroutine ends (we don&#39;t know what your <code>main</code> goroutine is)."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "edited": false, "score": 1, "creation_date": 1542060632, "post_id": 53270533, "comment_id": 93425293, "body": "Can you elaborate on what you mean by &quot;they keep running&quot;?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1542061036, "post_id": 53270533, "comment_id": 93425415, "body": "You have a loop in <code>b</code>&#39;s goroutine, and there is no return nor break statement in it, so it will run forever. A goroutine or its loop will not magically end or return just because an independent goroutine ended."}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542061104, "post_id": 53270533, "comment_id": 93425441, "body": "@icza I\u2019m ok with goroutines in b keep running. My problem is goroutines in A doesn\u2019t get stop (returned) and they keep running - processing more items from WorkChan. That\u2019s what I\u2019m trying to ahieve"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1542061878, "post_id": 53270533, "comment_id": 93425672, "body": "Just because you see <code>&quot;Stop called, closing channel&quot;</code> printed, that is not guarantee that the <code>QuitChan</code> is closed (as the print is before the <code>close()</code> call). Put a print statement <i>after</i> the <code>close()</code> and confirm if you see that printed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542062437, "post_id": 53270533, "comment_id": 93425827, "body": "Also, the code you posted is obviously just a fragment. You used short variable declaration: <code>QuitChan := make(chan struct{})</code>, and there is also a chance you shadowed a potential global <code>QuitChan</code> variable, and you may be closing a different channel. This is not possible to tell based on the fragments we see. Would be best if you could provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542063042, "post_id": 53270533, "comment_id": 93425972, "body": "@icza I had to fragment it, else it would be too long. I tried to pin point what I&#39;m seeing vs expecting. I&#39;ll try with print statement after the close statement to verify it is called and double check there is no shadowing issue"}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542064330, "post_id": 53270533, "comment_id": 93426360, "body": "@icza I&#39;ve updated the question; hopefully it is more complete now, with the main func included. I&#39;ve double checked - no shadowing. I&#39;ll be able to verify the print after close call tomorrow"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1542068644, "post_id": 53270533, "comment_id": 93427444, "body": "You are copying the WaitGroup. Use a pointer instead. <code>go vet</code> should complain about that, I think."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1542102876, "post_id": 53270533, "comment_id": 93438491, "body": "In your last comment you said you get an error that the channel is already closed. This confirms my suspicion that you shadow the global variable. We don&#39;t see your exact code, and I understand that would be too long. Again, please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> as we are just wasting each others&#39; time. As it is now, this question is off-topic."}], "answers": [{"comments": [{"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1542095049, "post_id": 53274222, "comment_id": 93434303, "body": "I&#39;m already using &amp;wg so that wasn&#39;t the issue, but I did made some progress after moving the channel initialization into a function. I declare QuitChan in global scope, init it in Start(), but when I close it now I get <code>panic: close of nil channel</code>"}], "tags": [], "owner": {"reputation": 1384, "user_id": 4296218, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xH28YeHMo9Q/AAAAAAAAAAI/AAAAAAAAABE/ad2T99eOL2s/photo.jpg?sz=128", "display_name": "James Shi", "link": "https://stackoverflow.com/users/4296218/james-shi"}, "is_accepted": false, "score": 5, "last_activity_date": 1542085931, "creation_date": 1542085931, "answer_id": 53274222, "question_id": 53270533, "link": "https://stackoverflow.com/questions/53270533/signal-goroutines-to-stop-with-channel-close/53274222#53274222", "title": "Signal goroutines to stop with channel close", "body": "<p><strong>First I think you should make a simple test, and past it out. It will be more help to let other understand what's your problem.</strong></p>\n\n<p>I changed your code, and make it reading like a go code, instead of other language. <strong>Now it's worked</strong>.</p>\n\n<p>In your code, there are some mistakes, I marked it as ERROR comment. Some are grammar error, like creating <code>WorkChan</code>. Some are type error.</p>\n\n<p>One import design thing you should know, when you want exit after execute <code>Stop()</code>, you should close the <code>WorkChan</code> where you send data to <code>WorkChan</code>, insteal of just return at where you receive date.</p>\n\n<ul>\n<li><p>a.go</p>\n\n<pre><code>package a\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n// ERROR: can not do make in global\nvar WorkChan chan int\nvar QuitChan chan struct{}\n\n// Create chan when init\nfunc init() {\n    fmt.Println(\"Init a\")\n    WorkChan = make(chan int)\n    QuitChan = make(chan struct{})\n}\n\nfunc Stop() {\n    fmt.Println(\"Stop called, closing quit channel\")\n    close(QuitChan)\n}\n\n// Close the work channel where you send date\nfunc Start(wg *sync.WaitGroup) {\n    i := 0\n    for {\n        select {\n        case &lt;-QuitChan:\n            fmt.Println(\"Closing work chan\")\n            close(WorkChan)\n            wg.Done()\n            return\n        default:\n            WorkChan &lt;- i\n            i++\n        }\n    }\n}\n\n// Work will exit when workchan closed\nfunc Work(wg *sync.WaitGroup) {\n    for item := range WorkChan {\n        fmt.Printf(\"Receive %d\\n\", item)\n    }\n    wg.Done()\n    fmt.Println(\"Work exit\")\n}\n</code></pre></li>\n<li><p>b.go</p>\n\n<pre><code>package b\n\nimport (\n    \"github.com/shitaibin/awesome/a\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc Signal() {\n\n    sChan := make(chan os.Signal, 1)\n    signal.Notify(sChan, syscall.SIGTERM, syscall.SIGINT) // ERROR\n\n    for {\n        s := &lt;-sChan\n        switch s {\n        case os.Interrupt, syscall.SIGTERM:\n            a.Stop()\n            return // should return free resource\n        }\n    }\n}\n</code></pre></li>\n<li><p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/shitaibin/awesome/a\"\n    \"github.com/shitaibin/awesome/b\"\n    \"sync\"\n)\n\nfunc main() {\n\n    var wg sync.WaitGroup\n\n    go b.Signal()\n\n    wg.Add(1)      // for simplicity; actual code start multiple goroutines of Work\n    go a.Work(&amp;wg) // ERROR: pointer\n\n    wg.Add(1)\n    go a.Start(&amp;wg) // Send data and close channel when stop\n\n    // wait until work is done\n    wg.Wait()\n    fmt.Println(\"Done.\")\n}\n</code></pre></li>\n<li><p>Result</p>\n\n<pre><code>// omit\nReceive 87028\nReceive 87029\nReceive 87030\nReceive 87031\nReceive 87032\nReceiv^C101    &lt;---- send signal here\nReceive 87102\nReceive 87103\nReceive 87104\nReceive 87105\nReceive 87106\nReceive 87107\nReceive 87108\nReceive 87109\nReceive 87110\nStop called, closing quit channel\nReceive 87111\nReceive 87112\nClosing work chan\nWork exit\nDone.\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3078, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1542094922, "creation_date": 1542059030, "last_edit_date": 1542094922, "question_id": 53270533, "link": "https://stackoverflow.com/questions/53270533/signal-goroutines-to-stop-with-channel-close", "title": "Signal goroutines to stop with channel close", "body": "<p>I have got multiple goroutines that <code>select</code> from two channels: one chan provides data, one chan for signals (kind of done/quit channel).</p>\n\n<p>I use the signals channel to capture signals (kill) and gracefully close the goroutines.</p>\n\n<p>I'm running the 'worker' goroutines from <code>package a</code>, while the goroutine func that captures signals runs from <code>package b</code>.</p>\n\n<p>I use the signals package from <a href=\"https://gist.github.com/reiki4040/be3705f307d3cd136e85\" rel=\"nofollow noreferrer\">https://gist.github.com/reiki4040/be3705f307d3cd136e85</a>. </p>\n\n<pre><code>package a\n\nimport \"sync\"\n\nWorkChan := make(chan int)\nQuitChan := make(chan struct{})\n\nfunc Stop() {\n        fmt.Println(\"Stop called, closing channel\")\n        close(QuitChan)\n}\n\nfunc Work(wg *sync.WaitGroup) {\n    var item int\n    for {\n        select {\n        case item = &lt;- WorkChan:\n            ... processing\n        case &lt;- QuitChan:\n            wg.Done()\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>The goroutine to catch signals, and call <code>a.Stop()</code></p>\n\n<pre><code>package b\n\nimport (\n    \"os/signal\"\n    \"os\"\n    \"syscal\"\n    \"a\"\n)\n\nfunc Signal() {\n\n    sChan := make(chan os.Signal, 1)\n    signal.Notify(signalChan, syscall.SIGTERM, syscall.SIGINT)\n\n    for {\n        s := &lt;-sChan\n        switch s {\n        case os.Interrupt, syscall.SIGTERM:\n            a.Stop()\n        }\n    }\n}\n</code></pre>\n\n<p>and this is my main func</p>\n\n<pre><code>package main\n\nimport (\n    \"a\"\n    \"b\"\n    \"sync\"\n)\n\nfunc main() {\n\n    var wg sync.WaitGroup\n\n    go b.Signal()\n\n    wg.Add(1) // for simplicity; actual code start multiple goroutines of Work\n    go a.Work(&amp;wg)\n\n    // wait until work is done\n    wg.Wait()\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n\n<p>When I kill the running process, I see the printed message from <code>Quit</code>. I expected that once the channel is closed, the goroutines will <code>select</code> the <code>QuitChan</code> case at some point and return.</p>\n\n<p>But they keep running; they continue to process items from <code>WorkChan</code>. seems like it is ignored. What am I missing here?\nDoesn't the channel get closed? How come it is still open?</p>\n"}, {"tags": ["reactjs", "go"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 1, "creation_date": 1542052121, "post_id": 53269034, "comment_id": 93422014, "body": "I didn&#39;t test it but you have a comma <code>,</code> at the end of your request <code>body</code> in axios and you don&#39;t have it in the curl command. So speaking JSON-wise , your curl command has the correct syntax. Json unmarshall should give this as an error but can you try removing the &quot;comma&quot; anyways ?"}, {"owner": {"reputation": 1799, "user_id": 5293594, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac5c167d020258e5e049e7d564a3ce0d?s=128&d=identicon&r=PG&f=1", "display_name": "asdfgh", "link": "https://stackoverflow.com/users/5293594/asdfgh"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1542052226, "post_id": 53269034, "comment_id": 93422057, "body": "removed it, still the same"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1542052898, "post_id": 53269034, "comment_id": 93422338, "body": "Your <code>axios.post</code> arguments are wrong. See <a href=\"https://github.com/axios/axios#axiosposturl-data-config\" rel=\"nofollow noreferrer\">github.com/axios/axios#axiosposturl-data-config</a>. Also axios by default sends the data as json, no need for the headers. You&#39;re calling <code>axios.post</code> so no need for <code>method: &#39;POST&#39;</code>. Just data, but omit the <code>body</code> attribute."}, {"owner": {"reputation": 1799, "user_id": 5293594, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac5c167d020258e5e049e7d564a3ce0d?s=128&d=identicon&r=PG&f=1", "display_name": "asdfgh", "link": "https://stackoverflow.com/users/5293594/asdfgh"}, "edited": false, "score": 0, "creation_date": 1542053361, "post_id": 53269034, "comment_id": 93422510, "body": "it worked, thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 2089, "user_id": 355283, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9c6edb7b5306665be2be9b2e837fa74d?s=128&d=identicon&r=PG", "display_name": "User123456", "link": "https://stackoverflow.com/users/355283/user123456"}, "is_accepted": false, "score": 1, "last_activity_date": 1542086789, "creation_date": 1542086789, "answer_id": 53274355, "question_id": 53269034, "link": "https://stackoverflow.com/questions/53269034/how-to-unmarshall-json-request-from-axios-react/53274355#53274355", "title": "How to unmarshall json request from Axios, React", "body": "<p>When you are doing post request with axios, one way to do is </p>\n\n<pre><code>axios({\n  method: 'post',\n  url: 'http://localhost:8000/api/rooms/signin',\n  data: {\n         \"username\": \"Username\", \n         \"password\": \"Password\"\n  },\nconfig: { headers: {'Content-Type': 'application/json' }}\n});\n</code></pre>\n\n<p>if you want you could add then statements here too.</p>\n\n<p>else</p>\n\n<pre><code>axios.post('http://localhost:8000/api/rooms/signin', {\n headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': 'JWT fefege...'\n                },\n             \"username\": \"Username\", \n             \"password\": \"Password\"\n  });\n</code></pre>\n"}], "owner": {"reputation": 1799, "user_id": 5293594, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac5c167d020258e5e049e7d564a3ce0d?s=128&d=identicon&r=PG&f=1", "display_name": "asdfgh", "link": "https://stackoverflow.com/users/5293594/asdfgh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542092811, "creation_date": 1542051745, "last_edit_date": 1542092811, "question_id": 53269034, "link": "https://stackoverflow.com/questions/53269034/how-to-unmarshall-json-request-from-axios-react", "title": "How to unmarshall json request from Axios, React", "body": "<p>I'm working on REST communication between React frontend and Go backend,  I have a problem with sending proper http post request. If I use curl everything works fine but when I use axios I get an empty structure (unmarshalling doesn't return error). It seems to me that generated requests should be exactly the same.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"encoding/json\"\n    \"io/ioutil\"\n)\n\ntype Credentials struct {\n    Password string `json:\"password\", db:\"password\"`\n    Username string `json:\"username\", db:\"username\"`\n}\n\nfunc main() {\n    fmt.Println(\"Listening on port 8000\")\n\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/api/rooms/signin\", Signin)\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n\nfunc Signin(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n\n    if r.Method == \"OPTIONS\" {\n        return\n    }\n    if r.Method == \"POST\" {\n        // Read body\n        b, err := ioutil.ReadAll(r.Body)\n        defer r.Body.Close()\n        if err != nil {\n            fmt.Println(\"Couldn't read request body\")\n            http.Error(w, err.Error(), 500)\n            return\n        }\n\n        // Unmarshal\n        var creds Credentials\n        err = json.Unmarshal(b, &amp;creds)\n        if err != nil {\n            fmt.Println(\"Couldn't unmarshal body\")\n            http.Error(w, err.Error(), 500)\n            return\n        }\n        fmt.Println(creds)\n\n        fmt.Println(\"username:\", creds.Username)\n        fmt.Println(\"password:\", creds.Password)\n\n        w.WriteHeader(http.StatusOK)\n        return\n    }\n}\n</code></pre>\n\n<p>My curl command:</p>\n\n<pre><code>curl -X POST -H \"Content-Type: application/json\" -d '{\"username\":\"Username\",\"password\":\"Password\"}' \"http://localhost:8000/api/rooms/signin\"\n</code></pre>\n\n<p>React handler:</p>\n\n<pre><code>  handleSubmit = (event) =&gt; {\n    event.preventDefault();\n    var data = {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: {\n            \"username\": \"Username\", \n            \"password\": \"Password\",\n        }\n    };\n    axios.post('http://localhost:8000/api/rooms/signin', data)\n        .then(response =&gt; {\n            console.log(response);\n        })\n        .catch(error =&gt; console.log(error));\n  }\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1542069124, "post_id": 53268797, "comment_id": 93427560, "body": "How are you trying to get this running in the IDE? None of those steps help reproduce the problem within the IDE. Are you using 2018.3 EAP."}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1542094518, "post_id": 53268797, "comment_id": 93434077, "body": "@dlsniper When I hit &quot;run&quot; - GoLand runs: <code>goapp serve -host localhost -port 8080 -admin_port 8000 app.yaml</code> and fails. When I run same command without GoLand it also fails."}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1542094620, "post_id": 53268797, "comment_id": 93434123, "body": "@dlsniper GoLand 2018.2.3; Build #GO-182.4505.32, built on September 20, 2018"}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1542094740, "post_id": 53268797, "comment_id": 93434170, "body": "@dlsniper Just downloaded IDE from <a href=\"https://jetbrains.com\" rel=\"nofollow noreferrer\">jetbrains.com</a> but it is <code>goland-2018.2.3.dmg</code> how to download 2018.3 ?"}], "answers": [{"tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": false, "score": 0, "last_activity_date": 1542060879, "creation_date": 1542060879, "answer_id": 53270872, "question_id": 53268797, "link": "https://stackoverflow.com/questions/53268797/go-appengine-wont-start-with-goapp/53270872#53270872", "title": "Go AppEngine won&#39;t start with goapp", "body": "<p>It looks like you are trying to run the go1.11 environment. I suspect you have:</p>\n\n<pre><code>runtime: go111\n</code></pre>\n\n<p>in your <code>app.yaml</code>.</p>\n\n<p>Try changing it to</p>\n\n<pre><code>runtime: go\n</code></pre>\n"}], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542060879, "creation_date": 1542050682, "question_id": 53268797, "link": "https://stackoverflow.com/questions/53268797/go-appengine-wont-start-with-goapp", "title": "Go AppEngine won&#39;t start with goapp", "body": "<p>Accordingly to <a href=\"https://cloud.google.com/appengine/docs/standard/go/download\" rel=\"nofollow noreferrer\">this doc</a>\n<br>I've downloaded \"Cloud SDK\" into my directory: <code>/Users/k/.google-cloud-sdk</code>\n<br>and \"Original App Engine SDK\" into my directory: <code>/Users/k/.go_appengine</code></p>\n\n<p>Now I try to run <a href=\"https://github.com/cn007b/monitoring\" rel=\"nofollow noreferrer\">my project</a>\nwhich is located in dir: <code>/Users/k/web/kovpak/monitoring</code></p>\n\n<p>I've tried this:</p>\n\n<pre><code>export APP_YAML=/Users/k/web/kovpak/monitoring/src/go-app/.gae/app.yaml\nexport GOPATH=/Users/k/web/kovpak/monitoring\nexport APPENGINE_DEV_APPSERVER=/Users/k/.google-cloud-sdk/bin/dev_appserver.py\nexport GOROOT=/Users/k/.google-cloud-sdk/platform/google_appengine/goroot-1.9/\n/Users/k/.google-cloud-sdk/platform/google_appengine/goroot-1.9/bin/goapp serve $APP_YAML\n</code></pre>\n\n<p>But it won't work, it prints:</p>\n\n<blockquote>\n  <p>compile: version \"1.9.4 (appengine-1.9.78)\" does not match go tool version \"go1.11\"</p>\n</blockquote>\n\n<p>Also I've tried this:</p>\n\n<pre><code>export APP_YAML=/Users/k/web/kovpak/monitoring/src/go-app/.gae/app.yaml\nexport GOPATH=/Users/k/web/kovpak/monitoring\nexport APPENGINE_DEV_APPSERVER=/Users/k/.go_appengine/dev_appserver.py\nexport GOROOT=/Users/k/.go_appengine/goroot-1.9\n/Users/k/.go_appengine/goroot-1.9/bin/goapp serve $APP_YAML\n</code></pre>\n\n<p>And it also won't work.\n<br>But if I run this:</p>\n\n<pre><code>export APP_YAML=/Users/k/web/kovpak/monitoring/src/go-app/.gae/app.yaml\nexport GOPATH=/Users/k/web/kovpak/monitoring\n/Users/k/.google-cloud-sdk/bin/dev_appserver.py $APP_YAML\n</code></pre>\n\n<p>All works!\n<br>Is it possible to run dev server with <code>goapp</code>? I need it for debugging from GoLand.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1542045788, "post_id": 53267664, "comment_id": 93419454, "body": "There is definitely not a &quot;go bug with modulo&quot; - the modulus operator in Go works just fine. This is an app issue. Is your CPU usage at or near max?"}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542045904, "post_id": 53267664, "comment_id": 93419498, "body": "no. near 0%. it also not a network issue and there is no single error in my runtime (and i log nearly everything)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1542045950, "post_id": 53267664, "comment_id": 93419520, "body": "It&#39;s near 0% yet &quot;especially on high traffic servers&quot;?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542046100, "post_id": 53267664, "comment_id": 93419594, "body": "Where is the log message you&#39;re looking for? Inside <code>doSomething</code>?"}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542046405, "post_id": 53267664, "comment_id": 93419723, "body": "sry. ignore that &quot;high traffic&quot; statement. there is only ~500kb/s traffic. but it is different to those instances where nearly 0 traffic arrives. i know i described it horrible, but this is real. i think i solved it by using &quot;time.Since().Seconds() &gt; 10&quot;. now it seems to work"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1542046605, "post_id": 53267810, "comment_id": 93419801, "body": "thank you very much :) &quot;and a for loop is not the most reliable way to schedule tasks&quot; =&gt; i think i found an exception where it not worked ;)"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1542046767, "post_id": 53267810, "comment_id": 93419872, "body": "You&#39;re welcome! It&#39;s a bit counter-intuitive, but good to be aware of. Also, if an answer helps, you may want to mark it as accepted. No pressure. :)"}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1542046827, "post_id": 53267810, "comment_id": 93419887, "body": "sry, only got 14 reps. 15 reps guys can vote for &quot;accepted&quot; :("}, {"owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 0, "creation_date": 1542050781, "post_id": 53267810, "comment_id": 93421409, "body": "do you also have an idea why my first approach didnt work? i guess that some &quot;bug&quot; just skipped the index so that index%10 was just randomly 0 and not every 10 seconds. and there is no similar bug description elsewhere in the internet. this is not possible that i was the first person who noticed that?"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "edited": false, "score": 1, "creation_date": 1542052426, "post_id": 53267810, "comment_id": 93422135, "body": "I don&#39;t think it&#39;s an issue with the modulo operation. I suspect it&#39;s because one (or many) of the calls to <code>time.Sleep(1 * time.Second)</code> took longer than 1 second. This is not unlikely if it&#39;s been running for many hours/days."}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 3, "last_activity_date": 1542046262, "creation_date": 1542046262, "answer_id": 53267810, "question_id": 53267664, "link": "https://stackoverflow.com/questions/53267664/i-have-a-strange-bug/53267810#53267810", "title": "I have a strange bug", "body": "<p>I'd recommend using a <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow noreferrer\"><code>time.Ticker</code></a> to perform some action every N seconds. That way, you use built-in timers and only wake the CPU when something needs to be done. Even if the CPU is not heavily used, <code>time.Sleep</code> and a for loop is not the most reliable way to schedule tasks. For example (from the link above):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n    done := make(chan bool)\n    go func() {\n        time.Sleep(10 * time.Second)\n        done &lt;- true\n    }()\n    for {\n        select {\n        case &lt;-done:\n            fmt.Println(\"Done!\")\n            return\n        case t := &lt;-ticker.C:\n            fmt.Println(\"Current time: \", t)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4011959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bd2eedb67385ddcbb68f3091687d731?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4011959/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 53267810, "answer_count": 1, "score": -2, "last_activity_date": 1542092873, "creation_date": 1542045609, "last_edit_date": 1542092873, "question_id": 53267664, "link": "https://stackoverflow.com/questions/53267664/i-have-a-strange-bug", "title": "I have a strange bug", "body": "<p>given are the following 2 functions.</p>\n\n<pre><code>func main() {\n    index := int(0)\n\n    for {\n        Loop(index)\n        index = (index + 1) % 86400 // Max interval: 1 day\n        time.Sleep(1 * time.Second)\n    }\n}\n\nfunc Loop(index int) {\n    if index%10 == 0 {\n        go doSomething...\n    }\n}\n</code></pre>\n\n<p>I want to execute something every 10/60/3600 seconds. So I thought an incrementing index with modulo should do this.</p>\n\n<p>But what I noticed (especially on high traffic servers) that it appears to skip some of that loops.</p>\n\n<p>I looked in my logs and sometimes there is something every 10 seconds but sometimes there is a gap up to 1 minute.</p>\n\n<p>Does anybody know why this is happening?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1542043941, "post_id": 53267239, "comment_id": 93418676, "body": "An unbuffered channel doesn&#39;t store anything by design, so <code>ok</code> doesn&#39;t contain any data to print."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1542044150, "post_id": 53267239, "comment_id": 93418772, "body": "Also note that &quot;print contents of a channel&quot; isn&#39;t really a thing. Your <code>fmt.Println</code> <i>reads a value from the channel</i> and prints it. Reading a value from a channel removes it from the channel. <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">The Tour of Go</a> should provide you a solid foundation on how channels work."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1542044746, "post_id": 53267239, "comment_id": 93419036, "body": "There are no trivial solutions to print values in a channel without <code>dequeuing</code> them. So if you want to just read and print you may read print and write to another channel"}, {"owner": {"reputation": 2761, "user_id": 985179, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/7f9f118aa571a5e0ebcfe240add2d868?s=128&d=identicon&r=PG", "display_name": "Neon Flash", "link": "https://stackoverflow.com/users/985179/neon-flash"}, "edited": false, "score": 0, "creation_date": 1542044769, "post_id": 53267239, "comment_id": 93419045, "body": "I updated the question. Could you take a look? I stored a value into the channel. Then retrieved the value from the channel and now I&#39;m trying to print it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1542045417, "post_id": 53267239, "comment_id": 93419325, "body": "@NeonFlash: you did not store a value into the channel, because the channel cannot store a value. However even if you made it a buffered, there is no language method to read the stored value without receiving out of the channel."}], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 4, "last_activity_date": 1542044916, "creation_date": 1542044916, "answer_id": 53267499, "question_id": 53267239, "link": "https://stackoverflow.com/questions/53267239/print-contents-of-a-channel-in-go/53267499#53267499", "title": "Print contents of a channel in Go", "body": "<p>Channels <code>make(chan int)</code> has implicit size zero ( ref: <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Making_slices_maps_and_channels</a>)</p>\n\n<p>A channel of size zero is unbuffered. A channel of specified size make(chan int, n) is buffered. See <a href=\"http://golang.org/ref/spec#Send_statements\" rel=\"nofollow noreferrer\">http://golang.org/ref/spec#Send_statements</a> for a discussion on buffered vs. unbuffered channels. The example at <a href=\"http://play.golang.org/p/VZAiN1V8-P\" rel=\"nofollow noreferrer\">http://play.golang.org/p/VZAiN1V8-P</a> illustrates the difference.</p>\n\n<p>Here, channel <code>&lt;-ok</code> or <code>ok &lt;-</code> will be blocked until someone processes it (<strong>concurrently</strong>). So, change <code>ok := make(chan int)</code> to <code>ok := make(chan int,1)</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    ok := make(chan int, 1)\n    ok &lt;- 1\n    x := &lt;- ok\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Or concurrently proccess it</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    ok := make(chan int)\n    go func(){\n       ok &lt;- 1\n    }()\n    x := &lt;- ok\n    fmt.Println(x)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": false, "score": 2, "last_activity_date": 1542045158, "creation_date": 1542045158, "answer_id": 53267563, "question_id": 53267239, "link": "https://stackoverflow.com/questions/53267239/print-contents-of-a-channel-in-go/53267563#53267563", "title": "Print contents of a channel in Go", "body": "<p>Here you are trying to write to an unbuffered channel since there are no go routines trying to read from the channel it will reach a deadlock situation</p>\n\n<p>Here is what you can do</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ok := make(chan int)\n\n    go func() {\n        for x := range ok {\n            fmt.Println(x)\n        }\n    }()\n    ok &lt;- 1\n    ok &lt;- 3\n    ok &lt;- 2\n    ok &lt;- 5\n    ok &lt;- 3\n    ok &lt;- 9\n    time.Sleep(1)\n}\n</code></pre>\n\n<p>you may find the link to play ground <a href=\"https://play.golang.com/p/we6Y-dNAZ69\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 2761, "user_id": 985179, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/7f9f118aa571a5e0ebcfe240add2d868?s=128&d=identicon&r=PG", "display_name": "Neon Flash", "link": "https://stackoverflow.com/users/985179/neon-flash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4906, "favorite_count": 0, "accepted_answer_id": 53267499, "answer_count": 2, "score": 1, "last_activity_date": 1542045464, "creation_date": 1542043802, "last_edit_date": 1542045464, "question_id": 53267239, "link": "https://stackoverflow.com/questions/53267239/print-contents-of-a-channel-in-go", "title": "Print contents of a channel in Go", "body": "<p>How can I print the contents of a channel in Go?</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    ok := make(chan int)\n    ok &lt;- 1\n    x := &lt;- ok\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>As I understand, <code>ok</code> is a channel which can store an integer value. So, how can I print its contents?</p>\n\n<p><code>fmt.Println(ok)</code> doesn't print the value stored inside the channel.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542042710, "post_id": 53266940, "comment_id": 93418055, "body": "&quot;Is there any way to get it with Go without using os.exec and parsing the output?&quot; I don&#39;t see any reason why not; you know the command to get the output and you know what format it&#39;s in. Are you having some trouble doing that? Can you show the code you&#39;re having trouble with?"}, {"owner": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542042803, "post_id": 53266940, "comment_id": 93418101, "body": "@Adrian it works, but I wonder if there is a better and cleaner way to get this information."}], "answers": [{"comments": [{"owner": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "edited": false, "score": 0, "creation_date": 1542106844, "post_id": 53267387, "comment_id": 93440815, "body": "I think, in macOS one has to replace <code>Ctim</code> with <code>Ctimespec</code>"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "edited": false, "score": 0, "creation_date": 1542115316, "post_id": 53267387, "comment_id": 93445440, "body": "If that&#39;s true then in <code>f.Sys()</code> it need to be other typ because <code>syscall.Stat_t</code> don&#39;t have <code>Ctimspec</code>. If Ctim is not accessible you need to call reflection on <code>f.Sys()</code> to get it type."}, {"owner": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "edited": false, "score": 0, "creation_date": 1542120217, "post_id": 53267387, "comment_id": 93448558, "body": "In mac <code>syscall.Stat_t</code> doesn&#39;t have <code>Ctim</code>, but has <code>Ctimspec</code>, it seems to be the same."}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "edited": false, "score": 0, "creation_date": 1542124368, "post_id": 53267387, "comment_id": 93451443, "body": "Indeed <a href=\"https://golang.org/src/syscall/ztypes_darwin_amd64.go\" rel=\"nofollow noreferrer\">golang.org/src/syscall/ztypes_darwin_amd64.go</a> line <code>76</code> <code>syscall.Stat_t</code> for <code>darwin</code> os have <code>Ctimespec</code>. It&#39;s wired why they do that beetwen os&#39;es"}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 3, "last_activity_date": 1542044403, "creation_date": 1542044403, "answer_id": 53267387, "question_id": 53266940, "link": "https://stackoverflow.com/questions/53266940/get-change-date-of-a-folder-in-go/53267387#53267387", "title": "Get change date of a folder in Go", "body": "<p>Change time is not accessible in <code>os.FileInfo</code> but can be get via <code>os.FileInfo.Sys()</code> which stores that data.</p>\n\n<p>You can get it by </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n    f, err := os.Stat(\"your/dir\")\n    if err != nil {\n        log.Fatalf(\"err reading: %v\", err)\n    }\n\n    //access change time saved in os.FileInfo.Sys()\n    changeTime := f.Sys().(*syscall.Stat_t).Ctim\n\n    fmt.Print(time.Unix(changeTime.Unix()).String())\n}\n</code></pre>\n\n<p>Ofcourse you need to check if <code>f.Sys()</code> it's proper type, but yeah <code>syscall.Stat_t.Ctim</code> is probably what you wanted.</p>\n"}, {"tags": [], "owner": {"reputation": 2864, "user_id": 1196369, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/16777b8b25858df69e496a07abfab395?s=128&d=identicon&r=PG", "display_name": "mickadoo", "link": "https://stackoverflow.com/users/1196369/mickadoo"}, "is_accepted": false, "score": 1, "last_activity_date": 1542045660, "creation_date": 1542045660, "answer_id": 53267682, "question_id": 53266940, "link": "https://stackoverflow.com/questions/53266940/get-change-date-of-a-folder-in-go/53267682#53267682", "title": "Get change date of a folder in Go", "body": "<p>If you're happy with calling os.Exec maybe you don't mind cross-platform issues. There was some discussion about this on a <a href=\"https://github.com/golang/go/issues/3952\" rel=\"nofollow noreferrer\">github issue</a> a while back.</p>\n\n<p>This code works for me to get the changed time anyway. Not sure how/if it'll work on Windows:</p>\n\n<pre><code>file, err := os.Open(\"test\")\nif err != nil {\n    panic(err)\n}\n\nstat, err := file.Stat()\nsys := stat.Sys().(*syscall.Stat_t)\nchangedTime := time.Unix(sys.Ctim.Unix())\n\nfmt.Println(stat.ModTime())\nfmt.Println(changedTime)\n</code></pre>\n\n<p>When I run </p>\n\n<pre><code>mv test test1 &amp;&amp; mv test1 test &amp;&amp; go run main.go\n</code></pre>\n\n<p>It gives me:</p>\n\n<pre><code>2018-11-12 17:31:38.659095951 +0000 GMT\n2018-11-12 17:57:43.042208583 +0000 GMT\n</code></pre>\n\n<p>Which seems to correctly reflect the time I changed the dirname, and not the creation time (as in the first date)</p>\n"}], "owner": {"reputation": 583, "user_id": 4634819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d3e147511d910234ff745620b0960cb2?s=128&d=identicon&r=PG&f=1", "display_name": "lawful_neutral", "link": "https://stackoverflow.com/users/4634819/lawful-neutral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 53267387, "answer_count": 2, "score": 2, "last_activity_date": 1542045660, "creation_date": 1542042477, "question_id": 53266940, "link": "https://stackoverflow.com/questions/53266940/get-change-date-of-a-folder-in-go", "title": "Get change date of a folder in Go", "body": "<p>I want to get the date when a folder was renamed, from terminal it can be done using the <code>stat</code> command, e.g.:</p>\n\n<pre><code>&gt; stat -x folders/folder1\nFile: \"folders/folder1\"\nSize: 64           FileType: Directory\nMode: (0755/drwxr-xr-x)         Uid: (2006390509/username)  Gid: \n(296108113/EMEA\\Domain Users)\nDevice: 1,4   Inode: 2599274    Links: 2\nAccess: Mon Nov 12 17:59:57 2018\nModify: Mon Nov 12 14:12:20 2018\nChange: Mon Nov 12 17:28:01 2018 \n</code></pre>\n\n<p>The change date is the last date the folder's metadata was changed, which includes renaming.</p>\n\n<p>Is there any way to get it with Go without using <code>os.exec</code> and parsing the output? <code>os.Stat</code> seems to provide only the last modification date which doesn't change when the folder is renamed.</p>\n"}, {"tags": ["postgresql", "go", "psql"], "answers": [{"comments": [{"owner": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110507, "post_id": 53267047, "comment_id": 93442844, "body": "It says: <code>sql: expected 1 destination arguments in Scan, not 2</code>"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110657, "post_id": 53267047, "comment_id": 93442926, "body": "What exact PG library are you using? Is it this one: <a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">github.com/lib/pq</a>? How are you opening your database connection?"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110801, "post_id": 53267047, "comment_id": 93442989, "body": "Are you opening your DB connection like this: <code>db, err := sql.Open(&quot;postgres&quot;, connStr)</code>?"}, {"owner": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110838, "post_id": 53267047, "comment_id": 93443007, "body": "I use <code>github.com&#47;lib&#47;pq</code> as DB driver, but to connect DB I use <code>github.com&#47;xo&#47;dburl</code>"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110936, "post_id": 53267047, "comment_id": 93443064, "body": "Can you post how you are opening your database connection?"}, {"owner": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542110963, "post_id": 53267047, "comment_id": 93443078, "body": "to connect DB I use this: <code>db, err := dburl.Open(&quot;pgsql:&#47;&#47;user:pass@host&#47;dbname?sslmode=disable&quot;)</code>"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 0, "creation_date": 1542111182, "post_id": 53267047, "comment_id": 93443204, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/183559/discussion-between-ssemilla-and-alex-chaliy\">continue this discussion in chat</a>."}, {"owner": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "edited": false, "score": 1, "creation_date": 1542112112, "post_id": 53267047, "comment_id": 93443649, "body": "So <b>the solution is</b> to use <code>oid, balance</code> instead of <code>*</code> in sql query string, to use <code>db.QueryRow()</code> instead of <code>db.Query()</code>, and to use <code>row.Scan(&amp;_id, &amp;bal)</code> according to <code>oid, balance</code> in sql query string."}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1542043696, "last_edit_date": 1542043696, "creation_date": 1542042975, "answer_id": 53267047, "question_id": 53266413, "link": "https://stackoverflow.com/questions/53266413/go-lang-postgres-cannot-get-oid-after-scan/53267047#53267047", "title": "Go Lang, Postgres: cannot get oid after Scan", "body": "<p>Try this <code>q.Scan(&amp;_id, &amp;bal)</code>, <a href=\"https://golang.org/pkg/database/sql/#Row.Scan\" rel=\"nofollow noreferrer\">func (*Row) Scan</a> has this signature:</p>\n\n<pre><code>func (r *Row) Scan(dest ...interface{}) error\n</code></pre>\n\n<p>It expects the the pointers to the values where it will store the queried data.</p>\n\n<p>If you are only querying for a single row, there is <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow noreferrer\">func (*DB) QueryRow()</a>. Then your code will simplify to</p>\n\n<pre><code>row := db.QueryRow(sqlstr)\nerr := row.Scan(&amp;_id, &amp;bal)\n// err will be sql.ErrNoRows if no rows have been selected\n</code></pre>\n"}], "owner": {"reputation": 397, "user_id": 7455192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SFuGK.png?s=128&g=1", "display_name": "ame", "link": "https://stackoverflow.com/users/7455192/ame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 53267047, "answer_count": 1, "score": 0, "last_activity_date": 1542043696, "creation_date": 1542040453, "question_id": 53266413, "link": "https://stackoverflow.com/questions/53266413/go-lang-postgres-cannot-get-oid-after-scan", "title": "Go Lang, Postgres: cannot get oid after Scan", "body": "<p>I have 2 columns if table <code>accounts</code>: </p>\n\n<p><code>oid</code> and <code>balance</code></p>\n\n<p>By the next code I try to extract <code>oid</code> then <code>balance</code>:</p>\n\n<pre><code>// variable `id` comes from an another part\n\nsqlstr := `SELECT * ` +\n    `FROM accounts ` +\n    `WHERE oid=` + id + `;`\n\nq, err := db.Query(sqlstr)\n\nif err != nil {\n    fmt.Println(\"Error: GetAccount \\n\", err)\n    return Account{}, err\n}\ndefer q.Close()\n\n\nvar _id string\nvar bal float64\n\nq.Next()\nq.Scan(&amp;_id)\nfmt.Println(\"_id \", _id)\n\n\nq.Next()\nq.Scan(&amp;bal)\nfmt.Println(\"bal \", bal)\n</code></pre>\n\n<p>After the first <code>q.Next()</code> I expected to extract <code>oid</code> and after the second to extract <code>balance</code>.</p>\n\n<p>But every time after the first <code>q.Next()</code> and after the second I only get <code>balance</code>.</p>\n\n<p>I tried to change <code>sqlstr</code> to the next:</p>\n\n<pre><code>sqlstr := `SELECT oid, balance ` +\n    `FROM accounts ` +\n    `WHERE oid=` + id + `;`\n</code></pre>\n\n<p>But I still cannot extract oid.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035406, "post_id": 53264958, "comment_id": 93414023, "body": "Never used go, but if the scanner is using either \\r\\n or \\n to detect the end of line, you&#39;ll need to find a way to tell it you want the crlf or lf returning along with the other data it gives you, if that&#39;s even possible.. In the other langs I&#39;ve used, when the data is delimited (eg in this case by \\r\\n or \\n) you don&#39;t get the delimiter when you ask it to read the next chunk of delimited data. What problem with the length are you actually trying to solve? Why do you care if it&#39;s \\r\\n or \\n ?"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035517, "post_id": 53264958, "comment_id": 93414084, "body": "@CaiusJard I just added a bit more about what I&#39;m trying to do. I&#39;m talking to an IMAP server, and when I get to the body part, it returns an atom (brackets with the size of the following text, followed by the text), and the numbers don&#39;t match up. It&#39;s worked so far on ~50,000 emails, so I think this email might contain <code>\\n</code> that the server didn&#39;t change to <code>\\r\\n</code>"}, {"owner": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035566, "post_id": 53264958, "comment_id": 93414107, "body": "ps; point to the scanning tag: <i><code>scanning</code> - this tag should not be used for network, text or file scans</i>"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035602, "post_id": 53264958, "comment_id": 93414132, "body": "@CaiusJard Oh whoops, I&#39;ll remove that"}, {"owner": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035706, "post_id": 53264958, "comment_id": 93414186, "body": "I wouldn&#39;t expect the server to modify the content of the email for \\r\\n vs \\n might be a windows vs unix vs mac mail client.. If you&#39;re wondering if data is missing, try examining whether <code>bytes + (lines) = atom</code> or <code>bytes + (2*lines) = atom</code> - if neither, then bytes are missing?"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 46070, "user_id": 1410664, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/vGygm.gif?s=128&g=1", "display_name": "Caius Jard", "link": "https://stackoverflow.com/users/1410664/caius-jard"}, "edited": false, "score": 0, "creation_date": 1542035846, "post_id": 53264958, "comment_id": 93414272, "body": "@CaiusJard exactly the problem, this email&#39;s bytes doesn&#39;t match the atom size, which is a problem because there&#39;s no other way to tell where the atom ends if I can&#39;t get accurate counts regarding the type of newline used. Maybe I can get the scanner to scan forward a set number of bytes instead..."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1542036638, "post_id": 53264958, "comment_id": 93414717, "body": "sounds like a job for tcpdump"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1542037175, "post_id": 53264958, "comment_id": 93415000, "body": "I am not familiar with the imap protocotl, but if 7060 is a count of bytes, then you should slurp up that number of bytes instead of reading line by line.  Also, scanners buffer data.  If you create and discard scanners per body, you will discard buffered data."}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542037256, "post_id": 53264958, "comment_id": 93415043, "body": "@ThunderCat that&#39;s the route I&#39;ve been attempting for the last few minutes, but I can&#39;t figure out how to do that in Go with their Scanner. There&#39;s an <code>advance</code> method on Scanners but it&#39;s not exported for some reason, so I can&#39;t call it from my code"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1542037320, "post_id": 53264958, "comment_id": 93415067, "body": "bufio.Scanner is a high level API. Use <a href=\"https://golang.org/pkg/bufio/#Reader\" rel=\"nofollow noreferrer\">bufio.Reader</a> for finer control, including the possibility to read N bytes (typically via <a href=\"https://golang.org/pkg/io/#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull</a>)."}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542037707, "post_id": 53264958, "comment_id": 93415265, "body": "@Peter looking through the doc this looks like the actual tool for the job. On a separate note, my suspicions were correct, this email was containing a mixture of crlf and lf"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1542037715, "post_id": 53264958, "comment_id": 93415269, "body": "@BrianLeishman Don&#39;t use Scanner. It is only appropriate for reading delimited values (lines, words, etc), but that&#39;s not what you have.  As Peter mentioned, bufio.Reader is a better choice.  There are <a href=\"https://godoc.org/?q=imap\" rel=\"nofollow noreferrer\">serveral imap packages</a> for Go.  You might want to look at how the packages are implemented or possibly just use one."}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542038182, "post_id": 53264958, "comment_id": 93415511, "body": "@ThunderCat you are absolutely right, in fact, the bufio.Reader would actually solve some performance issues/other problems, too, so it definitely looks like the correct tool. While I found an answer to my literal question, I&#39;ll be changing my use to the Reader instead."}], "answers": [{"tags": [], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "is_accepted": true, "score": 0, "last_activity_date": 1542037982, "creation_date": 1542037982, "answer_id": 53265703, "question_id": 53264958, "link": "https://stackoverflow.com/questions/53264958/how-to-get-the-line-length-including-newline-when-using-scanner/53265703#53265703", "title": "How to get the line length including newline when using Scanner?", "body": "<p>While this is an answer answers my question in the literal sense about including the <code>\\n</code> and potential <code>\\r</code>, using the Scanner in in the first place while reading an IMAP server's responses is NOT the correct tool, and I will be rewriting my use of the Scanner and replacing it with bufio.Reader.</p>\n\n<hr>\n\n<p>You can specify custom split functions for use in your Scanner, so for example, you can port the ScanLines split function to one that doesn't drop the newline characters with the token that gets returned.</p>\n\n<pre><code>// ...\nr := bufio.NewScanner(d.conn)\nr.Split(func(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    if atEOF &amp;&amp; len(data) == 0 {\n        return 0, nil, nil\n    }\n    if i := bytes.IndexByte(data, '\\n'); i &gt;= 0 {\n        // We have a full newline-terminated line.\n        return i + 1, data[0 : i+1], nil\n    }\n    // If we're at EOF, we have a final, non-terminated line. Return it.\n    if atEOF {\n        return len(data), data, nil\n    }\n    // Request more data.\n    return 0, nil, nil\n})\n\nfor r.Scan() {\n    line := r.Text()\n    len(line) // now gets the line length WITH the newline\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 0, "last_activity_date": 1542039631, "creation_date": 1542039631, "answer_id": 53266186, "question_id": 53264958, "link": "https://stackoverflow.com/questions/53264958/how-to-get-the-line-length-including-newline-when-using-scanner/53266186#53266186", "title": "How to get the line length including newline when using Scanner?", "body": "<p>The default <code>SplitFunc</code> provided to <code>bufio.NewScanner</code> is <code>SplitLines</code> which includes a call to <code>dropCR</code> which, per the comments, matches on end-of-line <code>\\r?\\n</code>. Because the <code>Scanner</code> will optionally find and drop carriage returns, you won't be able to find the full length of a line using the <code>bufio.Scanner</code>. </p>\n\n<p>From my experience, it's common to use the Scanner when things are basic, as it's a convenience struct. Otherwise bufio.Reader provides more flexibility. <code>bufio.Reader#ReadBytes(delim byte)</code> will give you what you're looking for. </p>\n"}], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 53265703, "answer_count": 2, "score": 0, "last_activity_date": 1542039631, "creation_date": 1542035259, "last_edit_date": 1542035617, "question_id": 53264958, "link": "https://stackoverflow.com/questions/53264958/how-to-get-the-line-length-including-newline-when-using-scanner", "title": "How to get the line length including newline when using Scanner?", "body": "<p>I'm using <code>Scan</code> to scan lines 1 at a time from an IMAP connection, which are supposed to end with <code>\\r\\n</code>, but I suspect some of the lines I'm getting are actually ending in just <code>\\n</code>, because I'm getting an incorrect amount of data when parsing the body atom in a particular instance </p>\n\n<p>(<code>* 8620 FETCH (BODY[] {7060}</code> is what I'm getting for the body in just this one email, but that seems to be longer than the count if count newlines as 2 bytes)</p>\n\n<pre><code>// ...\nr := bufio.NewScanner(d.conn)\nfor r.Scan() {\n    line := r.Text()\n    len(line) // gets the line length WITHOUT the newline\n}\n</code></pre>\n\n<p>Would there be any way to get the length with the newline? Or get the length of the token that the scanner stopped with?</p>\n"}, {"tags": ["go", "redis", "redigo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1542035024, "post_id": 53264855, "comment_id": 93413812, "body": "It&#39;s really inefficient. The entire point of a connection pool is to re-use connections and avoid the overhead involved in establishing a new connection. <a href=\"https://en.wikipedia.org/wiki/Connection_pool\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Connection_pool</a>"}, {"owner": {"reputation": 1720, "user_id": 778694, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/25a12b26dbcf89f0959f6af01be427e6?s=128&d=identicon&r=PG&f=1", "display_name": "franklin", "link": "https://stackoverflow.com/users/778694/franklin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542035048, "post_id": 53264855, "comment_id": 93413831, "body": "Cool. So singleton access is the way to go."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1542036771, "post_id": 53264855, "comment_id": 93414780, "body": "Redigo&#39;s <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#Pool\" rel=\"nofollow noreferrer\">pool documentation</a> describes how to use a pool in a web application. You should  create a single pool and share it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1542038221, "post_id": 53264855, "comment_id": 93415540, "body": "See also <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#hdr-Concurrency\" rel=\"nofollow noreferrer\">Redigo&#39;s documentation on allowed concurrency</a>.  Redigo does not have a &quot;client&quot; type as mentioned in question. Redigo does have a threadsafe pool and a partially unsafe connection."}], "answers": [{"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 3, "last_activity_date": 1542051631, "creation_date": 1542051631, "answer_id": 53269005, "question_id": 53264855, "link": "https://stackoverflow.com/questions/53264855/best-way-to-provide-redis-client-for-extensible-go-applications/53269005#53269005", "title": "Best way to provide redis client for extensible go applications", "body": "<p>Correct answer is already provided in comments, although I still want to add my 5 cents. </p>\n\n<p>Your question mixes up two concepts - concurrency and <a href=\"https://en.wikipedia.org/wiki/Pooling_(resource_management)\" rel=\"nofollow noreferrer\">resource pool</a>.</p>\n\n<p>Concurrent code makes sure that several execution flows safely work inside the same application using shared memory.\nIn our example we have multiple http requests from our users and handlers code for these requests that is executed concurrently. DB connection is part of that flow and required for request execution.</p>\n\n<p>Concurrent code should be abble to use DB connection and open/close connection if necessary. </p>\n\n<p>Although, concurrency has nothing to do with rules defining how many connections should be opened at any given time and how these connections should be reused/shared:</p>\n\n<ul>\n<li>Someone can create DB connection per request and that code is\nconcurrent. </li>\n<li>Someone can use some shared DB connection(s) and that\ncode is concurrent as long as multiple requests does not interfere\nwith each other. What is typically achieved with memory locks.</li>\n</ul>\n\n<p>Connection Pool, from other side, is pattern that provides efficient way to handle DB connections. \nWhy managing connections lifetime is important:</p>\n\n<ol>\n<li>Connection is expensive to open </li>\n<li>Connection expensive to keep alive without using as database can keep only limited number of open connections.</li>\n</ol>\n\n<p>With connection pool you can control:</p>\n\n<ol>\n<li>How many connection are always open - warm up slow resource</li>\n<li>Max number of open connection - prevent opening too many connections</li>\n<li>Connection timeout - balancing between connections reuse and releasing not used resources </li>\n</ol>\n\n<p>Maintaining connection or connection pool per request does not allow efficient connections reuse. Every request is slowed down with connection opening overhead, spike in traffic will cause opening too many connections and etc. </p>\n\n<p>Typically application has one connection pool shared between all requests. </p>\n\n<p>Sometimes, developers create several pools for different types of connections. For example one pool for transactional operations and one for reports.</p>\n"}], "owner": {"reputation": 1720, "user_id": 778694, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/25a12b26dbcf89f0959f6af01be427e6?s=128&d=identicon&r=PG&f=1", "display_name": "franklin", "link": "https://stackoverflow.com/users/778694/franklin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 697, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542051631, "creation_date": 1542034910, "question_id": 53264855, "link": "https://stackoverflow.com/questions/53264855/best-way-to-provide-redis-client-for-extensible-go-applications", "title": "Best way to provide redis client for extensible go applications", "body": "<p>I'm using redigo in an application and I'm wondering how my services should interface with Redis.</p>\n\n<p>Wikipedia has this to say about thread-safety:</p>\n\n<blockquote>\n  <p>Thread safety is a computer programming concept applicable to multi-threaded code. Thread-safe code only manipulates shared data structures in a manner that ensures that all threads behave properly and fulfill their design specifications without unintended interaction. </p>\n</blockquote>\n\n<p>What I interpret this to mean is that if a data-structure needs to be accessed by multiple clients (hundreds, thousands if not millions in today's micro-service world) thread-safety is the way in which we ensure that state is correctly preserved in the system regardless of which client accesses the data and when. This means resolving access priority (which client got there first), ensuring lock on mutation (only one client can write at a time) while promoting concurrency (many clients can read the data if there is no change). </p>\n\n<p>From what I've gathered, a redigo client can be used by multiple \"goroutines\" (or threads) concurrently. That leads me to believe that a singleton implementation like I'm familiar with in Java should suffice.</p>\n\n<p>I see examples, e.g., <a href=\"https://github.com/gilcrest/redigo-example/blob/master/main.go\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://gist.github.com/peterhellberg/9450839\" rel=\"nofollow noreferrer\">here</a>, where Redis connections (<code>pool</code>s) are simply created in the <code>main</code> method and passed in to various redigo functions. That doesn't seem like the most robust way to get things done, although they do appear to be following the singleton pattern. (Understandably the second post is really just a quick n'dirty API.)</p>\n\n<p>I would do it like this:</p>\n\n<ol>\n<li><p>In the <code>main</code> function call <code>init</code> which returns a redigo <code>pool</code>.</p></li>\n<li><p>Create handler functions (controllers) that accept a <code>pool</code> as a param (a sort of \"dirty\" dependency injection). </p></li>\n</ol>\n\n<p>This would (I think) ensure that only a single <code>pool</code> is ever created. </p>\n\n<p>Alternatively, is there any reason why I can't create a <code>pool</code> (client) every time I want to access the data store? If the client is killed after the transaction is complete, is there any issue with spinning up a new <code>pool</code> every time a handler receives a request?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1542034020, "post_id": 53264548, "comment_id": 93413238, "body": "I don&#39;t know that it&#39;s bad practice but it&#39;s highly unusual and looks like an XY Problem. What are you actually trying to do with this - what problem are you solving?"}, {"owner": {"reputation": 91, "user_id": 7411328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1556552474370118/picture?type=large", "display_name": "Gustav Eiman", "link": "https://stackoverflow.com/users/7411328/gustav-eiman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1542034641, "post_id": 53264548, "comment_id": 93413596, "body": "I&#39;m attempting to acumulate data for a &quot;sendmany&quot; rpc call to a bitcoin core node. Now I&#39;m thinking that this could be easier with a chan of strings than funcs... The idea is, if i have enough requests, send them as one payment to several people and I can pay a lower fee. <a href=\"https://bitcoincore.org/en/doc/0.16.0/rpc/wallet/sendmany/\" rel=\"nofollow noreferrer\">bitcoin core ref.</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1542035130, "post_id": 53264548, "comment_id": 93413873, "body": "1) Durable storage may be more appropriate for this scenario.  The application will lose payments if the application exits (possibly due to a crash).  2) To avoid adding arbitrarily large amount of latency, you may want to chunk by time rather than by count. 3) Ignoring these possible issues with your scenario, the code is OK."}, {"owner": {"reputation": 91, "user_id": 7411328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1556552474370118/picture?type=large", "display_name": "Gustav Eiman", "link": "https://stackoverflow.com/users/7411328/gustav-eiman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1542035638, "post_id": 53264548, "comment_id": 93414150, "body": "@ThunderCat Thanks! Feels like a well needed sanity check and great advice!"}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1563917497, "post_id": 53264548, "comment_id": 100858082, "body": "I would like to say this. The code I added below is in production, running v fast."}], "answers": [{"comments": [{"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1542044668, "post_id": 53266569, "comment_id": 93418997, "body": "I think it would be better to use mutexes or waitgroups so that a timer isn&#39;t required."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1542044723, "post_id": 53266569, "comment_id": 93419024, "body": "@dustinevan I don&#39;t think I understand what you mean. Can you elaborate?"}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1542050598, "post_id": 53266569, "comment_id": 93421355, "body": "this is not perfectly objective, but go&#39;s concurrency constructs exist to allow developers to orchestrate systems where data flows via a reactive model. e.g. you do something when something needs to be done, rather than asking whether something needs to be done, and doing when the answer is yes. Using a timer is a polling model, rather than a reactive one."}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1563917371, "post_id": 53266569, "comment_id": 100858043, "body": "Saw this again. Is the point to only take individual pieces of data as fast as the duration (in this case time.Second) will allow? When data is available from &lt;-ch, it will append the task and then wait for 1 second. I don&#39;t feel like rate limiting is part of the question here."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1564757358, "post_id": 53266569, "comment_id": 101147743, "body": "It doesn&#39;t rate limit. The timer is to flush partial batches. If the channel is always receiving data, the timer never fires"}], "tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": true, "score": 3, "last_activity_date": 1564757141, "last_edit_date": 1564757141, "creation_date": 1542041068, "answer_id": 53266569, "question_id": 53264548, "link": "https://stackoverflow.com/questions/53264548/wait-for-n-items-in-channel-before-executing-sequentially/53266569#53266569", "title": "Wait for N items in channel before executing sequentially", "body": "<p>Based on a few comments, it looks like what you are looking for is some form of batching.</p>\n\n<p>Batching has a few scenarios when you would want to take the batch and send it along:</p>\n\n<ol>\n<li>Batch size is sufficient size</li>\n<li>Enough time has passed and a partial batch should be flushed</li>\n</ol>\n\n<p>Your given example does not account for the second scenario. This can lead to some awkward behavior if you just never flush because you quit getting load.</p>\n\n<p>Therefore I would recommend either looking into a library (e.g., <a href=\"https://github.com/cloudfoundry/go-batching\" rel=\"nofollow noreferrer\">cloudfoundry/go-batching</a>) or simply use channels, a Timer and a select statement.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ch := make(chan string)\n    go func() {\n        tasks := []string{}\n        timer := time.NewTimer(time.Second) // Adjust this based on a reasonable user experience\n        for {\n            select {\n            case &lt;-timer.C:\n                fmt.Println(\"Flush partial batch due to time\")\n                flush(tasks)\n                tasks = nil\n                timer.Reset(time.Second)\n            case data := &lt;-ch:\n                tasks = append(tasks, data)\n\n                // Reset the timer for each data point so that we only flush\n                // partial batches when we stop receiving data.\n                if !timer.Stop() {\n                    &lt;-timer.C\n                }\n                timer.Reset(time.Second)\n\n                // Guard clause to for batch size\n                if len(tasks) &lt; 3 {\n                    fmt.Println(\"Queue still too small\")\n                    continue\n                }\n\n                flush(tasks)\n                tasks = nil // reset tasks\n            }\n        }\n    }()\n\n    ch &lt;- \"Msg 1\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 2\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 3\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 4\"\n    time.Sleep(time.Second)\n}\n\nfunc flush(tasks []string) {\n    // Guard against emtpy flushes\n    if len(tasks) == 0 {\n        return\n    }\n\n    fmt.Println(\"Flush\")\n    for _, t := range tasks {\n        fmt.Println(t)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 2, "last_activity_date": 1542051109, "last_edit_date": 1542051109, "creation_date": 1542050321, "answer_id": 53268715, "question_id": 53264548, "link": "https://stackoverflow.com/questions/53264548/wait-for-n-items-in-channel-before-executing-sequentially/53268715#53268715", "title": "Wait for N items in channel before executing sequentially", "body": "<p>I can see how something that batches results could be useful. But it does require a custom solution. There are many ways to solve this problem--I tried using <code>Sync.WaitGroup</code> but it got messy. It seems like using a <code>sync.Mutex</code> to lock the batching function is the best way. But, when mutex is the nicest answer imo that should trigger a recheck of the design because, again imo, it should be the last option. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"sync\"\n    \"sync/atomic\"\n)\n\nfunc main() {\n\n    ctx, canc := context.WithCancel(context.Background())\n    acc := NewAccumulator(4, ctx)\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            acc.Write(\"hi\")\n        }\n        canc()\n    }()\n\n    read := acc.ReadChan()\n    for batch := range read {\n        fmt.Println(batch)\n    }\n    fmt.Println(\"done\")\n}\n\ntype Accumulator struct {\n    count    int64\n    size     int\n    in       chan string\n    out      chan []string\n    ctx      context.Context\n    doneFlag int64\n    mu   sync.Mutex\n}\n\nfunc NewAccumulator(size int, parentCtx context.Context) *Accumulator {\n    a := &amp;Accumulator{\n        size: size,\n        in:   make(chan string, size),\n        out:  make(chan []string, 1),\n        ctx:  parentCtx,\n    }\n\n    go func() {\n        &lt;-a.ctx.Done()\n        atomic.AddInt64(&amp;a.doneFlag, 1)\n        close(a.in)\n        a.mu.Lock()\n        a.batch()\n        a.mu.Unlock()\n        close(a.out)\n    }()\n    return a\n}\n\nfunc (a *Accumulator) Write(s string) {\n    if atomic.LoadInt64(&amp;a.doneFlag) &gt; 0 {\n        panic(\"write to closed accumulator\")\n    }\n    a.in &lt;- s\n    atomic.AddInt64(&amp;a.count, 1)\n    a.mu.Lock()\n    if atomic.LoadInt64(&amp;a.count) == int64(a.size) {\n        a.batch()\n    }\n    a.mu.Unlock()\n}\n\nfunc (a *Accumulator) batch() {\n    batch := make([]string, 0)\n    for i := 0; i &lt; a.size; i++ {\n        msg := &lt;-a.in\n        if msg != \"\" {\n            batch = append(batch, msg)\n        }\n    }\n    fmt.Println(\"batching\", batch)\n    a.out &lt;- batch\n    atomic.StoreInt64(&amp;a.count, 0)\n}\n\nfunc (a *Accumulator) ReadChan() &lt;-chan []string {\n    return a.out\n}\n</code></pre>\n\n<p>It probably would be best of just have a slice that accumulates strings and when that slice reaches some size, then you kick off some processing.  </p>\n"}], "owner": {"reputation": 91, "user_id": 7411328, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1556552474370118/picture?type=large", "display_name": "Gustav Eiman", "link": "https://stackoverflow.com/users/7411328/gustav-eiman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 53266569, "answer_count": 2, "score": 1, "last_activity_date": 1564757141, "creation_date": 1542033821, "last_edit_date": 1542040271, "question_id": 53264548, "link": "https://stackoverflow.com/questions/53264548/wait-for-n-items-in-channel-before-executing-sequentially", "title": "Wait for N items in channel before executing sequentially", "body": "<p>So I am very new to go! But I had this idea about something I wanted to try.</p>\n\n<p>I would like to have a go routine that accepts strings from a channel but only after it has received N strings should it execute on them.</p>\n\n<p>I looked around for similar questions or cases but I only found ones where the idea was to execute several routines in parallel and wait to aggregate the result.</p>\n\n<p>I though about the idea of creating an array and just pass it to a routine where the length was sufficient. However I want to keep a certain separation of concerns and control this on the receiving end.</p>\n\n<p>My questions are.</p>\n\n<ol>\n<li>Is this bad practice for some reason?</li>\n<li><p>Is there a better way to do this, what is it?</p>\n\n<pre><code>func main() {\n    ch := make(chan string)\n    go func() {\n        tasks := []string{}\n        for {\n            tasks = append(tasks,&lt;- ch)\n\n            if len(tasks) &lt; 3 {\n                fmt.Println(\"Queue still to small\")\n            }\n            if len(tasks) &gt; 3 {\n                for i := 0; i &lt; len(tasks); i++ {\n                    fmt.Println(tasks[i])\n                }\n            }\n        }\n    }()\n\n    ch &lt;- \"Msg 1\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 2\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 3\"\n    time.Sleep(time.Second)\n    ch &lt;- \"Msg 4\"\n    time.Sleep(time.Second)\n}\n</code></pre></li>\n</ol>\n\n<p>Edit for simpler more accurate example.</p>\n"}, {"tags": ["docker", "go", "jenkins", "jenkins-pipeline"], "answers": [{"tags": [], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "is_accepted": true, "score": 1, "last_activity_date": 1542092492, "creation_date": 1542092492, "answer_id": 53275497, "question_id": 53264540, "link": "https://stackoverflow.com/questions/53264540/jenkins-golang-declarative-pipeline-build-docker-image-and-push-to-docker-hub/53275497#53275497", "title": "Jenkins Golang Declarative Pipeline: Build Docker Image and Push to Docker Hub", "body": "<p>I figured it out.</p>\n\n<p>My updated <code>Jenkinsfile</code> is as follows:</p>\n\n<pre><code>#!/usr/bin/env groovy\n// The above line is used to trigger correct syntax highlighting.\n\npipeline {\n    // Lets Jenkins use Docker for us later.\n    agent any    \n\n    // If anything fails, the whole Pipeline stops.\n    stages {\n        stage('Build &amp; Test') {   \n            // Use golang.\n            agent { docker { image 'golang' } }\n\n            steps {                                           \n                // Create our project directory.\n                sh 'cd ${GOPATH}/src'\n                sh 'mkdir -p ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our Jenkins workspace to our project directory.                \n                sh 'cp -r ${WORKSPACE}/* ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our \"vendor\" folder to our \"src\" folder.\n                sh 'cp -r ${WORKSPACE}/vendor/* ${GOPATH}/src'\n\n                // Build the app.\n                sh 'go build'               \n            }            \n        }\n\n        stage('Test') {\n            // Use golang.\n            agent { docker { image 'golang' } }\n\n            steps {                 \n                // Create our project directory.\n                sh 'cd ${GOPATH}/src'\n                sh 'mkdir -p ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our Jenkins workspace to our project directory.                \n                sh 'cp -r ${WORKSPACE}/* ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our \"vendor\" folder to our \"src\" folder.\n                sh 'cp -r ${WORKSPACE}/vendor/* ${GOPATH}/src'\n\n                // Remove cached test results.\n                sh 'go clean -cache'\n\n                // Run Unit Tests.\n                sh 'go test ./... -v -short'            \n            }\n        }      \n\n        stage('Docker') {         \n            environment {\n                // Extract the username and password of our credentials into \"DOCKER_CREDENTIALS_USR\" and \"DOCKER_CREDENTIALS_PSW\".\n                // (NOTE 1: DOCKER_CREDENTIALS will be set to \"your_username:your_password\".)\n                // The new variables will always be YOUR_VARIABLE_NAME + _USR and _PSW.\n                // (NOTE 2: You can't print credentials in the pipeline for security reasons.)\n                DOCKER_CREDENTIALS = credentials('my-docker-credentials-id')\n            }\n\n            steps {                           \n                // Use a scripted pipeline.\n                script {\n                    node {\n                        def app\n\n                        stage('Clone repository') {\n                            checkout scm\n                        }\n\n                        stage('Build image') {                            \n                            app = docker.build(\"${env.DOCKER_CREDENTIALS_USR}/my-project-img\")\n                        }\n\n                        stage('Push image') {  \n                            // Use the Credential ID of the Docker Hub Credentials we added to Jenkins.\n                            docker.withRegistry('https://registry.hub.docker.com', 'my-docker-credentials-id') {                                \n                                // Push image and tag it with our build number for versioning purposes.\n                                app.push(\"${env.BUILD_NUMBER}\")                      \n\n                                // Push the same image and tag it as the latest version (appears at the top of our version list).\n                                app.push(\"latest\")\n                            }\n                        }              \n                    }                 \n                }\n            }\n        }\n    }\n\n    post {\n        always {\n            // Clean up our workspace.\n            deleteDir()\n        }\n    }\n}   \n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4253, "favorite_count": 3, "accepted_answer_id": 53275497, "answer_count": 1, "score": 1, "last_activity_date": 1542092492, "creation_date": 1542033802, "question_id": 53264540, "link": "https://stackoverflow.com/questions/53264540/jenkins-golang-declarative-pipeline-build-docker-image-and-push-to-docker-hub", "title": "Jenkins Golang Declarative Pipeline: Build Docker Image and Push to Docker Hub", "body": "<p>I'm trying to create a Docker image of my Golang project and upload it to Docker Hub via Jenkins Declarative Pipeline.</p>\n\n<p>I am able to build my project and run all my tests.</p>\n\n<p>My <code>Jenkinsfile</code> is as follows:</p>\n\n<pre><code>#!/usr/bin/env groovy\n// The above line is used to trigger correct syntax highlighting.\n\npipeline {\n    agent { docker { image 'golang' } }\n\n    stages {\n        stage('Build') {   \n            steps {                                           \n                // Create our project directory.\n                sh 'cd ${GOPATH}/src'\n                sh 'mkdir -p ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our Jenkins workspace to our project directory.                \n                sh 'cp -r ${WORKSPACE}/* ${GOPATH}/src/MY_PROJECT_DIRECTORY'\n\n                // Copy all files in our \"vendor\" folder to our \"src\" folder.\n                sh 'cp -r ${WORKSPACE}/vendor/* ${GOPATH}/src'\n\n                // Build the app.\n                sh 'go build'\n            }            \n        }\n\n        // Each \"sh\" line (shell command) is a step,\n        // so if anything fails, the pipeline stops.\n        stage('Test') {\n            steps {                                \n                // Remove cached test results.\n                sh 'go clean -cache'\n\n                // Run Unit Tests.\n                sh 'go test ./... -v'                                  \n            }\n        }           \n    }\n}   \n</code></pre>\n\n<p>My <code>Dockerfile</code> (if needed) is as follows:</p>\n\n<pre><code># Make a golang container from the \"golang alpine\" docker image from Docker Hub.\nFROM golang:1.11.2-alpine3.8\n\n# Expose our desired port.\nEXPOSE 9000\n\n# Create the proper directory.\nRUN mkdir -p $GOPATH/src/MY_PROJECT_DIRECTORY\n\n# Copy app to the proper directory for building.\nADD . $GOPATH/src/MY_PROJECT_DIRECTORY\n\n# Set the work directory.\nWORKDIR $GOPATH/src/MY_PROJECT_DIRECTORY\n\n# Run CMD commands.\nRUN go get -d -v ./...\nRUN go install -v ./...\n\n# Provide defaults when running the container.\n# These will be executed after the entrypoint.\n# For example, if you ran docker run &lt;image&gt;,\n# then the commands and parameters specified by CMD would be executed.\nCMD [\"MY_PROJECT\"]\n</code></pre>\n\n<p>I am able to get my Docker Hub credentials via:</p>\n\n<pre><code>environment {\n    // Extract the username and password of our credentials into \"DOCKER_CREDENTIALS_USR\" and \"DOCKER_CREDENTIALS_PSW\".\n    // (NOTE 1: DOCKER_CREDENTIALS will be set to \"your_username:your_password\".)\n    // The new variables will always be YOUR_VARIABLE_NAME + _USR and _PSW.\n    DOCKER_CREDENTIALS = credentials('MY_JENKINS_CREDENTIAL_ID')\n}\n</code></pre>\n\n<p>For reference, here is what I got to work in my Freestyle job:</p>\n\n<pre><code>Execute Shell:\n\n    # Log in to Docker.\n    sudo docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD\n\n    # Make a Docker image for our app.\n    cd /var/lib/jenkins/tools/org.jenkinsci.plugins.golang.GolangInstallation/Go/src/MY_PROJECT_DIRECTORY/\n    sudo docker build -t MY-PROJECT-img .\n\n    # Tag our Docker image.\n    sudo docker tag  MY-PROJECT-img   $DOCKER_USERNAME/MY-PROJECT-img\n\n    # Push our Docker image to Docker Hub.\n    sudo docker push $DOCKER_USERNAME/MY-PROJECT-img\n\n    # Log out of Docker.\n    docker logout\n</code></pre>\n\n<p>NOTE: I have given Jenkins sudo privileges by doing the following:</p>\n\n<ol>\n<li><p>Open the sudoers file for editing:</p>\n\n<p>sudo visudo -f /etc/sudoers</p></li>\n<li><p>Press \"i\" to go into INSERT mode.</p></li>\n<li><p>Paste the following:</p>\n\n<p>jenkins ALL=(ALL) NOPASSWD: ALL</p></li>\n<li><p>Press \"ESC\" to exit INSERT mode.</p></li>\n<li><p>To Save, enter:</p>\n\n<p>:w</p></li>\n<li><p>To Quit, enter:</p>\n\n<p>:q</p></li>\n</ol>\n\n<p>I believe this should be possible by adding a new <code>stage</code> and <code>agent</code> in my Declarative Pipeline, but I haven't found anything online.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1542023120, "post_id": 53261277, "comment_id": 93407161, "body": "Are you looking for Kind?"}, {"owner": {"reputation": 942, "user_id": 7147393, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nonlb.jpg?s=128&g=1", "display_name": "Russiancold", "link": "https://stackoverflow.com/users/7147393/russiancold"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1542023400, "post_id": 53261277, "comment_id": 93407303, "body": "@Volker As I said, I just want to ensure that key is a string"}], "answers": [{"tags": [], "owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "is_accepted": false, "score": 1, "last_activity_date": 1542023837, "creation_date": 1542023837, "answer_id": 53261684, "question_id": 53261277, "link": "https://stackoverflow.com/questions/53261277/reflect-type-comparison/53261684#53261684", "title": "Reflect Type comparison", "body": "<p>You can extract the <code>Kind</code> of the key and confront it with kind enumerations in <code>reflect</code> package like <code>reflect.String</code> as in:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n\n    obj := make(map[string]interface{})\n\n        fmt.Println(reflect.TypeOf(obj).Key().Kind() == reflect.String) // It will print true\n}\n</code></pre>\n\n<p>See this <a href=\"https://play.golang.org/p/ilNAI7e-0q_A\" rel=\"nofollow noreferrer\">Go Playground snippet</a> if you want to try it.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1542030697, "last_edit_date": 1542030697, "creation_date": 1542023953, "answer_id": 53261716, "question_id": 53261277, "link": "https://stackoverflow.com/questions/53261277/reflect-type-comparison/53261716#53261716", "title": "Reflect Type comparison", "body": "<p>Yes, what you did reports if the key type is \"exactly\" <code>string</code>.</p>\n\n<p>But for example if the key type would be a custom type having <code>string</code> as its underlying type, like in this example:</p>\n\n<pre><code>type mystr string\nm := map[mystr]int{}\n</code></pre>\n\n<p>Then the key type would not be equal to <code>reflect.TypeOf(\"\")</code>.</p>\n\n<p>It's up to you if this is what you want. If you do want to accept the above map types too, you may check the <em>kind</em> of the key if it equals to <code>reflect.String</code> like this:</p>\n\n<pre><code>if v.Type().Key() == reflect.TypeOf(\"\") {\n    fmt.Print(\"It is string\")\n}\n\nif v.Type().Key().Kind() == reflect.String {\n    fmt.Print(\"It is string kind\")\n}\n</code></pre>\n\n<p>For the above <code>map[mystr]int</code>, this is the output (try it on the <a href=\"https://play.golang.org/p/XKNV5GOw7GG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>It is string kind\n</code></pre>\n\n<p>(The key is not of type <code>string</code>, but it is of kind <code>string</code>.)</p>\n"}], "owner": {"reputation": 942, "user_id": 7147393, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nonlb.jpg?s=128&g=1", "display_name": "Russiancold", "link": "https://stackoverflow.com/users/7147393/russiancold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1709, "favorite_count": 0, "accepted_answer_id": 53261716, "answer_count": 2, "score": 0, "last_activity_date": 1542030697, "creation_date": 1542022330, "question_id": 53261277, "link": "https://stackoverflow.com/questions/53261277/reflect-type-comparison", "title": "Reflect Type comparison", "body": "<p>I want to ensure that the type of <code>map</code> keys is <code>string</code>. <code>Key()</code> method returns <code>Type</code> and I'm not sure what is the right way to check if it's <code>string</code>. The only thing came to my mind is:<br></p>\n\n<pre><code>if v.Type().Key() == reflect.TypeOf(\"\") {\n    fmt.Print(\"It is string\")\n}\n</code></pre>\n\n<p>Is it the right way?</p>\n"}, {"tags": ["go", "google-cloud-vision"], "answers": [{"comments": [{"owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "edited": false, "score": 0, "creation_date": 1542095118, "post_id": 53263424, "comment_id": 93434334, "body": "Thanks. If there is gRPC used it is not possible to get  JSON than . I have to make a JSON manually."}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "edited": false, "score": 0, "creation_date": 1542121612, "post_id": 53263424, "comment_id": 93449532, "body": "Yes. I updated my answer with a snippet to pretty print JSON for the annotation response."}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": false, "score": 3, "last_activity_date": 1542121556, "last_edit_date": 1542121556, "creation_date": 1542030014, "answer_id": 53263424, "question_id": 53259815, "link": "https://stackoverflow.com/questions/53259815/google-cloud-vision-api-golang-how-to-get-api-json/53263424#53263424", "title": "Google Cloud Vision API. Golang . How to get API JSON", "body": "<p>Is there something in particular you're looking for in the JSON? You could pretty-print the response object as JSON, if you trying to explore what's returned:</p>\n\n<pre><code>json, err := json.MarshalIndent(annotation, \"\", \"  \")\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Println(string(json))\n</code></pre>\n\n<p>It's a bit difficult to get the raw JSON response from this call because under the hood it's using gRPC, not JSON. If you follow the client code for a bit (it's open source), you'll eventually get to <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/blob/master/vision/apiv1/image_annotator_client.go#L142\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/google-cloud-go/blob/master/vision/apiv1/image_annotator_client.go#L142</a>:</p>\n\n<pre><code>func (c *ImageAnnotatorClient) BatchAnnotateImages(ctx context.Context, req *visionpb.BatchAnnotateImagesRequest, opts ...gax.CallOption) (*visionpb.BatchAnnotateImagesResponse, error) \n</code></pre>\n\n<p>You can see that function build up the request, send it, and return the response (the same proto response you get from calling the original function, restricted to <code>res.FullTextAnnotation</code>). See <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/blob/master/vision/apiv1/client.go#L109\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/google-cloud-go/blob/master/vision/apiv1/client.go#L109</a>.</p>\n"}], "owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1542121556, "creation_date": 1542017013, "last_edit_date": 1542033021, "question_id": 53259815, "link": "https://stackoverflow.com/questions/53259815/google-cloud-vision-api-golang-how-to-get-api-json", "title": "Google Cloud Vision API. Golang . How to get API JSON", "body": "<p>I use Google Cloud Vision API with the Go SDK.\nIn some cases I don't want to use Golang structures to read API results, I just want to get full JSON response of an API call. For example,</p>\n\n<pre><code>// detectDocumentText gets the full document text from the Vision API for an\n// image at the given file path.\nfunc detectDocumentTextURI(w io.Writer, file string) error {\n        ctx := context.Background()\n\n        client, err := vision.NewImageAnnotatorClient(ctx)\n        if err != nil {\n                return err\n        }\n\n        image := vision.NewImageFromURI(file)\n        annotation, err := client.DetectDocumentText(ctx, image, nil)\n        if err != nil {\n                return err\n        }\n\n        if annotation == nil {\n                fmt.Fprintln(w, \"No text found.\")\n        } else {\n                fmt.Fprintf(w, \"API Response %s\", ...JSON...)\n        }\n\n        return nil\n}\n</code></pre>\n\n<p>How can I get that JSON from annotation structure? Is it possible?</p>\n"}, {"tags": ["ssl", "go", "chunked-encoding"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1542015922, "post_id": 53258539, "comment_id": 93403320, "body": "Can you post something that exhibits the non-chunked response? I&#39;ve tried your code in my local machine and it works."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 2, "creation_date": 1542017902, "post_id": 53258539, "comment_id": 93404387, "body": "you are using http/2 and that doesn&#39;t support chunks"}, {"owner": {"reputation": 31, "user_id": 10639509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--RwZSIqQDnE/AAAAAAAAAAI/AAAAAAAAAAo/UZwwctILYLI/photo.jpg?sz=128", "display_name": "Mike Eller", "link": "https://stackoverflow.com/users/10639509/mike-eller"}, "reply_to_user": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1542018095, "post_id": 53258539, "comment_id": 93404492, "body": "Thanks for trying this @ssemilla.  I&#39;m executing my code from a docker container.  I&#39;ll strip this back and see what happens."}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 10639509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--RwZSIqQDnE/AAAAAAAAAAI/AAAAAAAAAAo/UZwwctILYLI/photo.jpg?sz=128", "display_name": "Mike Eller", "link": "https://stackoverflow.com/users/10639509/mike-eller"}, "is_accepted": false, "score": 1, "last_activity_date": 1542020005, "creation_date": 1542020005, "answer_id": 53260617, "question_id": 53258539, "link": "https://stackoverflow.com/questions/53258539/send-a-chunked-https-response-from-a-go-server/53260617#53260617", "title": "Send a chunked HTTPS response from a Go server", "body": "<pre><code>log.Infof(\"Protocol Version: %s\", request.Proto)\n</code></pre>\n\n<p>Confirms its using HTTP/2.0</p>\n\n<p>Thanks Vorsprung</p>\n"}], "owner": {"reputation": 31, "user_id": 10639509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--RwZSIqQDnE/AAAAAAAAAAI/AAAAAAAAAAo/UZwwctILYLI/photo.jpg?sz=128", "display_name": "Mike Eller", "link": "https://stackoverflow.com/users/10639509/mike-eller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1542020026, "creation_date": 1542012429, "last_edit_date": 1542020026, "question_id": 53258539, "link": "https://stackoverflow.com/questions/53258539/send-a-chunked-https-response-from-a-go-server", "title": "Send a chunked HTTPS response from a Go server", "body": "<p>The following the example works very nicely for <strong>HTTP</strong>: <a href=\"https://stackoverflow.com/questions/26769626/send-a-chunked-http-response-from-a-go-server\">Send a chunked HTTP response from a Go server</a></p>\n\n<p>As soon as I add TLS, I see that the responses are no longer chunked:</p>\n\n<pre><code>func main() {\n  http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    flusher, ok := w.(http.Flusher)\n    if !ok {\n      panic(\"expected http.ResponseWriter to be an http.Flusher\")\n    }\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n    for i := 1; i &lt;= 10; i++ {\n      fmt.Fprintf(w, \"Chunk #%d\\n\", i)\n      flusher.Flush() // Trigger \"chunked\" encoding and send a chunk...\n      time.Sleep(500 * time.Millisecond)\n    }\n  })\n\n  log.Print(\"Listening on localhost:8080\")\n  log.Fatal(http.ListenAndServeTLS(\":8080\", \"&lt;CERT_FILE&gt;\", \"&lt;KEY_FILE&gt;\", nil))\n}\n</code></pre>\n\n<p>Any ideas why this might be?</p>\n"}, {"tags": ["json", "go", "dynamic", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1542012704, "post_id": 53258522, "comment_id": 93401695, "body": "Thanks 1+ , is there a way to provide for example &quot;dyn1&quot; &amp; &quot;dyn2&quot; as <code>parameter</code> to the function like <code>args</code> and return only them ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1542012768, "post_id": 53258522, "comment_id": 93401723, "body": "Just iterate over fields you&#39;re interested in, and collect them from the map. That&#39;s easy."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1542012798, "post_id": 53258522, "comment_id": 93401739, "body": "Can you please provide example how would you do this ? becouse when I use struct I get it for free..."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1542012992, "last_edit_date": 1542012992, "creation_date": 1542012350, "answer_id": 53258522, "question_id": 53258248, "link": "https://stackoverflow.com/questions/53258248/fill-struct-dynamically-from-parameters/53258522#53258522", "title": "Fill struct dynamically from parameters", "body": "<p>If you don't know the fields in advance, then don't use a struct but something that is also \"dynamic\": a map.</p>\n\n<pre><code>type Service struct {\n    Resources []struct {\n        Model struct {\n            Name        string `json:\"name\"`\n            Credentials struct {\n                Path string                 `json:\"path\"`\n                Vts  map[string]interface{} `json:\"vts\"`\n            } `json:\"credentials\"`\n        } `json:\"model\"`\n    } `json:\"resources\"`\n}\n</code></pre>\n\n<p><code>map[sting]interface{}</code> can hold values of any type. If you know all fields will hold a <code>string</code> value, you may also use a <code>map[string]string</code> so it will be easier to work with it.</p>\n\n<p>Example with input JSON:</p>\n\n<pre><code>{\n    \"resources\": [\n      {\n        \"model\": {\n          \"name\": \"cred\",\n          \"credentials\": {\n            \"path\": \"path in fs\",\n            \"vts\": {\n              \"user\": \"stephane\", \n              \"id\": \"123\",\n              \"address\": \"some address\",\n              \"dyn1\": \"d1value\",\n              \"dyn2\": \"d2value\"\n            }\n          }\n        }\n      }\n    ]\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>service := Service{}\nerr := json.Unmarshal([]byte(data), &amp;service)\nfmt.Printf(\"%q %v\", service, err)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/dW-bBZR6NGN\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{[{{\"cred\" {\"path in fs\" map[\"dyn2\":\"d2value\" \"user\":\"stephane\" \"id\":\"123\" \n    \"address\":\"some address\" \"dyn1\":\"d1value\"]}}}]} &lt;nil&gt;\n</code></pre>\n\n<p>Now if you want to collect values from the <code>Vts</code> map for a set of keys, this is how you can do it:</p>\n\n<pre><code>args := []string{\"dyn1\", \"dyn2\"}\nvalues := make([]interface{}, len(args))\nfor i, arg := range args {\n    values[i] = service.Resources[0].Model.Credentials.Vts[arg]\n}\nfmt.Println(values)\n</code></pre>\n\n<p>Output of the above will be (try it on the <a href=\"https://play.golang.org/p/isl2gWk79Xa\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[d1value d2value]\n</code></pre>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "accepted_answer_id": 53258522, "answer_count": 1, "score": 3, "last_activity_date": 1542041168, "creation_date": 1542011068, "last_edit_date": 1542041168, "question_id": 53258248, "link": "https://stackoverflow.com/questions/53258248/fill-struct-dynamically-from-parameters", "title": "Fill struct dynamically from parameters", "body": "<p>I've the following struct which works as expected Im getting \ndata and I was  able </p>\n\n<pre><code>type Service struct {\n    Resources    []struct {\n        Model struct {\n            Name                string `json:\"name\"`\n            Credentials         struct {\n                path string `json:\"path\"`\n                Vts struct {\n                    user string `json:\"user\"`\n                    id    string `json:\"id\"`\n                    address      string `json:\"address\"`\n                } `json:\"vts\"`\n            } `json:\"credentials\"`\n        } `json:\"model\"`\n    } `json:\"resources\"`\n}\n\nservice:= Service{}\nerr := json.Unmarshal([]byte(data), &amp;service\n</code></pre>\n\n<p>The data is like following, </p>\n\n<p>service1</p>\n\n<pre><code>{\n    \"resources\": [\n        \"model\": {\n          \"name\": \"cred\",\n          \"credentials\": {\n            \"path\": \"path in fs\",\n            \"vts\": {\n              \"user\": \"stephane\", \n              \"id\": \"123\",\n              \"address\": \"some address\"\n            }\n          },\n        }\n      },\n</code></pre>\n\n<p>Now some services providing additional data under vts for example now we have 3 fields (user/id/address) but some services (service1) can provides additional data like email, secondName ,etc . but the big problem here is that \nI need to get it from parameters since (service 2) education, salary etc</p>\n\n<p>Service2 </p>\n\n<pre><code>{\n    \"resources\": [\n        \"model\": {\n          \"name\": \"cred\",\n          \"credentials\": {\n            \"path\": \"path in fs\",\n            \"vts\": {\n              \"user\": \"stephane\",\n              \"id\": \"123\",\n              \"address\": \"some address\",\n              \"email\" : \"some email\",\n              \"secondName\" : \"secondName\"\n            }\n          },\n        }\n      },\n</code></pre>\n\n<p>service N</p>\n\n<pre><code>{\n    \"resources\": [\n        \"model\": {\n          \"name\": \"cred\",\n          \"credentials\": {\n            \"path\": \"path in fs\",\n            \"vts\": {\n              \"user\": \"stephane\",\n              \"id\": \"123\",\n              \"address\": \"some address\",\n              \"salary\" : \"1000000\"\n            }\n          },\n        }\n      },\n</code></pre>\n\n<p>Of course If I know <strong>in advance</strong> the fields I can put them all in the struct and use <code>omitempty</code> <strong>but I dont know, I just get it as parameter to the function</strong> (the new properties names) , some service can provide 10 more fields in this struct (which I should get the properties name of them as <code>args[]</code>to the functions) but I don't know them in advance, this should be dynamic somehow ....is there a nice way to handle it in Golang ? </p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1542008316, "post_id": 53256373, "comment_id": 93399816, "body": "You can use <a href=\"https://github.com/bramvdbogaerde/go-scp\" rel=\"nofollow noreferrer\">github.com/bramvdbogaerde/go-scp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1542012827, "post_id": 53258613, "comment_id": 93401754, "body": "If you don&#39;t want to go through the trouble of writing this, there are already packages out there that has this functionality: <a href=\"https://github.com/bramvdbogaerde/go-scp\" rel=\"nofollow noreferrer\">github.com/bramvdbogaerde/go-scp</a>"}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542026120, "post_id": 53258613, "comment_id": 93408834, "body": "I really wanted answer like this. Thanks a lot."}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 1, "creation_date": 1542027428, "post_id": 53258613, "comment_id": 93409509, "body": "It doesn&#39;t really work for me. It creates the file but there is no content inside. I actually realised it&#39;s not great to use session with scp within a command. This answer looks more of a copy paste than actual answer. io.Copy does not work. It just finishes because it&#39;s inside of the Goroutine otherwise it&#39;s left &quot;doing something&quot;"}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542027756, "post_id": 53258613, "comment_id": 93409707, "body": "file with no content?"}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542027777, "post_id": 53258613, "comment_id": 93409721, "body": "io.Copy spins forever"}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542027906, "post_id": 53258613, "comment_id": 93409795, "body": "If you add session.Wait() to not finish before io.Copy finishes it just spins forever and does not send any content"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542028246, "post_id": 53258613, "comment_id": 93409987, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/183498/discussion-between-ssemilla-and-howtogo\">continue this discussion in chat</a>."}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "edited": false, "score": 0, "creation_date": 1542029276, "post_id": 53258613, "comment_id": 93410470, "body": "okay, you were right. It works. I made a mistake of using os.OpenFile instead of os.Open and it was the cause of the error i couldn&#39;t notice"}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 2, "last_activity_date": 1542028899, "last_edit_date": 1542028899, "creation_date": 1542012725, "answer_id": 53258613, "question_id": 53256373, "link": "https://stackoverflow.com/questions/53256373/sending-file-over-ssh-in-go/53258613#53258613", "title": "Sending file over SSH in go", "body": "<p>Here is a minimal example on how to use Go as an <code>scp</code> client:</p>\n\n<pre><code>config := &amp;ssh.ClientConfig{\n    User: \"user\",\n    Auth: []ssh.AuthMethod{\n        ssh.Password(\"pass\"),\n    },\n    HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n}\n\nclient, _ := ssh.Dial(\"tcp\", \"remotehost:22\", config)\ndefer client.Close()\n\nsession, _ := client.NewSession()\ndefer session.Close()\n\nfile, _ := os.Open(\"filetocopy\")\ndefer file.Close()\nstat, _ := file.Stat()\n\nwg := sync.WaitGroup{}\nwg.Add(1)\n\ngo func() {\n    hostIn, _ := session.StdinPipe()\n    defer hostIn.Close()\n    fmt.Fprintf(hostIn, \"C0664 %d %s\\n\", stat.Size(), \"filecopyname\")\n    io.Copy(hostIn, file)\n    fmt.Fprint(hostIn, \"\\x00\")\n    wg.Done()\n}()\n\nsession.Run(\"/usr/bin/scp -t /remotedirectory/\")\nwg.Wait()\n</code></pre>\n\n<p>Note that I have ignored all errors only for conciseness.</p>\n\n<ol>\n<li><code>session.StdinPipe()</code> will create a writable pipe for the remote host.</li>\n<li><code>fmt.Fprintf(... \"C0664 ...\")</code> will signal the start of a file with <code>0664</code> permission, <code>stat.Size()</code> size and the remote filename <code>filecopyname</code>.</li>\n<li><code>io.Copy(hostIn, file)</code> will write the contents of <code>file</code> into <code>hostIn</code>.</li>\n<li><code>fmt.Fprint(hostIn, \"\\x00\")</code> will signal the end of the file.</li>\n<li><code>session.Run(\"/usr/bin/scp -qt /remotedirectory/\")</code> will run the scp command.</li>\n</ol>\n\n<p><strong>Edit</strong>: Added waitgroup per OP's request</p>\n"}, {"tags": [], "owner": {"reputation": 1535, "user_id": 2488550, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/UvNRI.jpg?s=128&g=1", "display_name": "Hemant_Negi", "link": "https://stackoverflow.com/users/2488550/hemant-negi"}, "is_accepted": false, "score": 3, "last_activity_date": 1600243408, "creation_date": 1600243408, "answer_id": 63915669, "question_id": 53256373, "link": "https://stackoverflow.com/questions/53256373/sending-file-over-ssh-in-go/63915669#63915669", "title": "Sending file over SSH in go", "body": "<p>You can do it using sftp package as well - &quot;github.com/pkg/sftp&quot;</p>\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc SSHCopyFile(srcPath, dstPath string) error {\n    config := &amp;ssh.ClientConfig{\n        User: &quot;user&quot;,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(&quot;pass&quot;),\n        },\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    }\n\n    client, _ := ssh.Dial(&quot;tcp&quot;, &quot;remotehost:22&quot;, config)\n    defer client.Close()\n\n\n    // open an SFTP session over an existing ssh connection.\n    sftp, err := sftp.NewClient(client)\n    if err != nil {\n        return err\n    }\n    defer sftp.Close()\n\n    // Open the source file\n    srcFile, err := os.Open(srcPath)\n    if err != nil {\n        return err\n    }\n    defer srcFile.Close()\n\n    // Create the destination file\n    dstFile, err := sftp.Create(dstPath)\n    if err != nil {\n        return err\n    }\n    defer dstFile.Close()\n\n    // write to file\n    if  _, err := dstFile.ReadFrom(srcFile); err!= nil {\n        return err\n    }\n    return nil\n}\n\n</code></pre>\n<p>Then call it like</p>\n<pre class=\"lang-golang prettyprint-override\"><code>SSHCopyFile(&quot;/path/to/local/file.txt&quot;, &quot;/path/on/remote/file.txt&quot;)\n</code></pre>\n<p>these are the required packages</p>\n<pre><code>&quot;github.com/pkg/sftp&quot;\n&quot;golang.org/x/crypto/ssh&quot;\n</code></pre>\n"}], "owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3506, "favorite_count": 0, "accepted_answer_id": 53258613, "answer_count": 2, "score": 0, "last_activity_date": 1600243408, "creation_date": 1542000592, "question_id": 53256373, "link": "https://stackoverflow.com/questions/53256373/sending-file-over-ssh-in-go", "title": "Sending file over SSH in go", "body": "<p><a href=\"https://stackoverflow.com/questions/38242598/golang-scp-file-using-crypto-ssh\">I found this answer before posting this question but the answer is not clear to me.</a></p>\n\n<p>Here is the code of the answer:</p>\n\n<pre><code>conn, err := ssh.Dial(\"tcp\", hostname+\":22\", config)\nif err != nil {\n    return err\n}\n\nsession, err := conn.NewSession()\nif err != nil {\n    return err\n}\ndefer session.Close()\n\nr, err := session.StdoutPipe()\nif err != nil {\n    return err\n}\n\nname := fmt.Sprintf(\"%s/backup_folder_%v.tar.gz\", path, time.Now().Unix())\nfile, err := os.OpenFile(name, os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0644)\nif err != nil {\n    return err\n}\ndefer file.Close()\n\nif err := session.Start(cmd); err != nil {\n    return err\n}\n\nn, err := io.Copy(file, r)\nif err != nil {\n    return err\n}\n\nif err := session.Wait(); err != nil {\n    return err\n}\n\nreturn nil\n</code></pre>\n\n<p>I don't understand relation between the cmd variable and io.Copy, where and how does it know which file to copy.\nI like the idea of using io.Copy but i do not know how to create the file via ssh and start sending content to it using io.Copy. </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1542005723, "post_id": 53256000, "comment_id": 93398854, "body": "To build your program you <i>will</i> <i>have</i> to download all the dependencies. To <i>run</i>: not. Google multistage docker builds. <a href=\"https://medium.com/@pierreprinetti/the-go-1-11-dockerfile-a3218319d191\" rel=\"nofollow noreferrer\">medium.com/@pierreprinetti/the-go-1-11-dockerfile-a3218319d1&zwnj;&#8203;91</a> might be a starting point."}], "answers": [{"tags": [], "owner": {"reputation": 2864, "user_id": 1196369, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/16777b8b25858df69e496a07abfab395?s=128&d=identicon&r=PG", "display_name": "mickadoo", "link": "https://stackoverflow.com/users/1196369/mickadoo"}, "is_accepted": false, "score": 0, "last_activity_date": 1542110580, "creation_date": 1542110580, "answer_id": 53280641, "question_id": 53256000, "link": "https://stackoverflow.com/questions/53256000/run-go-file-from-github-inside-docker/53280641#53280641", "title": "Run go file from Github inside Docker", "body": "<p>It depends what you want to do here. If your aim is to create an image for your production-ready app that you want to release for other people to use then you would need a Dockerfile that contains the instructions to fetch your code using <code>go get -v \"github_repo_directory\"</code>. This would result in a new image that you could distribute. However this won't be useful for development, because any change you make to your code means you'll have to rebuild this image.</p>\n\n<p>If you want to use Docker as a development environment you need to be able to see the changes you make locally right away. In this case you will be using the base image that allows you to run your app (e.g. the image provided by go), and you should mount your codebase inside the docker container. I would suggest reading up a bit on Docker, <a href=\"https://medium.com/statuscode/golang-docker-for-development-and-production-ce3ad4e69673\" rel=\"nofollow noreferrer\">this</a> article might be helpful.</p>\n"}], "owner": {"reputation": 31, "user_id": 10454455, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mqcGBDSQ2wI/AAAAAAAAAAI/AAAAAAAAAHQ/_Ij8Qb06G6g/photo.jpg?sz=128", "display_name": "Shihab Shahriar", "link": "https://stackoverflow.com/users/10454455/shihab-shahriar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542110580, "creation_date": 1541997140, "question_id": 53256000, "link": "https://stackoverflow.com/questions/53256000/run-go-file-from-github-inside-docker", "title": "Run go file from Github inside Docker", "body": "<p>I use \"go get\" command to download and install my go code from Github and other dependencies inside the Docker. For example:</p>\n\n<pre><code>docker run golang go get -v \"github_repo_directory\"\n</code></pre>\n\n<p>It downloads more than 900 MB initially for the dependencies. Then I can create the container and run the code inside the docker container. The issue is whenever I change something in the code, I have to to go through all the process and it again downloads a huge amount of file. Is there any way so that every time I modify my code, I don't have to download all the dependencies? I am using the following reference to run my code.</p>\n\n<p><a href=\"https://flaviocopes.com/golang-docker/\" rel=\"nofollow noreferrer\">https://flaviocopes.com/golang-docker/</a>   </p>\n"}, {"tags": ["go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "edited": false, "score": 0, "creation_date": 1541990614, "post_id": 53255305, "comment_id": 93395304, "body": "What are you currently using?"}, {"owner": {"reputation": 5461, "user_id": 5366891, "user_type": "registered", "profile_image": "https://graph.facebook.com/718933983/picture?type=large", "display_name": "Daniel Tran", "link": "https://stackoverflow.com/users/5366891/daniel-tran"}, "reply_to_user": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "edited": false, "score": 0, "creation_date": 1541990743, "post_id": 53255305, "comment_id": 93395323, "body": "I switched to swift rather than go. :( I intended to use golang and then i discovered that the libraries are not matured/maintained well enough to use"}, {"owner": {"reputation": 5461, "user_id": 5366891, "user_type": "registered", "profile_image": "https://graph.facebook.com/718933983/picture?type=large", "display_name": "Daniel Tran", "link": "https://stackoverflow.com/users/5366891/daniel-tran"}, "reply_to_user": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "edited": false, "score": 0, "creation_date": 1541990888, "post_id": 53255305, "comment_id": 93395345, "body": "It&#39;s official driver from mongodb team but it&#39;s in alpha stage for now."}, {"owner": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "edited": false, "score": 0, "creation_date": 1541993293, "post_id": 53255305, "comment_id": 93395745, "body": "Thanks a lot but what I now have with mgo works well! I can leave it working?"}, {"owner": {"reputation": 5461, "user_id": 5366891, "user_type": "registered", "profile_image": "https://graph.facebook.com/718933983/picture?type=large", "display_name": "Daniel Tran", "link": "https://stackoverflow.com/users/5366891/daniel-tran"}, "reply_to_user": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "edited": false, "score": 0, "creation_date": 1541993642, "post_id": 53255305, "comment_id": 93395818, "body": "Sure. Only consider what I mentioned in the answer. If it doesn\u2019t affect. Stay with mgo"}], "tags": [], "owner": {"reputation": 5461, "user_id": 5366891, "user_type": "registered", "profile_image": "https://graph.facebook.com/718933983/picture?type=large", "display_name": "Daniel Tran", "link": "https://stackoverflow.com/users/5366891/daniel-tran"}, "is_accepted": false, "score": 0, "last_activity_date": 1541990013, "creation_date": 1541990013, "answer_id": 53255305, "question_id": 53255251, "link": "https://stackoverflow.com/questions/53255251/can-i-continue-to-use-mgo-even-if-it-is-no-longer-maintained/53255305#53255305", "title": "Can I continue to use mgo even if it is no longer maintained?", "body": "<p>There will be problems if:</p>\n\n<ul>\n<li>You want to get some new features in mongodb and current mgo library doesn't support</li>\n<li>There is a bugs/security issue in mgo library.</li>\n</ul>\n\n<p>That's one of the reason why i'm not using mgo.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1542032599, "last_edit_date": 1542032599, "creation_date": 1541993551, "answer_id": 53255618, "question_id": 53255251, "link": "https://stackoverflow.com/questions/53255251/can-i-continue-to-use-mgo-even-if-it-is-no-longer-maintained/53255618#53255618", "title": "Can I continue to use mgo even if it is no longer maintained?", "body": "<p>Basically you may continue to use it, but since it's not maintained anymore, that means bugs discovered in it will not be fixed, and new features of MongoDB servers will not get added to it.</p>\n\n<p>If you read the README of the github project (<a href=\"https://github.com/go-mgo/mgo\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo</a>), it lists your options.</p>\n\n<p>The first suggests to use the community supported fork: <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\"><code>github.com/globalsign/mgo</code></a>. This is maintained, support for new features are being added, and it has the same API as the original package.</p>\n\n<p>Since <code>globalsign/mgo</code> has identical API, there is no reason not to switch to it. It will most likely only take to change your imports. </p>\n\n<p>Also note that there is an <strong>official</strong> MongoDB Go driver under development, it was announced here: <a href=\"https://engineering.mongodb.com/post/considering-the-community-effects-of-introducing-an-official-golang-mongodb-driver\" rel=\"nofollow noreferrer\">Considering the Community Effects of Introducing an Official MongoDB Go Driver</a>. It's project and source code is available here: <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\"><code>github.com/mongodb/mongo-go-driver</code></a>. It's currently in <strong>alpha</strong> phase, so it's nowhere near production ready (and they don't even have an estimated date when it will be ready). If you need a driver now, <code>globalsign/mgo</code> is the best option at the moment.</p>\n\n<p>Do note that both the official driver and <code>globalsign/mgo</code> are getting support for newest features and additions of the MongoDB server, as an example, both support <a href=\"https://docs.mongodb.com/v3.6/changeStreams/\" rel=\"nofollow noreferrer\">change streams</a> (it wasn't in the original <code>mgo</code> driver). For details, see: <a href=\"https://stackoverflow.com/questions/49151104/watch-for-mongodb-change-streams/49151612#49151612\">Watch for MongoDB Change Streams</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1541994178, "creation_date": 1541994178, "answer_id": 53255688, "question_id": 53255251, "link": "https://stackoverflow.com/questions/53255251/can-i-continue-to-use-mgo-even-if-it-is-no-longer-maintained/53255688#53255688", "title": "Can I continue to use mgo even if it is no longer maintained?", "body": "<p>There will be an Official MongoDB Go Driver.</p>\n\n<p><a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">GitHub: mongo-go-driver</a></p>\n\n<p><a href=\"https://groups.google.com/forum/#!forum/mongodb-go-driver\" rel=\"nofollow noreferrer\">Forum: mongodb-go-driver</a></p>\n\n<p><a href=\"https://engineering.mongodb.com/post/considering-the-community-effects-of-introducing-an-official-golang-mongodb-driver\" rel=\"nofollow noreferrer\">Considering the Community Effects of Introducing an Official MongoDB Go Driver</a></p>\n"}], "owner": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1542032599, "creation_date": 1541989382, "question_id": 53255251, "link": "https://stackoverflow.com/questions/53255251/can-i-continue-to-use-mgo-even-if-it-is-no-longer-maintained", "title": "Can I continue to use mgo even if it is no longer maintained?", "body": "<p>Recently I saw that mgo was no longer going to be maintained and I have a recent project with mgo. My question is if there is a problem with that? There are no risks?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1541988620, "post_id": 53255064, "comment_id": 93394925, "body": "A process can send Ctrl+C or Ctrl+Break to a process <i>group</i> (not necessarily an individual process) only if the sending process is attached to the same console (i.e. conhost.exe instance). The simplest group is 0, which sends the event to all processes attached to the console, including the sender (which must ignore the event). If a process is the lead of a group (i.e. created with the flag <code>CREATE_NEW_PROCESS_GROUP</code>), by default it has Ctrl+C completely disabled (no handler is called), unless manually enabled. Ctrl+Break can&#39;t be ignored in the same way, so it&#39;s the more reliable of the two."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1541988885, "post_id": 53255064, "comment_id": 93394975, "body": "If the parent is a GUI process without a console, it can easily attach to the child&#39;s console via <code>AttachConsole</code>. Or it can preallocate its own console via <code>AllocConsole</code> and have the child inherit it. If the parent and child have a different console, it&#39;s more complicated since the parent will have to start a process such as cmd.exe to keep its console referenced, then use <code>FreeConsole</code> and <code>AttachConsole</code> twice in order to temporarily attach to the child&#39;s console and then attach back to its original console."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542007085, "post_id": 53255064, "comment_id": 93399307, "body": "&quot;Interrupt is not implemented on Windows; using it with os.Process.Signal will return an error.&quot; <a href=\"https://golang.org/pkg/os/#Signal\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Signal</a>"}], "owner": {"reputation": 1, "user_id": 9026350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b59974b69513faca8211709bedcc81?s=128&d=identicon&r=PG", "display_name": "ee2marine", "link": "https://stackoverflow.com/users/9026350/ee2marine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1209, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541987709, "creation_date": 1541987366, "last_edit_date": 1541987709, "question_id": 53255064, "link": "https://stackoverflow.com/questions/53255064/sending-ctrlc-to-process-started-with-exec", "title": "Sending Ctrl+C to process started with exec", "body": "<p>I'm trying to send a CTRL-C event to a java process started with exec. </p>\n\n<pre><code>cmd := exec.Command(\"javaw\", \"-cp\", \"burst.jar;conf\", \"brs.Burst\") \ncmd.Dir = burstCmdPath\ncmd.Env = append(os.Environ())\nerr = cmd.Start()\n...\ncmd.Process.Signal(syscall.SIGINT)\n</code></pre>\n\n<p>Unfortunately, the SIGINT-signal does not work on windows.\nI do not want to KILL the process. I just want to close it gracefully with CTRL-C.</p>\n\n<p>I tried several things:</p>\n\n<ol>\n<li>Calling taskkill: Process does only react to forced kill.</li>\n<li><p>Using win32-API:</p>\n\n<pre><code>...\nd, err := syscall.LoadDLL(\"kernel32.dll\")               \np, e := d.FindProc(\"GenerateConsoleCtrlEvent\")\nr, _, e := p.Call(syscall.CTRL_C_EVENT, uintptr(cmd.Process.Pid))\nif r == 0 {\n    fmt.Print(\"GenerateConsoleCtrlEvent: %v\\n\", e)\n}\n...\n</code></pre>\n\n<p>Does not throw any errors, but does not work either.</p></li>\n</ol>\n\n<p>If you open burst.jar inside a shell, you can just press CTRL+C to signal a shutdown, but why not with exec? \nAny ideas?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "edited": false, "score": 0, "creation_date": 1541997053, "post_id": 53254833, "comment_id": 93396522, "body": "It works @ThunderCat! You&#39;re the GURU of reflection mate! Well done! Thank you very much!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1541985382, "last_edit_date": 1541985382, "creation_date": 1541985036, "answer_id": 53254833, "question_id": 53254726, "link": "https://stackoverflow.com/questions/53254726/populating-an-array-of-structs-passed-to-a-function-as-a-pointer/53254833#53254833", "title": "Populating an array of structs passed to a function as a pointer", "body": "<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package:</p>\n\n<pre><code>func list(ctx context.Context, kind string, dst interface{}, pageSize int, cursorStr string) string {\n    client, _ := datastore.NewClient(ctx, \"my-proj\")\n    query := datastore.NewQuery(kind).Limit(pageSize)\n    if cursorStr != \"\" {\n        cursor, err := datastore.DecodeCursor(cursorStr)\n        if err != nil {\n            log.Fatalf(\"Bad cursor %q: %v\", cursorStr, err)\n        }\n        query = query.Start(cursor)\n    }\n\n    // Get reflect value for the result slice.\n    results := reflect.ValueOf(dst).Elem()\n\n    // Allocate new value of the slice element type. \n    // resultp is pointer to that value.\n    resultp := reflect.New(results.Type().Elem())\n\n    it := client.Run(ctx, query)\n    _, err := it.Next(resultp.Interface())\n    for err == nil {\n        // Append last value to results\n        results.Set(reflect.Append(results, resultp.Elem())\n\n        _, err = it.Next(resultp.Interface())\n    }\n    if err != iterator.Done {\n        log.Fatalf(\"Failed fetching results: %v\", err)\n    }\n\n    // Get the cursor for the next page of results.\n    nextCursor, err := it.Cursor()\n    // [END datastore_cursor_paging]\n    _ = err        // Check the error.\n    _ = nextCursor // Use nextCursor.String as the next page's token.\n}\n</code></pre>\n\n<p>Call the function with a pointer to the destination slice:</p>\n\n<pre><code>var data []Tasks\ncursor := list(ctx, \"Tasks\", &amp;data, 10, \"\")\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 53254833, "answer_count": 1, "score": 0, "last_activity_date": 1541985382, "creation_date": 1541983710, "question_id": 53254726, "link": "https://stackoverflow.com/questions/53254726/populating-an-array-of-structs-passed-to-a-function-as-a-pointer", "title": "Populating an array of structs passed to a function as a pointer", "body": "<p>I'm want to do data pagination with Google Cloud Platform Datastore and I've found an example on GCP's page (<a href=\"https://cloud.google.com/datastore/docs/concepts/queries\" rel=\"nofollow noreferrer\">https://cloud.google.com/datastore/docs/concepts/queries</a>) for doing it with Cursors and it works absolutely fine. </p>\n\n<p>The example provided by Google has hardcoded the variables <code>var tasks []Task</code> and   <code>var task Task</code> and I would like to create a <strong>reusable</strong> function where I can pass the pointer to a struct array via a parameter typed <code>interface{}</code> and get this struct populated by this function. For example: </p>\n\n<pre><code>    type MyStruct1 struct {\n        F1 string\n    }\n\n    type MyStruct2 struct {\n        F1 int\n    }\n\n    func list(ctx context.Context, cursorStr string, data interface{}) {\n    ...\n    }\n\n    func main() {\n        mystruct1 := make([]MyStruct1, 0)\n        list(ctx, \"\", &amp;mystruct1)\n\n        mystruct2 := make([]MyStruct2, 0)\n        list(ctx, \"\", &amp;mystruct2)\n    }\n</code></pre>\n\n<p>My problem starts when I need to create in this function, a variable to store the record and then append it to the struct array passed as a pointer.</p>\n\n<p><strong>Example from Google</strong></p>\n\n<pre><code>func SnippetIterator_Cursor() {\n    ctx := context.Background()\n    client, _ := datastore.NewClient(ctx, \"my-proj\")\n    cursorStr := \"\"\n    // [START datastore_cursor_paging]\n    const pageSize = 5\n    query := datastore.NewQuery(\"Tasks\").Limit(pageSize)\n    if cursorStr != \"\" {\n        cursor, err := datastore.DecodeCursor(cursorStr)\n        if err != nil {\n            log.Fatalf(\"Bad cursor %q: %v\", cursorStr, err)\n        }\n        query = query.Start(cursor)\n    }\n\n    // Read the tasks.\n    var tasks []Task &lt;&lt; THIS IS WHAT I WANT TO BE GENERIC \n    var task Task. &lt;&lt; THIS IS WHAT I WANT TO BE GENERIC \n    it := client.Run(ctx, query)\n    _, err := it.Next(&amp;task)\n    for err == nil {\n        tasks = append(tasks, task)\n        _, err = it.Next(&amp;task)\n    }\n    if err != iterator.Done {\n        log.Fatalf(\"Failed fetching results: %v\", err)\n    }\n\n    // Get the cursor for the next page of results.\n    nextCursor, err := it.Cursor()\n    // [END datastore_cursor_paging]\n    _ = err        // Check the error.\n    _ = nextCursor // Use nextCursor.String as the next page's token.\n}\n</code></pre>\n\n<p><strong>My Generic function based on the code above</strong></p>\n\n<pre><code>func list(ctx context.Context, kind string, data interface{}, pageSize int, cursorStr string) string {\n    query := datastore.NewQuery(kind).Limit(pageSize)\n    if cursorStr != \"\" {\n        cursor, err := datastore.DecodeCursor(cursorStr)\n        if err != nil {\n            log.Fatalf(\"Bad cursor %q: %v\", cursorStr, err)\n        }\n        query = query.Start(cursor)\n    }\n    it := query.Run(ctx)\n\n    // HERE IS WHERE THE PROBLEM STARTS\n    var vet []interface{}\n    var rec interface{}\n\n    k, err := it.Next(rec)\n    if err != nil {\n        log.Println(err.Error())\n    }\n    for err == nil {\n        log.Println(k, rec) // PROBLEM: The key comes ok but rec comes nil\n        vet = append(vet, rec)\n        k, err = it.Next(rec)\n    }\n    log.Println(vet) // PROBLEM: vet has only nils\n\n    nextCursor, err := it.Cursor()\n    if err != nil {\n        log.Println(err.Error())\n    }\n\n    data = vet\n    return nextCursor.String()\n}\n\nfunc TestListFunc() {\n    data := make([]Tasks, 0)\n    cursor := list(ctx, \"Tasks\", &amp;data, 10, \"\")\n    x, _ := json.MarshalIndent(data, \" \", \"   \")\n    log.Println(string(x))\n}\n</code></pre>\n\n<p><strong>PROBLEM:</strong> The Datastore iterator <code>.Next()</code> doesn't seem to store the record in a variable typed <code>interface{}</code></p>\n"}, {"tags": ["csv", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1541976549, "post_id": 53253963, "comment_id": 93392596, "body": "try <code>csv.NewReader(strings.NewReader(object.Body))</code>"}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1541976729, "post_id": 53253963, "comment_id": 93392638, "body": "hmm, I get a compile error: <code>cannot use object.Body (type io.ReadCloser) as type string in argument to strings.NewReader</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541980358, "post_id": 53253963, "comment_id": 93393371, "body": "1) S3 returns the object contents as is. The ResponseContentEncoding and ResponseContentType options set the response headers, the options do not specify any transformation of the data. 2)  It looks like the response starts with a <a href=\"https://www.w3.org/International/questions/qa-byte-order-mark\" rel=\"nofollow noreferrer\">byte order mark</a>.  You will need to skip over that. 3) It looks like lines are separated by \\r.  To aid debugging, please dump raw body data as suggested to you <a href=\"https://stackoverflow.com/questions/53245917/parsing-csv-in-golang-with-iso-8859-1-encoding#comment93378249_53245917\">here</a>."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541981412, "post_id": 53253963, "comment_id": 93393578, "body": "@ThunderCat updated. It&#39;s a string with the weird encodings."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1541983334, "post_id": 53253963, "comment_id": 93393922, "body": "Thank you for showing the actual data as was asked in comments on your previous question. The file uploaded to S3 is not encoded per the <a href=\"https://tools.ietf.org/html/rfc4180\" rel=\"nofollow noreferrer\">CSV Encoding RFC</a>.  Specifically, the file uses CR to separate lines instead of CRLF. Because the <a href=\"https://godoc.org/encoding/csv\" rel=\"nofollow noreferrer\">encoding/csv</a> reader handles LF separators, the easiest workaround is to translate CR to LF in the input.  Also, the file contains a byte order mark. Skip over those two bytes before decoding."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541983932, "post_id": 53253963, "comment_id": 93394028, "body": "OK that makes sense. Thank you."}], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 750, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1541981391, "creation_date": 1541975985, "last_edit_date": 1541981391, "question_id": 53253963, "link": "https://stackoverflow.com/questions/53253963/csv-encoding-broken-when-downloading-from-s3", "title": "CSV Encoding Broken when Downloading from S3", "body": "<p>I'm trying to download a CSV file from S3 using golang's SDK but it comes out encoded wrongly and is interpreted as one slice.</p>\n\n<pre><code>input := &amp;s3.GetObjectInput{\n    Bucket:                  aws.String(bucket),\n    Key:                     aws.String(key),\n    ResponseContentType:     aws.String(\"text/csv\"),\n    ResponseContentEncoding: aws.String(\"utf-8\"),\n}\n\nobject, err := s3.New(s).GetObject(input)\nif err != nil {\n    var obj s3.GetObjectOutput\n\n    return &amp;obj, err\n}\n\ndefer object.Body.Close()\n\nlines, err := csv.NewReader(object.Body).ReadAll()\nif err != nil {\n    log.Fatal(err)\n}\n\nlog.Printf(\"%q\", lines[0])\n\n\n// returns [\"\\ufeffH1\" \"H2\\r\" \"field1\" \"field2\\r\" \"field1\" field2\\r00602\"]\n</code></pre>\n\n<p>I'm guessing this is incorrect character encoding. Problem is that I'm not clear what encoding that it is. When I'm putting the file, I'm specifying csv.</p>\n\n<p>I would have expected to see <code>[][]string</code>:</p>\n\n<pre><code>[\n  [],\n  []\n]\n</code></pre>\n\n<p>Any advice?</p>\n\n<p><strong>Approach 2</strong></p>\n\n<pre><code>buffer := new(bytes.Buffer)\nbuffer.ReadFrom(object.Body)\n\nstr := buffer.String()\n\nlines, err := csv.NewReader(strings.NewReader(str)).ReadAll()\nif err != nil {\n    log.Fatal(err)\n}\n\nlog.Printf(\"length: %v\", len(lines))\n// still one line\n</code></pre>\n\n<p><strong>Approach 3</strong></p>\n\n<p>My new approach is going to be manually removing byte sequences that are problematic. This is pretty terrible. Godocs on this need work.</p>\n\n<p>This is closer but now I have to split out on new lines then again on commas.</p>\n\n<p><strong>Edit</strong>\nWhen I print out the bytes it looks like:\n<code>\"\\ufeffH1,H2\\r,field1,field2\\r\uf141</code></p>\n\n<p>I have tried using the following encodings:</p>\n\n<p><code>utf-8</code>, <code>iso-8859-1</code>, <code>iso-8859-1:utf-8</code></p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1541999327, "post_id": 53253869, "comment_id": 93397048, "body": "Can i see your minikube deployment yamls?"}, {"owner": {"reputation": 1, "user_id": 10627055, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3w1e86xbKPw/AAAAAAAAAAI/AAAAAAAAALc/RTkGg_d_YH4/photo.jpg?sz=128", "display_name": "prithika", "link": "https://stackoverflow.com/users/10627055/prithika"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542005211, "post_id": 53253869, "comment_id": 93398658, "body": "yamls are present in this link <a href=\"https://github.com/prithika92/StoreImage\" rel=\"nofollow noreferrer\">github.com/prithika92/StoreImage</a>"}, {"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542006021, "post_id": 53253869, "comment_id": 93398946, "body": "So you accessing it from your host machine using minikube ip, right?"}, {"owner": {"reputation": 1, "user_id": 10627055, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3w1e86xbKPw/AAAAAAAAAAI/AAAAAAAAALc/RTkGg_d_YH4/photo.jpg?sz=128", "display_name": "prithika", "link": "https://stackoverflow.com/users/10627055/prithika"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542006143, "post_id": 53253869, "comment_id": 93398994, "body": "yes.. this is my minikube url.. PS C:\\Program Files_Mine\\Kubernetes&gt; minikube service image80-store --url <a href=\"http://192.168.99.100:31385\" rel=\"nofollow noreferrer\">192.168.99.100:31385</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "reply_to_user": {"reputation": 1, "user_id": 10627055, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3w1e86xbKPw/AAAAAAAAAAI/AAAAAAAAALc/RTkGg_d_YH4/photo.jpg?sz=128", "display_name": "prithika", "link": "https://stackoverflow.com/users/10627055/prithika"}, "edited": false, "score": 0, "creation_date": 1542039074, "post_id": 53257738, "comment_id": 93416036, "body": "@prithika nice. In stackoverflow if you find answer helpful, give an upvote."}], "tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": false, "score": 0, "last_activity_date": 1542008599, "creation_date": 1542008599, "answer_id": 53257738, "question_id": 53253869, "link": "https://stackoverflow.com/questions/53253869/unable-to-upload-image-file-using-go-from-minikube/53257738#53257738", "title": "unable to upload image file using go from minikube", "body": "<p>You hard coded <code>options[0] = \"&lt;/br&gt;&lt;a href = \\\"http://\" + ipaddress + \":80/uploadfile\\\"&gt;Click to upload file&lt;/a&gt;&lt;/br&gt;\"</code> and <code>ipaddress = \"localhost\"</code>. But when you running it on minikube, it not accessible by <code>localhost</code>. I suggest to use relative path instead.</p>\n\n<pre><code>options[0] = \"&lt;/br&gt;&lt;a href = \\\"/uploadfile\\\"&gt;Click to upload file&lt;/a&gt;&lt;/br&gt;\"\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10627055, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3w1e86xbKPw/AAAAAAAAAAI/AAAAAAAAALc/RTkGg_d_YH4/photo.jpg?sz=128", "display_name": "prithika", "link": "https://stackoverflow.com/users/10627055/prithika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542008599, "creation_date": 1541975215, "last_edit_date": 1542002274, "question_id": 53253869, "link": "https://stackoverflow.com/questions/53253869/unable-to-upload-image-file-using-go-from-minikube", "title": "unable to upload image file using go from minikube", "body": "<p>Below is my main.go file to upload images.\nHere using this go file am building a docker image.<br>\ndocker build is successful. \nOn accessing the minikube service url, get options to upload, list and delete files. \nBut once clicked on Upload file, get site cannot be reached.</p>\n\n<pre><code>var baseDirectory string\nvar ipaddress string\n\nfunc main() {\n    baseDirectory = \"/usr/local/go/\" // provide the base directory path where the files will be kept\n    ipaddress = \"localhost\"          // provide the ip address of the webserver\n    http.HandleFunc(\"/\", homePage)\n    http.HandleFunc(\"/uploadfile\", uploadFile)\n    fs := http.FileServer(http.Dir(\"static/\"))\n    http.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n    err := http.ListenAndServe(\":80\", nil)\n    if err != nil {\n        fmt.Println(\"Error occurred \", err)\n    }\n}\nfunc homePage(w http.ResponseWriter, req *http.Request) {\n    var options [1]string\n\n    options[0] = \"&lt;/br&gt;&lt;a href = \\\"http://\" + ipaddress + \":80/uploadfile\\\"&gt;Click to upload file&lt;/a&gt;&lt;/br&gt;\"\n    w.Header().Set(\"CONTENT-TYPE\", \"text/html; charset=UTF-8\")\n    fmt.Fprintf(w, \"&lt;h1&gt;%s&lt;/h1&gt;, &lt;div&gt;%s&lt;/div&gt;\", \"Home Page\\n\", options)\n}\n\nfunc uploadFile(w http.ResponseWriter, req *http.Request) {\n    //var s string\n    if req.Method == http.MethodPost {\n        f, handler, err := req.FormFile(\"usrfile\")\n        if err != nil {\n            log.Println(err)\n            http.Error(w, \"Error uploading file\", http.StatusInternalServerError)\n            return\n        }\n        defer f.Close()\n        filename := handler.Filename\n        fmt.Println(filename)\n        bs, err := ioutil.ReadAll(f)\n        if err != nil {\n            log.Println(err)\n            http.Error(w, \"Error reading file\", http.StatusInternalServerError)\n            return\n        }\n        fmt.Println(bs)\n        err1 := ioutil.WriteFile(baseDirectory+filename, bs, 0644)\n        if err != nil {\n            log.Fatal(err1)\n        }\n        fmt.Println(\"Success!\")\n    }\n\n    w.Header().Set(\"CONTENT-TYPE\", \"text/html; charset=UTF-8\")\n    fmt.Fprintf(w, `&lt;form action=\"/uploadfile\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n        Upload a file&lt;br&gt;\n        &lt;input type=\"file\" name=\"usrfile\"&gt;&lt;br&gt;\n        &lt;input type=\"submit\"&gt;\n        &lt;/form&gt;\n        &lt;br&gt;\n        &lt;br&gt;`)\n\n}\n</code></pre>\n"}, {"tags": ["go", "rabbitmq", "synchronization", "goroutine"], "comments": [{"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542002921, "post_id": 53253797, "comment_id": 93397894, "body": "here, <code>msgs, err := ch.Consume(</code>  what is the type of <code>msgs</code>?"}, {"owner": {"reputation": 1775, "user_id": 4893580, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/621d06faeb8ed8be874951e0f6b624e8?s=128&d=identicon&r=PG&f=1", "display_name": "Kris MP", "link": "https://stackoverflow.com/users/4893580/kris-mp"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542010886, "post_id": 53253797, "comment_id": 93400865, "body": "@nightfury1204 it&#39;s <code>&lt;-chan Delivery</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 2, "last_activity_date": 1542014718, "creation_date": 1542014718, "answer_id": 53259160, "question_id": 53253797, "link": "https://stackoverflow.com/questions/53253797/make-go-routine-wait-until-result-from-rabbitmq-is-sent/53259160#53259160", "title": "Make go routine wait until result from rabbitMQ is sent", "body": "<p>Modify your <code>func rabbitReceive(queueName string) &lt;-chan string</code> as below:</p>\n\n<pre><code> func rabbitReceive(queueName string) &lt;-chan string {\n    conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n\n    q, err := ch.QueueDeclare(\n        queueName, // name\n        true,      // durable\n        false,     // delete when usused\n        false,     // exclusive\n        false,     // no-waits\n        nil,       // arguments\n    )\n    failOnError(err, \"Failed to declare a queue\")\n\n    msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        true,   // auto-ack\n        false,  // exclusive\n        false,  // no-local\n        false,  // no-wait\n        nil,    // args\n    )\n    failOnError(err, \"Failed to register a consumer\")\n\n    resCh := make(chan string)\n    go func() {\n        d := &lt;-msgs\n        log.Printf(\"Received a message: %v from %v\", string(d.Body), q.Name)\n        resCh &lt;- string(d.Body)\n        conn.Close()\n        ch.Close()\n        close(resCh)\n    }()\n    return resCh\n}\n</code></pre>\n\n<p>The reason previous code cause you problem was <code>defer ch.Close()</code>. <code>ch</code> closes before response was written to <code>resCh</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1775, "user_id": 4893580, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/621d06faeb8ed8be874951e0f6b624e8?s=128&d=identicon&r=PG&f=1", "display_name": "Kris MP", "link": "https://stackoverflow.com/users/4893580/kris-mp"}, "edited": false, "score": 0, "creation_date": 1542082870, "post_id": 53260113, "comment_id": 93430279, "body": "Hi thanks, somehow if I try your solution it stuck on the second loop"}, {"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 1, "creation_date": 1542082946, "post_id": 53260113, "comment_id": 93430297, "body": "<code>msgs, err := ch.Consume(</code> here <code>msgs</code> is derived from <code>ch</code>, so if <code>ch</code> doesn&#39;t close it, then <code>for d := range msgs</code> this will be blocking. if <code>msgs</code> is not closed, then ` ch.Close()` will not be executed. So it will cause deadlock"}, {"owner": {"reputation": 471, "user_id": 2959585, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/PAepQ.jpg?s=128&g=1", "display_name": "eladm26", "link": "https://stackoverflow.com/users/2959585/eladm26"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1542115760, "post_id": 53260113, "comment_id": 93445744, "body": "@nightfury1204 it&#39;s ok that the goroutine will be blocking, it supposed to wait on <code>RESULT</code> for an incoming message. We can add another goroutine to act as a signal handler and close <code>ch</code> in case of receiving a SIGKILL or some other signal."}], "tags": [], "owner": {"reputation": 471, "user_id": 2959585, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/PAepQ.jpg?s=128&g=1", "display_name": "eladm26", "link": "https://stackoverflow.com/users/2959585/eladm26"}, "is_accepted": false, "score": 0, "last_activity_date": 1542018120, "creation_date": 1542018120, "answer_id": 53260113, "question_id": 53253797, "link": "https://stackoverflow.com/questions/53253797/make-go-routine-wait-until-result-from-rabbitmq-is-sent/53260113#53260113", "title": "Make go routine wait until result from rabbitMQ is sent", "body": "<p>following up on @nightfury1204 great answer, you are indeed closing <code>ch</code> before writing to <code>resCh</code>. just one thing, in the go routine you want to go over <strong>all</strong> the messages so a better way to do it will be:  </p>\n\n<pre><code>go func() {\n        for d := range msgs {\n          log.Printf(\"Received a message: %v from %v\", string(d.Body), q.Name)\n          resCh &lt;- string(d.Body)  \n        }\n        conn.Close()\n        ch.Close()\n        close(resCh)\n    }()\n</code></pre>\n"}], "owner": {"reputation": 1775, "user_id": 4893580, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/621d06faeb8ed8be874951e0f6b624e8?s=128&d=identicon&r=PG&f=1", "display_name": "Kris MP", "link": "https://stackoverflow.com/users/4893580/kris-mp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 1, "accepted_answer_id": 53259160, "answer_count": 2, "score": 1, "last_activity_date": 1545491662, "creation_date": 1541974657, "last_edit_date": 1545491662, "question_id": 53253797, "link": "https://stackoverflow.com/questions/53253797/make-go-routine-wait-until-result-from-rabbitmq-is-sent", "title": "Make go routine wait until result from rabbitMQ is sent", "body": "<p>I am fairly new to Go, I want to make a pipeline that translate every requests I receive by send it to first queue (TEST), and get the final result from the last queue (RESULT) and send it back as a response.</p>\n\n<p>The problem I am facing is, the response never wait til all result back from the queue. Here is the code:</p>\n\n<pre><code>func main() {\n    requests := []int{3, 4, 5, 6, 7}\n    var wg sync.WaitGroup\n    wg.Add(1)\n    resArr := []string{}\n    go func() {\n        for _, r := range requests {\n            rabbitSend(\"TEST\", r)\n            resArr = append(resArr, &lt;-rabbitReceive(\"RESULT\"))\n        }\n        defer wg.Done()\n    }()\n    wg.Wait()\n\n    log.Println(\"Result\", resArr)\n}\n</code></pre>\n\n<p><strong>rabbitSend method:</strong></p>\n\n<pre><code>func rabbitSend(queueName string, msg int) {\n    conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n    defer conn.Close()\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n    defer ch.Close()\n\n    q, err := ch.QueueDeclare(\n        queueName, // name\n        true,      // durable\n        false,     // delete when unused\n        false,     // exclusive\n        false,     // no-wait\n        nil,       // arguments\n    )\n    failOnError(err, \"Failed to declare a queue\")\n\n    body, _ := json.Marshal(msg)\n    err = ch.Publish(\n        \"\",     // exchange\n        q.Name, // routing key\n        false,  // mandatory\n        false,  // immediate\n        amqp.Publishing{\n            ContentType: \"application/json\",\n            Body:        []byte(body),\n        })\n    log.Printf(\"[x] Sent %s to %s\", body, q.Name)\n    failOnError(err, \"Failed to publish a message\")\n}\n</code></pre>\n\n<p><strong>rabbitReceive method:</strong></p>\n\n<pre><code>func rabbitReceive(queueName string) &lt;-chan string {\n    conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n    defer conn.Close()\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n    defer ch.Close()\n\n    q, err := ch.QueueDeclare(\n        queueName, // name\n        true,      // durable\n        false,     // delete when usused\n        false,     // exclusive\n        false,     // no-waits\n        nil,       // arguments\n    )\n    failOnError(err, \"Failed to declare a queue\")\n\n    msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        true,   // auto-ack\n        false,  // exclusive\n        false,  // no-local\n        false,  // no-wait\n        nil,    // args\n    )\n    failOnError(err, \"Failed to register a consumer\")\n\n    resCh := make(chan string)\n    go func() {\n        for d := range msgs {\n            log.Printf(\"Received a message: %v from %v\", string(d.Body), q.Name)\n            resCh &lt;- string(d.Body)\n        }\n        close(resCh)\n    }()\n    return resCh\n}\n</code></pre>\n\n<p>Here is what I get when I run the program:</p>\n\n<pre><code>2018/11/12 05:11:54 [x] Sent 3 to TEST\n2018/11/12 05:11:54 [x] Sent 4 to TEST\n2018/11/12 05:11:54 Received a message: 9 from RESULT\n2018/11/12 05:11:54 [x] Sent 5 to TEST\n2018/11/12 05:11:54 [x] Sent 6 to TEST\n2018/11/12 05:11:54 Received a message: 15 from RESULT\n2018/11/12 05:11:54 [x] Sent 7 to TEST\n2018/11/12 05:11:54 Received a message: 18 from RESULT\n2018/11/12 05:11:54 Result [ 9  15 18]\n</code></pre>\n\n<p>What I want is that, I receive the result exactly after I send the request, so the request will not get the wrong result as a response. Something like:</p>\n\n<pre><code>2018/11/12 05:11:54 [x] Sent 3 to TEST\n2018/11/12 05:11:54 Received a message: 9 from RESULT\n2018/11/12 05:11:54 [x] Sent 4 to TEST\n2018/11/12 05:11:54 Received a message: 12 from RESULT\n2018/11/12 05:11:54 [x] Sent 5 to TEST\n2018/11/12 05:11:54 Received a message: 15 from RESULT\n2018/11/12 05:11:54 [x] Sent 6 to TEST\n2018/11/12 05:11:54 Received a message: 18 from RESULT\n2018/11/12 05:11:54 [x] Sent 7 to TEST\n2018/11/12 05:11:54 Received a message: 21 from RESULT\n2018/11/12 05:11:54 Result [ 9 12 15 18 21]\n</code></pre>\n\n<p>I believe I did not use <strong>goroutine</strong> or <strong>sync.WaitGroup</strong> correctly here. Thanks in advance :)</p>\n"}, {"tags": ["c", "go", "java-native-interface", "cgo", "javah"], "comments": [{"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 1, "creation_date": 1541971898, "post_id": 53252803, "comment_id": 93391476, "body": "As far as I know, CGO doesn&#39;t support calling through C function pointers. So you&#39;d have to write a small wrapper library in C with functions that take a <code>JNIEnv*</code> and then calls <code>*(env)-&gt;TheActualJniFunction(env, ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "edited": false, "score": 0, "creation_date": 1542097585, "post_id": 53265342, "comment_id": 93435446, "body": "Thanks! So the steps I need to to is first build a shared library of jx.c using <code>gcc -shared -fPIC -I&#47;...&#47;libjx.so</code> and then point to that shared library using LDFLAGS in the Go file? Correct? I have tried that and it compiles when I do <code>go build...</code> but when running my Java program that uses my JNI method, then I get <code>Exception in thread &quot;main&quot; java.lang.UnsatisfiedLinkError: &#47;home&#47;rox&#47;jnijava&#47;target&#47;libjnijava.so: libjx.so: cannot open shared object file: No such file or directory</code> but both libjnijava.so (created by go build) and libjx.so (created by gcc -shared...) exist on that path."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "edited": false, "score": 0, "creation_date": 1542110395, "post_id": 53265342, "comment_id": 93442789, "body": "Yes, build the C file first and then you can create a library using <code>ar q libjx.a jx.c</code>. Then build your go shared object, e.g. <code>go build -buildmode=c-shared -o gox.so so.go</code>. You might need to add <code>libjx.so</code> in your <code>LD_LIBRARY_PATH</code>. I suggest <a href=\"https://stackoverflow.com/questions/13428910/how-to-set-the-environmental-variable-ld-library-path-in-linux\" title=\"how to set the environmental variable ld library path in linux\">stackoverflow.com/questions/13428910/&hellip;</a>"}, {"owner": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "edited": false, "score": 0, "creation_date": 1542121309, "post_id": 53265342, "comment_id": 93449337, "body": "Please have a look at my edit above where I added the steps to reproduce the error on Linux with Java 11. I have set <code>LD_LIBRARY_PATH</code> to point at the folder with the shared objects. I have also tried with setting the Java option <code>-Djava.library.path</code> but with no luck. So I am still stuck :-("}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "edited": false, "score": 0, "creation_date": 1542124760, "post_id": 53265342, "comment_id": 93451678, "body": "This: <code>&#47;home&#47;rox&#47;gojni&#47;target&#47;libgojni.so</code> is not = to this: <code>&#47;home&#47;rox&#47;jnijava&#47;target&#47;libjnijava.so</code>."}, {"owner": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "edited": false, "score": 0, "creation_date": 1542127493, "post_id": 53265342, "comment_id": 93453469, "body": "Thanks! I was testing with some different projects on different platforms and copy-pasted from wrong project. :-) Got it working now though. It turned out that the LD_LIBRARY_PATH wasn&#180;t set for the session I used."}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1542036713, "creation_date": 1542036713, "answer_id": 53265342, "question_id": 53252803, "link": "https://stackoverflow.com/questions/53252803/how-do-i-call-a-java-native-interface-c-function-from-my-go-code/53265342#53265342", "title": "How do I call a Java Native Interface C function from my Go code?", "body": "<p>JNI functions like <code>GetStringUTFChars</code> are function pointers and cannot be called directly from Go. You have to wrap the functions you need in a separate C file. e.g.</p>\n\n<p><em>jx.c</em></p>\n\n<pre><code>#include &lt;jni.h&gt;\n\nconst char* jx_GetStringUTFChars(JNIEnv *env, jstring str, jboolean *isCopy) {\n    return (*env)-&gt;GetStringUTFChars(env, str, isCopy);\n}\n</code></pre>\n\n<p>After creating a library from the C file, your Go file will look something like this:</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -I/usr/java/jdk1.8.0_162/include/ -I/usr/java/jdk1.8.0_162/include/linux/\n#cgo LDFLAGS: -L${SRCDIR}/ -ljx\n\n#include \"jx.h\"\n*/\nimport \"C\"\nimport (\n    \"fmt\"\n)\n\n//export Java_com_mypackage_MyClass_print\nfunc Java_com_mypackage_MyClass_print(env *C.JNIEnv, clazz C.jclass, str C.jstring) {\n    s := C.jx_GetStringUTFChars(env, str, (*C.jboolean)(nil))\n    fmt.Println(C.GoString(s))\n}\n\nfunc main() {}\n</code></pre>\n\n<p>The reason why there is a separate C file just for the wrapper function is because of this clause in the documentation:</p>\n\n<blockquote>\n  <p>Using //export in a file places a restriction on the preamble: since it is copied into two different C output files, it must not contain any definitions, only declarations.</p>\n</blockquote>\n"}], "owner": {"reputation": 2357, "user_id": 1008572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2546a87d9eb9ce02de5bf6a62ec7893c?s=128&d=identicon&r=PG", "display_name": "Rox", "link": "https://stackoverflow.com/users/1008572/rox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1230, "favorite_count": 0, "accepted_answer_id": 53265342, "answer_count": 1, "score": 1, "last_activity_date": 1542127625, "creation_date": 1541967332, "last_edit_date": 1542127625, "question_id": 53252803, "link": "https://stackoverflow.com/questions/53252803/how-do-i-call-a-java-native-interface-c-function-from-my-go-code", "title": "How do I call a Java Native Interface C function from my Go code?", "body": "<p>I am up with implementing my Java Native Interface functions in Golang using the golang <code>C</code> lib. <br />\nNow I want to convert a <code>jstring</code> to an UTF-8 string using the JNI function <code>GetStringUTFChars</code> but I get an error when doing it. These are the steps I have done:</p>\n\n<p>In my Java class (called MyClass) where I have defined the JNI method, I have:</p>\n\n<pre><code>public static native void print(String msg);\n</code></pre>\n\n<p>Using <code>javah</code>, I have generated the <code>.h</code>-file with the function defined in C language:</p>\n\n<pre><code>JNIEXPORT void JNICALL Java_com_mypackage_MyClass_print\n  (JNIEnv *, jclass, jstring);\n</code></pre>\n\n<p>Then, in my Go code I have the following code:</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -I/Library/Java/JavaVirtualMachines/jdk1.8.0_131.jdk/Contents/Home/include\n// #cgo CFLAGS: -I/Library/Java/JavaVirtualMachines/jdk1.8.0_131.jdk/Contents/Home/include/darwin\n/*\n#include &lt;jni.h&gt;\n*/\nimport \"C\"\n\n//export Java_com_mypackage_MyClass_print\nfunc Java_com_mypackage_MyClass_print(env *C.JNIEnv, clazz C.jclass, str C.jstring) {\n\n    _ = C.GetStringUTFChars(env, str, 0)\n\n}\n</code></pre>\n\n<p>When I build the <code>go</code> file using:<br />\n<code>go build -buildmode=c-shared -o libmyclass.dylib libmyclass.go</code> <br />then I get the following error:</p>\n\n<p><code>could not determine kind of name for C.GetStringUTFChars</code></p>\n\n<p>How should I call the <code>GetStringUTFChars</code> defined in the <a href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/functions.html\" rel=\"nofollow noreferrer\">JNI spec</a> so I then can print the string with <code>fmt.println</code>?</p>\n\n<p><strong>EDIT 2</strong><br />\nRemoved \"edit 1\" since the procedure above was correct, it was just the LD_LIBRARY_PATH variable that was not set. </p>\n"}, {"tags": ["postgresql", "go", "gob"], "answers": [{"comments": [{"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1541961304, "post_id": 53251601, "comment_id": 93388496, "body": "I&#39;ve just tried to implement this, but when coding the body into the struct I get <code>json: cannot unmarshal string into Go struct field Table.Column of type pq.ByteaArray</code>. Any thoughts on getting around this? Seems like this can get a bit messy."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1541961513, "post_id": 53251601, "comment_id": 93388556, "body": "That&#39;s coming from code that isn&#39;t in your question, and you&#39;re doing something very wrong."}, {"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1541961726, "post_id": 53251601, "comment_id": 93388610, "body": "Just passing form data and decoding into a struct. I&#39;ll update the question now."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1541959271, "creation_date": 1541959271, "answer_id": 53251601, "question_id": 53251572, "link": "https://stackoverflow.com/questions/53251572/golang-postgres-storing-gob-data/53251601#53251601", "title": "Golang + postgres storing gob data", "body": "<p>Use a <code>bytea</code> column in postgresql to store a <code>[]byte</code>, and skip the conversion to <code>string</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1541969914, "creation_date": 1541969914, "answer_id": 53253178, "question_id": 53251572, "link": "https://stackoverflow.com/questions/53251572/golang-postgres-storing-gob-data/53253178#53253178", "title": "Golang + postgres storing gob data", "body": "<p>Took a look at <a href=\"https://golang.org/src/encoding/base64/example_test.go\" rel=\"nofollow noreferrer\">https://golang.org/src/encoding/base64/example_test.go</a></p>\n\n<p>Was able to use </p>\n\n<pre><code>return base64.StdEncoding.EncodeToString(buf.Bytes()), nil\n</code></pre>\n\n<p>Which successfully stored in the database.</p>\n"}], "owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2142, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1541969914, "creation_date": 1541959093, "last_edit_date": 1541961834, "question_id": 53251572, "link": "https://stackoverflow.com/questions/53251572/golang-postgres-storing-gob-data", "title": "Golang + postgres storing gob data", "body": "<p>I'm trying to store encoded data using <code>encoding/gob</code> from Golang into Postgres. I'm using Gorm as well. </p>\n\n<p>First, sending form data using</p>\n\n<pre><code>if err := json.NewDecoder(r.Body).Decode(model); err != nil {\n  http.Error(w, err.Error(), http.StatusBadRequest)\n  return\n}\n</code></pre>\n\n<p>Currently <code>client_encoding</code> is set to UTF8 in the postgres database. Here's what I'm using to encode:</p>\n\n<pre><code>type payload struct {\n    Key     []byte\n    Nonce   *[nonceLength]byte\n    Message []byte\n}\n\n// Encrypt message\np.Message = secretbox.Seal(p.Message, plaintext, p.Nonce, key) // key set prior to this\n\nbuf := &amp;bytes.Buffer{}\nif err := gob.NewEncoder(buf).Encode(p); err != nil {\n    return nil, err\n}\n\nreturn buf.Bytes(), nil\n</code></pre>\n\n<p>Then I store <code>string(buf.Bytes())</code> which is stored in the database column which is currently a string type. Now I'm a novice with encoding, and I think gob just has a different encoding for my database. I'm receiving this error in console:</p>\n\n<p><code>(pq: invalid byte sequence for encoding \"UTF8\": 0xff)</code></p>\n\n<p>I've been following this gist for encryption/decryption:\n<a href=\"https://gist.github.com/fuzzyami/f3a7231037166117a6fef9607960aee7\" rel=\"nofollow noreferrer\">https://gist.github.com/fuzzyami/f3a7231037166117a6fef9607960aee7</a></p>\n\n<p>From what I've read, I shouldn't be encoding structs into the db, in this case <code>p</code>, unless using <code>gob</code>. Correct me if I'm wrong with that (can't find the resource at the moment where I found this).</p>\n\n<p>Is anyone able to point me in the right direction for storing this data in Postgres which is decrypted later? I'm clearly not understanding the encoding process, and not entirely sure where to start out here with reading resources, so any help is appreciated!</p>\n"}, {"tags": ["json", "go", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1541962741, "post_id": 53251508, "comment_id": 93388864, "body": "Thanks for your help on this, that worked brilliantly"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 1, "last_activity_date": 1541958567, "creation_date": 1541958567, "answer_id": 53251508, "question_id": 53251451, "link": "https://stackoverflow.com/questions/53251451/reading-json-file-into-custom-type-struct-i-need-use-the-keys-in-functions-that/53251508#53251508", "title": "Reading JSON file into custom type struct, I need use the keys in functions that expect type string and not custom types", "body": "<p>You need to implement <code>(p *Person) String() string</code> so that you can get a string representation of a Person.</p>\n\n<p>For example:</p>\n\n<pre><code>func (p *Person) String() string {\n  return fmt.Sprintf(\"%s age %d says %q\", p.Name, p.Age, p.Comment)\n}\n\n// ...\npdf.CellFormat(20, 7, str.String(), \"1\", 0, \"C\", false, 0, \"\")\n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 53251508, "answer_count": 1, "score": -1, "last_activity_date": 1541959502, "creation_date": 1541958120, "last_edit_date": 1541959502, "question_id": 53251451, "link": "https://stackoverflow.com/questions/53251451/reading-json-file-into-custom-type-struct-i-need-use-the-keys-in-functions-that", "title": "Reading JSON file into custom type struct, I need use the keys in functions that expect type string and not custom types", "body": "<p>I'm creating a tool that can take a JSON file, and then create a PDF out of it using Go</p>\n\n<p>Here is an example of my JSON:</p>\n\n<pre><code>[{\"Name\":\"Ollie\",\"Age\":\"25\",\"Comment\":\"This is my comment\"},{\"Name\":\"Amy\",\"Age\":\"28\",\"Comment\":\"Another comment\"},{\"Name\":\"Joey\",\"Age\":\"19\",\"Comment\":\"Comment from Joey\"},{\"Name\":\"James\",\"Age\":\"23\",\"Comment\":\"James' comment\"},{\"Name\":\"Richard\",\"Age\":\"20\",\"Comment\":\"Richard has also made 24\"}]\n</code></pre>\n\n<p>I have something that works from using CSV files, but now I want to be able to take JSON files too</p>\n\n<p>The package that i'm using to create the PDFs is gofpdf</p>\n\n<p>One of the issues is that I need to pass the JSON into a struct to read it, the struct has it's own custom type - because i'm using a custom type I can't pass in the values into gofpdf's functions to make the PDF</p>\n\n<p>I simply want to be able to pass the values from my struct (which are declared as strings) as strings in the functions:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"time\"\n\n    \"github.com/jung-kurt/gofpdf\"\n)\n</code></pre>\n\n<p>Here is my struct:</p>\n\n<pre><code>type Person struct {\n    Name    string `json:\"Name\"`\n    Age     string `json:\"Age\"`\n    Comment string `json:\"Comment\"`\n}\n\nfunc main() {\n\n    data, err := ioutil.ReadFile(\"csv-to-json.json\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //create variable people which is array of Person structs\n    var People []Person\n\n    //Take the data object (json file) and place into the People array of struct\n    json.Unmarshal(data, &amp;People)\n\n    fmt.Println(People[:])\n\n    pdf := NewReport()\n\n    pdf = CreateTableJSON(pdf, People[:])\n\n    if pdf.Err() {\n        log.Fatalf(\"Failed creating PDF report: %s\\n\", pdf.Error())\n    }\n\n    err = SavePDFJSON(pdf)\n    if err != nil {\n        log.Fatalf(\"Cannot save PDF: %s|n\", err)\n    }\n}\n\nfunc CreateTableJSON(pdf *gofpdf.Fpdf, table []Person) *gofpdf.Fpdf {\n    for _, str := range table {\n</code></pre>\n\n<p><strong>BELOW IS WHERE I AM STRUGGLING. str needs to be of type string</strong></p>\n\n<pre><code>        pdf.CellFormat(20, 7, str, \"1\", 0, \"C\", false, 0, \"\")\n\n        pdf.Ln(-1)\n    }\n    return pdf\n}\n\n//Create function that generates a new pdf report\nfunc NewReport() *gofpdf.Fpdf {\n    pdf := gofpdf.New(\"P\", \"mm\", \"Letter\", \"\")\n    pdf.AddPage()\n    pdf.SetFont(\"Arial\", \"B\", 28)\n    pdf.Cell(40, 10, \"My title for the PDF (New)!\")\n    pdf.Ln(12)\n    pdf.SetFont(\"Arial\", \"\", 11)\n    pdf.Cell(40, 10, time.Now().Format(\"Mon Jan 2, 2006\"))\n    pdf.Ln(12)\n\n    return pdf\n}\n\n\nfunc SavePDFJSON(pdf *gofpdf.Fpdf) error {\n    return pdf.OutputFileAndClose(\"pdf_from_json.pdf\")\n}\n</code></pre>\n\n<p>So i'm able to read the data from the JSON file and print the lines to the console, but I can't use this data in the PDF generation functions since i've had to create a custom types, and the function parameters are expecting strings. Can anyone help me out here? I want the equivalent of this:</p>\n\n<pre><code>pdf.CellFormat(20, 7, **TOSTRING(str)**, \"1\", 0, \"C\", false, 0, \"\")\n</code></pre>\n\n<p>I've been messing around for about 3 hours now without any luck</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "edited": false, "score": 0, "creation_date": 1541956102, "post_id": 53250625, "comment_id": 93387027, "body": "It work but how to just put filename instead <code>go-play&#47;log.go:75</code> to <code>log.go:75</code>"}, {"owner": {"reputation": 101, "user_id": 10441175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kRVCauU-iC4/AAAAAAAAAAI/AAAAAAAAAOQ/8tSn6FbPoQA/photo.jpg?sz=128", "display_name": "iHelos", "link": "https://stackoverflow.com/users/10441175/ihelos"}, "reply_to_user": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "edited": false, "score": 0, "creation_date": 1541956819, "post_id": 53250625, "comment_id": 93387199, "body": "you can define your implementation of CallerEncoder     <code>func MyCaller(caller zapcore.EntryCaller, enc zapcore.PrimitiveArrayEncoder) { \tenc.AppendString(filepath.Base(caller.FullPath())) }</code>"}], "tags": [], "owner": {"reputation": 101, "user_id": 10441175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kRVCauU-iC4/AAAAAAAAAAI/AAAAAAAAAOQ/8tSn6FbPoQA/photo.jpg?sz=128", "display_name": "iHelos", "link": "https://stackoverflow.com/users/10441175/ihelos"}, "is_accepted": true, "score": 4, "last_activity_date": 1541957077, "last_edit_date": 1541957077, "creation_date": 1541952778, "answer_id": 53250625, "question_id": 53250323, "link": "https://stackoverflow.com/questions/53250323/uber-zap-logger-not-printing-caller-information-in-the-log-statement/53250625#53250625", "title": "Uber Zap logger not printing caller information in the log statement", "body": "<p>according to documentation <a href=\"https://godoc.org/go.uber.org/zap#AddCaller\" rel=\"nofollow noreferrer\">https://godoc.org/go.uber.org/zap#AddCaller</a>\nyou can do something like this on logger creation:</p>\n\n<pre><code>wlogger := zap.New(core, zap.AddCaller())\n</code></pre>\n\n<p><strong>update answer to comment</strong><br>\nalso you can define your implementation of caller encode:</p>\n\n<pre><code>func MyCaller(caller zapcore.EntryCaller, enc zapcore.PrimitiveArrayEncoder) {\n    enc.AppendString(filepath.Base(caller.FullPath()))\n}\n</code></pre>\n\n<p>and pass it to <em>cfgConsole</em> and <em>cfgFile</em></p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 6414819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e029ce6b9ecc5ab160cb364e4be933a?s=128&d=identicon&r=PG&f=1", "display_name": "moonD4rk", "link": "https://stackoverflow.com/users/6414819/moond4rk"}, "is_accepted": false, "score": 3, "last_activity_date": 1591693391, "creation_date": 1591693391, "answer_id": 62278832, "question_id": 53250323, "link": "https://stackoverflow.com/questions/53250323/uber-zap-logger-not-printing-caller-information-in-the-log-statement/62278832#62278832", "title": "Uber Zap logger not printing caller information in the log statement", "body": "<p><a href=\"https://godoc.org/go.uber.org/zap#AddCallerSkip\" rel=\"nofollow noreferrer\">AddCallerSkip</a> can help you skip caller's call stack depth. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// before\nzap.New(core, zap.AddCaller())\n// output: {\"level\":\"panic\",\"time\":\"2020-06-09T16:08:25.677+0800\",\"line\":\"log/log.go:118\",\"msg\":\"before\")}\n\n// add caller skip\nzap.New(core, zap.AddCaller(), zap.AddCallerSkip(1))\n// output: {\"level\":\"panic\",\"time\":\"2020-06-09T16:47:39.559+0800\",\"line\":\"client/client.go:29\",\"msg\":\"after\"}\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3672, "favorite_count": 1, "accepted_answer_id": 53250625, "answer_count": 2, "score": 2, "last_activity_date": 1591693391, "creation_date": 1541950763, "question_id": 53250323, "link": "https://stackoverflow.com/questions/53250323/uber-zap-logger-not-printing-caller-information-in-the-log-statement", "title": "Uber Zap logger not printing caller information in the log statement", "body": "<p>I am trying to put the same message to console and the log files at the same time with custom encoder for config. In the process I want to display the caller information but the same is not being displayed even if I have used <code>caller</code> key as suggested in the documentation. Below is the sample code for the same</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"time\"\n\n    \"go.uber.org/zap\"\n    \"go.uber.org/zap/zapcore\"\n    \"gopkg.in/natefinch/lumberjack.v2\"\n)\n\nvar logLevelSeverity = map[zapcore.Level]string{\n    zapcore.DebugLevel:  \"DEBUG\",\n    zapcore.InfoLevel:   \"INFO\",\n    zapcore.WarnLevel:   \"WARNING\",\n    zapcore.ErrorLevel:  \"ERROR\",\n    zapcore.DPanicLevel: \"CRITICAL\",\n    zapcore.PanicLevel:  \"ALERT\",\n    zapcore.FatalLevel:  \"EMERGENCY\",\n}\n\nfunc SyslogTimeEncoder(t time.Time, enc zapcore.PrimitiveArrayEncoder) {\n    enc.AppendString(t.Format(\"Jan 01, 2006  15:04:05\"))\n}\n\nfunc CustomEncodeLevel(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {\n    enc.AppendString(logLevelSeverity[level])\n}\n\nfunc CustomLevelFileEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {\n    enc.AppendString(\"[\" + logLevelSeverity[level] + \"]\")\n}\n\nfunc main() {\n\n    w := zapcore.AddSync(&amp;lumberjack.Logger{\n        Filename:   \"temp1.log\",\n        MaxSize:    1024,\n        MaxBackups: 20,\n        MaxAge:     28,\n        Compress:   true,\n    })\n\n    //Define config for the console output\n    cfgConsole := zapcore.EncoderConfig{\n        MessageKey:   \"message\",\n        LevelKey:     \"severity\",\n        EncodeLevel:  CustomEncodeLevel,\n        TimeKey:      \"time\",\n        EncodeTime:   SyslogTimeEncoder,\n        CallerKey:    \"caller\",\n        EncodeCaller: zapcore.FullCallerEncoder,\n    }\n    cfgFile := zapcore.EncoderConfig{\n        MessageKey:   \"message\",\n        LevelKey:     \"severity\",\n        EncodeLevel:  CustomLevelFileEncoder,\n        TimeKey:      \"time\",\n        EncodeTime:   SyslogTimeEncoder,\n        CallerKey:    \"caller\",\n        EncodeCaller: zapcore.FullCallerEncoder,\n    }\n\n    consoleDebugging := zapcore.Lock(os.Stdout)\n    //consoleError := zapcore.Lock(os.Stderr)\n    core := zapcore.NewTee(\n        zapcore.NewCore(zapcore.NewConsoleEncoder(cfgFile), w, zap.DebugLevel),\n        zapcore.NewCore(zapcore.NewJSONEncoder(cfgConsole), consoleDebugging, zap.DebugLevel),\n        //zapcore.NewCore(zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig()), consoleError, zap.ErrorLevel),\n    )\n    //core := zapcore.NewCore(zapcore.NewConsoleEncoder(encConsole), w, zap.DebugLevel)\n    wlogger := zap.New(core)\n    wlogger.Debug(\"Sample debug for log file and console\")\n    wlogger.Warn(\"An warning message example\")\n    wlogger.Info(\"An info level message\")\n    coreFile := zapcore.NewCore(zapcore.NewConsoleEncoder(cfgFile), w, zap.DebugLevel)\n    flogger := zap.New(coreFile)\n    flogger.Debug(\"An exclusive message for file\")\n    //output\n    //{\"severity\":\"DEBUG\",\"time\":\"Nov 11, 2018  20:24:11\",\"message\":\"Sample debug for log file and console\"}\n    //{\"severity\":\"WARNING\",\"time\":\"Nov 11, 2018  20:24:11\",\"message\":\"An warning message example\"}\n    //{\"severity\":\"INFO\",\"time\":\"Nov 11, 2018  20:24:11\",\"message\":\"An info level message\"}\n}\n</code></pre>\n\n<p>Any thoughts why the caller information is not being displayed. </p>\n"}, {"tags": ["go", "yaml", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1541963427, "post_id": 53250313, "comment_id": 93389055, "body": "Both YAML&#39;s you show have sequences, and are semantically equivalent. Your first YAML uses a flow-style sequence and the second example uses a block-style sequence. There is no such thing as an array in YAML."}, {"owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "reply_to_user": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1541978180, "post_id": 53250313, "comment_id": 93392918, "body": "OK so is there any way to force the marshaller to use flow-style, without having to define a specific struct?"}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1542009040, "post_id": 53250313, "comment_id": 93400109, "body": "No. There are libraries that allow all-flow-style, all-block-style, or outmost-collection-flow-style, but not yaml.v2"}, {"owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "reply_to_user": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1542042695, "post_id": 53250313, "comment_id": 93418046, "body": "Can you recommend one?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1541951133, "creation_date": 1541951133, "answer_id": 53250390, "question_id": 53250313, "link": "https://stackoverflow.com/questions/53250313/golang-yaml-v2-marshals-an-array-as-a-sequence/53250390#53250390", "title": "Golang yaml.v2 marshals an array as a sequence", "body": "<p>Use <a href=\"https://godoc.org/gopkg.in/yaml.v2#Marshal\" rel=\"nofollow noreferrer\"><code>flow</code></a> in struct field tag format, to indicate you desire this behavior. But, of course, this requires unmarshaling to a struct, not to a map.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 10441175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kRVCauU-iC4/AAAAAAAAAAI/AAAAAAAAAOQ/8tSn6FbPoQA/photo.jpg?sz=128", "display_name": "iHelos", "link": "https://stackoverflow.com/users/10441175/ihelos"}, "is_accepted": false, "score": 1, "last_activity_date": 1541951808, "creation_date": 1541951808, "answer_id": 53250497, "question_id": 53250313, "link": "https://stackoverflow.com/questions/53250313/golang-yaml-v2-marshals-an-array-as-a-sequence/53250497#53250497", "title": "Golang yaml.v2 marshals an array as a sequence", "body": "<p><em>Flow</em> tag allows you to choose the representation of an array in yaml</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n)\n\ntype Conf struct {\n    Test []string `yaml:\"array.test,flow\"`\n}\n\nfunc main(){\n    data := `array.test: [\"val1\", \"val2\", \"val3\"]`\n    var conf Conf\n    yaml.Unmarshal([]byte(data), &amp;conf)\n\n    data2, _ := yaml.Marshal(conf)\n    fmt.Printf(\"%s\\n\", string(data2))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "edited": false, "score": 0, "creation_date": 1541956913, "post_id": 53250675, "comment_id": 93387233, "body": "thanks for the answer but this is not my case. I&#39;m trying to marshal a map, not a predefined struct."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "edited": false, "score": 0, "creation_date": 1542025715, "post_id": 53250675, "comment_id": 93408604, "body": "@Forepick: As every answer indicates, using a struct is the only way to do what you&#39;re asking."}, {"owner": {"reputation": 301, "user_id": 853178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e4d7f811cc5ff1705e63ab0cdc9e457?s=128&d=identicon&r=PG", "display_name": "Eric Dorsey", "link": "https://stackoverflow.com/users/853178/eric-dorsey"}, "edited": false, "score": 0, "creation_date": 1615842988, "post_id": 53250675, "comment_id": 117813007, "body": "@Shudipta Thank you for the &quot;struct fields must be public&quot; comment; this helped me solve a similar issue!"}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 4, "last_activity_date": 1541956841, "last_edit_date": 1541956841, "creation_date": 1541953092, "answer_id": 53250675, "question_id": 53250313, "link": "https://stackoverflow.com/questions/53250313/golang-yaml-v2-marshals-an-array-as-a-sequence/53250675#53250675", "title": "Golang yaml.v2 marshals an array as a sequence", "body": "<p>This one helped me in the same case as you.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n\n        \"gopkg.in/yaml.v2\"\n)\n\nvar data = `\na: Easy!\nb:\nc: 2\nd.test: [\"d1\", \"d2\"]\n`\n\n// Note: struct fields must be public in order for unmarshal to\n// correctly populate the data.\ntype T struct {\n    A string\n    B struct {\n            RenamedC int   `yaml:\"c\"`\n            DTest        []string `yaml:\"d.test,flow\"`\n    }\n}\n\nfunc main() {\n    // if we use struct containing yaml encoding for yaml formated string \n    t := T{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;t)\n    if err != nil {\n            log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t after unmarshal:\\n%v\\n\\n\", t)\n\n    d, err := yaml.Marshal(&amp;t)\n    if err != nil {\n            log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t after marshal:\\n%s\\n\\n\", string(d))\n}\n</code></pre>\n\n<p>Ref: <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a></p>\n"}], "owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9983, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1541963327, "creation_date": 1541950724, "last_edit_date": 1541963327, "question_id": 53250313, "link": "https://stackoverflow.com/questions/53250313/golang-yaml-v2-marshals-an-array-as-a-sequence", "title": "Golang yaml.v2 marshals an array as a sequence", "body": "<p>Given the following YAML: </p>\n\n<pre><code>array.test: [\"val1\", \"val2\", \"val3\"]\n</code></pre>\n\n<p>I Unmarshal it using gopkg.in/yaml.v2 into a <code>map[string]interface{}</code>. Then I get a single key whose value is an array of 3 values.</p>\n\n<p>When I then Marshal it again to YAML, the resulting YAML looks like this:</p>\n\n<pre><code>array.test:\n- val1\n- val2\n- val3\n</code></pre>\n\n<p>The array was actually marshaled as a sequence instead of an array.</p>\n\n<p>This is the entire GoLang code:</p>\n\n<pre><code>func main(){\n    data := `array.test: [\"val1\", \"val2\", \"val3\"]`\n    conf := make(map[string]interface{})\n    yaml.Unmarshal([]byte(data), conf)\n\n    data2, _ := yaml.Marshal(conf)\n    fmt.Printf(\"%s\\n\", string(data2))\n}\n</code></pre>\n\n<p>How can I overcome this issue?</p>\n"}, {"tags": ["python-3.x", "asynchronous", "go", "concurrency", "python-asyncio"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1541951190, "post_id": 53250293, "comment_id": 93385632, "body": "Questions seeking third-party resources such as libraries, are off-topic. Rather than asking for an equivalent to a language primitive, a better approach is to ask a question about a specific problem you&#39;re actually facing in Go, and how to address it."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 1, "creation_date": 1541951939, "post_id": 53250293, "comment_id": 93385827, "body": "Just ask what you need specifically. Your question is not just clear."}, {"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "reply_to_user": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541964936, "post_id": 53250293, "comment_id": 93389521, "body": "@ShudiptaSharma I updated my question for better sense, I looking for an equivalent method/pattern in Go lang"}], "answers": [{"comments": [{"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1541965785, "post_id": 53251013, "comment_id": 93389761, "body": "Thanks for useful links and goroutines keyword like the <code>coroutines</code>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1542010575, "post_id": 53251013, "comment_id": 93400721, "body": "I failed to parse that passage regarding corouties and the goroutines. Judging from your other comment, you might be confusing these two terms but <a href=\"https://stackoverflow.com/a/18061564/720999\">they are profoundly different</a>. As the other person who answered your question suggested, you seem to lack even the most basic knowledge of Go. The &quot;problem&quot; with Go is that its approach to concurrency is vastly different from most other mainstream languages (maybe except Erlang) so you simply cannot sufficiently reason about it w/o gaining some basic familiarity with the language."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1542010696, "post_id": 53251013, "comment_id": 93400774, "body": "Start with <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">the tour</a> and then proceed to <a href=\"https://github.com/golang/go/wiki/Books\" rel=\"nofollow noreferrer\">books</a>. If you&#39;re seriously determined learning Go, I&#39;d recommend to jump straight to <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">GOPL</a>, otherwise start with something free, like <a href=\"https://www.golang-book.com/books/intro\" rel=\"nofollow noreferrer\">this one</a>."}, {"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1542011503, "post_id": 53251013, "comment_id": 93401152, "body": "Thanks again. I thought that coroutine and goroutine are similar, So I&#39;ve been the mistake."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1541955538, "last_edit_date": 1541955538, "creation_date": 1541955223, "answer_id": 53251013, "question_id": 53250293, "link": "https://stackoverflow.com/questions/53250293/python-asyncio-event-loop-equivalent-in-go-lang/53251013#53251013", "title": "Python asyncio event loop equivalent in Go lang", "body": "<p>You don't need this in Go as in Go this would be an anti-pattern.</p>\n\n<p>Instead, in Go, you have management of <a href=\"https://manpages.debian.org/2/poll\" rel=\"nofollow noreferrer\">\"pollable\" descriptors</a> \u2014 such as sockets \u2014 tightly integrated with the runtime and the goroutine scheduler.\nThis allows you to write normal <em>sequential</em> code which will internally be handled via a platform-specific \"eventful\" interface (such as <code>epoll</code> on Linux, <code>kqueue</code> on FreeBSD and IOCP on Windows).\nAs soon as a goroutine tries to perform any I/O on a socket and the socket is not ready, the goroutine gets suspended until that data is ready after which it will be resumed right at the place it has been suspended.</p>\n\n<p>Hence in Go, you merely create a separate goroutine to serve each request which should be performed or served concurrently with the others and write plain sequential code to handle it.</p>\n\n<p>For backrgound, start <a href=\"https://eli.thegreenplace.net/2018/go-hits-the-concurrency-nail-right-on-the-head/\" rel=\"nofollow noreferrer\">here</a> and <a href=\"http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>The tutorials explaining how the Go scheduler works are,\nfor instance, <a href=\"https://rakyll.org/scheduler/\" rel=\"nofollow noreferrer\">this</a>\nand <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1541971149, "post_id": 53252901, "comment_id": 93391274, "body": "Thanks again. Can you write the equivalent of example in question in Go? and what is the difference between thread, process, and coroutines in Go and how to access them?"}, {"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "reply_to_user": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 2, "creation_date": 1541975972, "post_id": 53252901, "comment_id": 93392458, "body": "@BenyaminJafari I&#39;ve added a roughly equivalent example. <i>what is the difference between thread, process, and coroutines in Go and how to access them?</i> Those questions are way out of scope for a StackOverflow answer; you might want to consult a book on Go."}], "tags": [], "owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "is_accepted": true, "score": 5, "last_activity_date": 1541975929, "last_edit_date": 1541975929, "creation_date": 1541967927, "answer_id": 53252901, "question_id": 53250293, "link": "https://stackoverflow.com/questions/53250293/python-asyncio-event-loop-equivalent-in-go-lang/53252901#53252901", "title": "Python asyncio event loop equivalent in Go lang", "body": "<p>In Python terms, the event loop is <strong>built into</strong> Go. You would launch two goroutines with <code>go async_say(...)</code> and wait for them to complete, for example using a <a href=\"https://gobyexample.com/channel-synchronization\" rel=\"nofollow noreferrer\">channel</a> or a <a href=\"https://medium.com/@matryer/very-basic-concurrency-for-beginners-in-go-663e63c6ba07\" rel=\"nofollow noreferrer\">wait group</a>.</p>\n\n<p>A straightforward translation of your code to Go could look like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc async_say(delay time.Duration, msg string, done chan bool) {\n    time.Sleep(delay)\n    fmt.Println(msg)\n    done &lt;- true\n}\n\nfunc main() {\n    done1 := make(chan bool, 1)\n    go async_say(4 * time.Second, \"hello\", done1)\n    done2 := make(chan bool, 1)\n    go async_say(6 * time.Second, \"world\", done2)\n    &lt;-done1\n    &lt;-done2\n}\n</code></pre>\n\n<p>Note that, unlike Python (and JavaScript, etc.), Go functions do not come in different <a href=\"http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"nofollow noreferrer\">colors</a> depending on whether they are asynchronous or not. They can <em>all</em> be run asynchronously, and the equivalent of asyncio is built into the standard library.</p>\n"}], "owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2066, "favorite_count": 0, "accepted_answer_id": 53252901, "answer_count": 2, "score": 0, "last_activity_date": 1541975929, "creation_date": 1541950597, "last_edit_date": 1541965927, "question_id": 53250293, "link": "https://stackoverflow.com/questions/53250293/python-asyncio-event-loop-equivalent-in-go-lang", "title": "Python asyncio event loop equivalent in Go lang", "body": "<p>I use asynchronous/concurrency <code>asyncio</code> event loop in <em>Python3.x</em>.</p>\n\n<p>Is there any equivalent of <code>asyncio</code> or coroutines in Go lang with concurrency performance using <strong>a thread</strong>? </p>\n\n<hr>\n\n<p>[<strong>NOTE</strong>]:</p>\n\n<p>Not parallelism + concurrency (multiprocessing) pattern.</p>\n\n<hr>\n\n<p>[UPDATE]:</p>\n\n<p>Here is an asynchronous event loop using <code>asyncio</code> in Python for better sense:</p>\n\n<pre><code>import asyncio\nimport time\n\nasync def async_say(delay, msg):\n    await asyncio.sleep(delay)\n    print(msg)\n\nasync def main():\n    task1 = asyncio.ensure_future(async_say(4, 'hello'))\n    task2 = asyncio.ensure_future(async_say(6, 'world'))\n\n    print(f\"started at {time.strftime('%X')}\")\n    await task1\n    await task2\n    print(f\"finished at {time.strftime('%X')}\")\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(main())\n</code></pre>\n\n<p>Out:</p>\n\n<pre><code>started at 13:19:44\nhello\nworld\nfinished at 13:19:50\n</code></pre>\n\n<hr>\n\n<p>Any help would be greatly appreciated.</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541944952, "post_id": 53249485, "comment_id": 93383809, "body": "I&#39;m afraid I don&#39;t understand your question. You appear to be asking two unrelated things: How to map a variable to a json key, and how to append a string. Which specific problem are you having?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541944986, "post_id": 53249485, "comment_id": 93383818, "body": "It would also help greatly to format your code to be readable."}, {"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541945374, "post_id": 53249485, "comment_id": 93383932, "body": "@Flimzy, sorry I will try to make me more clear. &quot;incident&quot;: {         &quot;type&quot;: &quot;incident&quot;,         &quot;title&quot;: &quot;Docker down on &quot;+hostname         } in this field title I would like to append my variable hostname, but this is being interpreted as a normal string and its value is not being printed. this is being interpreted literally as +hostname and  not as server1.local."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 1, "creation_date": 1541947335, "post_id": 53249485, "comment_id": 93384480, "body": "I&#39;d like to point out that <code>os.Hostname()</code> is a function."}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1541977008, "post_id": 53249761, "comment_id": 93392702, "body": "I have created the structure as you suggested but I am receiving that the other structs are undefined and I don&#39;t know why."}, {"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1541977119, "post_id": 53249761, "comment_id": 93392719, "body": "<code>incident := Incident{ \t\tType:  &quot;incident&quot;, \t\tTitle: fmt.Sprintf(&quot;Docker is down on %s&quot;, hostname), \t\tService{ \t\t\tID:   &quot;PZXSH36&quot;, \t\t\tType: &quot;service_reference&quot;, \t\t}, \t\tPriority{ \t\t\tID:   &quot;P53ZZH5&quot;, \t\t\tType: &quot;priority_reference&quot;, \t\t}, \t\tUrgency:     &quot;high&quot;, \t\tIncidentKey: &quot;baf7cf21b1da41b4b0221008339ff357&quot;, \t\tBody{ \t\t\tType:    &quot;incident_body&quot;, \t\t\tDetails: &quot;Docker service is down or container stopped&quot;, \t\t}, \t\tEscalationPolicy{ \t\t\tID:   &quot;PI772OH&quot;, \t\t\tType: &quot;escalation_policy_reference&quot;, \t\t}, \t} </code>"}, {"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1541977234, "post_id": 53249761, "comment_id": 93392739, "body": "Service, Priority, Body and EscalationPolicy are being marked as undefined."}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1542017613, "last_edit_date": 1542017613, "creation_date": 1541947028, "answer_id": 53249761, "question_id": 53249485, "link": "https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string/53249761#53249761", "title": "Insert a variable inside a string", "body": "<p>make a struct in go to represent the json</p>\n\n<pre><code>type \n    Incident struct {\n        Type    string `json:\"type\"`\n        Title   string `json:\"title\"`\n        Service struct {\n            ID   string `json:\"id\"`\n            Type string `json:\"type\"`\n        } `json:\"service\"`\n        Priority struct {\n            ID   string `json:\"id\"`\n            Type string `json:\"type\"`\n        } `json:\"priority\"`\n        Urgency     string `json:\"urgency\"`\n        IncidentKey string `json:\"incident_key\"`\n        Body        struct {\n            Type    string `json:\"type\"`\n            Details string `json:\"details\"`\n        } `json:\"body\"`\n        EscalationPolicy struct {\n            ID   string `json:\"id\"`\n            Type string `json:\"type\"`\n        } `json:\"escalation_policy\"`\n}\n</code></pre>\n\n<p>then do something like</p>\n\n<pre><code>hostname,err:=os.Hostname()\nif (err !=nil) {\n   panic(err)\n}\nincident:=Incident{ Type: \"incident\",\n                    Title: fmt.Sprintf(\"Docker is down on %s\", hostname),\n                    //...etc etc add all other fields\n\nreq, err := http.NewRequest(\"POST\", url, json.Marshal(incident))\n</code></pre>\n\n<p>The workaround for declaring structs inside structs seems a bit clumsy (sorry)</p>\n\n<pre><code>Service: struct {\n            ID   string `json:\"id\"`\n            Type string `json:\"type\"`\n        }{\n            ID: \"asdf\",\n            Type: \"ABC\",\n       },\n</code></pre>\n\n<p>This other answer <a href=\"https://stackoverflow.com/a/53255390/1153938\">https://stackoverflow.com/a/53255390/1153938</a> shows how to split the structs inside the Incident struct and is a cleaner way of doing it</p>\n\n<p>I'll leave this answer here because it might be of interest how to declare it in this way</p>\n\n<p>If you are only calling <code>json.Unmarshal</code> then this way would be fine but for declaring stuff in a program as you need to do, perhaps not the best</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1541947281, "creation_date": 1541947281, "answer_id": 53249794, "question_id": 53249485, "link": "https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string/53249794#53249794", "title": "Insert a variable inside a string", "body": "<p>The problem is as simple as properly quoting strings. This should solve your immediate problem:</p>\n\n<pre><code>jsonStr := []byte(`{\n    \"incident\": {\n        \"type\": \"incident\",\n        \"title\": \"Docker is down on `+hostname+`\",\n        \"service\": {\n          \"id\": \"PWIXJZS\",\n          \"type\": \"service_reference\"\n        },\n        \"priority\": {\n          \"id\": \"P53ZZH5\",\n          \"type\": \"priority_reference\"\n        },\n        \"urgency\": \"high\",\n        \"incident_key\": \"baf7cf21b1da41b4b0221008339ff357\",\n        \"body\": {\n          \"type\": \"incident_body\",\n          \"details\": \"A disk is getting full on this machine. You should investigate what is causing the disk to fill, and ensure that there is an automated process in place for ensuring data is rotated (eg. logs should have logrotate around them). If data is expected to stay on this disk forever, you should start planning to scale up to a larger disk.\"\n        },\n        \"escalation_policy\": {\n          \"id\": \"PT20YPA\",\n          \"type\": \"escalation_policy_reference\"\n        }\n    }\n}`)\n</code></pre>\n\n<p>But a much better approach, as suggested by @Vorsprung, is to use a proper Go data structure, and marshal it to JSON.</p>\n"}, {"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1541954340, "creation_date": 1541954340, "answer_id": 53250872, "question_id": 53249485, "link": "https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string/53250872#53250872", "title": "Insert a variable inside a string", "body": "<p>Try this solution:</p>\n\n<pre><code>hostname, err := os.Hostname()\nif err != nil {\n    // handle err\n}\n\nindent := fmt.Sprintf(`{\n    \"incident\": {\n        \"type\": \"incident\",\n        \"title\": \"Docker is down on %s\",\n        \"service\": {\n          \"id\": \"PWIXJZS\",\n          \"type\": \"service_reference\"\n        },\n        \"priority\": {\n          \"id\": \"P53ZZH5\",\n          \"type\": \"priority_reference\"\n        },\n        \"urgency\": \"high\",\n        \"incident_key\": \"baf7cf21b1da41b4b0221008339ff357\",\n        \"body\": {\n          \"type\": \"incident_body\",\n          \"details\": \"A disk is getting full on this machine. You should investigate what is causing the disk to fill, and ensure that there is an automated process in place for ensuring data is rotated (eg. logs should have logrotate around them). If data is expected to stay on this disk forever, you should start planning to scale up to a larger disk.\"\n        },\n        \"escalation_policy\": {\n          \"id\": \"PT20YPA\",\n          \"type\": \"escalation_policy_reference\"\n        }\n    }\n}`, hostname)\njsonStr := []byte(indent)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1542115484, "post_id": 53255390, "comment_id": 93445564, "body": "thank you very much, thanks to your explanation I was able to understand the concept of struct. After I created my struct my POST worked perfectly."}, {"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1542115553, "post_id": 53255390, "comment_id": 93445615, "body": "<code>type service struct { \t\tID   string </code>json:&quot;id&quot;` \t\tType string <code>json:&quot;type&quot;</code> \t}  \ttype priority struct { \t\tID   string <code>json:&quot;id&quot;</code> \t\tType string <code>json:&quot;type&quot;</code> \t}  \ttype body struct { \t\tType    string <code>json:&quot;type&quot;</code> \t\tDetails string <code>json:&quot;details&quot;</code> \t}  \ttype escalationPolicy struct { \t\tID   string <code>json:&quot;id&quot;</code> \t\tType string <code>json:&quot;type&quot;</code> \t}`"}, {"owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1542115569, "post_id": 53255390, "comment_id": 93445623, "body": "<code>type incident struct { \t\tType             string           </code>json:&quot;type&quot;` \t\tTitle            string           <code>json:&quot;title&quot;</code> \t\tService          service          <code>json:&quot;service&quot;</code> \t\tPriority         priority         <code>json:&quot;priority&quot;</code> \t\tUrgency          string           <code>json:&quot;urgency&quot;</code> \t\tIncidentKey      string           <code>json:&quot;incident_key&quot;</code> \t\tBody             body             <code>json:&quot;body&quot;</code> \t\tEscalationPolicy escalationPolicy <code>json:&quot;escalation_policy&quot;</code> \t}  \ttype master struct { \t\tIncident incident <code>json:&quot;incident&quot;</code> \t}`"}], "tags": [], "owner": {"reputation": 26, "user_id": 10638360, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e49d33cc7534fe61a10e90f9c7352266?s=128&d=identicon&r=PG&f=1", "display_name": "Elevennn", "link": "https://stackoverflow.com/users/10638360/elevennn"}, "is_accepted": true, "score": 0, "last_activity_date": 1541992236, "last_edit_date": 1541992236, "creation_date": 1541991032, "answer_id": 53255390, "question_id": 53249485, "link": "https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string/53255390#53255390", "title": "Insert a variable inside a string", "body": "<p>Building on @Vorsprung's response, unless I'm mistaken you may want to define the structs a little differently to avoid the error you are getting based on your <a href=\"https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string#comment93392739_53249761\">response</a>\nOnce you've initialized and populated required properties on incident you should be able to POST the object after performing a json.Marshal() on the object.</p>\n\n<pre><code>jsonObject, _ := json.MarshalIndent(someIncident, \"\", \"\\t\")\n</code></pre>\n\n<p>If the structs are to be used outside of this package you may want to change the names to uppercase to allow exportability.</p>\n\n<pre><code>type incident struct {\n    Type             string           `json:\"type\"`\n    Title            string           `json:\"title\"`\n    Service          service          `json:\"service\"`\n    Priority         priority         `json:\"priority\"`\n    Urgency          string           `json:\"urgency\"`\n    IncidentKey      string           `json:\"incident_key\"`\n    Body             body             `json:\"body\"`\n    EscalationPolicy escalationPolicy `json:\"escalation_policy\"`\n}\n\ntype service struct {\n    ID   string `json:\"id\"`\n    Type string `json:\"type\"`\n}\n\ntype priority struct {\n    ID   string `json:\"id\"`\n    Type string `json:\"type\"`\n}\n\ntype body struct {\n    Type    string `json:\"type\"`\n    Details string `json:\"details\"`\n}\n\ntype escalationPolicy struct {\n    ID   string `json:\"id\"`\n    Type string `json:\"type\"`\n}\n</code></pre>\n\n<p>Initialization of the object: </p>\n\n<pre><code>someIncident := incident{\n    Type:  \"SomeType\",\n    Title: \"SomeTitle\",\n    Service: service{\n        ID:   \"SomeId\",\n        Type: \"SomeType\"},\n    Priority: priority{\n        ID:   \"SomeId\",\n        Type: \"SomeType\"},\n    Urgency:     \"SomeUrgency\",\n    IncidentKey: \"SomeKey\",\n    Body: body{\n        Type:    \"SomeType\",\n        Details: \"SomeDetails\"},\n    EscalationPolicy: escalationPolicy{\n        ID:   \"SomeId\",\n        Type: \"SomeType\"}}\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 8628244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXIvm.jpg?s=128&g=1", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/8628244/dimitri-berveglieri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 53255390, "answer_count": 4, "score": -2, "last_activity_date": 1542017613, "creation_date": 1541944760, "last_edit_date": 1541970527, "question_id": 53249485, "link": "https://stackoverflow.com/questions/53249485/insert-a-variable-inside-a-string", "title": "Insert a variable inside a string", "body": "<p>I have the <code>hostname</code> and a <code>json</code> formated string. I want to insert the <code>hostname</code> inside the value string of a key in that <code>json</code> formated string.</p>\n\n<p>My full code:</p>\n\n<pre><code>func pager() string {\ntoken := \"xxxxxxxxxxx\"\nurl := \"https://api.pagerduty.com/incidents\"\nhostname, err := os.Hostname()\nfmt.Println(hostname, err)\n\njsonStr := []byte(`{\n    \"incident\": {\n        \"type\": \"incident\",\n        **\"title\": \"Docker is down on.\"+hostname,**\n        \"service\": {\n          \"id\": \"PWIXJZS\",\n          \"type\": \"service_reference\"\n        },\n        \"priority\": {\n          \"id\": \"P53ZZH5\",\n          \"type\": \"priority_reference\"\n        },\n        \"urgency\": \"high\",\n        \"incident_key\": \"baf7cf21b1da41b4b0221008339ff357\",\n        \"body\": {\n          \"type\": \"incident_body\",\n          \"details\": \"A disk is getting full on this machine. You should investigate what is causing the disk to fill, and ensure that there is an automated process in place for ensuring data is rotated (eg. logs should have logrotate around them). If data is expected to stay on this disk forever, you should start planning to scale up to a larger disk.\"\n        },\n        \"escalation_policy\": {\n          \"id\": \"PT20YPA\",\n          \"type\": \"escalation_policy_reference\"\n        }\n    }\n}`)\n\nreq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(jsonStr))\nreq.Header.Set(\"Content-Type\", \"application/json\")\nreq.Header.Set(\"Accept\", \"application/vnd.pagerduty+json;version=2\")\nreq.Header.Set(\"From\", \"shinoda@wathever.com\")\nreq.Header.Set(\"Authorization\", \"Token token=\"+token)\n\nclient := &amp;http.Client{}\nresp, err := client.Do(req)\nif err != nil {\n    panic(err)\n}\n\nreturn resp.Status\n}\n\nfunc main() {\n    fmt.Println(pager())\n\n}\n</code></pre>\n\n<p>I am not very familiar with go, in python I can do this easily and I dont know the proper way to do this in golang.</p>\n\n<p>If someone could explain me, I would be grateful.</p>\n\n<p>thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 6, "creation_date": 1541940565, "post_id": 53248861, "comment_id": 93382691, "body": "You are not actually <i>calling</i> c.convimg, you are returning the method."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1541942120, "post_id": 53248861, "comment_id": 93383042, "body": "The error is actually pretty clear. You&#39;re returning a function of type <code>func(io.Writer) error</code>, when you should be returning just an <code>error</code>."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541942237, "post_id": 53248861, "comment_id": 93383067, "body": "Actually <code>return c.convimg</code> does not mean that it returns an <code>error</code> as return value. It is actually ruturning a <code>func(io.Writer) error {...}</code> definition instead of returning an <code>error</code> as return value as the function requires."}, {"owner": {"reputation": 491, "user_id": 8428765, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3039f4235de5e9222ec889403a287d0e?s=128&d=identicon&r=PG&f=1", "display_name": "lipsum", "link": "https://stackoverflow.com/users/8428765/lipsum"}, "edited": false, "score": 0, "creation_date": 1541943667, "post_id": 53248861, "comment_id": 93383455, "body": "Got it now, very silly mistake. Maybe I&#39;m getting tired today. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 491, "user_id": 8428765, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3039f4235de5e9222ec889403a287d0e?s=128&d=identicon&r=PG&f=1", "display_name": "lipsum", "link": "https://stackoverflow.com/users/8428765/lipsum"}, "is_accepted": true, "score": 0, "last_activity_date": 1541944386, "last_edit_date": 1541944386, "creation_date": 1541943796, "answer_id": 53249346, "question_id": 53248861, "link": "https://stackoverflow.com/questions/53248861/interface-does-not-implement-error-missing-error-method/53249346#53249346", "title": "Interface does not implement error (missing Error method)", "body": "<p>As the comments above, <code>return c.convimg</code> returns a function. I should write it like:</p>\n\n<pre><code>func convert(c Converter, w io.Writer) error\n    return c.convimg(w) \n</code></pre>\n"}], "owner": {"reputation": 491, "user_id": 8428765, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3039f4235de5e9222ec889403a287d0e?s=128&d=identicon&r=PG&f=1", "display_name": "lipsum", "link": "https://stackoverflow.com/users/8428765/lipsum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2022, "favorite_count": 0, "accepted_answer_id": 53249346, "answer_count": 1, "score": -4, "last_activity_date": 1541944386, "creation_date": 1541940170, "last_edit_date": 1541941656, "question_id": 53248861, "link": "https://stackoverflow.com/questions/53248861/interface-does-not-implement-error-missing-error-method", "title": "Interface does not implement error (missing Error method)", "body": "<p>I'm writing image converter program with Golang. Here's one of my file.</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/gif\"\n    \"image/jpeg\"\n    \"image/png\"\n    \"io\"\n)\n\ntype Converter interface {\n    convimg(io.Writer) error\n}\n\ntype jpgConverter struct {\n    img image.Image\n}\n\ntype pngConverter struct {\n    img image.Image\n}\n\ntype gifConverter struct {\n    img image.Image\n}\n\nfunc convert(c Converter) error {\n    return c.convimg  //compile error\n}\n\nfunc (c jpgConverter) convimg(dist io.Writer) error {\n    return jpeg.Encode(dist, c.img, nil)\n}\n\nfunc (c pngConverter) convimg(dist io.Writer) error {\n    return png.Encode(dist, c.img)\n}\n\nfunc (c gifConverter) convimg(dist io.Writer) error {\n    return gif.Encode(dist, c.img, nil)\n}\n</code></pre>\n\n<p>I use interface for duck typing so that I can use one same method for any type conversion.<br>\nBut a compile error occurred in <code>convert</code> method, and the error message says <code>cannot use c.convimg (type func(io.Writer) error) as type error in return argument: func(io.Writer) error does not implement error (missing Error method)</code>.<br>\nI define <code>error</code> as return type in the interface, but Where's the wrong point?</p>\n"}, {"tags": ["sockets", "asynchronous", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1541940124, "post_id": 53248807, "comment_id": 93382579, "body": "Writes are not asynchronous. What makes you think that your &quot;server only receives very little data&quot;? It doesn&#39;t matter how simple you think your code is, it can still be incorrect. Do include it in the question."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1541947349, "post_id": 53248807, "comment_id": 93384488, "body": "<i>&quot;detect whether all data is sent to the server from the socket.&quot;</i> - Do you really want to know if all data are sent (and might be still in transit and might get lost there) or do you rather want to know if all data got received and probably also processed by the server?  My guess is the last in which case you need the server to send some kind of acknowledgement back."}, {"owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 0, "creation_date": 1541988199, "post_id": 53248807, "comment_id": 93394859, "body": "Maybe related <a href=\"https://github.com/golang/go/issues/25722\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/25722</a>"}, {"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1542029073, "post_id": 53248807, "comment_id": 93410360, "body": "@Peter I add my code. Please have a look. I  remain confused about the problem. Thanks."}, {"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1542029165, "post_id": 53248807, "comment_id": 93410404, "body": "@SteffenUllrich I just want to ensure all the data is sent before Write() returns."}, {"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "reply_to_user": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 0, "creation_date": 1542029223, "post_id": 53248807, "comment_id": 93410440, "body": "@alex thanks for your information. But I still cannot find the reason why my code doesn&#39;t work."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1542034483, "post_id": 53248807, "comment_id": 93413514, "body": "@MartinZ: sent from the application to the OS kernel, sent from the OS kernel to the network card or actually have left the computer? <code>Write</code> can only give the first, the rest is out of control of the application."}, {"owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 0, "creation_date": 1542099036, "post_id": 53248807, "comment_id": 93436196, "body": "@MartinZ forget my previous message - wrong bug. You code looks fine, except your server sends received data back to the client, but your client code does not show receiving the data. With TCP connections - what comes in at one end should be read at the other end, otherwise you will have problems. And you also do not show error checking of write in the client. Do you check for write error?"}, {"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1542194482, "post_id": 53248807, "comment_id": 93478754, "body": "@SteffenUllrich Thanks for your answer. You are right."}, {"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "reply_to_user": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 0, "creation_date": 1542195039, "post_id": 53248807, "comment_id": 93479050, "body": "@alex Thanks again. The code I show here is just for reproduing the issue I encounter. In the real code I always check the returned err and there is no obvious error occurred. Just as you said, when I write some application protocols with the socket, there always are some mechanisms to check whther the server received the right data sent from the client. So I think I have got an answer."}], "answers": [{"tags": [], "owner": {"reputation": 134, "user_id": 9033739, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-T-HhIiUE9PU/AAAAAAAAAAI/AAAAAAAAAB0/XiM_soYGYOc/photo.jpg?sz=128", "display_name": "Dennis19901", "link": "https://stackoverflow.com/users/9033739/dennis19901"}, "is_accepted": false, "score": 2, "last_activity_date": 1541940744, "creation_date": 1541940744, "answer_id": 53248931, "question_id": 53248807, "link": "https://stackoverflow.com/questions/53248807/golang-socket-doesnt-send-all-bytes-before-write-method-returns/53248931#53248931", "title": "golang socket doesn&#39;t send all bytes before Write() method returns", "body": "<p>Did you poll the socket before trying to write?</p>\n\n<p>Behind the socket is your operating system's tcp stack. When writing on a socket, you push bytes to the send buffer. Your operating system then self determines when and how to send. If the receiving end has no buffer space.available in their receice buffer, your sending end knows this and will not put any more information in the send buffer.</p>\n\n<p>Make sure your send buffer has enough space for whatever you are trying to send next. This is done by polling the socket. This method is usually called Socket.Poll. I.recommend you ccheck the golang docs for the exact usage.</p>\n"}, {"comments": [{"owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "edited": false, "score": 0, "creation_date": 1542195567, "post_id": 53263806, "comment_id": 93479328, "body": "Thanks. After some days of study, I realize that Golang makes the TCPConn.Write works asynchronously, what I should do is give it time to send all data to the server internally. As for ensuring all data is sent successfully, the higher level protocols can ensure it."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1542031427, "creation_date": 1542031427, "answer_id": 53263806, "question_id": 53248807, "link": "https://stackoverflow.com/questions/53248807/golang-socket-doesnt-send-all-bytes-before-write-method-returns/53263806#53263806", "title": "golang socket doesn&#39;t send all bytes before Write() method returns", "body": "<p>You are not handling the error returned by conn.Read correctly. From <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">the docs</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>When Read encounters an error or end-of-file condition after successfully reading n > 0 bytes, it returns the number of bytes read. It may return the (non-nil) error from the same call or return the error (and n == 0) from a subsequent call. [...]</p>\n  \n  <p><strong>Callers should always process the n > 0 bytes returned before considering the error err</strong>. Doing so correctly handles I/O errors that happen after reading some bytes and also both of the allowed EOF behaviors.</p>\n</blockquote>\n\n<p>Note that you are re-inventing <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\">io.Copy</a> (albeit with an excessive buffer size). Your server code can be rewritten as:</p>\n\n<pre><code>func handleRequest(conn net.Conn) {\n    defer conn.Close()\n    n, err := io.Copy(conn, conn)\n}\n</code></pre>\n"}], "owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1425, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1542031427, "creation_date": 1541939679, "last_edit_date": 1542029646, "question_id": 53248807, "link": "https://stackoverflow.com/questions/53248807/golang-socket-doesnt-send-all-bytes-before-write-method-returns", "title": "golang socket doesn&#39;t send all bytes before Write() method returns", "body": "<p>Today when I try to send 100M data to my server (a very simple TCP server also written in Golang), I found that the TCPConn.Write method returns 104857600 and nil error and then I close the socket. But my server only receives very little data. I think it is because Write method works in async mode, so although the method returns 104857600, only a little data is sent to the server. So I want to know whether there is a way to set the Write work in sync mode or how to detect whether all data is sent to the server from the socket.</p>\n\n<p>The code is as follows:\nserver:</p>\n\n<pre><code>const ListenAddress = \"192.168.0.128:8888\"\nfunc main() {\n\n    var l net.Listener\n    var err error\n    l, err = net.Listen(\"tcp\", ListenAddress)\n    if err != nil {\n        fmt.Println(\"Error listening:\", err)\n        os.Exit(1)\n    }\n    defer l.Close()\n    fmt.Println(\"listen on \" + ListenAddress)\n    for {\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err)\n            os.Exit(1)\n        }\n        //logs an incoming message\n        fmt.Printf(\"Received message %s -&gt; %s \\n\", conn.RemoteAddr(), conn.LocalAddr())\n        // Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\nfunc handleRequest(conn net.Conn) {\n    defer conn.Close()\n    rcvLen := 0\n    rcvData := make([]byte,20 * 1024 * 1024) // 20M\n    for {\n        l , err := conn.Read(rcvData)\n        if err != nil {\n            fmt.Printf(\"%v\", err)\n            return\n        }\n        rcvLen += l\n        fmt.Printf(\"recv: %d\\r\\n\", rcvLen)\n\n        conn.Write(rcvData[:l])\n    }\n}\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", \"192.168.0.128:8888\")\nif err != nil {\n    fmt.Println(err)\n    os.Exit(-1)\n}\ndefer conn.Close()\ndata := make([]byte, 500 * 1024 * 1024)\nlen, err := conn.Write(data)\nfmt.Println(\"send len: \", len)\n</code></pre>\n\n<p>The output of the client: </p>\n\n<pre><code>send len:  524288000\n</code></pre>\n\n<p>The output of the server:</p>\n\n<pre><code>listen on 192.168.0.128:8888\nReceived message 192.168.0.2:50561 -&gt; 192.168.0.128:8888 \nrecv: 166440\nrecv: 265720\nEOF\n</code></pre>\n\n<p>I know if I can make the client wait for a while by SetLinger method, the data will be all sent to the server before the socket is closed. But I want to find a way to make the socket send all data before returns without calling SetLinger(). Thanks in advance. Please excuse my poor English.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 2, "creation_date": 1541929848, "post_id": 53247098, "comment_id": 93379891, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18088294/how-to-not-marshal-an-empty-struct-into-json-with-go\">How to not marshal an empty struct into JSON with Go?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "is_accepted": true, "score": 6, "last_activity_date": 1541926242, "creation_date": 1541926242, "answer_id": 53247151, "question_id": 53247098, "link": "https://stackoverflow.com/questions/53247098/how-to-omit-conditional-field-of-struct-within-marshal/53247151#53247151", "title": "How to omit conditional field of struct within marshal", "body": "<p>You could use <code>*int</code> instead of int and set the pointer value to nil in order to omit this.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype MyStruct struct {\n    Code        int   `json:\"Code\"`\n    Flags       uint8 `json:\"Flags\"`\n    OptionField *int  `json:\",omitempty\"`\n}\n\nfunc format(s MyStruct) string {\n    r, _ := json.Marshal(s)\n    return string(r)\n}\n\nfunc main() {\n    f := MyStruct{Code: 500, Flags: 10, OptionField: new(int)}\n    fmt.Println(format(f)) // {\"Code\":500,\"Flags\":10,\"OptionField\":0}\n    f.OptionField = nil\n    fmt.Println(format(f)) // {\"Code\":500,\"Flags\":10}\n}\n</code></pre>\n"}], "owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 53247151, "answer_count": 1, "score": 1, "last_activity_date": 1541932556, "creation_date": 1541925685, "last_edit_date": 1541932556, "question_id": 53247098, "link": "https://stackoverflow.com/questions/53247098/how-to-omit-conditional-field-of-struct-within-marshal", "title": "How to omit conditional field of struct within marshal", "body": "<p>There is struct of <strong>MyStruct</strong>.</p>\n\n<pre><code>type MyStruct struct {\n    Code        int   `json:\"Code\"`\n    Flags       uint8 `json:\"Flags\"`\n    OptionField int   `json:\",omitempty\"`\n}\n</code></pre>\n\n<p>Following code convert it to json.</p>\n\n<pre><code>f := MyStruct{Code:500, OptionField:41}\nr, _ := json.Marshal(f)\nfmt.Println(string(r)\n</code></pre>\n\n<p>I need to \"OptionField\" be optional. Some time it should exist in json with one of values [0, 1, 2, 3, ]. and in the other time it should exclude from json.</p>\n\n<p>My problem is: omitempty will exclude it when the value is zero, and the default value of int is zero. Is there any way to omit field in condition (ex: omit if value is -1). Or there is any way to do it.</p>\n"}, {"tags": ["go", "binary", "numeric", "twos-complement"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 2370086, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lC6Qg.jpg?s=128&g=1", "display_name": "Radoslav Stoyanov", "link": "https://stackoverflow.com/users/2370086/radoslav-stoyanov"}, "edited": false, "score": 0, "creation_date": 1541916439, "post_id": 53246263, "comment_id": 93377504, "body": "Wow! It seems to be working, but... isn&#39;t there some more fancy way of doing it as in the other languages? :)"}, {"owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "reply_to_user": {"reputation": 1250, "user_id": 2370086, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lC6Qg.jpg?s=128&g=1", "display_name": "Radoslav Stoyanov", "link": "https://stackoverflow.com/users/2370086/radoslav-stoyanov"}, "edited": false, "score": 0, "creation_date": 1541916716, "post_id": 53246263, "comment_id": 93377550, "body": "Golang is a type-safe language which means that it does not allow you to interpret values to an incompatible type(int64 to raw bytes in this case), which is not the case in &quot;other languages&quot; such as C. If you really needed to do so you will have to use the <code>unsafe</code> package to circumvent this protection."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1541931014, "post_id": 53246263, "comment_id": 93380187, "body": "Don&#39;t use package <code>unsafe</code> for this, simply convert it to unsigned integer as presented in the marked duplicate. Only use <code>unsafe</code> if truly justified, and only as a last resort."}], "tags": [], "owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "is_accepted": false, "score": 3, "last_activity_date": 1541916137, "creation_date": 1541916137, "answer_id": 53246263, "question_id": 53246159, "link": "https://stackoverflow.com/questions/53246159/negative-integer-to-binary-in-golang/53246263#53246263", "title": "Negative integer to binary in Golang", "body": "<p>I am sorry but did you mean you wanted to explore how int64 values are stored in the memory? You will need to use the <code>unsafe</code> package to force reinterpret a value in go.</p>\n\n<p>This code does what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    a := int64(-1)\n    fmt.Printf(\"%x\\n\", *(*[8]byte)(unsafe.Pointer(&amp;a)))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 172, "user_id": 8672913, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/01MkZ.jpg?s=128&g=1", "display_name": "Kenpachi", "link": "https://stackoverflow.com/users/8672913/kenpachi"}, "edited": false, "score": 0, "creation_date": 1596408729, "post_id": 53246606, "comment_id": 111795060, "body": "you can also use the bitwise not operator and add 1 <code>^bits+1</code>"}], "tags": [], "owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "is_accepted": false, "score": 0, "last_activity_date": 1541921001, "last_edit_date": 1541921001, "creation_date": 1541920442, "answer_id": 53246606, "question_id": 53246159, "link": "https://stackoverflow.com/questions/53246159/negative-integer-to-binary-in-golang/53246606#53246606", "title": "Negative integer to binary in Golang", "body": "<p>I also wrote a func to programmatically calculate the two's complement notation of a <code>int64</code> in case that you just wanted to calculate the value:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    a := int64(-1)\n    fmt.Printf(\"%x\\n\", TwoComplement(a))\n}\n\nfunc TwoComplement(val int64) []byte {\n    n := big.NewInt(val)\n\n    var r []byte\n    if n.Cmp(big.NewInt(0)) != -1 {\n        r = n.Bytes()\n    } else {\n        mask := big.NewInt(1)\n        mask.Lsh(mask, 64)\n\n        r = n.Add(n, mask).Bytes()\n    }\n\n    res := bytes.NewBuffer([]byte{})\n    for i := 0; i &lt; 8-len(r); i++ {\n        res.WriteByte(0)\n    }\n    res.Write(r)\n    return res.Bytes()\n}\n</code></pre>\n"}], "owner": {"reputation": 1250, "user_id": 2370086, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lC6Qg.jpg?s=128&g=1", "display_name": "Radoslav Stoyanov", "link": "https://stackoverflow.com/users/2370086/radoslav-stoyanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1957, "favorite_count": 2, "closed_date": 1541930866, "answer_count": 2, "score": 3, "last_activity_date": 1541921001, "creation_date": 1541914863, "question_id": 53246159, "link": "https://stackoverflow.com/questions/53246159/negative-integer-to-binary-in-golang", "closed_reason": "Duplicate", "title": "Negative integer to binary in Golang", "body": "<p>How can a negative integer be represented as a binary in Go, using the two's complement notation?<br>\nFor example:</p>\n\n<pre><code>n := int64(-1)\nfmt.Printf(\"%b\", n)\nfmt.Println(strconv.FormatInt(n, 2))\n</code></pre>\n\n<p>Both lines print <code>-1</code>. The result shoud be like <code>ffffffffffffffff</code>.</p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541913553, "post_id": 53245917, "comment_id": 93377123, "body": "I copied and pasted <a href=\"https://play.golang.org/p/SZSBdxpaUjP\" rel=\"nofollow noreferrer\">to the playground</a> and it works as expected.  What&#39;s different from actual code?"}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541913720, "post_id": 53245917, "comment_id": 93377148, "body": "Issue must be the S3 side of things. I&#39;m reading this information from a bucket and it must not be encoding it right. I thought it was at the parsing level but doesn&#39;t look like it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541913803, "post_id": 53245917, "comment_id": 93377164, "body": "S3 does not transform data.  Whatever you put in is what you get out.  Consider printing the first chunk of data with %q to see if data is what you expect it to be."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541913856, "post_id": 53245917, "comment_id": 93377169, "body": "It is. I printed the whole thing out. It&#39;s a giant slice. I have a function that dumps to s3 and a function that reads from s3 and transforms it. At the point of trying to transform it, it doesn&#39;t understand it as a csv. I&#39;m setting the content type to csv but if I download it, it is text."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541914547, "post_id": 53245917, "comment_id": 93377243, "body": "If you&#39;re still curious, it&#39;s the body field of <code>GetObjectOutput</code> from aws&#39;s go s3 package."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541915740, "post_id": 53245917, "comment_id": 93377407, "body": "What do you mean that it&#39;s a giant slice?  Can you given an example in the question? The problem is not in the code you have shown, so consider editing the question to include more code and context."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541921020, "post_id": 53245917, "comment_id": 93378249, "body": "Can you add the output of <code>b := make([]byte, 128); io.ReadFull(object.Body, b); fmt.Println(hex.Dump(b))</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541912568, "post_id": 53245978, "comment_id": 93377014, "body": "Hmm. If I read twice, it returns nothing because the first line reads everything."}, {"owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "reply_to_user": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541912788, "post_id": 53245978, "comment_id": 93377037, "body": "Maybe it was because of the new line character of the source file. Try using &quot;COL1,COL2\\r\\nval1,val2\\r\\nval1,val2\\r\\nval1,val2\\r\\n&quot; as data instead?"}, {"owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "reply_to_user": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541912842, "post_id": 53245978, "comment_id": 93377048, "body": "The first call to <code>Read</code> should only discard the first line, not consuming the whole reader."}, {"owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "reply_to_user": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541913018, "post_id": 53245978, "comment_id": 93377068, "body": "Have you tried using &quot;COL1,COL2\\r\\nval1,val2\\r\\nval1,val2\\r\\nval1,val2\\r\\n&quot; as the input string? I am running out of ideas if it still does not work as it worked on my machine :("}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1541913164, "post_id": 53245978, "comment_id": 93377087, "body": "Sadly, this is all in a remote environment in lambda so it might be related to the content type of the file that&#39;s being read from. I can get it to work from a bytestring but simulating the whole application flow is tough."}], "tags": [], "owner": {"reputation": 332, "user_id": 9739737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c098a7f12b7223f8d985edc29eb50afe?s=128&d=identicon&r=PG", "display_name": "Eternal_flame-AD", "link": "https://stackoverflow.com/users/9739737/eternal-flame-ad"}, "is_accepted": false, "score": 0, "last_activity_date": 1541912276, "creation_date": 1541912276, "answer_id": 53245978, "question_id": 53245917, "link": "https://stackoverflow.com/questions/53245917/parsing-csv-in-golang-with-iso-8859-1-encoding/53245978#53245978", "title": "Parsing CSV in golang with ISO-8859-1 encoding", "body": "<p>I think the first row in the sample you provided is not formed correctly. Shouldn't it be <code>COL1,COL2</code> instead?</p>\n\n<p>I think the following code does what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/csv\"\n    \"fmt\"\n)\n\nfunc main() {\n    data := bytes.NewBufferString(`COL1,COL2\nval1,val2\nval1,val2\nval1,val2`)\n\n    reader := csv.NewReader(data)\n    reader.Read() // Skip header\n    lines, err := reader.ReadAll()\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(lines)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 178, "user_id": 5396095, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IDb1FSLNLzk/AAAAAAAAAAI/AAAAAAAAAC0/yy90p8_VuMM/photo.jpg?sz=128", "display_name": "Mohammad Nasirifar", "link": "https://stackoverflow.com/users/5396095/mohammad-nasirifar"}, "is_accepted": false, "score": 0, "last_activity_date": 1541912400, "creation_date": 1541912400, "answer_id": 53245983, "question_id": 53245917, "link": "https://stackoverflow.com/questions/53245917/parsing-csv-in-golang-with-iso-8859-1-encoding/53245983#53245983", "title": "Parsing CSV in golang with ISO-8859-1 encoding", "body": "<p>From <a href=\"https://tools.ietf.org/html/rfc4180\" rel=\"nofollow noreferrer\">CSV RFC</a>:</p>\n\n<pre><code>  3.  There maybe an optional header line appearing as the first line\n   of the file with the same format as normal record lines.  This\n   header will contain names corresponding to the fields in the file\n   and should contain the same number of fields as the records in\n   the rest of the file (the presence or absence of the header line\n   should be indicated via the optional \"header\" parameter of this\n   MIME type).  For example:\n\n   field_name,field_name,field_name CRLF\n   aaa,bbb,ccc CRLF\n   zzz,yyy,xxx CRLF\n</code></pre>\n\n<p>You're missing a comma in the header, the parser therefore thinks that the whole file is one column wide.</p>\n"}], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 635, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1541969312, "creation_date": 1541911437, "last_edit_date": 1541969312, "question_id": 53245917, "link": "https://stackoverflow.com/questions/53245917/parsing-csv-in-golang-with-iso-8859-1-encoding", "title": "Parsing CSV in golang with ISO-8859-1 encoding", "body": "<p>I have a csv file that has a row of headers and then several dozen lines. When I attempt to read it as a csv, it gets returned as 1 large slice. Why does it not get returned as separate rows?\nInput looks like:</p>\n\n<pre><code>COL1,COL2\nval1,val2\nval1,val2\nval1,val2\n</code></pre>\n\n<p><code>object.Body</code> is a <code>ReadCloser</code></p>\n\n<pre><code>lines, err := csv.NewReader(object.Body).ReadAll()\nif err != nil {\n    log.Fatal(err)\n}\n\nfor _, line := range lines {\n    log.Print(line)\n}\n</code></pre>\n\n<p>Output is returned as</p>\n\n<pre><code>[COL1 COL2\nval1,val2\nval1,val2\nval1,val2]\n</code></pre>\n\n<p>I would expect the return to be:</p>\n\n<pre><code>[\n  [val1, val2],\n  [val1, val2],\n  [val1, val2],\n]\n</code></pre>\n\n<p>Any ideas? Totally stumped on this one. </p>\n\n<p><strong>Edit</strong> I mistakenly forgot to add a comma in the header. This was only in the sample code, not the actual issue. Sorry for the confusion. </p>\n\n<p><strong>Edit</strong> I believe that this issue is due to an encoding of the csv file differently.</p>\n"}, {"tags": ["string", "go", "inversion", "reversion"], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1541900248, "post_id": 53244842, "comment_id": 93375414, "body": "A similar approach using <a href=\"https://godoc.org/unicode/utf8#DecodeLastRuneInString\" rel=\"nofollow noreferrer\"><code>(unicode&#47;utf8).DecodeLastRuneInString</code></a> might save an extra array/translation."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1541913741, "post_id": 53244842, "comment_id": 93377155, "body": "@DavidMaze neat idea, I can&#39;t get a benchmark to run faster than the above method or work with unicode edge cases though."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 3, "last_activity_date": 1541898404, "last_edit_date": 1541898404, "creation_date": 1541897153, "answer_id": 53244842, "question_id": 53244824, "link": "https://stackoverflow.com/questions/53244824/how-to-manipulate-strings-in-go-to-reverse-them/53244842#53244842", "title": "How to manipulate strings in GO to reverse them?", "body": "<p>As you correctly identified, <a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">go strings are immutable</a>, so you cannot assign to rune/character values at given indices.</p>\n\n<p>Instead of reversing the string in-place one must create a copy of the runes in the string and reverse those instead, and then return the resulting string.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/FTvfFKK25-O\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func reverse(s string) string {\n  rs := []rune(s)\n  for i, j := 0, len(rs)-1; i &lt; j; i, j = i+1, j-1 {\n    rs[i], rs[j] = rs[j], rs[i]\n  }\n  return string(rs)\n}\n\nfunc main() {\n  fmt.Println(reverse(\"Hello, World!\"))\n  // !dlroW ,olleH\n  fmt.Println(reverse(\"Hello, \u4e16\u754c!\"))\n  // !\u754c\u4e16 ,olleH\n}\n</code></pre>\n\n<p>There are problems with this approach due to the intricacies of Unicode (e.g. <a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks\" rel=\"nofollow noreferrer\">combining diacritical marks</a>) but this will get you started.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1612098593, "last_edit_date": 1612098593, "creation_date": 1593965484, "answer_id": 62743214, "question_id": 53244824, "link": "https://stackoverflow.com/questions/53244824/how-to-manipulate-strings-in-go-to-reverse-them/62743214#62743214", "title": "How to manipulate strings in GO to reverse them?", "body": "<p>If you want to take into account <a href=\"https://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">unicode combining characters</a> (characters that are intended to modify other characters, like an acute accent <code>\u00b4</code> + <code>e</code> = <code>\u00e9</code>), <a href=\"https://github.com/acsellers\" rel=\"nofollow noreferrer\">Andrew Sellers</a> has an interesting take <a href=\"https://gist.github.com/acsellers/26f8f9cfc0cf5ed8353cc1eab4c07219\" rel=\"nofollow noreferrer\">in this gist</a>.</p>\n<p>It starts by listing the <a href=\"https://en.wikipedia.org/wiki/Unicode_block\" rel=\"nofollow noreferrer\">Unicode block range</a> for all <a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks\" rel=\"nofollow noreferrer\">combining diacritical marks (CDM)</a> (the  <a href=\"https://en.wikipedia.org/wiki/Unicode_block\" rel=\"nofollow noreferrer\">Unicode block</a> containing the most common <a href=\"https://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">combining characters</a>)</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks\" rel=\"nofollow noreferrer\">regulars</a> (<a href=\"https://en.wikipedia.org/wiki/Script_(Unicode)#Special_script_property_values\" rel=\"nofollow noreferrer\">inherited</a>), so the usual \u25cc\u0300   \u25cc\u0301  \u25cc\u0302  \u25cc\u0303  \u25cc\u0304  \u25cc\u0305  \u25cc\u0306  \u25cc\u0307  \u25cc\u0308, ...;</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_Extended\" rel=\"nofollow noreferrer\">extended</a> (containing diacritical marks used in German dialectology -- <a href=\"https://en.wikipedia.org/wiki/Teuthonista\" rel=\"nofollow noreferrer\">Teuthonista</a>)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_Supplement\" rel=\"nofollow noreferrer\">supplement</a> (or the <a href=\"https://en.wikipedia.org/wiki/Uralic_Phonetic_Alphabet\" rel=\"nofollow noreferrer\">Uralic Phonetic Alphabet</a>, Medievalist notations, and German dialectology -- again, Teuthonista)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_for_Symbols\" rel=\"nofollow noreferrer\">for symbols</a> (arrows, dots, enclosures, and overlays for modifying symbol characters)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Combining_Half_Marks\" rel=\"nofollow noreferrer\">Half Marks</a> (diacritic mark parts for spanning multiple characters, as <a href=\"https://scriptsource.org/cms/scripts/page.php?item_id=entry_detail&amp;uid=vj4y8j2bj4\" rel=\"nofollow noreferrer\">seen here</a>)</li>\n</ul>\n<pre class=\"lang-golang prettyprint-override\"><code>var combining = &amp;unicode.RangeTable{\n    R16: []unicode.Range16{\n        {0x0300, 0x036f, 1}, // combining diacritical marks\n        {0x1ab0, 0x1aff, 1}, // combining diacritical marks extended\n        {0x1dc0, 0x1dff, 1}, // combining diacritical marks supplement\n        {0x20d0, 0x20ff, 1}, // combining diacritical marks for symbols\n        {0xfe20, 0xfe2f, 1}, // combining half marks\n    },\n}\n</code></pre>\n<p>You can then read, rune after rune, your initial string:</p>\n<pre><code>sv := []rune(s)\n</code></pre>\n<p>But if you do so in <em>reverse</em> order, you will encounter <strong>combining diacritical marks (CDMs)</strong> <em>first</em>, <strong>and those need to preserve their order, to <em>not</em> be reversed</strong></p>\n<pre class=\"lang-golang prettyprint-override\"><code>for ix := len(sv) - 1; ix &gt;= 0; ix-- {\n        r := sv[ix]\n        if unicode.In(r, combining) {\n            cv = append(cv, r)\n            fmt.Printf(&quot;Detect combining diacritical mark ' %c'\\n&quot;, r)\n        }\n</code></pre>\n<p>(note the space around the <code>%c</code> combining rune: <code>'%c'</code> without space would means combining the mark with the first <code>'\u0364'</code>: instead of ' \u0364 '. I tried to use the <a href=\"https://en.wikipedia.org/wiki/Combining_Grapheme_Joiner\" rel=\"nofollow noreferrer\">CGJ Combining Grapheme Joiner</a> <code>\\u034F</code>, but that does not work)</p>\n<p>If you encounter finally a regular rune, you need to combine with those CDMs, before adding it to your reverse final rune array.</p>\n<pre><code>        } else {\n            rrv := make([]rune, 0, len(cv)+1)\n            rrv = append(rrv, r)\n            rrv = append(rrv, cv...)\n            fmt.Printf(&quot;regular mark '%c' (with '%d' combining diacritical marks '%s') =&gt; '%s'\\n&quot;, r, len(cv), string(cv), string(rrv))\n            rv = append(rv, rrv...)\n            cv = make([]rune, 0)\n        }\n</code></pre>\n<hr />\n<p>Where it gets even more complex is with emojis, and, for instance more recently, modifiers like the <a href=\"https://emojipedia.org/medium-dark-skin-tone/\" rel=\"nofollow noreferrer\">Medium-Dark Skin Tone</a>, the type 5 on the <a href=\"https://en.wikipedia.org/wiki/Fitzpatrick_scale\" rel=\"nofollow noreferrer\">Fitzpatrick Scale</a> of skin tones.<br />\nIf ignored, Reverse '\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb0\ud83d\udc71\ud83c\udffe\ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f' will give '\ufe0f\u2696\u200d\ud83c\udffe\ud83e\uddd1\ud83c\udffe\ud83d\udc71\ud83e\uddb0\u200d\ud83c\udffe\ud83d\udc69', loosing the skin tone on the last two emojis.</p>\n<p>And don't get me started on the <a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/200d\" rel=\"nofollow noreferrer\">ZERO WIDTH JOINER</a> (<code>200D</code>), which, from <a href=\"https://github.com/Wisdom/Awesome-Unicode\" rel=\"nofollow noreferrer\"><code>Wisdom/Awesome-Unicode</code></a>, forces adjacent characters to be joined together (e.g., Arabic characters or supported emoji). It Can be used this to compose sequentially combined emoji.</p>\n<p>Here are two examples of composed emojis, whose inner elements order should remain in the same order when &quot;reversed&quot;:</p>\n<p>\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb0 alone is (from <a href=\"https://onlineunicodetools.com/convert-unicode-to-code-points\" rel=\"nofollow noreferrer\">Unicode to code points converter</a>):</p>\n<ul>\n<li>\ud83d\udc69: <a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/1F469\" rel=\"nofollow noreferrer\">women (1f469)</a></li>\n<li><a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/1f3fe\" rel=\"nofollow noreferrer\">dark skin (1f3fe)</a></li>\n<li><a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/200d\" rel=\"nofollow noreferrer\">ZERO WIDTH JOINER (200d)</a></li>\n<li>\ud83e\uddb0<a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/1f9b0\" rel=\"nofollow noreferrer\">red hair (1f9b0)</a></li>\n</ul>\n<p>Those should remain in the exact same order.</p>\n<p>The &quot;<a href=\"https://www.quora.com/What%E2%80%99s-the-difference-between-a-symbol-a-glyph-and-a-character\" rel=\"nofollow noreferrer\">character</a>&quot; &quot;judge&quot; (meaning an abstract idea of the semantic value for &quot;judge&quot;) can be represented with several glyphs or one glyph.</p>\n<p>\ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f is actually <em>one</em> composed glyph (composed here of two emojis), representing a judge. That sequence should <em>not</em> be inverted.<br />\nThe program below correctly detect the &quot;zero width joiner&quot; and do <em>not</em> invert the emojis it combines.<br />\nIt you <a href=\"https://apps.timwhitlock.info/unicode/inspect?s=%F0%9F%A7%91%F0%9F%8F%BE%E2%80%8D%E2%9A%96%EF%B8%8F\" rel=\"nofollow noreferrer\">inspect that emoji</a>, you will find it composed of:</p>\n<ul>\n<li>\ud83e\uddd1: <a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/1F9D1\" rel=\"nofollow noreferrer\">Adult (1F9D1)</a></li>\n<li>\ud83c\udffe: <a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/1f3fe\" rel=\"nofollow noreferrer\">dark skin (1f3fe)</a></li>\n<li><a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/200d\" rel=\"nofollow noreferrer\">ZERO WIDTH JOINER (200d)</a> discussed above</li>\n<li>\u2696: <a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/2696\" rel=\"nofollow noreferrer\">scale (2696)</a></li>\n<li><a href=\"https://apps.timwhitlock.info/unicode/inspect/hex/FE0F\" rel=\"nofollow noreferrer\">VARIATION SELECTOR (FE0F)</a>, part of the <a href=\"https://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">unicode combining characters</a> (characters that are intended to modify other characters), here requesting that character 'scale' to be displayed <a href=\"https://en.wikipedia.org/wiki/Emoji#Emoji_versus_text_presentation\" rel=\"nofollow noreferrer\">emoji-style (with color) \u2696\ufe0f, using VS16 (U+FE0F), instead of text style (monochrome) '\u2696', using VS15 (U+FE0E)</a>.</li>\n</ul>\n<p>Again, that sequence order needs to be preserved.</p>\n<p>Note: the <a href=\"https://apps.timwhitlock.info/unicode/inspect?s=%F0%9F%91%A8%F0%9F%8F%BE%E2%80%8D%E2%9A%96%EF%B8%8F\" rel=\"nofollow noreferrer\">actual judge emoji \ud83d\udc68\ud83c\udffe\u200d\u2696\ufe0f</a> uses a <a href=\"https://apps.timwhitlock.info/unicode/inspect?s=%F0%9F%91%A8\" rel=\"nofollow noreferrer\">MAN \ud83e\uddd1 (1F468)</a>, instead of an <a href=\"https://apps.timwhitlock.info/unicode/inspect?s=%F0%9F%A7%91\" rel=\"nofollow noreferrer\">Adult \ud83e\uddd1 (1F9D1)</a> (plus the other characters listed above: dark skin, ZWJ, scale), and is therefore represented as <a href=\"https://en.wikipedia.org/wiki/Glyph\" rel=\"nofollow noreferrer\">one glyph</a>, instead of a <a href=\"https://en.wikipedia.org/wiki/Grapheme\" rel=\"nofollow noreferrer\">cluster of graphemes</a>.</p>\n<p>Meaning: the single glyph, official emoji for &quot;judge&quot;, needs to combine &quot;man&quot; with &quot;scale&quot; (resulting in one glyph \ud83d\udc68\ud83c\udffe\u200d\u2696\ufe0f) instead of &quot;adult&quot; + &quot;scale&quot;.<br />\nThe latter, &quot;adult&quot; + &quot;scale&quot;, is still considered as &quot;one character&quot;: you cannot select just the scale, because of the ZWJ (Zero Width Joiner).<br />\nBut that &quot;character&quot; is represented as a composed glyph \ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f, two glyphs, each one a concrete written representations a corresponding <a href=\"https://en.wikipedia.org/wiki/Grapheme\" rel=\"nofollow noreferrer\">grapheme</a> through codepoint+font)</p>\n<p>Obviously, using the first combination (&quot;man&quot;+&quot;scale&quot;) results in a more expressive character \ud83d\udc68\ud83c\udffe\u200d\u2696\ufe0f.</p>\n<p>See &quot;<a href=\"https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&amp;id=IWS-Chapter02#2333f153\" rel=\"nofollow noreferrer\">The relationship between graphemes and abstract characters for textual representation</a>&quot;</p>\n<blockquote>\n<p>Graphemes and orthographic characters are fairly concrete objects, in the sense that they are familiar to common users\u2014non-experts, who are typically taught to work in terms of them from the time they first learn their \u201cABCs\u201d (or equivalent from their writing system, of course).</p>\n<p>In the domain of information systems, however, we have a different sense of character: <strong>abstract characters which are minimal units of textual representation within a given system</strong>.<br />\nThese are, indeed, abstract in two important senses:</p>\n<ul>\n<li>first, some of these abstract characters may not correspond to anything concrete in an orthography, as we saw above in the case of HORIZONTAL TAB.</li>\n<li>Secondly, the concrete objects of writing (graphemes and orthographic characters) can be represented by abstract characters in more than one way, and not necessarily in a one-to-one manner, as we saw above in the case of \u201c\u00f4\u201d being represented by a sequence &lt;O, CIRCUMFLEX&gt;.</li>\n</ul>\n</blockquote>\n<p>Then: &quot;<a href=\"https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&amp;id=IWS-Chapter02#170d403a\" rel=\"nofollow noreferrer\">From grapheme to codepoint to glyph</a>&quot;:</p>\n<p><a href=\"https://i.stack.imgur.com/68Ym6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/68Ym6.png\" alt=\"https://scripts.sil.org/cms/scripts/render_graphic.php?&amp;type=media_graphic&amp;filename=../sites/nrsi/media/IWS-CharacterIntervene.png&amp;image_type=png&amp;width=648&amp;height=421\" /></a></p>\n<blockquote>\n<ul>\n<li>Graphemes are the units in terms of which users are usually accustomed to thinking.</li>\n<li>Within the computer, however, processes are done in terms of characters.</li>\n</ul>\n<p>We don\u2019t make any direct connection between graphemes and glyphs.<br />\nAs we have defined these two notions here, there is no direct connection between them. They can only be related indirectly through the abstract characters.<br />\nThis is a key point to grasp: the abstract characters are the element in common through which the others relate.</p>\n</blockquote>\n<hr />\n<p>Full example in <a href=\"https://play.golang.org/p/Wy4SZ_6U3vy\" rel=\"nofollow noreferrer\">Go playground</a>.</p>\n<pre><code>Reverse 'Hello, World' =&gt; 'dlroW ,olleH'\nReverse '\ud83d\udc7d\ud83d\udc76\u20e0\ud83c\udf83' =&gt; '\ud83c\udf83\ud83d\udc76\u20e0\ud83d\udc7d'\nReverse '\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb0\ud83d\udc71\ud83c\udffe\ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f' =&gt; '\ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f\ud83d\udc71\ud83c\udffe\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb0'\nReverse 'a\u0364o\u0367i\u0364  \u0161\u0301\u017e\u0301\u029f\u0301' =&gt; '\u029f\u0301\u017e\u0301\u0161\u0301  i\u0364o\u0367a\u0364'\nReverse 'H\u0319\u0316ell\u0354o\u0319\u031f\u035a\u034e\u0317\u0339\u032c \u032fW\u035d\u0316o\u0328\u032c\u031e\u031crl\u0323\u0326\u0323\u032ad\u0330\u0332\u0317\u0348' =&gt; 'd\u0330\u0332\u0317\u0348l\u0323\u0326\u0323\u032aro\u0328\u032c\u031e\u031cW\u035d\u0316 \u032fo\u0319\u031f\u035a\u034e\u0317\u0339\u032cl\u0354leH\u0319\u0316'\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 9922398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7234a673bc4e8192ee7a5f58fe0e8ee5?s=128&d=identicon&r=PG&f=1", "display_name": "Valney Faria", "link": "https://stackoverflow.com/users/9922398/valney-faria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1746, "favorite_count": 2, "accepted_answer_id": 53244842, "answer_count": 2, "score": 3, "last_activity_date": 1612098593, "creation_date": 1541896896, "last_edit_date": 1551321269, "question_id": 53244824, "link": "https://stackoverflow.com/questions/53244824/how-to-manipulate-strings-in-go-to-reverse-them", "title": "How to manipulate strings in GO to reverse them?", "body": "<p>I'm trying to invert a string in go but I'm having trouble handling the characters. Unlike C, GO treats strings as vectors of bytes, rather than characters, which are called runes here. I tried to do some type conversions to do the assignments, but so far I could not.</p>\n\n<p>The idea here is to generate 5 strings with random characters of sizes 100, 200, 300, 400 and 500 and then invert their characters. I was able to make C work with ease, but in GO, the language returns an error saying that it is not possible to perform the assignment.</p>\n\n<pre><code> func inverte() {\n    var c = \"A\"\n    var strs, aux string\n\n    rand.Seed(time.Now().UnixNano())\n    // Gera 5 vetores de 100, 200, 300, 400, e 500 caracteres\n    for i := 1; i &lt; 6; i++ {\n        strs = randomString(i * 100)\n        fmt.Print(strs)\n\n        for i2, j := 0, len(strs); i2 &lt; j; i2, j = i+1, j-1 {\n           aux = strs[i2]\n           strs[i2] = strs[j]\n           strs[j] = aux\n       }\n   }\n}\n</code></pre>\n"}, {"tags": ["go", "webhooks", "github-api", "hmacsha1"], "answers": [{"tags": [], "owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "is_accepted": true, "score": 5, "last_activity_date": 1541880726, "creation_date": 1541880726, "answer_id": 53243003, "question_id": 53242837, "link": "https://stackoverflow.com/questions/53242837/validating-github-webhook-hmac-signature-in-go/53243003#53243003", "title": "Validating GitHub Webhook HMAC signature in Go", "body": "<p>This is really embarrasing but still I would like to share how I was able to fix it.</p>\n\n<p><em>I sent in the wrong <code>key</code> as the input which was causing all the confusion.</em></p>\n\n<p>Lessons learnt:</p>\n\n<ol>\n<li>The above code snippet is absolutely <strong>correct</strong> and can be used as a validator.</li>\n<li>Every one makes stupid mistakes but only the wise own up to them and rectify.</li>\n</ol>\n"}], "owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 934, "favorite_count": 1, "accepted_answer_id": 53243003, "answer_count": 1, "score": 2, "last_activity_date": 1541880726, "creation_date": 1541879607, "question_id": 53242837, "link": "https://stackoverflow.com/questions/53242837/validating-github-webhook-hmac-signature-in-go", "title": "Validating GitHub Webhook HMAC signature in Go", "body": "<p>I've written the following function for validating the <code>X-Hub-Signature</code> request header returned by the GitHub API as part of the webhook's payload.</p>\n\n<pre><code>func isValidSignature(r *http.Request, key string) bool {\n    // Assuming a non-empty header\n    gotHash := strings.SplitN(r.Header.Get(\"X-Hub-Signature\"), \"=\", 2)\n    if gotHash[0] != \"sha1\" {\n        return false\n    }\n    defer r.Body.Close()\n\n    b, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Printf(\"Cannot read the request body: %s\\n\", err)\n        return false\n    }\n\n    hash := hmac.New(sha1.New, []byte(key))\n    if _, err := hash.Write(b); err != nil {\n        log.Printf(\"Cannot compute the HMAC for request: %s\\n\", err)\n        return false\n    }\n\n    expectedHash := hex.EncodeToString(hash.Sum(nil))\n    log.Println(\"EXPECTED HASH:\", expectedHash)\n    return gotHash[1] == expectedHash\n}\n</code></pre>\n\n<p>However, this doesn't seem to work as I'm not able to validate with the correct <code>secret</code>. Here is an example output, if that helps:</p>\n\n<pre><code>HUB SIGNATURE: sha1=026b77d2284bb95aa647736c42f32ea821d6894d\nEXPECTED HASH: 86b6fa48bf7643494dc3a8459a8af70008f6881a\n</code></pre>\n\n<p>I've used the logic from <a href=\"https://github.com/danharper/hmac-examples#go\" rel=\"nofollow noreferrer\">hmac-examples</a> repo as a guideline and implemented the code. However, I am unable to understand the reason behind this discrepancy. </p>\n\n<p>I would be grateful if someone can point out the trivial mistake I'm making here.</p>\n\n<p>Refer: <a href=\"https://developer.github.com/webhooks/#delivery-headers\" rel=\"nofollow noreferrer\">Delivery Headers</a></p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1541867316, "post_id": 53240259, "comment_id": 93367632, "body": "Data can be in the query string (GET, DELETE), the body (POST, PATCH), sometimes even headers...  what HTTP method and which part of the request are you wanting to use here?"}, {"owner": {"reputation": 53, "user_id": 7999371, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CKv092Z2UtI/AAAAAAAAAAI/AAAAAAAAAGY/I5_JEiDHwUE/photo.jpg?sz=128", "display_name": "ATkisai", "link": "https://stackoverflow.com/users/7999371/atkisai"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1541868068, "post_id": 53240259, "comment_id": 93367841, "body": "axios.post(&#39;<a href=\"http://localhost:8000/app/reg/\" rel=\"nofollow noreferrer\">localhost:8000/app/reg</a>&#39;, {user:this.user})           .then((response) =&gt; {             console.log(response);}"}], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1541864807, "last_edit_date": 1592644375, "creation_date": 1541864807, "answer_id": 53240590, "question_id": 53240259, "link": "https://stackoverflow.com/questions/53240259/how-get-data-from-frontend-in-gin/53240590#53240590", "title": "How get DATA from frontend in gin?", "body": "<p>you need to call <code>c.Request.ParseForm()</code> before using it from <code>request.Form</code></p>\n<p>says <a href=\"https://golang.org/pkg/net/http/#Request.ParseForm\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<p>For all requests, ParseForm parses the raw query from the URL and updates r.Form</p>\n<p>For other HTTP methods, or when the Content-Type is not application/x-www-form-urlencoded, the request Body is not read, and r.PostForm is initialized to a non-nil, empty value.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1591959444, "last_edit_date": 1591959444, "creation_date": 1541875174, "answer_id": 53242213, "question_id": 53240259, "link": "https://stackoverflow.com/questions/53240259/how-get-data-from-frontend-in-gin/53242213#53242213", "title": "How get DATA from frontend in gin?", "body": "<p>Well, I'd say you should fetch some book/HOWTO on how HTTP work and spend some time with it because it appears you're trying to bash the problem at hand without actually understanding what happens between your browser and your backend service.</p>\n\n<p>The real problem here is that there are more moving parts that you appear to be aware of, and the way to go depends on what your frontent does.</p>\n\n<p>You did not tell us exactly <em>how</em> you're doing your request,\nbut from a solicted comment it appears, you're using that \"axios\" tingy.\nIf I managed to google that project correctly,\nits README <a href=\"https://github.com/axios/axios#using-applicationx-www-form-urlencoded-format\" rel=\"nofollow noreferrer\">states</a>:</p>\n\n<blockquote>\n  <p>By default, axios serializes JavaScript objects to JSON. To send data in the <code>application/x-www-form-urlencoded</code> format instead, you can use one of the following options.</p>\n</blockquote>\n\n<p>This means two things:</p>\n\n<ol>\n<li>Unless you somehow tweaked the axios' settings, when you did\n<code>axios.post</code>, is supposedly performed an HTTP POST request\nwith its <code>Content-Type</code> field set to <code>application/json</code>\nand its payload (or \"body\" if you prefer) being\na JSON serialization of that <code>{user:this.user}</code> JavaScript object.</li>\n<li>It's therefore futile to attempt to parse the query string.\nAnd it's futile to attempt to parse the request as an HTTP form \u2014 which it isn't.</li>\n</ol>\n\n<p>Instead, you supposedly want to interpret the incoming request's body as being JSON-formatted. I have no idea as to how to do that in \"go-gin\", but in plain Go that would be something like</p>\n\n<pre><code>func (h *Handler) ServeHTTP(rw http.ResponseWriter, req *http.Request) {\n  defer req.Body.Close()\n\n  var user User\n\n  dec := json.NewDecoder(req.Body)\n  err := dec.Decode(&amp;user)\n  if err != nil {\n    rw.Header().Set(\"Content-Type\", \"text/plain; charset=UTF-8\")\n    rw.WriteHeader(http.StatusBadRequest)\n    fmt.Fprintln(rw, \"Error parsing request body: \", err)\n    return\n  }\n}\n</code></pre>\n\n<p>And ideally you'd first check that the content type of the incoming request was indeed <code>application/json</code> and reject it right away with <code>http.StatusBadRequest</code> if it isn't.</p>\n\n<p>An example of a working code to do that is</p>\n\n<pre><code>// VerifyContentTypeIsJSON makes sure the HTTP header of a server\n// http.Request contains the Content-Type field and it indicates\n// the request payload is JSON.\n// The implementation is based on RFC 7231 (section 3.1.1.5) and RFC 8259.\nfunc VerifyContentTypeIsJSON(header http.Header) error {\n    var s string\n\n    if values := header[\"Content-Type\"]; len(values) &gt; 0 {\n        s = values[0]\n    } else {\n        return errors.New(\"missing Content-Type\")\n    }\n\n    if s == \"\" {\n        return errors.New(\"empty Content-Type\")\n    }\n\n    if i := strings.IndexByte(s, ';'); i != -1 {\n        s = strings.TrimSpace(s[:i])\n    }\n\n    if strings.ToLower(s) != \"application/json\" {\n        return fmt.Errorf(\"unknown Content-Type: %v, must be application/json\", s)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Having this function, you'd have something like this\nafter <code>defer req.Body.Close()</code> and actually parsing it:</p>\n\n<pre><code>if err := VerifyContentTypeIsJSON(req.Header); err != nil {\n  rw.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n  rw.WriteHeader(http.StatusBadRequest)\n  fmt.Fprintln(rw, err)\n  return\n}\n</code></pre>\n\n<p>(Note that \"go-gin\" might have something akin to this already built-in, so please check this.)</p>\n\n<p>The <code>User</code> type should be some <code>struct</code> type matching the shape of the JSON object you intend to unmarshal from the request. Something like this:</p>\n\n<pre><code>type User struct {\n  User string `json:\"user\"`\n}\n</code></pre>\n\n<p>None that in the two places my example returned an\nerror to the user it used content type of plain text\n(in UTF-8 encoding). This may be OK but may be not.\nSay, your clients might expect a JSON-formatted document\nof some agreed-upon shape.</p>\n\n<p>Or you may use <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation\" rel=\"nofollow noreferrer\">content negotiation</a>, but I'd recommend to get simple things straight first.</p>\n\n<hr>\n\n<p>Literature to check:</p>\n\n<ul>\n<li><code>HTTP POST</code> request <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST\" rel=\"nofollow noreferrer\">explained at MDN</a>.</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Query_string\" rel=\"nofollow noreferrer\">URL's query string</a>.</li>\n<li>XHR <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#See_also\" rel=\"nofollow noreferrer\">explained at MDN</a> \u2014 see also links there.</li>\n<li><a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">\"Writing Web Applications in Go\"</a>,\nand <a href=\"https://www.google.com/search?q=web+app+golang\" rel=\"nofollow noreferrer\">this</a> in general.</li>\n</ul>\n\n<hr>\n\n<p>And to maybe answer that part of your question regarding\nwhy it \"just worked\" in Django.\nI can only guess, but I think it merely implements tons of magic which looks at the incoming request and tries to <em>guess</em> how to extract data from it.</p>\n\n<p>The problem is that guessing may indeed work well for\none-off throwaway scripts, but when you're about implementing something like web API (what many not quite correctly call \"REST\", but let's not digress) it's best\nto be very explicit about what your endpoint accept\n<em>precisely</em> and how <em>precisely</em> they react to requests \u2014 both legitimate and non-well-formed.</p>\n\n<p>Regarding magic in Go, you may read <a href=\"https://stephensearles.com/three-reasons-you-should-not-use-martini/\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1541940986, "last_edit_date": 1541940986, "creation_date": 1541940358, "answer_id": 53248878, "question_id": 53240259, "link": "https://stackoverflow.com/questions/53240259/how-get-data-from-frontend-in-gin/53248878#53248878", "title": "How get DATA from frontend in gin?", "body": "<p>If you're expecting a JSON body in the request, you can do it this way with gin.  Create a struct for the data you want to grab out of the body.  Use <code>json</code> tags for the JSON key names unless you're going to exactly match your Go field names to them.  Then call the <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.BindJSON\" rel=\"nofollow noreferrer\"><code>BindJSON</code></a> method on the gin context.</p>\n\n<p>For example:</p>\n\n<pre><code>type User struct {\n    FirstName string `json:\"first_name\"`\n    LastName  string `json:\"last_name\"`\n    Login     string `json:\"login\"`\n}\n\nfunc (h *Handler) HandleUser(gctx *gin.Context) {\n    user := new(User)\n    err := gctx.BindJSON(user)\n    if err != nil {\n        text := fmt.Sprintf(\"Failed to read user data from request: %s\", err)\n        log.Error(text)\n        gctx.JSON(http.StatusBadRequest, gin.H{\"error\": text})\n        return\n    }\n    // do something with user\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 7999371, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CKv092Z2UtI/AAAAAAAAAAI/AAAAAAAAAGY/I5_JEiDHwUE/photo.jpg?sz=128", "display_name": "ATkisai", "link": "https://stackoverflow.com/users/7999371/atkisai"}, "is_accepted": true, "score": 0, "last_activity_date": 1542313881, "creation_date": 1542313881, "answer_id": 53327475, "question_id": 53240259, "link": "https://stackoverflow.com/questions/53240259/how-get-data-from-frontend-in-gin/53327475#53327475", "title": "How get DATA from frontend in gin?", "body": "<p>Server GIN can't handle routine default application/json requests from axios!!! What???\nRequests should be sent as application/x-www-form-urlencoded.\nMy decision in Vue project: \nUse vue-resource instead axios (axios.post=>this.$http.post) with option\nVue.http.options.emulateJSON = true; in main.js</p>\n"}], "owner": {"reputation": 53, "user_id": 7999371, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CKv092Z2UtI/AAAAAAAAAAI/AAAAAAAAAGY/I5_JEiDHwUE/photo.jpg?sz=128", "display_name": "ATkisai", "link": "https://stackoverflow.com/users/7999371/atkisai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1056, "favorite_count": 0, "accepted_answer_id": 53327475, "answer_count": 4, "score": 0, "last_activity_date": 1591959444, "creation_date": 1541862534, "last_edit_date": 1541865547, "question_id": 53240259, "link": "https://stackoverflow.com/questions/53240259/how-get-data-from-frontend-in-gin", "title": "How get DATA from frontend in gin?", "body": "<p>To my shame, I have not been able to figure out how to get data from the frontend in Gin framework. In Django I get data So:</p>\n\n<pre><code>user=request.data.get('user')\nprint(user)\n</code></pre>\n\n<p>Everything is simple and understandable as day.\nHow should I do it in gin?</p>\n\n<pre><code>user := c.Query(\"user\")\nuser := c.Param(\"user\")\nuser := c.Params.ByName(\"user\")\nuser := c.PostForm(\"user\")\nprintln(user)//emptiness....\n</code></pre>\n"}, {"tags": ["go", "testing", "test-double"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541859373, "post_id": 53239718, "comment_id": 93365445, "body": "All <code>World</code> values are equal to one another. And why wouldn&#39;t they be? There&#39;s nothing in them to distinguish them. I&#39;m not familiar with the cmp package, but native equality is <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">defined in the spec</a>."}], "answers": [{"comments": [{"owner": {"reputation": 893, "user_id": 8086746, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/66af61e414e557bf54bf1c46f826f775?s=128&d=identicon&r=PG&f=1", "display_name": "amb85", "link": "https://stackoverflow.com/users/8086746/amb85"}, "edited": false, "score": 0, "creation_date": 1541861791, "post_id": 53240014, "comment_id": 93366110, "body": "Ah, okay, so to check my understanding, if I define a struct and don&#39;t assign any value to its members, they will be assigned a default value, hence the equality comparison passing? By checking whether the memory address is nil, we guard against the case when nothing has been assigned before checking whether the two are actually equal?"}], "tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 1, "last_activity_date": 1541860760, "creation_date": 1541860760, "answer_id": 53240014, "question_id": 53239718, "link": "https://stackoverflow.com/questions/53239718/golang-test-spy-incorrectly-comparing-equality/53240014#53240014", "title": "golang test spy incorrectly comparing equality", "body": "<p>When called <code>outputsWorldSpy := OutputsWorldSpy{}</code> golang assigned default value in <code>outputsWorldSpy.outputCalledWithWorld = World{}</code> and you assigned <code>seedWorld := World{}</code>. So they are same that's why test passed. If you want to handle that case, i suggest to use pointer.</p>\n\n<pre><code>type OutputsWorldSpy struct {\n    outputCalledWithWorld *World\n}\n\nfunc (ow *OutputsWorldSpy) output(world World) {\n    ow.outputCalledWithWorld = &amp;world\n}\n\nfunc (ow *OutputsWorldSpy) wasOutputCalledWithWorld(world World) bool {\n    if ow.outputCalledWithWorld == nil {\n        return false\n    }\n    return cmp.Equal(world, *ow.outputCalledWithWorld)\n}\n</code></pre>\n"}], "owner": {"reputation": 893, "user_id": 8086746, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/66af61e414e557bf54bf1c46f826f775?s=128&d=identicon&r=PG&f=1", "display_name": "amb85", "link": "https://stackoverflow.com/users/8086746/amb85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 1, "accepted_answer_id": 53240014, "answer_count": 1, "score": 0, "last_activity_date": 1541860760, "creation_date": 1541858489, "question_id": 53239718, "link": "https://stackoverflow.com/questions/53239718/golang-test-spy-incorrectly-comparing-equality", "title": "golang test spy incorrectly comparing equality", "body": "<p>I'm in the process of learning go and am adapting a Java Game of Life example from <a href=\"http://blog.testdouble.com/posts/2015-09-10-how-i-use-test-doubles.html\" rel=\"nofollow noreferrer\">testdouble</a>. However, the test spy I have written incorrectly compares equality of my <code>World</code> struct - the test passes when it should fail, since <code>output(world)</code> is not being called. What am I doing incorrectly?</p>\n\n<p>Test:</p>\n\n<pre><code>package gameoflife\n\nimport (\n    \"testing\"\n\n    \"github.com/google/go-cmp/cmp\"\n)\n\nfunc TestZeroGenerations(t *testing.T) {\n    generatesSeedWorldStub := GeneratesSeedWorldStub{}\n    outputsWorldSpy := OutputsWorldSpy{}\n    conway := NewSimulatesConway(&amp;generatesSeedWorldStub, &amp;outputsWorldSpy)\n    seedWorld := World{}\n\n    conway.simulate()\n\n    correctWorld := outputsWorldSpy.wasOutputCalledWithWorld(seedWorld)\n    if !correctWorld {\n        t.Errorf(\"Output called with seed world, expected: %t, got: %t\", true, correctWorld)\n    }\n}\n\ntype GeneratesSeedWorldStub struct{}\n\nfunc (gsw *GeneratesSeedWorldStub) generate() World {\n    return World{}\n}\n\ntype OutputsWorldSpy struct {\n    outputCalledWithWorld World\n}\n\nfunc (ow *OutputsWorldSpy) output(world World) {\n    ow.outputCalledWithWorld = world\n}\n\nfunc (ow *OutputsWorldSpy) wasOutputCalledWithWorld(world World) bool {\n    return cmp.Equal(world, ow.outputCalledWithWorld)\n}\n</code></pre>\n\n<p>Implementation:</p>\n\n<pre><code>package gameoflife\n\ntype SimulatesConway struct {\n    generatesSeedWorld GeneratesSeedWorld\n    outputsWorld       OutputsWorld\n}\n\nfunc NewSimulatesConway(generatesSeedWorld GeneratesSeedWorld, outputsWorld OutputsWorld) SimulatesConway {\n    return SimulatesConway{generatesSeedWorld: generatesSeedWorld, outputsWorld: outputsWorld}\n}\n\nfunc (sc *SimulatesConway) simulate() {\n    // seedWorld := sc.generatesSeedWorld.generate()\n    // sc.outputsWorld.output(seedWorld)\n}\n\ntype GeneratesSeedWorld interface {\n    generate() World\n}\n\ntype OutputsWorld interface {\n    output(world World)\n}\n\ntype World struct{}\n</code></pre>\n"}, {"tags": ["python", "go", "ctypes"], "comments": [{"owner": {"reputation": 5380, "user_id": 10618540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Od4aq.jpg?s=128&g=1", "display_name": "Paritosh Singh", "link": "https://stackoverflow.com/users/10618540/paritosh-singh"}, "edited": false, "score": 0, "creation_date": 1541850695, "post_id": 53238602, "comment_id": 93363249, "body": "As a suggestion, have you looked at numpy? (i will openly admit i have no idea what is happening in this code here. However, calculations on &quot;array of integers&quot; sounds like numpy department. It has helped me a lot with speeding up calculations)"}, {"owner": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "reply_to_user": {"reputation": 5380, "user_id": 10618540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Od4aq.jpg?s=128&g=1", "display_name": "Paritosh Singh", "link": "https://stackoverflow.com/users/10618540/paritosh-singh"}, "edited": false, "score": 0, "creation_date": 1541852478, "post_id": 53238602, "comment_id": 93363702, "body": "Yeah, i have,but I would like to use go because of some other code I have already, and I would like to integrate license check in go as <code>.so</code> file, because it&#39;s at least little harder to reverse engeneer than plain python file or pyc. So main idea here is to use license check with critical part of code in go, and compile it together."}], "answers": [{"comments": [{"owner": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "edited": false, "score": 0, "creation_date": 1541874750, "post_id": 53239156, "comment_id": 93369833, "body": "This is the right answer. I didn&#39;t think of headers, but now I know what to look for other types as well. Thanks a lot!"}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 2, "last_activity_date": 1541856496, "last_edit_date": 1541856496, "creation_date": 1541854480, "answer_id": 53239156, "question_id": 53238602, "link": "https://stackoverflow.com/questions/53238602/accessing-c-array-in-golang/53239156#53239156", "title": "Accessing C array in golang", "body": "<p>An array in C cannot be automatically casted to a slice in Go. Note that in Go, a slice has two parts: a length, and a pointer to the backing data.</p>\n\n<p>So you would have to manually create the slice from the pointer.</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"reflect\"\n    \"unsafe\"\n)\n\n//export Example\nfunc Example(carr *C.int, size int, idx int) C.int {\n\n    // Build the slice manually using unsafe\n    var slice []C.int\n    header := (*reflect.SliceHeader)(unsafe.Pointer(&amp;slice))\n    header.Cap = size\n    header.Len = size\n    header.Data = uintptr(unsafe.Pointer(carr))\n\n    return slice[idx]\n}\n\nfunc main() {}\n</code></pre>\n\n<p>Then you would call the Go exported function in your python code like:</p>\n\n<pre><code>from ctypes import *\n\n# Load compiled go module\nlib = cdll.LoadLibrary(\"./gomodule.so\")\n# We are passing an array of 256 elements and recieving integer\nlib.Example.argtypes = [c_int * 256]\nlib.Example.restype = c_int\npyarr = [x for x in range(256)]\n# Make C array from py array\narr = (c_int * len(pyarr))(*pyarr)\nprint lib.Example(arr, len(arr), 4)\n</code></pre>\n\n<p>The example above should print the 4th index element of the array</p>\n"}, {"comments": [{"owner": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "edited": false, "score": 0, "creation_date": 1541887517, "post_id": 53242629, "comment_id": 93373148, "body": "Nice, I tried this and the result is the same as the first answer, but file size of the shared object is smaller which is great. I must accept this as an &quot;accepted&quot; answer because of efficient conversion. Many thanks to both of you."}, {"owner": {"reputation": 2537, "user_id": 1720829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e2DBe.png?s=128&g=1", "display_name": "Nathan F.", "link": "https://stackoverflow.com/users/1720829/nathan-f"}, "edited": false, "score": 0, "creation_date": 1565126866, "post_id": 53242629, "comment_id": 101252512, "body": "What is the point of the <code>[1 &lt;&lt; 30]</code> bitwise? Could you add some information explaining what exactly is going on here?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 2537, "user_id": 1720829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e2DBe.png?s=128&g=1", "display_name": "Nathan F.", "link": "https://stackoverflow.com/users/1720829/nathan-f"}, "edited": false, "score": 0, "creation_date": 1577969436, "post_id": 53242629, "comment_id": 105294949, "body": "@NathanF.: the Go array must have a declared size. This sets the maximum allowed size and capacity of the slice. Go will construct the actual slice header from the parameters, and use the base of the array as the underlying array. So if the array actually has 256 <code>C.int</code>s in it, the slice will have that as its length and capacity and Go won&#39;t access outside the actual array."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1618595398, "last_edit_date": 1618595398, "creation_date": 1541878022, "answer_id": 53242629, "question_id": 53238602, "link": "https://stackoverflow.com/questions/53238602/accessing-c-array-in-golang/53242629#53242629", "title": "Accessing C array in golang", "body": "<p>This is the idiomatic, efficient Go solution (avoid reflection).</p>\n<p><code>module.go</code>:</p>\n<pre><code>package main\n\nimport &quot;C&quot;\n\nimport &quot;unsafe&quot;\n\n//export Example\nfunc Example(cArray *C.int, cSize C.int, i C.int) C.int {\n    gSlice := (*[1 &lt;&lt; 30]C.int)(unsafe.Pointer(cArray))[:cSize:cSize]\n    return gSlice[i]\n}\n\nfunc main() {}\n</code></pre>\n<p><code>test.py</code>:</p>\n<pre><code>from ctypes import *\n\n# Load compiled go module\nlib = cdll.LoadLibrary(&quot;./gomodule.so&quot;)\n# We are passing an array of 256 elements and receiving an integer\nlib.Example.argtypes = [c_int * 256]\nlib.Example.restype = c_int\npyarr = [x for x in range(256)]\n# Make C array from py array\narr = (c_int * len(pyarr))(*pyarr)\nprint(lib.Example(arr, len(arr), 4))\n</code></pre>\n<p>Output:</p>\n<pre><code>$ go build -buildmode=c-shared -o gomodule.so module.go\n$ python test.py\n4\n$ \n</code></pre>\n"}], "owner": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1235, "favorite_count": 1, "accepted_answer_id": 53242629, "answer_count": 2, "score": 2, "last_activity_date": 1618595398, "creation_date": 1541850293, "question_id": 53238602, "link": "https://stackoverflow.com/questions/53238602/accessing-c-array-in-golang", "title": "Accessing C array in golang", "body": "<p>I have two files, <code>module.go</code> and <code>test.py</code>. My goal is to speed up some calculations that is done in python, but have an issue accessing array of integers in go.</p>\n\n<p><code>module.go</code></p>\n\n<pre><code>package main\n\nimport \"C\"\n\n//export Example\nfunc Example(testArray []C.int) C.int {\n    return testArray[2]\n}\n\nfunc main() {}\n</code></pre>\n\n<p>and simple test file in python:</p>\n\n<pre><code>from ctypes import *\n\n# Load compiled go module\nlib = cdll.LoadLibrary(\"./gomodule.so\")\n# We are passing an array of 256 elements and recieving integer\nlib.Example.argtypes = [c_int * 256]\nlib.Example.restype = c_int\npyarr = [x for x in range(256)]\n# Make C array from py array\narr = (c_int * len(pyarr))(*pyarr)\nprint lib.Example(arr)\n</code></pre>\n\n<p>After compiling go module with <code>go build -buildmode=c-shared -o gomodule.so module.go</code> and fire up python file I got:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x12 pc=0x7fb18b6e688c]\n\ngoroutine 17 [running, locked to thread]:\nmain.Example(...)\n        /home/metro/go/src/github.com/golubaca/carinago/module.go:7\nmain._cgoexpwrap_53c1c00d0ad3_Example(0xa, 0x7fff33a2eac0, 0x7fff33a2ea70, 0x722a921de6cae100)\n        _cgo_gotypes.go:47 +0x1c\nAborted (core dumped)\n</code></pre>\n\n<p>I get that C array is different from Go, but can't find any tutorial how to access it's values without panic.</p>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541848707, "post_id": 53238373, "comment_id": 93362767, "body": "testify <a href=\"https://github.com/stretchr/testify\" rel=\"nofollow noreferrer\">github.com/stretchr/testify</a> has a fixture system"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1541851092, "post_id": 53238373, "comment_id": 93363355, "body": "Your current approach is idiomatic. If the setup really is the same for all tests, consider <a href=\"https://github.com/golang/go/wiki/TableDrivenTests\" rel=\"nofollow noreferrer\">table driven test</a>."}, {"owner": {"reputation": 6900, "user_id": 259562, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/648b40ee271355e605029dd38cf60cef?s=128&d=identicon&r=PG", "display_name": "dierre", "link": "https://stackoverflow.com/users/259562/dierre"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541940323, "post_id": 53238373, "comment_id": 93382632, "body": "@Peter yes, it&#39;s the same for all test but table driven approach doesn&#39;t allow me to express what&#39;s the test is about. If I can keep single tests I&#39;ll have the test name that describes it. Especially in integration tests where more things happen under the hood, I prefer keeping the tests separated."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541940450, "post_id": 53238373, "comment_id": 93382660, "body": "Go has <a href=\"https://golang.org/pkg/testing/#hdr-Subtests_and_Sub_benchmarks\" rel=\"nofollow noreferrer\">subtests</a> for descriptive related names."}], "answers": [{"tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 1, "last_activity_date": 1541856437, "creation_date": 1541856437, "answer_id": 53239415, "question_id": 53238373, "link": "https://stackoverflow.com/questions/53238373/testing-lifecyle-in-go-is-it-possible-to-add-tear-up-and-down-method-without-du/53239415#53239415", "title": "Testing lifecyle in Go. Is it possible to add tear up and down method without duplication of code?", "body": "<p>Go does not have the inbuilt functionality to support tear up and down methods. However, there are multiple third-party packages that enable this. Out of all of these, I like the <a href=\"https://github.com/onsi/ginkgo\" rel=\"nofollow noreferrer\">ginkgo</a> package the most. It is very expressive and avoids code duplication. </p>\n\n<p>A sample test would look like</p>\n\n<pre><code>var _ = Describe(\"Book\", func() {\n    var (\n        longBook  Book\n        shortBook Book\n    )\n\n    BeforeEach(func() {\n        longBook = Book{\n            Title:  \"Les Miserables\",\n            Author: \"Victor Hugo\",\n            Pages:  1488,\n        }\n\n        shortBook = Book{\n            Title:  \"Fox In Socks\",\n            Author: \"Dr. Seuss\",\n            Pages:  24,\n        }\n    })\n\n    Describe(\"Categorizing book length\", func() {\n        Context(\"With more than 300 pages\", func() {\n            It(\"should be a novel\", func() {\n                Expect(longBook.CategoryByLength()).To(Equal(\"NOVEL\"))\n            })\n        })\n\n        Context(\"With fewer than 300 pages\", func() {\n            It(\"should be a short story\", func() {\n                Expect(shortBook.CategoryByLength()).To(Equal(\"SHORT STORY\"))\n            })\n        })\n    })\n})\n</code></pre>\n\n<p>Similarity there are other lifecycle methods like <code>afterEach</code>, <code>justBeforeEach</code> etc.</p>\n"}], "owner": {"reputation": 6900, "user_id": 259562, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/648b40ee271355e605029dd38cf60cef?s=128&d=identicon&r=PG", "display_name": "dierre", "link": "https://stackoverflow.com/users/259562/dierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 53239415, "answer_count": 1, "score": 0, "last_activity_date": 1541856437, "creation_date": 1541848419, "question_id": 53238373, "link": "https://stackoverflow.com/questions/53238373/testing-lifecyle-in-go-is-it-possible-to-add-tear-up-and-down-method-without-du", "title": "Testing lifecyle in Go. Is it possible to add tear up and down method without duplication of code?", "body": "<p>I started working with Go a month go. I come from java/kotlin background and I would like to understand if it's possible to achieve some of the same stuff that I did in those languages even in Go.</p>\n\n<p>My current problem is this one.</p>\n\n<p>I have a set of integration test cases where I need to initialize some stuff and then clean the resources: a common use case, I believe.</p>\n\n<p>Here's some pseudo code of what I want achieve, if possible:</p>\n\n<pre><code>for each test {\n  init resources\n  run test {\n     init test resources\n     execute method under test\n     assert\n  }\n  clean resources\n}\n</code></pre>\n\n<p>At the moment, what I could try, was this approach:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    setup()\n    code := m.Run() \n    shutdown()\n    os.Exit(code)\n}\n</code></pre>\n\n<p>Which is fine generally speaking if not that it runs at package level. That doesn't give me much control at the moment because I would like to run one of those per test files. (that's what I noticed at least, please let me know if I'm wrong about it)</p>\n\n<p>At the moment what I'm doing is basically run initialization for each test, but that's really a lot of duplicated code:</p>\n\n<pre><code>address, tearDownTestCase := testutils.SetupTestCase(emptyContext, postRouter(login.LoginUser), \"/login\")\ndefer tearDownTestCase()\n// init test use case data\n// run test\n// clean use case data\n</code></pre>\n\n<p>Do you think there is a better approach?</p>\n"}, {"tags": ["go", "ethereum", "json-rpc", "smartcontracts", "go-ethereum"], "answers": [{"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1541844495, "post_id": 53237863, "comment_id": 93361818, "body": "Thank you for your help. Unfortunately, I still get <code>json: cannot unmarshal string into Go value of type main.response</code> error."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1541844647, "post_id": 53237863, "comment_id": 93361857, "body": "try tweaking the response.  I didn&#39;t look at the library you are using it might strip off the jsonrpc or the id"}, {"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1541844813, "post_id": 53237863, "comment_id": 93361901, "body": "I tried. I commented the <code>Jsonrpc</code>. It failed. Next I uncommented <code>Jsonrpc</code> and commented <code>ID</code>. It still failed."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1541845164, "post_id": 53237863, "comment_id": 93362001, "body": "add at lline 277 of go-ethereum client.go to <code>printf(&quot;%v&quot;,resp.Result)</code> just before it trips the error.  See what it is returning"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1541844163, "creation_date": 1541844163, "answer_id": 53237863, "question_id": 53237759, "link": "https://stackoverflow.com/questions/53237759/how-to-correctly-send-rpc-call-using-golang-to-get-smart-contract-owner/53237863#53237863", "title": "How to correctly send RPC call using Golang to get smart-contract owner?", "body": "<p>Your response struct doesn't show the data that the json of the response has</p>\n\n<p>try this </p>\n\n<pre><code>type response struct {\n    Jsonrpc string `json:\"jsonrpc\"`\n    ID      int    `json:\"id\"`\n    Result  string `json:\"result\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": false, "score": 0, "last_activity_date": 1541871570, "creation_date": 1541871570, "answer_id": 53241676, "question_id": 53237759, "link": "https://stackoverflow.com/questions/53237759/how-to-correctly-send-rpc-call-using-golang-to-get-smart-contract-owner/53241676#53241676", "title": "How to correctly send RPC call using Golang to get smart-contract owner?", "body": "<p><strong>json: cannot unmarshal string into Go value of type main.response error.</strong> I got similar type error when i was unmarshaling a response. It was because the response was actually json string, i mean it had Quotation <code>\"</code> as first character. So to be sure you also encountered the same problem, please <code>printf(\"%v\",resp.Result)</code> before unmarshaling in here <a href=\"https://github.com/ethereum/go-ethereum/blob/1ff152f3a43e4adf030ac61eb5d8da345554fc5a/rpc/client.go#L278\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum/blob/1ff152f3a43e4adf030ac61eb5d8da345554fc5a/rpc/client.go#L278</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1542020152, "post_id": 53258739, "comment_id": 93405628, "body": "Sorry @P&#233;ter Szil&#225;gyi, I&#39;m not very clear. Can you show it in code? Thanks."}], "tags": [], "owner": {"reputation": 121, "user_id": 8295306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ecbf0f5b4b79eebf8c193e5d324357f?s=128&d=identicon&r=PG", "display_name": "P&#233;ter Szil&#225;gyi", "link": "https://stackoverflow.com/users/8295306/p%c3%a9ter-szil%c3%a1gyi"}, "is_accepted": false, "score": 1, "last_activity_date": 1542013131, "creation_date": 1542013131, "answer_id": 53258739, "question_id": 53237759, "link": "https://stackoverflow.com/questions/53237759/how-to-correctly-send-rpc-call-using-golang-to-get-smart-contract-owner/53258739#53258739", "title": "How to correctly send RPC call using Golang to get smart-contract owner?", "body": "<p>If you look at the client library code, you'll see that the JSON RPC response object is already disassembled and either an error is returned on failure, or the actual result parsed: <a href=\"https://github.com/ethereum/go-ethereum/blob/master/rpc/client.go#L277\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum/blob/master/rpc/client.go#L277</a></p>\n\n<p>The parser however already unwrapped the containing \"result\" field. Your type still wants to do an additional unwrap:</p>\n\n<pre><code>type response struct {\n    Result string\n}\n</code></pre>\n\n<p>Drop the outer struct, simply pass a string pointer to the <code>client.Call</code>'s first parameter. </p>\n"}, {"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1542022957, "post_id": 53260846, "comment_id": 93407084, "body": "Thanks. This is the closest solution. Appreciate your help!"}], "tags": [], "owner": {"reputation": 78, "user_id": 10595796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cff1f3d57b2f5e9f70b9f139911143be?s=128&d=identicon&r=PG&f=1", "display_name": "user10595796", "link": "https://stackoverflow.com/users/10595796/user10595796"}, "is_accepted": true, "score": 2, "last_activity_date": 1542022633, "last_edit_date": 1542022633, "creation_date": 1542020773, "answer_id": 53260846, "question_id": 53237759, "link": "https://stackoverflow.com/questions/53237759/how-to-correctly-send-rpc-call-using-golang-to-get-smart-contract-owner/53260846#53260846", "title": "How to correctly send RPC call using Golang to get smart-contract owner?", "body": "<p>You can solve the problem best using the <a href=\"https://godoc.org/github.com/ethereum/go-ethereum/ethclient\" rel=\"nofollow noreferrer\">go-ethereum/<strong>ethclient</strong></a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n\n    \"github.com/ethereum/go-ethereum\"\n    \"github.com/ethereum/go-ethereum/common\"\n    \"github.com/ethereum/go-ethereum/ethclient\"\n)\n\nfunc main() {\n    client, _ := ethclient.Dial(\"https://mainnet.infura.io\")\n    defer client.Close()\n\n    contractAddr := common.HexToAddress(\"0xCc13Fc627EFfd6E35D2D2706Ea3C4D7396c610ea\")\n    callMsg := ethereum.CallMsg{\n        To:   &amp;contractAddr,\n        Data: common.FromHex(\"0x8da5cb5b\"),\n    }\n\n    res, err := client.CallContract(context.Background(), callMsg, nil)\n    if err != nil {\n        log.Fatalf(\"Error calling contract: %v\", err)\n    }\n    log.Printf(\"Owner: %s\", common.BytesToAddress(res).Hex())\n}\n</code></pre>\n"}], "owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1352, "favorite_count": 0, "accepted_answer_id": 53260846, "answer_count": 4, "score": 1, "last_activity_date": 1542022633, "creation_date": 1541843259, "last_edit_date": 1541852600, "question_id": 53237759, "link": "https://stackoverflow.com/questions/53237759/how-to-correctly-send-rpc-call-using-golang-to-get-smart-contract-owner", "title": "How to correctly send RPC call using Golang to get smart-contract owner?", "body": "<p><strong>Update</strong></p>\n\n<p>Since I'm not able to achieve this using the approach in this question, I created my own library to do the same thing (<a href=\"https://github.com/zulhfreelancer/go-ethereum-get-contract-owner\" rel=\"nofollow noreferrer\">link</a>). It doesn't rely on go-ethereum package but use the normal <code>net/http</code> package to do JSON RPC request.</p>\n\n<p>I still love to know what I did wrong in my approach below.</p>\n\n<hr>\n\n<p><strong>Definitions</strong>:</p>\n\n<ul>\n<li><strong>owner</strong> = <code>public</code> variable in contract with <code>address</code> type</li>\n<li><strong>contract</strong> = smart-contract that has <strong>owner</strong></li>\n</ul>\n\n<p>This is the curl request to get the owner of a contract. I managed to get the owner. (<a href=\"https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_call\" rel=\"nofollow noreferrer\">JSON RPC docs</a>)</p>\n\n<pre><code>curl localhost:8545 -X POST \\\n--header 'Content-type: application/json' \\\n--data '{\"jsonrpc\":\"2.0\", \"method\":\"eth_call\", \"params\":[{\"to\": \"0x_MY_CONTRACT_ADDRESS\", \"data\": \"0x8da5cb5b\"}, \"latest\"], \"id\":1}'\n\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x000000000000000000000000_OWNER\"}\n</code></pre>\n\n<p>But when I try to replicate it in Golang (code below), I got <em>json: cannot unmarshal string into Go value of type main.response</em> error. (<a href=\"https://github.com/ethereum/go-ethereum/blob/master/rpc/client.go#L243\" rel=\"nofollow noreferrer\">go-ethereum code that I use</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"github.com/ethereum/go-ethereum/rpc\"\n)\n\nfunc main() {\n    client, err := rpc.DialHTTP(os.Getenv(\"RPC_SERVER\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer client.Close()\n\n    type request struct {\n        To   string `json:\"to\"`\n        Data string `json:\"data\"`\n    }\n\n    type response struct {\n        Result string\n    }\n\n    req := request{\"0x_MY_CONTRACT_ADDRESS\", \"0x8da5cb5b\"}\n    var resp response\n    if err := client.Call(&amp;resp, \"eth_call\", req, \"latest\"); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%v\\n\", resp)\n}\n</code></pre>\n\n<p>What did I miss here?</p>\n\n<p>Expected result:</p>\n\n<p>Address in string format. E.g. <code>0x3ab17372b25154400738C04B04f755321bB5a94b</code></p>\n\n<p>P/S \u2014 I'm aware of <a href=\"https://github.com/ethereum/go-ethereum/wiki/Native-DApps:-Go-bindings-to-Ethereum-contracts#generating-the-bindings\" rel=\"nofollow noreferrer\">abigen</a> and I know it's better and easier to do this using abigen. But I'm trying to solve this specific issue without using abigen method.</p>\n"}, {"tags": ["email", "go", "proxy", "smtpclient"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1541844529, "post_id": 53236820, "comment_id": 93361828, "body": "There&#39;s no such thing as an SMTP proxy, per se, except to the extent that every SMTP server can serve as a proxy.  Which exact &quot;system proxy settings&quot; were you thinking of using?"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541849467, "post_id": 53236820, "comment_id": 93362929, "body": "See <a href=\"https://github.com/Supme/directEmail/blob/master/send.go\" rel=\"nofollow noreferrer\">github.com/Supme/directEmail/blob/master/send.go</a> for some code that diverts SMTP through a socks proxy"}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "edited": false, "score": 0, "creation_date": 1541853886, "post_id": 53236820, "comment_id": 93364043, "body": "i am not trying to make a proxy server. the vm on where my code runs is behind a proxy, so i need a way by which my email client will make calls using proxy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1541864061, "post_id": 53236820, "comment_id": 93366691, "body": "@ChinmaySamant: This isn&#39;t a coding problem. You need to allow access to an SMTP server <i>somehow</i>, from within your VM. A common way to do this is with a &#39;smarthost&#39; (the SMTP term most similar to a &#39;proxy&#39;), but this is entirely a networking/server issue, nothing to do with coding."}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "edited": false, "score": 0, "creation_date": 1541915133, "post_id": 53236820, "comment_id": 93377324, "body": "i fail to understand how it&#39;s not a coding problem.!!  for http client in GO to work behind proxy i had to use <code>&amp;http.Transport{Proxy: http.ProxyFromEnvironment}</code> so in similar way, i am asking what should i use for smtp clinet in GO to make it work behind proxy?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1542215916, "post_id": 53236820, "comment_id": 93491969, "body": "Your &quot;proxy&quot; is an HTTP proxy. It proxies HTTP. It does not proxy SMTP. Contact your system administrator to find out the correct SMTP server to use for outgoing mail."}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1542267311, "post_id": 53236820, "comment_id": 93509002, "body": "@MichaelHampton yes !! we are using squid for proxy and we do have a socks proxy server.. but how will I configure these settings in the smtp go client."}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "edited": false, "score": 0, "creation_date": 1542284405, "post_id": 53236820, "comment_id": 93518624, "body": "for smtp proxy we have ngnx smtp proxy server"}], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1567701875, "post_id": 53704161, "comment_id": 102051148, "body": "For the benefit of users like me who are facing exactly same problem, it will be great if you can write in more detail how you tackled and solved this issue. I am not able to find any site on the net where it is explained in clear terms."}, {"owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1571308917, "post_id": 53704161, "comment_id": 103202015, "body": "when your VM is behind a firewall and if you try to access anything which is outside the firewall (ex. any public internet site), you won&#39;t be able to."}], "tags": [], "owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "is_accepted": false, "score": 1, "last_activity_date": 1544439179, "creation_date": 1544439179, "answer_id": 53704161, "question_id": 53236820, "link": "https://stackoverflow.com/questions/53236820/use-smtp-email-client-behind-proxy-in-go/53704161#53704161", "title": "Use SMTP / Email Client behind proxy in GO", "body": "<p>@Flimzy I am new to networking stuff and Yes! Now I understand that it was less of coding and more of a networking issue.</p>\n\n<p>Solution that worked for me was that I configured postfix on the proxy machine to relay it to the Gmail SMTP server. (make sure ur proxy machine has access to ur needed SMTP server)<br>\nProxy machine ip needs to be set as an SMTP host in SMTP golang client.</p>\n"}], "owner": {"reputation": 208, "user_id": 4636546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZNkW.jpg?s=128&g=1", "display_name": "Chinmay Samant", "link": "https://stackoverflow.com/users/4636546/chinmay-samant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 694, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1544439179, "creation_date": 1541834050, "last_edit_date": 1542177837, "question_id": 53236820, "link": "https://stackoverflow.com/questions/53236820/use-smtp-email-client-behind-proxy-in-go", "title": "Use SMTP / Email Client behind proxy in GO", "body": "<p>I am using \"net/mail\" and \"net/smtp\" to create an email client in Go, but it fails when it's behind the proxy.</p>\n\n<p>I had the same issue for http client but it got resolved using <code>&amp;http.Transport{Proxy: http.ProxyFromEnvironment}</code> couldn't find a similar fix for SMTP</p>\n\n<p>The below code works on my machine, which is behind the co-corporate proxy. but if I run the same code on a VM which is not behind any proxy, It works.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/smtp\"\n)\n\nfunc main() {\n    fmt.Println(\"email sending\")\n    // Set up authentication information.\n    auth := smtp.PlainAuth(\n        \"\",\n        \"ma****017@gmail.com\",\n        \"A***a\",\n        \"smtp.gmail.com\",\n    )\n    // Connect to the server, authenticate, set the sender and recipient,\n    // and send the email all in one step.\n    err := smtp.SendMail(\n        \"smtp.gmail.com:587\",\n        auth,\n        \"ma***17@gmail.com\",\n        []string{\"chi****11@gmail.com\"},\n        []byte(\"This is the email body.\"),\n    )\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"email sent\")\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "thermal-printer"], "comments": [{"owner": {"reputation": 2131, "user_id": 2343935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/li569.png?s=128&g=1", "display_name": "grooveplex", "link": "https://stackoverflow.com/users/2343935/grooveplex"}, "edited": false, "score": 0, "creation_date": 1541809052, "post_id": 53234875, "comment_id": 93356374, "body": "Maybe something like <a href=\"https://godoc.org/github.com/google/gousb\" rel=\"nofollow noreferrer\">godoc.org/github.com/google/gousb</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 11, "last_activity_date": 1541811005, "creation_date": 1541811005, "answer_id": 53235044, "question_id": 53234875, "link": "https://stackoverflow.com/questions/53234875/write-on-thermal-printer-device-in-golang/53235044#53235044", "title": "Write on thermal printer device in golang", "body": "<p>As described in the documentation <a href=\"https://golang.org/pkg/os/#Open\" rel=\"noreferrer\"><code>os.Open()</code></a> opens a file read-only.</p>\n\n<p>You would have discovered the problem if you had checked the return from your <a href=\"https://golang.org/pkg/os/#File.Write\" rel=\"noreferrer\"><code>Write()</code></a> call. Always check errors. Don't ignore them, even in tiny programs like this; they will give you a clue as to what is wrong.</p>\n\n<p>To fix the problem, open the device special for writing with <a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"noreferrer\"><code>os.OpenFile()</code></a>.</p>\n\n<pre><code>f, err := os.OpenFile(\"/dev/usb/lp0\", os.O_RDWR, 0)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6758447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/929ef000d12f9ecb944f9fa18217ea61?s=128&d=identicon&r=PG&f=1", "display_name": "Augusto Pimenta", "link": "https://stackoverflow.com/users/6758447/augusto-pimenta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1132, "favorite_count": 0, "accepted_answer_id": 53235044, "answer_count": 1, "score": 2, "last_activity_date": 1541811005, "creation_date": 1541808815, "question_id": 53234875, "link": "https://stackoverflow.com/questions/53234875/write-on-thermal-printer-device-in-golang", "title": "Write on thermal printer device in golang", "body": "<p>I have a thermal printer(ESC/POS) already configured on my linux machine and using the terminal command (as root) I can make it print:</p>\n\n<pre><code>echo \"Hello!\" &gt; /dev/usb/lp0\n</code></pre>\n\n<p>However, doing the same procedure in golang nothing happens:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n   fmt.Println(\"Hello Would!\")\n\n   f, err := os.Open(\"/dev/usb/lp0\")\n\n   if err != nil {\n       panic(err)\n   }\n\n   defer f.Close()\n\n   f.Write([]byte(\"Hello world!\"))\n}\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1541799155, "post_id": 53233415, "comment_id": 93353912, "body": "On windows it&#39;s likely to have <code>\\r\\n</code> as the string delimiter, confirm it with <code>fmt.Printf(&quot;% x&quot;, input)</code>"}, {"owner": {"reputation": 51, "user_id": 7003973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a183246795dca8379108c2e20e257171?s=128&d=identicon&r=PG&f=1", "display_name": "GoodRockqqSK", "link": "https://stackoverflow.com/users/7003973/goodrockqqsk"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1541799399, "post_id": 53233415, "comment_id": 93353979, "body": "But it doesn&#39;t work on linux. So I have to replace it twice?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1541799784, "post_id": 53233415, "comment_id": 93354090, "body": "Remove both <code>\\n</code> and <code>\\r</code>"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541799893, "post_id": 53233415, "comment_id": 93354116, "body": "<a href=\"https://stackoverflow.com/questions/14493867/what-is-the-most-portable-cross-platform-way-to-represent-a-newline-in-go-golang\" title=\"what is the most portable cross platform way to represent a newline in go golang\">stackoverflow.com/questions/14493867/&hellip;</a>"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1541800549, "post_id": 53233415, "comment_id": 93354313, "body": "Please include the output in the question, formatted as code, rather than as links to images."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 7003973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a183246795dca8379108c2e20e257171?s=128&d=identicon&r=PG&f=1", "display_name": "GoodRockqqSK", "link": "https://stackoverflow.com/users/7003973/goodrockqqsk"}, "is_accepted": true, "score": 3, "last_activity_date": 1541800200, "creation_date": 1541800200, "answer_id": 53233669, "question_id": 53233415, "link": "https://stackoverflow.com/questions/53233415/go-run-program-properly-on-linux-but-on-windows-not/53233669#53233669", "title": "Go run program properly on linux but on windows not", "body": "<p>Thanks for help from @zerkms.</p>\n\n<p>Answer is:</p>\n\n<pre><code>input = strings.Replace(input, \"\\r\", \"\", -1)\ninput = strings.Replace(input, \"\\n\", \"\", -1)\n</code></pre>\n\n<p>Now it will work properly both on windows and linux</p>\n"}], "owner": {"reputation": 51, "user_id": 7003973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a183246795dca8379108c2e20e257171?s=128&d=identicon&r=PG&f=1", "display_name": "GoodRockqqSK", "link": "https://stackoverflow.com/users/7003973/goodrockqqsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 53233669, "answer_count": 1, "score": 2, "last_activity_date": 1541800521, "creation_date": 1541798432, "last_edit_date": 1541800521, "question_id": 53233415, "link": "https://stackoverflow.com/questions/53233415/go-run-program-properly-on-linux-but-on-windows-not", "title": "Go run program properly on linux but on windows not", "body": "<p>I am currently learning Go lang. Trying it on different platforms: Linux, Windows\nWhen I run code on Linux it runs perfectly, but when I try this program on Windows it doesn't work.</p>\n\n<p>Its just simple cmd calculator which allows simple operations like add number, multiply eg. Its not handling wrong input like characters. It's my first program for adoption Go syntax</p>\n\n<p>What doesn't work:</p>\n\n<ol>\n<li>Parsing int</li>\n<li>Comparing input</li>\n</ol>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"math\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n\n    reader := bufio.NewReader(os.Stdin)\n    var operation int\n    var firstNumber float64\n    var secondNumber float64\n\n    fmt.Println(\"Simple cmd calculator\")\n\n    repeat := true\n\n    for repeat {\n\n        fmt.Println(\"Enter number 1: \")\n        firstNumber = getNumber(*reader)\n\n        fmt.Println(\"Enter number 2: \")\n        secondNumber = getNumber(*reader)\n\n        fmt.Println()\n\n        selectOperation(*reader, &amp;operation)\n\n        fmt.Print(\"You result is: \")\n\n        switch operation {\n        case 1:\n            fmt.Println(add(firstNumber, secondNumber))\n        case 2:\n            fmt.Println(subtract(firstNumber, secondNumber))\n        case 3:\n            fmt.Println(multiply(firstNumber, secondNumber))\n        case 4:\n            fmt.Println(divide(firstNumber, secondNumber))\n        }\n\n        fmt.Println(\"Do you want to continue? [Y/n]\")\n        input, _ := reader.ReadString('\\n')\n\n        input = strings.Replace(input, \"\\n\", \"\", -1)\n\n        if !(input == \"Y\" || input == \"y\") {\n            repeat = false\n        }\n\n    }\n\n}\n\nfunc selectOperation(reader bufio.Reader, operation *int) {\n    fmt.Println(\"1. Add\")\n    fmt.Println(\"2. Subtract\")\n    fmt.Println(\"3. Multiply\")\n    fmt.Println(\"4. Divide\")\n\n    fmt.Print(\"Select operation: \")\n    input, _ := reader.ReadString('\\n')\n    input = strings.Replace(input, \"\\n\", \"\", -1)\n    number, _ := strconv.Atoi(input)\n    *operation = number\n}\n\nfunc getNumber(reader bufio.Reader) float64 {\n\n    input, _ := reader.ReadString('\\n')\n    input = strings.Replace(input, \"\\n\", \"\", -1)\n    convertedNumber, _ := strconv.ParseFloat(input, 64)\n    return convertedNumber\n\n}\n\nfunc add(a float64, b float64) float64 {\n    return (math.Round((a+b)*100) / 100)\n}\n\nfunc subtract(a float64, b float64) float64 {\n    return (math.Round((a-b)*100) / 100)\n}\n\nfunc multiply(a float64, b float64) float64 {\n    return (math.Round(a*b*100) / 100)\n}\n\nfunc divide(a float64, b float64) float64 {\n    return (math.Round(a/b*100) / 100)\n}\n</code></pre>\n\n\n\n<p>Results:</p>\n\n<p><a href=\"https://i.stack.imgur.com/dM3XF.png\" rel=\"nofollow noreferrer\">Linux</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/p7oMw.jpg\" rel=\"nofollow noreferrer\">Windows</a></p>\n\n<p>Am I doing something wrong or it's not my bad?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1541790249, "post_id": 53231763, "comment_id": 93350579, "body": "Show what you tried so far. If you are having trouble getting started, see <a href=\"https://godoc.org/encoding/json#example-Unmarshal\" rel=\"nofollow noreferrer\">this example in the encoding/json doc</a>. Also, do you want a map or a slice? The title says associative/indexed array and the body says map"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541791398, "post_id": 53231763, "comment_id": 93351053, "body": "A slice would be the normal way to unmarshal a JSON array, and will let you do <code>Users[0].Name</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541792379, "post_id": 53231763, "comment_id": 93351478, "body": "This isn&#39;t a code-writing service. What have you tried? Include your code. What problems did you encounter?"}, {"owner": {"reputation": 159, "user_id": 3408453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c37h3.jpg?s=128&g=1", "display_name": "Aldo Maria Landini", "link": "https://stackoverflow.com/users/3408453/aldo-maria-landini"}, "edited": false, "score": 0, "creation_date": 1541795819, "post_id": 53231763, "comment_id": 93352829, "body": "I got a config.json, I put the entire content into map[string]interface{}, but the problem comes when I write Res[&quot;users&quot;][0] in order to take the first object. it wants I iterate the interface{} with a range, and fetch all fields, but I wish to access to that field in much beautiful notation associative-array like Res[&quot;users&quot;][0].Name, or something like that. I want to replace all interface{} field (like the object) with a map (being a collection of users I want map[int]map[string]string for the single user)"}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 3408453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c37h3.jpg?s=128&g=1", "display_name": "Aldo Maria Landini", "link": "https://stackoverflow.com/users/3408453/aldo-maria-landini"}, "edited": false, "score": 0, "creation_date": 1541845701, "post_id": 53235205, "comment_id": 93362139, "body": "OK! That&#39;s great! But I just want 1) to do that without struct (if it&#39;s possible), and 2) put that code in a function that return config, in this example. I tried but I had problem about the return type (because config is not always the same type), maybe we can hack this problem using pointer? In brief I want to do something as much flexible as possible, without struct and for every return type."}, {"owner": {"reputation": 159, "user_id": 3408453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c37h3.jpg?s=128&g=1", "display_name": "Aldo Maria Landini", "link": "https://stackoverflow.com/users/3408453/aldo-maria-landini"}, "edited": false, "score": 0, "creation_date": 1541846021, "post_id": 53235205, "comment_id": 93362202, "body": "The problem with return type is sometimes config is map[int]map[string]string, and other times is map[string]string (simple JSON)."}], "tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": false, "score": 0, "last_activity_date": 1541813061, "last_edit_date": 1541813061, "creation_date": 1541812716, "answer_id": 53235205, "question_id": 53231763, "link": "https://stackoverflow.com/questions/53231763/how-to-convert-json-into-associative-indexed-array/53235205#53235205", "title": "How to convert JSON into associative/indexed array", "body": "<blockquote>\n  <p>I wish to access to that field in much beautiful notation associative-array like Res[\"users\"][0].Name, or something like that.</p>\n</blockquote>\n\n<p>As mentioned in comments, arguably the <strong>nicest</strong> way would be using structs</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n    Name   string `json:\"name\"`\n    Type   string `json:\"type\"`\n    Age    int    `json:\"age\"`\n    Social struct {\n        Facebook string `json:\"facebook\"`\n        Twitter  string `json:\"twitter\"`\n    } `json:\"social\"`\n}\ntype Config struct {\n    Users []User `json:\"users\"`\n}\n\n\nrawJSON := []byte(`{...your config JSON in here...}`)\n\nconfig := Config{}\nif err := json.Unmarshal(rawJSON, &amp;config); err != nil {\n    log.Fatal(err)\n}\n\nuser := config.Users[0]\n\nfmt.Printf(\n    \"name: %s, type: %s, age: %d, facebook: %s, twitter: %s\\n\",\n    user.Name,\n    user.Type,\n    user.Age,\n    user.Social.Facebook,\n    user.Social.Twitter,\n)\n</code></pre>\n\n<p>Result:</p>\n\n<pre>\nname: Elliot, type: Reader, age: 23, facebook: https://facebook.com, twitter: https://twitter.com\n</pre>\n\n<p><a href=\"https://play.golang.org/p/AvKWWaa6WAZ\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 159, "user_id": 3408453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c37h3.jpg?s=128&g=1", "display_name": "Aldo Maria Landini", "link": "https://stackoverflow.com/users/3408453/aldo-maria-landini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1541813061, "creation_date": 1541789708, "last_edit_date": 1541792290, "question_id": 53231763, "link": "https://stackoverflow.com/questions/53231763/how-to-convert-json-into-associative-indexed-array", "title": "How to convert JSON into associative/indexed array", "body": "<p>Given this JSON</p>\n\n<pre><code>{\n  \"users\": [\n    {\n      \"name\" : \"Elliot\",\n      \"type\" : \"Reader\",\n      \"age\" : 23,\n      \"social\" : {\n        \"facebook\" : \"https://facebook.com\",\n        \"twitter\" : \"https://twitter.com\"\n      }\n    },\n    {\n      \"name\" : \"Fraser\",\n      \"type\" : \"Author\",\n      \"age\" : 17,\n      \"social\" : {\n        \"facebook\" : \"https://facebook.com\",\n        \"twitter\" : \"https://twitter.com\"\n      }\n    }\n  ]\n}\n</code></pre>\n\n<p>I need a function/library to return a <strong>map</strong> in order to do <code>myMap[0].name</code>  to get the value \"Elliot\".\nIs there anyone who can help me? Thanks.</p>\n"}, {"tags": ["go", "mocking", "composition", "apiclient"], "answers": [{"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 3, "last_activity_date": 1541790696, "creation_date": 1541790696, "answer_id": 53231951, "question_id": 53231070, "link": "https://stackoverflow.com/questions/53231070/how-to-nest-endpoints-in-a-api-client-with-interfaces-while-keeping-readability/53231951#53231951", "title": "How to nest endpoints in a API client with interfaces while keeping readability", "body": "<p>You are fighting with language and bringing your OOP hobbies into language that is not designed for that.</p>\n\n<p>I personally would change direction and use old good flat structures and functions.</p>\n\n<p>Although, if you want to continue with your design, you can mock not interface but whole <code>http</code> stack. You can test your code with much better confidence as you testing real <code>http</code> payload vs making calls to your interfaces.</p>\n\n<p>Inject <code>HttpClient</code> into <code>Vehicle</code>: <code>func NewVehicle(httpClient *http.Client){}</code></p>\n\n<p>In test code, use <code>*http.ServeMux</code>:</p>\n\n<pre><code>mux.Handle(\"/path1\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // assessments and mocked response\n}))\nmux.Handle(\"/path2\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // assessments and mocked response\n}))\n// fallback to show not implemented routes\nresult.mux.Handle(\"/\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        result.t.Errorf(\"Not Supported route %q\", r.URL.Path)\n}))\n</code></pre>\n\n<p>Build Http Server:</p>\n\n<pre><code>server := httptest.NewServer(mux)\n</code></pre>\n\n<p>Create Http Client from mux server:</p>\n\n<pre><code>client := server.Client()\n</code></pre>\n"}], "owner": {"reputation": 1421, "user_id": 706521, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gj7QH.jpg?s=128&g=1", "display_name": "Adrian Forsius", "link": "https://stackoverflow.com/users/706521/adrian-forsius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 53231951, "answer_count": 1, "score": 1, "last_activity_date": 1541792390, "creation_date": 1541786400, "last_edit_date": 1541792390, "question_id": 53231070, "link": "https://stackoverflow.com/questions/53231070/how-to-nest-endpoints-in-a-api-client-with-interfaces-while-keeping-readability", "title": "How to nest endpoints in a API client with interfaces while keeping readability", "body": "<p>I'm trying to compose a simple API client I'm stuck trying to figure out how to make it readable and testable. How can I compose a nested structure while keeping it testable?</p>\n\n<p><strong>Psuedo code:</strong></p>\n\n<pre><code>type VehicleEndpoint struct {\n    Car CarEndpoint\n    VehicleGetter\n}\n\ntype VehicleGetter interface {\n    Get(string) Vehicle\n}\n\ntype Vehicle struct {\n    kind string\n}\n\ntype VehicleClient struct {\n    http.Client\n    url string\n}\n\nfunc (v *VehicleClient) Get(kind string) Vehicle {\n    resp := v.Do(v.url, kind)\n    return Vehicle{\n        kind: resp.Kind\n    }\n}\n\n\ntype CarEndpoint struct\n...\n\ntype CarGetter interface\n...\n\ntype Car struct\n...\n\ntype CarClient struct\n...\n\n\ntype API struct {\n    Vehicle VehicleEndpoint\n}\n\napi := API{\n    Vehicle: VehicleEndpoint{\n        VehicleGetter: VehicleClient{\n            http.Client{},\n        }\n        Car: CarEndpoint{\n          CarGetter: CarClient{\n            http.Client{},\n          }\n       }\n    }\n}\n</code></pre>\n\n<p>Now I can call API like so:</p>\n\n<pre><code>api.Vehicle.Car.Get(kind)\n</code></pre>\n\n<p>This gives me a very readable (nested) implementation to work with however I'm having a hard time mocking these endpoints because the use of interface would effectively remove any recognition of the nested structure.\nWhat would be the recommended way to construct an API keeping it very readable while also having each endpoint mocked?</p>\n"}, {"tags": ["go", "types", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1541782929, "post_id": 53230238, "comment_id": 93347168, "body": "from the FAQ: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"reputation": 1640, "user_id": 5531595, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/455940914617164/picture?type=large", "display_name": "Rohman HM", "link": "https://stackoverflow.com/users/5531595/rohman-hm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1541783143, "post_id": 53230238, "comment_id": 93347287, "body": "I got error <code>panic: reflect.Set: value of type []interface {} is not assignable to type []main.mytype</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1541784388, "post_id": 53230238, "comment_id": 93347939, "body": "&quot;don&#39;t know how to make a dynamic type in Golang&quot; - you can&#39;t, period. Go is a statically-typed language."}], "answers": [{"tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": false, "score": 0, "last_activity_date": 1541785962, "creation_date": 1541785962, "answer_id": 53230955, "question_id": 53230238, "link": "https://stackoverflow.com/questions/53230238/how-to-assign-dynamic-types-in-slices/53230955#53230955", "title": "How to assign dynamic types in slices", "body": "<p>So go doesn't let you do dynamic types like that. So if you want your code to work with <code>mytype</code>, try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\n//Reverse reverses a slice.\nfunc Reverse(slice *[]mytype) {\n    s := reflect.ValueOf(slice)\n\n    if s.Kind() != reflect.Ptr {\n        panic(\"Must be a pointer\")\n    }\n\n    sliceLen := s.Elem().Len()\n    sliceType := *slice\n    for left, right := 0, sliceLen-1; left &lt; right; left, right = left+1, right-1 {\n        sliceType[left], sliceType[right] = sliceType[right], sliceType[left]\n    }\n\n    s.Elem().Set(reflect.ValueOf(sliceType))\n}\n\ntype mytype int\n\nfunc main() {\n    var slice = []mytype{11, 22, 33, 44}\n\n    Reverse(&amp;slice)\n    fmt.Println(\"RESULT\", slice) // RESULT [44 33 22 11]\n}\n</code></pre>\n\n<p>However, you might be thinking: \"well I need to reverse lots of different types of slices...\". Well go has you covered there as well! </p>\n\n<p>Check out <a href=\"https://golang.org/pkg/sort/#Reverse\" rel=\"nofollow noreferrer\">sort.Reverse</a>.</p>\n\n<p>The sort package offers an interesting pattern that many gophers use to get around the lack of generics/templates in go. The tl;dr of the pattern is to use interfaces and add methods to those interfaces to modify the underlying data. That way each implementation of the interface knows the type, but the receiving method doesn't have to care.</p>\n"}], "owner": {"reputation": 1640, "user_id": 5531595, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/455940914617164/picture?type=large", "display_name": "Rohman HM", "link": "https://stackoverflow.com/users/5531595/rohman-hm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 617, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1541792409, "creation_date": 1541782873, "last_edit_date": 1541792409, "question_id": 53230238, "link": "https://stackoverflow.com/questions/53230238/how-to-assign-dynamic-types-in-slices", "title": "How to assign dynamic types in slices", "body": "<p>I made an app to reverse slice/array.\nI had a problem when make a slice with my own type.\nHere's will not work</p>\n\n<pre><code>type mytype int\n\nfunc main() {\n    // []mytype doesn't work\n    // var slice = []mytype{11, 22, 33, 44}\n</code></pre>\n\n<p>But if I change <code>mytype</code> to <code>int</code> it will work</p>\n\n<pre><code>// []int It works\n    var slice = []int{11, 22, 33, 44}\n</code></pre>\n\n<p>The error says\n<code>\npanic: interface conversion: interface {} is *[]main.mytype, not *[]int\n</code></p>\n\n<p>I figure out that the errors come from this line</p>\n\n<pre><code>sliceType := *slice.(*[]int)\n</code></pre>\n\n<p>Because I declaring the <code>sliceType</code> as <code>int</code>. I still don't know how to make a dynamic type in Golang.</p>\n\n<p>Any help will be appreciate. Here's the Golang Playground of my code <a href=\"https://play.golang.org/p/5QyTMcZFGPi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5QyTMcZFGPi</a></p>\n"}]